"use strict";(self.webpackChunkdefraMap=self.webpackChunkdefraMap||[]).push([[9003,4292,6314,8643,3840,7210],{74756:function(e,t,r){r.r(t),r.d(t,{default:function(){return L}});var i=r(53804),n=r(93040),s=r(78879),o=r(61500),a=r(30905),l=r(21609),c=r(31609),u=r(75218),h=r(40633),d=r(95929),p=r(60539),f=r(90683),m=r(23502),g=(r(58941),r(65953)),y=r(81392),_=r(57165),v=r(51432),b=r(43173),x=r(11876),S=r(83525),w=(r(13798),r(22739));const T=new Set(["ar","bs","ca","hr","cs","da","nl","en","et","fi","fr","de","el","he","hu","id","it","ja","ko","lv","lt","nb","pl","ro","ru","sr","es","sv","th","tr","uk","vi"]);let A=class extends S.A{constructor(e){super(e),this.id=null,this.language=null,this.places=null,this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2/webmaps",this.worldview=null}getLanguageParamValue(){if(this.language)return this.language;const e=(0,w.JK)().toLowerCase();switch(e){case"pt-br":return"pt-BR";case"pt-pt":return"pt-PT";case"zh-cn":return"zh-CN";case"zh-hk":return"zh-HK";case"zh-tw":return"zh-TW"}const t=(0,w.Z0)(e);return"pt"===t?"pt-BR":t&&T.has(t)?t:"global"}};(0,i._)([(0,m.MZ)()],A.prototype,"id",void 0),(0,i._)([(0,m.MZ)()],A.prototype,"language",void 0),(0,i._)([(0,m.MZ)()],A.prototype,"places",void 0),(0,i._)([(0,m.MZ)()],A.prototype,"serviceUrl",void 0),(0,i._)([(0,m.MZ)()],A.prototype,"worldview",void 0),A=(0,i._)([(0,g.$)("esri.support.BasemapStyle")],A);const C=A;var E,M=r(84624);let R=0,P=E=class extends((0,a.Te)(c.A)){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.style=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+R++,this.baseLayers=new s.A,this.referenceLayers=new s.A;const t=e=>{e.parent&&e.parent!==this&&"remove"in e.parent&&e.parent.remove(e),e.parent=this,"elevation"===e.type&&h.A.getLogger(this).error(`Layer '${e.title}, id:${e.id}' of type '${e.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=e=>{e.parent=null};this.addHandles([this.baseLayers.on("after-add",(e=>t(e.item))),this.referenceLayers.on("after-add",(e=>t(e.item))),this.baseLayers.on("after-remove",(e=>r(e.item))),this.referenceLayers.on("after-remove",(e=>r(e.item)))])}initialize(){this.when().catch((e=>{h.A.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.baseLayers.toArray();for(const t of e)t.destroy();const t=this.referenceLayers.toArray();for(const e of t)e.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem=(0,d.pR)(this.portalItem)}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set baseLayers(e){this._set("baseLayers",(0,o.V)(e,this._get("baseLayers")))}_writeBaseLayers(e,t,r){const i=[];e?(r={...r,layerContainerType:"basemap"},this.baseLayers.forEach((e=>{const t=(0,M.CJ)(e,r.webmap?r.webmap.getLayerJSONFromResourceInfo(e):null,r);null!=t&&i.push(t)})),this.referenceLayers.forEach((e=>{const t=(0,M.CJ)(e,r.webmap?r.webmap.getLayerJSONFromResourceInfo(e):null,r);null!=t&&("scene"!==e.type&&(t.isReference=!0),i.push(t))})),t.baseMapLayers=i):t.baseMapLayers=i}set referenceLayers(e){this._set("referenceLayers",(0,o.V)(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return(0,u.g)(this,(e=>{e(this.baseLayers,this.referenceLayers)}))}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map((e=>(0,l.Nb)(e)?e.clone():e)),referenceLayers:this.referenceLayers.map((e=>(0,l.Nb)(e)?e.clone():e))};return this.loaded&&(e.loadStatus="loaded"),new E({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){return e=e||{},t?.origin||(t={origin:"web-map",...t}),super.write(e,t),!this.loaded&&this.resourceInfo?.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map((e=>{const t=(0,l.o8)(e);return t.url&&(0,f.BQ)(t.url)&&(t.url=`https:${t.url}`),t.templateUrl&&(0,f.BQ)(t.templateUrl)&&(t.templateUrl=`https:${t.templateUrl}`),t}))),e}async _loadFromSource(e){const{resourceInfo:t,portalItem:r,style:i}=this;(0,p.Te)(e);const n=[];if(t){const r=t.context?t.context.url:null;if(n.push(this._loadLayersFromJSON(t.data,r,e)),t.data.id&&!t.data.title){const e=t.data.id;n.push((0,x.q)(e).then((e=>{e&&this.read({title:e},t.context)})))}}else r?n.push(this._loadFromItem(r,e)):i&&n.push(this._loadFromStylesService(i,e));await Promise.all(n)}async _loadLayersFromJSON(e,t,i){const n=this.resourceInfo?.context,s=this.portalItem?.portal||n?.portal||null,o=I[n?.origin||""]??"web-map",{populateOperationalLayers:a}=await r.e(3538).then(r.bind(r,80669)),l=[];if((0,p.Te)(i),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const r={context:{...n,origin:o,url:t,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},i=e=>"web-scene"===o&&"ArcGISSceneServiceLayer"===e.layerType||e.isReference,c=a(this.baseLayers,e.baseMapLayers.filter((e=>!i(e))),r);l.push(c);const u=a(this.referenceLayers,e.baseMapLayers.filter(i),r);l.push(u)}await Promise.allSettled(l)}async _loadFromItem(e,t){const r=await e.load(t),i=await r.fetchData("json",t),n=(0,f.An)(e.itemUrl??"");return this._set("resourceInfo",{data:i.baseMap??{},context:{origin:O[e.type||""]??"web-map",portal:e.portal||v.A.getDefault(),url:n}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||v.A.getDefault(),url:n}),this._loadLayersFromJSON(this.resourceInfo.data,n,t)}async _loadFromStylesService(e,t){const r=`${e.serviceUrl}/${e.id}`,i=(await(0,n.A)(r,{query:{language:e.getLanguageParamValue(),places:e.places,worldview:e.worldview},signal:t?.signal})).data,s=(0,f.An)(r);return this._set("resourceInfo",{data:i.baseMap??{},context:{origin:"web-map",url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this._loadLayersFromJSON(this.resourceInfo.data,s,t)}static fromId(e){const t=x.H[e];return t?t.itemId?new E({portalItem:{id:t.itemId,portal:{url:"https://www.arcgis.com"}}}):E.fromJSON(t,{origin:t.is3d?"web-scene":"web-map"}):null}};(0,i._)([(0,m.MZ)({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,r,i){this._writeBaseLayers(e,t,i)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:s.A}},writer(e,t,r,i){this._writeBaseLayers(e,t,i)}}}}}})],P.prototype,"baseLayers",null),(0,i._)([(0,m.MZ)({type:String,json:{origins:{"web-scene":{write:!0}}}})],P.prototype,"id",void 0),(0,i._)([(0,m.MZ)({type:b.default})],P.prototype,"portalItem",void 0),(0,i._)([(0,m.MZ)()],P.prototype,"referenceLayers",null),(0,i._)([(0,m.MZ)({readOnly:!0})],P.prototype,"resourceInfo",void 0),(0,i._)([(0,m.MZ)({type:_.A})],P.prototype,"spatialReference",void 0),(0,i._)([(0,m.MZ)({type:C})],P.prototype,"style",void 0),(0,i._)([(0,m.MZ)()],P.prototype,"thumbnailUrl",void 0),(0,i._)([(0,m.MZ)({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],P.prototype,"title",void 0),(0,i._)([(0,y.K)("title")],P.prototype,"writeTitle",null),P=E=(0,i._)([(0,g.$)("esri.Basemap")],P);const O={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},I={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},L=P},38474:function(e,t,r){r.d(t,{C:function(){return b},b:function(){return v}});var i=r(27264),n=r(13668),s=r(34178),o=r(27271),a=r(85709),l=r(84435),c=r(78946),u=r(58766),h=r(28686),d=r(23864),p=r(20830),f=r(38917),m=r(39506),g=r(62988),y=r(55890),_=r(65839);function v(e){const t=new g.N5,{vertex:r,fragment:v,attributes:b,varyings:x}=t;(0,p.NB)(r,e),t.include(s.d,e),t.include(a.c,e),t.include(u.A,e),t.include(o.g,e),b.add(_.r.POSITION,"vec3"),e.vvColor&&b.add(_.r.COLORFEATUREATTRIBUTE,"float"),x.add("vColor","vec4"),x.add("vpos","vec3");const S=e.multipassEnabled&&e.output===i.V.Color;S&&x.add("depth","float"),r.uniforms.add(new f.E("eColor",(e=>e.color))),r.code.add(m.H`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${e.hasVertexColors?"vColor *= eColor;":e.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${S?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),t.include(n.HQ,e),S&&t.include(c.Q,e),v.include(d.a);const w=e.output===i.V.Highlight;return w&&t.include(l.Qh,e),e.transparencyPassType===y.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),v.code.add(m.H`
  void main() {
    discardBySlice(vpos);
    ${S?"terrainDepthTest(depth);":""}
    vec4 fColor = vColor;

    ${e.output===i.V.ObjectAndLayerIdColor?m.H`fColor.a = 1.0;`:""}

    if (fColor.a < ${m.H.float(h.y)}) {
      discard;
    }

    ${e.output===i.V.Color?m.H`fragColor = highlightSlice(fColor, vpos); ${e.transparencyPassType===y.y.ColorAlpha?m.H`
                  fragColor = premultiplyAlpha(fragColor);
                  fragAlpha = fragColor.a;`:""}`:""}
    ${w?m.H`outputHighlight();`:""};
    ${e.output===i.V.ObjectAndLayerIdColor?m.H`outputObjectAndLayerIdColor();`:""}
  }
  `),t}const b=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}))},62480:function(e,t,r){r.d(t,{D:function(){return B},b:function(){return G}});var i=r(30087),n=r(36101),s=r(27264),o=r(13668),a=r(34178),l=r(14812),c=r(11377),u=r(91765),h=r(40883),d=r(2457),p=r(85709),f=r(94211),m=r(74603),g=r(15209),y=r(40602),_=r(63684),v=r(97910),b=r(42426),x=r(78946),S=r(50865),w=r(51942),T=r(11520),A=r(56574),C=r(86207),E=r(58766),M=r(28686),R=r(1354),P=r(54613),O=r(20830),I=r(82598),L=r(38917),N=r(14543),D=r(39506),F=r(62988),z=r(39838),V=r(55890),U=r(65839);function G(e){const t=new F.N5,{vertex:r,fragment:G,varyings:B}=t;if((0,O.NB)(r,e),t.include(u.I),B.add("vpos","vec3"),t.include(E.A,e),t.include(l.BK,e),t.include(m.G,e),t.include(C.q2,e),e.output===s.V.Color){t.include(C.Sx,e),t.include(C.MU,e),t.include(C.O1,e),t.include(C.QM,e),(0,O.yu)(r,e),t.include(c.Y,e),t.include(a.d,e);const s=e.normalType===c.W.Attribute||e.normalType===c.W.Compressed;s&&e.offsetBackfaces&&t.include(n.M),t.include(y.W,e),t.include(f.Mh,e),e.instancedColor&&t.attributes.add(U.r.INSTANCECOLOR,"vec4"),B.add("vPositionLocal","vec3"),t.include(d.U,e),t.include(i.oD,e),t.include(h.K,e),t.include(p.c,e),r.uniforms.add(new L.E("externalColor",(e=>e.externalColor))),B.add("vcolorExt","vec4"),e.multipassEnabled&&B.add("depth","float"),r.code.add(D.H`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${e.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${D.H.float(M.y)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = getVertexInLocalOriginSpace();
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${s?D.H`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${e.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${s&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${e.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        forwardColorUV();
        forwardNormalUV();
        forwardEmissiveUV();
        forwardOcclusionUV();
        forwardMetallicRoughnessUV();
      }
    `),t.include(o.HQ,e),t.include(v.kA,e),t.include(_.n,e),t.include(R.S,e),t.include(e.instancedDoublePrecision?A.G:A.Bz,e),t.include(x.Q,e),(0,O.yu)(G,e),G.uniforms.add(r.uniforms.get("localOrigin"),new I.t("ambient",(e=>e.ambient)),new I.t("diffuse",(e=>e.diffuse)),new N.m("opacity",(e=>e.opacity)),new N.m("layerOpacity",(e=>e.layerOpacity))),e.hasColorTexture&&G.uniforms.add(new z.N("tex",(e=>e.texture))),t.include(T._Z,e),t.include(w.c,e),G.include(P.N),t.include(S.r,e),(0,v.a8)(G),(0,v.eU)(G),(0,b.O4)(G),e.transparencyPassType===V.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),G.code.add(D.H`
      void main() {
        discardBySlice(vpos);
        ${e.multipassEnabled?"terrainDepthTest(depth);":""}
        ${e.hasColorTexture?D.H`
                vec4 texColor = texture(tex, ${e.hasColorTextureTransform?D.H`colorUV`:D.H`vuv0`});
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:D.H`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${e.normalType===c.W.ScreenDerivative?D.H`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:D.H`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${e.pbrMode===T.A9.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse() * getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${e.receiveShadows?"readShadowMap(vpos, linearDepth)":e.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?D.H`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:D.H`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.hasNormalTexture?D.H`
                mat3 tangentSpace = ${e.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${e.hasNormalTextureTransform?D.H`normalUV`:"vuv0"});`:D.H`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${e.spherical?D.H`normalize(posWorld);`:D.H`vec3(0.0, 0.0, 1.0);`}

        ${e.snowCover?D.H`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${e.pbrMode===T.A9.Normal||e.pbrMode===T.A9.Schematic?D.H`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${e.snowCover?D.H`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:D.H`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===V.y.ColorAlpha?D.H`
                  fragColor = premultiplyAlpha(fragColor);
                  fragAlpha = fragColor.a;`:""}
      }
    `)}return t.include(g.E,e),t}const B=Object.freeze(Object.defineProperty({__proto__:null,build:G},Symbol.toStringTag,{value:"Module"}))},88008:function(e,t,r){r.d(t,{H:function(){return I},b:function(){return M},c:function(){return P}});var i=r(13786),n=r(1932),s=r(41546),o=r(27264),a=r(13668),l=r(27271),c=r(10155),u=r(1143),h=r(50399),d=r(80231),p=r(84435),f=r(58766),m=r(28686),g=r(23864),y=r(52766),_=r(19202),v=r(20830),b=r(11687),x=r(38917),S=r(14543),w=r(39506),T=r(62988),A=r(39838),C=r(55890),E=r(65839);function M(e){const t=new T.N5,r=e.signedDistanceFieldEnabled;if(t.include(u.Q,e),t.include(a.HQ,e),e.occlusionPass)return t.include(h.I,e),t;const{vertex:n,fragment:M}=t;t.include(_.Y6),M.include(y.W),M.include(g.a),t.include(f.A,e),t.include(l.g,e),t.include(d.y),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),t.varyings.add("voccluded","float"),n.uniforms.add(new x.E("viewport",((e,t)=>t.camera.fullViewport)),new b.G("screenOffset",((e,t)=>(0,i.hZ)(O,2*e.screenOffset[0]*t.camera.pixelRatio,2*e.screenOffset[1]*t.camera.pixelRatio))),new b.G("anchorPosition",(e=>P(e))),new x.E("materialColor",(e=>e.color))),(0,v.Nz)(n),r&&(n.uniforms.add(new x.E("outlineColor",(e=>e.outlineColor))),M.uniforms.add(new x.E("outlineColor",(e=>R(e)?e.outlineColor:s.uY)),new S.m("outlineSize",(e=>R(e)?e.outlineSize:0)))),e.pixelSnappingEnabled&&n.include(c.K),e.hasScreenSizePerspective&&((0,_.pM)(n),(0,_.OH)(n)),e.debugDrawLabelBorder&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(E.r.UV0,"vec2"),t.attributes.add(E.r.COLOR,"vec4"),t.attributes.add(E.r.SIZE,"vec2"),t.attributes.add(E.r.FEATUREATTRIBUTE,"vec4"),n.code.add(w.H`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.hasScreenSizePerspective?w.H`
            inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
            vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:w.H`
            inputSize = size;
            vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(featureAttribute).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);
      bool visible = testHUDVisibility(posProj);
      voccluded = visible ? 0.0 : 1.0;
    `);const I=w.H`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,L=e.pixelSnappingEnabled?r?w.H`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:w.H`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:w.H`posProj += quadOffset;`;n.code.add(w.H`
    ${e.occlusionTestEnabled?"if (visible) {":""}
    ${I}
    ${e.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${e.output===o.V.ObjectAndLayerIdColor?w.H`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${w.H.float(m.y)};
    ${r?`alphaDiscard = alphaDiscard && outlineColor.a < ${w.H.float(m.y)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${L}
      gl_Position = posProj;
    }

    vtc = uv;

    ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${e.occlusionTestEnabled?w.H`} else { vtc = vec2(0.0);
      ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),M.uniforms.add(new A.N("tex",(e=>e.texture)));const N=e.debugDrawLabelBorder?w.H`(isBorder > 0.0 ? 0.0 : ${w.H.float(m.H)})`:w.H.float(m.H),D=w.H`
    ${e.debugDrawLabelBorder?w.H`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${e.sampleSignedDistanceFieldTexelCenter?w.H`
      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;
      `:w.H`
      vec2 samplePos = vtc;
      `}

    ${r?w.H`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${N} ||
          fillPixelColor.a + outlinePixelColor.a < ${w.H.float(m.y)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${N}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:w.H`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${N}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${e.debugDrawLabelBorder?w.H`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;switch(e.output){case o.V.Color:e.transparencyPassType===C.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),M.code.add(w.H`
        void main() {
          ${D}
          ${e.transparencyPassType===C.y.FrontFace?"fragColor.rgb /= fragColor.a;":""}
          ${e.transparencyPassType===C.y.ColorAlpha?"fragAlpha = fragColor.a;":""}
        }`);break;case o.V.ObjectAndLayerIdColor:M.code.add(w.H`
        void main() {
          ${D}
          outputObjectAndLayerIdColor();
        }`);break;case o.V.Highlight:M.constants.add("occludedHighlightFlag","vec4",p.U),M.constants.add("unoccludedHighlightFlag","vec4",p.bO),M.code.add(w.H`
        void main() {
          ${D}
          if (voccluded == 1.0) {
            fragColor = occludedHighlightFlag;
          } else {
            fragColor = unoccludedHighlightFlag;
          }
        }`)}return t}function R(e){return e.outlineColor[3]>0&&e.outlineSize>0}function P(e,t=O){return e.textureIsSignedDistanceField?function(e,t,r){null!=t?(0,i.hZ)(r,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):(0,i.hZ)(r,0,0)}(e.anchorPosition,e.distanceFieldBoundingBox,t):(0,i.C)(t,e.anchorPosition),t}const O=(0,n.vt)(),I=Object.freeze(Object.defineProperty({__proto__:null,build:M,calculateAnchorPosForRendering:P},Symbol.toStringTag,{value:"Module"}))},74810:function(e,t,r){r.d(t,{L:function(){return x},b:function(){return _}});var i=r(13786),n=r(1932),s=r(41546),o=r(13668),a=r(10155),l=r(1143),c=r(80231),u=r(98901),h=r(19202),d=r(11687),p=r(38917),f=r(14543),m=r(39506),g=r(62988),y=r(65839);function _(e){const t=new g.N5,{vertex:r,fragment:n}=t;return r.include(a.K),t.include(l.Q,e),t.include(o.HQ,e),t.attributes.add(y.r.UV0,"vec2"),r.uniforms.add(new p.E("viewport",((e,t)=>t.camera.fullViewport)),new f.m("lineSize",((e,t)=>e.size>0?Math.max(1,e.size)*t.camera.pixelRatio:0)),new d.G("pixelToNDC",((e,t)=>(0,i.hZ)(b,2/t.camera.fullViewport[2],2/t.camera.fullViewport[3]))),new f.m("borderSize",((e,t)=>null!=e.borderColor?t.camera.pixelRatio:0)),new d.G("screenOffset",((e,t)=>(0,i.hZ)(b,e.horizontalScreenOffset*t.camera.pixelRatio,0)))),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),e.multipassEnabled&&t.varyings.add("depth","float"),e.occlusionTestEnabled&&t.include(c.y),e.hasScreenSizePerspective&&(0,h.OH)(r),r.code.add(m.H`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${e.occlusionTestEnabled?m.H`
      if (!testHUDVisibility(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${e.hasScreenSizePerspective?m.H`
      vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:m.H`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${e.multipassEnabled?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(centerOffsetAndDistance.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${e.depthHudEnabled?e.depthHudAlignStartEnabled?m.H`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:m.H`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${e.hasScreenSizePerspective?m.H`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:m.H`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),n.uniforms.add(new p.E("uColor",(e=>v(e.color))),new p.E("borderColor",(e=>v(e.borderColor)))),e.multipassEnabled&&(n.include(u.H,e),n.uniforms.add(new d.G("inverseViewport",((e,t)=>t.inverseViewport)))),n.code.add(m.H`
    void main() {
      ${e.multipassEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${e.depthHudEnabled?m.H`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:m.H`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),t}function v(e){return null!=e?e:s.uY}const b=(0,n.vt)(),x=Object.freeze(Object.defineProperty({__proto__:null,build:_},Symbol.toStringTag,{value:"Module"}))},88630:function(e,t,r){r.d(t,{L:function(){return T},b:function(){return w}});var i=r(33710),n=r(27264),s=r(13668),o=r(55123),a=r(91981),l=r(78946),c=r(28686),u=r(23864),h=r(52766),d=r(20830),p=r(11687),f=r(38917),m=r(14543),g=r(39506),y=r(70340),_=r(62988),v=r(39838),b=r(55890),x=r(65839),S=r(50678);function w(e){const t=new _.N5,r=e.multipassEnabled&&e.output===n.V.Color,w=e.space===S.lM.World;t.include(o.s,e),t.include(a.r,e);const{vertex:T,fragment:A}=t;return A.include(h.W),(0,d.NB)(T,e),t.attributes.add(x.r.POSITION,"vec3"),t.attributes.add(x.r.PREVPOSITION,"vec3"),t.attributes.add(x.r.UV0,"vec2"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vUV","vec2"),t.varyings.add("vSize","float"),r&&t.varyings.add("depth","float"),e.hasTip&&t.varyings.add("vLineWidth","float"),T.uniforms.add(new p.G("nearFar",((e,t)=>t.camera.nearFar)),new f.E("viewport",((e,t)=>t.camera.fullViewport))),T.code.add(g.H`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),T.code.add(g.H`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),w?(t.attributes.add(x.r.NORMAL,"vec3"),(0,d.S7)(T),T.constants.add("tiltThreshold","float",.7),T.code.add(g.H`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):T.code.add(g.H`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),T.code.add(g.H`
      #define vecN ${w?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${w?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${e.anchor===S.kJ.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),e.space===S.lM.Screen&&(T.uniforms.add(new y.X("inverseProjectionMatrix",((e,t)=>t.camera.inverseProjectionMatrix))),T.code.add(g.H`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),T.code.add(g.H`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),T.uniforms.add(new m.m("perScreenPixelRatio",((e,t)=>t.camera.perScreenPixelRatio))),T.code.add(g.H`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${e.hasCap?"\n                if(prev.z > posLeft.z) {\n                  vec2 diff = posLeft.xy - posRight.xy;\n                  planeOrigin.xy += perpendicular(diff) / 2.0;\n                }\n              ":""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),(0,d.Nz)(T),T.code.add(g.H`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position, 1.0);
vec4 prev = view * vec4(prevPosition, 1.0);
clip(pos, prev);`),w?(e.hideOnShortSegments&&T.code.add(g.H`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),T.code.add(g.H`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(T.code.add(g.H`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),e.space===S.lM.Screen&&T.code.add(g.H`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),T.code.add(g.H`
        ${r?"depth = pos.z;":""}

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${w?"":"vUV *= displacedPosScreen.w;"}

        ${e.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),r&&t.include(l.Q,e),t.include(s.HQ,e),A.uniforms.add(new f.E("intrinsicColor",(e=>e.color)),new v.N("tex",(e=>e.markerTexture))),A.include(u.a),t.constants.add("texelSize","float",1/i.vO),A.code.add(g.H`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),e.hasTip&&(t.constants.add("relativeMarkerSize","float",i.Cz/i.vO),t.constants.add("relativeTipLineWidth","float",i.DZ),A.code.add(g.H`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${w?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),e.transparencyPassType===b.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),t.constants.add("symbolAlphaCutoff","float",c.y),A.code.add(g.H`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${w?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${e.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${e.output===n.V.ObjectAndLayerIdColor?g.H`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${e.output===n.V.Color?g.H`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===n.V.Color&&e.transparencyPassType===b.y.ColorAlpha?g.H`
            fragColor = premultiplyAlpha(fragColor);
            fragAlpha = fragColor.a;`:""}
    ${e.output===n.V.Highlight?g.H`fragColor = vec4(1.0);`:""}
  }
  `),t}const T=Object.freeze(Object.defineProperty({__proto__:null,build:w},Symbol.toStringTag,{value:"Module"}))},59121:function(e,t,r){r.d(t,{N:function(){return g},b:function(){return m}});var i=r(27264),n=r(13668),s=r(34178),o=r(85709),a=r(84435),l=r(28686),c=r(20830),u=r(38917),h=r(14543),d=r(39506),p=r(62988),f=r(65839);function m(e){const t=new p.N5,{vertex:r,fragment:m}=t;return t.include(s.d,e),t.include(o.c,e),(0,c.NB)(r,e),t.attributes.add(f.r.POSITION,"vec3"),t.varyings.add("vpos","vec3"),r.code.add(d.H`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);
}`),e.output===i.V.Highlight&&t.include(a.Qh,e),t.include(n.HQ,e),m.uniforms.add(new h.m("alphaCoverage",((e,t)=>Math.min(1,e.width*t.camera.pixelRatio)))),e.hasVertexColors||m.uniforms.add(new u.E("constantColor",(e=>e.color))),m.code.add(d.H`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${e.hasVertexColors?"vColor":"constantColor"};

    ${e.output===i.V.ObjectAndLayerIdColor?d.H`color.a = 1.0;`:""}

    if (color.a < ${d.H.float(l.y)}) {
      discard;
    }

    ${e.output===i.V.Color?d.H`fragColor = highlightSlice(color, vpos);`:""}
    ${e.output===i.V.Highlight?d.H`outputHighlight();`:""}
  }
  `),t}const g=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}))},94010:function(e,t,r){r.d(t,{O:function(){return u},a:function(){return d},b:function(){return h}});var i=r(86398),n=r(77423),s=r(14543),o=r(50295),a=r(39506),l=r(62988),c=r(39838);class u extends a.Y{constructor(){super(...arguments),this.overlayIndex=i.vr.INNER,this.opacity=1}}function h(){const e=new l.N5;return e.include(n.c),e.fragment.uniforms.add(new c.N("tex",(e=>e.texture))),e.fragment.uniforms.add(new o.c("overlayIdx",(e=>e.overlayIndex))),e.fragment.uniforms.add(new s.m("opacity",(e=>e.opacity))),e.fragment.code.add(a.H`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`),e}const d=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:u,build:h},Symbol.toStringTag,{value:"Module"}))},39387:function(e,t,r){r.d(t,{P:function(){return C},b:function(){return A}});var i=r(30087),n=r(27264),s=r(13668),o=r(34178),a=r(27271),l=r(26762),c=r(84464),u=r(84435),h=r(63684),d=r(97910),p=r(42426),f=r(78946),m=r(50865),g=r(69701),y=r(56574),_=r(23864),v=r(20830),b=r(82598),x=r(14543),S=r(39506),w=r(62988),T=r(55890);function A(e){const t=new w.N5,{vertex:r,fragment:A}=t;switch((0,v.NB)(r,e),t.varyings.add("vpos","vec3"),t.include(l.H,e),e.output!==n.V.Color&&e.output!==n.V.ObjectAndLayerIdColor||(t.include(o.d,e),t.include(y.Bz,e),t.include(i.oD,e),t.include(a.g,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vcolor","vec4"),e.multipassEnabled&&t.varyings.add("depth","float"),r.code.add(S.H`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${e.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${e.output===n.V.Color?"forwardLinearDepth();":""}
        forwardObjectAndLayerIdColor();

        vcolor = getColor();
      }
    `)),t.include(f.Q,e),e.output){case n.V.Color:t.include(s.HQ,e),t.include(d.kA,e),t.include(h.n,e),t.include(y.Bz,e),t.include(m.r,e),(0,v.yu)(A,e),(0,d.a8)(A),(0,d.eU)(A),A.uniforms.add(r.uniforms.get("localOrigin"),new b.t("ambient",(e=>e.ambient)),new b.t("diffuse",(e=>e.diffuse)),new b.t("specular",(e=>e.specular)),new x.m("opacity",(e=>e.opacity))),A.include(_.a),e.transparencyPassType===T.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),(0,p.O4)(A),A.code.add(S.H`
        void main() {
          discardBySlice(vpos);
          ${e.multipassEnabled?"terrainDepthTest(depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${e.transparencyPassType===T.y.ColorAlpha?S.H`
                  fragColor = premultiplyAlpha(fragColor);
                  fragAlpha = fragColor.a;`:""}
        }
      `);break;case n.V.Depth:t.include(o.d,e),r.code.add(S.H`void main() {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(s.HQ,e),A.code.add(S.H`void main() {
discardBySlice(vpos);
}`);break;case n.V.Shadow:case n.V.ShadowHighlight:case n.V.ShadowExcludeHighlight:case n.V.ViewshedShadow:t.include(o.d,e),(0,i.xJ)(t),t.varyings.add("depth","float"),r.code.add(S.H`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),t.include(s.HQ,e),t.include(c.L,e),A.code.add(S.H`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case n.V.ObjectAndLayerIdColor:t.include(s.HQ,e),A.code.add(S.H`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`);break;case n.V.Normal:t.include(o.d,e),t.include(g.n,e),(0,v.S7)(r),t.varyings.add("vnormal","vec3"),r.code.add(S.H`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(s.HQ,e),A.code.add(S.H`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case n.V.Highlight:t.include(o.d,e),t.include(g.n,e),t.varyings.add("vnormal","vec3"),r.code.add(S.H`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(s.HQ,e),t.include(u.Qh,e),A.code.add(S.H`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return t}const C=Object.freeze(Object.defineProperty({__proto__:null,build:A},Symbol.toStringTag,{value:"Module"}))},25770:function(e,t,r){r.d(t,{P:function(){return A},b:function(){return T}});var i=r(27264),n=r(13668),s=r(34178),o=r(27271),a=r(85709),l=r(84435),c=r(78946),u=r(58766),h=r(28686),d=r(23864),p=r(20830),f=r(38917),m=r(14543),g=r(39506),y=r(62988),_=r(55890),v=r(65839),b=r(67721);const x=.70710678118,S=x,w=.08715574274;function T(e){const t=new y.N5,r=e.multipassEnabled&&e.output===i.V.Color,{vertex:T,fragment:A,attributes:C,varyings:E}=t;(0,p.NB)(T,e),t.include(s.d,e),t.include(a.c,e),t.include(u.A,e),t.include(o.g,e),e.draped?T.uniforms.add(new m.m("worldToScreenRatio",((e,t)=>1/t.screenToPCSRatio))):C.add(v.r.BOUNDINGRECT,"mat3"),C.add(v.r.POSITION,"vec3"),C.add(v.r.UVMAPSPACE,"vec4"),e.vvColor&&C.add(v.r.COLORFEATUREATTRIBUTE,"float"),E.add("vColor","vec4"),E.add("vpos","vec3"),E.add("vuv","vec2"),r&&E.add("depth","float"),T.uniforms.add(new f.E("uColor",(e=>e.color)));const M=e.style===b.O.ForwardDiagonal||e.style===b.O.BackwardDiagonal||e.style===b.O.DiagonalCross;return M&&T.code.add(g.H`
      const mat2 rotate45 = mat2(${g.H.float(x)}, ${g.H.float(-S)},
                                 ${g.H.float(S)}, ${g.H.float(x)});
    `),e.draped||((0,p.yu)(T,e),T.uniforms.add(new m.m("worldToScreenPerDistanceRatio",((e,t)=>1/t.camera.perScreenPixelRatio))),T.code.add(g.H`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),T.code.add(g.H`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),T.code.add(g.H`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${g.H.float(w)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),T.code.add(g.H`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${M?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${M?" * rotate45":""};

      ${e.draped?"":g.H`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${g.H.float(e.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `),T.code.add(g.H`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${r?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();
      ${e.hasVertexColors?"vColor *= uColor;":e.vvColor?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),t.include(n.HQ,e),A.include(d.a),e.draped&&A.uniforms.add(new m.m("texelSize",((e,t)=>1/t.camera.pixelRatio))),e.output===i.V.Highlight&&t.include(l.Qh,e),r&&t.include(c.Q,e),e.output!==i.V.Highlight&&(A.code.add(g.H`
      const float lineWidth = ${g.H.float(e.lineWidth)};
      const float spacing = ${g.H.float(e.patternSpacing)};
      const float spacingINV = ${g.H.float(1/e.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),e.draped||A.code.add(g.H`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),e.transparencyPassType===_.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),A.code.add(g.H`
    void main() {
      discardBySlice(vpos);
      ${r?"terrainDepthTest(depth);":""}
      vec4 color = vColor;
      color = highlightSlice(color, vpos);

      ${e.output!==i.V.Highlight?g.H`color.a *= ${function(e){function t(t){return e.draped?g.H`coverage(vuv.${t}, texelSize)`:g.H`sampleAA(vuv.${t})`}switch(e.style){case b.O.ForwardDiagonal:case b.O.Horizontal:return t("y");case b.O.BackwardDiagonal:case b.O.Vertical:return t("x");case b.O.DiagonalCross:case b.O.Cross:return g.H`
        1.0 - (1.0 - ${t("x")}) * (1.0 - ${t("y")})
      `;default:return"0.0"}}(e)};`:""}

      ${e.output===i.V.ObjectAndLayerIdColor?g.H`color.a = 1.0;`:""}

      if (color.a < ${g.H.float(h.y)}) {
        discard;
      }

      ${e.output===i.V.Color?g.H`fragColor = color; ${e.transparencyPassType===_.y.ColorAlpha?g.H`
                    fragColor = premultiplyAlpha(fragColor);
                    fragAlpha = fragColor.a;`:""}`:""}
      ${e.output===i.V.Highlight?g.H`outputHighlight();`:""}
      ${e.output===i.V.ObjectAndLayerIdColor?g.H`outputObjectAndLayerIdColor();`:""}
    }
  `),t}const A=Object.freeze(Object.defineProperty({__proto__:null,build:T},Symbol.toStringTag,{value:"Module"}))},93776:function(e,t,r){r.d(t,{R:function(){return z},b:function(){return F}});var i=r(30087),n=r(36101),s=r(27264),o=r(13668),a=r(34178),l=r(14812),c=r(11377),u=r(91765),h=r(40883),d=r(2457),p=r(85709),f=r(74603),m=r(15209),g=r(63684),y=r(97910),_=r(42426),v=r(78946),b=r(51942),x=r(11520),S=r(56574),w=r(58766),T=r(28686),A=r(1354),C=r(54613),E=r(20830),M=r(82598),R=r(38917),P=r(14543),O=r(39506),I=r(62988),L=r(39838),N=r(55890),D=r(65839);function F(e){const t=new I.N5,{vertex:r,fragment:F,varyings:z}=t;return(0,E.NB)(r,e),t.include(u.I),z.add("vpos","vec3"),t.include(w.A,e),t.include(l.BK,e),t.include(f.G,e),e.output===s.V.Color&&((0,E.yu)(t.vertex,e),t.include(c.Y,e),t.include(a.d,e),e.offsetBackfaces&&t.include(n.M),e.instancedColor&&t.attributes.add(D.r.INSTANCECOLOR,"vec4"),z.add("vNormalWorld","vec3"),z.add("localvpos","vec3"),e.multipassEnabled&&z.add("depth","float"),t.include(d.U,e),t.include(i.oD,e),t.include(h.K,e),t.include(p.c,e),r.uniforms.add(new R.E("externalColor",(e=>e.externalColor))),z.add("vcolorExt","vec4"),r.code.add(O.H`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${e.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${O.H.float(T.y)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = getVertexInLocalOriginSpace();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${e.multipassEnabled?O.H`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),e.output===s.V.Color&&(t.include(o.HQ,e),t.include(y.kA,e),t.include(g.n,e),t.include(A.S,e),t.include(e.instancedDoublePrecision?S.G:S.Bz,e),t.include(v.Q,e),(0,E.yu)(t.fragment,e),(0,_.Gc)(F),(0,y.a8)(F),(0,y.eU)(F),F.uniforms.add(r.uniforms.get("localOrigin"),r.uniforms.get("view"),new M.t("ambient",(e=>e.ambient)),new M.t("diffuse",(e=>e.diffuse)),new P.m("opacity",(e=>e.opacity)),new P.m("layerOpacity",(e=>e.layerOpacity))),e.hasColorTexture&&F.uniforms.add(new L.N("tex",(e=>e.texture))),t.include(x._Z,e),t.include(b.c,e),F.include(C.N),e.transparencyPassType===N.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),(0,_.O4)(F),F.code.add(O.H`
      void main() {
        discardBySlice(vpos);
        ${e.multipassEnabled?O.H`terrainDepthTest(depth);`:""}
        ${e.hasColorTexture?O.H`
                vec4 texColor = texture(tex, ${e.hasColorTextureTransform?O.H`colorUV`:O.H`vuv0`});
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:O.H`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${e.pbrMode===x.A9.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?O.H`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:O.H`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.snowCover?O.H`albedo = mix(albedo, vec3(1), 0.9);`:O.H``}
        ${O.H`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${e.pbrMode===x.A9.Normal||e.pbrMode===x.A9.Schematic?e.spherical?O.H`vec3 normalGround = normalize(vpos + localOrigin);`:O.H`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:O.H``}
        ${e.pbrMode===x.A9.Normal||e.pbrMode===x.A9.Schematic?O.H`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${e.snowCover?O.H`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:O.H`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===N.y.ColorAlpha?O.H`
                fragColor = premultiplyAlpha(fragColor);
                fragAlpha = fragColor.a;`:""}
      }
    `)),t.include(m.E,e),t}const z=Object.freeze(Object.defineProperty({__proto__:null,build:F},Symbol.toStringTag,{value:"Module"}))},35904:function(e,t,r){r.d(t,{R:function(){return C},b:function(){return A},r:function(){return T}});var i=r(27264),n=r(13668),s=r(27271),o=r(55123),a=r(31166),l=r(91981),c=r(78946),u=r(61629),h=r(28686),d=r(23864),p=r(20830),f=r(11687),m=r(38917),g=r(14543),y=r(39506),_=r(70340),v=r(62988),b=r(55890),x=r(65839),S=r(50678),w=r(95736);const T=1;function A(e){const t=new v.N5,{attributes:r,varyings:A,constants:C,vertex:E,fragment:M}=t;t.include(u.p),t.include(o.s,e),t.include(a.q,e);const R=e.applyMarkerOffset&&!e.draped;R&&(E.uniforms.add(new g.m("markerScale",(e=>e.markerScale))),t.include(l.r,{space:S.lM.World,draped:!1})),t.include(s.g,e),(0,p.NB)(E,e),E.uniforms.add(new _.X("inverseProjectionMatrix",((e,t)=>t.camera.inverseProjectionMatrix)),new f.G("nearFar",((e,t)=>t.camera.nearFar)),new g.m("miterLimit",(e=>"miter"!==e.join?0:e.miterLimit)),new m.E("viewport",((e,t)=>t.camera.fullViewport))),E.constants.add("LARGE_HALF_FLOAT","float",65500),r.add(x.r.POSITION,"vec3"),r.add(x.r.PREVPOSITION,"vec3"),r.add(x.r.NEXTPOSITION,"vec3"),r.add(x.r.SUBDIVISIONFACTOR,"float"),r.add(x.r.UV0,"vec2"),A.add("vColor","vec4"),A.add("vpos","vec3"),A.add("vLineDistance","float"),A.add("vLineWidth","float");const P=e.multipassEnabled&&e.output===i.V.Color;P&&A.add("depth","float");const O=e.stippleEnabled;O&&A.add("vLineSizeInv","float"),C.add("aaWidth","float",e.stippleEnabled?0:1);const I=e.capType===w.x.ROUND,L=e.stippleEnabled&&I,N=e.falloffEnabled||L;N&&A.add("vLineDistanceNorm","float"),I&&(A.add("vSegmentSDF","float"),A.add("vReverseSegmentSDF","float")),E.code.add(y.H`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),E.code.add(y.H`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),E.code.add(y.H`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${P?"depth = pos.z;":""}

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),(0,p.Nz)(E),E.code.add(y.H`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;
      float lineSize = getSize();

      if (lineSize < 1.0) {
        coverage = lineSize; // convert sub-pixel coverage to alpha
        lineSize = 1.0;
      }
      lineSize += aaWidth;

      float lineWidth = lineSize * pixelRatio;
      vLineWidth = lineWidth;
      ${O?y.H`vLineSizeInv = 1.0 / lineSize;`:""}

      vec4 pos  = view * vec4(position, 1.0);
      vec4 prev = view * vec4(prevPosition, 1.0);
      vec4 next = view * vec4(nextPosition, 1.0);
  `),R&&E.code.add(y.H`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),E.code.add(y.H`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(e.stippleEnabled||I)&&E.code.add(y.H`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${I?y.H`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),E.code.add(y.H`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),e.roundJoins?E.code.add(y.H`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${e.stippleEnabled?y.H`min(1.0, subdivisionFactor * ${y.H.float((T+2)/(T+1))})`:y.H`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):E.code.add(y.H`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const D=e.capType!==w.x.BUTT;return E.code.add(y.H`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${D?y.H`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),E.code.add(y.H`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;
    float lineDistNorm = sign(uv0.y) * pos.w;

    vLineDistance =  lineWidth * lineDistNorm;
    ${N?y.H`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),I&&E.code.add(y.H`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),e.stippleEnabled&&(e.draped?E.uniforms.add(new g.m("worldToScreenRatio",((e,t)=>1/t.screenToPCSRatio))):E.code.add(y.H`vec3 segmentCenter = mix((nextPosition + position) * 0.5, (position + prevPosition) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),E.code.add(y.H`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(nextPosition - position, position - prevPosition, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),e.draped?E.code.add(y.H`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):E.code.add(y.H`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),E.uniforms.add(new g.m("stipplePatternPixelSize",(e=>(0,a.h)(e)))),E.code.add(y.H`float patternLength = lineSize * stipplePatternPixelSize;
vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);
if (segmentLengthScreenDouble >= 0.001) {
vec2 stippleDisplacement = pos.xy - segmentOrigin;
float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);
vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
}
vStippleDistanceLimits *= pos.w;
vStippleDistance *= pos.w;
vStippleDistanceLimits = isJoin ?
vStippleDistanceLimits :
isStartVertex ?
vec2(-1e34, vStippleDistanceLimits.y) :
vec2(vStippleDistanceLimits.x, 1e34);`)),E.code.add(y.H`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),P&&t.include(c.Q,e),t.include(n.HQ,e),M.include(d.a),M.code.add(y.H`
  void main() {
    discardBySlice(vpos);
    ${P?"terrainDepthTest(depth);":""}
  `),e.wireframe?M.code.add(y.H`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(I&&M.code.add(y.H`
        float sdf = min(vSegmentSDF, vReverseSegmentSDF);
        vec2 fragmentPosition = vec2(
          min(sdf, 0.0),
          vLineDistance
        ) * gl_FragCoord.w;

        float fragmentRadius = length(fragmentPosition);
        float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
        float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

        if (capCoverage < ${y.H.float(h.y)}) {
          discard;
        }
      `),L?M.code.add(y.H`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${y.H.float(h.y)}, stippleCoverage);
      `):M.code.add(y.H`float stippleAlpha = getStippleAlpha();`),e.output!==i.V.ObjectAndLayerIdColor&&M.code.add(y.H`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),M.uniforms.add(new m.E("intrinsicColor",(e=>e.color))),M.code.add(y.H`vec4 color = intrinsicColor * vColor;`),e.innerColorEnabled&&(M.uniforms.add(new m.E("innerColor",(e=>e.innerColor??e.color)),new g.m("innerWidth",((e,t)=>e.innerWidth*t.camera.pixelRatio))),M.code.add(y.H`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),M.code.add(y.H`vec4 finalColor = blendStipple(color, stippleAlpha);`),e.falloffEnabled&&(M.uniforms.add(new g.m("falloff",(e=>e.falloff))),M.code.add(y.H`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)),e.stippleEnabled||M.code.add(y.H`float featherStartDistance = max(vLineWidth - 2.0, 0.0);
float value = abs(vLineDistance) * gl_FragCoord.w;
float feather = (value - featherStartDistance) / (vLineWidth - featherStartDistance);
finalColor.a *= 1.0 - clamp(feather, 0.0, 1.0);`)),e.transparencyPassType===b.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),M.code.add(y.H`
    ${e.output===i.V.ObjectAndLayerIdColor?y.H`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${y.H.float(h.y)}) {
      discard;
    }

    ${e.output===i.V.Color?y.H`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===i.V.Color&&e.transparencyPassType===b.y.ColorAlpha?y.H`
            fragColor = premultiplyAlpha(fragColor);
            fragAlpha = fragColor.a;`:""}
    ${e.output===i.V.Highlight?y.H`fragColor = vec4(1.0);`:""}
    ${e.output===i.V.ObjectAndLayerIdColor?y.H`outputObjectAndLayerIdColor();`:""}
  }
  `),t}const C=Object.freeze(Object.defineProperty({__proto__:null,build:A,ribbonlineNumRoundJoinSubdivisions:T},Symbol.toStringTag,{value:"Module"}))},184:function(e,t,r){r.d(t,{S:function(){return y},b:function(){return f},g:function(){return m}});var i=r(13786),n=r(1932),s=r(77423),o=r(23397),a=r(82316),l=r(11687),c=r(14543),u=r(39506),h=r(62988),d=r(39838);const p=16;function f(){const e=new h.N5,t=e.fragment;return e.include(s.c),e.include(a.Ir),t.include(o.E),t.uniforms.add(new c.m("radius",((e,t)=>m(t.camera)))).code.add(u.H`vec3 sphere[16] = vec3[16](
vec3(0.186937, 0.0, 0.0),
vec3(0.700542, 0.0, 0.0),
vec3(-0.864858, -0.481795, -0.111713),
vec3(-0.624773, 0.102853, -0.730153),
vec3(-0.387172, 0.260319, 0.007229),
vec3(-0.222367, -0.642631, -0.707697),
vec3(-0.01336, -0.014956, 0.169662),
vec3(0.122575, 0.1544, -0.456944),
vec3(-0.177141, 0.85997, -0.42346),
vec3(-0.131631, 0.814545, 0.524355),
vec3(-0.779469, 0.007991, 0.624833),
vec3(0.308092, 0.209288,0.35969),
vec3(0.359331, -0.184533, -0.377458),
vec3(0.192633, -0.482999, -0.065284),
vec3(0.233538, 0.293706, -0.055139),
vec3(0.417709, -0.386701, 0.442449)
);
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),t.code.add(u.H`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),t.uniforms.add(new d.N("normalMap",(e=>e.normalTexture)),new d.N("depthMap",(e=>e.depthTexture)),new c.m("projScale",(e=>e.projScale)),new d.N("rnm",(e=>e.noiseTexture)),new l.G("rnmScale",((e,t)=>(0,i.hZ)(g,t.camera.fullWidth/e.noiseTexture.descriptor.width,t.camera.fullHeight/e.noiseTexture.descriptor.height))),new c.m("intensity",(e=>e.intensity)),new l.G("screenSize",((e,t)=>(0,i.hZ)(g,t.camera.fullWidth,t.camera.fullHeight)))),e.outputs.add("fragOcclusion","float"),t.code.add(u.H`
    void main(void) {
      float depth = depthFromTexture(depthMap, uv);

      // Early out if depth is out of range, such as in the sky
      if (depth >= 1.0 || depth <= 0.0) {
        fragOcclusion = 1.0;
        return;
      }

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      if(norm4.a != 1.0) {
        fragOcclusion = 1.0;
        return;
      }
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;

      float currentPixelDepth = linearizeDepth(depth);
      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy, currentPixelDepth);

      float sum = 0.0;
      vec3 tapPixelPos;

      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${u.H.int(p)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        // don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap);

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum += aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${u.H.int(p)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;

      fragOcclusion = A;
    }
  `),e}function m(e){return Math.max(10,20*e.computeScreenPixelSizeAtDist(Math.abs(4*e.relativeElevation)))}const g=(0,n.vt)(),y=Object.freeze(Object.defineProperty({__proto__:null,build:f,getRadius:m},Symbol.toStringTag,{value:"Module"}))},37739:function(e,t,r){r.d(t,{S:function(){return f},b:function(){return p}});var i=r(20551),n=r(77423),s=r(23397),o=r(30262),a=r(14543),l=r(39506),c=r(62988),u=r(40075),h=r(39838);const d=4;function p(){const e=new c.N5,t=e.fragment;e.include(n.c);const r=(d+1)/2,p=1/(2*r*r);return t.include(s.E),t.uniforms.add(new h.N("depthMap",(e=>e.depthTexture)),new u.o("tex",(e=>e.colorTexture)),new o.t("blurSize",(e=>e.blurSize)),new a.m("projScale",((e,t)=>{const r=(0,i.p)(t.camera.eye,t.camera.center);return r>5e4?Math.max(0,e.projScale-(r-5e4)):e.projScale}))),t.code.add(l.H`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${l.H.float(p)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),e.outputs.add("fragBlur","float"),t.code.add(l.H`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${l.H.int(d)}; r <= ${l.H.int(d)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragBlur = b / w_total;
    }
  `),e}const f=Object.freeze(Object.defineProperty({__proto__:null,build:p},Symbol.toStringTag,{value:"Module"}))},55747:function(e,t,r){r.d(t,{T:function(){return c},a:function(){return h},b:function(){return u}});var i=r(32501),n=r(77423),s=r(82598),o=r(39506),a=r(62988),l=r(39838);class c extends o.Y{constructor(){super(...arguments),this.color=(0,i.fA)(1,1,1)}}function u(){const e=new a.N5;return e.include(n.c),e.fragment.uniforms.add(new l.N("tex",(e=>e.texture)),new s.t("uColor",(e=>e.color))),e.fragment.code.add(o.H`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);
}`),e}const h=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:c,build:u},Symbol.toStringTag,{value:"Module"}))},52352:function(e,t,r){r.d(t,{W:function(){return E},b:function(){return C}});var i=r(30087),n=r(27264),s=r(13668),o=r(34178),a=r(27271),l=r(84435),c=r(46042),u=r(42426),h=r(78946),d=r(69701),p=r(11520),f=r(56574),m=r(11388),g=r(15985),y=r(28686),_=r(23864),v=r(20830),b=r(38917),x=r(14543),S=r(39506),w=r(62988),T=r(55890),A=r(65839);function C(e){const t=new w.N5,{vertex:r,fragment:C}=t;(0,v.NB)(r,e),t.include(o.d,e),t.attributes.add(A.r.POSITION,"vec3"),t.attributes.add(A.r.UV0,"vec2");const E=new b.E("waterColor",(e=>e.color));if(e.output===n.V.Color&&e.draped)return t.varyings.add("vpos","vec3"),r.uniforms.add(E),r.code.add(S.H`
        void main(void) {
          if (waterColor.a < ${S.H.float(y.y)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),C.uniforms.add(E),C.code.add(S.H`void main() {
fragColor = waterColor;
}`),t;switch(e.output===n.V.Color&&(t.include(d.n,e),t.include(i.oD,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),e.multipassEnabled&&t.varyings.add("depth","float"),r.uniforms.add(E),r.code.add(S.H`
      void main(void) {
        if (waterColor.a < ${S.H.float(y.y)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${e.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${e.output===n.V.Color?"forwardLinearDepth();":""}
      }
    `)),t.include(h.Q,e),e.output){case n.V.Color:t.include(u.qU),t.include(c.W,{pbrMode:p.A9.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(g.V),t.include(s.HQ,e),t.include(f.Bz,e),t.include(m.E,e),C.uniforms.add(E,new x.m("timeElapsed",(e=>e.timeElapsed)),r.uniforms.get("view"),r.uniforms.get("localOrigin")),(0,v.yu)(C,e),C.include(_.a),e.transparencyPassType===T.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),(0,u.Gc)(C),(0,u.O4)(C),C.code.add(S.H`
      void main() {
        discardBySlice(vpos);
        ${e.multipassEnabled?"terrainDepthTest(depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${e.receiveShadows?S.H`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${e.transparencyPassType===T.y.ColorAlpha?S.H`
                fragColor = premultiplyAlpha(fragColor);
                fragAlpha = fragColor.a;`:""}
      }
    `);break;case n.V.Normal:t.include(d.n,e),t.include(g.V,e),t.include(s.HQ,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),r.uniforms.add(E),r.code.add(S.H`
        void main(void) {
          if (waterColor.a < ${S.H.float(y.y)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),C.uniforms.add(new x.m("timeElapsed",(e=>e.timeElapsed))),C.code.add(S.H`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case n.V.Highlight:t.include(l.Qh,e),t.varyings.add("vpos","vec3"),r.uniforms.add(E),r.code.add(S.H`
      void main(void) {
        if (waterColor.a < ${S.H.float(y.y)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),t.include(s.HQ,e),C.code.add(S.H`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case n.V.ObjectAndLayerIdColor:t.include(a.g,e),t.varyings.add("vpos","vec3"),r.uniforms.add(E),r.code.add(S.H`
      void main(void) {
        if (waterColor.a < ${S.H.float(y.y)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),t.include(s.HQ,e),C.code.add(S.H`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return t}const E=Object.freeze(Object.defineProperty({__proto__:null,build:C},Symbol.toStringTag,{value:"Module"}))},2075:function(e,t,r){r.d(t,{a:function(){return y},c:function(){return _},g:function(){return S},h:function(){return R},u:function(){return b}}),r(58941);var i=r(40633),n=r(15774),s=r(89736),o=r(73364),a=r(39714),l=r(20551),c=r(32501),u=r(72485),h=r(73313),d=r(5596),p=r(79578),f=r(29531),m=r(50973);const g=()=>i.A.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");function y(e=F){return{plane:(0,d.vt)(e.plane),origin:(0,c.o8)(e.origin),basis1:(0,c.o8)(e.basis1),basis2:(0,c.o8)(e.basis2)}}function _(e,t=y()){return v(e.origin,e.basis1,e.basis2,t)}function v(e,t,r,i=y()){return(0,l.c)(i.origin,e),(0,l.c)(i.basis1,t),(0,l.c)(i.basis2,r),b(i),function(e,t){Math.abs((0,l.m)(e.basis1,e.basis2)/((0,l.l)(e.basis1)*(0,l.l)(e.basis2)))>1e-6&&g().warn(t,"Provided basis vectors are not perpendicular"),Math.abs((0,l.m)(e.basis1,O(e)))>1e-6&&g().warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-(0,l.m)(O(e),e.origin)-e.plane[3])>1e-6&&g().warn(t,"Plane offset is not consistent with plane origin")}(i,"fromValues()"),i}function b(e){(0,d.mR)(e.basis2,e.basis1,e.origin,e.plane)}function x(e,t,r){e!==r&&_(e,r);const i=(0,l.j)(m.rq.get(),O(e),t);return(0,l.g)(r.origin,r.origin,i),r.plane[3]-=t,r}function S(e,t=y()){const r=(e[2]-e[0])/2,i=(e[3]-e[1])/2;return(0,l.s)(t.origin,e[0]+r,e[1]+i,0),(0,l.s)(t.basis1,r,0,0),(0,l.s)(t.basis2,0,i,0),(0,d.fA)(0,0,1,0,t.plane),t}function w(e,t,r){return!!(0,d.Ui)(e.plane,t,r)&&I(e,r)}function T(e,t,r){const i=z.get();D(e,t,i,z.get());let s=Number.POSITIVE_INFINITY;for(const o of B){const a=N(e,o,V.get()),c=m.rq.get();if((0,d.T7)(i,a,c)){const e=(0,l.E)(m.rq.get(),t.origin,c),i=Math.abs((0,n.XM)((0,l.m)(t.direction,e)));i<s&&(s=i,(0,l.c)(r,c))}}return s===Number.POSITIVE_INFINITY?A(e,t,r):r}function A(e,t,r){if(w(e,t,r))return r;const i=z.get(),n=z.get();D(e,t,i,n);let s=Number.POSITIVE_INFINITY;for(const o of B){const a=N(e,o,V.get()),c=m.rq.get();if((0,d.gv)(i,a,c)){const e=(0,p.kb)(t,c);if(!(0,d.Tj)(n,c))continue;e<s&&(s=e,(0,l.c)(r,c))}}return M(e,t.origin)<s&&C(e,t.origin,r),r}function C(e,t,r){const i=(0,d._I)(e.plane,t,m.rq.get()),n=(0,h.H6)(L(e,e.basis1),i,-1,1,m.rq.get()),s=(0,h.H6)(L(e,e.basis2),i,-1,1,m.rq.get());return(0,l.f)(r,(0,l.g)(m.rq.get(),n,s),e.origin),r}function E(e,t,r){const{origin:i,basis1:n,basis2:s}=e,o=(0,l.f)(m.rq.get(),t,i),a=(0,f.gr)(n,o),c=(0,f.gr)(s,o),u=(0,f.gr)(O(e),o);return(0,l.s)(r,a,c,u)}function M(e,t){const r=E(e,t,m.rq.get()),{basis1:i,basis2:n}=e,s=(0,l.l)(i),o=(0,l.l)(n),a=Math.max(Math.abs(r[0])-s,0),c=Math.max(Math.abs(r[1])-o,0),u=r[2];return a*a+c*c+u*u}function R(e,t){return Math.sqrt(M(e,t))}function P(e,t){const r=-e.plane[3];return(0,f.gr)(O(e),t)-r}function O(e){return(0,d.Qj)(e.plane)}function I(e,t){const r=(0,l.f)(m.rq.get(),t,e.origin),i=(0,l.q)(e.basis1),n=(0,l.q)(e.basis2),s=(0,l.m)(e.basis1,r),o=(0,l.m)(e.basis2,r);return-s-i<0&&s-i<0&&-o-n<0&&o-n<0}function L(e,t){const r=V.get();return(0,l.c)(r.origin,e.origin),(0,l.c)(r.vector,t),r}function N(e,t,r){const{basis1:i,basis2:n,origin:s}=e,o=(0,l.j)(m.rq.get(),i,t.origin[0]),a=(0,l.j)(m.rq.get(),n,t.origin[1]);(0,l.g)(r.origin,o,a),(0,l.g)(r.origin,r.origin,s);const c=(0,l.j)(m.rq.get(),i,t.direction[0]),u=(0,l.j)(m.rq.get(),n,t.direction[1]);return(0,l.j)(r.vector,(0,l.g)(c,c,u),2),r}function D(e,t,r,i){const n=O(e);(0,d.mR)(n,t.direction,t.origin,r),(0,d.mR)((0,d.Qj)(r),n,t.origin,i)}const F={plane:(0,d.vt)(),origin:(0,c.fA)(0,0,0),basis1:(0,c.fA)(1,0,0),basis2:(0,c.fA)(0,1,0)},z=new s.I(d.vt),V=new s.I(h.vt),U=(0,c.vt)(),G=new s.I((()=>y())),B=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],H=(0,a.vt)(),k=(0,a.vt)();Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:class{constructor(){this.plane=(0,d.vt)(),this.origin=(0,c.vt)(),this.basis1=(0,c.vt)(),this.basis2=(0,c.vt)()}},altitudeAt:P,axisAt:function(e,t,r,i){return function(e,t,r){switch(t){case u._.X:(0,l.c)(r,e.basis1),(0,l.n)(r,r);break;case u._.Y:(0,l.c)(r,e.basis2),(0,l.n)(r,r);break;case u._.Z:(0,l.c)(r,O(e))}return r}(e,r,i)},closestPoint:A,closestPointOnSilhouette:T,copy:_,copyWithoutVerify:function(e,t){(0,l.c)(t.origin,e.origin),(0,l.c)(t.basis1,e.basis1),(0,l.c)(t.basis2,e.basis2),(0,d.C)(t.plane,e.plane)},create:y,distance:R,distance2:M,distanceToSilhouette:function(e,t){let r=Number.NEGATIVE_INFINITY;for(const i of B){const n=N(e,i,V.get()),s=(0,h.kb)(n,t);s>r&&(r=s)}return Math.sqrt(r)},elevate:x,equals:function(e,t){return(0,l.e)(e.basis1,t.basis1)&&(0,l.e)(e.basis2,t.basis2)&&(0,l.e)(e.origin,t.origin)},extrusionContainsPoint:function(e,t){return(0,d.Tj)(e.plane,t)&&I(e,t)},fromAABoundingRect:S,fromValues:v,intersectRay:w,intersectRayClosestSilhouette:function(e,t,r){if(w(e,t,r))return r;const i=T(e,t,m.rq.get());return(0,l.g)(r,t.origin,(0,l.j)(m.rq.get(),t.direction,(0,l.p)(t.origin,i)/(0,l.l)(t.direction))),r},normal:O,projectPoint:C,projectPointLocal:E,rotate:function(e,t,r,i){return e!==i&&_(e,i),(0,o.$0)(k,t,r),(0,l.h)(i.basis1,e.basis1,k),(0,l.h)(i.basis2,e.basis2,k),b(i),i},setAltitudeAt:function(e,t,r,i){const n=P(e,t),s=(0,l.j)(U,O(e),r-n);return(0,l.g)(i,t,s),i},setExtent:function(e,t,r){return S(t,r),x(r,P(e,e.origin),r),r},transform:function(e,t,r){return e!==r&&_(e,r),(0,o.B8)(H,t),(0,o.mg)(H,H),(0,l.h)(r.basis1,e.basis1,H),(0,l.h)(r.basis2,e.basis2,H),(0,l.h)((0,d.Qj)(r.plane),(0,d.Qj)(e.plane),H),(0,l.h)(r.origin,e.origin,t),(0,d.mP)(r.plane,r.plane,r.origin),r},up:F,updateUnboundedPlane:b,wrap:function(e,t,r){const i=G.get();return i.origin=e,i.basis1=t,i.basis2=r,i.plane=(0,d.LV)(0,0,0,0),b(i),i}},Symbol.toStringTag,{value:"Module"}))},59122:function(e,t,r){r.d(t,{e:function(){return l}});var i,n,s,o=r(32150),a={exports:{}};i=a,n=function(){function e(e,r,n){n=n||2;var s,o,a,c,u,h,d,p=r&&r.length,f=p?r[0]*n:e.length,m=t(e,0,f,n,!0),g=[];if(!m||m.next===m.prev)return g;if(p&&(m=l(e,r,m,n)),e.length>80*n){s=a=e[0],o=c=e[1];for(var y=n;y<f;y+=n)(u=e[y])<s&&(s=u),(h=e[y+1])<o&&(o=h),u>a&&(a=u),h>c&&(c=h);d=0!==(d=Math.max(a-s,c-o))?1/d:0}return i(m,g,n,s,o,d),g}function t(e,t,r,i,n){var s,o;if(n===M(e,t,r,i)>0)for(s=t;s<r;s+=i)o=A(s,e[s],e[s+1],o);else for(s=r-i;s>=t;s-=i)o=A(s,e[s],e[s+1],o);if(o&&v(o,o.next)){var a=o.next;C(o),o=a}return o}function r(e,t){if(!e)return e;t||(t=e);var r,i=e;do{if(r=!1,i.steiner||!v(i,i.next)&&0!==_(i.prev,i,i.next))i=i.next;else{var n=i.prev;if(C(i),(i=t=n)===i.next)break;r=!0}}while(r||i!==t);return t}function i(e,t,l,c,u,h,d){if(e){!d&&h&&p(e,c,u,h);for(var f,m,g=e;e.prev!==e.next;)if(f=e.prev,m=e.next,h?s(e,c,u,h):n(e))t.push(f.i/l),t.push(e.i/l),t.push(m.i/l),C(e),e=m.next,g=m.next;else if((e=m)===g){d?1===d?i(e=o(r(e),t,l),t,l,c,u,h,2):2===d&&a(e,t,l,c,u,h):i(r(e),t,l,c,u,h,1);break}}}function n(e){var t=e.prev,r=e,i=e.next;if(_(t,r,i)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(g(t.x,t.y,r.x,r.y,i.x,i.y,n.x,n.y)&&_(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function s(e,t,r,i){var n=e.prev,s=e,o=e.next;if(_(n,s,o)>=0)return!1;for(var a=n.x<s.x?n.x<o.x?n.x:o.x:s.x<o.x?s.x:o.x,l=n.y<s.y?n.y<o.y?n.y:o.y:s.y<o.y?s.y:o.y,c=n.x>s.x?n.x>o.x?n.x:o.x:s.x>o.x?s.x:o.x,u=n.y>s.y?n.y>o.y?n.y:o.y:s.y>o.y?s.y:o.y,h=f(a,l,t,r,i),d=f(c,u,t,r,i),p=e.prevZ,m=e.nextZ;p&&p.z>=h&&m&&m.z<=d;){if(p!==e.prev&&p!==e.next&&g(n.x,n.y,s.x,s.y,o.x,o.y,p.x,p.y)&&_(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,m!==e.prev&&m!==e.next&&g(n.x,n.y,s.x,s.y,o.x,o.y,m.x,m.y)&&_(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&g(n.x,n.y,s.x,s.y,o.x,o.y,p.x,p.y)&&_(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;m&&m.z<=d;){if(m!==e.prev&&m!==e.next&&g(n.x,n.y,s.x,s.y,o.x,o.y,m.x,m.y)&&_(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function o(e,t,i){var n=e;do{var s=n.prev,o=n.next.next;!v(s,o)&&b(s,n,n.next,o)&&w(s,o)&&w(o,s)&&(t.push(s.i/i),t.push(n.i/i),t.push(o.i/i),C(n),C(n.next),n=e=o),n=n.next}while(n!==e);return r(n)}function a(e,t,n,s,o,a){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&y(l,c)){var u=T(l,c);return l=r(l,l.next),u=r(u,u.next),i(l,t,n,s,o,a),void i(u,t,n,s,o,a)}c=c.next}l=l.next}while(l!==e)}function l(e,i,n,s){var o,a,l,u=[];for(o=0,a=i.length;o<a;o++)(l=t(e,i[o]*s,o<a-1?i[o+1]*s:e.length,s,!1))===l.next&&(l.steiner=!0),u.push(m(l));for(u.sort(c),o=0;o<u.length;o++)n=r(n=h(u[o],n),n.next);return n}function c(e,t){return e.x-t.x}function u(e){if(e.next.prev===e)return e;let t=e;for(;;){const r=t.next;if(r.prev===t||r===t||r===e)break;t=r}return t}function h(e,t){var i=function(e,t){var r,i=t,n=e.x,s=e.y,o=-1/0;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){var a=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=n&&a>o){if(o=a,a===n){if(s===i.y)return i;if(s===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!r)return null;if(n===o)return r;var l,c=r,u=r.x,h=r.y,p=1/0;i=r;do{n>=i.x&&i.x>=u&&n!==i.x&&g(s<h?n:o,s,u,h,s<h?o:n,s,i.x,i.y)&&(l=Math.abs(s-i.y)/(n-i.x),w(i,e)&&(l<p||l===p&&(i.x>r.x||i.x===r.x&&d(r,i)))&&(r=i,p=l)),i=i.next}while(i!==c);return r}(e,t);if(!i)return t;var n=T(i,e),s=r(i,i.next);let o=u(n);return r(o,o.next),s=u(s),u(t===i?s:t)}function d(e,t){return _(e.prev,e,t.prev)<0&&_(t.next,e,e.next)<0}function p(e,t,r,i){var n=e;do{null===n.z&&(n.z=f(n.x,n.y,t,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,r,i,n,s,o,a,l,c=1;do{for(r=e,e=null,s=null,o=0;r;){for(o++,i=r,a=0,t=0;t<c&&(a++,i=i.nextZ);t++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||r.z<=i.z)?(n=r,r=r.nextZ,a--):(n=i,i=i.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;r=i}s.nextZ=null,c*=2}while(o>1)}(n)}function f(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function m(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function g(e,t,r,i,n,s,o,a){return(n-o)*(t-a)-(e-o)*(s-a)>=0&&(e-o)*(i-a)-(r-o)*(t-a)>=0&&(r-o)*(s-a)-(n-o)*(i-a)>=0}function y(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&b(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(w(e,t)&&w(t,e)&&function(e,t){var r=e,i=!1,n=(e.x+t.x)/2,s=(e.y+t.y)/2;do{r.y>s!=r.next.y>s&&r.next.y!==r.y&&n<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}(e,t)&&(_(e.prev,e,t.prev)||_(e,t.prev,t))||v(e,t)&&_(e.prev,e,e.next)>0&&_(t.prev,t,t.next)>0)}function _(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function v(e,t){return e.x===t.x&&e.y===t.y}function b(e,t,r,i){var n=S(_(e,t,r)),s=S(_(e,t,i)),o=S(_(r,i,e)),a=S(_(r,i,t));return n!==s&&o!==a||!(0!==n||!x(e,r,t))||!(0!==s||!x(e,i,t))||!(0!==o||!x(r,e,i))||!(0!==a||!x(r,t,i))}function x(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function S(e){return e>0?1:e<0?-1:0}function w(e,t){return _(e.prev,e,e.next)<0?_(e,t,e.next)>=0&&_(e,e.prev,t)>=0:_(e,t,e.prev)<0||_(e,e.next,t)<0}function T(e,t){var r=new E(e.i,e.x,e.y),i=new E(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,s.next=i,i.prev=s,i}function A(e,t,r,i){var n=new E(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function C(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function E(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function M(e,t,r,i){for(var n=0,s=t,o=r-i;s<r;s+=i)n+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return n}return e.deviation=function(e,t,r,i){var n=t&&t.length,s=n?t[0]*r:e.length,o=Math.abs(M(e,0,s,r));if(n)for(var a=0,l=t.length;a<l;a++){var c=t[a]*r,u=a<l-1?t[a+1]*r:e.length;o-=Math.abs(M(e,c,u,r))}var h=0;for(a=0;a<i.length;a+=3){var d=i[a]*r,p=i[a+1]*r,f=i[a+2]*r;h+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},e.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},i=0,n=0;n<e.length;n++){for(var s=0;s<e[n].length;s++)for(var o=0;o<t;o++)r.vertices.push(e[n][s][o]);n>0&&(i+=e[n-1].length,r.holes.push(i))}return r},e},void 0!==(s=n())&&(i.exports=s);const l=(0,o.g)(a.exports)},88923:function(e,t,r){r.d(t,{q:function(){return l}});var i,n,s,o=r(32150),a={exports:{}};i=a,n=function(){function e(r,i,n,s,o){for(;s>n;){if(s-n>600){var a=s-n+1,l=i-n+1,c=Math.log(a),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(a-u)/a)*(l-a/2<0?-1:1);e(r,i,Math.max(n,Math.floor(i-l*u/a+h)),Math.min(s,Math.floor(i+(a-l)*u/a+h)),o)}var d=r[i],p=n,f=s;for(t(r,n,i),o(r[s],d)>0&&t(r,n,s);p<f;){for(t(r,p,f),p++,f--;o(r[p],d)<0;)p++;for(;o(r[f],d)>0;)f--}0===o(r[n],d)?t(r,n,f):t(r,++f,s),f<=i&&(n=f+1),i<=f&&(s=f-1)}}function t(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function r(e,t){return e<t?-1:e>t?1:0}return function(t,i,n,s,o){e(t,i,n||0,s||t.length-1,o||r)}},void 0!==(s=n())&&(i.exports=s);const l=(0,o.g)(a.exports)},17190:function(e,t,r){function i(e,t){const r=e.count;t||(t=new e.TypedArrayConstructor(r));for(let i=0;i<r;i++)t[i]=e.get(i);return t}r.d(t,{m:function(){return i}}),Object.freeze(Object.defineProperty({__proto__:null,makeDense:i},Symbol.toStringTag,{value:"Module"}))},78598:function(e,t,r){r.d(t,{a:function(){return n},f:function(){return o},n:function(){return s}});var i=r(24540);function n(e,t){s(e.typedBuffer,t.typedBuffer,e.typedBufferStride,t.typedBufferStride)}function s(e,t,r=2,n=r){const s=t.length/2;let o=0,a=0;if((0,i.cy)(t)||(0,i.dk)(t)){for(let i=0;i<s;++i)e[o]=t[a],e[o+1]=t[a+1],o+=r,a+=n;return}const l=(0,i.a3)(t);if((0,i.JI)(t))for(let i=0;i<s;++i)e[o]=Math.max(t[a]/l,-1),e[o+1]=Math.max(t[a+1]/l,-1),o+=r,a+=n;else for(let i=0;i<s;++i)e[o]=t[a]/l,e[o+1]=t[a+1]/l,o+=r,a+=n}function o(e,t,r,i){const n=e.typedBuffer,s=e.typedBufferStride,o=i?.count??e.count;let a=(i?.dstIndex??0)*s;for(let e=0;e<o;++e)n[a]=t,n[a+1]=r,a+=s}Object.freeze(Object.defineProperty({__proto__:null,fill:o,normalizeIntegerBuffer:s,normalizeIntegerBufferView:n},Symbol.toStringTag,{value:"Module"}))},62693:function(e,t,r){function i(e,t,r){n(e.typedBuffer,t.typedBuffer,r,e.typedBufferStride,t.typedBufferStride)}function n(e,t,r,i=3,n=i){if(e.length/i!==Math.ceil(t.length/n))return e;const s=e.length/i,o=r[0],a=r[1],l=r[2],c=r[4],u=r[5],h=r[6],d=r[8],p=r[9],f=r[10],m=r[12],g=r[13],y=r[14];let _=0,v=0;for(let r=0;r<s;r++){const r=t[_],s=t[_+1],b=t[_+2];e[v]=o*r+c*s+d*b+m,e[v+1]=a*r+u*s+p*b+g,e[v+2]=l*r+h*s+f*b+y,_+=n,v+=i}return e}function s(e,t,r){o(e.typedBuffer,t.typedBuffer,r,e.typedBufferStride,t.typedBufferStride)}function o(e,t,r,i=3,n=i){if(e.length/i!==Math.ceil(t.length/n))return;const s=e.length/i,o=r[0],a=r[1],l=r[2],c=r[3],u=r[4],h=r[5],d=r[6],p=r[7],f=r[8];let m=0,g=0;for(let r=0;r<s;r++){const r=t[m],s=t[m+1],y=t[m+2];e[g]=o*r+c*s+d*y,e[g+1]=a*r+u*s+p*y,e[g+2]=l*r+h*s+f*y,m+=n,g+=i}}function a(e,t,r){l(e.typedBuffer,t.typedBuffer,r,e.typedBufferStride,t.typedBufferStride)}function l(e,t,r,i=3,n=i){const s=Math.min(e.length/i,t.length/n);let o=0,a=0;for(let l=0;l<s;l++)e[a]=r*t[o],e[a+1]=r*t[o+1],e[a+2]=r*t[o+2],o+=n,a+=i;return e}function c(e,t,r,i=3,n=i){const s=e.length/i;if(s!==Math.ceil(t.length/n))return e;let o=0,a=0;for(let l=0;l<s;l++)e[a]=t[o]+r[0],e[a+1]=t[o+1]+r[1],e[a+2]=t[o+2]+r[2],o+=n,a+=i;return e}function u(e,t){h(e.typedBuffer,t.typedBuffer,e.typedBufferStride,t.typedBufferStride)}function h(e,t,r=3,i=r){const n=Math.min(e.length/r,t.length/i);let s=0,o=0;for(let a=0;a<n;a++){const n=t[s],a=t[s+1],l=t[s+2],c=n*n+a*a+l*l;if(c>0){const t=1/Math.sqrt(c);e[o]=t*n,e[o+1]=t*a,e[o+2]=t*l}s+=i,o+=r}}r.d(t,{a:function(){return n},b:function(){return c},c:function(){return s},d:function(){return i},e:function(){return u},f:function(){return a},n:function(){return h},s:function(){return l},t:function(){return o}}),r(58941),r(40633),Object.freeze(Object.defineProperty({__proto__:null,normalize:h,normalizeView:u,scale:l,scaleView:a,shiftRight:function(e,t,r){const i=Math.min(e.count,t.count),n=e.typedBuffer,s=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;let l=0,c=0;for(let e=0;e<i;e++)n[c]=o[l]>>r,n[c+1]=o[l+1]>>r,n[c+2]=o[l+2]>>r,l+=a,c+=s},transformMat3:o,transformMat3View:s,transformMat4:n,transformMat4View:i,translate:c},Symbol.toStringTag,{value:"Module"}))},96400:function(e,t,r){function i(e,t){n(e.typedBuffer,t.typedBuffer,e.typedBufferStride,t.typedBufferStride)}function n(e,t,r=3,i=r){const n=t.length/i;let s=0,o=0;for(let a=0;a<n;++a)e[s]=t[o],e[s+1]=t[o+1],e[s+2]=t[o+2],s+=r,o+=i}function s(e,t,r,i,n){const s=e.typedBuffer,o=e.typedBufferStride,a=n?.count??e.count;let l=(n?.dstIndex??0)*o;for(let e=0;e<a;++e)s[l]=t,s[l+1]=r,s[l+2]=i,l+=o}r.d(t,{a:function(){return i},c:function(){return n},f:function(){return s}}),Object.freeze(Object.defineProperty({__proto__:null,copy:n,copyView:i,fill:s},Symbol.toStringTag,{value:"Module"}))},32003:function(e,t,r){r.d(t,{a:function(){return n},b:function(){return a},n:function(){return o},s:function(){return l},t:function(){return s}}),r(58941);var i=r(40633);function n(e,t,r){s(e.typedBuffer,t.typedBuffer,r,e.typedBufferStride,t.typedBufferStride)}function s(e,t,r,i=4,n=i){if(e.length/i!=t.length/n)return;const s=e.length/i,o=r[0],a=r[1],l=r[2],c=r[3],u=r[4],h=r[5],d=r[6],p=r[7],f=r[8];let m=0,g=0;for(let r=0;r<s;r++){const r=t[m],s=t[m+1],y=t[m+2],_=t[m+3];e[g]=o*r+c*s+d*y,e[g+1]=a*r+u*s+p*y,e[g+2]=l*r+h*s+f*y,e[g+3]=_,m+=n,g+=i}}function o(e,t){const r=Math.min(e.count,t.count),i=e.typedBuffer,n=e.typedBufferStride,s=t.typedBuffer,o=t.typedBufferStride;for(let e=0;e<r;e++){const t=e*n,r=e*o,a=s[r],l=s[r+1],c=s[r+2],u=a*a+l*l+c*c;if(u>0){const e=1/Math.sqrt(u);i[t]=e*a,i[t+1]=e*l,i[t+2]=e*c}}}function a(e,t,r){l(e.typedBuffer,t,r,e.typedBufferStride)}function l(e,t,r,i=4){const n=Math.min(e.length/i,t.count),s=t.typedBuffer,o=t.typedBufferStride;let a=0,l=0;for(let t=0;t<n;t++)e[l]=r*s[a],e[l+1]=r*s[a+1],e[l+2]=r*s[a+2],e[l+3]=r*s[a+3],a+=o,l+=i}Object.freeze(Object.defineProperty({__proto__:null,normalize:o,scale:l,scaleView:a,transformMat3:s,transformMat3View:n,transformMat4:function(e,t,r,n=4,s=n){if(e.length/n!=t.length/s)return void i.A.getLogger("esri.views.3d.support.buffer.math").error("source and destination buffers need to have the same number of elements");const o=e.length/n,a=r[0],l=r[1],c=r[2],u=r[3],h=r[4],d=r[5],p=r[6],f=r[7],m=r[8],g=r[9],y=r[10],_=r[11],v=r[12],b=r[13],x=r[14],S=r[15];let w=0,T=0;for(let r=0;r<o;r++){const r=t[w],i=t[w+1],o=t[w+2],A=t[w+3];e[T]=a*r+h*i+m*o+v*A,e[T+1]=l*r+d*i+g*o+b*A,e[T+2]=c*r+p*i+y*o+x*A,e[T+3]=u*r+f*i+_*o+S*A,w+=s,T+=n}},transformMat4View:function(e,t,r){if(e.count!==t.count)return;const i=e.count,n=r[0],s=r[1],o=r[2],a=r[3],l=r[4],c=r[5],u=r[6],h=r[7],d=r[8],p=r[9],f=r[10],m=r[11],g=r[12],y=r[13],_=r[14],v=r[15],b=e.typedBuffer,x=e.typedBufferStride,S=t.typedBuffer,w=t.typedBufferStride;for(let e=0;e<i;e++){const t=e*x,r=e*w,i=S[r],T=S[r+1],A=S[r+2],C=S[r+3];b[t]=n*i+l*T+d*A+g*C,b[t+1]=s*i+c*T+p*A+y*C,b[t+2]=o*i+u*T+f*A+_*C,b[t+3]=a*i+h*T+m*A+v*C}}},Symbol.toStringTag,{value:"Module"}))},84111:function(e,t,r){function i(e,t){n(e.typedBuffer,t,e.typedBufferStride)}function n(e,t,r=4){const i=t.typedBuffer,n=t.typedBufferStride,s=t.count;let o=0,a=0;for(let t=0;t<s;++t)e[o]=i[a],e[o+1]=i[a+1],e[o+2]=i[a+2],e[o+3]=i[a+3],o+=r,a+=n}function s(e,t,r,i,n,s){const o=e.typedBuffer,a=e.typedBufferStride,l=s?.count??e.count;let c=(s?.dstIndex??0)*a;for(let e=0;e<l;++e)o[c]=t,o[c+1]=r,o[c+2]=i,o[c+3]=n,c+=a}r.d(t,{a:function(){return i},c:function(){return n},f:function(){return s}}),Object.freeze(Object.defineProperty({__proto__:null,copy:n,copyView:i,fill:s},Symbol.toStringTag,{value:"Module"}))},67750:function(e,t,r){r.d(t,{A:function(){return D}});const i=[["(",")"],[")","("],["<",">"],[">","<"],["[","]"],["]","["],["{","}"],["}","{"],["«","»"],["»","«"],["‹","›"],["›","‹"],["⁽","⁾"],["⁾","⁽"],["₍","₎"],["₎","₍"],["≤","≥"],["≥","≤"],["〈","〉"],["〉","〈"],["﹙","﹚"],["﹚","﹙"],["﹛","﹜"],["﹜","﹛"],["﹝","﹞"],["﹞","﹝"],["﹤","﹥"],["﹥","﹤"]],n=["آ","أ","إ","ا"],s=["ﻵ","ﻷ","ﻹ","ﻻ"],o=["ﻶ","ﻸ","ﻺ","ﻼ"],a=["ا","ب","ت","ث","ج","ح","خ","د","ذ","ر","ز","س","ش","ص","ض","ط","ظ","ع","غ","ف","ق","ك","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ی","ئ","ؤ"],l=["ﺍ","ﺏ","ﺕ","ﺙ","ﺝ","ﺡ","ﺥ","ﺩ","ﺫ","ﺭ","ﺯ","ﺱ","ﺵ","ﺹ","ﺽ","ﻁ","ﻅ","ﻉ","ﻍ","ﻑ","ﻕ","ﻙ","ﻝ","ﻡ","ﻥ","ﻩ","ﻭ","ﻱ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯼ","ﺉ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺉ","ﺅ"],c=["ﺎ","ﺐ","ﺖ","ﺚ","ﺞ","ﺢ","ﺦ","ﺪ","ﺬ","ﺮ","ﺰ","ﺲ","ﺶ","ﺺ","ﺾ","ﻂ","ﻆ","ﻊ","ﻎ","ﻒ","ﻖ","ﻚ","ﻞ","ﻢ","ﻦ","ﻪ","ﻮ","ﻲ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯽ","ﺊ","ﺆ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺊ","ﺆ"],u=["ﺎ","ﺒ","ﺘ","ﺜ","ﺠ","ﺤ","ﺨ","ﺪ","ﺬ","ﺮ","ﺰ","ﺴ","ﺸ","ﺼ","ﻀ","ﻄ","ﻈ","ﻌ","ﻐ","ﻔ","ﻘ","ﻜ","ﻠ","ﻤ","ﻨ","ﻬ","ﻮ","ﻴ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯿ","ﺌ","ﺆ","ﹱ","ﹲ","ﹴ","ﹷ","ﹹ","ﹻ","ﹽ","ﹿ","ﺀ","ﺌ","ﺆ"],h=["ﺍ","ﺑ","ﺗ","ﺛ","ﺟ","ﺣ","ﺧ","ﺩ","ﺫ","ﺭ","ﺯ","ﺳ","ﺷ","ﺻ","ﺿ","ﻃ","ﻇ","ﻋ","ﻏ","ﻓ","ﻗ","ﻛ","ﻟ","ﻣ","ﻧ","ﻫ","ﻭ","ﻳ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯾ","ﺋ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺋ","ﺅ"],d=["ء","آ","أ","ؤ","إ","ا","ة","د","ذ","ر","ز","و","ى"],p=["ً","ً","ٌ","؟","ٍ","؟","َ","َ","ُ","ُ","ِ","ِ","ّ","ّ","ْ","ْ","ء","آ","آ","أ","أ","ؤ","ؤ","إ","إ","ئ","ئ","ئ","ئ","ا","ا","ب","ب","ب","ب","ة","ة","ت","ت","ت","ت","ث","ث","ث","ث","ج","ج","ج","ج","ح","ح","ح","ح","خ","خ","خ","خ","د","د","ذ","ذ","ر","ر","ز","ز","س","س","س","س","ش","ش","ش","ش","ص","ص","ص","ص","ض","ض","ض","ض","ط","ط","ط","ط","ظ","ظ","ظ","ظ","ع","ع","ع","ع","غ","غ","غ","غ","ف","ف","ف","ف","ق","ق","ق","ق","ك","ك","ك","ك","ل","ل","ل","ل","م","م","م","م","ن","ن","ن","ن","ه","ه","ه","ه","و","و","ى","ى","ي","ي","ي","ي","ﻵ","ﻶ","ﻷ","ﻸ","ﻹ","ﻺ","ﻻ","ﻼ","؟","؟","؟"],f=["ء","ف"],m=["غ","ي"],g=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],y=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],_=0,v=1,b=2,x=3,S=4,w=5,T=6,A=7,C=8,E=10,M=11,R=12,P=18,O=["UBAT_L","UBAT_R","UBAT_EN","UBAT_AN","UBAT_ON","UBAT_B","UBAT_S","UBAT_AL","UBAT_WS","UBAT_CS","UBAT_ES","UBAT_ET","UBAT_NSM","UBAT_LRE","UBAT_RLE","UBAT_PDF","UBAT_LRO","UBAT_RLO","UBAT_BN"],I=100,L=[I+0,_,_,_,_,I+1,I+2,I+3,v,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,I+4,S,S,S,_,S,_,S,_,S,S,S,_,_,S,S,_,_,_,_,_,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,_,_,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,_,_,_,_,_,_,_,_,_,_,_,_,_,_,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,_,_,S,S,_,_,S,S,_,_,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,_,_,_,I+5,A,A,I+6,I+7],N=[[P,P,P,P,P,P,P,P,P,T,w,T,C,w,P,P,P,P,P,P,P,P,P,P,P,P,P,P,w,w,w,T,C,S,S,M,M,M,S,S,S,S,S,E,9,E,9,9,b,b,b,b,b,b,b,b,b,b,9,S,S,S,S,S,S,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,S,S,S,S,S,S,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,S,S,S,S,P,P,P,P,P,P,w,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,9,S,M,M,M,M,S,S,S,S,_,S,S,P,S,S,M,M,b,b,S,_,S,S,S,b,_,S,S,S,S,S,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,S,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,S,_,_,_,_,_,_,_,_],[_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,S,S,S,S,S,S,S,S,S,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,S,S,_,_,_,_,_,_,_,S,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,S,_,S,S,S,S,S,S,S,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,v,R,v,R,R,v,R,R,v,R,S,S,S,S,S,S,S,S,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,S,S,S,S,S,v,v,v,v,v,S,S,S,S,S,S,S,S,S,S,S],[x,x,x,x,S,S,S,S,A,M,M,A,9,A,S,S,R,R,R,R,R,R,R,R,R,R,R,A,S,S,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,x,x,x,x,x,x,x,x,x,x,M,x,x,A,A,A,R,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,R,R,R,R,R,R,R,x,S,R,R,R,R,R,R,A,A,R,R,S,R,R,R,R,A,A,b,b,b,b,b,b,b,b,b,b,A,A,A,A,A,A],[A,A,A,A,A,A,A,A,A,A,A,A,A,A,S,A,A,R,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,S,S,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,R,R,R,R,R,R,R,R,R,R,R,A,S,S,S,S,S,S,S,S,S,S,S,S,S,S,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,R,R,R,R,R,R,R,R,R,v,v,S,S,S,S,v,S,S,S,S,S],[C,C,C,C,C,C,C,C,C,C,C,P,P,P,_,v,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,C,w,13,14,15,16,17,9,M,M,M,M,M,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,9,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,C,P,P,P,P,P,S,S,S,S,S,P,P,P,P,P,P,b,_,S,S,b,b,b,b,b,b,E,E,S,S,S,_,b,b,b,b,b,b,b,b,b,b,E,E,S,S,S,S,_,_,_,_,_,_,_,_,_,_,_,_,_,S,S,S,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S],[_,_,_,_,_,_,_,S,S,S,S,S,S,S,S,S,S,S,S,_,_,_,_,_,S,S,S,S,S,v,R,v,v,v,v,v,v,v,v,v,v,E,v,v,v,v,v,v,v,v,v,v,v,v,v,S,v,v,v,v,v,S,v,S,v,v,S,v,v,S,v,v,v,v,v,v,v,v,v,v,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A],[R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,R,R,R,R,R,R,R,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,9,S,9,S,S,9,S,S,S,S,S,S,S,S,S,M,S,S,E,E,S,S,S,S,S,M,M,S,S,S,S,S,A,A,A,A,A,S,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,S,S,P],[S,S,S,M,M,M,S,S,S,S,S,E,9,E,9,9,b,b,b,b,b,b,b,b,b,b,9,S,S,S,S,S,S,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,S,S,S,S,S,S,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,S,S,S,S,S,S,S,S,S,S,S,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,S,S,S,_,_,_,_,_,_,S,S,_,_,_,_,_,_,S,S,_,_,_,_,_,_,S,S,_,_,_,S,S,S,M,M,S,S,S,M,M,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S]];class D{constructor(){this.inputFormat="ILYNN",this.outputFormat="VLNNN",this.sourceToTarget=[],this.targetToSource=[],this.levels=[]}bidiTransform(e,t,r){if(this.sourceToTarget=[],this.targetToSource=[],!e)return"";if(function(e,t,r){ie=[],se=[];for(let i=0;i<r;i++)e[i]=i,t[i]=i,ie[i]=i}(this.sourceToTarget,this.targetToSource,e.length),!this.checkParameters(t,r))return e;t=this.inputFormat,r=this.outputFormat;let i=e;const a=oe,u=K(t.charAt(1)),d=K(r.charAt(1)),f=("I"===t.charAt(0)?"L":t.charAt(0))+u,m=("I"===r.charAt(0)?"L":r.charAt(0))+d,g=t.charAt(2)+r.charAt(2);a.defInFormat=f,a.defOutFormat=m,a.defSwap=g;const y=F(e,f,m,g,a);let _=!1;return"R"===r.charAt(1)?_=!0:"C"!==r.charAt(1)&&"D"!==r.charAt(1)||(_="rtl"===this.checkContextual(y)),this.sourceToTarget=ie,this.targetToSource=function(e){const t=new Array(e.length);for(let r=0;r<e.length;r++)t[e[r]]=r;return t}(this.sourceToTarget),ne=this.targetToSource,i=t.charAt(3)===r.charAt(3)?y:"S"===r.charAt(3)?function(e,t,r){if(0===t.length)return"";void 0===e&&(e=!0);const i=(t=String(t)).split("");let n=0,a=1,u=i.length;e||(n=i.length-1,a=-1,u=1);const d=function(e,t,r,i,n){let a=0;const u=[];let d=0;for(let n=t;n*r<i;n+=r)if(k(e[n])||Q(e[n])){if("ل"===e[n]&&W(e,n+r,r,i)){e[n]=te(e[n+r],0===a?s:o),n+=r,ee(e,n,r,i),u[d]=n,d++,a=0;continue}const t=e[n];1===a?e[n]=j(e,n+r,r,i)?X(e[n]):J(e[n],c):!0===j(e,n+r,r,i)?e[n]=J(e[n],h):e[n]=J(e[n],l),Q(t)||(a=1),!0===Y(t)&&(a=0)}else a=0;return u}(i,n,a,u);let p="";for(let t=0;t<i.length;t++)H(d,d.length,t)>-1?(re(ne,t,!e,-1),ie.splice(t,1)):p+=i[t];return p}(_,y):function(e,t,r){if(0===e.length)return"";void 0===t&&(t=!0);let i="";const s=(e=String(e)).split("");for(let r=0;r<e.length;r++){let o=!1;if(s[r]>="ﹰ"&&s[r]<"\ufeff"){const a=e.charCodeAt(r);s[r]>="ﻵ"&&s[r]<="ﻼ"?(t?(r>0&&" "===s[r-1]?i=i.substring(0,i.length-1)+"ل":(i+="ل",o=!0),i+=n[(a-65269)/2]):(i+=n[(a-65269)/2],i+="ل",r+1<e.length&&" "===s[r+1]?r++:o=!0),o&&(re(ne,r,!0,1),ie.splice(r,0,ie[r]))):i+=p[a-65136]}else i+=s[r]}return i}(y,_),this.sourceToTarget=ie,this.targetToSource=ne,this.levels=se,i}_inputFormatSetter(e){if(!he.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=e}_outputFormatSetter(e){if(!he.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=e}checkParameters(e,t){return e?this._inputFormatSetter(e):e=this.inputFormat,t?this._outputFormatSetter(t):t=this.outputFormat,e!==t}checkContextual(e){let t=z(e);if("ltr"!==t&&"rtl"!==t){try{t=document.dir.toLowerCase()}catch(e){}"ltr"!==t&&"rtl"!==t&&(t="ltr")}return t}hasBidiChar(e){return de.test(e)}}function F(e,t,r,i,n){const s=function(e,t,r){if(void 0===t.inFormat&&(t.inFormat=r.defInFormat),void 0===t.outFormat&&(t.outFormat=r.defOutFormat),void 0===t.swap&&(t.swap=r.defSwap),t.inFormat===t.outFormat)return t;const i=t.inFormat.substring(0,1),n=t.outFormat.substring(0,1);let s,o=t.inFormat.substring(1,4),a=t.outFormat.substring(1,4);return"C"===o.charAt(0)&&(s=z(e),o="ltr"===s||"rtl"===s?s.toUpperCase():"L"===t.inFormat.charAt(2)?"LTR":"RTL",t.inFormat=i+o),"C"===a.charAt(0)&&(s=z(e),"rtl"===s?a="RTL":"ltr"===s?(s=function(e){const t=e.split("");return t.reverse(),z(t.join(""))}(e),a=s.toUpperCase()):a="L"===t.outFormat.charAt(2)?"LTR":"RTL",t.outFormat=n+a),t}(e,{inFormat:t,outFormat:r,swap:i},n);if(s.inFormat===s.outFormat)return e;t=s.inFormat,r=s.outFormat,i=s.swap;const o=t.substring(0,1),a=t.substring(1,4),l=r.substring(0,1),c=r.substring(1,4);if(n.inFormat=t,n.outFormat=r,n.swap=i,"L"===o&&"VLTR"===r){if("LTR"===a)return n.dir=ce,V(e,n);if("RTL"===a)return n.dir=ue,V(e,n)}if("V"===o&&"V"===l)return n.dir="RTL"===a?ue:ce,B(e,n);if("L"===o&&"VRTL"===r)return"LTR"===a?(n.dir=ce,e=V(e,n)):(n.dir=ue,e=V(e,n)),B(e);if("VLTR"===t&&"LLTR"===r)return n.dir=ce,V(e,n);if("V"===o&&"L"===l&&a!==c)return e=B(e),"RTL"===a?F(e,"LLTR","VLTR",i,n):F(e,"LRTL","VRTL",i,n);if("VRTL"===t&&"LRTL"===r)return F(e,"LRTL","VRTL",i,n);if("L"===o&&"L"===l){const t=n.swap;return n.swap=t.substr(0,1)+"N","RTL"===a?(n.dir=ue,e=V(e,n),n.swap="N"+t.substr(1,2),n.dir=ce,e=V(e,n)):(n.dir=ce,e=V(e,n),n.swap="N"+t.substr(1,2),e=F(e,"VLTR","LRTL",n.swap,n)),e}return e}function z(e){const t=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(e);return t?t[0]<="z"?"ltr":"rtl":""}function V(e,t){const r=e.split(""),i=[];return U(r,i,t),function(e,t,r){if(0!==r.hiLevel&&r.swap.substr(0,1)!==r.swap.substr(1,2))for(let r=0;r<e.length;r++)1===t[r]&&(e[r]=$(e[r]))}(r,i,t),q(2,r,i,t),q(1,r,i,t),se=i,r.join("")}function U(e,t,r){const i=e.length,n=r.dir?y:g;let s=0,o=-1;const a=[],l=[];r.hiLevel=r.dir,r.lastArabic=!1,r.hasUbatAl=!1,r.hasUbatB=!1,r.hasUbatS=!1;for(let t=0;t<i;t++)a[t]=G(e[t]);for(let c=0;c<i;c++){const i=s,u=Z(e,a,l,c,r);l[c]=u,s=n[i][u];const h=240&s;s&=15;const d=n[s][ae];if(t[c]=d,h>0)if(16===h){for(let e=o;e<c;e++)t[e]=1;o=-1}else o=-1;if(n[s][le])-1===o&&(o=c);else if(o>-1){for(let e=o;e<c;e++)t[e]=d;o=-1}a[c]===w&&(t[c]=0),r.hiLevel|=d}r.hasUbatS&&function(e,t,r,i){for(let n=0;n<r;n++)if(e[n]===T){t[n]=i.dir;for(let r=n-1;r>=0&&e[r]===C;r--)t[r]=i.dir}}(a,t,i,r)}function G(e){const t=e.charCodeAt(0),r=L[t>>8];return r<I?r:N[r-I][255&t]}function B(e,t){const r=e.split("");if(t){const e=[];U(r,e,t),se=e}return r.reverse(),ie.reverse(),r.join("")}function H(e,t,r){for(let i=0;i<t;i++)if(e[i]===r)return i;return-1}function k(e){for(let t=0;t<f.length;t++)if(e>=f[t]&&e<=m[t])return!0;return!1}function j(e,t,r,i){for(;t*r<i&&Q(e[t]);)t+=r;return!!(t*r<i&&k(e[t]))}function W(e,t,r,i){for(;t*r<i&&Q(e[t]);)t+=r;let s=" ";if(!(t*r<i))return!1;s=e[t];for(let e=0;e<n.length;e++)if(n[e]===s)return!0;return!1}function q(e,t,r,i){if(i.hiLevel<e)return;if(1===e&&i.dir===ue&&!i.hasUbatB)return t.reverse(),void ie.reverse();const n=t.length;let s,o,a,l,c,u=0;for(;u<n;){if(r[u]>=e){for(s=u+1;s<n&&r[s]>=e;)s++;for(o=u,a=s-1;o<a;o++,a--)l=t[o],t[o]=t[a],t[a]=l,c=ie[o],ie[o]=ie[a],ie[a]=c;u=s}u++}}function Z(e,t,r,i,n){const s=t[i];return{UBAT_L:()=>(n.lastArabic=!1,_),UBAT_R:()=>(n.lastArabic=!1,v),UBAT_ON:()=>S,UBAT_AN:()=>x,UBAT_EN:()=>n.lastArabic?x:b,UBAT_AL:()=>(n.lastArabic=!0,n.hasUbatAl=!0,v),UBAT_WS:()=>S,UBAT_CS:()=>{let e,s;return i<1||i+1>=t.length||(e=r[i-1])!==b&&e!==x||(s=t[i+1])!==b&&s!==x?S:(n.lastArabic&&(s=x),s===e?s:S)},UBAT_ES:()=>(i>0?r[i-1]:w)===b&&i+1<t.length&&t[i+1]===b?b:S,UBAT_ET:()=>{if(i>0&&r[i-1]===b)return b;if(n.lastArabic)return S;let e=i+1;const s=t.length;for(;e<s&&t[e]===M;)e++;return e<s&&t[e]===b?b:S},UBAT_NSM:()=>{if("VLTR"===n.inFormat){const r=t.length;let n=i+1;for(;n<r&&t[n]===R;)n++;if(n<r){const r=e[i].charCodeAt(0),s=r>=1425&&r<=2303||64286===r,o=t[n];if(s&&(o===v||o===A))return v}}return i<1||t[i-1]===w?S:r[i-1]},UBAT_B:()=>(n.lastArabic=!0,n.hasUbatB=!0,n.dir),UBAT_S:()=>(n.hasUbatS=!0,S),UBAT_LRE:()=>(n.lastArabic=!1,S),UBAT_RLE:()=>(n.lastArabic=!1,S),UBAT_LRO:()=>(n.lastArabic=!1,S),UBAT_RLO:()=>(n.lastArabic=!1,S),UBAT_PDF:()=>(n.lastArabic=!1,S),UBAT_BN:()=>S}[O[s]]()}function $(e){let t,r=0,n=i.length-1;for(;r<=n;)if(t=Math.floor((r+n)/2),e<i[t][0])n=t-1;else{if(!(e>i[t][0]))return i[t][1];r=t+1}return e}function Y(e){for(let t=0;t<d.length;t++)if(d[t]===e)return!0;return!1}function X(e){for(let t=0;t<a.length;t++)if(e===a[t])return u[t];return e}function J(e,t){for(let r=0;r<a.length;r++)if(e===a[r])return t[r];return e}function Q(e){return e>="ً"&&e<="ٕ"}function K(e){return"L"===e?"LTR":"R"===e?"RTL":"C"===e?"CLR":"D"===e?"CRL":""}function ee(e,t,r,i){for(;t*r<i&&Q(e[t]);)t+=r;return t*r<i&&(e[t]=" ",!0)}function te(e,t){for(let r=0;r<n.length;r++)if(e===n[r])return t[r];return e}function re(e,t,r,i){for(let n=0;n<e.length;n++)(e[n]>t||!r&&e[n]===t)&&(e[n]+=i)}let ie=[],ne=[],se=[];const oe={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},ae=5,le=6,ce=0,ue=1,he=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,de=/[\u0591-\u06ff\ufb1d-\ufefc]/},90152:function(e,t,r){r.d(t,{y:function(){return n}});const i=new(r(67750).A);function n(e){if(null==e)return["",!1];if(!i.hasBidiChar(e))return[e,!1];let t;return t="rtl"===i.checkContextual(e)?"IDNNN":"ICNNN",[i.bidiTransform(e,t,"VLYSN"),!0]}},99680:function(e,t,r){r.d(t,{q:function(){return n}});var i=r(85408);class n{constructor(e,t){this._storage=new i.F,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),t&&this._storage.registerRemoveFunc("",t)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,t,r=1){this._storage.put(this,e,t,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}}},85408:function(e,t,r){r.d(t,{Cn:function(){return s},F:function(){return c},Mn:function(){return l},Ti:function(){return n},k2:function(){return o}});var i=r(7187);const n=-3,s=n-1;var o,a;(a=o||(o={}))[a.ALL=0]="ALL",a[a.SOME=1]="SOME";class l{constructor(e,t,r){this.name=e,this._storage=t,this.id=u+++":",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),r&&(this._storage.registerRemoveFunc(this.id,r),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(e){return this._storage.getSize(this,e)}resetHitRate(){this._hit=this._miss=0}put(e,t,r,i=0){this._storage.put(this,e,t,r,i)}pop(e){const t=this._storage.pop(this,e);return void 0===t?++this._miss:++this._hit,t}get(e){const t=this._storage.get(this,e);return void 0===t?++this._miss:++this._hit,t}peek(e){return this._storage.peek(this,e)}updateSize(e,t,r){this._storage.updateSize(this,e,t,r)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}class c{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new i.A,this._users=new i.A}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,t){this._removeFuncs.push([e,t])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace((t=>t[0]!==e))}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,t){const r=this._db.get(e.id+t);return r?.size??0}put(e,t,r,i,a){t=e.id+t;const l=this._db.get(t);if(l&&(this._size-=l.size,e.size-=l.size,this._db.delete(t),l.entry!==r&&this._notifyRemove(t,l.entry,l.size,o.ALL)),i>this._maxSize)return void this._notifyRemove(t,r,i,o.ALL);if(void 0===r)return void console.warn("Refusing to cache undefined entry ");if(!i||i<0)return console.warn(`Refusing to cache entry with size ${i} for key ${t}`),void this._notifyRemove(t,r,0,o.ALL);const c=1+Math.max(a,s)-n;this._db.set(t,new h(r,i,c)),this._size+=i,e.size+=i,this._checkSize()}updateSize(e,t,r,i){t=e.id+t;const n=this._db.get(t);if(n&&n.entry===r){for(this._size-=n.size,e.size-=n.size;i>this._maxSize;){const e=this._notifyRemove(t,r,i,o.SOME);if(!(null!=e&&e>0))return void this._db.delete(t);i=e}n.size=i,this._size+=i,e.size+=i,this._checkSize()}}pop(e,t){t=e.id+t;const r=this._db.get(t);if(r)return this._size-=r.size,e.size-=r.size,this._db.delete(t),++this._hit,r.entry;++this._miss}get(e,t){t=e.id+t;const r=this._db.get(t);if(void 0!==r)return this._db.delete(t),r.lives=r.lifetime,this._db.set(t,r),++this._hit,r.entry;++this._miss}peek(e,t){const r=this._db.get(e.id+t);return r?++this._hit:++this._miss,r?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},r=new Array;this._db.forEach(((e,i)=>{const n=e.lifetime;r[n]=(r[n]||0)+e.size,this._users.forAll((r=>{const{id:n,name:s}=r;if(i.startsWith(n)){const r=t[s]||0;t[s]=r+e.size}}))}));const i={};this._users.forAll((e=>{const r=e.name;if("hitRate"in e&&"number"==typeof e.hitRate&&!isNaN(e.hitRate)&&e.hitRate>0){const n=t[r]||0;t[r]=n,i[r]=Math.round(100*e.hitRate)+"%"}else i[r]="0%"}));const s=Object.keys(t);s.sort(((e,r)=>t[r]-t[e])),s.forEach((r=>e[r]=Math.round(t[r]/2**20)+"MB / "+i[r]));for(let t=r.length-1;t>=0;--t){const i=r[t];i&&(e["Priority "+(t+n-1)]=Math.round(i/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll((e=>e.resetHitRate()))}clear(e){const t=e.id;this._db.forEach(((e,r)=>{r.startsWith(t)&&(this._size-=e.size,this._db.delete(r),this._notifyRemove(r,e.entry,e.size,o.ALL))})),e.size=0}clearAll(){this._db.forEach(((e,t)=>this._notifyRemove(t,e.entry,e.size,o.ALL))),this._users.forAll((e=>e.size=0)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,t,r,i){let n;return this._removeFuncs.some((s=>{if(e.startsWith(s[0])){const e=s[1](t,i,r);return"number"==typeof e&&(n=e),!0}return!1})),n}_checkSize(){this._users.forAll((e=>this._checkSizeLimits(e))),this._checkSizeLimits()}_checkSizeLimits(e){const t=e??this;if(t.maxSize<0||t.size<=t.maxSize)return;const r=e?.id;let i=!0;for(;i;){i=!1;for(const[n,s]of this._db)if(0===s.lifetime&&(!r||n.startsWith(r))){if(this._purgeItem(n,s,e),t.size<=.9*t.maxSize)return;i||=this._db.has(n)}}for(const[i,n]of this._db)if((!r||i.startsWith(r))&&(this._purgeItem(i,n,e),t.size<=.9*t.maxSize))return}_purgeItem(e,t,r=this._users.find((t=>e.startsWith(t.id)))){if(this._db.delete(e),t.lives<=1){this._size-=t.size,r&&(r.size-=t.size);const i=this._notifyRemove(e,t.entry,t.size,o.SOME);null!=i&&i>0&&(this._size+=i,r&&(r.size+=i),t.lives=t.lifetime,t.size=i,this._db.set(e,t))}else--t.lives,this._db.set(e,t)}}let u=0;class h{constructor(e,t,r){this.entry=e,this.size=t,this.lifetime=r,this.lives=r}}},7970:function(e,t,r){r.d(t,{O:function(){return i}});class i{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===this._outer.size}get(e,t){return this._outer.get(e)?.get(t)}set(e,t,r){const i=this._outer.get(e);i?i.set(t,r):this._outer.set(e,new Map([[t,r]]))}delete(e,t){const r=this._outer.get(e);r&&(r.delete(t),0===r.size&&this._outer.delete(e))}forEach(e){this._outer.forEach(((t,r)=>e(t,r)))}}},58009:function(e,t,r){r.d(t,{R:function(){return n}});var i=r(39819);let n=class e{constructor(e,t,r=""){this.major=e,this.minor=t,this._context=r}lessThan(e,t){return this.major<e||e===this.major&&this.minor<t}since(e,t){return!this.lessThan(e,t)}validate(e){if(this.major!==e.major){const t=this._context&&this._context+":",r=this._context&&this._context+" ";throw new i.A(t+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new e(this.major,this.minor,this._context)}static parse(t,r=""){const[n,s]=t.split("."),o=/^\s*\d+\s*$/;if(!n?.match||!o.test(n))throw new i.A((r&&r+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:t});if(!s?.match||!o.test(s))throw new i.A((r&&r+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:t});const a=parseInt(n,10),l=parseInt(s,10);return new e(a,l,r)}}},72952:function(e,t,r){r.d(t,{EB:function(){return p},Im:function(){return g},Mj:function(){return d},Ui:function(){return m},w2:function(){return f}});var i=r(83525),n=r(78879),s=r(63693);const o=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function a(e){return e instanceof i.A}function l(e){return e instanceof n.A?Object.keys(e.items):a(e)?(0,s.oY)(e).keys():e?Object.keys(e):[]}function c(e,t){return e instanceof n.A?e.items[t]:e[t]}function u(e){return e?e.declaredClass:null}function h(e,t){const r=e.diff;if(r&&"function"==typeof r)return r(e,t);const i=l(e),n=l(t);if(0===i.length&&0===n.length)return;if(!i.length||!n.length||function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}(e,t))return{type:"complete",oldValue:e,newValue:t};const s=n.filter((e=>!i.includes(e))),d=i.filter((e=>!n.includes(e))),p=i.filter((r=>n.includes(r)&&c(e,r)!==c(t,r))).concat(s,d).sort(),f=u(e);if(f&&o.has(f)&&p.length)return{type:"complete",oldValue:e,newValue:t};let m;const g=a(e)&&a(t);for(const i of p){const n=c(e,i),s=c(t,i);let o;if((g||"function"!=typeof n&&"function"!=typeof s)&&n!==s&&(null!=n||null!=s)){if(r&&r[i]&&"function"==typeof r[i])o=r[i]?.(n,s);else if(n instanceof Date&&s instanceof Date){if(n.getTime()===s.getTime())continue;o={type:"complete",oldValue:n,newValue:s}}else o="object"==typeof n&&"object"==typeof s&&u(n)===u(s)?h(n,s):{type:"complete",oldValue:n,newValue:s};null!=o&&(null!=m?m.diff[i]=o:m={type:"partial",diff:{[i]:o}})}}return m}function d(e,t){return p(e,t)}function p(e,t){if(null==e)return!1;const r=t.split(".");let i=e;for(const e of r){if("complete"===i.type)return!0;if("partial"!==i.type)return!1;{const t=i.diff[e];if(!t)return!1;i=t}}return!0}function f(e,t){if(!e)return!1;if("partial"===e.type){const r=Object.keys(e.diff);return 1===r.length&&r[0]===t}return!1}function m(e,t){if("function"!=typeof e&&"function"!=typeof t&&(null!=e||null!=t))return null==e||null==t||"object"==typeof e&&"object"==typeof t&&u(e)!==u(t)?{type:"complete",oldValue:e,newValue:t}:h(e,t)}function g(e){if(null==e)return!0;switch(e.type){case"complete":return!1;case"collection":{const t=e;for(const e of t.added)if(!g(e))return!1;for(const e of t.removed)if(!g(e))return!1;for(const e of t.changed)if(!g(e))return!1;return!0}case"partial":for(const t in e.diff)if(!g(e.diff[t]))return!1;return!0}}},75505:function(e,t,r){r.d(t,{$:function(){return g},IB:function(){return s},N2:function(){return y},QP:function(){return E},RH:function(){return v},Vl:function(){return C},Ws:function(){return b},ZD:function(){return _},_L:function(){return A},bJ:function(){return w},e$:function(){return T},f6:function(){return R},pW:function(){return x},pf:function(){return M}});var i=r(52874),n=(r(33400),r(41546));function s(e){return"r"in e&&"g"in e&&"b"in e}function o(e){return"h"in e&&"s"in e&&"v"in e}function a(e){return"l"in e&&"a"in e&&"b"in e}function l(e){return"l"in e&&"c"in e&&"h"in e}const c=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],u=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function h(e,t){const r=[];let i,n;if(e[0].length!==t.length)throw new Error("dimensions do not match");const s=e.length,o=e[0].length;let a=0;for(i=0;i<s;i++){for(a=0,n=0;n<o;n++)a+=e[i][n]*t[n];r.push(a)}return r}function d(e){const t=[e.r/255,e.g/255,e.b/255].map((e=>e<=.04045?e/12.92:((e+.055)/1.055)**2.4)),r=h(c,t);return{x:100*r[0],y:100*r[1],z:100*r[2]}}function p(e){const t=h(u,[e.x/100,e.y/100,e.z/100]).map((e=>{const t=e<=.0031308?12.92*e:1.055*e**(1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function f(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map((e=>e>(6/29)**3?e**(1/3):1/3*(29/6)**2*e+4/29));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function m(e){const t=e.l,r=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((e=>e>6/29?e**3:3*(6/29)**2*(e-4/29)));return{x:95.047*r[0],y:100*r[1],z:108.883*r[2]}}function g(e){return s(e)?e:l(e)?function(e){return p(m(function(e){const t=e.l,r=e.c,i=e.h;return{l:t,a:r*Math.cos(i),b:r*Math.sin(i)}}(e)))}(e):a(e)?function(e){return p(m(e))}(e):function(e){return"x"in e&&"y"in e&&"z"in e}(e)?p(e):o(e)?function(e){const t=(e.h+360)%360/60,r=e.s/100,i=e.v/100*255,n=i*r,s=n*(1-Math.abs(t%2-1));let o;switch(Math.floor(t)){case 0:o={r:n,g:s,b:0};break;case 1:o={r:s,g:n,b:0};break;case 2:o={r:0,g:n,b:s};break;case 3:o={r:0,g:s,b:n};break;case 4:o={r:s,g:0,b:n};break;case 5:case 6:o={r:n,g:0,b:s};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+i-n),o.g=Math.round(o.g+i-n),o.b=Math.round(o.b+i-n),o}(e):e}function y(e){return o(e)?e:function(e){const t=e.r,r=e.g,i=e.b,n=Math.max(t,r,i),s=n-Math.min(t,r,i);let o=n,a=0===s?0:n===t?(r-i)/s%6:n===r?(i-t)/s+2:(t-r)/s+4,l=0===s?0:s/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}(g(e))}function _(e){return a(e)?e:function(e){return f(d(e))}(g(e))}function v(e){return l(e)?e:function(e){return function(e){const t=e.l,r=e.a,i=e.b,n=Math.sqrt(r*r+i*i);let s=Math.atan2(i,r);return s=s>0?s:s+2*Math.PI,{l:t,c:n,h:s}}(f(d(e)))}(g(e))}function b(e,t){const{r:r,g:n,b:s}=t?.ignoreAlpha?e:function(e){let{r:t,g:r,b:n,a:s}=e;return s<1&&(t=Math.round(s*t+255*(1-s)),r=Math.round(s*r+255*(1-s)),n=Math.round(s*n+255*(1-s))),new i.A({r:t,g:r,b:n})}(e);return.2126*r+.7152*n+.0722*s}var x,S;function w(e,t=x.High){return b(e,{ignoreAlpha:!0})>t?new i.A([0,0,0,e.a]):new i.A([255,255,255,e.a])}function T(e,t){const r=_(e);r.l*=1-t;const i=g(r),n=e.clone();return n.setColor(i),n.a=e.a,n}function A(e,t){const r=e.clone();return r.a*=t,r}function C(e,t){const r=y(e);r.s*=t;const i=g(r),n=e.clone();return n.setColor(i),n.a=e.a,n}function E(e){return i.A.toUnitRGBA(e)}function M(e){return(0,n.fA)(e[0],e[1],e[2],e.length>3?e[3]:1)}function R(e,t){const r=i.A.toUnitRGBA(e);return r[3]*=t,r}(S=x||(x={}))[S.Low=160]="Low",S[S.High=225]="High"},14520:function(e,t,r){function i(e){return e=e||globalThis.location.hostname,c.some((t=>null!=e?.match(t)))}function n(e,t){return e&&(t=t||globalThis.location.hostname)?null!=t.match(s)||null!=t.match(a)?e.replace("static.arcgis.com","staticdev.arcgis.com"):null!=t.match(o)||null!=t.match(l)?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e}r.d(t,{EM:function(){return n},b5:function(){return i}});const s=/^devext\.arcgis\.com$/,o=/^qaext\.arcgis\.com$/,a=/^[\w-]*\.mapsdevext\.arcgis\.com$/,l=/^[\w-]*\.mapsqa\.arcgis\.com$/,c=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local\.esri\.com$/,s,o,/^jsapps\.esri\.com$/,a,l]},5161:function(e,t,r){r.d(t,{T:function(){return s},U:function(){return n}});var i=r(15774);function n(e,t,r=0){const n=(0,i.qE)(e,0,l);for(let e=0;e<4;e++)t[r+e]=Math.floor(256*c(n*o[e]))}function s(e,t=0){let r=0;for(let i=0;i<4;i++)r+=e[t+i]*a[i];return r}const o=[1,256,65536,16777216],a=[1/256,1/65536,1/16777216,1/4294967296],l=s(new Uint8ClampedArray([255,255,255,255]));function c(e){return e-Math.floor(e)}},80683:function(e,t,r){r.d(t,{Al:function(){return c},NZ:function(){return u},Vb:function(){return n},af:function(){return h},rK:function(){return d}});var i=r(25591);const n="arial-unicode-ms",s="woff2",o=new Map,a=new Set;class l{constructor(e,t){this.fontFace=e,this.promise=t}}async function c(e){const t=p(e),r=d(e),n=o.get(t);if(n)return n.promise;const c=new FontFace(e.family,`url('${i.default.fontsUrl}/woff2/${r}.${s}') format('${s}')`,{style:e.style,weight:e.weight}),u=document.fonts;if(u.has(c)&&"loading"===c.status)return c.loaded;const h=c.load().then((()=>(u.add(c),c)));return o.set(t,new l(c,h)),a.add(c),h}function u(e){return a.has(e)}function h(e){if(!e)return n;const t=e.toLowerCase().split(" ").join("-");switch(t){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return t}}function d(e){const t=f(e)+m(e);return h(e.family)+(t.length>0?t:"-regular")}function p(e){const t=f(e)+m(e);return(e.family||n)+(t.length>0?t:"-regular")}function f(e){if(!e.weight)return"";switch(e.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function m(e){if(!e.style)return"";switch(e.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}},87847:function(e,t,r){r.d(t,{M5:function(){return p},eV:function(){return h},xR:function(){return u}});var i=r(93040),n=r(39819),s=r(60539),o=r(90683),a=r(40845);let l=null,c=!0;function u(e,t,r){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(c)try{return new ImageData(e,t)}catch(e){c=!1}return d(e,t,r)}function h(e,t,r,i){if(!t||!r)throw new Error("Cannot construct image data without dimensions");if(c)try{return new ImageData(e,t,r)}catch(e){c=!1}const n=d(t,r,i);return n.data.set(e,0),n}function d(e,t,r){return r||(l||(l=document.createElement("canvas"),l.width=1,l.height=1),r=l),r.getContext("2d").createImageData(e,t)}async function p(e,t){const{arrayBuffer:l,mediaType:c}=await async function(e,t){const r=(0,o.r$)(e);if(r?.isBase64)return{arrayBuffer:(0,a.M)(r.data),mediaType:r.mediaType};const n=await(0,i.A)(e,{responseType:"array-buffer",...t});return{arrayBuffer:n.data,mediaType:n.getHeader?.("Content-Type")??""}}(e,t),u="image/png"===c;if("image/gif"===c){const{isAnimatedGIF:e,parseGif:i}=await r.e(8627).then(r.bind(r,36089));if(e(l))return i(l,t)}if(u){const{isAnimatedPNG:e,parseApng:i}=await r.e(5297).then(r.bind(r,9073));if(e(l))return i(l,t)}return async function(e,t){const r=window.URL.createObjectURL(e);try{const{data:e}=await(0,i.A)(r,{...t,responseType:"image"});return e}catch(e){if(!(0,s.zf)(e))throw new n.A("invalid-image",`Could not fetch requested image at ${r}`);throw e}finally{window.URL.revokeObjectURL(r)}}(new Blob([l],{type:c}),t)}},10793:function(e,t,r){function i(){const e=new Float32Array(6);return e[0]=1,e[3]=1,e}function n(e,t,r,i){const n=t[i],s=t[i+1];e[i]=r[0]*n+r[2]*s+r[4],e[i+1]=r[1]*n+r[3]*s+r[5]}function s(e,t,r,i=0,s=0,o=2){const a=s||t.length/o;for(let s=i;s<a;s++)n(e,t,r,s*o)}r.d(t,{gb:function(){return s},vt:function(){return i}}),Object.freeze(Object.defineProperty({__proto__:null,clone:function(e){const t=new Float32Array(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},create:i,createView:function(e,t){return new Float32Array(e,t,6)},fromValues:function(e,t,r,i,n,s){const o=new Float32Array(6);return o[0]=e,o[1]=t,o[2]=r,o[3]=i,o[4]=n,o[5]=s,o},transform:n,transformMany:s},Symbol.toStringTag,{value:"Module"}))},14583:function(e,t,r){function i(){return new Float32Array(2)}function n(e,t){const r=new Float32Array(2);return r[0]=e,r[1]=t,r}function s(){return i()}function o(){return n(1,1)}function a(){return n(1,0)}function l(){return n(0,1)}r.d(t,{Un:function(){return u},fA:function(){return n},uY:function(){return c},vt:function(){return i}});const c=s(),u=o(),h=a(),d=l();Object.freeze(Object.defineProperty({__proto__:null,ONES:u,UNIT_X:h,UNIT_Y:d,ZEROS:c,clone:function(e){const t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t},create:i,createView:function(e,t){return new Float32Array(e,t,2)},fromValues:n,ones:o,unitX:a,unitY:l,zeros:s},Symbol.toStringTag,{value:"Module"}))},43274:function(e,t,r){function i(){return new Float32Array(3)}function n(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function s(e,t,r){const i=new Float32Array(3);return i[0]=e,i[1]=t,i[2]=r,i}function o(){return i()}function a(){return s(1,1,1)}function l(){return s(1,0,0)}function c(){return s(0,1,0)}function u(){return s(0,0,1)}r.d(t,{fA:function(){return s},o8:function(){return n},vt:function(){return i}});const h=o(),d=a(),p=l(),f=c(),m=u();Object.freeze(Object.defineProperty({__proto__:null,ONES:d,UNIT_X:p,UNIT_Y:f,UNIT_Z:m,ZEROS:h,clone:n,create:i,createView:function(e,t){return new Float32Array(e,t,3)},fromValues:s,ones:a,unitX:l,unitY:c,unitZ:u,zeros:o},Symbol.toStringTag,{value:"Module"}))},67348:function(e,t,r){r.d(t,{$0:function(){return h},B8:function(){return o},CV:function(){return d},D_:function(){return n},Tl:function(){return u},e$:function(){return l},hZ:function(){return s},hs:function(){return c},kN:function(){return p},lw:function(){return a}});var i=r(8527);function n(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function s(e,t,r,i,n,s,o){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=s,e[5]=o,e}function o(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5];let l=r*s-i*n;return l?(l=1/l,e[0]=s*l,e[1]=-i*l,e[2]=-n*l,e[3]=r*l,e[4]=(n*a-s*o)*l,e[5]=(i*o-r*a)*l,e):null}function a(e,t,r){const i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=r[0],u=r[1],h=r[2],d=r[3],p=r[4],f=r[5];return e[0]=i*c+s*u,e[1]=n*c+o*u,e[2]=i*h+s*d,e[3]=n*h+o*d,e[4]=i*p+s*f+a,e[5]=n*p+o*f+l,e}function l(e,t,r){const i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=Math.sin(r),u=Math.cos(r);return e[0]=i*u+s*c,e[1]=n*u+o*c,e[2]=i*-c+s*u,e[3]=n*-c+o*u,e[4]=a,e[5]=l,e}function c(e,t,r){const i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=r[0],u=r[1];return e[0]=i*c,e[1]=n*c,e[2]=s*u,e[3]=o*u,e[4]=a,e[5]=l,e}function u(e,t,r){const i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=r[0],u=r[1];return e[0]=i,e[1]=n,e[2]=s,e[3]=o,e[4]=i*c+s*u+a,e[5]=n*c+o*u+l,e}function h(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e[4]=0,e[5]=0,e}function d(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function p(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function f(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}const m=a,g=f;Object.freeze(Object.defineProperty({__proto__:null,add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},determinant:function(e){return e[0]*e[3]-e[1]*e[2]},equals:function(e,t){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=t[0],u=t[1],h=t[2],d=t[3],p=t[4],f=t[5],m=(0,i.FD)();return Math.abs(r-c)<=m*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-u)<=m*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(s-h)<=m*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(o-d)<=m*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(a-p)<=m*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(l-f)<=m*Math.max(1,Math.abs(l),Math.abs(f))},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)},fromRotation:h,fromScaling:d,fromTranslation:p,identity:n,invert:o,mul:m,multiply:a,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e},multiplyScalarAndAdd:function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e},rotate:l,scale:c,set:s,str:function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},sub:g,subtract:f,translate:u},Symbol.toStringTag,{value:"Module"}))},44705:function(e,t,r){r.d(t,{B8:function(){return l},D_:function(){return o},Ge:function(){return _},I0:function(){return g},KC:function(){return c},Oe:function(){return f},Tl:function(){return h},dR:function(){return y},e$:function(){return d},hZ:function(){return s},hs:function(){return p},kN:function(){return m},lw:function(){return u},mg:function(){return a},z0:function(){return n}});var i=r(8527);function n(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function s(e,t,r,i,n,s,o,a,l,c){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=s,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e}function o(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function a(e,t){if(e===t){const r=t[1],i=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function l(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=u*o-a*c,d=-u*s+a*l,p=c*s-o*l;let f=r*h+i*d+n*p;return f?(f=1/f,e[0]=h*f,e[1]=(-u*i+n*c)*f,e[2]=(a*i-n*o)*f,e[3]=d*f,e[4]=(u*r-n*l)*f,e[5]=(-a*r+n*s)*f,e[6]=p*f,e[7]=(-c*r+i*l)*f,e[8]=(o*r-i*s)*f,e):null}function c(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return e[0]=o*u-a*c,e[1]=n*c-i*u,e[2]=i*a-n*o,e[3]=a*l-s*u,e[4]=r*u-n*l,e[5]=n*s-r*a,e[6]=s*c-o*l,e[7]=i*l-r*c,e[8]=r*o-i*s,e}function u(e,t,r){const i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=r[0],p=r[1],f=r[2],m=r[3],g=r[4],y=r[5],_=r[6],v=r[7],b=r[8];return e[0]=d*i+p*o+f*c,e[1]=d*n+p*a+f*u,e[2]=d*s+p*l+f*h,e[3]=m*i+g*o+y*c,e[4]=m*n+g*a+y*u,e[5]=m*s+g*l+y*h,e[6]=_*i+v*o+b*c,e[7]=_*n+v*a+b*u,e[8]=_*s+v*l+b*h,e}function h(e,t,r){const i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=r[0],p=r[1];return e[0]=i,e[1]=n,e[2]=s,e[3]=o,e[4]=a,e[5]=l,e[6]=d*i+p*o+c,e[7]=d*n+p*a+u,e[8]=d*s+p*l+h,e}function d(e,t,r){const i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=Math.sin(r),p=Math.cos(r);return e[0]=p*i+d*o,e[1]=p*n+d*a,e[2]=p*s+d*l,e[3]=p*o-d*i,e[4]=p*a-d*n,e[5]=p*l-d*s,e[6]=c,e[7]=u,e[8]=h,e}function p(e,t,r){const i=r[0],n=r[1],s=r[2];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=s*t[6],e[7]=s*t[7],e[8]=s*t[8],e}function f(e,t,r){const i=r[0],n=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e}function m(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function g(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],o=r+r,a=i+i,l=n+n,c=r*o,u=i*o,h=i*a,d=n*o,p=n*a,f=n*l,m=s*o,g=s*a,y=s*l;return e[0]=1-h-f,e[3]=u-y,e[6]=d+g,e[1]=u+y,e[4]=1-c-f,e[7]=p-m,e[2]=d-g,e[5]=p+m,e[8]=1-c-h,e}function y(e,t){const r=t[0],i=t[1],n=t[2],s=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10],h=u*o-a*c,d=-u*s+a*l,p=c*s-o*l,f=r*h+i*d+n*p;if(!f)return null;const m=1/f;return e[0]=h*m,e[1]=(-u*i+n*c)*m,e[2]=(a*i-n*o)*m,e[3]=d*m,e[4]=(u*r-n*l)*m,e[5]=(-a*r+n*s)*m,e[6]=p*m,e[7]=(-c*r+i*l)*m,e[8]=(o*r-i*s)*m,e}function _(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],y=t[15],_=r*a-i*o,v=r*l-n*o,b=r*c-s*o,x=i*l-n*a,S=i*c-s*a,w=n*c-s*l,T=u*m-h*f,A=u*g-d*f,C=u*y-p*f,E=h*g-d*m,M=h*y-p*m,R=d*y-p*g;let P=_*R-v*M+b*E+x*C-S*A+w*T;return P?(P=1/P,e[0]=(a*R-l*M+c*E)*P,e[1]=(l*C-o*R-c*A)*P,e[2]=(o*M-a*C+c*T)*P,e[3]=(n*M-i*R-s*E)*P,e[4]=(r*R-n*C+s*A)*P,e[5]=(i*C-r*M-s*T)*P,e[6]=(m*w-g*S+y*x)*P,e[7]=(g*b-f*w-y*v)*P,e[8]=(f*S-m*b+y*_)*P,e):null}function v(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}const b=u,x=v;Object.freeze(Object.defineProperty({__proto__:null,add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e},adjoint:c,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},determinant:function(e){const t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*(c*s-o*l)+r*(-c*n+o*a)+i*(l*n-s*a)},equals:function(e,t){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=t[0],p=t[1],f=t[2],m=t[3],g=t[4],y=t[5],_=t[6],v=t[7],b=t[8],x=(0,i.FD)();return Math.abs(r-d)<=x*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(n-p)<=x*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(s-f)<=x*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(o-m)<=x*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(a-g)<=x*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(l-y)<=x*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(c-_)<=x*Math.max(1,Math.abs(c),Math.abs(_))&&Math.abs(u-v)<=x*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(h-b)<=x*Math.max(1,Math.abs(h),Math.abs(b))},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)},fromMat2d:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},fromMat4:n,fromQuat:g,fromRotation:function(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=-r,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromTranslation:m,identity:o,invert:l,isOrthoNormal:function(e){const t=(0,i.FD)(),r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8];return Math.abs(1-(r*r+o*o+c*c))<=t&&Math.abs(1-(n*n+a*a+u*u))<=t&&Math.abs(1-(s*s+l*l+h*h))<=t},mul:b,multiply:u,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e},multiplyScalarAndAdd:function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e},normalFromMat4:_,normalFromMat4Legacy:y,projection:function(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},rotate:d,scale:p,scaleByVec2:f,set:s,str:function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},sub:x,subtract:v,translate:h,transpose:a},Symbol.toStringTag,{value:"Module"}))},32237:function(e,t,r){r.d(t,{A6:function(){return g},B8:function(){return p},Xd:function(){return u},Xr:function(){return f},Yc:function(){return O},hZ:function(){return _},lw:function(){return h},t2:function(){return R},x8:function(){return c}});var i=r(87725),n=r(61769),s=r(32501),o=r(8527),a=r(20551),l=r(33400);function c(e,t,r){r*=.5;const i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function u(e,t){const r=2*Math.acos(t[3]),i=Math.sin(r/2);return i>(0,o.FD)()?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r}function h(e,t,r){const i=t[0],n=t[1],s=t[2],o=t[3],a=r[0],l=r[1],c=r[2],u=r[3];return e[0]=i*u+o*a+n*c-s*l,e[1]=n*u+o*l+s*a-i*c,e[2]=s*u+o*c+i*l-n*a,e[3]=o*u-i*a-n*l-s*c,e}function d(e,t,r,i){const n=t[0],s=t[1],a=t[2],l=t[3];let c,u,h,d,p,f=r[0],m=r[1],g=r[2],y=r[3];return u=n*f+s*m+a*g+l*y,u<0&&(u=-u,f=-f,m=-m,g=-g,y=-y),1-u>(0,o.FD)()?(c=Math.acos(u),h=Math.sin(c),d=Math.sin((1-i)*c)/h,p=Math.sin(i*c)/h):(d=1-i,p=i),e[0]=d*n+p*f,e[1]=d*s+p*m,e[2]=d*a+p*g,e[3]=d*l+p*y,e}function p(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],o=r*r+i*i+n*n+s*s,a=o?1/o:0;return e[0]=-r*a,e[1]=-i*a,e[2]=-n*a,e[3]=s*a,e}function f(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function m(e,t){const r=t[0]+t[4]+t[8];let i;if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);const n=(r+1)%3,s=(r+2)%3;i=Math.sqrt(t[3*r+r]-t[3*n+n]-t[3*s+s]+1),e[r]=.5*i,i=.5/i,e[3]=(t[3*n+s]-t[3*s+n])*i,e[n]=(t[3*n+r]+t[3*r+n])*i,e[s]=(t[3*s+r]+t[3*r+s])*i}return e}function g(e,t,r,i){const n=.5*Math.PI/180;t*=n,r*=n,i*=n;const s=Math.sin(t),o=Math.cos(t),a=Math.sin(r),l=Math.cos(r),c=Math.sin(i),u=Math.cos(i);return e[0]=s*l*u-o*a*c,e[1]=o*a*u+s*l*c,e[2]=o*l*c-s*a*u,e[3]=o*l*u+s*a*c,e}const y=l.c,_=l.s,v=l.f,b=h,x=l.b,S=l.g,w=l.l,T=l.i,A=T,C=l.j,E=C,M=l.n,R=l.a,P=l.e;function O(e,t,r){const i=(0,a.m)(t,r);return i<-.999999?((0,a.b)(I,L,t),(0,a.H)(I)<1e-6&&(0,a.b)(I,N,t),(0,a.n)(I,I),c(e,I,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):((0,a.b)(I,t,r),e[0]=I[0],e[1]=I[1],e[2]=I[2],e[3]=1+i,M(e,e))}const I=(0,s.vt)(),L=(0,s.fA)(1,0,0),N=(0,s.fA)(0,1,0),D=(0,n.vt)(),F=(0,n.vt)(),z=(0,i.vt)();Object.freeze(Object.defineProperty({__proto__:null,add:v,calculateW:function(e,t){const r=t[0],i=t[1],n=t[2];return e[0]=r,e[1]=i,e[2]=n,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),e},conjugate:f,copy:y,dot:S,equals:P,exactEquals:R,fromEuler:g,fromMat3:m,getAxisAngle:u,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},invert:p,len:A,length:T,lerp:w,mul:b,multiply:h,normalize:M,random:function(e){const t=o.Ov,r=t(),i=t(),n=t(),s=Math.sqrt(1-r),a=Math.sqrt(r);return e[0]=s*Math.sin(2*Math.PI*i),e[1]=s*Math.cos(2*Math.PI*i),e[2]=a*Math.sin(2*Math.PI*n),e[3]=a*Math.cos(2*Math.PI*n),e},rotateX:function(e,t,r){r*=.5;const i=t[0],n=t[1],s=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+o*a,e[1]=n*l+s*a,e[2]=s*l-n*a,e[3]=o*l-i*a,e},rotateY:function(e,t,r){r*=.5;const i=t[0],n=t[1],s=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l-s*a,e[1]=n*l+o*a,e[2]=s*l+i*a,e[3]=o*l-n*a,e},rotateZ:function(e,t,r){r*=.5;const i=t[0],n=t[1],s=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+n*a,e[1]=n*l-i*a,e[2]=s*l+o*a,e[3]=o*l-s*a,e},rotationTo:O,scale:x,set:_,setAxes:function(e,t,r,i){const n=z;return n[0]=r[0],n[3]=r[1],n[6]=r[2],n[1]=i[0],n[4]=i[1],n[7]=i[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],M(e,m(e,n))},setAxisAngle:c,slerp:d,sqlerp:function(e,t,r,i,n,s){return d(D,t,n,s),d(F,r,i,s),d(e,D,F,2*s*(1-s)),e},sqrLen:E,squaredLength:C,str:function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}},Symbol.toStringTag,{value:"Module"}))},50612:function(e,t,r){r.d(t,{w:function(){return o}});var i=r(50659),n=(r(58941),r(7187)),s=r(88923);class o{constructor(e=9,t){this._compareMinX=h,this._compareMinY=d,this._toBBox=e=>e,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this._toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),b.prune(),x.prune(),S.prune(),w.prune()}all(e){a(this._data,e)}search(e,t){let r=this._data;const i=this._toBBox;if(_(e,r))for(b.clear();r;){for(let n=0,s=r.children.length;n<s;n++){const s=r.children[n],o=r.leaf?i(s):s;_(e,o)&&(r.leaf?t(s):y(e,o)?a(s,t):b.push(s))}r=b.pop()}}collides(e){let t=this._data;const r=this._toBBox;if(!_(e,t))return!1;for(b.clear();t;){for(let i=0,n=t.children.length;i<n;i++){const n=t.children[i],s=t.leaf?r(n):n;if(_(e,s)){if(t.leaf||y(e,s))return!0;b.push(n)}}t=b.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}let t=this._build(e.slice(0,e.length),0,e.length-1,0);if(this._data.children.length)if(this._data.height===t.height)this._splitRoot(this._data,t);else{if(this._data.height<t.height){const e=this._data;this._data=t,t=e}this._insert(t,this._data.height-t.height-1,!0)}else this._data=t;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new C([]),this}remove(e){if(!e)return this;let t,r=this._data,n=null,s=0,o=!1;const a=this._toBBox(e);for(S.clear(),w.clear();r||S.length>0;){if(r||(r=S.pop(),n=S.data[S.length-1],s=w.pop()??0,o=!0),r.leaf&&(t=(0,i.qh)(r.children,e,r.children.length,r.indexHint),-1!==t))return r.children.splice(t,1),S.push(r),this._condense(S),this;o||r.leaf||!y(r,a)?n?(s++,r=n.children[s],o=!1):r=null:(S.push(r),w.push(s),s=0,n=r,r=r.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_build(e,t,r,i){const n=r-t+1;let s=this._maxEntries;if(n<=s){const i=new C(e.slice(t,r+1));return l(i,this._toBBox),i}i||(i=Math.ceil(Math.log(n)/Math.log(s)),s=Math.ceil(n/s**(i-1)));const o=new E([]);o.height=i;const a=Math.ceil(n/s),c=a*Math.ceil(Math.sqrt(s));v(e,t,r,c,this._compareMinX);for(let n=t;n<=r;n+=c){const t=Math.min(n+c-1,r);v(e,n,t,a,this._compareMinY);for(let r=n;r<=t;r+=a){const n=Math.min(r+a-1,t);o.children.push(this._build(e,r,n,i-1))}}return l(o,this._toBBox),o}_insert(e,t,r){const i=this._toBBox,n=r?e:i(e);S.clear();const s=function(e,t,r,i){for(;i.push(t),!0!==t.leaf&&i.length-1!==r;){let r,i=1/0,n=1/0;for(let s=0,o=t.children.length;s<o;s++){const o=t.children[s],a=p(o),l=m(e,o)-a;l<n?(n=l,i=a<i?a:i,r=o):l===n&&a<i&&(i=a,r=o)}t=r||t.children[0]}return t}(n,this._data,t,S);for(s.children.push(e),u(s,n);t>=0&&S.data[t].children.length>this._maxEntries;)this._split(S,t),t--;!function(e,t,r){for(let i=r;i>=0;i--)u(t.data[i],e)}(n,S,t)}_split(e,t){const r=e.data[t],i=r.children.length,n=this._minEntries;this._chooseSplitAxis(r,n,i);const s=this._chooseSplitIndex(r,n,i);if(!s)return;const o=r.children.splice(s,r.children.length-s),a=r.leaf?new C(o):new E(o);a.height=r.height,l(r,this._toBBox),l(a,this._toBBox),t?e.data[t-1].children.push(a):this._splitRoot(r,a)}_splitRoot(e,t){this._data=new E([e,t]),this._data.height=e.height+1,l(this._data,this._toBBox)}_chooseSplitIndex(e,t,r){let i,n,s;i=n=1/0;for(let o=t;o<=r-t;o++){const t=c(e,0,o,this._toBBox),a=c(e,o,r,this._toBBox),l=g(t,a),u=p(t)+p(a);l<i?(i=l,s=o,n=u<n?u:n):l===i&&u<n&&(n=u,s=o)}return s}_chooseSplitAxis(e,t,r){const i=e.leaf?this._compareMinX:h,n=e.leaf?this._compareMinY:d;this._allDistMargin(e,t,r,i)<this._allDistMargin(e,t,r,n)&&e.children.sort(i)}_allDistMargin(e,t,r,i){e.children.sort(i);const n=this._toBBox,s=c(e,0,t,n),o=c(e,r-t,r,n);let a=f(s)+f(o);for(let i=t;i<r-t;i++){const t=e.children[i];u(s,e.leaf?n(t):t),a+=f(s)}for(let i=r-t-1;i>=t;i--){const t=e.children[i];u(o,e.leaf?n(t):t),a+=f(o)}return a}_condense(e){for(let t=e.length-1;t>=0;t--){const r=e.data[t];if(0===r.children.length)if(t>0){const n=e.data[t-1],s=n.children;s.splice((0,i.qh)(s,r,s.length,n.indexHint),1)}else this.clear();else l(r,this._toBBox)}}_initFormat(e){const t=["return a"," - b",";"];this._compareMinX=new Function("a","b",t.join(e[0])),this._compareMinY=new Function("a","b",t.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}function a(e,t){let r=e;for(x.clear();r;){if(!0===r.leaf)for(const e of r.children)t(e);else x.pushArray(r.children);r=x.pop()??null}}function l(e,t){c(e,0,e.children.length,t,e)}function c(e,t,r,i,n){n||(n=new C([])),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let s,o=t;o<r;o++)s=e.children[o],u(n,e.leaf?i(s):s);return n}function u(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function h(e,t){return e.minX-t.minX}function d(e,t){return e.minY-t.minY}function p(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function f(e){return e.maxX-e.minX+(e.maxY-e.minY)}function m(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function g(e,t){const r=Math.max(e.minX,t.minX),i=Math.max(e.minY,t.minY),n=Math.min(e.maxX,t.maxX),s=Math.min(e.maxY,t.maxY);return Math.max(0,n-r)*Math.max(0,s-i)}function y(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function _(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function v(e,t,r,i,n){const o=[t,r];for(;o.length;){const t=o.pop(),r=o.pop();if(t-r<=i)continue;const a=r+Math.ceil((t-r)/i/2)*i;(0,s.q)(e,a,r,t,n),o.push(r,a,a,t)}}const b=new n.A,x=new n.A,S=new n.A,w=new n.A({deallocator:void 0});class T{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class A extends T{constructor(){super(...arguments),this.height=1,this.indexHint=new i.vW}}class C extends A{constructor(e){super(),this.children=e,this.leaf=!0}}class E extends A{constructor(e){super(),this.children=e,this.leaf=!1}}},75218:function(e,t,r){r.d(t,{L:function(){return a},g:function(){return o}});var i=r(77472),n=r(78879),s=r(31609);async function o(e,t){return await e.load(),a(e,t)}async function a(e,t){const r=[],o=(...e)=>{for(const t of e)null!=t&&(Array.isArray(t)?o(...t):n.A.isCollection(t)?t.forEach((e=>o(e))):s.A.isLoadable(t)&&r.push(t))};t(o);let a=null;if(await(0,i.Tj)(r,(async e=>{const t=await(0,i.Ke)(function(e){return"loadAll"in e&&"function"==typeof e.loadAll}(e)?e.loadAll():e.load());!1!==t.ok||a||(a=t)})),a)throw a.error;return e}},92955:function(e,t,r){r.d(t,{GB:function(){return n},Qo:function(){return o},Y4:function(){return s}});var i=r(3569);class n{}function s(e){return e instanceof i.bo?e===n.instance:"unknown"===e?.toString().toLowerCase()}function o(e){return s(e)?n.instance:e}n.instance=new i.oh("Etc/UTC")},33134:function(e,t,r){r.d(t,{z:function(){return a}});var i=r(21609),n=r(49077),s=r(74697),o=r(76613);class a{static fromOptimized(e,t,r=!1,i=!1,n=1){return(new l).initialize(e,t,r,i,n)}static fromJSON(e,t=!1,r=!1){const[i,n]=u(e);return(new h).initialize(i,n,t,r,1)}static fromOptimizedCIM(e,t,r=!1,i=!1,n=1){return(new d).initialize(e,t,r,i,n)}static fromJSONCIM(e,t=!1,r=!1,i=1){const[n,s]=u(e);return(new p).initialize(n,s,t,r,i)}static fromFeatureSetReader(e){const t=e.readGeometryForDisplay(),r=e.geometryType;return t&&r?this.fromOptimized(t,r):null}static fromFeatureSetReaderCIM(e){const t=e.readGeometryForDisplay(),r=e.geometryType;return t&&r?this.fromOptimizedCIM(t,r):null}static createEmptyOptimized(e,t=!1,r=!1,i=1){return(new l).initialize(new o.A,e,t,r,i)}static createEmptyJSON(e,t=!1,r=!1){return(new h).initialize([],e,t,r,1)}static createEmptyOptimizedCIM(e,t=!1,r=!1,i=1){return(new d).initialize(new o.A,e,t,r,i)}static createEmptyJSONCIM(e,t=!1,r=!1,i=1){return(new p).initialize([],e,t,r,i)}asJSON(){const e=(0,n.x)(this);return"esriGeometryEnvelope"===this.geometryType?{xmin:e[0][0][0],ymin:e[0][0][1],xmax:e[0][2][0],ymax:e[0][2][1]}:"esriGeometryMultipoint"===this.geometryType?{points:e.flat()}:"esriGeometryPoint"===this.geometryType?{x:e[0][0][0],y:e[0][0][1]}:"esriGeometryPolygon"===this.geometryType?{rings:e}:{paths:e}}getCurrentRingArea(){if(this.pathSize<3)return 0;let e,t,r=0;if(this.seekPathStart(),!this.nextPoint())return 0;e=this.x,t=this.y;const i=e,n=t;for(;this.nextPoint();)r+=(e-this.x)*(t+this.y),e=this.x,t=this.y;return r+=(e-i)*(t+n),-.5*r}invertY(){this.yFactor*=-1}}class l extends a{constructor(){super(...arguments),this._end=-1}initialize(e,t,r,i,n){return this.hasZ=r,this.hasM=i,this.geometryType=t,this._stride=2+Number(r)+Number(i),this._geometry=e,this._pathIndex=-1,this._pathOffset=0,this._pointOffset=-this._stride,this._end=-1,this.yFactor=n,this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(e){if(e>=0&&e<this.totalSize){if(this._pathIndex<e)for(;this._pathIndex<e&&this.nextPath(););else if(this._pathIndex>e)for(;this._pathIndex>e&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(e){const t=this._pathOffset+e*this._stride;return t>=0&&t<this._end&&(this._pointOffset=t,!0)}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){return!(this.pathIndex>=this.totalSize-1||(this._pathIndex>=0&&(this._pathOffset+=this._stride*this.pathSize),this._pathIndex++,this._pointOffset=this._pathOffset-this._stride,this._end=this._pointOffset+this._stride+this._stride*this.pathSize,0))}prevPath(){return!(this.pathIndex<=0||(this._pathIndex--,this._end=this._pathOffset,this._pathOffset-=this._stride*this.pathSize,this._pointOffset=this._pathOffset-this._stride,0))}pathLength(){const e=this._end,t=this._stride,r=this._geometry.coords;let i=0;for(let n=this._pathOffset+t;n<e;n+=t){const e=r[n-t],s=r[n-t+1],o=r[n]-e,a=r[n+1]-s;i+=Math.sqrt(o*o+a*a)}return i}startPath(){this._geometry.lengths.push(0)}pushPath(e){this.startPath(),this.pushPoints(e)}pushPoint(e){for(let t=0;t<this._stride;++t)this._geometry.coords.push(e[t]);this._geometry.lengths[this.totalSize-1]++}pushXY(e,t){this._geometry.coords.push(e,t),this._geometry.lengths[this.totalSize-1]++}pushPoints(e){for(const t of e)for(let e=0;e<this._stride;++e)this._geometry.coords.push(t[e]);this._geometry.lengths[this.totalSize-1]+=e.length}pushCursor(e){const t=e.asOptimized();this._geometry.coords.push(...t.coords),this._geometry.lengths.push(...t.lengths)}asOptimized(){const e=this._geometry.clone();if(1!==this.yFactor)for(let t=1;t<e.coords.length;t+=this._stride)e.coords[t]*=this.yFactor;return"esriGeometryPoint"===this.geometryType&&(e.lengths.length=0),e}isClosed(){const e=this._geometry.coords,t=this._pathOffset,r=this._end-this._stride;for(let i=0;i<this._stride;i++)if(e[t+i]!==e[r+i])return!1;return!0}clone(){return(new l).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce(((e,t)=>e+t))}get pathSize(){const{lengths:e}=this._geometry;return this._geometry.isPoint?1:this._pathIndex<0||this._pathIndex>e.length-1?0:e[this._pathIndex]}get totalSize(){return this._geometry.isPoint?1:this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(e){this._geometry.coords[this._pointOffset]=e}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(e){this._geometry.coords[this._pointOffset+1]=this.yFactor*e}get z(){return this._geometry.coords[this._pointOffset+2]}set z(e){this._geometry.coords[this._pointOffset+2]=e}get m(){const e=this.hasZ?3:2;return this._geometry.coords[this._pointOffset+e]}set m(e){this._geometry.coords[this._pointOffset+3]=e}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}}function c(e){const t=[e.x,e.y];return e.z&&t.push(e.z),e.m&&t.push(e.m),t}function u(e){return(0,s.Bi)(e)?[e.rings,"esriGeometryPolygon"]:(0,s.Rg)(e)?[e.paths,"esriGeometryPolyline"]:(0,s.U9)(e)?[[e.points],"esriGeometryMultipoint"]:(0,s.ZC)(e)?[[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]],"esriGeometryEnvelope"]:(0,s.fT)(e)?[[[c(e)]],"esriGeometryPoint"]:[[],"esriGeometryPolyline"]}class h extends a{initialize(e,t,r,i,n){return this._paths=e,this.geometryType=t,this.hasZ=r,this.hasM=i,this._pathIndex=this._pointIndex=-1,this.yFactor=n,this._mIndex=this.hasZ?3:2,this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(e){return this._pathIndex=e,this._pointIndex=-1,e>=0&&e<this.totalSize&&(this._currentPath=this._paths[e],!0)}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(e){return e>=0&&e<this._currentPath.length&&(this._pointIndex=e,this._currentPoint=this._currentPath[this._pointIndex],!0)}nextPoint(){return this._currentPoint=this._currentPath[++this._pointIndex],this._pointIndex<this._currentPath.length}prevPoint(){return this._currentPoint=this._currentPath[--this._pointIndex],this._pointIndex>=0}nextPath(){return this._pointIndex=-1,this._currentPath=this._paths[++this._pathIndex],this._pathIndex<this.totalSize}prevPath(){return this.pathIndex>0&&(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0)}pathLength(){const e=this._currentPath.length,t=this._currentPath;let r=0;for(let i=1;i<e;i++){const e=t[i-1],n=t[i],s=e[0],o=e[1],a=n[0]-s,l=n[1]-o;r+=Math.sqrt(a*a+l*l)}return r}startPath(){this._paths.push([])}pushPath(e){this._paths.push(e)}pushPoint(e){this._paths[this.totalSize-1].push(e)}pushXY(e,t){this._paths[this.totalSize-1].push([e,t])}pushPoints(e){this._paths[this.totalSize-1].push(...e)}pushCursor(e){const t=(0,n.x)(e);for(const e of t)this.pushPath(e)}asOptimized(){const e=new o.A;if("esriGeometryPoint"===this.geometryType)e.coords.push(...this._paths[0][0]),e.lengths.length=0;else for(const t of this._paths){for(const r of t)e.coords.push(r[0]),e.coords.push(r[1]*this.yFactor),this.hasZ&&e.coords.push(r[2]),this.hasM&&e.coords.push(r[this._mIndex]);e.lengths.push(t.length)}return e}isClosed(){const e=this._currentPath[0],t=this._currentPath[this._currentPath.length-1];for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}clone(){return(new h).initialize((0,i.o8)(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map((e=>e.length)).reduce(((e,t)=>e+t))}get pathSize(){return this._pathIndex<0||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(e){this._currentPoint[0]=e}get y(){return this.yFactor*this._currentPoint[1]}set y(e){this._currentPoint[1]=this.yFactor*e}get z(){return this._currentPoint[2]}set z(e){this._currentPoint[2]=e}get m(){return this._currentPoint[this._mIndex]}set m(e){this._currentPoint[this._mIndex]=e}get pathIndex(){return this._pathIndex}}class d extends l{initialize(e,t,r,i,n){return super.initialize(e,t,r,i,n),this._controlPoints||(this._controlPoints=this._controlPoints=new Array(this.totalSize).fill(void 0).map((e=>new Set))),this}startPath(){super.startPath(),this._controlPoints.push(new Set)}clone(){const e=(new d).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);return e._controlPoints=this._controlPoints,e}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(e){this._controlPoints[this.pathIndex].add(e)}getControlPointAt(e){return this._controlPoints[this.pathIndex].has(e)}}class p extends h{initialize(e,t,r,i,n){return super.initialize(e,t,r,i,n)}clone(){return(new p).initialize((0,i.o8)(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][4]=1}getControlPoint(){return 1===this._paths[this.pathIndex][this._pointIndex][4]}setControlPointAt(e){this._paths[this.pathIndex][e][4]=1}getControlPointAt(e){return 1===this._paths[this.pathIndex][e][4]}}},22902:function(e,t,r){r.d(t,{A:function(){return v}});var i,n=r(53804),s=r(50659),o=r(73037),a=r(30905),l=r(62938),c=r(89001),u=r(23502),h=(r(58941),r(40633),r(47332)),d=r(65953),p=r(81392);const f=(0,o.O)()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),m=f.jsonValues.slice();(0,s.Xy)(m,"orthometric");const g=(0,o.O)()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let y=i=class extends a.oY{constructor(e){super(e),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(e,t,r){return f.write(e,t,r)}readHeightModel(e,t,r){return f.read(e)||(r?.messages&&r.messages.push(function(e,t){return new c.A("height-model:unsupported",`Height model of value '${e}' is not supported`,t)}(e,{context:r})),null)}readHeightUnit(e,t,r){return g.read(e)||(r?.messages&&r.messages.push(_(e,{context:r})),null)}readHeightUnitService(e,t,r){return(0,l.LA)(e)||g.read(e)||(r?.messages&&r.messages.push(_(e,{context:r})),null)}readVertCRS(e,t){return t.vertCRS||t.ellipsoid||t.geoid}clone(){return new i({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(e){return!!e&&(this===e||this.heightModel===e.heightModel&&this.heightUnit===e.heightUnit&&this.vertCRS===e.vertCRS)}static deriveUnitFromSR(e,t){const r=(0,l.k1)(t);return new i({heightModel:e.heightModel,heightUnit:r??void 0,vertCRS:e.vertCRS})}write(e,t){return t={origin:"web-scene",...t},super.write(e,t)}static fromJSON(e){if(!e)return null;const t=new i;return t.read(e,{origin:"web-scene"}),t}};function _(e,t){return new c.A("height-unit:unsupported",`Height unit of value '${e}' is not supported`,t)}(0,n._)([(0,u.MZ)({type:f.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:m,default:"ellipsoidal"}}}})],y.prototype,"heightModel",void 0),(0,n._)([(0,p.K)("web-scene","heightModel")],y.prototype,"writeHeightModel",null),(0,n._)([(0,h.w)(["web-scene","service"],"heightModel")],y.prototype,"readHeightModel",null),(0,n._)([(0,u.MZ)({type:g.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:g.jsonValues,write:g.write}}}})],y.prototype,"heightUnit",void 0),(0,n._)([(0,h.w)("web-scene","heightUnit")],y.prototype,"readHeightUnit",null),(0,n._)([(0,h.w)("service","heightUnit")],y.prototype,"readHeightUnitService",null),(0,n._)([(0,u.MZ)({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],y.prototype,"vertCRS",void 0),(0,n._)([(0,h.w)("service","vertCRS",["vertCRS","ellipsoid","geoid"])],y.prototype,"readVertCRS",null),y=i=(0,n._)([(0,d.$)("esri.geometry.HeightModelInfo")],y);const v=y},7456:function(e,t,r){r.d(t,{l:function(){return c}});var i=r(15774),n=r(73364),s=r(32501),o=r(46098),a=r(61441),l=r(57652);function c(e,t,r,i){if(null==e||null==i)return!1;const s=(0,a.Qk)(e,a.Wv),c=(0,a.Qk)(i,a.zp);if(s===c&&!u(c)&&(s!==a.rz.UNKNOWN||(0,l.aI)(e,i)))return(0,n.kN)(r,t),!0;if(u(c)){const e=a.w5[s][a.rz.LON_LAT],i=a.w5[a.rz.LON_LAT][c];return null!=e&&null!=i&&(e(t,0,d,0),i(d,0,p,0),(0,o.y)(h*d[0],h*d[1],r),r[12]=p[0],r[13]=p[1],r[14]=p[2],!0)}if(!(c!==a.rz.WEB_MERCATOR&&c!==a.rz.PLATE_CARREE&&c!==a.rz.WGS84&&c!==a.rz.CGCS2000||s!==a.rz.WGS84&&s!==a.rz.SPHERICAL_ECEF&&s!==a.rz.WEB_MERCATOR&&s!==a.rz.CGCS2000)){const e=a.w5[s][a.rz.LON_LAT],i=a.w5[a.rz.LON_LAT][c];return null!=e&&null!=i&&(e(t,0,d,0),i(d,0,p,0),s===a.rz.SPHERICAL_ECEF?(0,o.C)(h*d[0],h*d[1],r):(0,n.D_)(r),r[12]=p[0],r[13]=p[1],r[14]=p[2],!0)}return!1}function u(e){return e===a.rz.SPHERICAL_ECEF||e===a.rz.SPHERICAL_MARS_PCPF||e===a.rz.SPHERICAL_MOON_PCPF}const h=(0,i.kU)(1),d=(0,s.vt)(),p=(0,s.vt)()},46098:function(e,t,r){r.d(t,{C:function(){return s},y:function(){return n}});var i=r(73364);function n(e,t,r){const i=Math.sin(e),n=Math.cos(e),s=Math.sin(t),o=Math.cos(t),a=r;return a[0]=-i,a[4]=-s*n,a[8]=o*n,a[12]=0,a[1]=n,a[5]=-s*i,a[9]=o*i,a[13]=0,a[2]=0,a[6]=o,a[10]=s,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function s(e,t,r){return n(e,t,r),(0,i.mg)(r,r),r}},56919:function(e,t,r){r.d(t,{E:function(){return s}});var i=r(32501),n=(r(46157),r(68734));function s(e,t,r){return!!(0,n.F)(e,t,o,r.spatialReference)&&(r.x=o[0],r.y=o[1],r.z=o[2],!0)}const o=(0,i.vt)()},96611:function(e,t,r){r.d(t,{Y0:function(){return c},lO:function(){return u}});var i=r(61714),n=r(57165),s=r(57652);const o=new n.A(i.fv),a=new n.A(i.FY),l=new n.A(i.LJ),c=new n.A(i.Ro);function u(e){const t=h.get(e);if(t)return t;let r=o;if(e)if(e===a)r=a;else if(e===l)r=l;else{const t=e.wkid,i=e.latestWkid;if(null!=t||null!=i)(0,s.tl)(t)||(0,s.tl)(i)?r=a:((0,s.ZL)(t)||(0,s.ZL)(i))&&(r=l);else{const t=e.wkt2??e.wkt;if(t){const e=t.toUpperCase();e===d?r=a:e===p&&(r=l)}}}return h.set(e,r),r}const h=new Map,d=a.wkt.toUpperCase(),p=l.wkt.toUpperCase()},50240:function(e,t,r){r.d(t,{Ns:function(){return l},jh:function(){return n},l5:function(){return o},s:function(){return a},xm:function(){return s}});var i=r(24540);function n(e,t=!1){return e<=i.y9?t?new Array(e).fill(0):new Array(e):new Float64Array(e)}function s(e){return((0,i.cy)(e)?e.length:e.byteLength/8)<=i.y9?Array.from(e):new Float64Array(e)}function o(e,t,r){return Array.isArray(e)?e.slice(t,t+r):e.subarray(t,t+r)}function a(e,t){for(let r=0;r<t.length;++r)e[r]=t[r];return e}function l(e){return Array.isArray(e)?new Float64Array(e):e}},5047:function(e,t,r){r.d(t,{AK:function(){return o},Wz:function(){return s},oe:function(){return n}});var i=r(24540);function n(e,t=!1){return e<=i.y9?t?new Array(e).fill(0):new Array(e):new Float32Array(e)}function s(e){return((0,i.cy)(e)?e.length:e.byteLength/8)<=i.y9?Array.from(e):new Float32Array(e)}function o(e,t,r){return Array.isArray(e)?e.slice(t,t+r):e.subarray(t,t+r)}},37819:function(e,t,r){r.d(t,{Dg:function(){return n},EH:function(){return d},JH:function(){return o},my:function(){return s},tM:function(){return u}});var i=r(24540);function n(e){if((0,i.cy)(e)){if(e.length<i.y9)return e}else if(e.length<i.y9)return Array.from(e);let t=!0,r=!0;return e.some(((e,i)=>(t=t&&0===e,r=r&&e===i,!t&&!r))),t?d(e.length):r?u(e.length):(0,i.cy)(e)||e.BYTES_PER_ELEMENT!==Uint16Array.BYTES_PER_ELEMENT?function(e){let t=!0;for(const r of e){if(r>=65536)return(0,i.cy)(e)?new Uint32Array(e):e;r>=256&&(t=!1)}return t?new Uint8Array(e):new Uint16Array(e)}(e):e}function s(e){return e<=i.y9?new Array(e):e<=65536?new Uint16Array(e):new Uint32Array(e)}function o(e){return e<=i.y9?new Array(e):new Uint32Array(e)}let a=(()=>{const e=new Uint32Array(131072);for(let t=0;t<e.length;++t)e[t]=t;return e})();const l=[0],c=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function u(e){if(1===e)return l;if(e<i.y9)return Array.from(new Uint16Array(c.buffer,0,e));if(e<c.length)return new Uint16Array(c.buffer,0,e);if(e>a.length){const t=Math.max(2*a.length,e);a=new Uint32Array(t);for(let e=0;e<a.length;e++)a[e]=e}return new Uint32Array(a.buffer,0,e)}let h=new Uint8Array(65536);function d(e){if(1===e)return l;if(e<i.y9)return new Array(e).fill(0);if(e>h.length){const t=Math.max(2*h.length,e);h=new Uint8Array(t)}return new Uint8Array(h.buffer,0,e)}},54466:function(e,t,r){r.d(t,{A:function(){return g}});var i,n=r(53804),s=r(30905),o=r(21609),a=r(40633),l=r(23502),c=r(77560),u=r(65953),h=r(67888),d=r(94332),p=r(95123),f=r(7186);let m=i=class extends s.oY{static from(e){return(0,h.PZ)(i,e)}constructor(e){super(e),this.faces=null,this.material=null,this.name=void 0,this.shading="source",this.trustSourceNormals=!1}castFaces(e){return(0,f.b)(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},a.A.getLogger(this))}castMaterial(e){return(0,h.PZ)(e&&"object"==typeof e&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?p.A:d.A,e)}clone(){return new i({faces:(0,o.o8)(this.faces),shading:this.shading,material:(0,o.o8)(this.material),trustSourceNormals:this.trustSourceNormals,name:this.name})}cloneWithDeduplication(e,t){const r={faces:(0,o.o8)(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals,name:this.name};return new i(r)}get memoryUsage(){let e=0;return null!=this.faces&&(e+=this.faces.byteLength),null!=this.material&&(e+=this.material.memoryUsage),e}};(0,n._)([(0,l.MZ)({json:{write:!0}})],m.prototype,"faces",void 0),(0,n._)([(0,c.w)("faces")],m.prototype,"castFaces",null),(0,n._)([(0,l.MZ)({type:d.A,json:{write:!0}})],m.prototype,"material",void 0),(0,n._)([(0,c.w)("material")],m.prototype,"castMaterial",null),(0,n._)([(0,l.MZ)()],m.prototype,"name",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],m.prototype,"shading",void 0),(0,n._)([(0,l.MZ)({type:Boolean})],m.prototype,"trustSourceNormals",void 0),m=i=(0,n._)([(0,u.$)("esri.geometry.support.MeshComponent")],m);const g=m},65907:function(e,t,r){r.d(t,{A:function(){return u}});var i=r(53804),n=r(75743),s=r(30905),o=r(23502),a=(r(58941),r(40633),r(13798),r(74376)),l=r(65953);let c=class extends((0,n.O)(s.oY)){constructor(e){super(e),this.type="georeferenced",this.origin=null}};(0,i._)([(0,a.e)({georeferenced:"georeferenced"},{readOnly:!0})],c.prototype,"type",void 0),(0,i._)([(0,o.MZ)({type:[Number],nonNullable:!1,json:{write:!0}})],c.prototype,"origin",void 0),c=(0,i._)([(0,l.$)("esri.geometry.support.MeshGeoreferencedVertexSpace")],c);const u=c},20460:function(e,t,r){r.d(t,{A:function(){return h}});var i=r(53804),n=r(75743),s=r(30905),o=r(23502),a=(r(58941),r(40633),r(13798),r(74376)),l=r(65953),c=r(32501);let u=class extends((0,n.O)(s.oY)){constructor(e){super(e),this.type="local",this.origin=(0,c.vt)()}};(0,i._)([(0,a.e)({local:"local"},{readOnly:!0})],u.prototype,"type",void 0),(0,i._)([(0,o.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],u.prototype,"origin",void 0),u=(0,i._)([(0,l.$)("esri.geometry.support.MeshLocalVertexSpace")],u);const h=u},94332:function(e,t,r){r.d(t,{A:function(){return d}});var i,n=r(53804),s=r(52874),o=r(30905),a=r(23502),l=(r(58941),r(40633),r(13798),r(65953)),c=r(29646),u=r(16824);let h=i=class extends o.oY{constructor(e){super(e),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const r=null!=e?e.get(this):null;if(r)return r;const n=new i(this.clonePropertiesWithDeduplication(t));return null!=e&&e.set(this,n),n}clonePropertiesWithDeduplication(e){return{color:null!=this.color?this.color.clone():null,colorTexture:this.colorTexture?.cloneWithDeduplication(e),normalTexture:this.normalTexture?.cloneWithDeduplication(e),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:this.colorTextureTransform?.clone(),normalTextureTransform:this.normalTextureTransform?.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let e=0;return e+=null!=this.color?16:0,null!=this.colorTexture&&(e+=this.colorTexture.memoryUsage),e+=null!=this.colorTextureTransform?20:0,null!=this.normalTexture&&(e+=this.normalTexture.memoryUsage),e+=null!=this.normalTextureTransform?20:0,e}};(0,n._)([(0,a.MZ)({type:s.A,json:{write:!0}})],h.prototype,"color",void 0),(0,n._)([(0,a.MZ)({type:c.A,json:{write:!0}})],h.prototype,"colorTexture",void 0),(0,n._)([(0,a.MZ)({type:u.A,json:{write:!0}})],h.prototype,"colorTextureTransform",void 0),(0,n._)([(0,a.MZ)({type:c.A,json:{write:!0}})],h.prototype,"normalTexture",void 0),(0,n._)([(0,a.MZ)({type:u.A,json:{write:!0}})],h.prototype,"normalTextureTransform",void 0),(0,n._)([(0,a.MZ)({nonNullable:!0,json:{write:!0}})],h.prototype,"alphaMode",void 0),(0,n._)([(0,a.MZ)({nonNullable:!0,json:{write:!0}})],h.prototype,"alphaCutoff",void 0),(0,n._)([(0,a.MZ)({nonNullable:!0,json:{write:!0}})],h.prototype,"doubleSided",void 0),h=i=(0,n._)([(0,l.$)("esri.geometry.support.MeshMaterial")],h);const d=h},95123:function(e,t,r){r.d(t,{A:function(){return d}});var i,n=r(53804),s=r(52874),o=r(23502),a=(r(58941),r(40633),r(13798),r(65953)),l=r(94332),c=r(29646),u=r(16824);let h=i=class extends l.A{constructor(e){super(e),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const r=null!=e?e.get(this):null;if(r)return r;const n=new i(this.clonePropertiesWithDeduplication(t));return null!=e&&e.set(this,n),n}getMemoryUsage(){let e=super.getMemoryUsage();return e+=null!=this.emissiveColor?16:0,null!=this.emissiveTexture&&(e+=this.emissiveTexture.memoryUsage),e+=null!=this.emissiveTextureTransform?20:0,null!=this.occlusionTexture&&(e+=this.occlusionTexture.memoryUsage),e+=null!=this.occlusionTextureTransform?20:0,null!=this.metallicRoughnessTexture&&(e+=this.metallicRoughnessTexture.memoryUsage),e+=null!=this.metallicRoughnessTextureTransform?20:0,e}clonePropertiesWithDeduplication(e){return{...super.clonePropertiesWithDeduplication(e),emissiveColor:this.emissiveColor?.clone(),emissiveTexture:this.emissiveTexture?.cloneWithDeduplication(e),emissiveTextureTransform:this.emissiveTextureTransform?.clone(),occlusionTexture:this.occlusionTexture?.cloneWithDeduplication(e),occlusionTextureTransform:this.occlusionTextureTransform?.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:this.metallicRoughnessTexture?.cloneWithDeduplication(e),metallicRoughnessTextureTransform:this.metallicRoughnessTextureTransform?.clone()}}};(0,n._)([(0,o.MZ)({type:s.A,json:{write:!0}})],h.prototype,"emissiveColor",void 0),(0,n._)([(0,o.MZ)({type:c.A,json:{write:!0}})],h.prototype,"emissiveTexture",void 0),(0,n._)([(0,o.MZ)({type:u.A,json:{write:!0}})],h.prototype,"emissiveTextureTransform",void 0),(0,n._)([(0,o.MZ)({type:c.A,json:{write:!0}})],h.prototype,"occlusionTexture",void 0),(0,n._)([(0,o.MZ)({type:u.A,json:{write:!0}})],h.prototype,"occlusionTextureTransform",void 0),(0,n._)([(0,o.MZ)({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],h.prototype,"metallic",void 0),(0,n._)([(0,o.MZ)({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],h.prototype,"roughness",void 0),(0,n._)([(0,o.MZ)({type:c.A,json:{write:!0}})],h.prototype,"metallicRoughnessTexture",void 0),(0,n._)([(0,o.MZ)({type:u.A,json:{write:!0}})],h.prototype,"metallicRoughnessTextureTransform",void 0),h=i=(0,n._)([(0,a.$)("esri.geometry.support.MeshMaterialMetallicRoughness")],h);const d=h},29646:function(e,t,r){r.d(t,{A:function(){return v}});var i,n=r(53804),s=(r(58941),r(87847)),o=r(30905),a=r(23502),l=r(67888),c=(r(13798),r(47332)),u=r(65953),h=r(81392),d=r(60534);const p=new WeakMap;let f=0,m=i=class extends o.oY{constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,t,r,i){if(e instanceof HTMLImageElement){const n={type:"image-element",src:(0,d.t)(e.src,i),crossOrigin:e.crossOrigin};t[r]=n}else if(e instanceof HTMLCanvasElement){const i={type:"canvas-element",imageData:g(e.getContext("2d").getImageData(0,0,e.width,e.height))};t[r]=i}else if(e instanceof HTMLVideoElement){const n={type:"video-element",src:(0,d.t)(e.src,i),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[r]=n}else if(e instanceof ImageData){const i={type:"image-data",imageData:g(e)};t[r]=i}}readData(e){switch(e.type){case"image-element":{const t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t}case"canvas-element":{const t=y(e.imageData),r=document.createElement("canvas");return r.width=t.width,r.height=t.height,r.getContext("2d").putImageData(t,0,0),r}case"image-data":return y(e.imageData);case"video-element":{const t=document.createElement("video");return t.src=e.src,t.crossOrigin=e.crossOrigin,t.autoplay=e.autoplay,t.loop=e.loop,t.muted=e.muted,t.preload=e.preload,t}default:return}}get transparent(){const e=this.data,t=this.url;if(e instanceof HTMLCanvasElement)return _(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return _(e);if(t){const e=t.substr(t.length-4,4).toLowerCase(),r=t.substr(0,15).toLocaleLowerCase();if(".png"===e||"data:image/png;"===r)return!0}return!1}set transparent(e){this._overrideIfSome("transparent",e)}get contentHash(){const e="string"==typeof this.wrap?this.wrap:"object"==typeof this.wrap?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",t=(t="")=>`d:${t},t:${this.transparent},w:${e}`;return null!=this.url?t(this.url):null!=this.data?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?t(this.data.src):(p.has(this.data)||p.set(this.data,++f),t(p.get(this.data))):t()}get memoryUsage(){let e=0;if(e+=null!=this.url?this.url.length:0,null!=this.data){const t=this.data;"data"in t?e+=t.data.byteLength:t instanceof HTMLImageElement?e+=t.naturalWidth*t.naturalHeight*3:t instanceof HTMLCanvasElement&&(e+=t.width*t.height*3)}return e}clone(){const e={url:this.url,data:this.data,wrap:this._cloneWrap()};return new i(e)}cloneWithDeduplication(e){const t=e.get(this);if(t)return t;const r=this.clone();return e.set(this,r),r}_cloneWrap(){return"string"==typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}static from(e){return"string"==typeof e?new i({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new i({data:e}):(0,l.PZ)(i,e)}};function g(e){let t="";for(let r=0;r<e.data.length;r++)t+=String.fromCharCode(e.data[r]);return{data:btoa(t),width:e.width,height:e.height}}function y(e){const t=atob(e.data),r=new Uint8ClampedArray(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return(0,s.eV)(r,e.width,e.height)}function _(e){for(let t=3;t<e.data.length;t+=4)if(255!==e.data[t])return!0;return!1}(0,n._)([(0,a.MZ)({type:String,json:{write:d.w}})],m.prototype,"url",null),(0,n._)([(0,a.MZ)({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),(0,a.MZ)()],m.prototype,"data",null),(0,n._)([(0,h.K)("data")],m.prototype,"writeData",null),(0,n._)([(0,c.w)("data")],m.prototype,"readData",null),(0,n._)([(0,a.MZ)({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],m.prototype,"transparent",null),(0,n._)([(0,a.MZ)({json:{write:!0}})],m.prototype,"wrap",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],m.prototype,"contentHash",null),m=i=(0,n._)([(0,u.$)("esri.geometry.support.MeshTexture")],m);const v=m},16824:function(e,t,r){r.d(t,{A:function(){return c}});var i=r(53804),n=r(75743),s=r(30905),o=r(23502),a=(r(58941),r(40633),r(13798),r(65953));let l=class extends((0,n.O)(s.oY)){constructor(e){super(e),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};(0,i._)([(0,o.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],l.prototype,"offset",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,json:{write:!0}})],l.prototype,"rotation",void 0),(0,i._)([(0,o.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],l.prototype,"scale",void 0),l=(0,i._)([(0,a.$)("esri.geometry.support.MeshTextureTransform")],l);const c=l},7186:function(e,t,r){r.d(t,{H:function(){return h},b:function(){return p}});var i,n=r(53804),s=r(30905),o=r(21609),a=r(40633),l=r(23502),c=r(77560),u=r(65953);let h=i=class extends s.oY{constructor(e){super(e),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(e){return p(e,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},a.A.getLogger(this))}castPosition(e){return e&&e instanceof Float32Array&&a.A.getLogger(this).warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),p(e,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},a.A.getLogger(this))}castUv(e){return p(e,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},a.A.getLogger(this))}castNormal(e){return p(e,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},a.A.getLogger(this))}castTangent(e){return p(e,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},a.A.getLogger(this))}clone(){const e={position:(0,o.o8)(this.position),uv:(0,o.o8)(this.uv),normal:(0,o.o8)(this.normal),tangent:(0,o.o8)(this.tangent),color:(0,o.o8)(this.color)};return new i(e)}clonePositional(){const e={position:(0,o.o8)(this.position),normal:(0,o.o8)(this.normal),tangent:(0,o.o8)(this.tangent),uv:this.uv,color:this.color};return new i(e)}get memoryUsage(){let e=0;return e+=this.position.byteLength,null!=this.uv&&(e+=this.uv.byteLength),null!=this.normal&&(e+=this.normal.byteLength),null!=this.tangent&&(e+=this.tangent.byteLength),null!=this.color&&(e+=this.color.byteLength),e}};function d(e,t,r,i){const{loggerTag:n,stride:s}=t;return e.length%s!=0?(i.error(n,`Invalid array length, expected a multiple of ${s}`),new r([])):e}function p(e,t,r,i,n){if(!e)return e;if(e instanceof t)return d(e,i,t,n);for(const s of r)if(e instanceof s)return d(new t(e),i,t,n);if(Array.isArray(e))return d(new t(e),i,t,n);{const i=r.map((e=>`'${e.name}'`));return n.error(`Failed to set property, expected one of ${i}, but got ${e.constructor.name}`),new t([])}}function f(e,t,r){t[r]=function(e){const t=new Array(e.length);for(let r=0;r<e.length;r++)t[r]=e[r];return t}(e)}(0,n._)([(0,l.MZ)({json:{write:f}})],h.prototype,"color",void 0),(0,n._)([(0,c.w)("color")],h.prototype,"castColor",null),(0,n._)([(0,l.MZ)({nonNullable:!0,json:{write:f}})],h.prototype,"position",void 0),(0,n._)([(0,c.w)("position")],h.prototype,"castPosition",null),(0,n._)([(0,l.MZ)({json:{write:f}})],h.prototype,"uv",void 0),(0,n._)([(0,c.w)("uv")],h.prototype,"castUv",null),(0,n._)([(0,l.MZ)({json:{write:f}})],h.prototype,"normal",void 0),(0,n._)([(0,c.w)("normal")],h.prototype,"castNormal",null),(0,n._)([(0,l.MZ)({json:{write:f}})],h.prototype,"tangent",void 0),(0,n._)([(0,c.w)("tangent")],h.prototype,"castTangent",null),h=i=(0,n._)([(0,u.$)("esri.geometry.support.MeshVertexAttributes")],h)},72139:function(e,t,r){var i,n,s;r.d(t,{O3:function(){return l},Ox:function(){return c},bR:function(){return o},dC:function(){return i}}),(s=i||(i={}))[s.Unknown=0]="Unknown",s[s.Point=1]="Point",s[s.LineString=2]="LineString",s[s.Polygon=3]="Polygon";class o{constructor(e,t){this.x=e,this.y=t}clone(){return new o(this.x,this.y)}equals(e,t){return e===this.x&&t===this.y}isEqual(e){return e.x===this.x&&e.y===this.y}setCoords(e,t){return this.x=e,this.y=t,this}normalize(){const e=this.x,t=this.y,r=Math.sqrt(e*e+t*t);return this.x/=r,this.y/=r,this}rightPerpendicular(){const e=this.x;return this.x=this.y,this.y=-e,this}leftPerpendicular(){const e=this.x;return this.x=-this.y,this.y=e,this}move(e,t){return this.x+=e,this.y+=t,this}assign(e){return this.x=e.x,this.y=e.y,this}assignAdd(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}assignSub(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}rotate(e,t){const r=this.x,i=this.y;return this.x=r*e-i*t,this.y=r*t+i*e,this}scale(e){return this.x*=e,this.y*=e,this}length(){const e=this.x,t=this.y;return Math.sqrt(e*e+t*t)}sub(e){return this.x-=e.x,this.y-=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}static distance(e,t){const r=t.x-e.x,i=t.y-e.y;return Math.sqrt(r*r+i*i)}static add(e,t){return new o(e.x+t.x,e.y+t.y)}static sub(e,t){return new o(e.x-t.x,e.y-t.y)}}class a{constructor(e,t,r){this.ratio=e,this.x=t,this.y=r}}class l{constructor(e,t,r,i=8,n=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=i,this._pixelMargin=n,this._tileSize=512*i,this._dz=e,this._yPos=t,this._xPos=r}setPixelMargin(e){e!==this._pixelMargin&&(this._pixelMargin=e,this.setExtent(this._extent))}setExtent(e){this._extent=e,this._finalRatio=this._tileSize/e*(1<<this._dz);let t=this._pixelRatio*this._pixelMargin;t/=this._finalRatio;const r=e>>this._dz;t>r&&(t=r),this._margin=t,this._xmin=r*this._xPos-t,this._ymin=r*this._yPos-t,this._xmax=this._xmin+r+2*t,this._ymax=this._ymin+r+2*t}reset(e){this._type=e,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(e,t){this._pushLine(),this._prevIsIn=this._isIn(e,t),this._moveTo(e,t,this._prevIsIn),this._prevPt=new o(e,t),this._firstPt=new o(e,t),this._dist=0}lineTo(e,t){const r=this._isIn(e,t),i=new o(e,t),n=o.distance(this._prevPt,i);let s,l,c,u,h,d,p,f;if(r)this._prevIsIn?this._lineTo(e,t,!0):(s=this._prevPt,l=i,c=this._intersect(l,s),this._start=this._dist+n*(1-this._r),this._lineTo(c.x,c.y,!0),this._lineTo(l.x,l.y,!0));else if(this._prevIsIn)l=this._prevPt,s=i,c=this._intersect(l,s),this._lineTo(c.x,c.y,!0),this._lineTo(s.x,s.y,!1);else{const e=this._prevPt,t=i;if(e.x<=this._xmin&&t.x<=this._xmin||e.x>=this._xmax&&t.x>=this._xmax||e.y<=this._ymin&&t.y<=this._ymin||e.y>=this._ymax&&t.y>=this._ymax)this._lineTo(t.x,t.y,!1);else{const r=[];if((e.x<this._xmin&&t.x>this._xmin||e.x>this._xmin&&t.x<this._xmin)&&(u=(this._xmin-e.x)/(t.x-e.x),f=e.y+u*(t.y-e.y),f<=this._ymin?d=!1:f>=this._ymax?d=!0:r.push(new a(u,this._xmin,f))),(e.x<this._xmax&&t.x>this._xmax||e.x>this._xmax&&t.x<this._xmax)&&(u=(this._xmax-e.x)/(t.x-e.x),f=e.y+u*(t.y-e.y),f<=this._ymin?d=!1:f>=this._ymax?d=!0:r.push(new a(u,this._xmax,f))),(e.y<this._ymin&&t.y>this._ymin||e.y>this._ymin&&t.y<this._ymin)&&(u=(this._ymin-e.y)/(t.y-e.y),p=e.x+u*(t.x-e.x),p<=this._xmin?h=!1:p>=this._xmax?h=!0:r.push(new a(u,p,this._ymin))),(e.y<this._ymax&&t.y>this._ymax||e.y>this._ymax&&t.y<this._ymax)&&(u=(this._ymax-e.y)/(t.y-e.y),p=e.x+u*(t.x-e.x),p<=this._xmin?h=!1:p>=this._xmax?h=!0:r.push(new a(u,p,this._ymax))),0===r.length)h?d?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):d?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(r.length>1&&r[0].ratio>r[1].ratio)this._start=this._dist+n*r[1].ratio,this._lineTo(r[1].x,r[1].y,!0),this._lineTo(r[0].x,r[0].y,!0);else{this._start=this._dist+n*r[0].ratio;for(let e=0;e<r.length;e++)this._lineTo(r[e].x,r[e].y,!0)}this._lineTo(t.x,t.y,!1)}}this._dist+=n,this._prevIsIn=r,this._prevPt=i}close(){if(this._line.length>2){const e=this._firstPt,t=this._prevPt;e.x===t.x&&e.y===t.y||this.lineTo(e.x,e.y);const r=this._line;let i=r.length;for(;i>=4&&(r[0].x===r[1].x&&r[0].x===r[i-2].x||r[0].y===r[1].y&&r[0].y===r[i-2].y);)r.pop(),r[0].x=r[i-2].x,r[0].y=r[i-2].y,--i}}result(e=!0){return this._pushLine(),0===this._lines.length?null:(this._type===i.Polygon&&e&&u.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(this._type!==i.LineString)throw new Error("Only valid for lines");this._pushLine();const e=this._lines,t=e.length;if(0===t)return null;const r=[];for(let i=0;i<t;i++)r.push({line:e[i],start:this._starts[i]||0});return r}_isIn(e,t){return e>=this._xmin&&e<=this._xmax&&t>=this._ymin&&t<=this._ymax}_intersect(e,t){let r,i,n;if(t.x>=this._xmin&&t.x<=this._xmax)i=t.y<=this._ymin?this._ymin:this._ymax,n=(i-e.y)/(t.y-e.y),r=e.x+n*(t.x-e.x);else if(t.y>=this._ymin&&t.y<=this._ymax)r=t.x<=this._xmin?this._xmin:this._xmax,n=(r-e.x)/(t.x-e.x),i=e.y+n*(t.y-e.y);else{i=t.y<=this._ymin?this._ymin:this._ymax,r=t.x<=this._xmin?this._xmin:this._xmax;const s=(r-e.x)/(t.x-e.x),o=(i-e.y)/(t.y-e.y);s<o?(n=s,i=e.y+s*(t.y-e.y)):(n=o,r=e.x+o*(t.x-e.x))}return this._r=n,new o(r,i)}_pushLine(){this._line&&(this._type===i.Point?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===i.LineString?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===i.Polygon&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(e,t,r){this._type!==i.Polygon?r&&(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line.push(new o(e,t))):(r||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),t<this._ymin&&(t=this._ymin),t>this._ymax&&(t=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line.push(new o(e,t)),this._isH=!1,this._isV=!1)}_lineTo(e,t,r){let n,s;if(this._type!==i.Polygon)if(r){if(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(n=this._line[this._line.length-1],n.equals(e,t)))return;this._line.push(new o(e,t))}else this._line&&this._line.length>0&&this._pushLine();else if(r||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),t<this._ymin&&(t=this._ymin),t>this._ymax&&(t=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){n=this._line[this._line.length-1];const r=n.x===e,i=n.y===t;if(r&&i)return;this._isH&&r||this._isV&&i?(n.x=e,n.y=t,s=this._line[this._line.length-2],s.x===e&&s.y===t?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(s=this._line[this._line.length-2],this._isH=s.x===e,this._isV=s.y===t)):(this._isH=s.x===e,this._isV=s.y===t)):(this._line.push(new o(e,t)),this._isH=r,this._isV=i)}else this._line.push(new o(e,t))}}class c{setExtent(e){this._ratio=4096===e?1:4096/e}get validateTessellation(){return this._ratio<1}reset(e){this._lines=[],this._line=null}moveTo(e,t){this._line&&this._lines.push(this._line),this._line=[];const r=this._ratio;this._line.push(new o(e*r,t*r))}lineTo(e,t){const r=this._ratio;this._line.push(new o(e*r,t*r))}close(){const e=this._line;e&&!e[0].isEqual(e[e.length-1])&&e.push(e[0])}result(){return this._line&&this._lines.push(this._line),0===this._lines.length?null:this._lines}}!function(e){e[e.sideLeft=0]="sideLeft",e[e.sideRight=1]="sideRight",e[e.sideTop=2]="sideTop",e[e.sideBottom=3]="sideBottom"}(n||(n={}));class u{static simplify(e,t,r){if(!r)return;const i=-t,s=e+t,o=-t,a=e+t,l=[],c=[],h=r.length;for(let e=0;e<h;++e){const t=r[e];if(!t||t.length<2)continue;let u,h=t[0];const d=t.length;for(let r=1;r<d;++r)u=t[r],h.x===u.x&&(h.x<=i&&(h.y>u.y?(l.push(e),l.push(r),l.push(n.sideLeft),l.push(-1)):(c.push(e),c.push(r),c.push(n.sideLeft),c.push(-1))),h.x>=s&&(h.y<u.y?(l.push(e),l.push(r),l.push(n.sideRight),l.push(-1)):(c.push(e),c.push(r),c.push(n.sideRight),c.push(-1)))),h.y===u.y&&(h.y<=o&&(h.x<u.x?(l.push(e),l.push(r),l.push(n.sideTop),l.push(-1)):(c.push(e),c.push(r),c.push(n.sideTop),c.push(-1))),h.y>=a&&(h.x>u.x?(l.push(e),l.push(r),l.push(n.sideBottom),l.push(-1)):(c.push(e),c.push(r),c.push(n.sideBottom),c.push(-1)))),h=u}if(0===l.length||0===c.length)return;u.fillParent(r,c,l),u.fillParent(r,l,c);const d=[];u.calcDeltas(d,c,l),u.calcDeltas(d,l,c),u.addDeltas(d,r)}static fillParent(e,t,r){const i=r.length,s=t.length;for(let o=0;o<s;o+=4){const s=t[o],a=t[o+1],l=t[o+2],c=e[s][a-1],u=e[s][a];let d=8092,p=-1;for(let t=0;t<i;t+=4){if(r[t+2]!==l)continue;const i=r[t],s=r[t+1],o=e[i][s-1],a=e[i][s];switch(l){case n.sideLeft:case n.sideRight:if(h(c.y,o.y,a.y)&&h(u.y,o.y,a.y)){const e=Math.abs(a.y-o.y);e<d&&(d=e,p=t)}break;case n.sideTop:case n.sideBottom:if(h(c.x,o.x,a.x)&&h(u.x,o.x,a.x)){const e=Math.abs(a.x-o.x);e<d&&(d=e,p=t)}}}t[o+3]=p}}static calcDeltas(e,t,r){const i=t.length;for(let n=0;n<i;n+=4){const i=[],s=u.calcDelta(n,t,r,i);e.push(t[n]),e.push(t[n+1]),e.push(t[n+2]),e.push(s)}}static calcDelta(e,t,r,i){const n=t[e+3];if(-1===n)return 0;const s=i.length;return s>1&&i[s-2]===n?0:(i.push(n),u.calcDelta(n,r,t,i)+1)}static addDeltas(e,t){const r=e.length;let i=0;for(let t=0;t<r;t+=4){const r=e[t+3];r>i&&(i=r)}for(let s=0;s<r;s+=4){const r=t[e[s]],o=e[s+1],a=i-e[s+3];switch(e[s+2]){case n.sideLeft:r[o-1].x-=a,r[o].x-=a,1===o&&(r[r.length-1].x-=a),o===r.length-1&&(r[0].x-=a);break;case n.sideRight:r[o-1].x+=a,r[o].x+=a,1===o&&(r[r.length-1].x+=a),o===r.length-1&&(r[0].x+=a);break;case n.sideTop:r[o-1].y-=a,r[o].y-=a,1===o&&(r[r.length-1].y-=a),o===r.length-1&&(r[0].y-=a);break;case n.sideBottom:r[o-1].y+=a,r[o].y+=a,1===o&&(r[r.length-1].y+=a),o===r.length-1&&(r[0].y+=a)}}}}const h=(e,t,r)=>e>=t&&e<=r||e>=r&&e<=t},26133:function(e,t,r){r.d(t,{$I:function(){return _},AU:function(){return m},Cr:function(){return d},g7:function(){return y},i4:function(){return h},ui:function(){return p},up:function(){return b},vt:function(){return u},yo:function(){return g}});var i=r(15774),n=r(73364),s=r(32237),o=r(61769),a=r(20551),l=r(32501),c=r(41546);function u(e=b){return[e[0],e[1],e[2],e[3]]}function h(e,t,r=u()){return(0,a.c)(r,e),r[3]=t,r}function d(e,t,r=(0,c.vt)()){return(0,a.b)(r,e,t),(0,a.n)(r,r),r[3]=-(0,a.d)(e,t),r}function p(e,t=u()){const r=(0,n.l)(x,e);return v(t,(0,i.KJ)((0,s.Xd)(t,r))),t}function f(e,t,r=u()){return(0,s.x8)(x,e,_(e)),(0,s.x8)(S,t,_(t)),(0,s.lw)(x,S,x),v(r,(0,i.KJ)((0,s.Xd)(r,x)))}function m(e,t,r,i=u()){return h(l.Cw,e,w),h(l.JP,t,T),h(l.Cb,r,A),f(w,T,w),f(w,A,i),i}function g(e){return e}function y(e){return e[3]}function _(e){return(0,i.kU)(e[3])}function v(e,t){return e[3]=t,e}const b=[0,0,1,0],x=(0,o.vt)(),S=(0,o.vt)(),w=(u(),u()),T=u(),A=u()},92754:function(e,t,r){r.d(t,{Y$:function(){return d},qB:function(){return b},Qt:function(){return G},My:function(){return j},bf:function(){return F},jZ:function(){return g},j0:function(){return y},Sx:function(){return _},E$:function(){return v},h:function(){return M},P:function(){return I},SL:function(){return T},gH:function(){return p},si:function(){return x},mJ:function(){return B},UL:function(){return W},D6:function(){return z},Yi:function(){return R},An:function(){return L},LC:function(){return A},xs:function(){return f},Xm:function(){return S},Vp:function(){return H},zD:function(){return q},m8:function(){return V},nS:function(){return P},H$:function(){return N},eI:function(){return C},Eq:function(){return m},Aj:function(){return w},E7:function(){return k},Y4:function(){return Z},TX:function(){return U},Uz:function(){return O},ml:function(){return D},XP:function(){return E}});class i{constructor(e,t,r=0,i,n){this.TypedArrayConstructor=e,this.elementCount=9;const s=this.TypedArrayConstructor;void 0===i&&(i=9*s.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:r;this.typedBuffer=null==n?new s(t,o):new s(t,o,(n-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,r=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}getMat(e,t){let r=e*this.typedBufferStride;for(let e=0;e<9;e++)t[e]=this.typedBuffer[r++];return t}setMat(e,t){let r=e*this.typedBufferStride;for(let e=0;e<9;e++)this.typedBuffer[r++]=t[e]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}copyFrom(e,t,r){const i=this.typedBuffer,n=t.typedBuffer;let s=e*this.typedBufferStride,o=r*t.typedBufferStride;for(let e=0;e<9;++e)i[s++]=n[o++]}get buffer(){return this.typedBuffer.buffer}}i.ElementCount=9;class n{constructor(e,t,r=0,i,n){this.TypedArrayConstructor=e,this.elementCount=16;const s=this.TypedArrayConstructor;void 0===i&&(i=16*s.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:r;this.typedBuffer=null==n?new s(t,o):new s(t,o,(n-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,r=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}getMat(e,t){let r=e*this.typedBufferStride;for(let e=0;e<16;e++)t[e]=this.typedBuffer[r++];return t}setMat(e,t){let r=e*this.typedBufferStride;for(let e=0;e<16;e++)this.typedBuffer[r++]=t[e]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}copyFrom(e,t,r){const i=this.typedBuffer,n=t.typedBuffer;let s=e*this.typedBufferStride,o=r*t.typedBufferStride;for(let e=0;e<16;++e)i[s++]=n[o++]}get buffer(){return this.typedBuffer.buffer}}n.ElementCount=16;class s{constructor(e,t,r=0,i,n){this.TypedArrayConstructor=e,this.elementCount=1;const s=this.TypedArrayConstructor;void 0===i&&(i=s.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:r;this.typedBuffer=null==n?new s(t,o):new s(t,o,(n-r)/s.BYTES_PER_ELEMENT),this.stride=i,this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,t,r=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,t){this.typedBuffer[e*this.typedBufferStride]=t}get buffer(){return this.typedBuffer.buffer}}s.ElementCount=1;var o=r(13786);class a{constructor(e,t,r=0,i,n){this.TypedArrayConstructor=e,this.elementCount=2;const s=this.TypedArrayConstructor;void 0===i&&(i=2*s.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:r;this.typedBuffer=null==n?new s(t,o):new s(t,o,(n-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,r=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}getVec(e,t){return e*=this.typedBufferStride,(0,o.hZ)(t,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e]=t[1]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}setValues(e,t,r){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e]=r}copyFrom(e,t,r){const i=this.typedBuffer,n=t.typedBuffer;let s=e*this.typedBufferStride,o=r*t.typedBufferStride;i[s++]=n[o++],i[s]=n[o]}get buffer(){return this.typedBuffer.buffer}}a.ElementCount=2;var l=r(20551);class c{constructor(e,t,r=0,i,n){this.TypedArrayConstructor=e,this.elementCount=3;const s=this.TypedArrayConstructor;void 0===i&&(i=3*s.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:r;this.typedBuffer=null==n?new s(t,o):new s(t,o,(n-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,r=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}getVec(e,t){return e*=this.typedBufferStride,(0,l.s)(t,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e++]=t[1],this.typedBuffer[e]=t[2]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}setValues(e,t,r,i){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e++]=r,this.typedBuffer[e]=i}copyFrom(e,t,r){const i=this.typedBuffer,n=t.typedBuffer;let s=e*this.typedBufferStride,o=r*t.typedBufferStride;i[s++]=n[o++],i[s++]=n[o++],i[s]=n[o]}get buffer(){return this.typedBuffer.buffer}}c.ElementCount=3;var u=r(33400);class h{constructor(e,t,r=0,i,n){this.TypedArrayConstructor=e,this.start=r,this.elementCount=4;const s=this.TypedArrayConstructor;void 0===i&&(i=4*s.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:r;this.typedBuffer=null==n?new s(t,o):new s(t,o,(n-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,r=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}getVec(e,t){return e*=this.typedBufferStride,(0,u.s)(t,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e++]=t[1],this.typedBuffer[e++]=t[2],this.typedBuffer[e]=t[3]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}setValues(e,t,r,i,n){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e]=n}copyFrom(e,t,r){const i=this.typedBuffer,n=t.typedBuffer;let s=e*this.typedBufferStride,o=r*t.typedBufferStride;i[s++]=n[o++],i[s++]=n[o++],i[s++]=n[o++],i[s]=n[o]}get buffer(){return this.typedBuffer.buffer}}h.ElementCount=4;class d extends s{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}static fromTypedArray(e,t){return new d(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}d.ElementType="f32";class p extends a{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(p,e,t)}static fromTypedArray(e,t){return new p(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}p.ElementType="f32";class f extends c{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(f,e,t)}static fromTypedArray(e,t){return new f(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}f.ElementType="f32";class m extends h{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(m,e,t)}static fromTypedArray(e,t){return new m(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}m.ElementType="f32";class g extends i{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(g,e,t)}static fromTypedArray(e,t){return new g(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}g.ElementType="f32";class y extends i{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(y,e,t)}static fromTypedArray(e,t){return new y(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}y.ElementType="f64";class _ extends n{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(_,e,t)}static fromTypedArray(e,t){return new _(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}_.ElementType="f32";class v extends n{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(v,e,t)}static fromTypedArray(e,t){return new v(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}v.ElementType="f64";class b extends s{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(b,e,t)}static fromTypedArray(e,t){return new b(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}b.ElementType="f64";class x extends a{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(x,e,t)}static fromTypedArray(e,t){return new x(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}x.ElementType="f64";class S extends c{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(S,e,t)}static fromTypedArray(e,t){return new S(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}S.ElementType="f64";class w extends h{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(w,e,t)}static fromTypedArray(e,t){return new w(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}w.ElementType="f64";class T extends s{constructor(e,t=0,r,i){super(Uint8Array,e,t,r,i),this.elementType="u8"}slice(e,t){return this.sliceBuffer(T,e,t)}static fromTypedArray(e,t){return new T(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}T.ElementType="u8";class A extends a{constructor(e,t=0,r,i){super(Uint8Array,e,t,r,i),this.elementType="u8"}slice(e,t){return this.sliceBuffer(A,e,t)}static fromTypedArray(e,t){return new A(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}A.ElementType="u8";class C extends c{constructor(e,t=0,r,i){super(Uint8Array,e,t,r,i),this.elementType="u8"}slice(e,t){return this.sliceBuffer(C,e,t)}static fromTypedArray(e,t){return new C(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}C.ElementType="u8";class E extends h{constructor(e,t=0,r,i){super(Uint8Array,e,t,r,i),this.elementType="u8"}slice(e,t){return this.sliceBuffer(E,e,t)}static fromTypedArray(e,t){return new E(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}E.ElementType="u8";class M extends s{constructor(e,t=0,r,i){super(Uint16Array,e,t,r,i),this.elementType="u16"}slice(e,t){return this.sliceBuffer(M,e,t)}static fromTypedArray(e,t){return new M(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}M.ElementType="u16";class R extends a{constructor(e,t=0,r,i){super(Uint16Array,e,t,r,i),this.elementType="u16"}slice(e,t){return this.sliceBuffer(R,e,t)}static fromTypedArray(e,t){return new R(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}R.ElementType="u16";class P extends c{constructor(e,t=0,r,i){super(Uint16Array,e,t,r,i),this.elementType="u16"}slice(e,t){return this.sliceBuffer(P,e,t)}static fromTypedArray(e,t){return new P(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}P.ElementType="u16";class O extends h{constructor(e,t=0,r,i){super(Uint16Array,e,t,r,i),this.elementType="u16"}slice(e,t){return this.sliceBuffer(O,e,t)}static fromTypedArray(e,t){return new O(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}O.ElementType="u16";class I extends s{constructor(e,t=0,r,i){super(Uint32Array,e,t,r,i),this.elementType="u32"}slice(e,t){return this.sliceBuffer(I,e,t)}static fromTypedArray(e,t){return new I(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}I.ElementType="u32";class L extends a{constructor(e,t=0,r,i){super(Uint32Array,e,t,r,i),this.elementType="u32"}slice(e,t){return this.sliceBuffer(L,e,t)}static fromTypedArray(e,t){return new L(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}L.ElementType="u32";class N extends c{constructor(e,t=0,r,i){super(Uint32Array,e,t,r,i),this.elementType="u32"}slice(e,t){return this.sliceBuffer(N,e,t)}static fromTypedArray(e,t){return new N(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}N.ElementType="u32";class D extends h{constructor(e,t=0,r,i){super(Uint32Array,e,t,r,i),this.elementType="u32"}slice(e,t){return this.sliceBuffer(D,e,t)}static fromTypedArray(e,t){return new D(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}D.ElementType="u32";class F extends s{constructor(e,t=0,r,i){super(Int8Array,e,t,r,i),this.elementType="i8"}slice(e,t){return this.sliceBuffer(F,e,t)}static fromTypedArray(e,t){return new F(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}F.ElementType="i8";class z extends a{constructor(e,t=0,r,i){super(Int8Array,e,t,r,i),this.elementType="i8"}slice(e,t){return this.sliceBuffer(z,e,t)}static fromTypedArray(e,t){return new z(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}z.ElementType="i8";class V extends c{constructor(e,t=0,r,i){super(Int8Array,e,t,r,i),this.elementType="i8"}slice(e,t){return this.sliceBuffer(V,e,t)}static fromTypedArray(e,t){return new V(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}V.ElementType="i8";class U extends h{constructor(e,t=0,r,i){super(Int8Array,e,t,r,i),this.elementType="i8"}slice(e,t){return this.sliceBuffer(U,e,t)}static fromTypedArray(e,t){return new U(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}U.ElementType="i8";class G extends s{constructor(e,t=0,r,i){super(Int16Array,e,t,r,i),this.elementType="i16"}slice(e,t){return this.sliceBuffer(G,e,t)}static fromTypedArray(e,t){return new G(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}G.ElementType="i16";class B extends a{constructor(e,t=0,r,i){super(Int16Array,e,t,r,i),this.elementType="i16"}slice(e,t){return this.sliceBuffer(B,e,t)}static fromTypedArray(e,t){return new B(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}B.ElementType="i16";class H extends c{constructor(e,t=0,r,i){super(Int16Array,e,t,r,i),this.elementType="i16"}slice(e,t){return this.sliceBuffer(H,e,t)}static fromTypedArray(e,t){return new H(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}H.ElementType="i16";class k extends h{constructor(e,t=0,r,i){super(Int16Array,e,t,r,i),this.elementType="i16"}slice(e,t){return this.sliceBuffer(k,e,t)}static fromTypedArray(e,t){return new k(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}k.ElementType="i16";class j extends s{constructor(e,t=0,r,i){super(Int32Array,e,t,r,i),this.elementType="i32"}slice(e,t){return this.sliceBuffer(j,e,t)}static fromTypedArray(e,t){return new j(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}j.ElementType="i32";class W extends a{constructor(e,t=0,r,i){super(Int32Array,e,t,r,i),this.elementType="i32"}slice(e,t){return this.sliceBuffer(W,e,t)}static fromTypedArray(e,t){return new W(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}W.ElementType="i32";class q extends c{constructor(e,t=0,r,i){super(Int32Array,e,t,r,i),this.elementType="i32"}slice(e,t){return this.sliceBuffer(q,e,t)}static fromTypedArray(e,t){return new q(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}q.ElementType="i32";class Z extends h{constructor(e,t=0,r,i){super(Int32Array,e,t,r,i),this.elementType="i32"}slice(e,t){return this.sliceBuffer(Z,e,t)}static fromTypedArray(e,t){return new Z(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}Z.ElementType="i32"},28404:function(e,t,r){function i(e){switch(e){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}r.d(t,{GJ:function(){return i}})},91912:function(e,t,r){r.d(t,{$e:function(){return a},j1:function(){return l},mO:function(){return c},vt:function(){return o}});var i=r(89736),n=r(20551),s=r(79578);function o(e){return e?{ray:(0,s.vt)(e.ray),c0:e.c0,c1:e.c1}:{ray:(0,s.vt)(),c0:0,c1:Number.MAX_VALUE}}function a(e,t=o()){return(0,s.C)(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function l(e,t){return u(e,e.c0,t)}function c(e,t){return u(e,e.c1,t)}function u(e,t,r){return(0,n.g)(r,e.ray.origin,(0,n.j)(r,e.ray.direction,t))}new i.I((()=>o()))},69508:function(e,t,r){r.d(t,{C:function(){return g},FB:function(){return i},ig:function(){return v},m7:function(){return _},ui:function(){return y},vt:function(){return m}});var i,n,s,o=r(89736),a=r(73364),l=r(20551),c=r(32501),u=r(33400),h=r(41546),d=r(91912),p=r(5596),f=r(50973);function m(e){return e?[(0,p.vt)(e[0]),(0,p.vt)(e[1]),(0,p.vt)(e[2]),(0,p.vt)(e[3]),(0,p.vt)(e[4]),(0,p.vt)(e[5])]:[(0,p.vt)(),(0,p.vt)(),(0,p.vt)(),(0,p.vt)(),(0,p.vt)(),(0,p.vt)()]}function g(e,t){for(let r=0;r<b;r++)(0,p.C)(e[r],t[r]);return e}function y(e,t,r,s=w){const o=(0,a.lw)(f.Rc.get(),t,e);(0,a.B8)(o,o);for(let e=0;e<x;++e){const t=(0,u.t)(f.Km.get(),S[e],o);(0,l.s)(s[e],t[0]/t[3],t[1]/t[3],t[2]/t[3])}!function(e,t){(0,p.Cr)(t[n.FAR_BOTTOM_LEFT],t[n.NEAR_BOTTOM_LEFT],t[n.NEAR_TOP_LEFT],e[i.LEFT]),(0,p.Cr)(t[n.NEAR_BOTTOM_RIGHT],t[n.FAR_BOTTOM_RIGHT],t[n.FAR_TOP_RIGHT],e[i.RIGHT]),(0,p.Cr)(t[n.FAR_BOTTOM_LEFT],t[n.FAR_BOTTOM_RIGHT],t[n.NEAR_BOTTOM_RIGHT],e[i.BOTTOM]),(0,p.Cr)(t[n.NEAR_TOP_LEFT],t[n.NEAR_TOP_RIGHT],t[n.FAR_TOP_RIGHT],e[i.TOP]),(0,p.Cr)(t[n.NEAR_BOTTOM_LEFT],t[n.NEAR_BOTTOM_RIGHT],t[n.NEAR_TOP_RIGHT],e[i.NEAR]),(0,p.Cr)(t[n.FAR_BOTTOM_RIGHT],t[n.FAR_BOTTOM_LEFT],t[n.FAR_TOP_LEFT],e[i.FAR])}(r,s)}function _(e,t){for(let r=0;r<b;r++){const i=e[r];if(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]>=t[3])return!1}return!0}function v(e,t){for(let r=0;r<b;r++){const i=e[r];if(!(0,p.b6)(i,t))return!1}return!0}(s=i||(i={}))[s.LEFT=0]="LEFT",s[s.RIGHT=1]="RIGHT",s[s.BOTTOM=2]="BOTTOM",s[s.TOP=3]="TOP",s[s.NEAR=4]="NEAR",s[s.FAR=5]="FAR",function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(n||(n={})),n.FAR_BOTTOM_RIGHT,n.NEAR_BOTTOM_RIGHT,n.NEAR_BOTTOM_LEFT,n.FAR_BOTTOM_LEFT,n.NEAR_BOTTOM_LEFT,n.NEAR_BOTTOM_RIGHT,n.NEAR_TOP_RIGHT,n.NEAR_TOP_LEFT,n.FAR_BOTTOM_RIGHT,n.FAR_BOTTOM_LEFT,n.FAR_TOP_LEFT,n.FAR_TOP_RIGHT,n.NEAR_BOTTOM_RIGHT,n.FAR_BOTTOM_RIGHT,n.FAR_TOP_RIGHT,n.NEAR_TOP_RIGHT,n.FAR_BOTTOM_LEFT,n.NEAR_BOTTOM_LEFT,n.NEAR_TOP_LEFT,n.FAR_TOP_LEFT,n.FAR_TOP_LEFT,n.NEAR_TOP_LEFT,n.NEAR_TOP_RIGHT,n.FAR_TOP_RIGHT;const b=6,x=8,S=[(0,h.fA)(-1,-1,-1,1),(0,h.fA)(1,-1,-1,1),(0,h.fA)(1,1,-1,1),(0,h.fA)(-1,1,-1,1),(0,h.fA)(-1,-1,1,1),(0,h.fA)(1,-1,1,1),(0,h.fA)(1,1,1,1),(0,h.fA)(-1,1,1,1)],w=(new o.I(d.vt),[(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)()])},52313:function(e,t,r){r.d(t,{Hu:function(){return l},jI:function(){return m},zy:function(){return h}}),r(58941);var i,n,s=r(39819),o=r(22902),a=r(93389);function l(e,t,r){const n=h(e),a=t,l=c(n,a,r);if(n){const t=o.A.deriveUnitFromSR(n,e.spatialReference).heightUnit;if(!r&&t!==n.heightUnit){const e=new s.A("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${t})`,{horizontalUnit:t});return new s.A("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:n,error:e})}}if(!("heightModelInfo"in(u=e)&&null!=u.heightModelInfo||null!=u.spatialReference)&&f(u)||l===i.Unsupported)return new s.A("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:n});var u;switch(l){case i.Units:{const e=n?.heightUnit||"unknown",t=a?.heightUnit||"unknown",r=new s.A("layerview:incompatible-height-unit",`The vertical units of the layer (${e}) must match the vertical units of the scene (${t})`,{layerUnit:e,sceneUnit:t});return new s.A("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:n,sceneHeightModelInfo:a,error:r})}case i.HeightModel:{const e=n?.heightModel||"unknown",t=a?.heightModel||"unknown",r=new s.A("layerview:incompatible-height-model",`The height model of the layer (${e}) must match the height model of the scene (${t})`,{layerHeightModel:e,sceneHeightModel:t});return new s.A("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:n,sceneHeightModelInfo:a,error:r})}case i.CRS:{const e=n?.vertCRS||"unknown",t=a?.vertCRS||"unknown",r=new s.A("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${e}) must match the vertical datum of the scene (${t})`,{layerDatum:e,sceneDatum:t});return new s.A("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:n,sceneHeightModelInfo:a,error:r})}}return null}function c(e,t,r){if(!u(e)||!u(t))return i.Unsupported;if(null==e||null==t)return i.Ok;if(!r&&e.heightUnit!==t.heightUnit)return i.Units;if(e.heightModel!==t.heightModel)return i.HeightModel;switch(e.heightModel){case"gravity-related-height":return i.Ok;case"ellipsoidal":return e.vertCRS===t.vertCRS?i.Ok:i.CRS;default:return i.Unsupported}}function u(e){return null==e||null!=e.heightModel&&null!=e.heightUnit}function h(e){if("integrated-mesh-3dtiles"===e.type)return null;const t=e.url?(0,a.qg)(e.url):void 0,r=e.spatialReference?.vcsWkid;return(null!=r||null==t||"ImageServer"!==t.serverType)&&d(e)&&e.heightModelInfo?e.heightModelInfo:f(e)?o.A.deriveUnitFromSR(y,e.spatialReference):null}function d(e){return"heightModelInfo"in e}function p(e){if("unknown"===e.type||!("capabilities"in e))return!1;switch(e.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function f(e){return p(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):g(e)}function m(e){return null!=e.layers||g(e)||p(e)||d(e)}function g(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"integrated-mesh-3dtiles":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"catalog":case"catalog-footprint":case"catalog-dynamic-group":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(n=i||(i={}))[n.Ok=0]="Ok",n[n.Units=1]="Units",n[n.HeightModel=2]="HeightModel",n[n.CRS=3]="CRS",n[n.Unsupported=4]="Unsupported";const y=new o.A({heightModel:"gravity-related-height"})},30804:function(e,t,r){r.d(t,{d:function(){return c}});var i=r(87416),n=r(35068),s=r(72228),o=r(38441),a=r(96127);const l=222045e-19;function c(e){if(0===e.totalSize)return null;const t=(0,n.z8)(e);if(!t)return null;const r=4*(Math.abs(t[0])+Math.abs(t[2])+Math.abs(t[1])+Math.abs(t[3])+1)*l;let o=0,a=0;e.reset();for(let t=0;e.nextPath();t++){const r=e.getCurrentRingArea();r>a&&(a=r,o=t)}if(e.seekPath(o),0===e.pathSize)return null;e.seekPathStart();const c=(0,n.B$)(e);if(Math.abs(a)<=2*r*r)return[(c[0]+c[2])/2,(c[1]+c[3])/2];e.seekPathStart();const p=(0,s.w2)(e,(0,i.vt)());if(null===p)return null;if(e.totalPoints<4)return p;const f=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]],m=[NaN,NaN,NaN,NaN],g=[NaN,NaN,NaN,NaN];let y=!1,_=h(p,e,!0);0===_.distance&&(y=!0,f[0][0]=p[0],f[0][1]=p[1],_=h(p,e,!1)),m[0]=_.distance,g[0]=0;const v=[NaN,NaN];let w=!1,T=.25,A=-1,C=NaN;do{if(C=NaN,f[1]=d(e,b(c[0],c[2],T),0,t),isNaN(f[1][0])||isNaN(f[1][1])||(_=h(f[1],e,!1),C=_.distance),!isNaN(C)&&C>r&&u(f[1],e))w=!0,m[1]=C,g[1]=x(f[1],p);else if(!isNaN(C)&&C>A&&(A=C,v[0]=f[1][0],v[1]=f[1][1]),T-=.01,T<.1){if(!(A>=0))break;w=!0,m[1]=A,f[1][0]=v[0],f[1][1]=v[1],g[1]=x(f[1],p)}}while(!w);w=!1,T=.5,A=-1;let E=.01,M=1;do{if(C=NaN,f[2]=d(e,b(c[0],c[2],T),0,t),isNaN(f[2][0])||isNaN(f[2][1])||(_=h(f[2],e,!1),C=_.distance),!isNaN(C)&&C>r&&u(f[2],e))w=!0,m[2]=C,g[2]=x(f[2],p);else if(!isNaN(C)&&C>A)A=C,v[0]=f[2][0],v[1]=f[2][1];else if(C>A&&(A=C,v[0]=f[2][0],v[1]=f[2][1]),T=.5+E*M,E+=.01,M*=-1,T<.3||T>.7){if(!(A>=0))break;w=!0,m[2]=A,f[2][0]=v[0],f[2][1]=v[1],g[2]=x(f[2],p)}}while(!w);w=!1,T=.75,A=-1;do{if(C=NaN,f[3]=d(e,b(c[0],c[2],T),0,t),isNaN(f[3][0])||isNaN(f[3][1])||(_=h(f[3],e,!1),C=_.distance),!isNaN(C)&&C>r&&u(f[3],e))w=!0,m[3]=C,g[3]=x(f[3],p);else if(C>A&&(A=C,v[0]=f[3][0],v[1]=f[3][1]),T+=.01,T>.9){if(!(A>=0))break;w=!0,m[3]=A,f[3][0]=v[0],f[3][1]=v[1],g[3]=x(f[3],p)}}while(!w);const R=[0,1,2,3],P=y?0:1;let O;for(let e=P;e<4;e++)for(let e=P;e<3;e++){const t=g[e],r=g[e+1];S(t,r)>0&&(O=R[e],R[e]=R[e+1],R[e+1]=O,g[e]=r,g[e+1]=t)}let I=P,L=0,N=0;for(let e=P;e<4;e++){switch(e){case 0:N=2*m[R[e]];break;case 1:N=1.66666666*m[R[e]];break;case 2:N=1.33333333*m[R[e]];break;case 3:N=m[R[e]]}N>L&&(L=N,I=R[e])}return f[I]}function u(e,t){let r,i,n,s,o=0;for(t.reset();t.nextPath()&&t.nextPoint();)for(r=t.x,i=t.y;t.nextPoint();r=n,i=s)n=t.x,s=t.y,i>e[1]!=s>e[1]&&((n-r)*(e[1]-i)-(s-i)*(e[0]-r)>0?o++:o--);return 0!==o}function h(e,t,r){if(r&&u(e,t))return{coord:e,distance:0};let i=1/0,n=0,s=0,a=[0,0],l=[0,0];const c=[0,0];for(t.reset();t.nextPath()&&t.nextPoint();)if(!(t.pathSize<2))for(a[0]=t.x,a[1]=t.y;t.nextPoint();a=l){l=[t.x,t.y],(0,o.gR)(c,e,a,l);const r=x(e,c);r<i&&(i=r,n=c[0],s=c[1])}return{coord:[n,s],distance:Math.sqrt(i)}}function d(e,t,r,n){const s=[t,0];let o=1/0,l=1/0,c=!1,u=!1;const h=[[t,n[1]-1],[t,n[3]+1]],d=[0,0],f=[0,0],m=[0,0],g=[[0,0],[0,0]],y=(0,i.vt)();for(e.reset();e.nextPath()&&e.nextPoint();)if(!(e.pathSize<2))for(g[0][0]=e.x,g[0][1]=e.y;e.nextPoint();g[0][0]=g[1][0],g[0][1]=g[1][1]){if(g[1][0]=e.x,g[1][1]=e.y,null===p(y,g))continue;if(f[0]=h[0][0],f[1]=h[0][1],m[0]=h[1][0],m[1]=h[1][1],0===_(y,f,m))continue;if(!(0,a.Ql)(h[0],h[1],g[0],g[1],d))continue;const t=d[1];o>l?t<o&&(o=t,c=!0):t<l&&(l=t,u=!0)}return c&&u?s[1]=(o+l)/2:s[0]=s[1]=NaN,s}function p(e,t){if(t.length<2)return null;e||(e=(0,i.vt)());const[r,n]=t[0],[s,o]=t[1];return e[0]=Math.min(r,s),e[1]=Math.min(n,o),e[2]=Math.max(r,s),e[3]=Math.max(n,o),e}const f=1,m=4,g=3,y=12;function _(e,t,r){let i=v(t,e),n=v(r,e);const s=e[0],o=e[1],a=e[2],l=e[3];if(i&n)return 0;if(!(i|n))return 4;const c=(i?1:0)|(n?2:0);do{const c=r[0]-t[0],u=r[1]-t[1];if(c>u)i&g?(i&f?(t[1]+=u*(s-t[0])/c,t[0]=s):(t[1]+=u*(a-t[0])/c,t[0]=a),i=v(t,e)):n&g?(n&f?(r[1]+=u*(s-r[0])/c,r[0]=s):(r[1]+=u*(a-r[0])/c,r[0]=a),n=v(r,e)):i?(i&m?(t[0]+=c*(o-t[1])/u,t[1]=o):(t[0]+=c*(l-t[1])/u,t[1]=l),i=v(t,e)):(n&m?(r[0]+=c*(o-r[1])/u,r[1]=o):(r[0]+=c*(l-r[1])/u,r[1]=l),n=v(r,e));else if(i&y?(i&m?(t[0]+=c*(o-t[1])/u,t[1]=o):(t[0]+=c*(l-t[1])/u,t[1]=l),i=v(t,e)):n&y?(n&m?(r[0]+=c*(o-r[1])/u,r[1]=o):(r[0]+=c*(l-r[1])/u,r[1]=l),n=v(r,e)):i?(i&f?(t[1]+=u*(s-t[0])/c,t[0]=s):(t[1]+=u*(a-t[0])/c,t[0]=a),i=v(t,e)):(n&f?(r[1]+=u*(s-r[0])/c,r[0]=s):(r[1]+=u*(a-r[0])/c,r[0]=a),n=v(r,e)),i&n)return 0}while(i|n);return c}function v(e,t){return(e[0]<t[0]?1:0)|(e[0]>t[2]?1:0)<<1|(e[1]<t[1]?1:0)<<2|(e[1]>t[3]?1:0)<<3}function b(e,t,r){return e+(t-e)*r}function x(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}function S(e,t){if(e<t)return-1;if(e>t)return 1;if(e===t)return 0;const r=isNaN(e),i=isNaN(t);return r<i?-1:r>i?1:0}},73313:function(e,t,r){r.d(t,{C:function(){return c},Cr:function(){return h},H6:function(){return m},_I:function(){return p},dz:function(){return g},fA:function(){return u},kb:function(){return d},ld:function(){return y},sd:function(){return f},vt:function(){return l}});var i=r(15774),n=r(89736),s=r(20551),o=r(32501),a=r(50973);function l(e){return e?{origin:(0,o.o8)(e.origin),vector:(0,o.o8)(e.vector)}:{origin:(0,o.vt)(),vector:(0,o.vt)()}}function c(e,t=l()){return u(e.origin,e.vector,t)}function u(e,t,r=l()){return(0,s.c)(r.origin,e),(0,s.c)(r.vector,t),r}function h(e,t,r=l()){return(0,s.c)(r.origin,e),(0,s.f)(r.vector,t,e),r}function d(e,t){const r=(0,s.f)(a.rq.get(),t,e.origin),n=(0,s.m)(e.vector,r),o=(0,s.m)(e.vector,e.vector),l=(0,i.qE)(n/o,0,1),c=(0,s.f)(a.rq.get(),(0,s.j)(a.rq.get(),e.vector,l),r);return(0,s.m)(c,c)}function p(e,t,r){return m(e,t,0,1,r)}function f(e,t,r){return(0,s.g)(r,e.origin,(0,s.j)(r,e.vector,t))}function m(e,t,r,n,o){const{vector:l,origin:c}=e,u=(0,s.f)(a.rq.get(),t,c),h=(0,s.m)(l,u)/(0,s.q)(l);return(0,s.j)(o,l,(0,i.qE)(h,r,n)),(0,s.g)(o,o,e.origin)}function g(e,t){if(_(e,function(e,t){const r=b.get();return r.origin=e,r.vector=t,r}(t.origin,t.direction),!1,v)){const{tA:t,pB:r,distance2:i}=v;if(t>=0&&t<=1)return i;if(t<0)return(0,s.a)(e.origin,r);if(t>1)return(0,s.a)((0,s.g)(a.rq.get(),e.origin,e.vector),r)}return null}function y(e,t,r){return!!_(e,t,!0,v)&&((0,s.c)(r,v.pA),!0)}function _(e,t,r,n){const o=1e-6,l=e.origin,c=(0,s.g)(a.rq.get(),l,e.vector),u=t.origin,h=(0,s.g)(a.rq.get(),u,t.vector),d=a.rq.get(),p=a.rq.get();if(d[0]=l[0]-u[0],d[1]=l[1]-u[1],d[2]=l[2]-u[2],p[0]=h[0]-u[0],p[1]=h[1]-u[1],p[2]=h[2]-u[2],Math.abs(p[0])<o&&Math.abs(p[1])<o&&Math.abs(p[2])<o)return!1;const f=a.rq.get();if(f[0]=c[0]-l[0],f[1]=c[1]-l[1],f[2]=c[2]-l[2],Math.abs(f[0])<o&&Math.abs(f[1])<o&&Math.abs(f[2])<o)return!1;const m=d[0]*p[0]+d[1]*p[1]+d[2]*p[2],g=p[0]*f[0]+p[1]*f[1]+p[2]*f[2],y=d[0]*f[0]+d[1]*f[1]+d[2]*f[2],_=p[0]*p[0]+p[1]*p[1]+p[2]*p[2],v=(f[0]*f[0]+f[1]*f[1]+f[2]*f[2])*_-g*g;if(Math.abs(v)<o)return!1;let b=(m*g-y*_)/v,x=(m+g*b)/_;r&&(b=(0,i.qE)(b,0,1),x=(0,i.qE)(x,0,1));const S=a.rq.get(),w=a.rq.get();return S[0]=l[0]+b*f[0],S[1]=l[1]+b*f[1],S[2]=l[2]+b*f[2],w[0]=u[0]+x*p[0],w[1]=u[1]+x*p[1],w[2]=u[2]+x*p[2],n.tA=b,n.tB=x,n.pA=S,n.pB=w,n.distance2=(0,s.a)(S,w),!0}const v={tA:0,tB:0,pA:(0,o.vt)(),pB:(0,o.vt)(),distance2:0},b=new n.I((()=>l()))},61003:function(e,t,r){r.d(t,{b:function(){return s}});var i=r(15774),n=r(37819);function s(e,t,r){const s=Array.isArray(e),u=s?e.length/t:e.byteLength/(4*t),h=s?e:new Uint32Array(e,0,u*t),d=r?.minReduction??0,p=r?.originalIndices||null,f=p?p.length:0,m=r?.componentOffsets||null;let g=0;if(m)for(let e=0;e<m.length-1;e++){const t=m[e+1]-m[e];t>g&&(g=t)}else g=u;const y=Math.floor(1.1*g)+1;(null==c||c.length<2*y)&&(c=new Uint32Array((0,i.cU)(2*y)));for(let e=0;e<2*y;e++)c[e]=0;let _=0;const v=!!m&&!!p,b=v?f:u;let x=(0,n.my)(u);const S=new Uint32Array(f),w=1.96;let T=0!==d?Math.ceil(4*w*w/(d*d)*d*(1-d)):b,A=1,C=m?m[1]:b;for(let e=0;e<b;e++){if(e===T){const t=1-_/e;if(t+w*Math.sqrt(t*(1-t)/e)<d)return null;T*=2}if(e===C){for(let e=0;e<2*y;e++)c[e]=0;if(p)for(let e=m[A-1];e<m[A];e++)S[e]=x[p[e]];C=m[++A]}const r=v?p[e]:e,i=r*t,n=l(h,i,t);let s=n%y,a=_;for(;0!==c[2*s+1];){if(c[2*s]===n){const e=c[2*s+1]-1;if(o(h,i,e*t,t)){a=x[e];break}}s++,s>=y&&(s-=y)}a===_&&(c[2*s]=n,c[2*s+1]=r+1,_++),x[r]=a}if(0!==d&&1-_/u<d)return null;if(v){for(let e=m[A-1];e<S.length;e++)S[e]=x[p[e]];x=(0,n.Dg)(S)}const E=s?new Array(_):new Uint32Array(_*t);_=0;for(let e=0;e<b;e++)x[e]===_&&(a(h,(v?p[e]:e)*t,E,_*t,t),_++);if(p&&!v){const e=new Uint32Array(f);for(let t=0;t<e.length;t++)e[t]=x[p[t]];x=(0,n.Dg)(e)}return{buffer:Array.isArray(E)?E:E.buffer,indices:x,uniqueCount:_}}function o(e,t,r,i){for(let n=0;n<i;n++)if(e[t+n]!==e[r+n])return!1;return!0}function a(e,t,r,i,n){for(let s=0;s<n;s++)r[i+s]=e[t+s]}function l(e,t,r){let i=0;for(let n=0;n<r;n++)i=e[t+n]+i|0,i=i+(i<<11)+(i>>>2)|0;return i>>>0}let c=null},83614:function(e,t,r){r.d(t,{$5:function(){return C},CN:function(){return S},GN:function(){return P},JP:function(){return x},KM:function(){return M},Mv:function(){return L},OD:function(){return N},X4:function(){return w},gZ:function(){return R},gr:function(){return A},project:function(){return U},qs:function(){return E},si:function(){return T},xA:function(){return I}});var i=r(15774),n=r(44705),s=r(87725),o=r(73364),a=r(39714),l=r(20551),c=r(32501),u=r(46157),h=r(96611),d=r(7456),p=r(57617),f=r(50240),m=r(43587),g=r(57652),y=r(1644),_=r(92754),v=r(62693),b=r(32003);const x="Projection may be possible after calling projection.load().";function S(e,t,r,i){e.error(`Failed to project from (wkid:${t.wkid}) to (wkid:${r.wkid}).${i?" ":""}${i}`)}function w(e,t,r,i,n){return V(D.TO_PCPF,_.xs.fromTypedArray(e),N.NORMAL,_.Xm.fromTypedArray(t),_.Xm.fromTypedArray(r),i,_.xs.fromTypedArray(n))?n:null}function T(e,t,r,i,n){return V(D.FROM_PCPF,_.xs.fromTypedArray(e),N.NORMAL,_.Xm.fromTypedArray(t),_.Xm.fromTypedArray(r),i,_.xs.fromTypedArray(n))?n:null}function A(e,t,r){return(0,p.projectBuffer)(e,t,0,r,(0,h.lO)(t),0,e.length/3)?r:null}function C(e,t,r){return(0,p.projectBuffer)(e,(0,h.lO)(r),0,t,r,0,e.length/3)?t:null}function E(e,t,r){return(0,n.Ge)(k,r),(0,v.t)(t,e,k),(0,i.or)(k)&&(0,v.n)(t,t),t}function M(e,t,r){return(0,n.z0)(k,r),(0,b.t)(t,e,k),(0,i.or)(k)&&(0,v.n)(t,t,4),t}function R(e,t,r,n){const s=t===N.NORMAL;return O(e,t,r,((e,t)=>{const r=Math.cos((0,i.kU)(e));t[0]=s?r:1/r,t[1]=1}),n)}function P(e,t,r,i){const n=t===N.NORMAL;return O(e,t,r,((e,t)=>{const r=Math.cosh(-e/m.$O.radius);t[0]=1,t[1]=n?r:1/r}),i)}function O(e,t,r,i,n){const s=t===N.NORMAL?3:4,o=[0,0];for(let t=0,a=1;t<e.length;t+=s,a+=3){i(r[a],o);const l=e[t]*o[0],c=e[t+1]*o[1],u=e[t+2],h=1/Math.sqrt(l*l+c*c+u*u);n[t]=l*h,n[t+1]=c*h,n[t+2]=u*h,4===s&&(n[t+3]=e[t+3])}return n}function I(e,t,r,i,n){if(!V(D.TO_PCPF,_.xs.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),N.TANGENT,_.Xm.fromTypedArray(t),_.Xm.fromTypedArray(r),i,_.xs.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT)))return null;for(let t=3;t<e.length;t+=4)n[t]=e[t];return n}function L(e,t,r,i,n){if(!V(D.FROM_PCPF,_.xs.fromTypedArray(e,16),N.TANGENT,_.Xm.fromTypedArray(t),_.Xm.fromTypedArray(r),i,_.xs.fromTypedArray(n,16)))return null;for(let t=3;t<e.length;t+=4)n[t]=e[t];return n}var N,D,F;function z(e,t,r,i,s){switch((0,d.l)(i,r,H,i),e===D.FROM_PCPF&&(0,o.B8)(H,H),t){case N.NORMAL:return(0,n.Ge)(s,H);case N.TANGENT:return(0,n.z0)(s,H)}}function V(e,t,r,i,n,s,o){if(!t)return;const a=i.count,c=(0,h.lO)(s);if(function(e){return e.isWGS84||(0,g.x1)(e)||(0,g.q8)(e)||(0,g.KQ)(e)}(s))for(let i=0;i<a;i++)n.getVec(i,G),t.getVec(i,B),(0,l.t)(B,B,z(e,r,G,c,k)),o.setVec(i,B);else for(let s=0;s<a;s++){n.getVec(s,G),t.getVec(s,B);const a=(0,y.jg)(i.get(s,1));let u=Math.cos(a);r===N.TANGENT!=(e===D.TO_PCPF)&&(u=1/u),z(e,r,G,c,k),e===D.TO_PCPF?(k[0]*=u,k[1]*=u,k[2]*=u,k[3]*=u,k[4]*=u,k[5]*=u):(k[0]*=u,k[3]*=u,k[6]*=u,k[1]*=u,k[4]*=u,k[7]*=u),(0,l.t)(B,B,k),(0,l.n)(B,B),o.setVec(s,B)}return o}function U(e){return"local"===e.vertexSpace.type?function({vertexSpace:e,transform:t,inSpatialReference:r,outSpatialReference:i,localMode:n,outPositions:s,positions:l}){const m=e.origin??c.uY,g=null!=e.origin?t?.localMatrix??a.zK:a.zK,y=(0,h.lO)(r),_=i.isWebMercator&&n||!(0,u.canProjectWithoutEngine)(r,y)?r:y;(0,d.l)(r,m,H,_),(0,o.lw)(H,H,g);const b=s??(0,f.jh)(l.length);return(0,v.a)(b,l,H),(0,p.projectBuffer)(b,_,0,b,i,0,b.length/3),b}(e):function({vertexSpace:e,transform:t,outPositions:r,positions:i,inSpatialReference:n,outSpatialReference:s}){const u=null!=e.origin?t?.localMatrix??a.zK:a.zK,h=r??(0,f.jh)(i.length);(0,o.aI)(u,a.zK)?(0,f.s)(h,i):(0,v.a)(h,i,u);const d=e.origin??c.uY;if(!(0,l.e)(d,c.uY)){const[e,t,r]=d;for(let i=0;i<h.length;i+=3)h[i]+=e,h[i+1]+=t,h[i+2]+=r}return(0,p.projectBuffer)(h,n,0,h,s,0,h.length/3)?h:null}(e)}(F=N||(N={}))[F.NORMAL=0]="NORMAL",F[F.TANGENT=1]="TANGENT",function(e){e[e.TO_PCPF=0]="TO_PCPF",e[e.FROM_PCPF=1]="FROM_PCPF"}(D||(D={}));const G=(0,c.vt)(),B=(0,c.vt)(),H=(0,a.vt)(),k=(0,s.vt)()},67376:function(e,t,r){r.d(t,{CK:function(){return d},E9:function(){return u},Hq:function(){return h},MW:function(){return p},TE:function(){return f},yJ:function(){return m}});var i=r(88022),n=r(40633),s=r(20551),o=r(45532),a=r(65907),l=r(20460);function c(){return n.A.getLogger("esri.geometry.Mesh")}function u(e){return!h(e)}function h(e){return null!=e.origin}function d(e){return h(e.vertexSpace)}function p(e,t){if(!h(e))return null;const[r,i,n]=e.origin;return new o.default({x:r,y:i,z:n,spatialReference:t})}function f(e,t){const{x:r,y:n,z:s,spatialReference:o}=e,u=[r,n,s??0];return void 0!==t?.geographic&&((0,i.io)(c(),"option: geographic",{replacement:"Use the `vertexSpace` option instead.",version:"4.29",warnOnce:!0}),t.vertexSpace&&c().warn("Deprecated geographic flag ignored since vertexSpace option is provided.")),"local"===(t?.vertexSpace??(h=t?.geographic,null==h?void 0:h?"local":"georeferenced")??function(e){return e.isGeographic||e.isWebMercator?"local":"georeferenced"}(o))?new l.A({origin:u}):new a.A({origin:u});var h}function m(e,t){return e.type===t.type&&(e.origin===t.origin||null!=e.origin&&null!=t.origin&&(0,s.e)(e.origin,t.origin))}},6527:function(e,t,r){r.d(t,{S:function(){return l}});var i=r(15774),n=r(62938),s=r(20551),o=r(72485),a=r(5596);function l(e,t,r){const l=function(e,t,r,i){const o=(e=>!Array.isArray(e[0]))(t)?(e,r)=>t[3*e+r]:(e,r)=>t[e][r],l=i?(0,n.GA)(i)/(0,n.G9)(i):1;return(0,a.lU)(e,((e,t)=>(0,s.s)(e,o(t,0)*l,o(t,1)*l,o(t,2))),r)}(c,e,t,r)?(0,a.Qj)(c):[0,0,1];return Math.abs(l[2])>Math.cos((0,i.kU)(80))?o._.Z:Math.abs(l[1])>Math.abs(l[0])?o._.Y:o._.X}const c=(0,a.vt)()},87280:function(e,t,r){function i(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance,1,1]:[1,1,1,1],translate:null!=e.extent?[e.extent.xmin,e.extent.ymax,e.extent.zmin??0,e.extent.mmin??0]:[0,0,0,0]}:null}function n(e){if(function(e){return"lowerLeft"===e.originPosition&&4===e.scale.length&&4===e.translate.length}(e))return e;const{originPosition:t,scale:r,translate:i}=e,n=r[0]??1,s=r[1]??1;return{originPosition:"lowerLeft",scale:[n,"lowerLeft"===t?s:-s,r[2]??1,r[3]??1],translate:[i[0]??0,i[1]??0,i[2]??0,i[3]??0]}}function s({scale:e,translate:t},r){return r*e[0]+t[0]}function o({scale:e,translate:t},r){return r*e[1]+t[1]}function a({scale:e,translate:t},r){return(r??0)*e[2]+t[2]}function l({scale:e,translate:t},r){return r?r*e[3]+t[3]:0}function c(e,t){return e&&t?p:e&&!t?h:!e&&t?d:u}r.d(t,{$X:function(){return _},Gy:function(){return m},P5:function(){return v},SW:function(){return g},Tr:function(){return y},VV:function(){return i}}),r(74697);const u=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const i=t[0];let n=s(e,i[0]),a=o(e,i[1]);r[0]=[n,a];const{scale:l,originPosition:c}=e,u=l[0],h="lowerLeft"===c?l[1]:-l[1];for(let e=1;e<t.length;e++){const[i,s]=t[e];n+=u*i,a+=h*s,r[e]=[n,a]}return r},h=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const i=t[0];let n=s(e,i[0]),l=o(e,i[1]);r[0]=[n,l,a(e,i[2])];const{scale:c,originPosition:u}=e,h=c[0],d="lowerLeft"===u?c[1]:-c[1];for(let i=1;i<t.length;i++){const[s,o,c]=t[i];n+=h*s,l+=d*o,r[i]=[n,l,a(e,c)]}return r},d=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const i=t[0];let n=s(e,i[0]),a=o(e,i[1]);r[0]=[n,a,l(e,i[2])];const{scale:c,originPosition:u}=e,h=c[0],d="lowerLeft"===u?c[1]:-c[1];for(let i=1;i<t.length;i++){const[s,o,c]=t[i];n+=h*s,a+=d*o,r[i]=[n,a,l(e,c)]}return r},p=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const i=t[0];let n=s(e,i[0]),c=o(e,i[1]);r[0]=[n,c,a(e,i[2]),l(e,i[3])];const{scale:u,originPosition:h}=e,d=u[0],p="lowerLeft"===h?u[1]:-u[1];for(let i=1;i<t.length;i++){const[s,o,u,h]=t[i];n+=d*s,c+=p*o,r[i]=[n,c,a(e,u),l(e,h)]}return r};function f(e,t,r){const i=new Array(r.length);for(let n=0;n<r.length;n++)i[n]=t(e,r[n]);return i}function m(e,t,r){const i=n(e);return t.x=function({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}(i,r.x),t.y=function({scale:e,translate:t},r){return Math.round((r-t[1])/e[1])}(i,r.y),null!=r.z&&(t.z=function({scale:e,translate:t},r){return Math.round(((r??0)-t[2])/e[2])}(i,r.z)),null!=r.m&&(t.m=function({scale:e,translate:t},r){return r?Math.round((r-t[3])/e[3]):0}(i,r.m)),t}function g(e,t,r,i=r?.hasZ??!1,s=r?.hasM??!1){if(null!=r){const o=n(e);t.points=c(i,s)(o,r.points),t.hasZ=i,t.hasM=s}return t}function y(e,t,r,i=null!=r?.z,c=null!=r?.m){if(null==r)return t;const u=n(e);return t.x=s(u,r.x),t.y=o(u,r.y),i&&(t.z=a(u,r.z)),c&&(t.m=l(u,r.m)),t}function _(e,t,r,i=r?.hasZ??!1,s=r?.hasM??!1){if(null!=r){const o=n(e);t.rings=f(o,c(i,s),r.rings),t.hasZ=i,t.hasM=s}return t}function v(e,t,r,i=r?.hasZ??!1,s=r?.hasM??!1){if(null!=r){const o=n(e);t.paths=f(o,c(i,s),r.paths),t.hasZ=i,t.hasM=s}return t}},67496:function(e,t,r){r.d(t,{Fm:function(){return a},Q7:function(){return l}});var i=r(89736),n=r(20551),s=r(32501),o=r(73313);function a(e,t,r){const i=t[0]-e[0],n=t[1]-e[1],s=r[0]-e[0],o=r[1]-e[1];return.5*Math.abs(i*o-n*s)}function l(e,t,r){return(0,n.f)(c,t,e),(0,n.f)(u,r,e),.5*(0,n.l)((0,n.b)(c,c,u))}r(50973),new i.I(o.vt),new i.I((()=>{return e?{p0:(0,s.o8)(e.p0),p1:(0,s.o8)(e.p1),p2:(0,s.o8)(e.p2)}:{p0:(0,s.vt)(),p1:(0,s.vt)(),p2:(0,s.vt)()};var e}));const c=(0,s.vt)(),u=(0,s.vt)()},82588:function(e,t,r){r.d(t,{Wq:function(){return i},lO:function(){return d},oR:function(){return p}});var i,n,s=r(59122),o=r(72485),a=r(38441),l=r(50240),c=r(37819),u=r(6527),h=r(61003);function d(e){const t=p(e.rings,e.hasZ,i.CCW_IS_HOLE,e.spatialReference),r=new Array;let n=0,o=0;for(const e of t.polygons){const i=e.count,a=e.index,u=(0,l.l5)(t.position,3*a,3*i),h=e.holeIndices.map((e=>e-a)),d=(0,c.Dg)((0,s.e)(u,h,3));r.push({position:u,faces:d}),n+=u.length,o+=d.length}const a=function(e,t,r){if(1===e.length)return e[0];const i=(0,l.jh)(t),n=new Array(r);let s=0,o=0,a=0;for(const t of e){for(let e=0;e<t.position.length;e++)i[s++]=t.position[e];for(const e of t.faces)n[o++]=e+a;a=s/3}return{position:i,faces:(0,c.Dg)(n)}}(r,n,o),u=Array.isArray(a.position)?(0,h.b)(a.position,3,{originalIndices:a.faces}):(0,h.b)(a.position.buffer,6,{originalIndices:a.faces});return a.position=(0,l.xm)(new Float64Array(u.buffer)),a.faces=u.indices,a}function p(e,t,r,n){const s=e.length,o=new Array(s),a=new Array(s),c=new Array(s);let u=0;for(let t=0;t<s;++t)u+=e[t].length;let h=0,d=0,p=0;const g=(0,l.jh)(3*u);let y=0;for(let l=s-1;l>=0;l--){const u=e[l],_=r===i.CCW_IS_HOLE&&m(u,t,n);if(_&&1!==s)o[h++]=u;else{let e=u.length;for(let t=0;t<h;++t)e+=o[t].length;const r={index:y,pathLengths:new Array(h+1),count:e,holeIndices:new Array(h)};r.pathLengths[0]=u.length,u.length>0&&(c[p++]={index:y,count:u.length}),y=_?f(u,u.length-1,-1,g,y,u.length,t):f(u,0,1,g,y,u.length,t);for(let e=0;e<h;++e){const i=o[e];r.holeIndices[e]=y,r.pathLengths[e+1]=i.length,i.length>0&&(c[p++]={index:y,count:i.length}),y=f(i,0,1,g,y,i.length,t)}h=0,r.count>0&&(a[d++]=r)}}for(let e=0;e<h;++e){const r=o[e];r.length>0&&(c[p++]={index:y,count:r.length}),y=f(r,0,1,g,y,r.length,t)}return a.length=d,c.length=p,{position:g,polygons:a,outlines:c}}function f(e,t,r,i,n,s,o){n*=3;for(let a=0;a<s;++a){const s=e[t];i[n++]=s[0],i[n++]=s[1],i[n++]=o?s[2]:0,t+=r}return n/3}function m(e,t,r){if(!t)return!(0,a.$3)(e);const i=e.length-1;switch((0,u.S)(e,i,r)){case o._.X:return!(0,a.$3)(e,o._.Y,o._.Z);case o._.Y:return!(0,a.$3)(e,o._.X,o._.Z);case o._.Z:return!(0,a.$3)(e,o._.X,o._.Y)}}(n=i||(i={}))[n.NONE=0]="NONE",n[n.CCW_IS_HOLE=1]="CCW_IS_HOLE"},65215:function(e,t,r){r.d(t,{N3:function(){return s},Om:function(){return n}});var i=r(76613);class n{constructor(e=null,t={},r,i){this.geometry=e,this.attributes=t,this.centroid=r,this.objectId=i,this.displayId=0,this.geohashX=0,this.geohashY=0}static fromJSON(e,t){const r=e.geometry?i.A.fromJSON(e.geometry):null,s=e.centroid?i.A.fromJSON(e.centroid):null,o=e.attributes[t];return new n(r,e.attributes,s,o)}weakClone(){const e=new n(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}clone(){const e=this.geometry?.clone(),t=new n(e,{...this.attributes},this.centroid?.clone(),this.objectId);return t.displayId=this.displayId,t.geohashX=this.geohashX,t.geohashY=this.geohashY,t}}function s(e){return!!e.geometry?.coords?.length}},72887:function(e,t,r){r.d(t,{A:function(){return i}});class i{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new i;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}}},76613:function(e,t,r){r.d(t,{A:function(){return i}});class i{constructor(e=[],t=[],r=!1){this.lengths=e??[],this.coords=t??[],this.hasIndeterminateRingOrder=r}static fromJSON(e){return new i(e.lengths,e.coords,e.hasIndeterminateRingOrder)}static fromRect(e){const[t,r,n,s]=e,o=n-t,a=s-r;return new i([5],[t,r,o,0,0,a,-o,0,0,-a])}get isPoint(){return 0===this.lengths.length}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce(((e,t)=>e+t))}forEachVertex(e){let t=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const i=this.lengths[r];for(let r=0;r<i;r++)e(this.coords[2*(r+t)],this.coords[2*(r+t)+1]);t+=i}}deltaDecode(){const e=this.clone(),{coords:t,lengths:r}=e;let i=0;for(const e of r){for(let r=1;r<e;r++)t[2*(i+r)]+=t[2*(i+r)-2],t[2*(i+r)+1]+=t[2*(i+r)-1];i+=e}return e}clone(e){if(0===this.lengths.length)return new i([],[this.coords[0],this.coords[1]]);const t=2*(0===this.lengths.length?1:this.lengths.reduce(((e,t)=>e+t))),r=this.coords.slice(0,t);return e?(e.set(r),new i(this.lengths,e,this.hasIndeterminateRingOrder)):new i(Array.from(this.lengths),Array.from(r),this.hasIndeterminateRingOrder)}}},40302:function(e,t,r){function i(e,t){return e?t?4:3:t?3:2}function n(e,t,r,n){if(!t?.lengths.length)return null;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);const a=e.coords,l=[],c=r?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:u,coords:h}=t,d=i(r,n);let p=0;for(const e of u){const t=s(c,h,p,e,r,n);t&&l.push(t),p+=e*d}if(l.sort(((e,t)=>{let i=e[2]-t[2];return 0===i&&r&&(i=e[4]-t[4]),i})),l.length){let e=6*l[0][2];a[0]=l[0][0]/e,a[1]=l[0][1]/e,r&&(e=6*l[0][4],a[2]=0!==e?l[0][3]/e:0),(a[0]<c[0]||a[0]>c[1]||a[1]<c[2]||a[1]>c[3]||r&&(a[2]<c[4]||a[2]>c[5]))&&(a.length=0)}if(!a.length){const e=t.lengths[0]?o(h,0,u[0],r,n):null;if(!e)return null;a[0]=e[0],a[1]=e[1],r&&e.length>2&&(a[2]=e[2])}return e}function s(e,t,r,n,s,o){const a=i(s,o);let l=r,c=r+a,u=0,h=0,d=0,p=0,f=0;for(let r=0,i=n-1;r<i;r++,l+=a,c+=a){const r=t[l],i=t[l+1],n=t[l+2],o=t[c],a=t[c+1],m=t[c+2];let g=r*a-o*i;p+=g,u+=(r+o)*g,h+=(i+a)*g,s&&(g=r*m-o*n,d+=(n+m)*g,f+=g),r<e[0]&&(e[0]=r),r>e[1]&&(e[1]=r),i<e[2]&&(e[2]=i),i>e[3]&&(e[3]=i),s&&(n<e[4]&&(e[4]=n),n>e[5]&&(e[5]=n))}if(p>0&&(p*=-1),f>0&&(f*=-1),!p)return null;const m=[u,h,.5*p];return s&&(m[3]=d,m[4]=.5*f),m}function o(e,t,r,n,s){const o=i(n,s);let h=t,d=t+o,p=0,f=0,m=0,g=0;for(let t=0,i=r-1;t<i;t++,h+=o,d+=o){const t=e[h],r=e[h+1],i=e[h+2],s=e[d],o=e[d+1],y=e[d+2],_=n?l(t,r,i,s,o,y):a(t,r,s,o);if(_)if(p+=_,n){const e=u(t,r,i,s,o,y);f+=_*e[0],m+=_*e[1],g+=_*e[2]}else{const e=c(t,r,s,o);f+=_*e[0],m+=_*e[1]}}return p>0?n?[f/p,m/p,g/p]:[f/p,m/p]:r>0?n?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}function a(e,t,r,i){const n=r-e,s=i-t;return Math.sqrt(n*n+s*s)}function l(e,t,r,i,n,s){const o=i-e,a=n-t,l=s-r;return Math.sqrt(o*o+a*a+l*l)}function c(e,t,r,i){return[e+.5*(r-e),t+.5*(i-t)]}function u(e,t,r,i,n,s){return[e+.5*(i-e),t+.5*(n-t),r+.5*(s-r)]}r.d(t,{Q:function(){return n}})},51376:function(e,t,r){function i(e,t,r){return{objectId:e,target:t,distance:r,type:"vertex"}}function n(e,t,r,i,n,s=!1){return{objectId:e,target:t,distance:r,type:"edge",start:i,end:n,draped:s}}r.d(t,{P:function(){return n},k:function(){return i}})},46805:function(e,t,r){r.d(t,{T:function(){return o}});var i=r(40302),n=r(65215),s=r(76613);const o={getObjectId:e=>e.objectId,getAttributes:e=>e.attributes,getAttribute:(e,t)=>e.attributes[t],cloneWithGeometry:(e,t)=>new n.Om(t,e.attributes,null,e.objectId),getGeometry:e=>e.geometry,getCentroid:(e,t)=>(null==e.centroid&&(e.centroid=(0,i.Q)(new s.A,e.geometry,t.hasZ,t.hasM)),e.centroid)}},42413:function(e,t,r){r.d(t,{CI:function(){return s},fk:function(){return o}}),r(58941);var i=r(15774),n=r(57652);function s(e,t){return e===t||null!=e&&null!=t&&(0,n.aI)(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function o(e,t,r){return e===t||null!=e&&null!=t&&(0,n.aI)(e.spatialReference,t.spatialReference)&&(0,i.Sp)(e.x,t.x,r)&&(0,i.Sp)(e.y,t.y,r)&&(0,i.Sp)(e.z??0,t.z??0,r)&&(0,i.Sp)(e.m??0,t.m??0,r)}},5915:function(e,t,r){function i(e){return"point"===e.type}r.d(t,{v:function(){return i}})},37151:function(e,t,r){r.d(t,{HP:function(){return s},N3:function(){return o},RW:function(){return u},Uz:function(){return h},iQ:function(){return c},jy:function(){return a},w9:function(){return l}}),r(58941),r(24540),r(57165);var i=r(24761),n=r(87416);r(87280),r(63319),r(56740),r(42413);class s{constructor(e,t,r){this.uid=e,this.geometry=t,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}}function o(e){return null!=e.geometry}class a{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function l(e,t){switch((0,i.Ie)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let r=0;r<e.paths.length;r++)(0,i.Jf)(t,e.paths[r],!!e.hasZ);break;case"polygon":for(let r=0;r<e.rings.length;r++)(0,i.Jf)(t,e.rings[r],!!e.hasZ);break;case"multipoint":(0,i.Jf)(t,e.points,!!e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax)}}function c(e,t){switch((0,n.Ie)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let r=0;r<e.paths.length;r++)(0,n.Jf)(t,e.paths[r]);break;case"polygon":for(let r=0;r<e.rings.length;r++)(0,n.Jf)(t,e.rings[r]);break;case"multipoint":(0,n.Jf)(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function u(e,t){return null!=e.objectId?e.objectId:e.attributes&&t?e.attributes[t]:null}function h(e,t,r,i){if(t?.size&&null!=r&&e)for(const n in e){if(!t.has(n))continue;const s=e[n];"string"==typeof s&&s.length>r&&(i(n),e[n]="")}}},58081:function(e,t,r){r.d(t,{B2:function(){return x},BW:function(){return F},Ch:function(){return ne},DF:function(){return w},Di:function(){return j},E2:function(){return k},IE:function(){return b},Nl:function(){return K},Q4:function(){return se},Rk:function(){return ae},Ux:function(){return q},Ye:function(){return U},ZF:function(){return Y},eU:function(){return G},eY:function(){return J},jH:function(){return Q},jQ:function(){return ie},kz:function(){return ee},oN:function(){return W},q3:function(){return X},qK:function(){return N},qN:function(){return L},z5:function(){return V},zv:function(){return Z}});var i=r(39819),n=r(40633),s=r(95929),o=r(24761),a=r(87416),l=r(74697),c=r(65215),u=r(72887),h=r(76613);function d(e,t){return e?t?4:3:t?3:2}const p=()=>n.A.getLogger("esri.layers.graphics.featureConversionUtils"),f={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},m=(e,t,r,i,n,s)=>{e[r]=n,e[r+1]=s},g=(e,t,r,i,n,s)=>{e[r]=n,e[r+1]=s,e[r+2]=t[i+2]},y=(e,t,r,i,n,s)=>{e[r]=n,e[r+1]=s,e[r+2]=t[i+3]},_=(e,t,r,i,n,s)=>{e[r]=n,e[r+1]=s,e[r+2]=t[i+2],e[r+3]=t[i+3]};function v(e,t,r,i){if(e){if(r)return t&&i?_:g;if(t&&i)return y}else if(t&&i)return g;return m}function b({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function x({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function S({scale:e,translate:t},r,i){return r*e[i]+t[i]}function w(e,t,r){return e?t?r?P(e):C(e):r?M(e):T(e):null}function T(e){const t=e.coords;return{x:t[0],y:t[1]}}function A(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function C(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function E(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function M(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function R(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function P(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function O(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function I(e,t){return e&&t?O:e?E:t?R:A}function L(e,t,r=I(null!=t.z,null!=t.m)){return r(e,t)}function N(e,t,r){if(null==e)return null;const i=d(t,r),n=[];for(let t=0;t<e.coords.length;t+=i){const r=[];for(let n=0;n<i;n++)r.push(e.coords[t+n]);n.push(r)}return t?r?{points:n,hasZ:t,hasM:r}:{points:n,hasZ:t}:r?{points:n,hasM:r}:{points:n}}function D(e,t,r=d(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const i=e.coords;let n=0;for(const e of t.points)for(let t=0;t<r;t++)i[n++]=e[t];return e}function F(e,t,r){if(!e)return null;const i=d(t,r),{coords:n,lengths:s}=e,o=[];let a=0;for(const e of s){const t=[];for(let r=0;r<e;r++){const e=[];for(let t=0;t<i;t++)e.push(n[a++]);t.push(e)}o.push(t)}return t?r?{paths:o,hasZ:t,hasM:r}:{paths:o,hasZ:t}:r?{paths:o,hasM:r}:{paths:o}}function z(e,t,r=d(t.hasZ,t.hasM)){const{lengths:i,coords:n}=e;let s=0;for(const e of t.paths){for(const t of e)for(let e=0;e<r;e++)n[s++]=t[e];i.push(e.length)}return e}function V(e,t,r){if(!e)return null;const i=d(t,r),{coords:n,lengths:s}=e,o=[];let a=0;for(const e of s){const t=[];for(let r=0;r<e;r++){const e=[];for(let t=0;t<i;t++)e.push(n[a++]);t.push(e)}o.push(t)}return t?r?{rings:o,hasZ:t,hasM:r}:{rings:o,hasZ:t}:r?{rings:o,hasM:r}:{rings:o}}function U(e,t,r=t.hasZ,i=t.hasM){return G(e,t.rings,r,i)}function G(e,t,r,i){const n=d(r,i),{lengths:s,coords:o}=e;let a=0;le(e);for(const e of t){for(const t of e)for(let e=0;e<n;e++)o[a++]=t[e];s.push(e.length)}return e}const B=[],H=[];function k(e,t,r,i,n){B[0]=e;const[s]=j(H,B,t,r,i,n);return ce(B),ce(H),s}function j(e,t,r,n,s,o){if(ce(e),!r){for(const r of t){const t=o?r.attributes[o]:void 0;e.push(new c.Om(null,r.attributes,null,t))}return e}switch(r){case"esriGeometryPoint":return function(e,t,r,i,n){const s=I(r,i);for(const{geometry:r,attributes:i}of t){const t=null!=r?s(new h.A,r):null;e.push(new c.Om(t,i,null,n?i[n]:void 0))}return e}(e,t,n,s,o);case"esriGeometryMultipoint":return function(e,t,r,i,n){const s=d(r,i);for(const{geometry:r,attributes:i}of t){const t=null!=r?D(new h.A,r,s):null;e.push(new c.Om(t,i,null,n?i[n]:void 0))}return e}(e,t,n,s,o);case"esriGeometryPolyline":return function(e,t,r,i,n){const s=d(r,i);for(const{geometry:r,attributes:i,centroid:o}of t){const t=null!=r?z(new h.A,r,s):null,a=null!=o?L(new h.A,o):null;e.push(new c.Om(t,i,a,n?i[n]:void 0))}return e}(e,t,n,s,o);case"esriGeometryPolygon":return function(e,t,r,i,n){for(const{geometry:s,centroid:o,attributes:a}of t){const t=null!=s?U(new h.A,s,r,i):null,l=n?a[n]:void 0;null!=o?e.push(new c.Om(t,a,A(new h.A,o),l)):e.push(new c.Om(t,a,null,l))}return e}(e,t,n,s,o);default:p().error("convertToFeatureSet:unknown-geometry",new i.A(`Unable to parse unknown geometry type '${r}'`)),ce(e)}return e}function W(e,t,r,i){H[0]=e,$(B,H,t,r,i);const n=B[0];return ce(B),ce(H),n}function q(e,t,r){if(null==e)return null;const n=new h.A;return"hasZ"in e&&null==t&&(t=e.hasZ),"hasM"in e&&null==r&&(r=e.hasM),(0,l.fT)(e)?I(null!=t?t:null!=e.z,null!=r?r:null!=e.m)(n,e):(0,l.Bi)(e)?U(n,e,t,r):(0,l.Rg)(e)?z(n,e,d(t,r)):(0,l.U9)(e)?D(n,e,d(t,r)):void p().error("convertFromGeometry:unknown-geometry",new i.A(`Unable to parse unknown geometry type '${e}'`))}function Z(e,t,r,n){const s=e&&("coords"in e?e:e.geometry);if(null==s)return null;switch(t){case"esriGeometryPoint":{let e=T;return r&&n?e=P:r?e=C:n&&(e=M),e(s)}case"esriGeometryMultipoint":return N(s,r,n);case"esriGeometryPolyline":return F(s,r,n);case"esriGeometryPolygon":return V(s,r,n);default:return p().error("convertToGeometry:unknown-geometry",new i.A(`Unable to parse unknown geometry type '${t}'`)),null}}function $(e,t,r,n,s){if(ce(e),null==r)return function(e,t){for(const r of t)e.push({attributes:r.attributes});return e}(e,t);switch(r){case"esriGeometryPoint":return function(e,t,r,i){let n=T;r&&i?n=P:r?n=C:i&&(n=M);for(const r of t){const{geometry:t,attributes:i}=r,s=null!=t?n(t):null;e.push({attributes:i,geometry:s})}return e}(e,t,n,s);case"esriGeometryMultipoint":return function(e,t,r,i){for(const{geometry:n,attributes:s}of t)e.push({attributes:s,geometry:null!=n?N(n,r,i):null});return e}(e,t,n,s);case"esriGeometryPolyline":return function(e,t,r,i){for(const{geometry:n,attributes:s}of t)e.push({attributes:s,geometry:null!=n?F(n,r,i):null});return e}(e,t,n,s);case"esriGeometryPolygon":return function(e,t,r,i){for(const{geometry:n,attributes:s,centroid:o}of t){const t=null!=n?V(n,r,i):null;if(null!=o){const r=T(o);e.push({attributes:s,centroid:r,geometry:t})}else e.push({attributes:s,geometry:t})}return e}(e,t,n,s);default:p().error("convertToFeatureSet:unknown-geometry",new i.A(`Unable to parse unknown geometry type '${r}'`))}return e}function Y(e){const{objectIdFieldName:t,spatialReference:r,transform:i,fields:n,hasM:s,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:u,queryGeometry:h,queryGeometryType:d}=e,p={features:$([],a,l,o,s),fields:n,geometryType:l,objectIdFieldName:t,spatialReference:r,uniqueIdField:u,queryGeometry:Z(h,d,!1,!1)};return i&&(p.transform=i),c&&(p.exceededTransferLimit=c),s&&(p.hasM=s),o&&(p.hasZ=o),p}function X(e,t){const r=new u.A,{hasM:n,hasZ:s,features:o,objectIdFieldName:a,spatialReference:l,geometryType:c,exceededTransferLimit:h,transform:d,fields:f}=e;return f&&(r.fields=f),r.geometryType=c??null,r.objectIdFieldName=a??t??null,r.spatialReference=l??null,r.objectIdFieldName?(o&&j(r.features,o,c,s,n,r.objectIdFieldName),h&&(r.exceededTransferLimit=h),n&&(r.hasM=n),s&&(r.hasZ=s),d&&(r.transform=d),r):(p().error(new i.A("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function J(e){const{transform:t,features:r,hasM:i,hasZ:n}=e;if(!t)return e;for(const e of r)null!=e.geometry&&ne(e.geometry,e.geometry,i,n,t),null!=e.centroid&&ne(e.centroid,e.centroid,i,n,t);return e.transform=null,e}function Q(e,t){const{geometryType:r,features:i,hasM:n,hasZ:s}=t;if(!e)return t;for(let t=0;t<i.length;t++){const o=i[t],a=o.weakClone();a.geometry=new h.A,K(a.geometry,o.geometry,n,s,r,e),o.centroid&&(a.centroid=new h.A,K(a.centroid,o.centroid,n,s,"esriGeometryPoint",e)),i[t]=a}return t.transform=e,t}function K(e,t,r,i,n,s,o=r,a=i){if(le(e),!t?.coords.length)return null;const l=f[n],{coords:c,lengths:u}=t,h=d(r,i),p=d(r&&o,i&&a),m=v(r,i,o,a);if(!u.length)return m(e.coords,c,0,0,b(s,c[0]),x(s,c[1])),le(e,h,0),e;let g,y,_,S,w=0,T=0,A=T;for(const t of u){if(t<l)continue;let r=0;T=A,_=g=b(s,c[w]),S=y=x(s,c[w+1]),m(e.coords,c,T,w,_,S),r++,w+=h,T+=p;for(let i=1;i<t;i++,w+=h)_=b(s,c[w]),S=x(s,c[w+1]),_===g&&S===y||(m(e.coords,c,T,w,_-g,S-y),T+=p,r++,g=_,y=S);r>=l&&(e.lengths.push(r),A=T)}return ce(e.coords,A),e.coords.length?e:null}function ee(e,t,r,i,n,s,o=r,a=i){if(le(e),!t?.coords.length)return null;const l=f[n],{coords:c,lengths:u}=t,h=d(r,i),p=d(r&&o,i&&a),m=v(r,i,o,a);if(!u.length)return m(e.coords,c,0,0,c[0],c[1]),le(e,h,0),e;let g=0;const y=s*s;for(const t of u){if(t<l){g+=t*h;continue}const r=e.coords.length/p,i=g,n=g+(t-1)*h;m(e.coords,c,e.coords.length,i,c[i],c[i+1]),re(e.coords,c,h,y,m,i,n),m(e.coords,c,e.coords.length,n,c[n],c[n+1]);const s=e.coords.length/p-r;s>=l?e.lengths.push(s):ce(e.coords,r*p),g+=t*h}return e.coords.length?e:null}function te(e,t,r,i){const n=e[t],s=e[t+1],o=e[r],a=e[r+1],l=e[i],c=e[i+1];let u=o,h=a,d=l-u,p=c-h;if(0!==d||0!==p){const e=((n-u)*d+(s-h)*p)/(d*d+p*p);e>1?(u=l,h=c):e>0&&(u+=d*e,h+=p*e)}return d=n-u,p=s-h,d*d+p*p}function re(e,t,r,i,n,s,o){let a,l=i,c=0;for(let e=s+r;e<o;e+=r)a=te(t,e,s,o),a>l&&(c=e,l=a);l>i&&(c-s>r&&re(e,t,r,i,n,s,c),n(e,t,e.length,c,t[c],t[c+1]),o-c>r&&re(e,t,r,i,n,c,o))}function ie(e,t,r,i){if(!t?.coords?.length)return null;const n=d(r,i);let s=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,u=Number.NEGATIVE_INFINITY;if(t&&t.coords){const e=t.coords;for(let t=0;t<e.length;t+=n){const r=e[t],i=e[t+1];s=Math.min(s,r),c=Math.max(c,r),l=Math.min(l,i),u=Math.max(u,i)}}return(0,o.is)(e)?(0,o.BI)(e,s,l,c,u):(0,a.fA)(s,l,c,u,e),e}function ne(e,t,r,i,n){const{coords:o,lengths:a}=t,l=d(r,i);if(!o.length)return e!==t&&le(e),e;(0,s.Lw)(n);const{originPosition:c,scale:u,translate:h}=n,p=ue;p.originPosition=c;const f=p.scale;f[0]=u[0]??1,f[1]=-(u[1]??1),f[2]=u[2]??1,f[3]=u[3]??1;const m=p.translate;if(m[0]=h[0]??0,m[1]=h[1]??0,m[2]=h[2]??0,m[3]=h[3]??0,!a.length){for(let t=0;t<l;++t)e.coords[t]=S(p,o[t],t);return e!==t&&le(e,l,0),e}let g=0;for(let t=0;t<a.length;t++){const r=a[t];e.lengths[t]=r;for(let t=0;t<l;++t)e.coords[g+t]=S(p,o[g+t],t);let i=e.coords[g],n=e.coords[g+1];g+=l;for(let t=1;t<r;t++,g+=l){i+=o[g]*f[0],n+=o[g+1]*f[1],e.coords[g]=i,e.coords[g+1]=n;for(let t=2;t<l;++t)e.coords[g+t]=S(p,o[g+t],t)}}return e!==t&&le(e,o.length,a.length),e}function se(e,t,r,i,n,s){if(le(e),e.lengths.push(...t.lengths),r===n&&i===s)for(let r=0;r<t.coords.length;r++)e.coords.push(t.coords[r]);else{const o=d(r,i),a=v(r,i,n,s),l=t.coords;for(let t=0;t<l.length;t+=o)a(e.coords,l,e.coords.length,t,l[t],l[t+1])}return e}function oe(e,t,r,i){let n=0,s=e[i*t],o=e[i*(t+1)];for(let a=1;a<r;a++){const r=s+e[i*(t+a)],l=o+e[i*(t+a)+1],c=(r-s)*(l+o);s=r,o=l,n+=c}return.5*n}function ae(e,t){const{coords:r,lengths:i}=e;let n=0,s=0;for(let e=0;e<i.length;e++){const o=i[e];s+=oe(r,n,o,t),n+=o}return Math.abs(s)}function le(e,t=0,r=0){ce(e.lengths,r),ce(e.coords,t)}function ce(e,t=0){e.length!==t&&(e.length=t)}const ue={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]}},45328:function(e,t,r){r.d(t,{EL:function(){return g},RS:function(){return y},gr:function(){return c},wP:function(){return h},wZ:function(){return d}}),r(50917);var i=r(59469),n=(r(58941),r(21609)),s=r(24540),o=r(74697),a=r(46460),l=r(57165);function c(e){return"declaredClass"in e}function u(e){return"declaredClass"in e}function h(e,t){return e?"declaredClass"in e?e:new i.default({layer:t,sourceLayer:t,visible:e.visible,symbol:(0,n.o8)(e.symbol),attributes:(0,n.o8)(e.attributes),geometry:d(e.geometry)}):null}function d(e){return null==e?null:c(e)?e:(0,o.rS)(function(e){const{wkid:t,wkt:r,wkt2:i,latestWkid:n}=e.spatialReference,s={wkid:t,wkt:r,wkt2:i,latestWkid:n};switch(e.type){case"point":{const{x:t,y:r,z:i,m:n}=e;return{x:t,y:r,z:i,m:n,spatialReference:s}}case"polygon":{const{rings:t,hasZ:r,hasM:i}=e;return{rings:p(t),hasZ:r,hasM:i,spatialReference:s}}case"polyline":{const{paths:t,hasZ:r,hasM:i}=e;return{paths:p(t),hasZ:r,hasM:i,spatialReference:s}}case"extent":{const{xmin:t,xmax:r,ymin:i,ymax:n,zmin:o,zmax:a,mmin:l,mmax:c,hasZ:u,hasM:h}=e;return{xmin:t,xmax:r,ymin:i,ymax:n,zmin:o,zmax:a,mmin:l,mmax:c,hasZ:u,hasM:h,spatialReference:s}}case"multipoint":{const{points:t,hasZ:r,hasM:i}=e;return{points:m(t)?f(t):t,hasZ:r,hasM:i,spatialReference:s}}default:return}}(e))}function p(e){return function(e){for(const t of e)if(0!==t.length)return m(t);return!1}(e)?e.map((e=>f(e))):e}function f(e){return e.map((e=>Array.from(e)))}function m(e){return e.length>0&&((0,s.vZ)(e[0])||(0,s.aI)(e[0]))}function g(e,t){if(!e)return null;let r;if(u(e)){if(null==t)return e.clone();if(u(t))return t.copy(e)}return null!=t?(r=t,r.x=e.x,r.y=e.y,r.spatialReference=e.spatialReference,e.hasZ?(r.z=e.z,r.hasZ=e.hasZ):(r.z=void 0,r.hasZ=!1),e.hasM?(r.m=e.m,r.hasM=!0):(r.m=void 0,r.hasM=!1)):(r=(0,a.T)(e.x,e.y,e.z,e.spatialReference),e.hasM&&(r.m=e.m,r.hasM=!0)),r}function y(e){const{wkid:t,wkt:r,wkt2:i,latestWkid:n}=e,s={wkid:t,wkt:r,wkt2:i,latestWkid:n};return l.A.fromJSON(s)}},14921:function(e,t,r){var i;r.d(t,{$:function(){return i}}),function(e){e[e.EnableFastUpdates=0]="EnableFastUpdates",e[e.DisableFastUpdates=1]="DisableFastUpdates",e[e.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"}(i||(i={}))},7103:function(e,t,r){r.d(t,{A:function(){return d}});var i=r(39819),n=r(30905),s=r(40633),o=r(25738),a=r(92955),l=r(53743),c=r(21168),u=r(3569);const h=new Map;class d{static fromJSON(e){return new d(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new d(e.fields??[],g(e))}static fromLayerJSON(e){return new d(e.fields??[],g(e))}constructor(e=[],t){this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=t?new Map(t):null;const r=[];for(const e of this.fields){const t=e?.name,i=f(t);if(t&&i){const n=p(t);this._fieldsMap.set(t,e),this._fieldsMap.set(n,e),this._normalizedFieldsMap.set(i,e),r.push(`${n}:${e.type}:${this._timeZoneByFieldName?.get(t)}`),(0,l.vE)(e)?(this.dateFields.push(e),this._dateFieldsSet.add(e)):(0,l.WA)(e)&&(this._numericFieldsSet.add(e),this.numericFields.push(e)),(0,l.te)(e)||(0,l.Xz)(e)||(e.editable=null==e.editable||!!e.editable,e.nullable=null==e.nullable||!!e.nullable)}}r.sort(),this.uid=r.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)(0,l.te)(e)||(0,l.Xz)(e)||e.nullable||void 0!==(0,l.lD)(e)||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===e?.uid}has(e){return null!=this.get(e)}get(e){if(!e)return;let t=this._fieldsMap.get(e);return t||(t=this._fieldsMap.get(p(e))??this._normalizedFieldsMap.get(f(e)),t&&this._fieldsMap.set(e,t),t)}getTimeZone(e){const t=this.get(e&&"string"!=typeof e?e.name:e);return t?this._timeZoneByFieldName?this._timeZoneByFieldName.get(t.name):"date"===t.type||"esriFieldTypeDate"===t.type?(s.A.getLogger("esri.layers.support.FieldsIndex").error(new i.A("getTimeZone:no-timezone-information",`no time zone information for field '${t.name}'`)),c.n$):m.has(t.type)?c.L5:null:null}getLuxonTimeZone(e){const t=this.getTimeZone(e);return t?t===c.L5?a.GB.instance:t===c.n$?u.mQ.utcInstance:(0,o.tE)(h,t,(()=>u.oh.create(t))):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return(0,l.OH)(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){return this.get(e)?.name??void 0}toJSON(){return{fields:this.fields.map((e=>(0,n.Wj)(e)?e.toJSON():e)),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}}function p(e){return e.trim().toLowerCase()}function f(e){return(0,l.rS)(e)?.toLowerCase()??""}const m=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function g(e){const t=new Map;if(!e.fields)return t;const r=!0===e.datesInUnknownTimezone,{timeInfo:i,editFieldsInfo:n}=e,s=(i?"startField"in i?i.startField:i.startTimeField:"")??"",o=(i?"endField"in i?i.endField:i.endTimeField:"")??"",a=function(e){return"dateFieldsTimeZone"in e}(e)?e.dateFieldsTimeZone??null:e.dateFieldsTimeReference?(0,c.ZS)(e.dateFieldsTimeReference):null,l=n?function(e){return"timeZone"in e}(n)?n.timeZone??a:n.dateFieldsTimeReference?(0,c.ZS)(n.dateFieldsTimeReference):a??c.n$:null,u=i?function(e){return"timeZone"in e}(i)?i.timeZone??a:i.timeReference?(0,c.ZS)(i.timeReference):a:null,h=new Map([[p(n?.creationDateField??""),l],[p(n?.editDateField??""),l],[p(s),u],[p(o),u]]);for(const{name:i,type:n}of e.fields)if(m.has(n))t.set(i,c.L5);else if("date"!==n&&"esriFieldTypeDate"!==n)t.set(i,null);else if(r)t.set(i,c.L5);else{const e=h.get(p(i??""))??a;t.set(i,e)}return t}},47558:function(e,t,r){r.d(t,{T:function(){return o}});var i=r(60539),n=r(85445),s=r(55213);class o{constructor(){this._tasks=new Array,this._runningTasks=(0,n.v)(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(e){if(0===this.length)return s.G;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,r){return++this._runningTasks.value,new Promise(((i,n)=>this._tasks.push(new a(i,n,e,t,r)))).finally((()=>--this._runningTasks.value))}unshift(e,t,r){return++this._runningTasks.value,new Promise(((i,n)=>this._tasks.unshift(new a(i,n,e,t,r)))).finally((()=>--this._runningTasks.value))}_process(e){if(0===this._tasks.length)return!1;const t=this._tasks.shift();try{const r=(0,i.G4)(t.signal);if(r&&!t.abortCallback)t.reject((0,i.NK)());else{const n=r?t.abortCallback?.((0,i.NK)()):t.callback(e);(0,i.$X)(n)?n.then(t.resolve,t.reject):t.resolve(n)}}catch(e){t.reject(e)}return!0}cancelAll(){const e=(0,i.NK)();for(const t of this._tasks)if(t.abortCallback){const r=t.abortCallback(e);t.resolve(r)}else t.reject(e);this._tasks.length=0}}class a{constructor(e,t,r,i=void 0,n=void 0){this.resolve=e,this.reject=t,this.callback=r,this.signal=i,this.abortCallback=n}}},93389:function(e,t,r){r.d(t,{Fi:function(){return u},HZ:function(){return y},Jf:function(){return g},LS:function(){return _},Wo:function(){return m},bd:function(){return v},cr:function(){return p},iz:function(){return d},qg:function(){return h},yG:function(){return f}});var i=r(90683),n=r(60534);const s={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",knowledgegraphserver:"KnowledgeGraphServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer","3dtilesserver":"3DTilesServer",videoserver:"VideoServer"},o=Object.values(s),a=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${o.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),l=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^/\\n]+)\\/(${o.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),c=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function u(e){return a.test(e)}function h(e){if(null==e)return null;const t=(0,i.An)(e),r=t?.path.match(a)||t?.path.match(l);if(!r)return null;const[,n,o,c,u]=r,h=o.indexOf("/");return{title:p(-1!==h?o.slice(h+1):o),serverType:s[c.toLowerCase()],sublayer:null!=u&&""!==u?parseInt(u,10):null,url:{path:n}}}function d(e){const t=(0,i.An)(e).path.match(c);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function p(e){return(e=e.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function f(e,t){const r=[];if(e){const t=h(e);null!=t&&t.title&&r.push(t.title)}if(t){const e=p(t);r.push(e)}if(2===r.length){if(r[0].toLowerCase().includes(r[1].toLowerCase()))return r[0];if(r[1].toLowerCase().includes(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function m(e){let t=(0,i.$z)(e,!0);return!!t&&(t=t.toLowerCase(),t.endsWith(".arcgis.com")&&(t.startsWith("services")||t.startsWith("tiles")||t.startsWith("features")))}function g(e,t){return e?(0,i.UC)((0,i.zi)(e,t)):e}function y(e){let{url:t}=e;if(!t)return{url:t};t=(0,i.zi)(t,e.logger);const r=(0,i.An)(t),n=h(r.path);let s;if(null!=n)null!=n.sublayer&&null==e.layer.layerId&&(s=n.sublayer),t=n.url.path;else if(e.nonStandardUrlAllowed){const e=d(r.path);null!=e&&(t=e.serviceUrl,s=e.sublayerId)}return{url:(0,i.UC)(t),layerId:s}}function _(e,t,r,s,o){(0,n.w)(t,s,"url",o),s.url&&null!=e.layerId&&(s.url=(0,i.fj)(s.url,r,e.layerId.toString()))}function v(e){if(!e)return!1;const t=e.toLowerCase(),r=t.includes("/services/"),i=t.includes("/mapserver/wmsserver"),n=t.includes("/imageserver/wmsserver"),s=t.includes("/wmsserver");return r&&(i||n||s)}},43173:function(e,t,r){r.r(t),r.d(t,{default:function(){return R}});var i=r(53804),n=r(53216),s=r(39819),o=r(30905),a=r(21609),l=r(31609),c=r(90683),u=r(23502),h=r(67888),d=r(47332),p=r(65953),f=r(91484),m=r(51432),g=r(83525),y=r(40633),_=r(77560);r(13798),r(58941);let v=class extends g.A{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e?.portalItem&&e.path?{...e,path:b(e.path,e.portalItem)}:e}set path(e){null!=e&&(0,c.oP)(e)?y.A.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return b(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",t){const r=this.cdnUrl;if(null==r)throw new s.A("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(r,{responseType:e,query:{token:this.portalItem.apiKey},signal:t?.signal})}async update(e,t){const{addOrUpdateResources:i}=await r.e(4460).then(r.bind(r,55597));return await i(this.portalItem,[{resource:this,content:e,compress:t?.compress,access:t?.access}],"update",t),this}hasPath(){return null!=this.path}};function b(e,t){return null==e?e:(e=e.replace(/^\/+/,""),null!=t&&(0,c.oP)(e)&&(e=(0,c.V1)(e,t.itemUrl)),e?.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}(0,i._)([(0,u.MZ)()],v.prototype,"portalItem",void 0),(0,i._)([(0,u.MZ)({type:String,value:null})],v.prototype,"path",null),(0,i._)([(0,_.w)("path")],v.prototype,"_castPath",null),(0,i._)([(0,u.MZ)({type:String,readOnly:!0})],v.prototype,"url",null),(0,i._)([(0,u.MZ)({type:String,readOnly:!0})],v.prototype,"cdnUrl",null),(0,i._)([(0,u.MZ)({type:String,readOnly:!0})],v.prototype,"itemRelativeUrl",null),v=(0,i._)([(0,p.$)("esri.portal.PortalItemResource")],v);const x=v;let S=class extends g.A{constructor(e){super(e),this.created=null,this.rating=null}};(0,i._)([(0,u.MZ)()],S.prototype,"created",void 0),(0,i._)([(0,u.MZ)()],S.prototype,"rating",void 0),S=(0,i._)([(0,p.$)("esri.portal.PortalRating")],S);const w=S;var T,A=r(60534);const C=new Set(["3DTiles Service","CSV","Feature Collection","Feature Service","Feed","GeoJson","Group Layer","Image Service","KML","Map Service","Media Layer","Scene Service","Stream Service","Vector Tile Service","WFS","WMS","WMTS"]),E=new Set(["KML","GeoJson","CSV"]);let M=T=class extends((0,o.Te)(l.A)){static from(e){return(0,h.PZ)(T,e)}constructor(e){super(e),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const e=this.type,t=this.typeKeywords||[];let r=e;return"Feature Service"===e||"Feature Collection"===e?r=t.includes("Table")?"Table":t.includes("Route Layer")?"Route Layer":t.includes("Markup")?"Markup":"Feature Layer":"Image Service"===e?r=t.includes("Elevation 3D Layer")?"Elevation Layer":t.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":"Scene Service"===e?r="Scene Layer":"Video Service"===e?r="Video Layer":"Scene Package"===e?r="Scene Layer Package":"Stream Service"===e?r="Feature Layer":"Geoprocessing Service"===e?r=t.includes("Web Tool")?"Tool":"Geoprocessing Service":"Geoenrichment Service"===e?r="GeoEnrichment Service":"Geocoding Service"===e?r="Locator":"Microsoft Powerpoint"===e?r="Microsoft PowerPoint":"GeoJson"===e?r="GeoJSON":"Globe Service"===e?r="Globe Layer":"Vector Tile Service"===e?r="Tile Layer":"netCDF"===e?r="NetCDF":"Map Service"===e?r=t.includes("Spatiotemporal")||!t.includes("Hosted Service")&&!t.includes("Tiled")||t.includes("Relational")?"Map Image Layer":"Tile Layer":e?.toLowerCase().includes("add in")?r=e.replaceAll(/(add in)/gi,"Add-In"):"datastore catalog service"===e?r="Big Data File Share":"Compact Tile Package"===e?r="Tile Package (tpkx)":"Raster function template"===e?r="Raster Function Template":"OGCFeatureServer"===e?r="OGC Feature Layer":"web mapping application"===e&&t.includes("configurableApp")?r="Instant App":"Insights Page"===e?r="Insights Report":"Excalibur Imagery Project"===e?r="Excalibur Project":"3DTiles Service"===e?r="3D tiles layer":"3DTiles Package"===e&&(r="3D tiles package"),r}readExtent(e){return e&&e.length?new f.default(e[0][0],e[0][1],e[1][0],e[1][1]):null}get iconUrl(){const e=this.type?.toLowerCase()||"",t=this.typeKeywords||[];let r,i=!1,s=!1,o=!1,a=!1,l=!1,c=!1,u=!1,h=!1;return e.indexOf("service")>0||"feature collection"===e||"kml"===e||"wms"===e||"wmts"===e||"wfs"===e?(i=t.includes("Hosted Service"),"feature service"===e||"feature collection"===e||"kml"===e||"wfs"===e?(s=t.includes("Table"),o=t.includes("Route Layer"),a=t.includes("Markup"),l=t.includes("Spatiotemporal"),c=t.includes("UtilityNetwork"),r=l&&s?"spatiotemporaltable":s?"table":o?"routelayer":a?"markup":l?"spatiotemporal":c?"utilitynetwork":i?"featureshosted":"features"):"map service"===e||"wms"===e||"wmts"===e?(l=t.includes("Spatiotemporal"),u=t.includes("Relational"),r=l||u?"mapimages":i||t.includes("Tiled")||"wmts"===e?"maptiles":"mapimages"):r="scene service"===e?t.includes("Line")?"sceneweblayerline":t.includes("3DObject")?"sceneweblayermultipatch":t.includes("Point")?"sceneweblayerpoint":t.includes("IntegratedMesh")?"sceneweblayermesh":t.includes("PointCloud")?"sceneweblayerpointcloud":t.includes("Polygon")?"sceneweblayerpolygon":t.includes("Building")?"sceneweblayerbuilding":t.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":"image service"===e?t.includes("Elevation 3D Layer")?"elevationlayer":t.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":"stream service"===e?"streamlayer":"vector tile service"===e?"vectortile":"datastore catalog service"===e?"datastorecollection":"geocoding service"===e?"geocodeservice":"video service"===e?t.includes("Live Stream")?"livestreamvideolayer":"videolayer":"geoprocessing service"===e?t.includes("Web Tool")?"tool":"layers":"geodata service"===e?"geodataservice":"3dtiles service"===e?t.includes("3DObject")?"3dobjecttileslayer":t.includes("IntegratedMesh")?"integratedmeshtileslayer":"3dtileslayer":"layers"):"web map"===e||"cityengine web scene"===e?r="maps":"web scene"===e?r=t.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":"web mapping application"===e&&t.includes("configurableApp")?r="instantapps":"web mapping application"===e||"mobile application"===e||"application"===e||"operation view"===e||"desktop application"===e?r="apps":"map document"===e||"map package"===e||"published map"===e||"scene document"===e||"globe document"===e||"basemap package"===e||"mobile basemap package"===e||"mobile map package"===e||"project package"===e||"project template"===e||"pro map"===e||"layout"===e||"layer"===e&&t.includes("ArcGIS Pro")||"explorer map"===e&&t.indexOf("Explorer Document")?r="mapsgray":"service definition"===e||"shapefile"===e||"cad drawing"===e||"geojson"===e||"netcdf"===e||"administrative report"===e?r="datafiles":"360 vr experience"===e?r="360vr":"explorer add in"===e||"desktop add in"===e||"windows viewer add in"===e||"windows viewer configuration"===e?r="appsgray":"arcgis pro add in"===e||"arcgis pro configuration"===e?r="addindesktop":"pdf"===e?r="pdf":"microsoft word"===e?r="word":"microsoft excel"===e?r="excel":"microsoft powerpoint"===e?r="ppt":"rule package"===e||"file geodatabase"===e||"sqlite geodatabase"===e||"csv collection"===e||"kml collection"===e||"windows mobile package"===e||"map template"===e||"desktop application template"===e||"gml"===e||"arcpad package"===e||"code sample"===e||"document link"===e||"earth configuration"===e||"operations dashboard add in"===e||"rules package"===e||"workflow manager package"===e||"explorer map"===e&&t.includes("Explorer Mapping Application")||t.includes("Document")?r="datafilesgray":"network analysis service"===e||"geoprocessing service"===e||"geodata service"===e||"geometry service"===e||"geoprocessing package"===e||"locator package"===e||"geoprocessing sample"===e||"workflow manager service"===e?r="toolsgray":"layer"===e||"layer package"===e||"explorer layer"===e?r="layersgray":"analysis model"===e?r="analysismodel":"scene package"===e?r="scenepackage":"3dtiles package"===e?r="3dtileslayerpackage":"3dtiles service"===e?r="3dtileslayer":"mobile scene package"===e?r="mobilescenepackage":"tile package"===e||"compact tile package"===e?r="tilepackage":"task file"===e?r="taskfile":"report template"===e?r="report-template":"statistical data collection"===e?r="statisticaldatacollection":"insights workbook"===e?r="workbook":"insights model"===e?r="insightsmodel":"insights page"===e?r="insightspage":"insights theme"===e?r="insightstheme":"hub initiative"===e?r="hubinitiative":"hub page"===e?r="hubpage":"hub site application"===e?r="hubsite":"hub event"===e?r="hubevent":"hub project"===e?r="hubproject":"relational database connection"===e?r="relationaldatabaseconnection":"big data file share"===e?r="datastorecollection":"image collection"===e?r="imagecollection":"desktop style"===e?r="desktopstyle":"style"===e?r=t.includes("Dictionary")?"dictionarystyle":"style":"dashboard"===e?r="dashboard":"raster function template"===e?r="rasterprocessingtemplate":"vector tile package"===e?r="vectortilepackage":"ortho mapping project"===e?r="orthomappingproject":"ortho mapping template"===e?r="orthomappingtemplate":"solution"===e?r="solutions":"geopackage"===e?r="geopackage":"deep learning package"===e?r="deeplearningpackage":"real time analytic"===e?r="realtimeanalytics":"big data analytic"===e?r="bigdataanalytics":"feed"===e?r="feed":"excalibur imagery project"===e?r="excaliburimageryproject":"notebook"===e?r="notebook":"storymap"===e?r="storymap":"survey123 add in"===e?r="survey123addin":"mission"===e?r="mission":"mission report"===e?r="missionreport":"mission template"===e?r="missiontemplate":"quickcapture project"===e?r="quickcaptureproject":"pro report"===e?r="proreport":"pro report template"===e?r="proreporttemplate":"urban model"===e?r="urbanmodel":"web experience"===e?r="experiencebuilder":"web experience template"===e?r="webexperiencetemplate":"experience builder widget"===e?r="experiencebuilderwidget":"experience builder widget package"===e?r="experiencebuilderwidgetpackage":"workflow"===e?r="workflow":"kernel gateway connection"===e?r="kernelgatewayconnection":"insights script"===e?r="insightsscript":"hub initiative template"===e?r="hubinitiativetemplate":"storymap theme"===e?r="storymaptheme":"knowledge graph"===e?r="knowledgegraph":"knowledge graph layer"===e?r="knowledgegraphlayer":"knowledge studio project"===e?r="knowledgestudio":"native application"===e?r="nativeapp":"native application installer"===e?r="nativeappinstaller":"web link chart"===e?r="linkchart":"knowledge graph web investigation"===e?r="investigation":"ogcfeatureserver"===e?r="features":"pro project"===e?r="proproject":"insights workbook package"===e?r="insightsworkbookpackage":"apache parquet"===e?r="apacheparquet":"notebook code snippet library"===e?r="notebookcodesnippets":"suitability model"===e?r="suitabilitymodel":"esri classifier definition"===e?r="classifierdefinition":"esri classification schema"===e?r="classificationschema":"insights data engineering workbook"===e?r="dataengineeringworkbook":"insights data engineering model"===e?r="dataengineeringmodel":"deep learning studio project"===e?r="deeplearningproject":"discussion"===e?r="discussion":"allsource project"===e?r="allsourceproject":"api key"===e?r="apikey":"data pipeline"===e?r="datapipelines":"group layer"===e?(h=t.includes("Map"),r=h?"layergroup2d":"layergroup"):r="media layer"===e?"onlinemedialayer":"form"===e?t.includes("Survey123")?"survey":"datafilesgray":"csv"===e?"csv":"image"===e?"image":"maps",r?(0,n.s)("esri/images/portal/"+r+"16.png"):null}get isLayer(){return null!=this.type&&C.has(this.type)}get itemCdnUrl(){return(0,A.a)(this.itemUrl)}get itemPageUrl(){const e=this.portal?.itemPageUrl;return e&&this.id?`${e}?id=${this.id}`:null}get itemUrl(){const e=this.portal?.restUrl;return e&&this.id?`${e}/content/items/${this.id}`:null}get thumbnailUrl(){const e=this.itemUrl,t=this.thumbnail;return e&&t?this.portal?.normalizeUrl(`${e}/info/${t}?f=json`)??null:null}get userItemUrl(){const e=this.portal?.restUrl;if(!e)return null;const t=this.owner||this.portal?.user?.username;return t?`${e}/content/users/${this.ownerFolder?`${t}/${this.ownerFolder}`:t}/items/${this.id}`:null}load(e){const t=this.portal??(this.portal=m.A.getDefault()),r=t.load(e).then((()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?t.request(this.itemUrl,{signal:null!=e?e.signal:null,query:{token:this.apiKey}}):{})).then((e=>{this.sourceJSON=e,this.read(e)}));return this.addResolvingPromise(r),Promise.resolve(this)}async addRating(e){const t={method:"post",query:{}};return e instanceof w&&(e=e.rating),null==e||isNaN(e)||"number"!=typeof e||(t.query.rating=e),this.portal?(await this.portal.request(this.itemUrl+"/addRating",t),new w({rating:e,created:new Date})):null}clone(){const e={access:this.access,accessInformation:this.accessInformation,applicationProxies:(0,a.o8)(this.applicationProxies),avgRating:this.avgRating,categories:(0,a.o8)(this.categories),created:(0,a.o8)(this.created),culture:this.culture,description:this.description,extent:(0,a.o8)(this.extent),groupCategories:(0,a.o8)(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:(0,a.o8)(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:(0,a.o8)(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:(0,a.o8)(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:(0,a.o8)(this.typeKeywords),url:this.url};this.loaded&&(e.loadStatus="loaded");const t=new T({sourceJSON:this.sourceJSON}).set(e);return t._set("isOrgItem",this.isOrgItem),t}createPostQuery(){const e=this.toJSON();for(const t of["tags","typeKeywords","categories"])e[t]=e[t]?.join(", ");const{extent:t}=e;return t&&(e.extent=JSON.stringify(t)),e}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(e="json",t){return this.portal.request(this.itemUrl+"/data",{responseType:e,...t,query:{token:this.apiKey}})}async fetchRating(e){const t=await this.portal.request(this.itemUrl+"/rating",{query:{token:this.apiKey},...e});return null!=t.rating?(t.created=new Date(t.created),new w(t)):null}fetchRelatedItems(e,t){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...e,token:this.apiKey},...t},T)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then((e=>(this.sourceJSON=e,this.read(e),this)))}update(e){return this.id?this.load().then((()=>this.portal.signIn())).then((()=>{const t=e?.data,r={method:"post"};r.query=this.createPostQuery();for(const e in r.query)null===r.query[e]&&(r.query[e]="");return r.query.clearEmptyFields=!0,null!=t&&("string"==typeof t?r.query.text=t:"object"==typeof t&&(r.query.text=JSON.stringify(t))),this.portal.request(`${this.userItemUrl}/update`,r).then((()=>this.reload()))})):Promise.reject(new s.A("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(e){if(!this.id)throw new s.A("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:t,itemUrl:r}=this;await t.signIn();const{copyResources:i,folder:n,tags:o,title:a}=e||{},l={method:"post",query:{copyPrivateResources:"all"===i,folder:"string"==typeof n?n:n?.id,includeResources:!!i,tags:o?.join(","),title:a}},{itemId:c}=await t.request(`${r}/copy`,l);return new T({id:c,portal:t})}updateThumbnail(e){return this.id?this.load().then((()=>this.portal.signIn())).then((()=>{const t=e.thumbnail,r=e.filename,i={method:"post"};if("string"==typeof t)(0,c.DB)(t)?i.query={data:t}:i.query={url:(0,c.s2)(t)},null!=r&&(i.query.filename=r);else{const e=new FormData;null!=r?e.append("file",t,r):e.append("file",t),i.body=e}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,i).then((()=>this.reload()))})):Promise.reject(new s.A("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(e={},t){const{fetchResources:i}=await r.e(4460).then(r.bind(r,55597));return i(this,e,t)}async addResource(e,t,i){const{addOrUpdateResources:n}=await r.e(4460).then(r.bind(r,55597));return e.portalItem=this,await n(this,[{resource:e,content:t,compress:i?.compress,access:i?.access}],"add",i),e}async removeResource(e,t){const{removeResource:i}=await r.e(4460).then(r.bind(r,55597));if(e.portalItem&&e.portalItem.itemUrl!==this.itemUrl)throw new s.A("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i(this,e,t)}async removeAllResources(e){const{removeAllResources:t}=await r.e(4460).then(r.bind(r,55597));return t(this,e)}resourceFromPath(e){return new x({portalItem:this,path:e})}toJSON(){const e=this.extent,t={accessInformation:this.accessInformation,categories:(0,a.o8)(this.categories),created:this.created?.getTime(),description:this.description,extent:e&&[[e.xmin,e.ymin],[e.xmax,e.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified?.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:(0,a.o8)(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:(0,a.o8)(this.typeKeywords),url:this.url};return(0,a.oy)(t)}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new T({sourceJSON:e})}_getPostQuery(){const e=this.toJSON();for(const t in e)"tags"===t&&null!==e[t]&&(e[t]=e[t].join(", ")),"typeKeywords"===t&&null!==e[t]&&(e[t]=e[t].join(", ")),"extent"===t&&e[t]&&(e[t]=JSON.stringify(e[t]));return e}};(0,i._)([(0,u.MZ)({type:["private","shared","org","public"]})],M.prototype,"access",void 0),(0,i._)([(0,u.MZ)()],M.prototype,"accessInformation",void 0),(0,i._)([(0,u.MZ)({type:String})],M.prototype,"apiKey",void 0),(0,i._)([(0,u.MZ)({json:{read:{source:"appProxies"}}})],M.prototype,"applicationProxies",void 0),(0,i._)([(0,u.MZ)()],M.prototype,"avgRating",void 0),(0,i._)([(0,u.MZ)()],M.prototype,"categories",void 0),(0,i._)([(0,u.MZ)({type:Date})],M.prototype,"created",void 0),(0,i._)([(0,u.MZ)()],M.prototype,"culture",void 0),(0,i._)([(0,u.MZ)()],M.prototype,"description",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],M.prototype,"displayName",null),(0,i._)([(0,u.MZ)({type:f.default})],M.prototype,"extent",void 0),(0,i._)([(0,d.w)("extent")],M.prototype,"readExtent",null),(0,i._)([(0,u.MZ)()],M.prototype,"groupCategories",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],M.prototype,"iconUrl",null),(0,i._)([(0,u.MZ)()],M.prototype,"id",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],M.prototype,"isLayer",null),(0,i._)([(0,u.MZ)({type:Boolean,readOnly:!0})],M.prototype,"isOrgItem",void 0),(0,i._)([(0,u.MZ)()],M.prototype,"itemControl",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],M.prototype,"itemPageUrl",null),(0,i._)([(0,u.MZ)({readOnly:!0})],M.prototype,"itemUrl",null),(0,i._)([(0,u.MZ)()],M.prototype,"licenseInfo",void 0),(0,i._)([(0,u.MZ)({type:Date})],M.prototype,"modified",void 0),(0,i._)([(0,u.MZ)()],M.prototype,"name",void 0),(0,i._)([(0,u.MZ)()],M.prototype,"numComments",void 0),(0,i._)([(0,u.MZ)()],M.prototype,"numRatings",void 0),(0,i._)([(0,u.MZ)()],M.prototype,"numViews",void 0),(0,i._)([(0,u.MZ)()],M.prototype,"owner",void 0),(0,i._)([(0,u.MZ)()],M.prototype,"ownerFolder",void 0),(0,i._)([(0,u.MZ)({type:m.A})],M.prototype,"portal",void 0),(0,i._)([(0,u.MZ)()],M.prototype,"screenshots",void 0),(0,i._)([(0,u.MZ)()],M.prototype,"size",void 0),(0,i._)([(0,u.MZ)()],M.prototype,"snippet",void 0),(0,i._)([(0,u.MZ)()],M.prototype,"sourceJSON",void 0),(0,i._)([(0,u.MZ)({type:String})],M.prototype,"sourceUrl",void 0),(0,i._)([(0,u.MZ)({type:String})],M.prototype,"spatialReference",void 0),(0,i._)([(0,u.MZ)()],M.prototype,"tags",void 0),(0,i._)([(0,u.MZ)()],M.prototype,"thumbnail",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],M.prototype,"thumbnailUrl",null),(0,i._)([(0,u.MZ)()],M.prototype,"title",void 0),(0,i._)([(0,u.MZ)()],M.prototype,"type",void 0),(0,i._)([(0,u.MZ)()],M.prototype,"typeKeywords",void 0),(0,i._)([(0,u.MZ)({type:String,json:{read(e,t){if(E.has(t.type)){const t=this.portal?.restUrl;e||=t&&this.id?`${t}/content/items/${this.id}/data`:null}return e}}})],M.prototype,"url",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],M.prototype,"userItemUrl",null),M=T=(0,i._)([(0,p.$)("esri.portal.PortalItem")],M);const R=M},68354:function(e,t,r){r.r(t),r.d(t,{getGeometryServiceURL:function(){return l},projectGeometry:function(){return c}});var i=r(25591),n=r(39819),s=r(51432),o=r(50493),a=r(6805);async function l(e=null,t){if(i.default.geometryServiceUrl)return i.default.geometryServiceUrl;if(!e)throw new n.A("internal:geometry-service-url-not-configured");let r;r="portal"in e?e.portal||s.A.getDefault():e,await r.load({signal:t});const o=r.helperServices?.geometry?.url;if(!o)throw new n.A("internal:geometry-service-url-not-configured");return o}async function c(e,t,r=null,i){const s=await l(r,i),c=new a.A({geometries:[e],outSpatialReference:t}),u=await(0,o.C)(s,c,{signal:i});if(u&&Array.isArray(u)&&1===u.length)return u[0];throw new n.A("internal:geometry-service-projection-failed")}},74865:function(e,t,r){r.d(t,{A:function(){return M}});var i,n=r(53804),s=r(10748),o=r(73037),a=r(21609),l=r(40633),c=r(23502),u=r(77560),h=r(74376),d=r(47332),p=r(65953),f=r(81392),m=r(67888),g=r(53743),y=r(30047),_=r(77056),v=r(23879),b=r(85336),x=r(49951),S=r(54547);const w="percent-of-total",T="field",A=new o.J({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:w,esriNormalizeByField:T}),C=(0,m.dp)(v.A);let E=i=class extends((0,_.h)(y.A)){constructor(e){super(e),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(e,t,r){if(!Array.isArray(e))return;let i=t.minValue;return e.map((e=>{const t=new v.A;return t.read(e,r),null==t.minValue&&(t.minValue=i),null==t.maxValue&&(t.maxValue=t.minValue),i=t.maxValue,t}))}writeClassBreakInfos(e,t,r,i){const n=e.map((e=>e.write({},i)));this._areClassBreaksConsecutive()&&n.forEach((e=>delete e.classMinValue)),t[r]=n}castField(e){return null==e?e:"function"==typeof e?(l.A.getLogger(this).error(".field: field must be a string value"),null):(0,m.GX)(e)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,r=null!=this.normalizationTotal;return t||r?(e=t&&T||r&&w||null,t&&r&&l.A.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):e!==T&&e!==w||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}addClassBreakInfo(e,t,r){let i=null;i="number"==typeof e?new v.A({minValue:e,maxValue:t,symbol:(0,s.dp)(r)}):C((0,a.o8)(e)),this.classBreakInfos.push(i),1===this.classBreakInfos.length&&this.notifyChange("minValue")}removeClassBreakInfo(e,t){const r=this.classBreakInfos.length;for(let i=0;i<r;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]===e&&r[1]===t){this.classBreakInfos.splice(i,1);break}}}getBreakIndex(e,t){return this.valueExpression&&null==t?.arcade&&l.A.getLogger(this).warn(""),this.valueExpression?this._getBreakIndexForExpression(e,t):this._getBreakIndexForField(e)}async getClassBreakInfo(e,t){let r=t;this.valueExpression&&null==t?.arcade&&(r={...r,arcade:await(0,S.lw)()});const i=this.getBreakIndex(e,r);return-1!==i?this.classBreakInfos[i]:null}getSymbol(e,t){if(this.valueExpression&&null==t?.arcade)return void l.A.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this.getBreakIndex(e,t);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}async getSymbolAsync(e,t){let r=t;if(this.valueExpression&&null==t?.arcade){const e=await(0,S.lw)(),{arcadeUtils:t}=e;t.hasGeometryOperations(this.valueExpression)&&await t.enableGeometryOperations(),r={...r,arcade:e}}const i=this.getBreakIndex(e,r);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}getSymbols(){const e=[];return this.classBreakInfos.forEach((t=>{t.symbol&&e.push(t.symbol)})),this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),r=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${e}.${t}.${this.classBreakInfos.reduce(((e,t)=>e+t.getMeshHash()),"")}.${r}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new i({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol?.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol?.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:(0,a.o8)(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:(0,a.o8)(this.visualVariables),legendOptions:(0,a.o8)(this.legendOptions),authoringInfo:(0,a.o8)(this.authoringInfo)})}async collectRequiredFields(e,t){const r=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(r)}async collectSymbolFields(e,t){const r=[...this.getSymbols().map((r=>r.collectRequiredFields(e,t))),(0,g.Dx)(e,t,this.valueExpression)];(0,g.rq)(e,t,this.field),(0,g.rq)(e,t,this.normalizationField),await Promise.all(r)}_getBreakIndexForExpression(e,t){const{viewingMode:r,scale:i,spatialReference:n,arcade:s,timeZone:o}=t??{},{valueExpression:a}=this;let l=this._compiledValueExpression.valueExpression===a?this._compiledValueExpression.compiledFunction:null;const c=s.arcadeUtils;if(!l){const e=c.createSyntaxTree(a);l=c.createFunction(e),this._compiledValueExpression.compiledFunction=l}this._compiledValueExpression.valueExpression=a;const u=c.executeFunction(l,c.createExecContext(e,c.getViewInfo({viewingMode:r,scale:i,spatialReference:n}),o));return this._getBreakIndexfromInfos(u)}_getBreakIndexForField(e){const t=this.field,r=e.attributes,i=this.normalizationType;let n=parseFloat(r[t]);if(i){const e=this.normalizationTotal,t=parseFloat(this.normalizationField?r[this.normalizationField]:void 0);if("log"===i)n=Math.log(n)*Math.LOG10E;else if(i!==w||null==e||isNaN(e)){if(i===T&&!isNaN(t)){if(isNaN(n)||isNaN(t))return-1;n/=t}}else n=n/e*100}return this._getBreakIndexfromInfos(n)}_getBreakIndexfromInfos(e){const t=this.isMaxInclusive;if(null!=e&&"number"==typeof e&&!isNaN(e))for(let r=0;r<this.classBreakInfos.length;r++){const i=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(i[0]<=e&&(t?e<=i[1]:e<i[1]))return r}return-1}_areClassBreaksConsecutive(){const e=this.classBreakInfos,t=e.length;for(let r=1;r<t;r++)if(e[r-1].maxValue!==e[r].minValue)return!1;return!0}};(0,n._)([(0,c.MZ)(b.As)],E.prototype,"backgroundFillSymbol",void 0),(0,n._)([(0,c.MZ)({type:[v.A]})],E.prototype,"classBreakInfos",void 0),(0,n._)([(0,d.w)("classBreakInfos")],E.prototype,"readClassBreakInfos",null),(0,n._)([(0,f.K)("classBreakInfos")],E.prototype,"writeClassBreakInfos",null),(0,n._)([(0,c.MZ)({type:String,json:{write:!0}})],E.prototype,"defaultLabel",void 0),(0,n._)([(0,c.MZ)(b.z4)],E.prototype,"defaultSymbol",void 0),(0,n._)([(0,c.MZ)({type:String,json:{write:!0}})],E.prototype,"field",void 0),(0,n._)([(0,u.w)("field")],E.prototype,"castField",null),(0,n._)([(0,c.MZ)({type:Boolean})],E.prototype,"isMaxInclusive",void 0),(0,n._)([(0,c.MZ)({type:x.q,json:{write:!0}})],E.prototype,"legendOptions",void 0),(0,n._)([(0,c.MZ)({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return 0!==this.classBreakInfos.length&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],E.prototype,"minValue",null),(0,n._)([(0,c.MZ)({type:String,json:{write:!0}})],E.prototype,"normalizationField",void 0),(0,n._)([(0,c.MZ)({type:Number,cast:e=>(0,m.GB)(e),json:{write:!0}})],E.prototype,"normalizationTotal",void 0),(0,n._)([(0,c.MZ)({type:A.apiValues,value:null,json:{type:A.jsonValues,read:A.read,write:A.write}})],E.prototype,"normalizationType",null),(0,n._)([(0,h.e)({classBreaks:"class-breaks"})],E.prototype,"type",void 0),(0,n._)([(0,c.MZ)({type:String,json:{write:!0}})],E.prototype,"valueExpression",void 0),(0,n._)([(0,c.MZ)({type:String,json:{write:!0}})],E.prototype,"valueExpressionTitle",void 0),E=i=(0,n._)([(0,p.$)("esri.renderers.ClassBreaksRenderer")],E);const M=E},1526:function(e,t,r){r.d(t,{A:function(){return R}});var i=r(53804),n=r(21609),s=r(23502),o=(r(58941),r(40633)),a=r(65953),l=r(81392),c=r(53743),u=r(30047),h=r(77056),d=r(52874),p=r(93040),f=r(39819),m=r(99680),g=r(60539),y=r(58009),_=r(7103),v=r(54547),b=r(38164),x=r(67895),S=r(7590);const w="esri.renderers.support.DictionaryLoader",T={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};class A{constructor(e,t,r){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new m.q(100),this._dictionaryVersion=null,this._fieldIndex=null,this._dictionaryPromise=null,this.url=e,this.config=t,this.fieldMap=r}getSymbolFields(){return this._symbolFields}async getSymbolAsync(e,t){let r;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(t));try{r=await this._dictionaryPromise}catch(e){if((0,g.zf)(e))return this._dictionaryPromise=null,null}const i=this._dictionaryVersion?.since(4,0),n={};if(this.fieldMap)for(const t of this._symbolFields){const r=(0,S.MO)(this.fieldMap[t],this._fieldIndex);if(r){const s=e.attributes[r];n[t]=i?s:null!=s?""+e.attributes[r]:""}else n[t]=""}let s=null;try{s=r?.(n,t)}catch(e){return null}if(!s||"string"!=typeof s||"invalid"===s)return null;const o=s.split(";"),a=[],l=[];for(const e of o)if(e)if(e.includes("po:")){const t=e.substr(3).split("|");if(3===t.length){const e=t[0],r=t[1];let i=t[2];if("DashTemplate"===r)i=i.split(" ").map((e=>Number(e)));else if("Color"===r){const e=new d.A(i).toRgba();i=[e[0],e[1],e[2],255*e[3]]}else i=Number(i);l.push({primitiveName:e,propertyName:r,value:i,defaultValue:null})}}else if(e.includes("|")){for(const t of e.split("|"))if(this._itemNames.has(t)){a.push(t);break}}else this._itemNames.has(e)&&a.push(e);const c=null==e.geometry||!e.geometry.hasZ&&"point"===e.geometry.type;return this._cimPartsToCIMSymbol(e,a,l,c,t)}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void o.A.getLogger(w).error("no valid URL!");const t=(0,p.A)(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:null!=e?e.signal:null}),[{data:r}]=await Promise.all([t,(0,v.lw)()]);if(!r)throw this._dictionaryPromise=null,new f.A("esri.renderers.DictionaryRenderer","Bad dictionary data!");const{authoringInfo:i,dictionary_version:n,expression:s,itemsNames:a}=r,l=s;let c=!1;n&&(this._dictionaryVersion=y.R.parse(n),c=this._dictionaryVersion.since(4,0)),this._refSymbolUrlTemplate=this.url+"/"+r.cimRefTemplateUrl,this._itemNames=new Set(a),this._symbolFields=i.symbol;const u={};if(this.config){const e=this.config;for(const t in e)u[t]=e[t]}if(i.configuration)for(const e of i.configuration)u.hasOwnProperty(e.name)||(u[e.name]=e.value);const h=[];if(e?.fields&&this.fieldMap)for(const t in this.fieldMap){const r=this.fieldMap[t],i=e.fields.filter((e=>e.name.toLowerCase()===r?.toLowerCase()));i.length>0&&h.push({...i[0],type:c?i[0].type:"esriFieldTypeString"})}h.length>0&&(this._fieldIndex=new _.A(h));const d=(0,v.xR)(l,null!=e?e.spatialReference:null,h,u).then((e=>{const t={scale:0};return(r,i)=>{if(null==e)return null;const n=e.repurposeFeature({geometry:null,attributes:r});return t.scale=null!=i?i.scale??void 0:void 0,e.evaluate({$feature:n,$view:t},e.services)}})).catch((e=>(o.A.getLogger(w).error("Creating dictionary expression failed:",e),null)));return this._dictionaryPromise=d,d}async _cimPartsToCIMSymbol(e,t,r,i,s){const o=new Array(t.length);for(let e=0;e<t.length;e++)o[e]=this._getSymbolPart(t[e],s);let a=await Promise.all(o);const l=this.fieldMap;if(l){a=(0,n.o8)(a);for(const t of a)x.$.applyDictionaryTextOverrides(t,e,l,this._fieldIndex,(0,S.bs)(t))}return new b.A({data:C(a,r,i)})}async _getSymbolPart(e,t){const r=this._symbolCache.get(e);if(r)return r;if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then((e=>e.data));const i=this._refSymbolUrlTemplate.replaceAll(/\{itemName\}/gi,e),n=(0,p.A)(i,{responseType:"json",query:{f:"json"},...t});this._ongoingRequests.set(e,n),n.finally((()=>this._ongoingRequests.delete(e)));try{const t=await n;return this._symbolCache.put(e,t.data),t.data}catch(e){throw e}}}function C(e,t,r){if(!e||0===e.length)return null;const i={...e[0]};if(e.length>1){i.symbolLayers=[];for(const t of e){const e=t;i.symbolLayers.unshift(...e.symbolLayers)}}return r&&(i.callout=T),{type:"CIMSymbolReference",symbol:i,primitiveOverrides:t}}var E;let M=E=class extends((0,h.h)(u.A)){constructor(e){super(e),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new A(this.url,this.config,this.fieldMap)}writeData(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,t,r,i){i?.origin||super.writeVisualVariables(e,t,r,i)}clone(){return new E({config:(0,n.o8)(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:(0,n.o8)(this.fieldMap),url:(0,n.o8)(this.url),visualVariables:(0,n.o8)(this.visualVariables)})}async getSymbolAsync(e,t){return this._loader.getSymbolAsync(e,t)}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await(0,c.Dx)(e,t,this.scaleExpression);for(const r in this.fieldMap){const i=this.fieldMap[r];t.has(i)&&e.add(i)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};(0,i._)([(0,s.MZ)({type:A})],M.prototype,"_loader",null),(0,i._)([(0,s.MZ)({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],M.prototype,"config",void 0),(0,i._)([(0,s.MZ)({type:Object,json:{write:!0}})],M.prototype,"fieldMap",void 0),(0,i._)([(0,s.MZ)({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],M.prototype,"scaleExpression",void 0),(0,i._)([(0,l.K)("scaleExpression")],M.prototype,"writeData",null),(0,i._)([(0,s.MZ)({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],M.prototype,"scaleExpressionTitle",void 0),(0,i._)([(0,s.MZ)({type:String,json:{write:!0}})],M.prototype,"url",void 0),(0,i._)([(0,l.K)("visualVariables")],M.prototype,"writeVisualVariables",null),M=E=(0,i._)([(0,a.$)("esri.renderers.DictionaryRenderer")],M);const R=M},96173:function(e,t,r){r.d(t,{A:function(){return x}});var i,n=r(53804),s=r(52874),o=r(21609),a=r(23502),l=(r(58941),r(40633),r(74376)),c=r(65953),u=r(53743),h=r(30047),d=r(77056),p=r(19563),f=r(30905);r(13798);let m=i=class extends f.oY{constructor(){super(...arguments),this.unit=null}clone(){return new i({unit:this.unit})}};(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],m.prototype,"unit",void 0),m=i=(0,n._)([(0,c.$)("esri.renderers.support.DotDensityLegendOptions")],m);const g=m;var y,_=r(8740),v=r(22198);let b=y=class extends((0,d.h)(h.A)){constructor(e){super(e),this.attributes=null,this.backgroundColor=new s.A([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new v.A,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(null==this.referenceScale)return this.dotValue;const t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new _.A({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes?.reduce(((e,t)=>e+t.getAttributeHash()),"")??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new y({attributes:(0,o.o8)(this.attributes),backgroundColor:(0,o.o8)(this.backgroundColor),dotBlendingEnabled:(0,o.o8)(this.dotBlendingEnabled),dotShape:(0,o.o8)(this.dotShape),dotSize:(0,o.o8)(this.dotSize),dotValue:(0,o.o8)(this.dotValue),legendOptions:(0,o.o8)(this.legendOptions),outline:(0,o.o8)(this.outline),referenceScale:(0,o.o8)(this.referenceScale),seed:(0,o.o8)(this.seed),visualVariables:(0,o.o8)(this.visualVariables),authoringInfo:(0,o.o8)(this.authoringInfo)})}getControllerHash(){const e=this.attributes?.map((e=>e.field||e.valueExpression||""));return`${e}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const r of this.attributes??[])r.valueExpression&&await(0,u.Dx)(e,t,r.valueExpression),r.field&&e.add(r.field)}};(0,n._)([(0,a.MZ)({type:[p.A],json:{write:!0}})],b.prototype,"attributes",void 0),(0,n._)([(0,a.MZ)({type:s.A,json:{write:!0}})],b.prototype,"backgroundColor",void 0),(0,n._)([(0,a.MZ)({type:Boolean,json:{write:!0}})],b.prototype,"dotBlendingEnabled",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!1}})],b.prototype,"dotShape",void 0),(0,n._)([(0,a.MZ)({type:Number,json:{write:!0}})],b.prototype,"dotSize",void 0),(0,n._)([(0,a.MZ)({type:g,json:{write:!0}})],b.prototype,"legendOptions",void 0),(0,n._)([(0,a.MZ)({type:v.A,json:{default:null,write:!0}})],b.prototype,"outline",void 0),(0,n._)([(0,a.MZ)({type:Number,json:{write:!0}})],b.prototype,"dotValue",void 0),(0,n._)([(0,a.MZ)({type:Number,json:{write:!0}})],b.prototype,"referenceScale",void 0),(0,n._)([(0,a.MZ)({type:Number,json:{write:!0}})],b.prototype,"seed",void 0),(0,n._)([(0,l.e)({dotDensity:"dot-density"})],b.prototype,"type",void 0),b=y=(0,n._)([(0,c.$)("esri.renderers.DotDensityRenderer")],b);const x=b},52308:function(e,t,r){r.d(t,{A:function(){return C}});var i=r(53804),n=r(52874),s=(r(10748),r(88022)),o=r(21609),a=r(40633),l=r(74087),c=r(13520),u=r(23502),h=(r(58941),r(63693)),d=r(74376),p=r(65953),f=r(53743),m=r(30047),g=r(53871),y=r(27419),_=r(75743),v=r(30905);r(13798);let b=class extends((0,_.O)(v.oY)){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],b.prototype,"minLabel",void 0),(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],b.prototype,"maxLabel",void 0),(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],b.prototype,"title",void 0),b=(0,i._)([(0,p.$)("esri.renderers.support.HeatmapLegendOptions")],b);var x,S=r(70181),w=r(90363);function T(e){if(null!=e){const{maxDensity:t,minDensity:r,radius:i}=e;if(null!=t||null!=r||null!=i){const{blurRadius:t,maxPixelIntensity:r,minPixelIntensity:i,...n}=e;return n}}return e}let A=x=class extends m.A{constructor(e){super(e),this.authoringInfo=null,this.colorStops=[new y.A({ratio:0,color:new n.A("rgba(255, 140, 0, 0)")}),new y.A({ratio:.75,color:new n.A("rgba(255, 140, 0, 1)")}),new y.A({ratio:.9,color:new n.A("rgba(255, 0,   0, 1)")})],this.field=null,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(e){return T(e)}get blurRadius(){return(0,S.PU)(this.radius)}set blurRadius(e){const t=this.maxPixelIntensity,r=this.minPixelIntensity;this._set("radius",(0,S.zp)(e)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",t*this._pixelIntensityToDensity),this._set("minDensity",r*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(e){this._set("maxDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(e){this._set("minDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(S.ex**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(e,t){this._warnedProps[e]||"user"===(0,h.oY)(this).getDefaultOrigin()&&(this._warnedProps[e]=!0,(0,l._)((()=>{(0,s.Lx)(a.A.getLogger(this),e,{replacement:`${String(t)} (suggested value: ${this._get(t)})`,version:"4.24"})})))}read(e,t){e=T(e),super.read(e,t)}getSymbol(){return new w.A}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(e,t){const r=this.field,i=this.valueExpression;r&&"string"==typeof r&&(0,f.rq)(e,t,r),i&&"string"==typeof i&&await(0,f.Dx)(e,t,i)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new x({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:(0,o.o8)(this.colorStops),field:this.field,legendOptions:(0,o.o8)(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};(0,i._)([(0,u.MZ)({type:g.A,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],A.prototype,"authoringInfo",void 0),(0,i._)([(0,u.MZ)({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],A.prototype,"blurRadius",null),(0,i._)([(0,u.MZ)({type:[y.A],json:{write:!0}})],A.prototype,"colorStops",void 0),(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],A.prototype,"field",void 0),(0,i._)([(0,u.MZ)({type:b,json:{write:!0}})],A.prototype,"legendOptions",void 0),(0,i._)([(0,u.MZ)({type:Number,json:{write:!0}})],A.prototype,"maxDensity",void 0),(0,i._)([(0,u.MZ)({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],A.prototype,"maxPixelIntensity",null),(0,i._)([(0,u.MZ)({type:Number,json:{write:!0}})],A.prototype,"minDensity",void 0),(0,i._)([(0,u.MZ)({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],A.prototype,"minPixelIntensity",null),(0,i._)([(0,u.MZ)({type:Number,cast:c.cr,json:{write:!0}})],A.prototype,"radius",void 0),(0,i._)([(0,u.MZ)({type:Number,range:{min:0},json:{default:0,write:!0}})],A.prototype,"referenceScale",void 0),(0,i._)([(0,d.e)({heatmap:"heatmap"})],A.prototype,"type",void 0),(0,i._)([(0,u.MZ)({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],A.prototype,"valueExpression",void 0),(0,i._)([(0,u.MZ)({type:String})],A.prototype,"valueExpressionTitle",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],A.prototype,"_pixelIntensityToDensity",null),A=x=(0,i._)([(0,p.$)("esri.renderers.HeatmapRenderer")],A);const C=A},60189:function(e,t,r){r.d(t,{A:function(){return S}});var i=r(53804),n=r(52874),s=(r(10748),r(50659)),o=r(75743),a=r(13520),l=r(23502),c=(r(58941),r(40633),r(74376)),u=r(65953),h=r(53743),d=r(30047),p=r(77056),f=r(19563),m=r(30905);r(13798);let g=class extends((0,o.O)(m.oY)){constructor(){super(...arguments),this.color=new n.A([0,0,0,0]),this.label=null,this.threshold=0}};(0,i._)([(0,l.MZ)({type:n.A,json:{write:!0}})],g.prototype,"color",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],g.prototype,"label",void 0),(0,i._)([(0,l.MZ)({type:Number,range:{min:0,max:1},json:{write:!0}})],g.prototype,"threshold",void 0),g=(0,i._)([(0,u.$)("esri.renderers.support.OthersCategory")],g);let y=class extends((0,o.O)(m.oY)){constructor(){super(...arguments),this.title=null}};(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],y.prototype,"title",void 0),y=(0,i._)([(0,u.$)("esri.renderers.support.PieChartLegendOptions")],y);var _=r(90363),v=r(8740),b=r(22198);let x=class extends((0,p.h)((0,o.O)(d.A))){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new n.A([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new g,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){return new _.A({size:this.size?this.size/2+(this.outline?.width||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(s.Ru)}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){return this.getSymbols().reduce(((e,t)=>e+JSON.stringify(t)),"")}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const r of this.attributes)r.valueExpression&&await(0,h.Dx)(e,t,r.valueExpression),r.field&&e.add(r.field)}};(0,i._)([(0,l.MZ)({type:[f.A],json:{write:!0}})],x.prototype,"attributes",void 0),(0,i._)([(0,l.MZ)({type:v.A,json:{default:null,write:!0}})],x.prototype,"backgroundFillSymbol",void 0),(0,i._)([(0,l.MZ)({type:n.A,json:{write:!0}})],x.prototype,"defaultColor",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],x.prototype,"defaultLabel",void 0),(0,i._)([(0,l.MZ)({type:Number,range:{min:0,max:1},json:{write:!0}})],x.prototype,"holePercentage",void 0),(0,i._)([(0,l.MZ)({type:g,json:{write:!0}})],x.prototype,"othersCategory",void 0),(0,i._)([(0,l.MZ)({type:y,json:{write:!0}})],x.prototype,"legendOptions",void 0),(0,i._)([(0,l.MZ)({type:b.A,json:{default:null,write:!0}})],x.prototype,"outline",void 0),(0,i._)([(0,l.MZ)({type:Number,cast:a.cr,json:{write:!0}})],x.prototype,"size",void 0),(0,i._)([(0,c.e)({pieChart:"pie-chart"})],x.prototype,"type",void 0),x=(0,i._)([(0,u.$)("esri.renderers.PieChartRenderer")],x);const S=x},30047:function(e,t,r){r.d(t,{A:function(){return h}});var i=r(53804),n=r(73037),s=r(30905),o=r(23502),a=(r(58941),r(40633),r(13798),r(65953)),l=r(53871);const c=new n.J({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let u=class extends s.oY{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const t=new Set;return await this.collectRequiredFields(t,e),Array.from(t).sort()}getSymbol(e,t){}async getSymbolAsync(e,t){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};(0,i._)([(0,o.MZ)({type:l.A,json:{write:!0}})],u.prototype,"authoringInfo",void 0),(0,i._)([(0,o.MZ)({type:c.apiValues,readOnly:!0,json:{type:c.jsonValues,read:!1,write:{writer:c.write,ignoreOrigin:!0}}})],u.prototype,"type",void 0),u=(0,i._)([(0,a.$)("esri.renderers.Renderer")],u);const h=u},27777:function(e,t,r){r.d(t,{A:function(){return p}});var i,n=r(53804),s=r(21609),o=r(23502),a=(r(58941),r(40633),r(74376)),l=r(65953),c=r(30047),u=r(77056),h=r(85336);let d=i=class extends((0,u.h)(c.A)){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(e,t){await Promise.all([this.collectSymbolFields(e,t),this.collectVVRequiredFields(e,t)])}async collectSymbolFields(e,t){await Promise.all(this.getSymbols().map((r=>r.collectRequiredFields(e,t))))}getSymbol(e,t){return this.symbol}async getSymbolAsync(e,t){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){return this.getSymbols().reduce(((e,t)=>e+JSON.stringify(t)),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new i({description:this.description,label:this.label,symbol:(0,s.o8)(this.symbol),visualVariables:(0,s.o8)(this.visualVariables),authoringInfo:(0,s.o8)(this.authoringInfo)})}};(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],d.prototype,"description",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],d.prototype,"label",void 0),(0,n._)([(0,o.MZ)(h.Wp)],d.prototype,"symbol",void 0),(0,n._)([(0,a.e)({simple:"simple"})],d.prototype,"type",void 0),d=i=(0,n._)([(0,l.$)("esri.renderers.SimpleRenderer")],d);const p=d},61065:function(e,t,r){r.d(t,{A:function(){return W}});var i=r(53804),n=r(10748),s=r(39819),o=r(21609),a=r(40633),l=r(34194),c=r(28181),u=r(23502),h=r(77560),d=r(74376),p=r(47332),f=r(65953),m=r(81392),g=r(72952),y=r(67888),_=r(53743),v=r(51432),b=r(30047),x=r(77056),S=r(85336),w=r(49951),T=r(75743),A=r(30905);r(58941),r(13798);let C=class extends((0,T.O)(A.oY)){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};(0,i._)([(0,u.MZ)(S.Ug)],C.prototype,"value",void 0),(0,i._)([(0,u.MZ)(S.Ug)],C.prototype,"value2",void 0),(0,i._)([(0,u.MZ)(S.Ug)],C.prototype,"value3",void 0),C=(0,i._)([(0,f.$)("esri.renderers.support.UniqueValue")],C);const E=C;var M=r(50659);let R=class extends((0,T.O)(A.oY)){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(null==e)return null;const t=typeof(e=Array.isArray(e)?e:[e])[0];return"string"===t||"number"===t?e.map((e=>new E({value:e}))):"object"===t?e[0]instanceof E?e:e.map((e=>new E(e))):null}};(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],R.prototype,"description",void 0),(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],R.prototype,"label",void 0),(0,i._)([(0,u.MZ)(S.z4)],R.prototype,"symbol",void 0),(0,i._)([(0,u.MZ)({type:[E],json:{type:[[String]],read:{reader:e=>e?e.map((e=>new E({value:e[0],value2:e[1],value3:e[2]}))):null},write:{writer:(e,t)=>{const r=[];for(const t of e){const e=[t.value,t.value2,t.value3].filter(M.Ru).map((e=>e.toString()));r.push(e)}t.values=r}}}})],R.prototype,"values",void 0),(0,i._)([(0,h.w)("values")],R.prototype,"castValues",null),R=(0,i._)([(0,f.$)("esri.renderers.support.UniqueValueClass")],R);const P=R;let O=class extends((0,T.O)(A.oY)){constructor(e){super(e),this.heading=null,this.classes=null}};(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],O.prototype,"heading",void 0),(0,i._)([(0,u.MZ)({type:[P],json:{write:!0}})],O.prototype,"classes",void 0),O=(0,i._)([(0,f.$)("esri.renderers.support.UniqueValueGroup")],O);const I=O;var L,N=r(99278),D=r(54547),F=r(60534),z=r(3521),V=r(36e3);const U="esri.renderers.UniqueValueRenderer",G=()=>a.A.getLogger(U),B="uvInfos-watcher",H="uvGroups-watcher",k=(0,y.dp)(N.A);let j=L=class extends((0,x.h)(b.A)){constructor(e){super(e),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,t){if(!e&&!t)return;if(!e||!t)return{type:"complete",oldValue:e,newValue:t};let r=!1;const i={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<t.length;n++){const s=e.find((e=>e.value===t[n].value));s?(0,g.Ui)(s,t[n])?(i.changed.push({type:"complete",oldValue:s,newValue:t[n]}),r=!0):i.unchanged.push({oldValue:s,newValue:t[n]}):(i.added.push(t[n]),r=!0)}for(let n=0;n<e.length;n++)t.find((t=>t.value===e[n].value))||(i.removed.push(e[n]),r=!0);return r?i:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(e){this._set("field",e),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(e){return null==e||"function"==typeof e?e:(0,y.GX)(e)}writeField(e,t,r,i){"string"==typeof e?t[r]=e:i?.messages?i.messages.push(new s.A("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):G().error(".field: cannot write field to JSON since it's not a string value")}set field2(e){this._set("field2",e),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(e){this._set("field3",e),this._updateUniqueValues()}set valueExpression(e){this._set("valueExpression",e),this._updateUniqueValues()}set defaultSymbol(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)}set fieldDelimiter(e){this._set("fieldDelimiter",e),this._updateUniqueValues()}readPortal(e,t,r){return r.portal||v.A.getDefault()}readStyleOrigin(e,t,r){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){const e=(0,F.f)(t.styleUrl,r);return Object.freeze({styleUrl:e})}}writeStyleOrigin(e,t,r,i){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=(0,F.t)(e.styleUrl,i))}set uniqueValueGroups(e){this.styleOrigin?G().error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",e),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(e){this.styleOrigin?G().error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(e,t){if(this.styleOrigin)return void G().error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let r;r="object"==typeof e?k(e):new N.A({value:e,symbol:(0,n.dp)(t)}),this.uniqueValueInfos?.push(r),this._valueInfoMap[r.value]=r,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(e){if(this.styleOrigin)return void G().error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const t=this.uniqueValueInfos;if(t)for(let r=0;r<t.length;r++){const i=t[r];if(String(i.value)===String(e)){delete this._valueInfoMap[e],t.splice(r,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(e,t){let r=t;return this.valueExpression&&null==t?.arcade&&(r={...r,arcade:await(0,D.lw)()}),this._getUniqueValueInfo(e,r)}getSymbol(e,t){if(this.valueExpression&&null==t?.arcade)return void G().error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this._getUniqueValueInfo(e,t);return r?.symbol||this.defaultSymbol}async getSymbolAsync(e,t){let r=t;if(this.valueExpression&&null==r?.arcade){const e=await(0,D.lw)(),{arcadeUtils:t}=e;t.hasGeometryOperations(this.valueExpression)&&await t.enableGeometryOperations(),r={...r,arcade:e}}const i=this._getUniqueValueInfo(e,r);return i?.symbol||this.defaultSymbol}getSymbols(){const e=[];for(const t of this.uniqueValueInfos??[])t.symbol&&e.push(t.symbol);return this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),r=this.uniqueValueInfos?.reduce(((e,t)=>e+t.getMeshHash()),"");return`${e}.${t}.${r}.${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}.${this.valueExpression}`}clone(){const e=new L({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:(0,o.o8)(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:(0,o.o8)(this.visualVariables),legendOptions:(0,o.o8)(this.legendOptions),authoringInfo:(0,o.o8)(this.authoringInfo),backgroundFillSymbol:(0,o.o8)(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);const t=(0,o.o8)(this.uniqueValueInfos),r=(0,o.o8)(this.uniqueValueGroups);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze((0,o.o8)(this.styleOrigin))),Object.freeze(t),Object.freeze(r)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e._set("uniqueValueGroups",r),e._isInfosSource=this._isInfosSource,e._watchUniqueValueInfosAndGroups(),e}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(e,t){const r=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(r)}async collectSymbolFields(e,t){const r=[...this.getSymbols().map((r=>r.collectRequiredFields(e,t))),(0,_.Dx)(e,t,this.valueExpression)];(0,_.rq)(e,t,this.field),(0,_.rq)(e,t,this.field2),(0,_.rq)(e,t,this.field3),await Promise.all(r)}populateFromStyle(){return(0,z.cF)(this.styleOrigin,{portal:this.portal}).then((e=>{const t=[];return this._valueInfoMap={},e?.data&&Array.isArray(e.data.items)&&e.data.items.forEach((r=>{const i=new V.A({styleUrl:e.styleUrl,styleName:e.styleName,portal:this.portal,name:r.name});this.defaultSymbol||r.name!==e.data.defaultItem||(this.defaultSymbol=i,this._isDefaultSymbolDerived=!0);const n=new N.A({value:r.name,symbol:i});t.push(n),this._valueInfoMap[r.name]=n})),this._set("uniqueValueInfos",Object.freeze(t)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&this.uniqueValueInfos?.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this}))}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",",")}_updateUniqueValues(){null!=this._isInfosSource&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:e}=this;if(e)for(const t of e)this._valueInfoMap[t.value+""]=t}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(B);const{uniqueValueInfos:e}=this;if(e){const t=[];for(const r of e)t.push((0,c.watch)((()=>({symbol:r.symbol,value:r.value,label:r.label,description:r.description})),((e,t)=>{e!==t&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)}),{sync:!0}));this.addHandles(t,B)}}_watchUniqueValueGroups(){this.removeHandles(H);const{uniqueValueGroups:e}=this;if(e){const t=[];for(const r of e){t.push((0,c.watch)((()=>({classes:r.classes})),((e,t)=>{e!==t&&(this._updateInfosFromGroups(),this._isInfosSource=!1)}),{sync:!0}));for(const e of r.classes??[])t.push((0,c.watch)((()=>({symbol:e.symbol,values:e.values,label:e.label,description:e.description})),((e,t)=>{e!==t&&(this._updateInfosFromGroups(),this._isInfosSource=!1)}),{sync:!0}))}this.addHandles(t,H)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const e=[],{field:t,field2:r,field3:i,fieldDelimiter:n,uniqueValueGroups:s,valueExpression:o}=this;if(!t&&!o)return this._set("uniqueValueInfos",e),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!t||!r);for(const t of s)for(const s of t.classes??[]){const{symbol:t,label:o,values:l,description:c}=s;for(const s of l??[]){const{value:l,value2:u,value3:h}=s,d=[l];r&&d.push(u),i&&d.push(h);const p=a?d.join(n||""):d[0]??void 0;e.push(new N.A({symbol:t,label:o,value:p,description:c}))}}this._set("uniqueValueInfos",e),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(e=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:t,field2:r,valueExpression:i,fieldDelimiter:n,uniqueValueInfos:s}=this;if(!t&&!i||!s.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!t||!r),a=s.map((e=>{const{symbol:t,label:r,value:i,description:s}=e,[a,l,c]=o?i?.toString()?.split(n||"")||[]:[i];return new P({symbol:t,label:r,description:s,values:[new E({value:a,value2:l,value3:c})]})})),l=[new I({classes:a})];e&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(e,t){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,t):this._getUnqiueValueInfoForFields(e)}_getUnqiueValueInfoForExpression(e,t){const{viewingMode:r,scale:i,spatialReference:n,arcade:s,timeZone:o}=t??{};let a=this._cache.compiledFunc;const l=s.arcadeUtils;if(!a){const e=l.createSyntaxTree(this.valueExpression);a=l.createFunction(e),this._cache.compiledFunc=a}const c=l.executeFunction(a,l.createExecContext(e,l.getViewInfo({viewingMode:r,scale:i,spatialReference:n}),o));return this._valueInfoMap[c+""]}_getUnqiueValueInfoForFields(e){const t=this.field,r=e.attributes;let i;if(this.field2){const e=this.field2,n=this.field3,s=[];t&&s.push(r[t]),e&&s.push(r[e]),n&&s.push(r[n]),i=s.join(this.fieldDelimiter||"")}else t&&(i=r[t]);return this._valueInfoMap[i+""]}static fromPortalStyle(e,t){const r=new L(t?.properties);r._set("styleOrigin",Object.freeze({styleName:e})),r._set("portal",t?.portal||v.A.getDefault());const i=r.populateFromStyle();return i.catch((t=>{G().error(`#fromPortalStyle('${e}'[, ...])`,"Failed to create unique value renderer from style name",t)})),i}static fromStyleUrl(e,t){const r=new L(t?.properties);r._set("styleOrigin",Object.freeze({styleUrl:e}));const i=r.populateFromStyle();return i.catch((t=>{G().error(`#fromStyleUrl('${e}'[, ...])`,"Failed to create unique value renderer from style URL",t)})),i}};(0,i._)([(0,u.MZ)({readOnly:!0})],j.prototype,"_cache",null),(0,i._)([(0,d.e)({uniqueValue:"unique-value"})],j.prototype,"type",void 0),(0,i._)([(0,u.MZ)(S.As)],j.prototype,"backgroundFillSymbol",void 0),(0,i._)([(0,u.MZ)({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],j.prototype,"field",null),(0,i._)([(0,h.w)("field")],j.prototype,"castField",null),(0,i._)([(0,m.K)("field")],j.prototype,"writeField",null),(0,i._)([(0,u.MZ)({type:String,value:null,json:{write:!0}})],j.prototype,"field2",null),(0,i._)([(0,u.MZ)({type:String,value:null,json:{write:!0}})],j.prototype,"field3",null),(0,i._)([(0,u.MZ)({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],j.prototype,"orderByClassesEnabled",void 0),(0,i._)([(0,u.MZ)({type:String,value:null,json:{write:!0}})],j.prototype,"valueExpression",null),(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],j.prototype,"valueExpressionTitle",void 0),(0,i._)([(0,u.MZ)({type:w.q,json:{write:!0}})],j.prototype,"legendOptions",void 0),(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],j.prototype,"defaultLabel",void 0),(0,i._)([(0,u.MZ)((0,l.$N)({...S.z4},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],j.prototype,"defaultSymbol",null),(0,i._)([(0,u.MZ)({type:String,value:null,json:{write:!0}})],j.prototype,"fieldDelimiter",null),(0,i._)([(0,u.MZ)({type:v.A,readOnly:!0})],j.prototype,"portal",void 0),(0,i._)([(0,p.w)("portal",["styleName"])],j.prototype,"readPortal",null),(0,i._)([(0,u.MZ)({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],j.prototype,"styleOrigin",void 0),(0,i._)([(0,p.w)("styleOrigin",["styleName","styleUrl"])],j.prototype,"readStyleOrigin",null),(0,i._)([(0,m.K)("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],j.prototype,"writeStyleOrigin",null),(0,i._)([(0,u.MZ)({type:[I],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(e,t,r)=>(t.uniqueValueGroups||function(e){const{field1:t,field2:r,field3:i,fieldDelimiter:n,uniqueValueInfos:s,valueExpression:o}=e,a=!(!t||!r);return[{classes:(s??[]).map((e=>{const{symbol:s,label:l,value:c,description:u}=e,[h,d,p]=a?c?.toString()?.split(n||"")||[]:[c],f=[];return(t||o)&&f.push(h),r&&f.push(d),i&&f.push(p),{symbol:s,label:l,values:[f],description:u}}))}]}(t)).map((e=>I.fromJSON(e,r)))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],j.prototype,"uniqueValueGroups",null),(0,i._)([(0,u.MZ)({type:[N.A],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],j.prototype,"uniqueValueInfos",null),j=L=(0,i._)([(0,f.$)(U)],j);const W=j},77056:function(e,t,r){r.d(t,{h:function(){return L}});var i=r(53804),n=r(23502),s=(r(58941),r(40633)),o=(r(13798),r(47332)),a=r(65953),l=r(81392),c=r(53743);const u=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var h,d=r(74843),p=r(64494),f=r(30905),m=r(67888),g=r(59798);let y=h=class extends f.oY{constructor(e){super(e),this.label=null,this.opacity=null,this.value=null}readOpacity(e,t){return(0,g.D)(t.transparency)}writeOpacity(e,t,r){t[r]=(0,g.p)(e)}clone(){return new h({label:this.label,opacity:this.opacity,value:this.value})}};(0,i._)([(0,n.MZ)({type:String,json:{write:!0}})],y.prototype,"label",void 0),(0,i._)([(0,n.MZ)({type:Number,json:{type:m.jz,write:{target:"transparency"}}})],y.prototype,"opacity",void 0),(0,i._)([(0,o.w)("opacity",["transparency"])],y.prototype,"readOpacity",null),(0,i._)([(0,l.K)("opacity")],y.prototype,"writeOpacity",null),(0,i._)([(0,n.MZ)({type:Number,json:{write:!0}})],y.prototype,"value",void 0),y=h=(0,i._)([(0,a.$)("esri.renderers.visualVariables.support.OpacityStop")],y);const _=y;var v;let b=v=class extends p.A{constructor(e){super(e),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter((e=>!!e))).sort(((e,t)=>e.value-t.value)),this._set("stops",e)}clone(){return new v({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map((e=>e.clone())),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map((e=>e.value||0))}};(0,i._)([(0,n.MZ)({readOnly:!0})],b.prototype,"cache",null),(0,i._)([(0,n.MZ)({type:["opacity"],json:{type:["transparencyInfo"]}})],b.prototype,"type",void 0),(0,i._)([(0,n.MZ)({type:String,json:{write:!0}})],b.prototype,"normalizationField",void 0),(0,i._)([(0,n.MZ)({type:[_],json:{write:!0}})],b.prototype,"stops",null),b=v=(0,i._)([(0,a.$)("esri.renderers.visualVariables.OpacityVariable")],b);const x=b;var S=r(36604),w=r(53096),T=r(83525),A=r(73037),C=r(89001);const E={color:d.A,size:w.A,opacity:x,rotation:S.A},M=new A.J({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),R=/^\[([^\]]+)\]$/i;let P=class extends T.A{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),e=e&&e.filter((e=>!!e)),e?.length){for(const t of e)switch(t.type){case"color":this.colorVariables.push(t);break;case"opacity":this.opacityVariables.push(t);break;case"rotation":this.rotationVariables.push(t);break;case"size":this.sizeVariables.push(t)}this.sizeVariables.length&&this.sizeVariables.some((e=>!!e.target))&&e.sort(((e,t)=>{let r=null;return r=e.target===t.target?0:e.target?1:-1,r}));for(let t=0;t<e.length;t++)e[t].index=t;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,t,r){const{rotationExpression:i,rotationType:n}=t,o=i?.match(R),a=o?.[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:n,field:a})),e)return e.map((e=>{const t=M.read(e.type),i=E[t];i||(s.A.getLogger(this).warn(`Unknown variable type: ${t}`),r?.messages&&r.messages.push(new C.A("visual-variable:unsupported",`visualVariable of type '${t}' is not supported`,{definition:e,context:r})));const n=new i;return n.read(e,r),n}))}writeVariables(e,t){const r=[];for(const i of e){const e=i.toJSON(t);e&&r.push(e)}return r}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};(0,i._)([(0,n.MZ)()],P.prototype,"visualVariables",null),P=(0,i._)([(0,a.$)("esri.renderers.visualVariables.VisualVariableFactory")],P);const O=P,I={base:p.A,key:"type",typeMap:{opacity:x,color:d.A,rotation:S.A,size:w.A}},L=e=>{let t=class extends e{constructor(){super(...arguments),this._vvFactory=new O}set visualVariables(e){this._vvFactory.visualVariables=e,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(e,t,r){return this._vvFactory.readVariables(e,t,r)}writeVisualVariables(e,t,r,i){t[r]=this._vvFactory.writeVariables(e,i)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const e of this.visualVariables)if(e.arcadeRequired)return!0;return!1}hasVisualVariables(e,t){return e?this.getVisualVariablesForType(e,t).length>0:this.getVisualVariablesForType("size",t).length>0||this.getVisualVariablesForType("color",t).length>0||this.getVisualVariablesForType("opacity",t).length>0||this.getVisualVariablesForType("rotation",t).length>0}getVisualVariablesForType(e,t){const r=this.visualVariables;return r?r.filter((r=>r.type===e&&("string"==typeof t?r.target===t:!1!==t||!r.target))):[]}async collectVVRequiredFields(e,t){let r=[];this.visualVariables&&(r=r.concat(this.visualVariables));for(const i of r)i&&(i.field&&(0,c.rq)(e,t,i.field),i.normalizationField&&(0,c.rq)(e,t,i.normalizationField),i.valueExpression&&(N(i.valueExpression,e,t)||await(0,c.Dx)(e,t,i.valueExpression)))}};return(0,i._)([(0,n.MZ)({types:[I],value:null,json:{write:!0}})],t.prototype,"visualVariables",null),(0,i._)([(0,o.w)("visualVariables",["visualVariables","rotationType","rotationExpression"])],t.prototype,"readVisualVariables",null),(0,i._)([(0,l.K)("visualVariables")],t.prototype,"writeVisualVariables",null),t=(0,i._)([(0,a.$)("esri.renderers.mixins.VisualVariablesMixin")],t),t};function N(e,t,r){const i=(n=e,n.match(u)?.[1]?.replace(/\\'/g,"'")??null);var n;return null!=i&&((0,c.rq)(t,r,i),!0)}},19563:function(e,t,r){r.d(t,{A:function(){return p}});var i,n=r(53804),s=r(52874),o=r(30905),a=r(40633),l=r(23502),c=r(77560),u=(r(13798),r(58941),r(65953)),h=r(67888);let d=i=class extends o.oY{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return null==e?e:"function"==typeof e?(a.A.getLogger(this).error(".field: field must be a string value"),null):(0,h.GX)(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new i({color:this.color?.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};(0,n._)([(0,l.MZ)({type:s.A,json:{type:[Number],write:!0}})],d.prototype,"color",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],d.prototype,"field",void 0),(0,n._)([(0,c.w)("field")],d.prototype,"castField",null),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],d.prototype,"label",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],d.prototype,"valueExpression",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],d.prototype,"valueExpressionTitle",void 0),d=i=(0,n._)([(0,u.$)("esri.renderers.support.AttributeColorInfo")],d);const p=d},53871:function(e,t,r){r.d(t,{A:function(){return D}});var i,n=r(53804),s=r(73037),o=r(30905),a=r(21609),l=r(23502),c=r(67888),u=r(47332),h=r(65953);r(58941),r(40633),r(13798);let d=i=class extends o.oY{constructor(e){super(e),this.minValue=0,this.maxValue=0}clone(){return new i({minValue:this.minValue,maxValue:this.maxValue})}};var p;(0,n._)([(0,l.MZ)({type:Number,json:{write:!0}})],d.prototype,"minValue",void 0),(0,n._)([(0,l.MZ)({type:Number,json:{write:!0}})],d.prototype,"maxValue",void 0),d=i=(0,n._)([(0,h.$)("esri.renderers.support.AuthoringInfoClassBreakInfo")],d);let f=p=class extends o.oY{constructor(e){super(e),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=new Array}clone(){return new p({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:(0,a.o8)(this.classBreakInfos)})}};(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],f.prototype,"field",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],f.prototype,"normalizationField",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],f.prototype,"label",void 0),(0,n._)([(0,l.MZ)({type:[d],json:{write:!0}})],f.prototype,"classBreakInfos",void 0),f=p=(0,n._)([(0,h.$)("esri.renderers.support.AuthoringInfoFieldInfo")],f);var m,g=r(77560);let y=m=class extends o.oY{constructor(e){super(e),this.label=null,this.size=null,this.value=null}clone(){return new m({label:this.label,value:this.value,size:this.size})}};(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],y.prototype,"label",void 0),(0,n._)([(0,l.MZ)({type:Number,json:{write:!0}})],y.prototype,"size",void 0),(0,n._)([(0,l.MZ)({type:Number,json:{write:!0}})],y.prototype,"value",void 0),y=m=(0,n._)([(0,h.$)("esri.renderers.support.AuthoringInfoSizeStop")],y);const _=y;var v;const b=new s.J({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),x=new s.J({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),S={key:e=>"number"==typeof e?"number":"string",typeMap:{number:Number,string:String},base:null},w=["high-to-low","above-and-below","centered-on","extremes"],T=[...new Set(["high-to-low","above-and-below","centered-on","extremes","above","below","high-to-low","above-and-below","above","below","reference-size"])],A=["seconds","minutes","hours","days","months","years"];let C=v=class extends o.oY{constructor(e){super(e),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(e){return"string"==typeof e||"number"==typeof e?e:null}get normalizationField(){return"reference-size"===this.theme?this._get("normalizationField"):null}set normalizationField(e){this._set("normalizationField",e)}get referenceSizeScale(){return"reference-size"===this.theme?this._get("referenceSizeScale"):null}set referenceSizeScale(e){this._set("referenceSizeScale",e)}get referenceSizeSymbolStyle(){return"reference-size"===this.theme?this._get("referenceSizeSymbolStyle"):null}set referenceSizeSymbolStyle(e){this._set("referenceSizeSymbolStyle",e)}castStartTime(e){return"string"==typeof e||"number"==typeof e?e:null}get sizeStops(){return"reference-size"===this.theme?this._get("sizeStops"):null}set sizeStops(e){this._set("sizeStops",e)}get style(){return"color"===this.type?this._get("style"):null}set style(e){this._set("style",e)}get theme(){return"color"===this.type||"size"===this.type?this._get("theme")||"high-to-low":null}set theme(e){this._set("theme",e)}clone(){return new v({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,normalizationField:this.normalizationField,referenceSizeScale:this.referenceSizeScale,referenceSizeSymbolStyle:this.referenceSizeSymbolStyle,sizeStops:(0,a.o8)(this.sizeStops),startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};(0,n._)([(0,l.MZ)({types:S,json:{write:!0}})],C.prototype,"endTime",void 0),(0,n._)([(0,g.w)("endTime")],C.prototype,"castEndTime",null),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],C.prototype,"field",void 0),(0,n._)([(0,l.MZ)({type:Number,json:{write:!0}})],C.prototype,"maxSliderValue",void 0),(0,n._)([(0,l.MZ)({type:Number,json:{write:!0}})],C.prototype,"minSliderValue",void 0),(0,n._)([(0,l.MZ)({type:String,json:{origins:{"web-scene":{write:!1}},write:!0}})],C.prototype,"normalizationField",null),(0,n._)([(0,l.MZ)({type:Number,value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],C.prototype,"referenceSizeScale",null),(0,n._)([(0,l.MZ)({type:["circle","diamond","hexagon-flat","hexagon-pointy","square"],value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],C.prototype,"referenceSizeSymbolStyle",null),(0,n._)([(0,l.MZ)({types:S,json:{write:!0}})],C.prototype,"startTime",void 0),(0,n._)([(0,g.w)("startTime")],C.prototype,"castStartTime",null),(0,n._)([(0,l.MZ)({type:[_],json:{origins:{"web-scene":{write:!1}},write:!0}})],C.prototype,"sizeStops",null),(0,n._)([(0,l.MZ)({type:b.apiValues,value:null,json:{type:b.jsonValues,read:b.read,write:b.write}})],C.prototype,"style",null),(0,n._)([(0,l.MZ)({type:T,value:null,json:{type:T,origins:{"web-scene":{type:w,write:{writer:(e,t)=>{w.includes(e)&&(t.theme=e)}}}},write:!0}})],C.prototype,"theme",null),(0,n._)([(0,l.MZ)({type:x.apiValues,json:{type:x.jsonValues,read:x.read,write:x.write}})],C.prototype,"type",void 0),(0,n._)([(0,l.MZ)({type:A,json:{type:A,write:!0}})],C.prototype,"units",void 0),C=v=(0,n._)([(0,h.$)("esri.renderers.support.AuthoringInfoVisualVariable")],C);const E=C;var M,R=r(85982);const P=new s.J({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),O=new s.J({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),I=new s.J({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),L=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"];let N=M=class extends o.oY{constructor(e){super(e),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const e=this._get("classificationMethod"),t=this.type;return t&&"relationship"!==t?"class-breaks-size"===t||"class-breaks-color"===t?e||"manual":null:e}set classificationMethod(e){this._set("classificationMethod",e)}readColorRamp(e){return e?(0,R.r)(e):void 0}get fields(){return this.type&&"predominance"!==this.type?null:this._get("fields")}set fields(e){this._set("fields",e)}get field1(){return this.type&&"relationship"!==this.type?null:this._get("field1")}set field1(e){this._set("field1",e)}get field2(){return this.type&&"relationship"!==this.type?null:this._get("field2")}set field2(e){this._set("field2",e)}get flowTheme(){return"flow"===this.type?this._get("flowTheme"):null}set flowTheme(e){this._set("flowTheme",e)}get focus(){return this.type&&"relationship"!==this.type?null:this._get("focus")}set focus(e){this._set("focus",e)}get numClasses(){return this.type&&"relationship"!==this.type?null:this._get("numClasses")}set numClasses(e){this._set("numClasses",e)}get statistics(){return"univariate-color-size"===this.type&&"above-and-below"===this.univariateTheme?this._get("statistics"):null}set statistics(e){this._set("statistics",e)}get standardDeviationInterval(){const e=this.type;return e&&"relationship"!==e&&"class-breaks-size"!==e&&"class-breaks-color"!==e||this.classificationMethod&&"standard-deviation"!==this.classificationMethod?null:this._get("standardDeviationInterval")}set standardDeviationInterval(e){this._set("standardDeviationInterval",e)}get type(){return this._get("type")}set type(e){let t=e;"classed-size"===e?t="class-breaks-size":"classed-color"===e&&(t="class-breaks-color"),this._set("type",t)}get univariateSymbolStyle(){return"univariate-color-size"===this.type&&"above-and-below"===this.univariateTheme?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(e){this._set("univariateSymbolStyle",e)}get univariateTheme(){return"univariate-color-size"===this.type?this._get("univariateTheme"):null}set univariateTheme(e){this._set("univariateTheme",e)}clone(){return new M({classificationMethod:this.classificationMethod,colorRamp:(0,a.o8)(this.colorRamp),fadeRatio:(0,a.o8)(this.fadeRatio),fields:this.fields?.slice(0),field1:(0,a.o8)(this.field1),field2:(0,a.o8)(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map((e=>e.clone())),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};(0,n._)([(0,l.MZ)({type:P.apiValues,value:null,json:{type:P.jsonValues,read:P.read,write:P.write,origins:{"web-document":{default:"manual",type:P.jsonValues,read:P.read,write:P.write}}}})],N.prototype,"classificationMethod",null),(0,n._)([(0,l.MZ)({types:R.g,json:{write:!0}})],N.prototype,"colorRamp",void 0),(0,n._)([(0,u.w)("colorRamp")],N.prototype,"readColorRamp",null),(0,n._)([(0,l.MZ)({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],N.prototype,"fadeRatio",void 0),(0,n._)([(0,l.MZ)({type:[String],value:null,json:{write:!0}})],N.prototype,"fields",null),(0,n._)([(0,l.MZ)({type:f,value:null,json:{write:!0}})],N.prototype,"field1",null),(0,n._)([(0,l.MZ)({type:f,value:null,json:{write:!0}})],N.prototype,"field2",null),(0,n._)([(0,l.MZ)({type:["flow-line","wave-front"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],N.prototype,"flowTheme",null),(0,n._)([(0,l.MZ)({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],N.prototype,"focus",null),(0,n._)([(0,l.MZ)({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],N.prototype,"isAutoGenerated",void 0),(0,n._)([(0,l.MZ)({type:Number,value:null,json:{type:c.jz,write:!0}})],N.prototype,"numClasses",null),(0,n._)([(0,l.MZ)({type:L,json:{type:L,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],N.prototype,"lengthUnit",void 0),(0,n._)([(0,l.MZ)({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],N.prototype,"maxSliderValue",void 0),(0,n._)([(0,l.MZ)({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],N.prototype,"minSliderValue",void 0),(0,n._)([(0,l.MZ)({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],N.prototype,"statistics",null),(0,n._)([(0,l.MZ)({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],N.prototype,"standardDeviationInterval",null),(0,n._)([(0,l.MZ)({type:O.apiValues,value:null,json:{type:O.jsonValues,read:O.read,write:O.write,origins:{"web-scene":{type:I.jsonValues,write:{writer:I.write,overridePolicy:e=>({enabled:"flow"!==e})}}}}})],N.prototype,"type",null),(0,n._)([(0,l.MZ)({type:[E],json:{write:!0}})],N.prototype,"visualVariables",void 0),(0,n._)([(0,l.MZ)({type:["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],N.prototype,"univariateSymbolStyle",null),(0,n._)([(0,l.MZ)({type:["high-to-low","above-and-below","above","below"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],N.prototype,"univariateTheme",null),N=M=(0,n._)([(0,h.$)("esri.renderers.support.AuthoringInfo")],N);const D=N},23879:function(e,t,r){r.d(t,{A:function(){return u}});var i,n=r(53804),s=r(30905),o=r(23502),a=(r(58941),r(40633),r(13798),r(65953)),l=r(85336);let c=i=class extends s.oY{constructor(e){super(e),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new i({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?.clone()??null})}getMeshHash(){const e=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${e}`}};(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],c.prototype,"description",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],c.prototype,"label",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],c.prototype,"minValue",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],c.prototype,"maxValue",void 0),(0,n._)([(0,o.MZ)(l.Wp)],c.prototype,"symbol",void 0),c=i=(0,n._)([(0,a.$)("esri.renderers.support.ClassBreakInfo")],c);const u=c},27419:function(e,t,r){r.d(t,{A:function(){return h}});var i,n=r(53804),s=r(52874),o=r(30905),a=r(23502),l=r(67888),c=(r(13798),r(58941),r(65953));let u=i=class extends o.oY{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new i({color:this.color&&this.color.clone(),ratio:this.ratio})}};(0,n._)([(0,a.MZ)({type:s.A,json:{type:[l.jz],default:null,write:!0}})],u.prototype,"color",void 0),(0,n._)([(0,a.MZ)({type:Number,json:{write:!0}})],u.prototype,"ratio",void 0),u=i=(0,n._)([(0,c.$)("esri.renderers.support.HeatmapColorStop")],u);const h=u},49951:function(e,t,r){r.d(t,{q:function(){return l}});var i,n=r(53804),s=r(30905),o=r(23502),a=(r(58941),r(40633),r(13798),r(65953));let l=i=class extends s.oY{constructor(){super(...arguments),this.title=null}clone(){return new i({title:this.title})}};(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],l.prototype,"title",void 0),l=i=(0,n._)([(0,a.$)("esri.renderers.support.LegendOptions")],l)},99278:function(e,t,r){r.d(t,{A:function(){return u}});var i,n=r(53804),s=r(30905),o=r(23502),a=(r(58941),r(40633),r(13798),r(65953)),l=r(85336);let c=i=class extends s.oY{constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new i({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol?.toJSON());return`${this.value}.${e}`}};(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],c.prototype,"description",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],c.prototype,"label",void 0),(0,n._)([(0,o.MZ)(l.Wp)],c.prototype,"symbol",void 0),(0,n._)([(0,o.MZ)(l.Ug)],c.prototype,"value",void 0),c=i=(0,n._)([(0,a.$)("esri.renderers.support.UniqueValueInfo")],c);const u=c},85336:function(e,t,r){r.d(t,{As:function(){return h},Ug:function(){return d},Wp:function(){return u},z4:function(){return c}});var i=r(10748),n=r(34194),s=r(51575),o=r(8404),a=r(34563),l=r(15186);const c={types:i.xK,json:{write:{writer:o.M9},origins:{"web-scene":{types:i.On,write:{writer:o.M9},read:{reader:(0,s.C)({types:i.On})}}}}},u=(0,n.$N)({json:{origins:{"web-scene":{write:{isRequired:!0}}}}},c),h={types:{base:a.A,key:"type",typeMap:{"simple-fill":i.Es.typeMap["simple-fill"],"picture-fill":i.Es.typeMap["picture-fill"],"polygon-3d":i.Es.typeMap["polygon-3d"]}},json:{write:{writer:o.M9},origins:{"web-scene":{type:l.A,write:{writer:o.M9}}}}},d={cast:e=>null==e||"string"==typeof e||"number"==typeof e?e:`${e}`,json:{type:String,write:{writer:(e,t)=>{t.value=e?.toString()}}}}},70181:function(e,t,r){r.d(t,{O3:function(){return h},PU:function(){return c},YW:function(){return p},ex:function(){return a},hv:function(){return d},zp:function(){return l}});var i=r(15774),n=r(13520),s=r(33400),o=r(41546);const a=2.4;function l(e){return(0,n.PN)(e*a)}function c(e){return(0,n.Lz)(e)/a}function u(e,t,r,n){let{color:o,ratio:a}=t,{color:l,ratio:c}=r;if(c===a){const e=1e-6;1===c?a-=e:c+=e}const u=(0,i.qE)((n-a)/(c-a),0,1);(0,s.l)(e,o.toArray(),l.toArray(),u)}function h(e){const t=new Uint8ClampedArray(2048);if((e=e.filter((({ratio:e})=>e>=0&&e<=1)).sort(((e,t)=>e.ratio-t.ratio)).map((({color:e,ratio:t})=>({color:e,ratio:Math.max(t,.001)})))).length<1)return t;let r=e[0],i=e[0],n=1;const s=(0,o.vt)();for(let o=0;o<512;o++){const a=(o+.5)/512;for(;a>i.ratio&&n<e.length;)r=i,i=e[n++];u(s,r,i,a),t.set(s,4*o)}return t}function d(e,t,r){const i=Math.sqrt(e**2+t**2)/r;return i>1?0:3/(Math.PI*r**2)*(1-i**2)**2}function p(e){return"function"==typeof e?e:e?t=>+t[e]:()=>1}},6537:function(e,t,r){r.d(t,{L:function(){return l},r:function(){return o}});var i=r(89001),n=r(51575),s=r(31315);function o(e,t){return l(e,null,t)}const a=(0,n.C)({types:s.H});function l(e,t,r){return e?e&&(e.styleName||e.styleUrl)&&"uniqueValue"!==e.type?(r?.messages&&r.messages.push(new i.A("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:r})),null):a(e,t,r):null}},31315:function(e,t,r){r.d(t,{H:function(){return d},X:function(){return p}});var i=r(40633),n=r(74865),s=r(1526),o=r(96173),a=r(52308),l=r(60189),c=r(30047),u=r(27777),h=r(61065);const d={key:"type",base:c.A,typeMap:{heatmap:a.A,simple:u.A,"unique-value":h.A,"class-breaks":n.A,"dot-density":o.A,dictionary:s.A,"pie-chart":l.A},errorContext:"renderer"},p={key:"type",base:c.A,typeMap:{simple:u.A,"unique-value":h.A,"class-breaks":n.A,heatmap:a.A},errorContext:"renderer",validate:function(e){switch(e.type){case"simple":return function(e){if(e.symbol)return e;i.A.getLogger("esri.renderers.support.types").error("Removed invalid 'simple' renderer without a symbol from web scene.")}(e);case"unique-value":return function(e){const t=e.uniqueValueInfos,r=t?.filter((({symbol:e,label:t},r)=>(e||i.A.getLogger("esri.renderers.support.types").error(`Removed invalid unique value info ([${r}] ${t}) without a symbol from web scene.`),!!e)));return r?.length!==t?.length&&(e.uniqueValueInfos=r),e}(e);case"class-breaks":return function(e){const t=e.classBreakInfos,r=t?.filter((({symbol:e,label:t},r)=>(e||i.A.getLogger("esri.renderers.support.types").error(`Removed invalid class break info ([${r}] ${t}) without a symbol from web scene.`),!!e)));return r?.length!==t?.length&&(e.classBreakInfos=r),e}(e);case"heatmap":return e}}}},74843:function(e,t,r){r.d(t,{A:function(){return u}});var i,n=r(53804),s=r(23502),o=(r(58941),r(40633),r(13798),r(65953)),a=r(64494),l=r(71859);let c=i=class extends a.A{constructor(e){super(e),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter((e=>!!e))).sort(((e,t)=>e.value-t.value)),this._set("stops",e)}clone(){return new i({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map((e=>e.clone())),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map((e=>e.value||0))}};(0,n._)([(0,s.MZ)({readOnly:!0})],c.prototype,"cache",null),(0,n._)([(0,s.MZ)({type:["color"],json:{type:["colorInfo"]}})],c.prototype,"type",void 0),(0,n._)([(0,s.MZ)({type:String,json:{write:!0}})],c.prototype,"normalizationField",void 0),(0,n._)([(0,s.MZ)({type:[l.A],json:{write:!0}})],c.prototype,"stops",null),c=i=(0,n._)([(0,o.$)("esri.renderers.visualVariables.ColorVariable")],c);const u=c},36604:function(e,t,r){r.d(t,{A:function(){return h}});var i,n=r(53804),s=r(39819),o=r(23502),a=(r(58941),r(40633),r(13798),r(65953)),l=r(81392),c=r(64494);let u=i=class extends c.A{constructor(e){super(e),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(e,t,r,i){if(i?.messages){const e=`visualVariables[${this.index}]`;i.messages.push(new s.A("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:e+".valueExpressionTitle",context:i}))}}clone(){return new i({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions?.clone()})}};(0,n._)([(0,o.MZ)({readOnly:!0})],u.prototype,"cache",null),(0,n._)([(0,o.MZ)({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],u.prototype,"axis",void 0),(0,n._)([(0,o.MZ)({type:["rotation"],json:{type:["rotationInfo"]}})],u.prototype,"type",void 0),(0,n._)([(0,o.MZ)({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],u.prototype,"rotationType",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],u.prototype,"valueExpressionTitle",void 0),(0,n._)([(0,l.K)("web-scene","valueExpressionTitle")],u.prototype,"writeValueExpressionTitleWebScene",null),u=i=(0,n._)([(0,a.$)("esri.renderers.visualVariables.RotationVariable")],u);const h=u},53096:function(e,t,r){r.d(t,{A:function(){return E}});var i,n=r(53804),s=r(39819),o=r(73037),a=r(40633),l=r(23502),c=r(77560),u=r(47332),h=r(65953),d=r(81392),p=r(64494),f=r(13520),m=r(59423),g=(r(58941),r(13798),r(96893));let y=i=class extends g.A{constructor(){super(...arguments),this.customValues=null}clone(){return new i({title:this.title,showLegend:this.showLegend,customValues:this.customValues?.slice(0)})}};(0,n._)([(0,l.MZ)({type:[Number],json:{write:!0}})],y.prototype,"customValues",void 0),y=i=(0,n._)([(0,h.$)("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],y);const _=y;var v,b=r(32974),x=r(70481);const S=new o.J({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),w=new o.J({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function T(e){if(null!=e)return"string"==typeof e||"number"==typeof e?function(e){return(0,f.cr)(e)}(e):"size"===e.type?(0,b.of)(e)?e:(delete(e={...e}).type,new C(e)):void 0}function A(e,t,r){if("object"!=typeof e)return e;const i=new C;return i.read(e,r),i}let C=v=class extends p.A{constructor(e){super(e),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:null!=this.valueExpression&&x.viewScaleRE.test(this.valueExpression)}}set index(e){(0,b.of)(this.maxSize)&&(this.maxSize.index=`visualVariables[${e}].maxSize`),(0,b.of)(this.minSize)&&(this.minSize.index=`visualVariables[${e}].minSize`),this._set("index",e)}get inputValueType(){return(0,b.eh)(this)}set maxDataValue(e){e&&this.stops&&(a.A.getLogger(this).warn("cannot set maxDataValue when stops is not null."),e=null),this._set("maxDataValue",e)}set maxSize(e){e&&this.stops&&(a.A.getLogger(this).warn("cannot set maxSize when stops is not null."),e=null),this._set("maxSize",e)}castMaxSize(e){return T(e)}readMaxSize(e,t,r){return A(e,0,r)}set minDataValue(e){e&&this.stops&&(a.A.getLogger(this).warn("cannot set minDataValue when stops is not null."),e=null),this._set("minDataValue",e)}set minSize(e){e&&this.stops&&(a.A.getLogger(this).warn("cannot set minSize when stops is not null."),e=null),this._set("minSize",e)}castMinSize(e){return T(e)}readMinSize(e,t,r){return A(e,0,r)}get arcadeRequired(){return!!this.valueExpression||null!=this.minSize&&"object"==typeof this.minSize&&this.minSize.arcadeRequired||null!=this.maxSize&&"object"==typeof this.maxSize&&this.maxSize.arcadeRequired}set stops(e){null==this.minDataValue&&null==this.maxDataValue&&null==this.minSize&&null==this.maxSize?e&&Array.isArray(e)&&(e=e.filter((e=>!!e))).sort(((e,t)=>e.value-t.value)):e&&(a.A.getLogger(this).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),e=null),this._set("stops",e)}get transformationType(){return(0,b.KZ)(this,this.inputValueType)}readValueExpression(e,t){return e||t.expression&&"$view.scale"}writeValueExpressionWebScene(e,t,r,i){if("$view.scale"===e){if(i?.messages){const e=this.index,t="string"==typeof e?e:`visualVariables[${e}]`;i.messages.push(new s.A("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:t+".valueExpression",context:i}))}}else t[r]=e}readValueUnit(e){return e?w.read(e):null}clone(){return new v({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:(0,b.of)(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:(0,b.of)(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops?.map((e=>e.clone())),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions?.clone()})}flipSizes(){if(this.transformationType===b._w.ClampedLinear){const{minSize:e,maxSize:t}=this;return this.minSize=t,this.maxSize=e,this}if(this.transformationType===b._w.Stops){const e=this.stops;if(!e)return this;const t=e.map((e=>e.size)).reverse(),r=e.length;for(let i=0;i<r;i++)e[i].size=t[i];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops?.map((e=>e.value||0))}};(0,n._)([(0,l.MZ)({readOnly:!0})],C.prototype,"cache",null),(0,n._)([(0,l.MZ)({type:S.apiValues,json:{type:S.jsonValues,origins:{"web-map":{read:!1}},read:S.read,write:S.write}})],C.prototype,"axis",void 0),(0,n._)([(0,l.MZ)()],C.prototype,"index",null),(0,n._)([(0,l.MZ)({type:String,readOnly:!0})],C.prototype,"inputValueType",null),(0,n._)([(0,l.MZ)({type:_,json:{write:!0}})],C.prototype,"legendOptions",void 0),(0,n._)([(0,l.MZ)({type:Number,value:null,json:{write:!0}})],C.prototype,"maxDataValue",null),(0,n._)([(0,l.MZ)({type:Number,value:null,json:{write:!0}})],C.prototype,"maxSize",null),(0,n._)([(0,c.w)("maxSize")],C.prototype,"castMaxSize",null),(0,n._)([(0,u.w)("maxSize")],C.prototype,"readMaxSize",null),(0,n._)([(0,l.MZ)({type:Number,value:null,json:{write:!0}})],C.prototype,"minDataValue",null),(0,n._)([(0,l.MZ)({type:Number,value:null,json:{write:!0}})],C.prototype,"minSize",null),(0,n._)([(0,c.w)("minSize")],C.prototype,"castMinSize",null),(0,n._)([(0,u.w)("minSize")],C.prototype,"readMinSize",null),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],C.prototype,"normalizationField",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],C.prototype,"arcadeRequired",null),(0,n._)([(0,l.MZ)({type:String})],C.prototype,"scaleBy",void 0),(0,n._)([(0,l.MZ)({type:[m.A],value:null,json:{write:!0}})],C.prototype,"stops",null),(0,n._)([(0,l.MZ)({type:["outline"],json:{write:!0}})],C.prototype,"target",void 0),(0,n._)([(0,l.MZ)({type:String,readOnly:!0})],C.prototype,"transformationType",null),(0,n._)([(0,l.MZ)({type:["size"],json:{type:["sizeInfo"]}})],C.prototype,"type",void 0),(0,n._)([(0,l.MZ)({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],C.prototype,"useSymbolValue",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],C.prototype,"valueExpression",void 0),(0,n._)([(0,u.w)("valueExpression",["valueExpression","expression"])],C.prototype,"readValueExpression",null),(0,n._)([(0,d.K)("web-scene","valueExpression")],C.prototype,"writeValueExpressionWebScene",null),(0,n._)([(0,l.MZ)({type:["radius","diameter","area","width","distance"],json:{write:!0}})],C.prototype,"valueRepresentation",void 0),(0,n._)([(0,l.MZ)({type:w.apiValues,json:{write:w.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],C.prototype,"valueUnit",void 0),(0,n._)([(0,u.w)("valueUnit")],C.prototype,"readValueUnit",null),C=v=(0,n._)([(0,h.$)("esri.renderers.visualVariables.SizeVariable")],C);const E=C},64494:function(e,t,r){r.d(t,{A:function(){return f}});var i=r(53804),n=r(73037),s=r(30905),o=r(40633),a=r(23502),l=r(77560),c=r(65953),u=r(67888),h=r(96893);const d=new n.J({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let p=class extends s.oY{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return null==e?e:"function"==typeof e?(o.A.getLogger(this).error(".field: field must be a string value"),null):(0,u.GX)(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};(0,i._)([(0,a.MZ)()],p.prototype,"index",void 0),(0,i._)([(0,a.MZ)({type:d.apiValues,readOnly:!0,json:{read:d.read,write:d.write}})],p.prototype,"type",void 0),(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],p.prototype,"field",void 0),(0,i._)([(0,l.w)("field")],p.prototype,"castField",null),(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],p.prototype,"valueExpression",void 0),(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],p.prototype,"valueExpressionTitle",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],p.prototype,"arcadeRequired",null),(0,i._)([(0,a.MZ)({type:h.A,json:{write:!0}})],p.prototype,"legendOptions",void 0),p=(0,i._)([(0,c.$)("esri.renderers.visualVariables.VisualVariable")],p);const f=p},71859:function(e,t,r){r.d(t,{A:function(){return d}});var i,n=r(53804),s=r(52874),o=r(30905),a=r(23502),l=r(67888),c=(r(13798),r(58941),r(65953)),u=r(81392);let h=i=class extends o.oY{constructor(e){super(e),this.color=null,this.label=null,this.value=null}writeValue(e,t,r){t[r]=e??0}clone(){return new i({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};(0,n._)([(0,a.MZ)({type:s.A,json:{type:[l.jz],write:!0}})],h.prototype,"color",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],h.prototype,"label",void 0),(0,n._)([(0,a.MZ)({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],h.prototype,"value",void 0),(0,n._)([(0,u.K)("value")],h.prototype,"writeValue",null),h=i=(0,n._)([(0,c.$)("esri.renderers.visualVariables.support.ColorStop")],h);const d=h},59423:function(e,t,r){r.d(t,{A:function(){return u}});var i,n=r(53804),s=r(30905),o=r(13520),a=r(23502),l=(r(58941),r(40633),r(13798),r(65953));let c=i=class extends s.oY{constructor(e){super(e),this.label=null,this.size=null,this.value=null,this.useMinValue=null,this.useMaxValue=null}clone(){return new i({label:this.label,size:this.size,value:this.value,useMaxValue:this.useMaxValue,useMinValue:this.useMinValue})}};(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],c.prototype,"label",void 0),(0,n._)([(0,a.MZ)({type:Number,cast:o.cr,json:{write:!0}})],c.prototype,"size",void 0),(0,n._)([(0,a.MZ)({type:Number,json:{write:!0}})],c.prototype,"value",void 0),(0,n._)([(0,a.MZ)({type:Boolean,json:{write:!1}})],c.prototype,"useMinValue",void 0),(0,n._)([(0,a.MZ)({type:Boolean,json:{write:!1}})],c.prototype,"useMaxValue",void 0),c=i=(0,n._)([(0,l.$)("esri.renderers.visualVariables.support.SizeStop")],c);const u=c},96893:function(e,t,r){r.d(t,{A:function(){return c}});var i,n=r(53804),s=r(23502),o=(r(58941),r(40633),r(13798),r(65953)),a=r(49951);let l=i=class extends a.q{constructor(){super(...arguments),this.showLegend=null}clone(){return new i({title:this.title,showLegend:this.showLegend})}};(0,n._)([(0,s.MZ)({type:Boolean,json:{write:!0}})],l.prototype,"showLegend",void 0),l=i=(0,n._)([(0,o.$)("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],l);const c=l},32974:function(e,t,r){var i,n;function s(e){return e&&"esri.renderers.visualVariables.SizeVariable"===e.declaredClass}function o(e){return null!=e&&!isNaN(e)&&isFinite(e)}function a(e){return e.valueExpression?i.Expression:e.field&&"string"==typeof e.field?i.Field:i.Unknown}function l(e,t){const r=t||a(e),s=e.valueUnit||"unknown";return r===i.Unknown?n.Constant:e.stops?n.Stops:null!=e.minSize&&null!=e.maxSize&&null!=e.minDataValue&&null!=e.maxDataValue?n.ClampedLinear:"unknown"===s?null!=e.minSize&&null!=e.minDataValue?e.minSize&&e.minDataValue?n.Proportional:n.Additive:n.Identity:n.RealWorldSize}r.d(t,{KZ:function(){return l},Yf:function(){return i},_w:function(){return n},eh:function(){return a},gf:function(){return o},of:function(){return s}}),function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"}(i||(i={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(n||(n={}))},70481:function(e,t,r){r.r(t),r.d(t,{getAllSizes:function(){return A},getColor:function(){return m},getOpacity:function(){return g},getRotationAngle:function(){return y},getSize:function(){return _},getSizeForValue:function(){return x},getSizeFromNumberOrVariable:function(){return v},getSizeRangeAtScale:function(){return S},getVisualVariableValues:function(){return w},viewScaleRE:function(){return f}});var i=r(52874),n=r(59469),s=r(82547),o=r(40633),a=r(85031),l=r(32974);const c=()=>o.A.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),u=e=>c().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${e}`),h=()=>c().error("Use of arcade expressions requires an arcade context"),d=new n.default,p=Math.PI,f=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function m(e,t,r){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"color"===e.type)):e;if(!n)return;if("esri.renderers.visualVariables.ColorVariable"!==n.declaredClass)return void u("ColorVariable");const s="number"==typeof t,o=s?null:t,a=o?.attributes;let l=s?t:null;const c=n.field,{ipData:d,hasExpression:p}=n.cache;let f=n.cache.compiledFunc;if(!c&&!p){const e=n.stops;return e&&e[0]&&e[0].color}if("number"!=typeof l)if(p){if(null==r?.arcade)return void h();const e={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},t=r.arcade.arcadeUtils,i=t.getViewInfo(e),s=t.createExecContext(o,i,r.timeZone);if(!f){const e=t.createSyntaxTree(n.valueExpression);f=t.createFunction(e),n.cache.compiledFunc=f}l=t.executeFunction(f,s)}else a&&(l=a[c]);const m=n.normalizationField,g=null!=a&&null!=m?parseFloat(a[m]):void 0;if(null!=l&&(!m||s||!isNaN(g)&&0!==g)){isNaN(g)||s||(l/=g);const e=T(l,d);if(e){const t=e[0],s=e[1],o=t===s?n.stops[t].color:i.A.blendColors(n.stops[t].color,n.stops[s].color,e[2],null!=r?r.color:void 0);return new i.A(o)}}}function g(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"opacity"===e.type)):e;if(!i)return;if("esri.renderers.visualVariables.OpacityVariable"!==i.declaredClass)return void u("OpacityVariable");const n="number"==typeof t,s=n?null:t,o=s?.attributes;let a=n?t:null;const l=i.field,{ipData:c,hasExpression:d}=i.cache;let p=i.cache.compiledFunc;if(!l&&!d){const e=i.stops;return e&&e[0]&&e[0].opacity}if("number"!=typeof a)if(d){if(null==r?.arcade)return void h();const e={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},t=r.arcade.arcadeUtils,n=t.getViewInfo(e),o=t.createExecContext(s,n,r.timeZone);if(!p){const e=t.createSyntaxTree(i.valueExpression);p=t.createFunction(e),i.cache.compiledFunc=p}a=t.executeFunction(p,o)}else o&&(a=o[l]);const f=i.normalizationField,m=null!=o&&null!=f?parseFloat(o[f]):void 0;if(null!=a&&(!f||n||!isNaN(m)&&0!==m)){isNaN(m)||n||(a/=m);const e=T(a,c);if(e){const t=e[0],r=e[1];if(t===r)return i.stops[t].opacity;{const n=i.stops[t].opacity;return n+(i.stops[r].opacity-n)*e[2]}}}}function y(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"rotation"===e.type)):e;if(!i)return;if("esri.renderers.visualVariables.RotationVariable"!==i.declaredClass)return void u("RotationVariable");const n=i.axis||"heading",s="heading"===n&&"arithmetic"===i.rotationType?90:0,o="heading"===n&&"arithmetic"===i.rotationType?-1:1,a="number"==typeof t?null:t,l=a?.attributes,c=i.field,{hasExpression:d}=i.cache;let p=i.cache.compiledFunc,f=0;if(!c&&!d)return f;if(d){if(null==r?.arcade)return void h();const e={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},t=r.arcade.arcadeUtils,n=t.getViewInfo(e),s=t.createExecContext(a,n,r.timeZone);if(!p){const e=t.createSyntaxTree(i.valueExpression);p=t.createFunction(e),i.cache.compiledFunc=p}f=t.executeFunction(p,s)}else l&&(f=l[c]||0);return f="number"!=typeof f||isNaN(f)?null:s+o*f,f}function _(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"size"===e.type)):e;if(!i)return;if("esri.renderers.visualVariables.SizeVariable"!==i.declaredClass)return void u("SizeVariable");const n=x(function(e,t,r){const i="number"==typeof t,n=i?null:t,s=n?.attributes;let o=i?t:null;const{isScaleDriven:a}=e.cache;let c=e.cache.compiledFunc;if(a){const t=null!=r?r.scale:void 0,i=null!=r?r.view:void 0;o=null==t||"3d"===i?function(e){let t=null,r=null;const i=e.stops;return i?(t=i[0].value,r=i[i.length-1].value):(t=e.minDataValue||0,r=e.maxDataValue||0),(t+r)/2}(e):t}else if(!i)switch(e.inputValueType){case l.Yf.Expression:{if(null==r?.arcade)return void h();const t={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},i=r.arcade.arcadeUtils,s=i.getViewInfo(t),a=i.createExecContext(n,s,r.timeZone);if(!c){const t=i.createSyntaxTree(e.valueExpression);c=i.createFunction(t),e.cache.compiledFunc=c}o=i.executeFunction(c,a);break}case l.Yf.Field:s&&(o=s[e.field]);break;case l.Yf.Unknown:o=null}if(!(0,l.gf)(o))return null;if(i||!e.normalizationField)return o;const u=s?parseFloat(s[e.normalizationField]):null;return(0,l.gf)(u)&&0!==u?o/u:null}(i,t,r),i,t,r,i.cache.ipData);return null==n||isNaN(n)?0:n}function v(e,t,r){return null==e?null:(0,l.of)(e)?_(e,t,r):(0,l.gf)(e)?e:null}function b(e,t,r){return(0,l.gf)(r)&&e>r?r:(0,l.gf)(t)&&e<t?t:e}function x(e,t,r,i,n){switch(t.transformationType){case l._w.Additive:return function(e,t,r,i){return e+((v(t.minSize,r,i)||t.minDataValue)??0)}(e,t,r,i);case l._w.Constant:return function(e,t,r){const i=e.stops;let n=i?.length&&i[0].size;return null==n&&(n=e.minSize),v(n,t,r)}(t,r,i);case l._w.ClampedLinear:return function(e,t,r,i){const n=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),s=v(t.minSize,r,i),o=v(t.maxSize,r,i),a=null!=i?i.shape:void 0;if(e<=t.minDataValue)return s;if(e>=t.maxDataValue)return o;if(null==s||null==o)return null;if("area"===t.scaleBy&&a){const e="circle"===a,t=e?p*(s/2)**2:s*s,r=t+n*((e?p*(o/2)**2:o*o)-t);return e?2*Math.sqrt(r/p):Math.sqrt(r)}return s+n*(o-s)}(e,t,r,i);case l._w.Proportional:return function(e,t,r,i){const n=null!=i?i.shape:void 0,s=e/t.minDataValue,o=v(t.minSize,r,i),a=v(t.maxSize,r,i);let l=null;return l="circle"===n?2*Math.sqrt(s*(o/2)**2):"square"===n||"diamond"===n||"image"===n?Math.sqrt(s*o**2):s*o,b(l,o,a)}(e,t,r,i);case l._w.Stops:return function(e,t,r,i,n){const[s,o,a]=T(e,n);if(s===o)return v(t.stops?.[s].size,r,i);{const e=v(t.stops?.[s].size,r,i);return e+(v(t.stops?.[o].size,r,i)-e)*a}}(e,t,r,i,n);case l._w.RealWorldSize:return function(e,t,r,i){const n=(i?.resolution??1)*a.j[t.valueUnit],s=v(t.minSize,r,i),o=v(t.maxSize,r,i),{valueRepresentation:l}=t;let c=null;return c="area"===l?2*Math.sqrt(e/p)/n:"radius"===l||"distance"===l?2*e/n:e/n,b(c,s,o)}(e,t,r,i);case l._w.Identity:return e;case l._w.Unknown:return null}}function S(e,t,r){const{isScaleDriven:i}=e.cache;if(!(i&&"3d"===r||t))return null;const n={scale:t,view:r};let s=v(e.minSize,d,n),o=v(e.maxSize,d,n);if(null!=s||null!=o){if(s>o){const e=o;o=s,s=e}return{minSize:s,maxSize:o}}}function w(e,t,r){if(!e.visualVariables)return;const i=[],n=[],s=[],o=[],a=[];for(const t of e.visualVariables)switch(t.type){case"color":n.push(t);break;case"opacity":s.push(t);break;case"rotation":a.push(t);break;case"size":o.push(t)}return n.forEach((e=>{const n=m(e,t,r);i.push({variable:e,value:n})})),s.forEach((e=>{const n=g(e,t,r);i.push({variable:e,value:n})})),a.forEach((e=>{const n=y(e,t,r);i.push({variable:e,value:n})})),o.forEach((e=>{const n=_(e,t,r);i.push({variable:e,value:n})})),i.filter((e=>null!=e.value))}function T(e,t){if(!t)return;let r=0,i=t.length-1;return t.some(((t,n)=>e<t?(i=n,!0):(r=n,!1))),[r,i,(e-t[r])/(t[i]-t[r])]}function A(e,t,r){const i=["proportional","proportional","proportional"];for(const n of e){const e=n.useSymbolValue?"symbol-value":_(n,t,r);switch(n.axis){case"width":i[0]=e;break;case"depth":i[1]=e;break;case"height":i[2]=e;break;case"width-and-depth":i[0]=e,i[1]=e;break;case"all":case void 0:case null:i[0]=e,i[1]=e,i[2]=e;break;default:(0,s.Xb)(n.axis)}}return i}},50493:function(e,t,r){r.d(t,{C:function(){return u}});var i=r(93040),n=r(67888),s=r(74697),o=r(39397),a=r(26765),l=r(6805);const c=(0,n.dp)(l.A);async function u(e,t,r){t=c(t);const n=(0,o.Dl)(e),l={...n.query,f:"json",...t.toJSON()},u=t.outSpatialReference,h=(0,s.$B)(t.geometries[0]),d=(0,o.jV)(l,r);return(0,i.A)(n.path+"/project",d).then((({data:{geometries:e}})=>(0,a.V)(e,h,u)))}},26765:function(e,t,r){r.d(t,{V:function(){return s},X:function(){return n}});var i=r(74697);function n(e){return{geometryType:(0,i.$B)(e[0]),geometries:e.map((e=>e.toJSON()))}}function s(e,t,r){const n=(0,i.xD)(t);return e.map((e=>{const t=n.fromJSON(e);return t.spatialReference=r,t}))}},30698:function(e,t,r){r.d(t,{A:function(){return p}});var i,n=r(53804),s=r(52874),o=r(21609),a=r(23502),l=r(67888),c=r(74376),u=r(65953),h=r(9035);let d=i=class extends h.A{constructor(e){super(e),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new i({fromColor:(0,o.o8)(this.fromColor),toColor:(0,o.o8)(this.toColor),algorithm:this.algorithm})}};(0,n._)([(0,c.e)({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],d.prototype,"algorithm",void 0),(0,n._)([(0,a.MZ)({type:s.A,json:{type:[l.jz],write:!0}})],d.prototype,"fromColor",void 0),(0,n._)([(0,a.MZ)({type:s.A,json:{type:[l.jz],write:!0}})],d.prototype,"toColor",void 0),(0,n._)([(0,a.MZ)({type:["algorithmic"]})],d.prototype,"type",void 0),d=i=(0,n._)([(0,u.$)("esri.rest.support.AlgorithmicColorRamp")],d);const p=d},9035:function(e,t,r){r.d(t,{A:function(){return l}});var i=r(53804),n=r(30905),s=r(23502),o=(r(58941),r(40633),r(13798),r(65953));let a=class extends n.oY{constructor(e){super(e),this.type=null}};(0,i._)([(0,s.MZ)({readOnly:!0,json:{read:!1,write:!0}})],a.prototype,"type",void 0),a=(0,i._)([(0,o.$)("esri.rest.support.ColorRamp")],a);const l=a},96245:function(e,t,r){r.d(t,{A:function(){return h}});var i,n=r(53804),s=r(21609),o=r(23502),a=(r(58941),r(40633),r(65953)),l=r(30698),c=r(9035);let u=i=class extends c.A{constructor(e){super(e),this.colorRamps=null,this.type="multipart"}clone(){return new i({colorRamps:(0,s.o8)(this.colorRamps)})}};(0,n._)([(0,o.MZ)({type:[l.A],json:{write:!0}})],u.prototype,"colorRamps",void 0),(0,n._)([(0,o.MZ)({type:["multipart"]})],u.prototype,"type",void 0),u=i=(0,n._)([(0,a.$)("esri.rest.support.MultipartColorRamp")],u);const h=u},6805:function(e,t,r){r.d(t,{A:function(){return u}});var i=r(53804),n=r(30905),s=r(23502),o=(r(58941),r(40633),r(13798),r(65953)),a=r(74697),l=r(57652);let c=class extends n.oY{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map((e=>e.toJSON())),t=this.geometries[0],r={};return r.outSR=(0,l.YX)(this.outSpatialReference),r.inSR=(0,l.YX)(t.spatialReference),r.geometries=JSON.stringify({geometryType:(0,a.$B)(t),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),null!=this.transformForward&&(r.transformForward=this.transformForward),r}};(0,i._)([(0,s.MZ)()],c.prototype,"geometries",void 0),(0,i._)([(0,s.MZ)({json:{read:{source:"outSR"}}})],c.prototype,"outSpatialReference",void 0),(0,i._)([(0,s.MZ)()],c.prototype,"transformation",void 0),(0,i._)([(0,s.MZ)()],c.prototype,"transformForward",void 0),c=(0,i._)([(0,o.$)("esri.rest.support.ProjectParameters")],c);const u=c},85982:function(e,t,r){r.d(t,{g:function(){return o},r:function(){return a}});var i=r(30698),n=r(9035),s=r(96245);const o={key:"type",base:n.A,typeMap:{algorithmic:i.A,multipart:s.A}};function a(e){return e?.type?"algorithmic"===e.type?i.A.fromJSON(e):"multipart"===e.type?s.A.fromJSON(e):null:null}},39397:function(e,t,r){r.d(t,{Dl:function(){return o},jV:function(){return s},lF:function(){return a}}),r(25591),r(7156);var i=r(21609),n=r(90683);function s(e,t){return t?{...t,query:{...e??{},...t.query}}:{query:e}}function o(e){return"string"==typeof e?(0,n.An)(e):(0,i.o8)(e)}function a(e,t,r){const i={};for(const n in e){if("declaredClass"===n)continue;const s=e[n];if(null!=s&&"function"!=typeof s)if(Array.isArray(s))i[n]=s.map((e=>a(e)));else if("object"==typeof s)if(s.toJSON){const e=s.toJSON(r?.[n]);i[n]=t?e:JSON.stringify(e)}else i[n]=t?s:JSON.stringify(s);else i[n]=s}return i}r(48893)},11876:function(e,t,r){r.d(t,{H:function(){return o},q:function(){return s}});var i=r(53216),n=r(38225);async function s(e){if(!e)return;const t=e.includes("-vector")?e.slice(0,e.indexOf("-vector")):e.includes("-3d")?e.slice(0,e.indexOf("-3d")):e,r=await(0,n.ud)("esri/t9n/basemaps");return r[e]||r[t]}const o={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"arcgis-imagery":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}}},51107:function(e,t,r){r.d(t,{VC:function(){return u},dp:function(){return d},jj:function(){return h},ns:function(){return p}});var i=r(74756),n=r(25591),s=(r(78879),r(40633)),o=r(95929),a=(r(90683),r(67888)),l=(r(25128),r(11876));const c=()=>s.A.getLogger("esri.support.basemapUtils");function u(){return{}}function h(e){for(const t in e){const r=e[t];(0,o.pR)(r),delete e[t]}}function d(e,t){let r;if("string"==typeof e){const s=e in l.H,o=!s&&e.includes("/");if(!s&&!o){const t=Object.entries(l.H).filter((([e,t])=>n.default.apiKey&&!t.classic||!n.default.apiKey&&(t.classic||t.is3d))).map((([e])=>`"${e}"`)).sort().join(", ");return c().warn(`Unable to find basemap definition for: ${e}. Try one of these: ${t}`),null}t&&(r=t[e]),r||(r=s?i.default.fromId(e):new i.default({style:{id:e}}),t&&(t[e]=r))}else r=(0,a.dp)(i.default,e);return r?.destroyed&&(c().warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function p(e,t){return e.basemap?.referenceLayers?.some((e=>e.uid===t))||e.basemap?.baseLayers?.some((e=>e.uid===t))}},96736:function(e,t,r){r.d(t,{Vd:function(){return n},Vo:function(){return s}});var i=r(58941);const n=()=>!!(0,i.A)("enable-feature:force-wosr"),s=()=>!!(0,i.A)("enable-feature:SceneLayer-editing");((e="i3s-patching")=>{switch(i.A.add("enable-i3s-patching",!1,!0,!0),i.A.add("enable-feature:direct-3d-object-feature-layer-display",!1,!0,!0),i.A.add("enable-feature:SceneLayer-editing",!0,!0,!0),e){case"feature-layer-view":i.A.add("enable-feature:direct-3d-object-feature-layer-display",!0,!0,!0);break;case"i3s-patching":i.A.add("enable-i3s-patching",!0,!0,!0)}})("i3s-patching")},9030:function(e,t,r){r.d(t,{D:function(){return n}});var i=r(93040);async function n(e,t){const{data:r}=await(0,i.A)(e,{responseType:"image",...t});return r}},23454:function(e,t,r){r.d(t,{Aq:function(){return s},pC:function(){return o},rx:function(){return a}});var i=r(62096),n=r(29076);function s(e,t){e[4]=t}class o{constructor(e,t=!0,r=!0,i=0){this.isClosed=!1,this.geometryCursor=null,this.geometryCursor=!t&&"esriGeometryPolygon"===e.geometryType||!r&&"esriGeometryPolyline"===e.geometryType?null:e,this.geomUnitsPerPoint=i,this.iterateMultiPath=!1,this.iteratePath=!1,this.internalPlacement=new n.W}next(){if(!this.geometryCursor)return null;const e=this.processMultiPath(this.geometryCursor);return this.iterateMultiPath&&e||(this.geometryCursor=null),e}processMultiPath(e){for(;this.iteratePath||e.pathIndex<e.totalSize-1;){this.iteratePath||e.nextPath(),this.iterateMultiPath=!0;const t=this.processPath(e);if(t)return t}return this.iterateMultiPath=!1,null}}class a{constructor(e,t,r,i=0){this.isClosed=!1,this._tileKey=null,this.inputGeometries=e,this.acceptPolygon=t,this.acceptPolyline=r,this.geomUnitsPerPoint=i,this.iteratePath=!1,this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){let e=this.inputGeometries.next();for(;e&&(this.isClosed=this.acceptPolygon&&"esriGeometryPolygon"===e.geometryType||"esriGeometryEnvelope"===e.geometryType,this.multiPathCursor=e,!this.multiPathCursor);)e=this.inputGeometries.next();if(!this.multiPathCursor)return null;this._tileKey&&this.isClippingRequired(this.multiPathCursor)&&(this.multiPathCursor.reset(),this.multiPathCursor=(0,i.q)(this.multiPathCursor,256))}for(;this.iteratePath||this.multiPathCursor.nextPath();){this.multiPathCursor.seekPathStart();const e=this.processPath(this.multiPathCursor);if(e)return e}this.multiPathCursor=null}}isClippingRequired(e){return!1}}},62096:function(e,t,r){r.d(t,{k:function(){return a},q:function(){return l}});var i=r(33134),n=r(72139);const s=512;let o;class a{constructor(e){this._geometry=e}next(){const e=this._geometry;return this._geometry=null,e}}function l(e,t){o||(o=new n.O3(0,0,0,1));const r="esriGeometryPolygon"===e.geometryType,a=r?n.dC.Polygon:n.dC.LineString,l=r?3:2;let c,u;for(o.reset(a),o.setPixelMargin(t+1),o.setExtent(s);e.nextPath();)if(!(e.pathSize<l)){for(e.nextPoint(),c=e.x,u=-e.y,o.moveTo(c,u);e.nextPoint();)c=e.x,u=-e.y,o.lineTo(c,u);r&&o.close()}const h=o.result(!1);if(h){const t=i.z.createEmptyOptimizedCIM(e.geometryType);for(const e of h){t.startPath();for(const r of e)t.pushXY(r.x,-r.y)}return t.reset(),t}return null}},9635:function(e,t,r){r.d(t,{A:function(){return T},c:function(){return A}});var i=r(63514),n=r(82112),s=r(20391),o=r(11672),a=r(12281),l=r(2969),c=r(7889),u=r(48645),h=r(7088),d=r(17706),p=r(10183),f=r(1646),m=r(79323),g=r(34476),y=r(31771),_=r(15987),v=r(19511),b=r(20305),x=r(58892),S=r(80585),w=r(58676);function T(e){if(!e)return null;switch(e.type){case"CIMGeometricEffectAddControlPoints":return i.N.local();case"CIMGeometricEffectArrow":return n.B.local();case"CIMGeometricEffectBuffer":return s.s.local();case"CIMGeometricEffectControlMeasureLine":return o.v.local();case"CIMGeometricEffectCut":return a.y.local();case"CIMGeometricEffectDashes":return l.I.local();case"CIMGeometricEffectDonut":return c.O.local();case"CIMGeometricEffectJog":return u.U.local();case"CIMGeometricEffectMove":return h.V.local();case"CIMGeometricEffectOffset":return d.V.local();case"CIMGeometricEffectReverse":return p.C.local();case"CIMGeometricEffectRotate":return f.v.local();case"CIMGeometricEffectScale":return m.W.local();case"CIMGeometricEffectWave":return g.l.local()}return null}function A(e){if(!e)return null;switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":return y.e.local();case"CIMMarkerPlacementAtExtremities":return _.y.local();case"CIMMarkerPlacementAtRatioPositions":return v.S.local();case"CIMMarkerPlacementInsidePolygon":return b.M.local();case"CIMMarkerPlacementOnLine":return x.R.local();case"CIMMarkerPlacementOnVertices":return S.A.local();case"CIMMarkerPlacementPolygonCenter":return w.L.local()}return null}},29076:function(e,t,r){r.d(t,{W:function(){return i}});class i{constructor(){this.setIdentity()}getAngle(){return(null==this.rz||0===this.rz&&1!==this.rzCos&&0!==this.rzSin)&&(this.rz=Math.atan2(this.rzSin,this.rzCos)),this.rz}setIdentity(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rzCos=1,this.rzSin=0}setTranslate(e,t){this.tx=e,this.ty=t}setTranslateZ(e){this.tz=e}setRotateCS(e,t){this.rz=void 0,this.rzCos=e,this.rzSin=t}setRotate(e){this.rz=e,this.rzCos=void 0,this.rzSin=void 0}setRotateY(e){this.ry=e}setScale(e){this.s=e}setMeasure(e){this.m=e}}},14817:function(e,t,r){r.d(t,{Rj:function(){return D},mx:function(){return L},CK:function(){return N},IT:function(){return O},QF:function(){return U}});var i=r(80683),n=r(58941),s=r(21609),o=r(40633),a=r(56996),l=r(13520),c=r(33134),u=r(87416),h=r(35068),d=r(72228),p=r(74697),f=r(62096);class m{applyColorSubstituition(e,t){if(!t)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:r,height:i}=e,n=this._rasterizationCanvas,s=n.getContext("2d",{willReadFrequently:!0});e!==n&&(n.width=r,n.height=i,s.drawImage(e,0,0,r,i));const o=s.getImageData(0,0,r,i).data;if(t)for(const e of t)if(e&&e.oldColor&&4===e.oldColor.length&&e.newColor&&4===e.newColor.length){const[t,r,i,n]=e.oldColor,[s,a,l,c]=e.newColor;if(t===s&&r===a&&i===l&&n===c)continue;for(let e=0;e<o.length;e+=4)t===o[e]&&r===o[e+1]&&i===o[e+2]&&n===o[e+3]&&(o[e]=s,o[e+1]=a,o[e+2]=l,o[e+3]=c)}const a=new ImageData(o,r,i);return s.putImageData(a,0,0),n}tintImageData(e,t){if(!t||t.length<4)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:r,height:i}=e,n=this._rasterizationCanvas,s=n.getContext("2d",{willReadFrequently:!0});e!==n&&(n.width=r,n.height=i,s.drawImage(e,0,0,r,i));const o=s.getImageData(0,0,r,i),a=new Uint8Array(o.data),l=[t[0]/255,t[1]/255,t[2]/255,t[3]/255];for(let e=0;e<a.length;e+=4)a[e]*=l[0],a[e+1]*=l[1],a[e+2]*=l[2],a[e+3]*=l[3];const c=new ImageData(new Uint8ClampedArray(a.buffer),r,i);return s.putImageData(c,0,0),n}}var g=r(9635),y=r(29076),_=r(38821),v=r(33389);function b(e){const t=e.getFrame(0);if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)return t;const r=document.createElement("canvas");r.width=e.width,r.height=e.height;const i=r.getContext("2d");return t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0),r}var x=r(82497),S=r(64303);function w(e){return`rgba(${e.slice(0,3).toString()},${e[3]})`}class T{constructor(e){e&&(this._textRasterizationCanvas=e)}rasterizeText(e,t){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const r=this._textRasterizationCanvas,i=r.getContext("2d",{willReadFrequently:!0});A(i,t),this._parameters=t,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const{decoration:n,weight:s}=t.font;this._lineThroughWidthOffset=n&&"line-through"===n?.1*this._lineHeight:0;const o=null!=t.backgroundColor||null!=t.borderLine,a=o?S.y7:0,c=this._computeTextWidth(i,t)+2*a,u=this._lineHeight*this._textLines.length+2*a;if(r.width=c+2*this._lineThroughWidthOffset,r.height=u,0===r.width||0===r.height)return r.width=r.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:r};this._renderedLineHeight=Math.round(this._lineHeight*t.pixelRatio),this._renderedHaloSize=(0,l.Lz)(t.halo.size)*t.pixelRatio,this._renderedWidth=c*t.pixelRatio,this._renderedHeight=u*t.pixelRatio,this._lineThroughWidthOffset*=t.pixelRatio;const h=t.color??[0,0,0,0],d=t.halo&&t.halo.color?t.halo.color:[0,0,0,0];this._fillStyle=w(h),this._haloStyle=`rgb(${d.slice(0,3).toString()})`;const p=this._renderedLineHeight,f=this._renderedHaloSize;i.save(),i.clearRect(0,0,r.width,r.height),A(i,t);const m=a*t.pixelRatio,g=function(e,t){return"center"===e?.5*t:"right"===e?t:0}(i.textAlign,this._renderedWidth-2*m)+f+m,y=f+m,_=f>0;let v=this._lineThroughWidthOffset,b=0;if(o){i.save();const e=t.backgroundColor??[0,0,0,0],n=t.borderLine?.color??[0,0,0,0],s=2*(0,l.Lz)(t.borderLine?.size??0);i.fillStyle=w(e),i.strokeStyle=w(n),i.lineWidth=s,i.fillRect(0,0,r.width,r.height),i.strokeRect(0,0,r.width,r.height),i.restore()}_&&this._renderHalo(i,g,y,v,b,t),b+=y,v+=g;for(const e of this._textLines)_?(i.globalCompositeOperation="destination-out",i.fillStyle="rgb(0, 0, 0)",i.fillText(e,v,b),i.globalCompositeOperation="source-over",i.fillStyle=this._fillStyle,i.fillText(e,v,b)):(i.fillStyle=this._fillStyle,i.fillText(e,v,b)),n&&"none"!==n&&this._renderDecoration(i,v,b,n,s),b+=p;i.restore();const x=this._renderedWidth+2*this._lineThroughWidthOffset,T=this._renderedHeight,C=i.getImageData(0,0,x,T),E=new Uint8Array(C.data);if(t.premultiplyColors){let e;for(let t=0;t<E.length;t+=4)e=E[t+3]/255,E[t]=E[t]*e,E[t+1]=E[t+1]*e,E[t+2]=E[t+2]*e}let M,R;switch(t.horizontalAlignment){case"left":M=-.5;break;case"right":M=.5;break;default:M=0}switch(t.verticalAlignment){case"bottom":R=-.5;break;case"top":R=.5;break;case"baseline":R=-1/6;break;default:R=0}return{size:[x,T],image:new Uint32Array(E.buffer),sdf:!1,simplePattern:!1,anchorX:M,anchorY:R,canvas:r}}_renderHalo(e,t,r,i,n,s){const o=this._renderedWidth,a=this._renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas")),this._haloRasterizationCanvas.width=o,this._haloRasterizationCanvas.height=a;const l=this._haloRasterizationCanvas,c=l.getContext("2d");c.clearRect(0,0,o,a),A(c,s);const{decoration:u,weight:h}=s.font;c.fillStyle=this._haloStyle,c.strokeStyle=this._haloStyle,c.lineJoin="round",this._renderHaloNative(c,t,r,u,h),e.globalAlpha=this._parameters.halo.color[3],e.drawImage(l,0,0,o,a,i,n,o,a),e.globalAlpha=1}_renderHaloNative(e,t,r,i,n){const s=this._renderedLineHeight,o=this._renderedHaloSize;for(const a of this._textLines){const l=2*o,c=5,u=.1;for(let s=0;s<c;s++){const o=(1-(c-1)*u+s*u)*l;e.lineWidth=o,e.strokeText(a,t,r),i&&"none"!==i&&this._renderDecoration(e,t,r,i,n,o)}r+=s}}computeTextSize(e,t){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const r=this._textRasterizationCanvas,i=r.getContext("2d");A(i,t),this._parameters=t,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const n=this._computeTextWidth(i,t),s=this._lineHeight*this._textLines.length;return r.width=n,r.height=s,[n*t.pixelRatio,s*t.pixelRatio]}_computeTextWidth(e,t){let r=0;for(const t of this._textLines)r=Math.max(r,e.measureText(t).width);const i=t.font;return("italic"===i.style||"oblique"===i.style||"string"==typeof i.weight&&("bold"===i.weight||"bolder"===i.weight)||"number"==typeof i.weight&&i.weight>600)&&(r+=.3*e.measureText("w").width),r+=2*(0,l.Lz)(this._parameters.halo.size),Math.round(r)}_computeLineHeight(){let e=1.275*this._parameters.size;const t=this._parameters.font.decoration;return t&&"underline"===t&&(e*=1.3),Math.round(e+2*(0,l.Lz)(this._parameters.halo.size))}_renderDecoration(e,t,r,i,n,s){const o=.9*this._lineHeight,a="bold"===n?.06:"bolder"===n?.09:.04;switch(e.textAlign){case"center":t-=this._renderedWidth/2;break;case"right":t-=this._renderedWidth}const l=e.textBaseline;if("underline"===i)switch(l){case"top":r+=o;break;case"middle":r+=o/2}else if("line-through"===i)switch(l){case"top":r+=o/1.5;break;case"middle":r+=o/3}const c=s?1.5*s:Math.ceil(o*a);e.save(),e.beginPath(),e.strokeStyle=e.fillStyle,e.lineWidth=c,e.moveTo(t-this._lineThroughWidthOffset,r),e.lineTo(t+this._renderedWidth+2*this._lineThroughWidthOffset,r),e.stroke(),e.restore()}}function A(e,t){const r=Math.max(t.size,.5),i=t.font,n=`${i.style} ${i.weight} ${(0,l.Lz)(r*t.pixelRatio).toFixed(1)}px ${i.family}, sans-serif`;let s;switch(e.font=n,e.textBaseline="top",t.horizontalAlignment){case"left":default:s="left";break;case"right":s="right";break;case"center":s="center"}e.textAlign=s}var C=r(7590),E=r(39686),M=r(17469),R=r(96700);const P=Math.PI/180;class O{constructor(e){this._t=e}static createIdentity(){return new O([1,0,0,0,1,0])}clone(){const e=this._t;return new O(e.slice())}transform(e){const t=this._t;return[t[0]*e[0]+t[1]*e[1]+t[2],t[3]*e[0]+t[4]*e[1]+t[5]]}static createScale(e,t){return new O([e,0,0,0,t,0])}scale(e,t){const r=this._t;return r[0]*=e,r[1]*=e,r[2]*=e,r[3]*=t,r[4]*=t,r[5]*=t,this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(e,t){return new O([0,0,e,0,0,t])}translate(e,t){const r=this._t;return r[2]+=e,r[5]+=t,this}static createRotate(e){const t=Math.cos(e),r=Math.sin(e);return new O([t,-r,0,r,t,0])}rotate(e){return O.multiply(this,O.createRotate(e),this)}angle(){const e=this._t[0],t=this._t[3],r=Math.sqrt(e*e+t*t);return[e/r,t/r]}static multiply(e,t,r){const i=e._t,n=t._t,s=i[0]*n[0]+i[3]*n[1],o=i[1]*n[0]+i[4]*n[1],a=i[2]*n[0]+i[5]*n[1]+n[2],l=i[0]*n[3]+i[3]*n[4],c=i[1]*n[3]+i[4]*n[4],u=i[2]*n[3]+i[5]*n[4]+n[5],h=r._t;return h[0]=s,h[1]=o,h[2]=a,h[3]=l,h[4]=c,h[5]=u,r}invert(){const e=this._t;let t=e[0]*e[4]-e[1]*e[3];if(0===t)return new O([0,0,0,0,0,0]);t=1/t;const r=(e[1]*e[5]-e[2]*e[4])*t,i=(e[2]*e[3]-e[0]*e[5])*t,n=e[4]*t,s=-e[1]*t,o=-e[3]*t,a=e[0]*t;return new O([n,s,r,o,a,i])}}class I{constructor(e,t){this._resourceManager=e,this._transfos=[],this._sizeTransfos=[],this._geomUnitsPerPoint=1,this._placementPool=new a.A(y.W,void 0,void 0,100),this._earlyReturn=!1,this._mapRotation=0,this._transfos.push(t||O.createIdentity()),this._sizeTransfos.push(t?t.scaleRatio():1)}setTransform(e,t){this._transfos=[e||O.createIdentity()],this._sizeTransfos=[t||(e?e.scaleRatio():1)]}setGeomUnitsPerPoint(e){this._geomUnitsPerPoint=e}transformPt(e){return this._transfos[this._transfos.length-1].transform(e)}transformSize(e){return e*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(e){return this._transfos[this._transfos.length-1].invert().transform(e)}reverseTransformSize(e){return e/this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformScalar(e){return e/this._transfos[this._transfos.length-1].scaleRatio()}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}prevGeomUnitsPerPoint(){return this._transfos.length>2?1:this._geomUnitsPerPoint}isEmbedded(){return this._transfos.length>1}back(){return this._transfos[this._transfos.length-1]}push(e,t){const r=t?e.scaleRatio():1;O.multiply(e,this.back(),e),this._transfos.push(e),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*r)}pop(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)}drawSymbol(e,t,r){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this.drawMultiLayerSymbol(e,t);break;case"CIMTextSymbol":this.drawTextSymbol(e,t,r)}}drawMultiLayerSymbol(e,t){if(!e||!t)return;const r=e.symbolLayers;if(!r)return;const i=e.effects;if(i&&i.length>0){const e=this.executeEffects(i,t);if(e){let t=e.next();for(;t;)this.drawSymbolLayers(r,t.asJSON()),t=e.next()}}else this.drawSymbolLayers(r,t)}executeEffects(e,t){const r=this._resourceManager.geometryEngine;let i=new f.k(c.z.fromJSONCIM(t));for(const t of e){const e=(0,g.A)(t);e&&(i=e.execute(i,t,this.geomUnitsPerPoint(),null,r))}return i}drawSymbolLayers(e,t){let r=e.length;for(;r--;){const i=e[r];if(!i||!1===i.enable)continue;const n=i.effects;if(n&&n.length>0){const e=this.executeEffects(n,t);if(e){let t=null;for(;(t=e.next())&&(this.drawSymbolLayer(i,t.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(i,t);if(this._earlyReturn)return}}drawSymbolLayer(e,t){switch(e.type){case"CIMSolidFill":this.drawSolidFill(t,e.color);break;case"CIMHatchFill":this.drawHatchFill(t,e);break;case"CIMPictureFill":this.drawPictureFill(t,e);break;case"CIMGradientFill":this.drawGradientFill(t,e);break;case"CIMSolidStroke":this.drawSolidStroke(t,e.color,e.width,e.capStyle,e.joinStyle,e.miterLimit);break;case"CIMPictureStroke":this.drawPictureStroke(t,e);break;case"CIMGradientStroke":this.drawGradientStroke(t,e);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":this.drawMarkerLayer(e,t)}}drawHatchFill(e,t){const r=function(e,t,r){let i=(0,C.$w)(e.separation,_.D.CIMHatchFill.separation)*r,n=(0,C.$w)(e.rotation);if(0===i)return null;i<0&&(i=-i);let s=0;const o=.5*i;for(;s>o;)s-=i;for(;s<-o;)s+=i;const a=(0,u.vt)();(0,h.Rg)(a,t),a[0]-=o,a[1]-=o,a[2]+=o,a[3]+=o;const l=[[a[0],a[1]],[a[0],a[3]],[a[2],a[3]],[a[2],a[1]]];for(;n>180;)n-=180;for(;n<0;)n+=180;const c=Math.cos(n*P),d=Math.sin(n*P),p=-i*d,f=i*c;let m,g,y,v;s=(0,C.$w)(e.offsetX)*r*d-(0,C.$w)(e.offsetY)*r*c,m=y=Number.MAX_VALUE,g=v=-Number.MAX_VALUE;for(const e of l){const t=e[0],r=e[1],i=c*t+d*r,n=-d*t+c*r;m=Math.min(m,i),y=Math.min(y,n),g=Math.max(g,i),v=Math.max(v,n)}y=Math.floor(y/i)*i;let b=c*m-d*y-p*s/i,x=d*m+c*y-f*s/i,S=c*g-d*y-p*s/i,w=d*g+c*y-f*s/i;const T=1+Math.round((v-y)/i),A=[];for(let e=0;e<T;e++)b+=p,x+=f,S+=p,w+=f,A.push([[b,x],[S,w]]);return{paths:A}}(t,e,this.geomUnitsPerPoint());r&&(this.pushClipPath(e),this.drawMultiLayerSymbol(t.lineSymbol,r),this.popClipPath())}drawPictureFill(e,t){}drawGradientFill(e,t){}drawPictureStroke(e,t){}drawGradientStroke(e,t){}drawMarkerLayer(e,t){const r=e.markerPlacement;if(r){const i=(0,g.c)(r);if(i){const n="CIMMarkerPlacementInsidePolygon"===r.type||"CIMMarkerPlacementPolygonCenter"===r.type&&r.clipAtBoundary;n&&this.pushClipPath(t);const s=i.execute(c.z.fromJSONCIM(t),r,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine);if(s){let t=null;for(;(t=s.next())&&(this.drawMarker(e,t),!this._earlyReturn););}n&&this.popClipPath()}}else{const r=this._placementPool.acquire();if((0,p.fT)(t))r.tx=t.x,r.ty=t.y,this.drawMarker(e,r);else if((0,p.Bi)(t)){const i=(0,d.l8)(t);i&&([r.tx,r.ty]=i,this.drawMarker(e,r))}else for(const i of t.points)if(r.tx=i[0],r.ty=i[1],this.drawMarker(e,r),this._earlyReturn)break;this._placementPool.release(r)}}drawMarker(e,t){switch(e.type){case"CIMCharacterMarker":case"CIMPictureMarker":this.drawPictureMarker(e,t);break;case"CIMVectorMarker":this.drawVectorMarker(e,t)}}drawPictureMarker(e,t){if(!e)return;const r=this._resourceManager.getResource(e.url),i=(0,C.$w)(e.size,_.D.CIMPictureMarker.size);if(null==r||i<=0)return;const n=r.width,s=r.height;if(!n||!s)return;const o=n/s,a=(0,C.$w)(e.scaleX,1),l=O.createIdentity(),c=e.anchorPoint;if(c){let t=c.x,r=c.y;"Absolute"!==e.anchorPointUnits&&(t*=i*o*a,r*=i),l.translate(-t,-r)}let u=(0,C.$w)(e.rotation);e.rotateClockwise&&(u=-u),this._mapRotation&&(u+=this._mapRotation),u&&l.rotate(u*P);let h=(0,C.$w)(e.offsetX),d=(0,C.$w)(e.offsetY);if(h||d){if(this._mapRotation){const e=P*this._mapRotation,t=Math.cos(e),r=Math.sin(e),i=h*r+d*t;h=h*t-d*r,d=i}l.translate(h,d)}const p=this.geomUnitsPerPoint();1!==p&&l.scale(p,p);const f=t.getAngle();f&&l.rotate(f),l.translate(t.tx,t.ty),this.push(l,!1),this.drawImage(e,i),this.pop()}drawVectorMarker(e,t){if(!e)return;const r=e.markerGraphics;if(!r)return;const i=(0,C.$w)(e.size,_.D.CIMVectorMarker.size),n=e.frame,s=n?n.ymax-n.ymin:0,a=i&&s?i/s:1,l=O.createIdentity();n&&l.translate(.5*-(n.xmax+n.xmin),.5*-(n.ymax+n.ymin));const c=e.anchorPoint;if(c){let t=c.x,r=c.y;"Absolute"!==e.anchorPointUnits?n&&(t*=n.xmax-n.xmin,r*=n.ymax-n.ymin):(t/=a,r/=a),l.translate(-t,-r)}1!==a&&l.scale(a,a);let u=(0,C.$w)(e.rotation);e.rotateClockwise&&(u=-u),this._mapRotation&&(u+=this._mapRotation),u&&l.rotate(u*P);let h=(0,C.$w)(e.offsetX),d=(0,C.$w)(e.offsetY);if(h||d){if(this._mapRotation){const e=P*this._mapRotation,t=Math.cos(e),r=Math.sin(e),i=h*r+d*t;h=h*t-d*r,d=i}l.translate(h,d)}const p=this.geomUnitsPerPoint();1!==p&&l.scale(p,p);const f=t.getAngle();f&&l.rotate(f),l.translate(t.tx,t.ty),this.push(l,e.scaleSymbolsProportionally);for(const e of r){e?.symbol&&e.geometry||o.A.getLogger("esri.symbols.cim.CIMSymbolDrawHelper").error("Invalid marker graphic",e);let t=e.textString;if("number"==typeof t&&(t=t.toString()),this.drawSymbol(e.symbol,e.geometry,t),this._earlyReturn)break}this.pop()}drawTextSymbol(e,t,r){if(!e)return;if(!(0,p.fT)(t))return;if((0,C.$w)(e.height,_.D.CIMTextSymbol.height)<=0)return;const i=O.createIdentity();let n=(0,C.$w)(e.angle);n=-n,n&&i.rotate(n*P);const s=(0,C.$w)(e.offsetX),o=(0,C.$w)(e.offsetY);(s||o)&&i.translate(s,o);const a=this.geomUnitsPerPoint();1!==a&&i.scale(a,a),i.translate(t.x,t.y),this.push(i,!1),this.drawText(e,r),this.pop()}}class L extends I{constructor(e,t){super(e,t),this.reset()}reset(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0}envelope(){return new x.A(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return(0,u.fA)(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(e){if(e&&!(this._clipCount>0))if((0,p.Bi)(e))this._processPath(e.rings,0);else if((0,p.Rg)(e))this._processPath(e.paths,0);else if((0,p.ZC)(e)){const t=V(e);t&&this._processPath(t.rings,0)}else console.error("drawSolidFill Unexpected geometry type!")}drawSolidStroke(e,t,r){if(!e||this._clipCount>0||null==r||r<=0)return;const i=Math.max(.5*this.transformSize((0,C.$w)(r,_.D.CIMSolidStroke.width)),.25);if((0,p.Bi)(e))this._processPath(e.rings,i);else if((0,p.Rg)(e))this._processPath(e.paths,i);else if((0,p.ZC)(e)){const t=V(e);t&&this._processPath(t.rings,i)}else console.error("drawSolidStroke unexpected geometry type!")}drawMarkerLayer(e,t){(0,p.Bi)(t)&&e.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===e.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===e.markerPlacement.type&&e.markerPlacement.clipAtBoundary)?this._processPath(t.rings,0):super.drawMarkerLayer(e,t)}drawHatchFill(e,t){this.drawSolidFill(e)}drawPictureFill(e,t){this.drawSolidFill(e)}drawGradientFill(e,t){this.drawSolidFill(e)}drawPictureStroke(e,t){this.drawSolidStroke(e,null,t.width)}drawGradientStroke(e,t){this.drawSolidStroke(e,null,t.width)}pushClipPath(e){this.drawSolidFill(e),this._clipCount++}popClipPath(){this._clipCount--}drawImage(e,t){const{url:r}=e,i=(0,C.$w)(e.scaleX,1);let n=i*t,s=t;const o=this._resourceManager.getResource(r);if(null!=o){const e=o.height/o.width;n=i*(t?e>1?t:t/e:o.width),s=t?e>1?t*e:t:o.height}this._merge(this.transformPt([-n/2,-s/2]),0),this._merge(this.transformPt([-n/2,s/2]),0),this._merge(this.transformPt([n/2,-s/2]),0),this._merge(this.transformPt([n/2,s/2]),0)}drawText(e,t){if(!t||0===t.length)return;this._textRasterizer||(this._textRasterizer=new T);const r=G(e);let[i,n]=this._textRasterizer.computeTextSize(t,r);i=(0,l.PN)(i),n=(0,l.PN)(n);let s=0;switch(e.horizontalAlignment){case"Left":s=i/2;break;case"Right":s=-i/2}let o=0;switch(e.verticalAlignment){case"Bottom":o=n/2;break;case"Top":o=-n/2;break;case"Baseline":o=n/6}this._merge(this.transformPt([-i/2+s,-n/2+o]),0),this._merge(this.transformPt([-i/2+s,n/2+o]),0),this._merge(this.transformPt([i/2+s,-n/2+o]),0),this._merge(this.transformPt([i/2+s,n/2+o]),0)}_processPath(e,t){if(e)for(const r of e){const e=r?r.length:0;if(e>1){this._merge(this.transformPt(r[0]),t);for(let i=1;i<e;i++)this._merge(this.transformPt(r[i]),t)}}}_merge(e,t){e[0]-t<this._xmin&&(this._xmin=e[0]-t),e[0]+t>this._xmax&&(this._xmax=e[0]+t),e[1]-t<this._ymin&&(this._ymin=e[1]-t),e[1]+t>this._ymax&&(this._ymax=e[1]+t)}}class N extends I{constructor(){super(...arguments),this._searchPoint=[0,0],this._searchDistPoint=0,this._textInfo=null}hitTest(e,t,r,i,s,o){const a=o*(0,l.Lz)(1);this.setTransform(),this.setGeomUnitsPerPoint(a),this._searchPoint=[(e[0]+e[2])/2,(e[1]+e[3])/2],this._searchDistPoint=(e[2]-e[0])/2/a,this._textInfo=i;const c=t&&("CIMPointSymbol"===t.type&&"Map"!==t.angleAlignment||"CIMTextSymbol"===t.type);if(this._mapRotation=c?s:0,!(0,n.A)("esri-mobile")){const e=(0,l.PN)(E._M*window.devicePixelRatio),r=(0,l.PN)(E.ie);("CIMLineSymbol"!==t?.type&&"CIMPolygonSymbol"!==t?.type||!t.symbolLayers?.some(C.jn))&&"CIMMeshSymbol"!==t?.type&&((0,C.YC)(t)??0)<r&&(this._searchDistPoint=e)}return this._earlyReturn=!1,this.drawSymbol(t,r),this._earlyReturn}drawSolidFill(e,t){this._hitTestFill(e)}drawHatchFill(e,t){this._hitTestFill(e)}drawPictureFill(e,t){this._hitTestFill(e)}drawGradientFill(e,t){this._hitTestFill(e)}drawSolidStroke(e,t,r,i,n,s){this._hitTestStroke(e,r)}drawPictureStroke(e,t){this._hitTestStroke(e,t.width)}drawGradientStroke(e,t){this._hitTestStroke(e,t.width)}drawMarkerLayer(e,t){e.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===e.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===e.markerPlacement.type&&e.markerPlacement.clipAtBoundary)?this._hitTestFill(t):super.drawMarkerLayer(e,t)}pushClipPath(e){}popClipPath(){}drawImage(e,t){const{url:r}=e,i=(0,C.$w)(e.scaleX,1),n=this._resourceManager.getResource(r);if(null==n||0===n.height||0===t)return;const s=t*this.geomUnitsPerPoint(),o=s*i*(n.width/n.height),a=this.reverseTransformPt(this._searchPoint),l=this._searchDistPoint;Math.abs(a[0])<o/2+l&&Math.abs(a[1])<s/2+l&&(this._earlyReturn=!0)}drawText(e,t){const r=this._textInfo;if(!r)return;const i=r.get(e);if(!i)return;if(!i.glyphMosaicItems.glyphs.length)return;const n=(0,R.hV)((0,C.$w)(e.height,_.D.CIMTextSymbol.height)),{lineGapType:s,lineGap:o}=e,a=s?U(s,(0,C.$w)(o),n):0,l="CIMBackgroundCallout"===e.callout?.type,c=(0,M.Tl)(i.glyphMosaicItems,{scale:n/E.eG,angle:0,xOffset:0,yOffset:0,horizontalAlignment:e.horizontalAlignment,verticalAlignment:e.verticalAlignment,maxLineWidth:(0,R.Lu)(e.lineWidth),lineHeight:E.DY*Math.max(.25,Math.min(a||1,4)),decoration:e.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:l}),u=this.reverseTransformPt(this._searchPoint),h=u[0],d=u[1];for(const e of c.glyphs)if(h>e.xTopLeft&&h<e.xBottomRight&&d>-e.yBottomRight&&d<-e.yTopLeft){this._earlyReturn=!0;break}}_hitTestFill(e){let t=null;if((0,p.ZC)(e)){const r=e;t=[[[r.xmin,r.ymin],[r.xmin,r.ymax],[r.xmax,r.ymax],[r.xmax,r.ymin],[r.xmin,r.ymin]]]}else if((0,p.Bi)(e))t=e.rings;else{if(!(0,p.Rg)(e))return;t=e.paths}const r=this.reverseTransformPt(this._searchPoint);(function(e,t){let r=0;for(const i of t){const t=i.length;for(let n=1;n<t;n++){const t=i[n-1],s=i[n];t[1]>e[1]!=s[1]>e[1]&&((s[0]-t[0])*(e[1]-t[1])-(s[1]-t[1])*(e[0]-t[0])>0?r++:r--)}}return 0!==r})(r,t)&&(this._earlyReturn=!0),this._earlyReturn||F(r,t,this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint())&&(this._earlyReturn=!0)}_hitTestStroke(e,t){let r=null;if((0,p.ZC)(e)){const t=e;r=[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}else if((0,p.Bi)(e))r=e.rings;else{if(!(0,p.Rg)(e))return;r=e.paths}F(this.reverseTransformPt(this._searchPoint),r,(0,C.$w)(t,_.D.CIMSolidStroke.width)*this.geomUnitsPerPoint()/2+this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint())&&(this._earlyReturn=!0)}}class D extends I{constructor(e,t,r,i){super(t,r),this._applyAdditionalRenderProps=i,this._colorSubstitutionHelper=new m,this._ctx=e}drawSolidFill(e,t){if(!e)return;if((0,p.Bi)(e))this._buildPath(e.rings,!0);else if((0,p.Rg)(e))this._buildPath(e.paths,!0);else if((0,p.ZC)(e))this._buildPath(V(e).rings,!0);else{if(!(0,p.U9)(e))return;console.log("CanvasDrawHelper.drawSolidFill - No implementation!")}const r=this._ctx;r.fillStyle="string"==typeof t?t:"rgba("+Math.round(t[0])+","+Math.round(t[1])+","+Math.round(t[2])+","+(t[3]??255)/255+")",r.fill("evenodd")}drawSolidStroke(e,t,r,i,n,s){if(!e||!t||0===r)return;if((0,p.Bi)(e))this._buildPath(e.rings,!0);else if((0,p.Rg)(e))this._buildPath(e.paths,!1);else{if(!(0,p.ZC)(e))return void console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");this._buildPath(V(e).rings,!0)}const o=this._ctx;o.strokeStyle="string"==typeof t?t:"rgba("+Math.round(t[0])+","+Math.round(t[1])+","+Math.round(t[2])+","+(t[3]??255)/255+")",o.lineWidth=Math.max(this.transformSize(r),.5),this._setCapStyle(i),this._setJoinStyle(n),o.miterLimit=s,o.stroke()}pushClipPath(e){if(this._ctx.save(),(0,p.Bi)(e))this._buildPath(e.rings,!0);else if((0,p.Rg)(e))this._buildPath(e.paths,!0);else{if(!(0,p.ZC)(e))return;this._buildPath(V(e).rings,!0)}this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(e,t){const{colorSubstitutions:r,url:i,tintColor:n}=e,s=(0,C.$w)(e.scaleX,1),o=this._resourceManager.getResource(i);if(null==o)return;let a=t*(o.width/o.height),l=t;t||(a=o.width,l=o.height);const c=(0,C.UE)(i)||"src"in o&&(0,C.UE)(o.src);let u="getFrame"in o?b(o):o;r&&(u=this._colorSubstitutionHelper.applyColorSubstituition(u,r)),this._applyAdditionalRenderProps&&!c&&n&&(u=this._colorSubstitutionHelper.tintImageData(u,n));const h=this.transformPt([0,0]),[d,p]=this.getTransformAngle(),f=this.transformSize(1),m=this._ctx;m.save(),m.setTransform({m11:s*f*d,m12:s*f*p,m21:-f*p,m22:f*d,m41:h[0],m42:h[1]}),m.drawImage(u,-a/2,-l/2,a,l),m.restore()}drawText(e,t){if(!t||0===t.length)return;this._textRasterizer||(this._textRasterizer=new T);const r=G(e);r.size*=this.transformSize((0,l.PN)(1));const i=this._textRasterizer.rasterizeText(t,r);if(!i)return;const{size:n,anchorX:s,anchorY:o,canvas:a}=i,c=n[0]*(s+.5),u=n[1]*(o-.5),h=this._ctx,d=this.transformPt([0,0]),[p,f]=this.getTransformAngle();h.save(),h.setTransform({m11:1*p,m12:1*f,m21:-1*f,m22:1*p,m41:d[0]-1*c,m42:d[1]+1*u}),h.drawImage(a,0,0),h.restore()}drawPictureFill(e,t){if(!e)return;let{colorSubstitutions:r,height:i,offsetX:n,offsetY:s,rotation:o,scaleX:a,tintColor:l,url:c}=t;const u=this._resourceManager.getResource(c);if(null==u)return;if((0,p.Bi)(e))this._buildPath(e.rings,!0);else if((0,p.Rg)(e))this._buildPath(e.paths,!0);else if((0,p.ZC)(e))this._buildPath(V(e).rings,!0);else{if(!(0,p.U9)(e))return;console.log("CanvasDrawHelper.drawPictureFill - No implementation!")}const h=this._ctx,d=(0,C.UE)(c)||"src"in u&&(0,C.UE)(u.src);let f,m="getFrame"in u?b(u):u;if(r&&(m=this._colorSubstitutionHelper.applyColorSubstituition(m,r)),this._applyAdditionalRenderProps){d||l&&(m=this._colorSubstitutionHelper.tintImageData(m,l)),f=h.createPattern(m,"repeat");const e=this.transformSize(1);o||(o=0),n?n*=e:n=0,s?s*=e:s=0,i&&(i*=e);const t=i?i/u.height:1,r=a&&i?a*i/u.width:1;if(0!==o||1!==t||1!==r||0!==n||0!==s){const e=new DOMMatrix;e.rotateSelf(0,0,-o).translateSelf(n,s).scaleSelf(r,t,1),f.setTransform(e)}}else f=h.createPattern(m,"repeat");h.save(),h.fillStyle=f,h.fill("evenodd"),h.restore()}drawPictureStroke(e,t){if(!e)return;let{colorSubstitutions:r,capStyle:i,joinStyle:n,miterLimit:o,tintColor:a,url:c,width:u}=t;const h=this._resourceManager.getResource(c);if(null==h)return;let d;if((0,p.Bi)(e))d=e.rings;else if((0,p.Rg)(e))d=e.paths;else{if(!(0,p.ZC)(e))return(0,p.U9)(e)?void console.log("CanvasDrawHelper.drawPictureStroke - No implementation!"):void 0;d=V(e).rings}u||(u=h.width);const f=(0,C.UE)(c)||"src"in h&&(0,C.UE)(h.src);let m="getFrame"in h?b(h):h;r&&(m=this._colorSubstitutionHelper.applyColorSubstituition(m,r)),this._applyAdditionalRenderProps&&(f||a&&(m=this._colorSubstitutionHelper.tintImageData(m,a)));const g=Math.max(this.transformSize((0,l.Lz)(u)),.5),y=g/m.width,_=this._ctx,v=_.createPattern(m,"repeat-y");let x,S;_.save(),this._setCapStyle(i),this._setJoinStyle(n),void 0!==o&&(_.miterLimit=o),_.lineWidth=g;for(let e of d)if(e=(0,s.o8)(e),H(e),e&&!(e.length<=1)){x=this.transformPt(e[0]);for(let t=1;t<e.length;t++){S=this.transformPt(e[t]);const r=z(x,S),i=new DOMMatrix;i.translateSelf(0,x[1]-g/2).scaleSelf(y,y,1).rotateSelf(0,0,90-r),v.setTransform(i),_.strokeStyle=v,_.beginPath(),_.moveTo(x[0],x[1]),_.lineTo(S[0],S[1]),_.stroke(),x=S}}_.restore()}_buildPath(e,t){const r=this._ctx;if(r.beginPath(),e)for(const i of e){const e=i?i.length:0;if(e>1){let n=this.transformPt(i[0]);r.moveTo(n[0],n[1]);for(let t=1;t<e;t++)n=this.transformPt(i[t]),r.lineTo(n[0],n[1]);t&&r.closePath()}}}_setCapStyle(e){switch(e){case v.uT.Butt:this._ctx.lineCap="butt";break;case v.uT.Round:this._ctx.lineCap="round";break;case v.uT.Square:this._ctx.lineCap="square"}}_setJoinStyle(e){switch(e){case v.wd.Bevel:this._ctx.lineJoin="bevel";break;case v.wd.Round:this._ctx.lineJoin="round";break;case v.wd.Miter:this._ctx.lineJoin="miter"}}}function F(e,t,r){for(const i of t){const t=i.length;for(let n=1;n<t;n++){const t=i[n-1],s=i[n];let o=(s[0]-t[0])*(s[0]-t[0])+(s[1]-t[1])*(s[1]-t[1]);if(0===o)continue;o=Math.sqrt(o);const a=((s[0]-t[0])*(e[1]-t[1])-(s[1]-t[1])*(e[0]-t[0]))/o;if(Math.abs(a)<r){const i=((s[0]-t[0])*(e[0]-t[0])+(s[1]-t[1])*(e[1]-t[1]))/o;if(i>-r&&i<o+r)return!0}}}return!1}function z(e,t){const r=t[0]-e[0],i=t[1]-e[1];return 180/Math.PI*Math.atan2(i,r)}const V=e=>e?{spatialReference:e.spatialReference,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:null,U=(e,t,r)=>{switch(e){case"ExtraLeading":return 1+t/r;case"Multiple":return t;case"Exact":return t/r}};function G(e,t=1){const r=(0,C.DW)(e),n=(0,C._d)(e.fontStyleName),s=e.fontFamilyName??i.Vb,{weight:o,style:a}=n,l=t*(e.height||5),c=(0,C.Bu)(e.horizontalAlignment),u=(0,C.Nl)(e.verticalAlignment),h=(0,C.pM)(e),d=(0,C.pM)(e.haloSymbol),p=null!=d?t*(e.haloSize??0):0,f="CIMBackgroundCallout"===e.callout?.type?e.callout.backgroundSymbol:null,m=(0,C.pM)(f),g=(0,C.xo)(f),y=(0,C._1)(f);return{color:h,size:l,horizontalAlignment:c,verticalAlignment:u,font:{family:s,style:(0,C.pV)(a),weight:(0,C.Kn)(o),decoration:r},halo:{size:p||0,color:d,style:a},backgroundColor:m,borderLine:null!=g&&null!=y?{size:g,color:y}:null,pixelRatio:1,premultiplyColors:!0}}const B=1e-4;function H(e){let t,r,i,n,s,o=e[0],a=1;for(;a<e.length;)t=e[a][0]-o[0],r=e[a][1]-o[1],n=0!==t?r/t:Math.PI/2,void 0!==i&&n-i<=B?(e.splice(a-1,1),o=s):(s=o,o=e[a],a++),i=n}},57176:function(e,t,r){r.d(t,{BW:function(){return k},Sc:function(){return I},Vb:function(){return E},ll:function(){return O},ni:function(){return D},wp:function(){return L}});var i=r(90152),n=r(58941),s=r(21609),o=r(40633),a=r(13798),l=r(13520),c=r(87416),u=r(35068),h=r(90046),d=r(29076),p=r(14817),f=r(38821),m=r(33389),g=r(7590),y=r(74661),_=r(7056),v=r(39686),b=r(17469),x=r(96700);const S=Math.PI,w=S/2,T=Math.PI/180,A=96/72,C=()=>o.A.getLogger("esri.symbols.cim.CIMSymbolHelper");function E(e){let t;switch(e.type){case"cim":return e.data;case"web-style":return e;case"simple-marker":{const r=L.fromSimpleMarker(e);if(!r)throw new Error("InternalError: Cannot convert symbol to CIM");t=r;break}case"picture-marker":t=L.fromPictureMarker(e);break;case"simple-line":t=L.fromSimpleLineSymbol(e);break;case"simple-fill":t=L.fromSimpleFillSymbol(e);break;case"picture-fill":t=L.fromPictureFillSymbol(e);break;case"text":t=L.fromTextSymbol(e)}return{type:"CIMSymbolReference",symbol:t}}function M(e,t,r){switch(t.type){case"CIMSymbolReference":return M(e,t.symbol,r);case"CIMPointSymbol":null==r&&(r={x:0,y:0}),e.drawSymbol(t,r);break;case"CIMLineSymbol":null==r&&(r={paths:[[[0,0],[10,0]]]}),e.drawSymbol(t,r);break;case"CIMPolygonSymbol":null==r&&(r={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]}),e.drawSymbol(t,r);break;case"CIMTextSymbol":{const r={x:0,y:0};e.drawSymbol(t,r);break}case"CIMVectorMarker":{const r=new d.W;e.drawMarker(t,r);break}}return e.envelope()}function R(e){if(!e)return 0;switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAtExtremities":case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementAtRatioPositions":case"CIMMarkerPlacementOnLine":case"CIMMarkerPlacementOnVertices":return Math.abs(e.offset);default:return 0}}function P(e){if(!e)return 0;switch(e.type){case"CIMGeometricEffectArrow":return Math.abs(.5*e.width);case"CIMGeometricEffectBuffer":return Math.abs(e.size);case"CIMGeometricEffectControlMeasureLine":return 500;case"CIMGeometricEffectExtension":case"CIMGeometricEffectRadial":return Math.abs(e.length);case"CIMGeometricEffectJog":return Math.abs(.5*e.length);case"CIMGeometricEffectMove":return Math.max(Math.abs((0,g.$w)(e.offsetX)),Math.abs((0,g.$w)(e.offsetY)));case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":return Math.abs(e.offset);case"CIMGeometricEffectRegularPolygon":return Math.abs(e.radius);case"CIMGeometricEffectRotate":case"CIMGeometricEffectScale":default:return 0;case"CIMGeometricEffectTaperedPolygon":return.5*Math.max(Math.abs(e.fromWidth),Math.abs(e.toWidth));case"CIMGeometricEffectWave":return Math.abs(e.amplitude);case"CIMGeometricEffectDonut":return Math.abs(e.width)}}function O(e){if(!e)return 0;let t=0;for(const r of e)t+=P(r);return t}class I{static getSymbolInflateSize(e,t,r,i,n){return e||(e=[0,0,0,0]),t?this._getInflateSize(e,t,r,i,n):e}static safeSize(e){const t=Math.max(Math.abs(e[0]),Math.abs(e[2])),r=Math.max(Math.abs(e[1]),Math.abs(e[3]));return Math.sqrt(t*t+r*r)}static _vectorMarkerBounds(e,t,r,i){let n=!0;const s=(0,c.vt)();if(t?.markerGraphics)for(const o of t.markerGraphics){const t=[0,0,0,0];o.geometry&&((0,u.Rg)(s,o.geometry),t[0]=0,t[1]=0,t[2]=0,t[3]=0,this.getSymbolInflateSize(t,o.symbol,r,0,i),s[0]+=t[0],s[1]+=t[1],s[2]+=t[2],s[3]+=t[3],n?(e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],n=!1):(e[0]=Math.min(e[0],s[0]),e[1]=Math.min(e[1],s[1]),e[2]=Math.max(e[2],s[2]),e[3]=Math.max(e[3],s[3])))}return e}static _getInflateSize(e,t,r,i,n){if(function(e){return void 0!==e.symbolLayers}(t)){const s=this._getLayersInflateSize(e,t.symbolLayers,r,i,n),o=O(t.effects);return o>0&&(s[0]-=o,s[1]-=o,s[2]+=o,s[3]+=o),s}return this._getTextInflatedSize(e,t,n)}static _getLayersInflateSize(e,t,r,i,n){let s=!0;if(!t)return e;for(const o of t){if(!o)continue;let t=[0,0,0,0];switch(o.type){case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const e=o;let r=e.width;null!=r&&(e.capStyle===m.uT.Square||e.joinStyle===m.wd.Miter?r/=1.4142135623730951:r/=2,t[0]=-r,t[1]=-r,t[2]=r,t[3]=r);break}case"CIMCharacterMarker":case"CIMVectorMarker":case"CIMPictureMarker":{const e=o;if("CIMVectorMarker"===o.type){const e=o;if(t=this._vectorMarkerBounds(t,e,r,n),e.frame){const r=(e.frame.xmin+e.frame.xmax)/2,i=(e.frame.ymin+e.frame.ymax)/2;if(t[0]-=r,t[1]-=i,t[2]-=r,t[3]-=i,null!=e.size){const r=e.size/(e.frame.ymax-e.frame.ymin);t[0]*=r,t[1]*=r,t[2]*=r,t[3]*=r}}}else if("CIMPictureMarker"===o.type){const i=o,n=r.getResource(i.url);let s=1;if(null!=n&&n.height&&(s=n.width/n.height),null!=e.size){const r=e.size/2,n=e.size*s*i.scaleX/2;t=[-n,-r,n,r]}}else if(null!=e.size){const r=e.size/2;t=[-r,-r,r,r]}if(e.anchorPoint){let r,i;"Absolute"===e.anchorPointUnits?(r=e.anchorPoint.x,i=e.anchorPoint.y):(r=e.anchorPoint.x*(t[2]-t[0]),i=e.anchorPoint.y*(t[3]-t[1]));const n=1.25*Math.sqrt(r*r+i*i);t[0]-=n,t[1]-=n,t[2]+=n,t[3]+=n}let s=(0,g.$w)(e.rotation);if(e.rotateClockwise&&(s=-s),i&&(s-=i),s){const e=T*s,r=Math.cos(e),i=Math.sin(e),n=(0,c.vt)([_.MG,_.MG,-_.MG,-_.MG]);(0,c.tK)(n,[t[0]*r-t[1]*i,t[0]*i+t[1]*r]),(0,c.tK)(n,[t[0]*r-t[3]*i,t[0]*i+t[3]*r]),(0,c.tK)(n,[t[2]*r-t[1]*i,t[2]*i+t[1]*r]),(0,c.tK)(n,[t[2]*r-t[3]*i,t[2]*i+t[3]*r]),t=n}let a=(0,g.$w)(e.offsetX),l=(0,g.$w)(e.offsetY);if(i){const e=T*i,t=Math.cos(e),r=Math.sin(e),n=a*r+l*t;a=a*t-l*r,l=n}t[0]+=a,t[1]+=l,t[2]+=a,t[3]+=l;const u=R(e.markerPlacement);u>0&&(t[0]-=u,t[1]-=u,t[2]+=u,t[3]+=u);break}}const a=O(o.effects);a>0&&(t[0]-=a,t[1]-=a,t[2]+=a,t[3]+=a),s?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],s=!1):(e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[2]),e[3]=Math.max(e[3],t[3]))}return e}static _getTextInflatedSize(e,t,r){const i=(0,x.hV)(t.height??f.D.CIMTextSymbol.height);if(e[0]=-i/2,e[1]=-i/2,e[2]=i/2,e[3]=i/2,!r)return e;const n=r.get(t);if(!n)return e;if(!n.glyphMosaicItems.glyphs.length)return e;const{lineGapType:s,lineGap:o}=t,a=s?(0,p.QF)(s,o??0,i):0,l="CIMBackgroundCallout"===t.callout?.type,c=(0,b.Tl)(n.glyphMosaicItems,{scale:i/v.eG,angle:(0,g.$w)(t.angle),xOffset:(0,g.$w)(t.offsetX),yOffset:(0,g.$w)(t.offsetY),horizontalAlignment:t.horizontalAlignment,verticalAlignment:t.verticalAlignment,maxLineWidth:(0,x.Lu)(t.lineWidth),lineHeight:v.DY*Math.max(.25,Math.min(a||1,4)),decoration:t.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:l}).boundsT,u=Math.sqrt(c.width*c.width+c.height*c.height);return e[0]-=c.x+u,e[1]-=c.y-u,e[2]+=c.x+u,e[3]+=-c.y+u,e}}class L{static getEnvelope(e,t,r){if(!e)return null;const i=new p.mx(r);if(Array.isArray(e)){let r;for(const n of e)r?r.union(M(i,n,t)):r=M(i,n,t);return r}return M(i,e,t)}static getTextureAnchor(e,t){const r=this.getEnvelope(e,null,t);if(!r)return[0,0,0];const i=(r.x+.5*r.width)*A,n=(r.y+.5*r.height)*A,s=r.width*A+2,o=r.height*A+2;return[-i/s,-n/o,o]}static rasterize(e,t,r,i,n=!0){const s=r||this.getEnvelope(t,null,i);if(!s)return[null,0,0,0,0];const o=(s.x+.5*s.width)*A,a=(s.y+.5*s.height)*A;e.width=s.width*A,e.height=s.height*A,r||(e.width+=2,e.height+=2);const l=e.getContext("2d",{willReadFrequently:!0}),c=p.IT.createScale(A,-A);c.translate(.5*e.width-o,.5*e.height+a);const u=new p.Rj(l,i,c);switch(t.type){case"CIMPointSymbol":{const e={type:"point",x:0,y:0};u.drawSymbol(t,e);break}case"CIMVectorMarker":{const e=new d.W;u.drawMarker(t,e);break}}const h=l.getImageData(0,0,e.width,e.height),f=new Uint8Array(h.data);if(n){let e;for(let t=0;t<f.length;t+=4)e=f[t+3]/255,f[t]=f[t]*e,f[t+1]=f[t+1]*e,f[t+2]=f[t+2]*e}return[f,e.width,e.height,-o/e.width,-a/e.height]}static fromTextSymbol(e){const{text:t}=e;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:L.createCIMTextSymbolfromTextSymbol(e),textString:t}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(e){const{height:t,outline:r,width:i,xoffset:n,xscale:s,yoffset:o,yscale:a}=e,l=[],c={type:"CIMPolygonSymbol",symbolLayers:l};if(r){const e=q(r);e&&l.push(e)}let u=e.url;"esriPFS"===e.type&&e.imageData&&(u=e.imageData);const h="angle"in e?e.angle??0:0,d=(i??0)*(s||1),p=(t??0)*(a||1);return l.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:m.O$.Picture,tintColor:null,url:u,height:p,width:d,offsetX:(0,g.$w)(n),offsetY:(0,g.$w)(o),rotation:(0,g.$w)(-h),colorSubstitutions:null}),c}static fromSimpleFillSymbol(e){const{color:t,style:r,outline:i}=e,n=[],o={type:"CIMPolygonSymbol",symbolLayers:n};if(i){const e=q(i);e&&n.push(e)}if(r&&"solid"!==r&&"none"!==r&&"esriSFSSolid"!==r&&"esriSFSNull"!==r){const e={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:U(t),capStyle:m.uT.Butt,joinStyle:m.wd.Miter,width:.75}]};let i=0;const o=(0,l.PN)(W(r)?8:10);switch(r){case"vertical":case"esriSFSVertical":i=90;break;case"forward-diagonal":case"esriSFSForwardDiagonal":case"diagonal-cross":case"esriSFSDiagonalCross":i=-45;break;case"backward-diagonal":case"esriSFSBackwardDiagonal":i=45;break;case"cross":case"esriSFSCross":i=0}n.push({type:"CIMHatchFill",lineSymbol:e,offsetX:0,offsetY:0,rotation:i,separation:o}),"cross"===r||"esriSFSCross"===r?n.push({type:"CIMHatchFill",lineSymbol:(0,s.o8)(e),offsetX:0,offsetY:0,rotation:90,separation:o}):"diagonal-cross"!==r&&"esriSFSDiagonalCross"!==r||n.push({type:"CIMHatchFill",lineSymbol:(0,s.o8)(e),offsetX:0,offsetY:0,rotation:45,separation:o})}else!r||"solid"!==r&&"esriSFSSolid"!==r||n.push({type:"CIMSolidFill",enable:!0,color:U(t)});return o}static fromSimpleLineSymbol(e){const{cap:t,color:r,join:i,marker:n,miterLimit:s,style:o,width:a}=e;let l=null;"solid"!==o&&"none"!==o&&"esriSLSSolid"!==o&&"esriSLSNull"!==o&&(l=[{type:"CIMGeometricEffectDashes",dashTemplate:k(o,t),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const c=[];if(n){let e;switch(n.placement){case"begin-end":e=m.$2.Both;break;case"begin":e=m.$2.JustBegin;break;case"end":e=m.$2.JustEnd;break;default:e=m.$2.None}const t=L.fromSimpleMarker(n,a,r).symbolLayers[0];t.markerPlacement={type:"CIMMarkerPlacementAtExtremities",placePerPart:!1,angleToLine:!0,offset:0,extremityPlacement:e,offsetAlongLine:0},c.push(t)}return c.push({type:"CIMSolidStroke",color:"none"!==o&&"esriSLSNull"!==o?U(r):[0,0,0,0],capStyle:D(t),joinStyle:F(i),miterLimit:s,width:a,effects:l}),{type:"CIMLineSymbol",symbolLayers:c}}static fromPictureMarker(e){const{angle:t,height:r,width:i,xoffset:n,yoffset:s}=e;let o=e.url;return"esriPMS"===e.type&&e.imageData&&(o=e.imageData),{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:m.O$.Picture,tintColor:null,url:o,size:r,width:i,offsetX:(0,g.$w)(n),offsetY:(0,g.$w)(s),rotation:(0,g.$w)(-t)}]}}static createCIMTextSymbolfromTextSymbol(e){const{angle:t,color:r,font:n,haloColor:s,haloSize:o,horizontalAlignment:a,kerning:l,lineWidth:c,text:u,verticalAlignment:h,xoffset:d,yoffset:p,backgroundColor:f,borderLineColor:y,borderLineSize:_}=e;let v,b,x,S,w,T;n&&(v=n.family,b=n.style,x=n.weight,S=n.size,w=n.decoration);let A=!1;return u&&(A=(0,i.y)(u)[1]),(f||_)&&(T={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:U(f)},{type:"CIMSolidStroke",color:U(y),width:_}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null}),{type:"CIMTextSymbol",angle:t,blockProgression:m.TZ.BTT,depth3D:1,extrapolateBaselines:!0,fontEffects:m.Y.Normal,fontEncoding:m.bj.Unicode,fontFamilyName:v||"Arial",fontStyleName:G(b,x),fontType:m.g7.Unspecified,haloSize:o,height:S,hinting:m.mU.Default,horizontalAlignment:z(a??"center"),kerning:l,letterWidth:100,ligatures:!0,lineGapType:"Multiple",lineWidth:c,offsetX:(0,g.$w)(d),offsetY:(0,g.$w)(p),strikethrough:"line-through"===w,underline:"underline"===w,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:U(r)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:U(s)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:A?m.f0.RTL:m.f0.LTR,verticalAlignment:V(h??"baseline"),verticalGlyphOrientation:m.vG.Right,wordSpacing:100,billboardMode3D:m.xn.FaceNearPlane,callout:T}}static createPictureMarkerRasterizationParam(e){const{angle:t,height:r,width:i,xoffset:n,yoffset:s}=e,o=e.url??e.source?.url??e.source?.imageData;return o?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:m.O$.Picture,tintColor:null,url:o,size:r,width:i,offsetX:(0,g.$w)(n),offsetY:(0,g.$w)(s),rotation:(0,g.$w)(-t)}}:null}static createPictureFillRasterizationParam(e){const{width:t,height:r,xoffset:i,yoffset:n,url:s}=e;return s?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureFill",scaleX:1,textureFilter:m.O$.Picture,tintColor:null,url:s,width:t,height:r,offsetX:(0,g.$w)(i),offsetY:(0,g.$w)(n),rotation:0}}:null}static fromSimpleMarker(e,t,r){const{style:i}=e,n=e.color??r;if("path"===i||"esriSMSPath"===i){const t=[];if("outline"in e&&e.outline){const r=e.outline;t.push({type:"CIMSolidStroke",enable:!0,width:r.width,color:U(r.color),path:e.path})}t.push({type:"CIMSolidFill",enable:!0,color:U(n),path:e.path});const[r,i]=j("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:-(0,g.$w)(e.angle),size:(0,g.$w)(e.size||6),offsetX:(0,g.$w)(e.xoffset),offsetY:(0,g.$w)(e.yoffset),scaleSymbolsProportionally:!1,frame:r,markerGraphics:[{type:"CIMMarkerGraphic",geometry:i,symbol:{type:"CIMPolygonSymbol",symbolLayers:t}}]}]}}const s=[];let o,a,l=e.size;if("outline"in e&&e.outline&&"none"!==e.outline.style&&"esriSLSNull"!==e.outline.style){const t=e.outline,r="solid"!==t.style&&"esriSLSSolid"!==t.style;[o,a]=r?j(i,e.size):j(i);const n=t.width??y.A7.width;if(r){const t=n/e.size,r=(o.xmax-o.xmin)*t/2,i=(o.ymax-o.ymin)*t/2;o.xmin-=r,o.xmax+=r,o.ymin-=i,o.ymax+=i,l&&(l+=n)}const c="cross"!==e.style&&"x"!==e.style||"dot"===e?.outline.style||"short-dot"===e?.outline.style?m.yS.HalfGap:m.yS.FullPattern,u=r?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:k(t.style,null).map((e=>t.width&&t.width>0?e*t.width:e)),lineDashEnding:c,controlPointEnding:m.yS.FullPattern}]:void 0;s.push({type:"CIMSolidStroke",capStyle:r?m.uT.Round:m.uT.Butt,enable:!0,width:n,color:U(t.color),effects:u})}else!t||"line-marker"!==e.type||"cross"!==e.style&&"x"!==e.style?[o,a]=j(i):([o,a]=j(i),s.push({type:"CIMSolidStroke",enable:!0,width:t,color:U(n)}));s.push({type:"CIMSolidFill",enable:!0,color:U(n)});const c={type:"CIMPolygonSymbol",symbolLayers:s};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:(0,g.$w)(-e.angle),size:(0,g.$w)(l||6*t),offsetX:(0,g.$w)(e.xoffset),offsetY:(0,g.$w)(e.yoffset),scaleSymbolsProportionally:!1,frame:o,markerGraphics:[{type:"CIMMarkerGraphic",geometry:a,symbol:c}]}]}}static fromCIMHatchFill(e,t){const r=t*(e.separation??f.D.CIMHatchFill.separation),i=r/2,n=(0,s.o8)(e.lineSymbol);n.symbolLayers?.forEach((e=>{switch(e.type){case"CIMSolidStroke":null!=e.width&&(e.width*=t),e.effects?.forEach((e=>{if("CIMGeometricEffectDashes"===e.type){const r=e.dashTemplate;e.dashTemplate=r?.map((e=>e*t))}}));break;case"CIMVectorMarker":{null!=e.size&&(e.size*=t);const r=e.markerPlacement;null!=r&&"placementTemplate"in r&&(r.placementTemplate=r.placementTemplate.map((e=>e*t)));break}}}));let o=this._getLineSymbolPeriod(n)||4;for(;o<4;)o*=2;const a=o/2;return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-i,ymax:i},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-a,0],[a,0]]]},symbol:n}],size:r}}static fetchResources(e,t,r,i=null){return e&&t?(N(e,(e=>{(function(e,t,r){e.effects&&null==t.geometryEngine&&(t.geometryEnginePromise?r.push(t.geometryEnginePromise):(0,g.yH)(e.effects)&&(t.geometryEnginePromise=(0,g._H)(),r.push(t.geometryEnginePromise),t.geometryEnginePromise.then((e=>t.geometryEngine=e))))})(e,t,r),"url"in e&&e.url&&r.push(t.fetchResource(e.url,{signal:i}))})),r):r}static fetchFonts(e,t,r){if(e&&t)if("symbolLayers"in e&&e.symbolLayers){for(const i of e.symbolLayers)if("CIMVectorMarker"===i.type&&i.markerGraphics)for(const e of i.markerGraphics)e?.symbol&&L.fetchFonts(e.symbol,t,r)}else if("CIMTextSymbol"===e.type){const{fontFamilyName:i,fontStyleName:n}=e;if(!i||"calcitewebcoreicons"===i.toLowerCase())return;const{style:s,weight:o}=(0,g._d)(n),a=(0,g.DW)(e),l=new h.A({family:i,style:s,weight:o,decoration:a});r.push(t.loadFont(l).catch((()=>{C().error(`Unsupported font ${i} in CIM symbol`)})))}}static _getLineSymbolPeriod(e){if(e){const t=this._getEffectsRepeat(e.effects);if(t)return t;if(e.symbolLayers)for(const t of e.symbolLayers)if(t){const e=this._getEffectsRepeat(t.effects);if(e)return e;switch(t.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const e=this._getPlacementRepeat(t.markerPlacement);if(e)return e}}}}return 0}static _getEffectsRepeat(e){if(e)for(const t of e)if(t)switch(t.type){case"CIMGeometricEffectDashes":{const e=t.dashTemplate;if(e&&e.length){let t=0;for(const r of e)t+=r;return 1&e.length&&(t*=2),t}break}case"CIMGeometricEffectWave":return t.period;default:C().error(`unsupported geometric effect type ${t.type}`)}return 0}static _getPlacementRepeat(e){if(e)switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineVariableSize":{const t=e.placementTemplate;if(t&&t.length){let e=0;for(const r of t)e+=+r;return 1&t.length&&(e*=2),e}break}}return 0}static fromCIMInsidePolygon(e){const t=e.markerPlacement,r={...e};r.markerPlacement=null,r.anchorPoint=null;const i=Math.abs(t.stepX),n=Math.abs(t.stepY),s=(t.randomness??100)/100;let o,c,u,h;if("Random"===t.gridType){const e=(0,l.PN)(v.yv),r=Math.max(Math.floor(e/i),1),d=Math.max(Math.floor(e/n),1);o=r*i/2,c=d*n/2,u=2*c;const p=new a.A(t.seed),f=s*i/1.5,m=s*n/1.5;h=[];for(let e=0;e<r;e++)for(let t=0;t<d;t++){const r=e*i-o+f*(.5-p.getFloat()),s=t*n-c+m*(.5-p.getFloat());h.push({x:r,y:s}),0===e&&h.push({x:r+2*o,y:s}),0===t&&h.push({x:r,y:s+2*c})}}else!0===t.shiftOddRows?(o=i/2,c=n,u=2*n,h=[{x:-o,y:0},{x:o,y:0},{x:0,y:c},{x:0,y:-c}]):(o=i/2,c=n/2,u=n,h=[{x:-i,y:0},{x:0,y:-n},{x:-i,y:-n},{x:0,y:0},{x:i,y:0},{x:0,y:n},{x:i,y:n},{x:-i,y:n},{x:i,y:-n}]);return{type:"CIMVectorMarker",frame:{xmin:-o,xmax:o,ymin:-c,ymax:c},markerGraphics:h.map((e=>({type:"CIMMarkerGraphic",geometry:e,symbol:{type:"CIMPointSymbol",symbolLayers:[r]}}))),size:u}}}function N(e,t){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const r=e.symbolLayers;if(!r)return;for(const e of r)if(t(e),"CIMVectorMarker"===e.type){const r=e.markerGraphics;if(!r)continue;for(const e of r)if(e){const r=e.symbol;r&&N(r,t)}}break}}}const D=e=>{if(!e)return m.uT.Butt;switch(e){case"butt":return m.uT.Butt;case"square":return m.uT.Square;case"round":return m.uT.Round}},F=e=>{if(!e)return m.wd.Miter;switch(e){case"miter":return m.wd.Miter;case"round":return m.wd.Round;case"bevel":return m.wd.Bevel}},z=e=>{if(null==e)return"Center";switch(e){case"left":return"Left";case"right":return"Right";case"center":return"Center"}},V=e=>{if(null==e)return"Center";switch(e){case"baseline":return"Baseline";case"top":return"Top";case"middle":return"Center";case"bottom":return"Bottom"}},U=e=>{if(!e)return[0,0,0,0];const{r:t,g:r,b:i,a:n}=e;return[t,r,i,255*n]},G=(e,t)=>{const r=B(t),i=H(e);return r&&i?`${r}-${i}`:`${r}${i}`},B=e=>{if(!e)return"";switch(e.toLowerCase()){case"bold":case"bolder":return"bold"}return""},H=e=>{if(!e)return"";switch(e.toLowerCase()){case"italic":case"oblique":return"italic"}return""},k=(e,t)=>{const r=(0,n.A)("safari")?.001:0,i="butt"===t;switch(e){case"dash":case"esriSLSDash":return i?[4,3]:[3,4];case"dash-dot":case"esriSLSDashDot":return i?[4,3,1,3]:[3,4,r,4];case"dot":case"esriSLSDot":return i?[1,3]:[r,4];case"long-dash":case"esriSLSLongDash":return i?[8,3]:[7,4];case"long-dash-dot":case"esriSLSLongDashDot":return i?[8,3,1,3]:[7,4,r,4];case"long-dash-dot-dot":case"esriSLSDashDotDot":return i?[8,3,1,3,1,3]:[7,4,r,4,r,4];case"short-dash":case"esriSLSShortDash":return i?[4,1]:[3,2];case"short-dash-dot":case"esriSLSShortDashDot":return i?[4,1,1,1]:[3,2,r,2];case"short-dash-dot-dot":case"esriSLSShortDashDotDot":return i?[4,1,1,1,1,1]:[3,2,r,2,r,2];case"short-dot":case"esriSLSShortDot":return i?[1,1]:[r,2];case"solid":case"esriSLSSolid":case"none":return C().error("Unexpected: style does not require rasterization"),[0,0];default:return C().error(`Tried to rasterize SLS, but found an unexpected style: ${e}!`),[0,0]}},j=(e,t=100)=>{const r=t/2;let i,n;const s=e;if("circle"===s||"esriSMSCircle"===s){const e=.25;let t=Math.acos(1-e/r),s=Math.ceil(S/t/4);0===s&&(s=1),t=w/s,s*=4;const o=[];o.push([r,0]);for(let e=1;e<s;e++)o.push([r*Math.cos(e*t),-r*Math.sin(e*t)]);o.push([r,0]),i={rings:[o]},n={xmin:-r,ymin:-r,xmax:r,ymax:r}}else if("cross"===s||"esriSMSCross"===s){const e=0;i={paths:[[[e,r],[e,-r]],[[r,e],[-r,e]]]},n={xmin:-r,ymin:-r,xmax:r,ymax:r}}else if("diamond"===s||"esriSMSDiamond"===s)i={rings:[[[-r,0],[0,r],[r,0],[0,-r],[-r,0]]]},n={xmin:-r,ymin:-r,xmax:r,ymax:r};else if("square"===s||"esriSMSSquare"===s)i={rings:[[[-r,-r],[-r,r],[r,r],[r,-r],[-r,-r]]]},n={xmin:-r,ymin:-r,xmax:r,ymax:r};else if("x"===s||"esriSMSX"===s)i={paths:[[[r,r],[-r,-r]],[[r,-r],[-r,r]]]},n={xmin:-r,ymin:-r,xmax:r,ymax:r};else if("triangle"===s||"esriSMSTriangle"===s){const e=.5773502691896257*t,r=-e,s=2/3*t,o=s-t;i={rings:[[[r,o],[0,s],[e,o],[r,o]]]},n={xmin:r,ymin:o,xmax:e,ymax:s}}else"arrow"===s&&(i={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},n={xmin:-r,ymin:-r,xmax:r,ymax:r});return[n,i]},W=e=>"vertical"===e||"horizontal"===e||"cross"===e||"esriSFSCross"===e||"esriSFSVertical"===e||"esriSFSHorizontal"===e;function q(e){if(!e)return null;let t=null;const{cap:r,color:i,join:n,miterLimit:s,style:o,width:a}=e;return"solid"!==o&&"none"!==o&&"esriSLSSolid"!==o&&"esriSLSNull"!==o&&(t=[{type:"CIMGeometricEffectDashes",dashTemplate:k(o,r),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]),{type:"CIMSolidStroke",color:"esriSLSNull"!==o&&"none"!==o?U(i):[0,0,0,0],capStyle:D(r),joinStyle:F(n),miterLimit:s,width:a,effects:t}}},93996:function(e,t,r){r.d(t,{I:function(){return o},U:function(){return s}});var i=r(33134),n=r(33389);const s=.03;class o{constructor(e=0,t=!1){}isEmpty(e){if(!e.nextPoint())return!0;let t,r,i,n;for(t=e.x,r=e.y;e.nextPoint();t=r,r=n)if(i=e.x,n=e.y,i!==t||n!==r)return e.seekPathStart(),!1;return e.seekPathStart(),!0}normalize(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);0!==t&&(e[0]/=t,e[1]/=t)}getLength(e,t,r,i){const n=r-e,s=i-t;return Math.sqrt(n*n+s*s)}getSegLength(e){const[[t,r],[i,n]]=e;return this.getLength(t,r,i,n)}getCoord2D(e,t,r,i,n){return[e+(r-e)*n,t+(i-t)*n]}getSegCoord2D(e,t){const[[r,i],[n,s]]=e;return this.getCoord2D(r,i,n,s,t)}getAngle(e,t,r,i,n){const s=r-e,o=i-t;return Math.atan2(o,s)}getAngleCS(e,t,r,i,n){const s=r-e,o=i-t,a=Math.sqrt(s*s+o*o);return a>0?[s/a,o/a]:[1,0]}getSegAngleCS(e,t){const[[r,i],[n,s]]=e;return this.getAngleCS(r,i,n,s,t)}cut(e,t,r,i,n,s){return[n<=0?[e,t]:this.getCoord2D(e,t,r,i,n),s>=1?[r,i]:this.getCoord2D(e,t,r,i,s)]}getSubCurve(e,t,r){const n=i.z.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(n,e,t,r)?n:null}appendSubCurve(e,t,r,i){e.startPath(),t.seekPathStart();let n=0,s=!0;if(!t.nextPoint())return!1;let o=t.x,a=t.y;for(;t.nextPoint();){const l=this.getLength(o,a,t.x,t.y);if(0!==l){if(s){if(n+l>r){const c=(r-n)/l;let u=1,h=!1;n+l>=i&&(u=(i-n)/l,h=!0);const d=this.cut(o,a,t.x,t.y,c,u);if(d&&e.pushPoints(d),h)break;s=!1}}else{if(n+l>i){const r=this.cut(o,a,t.x,t.y,0,(i-n)/l);r&&e.pushPoint(r[1]);break}e.pushXY(t.x,t.y)}n+=l,o=t.x,a=t.y}else o=t.x,a=t.y}return!0}getCIMPointAlong(e,t){if(!e.nextPoint())return null;let r,i,n,s,o=0;for(r=e.x,i=e.y;e.nextPoint();r=n,i=s){n=e.x,s=e.y;const a=this.getLength(r,i,n,s);if(0!==a){if(o+a>t){const e=(t-o)/a;return this.getCoord2D(r,i,n,s,e)}o+=a}}return null}offset(e,t,r,i,s){if(!e||e.length<2)return null;let o=0,a=e[o++],l=o;for(;o<e.length;){const t=e[o];t[0]===a[0]&&t[1]===a[1]||(o!==l&&(e[l]=e[o]),a=e[l++]),o++}const c=e[0][0]===e[l-1][0]&&e[0][1]===e[l-1][1];if(c&&--l,l<(c?3:2))return null;const u=[];a=c?e[l-1]:null;let h=e[0];for(let s=0;s<l;s++){const o=s===l-1?c?e[0]:null:e[s+1];if(a)if(o){const e=[o[0]-h[0],o[1]-h[1]];this.normalize(e);const s=[h[0]-a[0],h[1]-a[1]];this.normalize(s);const l=s[0]*e[1]-s[1]*e[0],c=s[0]*e[0]+s[1]*e[1];if(0===l&&1===c){h=o;continue}if(l>=0==t<=0){if(c<1){const r=[e[0]-s[0],e[1]-s[1]];this.normalize(r);const n=Math.sqrt((1+c)/2);if(n>1/i){const e=-Math.abs(t)/n;u.push([h[0]-r[0]*e,h[1]-r[1]*e])}}}else switch(r){case n.xw.Mitered:{const r=Math.sqrt((1+c)/2);if(r>0&&1/r<i){const i=[e[0]-s[0],e[1]-s[1]];this.normalize(i);const n=Math.abs(t)/r;u.push([h[0]-i[0]*n,h[1]-i[1]*n]);break}}case n.xw.Bevelled:u.push([h[0]+s[1]*t,h[1]-s[0]*t]),u.push([h[0]+e[1]*t,h[1]-e[0]*t]);break;case n.xw.Rounded:if(c<1){u.push([h[0]+s[1]*t,h[1]-s[0]*t]);const r=Math.floor(2.5*(1-c));if(r>0){const i=1/r;let n=i;for(let o=1;o<r;o++,n+=i){const r=[s[1]*(1-n)+e[1]*n,-s[0]*(1-n)-e[0]*n];this.normalize(r),u.push([h[0]+r[0]*t,h[1]+r[1]*t])}}u.push([h[0]+e[1]*t,h[1]-e[0]*t])}break;case n.xw.Square:default:if(l<0)u.push([h[0]+(s[1]+s[0])*t,h[1]+(s[1]-s[0])*t]),u.push([h[0]+(e[1]-e[0])*t,h[1]-(e[0]+e[1])*t]);else{const r=Math.sqrt((1+Math.abs(c))/2),i=[e[0]-s[0],e[1]-s[1]];this.normalize(i);const n=t/r;u.push([h[0]-i[0]*n,h[1]-i[1]*n])}}}else{const e=[h[0]-a[0],h[1]-a[1]];this.normalize(e),u.push([h[0]+e[1]*t,h[1]-e[0]*t])}else{const e=[o[0]-h[0],o[1]-h[1]];this.normalize(e),u.push([h[0]+e[1]*t,h[1]-e[0]*t])}a=h,h=o}return u.length<(c?3:2)?null:(c&&u.push([u[0][0],u[0][1]]),u)}}},65661:function(e,t,r){r.d(t,{VA:function(){return a},YQ:function(){return i},Z1:function(){return u},ps:function(){return l}});var i,n,s=r(33134),o=r(93996);class a{constructor(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}isEmpty(){return 0===this._values.length}size(){return this._values.length}init(e,t,r=!0){if(this._setEmpty(),!e||0===e.length)return!1;for(let t=0;t<e.length;t++){let i=Math.abs(e[t]);r&&i<1e-7&&(i=1e-7),this._values.push(i),this._length+=i}return t&&1&e.length&&(this._length*=2),0!==this._length&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)}scale(e){const t=this._values?this._values.length:0;for(let r=0;r<t;++r)this._values[r]*=e;this._length*=e,this.extPtGap*=e,this.ctrlPtGap*=e}addValue(e){this._length+=e,this._values.push(e)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0}}class l{constructor(){this.pt=null,this.ca=0,this.sa=0}}(n=i||(i={}))[n.FAIL=0]="FAIL",n[n.END=1]="END",n[n.CONTINUE=2]="CONTINUE";class c{constructor(){this.reset()}reset(){this.segment=null,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1}isValid(){return null!==this.segment}copyTo(e){e.segment=this.segment,e.segmentLength=this.segmentLength,e.abscissa=this.abscissa,e.isPathEnd=this.isPathEnd,e.isPartEnd=this.isPartEnd}}class u extends o.I{constructor(e=0,t=!1){super(e,t),this._tolerance=o.U,this._currentPosition=new c}updateTolerance(e){this._tolerance=o.U*e}init(e,t,r=!0){return r?(this._patternLength=t.length(),this._partExtPtGap=t.extPtGap,this._partCtrlPtGap=t.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._pathCursor=e,this._seg=-1,this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(e,t=i.FAIL){const r=new c;return!!this._nextPosition(e,r,null,t)&&(r.copyTo(this._currentPosition),!0)}curPointAndAngle(e){e.pt=this._getPoint(this._currentPosition);const[t,r]=this._getAngleCS(this._currentPosition);e.ca=t,e.sa=r}nextPointAndAngle(e,t,r=i.FAIL){const n=new c;if(!this._nextPosition(e,n,null,r))return!1;n.copyTo(this._currentPosition),t.pt=this._getPoint(n);const[s,o]=this._getAngleCS(n);return t.ca=s,t.sa=o,!0}nextCurve(e){if(0===e)return null;const t=s.z.createEmptyOptimizedCIM("esriGeometryPolyline");t.startPath(),t.nextPath();const r=new c;return this._nextPosition(e,r,t,i.END)?(r.copyTo(this._currentPosition),t):null}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(e){return this._pathCursor.seekInPath(e),[this._pathCursor.x,this._pathCursor.y]}getSeg(e){return[this.getPt(e),this.getPt(e+1)]}_nextPosition(e,t,r,n){if(this._currentPosition.isPathEnd)return!1;let s=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(s/=this._currentPosition.segmentLength),this._currentPosition.copyTo(t);t.abscissa+e*this._partLengthRatio>t.segmentLength+this._tolerance;){if(r){if(0===r.pathSize)if(0===s){const e=t.segment[0];r.pushXY(e[0],e[1])}else r.pushPoint(this.getSegCoord2D(t.segment,s));const e=t.segment[1];r.pushXY(e[0],e[1])}if(s=0,e-=(t.segmentLength-t.abscissa)/this._partLengthRatio,this._partSegCount)t.segment=this._nextSegment(),t.segmentLength=this.getSegLength(t.segment),t.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart())return n!==i.FAIL&&(t.segmentLength=this.getSegLength(t.segment),t.isPartEnd=!0,n===i.END?(t.abscissa=t.segmentLength,t.isPathEnd=!0):t.abscissa=t.segmentLength+e,!0);this._currentPosition.copyTo(t)}}if(t.abscissa+=e*this._partLengthRatio,r){0===r.pathSize&&(0===s?r.pushPoint(t.segment[0]):r.pushPoint(this.getSegCoord2D(t.segment,s)));const e=t.abscissa/t.segmentLength;1===e?r.pushPoint(t.segment[1]):r.pushPoint(this.getSegCoord2D(t.segment,e))}return this._partSegCount||Math.abs(t.abscissa-t.segmentLength)<this._tolerance&&(t.isPathEnd=this._partIsLast,t.isPartEnd=!0),!0}_getPoint(e){const t=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegCoord2D(this._currentPosition.segment,t)}_getAngleCS(e){const t=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegAngleCS(this._currentPosition.segment,t)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}let e=this._partSegCount;for(;e;)this._previousSegment(),--e;this._currentPosition.segment=this._nextSegment(),this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;const t=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(t);let r=t+this._partSegCount+1;if(r>=this._pathCursor.pathSize&&(r=0),this._ctrlPtEnd=this._pathCursor.getControlPointAt(r),this._patternLength>0){const e=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,t=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let r=Math.round((this._partLength-(e+t))/this._patternLength);r<=0&&(r=e+t>0?0:1),this._partLengthRatio=this._partLength/(e+t+r*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+1}}},67895:function(e,t,r){r.d(t,{$:function(){return u}});var i=r(52874),n=r(75505),s=r(21609),o=r(54547),a=r(7590),l=r(16088);const c=e=>{if(!e)return[0,0,0,0];const{r:t,g:r,b:i,a:n}=e;return[t,r,i,255*n]};class u{static findApplicableOverrides(e,t,r){if(e&&t){if(e.primitiveName){let i=!1;for(const t of r)if(t.primitiveName===e.primitiveName){i=!0;break}if(!i)for(const i of t)i.primitiveName===e.primitiveName&&r.push(i)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const i of e.effects)u.findApplicableOverrides(i,t,r);if(e.symbolLayers)for(const i of e.symbolLayers)u.findApplicableOverrides(i,t,r);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(e.effects)for(const i of e.effects)u.findApplicableOverrides(i,t,r);if(e.markerPlacement&&u.findApplicableOverrides(e.markerPlacement,t,r),"CIMVectorMarker"===e.type){if(e.markerGraphics)for(const i of e.markerGraphics)u.findApplicableOverrides(i,t,r),u.findApplicableOverrides(i.symbol,t,r)}else"CIMCharacterMarker"===e.type?u.findApplicableOverrides(e.symbol,t,r):"CIMHatchFill"===e.type?u.findApplicableOverrides(e.lineSymbol,t,r):"CIMPictureMarker"===e.type&&u.findApplicableOverrides(e.animatedSymbolProperties,t,r)}}}static findEffectOverrides(e,t){if(!e)return null;if("CIMGeometricEffectDashes"===e.type&&(0,a.K3)(e),!t||!e.primitiveName)return{type:"cim-effect-param",effect:e,overrides:[]};const r=(0,a.rB)(e),i=e.primitiveName,n=[];for(const e of t)e.primitiveName===i&&n.push((0,a.rB)(e));return{type:"cim-effect-param",effect:r,overrides:(0,a.pk)(n)}}static async resolveSymbolOverrides(e,t,r,i,n,o,l){if(!e?.symbol)return null;let{symbol:c,primitiveOverrides:h}=e;const d=!!h;if(!d&&!i)return c;c=(0,s.o8)(c),h=(0,s.o8)(h);let p=!0;if(t||(t={attributes:{}},p=!1),d){if(p||(h=h.filter((e=>!e.valueExpressionInfo?.expression.includes("$feature")))),l||(h=h.filter((e=>!e.valueExpressionInfo?.expression.includes("$view")))),h.length>0){const e={spatialReference:r,fields:(0,a.O2)(t.attributes),geometryType:n};await u.createRenderExpressions(h,e),u.evaluateOverrides(h,t,n??"esriGeometryPoint",o,l)}u.applyOverrides(c,h)}return i&&u.applyDictionaryTextOverrides(c,t,i,null),c}static async createRenderExpressions(e,t){const r=[];for(const i of e){const e=i.valueExpressionInfo;if(!e||u._expressionToRenderExpression.has(e.expression))continue;const n=(0,o.Ad)(e.expression,t.spatialReference,t.fields);r.push(n),n.then((t=>u._expressionToRenderExpression.set(e.expression,t)))}r.length>0&&await Promise.all(r)}static evaluateOverrides(e,t,r,i,s){const o={$view:{scale:s?.scale}};for(const s of e){s.value&&"object"==typeof s.value&&(0,n.IB)(s.value)&&("Color"===s.propertyName||"StrokeColor"===s.propertyName)&&(s.value=c(s.value));const e=s.valueExpressionInfo;if(!e)continue;const a=u._expressionToRenderExpression.get(e.expression);a&&(s.value=(0,l.A)(a,t,o,r,i))}}static applyDictionaryTextOverrides(e,t,r,i,n="Normal"){if(e?.type)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":case"CIMTextSymbol":{const s=e.symbolLayers;if(!s)return;for(const o of s)o&&"CIMVectorMarker"===o.type&&u.applyDictionaryTextOverrides(o,t,r,i,"CIMTextSymbol"===e.type?e.textCase:n)}break;case"CIMVectorMarker":{const n=e.markerGraphics;if(!n)return;for(const e of n)e&&u.applyDictionaryTextOverrides(e,t,r,i)}break;case"CIMMarkerGraphic":{const s=e.textString;if(s&&s.includes("[")){const o=(0,a.gQ)(s,r);e.textString=(0,a.FM)(t,o,i,n)}}}}static applyOverrides(e,t,r,i){if(e.primitiveName)for(const n of t)if(n.primitiveName===e.primitiveName){const t=(0,a.YF)(n.propertyName);if(i&&i.push({cim:e,nocapPropertyName:t,value:e[t]}),r){let t=!1;for(const i of r)i.primitiveName===e.primitiveName&&(t=!0);t||r.push(n)}null!=n.value&&(e[t]=n.value)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const n of e.effects)u.applyOverrides(n,t,r,i);if(e.symbolLayers)for(const n of e.symbolLayers)u.applyOverrides(n,t,r,i);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(e.effects)for(const n of e.effects)u.applyOverrides(n,t,r,i);if("CIMVectorMarker"===e.type&&e.markerGraphics)for(const n of e.markerGraphics)u.applyOverrides(n,t,r,i),u.applyOverrides(n.symbol,t,r,i)}}static restoreOverrides(e){for(const t of e)t.cim[t.nocapPropertyName]=t.value}static buildOverrideKey(e){let t="";for(const r of e)void 0!==r.value&&(t+=`${r.primitiveName}${r.propertyName}${JSON.stringify(r.value)}`);return t}static toValue(e,t){if("DashTemplate"===e)return t.split(" ").map((e=>Number(e)));if("Color"===e){const e=new i.A(t).toRgba();return e[3]*=255,e}return t}}u._expressionToRenderExpression=new Map},82497:function(e,t,r){r.d(t,{A:function(){return i}});class i{constructor(e=0,t=0,r=0,i=0){this.x=e,this.y=t,this.width=r,this.height=i}static fromExtent(e){return new i(e.xmin,-e.ymax,e.xmax-e.xmin,e.ymax-e.ymin)}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}},38821:function(e,t,r){r.d(t,{D:function(){return n},K:function(){return i}});const i={color:[128,128,128,1],outlinecolor:[0,0,0,1],backgroundcolor:[128,128,128,1],borderlinecolor:[0,0,0,1],tintcolor:[255,255,255,1]},n={CIMVectorMarker:{scalesymbolsproportionally:!1,respectframe:!0,anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMPictureMarker:{scalex:1,texturefilter:"Draft",anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMTextSymbol:{angle:0,anglex:0,angley:0,halosize:1,height:10,horizontalalignment:"Left",kerning:!0,letterspacing:0,letterwidth:100,ligatures:!0,linegap:0,offsetx:0,offsety:0,strikethrough:!1,textcase:"Normal",textstring:"",underline:!1,verticalalignment:"Bottom",enable:!0,colorlocked:!1},CIMSolidStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMPictureStroke:{texturefilter:"Draft",capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMGradientStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMSolidFill:{enable:!0,colorlocked:!1},CIMPictureFill:{offsetx:0,offsety:0,rotation:0,scalex:1,height:10,texturefilter:"Draft",enable:!0,colorlocked:!1},CIMHatchFill:{offsetx:0,offsety:0,rotation:0,separation:4,enable:!0,colorlocked:!1},CIMGeometricEffectAddControlPoints:{angletolerance:120},CIMGeometricEffectArrow:{arrowtype:"OpenEnded",width:5},CIMGeometricEffectBuffer:{size:1},CIMGeometricEffectCut:{begincut:1,endcut:1,middlecut:0,invert:!1},CIMGeometricEffectDashes:{customendingoffset:0,linedashending:"NoConstraint",offsetalongline:0},CIMGeometricEffectDonut:{method:"Mitered",option:"Accurate",width:2},CIMGeometricEffectJog:{angle:225,length:20,position:50},CIMGeometricEffectControlMeasureLine:{rule:"FullGeometry"},CIMGeometricEffectMove:{offsetx:1,offsety:-1},CIMGeometricEffectOffset:{method:"Square",offset:1,option:"Fast"},CIMGeometricEffectRotate:{angle:15},CIMGeometricEffectScale:{xscalefactor:1.15,yscalefactor:1.15},CIMGeometricEffectWave:{amplitude:2,period:3,seed:1,waveform:"Sinus"},CIMMarkerPlacementAlongLine:{customendingoffset:0,endings:"WithHalfGap",offsetalongline:0,placeperpart:!0,angletoline:!0,offset:0},CIMMarkerPlacementAtExtremities:{extremityplacement:"Both",offsetalongline:0,angletoline:!0,offset:0},CIMMarkerPlacementAtRatioPositions:{beginposition:0,endposition:0,flipfirst:!0,angletoline:!0,offset:0},CIMMarkerPlacementInsidePolygon:{gridangle:0,gridtype:"Fixed",offsetx:0,offsety:0,randomness:100,seed:0,shiftoddrows:!1,stepx:16,stepy:16,clipping:"ClipAtBoundary"},CIMMarkerPlacementOnLine:{relativeto:"LineMiddle",startpointoffset:0,angletoline:!0,offset:0},CIMMarkerPlacementOnVertices:{placeperpart:!0,placeoncontrolpoints:!0,placeonendpoints:!0,placeonregularvertices:!0,angletoline:!0,offset:0},CIMMarkerPlacementPolygonCenter:{method:"OnPolygon",offsetx:0,offsety:0,clipatboundary:!1},CIMAnimatedSymbolProperties:{playanimation:!1,reverseanimation:!1,randomizestarttime:!1,randomizestartseed:0,starttimeoffset:0,duration:3,endingduration:3,useendingduration:!1,repeattype:"Loop",repeatdelay:0}}},63514:function(e,t,r){r.d(t,{N:function(){return i}});class i{static local(){return null===i.instance&&(i.instance=new i),i.instance}execute(e,t,r,i,s){return new n(e,t,r)}}i.instance=null;class n{constructor(e,t,r){this._inputGeometries=e,this._angleTolerance=void 0!==t.angleTolerance?t.angleTolerance:120,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let e=this._inputGeometries.next();for(;e;){if("esriGeometryPolygon"===e.geometryType)this._isClosed=!0;else if("esriGeometryPolyline"===e.geometryType)this._isClosed=!1;else{if("esriGeometryEnvelope"!==e.geometryType){e=this._inputGeometries.next();continue}if(this._maxCosAngle)return e;this._isClosed=!0}for(;e.nextPath();)this._processPath(e);return e.reset(),e}return null}_processPath(e){if(e.nextPoint()){const t=e.x,r=e.y;let i=t,n=r,s=e.pathSize,o=0,a=0,l=0,c=0,u=0,h=0;this._isClosed&&++s;for(let d=1;e.nextPoint()||d<s;++d){let p,f;this._isClosed&&d===s-1?(p=t,f=r):(p=e.x,f=e.y);const m=p-i,g=f-n,y=Math.sqrt(m*m+g*g);d>1&&y>0&&l>0&&(o*m+a*g)/y/l<=this._maxCosAngle&&e.setControlPointAt(d-1),1===d&&(c=m,u=g,h=y),y>0&&(i=p,n=f,o=m,a=g,l=y)}this._isClosed&&l>0&&h>0&&(o*c+a*u)/h/l<=this._maxCosAngle&&e.setControlPointAt(0)}}}},82112:function(e,t,r){r.d(t,{B:function(){return u}});var i=r(33134),n=r(49077),s=r(23454),o=r(93996),a=r(33389);const l=1.7320508075688772,c=a.oF.OpenEnded;class u{static local(){return null===u.instance&&(u.instance=new u),u.instance}execute(e,t,r,i,n){return new h(e,t,r)}}u.instance=null;class h extends s.rx{constructor(e,t,r){super(e,!1,!0),this._curveHelper=new o.I,this._width=(void 0!==t.width?t.width:5)*r,this._arrowType=void 0!==t.geometricEffectArrowType?t.geometricEffectArrowType:void 0!==t.arrowType?t.arrowType:c,this._offsetFlattenError=o.U*r}processPath(e){const t=i.z.createEmptyOptimizedCIM(e.geometryType);switch(this._arrowType){case a.oF.OpenEnded:default:this._constructSimpleArrow(t,e,!0);break;case a.oF.Block:this._constructSimpleArrow(t,e,!1);break;case a.oF.Crossed:this._constructCrossedArrow(t,e)}return t}_constructSimpleArrow(e,t,r){const i=t.pathLength();let s=this._width;i<2*s&&(s=i/2);const o=this._curveHelper.getSubCurve(t,0,i-s);if(!o||!o.nextPath())return;o.seekPathStart();const a=s/2;if(this._curveHelper.isEmpty(o))return;const l=(0,n.A)(o),c=this._constructOffset(l,-a);if(!c)return;const u=this._constructOffset(l,a);if(!u)return;const h=this._constructArrowBasePoint(c,-a/2);if(!h)return;const d=this._constructArrowBasePoint(u,a/2);if(!d)return;t.seekInPath(t.pathSize-1);const p=[t.x,t.y];e.pushPath(u),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(d),e.nextPoint(),e.setControlPoint(),e.pushPoint(p),e.nextPoint(),e.setControlPoint(),e.pushPoint(h),e.nextPoint(),e.setControlPoint(),e.pushPoints(c.reverse()),e.setControlPoint(),r||(e.setControlPointAt(0),e.setControlPointAt(e.pathSize-1),e.pushPoint(u[0])),e.reset()}_constructCrossedArrow(e,t){const r=t.pathLength();let i=this._width;r<i*(1+l+1)&&(i=r/(1+l+1)),t.seekPathStart();const s=this._curveHelper.getSubCurve(t,0,r-i*(1+l));if(!s)return;s.nextPath();const o=i/2;if(this._curveHelper.isEmpty(s))return;const a=(0,n.A)(s),c=this._constructOffset(a,o);if(!c)return;const u=this._constructOffset(a,-o);if(!u)return;const h=this._curveHelper.getSubCurve(t,0,r-i);if(!h)return;if(h.nextPath(),this._curveHelper.isEmpty(h))return;const d=(0,n.A)(h),p=this._constructOffset(d,o);if(!p)return;const f=this._constructOffset(d,-o);if(!f)return;const m=p[p.length-1],g=this._constructArrowBasePoint(p,o/2);if(!g)return;const y=f[f.length-1],_=this._constructArrowBasePoint(f,-o/2);if(!_)return;t.seekInPath(t.pathSize-1);const v=[t.x,t.y];e.pushPath(c),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(y),e.nextPoint(),e.setControlPoint(),e.pushPoint(_),e.nextPoint(),e.setControlPoint(),e.pushPoint(v),e.nextPoint(),e.setControlPoint(),e.pushPoint(g),e.nextPoint(),e.setControlPoint(),e.pushPoint(m),e.nextPoint(),e.setControlPoint(),e.pushPoints(u.reverse()),e.nextPoint(),e.setControlPoint(),e.reset()}_constructOffset(e,t){return this._curveHelper.offset(e,t,a.xw.Rounded,4,this._offsetFlattenError)}_constructArrowBasePoint(e,t){if(!e||e.length<2)return null;const r=e[e.length-2],i=e[e.length-1],n=[i[0]-r[0],i[1]-r[1]];return this._curveHelper.normalize(n),[i[0]+n[1]*t,i[1]-n[0]*t]}}},20391:function(e,t,r){r.d(t,{s:function(){return c}}),r(50917);var i=r(33134),n=r(49077),s=r(62096),o=r(93996),a=r(33389),l=r(57165);class c{static local(){return null===c.instance&&(c.instance=new c),c.instance}execute(e,t,r,i,n,s){return new u(e,t,r,i,n,s)}}c.instance=null;class u{constructor(e,t,r,i,n,s){this._inputGeometries=e,this._tileKey=i,this._geometryEngine=n,this._curveHelper=new o.I,this._size=(void 0!==t.size?t.size:1)*r,this._maxInflateSize=s*r,this._offsetFlattenError=o.U*r}next(){let e;for(;e=this._inputGeometries.next();){if(0===this._size)return e;if("esriGeometryEnvelope"===e.geometryType)if(this._size>0){const t=i.z.createEmptyOptimizedCIM(e.geometryType),r=(0,n.x)(e)[0],s=this._curveHelper.offset(r,this._size,a.xw.Rounded,4,this._offsetFlattenError);if(s)return t.pushPath(s),t}else if(this._size<0){const t=e.asJSON();if(Math.min(t.xmax-t.xmin,t.ymax-t.ymin)+2*this._size>0)return i.z.fromJSONCIM({xmin:t.xmin-this._size,xmax:t.xmax+this._size,ymin:t.ymin-this._size,ymax:t.ymax+this._size})}const t=this._geometryEngine;if(null==t)return null;const r=this._tileKey?(0,s.q)(e,this._maxInflateSize):e;if(!r)continue;const o=t.buffer(l.A.WebMercator,r.asJSON(),this._size,1);return o?i.z.fromJSONCIM(o):null}return null}}},11672:function(e,t,r){r.d(t,{v:function(){return a}});var i=r(33134),n=r(49077),s=r(23454),o=r(33389);class a{static local(){return null===a.instance&&(a.instance=new a),a.instance}execute(e,t,r,i,n){return new l(e,t,r)}}a.instance=null;class l{constructor(e,t,r){this._defaultPointSize=20,this._inputGeometries=e,this._geomUnitsPerPoint=r,this._rule=t.rule??o.uQ.FullGeometry,this._defaultSize=this._defaultPointSize*r}next(){let e;for(;e=this._inputGeometries.next();){const t=this._processGeom((0,n.x)(e));if(t?.length)return i.z.fromJSONCIM({paths:t})}return null}_clone(e){return[e[0],e[1]]}_mid(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}_mix(e,t,r,i){return[e[0]*t+r[0]*i,e[1]*t+r[1]*i]}_add(e,t){return[e[0]+t[0],e[1]+t[1]]}_add2(e,t,r){return[e[0]+t,e[1]+r]}_sub(e,t){return[e[0]-t[0],e[1]-t[1]]}_dist(e,t){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}_norm(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}_normalize(e,t=1){const r=t/this._norm(e);e[0]*=r,e[1]*=r}_leftPerpendicular(e){const t=-e[1],r=e[0];e[0]=t,e[1]=r}_leftPerp(e){return[-e[1],e[0]]}_rightPerpendicular(e){const t=e[1],r=-e[0];e[0]=t,e[1]=r}_rightPerp(e){return[e[1],-e[0]]}_dotProduct(e,t){return e[0]*t[0]+e[1]*t[1]}_crossProduct(e,t){return e[0]*t[1]-e[1]*t[0]}_rotateDirect(e,t,r){const i=e[0]*t-e[1]*r,n=e[0]*r+e[1]*t;e[0]=i,e[1]=n}_makeCtrlPt(e){const t=[e[0],e[1]];return(0,s.Aq)(t,1),t}_addAngledTicks(e,t,r,i){const n=this._sub(r,t);this._normalize(n);const s=this._crossProduct(n,this._sub(i,t));let o;o=s>0?this._rightPerp(n):this._leftPerp(n);const a=Math.abs(s)/2,l=[];l.push([t[0]+(o[0]-n[0])*a,t[1]+(o[1]-n[1])*a]),l.push(t),l.push(r),l.push([r[0]+(o[0]+n[0])*a,r[1]+(o[1]+n[1])*a]),e.push(l)}_addBezier2(e,t,r,i,n){if(0==n--)return void e.push(i);const s=this._mid(t,r),o=this._mid(r,i),a=this._mid(s,o);this._addBezier2(e,t,s,a,n),this._addBezier2(e,a,o,i,n)}_addBezier3(e,t,r,i,n,s){if(0==s--)return void e.push(n);const o=this._mid(t,r),a=this._mid(r,i),l=this._mid(i,n),c=this._mid(o,a),u=this._mid(a,l),h=this._mid(c,u);this._addBezier3(e,t,o,c,h,s),this._addBezier3(e,h,u,l,n,s)}_add90DegArc(e,t,r,i,n){const s=n??this._crossProduct(this._sub(r,t),this._sub(i,t))>0,o=this._mid(t,r),a=this._sub(o,t);s?this._leftPerpendicular(a):this._rightPerpendicular(a),o[0]+=a[0],o[1]+=a[1],this._addBezier3(e,t,this._mix(t,.33333,o,.66667),this._mix(r,.33333,o,.66667),r,4)}_addArrow(e,t,r){const i=t[0],n=t[1],s=t[t.length-1],o=this._sub(i,n),a=this._norm(o);this._normalize(o);const l=Math.abs(this._crossProduct(o,this._sub(s,n)));let c=this._dotProduct(o,this._sub(s,n));c<.05*a?c=.05*a:c>.95*a&&(c=.95*a);const u=.5*l,h=this._leftPerp(o),d=[n[0]+o[0]*c,n[1]+o[1]*c],p=t.length-1,f=[];f.push(r?[-h[0],-h[1]]:h);let m=[-o[0],-o[1]];for(let e=1;e<p-1;e++){const r=this._sub(t[e+1],t[e]);this._normalize(r);const i=this._dotProduct(r,m),n=this._crossProduct(r,m),s=Math.sqrt((1+i)/2),o=this._sub(r,m);this._normalize(o),o[0]/=s,o[1]/=s,f.push(n<0?[-o[0],-o[1]]:o),m=r}f.push(this._rightPerp(m));for(let r=f.length-1;r>0;r--)e.push([t[r][0]+f[r][0]*u,t[r][1]+f[r][1]*u]);e.push([d[0]+f[0][0]*u,d[1]+f[0][1]*u]),e.push([d[0]+f[0][0]*l,d[1]+f[0][1]*l]),e.push(i),e.push([d[0]-f[0][0]*l,d[1]-f[0][1]*l]),e.push([d[0]-f[0][0]*u,d[1]-f[0][1]*u]);for(let r=1;r<f.length;r++)e.push([t[r][0]-f[r][0]*u,t[r][1]-f[r][1]*u])}_cp2(e,t,r){return e.length>=2?e[1]:this._add2(e[0],t*this._defaultSize,r*this._defaultSize)}_cp3(e,t,r,i){if(e.length>=3)return e[2];const n=this._mix(e[0],1-r,t,r),s=this._sub(t,e[0]);return this._normalize(s),this._rightPerpendicular(s),[n[0]+s[0]*i*this._defaultSize,n[1]+s[1]*i*this._defaultSize]}_arrowPath(e){if(e.length>2)return e;const t=e[0],r=this._cp2(e,-4,0),i=this._sub(t,r);this._normalize(i);const n=this._rightPerp(i);return[t,r,[t[0]+(n[0]-i[0])*this._defaultSize,t[1]+(n[1]-i[1])*this._defaultSize]]}_arrowLastSeg(e){const t=e[0],r=this._cp2(e,-4,0);let i;if(e.length>=3)i=e[e.length-1];else{const e=this._sub(t,r);this._normalize(e);const n=this._rightPerp(e);i=[t[0]+(n[0]-e[0])*this._defaultSize,t[1]+(n[1]-e[1])*this._defaultSize]}return[r,i]}_processGeom(e){if(!e)return null;const t=[];for(const r of e){if(!r||0===r.length)continue;const e=r.length;let i=r[0];switch(this._rule){case o.uQ.PerpendicularFromFirstSegment:{const e=this._cp2(r,0,-1),n=this._cp3(r,e,.5,4),s=[];s.push(n),s.push(this._mid(i,e)),t.push(s);break}case o.uQ.ReversedFirstSegment:{const e=this._cp2(r,0,-1);t.push([e,i]);break}case o.uQ.PerpendicularToSecondSegment:{if(r.length<3)return[];const e=this._cp2(r,-4,1),n=this._cp3(r,e,.882353,-1.94),s=[];s.push(this._mid(e,n)),s.push(i),t.push(s);break}case o.uQ.SecondSegmentWithTicks:{if(r.length<3)return[];const e=this._cp2(r,-4,1),n=this._cp3(r,e,.882353,-1.94),s=this._sub(n,e);let o;o=this._crossProduct(s,this._sub(i,e))>0?this._rightPerp(s):this._leftPerp(s);const a=[];a.push([e[0]+(o[0]-s[0])/3,e[1]+(o[1]-s[1])/3]),a.push(e),a.push(n),a.push([n[0]+(o[0]+s[0])/3,n[1]+(o[1]+s[1])/3]),t.push(a);break}case o.uQ.DoublePerpendicular:{const e=this._cp2(r,0,-1),n=this._cp3(r,e,.5,3),s=this._mid(i,e),o=this._sub(s,n);this._normalize(o);const a=this._crossProduct(o,this._sub(i,n));this._leftPerpendicular(o);const l=[];l.push(i),l.push([n[0]+o[0]*a,n[1]+o[1]*a]),t.push(l);const c=[];c.push([n[0]-o[0]*a,n[1]-o[1]*a]),c.push(e),t.push(c);break}case o.uQ.OppositeToFirstSegment:{const e=this._cp2(r,0,-1),n=this._cp3(r,e,.5,3),s=this._mid(i,e),o=this._sub(s,n);this._normalize(o);const a=this._crossProduct(o,this._sub(i,n));this._leftPerpendicular(o);const l=[];l.push([n[0]+o[0]*a,n[1]+o[1]*a]),l.push([n[0]-o[0]*a,n[1]-o[1]*a]),t.push(l);break}case o.uQ.TriplePerpendicular:{const e=this._cp2(r,0,-1),n=this._cp3(r,e,.5,4),s=this._mid(i,e),o=this._sub(s,n);this._normalize(o);const a=this._crossProduct(o,this._sub(i,n));this._leftPerpendicular(o);const l=[];l.push([n[0]+o[0]*a*.8,n[1]+o[1]*a*.8]),l.push([s[0]+.8*(i[0]-s[0]),s[1]+.8*(i[1]-s[1])]),t.push(l),t.push([n,s]);const c=[];c.push([n[0]-o[0]*a*.8,n[1]-o[1]*a*.8]),c.push([s[0]+.8*(e[0]-s[0]),s[1]+.8*(e[1]-s[1])]),t.push(c);break}case o.uQ.HalfCircleFirstSegment:{const e=this._cp2(r,0,-1),n=this._cp3(r,e,.5,4),s=this._mid(i,e);let o=this._sub(e,i);const a=Math.cos(Math.PI/18),l=Math.sin(Math.PI/18),c=Math.sqrt((1+a)/2),u=Math.sqrt((1-a)/2),h=[];let d;this._crossProduct(o,this._sub(n,i))>0?(h.push(i),o=this._sub(i,s),d=e):(h.push(e),o=this._sub(e,s),d=i),this._rotateDirect(o,c,u),o[0]/=c,o[1]/=c;for(let e=1;e<=18;e++)h.push(this._add(s,o)),this._rotateDirect(o,a,l);h.push(d),t.push(h);break}case o.uQ.HalfCircleSecondSegment:{const e=this._cp2(r,0,-1),n=this._cp3(r,e,1,-1);let s=this._sub(i,e);this._normalize(s);const o=this._crossProduct(s,this._sub(n,e))/2;this._leftPerpendicular(s);const a=[e[0]+s[0]*o,e[1]+s[1]*o];s=this._sub(e,a);const l=Math.cos(Math.PI/18);let c=Math.sin(Math.PI/18);o>0&&(c=-c);const u=[e];for(let e=1;e<=18;e++)this._rotateDirect(s,l,c),u.push(this._add(a,s));t.push(u);break}case o.uQ.HalfCircleExtended:{const n=this._cp2(r,0,-2),s=this._cp3(r,n,1,-1);let o;if(e>=4)o=r[3];else{const e=this._sub(i,n);o=this._add(s,e)}const a=this._dist(n,s)/2/.75,l=this._sub(n,i);this._normalize(l,a);const c=this._sub(s,o);this._normalize(c,a);const u=[o,s];t.push(u);const h=[this._clone(s)];this._addBezier3(h,s,this._add(s,c),this._add(n,l),n,4),h.push(i),t.push(h);break}case o.uQ.OpenCircle:{const e=this._cp2(r,-2,0),n=this._sub(e,i),s=Math.cos(Math.PI/18),o=-Math.sin(Math.PI/18),a=[e];for(let e=1;e<=33;e++)this._rotateDirect(n,s,o),a.push(this._add(i,n));t.push(a);break}case o.uQ.CoverageEdgesWithTicks:{const n=this._cp2(r,0,-1);let s,o;if(e>=3)s=r[2];else{const e=this._sub(n,i),t=this._leftPerp(e);s=[i[0]+t[0]-.25*e[0],i[1]+t[1]-.25*e[1]]}if(e>=4)o=r[3];else{const e=this._mid(i,n),t=this._sub(i,n);this._normalize(t),this._leftPerpendicular(t);const r=this._crossProduct(t,this._sub(s,e));this._rightPerpendicular(t),o=[s[0]+t[0]*r*2,s[1]+t[1]*r*2]}const a=this._sub(n,i);let l,c;l=this._crossProduct(a,this._sub(s,i))>0?this._rightPerp(a):this._leftPerp(a),c=[],c.push(s),c.push(i),c.push([i[0]+(l[0]-a[0])/3,i[1]+(l[1]-a[1])/3]),t.push(c),l=this._crossProduct(a,this._sub(o,n))>0?this._rightPerp(a):this._leftPerp(a),c=[],c.push([n[0]+(l[0]+a[0])/3,n[1]+(l[1]+a[1])/3]),c.push(n),c.push(o),t.push(c);break}case o.uQ.GapExtentWithDoubleTicks:{const n=this._cp2(r,0,2),s=this._cp3(r,n,0,1);let o;if(e>=4)o=r[3];else{const e=this._sub(n,i);o=this._add(s,e)}this._addAngledTicks(t,i,n,this._mid(s,o)),this._addAngledTicks(t,s,o,this._mid(i,n));break}case o.uQ.GapExtentMidline:{const n=this._cp2(r,2,0),s=this._cp3(r,n,0,1);let o;if(e>=4)o=r[3];else{const e=this._sub(n,i);o=this._add(s,e)}const a=[];a.push(this._mid(i,s)),a.push(this._mid(n,o)),t.push(a);break}case o.uQ.Chevron:{const n=this._cp2(r,-1,-1);let s;if(e>=3)s=r[2];else{const e=this._sub(n,i);this._leftPerpendicular(e),s=this._add(i,e)}t.push([n,this._makeCtrlPt(i),s]);break}case o.uQ.PerpendicularWithArc:{const n=this._cp2(r,0,-2),s=this._cp3(r,n,.5,-1),o=this._sub(n,i),a=this._norm(o);o[0]/=a,o[1]/=a;const l=this._crossProduct(o,this._sub(s,i));let c=this._dotProduct(o,this._sub(s,i));c<.05*a?c=.05*a:c>.95*a&&(c=.95*a);const u=[i[0]+o[0]*c,i[1]+o[1]*c];let h=this._leftPerp(o),d=[];if(d.push([u[0]-h[0]*l,u[1]-h[1]*l]),d.push([u[0]+h[0]*l,u[1]+h[1]*l]),t.push(d),e>=4){const e=r[3];let n=this._dotProduct(o,this._sub(e,i));n<.1*a?n=.1*a:n>.9*a&&(n=.9*a);const s=[i[0]+o[0]*n,i[1]+o[1]*n],l=this._crossProduct(o,this._sub(e,i)),c=[];c.push([s[0]-h[0]*l,s[1]-h[1]*l]),c.push([s[0]+h[0]*l,s[1]+h[1]*l]),t.push(c)}const p=[n[0]+h[0]*l,n[1]+h[1]*l];h=this._sub(n,p);const f=Math.cos(Math.PI/18);let m=Math.sin(Math.PI/18);l<0&&(m=-m),d=[i,n];for(let e=1;e<=9;e++)this._rotateDirect(h,f,m),d.push(this._add(p,h));t.push(d);break}case o.uQ.ClosedHalfCircle:{const e=this._cp2(r,2,0),n=this._mid(i,e),s=this._sub(e,n),o=Math.cos(Math.PI/18),a=Math.sin(Math.PI/18),l=[i,e];for(let e=1;e<=18;e++)this._rotateDirect(s,o,a),l.push(this._add(n,s));t.push(l);break}case o.uQ.TripleParallelExtended:{const e=this._cp2(r,0,-2),n=this._cp3(r,e,1,-2),o=this._mid(i,e),a=this._sub(n,e);this._normalize(a);const l=Math.abs(this._crossProduct(a,this._sub(o,e)))/2,c=this._dist(e,n),u=[e,i];u.push([i[0]+a[0]*c*.5,i[1]+a[1]*c*.5]),t.push(u);const h=[];h.push([o[0]-a[0]*l,o[1]-a[1]*l]),h.push([o[0]+a[0]*c*.375,o[1]+a[1]*c*.375]),(0,s.Aq)(h[h.length-1],1),h.push([o[0]+a[0]*c*.75,o[1]+a[1]*c*.75]),t.push(h);const d=[e,n];t.push(d);break}case o.uQ.ParallelWithTicks:{const e=this._cp2(r,3,0),n=this._cp3(r,e,.5,-1),s=this._sub(n,e);this._normalize(s);const o=this._crossProduct(s,this._sub(n,i));this._leftPerpendicular(s),this._addAngledTicks(t,i,e,n),this._addAngledTicks(t,this._mix(i,1,s,o),this._mix(e,1,s,o),this._mid(i,e));break}case o.uQ.Parallel:{const e=this._cp2(r,3,0),n=this._cp3(r,e,.5,-1),s=this._sub(e,i);this._normalize(s);const o=this._leftPerp(s),a=this._crossProduct(s,this._sub(n,i));let l=[i,e];t.push(l),l=[],l.push([i[0]+o[0]*a,i[1]+o[1]*a]),l.push([e[0]+o[0]*a,e[1]+o[1]*a]),t.push(l);break}case o.uQ.PerpendicularToFirstSegment:{const e=this._cp2(r,3,0),n=this._cp3(r,e,.5,-1),s=this._mid(i,e),o=this._sub(e,i);this._normalize(o);const a=this._crossProduct(o,this._sub(n,i));this._leftPerpendicular(o);const l=[];l.push([s[0]-o[0]*a*.25,s[1]-o[1]*a*.25]),l.push([s[0]+o[0]*a*1.25,s[1]+o[1]*a*1.25]),t.push(l);break}case o.uQ.ParallelOffset:{const e=this._cp2(r,3,0),n=this._cp3(r,e,.5,-1),s=this._sub(e,i);this._normalize(s);const o=this._crossProduct(s,this._sub(n,i));this._leftPerpendicular(s);const a=[];a.push([i[0]-s[0]*o,i[1]-s[1]*o]),a.push([e[0]-s[0]*o,e[1]-s[1]*o]),t.push(a);const l=[];l.push([i[0]+s[0]*o,i[1]+s[1]*o]),l.push([e[0]+s[0]*o,e[1]+s[1]*o]),t.push(l);break}case o.uQ.OffsetOpposite:{const e=this._cp2(r,3,0),n=this._cp3(r,e,.5,-1),s=this._sub(e,i);this._normalize(s);const o=this._crossProduct(s,this._sub(n,i));this._leftPerpendicular(s);const a=[];a.push([i[0]-s[0]*o,i[1]-s[1]*o]),a.push([e[0]-s[0]*o,e[1]-s[1]*o]),t.push(a);break}case o.uQ.OffsetSame:{const e=this._cp2(r,3,0),n=this._cp3(r,e,.5,-1),s=this._sub(e,i);this._normalize(s);const o=this._crossProduct(s,this._sub(n,i));this._leftPerpendicular(s);const a=[];a.push([i[0]+s[0]*o,i[1]+s[1]*o]),a.push([e[0]+s[0]*o,e[1]+s[1]*o]),t.push(a);break}case o.uQ.CircleWithArc:{let n=this._cp2(r,3,0);const o=this._cp3(r,n,.5,-1);let a,l;if(e>=4)a=r[3],l=this._crossProduct(this._sub(a,n),this._sub(o,n))>0;else{a=n,l=this._crossProduct(this._sub(a,i),this._sub(o,i))>0;const e=24*this._geomUnitsPerPoint,t=this._sub(a,i);this._normalize(t,e);const r=Math.sqrt(2)/2;this._rotateDirect(t,r,l?r:-r),n=this._add(i,t)}const c=this._sub(n,i),u=Math.cos(Math.PI/18),h=Math.sin(Math.PI/18),d=[n];for(let e=1;e<=36;e++)this._rotateDirect(c,u,h),d.push(this._add(i,c));this._add90DegArc(d,n,a,o,l),(0,s.Aq)(d[d.length-8],1),t.push(d);break}case o.uQ.DoubleJog:{let n,s=this._cp2(r,-3,1),o=this._cp3(r,s,-1,-.5);if(e>=4)n=r[3];else{const e=i;i=s,n=o;const t=this._dist(i,e),r=this._dist(n,e);let a=30*this._geomUnitsPerPoint;.5*t<a&&(a=.5*t),.5*r<a&&(a=.5*r),s=this._mix(i,a/t,e,(t-a)/t),o=this._mix(n,a/r,e,(r-a)/r)}const a=this._mid(i,s),l=this._mid(n,o),c=this._dist(i,s),u=this._dist(o,n);let h=Math.min(c,u)/8;h=Math.min(h,24*this._geomUnitsPerPoint);const d=Math.cos(Math.PI/4);let p=this._sub(i,s);this._normalize(p,h),this._crossProduct(p,this._sub(n,s))>0?this._rotateDirect(p,d,-d):this._rotateDirect(p,d,d);let f=[];f.push(s),f.push(this._add(a,p)),f.push(this._sub(a,p)),f.push(i),t.push(f),p=this._sub(n,o),this._normalize(p,h),this._crossProduct(p,this._sub(i,o))<0?this._rotateDirect(p,d,d):this._rotateDirect(p,d,-d),f=[],f.push(o),f.push(this._add(l,p)),f.push(this._sub(l,p)),f.push(n),t.push(f);break}case o.uQ.PerpendicularOffset:{const e=this._cp2(r,-4,1),n=this._cp3(r,e,.882353,-1.94),s=this._sub(n,e);this._crossProduct(s,this._sub(i,e))>0?this._rightPerpendicular(s):this._leftPerpendicular(s);const o=[s[0]/8,s[1]/8],a=this._sub(this._mid(e,n),o);t.push([a,i]);break}case o.uQ.LineExcludingLastSegment:{const e=this._arrowPath(r),i=[];let n=e.length-2;for(;n--;)i.push(e[n]);t.push(i);break}case o.uQ.MultivertexArrow:{const e=this._arrowPath(r),i=[];this._addArrow(i,e,!1),t.push(i);break}case o.uQ.CrossedArrow:{const e=this._arrowPath(r),i=[];this._addArrow(i,e,!0),t.push(i);break}case o.uQ.ChevronArrow:{const[e,n]=this._arrowLastSeg(r),s=10*this._geomUnitsPerPoint,o=this._sub(i,e),a=this._norm(o);this._normalize(o);const l=this._crossProduct(o,this._sub(n,e));let c=this._dotProduct(o,this._sub(n,e));c<.05*a?c=.05*a:c>.95*a-s&&(c=.95*a-s);const u=[e[0]+o[0]*c,e[1]+o[1]*c],h=this._leftPerp(o),d=[];d.push([u[0]+h[0]*l+o[0]*s,u[1]+h[1]*l+o[1]*s]),d.push(i),d.push([u[0]-h[0]*l+o[0]*s,u[1]-h[1]*l+o[1]*s]),t.push(d);break}case o.uQ.ChevronArrowOffset:{const[e,n]=this._arrowLastSeg(r),s=this._sub(i,e),o=this._norm(s);this._normalize(s);const a=this._crossProduct(s,this._sub(n,e));let l=this._dotProduct(s,this._sub(n,e));l<.05*o?l=.05*o:l>.95*o&&(l=.95*o);const c=[e[0]+s[0]*l,e[1]+s[1]*l];this._leftPerpendicular(s);const u=[];u.push([c[0]+s[0]*a*.5,c[1]+s[1]*a*.5]),u.push(this._mid(c,i)),u.push([c[0]-s[0]*a*.5,c[1]-s[1]*a*.5]),t.push(u);break}case o.uQ.PartialFirstSegment:{const[e,n]=this._arrowLastSeg(r),s=this._sub(i,e),o=this._norm(s);this._normalize(s);let a=this._dotProduct(s,this._sub(n,e));a<.05*o?a=.05*o:a>.95*o&&(a=.95*o);const l=[e[0]+s[0]*a,e[1]+s[1]*a];t.push([e,l]);break}case o.uQ.Arch:{const e=this._cp2(r,0,-1),n=this._cp3(r,e,.5,1),s=this._sub(i,e),o=this._mix(n,1,s,.55),a=this._mix(n,1,s,-.55),l=[i];this._addBezier2(l,i,o,n,4),this._addBezier2(l,n,a,e,4),t.push(l);break}case o.uQ.CurvedParallelTicks:{const e=this._cp2(r,-4,1),n=this._cp3(r,e,.882353,-1.94),s=this._sub(n,e);this._crossProduct(s,this._sub(i,e))>0?this._rightPerpendicular(s):this._leftPerpendicular(s);const o=[s[0]/8,s[1]/8],a=this._sub(this._mid(e,n),o),l=this._sub(this._mix(e,.75,n,.25),o),c=this._sub(this._mix(e,.25,n,.75),o),u=[e];this._addBezier2(u,e,l,a,3),this._addBezier2(u,a,c,n,3),t.push(u);for(let e=0;e<8;e++){const r=u[2*e+1],i=[this._clone(r)];i.push(this._add(r,[s[0]/4,s[1]/4])),t.push(i)}break}case o.uQ.Arc90Degrees:{const e=this._cp2(r,0,-1),n=this._cp3(r,e,.5,1),s=[e];this._add90DegArc(s,e,i,n),t.push(s);break}case o.uQ.TipWithPerpendicularAndTicks:{const[e,n]=this._arrowLastSeg(r),s=10*this._geomUnitsPerPoint,o=this._sub(i,e),a=this._norm(o);this._normalize(o);let l=this._crossProduct(o,this._sub(n,e)),c=this._dotProduct(o,this._sub(n,e));c<.05*a?c=.05*a:c>.95*a-s&&(c=.95*a-s);const u=this._leftPerp(o),h=[i[0]-o[0]*s,i[1]-o[1]*s],d=.5*Math.max(a-c-s,s);l=Math.abs(l);const p=[];p.push([h[0]+u[0]*(l+d)-o[0]*d,h[1]+u[1]*(l+d)-o[1]*d]),p.push([h[0]+u[0]*l,h[1]+u[1]*l]),p.push([h[0]-u[0]*l,h[1]-u[1]*l]),p.push([h[0]-u[0]*(l+d)-o[0]*d,h[1]-u[1]*(l+d)-o[1]*d]),t.push(p),t.push([h,i]);break}case o.uQ.FullGeometry:default:t.push(r)}}return t}}},12281:function(e,t,r){r.d(t,{y:function(){return o}});var i=r(33134),n=r(23454),s=r(93996);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,r,i,n){return new a(e,t,r)}}o.instance=null;class a extends n.rx{constructor(e,t,r){super(e,!0,!0),this._curveHelper=new s.I,this._beginCut=(void 0!==t.beginCut?t.beginCut:1)*r,this._endCut=(void 0!==t.endCut?t.endCut:1)*r,this._middleCut=(void 0!==t.middleCut?t.middleCut:0)*r,this._invert=void 0!==t.invert&&t.invert,this._beginCut<0&&(this._beginCut=0),this._endCut<0&&(this._endCut=0),this._middleCut<0&&(this._middleCut=0)}processPath(e){const{_beginCut:t,_endCut:r,_middleCut:n}=this,s=e.pathLength(),o=i.z.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._invert){if(0!==t||0!==r||0!==n)if(t+r+n>=s)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else this._curveHelper.appendSubCurve(o,e,0,t),this._curveHelper.appendSubCurve(o,e,.5*(s-n),.5*(s+n)),this._curveHelper.appendSubCurve(o,e,s-r,r)}else if(0===t&&0===r&&0===n)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else t+r+n<s&&(0===n?this._curveHelper.appendSubCurve(o,e,t,s-r):(this._curveHelper.appendSubCurve(o,e,t,.5*(s-n)),this._curveHelper.appendSubCurve(o,e,.5*(s+n),s-r)));return 0===o.totalSize?null:o}}},2969:function(e,t,r){r.d(t,{I:function(){return u}});var i=r(33134),n=r(49077),s=r(38441),o=r(23454),a=r(33389),l=r(65661),c=r(7590);class u{static local(){return null===u.instance&&(u.instance=new u),u.instance}execute(e,t,r,i,n){return new h(e,t,r,i)}}u.instance=null;class h extends o.rx{constructor(e,t,r,i){super(e,!0,!0),this._firstCurve=null,this._walker=new l.Z1,this._walker.updateTolerance(r),this._endings=t.lineDashEnding,this._customDashPos=-(t.offsetAlongLine??0)*r,this._offsetAtEnd=(t.customEndingOffset??0)*r,this._tileKey=i;let n=(0,c.K3)(t).dashTemplate;null==n&&(n=[]),n.length%2&&(n=[...n,...n]);let s=0;for(let e=0;e<n.length;e++){let t=Math.abs(n[e]);t<1e-7&&(t=1e-7),s+=t}this._patternLength=s,this._numOfDashesPerPattern=n.length/2,this._pattern=new l.VA,this._pattern.init(n,!0),this._pattern.scale(r)}processPath(e){if(0===this._pattern.length()){this.iteratePath=!1;const t=(0,n.A)(e);return i.z.fromJSONCIM({paths:[t]})}if(!this.iteratePath){let t=!0;switch(this._endings){case a.yS.HalfPattern:case a.yS.HalfGap:default:this._pattern.extPtGap=0;break;case a.yS.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case a.yS.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case a.yS.NoConstraint:this.isClosed||(t=!1);break;case a.yS.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}const r=e.pathLength();if(this._pattern.isEmpty()||r<.1*this._pattern.length()){const t=(0,n.A)(e);return i.z.fromJSONCIM({paths:[t]})}if(!this._walker.init(e,this._pattern,t)){const t=(0,n.A)(e);return i.z.fromJSONCIM({paths:[t]})}}let t;if(this.iteratePath)t=this._pattern.nextValue();else{let e;switch(this._endings){case a.yS.HalfPattern:default:e=.5*this._pattern.firstValue();break;case a.yS.HalfGap:e=.5*-this._pattern.lastValue();break;case a.yS.FullGap:e=-this._pattern.lastValue();break;case a.yS.FullPattern:e=0;break;case a.yS.NoConstraint:case a.yS.Custom:e=-this._customDashPos}let r=e/this._pattern.length();r-=Math.floor(r),e=r*this._pattern.length(),this._pattern.reset(),t=this._pattern.nextValue();let i=!1;for(;e>=t;)e-=t,t=this._pattern.nextValue(),i=!i;t-=e,i?(this._walker.nextPosition(t),t=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(t),t=this._pattern.nextValue(),this._walker.nextPosition(t),t=this._pattern.nextValue())}let r=this._walker.nextCurve(t);if(r)if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)r.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else t=this._pattern.nextValue(),!this._walker.nextPosition(t)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(r.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,r=this._firstCurve,this._firstCurve=null;return r?.reset(),r}isClippingRequired(e){const t=(0,n.x)(e);let r=0;for(const e of t)r+=(0,s.Yl)(e);return Math.round(this._numOfDashesPerPattern*(r/this._patternLength))>1e3}}},7889:function(e,t,r){r.d(t,{O:function(){return a}}),r(50917);var i=r(33134),n=r(62096),s=r(33389),o=r(57165);class a{static local(){return null===a.instance&&(a.instance=new a),a.instance}execute(e,t,r,i,n,s){return new l(e,t,r,i,n,s)}}a.instance=null;class l{constructor(e,t,r,i,n,o){switch(this._inputGeometries=e,this._tileKey=i,this._geometryEngine=n,this._maxInflateSize=o*r,this._width=(void 0!==t.width?t.width:2)*r,t.method){case s.M1.Mitered:case s.M1.Bevelled:case s.M1.Rounded:case s.M1.TrueBuffer:case s.M1.Square:}this._option=t.option}next(){let e;for(;e=this._inputGeometries.next();){if("esriGeometryEnvelope"===e.geometryType&&this._width>0){const t=e.asJSON();return Math.min(t.xmax-t.xmin,t.ymax-t.ymin)-2*this._width<0?e:i.z.fromJSONCIM({paths:[[[t.xmin+this._width,t.ymin+this._width],[t.xmax-this._width,t.ymin+this._width],[t.xmax-this._width,t.ymax-this._width],[t.xmin+this._width,t.ymax-this._width],[t.xmin+this._width,t.ymin+this._width]],[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]})}if("esriGeometryPolygon"===e.geometryType){if(0===this._width)return e.clone();const t=this._geometryEngine;if(null==t)return null;const r=this._tileKey?(0,n.q)(e,this._maxInflateSize):e.clone();if(!r)continue;const i=t.buffer(o.A.WebMercator,r.asJSON(),-this._width,1);if(i)for(const e of i.rings)if(e){r.startPath();for(const t of e.reverse())r.pushXY(t[0],r.yFactor*t[1])}return r}}return null}}},48645:function(e,t,r){r.d(t,{U:function(){return o}});var i=r(33134),n=r(23454),s=r(93996);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,r,i,n){return new a(e,t,r)}}o.instance=null;class a extends n.rx{constructor(e,t,r){super(e,!1,!0),this._curveHelper=new s.I,this._length=(void 0!==t.length?t.length:20)*r,this._angle=void 0!==t.angle?t.angle:225,this._position=void 0!==t.position?t.position:50,this._length<0&&(this._length=-this._length),this._position<20&&(this._position=20),this._position>80&&(this._position=80),this._mirror=!1}processPath(e){const t=i.z.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._curveHelper.isEmpty(e))return null;e.seekInPath(0);const r=e.x,n=e.y;e.seekInPath(e.pathSize-1);const s=e.x,o=e.y,a=[s-r,o-n];this._curveHelper.normalize(a);const l=r+(s-r)*this._position/100,c=n+(o-n)*this._position/100,u=Math.cos((90-this._angle)/180*Math.PI);let h=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(h=-h),this._mirror=!this._mirror;const d=[l-this._length/2*u,c-this._length/2*h],p=[l+this._length/2*u,c+this._length/2*h];return t.pushPath([[r,n],d,p,[s,o]]),t}}},7088:function(e,t,r){r.d(t,{V:function(){return i}});class i{static local(){return null===i.instance&&(i.instance=new i),i.instance}execute(e,t,r,i,s){return new n(e,t,r)}}i.instance=null;class n{constructor(e,t,r){this._inputGeometries=e,this._offsetX=void 0!==t.offsetX?t.offsetX*r:0,this._offsetY=void 0!==t.offsetY?t.offsetY*r:0}next(){let e=this._inputGeometries.next();for(;e;){if(e.totalSize>0)return this._move(e.clone(),this._offsetX,this._offsetY);e=this._inputGeometries.next()}return null}_move(e,t,r){for(;e.nextPath();)for(;e.nextPoint();)e.x=e.x+t,e.y=e.y+r;return e.reset(),e}}},17706:function(e,t,r){r.d(t,{V:function(){return u}}),r(50917);var i=r(33134),n=r(49077),s=r(74697),o=r(62096),a=r(93996),l=r(33389),c=r(57165);class u{static local(){return null===u.instance&&(u.instance=new u),u.instance}execute(e,t,r,i,n,s){return new h(e,t,r,i,n,s)}}u.instance=null;class h{constructor(e,t,r,i,n,s){this._inputGeometries=e,this._tileKey=i,this._geometryEngine=n,this._curveHelper=new a.I,this._offset=(t.offset??1)*r,this._method=t.method,this._maxInflateSize=Math.max(Math.abs(s*r),10),this._option=t.option,this._offsetFlattenError=a.U*r}next(){let e;for(;e=this._inputGeometries.next();){if(0===this._offset)return e.clone();if("esriGeometryEnvelope"===e.geometryType){if(this._method===l.xw.Rounded&&this._offset>0){const t=(0,n.A)(e),r=this._curveHelper.offset(t,-this._offset,this._method,4,this._offsetFlattenError);if(r){const t=i.z.createEmptyOptimizedCIM(e.geometryType);return t.pushPath(r),t}return null}const t=e.asJSON();if((0,s.ZC)(t)&&Math.min(t.xmax-t.xmin,t.ymax-t.ymin)+2*this._offset>0)return i.z.fromJSONCIM({xmin:t.xmin-this._offset,xmax:t.xmax+this._offset,ymin:t.ymin-this._offset,ymax:t.ymax+this._offset})}const t=this._geometryEngine;if(null==t)continue;const r=this._tileKey?(0,o.q)(e,this._maxInflateSize):e.clone();if(!r)continue;const a=t.offset(c.A.WebMercator,r.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError);return a?i.z.fromJSONCIM(a):null}return null}}},10183:function(e,t,r){r.d(t,{C:function(){return i}});class i{static local(){return null===i.instance&&(i.instance=new i),i.instance}execute(e,t,r,i,s){return new n(e,t,r)}}i.instance=null;class n{constructor(e,t,r){this._inputGeometries=e,this._reverse=void 0===t.reverse||t.reverse}next(){let e=this._inputGeometries.next();for(;e;){if(!this._reverse)return e;if("esriGeometryPolyline"===e.geometryType)return s(e.clone());e=this._inputGeometries.next()}return null}}function s(e){for(;e.nextPath();)for(let t=0;t<e.pathSize/2;t++){e.seekInPath(t);const r=e.x,i=e.y;e.seekInPath(e.pathSize-t-1);const n=e.x,s=e.y;e.x=r,e.y=i,e.seekInPath(t),e.x=n,e.y=s}return e.reset(),e}},1646:function(e,t,r){r.d(t,{v:function(){return n}});var i=r(35068);class n{static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(e,t,r,i,n){return new s(e,t,r)}}n.instance=null;class s{constructor(e,t,r){this._inputGeometries=e,this._rotateAngle=void 0!==t.angle?t.angle*Math.PI/180:0}next(){let e=this._inputGeometries.next();for(;e;){if(0===this._rotateAngle||"esriGeometryPoint"===e.geometryType)return e;if(e.totalSize>0){const t=(0,i.z8)(e),r=(t[2]+t[0])/2,n=(t[3]+t[1])/2;return e.reset(),this._rotate(e.clone(),r,n)}e=this._inputGeometries.next()}return null}_rotate(e,t,r){const i=Math.cos(this._rotateAngle),n=Math.sin(this._rotateAngle);for(;e.nextPath();)for(;e.nextPoint();){const s=e.x-t,o=e.y-r;e.x=t+s*i-o*n,e.y=r+s*n+o*i}return e.reset(),e}}},79323:function(e,t,r){r.d(t,{W:function(){return n}});var i=r(35068);class n{static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(e,t,r,i,n){return new s(e,t,r)}}n.instance=null;class s{constructor(e,t,r){this._inputGeometries=e,this._xFactor=void 0!==t.xScaleFactor?t.xScaleFactor:1.15,this._yFactor=void 0!==t.yScaleFactor?t.yScaleFactor:1.15}next(){const e=this._inputGeometries.next();if(e){if(1===this._xFactor&&1===this._yFactor)return e;if("esriGeometryPoint"===e.geometryType)return e;if(e.totalSize>0){const t=(0,i.z8)(e),r=(t[2]+t[0])/2,n=(t[3]+t[1])/2;return e.reset(),this._scaleCursor(e.clone(),r,n)}}return null}_scaleCursor(e,t,r){for(;e.nextPath();)for(;e.nextPoint();)e.x=t+(e.x-t)*this._xFactor,e.y=r+(e.y-r)*this._yFactor;return e.reset(),e}}},34476:function(e,t,r){r.d(t,{l:function(){return o}});var i=r(33134),n=r(33389),s=r(65661);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,r,i,n){return new a(e,t,r)}}o.instance=null;class a{constructor(e,t,r){this._inputGeometries=e,this._height=(void 0!==t.amplitude?t.amplitude:2)*r,this._period=(void 0!==t.period?t.period:3)*r,this._style=t.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new s.VA,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new s.Z1,this._walker.updateTolerance(r)}next(){let e=this._inputGeometries.next();for(;e;){if(0===this._height||0===this._period)return e;const t=this._processGeom(e);if(t)return t;e=this._inputGeometries.next()}return null}_processGeom(e){const t=i.z.createEmptyOptimizedCIM(e.geometryType);for(;e.nextPath();){t.startPath();const r=e.pathLength();if(this._walker.init(e,this._pattern))switch(this._style){case n.WE.Sinus:default:this._constructCurve(t,r,!1);break;case n.WE.Square:this._constructSquare(t,r);break;case n.WE.Triangle:this._constructTriangle(t,r);break;case n.WE.Random:this._constructCurve(t,r,!0)}else for(;e.nextPoint();)t.pushXY(e.x,e.y)}return t}_constructCurve(e,t,r){let i=Math.round(t/this._period);0===i&&(i=1);const n=16*i+1,o=t/i,a=this._period/16,l=1/n,c=2*Math.PI*t/o,u=2*Math.PI*Math.random(),h=2*Math.PI*Math.random(),d=2*Math.PI*Math.random(),p=.75-Math.random()/2,f=.75-Math.random()/2,m=new s.ps;this._walker.curPointAndAngle(m),e.pushPoint(m.pt);let g=0;for(;;){if(!this._walker.nextPointAndAngle(a,m)){e.pushPoint(this._walker.getPathEnd());break}{const t=g;let i;if(g+=l,r){const e=this._height/2*(1+.3*Math.sin(p*c*t+u));i=e*Math.sin(c*t+h),i+=e*Math.sin(f*c*t+d),i/=2}else i=.5*this._height*Math.sin(.5*c*t);e.pushXY(m.pt[0]-i*m.sa,m.pt[1]+i*m.ca)}}}_constructSquare(e,t){Math.round(t/this._period);let r=!0;for(;;){let t=!1;if(this._walker.curPositionIsValid()){const i=new s.ps;this._walker.curPointAndAngle(i);const n=new s.ps;if(this._walker.nextPointAndAngle(this._period,n)){const o=new s.ps;this._walker.nextPointAndAngle(this._period,o)&&(r?(e.pushPoint(i.pt),r=!1):e.pushPoint(i.pt),e.pushXY(i.pt[0]-this._height/2*i.sa,i.pt[1]+this._height/2*i.ca),e.pushXY(n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca),e.pushXY(n.pt[0]+this._height/2*n.sa,n.pt[1]-this._height/2*n.ca),e.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca),t=!0)}}if(!t){e.pushPoint(this._walker.getPathEnd());break}}}_constructTriangle(e,t){Math.round(t/this._period);let r=!0;for(;;){let t=!1;if(this._walker.curPositionIsValid()){const i=new s.ps;this._walker.curPointAndAngle(i);const n=new s.ps;if(this._walker.nextPointAndAngle(this._period/2,n)){const o=new s.ps;this._walker.nextPointAndAngle(this._period,o)&&(this._walker.nextPosition(this._period/2)&&(r?(e.pushPoint(i.pt),r=!1):e.pushPoint(i.pt),e.pushXY(n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca),e.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca)),t=!0)}}if(!t){e.pushPoint(this._walker.getPathEnd());break}}}}},33389:function(e,t,r){var i,n,s,o,a,l,c,u,h,d,p,f,m,g,y,_,v,b,x,S,w,T,A,C,E,M,R,P,O,I,L,N,D,F,z,V,U,G,B,H,k,j,W,q,Z,$,Y,X,J,Q,K,ee,te,re,ie,ne,se,oe,ae,le,ce;r.d(t,{$2:function(){return a},C1:function(){return s},JO:function(){return n},M1:function(){return T},O$:function(){return se},Q1:function(){return $},TZ:function(){return _},WE:function(){return P},Y:function(){return c},YI:function(){return X},bj:function(){return u},e_:function(){return Z},f0:function(){return ne},fu:function(){return p},g7:function(){return h},ip:function(){return Y},mU:function(){return O},oF:function(){return S},uQ:function(){return w},uT:function(){return V},vG:function(){return ae},wd:function(){return H},xR:function(){return i},xn:function(){return v},xw:function(){return E},yS:function(){return U}}),function(e){e[e.BUTT=0]="BUTT",e[e.ROUND=1]="ROUND",e[e.SQUARE=2]="SQUARE",e[e.UNKNOWN=4]="UNKNOWN"}(i||(i={})),function(e){e[e.BEVEL=0]="BEVEL",e[e.ROUND=1]="ROUND",e[e.MITER=2]="MITER",e[e.UNKNOWN=4]="UNKNOWN"}(n||(n={})),function(e){e[e.SCREEN=0]="SCREEN",e[e.MAP=1]="MAP"}(s||(s={})),function(e){e[e.Tint=0]="Tint",e[e.Ignore=1]="Ignore",e[e.Multiply=99]="Multiply"}(o||(o={})),function(e){e.Both="Both",e.JustBegin="JustBegin",e.JustEnd="JustEnd",e.None="None"}(a||(a={})),function(e){e[e.Mosaic=0]="Mosaic",e[e.Centered=1]="Centered"}(l||(l={})),function(e){e[e.Normal=0]="Normal",e[e.Superscript=1]="Superscript",e[e.Subscript=2]="Subscript"}(c||(c={})),function(e){e[e.MSSymbol=0]="MSSymbol",e[e.Unicode=1]="Unicode"}(u||(u={})),function(e){e[e.Unspecified=0]="Unspecified",e[e.TrueType=1]="TrueType",e[e.PSOpenType=2]="PSOpenType",e[e.TTOpenType=3]="TTOpenType",e[e.Type1=4]="Type1"}(h||(h={})),function(e){e[e.Display=0]="Display",e[e.Map=1]="Map"}(d||(d={})),function(e){e.None="None",e.Loop="Loop",e.Oscillate="Oscillate"}(p||(p={})),function(e){e[e.Z=0]="Z",e[e.X=1]="X",e[e.Y=2]="Y"}(f||(f={})),function(e){e[e.XYZ=0]="XYZ",e[e.ZXY=1]="ZXY",e[e.YXZ=2]="YXZ"}(m||(m={})),function(e){e[e.Rectangle=0]="Rectangle",e[e.RoundedRectangle=1]="RoundedRectangle",e[e.Oval=2]="Oval"}(g||(g={})),function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.Screen=2]="Screen",e[e.Multiply=3]="Multiply",e[e.Add=4]="Add"}(y||(y={})),function(e){e[e.TTB=0]="TTB",e[e.RTL=1]="RTL",e[e.BTT=2]="BTT"}(_||(_={})),function(e){e[e.None=0]="None",e[e.SignPost=1]="SignPost",e[e.FaceNearPlane=2]="FaceNearPlane"}(v||(v={})),function(e){e[e.Float=0]="Float",e[e.String=1]="String",e[e.Boolean=2]="Boolean"}(b||(b={})),function(e){e[e.Intersect=0]="Intersect",e[e.Subtract=1]="Subtract"}(x||(x={})),function(e){e.OpenEnded="OpenEnded",e.Block="Block",e.Crossed="Crossed"}(S||(S={})),function(e){e.FullGeometry="FullGeometry",e.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",e.ReversedFirstSegment="ReversedFirstSegment",e.PerpendicularToSecondSegment="PerpendicularToSecondSegment",e.SecondSegmentWithTicks="SecondSegmentWithTicks",e.DoublePerpendicular="DoublePerpendicular",e.OppositeToFirstSegment="OppositeToFirstSegment",e.TriplePerpendicular="TriplePerpendicular",e.HalfCircleFirstSegment="HalfCircleFirstSegment",e.HalfCircleSecondSegment="HalfCircleSecondSegment",e.HalfCircleExtended="HalfCircleExtended",e.OpenCircle="OpenCircle",e.CoverageEdgesWithTicks="CoverageEdgesWithTicks",e.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",e.GapExtentMidline="GapExtentMidline",e.Chevron="Chevron",e.PerpendicularWithArc="PerpendicularWithArc",e.ClosedHalfCircle="ClosedHalfCircle",e.TripleParallelExtended="TripleParallelExtended",e.ParallelWithTicks="ParallelWithTicks",e.Parallel="Parallel",e.PerpendicularToFirstSegment="PerpendicularToFirstSegment",e.ParallelOffset="ParallelOffset",e.OffsetOpposite="OffsetOpposite",e.OffsetSame="OffsetSame",e.CircleWithArc="CircleWithArc",e.DoubleJog="DoubleJog",e.PerpendicularOffset="PerpendicularOffset",e.LineExcludingLastSegment="LineExcludingLastSegment",e.MultivertexArrow="MultivertexArrow",e.CrossedArrow="CrossedArrow",e.ChevronArrow="ChevronArrow",e.ChevronArrowOffset="ChevronArrowOffset",e.PartialFirstSegment="PartialFirstSegment",e.Arch="Arch",e.CurvedParallelTicks="CurvedParallelTicks",e.Arc90Degrees="Arc90Degrees",e.TipWithPerpendicularAndTicks="TipWithPerpendicularAndTicks"}(w||(w={})),function(e){e.Mitered="Mitered",e.Bevelled="Bevelled",e.Rounded="Rounded",e.Square="Square",e.TrueBuffer="TrueBuffer"}(T||(T={})),function(e){e.ClosePath="ClosePath",e.ConvexHull="ConvexHull",e.RectangularBox="RectangularBox"}(A||(A={})),function(e){e.BeginningOfLine="BeginningOfLine",e.EndOfLine="EndOfLine"}(C||(C={})),function(e){e.Mitered="Mitered",e.Bevelled="Bevelled",e.Rounded="Rounded",e.Square="Square"}(E||(E={})),function(e){e.Fast="Fast",e.Accurate="Accurate"}(M||(M={})),function(e){e.BeginningOfLine="BeginningOfLine",e.EndOfLine="EndOfLine"}(R||(R={})),function(e){e.Sinus="Sinus",e.Square="Square",e.Triangle="Triangle",e.Random="Random"}(P||(P={})),function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Force=2]="Force"}(O||(O={})),function(e){e[e.Buffered=0]="Buffered",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.AlongLine=3]="AlongLine"}(I||(I={})),function(e){e[e.Linear=0]="Linear",e[e.Rectangular=1]="Rectangular",e[e.Circular=2]="Circular",e[e.Buffered=3]="Buffered"}(L||(L={})),function(e){e[e.Discrete=0]="Discrete",e[e.Continuous=1]="Continuous"}(N||(N={})),function(e){e[e.AcrossLine=0]="AcrossLine",e[e.AloneLine=1]="AloneLine"}(D||(D={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Center=2]="Center",e[e.Justify=3]="Justify"}(F||(F={})),function(e){e[e.Base=0]="Base",e[e.MidPoint=1]="MidPoint",e[e.ThreePoint=2]="ThreePoint",e[e.FourPoint=3]="FourPoint",e[e.Underline=4]="Underline",e[e.CircularCW=5]="CircularCW",e[e.CircularCCW=6]="CircularCCW"}(z||(z={})),function(e){e.Butt="Butt",e.Round="Round",e.Square="Square"}(V||(V={})),function(e){e.NoConstraint="NoConstraint",e.HalfPattern="HalfPattern",e.HalfGap="HalfGap",e.FullPattern="FullPattern",e.FullGap="FullGap",e.Custom="Custom"}(U||(U={})),function(e){e[e.None=-1]="None",e[e.Custom=0]="Custom",e[e.Circle=1]="Circle",e[e.OpenArrow=2]="OpenArrow",e[e.ClosedArrow=3]="ClosedArrow",e[e.Diamond=4]="Diamond"}(G||(G={})),function(e){e[e.ExtraLeading=0]="ExtraLeading",e[e.Multiple=1]="Multiple",e[e.Exact=2]="Exact"}(B||(B={})),function(e){e.Bevel="Bevel",e.Round="Round",e.Miter="Miter"}(H||(H={})),function(e){e[e.Default=0]="Default",e[e.String=1]="String",e[e.Numeric=2]="Numeric"}(k||(k={})),function(e){e[e.InsidePolygon=0]="InsidePolygon",e[e.PolygonCenter=1]="PolygonCenter",e[e.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(j||(j={})),function(e){e[e.Tint=0]="Tint",e[e.Replace=1]="Replace",e[e.Multiply=2]="Multiply"}(W||(W={})),function(e){e[e.ClipAtBoundary=0]="ClipAtBoundary",e[e.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",e[e.DoNotTouchBoundary=2]="DoNotTouchBoundary",e[e.DoNotClip=3]="DoNotClip"}(q||(q={})),function(e){e.NoConstraint="NoConstraint",e.WithMarkers="WithMarkers",e.WithFullGap="WithFullGap",e.WithHalfGap="WithHalfGap",e.Custom="Custom"}(Z||(Z={})),function(e){e.Fixed="Fixed",e.Random="Random",e.RandomFixedQuantity="RandomFixedQuantity"}($||($={})),function(e){e.LineMiddle="LineMiddle",e.LineBeginning="LineBeginning",e.LineEnd="LineEnd",e.SegmentMidpoint="SegmentMidpoint"}(Y||(Y={})),function(e){e.OnPolygon="OnPolygon",e.CenterOfMass="CenterOfMass",e.BoundingBoxCenter="BoundingBoxCenter"}(X||(X={})),function(e){e[e.Low=0]="Low",e[e.Medium=1]="Medium",e[e.High=2]="High"}(J||(J={})),function(e){e[e.MarkerCenter=0]="MarkerCenter",e[e.MarkerBounds=1]="MarkerBounds"}(Q||(Q={})),function(e){e[e.None=0]="None",e[e.PropUniform=1]="PropUniform",e[e.PropNonuniform=2]="PropNonuniform",e[e.DifUniform=3]="DifUniform",e[e.DifNonuniform=4]="DifNonuniform"}(K||(K={})),function(e){e.Tube="Tube",e.Strip="Strip",e.Wall="Wall"}(ee||(ee={})),function(e){e[e.Random=0]="Random",e[e.Increasing=1]="Increasing",e[e.Decreasing=2]="Decreasing",e[e.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(te||(te={})),function(e){e[e.Relative=0]="Relative",e[e.Absolute=1]="Absolute"}(re||(re={})),function(e){e[e.Normal=0]="Normal",e[e.LowerCase=1]="LowerCase",e[e.Allcaps=2]="Allcaps"}(ie||(ie={})),function(e){e[e.LTR=0]="LTR",e[e.RTL=1]="RTL"}(ne||(ne={})),function(e){e.Draft="Draft",e.Picture="Picture",e.Text="Text"}(se||(se={})),function(e){e[e.Top=0]="Top",e[e.Center=1]="Center",e[e.Baseline=2]="Baseline",e[e.Bottom=3]="Bottom"}(oe||(oe={})),function(e){e[e.Right=0]="Right",e[e.Upright=1]="Upright"}(ae||(ae={})),function(e){e[e.Small=0]="Small",e[e.Medium=1]="Medium",e[e.Large=2]="Large"}(le||(le={})),function(e){e[e.Calm=0]="Calm",e[e.Rippled=1]="Rippled",e[e.Slight=2]="Slight",e[e.Moderate=3]="Moderate"}(ce||(ce={}))},31771:function(e,t,r){r.d(t,{e:function(){return o}});var i=r(23454),n=r(33389),s=r(65661);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,r,i,n){return new a(e,t,r)}}o.instance=null;class a extends i.pC{constructor(e,t,r){super(e),this._geometryWalker=new s.Z1,this._geometryWalker.updateTolerance(r),this._angleToLine=t.angleToLine??!0,this._offset=(t.offset?t.offset:0)*r,this._originalEndings=t.endings,this._offsetAtEnd=(t.customEndingOffset?t.customEndingOffset:0)*r,this._position=-(t.offsetAlongLine?t.offsetAlongLine:0)*r,this._pattern=new s.VA,this._pattern.init(t.placementTemplate,!1),this._pattern.scale(r),this._endings=this._originalEndings}processPath(e){if(this._pattern.isEmpty())return null;let t;if(this.iteratePath)t=this._pattern.nextValue();else{this._originalEndings===n.e_.WithFullGap&&this.isClosed?this._endings=n.e_.WithMarkers:this._endings=this._originalEndings,this._pattern.extPtGap=0;let r,i=!0;switch(this._endings){case n.e_.NoConstraint:r=-this._position,r=this._adjustPosition(r),i=!1;break;case n.e_.WithHalfGap:default:r=-this._pattern.lastValue()/2;break;case n.e_.WithFullGap:r=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case n.e_.WithMarkers:r=0;break;case n.e_.Custom:r=-this._position,r=this._adjustPosition(r),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(e,this._pattern,i))return null;this._pattern.reset();let s=0;for(;r>s;)r-=s,s=this._pattern.nextValue();s-=r,t=s,this.iteratePath=!0}const r=new s.ps;return this._geometryWalker.nextPointAndAngle(t,r)?this._endings===n.e_.WithFullGap&&this._geometryWalker.isPathEnd()?(this.iteratePath=!1,null):this._endings===n.e_.WithMarkers&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(r.pt[0]-this._offset*r.sa,r.pt[1]+this._offset*r.ca),this._angleToLine&&this.internalPlacement.setRotateCS(r.ca,r.sa),this.internalPlacement):(this.iteratePath=!1,null)}_adjustPosition(e){let t=e/this._pattern.length();return t-=Math.floor(t),t*this._pattern.length()}}},15987:function(e,t,r){r.d(t,{y:function(){return o}});var i=r(23454),n=r(93996),s=r(33389);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,r,i,n){return new a(e,t,r)}}o.instance=null;class a extends i.pC{constructor(e,t,r){super(e,!1,!0),this._curveHelper=new n.I,this._placePerPart=t.placePerPart??!1,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*r:0,this._type=t.extremityPlacement,this._position=void 0!==t.offsetAlongLine?t.offsetAlongLine*r:0,this._beginProcessed=!1}processMultiPath(e){return this._placePerPart?super.processMultiPath(e):this.processPath(e)}processPath(e){let t;switch(this._type){case s.$2.Both:default:this._beginProcessed?(t=this._atExtremities(e,this._position,!1),this._beginProcessed=!1,this.iterateMultiPath=!1,this.iteratePath=!1):(t=this._atExtremities(e,this._position,!0),this._beginProcessed=!0,this.iterateMultiPath=!0,this.iteratePath=!0);break;case s.$2.JustBegin:t=this._atExtremities(e,this._position,!0);break;case s.$2.JustEnd:t=this._atExtremities(e,this._position,!1);case s.$2.None:}return t}_atExtremities(e,t,r){if(this._placePerPart||(r?e.seekPath(0):e.seekPath(e.totalSize-1)),r||e.seekPathEnd(),r?e.nextPoint():e.prevPoint()){let i=0,[n,s]=[0,0],[o,a]=[e.x,e.y];for(;r?e.nextPoint():e.prevPoint();){n=o,s=a,o=e.x,a=e.y;const r=this._curveHelper.getLength(n,s,o,a);if(i+r>t){const e=(t-i)/r,[l,c]=this._curveHelper.getAngleCS(n,s,o,a,e),u=this._curveHelper.getCoord2D(n,s,o,a,e);return this.internalPlacement.setTranslate(u[0]-this._offset*c,u[1]+this._offset*l),this._angleToLine&&this.internalPlacement.setRotateCS(-l,-c),this.internalPlacement}i+=r}}return null}}},19511:function(e,t,r){r.d(t,{S:function(){return s}});var i=r(23454),n=r(65661);class s{static local(){return null===s.instance&&(s.instance=new s),s.instance}execute(e,t,r,i,n){return new o(e,t,r)}}s.instance=null;class o extends i.pC{constructor(e,t,r){super(e),this._walker=new n.Z1,this._walker.updateTolerance(r),this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*r:0,this._beginGap=void 0!==t.beginPosition?t.beginPosition*r:0,this._endGap=void 0!==t.endPosition?t.endPosition*r:0,this._flipFirst=void 0===t.flipFirst||t.flipFirst,this._pattern=new n.VA,this._pattern.init(t.positionArray,!1,!1),this._subPathLen=0,this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0}processPath(e){if(this._pattern.isEmpty())return null;let t;if(this.iteratePath){const e=this._pattern.nextValue()*this._subPathLen,r=this._beginGap+e;t=r-this._prevPos,this._prevPos=r}else{if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=e.pathLength()-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(e,this._pattern,!1))return null;this._pattern.reset();const r=this._pattern.nextValue()*this._subPathLen,i=this._beginGap+r;t=i-this._prevPos,this._prevPos=i,this.iteratePath=!0}const r=new n.ps;if(!this._walker.nextPointAndAngle(t,r,n.YQ.END))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(r.pt[0]-this._offset*r.sa,r.pt[1]+this._offset*r.ca);const i=this._isFirst&&this._flipFirst;let s,o;return this._angleToLine?(s=r.ca,o=r.sa):(s=1,o=0),i&&(s=-s,o=-o),this.internalPlacement.setRotateCS(s,o),this._isFirst=!1,this._posCount--,0===this._posCount&&(this.iteratePath=!1),this.internalPlacement}}},20305:function(e,t,r){r.d(t,{M:function(){return c}});var i=r(13798),n=r(29076),s=r(33389);const o=512,a=24,l=1e-6;class c{static local(){return null===c.instance&&(c.instance=new c),c.instance}execute(e,t,r,i,n){return new u(e,t,r,i,n)}}c.instance=null;class u{constructor(e,t,r,a,l){if(this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._accelerationMap=null,this._testInsidePolygon=!1,this._verticalSubdivision=!0,this._stepX=Math.abs(t.stepX??16)*r,this._stepY=Math.abs(t.stepY??16)*r,this._stepX=Math.round(128*this._stepX)/128,this._stepY=Math.round(128*this._stepY)/128,0!==this._stepX&&0!==this._stepY){if(this._gridType=t.gridType??s.Q1.Fixed,this._gridType===s.Q1.Random){const e=t.seed??13,r=1;this._randomLCG=new i.A(e*r),this._randomness=(t.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0,this._buildRandomValues()}else{if(this._randomness=0,this._gridAngle=t.gridAngle??0,this._shiftOddRows=t.shiftOddRows??!1,this._offsetX=(t.offsetX??0)*r,this._offsetY=(t.offsetY??0)*r,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}if(this._graphicOriginX=0,this._graphicOriginY=0,null!=a){const[e,t,r,i]=a.split("/"),n=parseFloat(e),s=parseFloat(t),l=parseFloat(r),c=parseFloat(i);this._graphicOriginX=-(c*2**n+l)*o,this._graphicOriginY=s*o,this._testInsidePolygon=!0}this._internalPlacement=new n.W,this._calculateMinMax(e),this._geometryCursor=e}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!u._randValues){u._randValues=[];for(let e=0;e<a;e++)for(let e=0;e<a;e++)u._randValues.push(this._randomLCG.getFloat()),u._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(e){let t,r,i,n,s,a,l,c,u,h,d,p,f,m;this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,l=c=f=d=Number.MAX_VALUE,u=h=m=p=-Number.MAX_VALUE;const g=1!==this._cosAngle;for(e.reset();e.nextPath();)for(;e.nextPoint();)a=e.x,s=e.y,t=a-this._graphicOriginX-this._offsetX,r=s-this._graphicOriginY-this._offsetY,g?(i=this._cosAngle*t-this._sinAngle*r,n=this._sinAngle*t+this._cosAngle*r):(i=t,n=r),l=Math.min(l,i),u=Math.max(u,i),c=Math.min(c,n),h=Math.max(h,n),d=Math.min(d,s),p=Math.max(p,s),f=Math.min(f,a),m=Math.max(m,a);d=d!==Number.MAX_VALUE?d:-o-this._stepY,p=p!==-Number.MAX_VALUE?p:this._stepY,f=f!==Number.MAX_VALUE?f:-this._stepX,m=m!==-Number.MAX_VALUE?m:o+this._stepX;const y=p-d,_=m-f;if(this._verticalSubdivision=y>=_,this._polygonMin=this._verticalSubdivision?d:f,this._testInsidePolygon){let e=0-this._graphicOriginX-this._offsetX-this._stepX,t=o-this._graphicOriginX-this._offsetX+this._stepX,r=-o-this._graphicOriginY-this._offsetY-this._stepY,i=0-this._graphicOriginY-this._offsetY+this._stepY;if(g){const n=[[e,r],[e,i],[t,r],[t,i]];e=r=Number.MAX_VALUE,t=i=-Number.MAX_VALUE;for(const s of n){const n=this._cosAngle*s[0]-this._sinAngle*s[1],o=this._sinAngle*s[0]+this._cosAngle*s[1];e=Math.min(e,n),t=Math.max(t,n),r=Math.min(r,o),i=Math.max(i,o)}}l=l!==Number.MAX_VALUE?Math.max(l,e):e,c=c!==Number.MAX_VALUE?Math.max(c,r):r,u=u!==-Number.MAX_VALUE?Math.min(u,t):t,h=h!==-Number.MAX_VALUE?Math.min(h,i):i}this._xMin=Math.round(l/this._stepX),this._xMax=Math.round(u/this._stepX),this._yMin=Math.round(c/this._stepY),this._yMax=Math.round(h/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1,this._buildAccelerationMap(e,f,m,d,p)}_buildAccelerationMap(e,t,r,i,n){e.reset();const s=new Map,a=this._verticalSubdivision,l=a?n-i:r-t;let c=Math.ceil(l/10);if(c<=1)return;const u=Math.floor(l/c);let d,p,f,m,g,y,_,v,b,x,S;for(c++,this._delta=u,a?(b=-o-2*this._stepY,x=2*this._stepY,S=i):(b=-2*this._stepX,x=o+2*this._stepX,S=t);e.nextPath();)if(!(e.pathSize<2)&&e.nextPoint())for(d=e.x,p=e.y;e.nextPoint();d=f,p=m){if(f=e.x,m=e.y,a){if(p===m||p<b&&m<b||p>x&&m>x)continue;g=Math.min(p,m),y=Math.max(p,m)}else{if(d===f||d<b&&f<b||d>x&&f>x)continue;g=Math.min(d,f),y=Math.max(d,f)}for(;g<y;)_=Math.floor((g-S)/u),h(_,d,p,f,m,s),g+=u;v=Math.floor((y-S)/u),v>_&&h(v,d,p,f,m,s)}this._accelerationMap=s}_nextInside(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--}let e=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(e+=.5*this._stepX);const t=this._currentY*this._stepY+this._offsetY;let r,i;if(this._currentX++,this._gridType===s.Q1.Random){const n=(this._currentX%a+a)%a,s=(this._currentY%a+a)%a;r=this._graphicOriginX+e+this._stepX*this._randomness*(.5-u._randValues[s*a+n])*2/3,i=this._graphicOriginY+t+this._stepY*this._randomness*(.5-u._randValues[s*a+n+1])*2/3}else r=this._graphicOriginX+this._cosAngle*e+this._sinAngle*t,i=this._graphicOriginY-this._sinAngle*e+this._cosAngle*t;if(!this._testInsidePolygon||this._isInsidePolygon(r,i,this._geometryCursor))return this._internalPlacement.setTranslate(r,i),this._internalPlacement}}_isInsidePolygon(e,t,r){if(null==this._accelerationMap)return function(e,t,r){let i,n,s,o,a=0;for(e+=l,t+=l,r.reset();r.nextPath();)if(r.nextPoint())for(i=r.x,n=r.y;r.nextPoint();i=s,n=o)s=r.x,o=r.y,n>t!=o>t&&((s-i)*(t-n)-(o-n)*(e-i)>0?a++:a--);return 0!==a}(e,t,r);e+=l,t+=l;const i=this._verticalSubdivision,n=i?t:e,s=Math.floor((n-this._polygonMin)/this._delta),o=this._accelerationMap.get(s);if(!o)return!1;let a,c,u,h=0;for(const r of o){if(a=r[0],c=r[1],i){if(a[1]>t==c[1]>t)continue;u=(c[0]-a[0])*(t-a[1])-(c[1]-a[1])*(e-a[0])}else{if(a[0]>e==c[0]>e)continue;u=(c[1]-a[1])*(e-a[0])-(c[0]-a[0])*(t-a[1])}u>0?h++:h--}return 0!==h}}function h(e,t,r,i,n,s){let o=s.get(e);o||(o=[],s.set(e,o)),o.push([[t,r],[i,n]])}},58892:function(e,t,r){r.d(t,{R:function(){return o}});var i=r(23454),n=r(93996),s=r(33389);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,r,i,n){return new a(e,t,r)}}o.instance=null;class a extends i.pC{constructor(e,t,r){super(e),this._curveHelper=new n.I,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*r:0,this._relativeTo=t.relativeTo,this._position=void 0!==t.startPointOffset?t.startPointOffset*r:0,this._epsilon=.001*r}processPath(e){const t=this._position;if(this._relativeTo===s.ip.SegmentMidpoint){if(this.iteratePath||(this.iteratePath=!0),e.nextPoint()){let[t,r]=[e.x,e.y],[i,n]=[0,0];for(;e.nextPoint();){i=e.x,n=e.y;const s=this._curveHelper.getLength(t,r,i,n);if(s<this._epsilon){t=i,r=n;continue}const o=.5+this._position/s,[a,l]=this._curveHelper.getAngleCS(t,r,i,n,o),c=this._curveHelper.getCoord2D(t,r,i,n,o);return this.internalPlacement.setTranslate(c[0]-this._offset*l,c[1]+this._offset*a),this._angleToLine&&this.internalPlacement.setRotateCS(a,l),this.internalPlacement}}return this.iteratePath=!1,null}const r=this._relativeTo===s.ip.LineEnd;return this.onLine(e,t,r)}onLine(e,t,r){let i,n=!1;switch(this._relativeTo){case s.ip.LineMiddle:default:e.seekPathStart(),i=e.pathLength()/2+t;break;case s.ip.LineBeginning:i=t;break;case s.ip.LineEnd:i=t,n=!0}r?e.seekPathEnd():e.seekPathStart();let o=0;if(r?e.prevPoint():e.nextPoint()){let[t,s]=[e.x,e.y],[a,l]=[0,0];for(;r?e.prevPoint():e.nextPoint();){a=e.x,l=e.y;const r=this._curveHelper.getLength(t,s,a,l);if(o+r>i){const e=(i-o)/r,[c,u]=this._curveHelper.getAngleCS(t,s,a,l,e),h=this._curveHelper.getCoord2D(t,s,a,l,e),d=n?-this._offset:this._offset;return this.internalPlacement.setTranslate(h[0]-d*u,h[1]+d*c),this._angleToLine&&(n?this.internalPlacement.setRotateCS(-c,-u):this.internalPlacement.setRotateCS(c,u)),this.internalPlacement}t=a,s=l,o+=r}}return null}}},80585:function(e,t,r){r.d(t,{A:function(){return s}});var i=r(23454),n=r(93996);class s{static local(){return null===s.instance&&(s.instance=new s),s.instance}execute(e,t,r,i,n){return new o(e,t,r)}}s.instance=null;class o extends i.pC{constructor(e,t,r){super(e),this._curveHelper=new n.I,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*r:0,this._endPoints=void 0===t.placeOnEndPoints||t.placeOnEndPoints,this._controlPoints=void 0===t.placeOnControlPoints||t.placeOnControlPoints,this._regularVertices=void 0===t.placeOnRegularVertices||t.placeOnRegularVertices,this._tags=[],this._tagIterator=0}processPath(e){if(this.iteratePath||(this._preparePath(e),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;const t=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(t[2]);let r=t[0],i=t[1];if(0!==this._offset){const e=Math.cos(t[2]),n=Math.sin(t[2]);r-=this._offset*n,i+=this._offset*e}return this.internalPlacement.setTranslate(r,i),this._tagIterator++,this.internalPlacement}_preparePath(e){this._tags.length=0,this._tagIterator=0,e.seekPathStart();const t=e.isClosed();let r=0,i=!1,n=0,s=0;if(e.seekPathStart(),e.nextPoint()){let o=e.x,l=e.y,c=e.getControlPoint(),u=!0,h=e.nextPoint();for(;h;){const d=e.x,p=e.y,f=e.getControlPoint();(this._angleToLine||0!==this._offset)&&(n=this._curveHelper.getAngle(o,l,d,p,0)),u?(u=!1,t?(r=n,i=c):(this._endPoints||this._controlPoints&&c)&&this._tags.push([o,l,n])):c?this._controlPoints&&this._tags.push([o,l,a(s,n)]):this._regularVertices&&this._tags.push([o,l,a(s,n)]),(this._angleToLine||0!==this._offset)&&(s=this._curveHelper.getAngle(o,l,d,p,1)),h=e.nextPoint(),h||(t?f||i?this._controlPoints&&this._tags.push([d,p,a(s,r)]):this._regularVertices&&this._tags.push([d,p,a(s,r)]):(this._endPoints||this._controlPoints&&f)&&this._tags.push([d,p,s])),o=d,l=p,c=f}}this._tagIterator=0}}function a(e,t){const r=Math.PI;for(;Math.abs(t-e)>r+2e-15;)t-e>r?t-=2*r:t+=2*r;return(e+t)/2}},58676:function(e,t,r){r.d(t,{L:function(){return l}});var i=r(35068),n=r(72228),s=r(30804),o=r(29076),a=r(33389);class l{static local(){return null===l.instance&&(l.instance=new l),l.instance}execute(e,t,r,i,n){return new c(e,t,r)}}l.instance=null;class c{constructor(e,t,r){this._geometryCursor=e,this._offsetX=void 0!==t.offsetX?t.offsetX*r:0,this._offsetY=void 0!==t.offsetY?t.offsetY*r:0,this._method=void 0!==t.method?t.method:a.YI.OnPolygon,this._internalPlacement=new o.W}next(){const e=this._geometryCursor;return this._geometryCursor=null,e?this._polygonCenter(e):null}_polygonCenter(e){let t=!1;switch(this._method){case a.YI.CenterOfMass:{const r=(0,n.TP)(e);r&&(this._internalPlacement.setTranslate(r[0]+this._offsetX,r[1]+this._offsetY),t=!0)}break;case a.YI.BoundingBoxCenter:{const r=(0,i.z8)(e);r&&(this._internalPlacement.setTranslate((r[2]+r[0])/2+this._offsetX,(r[3]+r[1])/2+this._offsetY),t=!0)}break;case a.YI.OnPolygon:default:{const r=(0,s.d)(e);null!==r&&(this._internalPlacement.setTranslate(r[0]+this._offsetX,r[1]+this._offsetY),t=!0)}}return t?this._internalPlacement:null}}},7590:function(e,t,r){r.d(t,{$w:function(){return y},Bu:function(){return R},DW:function(){return A},FM:function(){return c},G9:function(){return s},GV:function(){return _},Go:function(){return u},K3:function(){return V},Kn:function(){return w},MM:function(){return p},MO:function(){return B},Nl:function(){return P},Ny:function(){return v},O2:function(){return O},UE:function(){return I},YC:function(){return G},YF:function(){return N},ZO:function(){return F},_1:function(){return E},_H:function(){return x},_d:function(){return T},bs:function(){return U},e6:function(){return h},gQ:function(){return l},iA:function(){return z},jn:function(){return m},lW:function(){return d},mA:function(){return f},n5:function(){return L},pM:function(){return C},pV:function(){return S},pk:function(){return H},rB:function(){return k},s4:function(){return n},xo:function(){return M},yH:function(){return b},zb:function(){return D},zr:function(){return g}});var i=r(38821);function n(e,t,r,i){return function(e){return"function"==typeof e}(e)?e(t,r,i):e}function s(e){return[e.r,e.g,e.b,e.a]}const o=" /-,\n";function a(e){let t=e.length;for(;t--;)if(!o.includes(e.charAt(t)))return!1;return!0}function l(e,t){const r=[];let i=0,n=-1;do{if(n=e.indexOf("[",i),n>=i){if(n>i){const t=e.substr(i,n-i);r.push([t,null,a(t)])}if(i=n+1,n=e.indexOf("]",i),n>=i){if(n>i){const s=t[e.substr(i,n-i)];s&&r.push([null,s,!1])}i=n+1}}}while(-1!==n);if(i<e.length-1){const t=e.substr(i);r.push([t,null,a(t)])}return r}function c(e,t,r,i){let n="",s=null;for(const i of t){const[t,o,a]=i;if(t)a?s=t:(s&&(n+=s,s=null),n+=t);else{let t=o;null!=r&&(t=B(o,r));const i=e.attributes[t];i&&(s&&(n+=s,s=null),n+=i)}}return function(e,t){switch("string"!=typeof e&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}(n,i)}function u(e,t,r,i,n,s,o=!0){const a=t/n,l=r/s,c=Math.ceil(a/2),u=Math.ceil(l/2);for(let r=0;r<s;r++)for(let h=0;h<n;h++){const d=4*(h+(o?s-r-1:r)*n);let p=0,f=0,m=0,g=0,y=0,_=0,v=0;const b=(r+.5)*l;for(let i=Math.floor(r*l);i<(r+1)*l;i++){const r=Math.abs(b-(i+.5))/u,n=(h+.5)*a,s=r*r;for(let r=Math.floor(h*a);r<(h+1)*a;r++){let o=Math.abs(n-(r+.5))/c;const a=Math.sqrt(s+o*o);a>=-1&&a<=1&&(p=2*a*a*a-3*a*a+1,p>0&&(o=4*(r+i*t),v+=p*e[o+3],m+=p,e[o+3]<255&&(p=p*e[o+3]/250),g+=p*e[o],y+=p*e[o+1],_+=p*e[o+2],f+=p))}}i[d]=g/f,i[d+1]=y/f,i[d+2]=_/f,i[d+3]=v/m}}function h(e){return e?[e[0],e[1],e[2],e[3]/255]:[0,0,0,0]}function d(e){return e.data?.symbol??null}function p(e){return"CIMVectorMarker"===e.type||"CIMPictureMarker"===e.type||"CIMBarChartMarker"===e.type||"CIMCharacterMarker"===e.type||"CIMPieChartMarker"===e.type||"CIMStackedBarChartMarker"===e.type}function f(e){return"CIMGradientStroke"===e.type||"CIMPictureStroke"===e.type||"CIMSolidStroke"===e.type}function m(e){return null!=e&&("CIMGradientFill"===e.type||"CIMHatchFill"===e.type||"CIMPictureFill"===e.type||"CIMSolidFill"===e.type||"CIMWaterFill"===e.type)}function g(e){return null!=e&&("CIMMarkerPlacementAlongLineRandomSize"===e.type||"CIMMarkerPlacementAlongLineSameSize"===e.type||"CIMMarkerPlacementAlongLineVariableSize"===e.type||"CIMMarkerPlacementAtExtremities"===e.type||"CIMMarkerPlacementAtMeasuredUnits"===e.type||"CIMMarkerPlacementAtRatioPositions"===e.type||"CIMMarkerPlacementOnLine"===e.type||"CIMMarkerPlacementOnVertices"===e.type)}const y=(e,t=0)=>null==e||isNaN(e)?t:e,_=(e,t)=>e??t,v=e=>e.tintColor?h(e.tintColor):[255,255,255,1],b=e=>{if(!e)return!1;for(const t of e)switch(t.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function x(){return r.e(4696).then(r.bind(r,28356))}function S(e){if(!e)return"normal";switch(e.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function w(e){if(!e)return"normal";switch(e.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function T(e){let t="normal",r="normal";if(e){const i=e.toLowerCase();i.includes("italic")?t="italic":i.includes("oblique")&&(t="oblique"),i.includes("bold")?r="bold":i.includes("light")&&(r="lighter")}return{style:t,weight:r}}function A(e){return e.underline?"underline":e.strikethrough?"line-through":"none"}function C(e){if(!e)return null;switch(e.type){case"CIMPolygonSymbol":if(e.symbolLayers)for(const t of e.symbolLayers){const e=C(t);if(null!=e)return e}break;case"CIMTextSymbol":return C(e.symbol);case"CIMSolidFill":return e.color}return null}function E(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const t=e.symbolLayers;if(t)for(const e of t){const t=E(e);if(null!=t)return t}break}case"CIMTextSymbol":return E(e.symbol);case"CIMSolidStroke":return e.color}}function M(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(e.symbolLayers)for(const t of e.symbolLayers){const e=M(t);if(void 0!==e)return e}break;case"CIMTextSymbol":return M(e.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return e.width}}function R(e){switch(e){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function P(e){switch(e){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function O(e){return(e?Object.keys(e):[]).map((t=>({name:t,alias:t,type:"string"==typeof e[t]?"esriFieldTypeString":"esriFieldTypeDouble"})))}const I=e=>e.includes("data:image/svg+xml");function L(e){if(!e)return null;switch(e.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function N(e){return e?e.charAt(0).toLowerCase()+e.substring(1):e}function D(e,t,r,i,n,s){const{infos:o}=s;let a=1,l=0,c=0,u=0;for(const{offsetX:e,offsetY:t,rotation:r,size:i,frameHeight:n,rotateClockWise:s}of o)c=W(e,t,l,a,c),u=j(e,t,l,a,u),n&&(a*=i/n),l=q(r,s,l);const h=W(i,n,l,a,c),d=j(i,n,l,a,u);return{size:e*a,rotation:q(t,r,l),offsetX:h,offsetY:d}}function F(e){if(null==e)return!1;if(Array.isArray(e))return e.every((e=>F(e)));switch(typeof e){case"string":return!!e;case"number":return!isNaN(e)}}function z(e,t){if("color"===t||"outlinecolor"===t||"backgroundcolor"===t||"borderlinecolor"===t||"tintcolor"===t)return[...i.K[t]];const r=i.D[e];if(!r)throw new Error(`InternalError: default value for type ${e}.`);return r[t]}function V(e){return e?.dashTemplate&&"string"==typeof e.dashTemplate&&(e.dashTemplate=e.dashTemplate.split(" ").map(Number)),e}function U(e){if(null==e)return"Normal";switch(e.type){case"CIMTextSymbol":return e.textCase??"Normal";case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const t=e.symbolLayers;if(!t)return"Normal";for(const e of t)if("CIMVectorMarker"===e.type)return U(e)}break;case"CIMVectorMarker":{const t=e.markerGraphics;if(!t)return"Normal";for(const e of t)if(e.symbol)return U(e.symbol)}}return"Normal"}function G(e){if(e)switch(e.type){case"CIMTextSymbol":return e.height;case"CIMPointSymbol":{let t=0;if(e.symbolLayers)for(const r of e.symbolLayers)if(r)switch(r.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const e=r.size??i.D.CIMVectorMarker.size;e>t&&(t=e);break}}return t}case"CIMLineSymbol":case"CIMPolygonSymbol":{let t=0;if(e.symbolLayers)for(const r of e.symbolLayers)if(r)switch(r.type){case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const e=r.width;null!=e&&e>t&&(t=e);break}case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":if(r.markerPlacement&&g(r.markerPlacement)){const e=r.size??i.D.CIMVectorMarker.size;e>t&&(t=e)}break;case"CIMPictureFill":{const e=r.height;null!=e&&e>t&&(t=e)}}return t}}}function B(e,t){if(null!==t){const r=t.get(e);return r?r.name:e}return e}function H(e){return e.map((e=>({...e,propertyName:N(e.propertyName)})))}function k(e){const t={};for(const r in e){const i=e[r];t[N(r)]=i}return t}function j(e,t,r,i,n){const s=r*Math.PI/180;if(s){const r=Math.cos(s);return(Math.sin(s)*e+r*t)*i+n}return t*i+n}function W(e,t,r,i,n){const s=r*Math.PI/180;return s?(Math.cos(s)*e-Math.sin(s)*t)*i+n:e*i+n}function q(e,t,r){return t?r-e:r+e}},77927:function(e,t,r){r.d(t,{Fe:function(){return h},Km:function(){return s},Nk:function(){return l}});var i=r(52874),n=r(7590);function s(e,t,r,i){if(e)if("CIMTextSymbol"!==e.type){if(r&&e.effects)for(const r of e.effects)a(r,t);if(e.symbolLayers)for(const r of e.symbolLayers)switch(r.type){case"CIMPictureMarker":case"CIMVectorMarker":o(r,t,i);break;case"CIMPictureStroke":case"CIMSolidStroke":!i?.preserveOutlineWidth&&r.width&&(r.width*=t);break;case"CIMPictureFill":r.height&&(r.height*=t),r.offsetX&&(r.offsetX*=t),r.offsetY&&(r.offsetY*=t);break;case"CIMHatchFill":s(r.lineSymbol,t,!0,{...i,preserveOutlineWidth:!1}),r.offsetX&&(r.offsetX*=t),r.offsetY&&(r.offsetY*=t),r.separation&&(r.separation*=t)}}else null!=e.height&&(e.height*=t)}function o(e,t,r){if(e&&(e.markerPlacement&&function(e,t){switch((0,n.zr)(e)&&e.offset&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.placementTemplate&&e.placementTemplate.length){const r=e.placementTemplate.map((e=>e*t));e.placementTemplate=r}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset&&(e.maxRandomOffset*=t),e.placementTemplate&&e.placementTemplate.length){const r=e.placementTemplate.map((e=>e*t));e.placementTemplate=r}break;case"CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=t);break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=t);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=t),e.endPosition&&(e.endPosition*=t);break;case"CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.stepX&&(e.stepX*=t),e.stepY&&(e.stepY*=t)}}(e.markerPlacement,t),e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.anchorPoint&&"Absolute"===e.anchorPointUnits&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size=null!=e.size?e.size*t:0,"CIMVectorMarker"===e.type&&e.markerGraphics))for(const i of e.markerGraphics)e.scaleSymbolsProportionally||s(i.symbol,t,!0,r)}function a(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width&&(e.width*=t);break;case"CIMGeometricEffectBuffer":e.size&&(e.size*=t);break;case"CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=t),e.endCut&&(e.endCut*=t),e.middleCut&&(e.middleCut*=t);break;case"CIMGeometricEffectDashes":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.dashTemplate&&e.dashTemplate.length){const r=e.dashTemplate.map((e=>e*t));e.dashTemplate=r}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length&&(e.length*=t);break;case"CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=t);break;case"CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=t);break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=t),e.length&&(e.length*=t),e.toWidth&&(e.toWidth*=t);break;case"CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=t),e.period&&(e.period*=t)}}function l(e){const t=[];return c((0,n.lW)(e),t),t.length?new i.A((0,n.e6)(t[0])):null}function c(e,t){if(!e)return;let r;r="CIMTextSymbol"===e.type?e.symbol:e;const i="CIMPolygonSymbol"===e.type;if(r?.symbolLayers)for(const e of r.symbolLayers)if(!(e.colorLocked||i&&((0,n.mA)(e)||(0,n.MM)(e)&&e.markerPlacement&&(0,n.zr)(e.markerPlacement))))switch(e.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":e.tintColor&&u(t,e.tintColor);break;case"CIMVectorMarker":e.markerGraphics?.forEach((e=>{c(e.symbol,t)}));break;case"CIMSolidStroke":case"CIMSolidFill":u(t,e.color);break;case"CIMHatchFill":c(e.lineSymbol,t)}}function u(e,t){for(const r of e)if(r.join(".")===t.join("."))return;e.push(t)}function h(e,t,r){t instanceof i.A||(t=new i.A(t));const s=(0,n.lW)(e);s&&d(s,t,r)}function d(e,t,r){if(!e)return;let i;i="CIMTextSymbol"===e.type?e.symbol:e;const s="CIMPolygonSymbol"===i?.type;if(i?.symbolLayers)for(const e of i.symbolLayers){if(e.colorLocked)continue;if(s)if(r){const{layersToColor:t}=r;if(((0,n.mA)(e)||(0,n.MM)(e)&&e.markerPlacement&&(0,n.zr)(e.markerPlacement))&&"fill"===t||(0,n.jn)(e)&&"outline"===t)continue}else if((0,n.mA)(e)||(0,n.MM)(e)&&e.markerPlacement&&(0,n.zr)(e.markerPlacement))continue;const i=t.toArray();switch(e.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":e.tintColor=i;break;case"CIMVectorMarker":e.markerGraphics?.forEach((e=>{d(e.symbol,t,r)}));break;case"CIMSolidStroke":case"CIMSolidFill":e.color=i;break;case"CIMHatchFill":d(e.lineSymbol,t,r)}}}},74661:function(e,t,r){r.d(t,{A7:function(){return c},Cx:function(){return u},Hk:function(){return h},JJ:function(){return m},SF:function(){return d},UK:function(){return l},jM:function(){return p},x3:function(){return f}}),r(58941);var i=r(8740),n=r(22198),s=r(90363),o=r(90972),a=r(6259);const l=s.A.fromJSON(a.Cb),c=n.A.fromJSON(a.yM),u=i.A.fromJSON(a.WR),h=o.A.fromJSON(a.JZ);function d(e){if(null==e)return null;switch(e.type){case"mesh":return null;case"point":case"multipoint":return l;case"polyline":return c;case"polygon":case"extent":return u}return null}const p=s.A.fromJSON(a.nC),f=n.A.fromJSON(a.HW),m=i.A.fromJSON(a.b6)},40990:function(e,t,r){r.d(t,{af:function(){return b},al:function(){return v},dX:function(){return x}});var i=r(52874),n=(r(10748),r(78879)),s=(r(58941),r(13520)),o=r(22762),a=r(56150),l=r(97025),c=r(78018),u=r(15186),h=r(10052),d=r(74661),p=r(6259),f=r(77529);const m=c.A.fromSimpleMarkerSymbol(d.UK),g=a.A.fromSimpleLineSymbol(d.A7),y=u.A.fromSimpleFillSymbol(d.Cx),_=new l.A({symbolLayers:new n.A([new o.A({material:{color:p.fT},edges:new h.A({size:(0,s.PN)(1),color:new i.A(p.JR)})})])}),v=new a.A({symbolLayers:new n.A([new f.A({material:{color:new i.A([0,0,0])},size:(0,s.PN)(1)})])}),b=new u.A({symbolLayers:new n.A([new o.A({outline:{color:new i.A([0,0,0]),size:(0,s.PN)(1)}})])});function x(e){if(null==e)return null;switch(e.type){case"mesh":return _;case"point":case"multipoint":return m;case"polyline":return g;case"polygon":case"extent":return y}return null}},6259:function(e,t,r){r.d(t,{Cb:function(){return s},HW:function(){return u},JR:function(){return n},JZ:function(){return l},WR:function(){return a},b6:function(){return h},fT:function(){return i},nC:function(){return c},yM:function(){return o}});const i=[252,146,31,255],n=[153,153,153,255],s={type:"esriSMS",style:"esriSMSCircle",size:6,color:i,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},o={type:"esriSLS",style:"esriSLSSolid",width:.75,color:i},a={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},l={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},c={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},u={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},h={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},31827:function(e,t,r){r.d(t,{$4:function(){return v},O0:function(){return b},O1:function(){return x},Sw:function(){return S},eH:function(){return y},rc:function(){return _}});var i=r(53216),n=r(52874),s=r(93040),o=r(99680),a=r(13520),l=r(77927);const c="picture-fill",u="simple-fill",h="simple-line",d="simple-marker",p="text",f="cim",m=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),g=new o.q(1e3);function y(e){const t=e.style;let r=null;if(e)switch(e.type){case d:"cross"!==t&&"x"!==t&&(r=e.color);break;case u:t&&"solid"!==t?"none"!==t&&(r={type:"pattern",x:0,y:0,src:(0,i.s)(`esri/symbols/patterns/${t}.png`),width:5,height:5}):r=e.color;break;case c:r={type:"pattern",src:e.url,width:(0,a.Lz)(e.width)*e.xscale,height:(0,a.Lz)(e.height)*e.yscale,x:(0,a.Lz)(e.xoffset),y:(0,a.Lz)(e.yoffset)};break;case p:r=e.color;break;case f:r=(0,l.Nk)(e)}return r}function _(e,t){const r=e+"-"+t;return void 0!==g.get(r)?Promise.resolve(g.get(r)):(0,s.A)(e,{responseType:"image"}).then((e=>{const i=e.data,n=i.naturalWidth,s=i.naturalHeight,o=document.createElement("canvas");o.width=n,o.height=s;const a=o.getContext("2d");a.fillStyle=t,a.fillRect(0,0,n,s),a.globalCompositeOperation="destination-in",a.drawImage(i,0,0);const l=o.toDataURL();return g.put(r,l),l}))}function v(e){if(!e)return null;let t=null;switch(e.type){case u:case c:case d:t=v(e.outline);break;case h:{const r=(0,a.Lz)(e.width);null!=e.style&&"none"!==e.style&&0!==r&&(t={color:e.color,style:x(e.style),width:r,cap:e.cap,join:"miter"===e.join?(0,a.Lz)(e.miterLimit):e.join},t.dashArray=b(t).join(",")||"none");break}default:t=null}return t}function b(e){if(!e?.style)return[];const{dashArray:t,style:r,width:i}=e;if("string"==typeof t&&"none"!==t)return t.split(",").map((e=>Number(e)));const n=i??0,s=m.has(r)?m.get(r).map((e=>e*n)):[];if("butt"!==e.cap)for(const[e,t]of s.entries())s[e]=e%2==1?t+n:Math.max(t-n,1);return s}const x=(()=>{const e={};return t=>{if(e[t])return e[t];const r=t.replaceAll("-","");return e[t]=r,r}})(),S=new n.A([128,128,128])},8404:function(e,t,r){r.d(t,{M9:function(){return c},oO:function(){return u},rS:function(){return p}});var i=r(10748),n=r(39819),s=r(11432),o=r(97992),a=r(11299),l=r(36e3);function c(e,t,r,i){const n=d(e,{},{context:i,isLabelSymbol:!1});null!=n&&(t[r]=n)}function u(e,t,r,i){const n=d(e,{},{context:i,isLabelSymbol:!0});null!=n&&(t[r]=n)}function h(e){return e instanceof o.A||e instanceof l.A}function d(e,t,r){if(null==e)return null;const{context:i,isLabelSymbol:o}=r,l=i?.origin,c=i?.messages;if("web-scene"===l&&!h(e)){const r=(0,a.t)(e,{retainCIM:!0,hasLabelingContext:o});return null!=r.symbol?r.symbol.write(t,i):(c?.push(new n.A("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:e,context:i,error:r.error})),null)}return("web-map"===l||"portal-item"===l&&!(0,s.TU)(i?.layer))&&h(e)?(c?.push(new n.A("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:e,context:i})),null):e.write(t,i)}function p(e,t){return(0,i.Bu)(e,null,t)}},3521:function(e,t,r){r.d(t,{bo:function(){return d},cF:function(){return h},jg:function(){return y},o5:function(){return p},yA:function(){return f}});var i=r(93040),n=r(39819),s=r(60539),o=r(90683),a=r(51432),l=r(26544),c=r(96736);let u={};function h(e,t,r){return null!=e?.styleUrl?async function(e,t){try{return{data:(await f(e,t)).data,baseUrl:(0,o.nM)(e),styleUrl:e}}catch(e){return(0,s.QP)(e),null}}(e.styleUrl,r):null!=e?.styleName?function(e,t,r){const i=null!=t.portal?t.portal:a.A.getDefault();let s;const o=`${i.url} - ${i.user?.username} - ${e}`;return u[o]||(u[o]=function(e,t,r){return t.load(r).then((()=>{const i=new l.A({disableExtraQuery:!0,query:`owner:${m} AND type:${g} AND typekeywords:"${e}"`});return t.queryItems(i,r)})).then((({results:t})=>{let i=null;const s=e.toLowerCase();if(t&&Array.isArray(t))for(const e of t){const t=e.typeKeywords?.some((e=>e.toLowerCase()===s));if(t&&e.type===g&&e.owner===m){i=e;break}}if(!i)throw new n.A("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return i.load(r)}))}(e,i,r).then((e=>(s=e,e.fetchData()))).then((t=>({data:t,baseUrl:s.itemUrl??"",styleName:e})))),u[o]}(e.styleName,t,r):Promise.reject(new n.A("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function d(e){return null===e||"CIMSymbolReference"===e.type?e:{type:"CIMSymbolReference",symbol:e}}function p(e,t,r=["gltf"]){if("cimRef"===t)return encodeURI(e.cimRef);if(e.formatInfos&&!(0,c.Vd)())for(const t of r){const r=e.formatInfos.find((e=>e.type===t));if(r)return r.href}return encodeURI(e.webRef)}function f(e,t){const r={responseType:"json",query:{f:"json"},...t};return(0,i.A)((0,o.S8)(e),r)}const m="esri_en",g="Style",y="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json"},11299:function(e,t,r){r.d(t,{c:function(){return y},t:function(){return _}});var i=r(10748),n=r(39819),s=r(40990),o=r(36e3),a=r(78018),l=r(22198),c=r(56150),u=r(90363),h=r(24411),d=r(8740),p=r(97025),f=r(15186),m=r(90972),g=r(56922);const y={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function _(e,t=y){if(!e)return{symbol:null};const{retainId:r=y.retainId,ignoreDrivers:_=y.ignoreDrivers,hasLabelingContext:v=y.hasLabelingContext,retainCIM:b=y.retainCIM,cimFallbackEnabled:x=y.cimFallbackEnabled}=t;let S=null;if((0,i.wk)(e)||e instanceof o.A)S=e.clone();else if("cim"===e.type){const r=e.data?.symbol?.type;switch(r){case"CIMPointSymbol":S=b?e.clone():a.A.fromCIMSymbol(e);break;case"CIMLineSymbol":x&&(S=s.al.clone(),t?.logWarning?.("Unsupported CIM line symbology converted to fallback 3D line symbology"));break;case"CIMPolygonSymbol":x&&(S=s.af.clone(),t?.logWarning?.("Unsupported CIM polygon symbology converted to fallback 3D polygon symbology"))}if(!S)return{error:new n.A("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${r||"unknown"}' is unsupported in 3D`,{symbol:e})}}else if(e instanceof l.A)S=c.A.fromSimpleLineSymbol(e);else if(e instanceof u.A)S=a.A.fromSimpleMarkerSymbol(e);else if(e instanceof h.A)S=a.A.fromPictureMarkerSymbol(e);else if(e instanceof d.A)S=t.geometryType&&"mesh"===t.geometryType?p.A.fromSimpleFillSymbol(e):f.A.fromSimpleFillSymbol(e);else{if(!(e instanceof m.A))return{error:new n.A("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${e.type||e.declaredClass}' is unsupported in 3D`,{symbol:e})};S=v?g.A.fromTextSymbol(e):a.A.fromTextSymbol(e)}return r&&S&&"cim"!==S.type&&(S.id=e.id),_&&(0,i.wk)(S)&&S.symbolLayers.forEach((e=>e.ignoreDrivers=!0)),{symbol:S}}},89814:function(e,t,r){r.d(t,{$d:function(){return f},GG:function(){return w},N7:function(){return m},Sx:function(){return g},UQ:function(){return S},di:function(){return T},dt:function(){return _},f3:function(){return A},k_:function(){return p},yG:function(){return C}});var i=r(52874),n=r(10748),s=r(77472),o=(r(58941),r(13520)),a=r(32501),l=r(60318),c=r(77927),u=r(31827),h=r(13109);const d=new i.A("white");function p(e){if(!e)return 0;if((0,n.wk)(e)){const t=function(e){const t=e.symbolLayers?.at(-1);if(t&&"outline"in t)return t?.outline?.size}(e);return null!=t?t:0}return(0,o.PN)((0,u.$4)(e)?.width)}function f(e){if(null==e||!("symbolLayers"in e)||null==e.symbolLayers)return!1;switch(e.type){case"point-3d":return e.symbolLayers.some((e=>"object"===e.type));case"line-3d":return e.symbolLayers.some((e=>"path"===e.type));case"polygon-3d":return e.symbolLayers.some((e=>"object"===e.type||"extrude"===e.type));default:return!1}}function m(e){return e.resource?.href??""}function g(e,t){if(!e)return null;let r=null;return(0,n.wk)(e)?r=function(e){const t=e.symbolLayers;if(!t)return null;let r=null;return t.forEach((e=>{"object"===e.type&&e.resource?.href||(r="water"===e.type?e.color:e.material?e.material.color:null)})),r?new i.A(r):null}(e):(0,n.$y)(e)&&(r="cim"===e.type?(0,c.Nk)(e):e.color?new i.A(e.color):null),r?y(r,t):null}function y(e,t){if(null==t||null==e)return e;const r=e.toRgba();return r[3]=r[3]*t,new i.A(r)}function _(e,t,r){var s,o,a;e&&(t||null!=r)&&(t&&(t=new i.A(t)),(0,n.wk)(e)?function(e,t,r){const i=e.symbolLayers;if(!i)return;const n=e=>y(t=t??e??(null!=r?d:null),r);i.forEach((e=>{if("object"!==e.type||!e.resource?.href||t)if("water"===e.type)e.color=n(e.color);else{const t=null!=e.material?e.material.color:null,i=n(t);null==e.material?e.material=new h.N({color:i}):e.material.color=i,null!=r&&"outline"in e&&null!=e.outline?.color&&(e.outline.color=y(e.outline.color,r))}}))}(e,t,r):(0,n.$y)(e)&&(s=e,a=r,(o=(o=t)??s.color)&&(s.color=y(o,a)),null!=a&&"outline"in s&&s.outline?.color&&(s.outline.color=y(s.outline.color,a))))}function v(e){for(const t of e)if("number"==typeof t)return t;return null}function b(e,t,r){for(let i=0;i<3;i++){const n=e[i];switch(n){case"symbol-value":{const e=r[i];return null!=e?e/t[i]:1}case"proportional":break;default:if(n&&t[i])return n/t[i]}}return 1}function x(e,t,r,i){switch(e){case"proportional":return r*i;case"symbol-value":return null!=t?t:r;default:return e}}async function S(e,t){if(e&&t)return(0,n.wk)(e)?async function(e,t){const i=e.symbolLayers;i&&await(0,s.jJ)(i,(async e=>async function(e,t){switch(e.type){case"extrude":!function(e,t){e.size="number"==typeof t[2]?t[2]:0}(e,t);break;case"icon":case"line":case"text":!function(e,t){const r=v(t);null!=r&&(e.size=r)}(e,t);break;case"path":!function(e,t){const r=b(t,a.Un,[e.width,void 0,e.height]);e.width=x(t[0],e.width,1,r),e.height=x(t[2],e.height,1,r)}(e,t);break;case"object":await async function(e,t){const{resourceSize:i,symbolSize:n}=await async function(e){const{computeObjectLayerResourceSize:t}=await r.e(7269).then(r.bind(r,9141)),i=await t(e,10),{width:n,height:s,depth:o}=e,a=[n,o,s];let l=1;for(let e=0;e<3;e++){const t=a[e];if(null!=t){l=t/i[e];break}}for(let e=0;e<3;e++)null==a[e]&&(a[e]=i[e]*l);return{resourceSize:i,symbolSize:a}}(e),s=b(t,i,n);e.width=x(t[0],n[0],i[0],s),e.depth=x(t[1],n[1],i[1],s),e.height=x(t[2],n[2],i[2],s)}(e,t)}}(e,t)))}(e,t):void((0,n.$y)(e)&&function(e,t){const r=v(t);if(null!=r)switch(e.type){case"simple-marker":e.size=r;break;case"picture-marker":{const t=e.width/e.height;t>1?(e.width=r,e.height=r*t):(e.width=r*t,e.height=r);break}case"simple-line":e.width=r;break;case"text":e.font.size=r}}(e,t))}function w(e,t,r){if(e&&null!=t)if((0,n.wk)(e)){const i=e.symbolLayers;i&&i.forEach((e=>{if(e&&"object"===e.type)switch(r){case"tilt":e.tilt=(e.tilt??0)+t;break;case"roll":e.roll=(e.roll??0)+t;break;default:e.heading=(e.heading??0)+t}}))}else(0,n.$y)(e)&&("simple-marker"!==e.type&&"picture-marker"!==e.type&&"text"!==e.type||(e.angle+=t))}function T(e){if(!e)return null;const t=e.effects.filter((e=>"bloom"!==e.type)).map((e=>e.toJSON()));return(0,l.zu)(t)}function A(e){return null!=e&&"polygon-3d"===e.type&&e.symbolLayers.some((e=>"extrude"===e.type))}async function C(e,t){return await e.fetchSymbol(t)||e.fetchCIMSymbol(t)}},27923:function(e,t,r){r.d(t,{I:function(){return m},p:function(){return f},resolveWebStyleSymbol:function(){return p}});var i=r(10748),n=r(14520),s=r(39819),o=r(90683),a=r(51432),l=r(60534),c=r(8404),u=r(48812),h=r(3521),d=r(11355);function p(e,t,r,i){const n=e.name;return null==n?Promise.reject(new s.A("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):e.styleName&&"Esri2DPointSymbolsStyle"===e.styleName?function(e,t,r){const i=h.jg.replaceAll(/\{SymbolName\}/gi,e),n=null!=t.portal?t.portal:a.A.getDefault();return(0,h.yA)(i,r).then((e=>{const t=(0,h.bo)(e.data);return(0,c.rS)(t,{portal:n,url:(0,o.An)((0,o.nM)(i)),origin:"portal-item"})}))}(n,t,i):(0,h.cF)(e,t,i).then((e=>m(e,n,t,r,h.o5,i)))}function f(e,t){return t.items.find((t=>t.name===e))}function m(e,t,r,p,m,g){const y=null!=r?.portal?r.portal:a.A.getDefault(),_={portal:y,url:(0,o.An)(e.baseUrl),origin:"portal-item"},v=f(t,e.data);if(!v){const e=`The symbol name '${t}' could not be found`;return Promise.reject(new s.A("symbolstyleutils:symbol-name-not-found",e,{symbolName:t}))}let b=(0,l.f)(m(v,p),_),x=v.thumbnail?.href??null;const S=v.thumbnail?.imageData;(0,n.b5)()&&(b=(0,n.EM)(b)??"",x=(0,n.EM)(x));const w={portal:y,url:(0,o.An)((0,o.nM)(b)),origin:"portal-item"};return(0,h.yA)(b,g).then((n=>{const s="cimRef"===p?(0,h.bo)(n.data):n.data,o=(0,c.rS)(s,w);if(o&&(0,i.wk)(o)){if(x){const e=(0,l.f)(x,_);o.thumbnail=new d.V({url:e})}else S&&(o.thumbnail=new d.V({url:`data:image/png;base64,${S}`}));e.styleUrl?o.styleOrigin=new u.A({portal:r.portal,styleUrl:e.styleUrl,name:t}):e.styleName&&(o.styleOrigin=new u.A({portal:r.portal,styleName:e.styleName,name:t}))}return o}))}},16088:function(e,t,r){r.d(t,{A:function(){return o}});var i=r(39819),n=r(40633),s=r(87280);function o(e,t,r,i,s){if(null==e)return null;const o=e.referencesGeometry()&&s?l(t,i,s):t,a=e.repurposeFeature(o);try{return e.evaluate({...r,$feature:a},e.services)}catch(e){return n.A.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",e),null}}const a=new Map;function l(e,t,r){const{transform:o,hasZ:l,hasM:c}=r;a.has(t)||a.set(t,function(e){const t={};switch(e){case"esriGeometryPoint":return(e,r,i,n)=>(0,s.Tr)(r,t,e,i,n);case"esriGeometryPolygon":return(e,r,i,n)=>(0,s.$X)(r,t,e,i,n);case"esriGeometryPolyline":return(e,r,i,n)=>(0,s.P5)(r,t,e,i,n);case"esriGeometryMultipoint":return(e,r,i,n)=>(0,s.SW)(r,t,e,i,n);default:return n.A.getLogger("esri.views.2d.support.arcadeOnDemand").error(new i.A("mapview-arcade",`Unable to handle geometryType: ${e}`)),e=>e}}(t));const u=a.get(t)(e.geometry,o,l,c);return{...e,geometry:u}}},7056:function(e,t,r){r.d(t,{GW:function(){return g},IU:function(){return b},Jo:function(){return o},MG:function(){return s},Wh:function(){return d},cP:function(){return T},os:function(){return u},p6:function(){return m},pJ:function(){return a},ru:function(){return S},s3:function(){return x},w4:function(){return w},wV:function(){return f},yM:function(){return A},z0:function(){return p}});var i=r(38441),n=r(72139);const s=Number.POSITIVE_INFINITY,o=Math.PI,a=2*o,l=128/o,c=256/360,u=o/180,h=1/Math.LN2;function d(e,t){return(e%=t)>=0?e:e+t}function p(e){return d(e*l,256)}function f(e){return d(e*c,256)}function m(e){return Math.log(e)*h}function g(e,t,r){return e*(1-r)+t*r}const y=8,_=14,v=16;function b(e){return y+Math.max((e-_)*v,0)}function x(e,t,r){let i,n,s,o=0;for(const a of r){i=a.length;for(let r=1;r<i;++r)n=a[r-1],s=a[r],n.y>t!=s.y>t&&((s.x-n.x)*(t-n.y)-(s.y-n.y)*(e-n.x)>0?o++:o--)}return 0!==o}function S(e,t,r,n){let s,o,a,l;const c=n*n;for(const n of r){const r=n.length;if(!(r<2)){s=n[0].x,o=n[0].y;for(let u=1;u<r;++u){if(a=n[u].x,l=n[u].y,(0,i.Ng)(e,t,s,o,a,l)<c)return!0;s=a,o=l}}}return!1}function w(e,t,r,i,n,s,o){const a=Math.max(i,Math.min(t,s))-t,l=Math.max(n,Math.min(r,o))-r;return a*a+l*l<=e*e}function T(e,t){if(0===t||Number.isNaN(t))return e;const r=[],i=new n.bR(0,0),s=new n.bR(0,0),o=new n.bR(0,0);for(let a=0;a<e.length;a++){const l=e[a],c=[];for(let e=0;e<l.length;e++){const r=l[e-1],a=l[e],u=l[e+1];0===e?i.setCoords(0,0):i.assignSub(a,r).normalize().rightPerpendicular(),e===l.length-1?s.setCoords(0,0):s.assignSub(u,a).normalize().rightPerpendicular(),o.assignAdd(i,s).normalize();const h=o.x*s.x+o.y*s.y;0!==h&&o.scale(1/h),c.push(n.bR.add(a,o.scale(t)))}r.push(c)}return r}function A(e,t,r,i){const s=new n.bR(e[0],e[1]);if(s.scale(i),"viewport"===t){const e=-r*(Math.PI/180),t=Math.cos(e),i=Math.sin(e);s.rotate(t,i)}return s}},54904:function(e,t,r){r.d(t,{A:function(){return i}});class i{constructor(e=0,t=0,r=0,i=0){this.x=e,this.y=t,this.width=r,this.height=i}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}},96564:function(e,t,r){r.d(t,{Dy:function(){return d},UD:function(){return c},fO:function(){return u},gy:function(){return o},iT:function(){return h},xy:function(){return l}});var i=r(40633);const n=()=>i.A.getLogger("esri.views.2d.engine.webgl.alignmentUtils");var s,o,a;function l(e){if(!e)return s.Center;switch(e){case"Left":case"left":return s.Left;case"Right":case"right":return s.Right;case"Justify":return n().warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),s.Center;case"Center":case"center":return s.Center}}function c(e){if(!e)return o.Center;switch(e){case"Top":case"top":return o.Top;case"Center":case"middle":return o.Center;case"Baseline":case"baseline":return o.Baseline;case"Bottom":case"bottom":return o.Bottom}}function u(e){switch(e){case"above-left":case"esriServerPointLabelPlacementAboveLeft":return["right","bottom"];case"above-center":case"above-along":case"esriServerPointLabelPlacementAboveCenter":case"esriServerLinePlacementAboveAlong":return["center","bottom"];case"above-right":case"esriServerPointLabelPlacementAboveRight":return["left","bottom"];case"center-left":case"esriServerPointLabelPlacementCenterLeft":return["right","middle"];case"center-center":case"center-along":case"esriServerPointLabelPlacementCenterCenter":case"esriServerLinePlacementCenterAlong":case"always-horizontal":case"esriServerPolygonPlacementAlwaysHorizontal":return["center","middle"];case"center-right":case"esriServerPointLabelPlacementCenterRight":return["left","middle"];case"below-left":case"esriServerPointLabelPlacementBelowLeft":return["right","top"];case"below-center":case"below-along":case"esriServerPointLabelPlacementBelowCenter":case"esriServerLinePlacementBelowAlong":return["center","top"];case"below-right":case"esriServerPointLabelPlacementBelowRight":return["left","top"];default:return console.debug(`Found invalid placement type ${e}`),["center","middle"]}}function h(e){switch(e){case s.Right:case"right":return-1;case s.Center:case"center":return 0;case s.Left:case"left":return 1;default:return console.debug(`Found invalid horizontal alignment ${e}`),0}}function d(e){switch(e){case o.Top:case"top":return 1;case o.Center:case"middle":return 0;case o.Bottom:case o.Baseline:case"baseline":case"bottom":return-1;default:return console.debug(`Found invalid vertical alignment ${e}`),0}}(a=s||(s={}))[a.Left=-1]="Left",a[a.Center=0]="Center",a[a.Right=1]="Right",function(e){e[e.Top=1]="Top",e[e.Center=0]="Center",e[e.Bottom=-1]="Bottom",e[e.Baseline=2]="Baseline"}(o||(o={}))},87573:function(e,t,r){r.d(t,{A:function(){return n}});var i=r(14583);class n{constructor(e,t,r,n){this.computedX=0,this.computedY=0,this.center=(0,i.fA)(e,t),this.centerT=(0,i.vt)(),this.halfWidth=r/2,this.halfHeight=n/2,this.width=r,this.height=n}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+this.halfHeight}get trX(){return this.center[0]-this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+this.halfWidth}get ymin(){return this.y-this.halfHeight}get ymax(){return this.y+this.halfHeight}set x(e){this.center[0]=e}set y(e){this.center[1]=e}clone(){return new n(this.x,this.y,this.width,this.height)}serialize(e){return e.writeF32(this.center[0]),e.writeF32(this.center[1]),e.push(this.width),e.push(this.height),e}findCollisionDelta(e,t=4){const r=Math.abs(e.centerT[0]-this.centerT[0]),i=Math.abs(e.centerT[1]-this.centerT[1]),n=(e.halfWidth+this.halfWidth+t)/r,s=(e.halfHeight+this.halfHeight+t)/i,o=Math.min(n,s);return Math.log2(o)}extend(e){const t=Math.min(this.xmin,e.xmin),r=Math.min(this.ymin,e.ymin),i=Math.max(this.xmax,e.xmax)-t,n=Math.max(this.ymax,e.ymax)-r,s=t+i/2,o=r+n/2;this.width=i,this.height=n,this.halfWidth=i/2,this.halfHeight=n/2,this.x=s,this.y=o}static deserialize(e){const t=e.readF32(),r=e.readF32(),i=e.readInt32(),s=e.readInt32();return new n(t,r,i,s)}}},39686:function(e,t,r){r.d(t,{$U:function(){return L},C2:function(){return c},CQ:function(){return n},CR:function(){return x},C_:function(){return D},Cp:function(){return S},DY:function(){return a},GR:function(){return X},Gh:function(){return M},LY:function(){return C},O5:function(){return j},Pq:function(){return u},Qb:function(){return H},Sr:function(){return v},TB:function(){return Y},V3:function(){return P},Vl:function(){return $},Xh:function(){return Z},YS:function(){return d},YV:function(){return s},_M:function(){return O},_x:function(){return W},cp:function(){return J},dV:function(){return T},eG:function(){return l},eI:function(){return q},fq:function(){return G},fy:function(){return R},g0:function(){return E},hM:function(){return F},ie:function(){return I},ju:function(){return o},lL:function(){return g},mg:function(){return N},n9:function(){return _},nM:function(){return m},nW:function(){return U},p:function(){return z},qM:function(){return i},r1:function(){return k},sn:function(){return y},uM:function(){return p},ue:function(){return h},vN:function(){return w},vd:function(){return b},yA:function(){return V},yv:function(){return B},z2:function(){return f}});const i=1e-30,n=512,s=16777216,o=8,a=29,l=24,c=4,u=0,h=0,d=0,p=1,f=2,m=3,g=4,y=5,_=6,v=12,b=5,x=6,S=5,w=6;var T,A;(A=T||(T={}))[A.FilterFlags=0]="FilterFlags",A[A.Animation=1]="Animation",A[A.GPGPU=2]="GPGPU",A[A.VV=3]="VV",A[A.DD0=4]="DD0",A[A.DD1=5]="DD1",A[A.DD2=6]="DD2";const C=8,E=C<<1,M=1.05,R=3,P=1,O=3,I=3,L=5,N=6,D=1.15,F=2,z=128,V=256-2*F,U=2,G=10,B=1024,H=128,k=4,j=1,W=1<<20,q=.75,Z=10,$=.75,Y=256,X=32,J=512},17469:function(e,t,r){r.d(t,{Tl:function(){return T}});var i=r(67348),n=r(10793),s=r(13786),o=r(14583),a=r(96564),l=r(54904),c=r(87573);const u=22,h=4,d=u+h,p=u-6,f=3,m=Math.PI/180;class g{constructor(e,t,r,i){this._rotationT=(0,n.vt)(),this._xBounds=0,this._yBounds=0,this.minZoom=0,this.maxZoom=255,this._bounds=null;const s=r.rect,o=new Float32Array(8);e*=i,t*=i;const a=r.code?s.width*i:r.metrics.width,l=r.code?s.height*i:r.metrics.height;this.width=a,this.height=l,o[0]=e,o[1]=t,o[2]=e+a,o[3]=t,o[4]=e,o[5]=t+l,o[6]=e+a,o[7]=t+l,this._data=o,this._setTextureCoords(s),this._scale=i,this._mosaic=r,this.x=e,this.y=t,this.maxOffset=Math.max(e+a,t+l)}get mosaic(){return this._mosaic}set angle(e){this._angle=e,(0,i.$0)(this._rotationT,-e),this._setOffsets()}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){return this._offsets||this._setOffsets(),this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){const{height:e,width:t}=this._mosaic.metrics,r=t*this._scale,s=Math.abs(e)*this._scale,o=new Float32Array(8);o[0]=this.x,o[1]=this.y,o[2]=this.x+r,o[3]=this.y,o[4]=this.x,o[5]=this.y+s,o[6]=this.x+r,o[7]=this.y+s;const a=(0,i.lw)((0,n.vt)(),this._rotationT,this._transform);(0,n.gb)(o,o,a);let l=1/0,u=1/0,h=0,d=0;for(let e=0;e<4;e++){const t=o[2*e],r=o[2*e+1];l=Math.min(l,t),u=Math.min(u,r),h=Math.max(h,t),d=Math.max(d,r)}const p=h-l,f=d-u,m=l+p/2,g=u+f/2;this._bounds=new c.A(m,g,p,f)}return this._bounds}setTransform(e){this._transform=e,this._offsets=null}_setOffsets(){this._offsets||(this._offsets={topLeft:[0,0],topRight:[0,0],bottomLeft:[0,0],bottomRight:[0,0]});const e=(0,i.lw)((0,n.vt)(),this._rotationT,this._transform);this._offsets.topLeft[0]=this._data[0],this._offsets.topLeft[1]=this._data[1],this._offsets.topRight[0]=this._data[2],this._offsets.topRight[1]=this._data[3],this._offsets.bottomLeft[0]=this._data[4],this._offsets.bottomLeft[1]=this._data[5],this._offsets.bottomRight[0]=this._data[6],this._offsets.bottomRight[1]=this._data[7],(0,s.l0)(this._offsets.topLeft,this._offsets.topLeft,e),(0,s.l0)(this._offsets.topRight,this._offsets.topRight,e),(0,s.l0)(this._offsets.bottomLeft,this._offsets.bottomLeft,e),(0,s.l0)(this._offsets.bottomRight,this._offsets.bottomRight,e)}_setTextureCoords({x:e,y:t,width:r,height:i}){this._texcoords={topLeft:[e,t],topRight:[e+r,t],bottomLeft:[e,t+i],bottomRight:[e+r,t+i]}}}const y=(e,t)=>({code:0,page:0,sdf:!0,rect:new l.A(0,0,11,8),textureBinding:t,metrics:{advance:0,height:4,width:e,left:0,top:0}});function _(e,t){return e.forEach((e=>(0,s.l0)(e,e,t))),{topLeft:e[0],topRight:e[1],bottomLeft:e[2],bottomRight:e[3]}}class v{constructor(e,t,r){this._rotation=0,this._decorate(e,t,r),this.glyphs=e,this.bounds=this._createBounds(e),this.isMultiline=t.length>1,this._hasRotation=0!==r.angle,this._transform=this._createGlyphTransform(this.bounds,r),this._borderLineSizePx=r.borderLineSizePx,(r.borderLineSizePx||r.hasBackground)&&([this.bounds,this.textBox]=this.shapeBackground(this._transform));for(const t of e)t.setTransform(this._transform)}setRotation(e){if(0===e&&0===this._rotation)return;this._rotation=e;const t=this._transform,r=(0,i.$0)((0,n.vt)(),e);(0,i.lw)(t,r,t);for(const e of this.glyphs)e.setTransform(this._transform)}_decorate(e,t,r){if(!r.decoration||"none"===r.decoration||!e.length)return;const i=r.scale,n="underline"===r.decoration?d:p,s=e[0].textureBinding;for(const r of t){const t=r.startX*i,o=r.startY*i,a=(r.width+r.glyphWidthEnd)*i;e.push(new g(t,o+n*i,y(a,s),1))}}shapeBackground(e){const t=(1.5+(this._borderLineSizePx||0))/2,r=this._borderLineSizePx?t:0,{xmin:i,ymin:n,xmax:s,ymax:o,x:a,y:l,width:u,height:h}=this.bounds,d=[i-8,n-8],p=[s+8,n-8],f=[i-8,o+8],m=[s+8,o+8],g=_([[d[0]-t,d[1]-t],[p[0]+t,p[1]-t],[d[0]+r,d[1]+r],[p[0]-r,p[1]+r]],e),y=_([[f[0]+r,f[1]-r],[m[0]-r,m[1]-r],[f[0]-t,f[1]+t],[m[0]+t,m[1]+t]],e),v=_([[d[0]-t,d[1]-t],[d[0]+r,d[1]+r],[f[0]-t,f[1]+t],[f[0]+r,f[1]-r]],e),b=_([[p[0]-r,p[1]+r],[p[0]+t,p[1]-t],[m[0]-r,m[1]-r],[m[0]+t,m[1]+t]],e),x={main:_([d,p,f,m],e),top:g,bot:y,left:v,right:b};return[new c.A(a,l,u+2*t,h+2*t),x]}get boundsT(){const e=this.bounds,t=(0,s.hZ)((0,o.vt)(),e.x,e.y);if((0,s.l0)(t,t,this._transform),this._hasRotation){const r=Math.max(e.width,e.height);return new c.A(t[0],t[1],r,r)}return new c.A(t[0],t[1],e.width,e.height)}_createBounds(e){let t=1/0,r=1/0,i=0,n=0;for(const s of e)t=Math.min(t,s.xTopLeft),r=Math.min(r,s.yTopLeft),i=Math.max(i,s.xBottomRight),n=Math.max(n,s.yBottomRight);const s=i-t,o=n-r;return new c.A(t+s/2,r+o/2,s,o)}_createGlyphTransform(e,t){const r=m*t.angle,a=(0,n.vt)(),l=(0,o.vt)();return(0,i.Tl)(a,a,(0,s.hZ)(l,t.xOffset,-t.yOffset)),t.useCIMAngleBehavior?(0,i.e$)(a,a,r):((0,i.Tl)(a,a,(0,s.hZ)(l,e.x,e.y)),(0,i.e$)(a,a,r),(0,i.Tl)(a,a,(0,s.hZ)(l,-e.x,-e.y))),a}}class b{constructor(e,t,r,i,n,s){this.glyphWidthEnd=0,this.startX=0,this.startY=0,this.start=Math.max(0,Math.min(t,r)),this.end=Math.max(0,Math.max(t,r)),this.end<e.length&&(this.glyphWidthEnd=e[this.end].metrics.width),this.width=i,this.yMin=n,this.yMax=s}}const x=e=>10===e,S=e=>32===e;function w(e,t){let r=0;for(let t=0;t<e.length;t++){const{width:i}=e[t];r=Math.max(i,r)}const i="underline"===t.decoration?h:0,n=e[0].yMin;return{x:0,y:n,height:e[e.length-1].yMax+t.lineHeight*(e.length-1)+i-n,width:r}}function T(e,t){const r=t.scale,i=new Array,{glyphs:n,isRightToLeft:s}=e,o=function(e,t,r){const i=new Array,n=1/r.scale,s=r.maxLineWidth*n,o=t?e.length-1:0,a=t?-1:e.length,l=t?-1:1;let c=o,u=0,h=0,d=c,p=d,f=0,m=1/0,g=0;for(;c!==a;){const{code:t,metrics:r}=e[c],n=Math.abs(r.top);if(x(t)||S(t)||(m=Math.min(m,n),g=Math.max(g,n+r.height)),x(t))c!==o&&(i.push(new b(e,d,c-l,u,m===1/0?0:m,g)),m=1/0,g=0),u=0,d=c+l,p=c+l,h=0;else if(S(t))p=c+l,h=0,f=r.advance,u+=r.advance;else if(u>s){if(p!==d){const t=p-2*l;u-=f,i.push(new b(e,d,t,u-h,m,g)),m=1/0,g=0,d=p,u=h}else i.push(new b(e,d,c-l,u,m,g)),m=1/0,g=0,d=c,p=c,u=0;u+=r.advance,h+=r.advance}else u+=r.advance,h+=r.advance;c+=l}const y=new b(e,d,c-l,u,m,g);return y.start>=0&&y.end<e.length&&i.push(y),i}(n,s,t),l=o.length?w(o,t):{x:0,y:0,height:0,width:0},c=(0,a.xy)(t.horizontalAlignment),h=(0,a.UD)(t.verticalAlignment),d=h===a.gy.Baseline?1:0,p=d?0:h-1,m=(1-d)*-l.y+p*(l.height/2)+(d?1:0)*-u;for(let e=0;e<o.length;e++){const{start:s,end:a,width:l}=o[e];let u=-1*(c+1)*(l/2)-f;const h=e*t.lineHeight+m-f;o[e].startX=u,o[e].startY=h;for(let e=s;e<=a;e++){const t=n[e];if(x(t.code))continue;const s=new g(u+t.metrics.left,h-t.metrics.top,t,r);u+=t.metrics.advance,i.push(s)}}return new v(i,o,t)}},96700:function(e,t,r){r.d(t,{DF:function(){return a},Lu:function(){return c},RA:function(){return o},hV:function(){return l}});var i=r(13520),n=r(44740),s=(r(87416),r(57652),r(39686));const o=50;function a(e){if(!e)return null;const{xmin:t,ymin:r,xmax:i,ymax:s,spatialReference:o}=e;return new n.A({rings:[[[t,r],[t,s],[i,s],[i,r],[t,r]]],spatialReference:o})}function l(e){return(0,i.PN)(Math.round((0,i.Lz)(e)))}function c(e){const t=(0,i.PN)(s.GR),r=(0,i.PN)(s.cp);return Math.max(t,Math.min(e||r,r))}},47096:function(e,t,r){var i,n;function s(e){return null!=e&&!e.running}r.d(t,{c:function(){return n},c2:function(){return i},pi:function(){return s}}),function(e){e[e.RENDERING=0]="RENDERING",e[e.FADING=1]="FADING",e[e.FINISHED=2]="FINISHED"}(i||(i={})),function(e){e[e.RG=0]="RG",e[e.BA=1]="BA"}(n||(n={}))},75256:function(e,t,r){r.d(t,{OQ:function(){return i},ny:function(){return m}});var i,n,s=r(15774),o=r(73364),a=r(39714),l=r(20551),c=r(32501),u=r(26133),h=r(43587),d=r(47096),p=r(58192),f=r(81197);class m{constructor(){this.readChannels=d.c.RG,this.renderingStage=d.c2.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=(0,c.vt)(),this.parallax=new g,this.parallaxNew=new g,this.pointOnGround=(0,c.vt)(),this.fadeMode=i.HIDE,this.fadeFactor=0,this.opacity=0}updateParallax(e){const t=this.parallax,r=(0,l.l)(e.eye);if(t.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(r*r-h.$O.radius*h.$O.radius,0))/r,(0,u.Cr)(y,t.anchorPointClouds,_),(0,o.e$)(t.transform,a.zK,_[3],(0,u.yo)(_)),this.fadeMode===i.CROSS_FADE){const e=this.parallaxNew;(0,u.Cr)(y,e.anchorPointClouds,_),(0,o.e$)(e.transform,a.zK,_[3],(0,u.yo)(_))}}updateFading(e,t,r,i){this.isFading&&this._advanceFading(r,i),this._evaluateFading(e,t,r)}_evaluateFading(e,t,r){const n=e.relativeElevation,s=this._calculateDistanceToAnchorPoint(e);if((n>1.7*p.ni||n<-p.ni||s>w)&&this.opacity>0)this._setFade(i.HIDE,r);else if(!this.isFading)if((n>p.ni||n<-.35*p.ni||s>S)&&this.opacity>0)this._setFade(i.FADE_OUT,r);else if(n<=p.ni&&n>=-.35*p.ni&&t===f.M.IDLE&&(0,d.pi)(this.data)){if(0===this.opacity)return void this._setFade(i.FADE_IN,r);(s>x||this.renderingStage===d.c2.FADING)&&this._setFade(i.CROSS_FADE,r)}}_advanceFading(e,t){this._switchReadChannels(),this._updateAnchorPoint(),this._advanceFadingFactorAndOpacity(e,t)}_advanceFadingFactorAndOpacity(e,t){if(this.fadeFactor<1)return this.fadeFactor=t?(0,s.qE)((e-this.startTime)/(b*t),0,1):1,this.fadeMode===i.FADE_OUT&&(this.opacity=1-this.fadeFactor),this.fadeMode===i.FADE_IN&&(this.opacity=this.fadeFactor),void(this.fadeMode===i.CROSS_FADE&&(this.opacity=1));this.fadeFactor=0,this.fadeMode===i.FADE_OUT&&(this.opacity=0),this.fadeMode===i.FADE_IN&&(this.opacity=1),this.fadeMode===i.CROSS_FADE&&(this.opacity=1),this.fadeMode=i.NONE}_switchReadChannels(){const e=this.fadeMode===i.CROSS_FADE&&1===this.fadeFactor,t=this.fadeMode===i.FADE_IN&&0===this.fadeFactor;this.renderingStage===d.c2.FADING&&(e||t)&&(this.readChannels=1-this.readChannels,this.renderingStage=d.c2.FINISHED)}_calculateDistanceToAnchorPoint(e){return(0,l.n)(this.pointOnGround,e.eye),(0,l.j)(this.pointOnGround,this.pointOnGround,h.$O.radius),(0,l.l)((0,l.f)(v,this.parallax.anchorPointClouds,this.pointOnGround))}_updateAnchorPoint(){this.fadeMode===i.CROSS_FADE&&(0===this.fadeFactor&&(0,l.c)(this.parallaxNew.anchorPointClouds,this.pointOnGround),1===this.fadeFactor&&(0,l.c)(this.parallax.anchorPointClouds,this.parallaxNew.anchorPointClouds)),this.fadeMode===i.FADE_IN&&0===this.fadeFactor&&(0,l.c)(this.parallax.anchorPointClouds,this.pointOnGround)}_setFade(e,t){switch(e){case i.HIDE:this.opacity=0;break;case i.FADE_OUT:this.opacity=1;break;case i.FADE_IN:this.opacity=0;break;case i.CROSS_FADE:this.opacity=1}this.fadeMode=e,this.fadeFactor=0,this.startTime=t}get isFading(){return this.fadeMode===i.FADE_OUT||this.fadeMode===i.FADE_IN||this.fadeMode===i.CROSS_FADE}}(n=i||(i={}))[n.NONE=0]="NONE",n[n.HIDE=1]="HIDE",n[n.FADE_OUT=2]="FADE_OUT",n[n.FADE_IN=3]="FADE_IN",n[n.CROSS_FADE=4]="CROSS_FADE";class g{constructor(){this.anchorPointClouds=(0,c.vt)(),this.radiusCurvatureCorrectionFactor=0,this.transform=(0,a.vt)()}}const y=(0,c.fA)(0,0,1),_=(0,u.vt)(),v=(0,c.vt)(),b=1.25,x=34e3,S=64e3,w=2e5},58192:function(e,t,r){r.d(t,{k9:function(){return T},ni:function(){return w}});var i,n=r(53804),s=r(30905),o=r(23502),a=(r(58941),r(40633),r(13798),r(74376)),l=r(65953);let c=i=class extends s.oY{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new i({cloudCover:this.cloudCover})}};(0,n._)([(0,a.e)({cloudy:"cloudy"})],c.prototype,"type",void 0),(0,n._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0),c=i=(0,n._)([(0,l.$)("esri.views.3d.environment.CloudyWeather")],c);const u=c;var h;let d=h=class extends s.oY{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new h({fogStrength:this.fogStrength})}};(0,n._)([(0,a.e)({foggy:"foggy"})],d.prototype,"type",void 0),(0,n._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d.prototype,"fogStrength",void 0),d=h=(0,n._)([(0,l.$)("esri.views.3d.environment.FoggyWeather")],d);const p=d;var f;let m=f=class extends s.oY{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new f({cloudCover:this.cloudCover,precipitation:this.precipitation})}};(0,n._)([(0,a.e)({rainy:"rainy"})],m.prototype,"type",void 0),(0,n._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],m.prototype,"cloudCover",void 0),(0,n._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],m.prototype,"precipitation",void 0),m=f=(0,n._)([(0,l.$)("esri.views.3d.environment.RainyWeather")],m);const g=m;var y;let _=y=class extends s.oY{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new y({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};(0,n._)([(0,a.e)({snowy:"snowy"})],_.prototype,"type",void 0),(0,n._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],_.prototype,"cloudCover",void 0),(0,n._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],_.prototype,"precipitation",void 0),(0,n._)([(0,o.MZ)({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],_.prototype,"snowCover",void 0),_=y=(0,n._)([(0,l.$)("esri.views.3d.environment.SnowyWeather")],_);const v=_;var b;let x=b=class extends s.oY{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new b({cloudCover:this.cloudCover})}};(0,n._)([(0,a.e)({sunny:"sunny"})],x.prototype,"type",void 0),(0,n._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],x.prototype,"cloudCover",void 0),x=b=(0,n._)([(0,l.$)("esri.views.3d.environment.SunnyWeather")],x);const S={key:"type",base:x,typeMap:{sunny:x,cloudy:u,rainy:g,snowy:v,foggy:p}};Object.keys(S.typeMap);const w=1e4,T=1e5},44432:function(e,t,r){r.d(t,{R:function(){return l}});var i=r(93040),n=r(77472),s=r(39819),o=r(60539),a=r(90683);class l{constructor(e){this._streamDataRequester=e}async loadJSON(e,t){return this._load("json",e,t)}async loadBinary(e,t){return(0,a.DB)(e)?((0,o.Te)(t),(0,a.lJ)(e)):this._load("binary",e,t)}async loadImage(e,t){return this._load("image",e,t)}async _load(e,t,r){if(null==this._streamDataRequester)return(await(0,i.A)(t,{responseType:c[e]})).data;const a=await(0,n.Ke)(this._streamDataRequester.request(t,e,r));if(!0===a.ok)return a.value;throw(0,o.QP)(a.error),new s.A("",`Request for resource failed: ${a.error}`)}}const c={image:"image",binary:"array-buffer",json:"json","image+type":void 0}},54200:function(e,t,r){r.d(t,{G:function(){return o}});var i=r(87725),n=r(14583),s=r(44705);function o(e){if(null==e)return null;const t=null!=e.offset?e.offset:n.uY,r=null!=e.rotation?e.rotation:0,o=null!=e.scale?e.scale:n.Un,a=(0,i.fA)(1,0,0,0,1,0,t[0],t[1],1),l=(0,i.fA)(Math.cos(r),-Math.sin(r),0,Math.sin(r),Math.cos(r),0,0,0,1),c=(0,i.fA)(o[0],0,0,0,o[1],0,0,0,1),u=(0,i.vt)();return(0,s.lw)(u,l,c),(0,s.lw)(u,a,u),u}},33913:function(e,t,r){r.d(t,{x:function(){return o}});var i=r(24540),n=r(37819),s=r(85456);function o(e,t){switch(t){case s.WR.TRIANGLES:return"number"==typeof(r=e)?(0,n.tM)(r):(0,i.mg)(r)?new Uint16Array(r):r;case s.WR.TRIANGLE_STRIP:return function(e){const t="number"==typeof e?e:e.length;if(t<3)return[];const r=t-2,i=(0,n.my)(3*r);if("number"==typeof e){let e=0;for(let t=0;t<r;t+=1)t%2==0?(i[e++]=t,i[e++]=t+1,i[e++]=t+2):(i[e++]=t+1,i[e++]=t,i[e++]=t+2)}else{let t=0;for(let n=0;n<r;n+=1)n%2==0?(i[t++]=e[n],i[t++]=e[n+1],i[t++]=e[n+2]):(i[t++]=e[n+1],i[t++]=e[n],i[t++]=e[n+2])}return i}(e);case s.WR.TRIANGLE_FAN:return function(e){const t="number"==typeof e?e:e.length;if(t<3)return new Uint16Array(0);const r=t-2,i=r<=65536?new Uint16Array(3*r):new Uint32Array(3*r);if("number"==typeof e){let e=0;for(let t=0;t<r;++t)i[e++]=0,i[e++]=t+1,i[e++]=t+2;return i}const n=e[0];let s=e[1],o=0;for(let t=0;t<r;++t){const r=e[t+2];i[o++]=n,i[o++]=s,i[o++]=r,s=r}return i}(e)}var r}},43:function(e,t,r){r.d(t,{KB:function(){return a},Xi:function(){return s},pn:function(){return l},x3:function(){return o}});var i=r(58941),n=r(54407);class s{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=n.JS.KTX2_ENCODING}}function o(e){return"encoded-mesh-texture"===e?.type}async function a(e){const t=new Blob([e]),r=await t.text();return JSON.parse(r)}async function l(e,t){if(t===n.JS.KTX2_ENCODING)return new s(e);const r=new Blob([e],{type:t}),o=URL.createObjectURL(r),a=new Image;if((0,i.A)("esri-iPhone"))return new Promise(((e,t)=>{const r=()=>{n(),e(a)},i=e=>{n(),t(e)},n=()=>{URL.revokeObjectURL(o),a.removeEventListener("load",r),a.removeEventListener("error",i)};a.addEventListener("load",r),a.addEventListener("error",i),a.src=o}));try{a.src=o,await a.decode()}catch(e){console.warn("Failed decoding HTMLImageElement")}return URL.revokeObjectURL(o),a}},32680:function(e,t,r){r.d(t,{y:function(){return V}});var i,n,s=r(40633),o=r(39714),a=r(85456),l=r(39819),c=r(25738),u=r(60539),h=r(90683),d=r(58009),p=r(73364),f=r(32237),m=r(61769),g=r(92754),y=r(17190);r(58941);class _{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const t=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,t,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}}!function(e){e.SCALAR="SCALAR",e.VEC2="VEC2",e.VEC3="VEC3",e.VEC4="VEC4",e.MAT2="MAT2",e.MAT3="MAT3",e.MAT4="MAT4"}(i||(i={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(n||(n={}));var v=r(82547);const b={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},x={pbrMetallicRoughness:b,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},S={ESRI_externalColorMixMode:"tint",ESRI_receiveShadows:!0,ESRI_receiveAmbientOcclusion:!0},w=(e={})=>{const t={...b,...e.pbrMetallicRoughness},r=function(e){switch(e.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:(0,v.Xb)(e.ESRI_externalColorMixMode),e.ESRI_externalColorMixMode="tint"}return e}({...S,...e.extras});return{...x,...e,pbrMetallicRoughness:t,extras:r}},T={magFilter:a.Cj.LINEAR,minFilter:a.Cj.LINEAR_MIPMAP_LINEAR,wrapS:a.pF.REPEAT,wrapT:a.pF.REPEAT};var A=r(43);const C=1179937895;class E{constructor(e,t,r,i){if(this._context=e,this.uri=t,this.json=r,this._glbBuffer=i,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu","KHR_texture_transform"],this._baseUri=function(e){let t,r;return e.replace(/^(.*\/)?([^/]*)$/,((e,i,n)=>(t=i||"",r=n||"",""))),{dirPart:t,filePart:r}}(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),null==r.scenes)throw new l.A("gltf-loader-unsupported-feature","Scenes must be defined.");if(null==r.meshes)throw new l.A("gltf-loader-unsupported-feature","Meshes must be defined");if(null==r.nodes)throw new l.A("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(e,t,r){if((0,h.DB)(t)){const r=(0,h.r$)(t);if(r&&"model/gltf-binary"!==r.mediaType)try{const i=JSON.parse(r.isBase64?atob(r.data):r.data);return new E(e,t,i)}catch{}const i=(0,h.lJ)(t);if(E._isGLBData(i))return this._fromGLBData(e,t,i)}if(D.test(t)||"gltf"===r?.expectedType){const i=await e.loadJSON(t,r);return new E(e,t,i)}const i=await e.loadBinary(t,r);if(E._isGLBData(i))return this._fromGLBData(e,t,i);if(F.test(t)||"glb"===r?.expectedType)throw new l.A("gltf-loader-invalid-glb","This is not a valid glb file.");const n=await e.loadJSON(t,r);return new E(e,t,n)}static _isGLBData(e){if(null==e)return!1;const t=new _(e);return t.remainingBytes()>=4&&t.readUint32()===C}static async _fromGLBData(e,t,r){const i=await E._parseGLBData(r);return new E(e,t,i.json,i.binaryData)}static async _parseGLBData(e){const t=new _(e);if(t.remainingBytes()<12)throw new l.A("gltf-loader-error","glb binary data is insufficiently large.");const r=t.readUint32(),i=t.readUint32(),n=t.readUint32();if(r!==C)throw new l.A("gltf-loader-error","Magic first 4 bytes do not fit to expected glb value.");if(e.byteLength<n)throw new l.A("gltf-loader-error","glb binary data is smaller than header specifies.");if(2!==i)throw new l.A("gltf-loader-unsupported-feature","An unsupported glb container version was detected. Only version 2 is supported.");let o,a,c=0;for(;t.remainingBytes()>=8;){const e=t.readUint32(),r=t.readUint32();if(0===c){if(1313821514!==r)throw new l.A("gltf-loader-error","First glb chunk must be JSON.");if(e<0)throw new l.A("gltf-loader-error","No JSON data found.");o=await(0,A.KB)(t.readUint8Array(e))}else if(1===c){if(5130562!==r)throw new l.A("gltf-loader-unsupported-feature","Second glb chunk expected to be BIN.");a=t.readUint8Array(e)}else s.A.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 glb chunks detected. Skipping.");c+=1}if(!o)throw new l.A("gltf-loader-error","No glb JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(e,t){const r=this.json.buffers[e];if(null==r.uri){if(null==this._glbBuffer)throw new l.A("gltf-loader-error","glb buffer not present");return this._glbBuffer}const i=await this._getBufferLoader(e,t);if(i.byteLength!==r.byteLength)throw new l.A("gltf-loader-error","Buffer byte lengths should match.");return i}async _getBufferLoader(e,t){const r=this._bufferLoaders.get(e);if(r)return r;const i=this.json.buffers[e].uri,n=this._context.loadBinary(this._resolveUri(i),t).then((e=>new Uint8Array(e)));return this._bufferLoaders.set(e,n),n}async getAccessor(e,t){if(!this.json.accessors)throw new l.A("gltf-loader-unsupported-feature","Accessors missing.");const r=this.json.accessors[e];if(null==r?.bufferView)throw new l.A("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(r.type in[i.MAT2,i.MAT3,i.MAT4])throw new l.A("gltf-loader-unsupported-feature",`AttributeType ${r.type} is not supported`);const n=this.json.bufferViews[r.bufferView],s=await this.getBuffer(n.buffer,t),o=O[r.type],a=I[r.componentType],c=o*a,u=n.byteStride||c;return{raw:s.buffer,byteStride:u,byteOffset:s.byteOffset+(n.byteOffset||0)+(r.byteOffset||0),entryCount:r.count,isDenselyPacked:u===c,componentCount:o,componentByteSize:a,componentType:r.componentType,min:r.min,max:r.max,normalized:!!r.normalized}}async getIndexData(e,t){if(null==e.indices)return;const r=await this.getAccessor(e.indices,t);if(r.isDenselyPacked)switch(r.componentType){case a.pe.UNSIGNED_BYTE:return new Uint8Array(r.raw,r.byteOffset,r.entryCount);case a.pe.UNSIGNED_SHORT:return new Uint16Array(r.raw,r.byteOffset,r.entryCount);case a.pe.UNSIGNED_INT:return new Uint32Array(r.raw,r.byteOffset,r.entryCount)}else switch(r.componentType){case a.pe.UNSIGNED_BYTE:return(0,y.m)(L(g.SL,r));case a.pe.UNSIGNED_SHORT:return(0,y.m)(L(g.h,r));case a.pe.UNSIGNED_INT:return(0,y.m)(L(g.P,r))}}async getPositionData(e,t){if(null==e.attributes.POSITION)throw new l.A("gltf-loader-unsupported-feature","No POSITION vertex data found.");const r=await this.getAccessor(e.attributes.POSITION,t);if(r.componentType!==a.pe.FLOAT)throw new l.A("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+a.pe[r.componentType]);if(3!==r.componentCount)throw new l.A("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return L(g.xs,r)}async getNormalData(e,t){if(null==e.attributes.NORMAL)throw new l.A("gltf-loader-error","No NORMAL vertex data found.");const r=await this.getAccessor(e.attributes.NORMAL,t);if(r.componentType!==a.pe.FLOAT)throw new l.A("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+a.pe[r.componentType]);if(3!==r.componentCount)throw new l.A("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return L(g.xs,r)}async getTangentData(e,t){if(null==e.attributes.TANGENT)throw new l.A("gltf-loader-error","No TANGENT vertex data found.");const r=await this.getAccessor(e.attributes.TANGENT,t);if(r.componentType!==a.pe.FLOAT)throw new l.A("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+a.pe[r.componentType]);if(4!==r.componentCount)throw new l.A("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+r.componentCount.toFixed());return new g.Eq(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*r.entryCount)}async getTextureCoordinates(e,t){if(null==e.attributes.TEXCOORD_0)throw new l.A("gltf-loader-error","No TEXCOORD_0 vertex data found.");const r=await this.getAccessor(e.attributes.TEXCOORD_0,t);if(2!==r.componentCount)throw new l.A("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+r.componentCount.toFixed());if(r.componentType===a.pe.FLOAT)return L(g.gH,r);if(!r.normalized)throw new l.A("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return function(e){switch(e.componentType){case a.pe.BYTE:return new g.D6(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case a.pe.UNSIGNED_BYTE:return new g.LC(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case a.pe.SHORT:return new g.mJ(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case a.pe.UNSIGNED_SHORT:return new g.Yi(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case a.pe.UNSIGNED_INT:return new g.An(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case a.pe.FLOAT:return new g.gH(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount)}}(r)}async getVertexColors(e,t){if(null==e.attributes.COLOR_0)throw new l.A("gltf-loader-error","No COLOR_0 vertex data found.");const r=await this.getAccessor(e.attributes.COLOR_0,t);if(4!==r.componentCount&&3!==r.componentCount)throw new l.A("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+r.componentCount.toFixed());if(4===r.componentCount){if(r.componentType===a.pe.FLOAT)return L(g.Eq,r);if(r.componentType===a.pe.UNSIGNED_BYTE)return L(g.XP,r);if(r.componentType===a.pe.UNSIGNED_SHORT)return L(g.Uz,r)}else if(3===r.componentCount){if(r.componentType===a.pe.FLOAT)return L(g.xs,r);if(r.componentType===a.pe.UNSIGNED_BYTE)return L(g.eI,r);if(r.componentType===a.pe.UNSIGNED_SHORT)return L(g.nS,r)}throw new l.A("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+a.pe[r.componentType])}hasPositions(e){return void 0!==e.attributes.POSITION}hasNormals(e){return void 0!==e.attributes.NORMAL}hasVertexColors(e){return void 0!==e.attributes.COLOR_0}hasTextureCoordinates(e){return void 0!==e.attributes.TEXCOORD_0}hasTangents(e){return void 0!==e.attributes.TANGENT}async getMaterial(e,t,r){let i=e.material?this._materialCache.get(e.material):void 0;if(!i){const n=null!=e.material?w(this.json.materials[e.material]):w(),s=n.pbrMetallicRoughness,o=this.hasVertexColors(e),a=this.getTexture(s.baseColorTexture,t),l=this.getTexture(n.normalTexture,t),c=r?this.getTexture(n.occlusionTexture,t):void 0,u=r?this.getTexture(n.emissiveTexture,t):void 0,h=r?this.getTexture(s.metallicRoughnessTexture,t):void 0,d=null!=e.material?e.material:-1;i={alphaMode:n.alphaMode,alphaCutoff:n.alphaCutoff,color:s.baseColorFactor,doubleSided:!!n.doubleSided,colorTexture:await a,normalTexture:await l,name:n.name,id:d,occlusionTexture:await c,emissiveTexture:await u,emissiveFactor:n.emissiveFactor,metallicFactor:s.metallicFactor,roughnessFactor:s.roughnessFactor,metallicRoughnessTexture:await h,hasVertexColors:o,ESRI_externalColorMixMode:n.extras.ESRI_externalColorMixMode,colorTextureTransform:s?.baseColorTexture?.extensions?.KHR_texture_transform,normalTextureTransform:n.normalTexture?.extensions?.KHR_texture_transform,occlusionTextureTransform:n.occlusionTexture?.extensions?.KHR_texture_transform,emissiveTextureTransform:n.emissiveTexture?.extensions?.KHR_texture_transform,metallicRoughnessTextureTransform:s?.metallicRoughnessTexture?.extensions?.KHR_texture_transform,receiveAmbientOcclusion:n.extras.ESRI_receiveAmbientOcclusion,receiveShadows:n.extras.ESRI_receiveShadows}}return i}async getTexture(e,t){if(!e)return;if(0!==(e.texCoord||0))throw new l.A("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const r=e.index,i=this.json.textures[r],n=(u=null!=i.sampler?this.json.samplers[i.sampler]:{},{...T,...u}),s=N(i),o=this.json.images[s],a=await this._loadTextureImageData(r,i,t);var u;return(0,c.tE)(this._textureCache,r,(()=>{const e=e=>33071===e||33648===e||10497===e,t=e=>{throw new l.A("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${e}`)};return{data:a,wrapS:e(n.wrapS)?n.wrapS:t(n.wrapS),wrapT:e(n.wrapT)?n.wrapT:t(n.wrapT),minFilter:n.minFilter,name:o.name,id:r}}))}getNodeTransform(e){if(void 0===e)return M;let t=this._nodeTransformCache.get(e);if(!t){const r=this.getNodeTransform(this._getNodeParent(e)),i=this.json.nodes[e];i.matrix?t=(0,p.lw)((0,o.vt)(),r,i.matrix):i.translation||i.rotation||i.scale?(t=(0,o.o8)(r),i.translation&&(0,p.Tl)(t,t,i.translation),i.rotation&&(P[3]=(0,f.Xd)(P,i.rotation),(0,p.e$)(t,t,P[3],P)),i.scale&&(0,p.hs)(t,t,i.scale)):t=(0,o.o8)(r),this._nodeTransformCache.set(e,t)}return t}_resolveUri(e){return(0,h.s2)(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=d.R.parse(this.json.asset.version,"glTF");R.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every((e=>this._supportedExtensions.includes(e))))throw new l.A("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach(((e,t)=>{e.children&&e.children.forEach((e=>{this._nodeParentMap.set(e,t)}))}))}async _loadTextureImageData(e,t,r){const i=this._textureLoaders.get(e);if(i)return i;const n=this._createTextureLoader(t,r);return this._textureLoaders.set(e,n),n}async _createTextureLoader(e,t){const r=N(e),i=this.json.images[r];if(i.uri){if(i.uri.endsWith(".ktx2")){const e=await this._context.loadBinary(this._resolveUri(i.uri),t);return new A.Xi(new Uint8Array(e))}return this._context.loadImage(this._resolveUri(i.uri),t)}if(null==i.bufferView)throw new l.A("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(null==i.mimeType)throw new l.A("gltf-loader-unsupported-feature","Image mimeType must be defined.");const n=this.json.bufferViews[i.bufferView],s=await this.getBuffer(n.buffer,t);if(null!=n.byteStride)throw new l.A("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const o=s.byteOffset+(n.byteOffset||0);return(0,A.pn)(new Uint8Array(s.buffer,o,n.byteLength),i.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const e=await(0,u.nA)(Array.from(this._bufferLoaders.values())),t=await(0,u.nA)(Array.from(this._textureLoaders.values()));return e.reduce(((e,t)=>e+(t?.byteLength??0)),0)+t.reduce(((e,t)=>e+(t?(0,A.x3)(t)?t.data.byteLength:t.width*t.height*4:0)),0)}}const M=(0,p.hM)((0,o.vt)(),Math.PI/2),R=new d.R(2,0,"glTF"),P=(0,m.vt)(),O={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},I={[a.pe.BYTE]:1,[a.pe.UNSIGNED_BYTE]:1,[a.pe.SHORT]:2,[a.pe.UNSIGNED_SHORT]:2,[a.pe.HALF_FLOAT]:2,[a.pe.FLOAT]:4,[a.pe.INT]:4,[a.pe.UNSIGNED_INT]:4};function L(e,t){return new e(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*(t.entryCount-1)+t.componentByteSize*t.componentCount)}function N(e){if(null!=e.extensions?.KHR_texture_basisu)return e.extensions.KHR_texture_basisu.source;if(null!==e.source)return e.source;throw new l.A("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}const D=/\.gltf$/i,F=/\.glb$/i;let z=0;async function V(e,t,r={},i=!0){const n=await E.load(e,t,r),l="gltf_"+z++,c={lods:[],materials:new Map,textures:new Map,meta:U(n)},u=!(!n.json.asset.extras||"symbolResource"!==n.json.asset.extras.ESRI_type),h=n.json.asset.extras?.ESRI_webstyleSymbol?.webstyle,d=new Map;await G(n,(async(e,t,u,h)=>{const p=d.get(u)??0;d.set(u,p+1);const f=void 0!==e.mode?e.mode:a.WR.TRIANGLES,m=f===a.WR.TRIANGLES||f===a.WR.TRIANGLE_STRIP||f===a.WR.TRIANGLE_FAN?f:null;if(null==m)return void s.A.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+a.WR[f]+"). Skipping primitive.");if(!n.hasPositions(e))return void s.A.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const g=n.getPositionData(e,r),y=n.getMaterial(e,r,i),_=n.hasNormals(e)?n.getNormalData(e,r):null,v=n.hasTangents(e)?n.getTangentData(e,r):null,b=n.hasTextureCoordinates(e)?n.getTextureCoordinates(e,r):null,x=n.hasVertexColors(e)?n.getVertexColors(e,r):null,S=n.getIndexData(e,r),w={name:h,transform:(0,o.o8)(t),attributes:{position:await g,normal:_?await _:null,texCoord0:b?await b:null,color:x?await x:null,tangent:v?await v:null},indices:await S,primitiveType:m,material:H(c,await y,l)};let T=null;null!=c.meta?.ESRI_lod&&"screenSpaceRadius"===c.meta.ESRI_lod.metric&&(T=c.meta.ESRI_lod.thresholds[u]),c.lods[u]=c.lods[u]||{parts:[],name:h,lodThreshold:T},c.lods[u].parts[p]=w}));for(const e of c.lods)e.parts=e.parts.filter((e=>!!e));const p=await n.getLoadedBuffersSize();return{model:c,meta:{isEsriSymbolResource:u,uri:n.uri,ESRI_webstyle:h},customMeta:{},size:p}}function U(e){const t=e.json;let r=null;return t.nodes.forEach((e=>{const t=e.extras;null!=t&&(t.ESRI_proxyEllipsoid||t.ESRI_lod)&&(r=t)})),r}async function G(e,t){const r=e.json,i=r.scenes[r.scene||0].nodes,n=i.length>1,o=[];for(const e of i){const t=r.nodes[e];o.push(a(e,0)),B(t)&&!n&&t.extensions.MSFT_lod.ids.forEach(((e,t)=>a(e,t+1)))}async function a(i,n){const l=r.nodes[i],c=e.getNodeTransform(i);if(null!=l.weights&&s.A.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),null!=l.mesh){const e=r.meshes[l.mesh];for(const r of e.primitives)o.push(t(r,c,n,e.name))}for(const e of l.children||[])o.push(a(e,n))}await Promise.all(o)}function B(e){return e.extensions?.MSFT_lod&&Array.isArray(e.extensions.MSFT_lod.ids)}function H(e,t,r){const i=t=>{const i=`${r}_tex_${t&&t.id}${t?.name?"_"+t.name:""}`;if(t&&!e.textures.has(i)){const r=function(e,t={}){return{data:e,parameters:{wrap:{s:a.pF.REPEAT,t:a.pF.REPEAT,...t.wrap},noUnpackFlip:!0,mipmap:!1,...t}}}(t.data,{wrap:{s:t.wrapS,t:t.wrapT},mipmap:k.has(t.minFilter),noUnpackFlip:!0});e.textures.set(i,r)}return i},n=`${r}_mat_${t.id}_${t.name}`;if(!e.materials.has(n)){const r=function(e={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...e}}({color:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,colorMixMode:t.ESRI_externalColorMixMode,textureColor:t.colorTexture?i(t.colorTexture):void 0,textureNormal:t.normalTexture?i(t.normalTexture):void 0,textureOcclusion:t.occlusionTexture?i(t.occlusionTexture):void 0,textureEmissive:t.emissiveTexture?i(t.emissiveTexture):void 0,textureMetallicRoughness:t.metallicRoughnessTexture?i(t.metallicRoughnessTexture):void 0,emissiveFactor:[t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2]],colorTextureTransform:t.colorTextureTransform,normalTextureTransform:t.normalTextureTransform,occlusionTextureTransform:t.occlusionTextureTransform,emissiveTextureTransform:t.emissiveTextureTransform,metallicRoughnessTextureTransform:t.metallicRoughnessTextureTransform,metallicFactor:t.metallicFactor,roughnessFactor:t.roughnessFactor,receiveShadows:t.receiveShadows,receiveAmbientOcclustion:t.receiveAmbientOcclusion});e.materials.set(n,r)}return n}const k=new Set([a.Cj.LINEAR_MIPMAP_LINEAR,a.Cj.LINEAR_MIPMAP_NEAREST])},27002:function(e,t,r){r.r(t),r.d(t,{default:function(){return dd}});var i=r(53804),n=r(39819),s=r(95929),o=r(28181),a=r(23502),l=r(58941),c=r(40633),u=(r(13798),r(65953)),h=r(61226),d=r(60539),p=r(52313);const f=e=>{let t=class extends e{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(){super.postscript(),(0,p.jI)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const e=new AbortController,t=e.signal;this.addHandles((0,h.hA)((()=>e.abort()))),await(0,o.C_)((()=>this.view.defaultsFromMap?.heightModelInfoReady),t),(0,d.Te)(t);const r=(0,p.Hu)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(r)throw r}};return(0,i._)([(0,a.MZ)()],t.prototype,"view",void 0),(0,i._)([(0,a.MZ)()],t.prototype,"slicePlaneEnabled",void 0),t=(0,i._)([(0,u.$)("esri.views.3d.layers.LayerView3D")],t),t};r(50917);var m=r(32501),g=r(56763),y=r(46460),_=r(68945),v=r(49618),b=r(76589),x=r(68546),S=r(57165),w=r(59469),T=r(83525),A=r(78879),C=r(72952),E=r(20248),M=r(20833),R=r(45328),P=r(52874),O=r(70481);function I(e,t){if(!e||e.symbol)return null;const r=t?.renderer;return e&&null!=r&&r.getObservationRenderer?r.getObservationRenderer(e):r}var L=r(7926),N=r(46949),D=r(41546);const F=D.uY;r(74865),r(1526),r(96173),r(52308),r(60189),r(30047),r(27777);var z=r(61065),V=(r(6537),r(10748),r(50659)),U=r(25738),G=r(85408),B=r(7187),H=r(74087),k=r(20551),j=r(46157),W=r(57617),q=r(68734),Z=r(74802),$=r(24761),Y=r(87416),X=r(57652),J=r(37151),Q=r(47558),K=r(11299);function ee(e){return null==e||"simple"===e.type||"unique-value"===e.type||"class-breaks"===e.type||"dictionary"===e.type||"heatmap"===e.type}function te(e,t){if(!t)return null;let r;if(r=Array.isArray(t)?t:[t],r.length>0){const t=r.map((e=>e.details.symbol.type||e.details.symbol.declaredClass)).filter((e=>!!e));t.sort();const i=[];return t.forEach(((e,r)=>{0!==r&&e===t[r-1]||i.push(e)})),new n.A("renderer-conversion-3d:unsupported-symbols",`Renderer contains symbols (${i.join(", ")}) which are not supported in 3D`,{renderer:e,symbolErrors:r})}return null}var re=r(54547),ie=r(51107),ne=r(40990),se=r(82547),oe=r(93854);var ae=r(8470),le=r(65839);class ce{constructor(e,t=null){this.geometry=e,this.textures=t}}class ue{constructor(e,t,r){this.components=e,this.minScreenSpaceRadius=t,this.pivotOffset=r;const i=this.geometries;this.numVertices=i.reduce(((e,t)=>e+t.attributes.get(le.r.POSITION).indices.length),0)}get geometries(){return(0,V.Am)(this.components.map((e=>e.geometry)))}}class he{constructor(e){this.levels=e,this.levels.sort(((e,t)=>e.minScreenSpaceRadius===t.minScreenSpaceRadius?e.numVertices-t.numVertices:e.minScreenSpaceRadius-t.minScreenSpaceRadius))}}function de(e){const t=[];return e.levels.forEach((e=>e.components.forEach((e=>t.push(e.geometry.material))))),(0,V.Am)(t)}function pe(e){const t=new Array;return e.levels.forEach((e=>e.components.forEach((e=>{null!=e.textures&&t.push(...e.textures)})))),(0,V.Am)(t)}function fe(e){const t=new Array;return e.levels.forEach((e=>e.components.forEach((e=>t.push(e.geometry))))),(0,V.Am)(t)}function me(e,t){const r=(e,t,r=!1)=>new he(e.map((e=>{const i=t(e.tesselation);return r&&(0,ae.zC)(i),new ue([new ce(i)],e.minScreenSpaceRadius)})));switch(e){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],(e=>(0,ae.uX)(t,.5,e,!0)));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],(()=>(0,ae.C1)(t,1)));case"cone":return r(ge,(e=>(0,ae.EE)(t,1,.5,e,!1)),!0);case"inverted-cone":return r(ge,(e=>(0,ae.EE)(t,1,.5,e,!0)),!0);case"cylinder":return r(ge,(e=>(0,ae.nW)(t,1,.5,e,[0,0,1],[0,0,.5])));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],(()=>(0,ae.Ho)(t,1)),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],(()=>(0,ae.td)(t,1)),!0);default:return}}const ge=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];class ye{constructor(e){this.estimated=!1,this.verticesPerFeature=e.verticesPerFeature??0,this.verticesPerCoordinate=e.verticesPerCoordinate??0,this.drawCallsPerFeature=e.drawCallsPerFeature??0,this.memory=e.memory??new xe}}class _e extends ye{constructor(e){super(e),this.estimated=!0}}class ve extends ye{constructor(e,t){super(t),this.numComplexities=e}}class be extends _e{constructor(e,t){super(t),this.numComplexities=e}}class xe{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}}var Se=r(26586),we=r(42674);const Te=new _e({});function Ae(e){let t=0,r=0,i=0,n=!1,s=0;const o=new xe;for(const a of e)null!=a&&(t+=a.verticesPerFeature,r+=a.verticesPerCoordinate,i+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,n=n||a.estimated,++s);return n?new be(s,{verticesPerFeature:t,verticesPerCoordinate:r,drawCallsPerFeature:i,memory:o}):new ve(s,{verticesPerFeature:t,verticesPerCoordinate:r,drawCallsPerFeature:i,memory:o})}const Ce={};function Ee(e,t){const r=Me(e,t),i=(0,Se.RF)(t)?2:0;switch(t.type){case"extrude":return new ye({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:i,memory:r});case"fill":if("mesh-3d"===e.type)return new ye({drawCallsPerFeature:i,memory:r});if(null!=t.outline&&t.outline.size>0)return new ye({verticesPerFeature:-12,verticesPerCoordinate:9,memory:r});case"water":return new ye({verticesPerFeature:-6,verticesPerCoordinate:3,memory:r});case"line":return new ye({verticesPerFeature:-6,verticesPerCoordinate:6,memory:r});case"object":return t.resource?.href?new _e({verticesPerFeature:100,memory:r}):{...Re(t.resource?.primitive??oe.r),memory:r};case"path":{let e=0,i=0;switch(t.profile){case"circle":e=10;break;case"quad":e=4;break;default:return void(0,se.Xb)(t.profile)}switch(t.join){case"round":i=3;break;case"miter":case"bevel":i=1;break;default:return}const n=2*e,s=e*i*2,o=s+n;let a=-2*s-n;switch(t.cap){case"none":break;case"butt":case"square":a+=2*(e-1);break;case"round":a+=2*(2*e*2+e);break;default:return}return new ye({verticesPerFeature:a,verticesPerCoordinate:o,memory:r})}case"text":case"icon":return new ye({verticesPerFeature:6,memory:r});default:return}}function Me(e,t){const r="point-3d"===e.type;switch(t.type){case"extrude":return t.edges&&t.edges.size>0?Oe.EXTRUDE_EDGES:Oe.EXTRUDE;case"fill":return null!=t.outline&&t.outline.size>0?Oe.FILL_OUTLINE:Oe.FILL;case"water":return Oe.FILL;case"line":return"round"===t.join?Oe.LINE_ROUND:Oe.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return Oe.PATH_ROUND_CIRCLE;case"quad":return Oe.PATH_ROUND_QUAD;default:return void(0,se.Xb)(t.profile)}case"miter":case"bevel":switch(t.profile){case"circle":return Oe.PATH_MITER_CIRCLE;case"quad":return Oe.PATH_MITER_QUAD;default:return void(0,se.Xb)(t.profile)}default:return}case"object":return r?Oe.OBJECT_POINT:Oe.OBJECT_POLYGON;case"icon":case"text":return r?Oe.ICON_POINT:Oe.ICON_POLYGON;default:return}}function Re(e){const t=Ce[e];if(t)return t;const r=Pe(me(e,new we.$U({})).levels);return Ce[e]=new ye({verticesPerFeature:r}),Ce[e]}function Pe(e){return e.reduce(((e,t,r)=>e+t.numVertices*(1/10**r)),0)/e.reduce(((e,t,r)=>e+1/10**r),0)}const Oe={ICON_POINT:{bytesPerFeature:2379.8272296852992,bytesPerFeatureLabel:852.246235,resourceBytes:0,draped:{bytesPerFeature:1868.2382921559424,bytesPerFeatureLabel:839.205415}},ICON_POLYGON:{bytesPerFeature:2957.8429876524656,bytesPerFeatureLabel:862.5307816666666,resourceBytes:0,draped:{bytesPerFeature:2579.7767085451133,bytesPerFeatureLabel:856.9298550000001}},OBJECT_POINT:{bytesPerFeature:603.543820573039,bytesPerFeatureLabel:717.4551849999999,resourceBytes:0,draped:{bytesPerFeature:603.543820573039,bytesPerFeatureLabel:717.4551849999999}},OBJECT_POLYGON:{bytesPerFeature:1111.1693389308373,bytesPerFeatureLabel:707.4535949999998,resourceBytes:0,draped:{bytesPerFeature:1111.1693389308373,bytesPerFeatureLabel:707.4535949999998}},LINE_MITER:{bytesPerFeature:3081.208408220661,bytesPerFeatureLabel:858.6749016666668,resourceBytes:0,draped:{bytesPerFeature:2682.57863388475,bytesPerFeatureLabel:844.6118016666666}},LINE_ROUND:{bytesPerFeature:3209.3236242927915,bytesPerFeatureLabel:858.1810416666667,resourceBytes:0,draped:{bytesPerFeature:2687.6256038096126,bytesPerFeatureLabel:849.578535}},PATH_MITER_CIRCLE:{bytesPerFeature:38708.74276663992,bytesPerFeatureLabel:858.70415,resourceBytes:0,draped:{bytesPerFeature:38708.74276663992,bytesPerFeatureLabel:858.70415}},PATH_ROUND_CIRCLE:{bytesPerFeature:42098.00590216518,bytesPerFeatureLabel:868.3632500000001,resourceBytes:0,draped:{bytesPerFeature:42098.00590216518,bytesPerFeatureLabel:868.3632500000001}},PATH_MITER_QUAD:{bytesPerFeature:25037.823002405767,bytesPerFeatureLabel:835.93355,resourceBytes:0,draped:{bytesPerFeature:25037.823002405767,bytesPerFeatureLabel:835.93355}},PATH_ROUND_QUAD:{bytesPerFeature:40320.254760224525,bytesPerFeatureLabel:851.66955,resourceBytes:0,draped:{bytesPerFeature:40320.254760224525,bytesPerFeatureLabel:851.66955}},FILL:{bytesPerFeature:3147.43349219103,bytesPerFeatureLabel:850.7598550000001,resourceBytes:0,draped:{bytesPerFeature:2673.7898488975106,bytesPerFeatureLabel:846.6459950000002}},FILL_OUTLINE:{bytesPerFeature:4565.099993465867,bytesPerFeatureLabel:855.334515,resourceBytes:0,draped:{bytesPerFeature:3904.46969705314,bytesPerFeatureLabel:844.7081016666667}},EXTRUDE:{bytesPerFeature:7551.2282834569505,bytesPerFeatureLabel:849.5513283333333,resourceBytes:0,draped:{bytesPerFeature:7551.2282834569505,bytesPerFeatureLabel:849.5513283333333}},EXTRUDE_EDGES:{bytesPerFeature:2959.8379634500698,bytesPerFeatureLabel:602.0969283333335,resourceBytes:0,draped:{bytesPerFeature:2959.8379634500698,bytesPerFeatureLabel:602.0969283333335}}};class Ie{constructor(e,t,r){this.maximumTotalNumberOfVertices=e,this.maximumNumberOfFeatures=t,this.averageSymbolComplexity=r}}var Le,Ne,De=r(48961);r(71673);class Fe{constructor(e,t){this.spatialReference=e,this._view=t}getElevation(e,t,r){return this._view.elevationProvider.getElevation(e,t,0,this.spatialReference,r)}async queryElevation(e,t,r,i,n){return this._view.elevationProvider.queryElevation(e,t,0,this.spatialReference,n,r,i)}}!function(e){e[e.USER=1]="USER",e[e.SCALE_RANGE=2]="SCALE_RANGE",e[e.FILTER=4]="FILTER",e[e.DECONFLICTION=8]="DECONFLICTION",e[e.ALL_GRAPHIC=15]="ALL_GRAPHIC",e[e.ALL_LABEL=255]="ALL_LABEL"}(Le||(Le={})),function(e){e[e.GRAPHIC=1]="GRAPHIC",e[e.LABEL=16]="LABEL"}(Ne||(Ne={}));var ze=r(48996),Ve=r(65215),Ue=r(76613),Ge=r(46805);const Be=(0,$.vt)();let He=class extends T.A{constructor(e){super(e),this.events=new ze.A,this.hasZ=null,this.hasM=null,this.objectIdField=null,this.featureAdapter={getAttribute:(e,t)=>"graphic"in e?e.graphic.attributes[t]:Ge.T.getAttribute(e,t),getAttributes:e=>"graphic"in e?e.graphic.attributes:Ge.T.getAttributes(e),getObjectId:e=>"graphic"in e?(0,J.RW)(e.graphic,this.objectIdField)??void 0:Ge.T.getObjectId(e),getGeometry:e=>"graphic"in e?e.getAsOptimizedGeometry(this.hasZ,this.hasM):Ge.T.getGeometry(e),getCentroid:(e,t)=>{if("graphic"in e){let r=null;null!=e.centroid?r=e.centroid:"point"===e.graphic.geometry.type&&(0,j.projectPoint)(e.graphic.geometry,ke,this.viewSpatialReference)&&(r=ke);const i=new Array(2+(t.hasZ?1:0)+(t.hasM?1:0));return null==r?(i[0]=0,i[1]=0,i[2]=0,i[3]=0):(i[0]=r.x,i[1]=r.y,t.hasZ&&(i[2]=r.hasZ?r.z:0),t.hasM&&(i[t.hasZ?3:2]=r.hasM?r.m:0)),new Ue.A([],i)}return Ge.T.getCentroid(e,t)},cloneWithGeometry:(e,t)=>"graphic"in e?new Ve.Om(t,this.featureAdapter.getAttributes(e),null,this.featureAdapter.getObjectId(e)):Ge.T.cloneWithGeometry(e,t)}}forEachInBounds(e,t){this.getSpatialIndex().forEachInBounds(e,t)}forEachBounds(e,t){const r=this.getSpatialIndex();for(const i of e){const e=this.featureAdapter.getObjectId(i);null!=r.getBounds(e,Be)&&t(Be)}}};(0,i._)([(0,a.MZ)({constructOnly:!0})],He.prototype,"getSpatialIndex",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],He.prototype,"forEach",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],He.prototype,"hasZ",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],He.prototype,"hasM",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],He.prototype,"objectIdField",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],He.prototype,"viewSpatialReference",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],He.prototype,"featureSpatialReference",void 0),He=(0,i._)([(0,u.$)("esri.views.3d.layers.graphics.Graphics3DFeatureStore")],He);const ke={type:"point",x:0,y:0,hasZ:!1,hasM:!1,spatialReference:null};class je{constructor(e,t,r){this.graphic=e,this.renderingInfo=t,this.layer=r}}class We{constructor(e,t){this.scheduler=e,this.schedule=t,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}}var qe=r(77472),Ze=r(58608),$e=r(13520),Ye=r(73364),Xe=r(39714),Je=r(7456),Qe=r(70974),Ke=r(60516),et=r(40321);function tt(e){return null!=e.mapPositions}function rt(e,t,r,i,n){const s=e.stageObject,o=s.geometries;let a=0;for(const e of o){if(!tt(e))continue;const{update:o,averageGeometrySampledElevation:l}=ft(e,t,r,i,n);a+=l,o&&s.geometryVertexAttributeUpdated(e,le.r.POSITION)}return a/o.length}function it(e,t,r,i,n,s){const o=e.stageObject,a=t.centerPointInElevationSR;let l=0;o.usesVerticalDistanceToGround?(i(a,pt),(0,v.ai)(o,pt.verticalDistanceToGround),l=pt.sampledElevation):(i(a,pt),"absolute-height"!==t.mode&&(l=pt.sampledElevation));const c=(0,Ye.C)(nt,s??o.transformation),u=(0,k.s)(dt,c[12],c[13],c[14]);Qe.b.TESTS_DISABLE_OPTIMIZATIONS?(lt[0]=a.x,lt[1]=a.y,lt[2]=pt.z,(0,Je.l)(a.spatialReference,lt,c,n.spatialReference)&&(s?(0,Ye.C)(s,c):o.transformation=c)):n.setAltitudeOfTransformation(pt.z,c);const h=at/n.unitInMeters;return(Math.abs(c[12]-u[0])>=h||Math.abs(c[13]-u[1])>=h||Math.abs(c[14]-u[2])>=h)&&(s?(0,Ye.C)(s,c):o.transformation=c),l}const nt=(0,Xe.vt)();function st(e,t,r,i,n){const s=e.graphics3DSymbolLayer.lodRenderer;if(null==s)return 0;const o=t.centerPointInElevationSR;i(o,pt);const a="absolute-height"!==t.mode?pt.sampledElevation:0,l=s.instanceData,c=e.instanceIndex,u=ht;l.getGlobalTransform(c,u);const h=(0,k.s)(dt,u[12],u[13],u[14]);Qe.b.TESTS_DISABLE_OPTIMIZATIONS?(lt[0]=o.x,lt[1]=o.y,lt[2]=pt.z,(0,Je.l)(o.spatialReference,lt,u,n.spatialReference)&&l.setGlobalTransform(c,u)):n.setAltitudeOfTransformation(pt.z,u);const d=at/n.unitInMeters;return(Qe.b.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(u[12]-h[0])>=d||Math.abs(u[13]-h[1])>=d||Math.abs(u[14]-h[2])>=d)&&l.setGlobalTransform(c,u),a}function ot(e,t,r,i,n){const s=e.stageObject,o=s.geometries;if(0===o.length)return 0;let a=0,l=null,c=0,u=!1;for(const e of o){if(!tt(e))continue;const o=e.attributes.get(le.r.POSITION);if(o!==l){const{update:s,averageGeometrySampledElevation:a}=ft(e,t,r,i,n);c=a,l=o,u=s}u&&s.geometryVertexAttributeUpdated(e,le.r.POSITION),a+=c}return a/o.length}const at=.01,lt=(0,m.vt)(),ct=(0,m.vt)(),ut=(0,m.vt)(),ht=(0,Xe.vt)(),dt=(0,m.vt)(),pt=new v.Uk;function ft(e,t,r,i,n){let s=!1;const o=e.transformation,a=t.requiresSampledElevationInfo;ct[0]=o[12],ct[1]=o[13],ct[2]=o[14],e.invalidateBoundingInfo();const l=e.getMutableAttribute(le.r.POSITION),c=l.data,u=l.size,h=c.length/u,d=new Ke.aY(e.mapPositions,r);let p=0,f=0;for(let e=0;e<h;e++){if(ut[0]=c[p],ut[1]=c[p+1],ut[2]=c[p+2],i(d,pt),a&&(f+=pt.sampledElevation),Qe.b.TESTS_DISABLE_OPTIMIZATIONS)c[p]=d.array[d.offset],c[p+1]=d.array[d.offset+1],c[p+2]=pt.z,(0,W.projectBuffer)(c,r,p,c,n.spatialReference,p,1),c[p]-=ct[0],c[p+1]-=ct[1],c[p+2]-=ct[2],s=!0;else{lt[0]=c[p]+ct[0],lt[1]=c[p+1]+ct[1],lt[2]=c[p+2]+ct[2],n.setAltitude(lt,pt.z),c[p]=lt[0]-ct[0],c[p+1]=lt[1]-ct[1],c[p+2]=lt[2]-ct[2];const e=at/n.unitInMeters;(Math.abs(ut[0]-c[p])>=e||Math.abs(ut[1]-c[p+1])>=e||Math.abs(ut[2]-c[p+2])>=e)&&(s=!0)}p+=u,d.offset+=3}return f/=h,{update:s,averageGeometrySampledElevation:f}}var mt=r(90599),gt=r(75302),yt=r(54407),_t=r(33753);class vt{constructor(e,t,r){this.baseMaterial=e,this.edgeMaterials=t,this.properties=r}}class bt{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,t,r,i,n,s,o,a=null){this.graphics3DSymbolLayer=e,this.stageObject=t,this._uniqueGeometries=r,this._uniqueMaterials=i,this._sharedResource=n,this.elevationAligner=s,this.elevationContext=o,this._edgeState=a,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const t=e.stage;t.addMany(this._uniqueMaterials),t.addMany(this._uniqueGeometries),t.add(this.stageObject)}destroy(){if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1),e.renderer.edgeView?.removeObject(this.stageObject),this.stageObject.dispose(),this._sharedResource?.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,t){const{stageObject:r,_edgeState:i,_stageLayer:n}=this;if(null==i)return;const s=xt(i.baseMaterial);let o=!1;for(const e of i.edgeMaterials)e.objectTransparency!==s&&(e.objectTransparency=s,o=!0);o&&this.resetEdgeObject(t),n.stage.renderer.withEdgeView((t=>{t.updateAllComponentOpacities(r,[e])}))}slicePlaneEnabledChanged(e,t){const{stageObject:r,_edgeState:i,_stageLayer:n}=this;null!=i&&n.stage.renderer.withEdgeView((n=>{n.updateAllComponentMaterials(r,i.edgeMaterials,{hasSlicePlane:e},!t),i.properties.hasSlicePlane=e}))}setVisibility(e){const{_edgeState:t,stageObject:r,_stageLayer:i}=this;null!=i&&this.visible!==e&&(this._visible=e,r.visible=e,e&&!this._addedToStage&&(i.add(r),this._addedToStage=!0),null!=t&&i.stage.renderer.withEdgeView((i=>{i.hasObject(r)?i.updateObjectVisibility(r,e):e&&this._addOrUpdateEdgeObject(t,i,!1)})))}get visible(){return this._visible}alignWithElevation(e,t,r,i){null!=this.elevationAligner&&(null!=r&&(0,x.gf)(this.elevationContext.featureExpressionInfoContext,r),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,((r,i)=>(0,v.sE)(r,e,this.elevationContext,t,i)),t),this.resetEdgeObject(i))}alignWithAbsoluteElevation(e,t,r){this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,((t,r)=>{r.sampledElevation=e,r.verticalDistanceToGround=0,r.z=e}),t),this.resetEdgeObject(r)}getCenterObjectSpace(e=(0,m.vt)()){return(0,k.c)(e,(0,mt.g)(this.stageObject.boundingVolumeObjectSpace.bounds))}getBoundingBoxObjectSpace(e=(0,$.vt)()){const t=this.stageObject.boundingVolumeObjectSpace;return(0,$.Ne)(e,t.min),(0,$.vI)(e,t.max),e}computeAttachmentOrigin(e){const t=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=t[12],e.render.origin[1]+=t[13],e.render.origin[2]+=t[14],e.render.num++;else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(Tt)&&((0,k.h)(Tt,Tt,t),(0,k.g)(e.render.origin,e.render.origin,Tt),e.render.num++)}async getProjectedBoundingBox(e,t,r,i,n){const s=this.getBoundingBoxObjectSpace(n),o=At,a=(0,$.fT)(s)?1:o.length;for(let e=0;e<a;e++){const t=o[e];wt[0]=s[t[0]],wt[1]=s[t[1]],wt[2]=s[t[2]],(0,k.h)(wt,wt,this.stageObject.transformation),St[3*e]=wt[0],St[3*e+1]=wt[1],St[3*e+2]=wt[2]}if(!e(St,0,a))return null;(0,$.Ie)(s);let l=null;this.calculateRelativeScreenBounds&&(l=this.calculateRelativeScreenBounds());for(let e=0;e<3*a;e+=3){for(let t=0;t<3;t++)s[t]=Math.min(s[t],St[e+t]),s[t+3]=Math.max(s[t+3],St[e+t]);l&&r.push({location:St.slice(e,e+3),screenSpaceBoundingRect:l})}if(t?.service&&"absolute-height"!==this.elevationContext.mode){(0,$.gX)(s,Tt);const e="relative-to-scene"===this.elevationContext.mode?"scene":"ground";let r=0;if(t.useViewElevation)r=t.service.getElevation(Tt[0],Tt[1],e)??0;else try{const n=(0,gt.vY)(s,t.service.spatialReference,t);r=await t.service.queryElevation(Tt[0],Tt[1],i,n,e)??0}catch(e){}(0,$.cY)(s,0,0,-this.alignedSampledElevation+r)}return s}addObjectState(e,t){e===yt.Mg.Highlight&&t.addObject(this.stageObject,this.stageObject.highlight()),e===yt.Mg.MaskOccludee&&t.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}resetEdgeObject(e){const{_edgeState:t,stageObject:r,_stageLayer:i,_visible:n}=this;null!=t&&i.stage.renderer.withEdgeView((i=>{n?this._addOrUpdateEdgeObject(t,i,e):i.removeObject(r)}))}_addOrUpdateEdgeObject(e,t,r){const i=xt(e.baseMaterial);for(const t of e.edgeMaterials)t.objectTransparency=i;t.addOrUpdateObject3D(this.stageObject,e.edgeMaterials,e.properties,!r).then((()=>this._stageLayer?.sync()))}}function xt(e){return e.isVisible()?e.parameters.transparent?_t.x.TRANSPARENT:_t.x.OPAQUE:_t.x.INVISIBLE}const St=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],wt=(0,m.vt)(),Tt=(0,m.vt)(),At=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];class Ct{constructor(e,t=null){this.labelText=t,this.elevationOffset=e??0}}var Et,Mt,Rt,Pt,Ot=r(38441);(Rt=Et||(Et={}))[Rt.RecreateSymbol=0]="RecreateSymbol",Rt[Rt.RecreateGraphics=1]="RecreateGraphics",Rt[Rt.FastUpdate=2]="FastUpdate";class It{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=Mt.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,t){return this._loadStatus===Mt.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===Mt.FAILED?(t&&t(this._loadError),this._loader??Promise.resolve()):(null==this._loader&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then((()=>{this._abortController=null,this._loadStatus=Mt.LOADED}),(e=>{throw this._loadError=e,this._abortController=null,this._loadStatus=Mt.FAILED,!(0,d.zf)(e)&&this.logger&&e.message&&this.logger.warn(e.message),e}))),this._loader.then(e,t).catch((()=>{})),this._loader)}abortLoad(){null!=this._abortController?this._abortController=(0,s.DC)(this._abortController):this._loadStatus===Mt.LOADING&&(this._loadStatus=Mt.FAILED),this._loader=null}}(Pt=Mt||(Mt={}))[Pt.LOADING=0]="LOADING",Pt[Pt.LOADED=1]="LOADED",Pt[Pt.FAILED=2]="FAILED";var Lt=r(24129);const Nt=()=>c.A.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class Dt extends It{constructor(e,t,r,i){super(r.schedule),this.symbol=e,this.symbolLayer=t,this._context=r,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this._materials=[],this.usedMemory=0,this.logger=Nt(),this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=i.renderPriority,this._renderPriorityStep=i.renderPriorityStep,this._elevationContext=new b.F,this.complexity=this.computeComplexity(),this.ignoreDrivers=i.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=Ft(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const t=this._drivenProperties,r=Ft(e);return r.color!==t.color||r.opacity!==t.opacity||r.opacityAlwaysOpaque!==t.opacityAlwaysOpaque||r.size!==t.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,t,r,i){const n=e.projectionSuccess,s="polygons"in e?e.polygons:null,o=`${i} geometry failed to be created`;n?!this._logGeometryValidationWarnings(t,r,i)&&s&&0===s.length&&"rings"===r&&t.length>0&&t[0].length>2&&Nt().warnOncePerTick(`${o} (filled rings should use clockwise winding - try reversing the order of vertices)`):Nt().warnOncePerTick(`${o} (failed to project geometry to view spatial reference)`)}_logGeometryValidationWarnings(e,t,r){const i=`${r} geometry failed to be created`;return!e.length||1===e.length&&!e[0].length?(Nt().warnOncePerTick(`${i} (no ${t} were defined)`),!0):!(Array.isArray(e)&&Array.isArray(e[0])||(Nt().warnOncePerTick(`${i} (${t} should be defined as a 2D array)`),0))}_validateGeometry(e,t=null,r=null){if(null!=t&&!t.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${e.type}`),!1;switch(e.type){case"point":{const t=e;if(!isFinite(t.x)||!isFinite(t.y))return Nt().warn("point coordinate is not a valid number, graphic skipped"),!1;break}case"polygon":(0,Ot.m3)(e)&&Nt().warnOncePerTick("Fixed a non-closed polygon ring.")}return!0}_defaultElevationInfoNoZ(){return zt}_defaultElevationInfoZ(){return Vt}_updateElevationContext(){null!=this._elevationInfoOverride?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,t=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||t.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,t=new b.F){const r=e.geometry,i=this.getDefaultElevationInfo(r);t.unit=null!=this._elevationContext.unit?this._elevationContext.unit:i.unit,t.mode=this.getGeometryElevationMode(r,i),t.offsetMeters=this._elevationContext.meterUnitOffset??i.offset??0;const n=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===t.mode;n&&(t.mode="relative-to-ground",t.offsetMeters=0);const s=n?x.KF:this._elevationContext.featureExpressionInfoContext;return t.updateFeatureExpressionInfoContext(s,e,this._context.layer),t}prepareSymbolLayerPatch(e){}updateGeometry(e,t){return!1}updateTransform(e,t,r,i){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,t=Ut){let r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||(null!=e?r*=e.a:t.hasIntrinsicColor||(r=0)),r}_getCombinedOpacityAndColor(e,t=Ut){const r=this._getCombinedOpacity(e,t);if(this._drivenProperties.color)return(0,gt.$C)(null,r);const i=null!=e?P.A.toUnitRGB(e):m.Un;return(0,gt.$C)(i,r)}_getVertexOpacityAndColor(e,t=null){const r=this._drivenProperties.color?e.color:null,i=this._drivenProperties.opacity?e.opacity:null,n=(0,gt.$C)(r,i);return t&&(n[0]*=t,n[1]*=t,n[2]*=t,n[3]*=t),n}isFastUpdatesEnabled(){return null!=this._fastUpdates}computeComplexity(){return Ee(this.symbol,this.symbolLayer)}globalPropertyChanged(e,t,r){switch(e){case"opacity":return this.layerOpacityChanged(t,r),!0;case"elevationInfo":{const e=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(t,r,e)!==v.uw.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(t,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,t,r){let i=v.uw.UPDATE;return e.forEach((e=>{const n=t(e);if(null!=n){const t=e.graphic;this.setGraphicElevationContext(t,n.elevationContext),n.needsElevationUpdates=r(n.elevationContext.mode)}else i=v.uw.RECREATE})),i}applyRendererDiff(e,t){return Et.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const t=this._fastUpdates.visualVariables,r=t.size?(0,Lt.ul)(t.size.field,e):0,i=t.color?(0,Lt.ul)(t.color.field,e):0,n=t.opacity?(0,Lt.ul)(t.opacity.field,e):0;return(0,D.fA)(r,i,n,0)}get draped(){return this._draped}ensureDrapedStatus(e){return null==this._draped?(this._draped=e,!0):(e!==this.draped&&Nt().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){return{drivenProperties:this._drivenProperties,getVisVarFields:()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??null})}}}function Ft(e){const t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return e&&"visualVariables"in e&&e.visualVariables&&e.visualVariables.forEach((e=>{switch(e.type){case"color":if(t.color=!0,e.stops)for(let r=0;r<e.stops.length;r++){const i=e.stops[r].color;i&&(t.opacity=!0,i.a<1&&(t.opacityAlwaysOpaque=!1))}break;case"opacity":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case"size":t.size=!0}})),t}const zt={mode:"on-the-ground",offset:0,unit:"meters"},Vt={mode:"absolute-height",offset:0,unit:"meters"},Ut={hasIntrinsicColor:!1};var Gt=r(10713);function Bt(e,t,r,i,n){if(kt(e,t))return null;r.localOrigin=qt(e,t);const s=new Gt.B({geometries:[r],castShadow:!1,layerUid:e.layer.uid,graphicUid:n,usesVerticalDistanceToGround:!0});return{object:s,sampledElevation:(0,v.fe)(s,t,e.elevationProvider,e.renderCoordsHelper,i)}}function Ht(e,t,r,i){return kt(t,r)?null:(0,v.fe)(e,r,t.elevationProvider,t.renderCoordsHelper,i)}function kt(e,t){const r=e.clippingExtent;return!!r&&((0,g.g)(t,Zt,e.elevationProvider.spatialReference),!(0,$.Uc)(r,Zt))}function jt(e,t,r){const i=e.elevationContext,n=r.spatialReference;(0,g.g)(t,Zt,n),i.centerPointInElevationSR=(0,y.T)(Zt[0],Zt[1],t.hasZ?Zt[2]:0,null!=n?n:null)}function Wt(e){switch(e.type){case"point":return e;case"polygon":case"extent":return(0,gt.W$)(e);case"polyline":{const t=e.paths[0];if(!t||0===t.length)return null;const r=(0,Ot.$H)(t,(0,Ot.Yl)(t)/2);return(0,y.T)(r[0],r[1],r[2],e.spatialReference)}case"mesh":return e.origin}return null}function qt(e,t){return(0,g.g)(t,Zt,e.renderCoordsHelper.spatialReference),e.localOriginFactory.getOrigin(Zt)}const Zt=(0,m.vt)();var $t=r(14905),Yt=r(40359),Xt=r(50944),Jt=r(14583),Qt=r(65856),Kt=r(27264),er=r(4875),tr=r(24100),rr=r(29165),ir=r(93678),nr=r(65420),sr=r(34615),or=r(22542),ar=r(40502),lr=r(54101),cr=r(74810),ur=r(85456),hr=r(57087);class dr extends or.w{initializeConfiguration(e,t){t.spherical=e.viewingMode===nr.RT.Global}initializeProgram(e){return new lr.B(e.rctx,dr.shader.get().build(this.configuration),ar.D)}setPipelineState(e){const t=e?ur.MT.ALWAYS:ur.MT.LESS;return this.configuration.depthHudEnabled?(0,hr.Ey)({depthTest:{func:t},depthWrite:hr.kn}):(0,hr.Ey)({blending:(0,hr.p3)(ur.dn.ONE,ur.dn.SRC_ALPHA,ur.dn.ONE_MINUS_SRC_ALPHA,ur.dn.ONE_MINUS_SRC_ALPHA),depthTest:{func:t},colorWrite:hr.wE})}initializePipeline(){return this.setPipelineState(this.configuration.multipassEnabled)}}dr.shader=new sr.$(cr.L,(()=>r.e(8083).then(r.bind(r,40362))));var pr=r(8610),fr=r(46121);class mr extends fr.E{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.multipassEnabled=!1}}(0,i._)([(0,pr.W)()],mr.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,i._)([(0,pr.W)()],mr.prototype,"spherical",void 0),(0,i._)([(0,pr.W)()],mr.prototype,"occlusionTestEnabled",void 0),(0,i._)([(0,pr.W)()],mr.prototype,"hasVerticalOffset",void 0),(0,i._)([(0,pr.W)()],mr.prototype,"hasScreenSizePerspective",void 0),(0,i._)([(0,pr.W)()],mr.prototype,"depthHudEnabled",void 0),(0,i._)([(0,pr.W)()],mr.prototype,"depthHudAlignStartEnabled",void 0),(0,i._)([(0,pr.W)()],mr.prototype,"hasSlicePlane",void 0),(0,i._)([(0,pr.W)()],mr.prototype,"multipassEnabled",void 0),(0,i._)([(0,pr.W)({constValue:!0})],mr.prototype,"hasSliceInVertexProgram",void 0),(0,i._)([(0,pr.W)({constValue:!1})],mr.prototype,"draped",void 0);class gr extends tr.im{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new _r),this.produces=new Map([[rr.N.LINE_CALLOUTS,e=>e===Kt.V.Color],[rr.N.LINE_CALLOUTS_HUD_DEPTH,e=>e===Kt.V.Color]]),this._configuration=new mr,this._uniqueMaterialIdentifier=gr.uniqueMaterialIdentifier(this.parameters)}passParameters(){return this.parameters}getConfiguration(e,t){const r=t?.slot!==rr.N.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=null!=this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=null!=this.parameters.screenSizePerspective,this._configuration.depthHudEnabled=r,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration}intersect(){}createGLMaterial(e){return new yr(e)}createBufferWriter(){return new xr}validateParameters(e){const t=gr.uniqueMaterialIdentifier(e);t!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=t)}static uniqueMaterialIdentifier({renderOccluded:e,isDecoration:t,horizontalScreenOffset:r,color:i,size:n,occlusionTest:s,shaderPolygonOffset:o,depthHUDAlignStart:a,centerOffsetUnits:l,hasSlicePlane:c,screenSizePerspective:u,verticalOffset:h,borderColor:d}){return Xt.ML`${e}:${t}:${r}:[${i}]:${n}:${s}:${o}:${a}:${l}:${c}:${null!=u}:{${h.screenLength}:${h.minWorldLength}:${h.maxWorldLength}}:[${d}]`}}class yr extends er.A{beginSlot(e){return this.ensureTechnique(dr,e)}}class _r extends tr.qA{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}}const vr=(0,Qt.BP)().vec3f(le.r.POSITION).vec3f(le.r.NORMAL).vec2f(le.r.UV0).vec4f(le.r.CENTEROFFSETANDDISTANCE),br=[(0,Jt.fA)(0,0),(0,Jt.fA)(1,0),(0,Jt.fA)(0,1),(0,Jt.fA)(1,0),(0,Jt.fA)(1,1),(0,Jt.fA)(0,1)];class xr{constructor(){this.vertexBufferLayout=vr}elementCount(e){return 6*e.attributes.get(le.r.POSITION).indices.length}write(e,t,r,i,n){(0,ir.Hk)(r.attributes.get(le.r.POSITION),e,i.position,n,6),(0,ir.p1)(r.attributes.get(le.r.NORMAL),t,i.normal,n,6),(0,ir.Ut)(r.attributes.get(le.r.CENTEROFFSETANDDISTANCE),i.centerOffsetAndDistance,n,6);for(let e=0;e<br.length;++e)i.uv0.setVec(n+e,br[e])}}class Sr extends Dt{constructor(e,t){super(e,null,t,Ar),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new gr(this._materialParameters),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}_perInstanceMaterialParameters(e){const t=this._materialParameters;return t.horizontalScreenOffset=e.horizontalScreenOffset??0,t.centerOffsetUnits=e.centerOffsetUnits||"world",t}get _materialParameters(){const e=new _r,t=this.symbol,r=t.callout;if(e.color=null!=r.color?P.A.toUnitRGBA(r.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=(0,$e.Lz)(r.size||0),t.verticalOffset){const{screenLength:r,minWorldLength:i,maxWorldLength:n}=t.verticalOffset;e.verticalOffset={screenLength:(0,$e.Lz)(r),minWorldLength:i||0,maxWorldLength:null!=n?n:1/0}}e.borderColor=null!=r.border?.color?P.A.toUnitRGBA(r.border.color):null;const i="object"===t.symbolLayers.at(0).type,n="label-3d"===t.type;return e.occlusionTest=!i,e.shaderPolygonOffset=i?0:void 0,e.depthHUDAlignStart=n,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return Tr}createGraphics3DGraphic(e){const t=e.renderingInfo,r=e.graphic,i=this.setGraphicElevationContext(r,new b.F,t.elevationOffset||0),n=t.symbol,s="on-the-ground"===this._elevationContext.mode&&("cim"===n.type||!n.symbolLayers.some((e=>"object"===e.type||"text"===e.type)));if("label-3d"!==n.type&&s)return null;if("point-3d"===n.type&&n.symbolLayers.every((e=>"text"===e.type&&!(0,Ze.Ie)(e))))return null;const o=(0,gt.W$)(r.geometry);return null==o?null:this._createAs3DShape(o,i,t,r.uid)}layerOpacityChanged(){this._materials[0]?.setParameters(this._materialParameters)}layerElevationInfoChanged(e,t,r){const i=this._elevationContext.mode,n=(0,v.I2)(Sr.elevationModeChangeTypes,r,i);return n!==v.uw.UPDATE||e.forEach((e=>{const r=t(e);null!=r&&this.updateGraphicElevationContext(e.graphic,r)})),n}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,t,r=0){return super.setGraphicElevationContext(e,t),t.addOffsetRenderUnits(r),t}updateGraphicElevationContext(e,t){this.setGraphicElevationContext(e,t.elevationContext,null!=t.metadata?t.metadata.elevationOffset:0),t.needsElevationUpdates=(0,v.nu)(t.elevationContext.mode)}computeComplexity(){return new ye({verticesPerFeature:6})}_getOrCreateMaterial(e){const t=this._perInstanceMaterialParameters(e),r=gr.uniqueMaterialIdentifier(t);if(r===this._materials[0]?.uniqueMaterialIdentifier)return{material:this._materials[0],isUnique:!1};if(null!=e.materialCollection){let i=e.materialCollection.get(r);return null==i&&(i=new gr(t),e.materialCollection.add(r,i)),{material:i,isUnique:!1}}return{material:new gr(t),isUnique:!0}}_createAs3DShape(e,t,r,i){const n=this._context.layer.uid,s=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:n}),o=this._getOrCreateMaterial(r),a=new et.V(o.material,function(e){const{translation:t,centerOffset:r}=e,i=new $t.n(t?[t[0],t[1],t[2]]:[0,0,0],wr,3,!0),n=new $t.n(r?[r[0],r[1],r[2],r[3]]:[0,0,0,1],wr,4,!0);return[[le.r.POSITION,i],[le.r.NORMAL,new $t.n([0,0,1],wr,3,!0)],[le.r.CENTEROFFSETANDDISTANCE,n]]}(r),null,Yt.X.Point,s),l=Bt(this._context,e,a,t,i);if(null==l)return null;const c=new bt(this,l.object,[a],o.isUnique?[o.material]:null,null,it,t);return c.metadata=new Ct(r.elevationOffset),c.alignedSampledElevation=l.sampledElevation,c.needsElevationUpdates=(0,v.nu)(t.mode),jt(c,e,this._context.elevationProvider),c}}Sr.elevationModeChangeTypes={definedChanged:v.uw.UPDATE,staysOnTheGround:v.uw.UPDATE,onTheGroundChanged:v.uw.RECREATE};const wr=[0],Tr={mode:"relative-to-ground",offset:0},Ar={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};class Cr{constructor(e,t,r=(0,m.vt)(),i=(0,D.vt)(),n=0,s="world",o=0,a=null){this.renderer=e,this.symbol=t,this.translation=r,this.centerOffset=i,this.horizontalScreenOffset=n,this.centerOffsetUnits=s,this.elevationOffset=o,this.materialCollection=a}}const Er=()=>c.A.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory"),Mr={line:Sr};var Rr=r(63952),Pr=r(56996),Or=r(13786),Ir=r(1932),Lr=r(44740);function Nr(e,t,r,i){return!(null==e||((0,X.aI)(t,i)?((0,Y.C)(r,e),0):(Dr[0]=e[0],Dr[1]=e[1],Dr[2]=0,!(0,W.projectBuffer)(Dr,t,0,Dr,i,0,1)||(r[0]=Dr[0],r[1]=Dr[1],Dr[0]=e[2],Dr[1]=e[3],Dr[2]=0,!(0,W.projectBuffer)(Dr,t,0,Dr,i,0,1)||(r[2]=Dr[0],r[3]=Dr[1],0)))))}const Dr=(0,m.vt)();var Fr=r(58081);const zr=new Pr.A(Array,(e=>(0,$.hZ)(e,$.v_)),null,10,5),Vr=(0,Y.vt)();class Ur{get labelLayers(){return this._labelLayers||V.tR}get extent(){return this._extent}get isElevationSource(){return this.layers.some((e=>e?.isElevationSource))}constructor(e,t,r,i,n){this.graphic=e,this.graphics3DSymbol=t,this.layers=r,this._visibleFlags=Le.ALL_LABEL,this.deconflictionPriority=0,++t.referenced,this._featureExpressionFeature=n?(0,x.VG)(n,e,i):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic((t=>{t.initialize(e),t.setVisibility(this.isVisible())}))}destroy(){this._forEachSymbolLayerGraphic((e=>e.destroy())),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return null==this.layers}clearLabelGraphics(){this._forEachLabelGraphic((e=>e.destroy())),this._labelLayers=null}addLabelGraphic(e,t){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(t),e.setVisibility(this.isVisible(Ne.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic((t=>{"draped"===t.type&&(e=!0)})),e}isVisible(e=Ne.GRAPHIC,t){const r=t?this._visibleFlags|t|Ne.LABEL*t:this._visibleFlags;return e===Ne.GRAPHIC?(r&Le.ALL_GRAPHIC)===Le.ALL_GRAPHIC:(r&Le.ALL_LABEL)===Le.ALL_LABEL}setVisibilityFlag(e,t,r){const i=this.isVisible(e);r?this._visibleFlags|=e*t:this._visibleFlags&=~(e*t);const n=this.isVisible(e);if(i===n)return!1;if(e===Ne.LABEL)this._forEachLabelGraphic((e=>e.setVisibility(n)));else{this._forEachSymbolLayerGraphic((e=>e.setVisibility(n)));const e=this.isVisible(Ne.LABEL);this._forEachLabelGraphic((t=>t.setVisibility(e)))}return!0}getVisibilityFlag(e,t){return!!(this._visibleFlags&e*t)}computeExtent(e){if(!this._extent){const t=this.graphic.geometry;if(null==t)return!1;this._extent=(0,Y.vt)(),(0,J.iQ)(t,this._extent);const r=t.spatialReference;if(!(0,X.aI)(r,e)&&!Nr(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,t){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,t)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,t,r){let i=e.geometry;return"mesh"!==i.type&&"extent"!==i.type||(i=Lr.A.fromExtent("mesh"===i.type?i.extent:i)),(0,Fr.Ux)(i,t,r)}get usedMemory(){let e=(0,Rr.eY)(this.graphic.attributes);return this._forEachSymbolLayerGraphic((t=>e+=t.graphics3DSymbolLayer.usedMemory)),e}computeAttachmentOrigin(){const e={render:{origin:(0,m.vt)(),num:0},draped:{origin:(0,Ir.vt)(),num:0}};for(const t of this.layers)null!=t&&t.computeAttachmentOrigin(e);return e.render.num>1&&(0,k.j)(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&(0,Or.hs)(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,t,r,i,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?(0,$.Ie)(n.boundingBox):n.boundingBox=(0,$.Ie)(),n.requiresDrapedElevation=!1,await(0,qe.jJ)(this.layers,(async s=>{if(null==s)return;const o="draped"===s.type?t:e,a=zr.acquire(),l=await s.getProjectedBoundingBox(o,r,n.screenSpaceObjects,i,a);isFinite(l[2])&&isFinite(l[5])||(n.requiresDrapedElevation=!0),l&&(0,$.RF)(n.boundingBox,a),zr.release(a)})),(0,$.vQ)(n.boundingBox)||(0,Y.vQ)((0,$.ES)(n.boundingBox,Vr))?n:null}needsElevationUpdates(){for(const e of this.layers)if(null!=e&&("object3d"===e.type||"lod-instance"===e.type)&&e.needsElevationUpdates)return!0;return this._labelLayers?.some((e=>e?.needsElevationUpdates??!1))??!1}alignWithElevation(e,t,r){this._forEachRenderedGraphic((i=>{"object3d"!==i.type&&"lod-instance"!==i.type||i.alignWithElevation(e,t,this._featureExpressionFeature,r)}))}alignWithAbsoluteElevation(e,t,r){this._forEachRenderedGraphic((i=>{"object3d"===i.type&&i.alignWithAbsoluteElevation(e,t,r)}))}addObjectStateSet(e,t){this._forEachSymbolLayerGraphic((r=>r.addObjectState(e,t)))}removeObjectState(e){this._forEachSymbolLayerGraphic((t=>t.removeObjectState(e)))}_forEachGraphicList(e,t){e?.forEach((e=>e&&t(e)))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){}}var Gr=r(21609),Br=r(62938),Hr=r(59122),kr=r(44705),jr=r(87725),Wr=r(50240),qr=r(37819),Zr=r(62693),$r=r(51376),Yr=r(72485),Xr=r(6527),Jr=r(91484);function Qr(e,t,r){const i=(t.length>0?t[0]:e.length/3)-1,n=(0,Xr.S)(e,i,r);if(n!==Yr._.Z){e=e.slice();for(let t=0;t<e.length;t+=3)e[t+n]=e[t+2]}return(0,Hr.e)(e,t,3)}function Kr(e){const t=[[le.r.POSITION,new $t.n(e.attributeData.position,e.indices,3,!0)]],r=(0,qr.EH)(e.indices.length);return null!=e.attributeData.colorFeature?t.push([le.r.COLORFEATUREATTRIBUTE,new $t.n([e.attributeData.colorFeature],r,1,!0)]):e.attributeData.color&&t.push([le.r.COLOR,new $t.n(e.attributeData.color,r,4,!0)]),e.attributeData.uvMapSpace&&t.push([le.r.UVMAPSPACE,new $t.n(e.attributeData.uvMapSpace,e.indices,4,!0)]),e.attributeData.boundingRect&&t.push([le.r.BOUNDINGRECT,new $t.n(e.attributeData.boundingRect,e.indices,9,!0)]),new et.V(e.material,t,e.mapPositions,Yt.X.Mesh,e.attributeData.objectAndLayerIdColor)}function ei(e,t=null){const r=[[le.r.POSITION,new $t.n(e.attributeData.position,e.indices,3,!0)],[le.r.UV0,new $t.n(e.attributeData.uv0,e.indices,2,!0)]];return new et.V(e.material,r,e.mapPositions,Yt.X.Mesh,t)}function ti(e){switch(e.type){case"extent":if(e instanceof Jr.default)return Lr.A.fromExtent(e);break;case"polygon":return e}return null}class ri{constructor(e,t,r){this.renderData=e,this.layerUid=t,this.graphicUid=r,this.outGeometries=new Array}}var ii=r(82588),ni=r(45147);function si(e,t,r,i){const n=(0,ii.oR)(e.rings,!!e.hasZ&&"on-the-ground"!==i.mode,ii.Wq.CCW_IS_HOLE,e.spatialReference),s=(0,Wr.jh)(n.position.length),o=(0,v.au)(n.position,e.spatialReference,0,s,0,n.position,0,n.position.length/3,t,r,i),a=null!=o;return new pi(n.position,s,li(n.polygons,n.position,s),ai(n.outlines,n.position,s),a,o)}function oi(e,t){const r=(0,ii.oR)(e.rings,!1,ii.Wq.CCW_IS_HOLE),i=(0,W.projectBuffer)(r.position,e.spatialReference,0,r.position,t,0,r.position.length/3);for(let e=2;e<r.position.length;e+=3)r.position[e]=ni.bi;return{position:r.position,polygons:li(r.polygons,r.position),outlines:ai(r.outlines,r.position),projectionSuccess:i}}function ai(e,t,r=null){return e.filter((({count:e})=>e>1)).map((({index:e,count:i})=>{const n=3*e,s=3*i;return null!=r?new ui(e,i,(0,Wr.l5)(t,n,s),(0,Wr.l5)(r,n,s)):new ci(e,i,(0,Wr.l5)(t,n,s))}))}function li(e,t,r=null){const i=new Array;for(const{index:n,count:s,holeIndices:o,pathLengths:a}of e){if(s<=1)continue;const e=3*n,l=3*s,c=o.map((e=>e-n)),u=null!=r?new hi(n,s,(0,Wr.l5)(t,3*n,3*s),(0,Wr.l5)(r,e,l),c,a):new di(n,s,(0,Wr.l5)(t,3*n,3*s),c,a);i.push(u)}return i}class ci{constructor(e,t,r){this.index=e,this.count=t,this.position=r}}class ui extends ci{constructor(e,t,r,i){super(e,t,r),this.mapPositions=i}}class hi extends ui{constructor(e,t,r,i,n,s){super(e,t,r,i),this.holeIndices=n,this.pathLengths=s}}class di extends ci{constructor(e,t,r,i,n){super(e,t,r),this.holeIndices=i,this.pathLengths=n}}class pi{constructor(e,t,r,i,n,s){this.position=e,this.mapPositions=t,this.polygons=r,this.outlines=i,this.projectionSuccess=n,this.sampledElevation=s}}var fi=r(11377),mi=r(13641);const gi=["polygon","extent"];function yi(e,t,r,i,n,s){const o=(0,qr.EH)(t.length),a=[[le.r.POSITION,new $t.n(i.positions,t,3,!0)],[le.r.NORMALCOMPRESSED,new $t.n(i.normals,t,2,!0)],[le.r.COLOR,new $t.n(n,o,4,!0)]];return new et.V(e,a,i.elevation,Yt.X.Mesh,s,r)}function _i(e,t,r,i,n,s,o,a,l,c,u,h,d){{const p=r.length/3,f=2*i.count;!function(e,t,r,i,n,s,o,a,l,c,u,h,d,p,f,m,g){(0,k.c)(Oi,m);{const n=f>0?1:-1;let s=3*r,o=0,h=3*o,d=i,p=3*d;for(let r=0;r<i;++r){const r=e[s],i=e[s+1],m=e[s+2];g&&(Oi[0]=r,Oi[1]=i,Oi[2]=m,(0,k.n)(Oi,Oi)),a[h+0]=r,a[h+1]=i,a[h+2]=m;const y=t[s+0],_=t[s+1],v=t[s+2];l[h+0]=y,l[h+1]=_,l[h+2]=v,c[h+0]=-n*Oi[0],c[h+1]=-n*Oi[1],c[h+2]=-n*Oi[2],u[o]=0,a[p+0]=r+f*Oi[0],a[p+1]=i+f*Oi[1],a[p+2]=m+f*Oi[2],l[p+0]=y,l[p+1]=_,l[p+2]=v,u[d]=f,h+=3,p+=3,s+=3,o+=1,d+=1}}{let e=0,t=0,r=3*p;const s=f<0?Ni:Li,a=f<0?Li:Ni;for(let l=0;l<o;++l)d[t]=n[e+s[0]],d[t+1]=n[e+s[1]],d[t+2]=n[e+s[2]],h[r]=n[e+a[0]]+i,h[r+1]=n[e+a[1]]+i,h[r+2]=n[e+a[2]]+i,t+=3,r+=3,e+=3}}(e,t,i.index,i.count,r,0,p,n,s,o,a,l,c,f,u,h,d)}{let e=0,t=2*i.count,r=0;const c=i.pathLengths[0];xi(n,s,a,o,e,c,i.count,t,l,r,u),t+=4*c,r+=2*c,e+=c;for(let c=1;c<i.pathLengths.length;++c){const h=i.pathLengths[c];xi(n,s,a,o,e,h,i.count,t,l,r,u),t+=4*h,r+=2*h,e+=h}}}function vi(e,t,r,i,n,s,o){i[s]=i[o],o*=3,e[s*=3]=e[o],e[s+1]=e[o+1],e[s+2]=e[o+2],t[s]=t[o],t[s+1]=t[o+1],t[s+2]=t[o+2],r[s]=n[0],r[s+1]=n[1],r[s+2]=n[2]}const bi=(0,m.vt)();function xi(e,t,r,i,n,s,o,a,l,c,u){let h=n,d=n+1,p=n+o,f=n+o+1,m=a,g=a+1,y=a+2*s,_=a+2*s+1;u<0&&(h=n+o+1,f=n);let v=3*c;for(let a=0;a<s;++a)a===s-1&&(d=n,u>0?f=n+o:h=n+o),Ei(e,h,d,p,bi),vi(e,t,i,r,bi,m,h),vi(e,t,i,r,bi,g,d),vi(e,t,i,r,bi,y,p),vi(e,t,i,r,bi,_,f),l[v]=m,l[v+1]=y,l[v+2]=_,l[v+3]=m,l[v+4]=_,l[v+5]=g,v+=6,h++,d++,p++,f++,m+=2,g+=2,y+=2,_+=2}const Si=(0,m.vt)(),wi=(0,m.vt)(),Ti=(0,m.vt)(),Ai=(0,m.vt)(),Ci=(0,m.vt)();function Ei(e,t,r,i,n){t*=3,r*=3,i*=3,(0,k.s)(Si,e[t++],e[t++],e[t++]),(0,k.s)(wi,e[r++],e[r++],e[r++]),(0,k.s)(Ti,e[i++],e[i++],e[i++]),(0,k.f)(Ai,wi,Si),(0,k.f)(Ci,Ti,Si),(0,k.b)(n,Ci,Ai),(0,k.n)(n,n)}const Mi=(0,m.vt)();function Ri(e,t,r){const i=e.getMutableAttribute(le.r.POSITION),n=e.getMutableAttribute(le.r.NORMALCOMPRESSED).data,{topVertexStart:s,topVertexCount:o,topFaceStart:a,topFaceCount:l}=t,c=i.data,u=o,h=e.attributes.get(le.r.POSITION).indices,d=a+l,p=s+o,f=(0,Wr.jh)(3*u);for(let e=0;e<u;++e){const t=3*e;f[t+0]=0,f[t+1]=0,f[t+2]=0}const m=Di,g=Fi,y=zi,_=Vi,v=Oi;for(let e=a;e<d;++e){const t=3*e;for(let e=0;e<3;++e){const i=h[t+e];_[e]=i;const n=3*i;(0,k.s)(Pi,c[n+0],c[n+1],c[n+2]),(0,k.h)(m[e],Pi,r)}(0,k.z)(g,m[1],m[0]),(0,k.z)(y,m[2],m[0]),(0,k.b)(v,g,y),(0,k.n)(v,v);for(let e=0;e<3;++e){const t=3*(_[e]-s);f[t+0]+=v[0],f[t+1]+=v[1],f[t+2]+=v[2]}}for(let e=s;e<p;++e){const t=3*(e-s),r=f[t+0],i=f[t+1],o=f[t+2],a=Math.sqrt(r*r+i*i+o*o);(0,mi.aT)(n,e,r/a,i/a,o/a)}}const Pi=(0,m.vt)(),Oi=(0,m.vt)(),Ii=new v.Uk,Li=[0,2,1],Ni=[0,1,2],Di=[(0,m.vt)(),(0,m.vt)(),(0,m.vt)()],Fi=(0,m.vt)(),zi=(0,m.vt)(),Vi=[0,0,0];var Ui;!function(e){e[e.Main=0]="Main",e[e.Bottom=1]="Bottom"}(Ui||(Ui={}));class Gi{constructor(e,t,r,i){this.positions=e,this.elevation=t,this.normals=r,this.heights=i}}class Bi{constructor(e,t,r,i){this.topVertexStart=e,this.topVertexCount=t,this.topFaceStart=r,this.topFaceCount=i}}var Hi=r(90683),ki=r(57176),ji=r(67895),Wi=r(7590),qi=r(77927),Zi=r(28896),$i=r(85848),Yi=r(89814),Xi=r(16088),Ji=r(96253);class Qi{constructor(e,t,r,i){this.graphics3DSymbolLayer=e,this.renderGeometries=t,this.boundingBox=r,this._drapeSourceRenderer=i,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e.stage}setVisibility(e){if(null!=this.stage&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,Ji.q.ADD);if(e||this._addedToStage){for(const e of this.renderGeometries)e.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Ji.k.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,Ji.q.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=(0,m.vt)()){return(0,k.s)(e,0,0,0)}getBoundingBoxObjectSpace(e=(0,$.vt)()){return(0,$.Ie)(e)}addObjectState(e,t){e===yt.Mg.Highlight&&(this.renderGeometries.forEach((e=>{const r=e.geometry.addHighlight();t.addRenderGeometry(e,r,this)})),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Ji.k.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach((t=>{e.removeRenderGeometry(t)}))}removeRenderGeometryObjectState(e,t){e.geometry.removeHighlight(t),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Ji.k.HIGHLIGHT)}computeAttachmentOrigin(e){for(const t of this.renderGeometries)t.geometry.computeAttachmentOrigin(tn)&&(e.draped.origin[0]+=tn[0],e.draped.origin[1]+=tn[1],e.draped.num++)}async getProjectedBoundingBox(e,t,r,i,n){(0,$.Ie)(n);for(let t=0;t<this.renderGeometries.length;t++){const i=this.renderGeometries[t];this._getRenderGeometryProjectedBoundingRect(i,e,Ki,r),(0,$.DC)(n,Ki)}if(t){let e;(0,$.gX)(n,tn);const r=(0,gt.vY)(n,t.service.spatialReference,t);try{e=await t.service.queryElevation(tn[0],tn[1],i,r,"ground")}catch(e){}null!=e&&(n[2]=Math.min(n[2],e),n[5]=Math.max(n[5],e))}return n}_getRenderGeometryProjectedBoundingRect(e,t,r,i){if(this.boundingBox)(0,$.hZ)(en,this.boundingBox);else{const t=e.boundingSphere,r=t[3];en[0]=t[0]-r,en[1]=t[1]-r,en[2]=t[2]-r,en[3]=t[0]+r,en[4]=t[1]+r,en[5]=t[2]+r}return t(en,0,2),this.calculateRelativeScreenBounds&&i.push({location:(0,$.gX)(en),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),(0,$.ES)(en,r)}}const Ki=(0,Y.vt)(),en=(0,$.vt)(),tn=(0,m.vt)();var rn=r(15774);function nn(e,t,r){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=r,e.canvas}function sn(e){const{size:t}=e.definition,r=e.fontString(t);let i=on.get(r);if(!i){const n=nn(ln,0,0).getContext("2d");e.setFontProperties(n,t);const s=n.measureText(cn);i=new an(s.actualBoundingBoxAscent,s.actualBoundingBoxDescent),on.set(r,i)}return i}const on=new Map;class an{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(e,t){this.maxAscent=e,this.maxDescent=t}}const ln={canvas:null},cn=(()=>{let e="";for(let t=32;t<127;t++)e+=String.fromCharCode(t);return e})();class un{constructor(e,t,r,i){this.text=e,this._alignment=t,this._parameters=r,this._maxSize=i,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.replaceAll(" "," ").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let e=this._metrics.firstLineAscent;for(let t=0;t<this._lines.length-1;t++)e+=this._lineSpacing;return e+=this._metrics.lastLineDescent,Math.ceil(e+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(null==this._metricsCached){const e=nn(pn,mn,mn).getContext("2d"),t=this._parameters.definition.pixelRatio,r=this._fontSize*t;this._parameters.setFontProperties(e,r);let i=2*this._haloSize;const n=this._parameters.definition.font;"italic"!==n.style&&"oblique"!==n.style&&"bold"!==n.weight&&"bolder"!==n.weight||(i+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let s=0,o=0,a=0,l=0,c=0;this._lines.forEach(((r,n)=>{const u=e.measureText(r),h=u.width/t,d=h+i;this._textWidths.push(h),this._lineWidths.push(d),s=Math.max(s,d),l=Math.max(l,u.actualBoundingBoxAscent/t),c=Math.max(c,u.actualBoundingBoxDescent/t),0===n&&(o=u.actualBoundingBoxAscent/t),n===this._lines.length-1&&(a=u.actualBoundingBoxDescent/t)}));const u=sn(this._parameters),h=Math.max(l,u.maxAscent),d=Math.max(c,u.maxDescent),p=o,f="underline"===this._parameters.definition.font.decoration?d:a,m=s;this._metricsCached=new yn(p,f,h,d,m)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return this._midLineHeight*fn}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,1)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(null==this._renderPixelRatio){const e=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(e,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case dn.Left:return this._horizontalPadding;case dn.Center:return(this.displayWidth-this._lineWidths[e])/2;case dn.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[e]}}render(e,t,r){e.save();const i=t/=this.renderPixelRatio,n=r/=this.renderPixelRatio,s=this._haloSize,o=this._firstLineYOffset+this._metrics.firstLineAscent;t+=s,r+=o;const a=this._haloSize>0;a&&this._renderHalo(e,i,n,s,o),this._parameters.setFontProperties(e,this._renderedFontSize);for(let i=0;i<this._lines.length;++i){const n=this._lines[i],s=this._getLineXOffset(i);a&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,n,t+s,r),this._renderLineDecoration(e,t+s,r,this._textWidths[i])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,n,t+this._getLineXOffset(i),r),this._renderLineDecoration(e,t+s,r,this._textWidths[i]),r+=this._lineSpacing}if(Qe.b.TEXT_SHOW_BASELINE){e.strokeStyle=gn,e.setLineDash([2,2]),e.lineWidth=1;let t=n+o;for(let r=0;r<this._lines.length;++r)this._drawLine(e,[i,t],[i+this.displayWidth,t]),t+=this._lineSpacing}if(Qe.b.TEXT_SHOW_BORDER&&(e.strokeStyle=gn,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[i,n],[this.displayWidth,this.displayHeight])),this._hasBackground){const t=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,i,n,t),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,t,r,i,n=!1){if("none"===this._parameters.definition.font.decoration||0===i)return;const s=Math.max(this._parameters.definition.size/16,1);switch(this._parameters.definition.font.decoration){case"underline":r+=2*s;break;case"line-through":r-=.33*this._midLineAscent}const o=n?this._haloSize:0;e.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(s+2*o),e.beginPath(),e.moveTo(this._toRenderUnit(t-o),this._toRenderUnit(r)),e.lineTo(this._toRenderUnit(t+i+o),this._toRenderUnit(r)),e.stroke()}_roundedRect(e,t,r,i){t=this._toRenderUnit(t),r=this._toRenderUnit(r);const n=this.renderedWidth,s=this.renderedHeight;0!==i?(i=(0,rn.qE)(i,0,Math.floor(s/2)),e.beginPath(),e.moveTo(t,r+i),e.arcTo(t,r,t+i,r,i),e.lineTo(t+n-i,r),e.arcTo(t+n,r,t+n,r+i,i),e.lineTo(t+n,r+s-i),e.arcTo(t+n,r+s,t+n-i,r+s,i),e.lineTo(t+i,r+s),e.arcTo(t,r+s,t,r+s-i,i),e.closePath()):e.rect(t,r,n,s)}_renderHalo(e,t,r,i,n){const s=this.renderedWidth,o=this.renderedHeight,a=nn(pn,Math.max(s,mn),Math.max(o,mn)),l=a.getContext("2d");l.clearRect(0,0,s,o),this._parameters.setFontProperties(l,this._renderedFontSize),l.fillStyle=this._parameters.haloStyle,l.strokeStyle=this._parameters.haloStyle;const c=this._renderedHaloSize<3;l.lineJoin=c?"miter":"round",c?this._renderHaloEmulated(l,i,n):this._renderHaloNative(l,i,n);let u=n;for(let e=0;e<this._lines.length;++e){const t=this._getLineXOffset(e);this._renderLineDecoration(l,i+t,u,this._textWidths[e],!0),u+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(a,0,0,s,o,this._toRenderUnit(t),this._toRenderUnit(r),s,o),e.globalAlpha=1}_renderHaloEmulated(e,t,r){for(let i=0;i<this._lines.length;++i){const n=this._lines[i],s=this._getLineXOffset(i);for(const[i,o]of hn)this._fillText(e,n,t+s+this._haloSize*i,r+this._haloSize*o);r+=this._lineSpacing}}_renderHaloNative(e,t,r){const i=2*this._haloSize;for(let n=0;n<this._lines.length;++n){const s=this._lines[n],o=this._getLineXOffset(n),a=5,l=.1;for(let n=0;n<a;n++){const c=1-(a-1)*l+n*l;e.lineWidth=this._toRenderUnit(c*i),this._strokeText(e,s,t+o,r)}r+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,t,r,i){e.fillText(t,this._toRenderUnit(r),this._toRenderUnit(i))}_strokeText(e,t,r,i){e.strokeText(t,this._toRenderUnit(r),this._toRenderUnit(i))}_drawLine(e,t,r){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(t[0])+.5,this._toRoundedRenderUnit(t[1])+.5),e.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.stroke()}_drawBox(e,t,r){const i=this._toRenderUnit(t[0]),n=this._toRenderUnit(t[1]),s=this._toRenderUnit(r[0]),o=this._toRenderUnit(r[1]),a=Math.floor(i)+.5,l=Math.ceil(i+s)-.5,c=Math.floor(n)+.5,u=Math.ceil(n+o)-.5;e.beginPath(),e.moveTo(a,c),e.lineTo(l,c),e.lineTo(l,u),e.lineTo(a,u),e.lineTo(a,c),e.stroke()}}const hn=[];{const e=16;for(let t=0;t<360;t+=360/e)hn.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}var dn;!function(e){e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right"}(dn||(dn={}));const pn={canvas:null},fn=.2,mn=512,gn="rgb(255, 0, 255, 0.5)";class yn{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(e,t,r,i,n){this.firstLineAscent=e,this.lastLineDescent=t,this.maxLineAscent=r,this.maxLineDescent=i,this.displayWidth=n}}const _n=Object.freeze({left:0,center:.5,right:1}),vn=Object.freeze({"bottom-left":(0,Ir.fA)(0,0),bottom:(0,Ir.fA)(.5,0),"bottom-right":(0,Ir.fA)(1,0),left:(0,Ir.fA)(0,.5),center:(0,Ir.fA)(.5,.5),right:(0,Ir.fA)(1,.5),"top-left":(0,Ir.fA)(0,1),top:(0,Ir.fA)(.5,1),"top-right":(0,Ir.fA)(1,1)});var bn=r(98323),xn=r(15389),Sn=r(59552),wn=r(6955);const Tn=(0,m.fA)(0,0,1),An=bn.CN,Cn=[An/2,An/2,1-An/2,1-An/2],En=[bn.Q_*An,bn.Q_*An];class Mn extends Dt{getCachedSize(){return{size:this._getIconSize()}}constructor(e,t,r,i){super(e,t,r,i),this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._patchTask=null,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const t=this._prepareMaterialParameters(),r=this._getPrimitive();if(null!=r)this._prepareResourcesPrimitive(t,r);else{const r=(0,Yi.N7)(this.symbolLayer),i=Pn(r);null!=i?await this._prepareResourcesCIM(t,JSON.parse(i),e):await this._prepareResourcesHref(t,r,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=(0,gt.Hj)(this._getIconSize());if(e)throw new n.A("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,t=Math.round(null!=e.size?(0,$e.Lz)(e.size):16);return this._drivenProperties.size?Math.max(t,64):t}_generateTextureCIM(e){let t=this._cimData;if(t&&t.symbol||this.logger.error("Can't create texture, CIM data is undefined"),t.primitiveOverrides){t=(0,Gr.o8)(t);const r=t.primitiveOverrides;ji.$.evaluateOverrides(r,e,this._arcadeInfo.geometryType,null,null),ji.$.applyOverrides(t.symbol,r)}const r=(0,Xt.Wm)(JSON.stringify(t));let i=this._cimSymbolTextures.get(r);if(i)return i;const n=this._context.sharedResources.cimSymbolRasterizer,s=this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null;s&&ji.$.applyDictionaryTextOverrides(t.symbol,e,s,null);const o=null!=this._cimScaleFactorOrFunction?(0,Wi.s4)(this._cimScaleFactorOrFunction,e):1;1!==o&&t.symbol&&(0,qi.Km)(t.symbol,o,!0);const a=ki.wp.getEnvelope(t,null,n.resourceManager);if(a?.width&&a.height){const e=a.x+a.width/2,r=a.y+a.height/2,s=n.rasterize({type:"cim",data:t},a.width,a.height,e,r,1,"esriGeometryPoint"),o=new $i.Q({x:-a.x/a.width-.5,y:(a.height+a.y)/a.height-.5});this._cimMaterialParametersInfo.anchorPosition=On("relative",o),i=new Sn.g(s,{width:s?.width??1,height:s?.height??1,reloadable:!0})}else i=new Sn.g(new ImageData(1,1),{width:1,height:1,reloadable:!0});return this._cimSymbolTextures.set(r,i),this._context.stage.add(i),i}_prepareMaterialParameters(){const e={anchorPosition:On(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},t=this.symbol;if(function(e){return e&&"point-3d"===e.type&&e.hasVisibleVerticalOffset()}(t)){const{screenLength:r,minWorldLength:i,maxWorldLength:n}=t.verticalOffset;e.verticalOffset={screenLength:(0,$e.Lz)(r),minWorldLength:i||0,maxWorldLength:null!=n?n:1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!(0,l.A)("enable-feature:non-occluded-hud"),e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,t){const r=this._getOutlineSize();if(Rn(t)&&0===r)throw new Error("Nothing to render");if(this._outlineSize=r,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,null!=this._context.sharedResources.textures){const r=this._context.sharedResources.textures.fromData(`${t}-icon`,(()=>(0,bn.sZ)(t)));this._textureHandle=r,e.textureId=r.texture.id}e.textureIsSignedDistanceField=!0,e.sampleSignedDistanceFieldTexelCenter=(0,bn.ny)(t),e.distanceFieldBoundingBox=Cn;const i=this._getIconSize();this._size=[i,i],this._symbolTextureRatio=1/An,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,t,r){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const i=this._getIconSize(),s=i*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(null!=this._context.sharedResources.textures){const o=await(0,qe.Ke)(this._context.sharedResources.textures.fromUrl(t,s,{signal:r}));if(!1===o.ok)throw(0,d.QP)(o.error),new n.A("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${t})`);this._textureHandle=o.value;const a=o.value.texture;this._size=In(a,i),e.textureId=a.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,t,i){if(this._cimData=t,!this._context.sharedResources.cimSymbolRasterizer){const e=(await r.e(5461).then(r.bind(r,74185))).CIMSymbolRasterizer;(0,d.Te)(i),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new e(this._context.renderCoordsHelper.spatialReference))}const n=this._context.sharedResources.cimSymbolRasterizer,s=[],o=t,a=o?.symbol;ki.wp.fetchResources(a,n.resourceManager,s,i),ki.wp.fetchFonts(a,n.resourceManager,s);const l=this._context.layer.fields?this._context.layer.fields.map((e=>e.toJSON())):[],c=this._context.renderCoordsHelper.spatialReference;if(this._arcadeInfo={spatialReference:c,fields:l,geometryType:"esriGeometryPoint"},o?.primitiveOverrides&&s.push(ji.$.createRenderExpressions(o.primitiveOverrides,this._arcadeInfo)),s.length>0&&(await Promise.all(s),(0,d.Te)(i)),this._context.renderer&&"dictionary"===this._context.renderer.type&&this._context.renderer.scaleExpression){const e=this._context.renderer;if(e.scaleExpression){const t=e.scaleExpression,r=await(0,re.Ad)(t,this._context.layer.spatialReference,l);this._cimScaleFactorOrFunction=(e,t,i)=>{const n=(0,Xi.A)(r,e,{$view:i},"esriGeometryPoint",t);return null!==n?n:1}}}(0,d.Te)(i),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource?.href?null:this.symbolLayer.resource?.primitive??Zi.r}_getOutlineSize(){let e=0;const t=this.symbolLayer;return null!=t.outline?.size?Math.max((0,$e.Lz)(t.outline.size),0):(e=Rn(this._getPrimitive())?1.5:0,Math.max(e,0))}_getOutlineColor(){const e=this._getLayerOpacity(),t=this.symbolLayer,r=t?.outline?.color;if(null!=r){const t=P.A.toUnitRGB(r),i=r.a*e;return[t[0],t[1],t[2],i]}return[0,0,0,0]}_getFillColor(){if(Rn(this._getPrimitive()))return F;const e=null==this._getPrimitive(),t=this.symbolLayer?.material?.color;return this._getCombinedOpacityAndColor(t,{hasIntrinsicColor:e})}_createMaterialAndAddToStage(e,t){if(this._cimData){this._fastUpdates=null;let r=e.textureId?this._cimSymbolMaterials.get(e.textureId):null;return r||(r=new wn.R(e),this._cimSymbolMaterials.set(e.textureId??0,r),t.add(r)),r}return this._fastUpdates=(0,Lt.s_)(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates&&(e={...e,...this._fastUpdates.materialParameters}),this._materials[0]=new wn.R(e),t.add(this._materials[0]),this._materials[0]}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial((e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,draped:this.draped})})),this.layerOpacityChanged())}destroy(){super.destroy(),this._patchTask=(0,s.DC)(this._patchTask),this._forEachMaterial((e=>this._context.stage.remove(e))),this._materials.length=0,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach((e=>this._context.stage.remove(e))),this._cimSymbolTextures.clear(),this._textureHandle=(0,s.Gz)(this._textureHandle)}_getScaleFactor(e,t){if(this._drivenProperties.size&&e.size){for(let t=0;t<3;t++){const r=e.size[t];r&&"symbol-value"!==r&&"proportional"!==r&&(e.size[t]=(0,$e.Lz)(r))}if("symbol-value"===e.size[0])return 1;if(isFinite(+e.size[0]))return+e.size[0]/t;if(isFinite(+e.size[2]))return+e.size[2]/t}return 1}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry))return null;let r,i=[0,0];if(this._cimData){if(!this._cimData.symbol)return null;const e=this._generateTextureCIM(t),n={textureId:e.id,...this._cimMaterialParametersInfo};r=this._createMaterialAndAddToStage(n,this._context.stage);const s=window.devicePixelRatio||1;i=[e.parameters.width/s,e.parameters.height/s]}else i=this._size,r=this._materials[0];const n=Wt(t.geometry);if(null==n)return this.logger.warn(`unsupported geometry type for icon symbol: ${t.geometry.type}`),null;const s=e.renderingInfo,o=this._getVertexOpacityAndColor(s);let a=1;if(!this._fastUpdates?.visualVariables.size){const e=i[0]>i[1]?i[0]:i[1];a=this._getScaleFactor(s,e)}a*=this._symbolTextureRatio;const l=(0,Ir.fA)(i[0]*a,i[1]*a),c=this.setGraphicElevationContext(t);return this.ensureDrapedStatus("on-the-ground"===c.mode)&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(t,n,r,o,l,e.layer.uid):this._createAs3DShape(t,n,r,o,l,c,t.uid)}layerOpacityChanged(){const e=this._getFillColor(),t=this._getOutlineColor();this._forEachMaterial((r=>{r.setParameters({color:e}),r.setParameters({outlineColor:t})}))}updateGeometry(e,t){if(this.draped||!this._validateGeometry(t))return!1;const{elevationContext:r,stageObject:i}=e;if(r.mode!==this.getGeometryElevationMode(t))return!1;const n=Wt(t);if(!n)return!1;const s=Ht(i,this._context,n,r);if(null==s)return!1;const o=qt(this._context,n);return i.geometries[0].localOrigin===o&&(e.alignedSampledElevation=s,jt(e,n,this._context.elevationProvider),!0)}layerElevationInfoChanged(e,t,r){const i=this._elevationContext.mode,n=(0,v.I2)(Mn.elevationModeChangeTypes,r,i);if(n!==v.uw.UPDATE)return n;const s=(0,v.nu)(i)||"absolute-height"===i;return this.updateGraphics3DGraphicElevationInfo(e,t,(()=>s))}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial((e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})})),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return null!=this._getPrimitive()}applyRendererDiff(e,t){for(const r in e.diff){if("visualVariables"!==r)return Et.RecreateSymbol;if(!(0,Lt.J_)(this._fastUpdates,t,this._fastVisualVariableConvertOptions()))return Et.RecreateSymbol;this._materials[0]?.setParameters(this._fastUpdates.materialParameters)}return Et.FastUpdate}prepareSymbolLayerPatch(e){if(this._patchTask?.abort(),"partial"!==e.diff.type)return;const t=e.diff.diff;this._preparePatchResource(e,t)}_preparePatchResource(e,t){if(!t.resource||"partial"!==t.resource.type)return;const r=t.resource.diff;if("complete"!==r?.href?.type)return;const i=r.href.newValue,{textures:o}=this._context.sharedResources;if(null==i||null==o||null!=Pn(i))return;const a=this._getIconSize(),l=a*this._context.graphicsCoreOwner.view.state.pixelRatio;e.symbolLayerStatePatches.push((()=>{this._patchTask=(0,s.DC)(this._patchTask),this._patchTask=(0,qe.UT)((e=>this._context.schedule((async(e,t)=>{const r=await(0,qe.Ke)(o.fromUrl(i,l,{signal:t}));(0,d.Te)(t);const c=!r.ok;if(c&&(0,d.QP)(r.error),this._textureHandle=(0,s.Gz)(this._textureHandle),this._patchTask=null,c){this._forEachMaterial((e=>{e.visible=!1,e.setParameters({textureId:null})}));const e=`Failed to load (Request for icon resource failed: ${i})`;return void this.logger.error(new n.A("graphics3diconsymbollayer:request-failed",e))}this._textureHandle=r.value;const u=r.value.texture;this._size=In(u,a),this._forEachMaterial((e=>{e.setParameters({textureId:u.id}),e.visible=!0}))}),e)))})),delete r.href}_defaultElevationInfoNoZ(){return Ln}_createAs3DShape(e,t,r,i,n,s,o){const a=this.getFastUpdateAttrValues(e),l=this._context.layer.uid,c=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:o,layerUid:l}),u=(0,ae.DJ)(r,Tn,null,i,n,Nn,null,a,c),h=Bt(this._context,t,u,s,o);if(null==h)return null;const d=new bt(this,h.object,[u],null,null,it,s);return d.alignedSampledElevation=h.sampledElevation,d.needsElevationUpdates=(0,v.nu)(s.mode)||"absolute-height"===s.mode,d.getScreenSize=this._createScreenSizeGetter(n,a),d.calculateRelativeScreenBounds=e=>r.calculateRelativeScreenBounds(d.getScreenSize(),1,e),jt(d,t,this._context.elevationProvider),d}_createAsOverlay(e,t,r,i,n,s){r.renderPriority=this._renderPriority;const o=(0,m.vt)();(0,g.g)(t,o,this._context.overlaySR),o[2]=ni.bi;const a=this._context.clippingExtent;if(null!=a&&!(0,$.Uc)(a,o))return null;const l=this.getFastUpdateAttrValues(e),c=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),u=(0,ae.DJ)(r,Tn,o,i,n,null,null,l,c),h=new xn.$(u,{layerUid:s,graphicUid:e.uid}),d=new Qi(this,[h],null,this._context.drapeSourceRenderer);return d.getScreenSize=this._createScreenSizeGetter(n,l),d.calculateRelativeScreenBounds=e=>r.calculateRelativeScreenBounds(d.getScreenSize(),1,e),d}_createScreenSizeGetter(e,t){const r=this._outlineSize+2;if(this._fastUpdates&&t){const i=e[0]/this._symbolTextureRatio,n=e[1]/this._symbolTextureRatio;return(e=(0,Ir.vt)())=>{const[s,o]=(0,Lt.VC)(Dn,this._fastUpdates.materialParameters,t);return e[0]=s*i+r,e[1]=o*n+r,e}}const i=e[0]/this._symbolTextureRatio+r,n=e[1]/this._symbolTextureRatio+r;return(e=(0,Ir.vt)())=>(e[0]=i,e[1]=n,e)}_fastVisualVariableConvertOptions(){const e=Math.max(this._size[0],this._size[1]),t=(0,m.fA)(e,e,e),r=(0,$e.PN)(1),i=e*r,n=(0,m.fA)(i,i,i);return new Lt.wI({size:!0,color:!0,rotation:!0,opacity:!1},t,n,r)}_forEachMaterial(e){this._materials.forEach(e),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._materials[0]}}}function Rn(e){return null!=e&&("cross"===e||"x"===e)}function Pn(e){const t=(0,Hi.r$)(e);return"application/json"===t?.mediaType?t.data:void 0}function On(e,t){return"relative"===e?(0,Ir.fA)((t.x||0)+.5,.5-(t.y||0)):e in vn?vn[e]:vn.center}function In({parameters:e},t){const r=(e.width??1)/(e.height??1);return r>1?[t,Math.round(t/r)]:[Math.round(t*r),t]}Mn.PRIMITIVE_SIZE=En,Mn.elevationModeChangeTypes={definedChanged:v.uw.UPDATE,staysOnTheGround:v.uw.NONE,onTheGroundChanged:v.uw.RECREATE};const Ln={mode:"relative-to-ground",offset:0},Nn=(0,D.fA)(0,0,0,1),Dn=(0,m.vt)();var Fn=r(95736);function zn(e){switch(e){case"butt":return Fn.x.BUTT;case"square":return Fn.x.SQUARE;case"round":return Fn.x.ROUND;default:return null}}function Vn(e){return"diamond"===e?"kite":e}var Un=r(79366),Gn=r(29800),Bn=r(36634),Hn=r(77971),kn=r(46921),jn=r(6200),Wn=r(55890),qn=r(88630),Zn=r(50678);const $n=new Map([[le.r.POSITION,0],[le.r.PREVPOSITION,1],[le.r.UV0,2],[le.r.NORMAL,3],[le.r.COLOR,4],[le.r.COLORFEATUREATTRIBUTE,4],[le.r.SIZE,5],[le.r.SIZEFEATUREATTRIBUTE,5],[le.r.OPACITYFEATUREATTRIBUTE,6]]);class Yn extends or.w{initializeProgram(e){return new lr.B(e.rctx,Yn.shader.get().build(this.configuration),$n)}_makePipelineState(e,t){const r=this.configuration,i=e===Wn.y.NONE;return(0,hr.Ey)({blending:r.output===Kt.V.Color?i?kn.V0:(0,kn.ez)(e):null,depthTest:r.space===Zn.lM.Draped?null:{func:(0,kn.K_)(e)},depthWrite:r.space===Zn.lM.Draped?null:i?r.writeDepth?hr.kn:null:(0,kn.XO)(e),drawBuffers:r.output===Kt.V.Depth?{buffers:[ur.Hr.NONE]}:(0,kn.cl)(e),colorWrite:hr.wE,stencilWrite:r.hasOccludees?jn.v0:null,stencilTest:r.hasOccludees?t?jn.a9:jn.qh:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=(0,hr.Ey)({blending:kn.V0,depthTest:jn.sf,depthWrite:null,colorWrite:hr.wE,stencilWrite:null,stencilTest:jn.mK}),this._occluderPipelineOpaque=(0,hr.Ey)({blending:kn.V0,depthTest:jn.sf,depthWrite:null,colorWrite:hr.wE,stencilWrite:jn.r8,stencilTest:jn.I$}),this._occluderPipelineMaskWrite=(0,hr.Ey)({blending:null,depthTest:jn.m,depthWrite:null,colorWrite:null,stencilWrite:jn.v0,stencilTest:jn.a9})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e,t,r){return e?this._occludeePipelineState:this.configuration.occluder?r?this._occluderPipelineTransparent:t?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}}Yn.shader=new sr.$(qn.L,(()=>r.e(5599).then(r.bind(r,83014))));class Xn extends tr.im{constructor(e){super(e,new Qn),this.produces=new Map([[rr.N.OPAQUE_MATERIAL,e=>e===Kt.V.Highlight||(0,Kt._o)(e)&&this.parameters.renderOccluded===tr.m$.OccludeAndTransparentStencil],[rr.N.OPAQUE_NO_SSAO_DEPTH,e=>(0,Kt.eh)(e)],[rr.N.OCCLUDER_MATERIAL,e=>(0,Kt.aD)(e)&&this.parameters.renderOccluded===tr.m$.OccludeAndTransparentStencil],[rr.N.TRANSPARENT_OCCLUDER_MATERIAL,e=>(0,Kt.aD)(e)&&this.parameters.renderOccluded===tr.m$.OccludeAndTransparentStencil],[rr.N.TRANSPARENT_MATERIAL,e=>(0,Kt._o)(e)&&this.parameters.writeDepth],[rr.N.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,e=>(0,Kt._o)(e)&&!this.parameters.writeDepth],[rr.N.DRAPED_MATERIAL,e=>e===Kt.V.Color||e===Kt.V.Highlight]]),this._vertexAttributeLocations=$n,this._configuration=new Zn.Dt,this._layout=this.createLayout()}getConfiguration(e,t){return this._configuration.output=e,this._configuration.space=t.slot===rr.N.DRAPED_MATERIAL?Zn.lM.Draped:this.parameters.worldSpace?Zn.lM.World:Zn.lM.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==Fn.x.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===tr.m$.OccludeAndTransparentStencil,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=(0,Qt.BP)().vec3f(le.r.POSITION).vec3f(le.r.PREVPOSITION).vec2f(le.r.UV0);return this.parameters.worldSpace&&e.vec3f(le.r.NORMAL),this.parameters.vvSize?e.f32(le.r.SIZEFEATUREATTRIBUTE):e.f32(le.r.SIZE),this.parameters.vvColor?e.f32(le.r.COLORFEATUREATTRIBUTE):e.vec4f(le.r.COLOR),this.parameters.vvOpacity&&e.f32(le.r.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new Kn(this._layout,this.parameters)}createGLMaterial(e){return new Jn(e)}}class Jn extends Bn.m{constructor(){super(...arguments),this._markerPrimitive=null}dispose(){super.dispose(),this._markerTextures.release(this._markerPrimitive),this._markerPrimitive=null}_updateParameters(e){const t=this._material.parameters.markerPrimitive;return t!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextures.swap(t,this._markerPrimitive)}),this._markerPrimitive=t),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(Yn,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===Kt.V.Color&&this._updateOccludeeState(e),this._updateParameters(e)}}class Qn extends Hn.S{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.markerPrimitive="arrow",this.placement="end",this.cap=Fn.x.BUTT,this.anchor=Zn.kJ.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1,this.markerTexture=null}}class Kn{constructor(e,t){this.vertexBufferLayout=e,this._parameters=t}elementCount(){return"begin-end"===this._parameters.placement?12:6}write(e,t,r,i,n){const s=r.attributes.get(le.r.POSITION).data,o=s.length/3;let a=[1,0,0];const l=r.attributes.get(le.r.NORMAL);this._parameters.worldSpace&&null!=l&&(a=l.data);let c=1,u=0;this._parameters.vvSize?u=r.attributes.get(le.r.SIZEFEATUREATTRIBUTE).data[0]:r.attributes.has(le.r.SIZE)&&(c=r.attributes.get(le.r.SIZE).data[0]);let h=[1,1,1,1],d=0;this._parameters.vvColor?d=r.attributes.get(le.r.COLORFEATUREATTRIBUTE).data[0]:r.attributes.has(le.r.COLOR)&&(h=r.attributes.get(le.r.COLOR).data);let p=0;this._parameters.vvOpacity&&(p=r.attributes.get(le.r.OPACITYFEATUREATTRIBUTE).data[0]);const f=new Float32Array(i.buffer);let m=n*(this.vertexBufferLayout.stride/4);const g=(e,t,r,i)=>{if(f[m++]=e[0],f[m++]=e[1],f[m++]=e[2],f[m++]=t[0],f[m++]=t[1],f[m++]=t[2],f[m++]=r[0],f[m++]=r[1],this._parameters.worldSpace&&(f[m++]=a[0],f[m++]=a[1],f[m++]=a[2]),this._parameters.vvSize?f[m++]=u:f[m++]=c,this._parameters.vvColor)f[m++]=d;else{const e=Math.min(4*i,h.length-4);f[m++]=h[e],f[m++]=h[e+1],f[m++]=h[e+2],f[m++]=h[e+3]}this._parameters.vvOpacity&&(f[m++]=p)};let y;!function(e){e[e.ASCENDING=1]="ASCENDING",e[e.DESCENDING=-1]="DESCENDING"}(y||(y={}));const _=(t,r)=>{const i=(0,k.s)(es,s[3*t],s[3*t+1],s[3*t+2]),n=ts;let a=t+r;do{(0,k.s)(n,s[3*a],s[3*a+1],s[3*a+2]),a+=r}while((0,k.G)(i,n)&&a>=0&&a<o);e&&((0,k.h)(i,i,e),(0,k.h)(n,n,e)),g(i,n,[-1,-1],t),g(i,n,[1,-1],t),g(i,n,[1,1],t),g(i,n,[-1,-1],t),g(i,n,[1,1],t),g(i,n,[-1,1],t)},v=this._parameters.placement;"begin"!==v&&"begin-end"!==v||_(0,y.ASCENDING),"end"!==v&&"begin-end"!==v||_(o-1,y.DESCENDING)}}const es=(0,m.vt)(),ts=(0,m.vt)();var rs=r(20794),is=r(65352);const ns=["polyline","polygon","extent"],ss=new Lt.wI({size:!0,color:!0,rotation:!1,opacity:!0});class os extends Dt{constructor(e,t,r,i){super(e,t,r,i)}async doLoad(){if(this._fastUpdates=(0,Lt.s_)(this._context.renderer,ss),!this._drivenProperties.size&&(null!=this.symbolLayer.size?this.symbolLayer.size:(0,$e.PN)(1))<0)throw new n.A("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values")}_getMaterialParameters(e,t=!1){const r=this._getCombinedOpacityAndColor(t&&this._markerColor||this._materialColor);this._patternHidesLine&&!t&&(r[3]=0);const i={width:this._computeMaterialWidth(this.symbolLayer?.size),color:r,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:zn(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:(0,rs.Xq)(this.symbolLayer.pattern)};return this._fastUpdates?.visualVariables?{...i,...this._fastUpdates.materialParameters}:i}get _materialColor(){return this.symbolLayer.material?.color}get _markerColor(){return this.symbolLayer.marker?.color}get _lineMaterial(){return null==this._materials[us.Line]&&(this._materials[us.Line]=new is.W(this._getMaterialParameters(!1)),this._context.stage.add(this._materials[us.Line])),this._materials[us.Line]}get _ringMaterial(){return null==this._materials[us.Ring]&&(this._materials[us.Ring]=new is.W(this._getMaterialParameters(!0)),this._context.stage.add(this._materials[us.Ring])),this._materials[us.Ring]}get _wireframeLineMaterial(){return null==this._materials[us.LineWireframe]&&(this._materials[us.LineWireframe]=new is.W({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._materials[us.LineWireframe])),this._materials[us.LineWireframe]}get _wireframeRingMaterial(){return null==this._materials[us.RingWireframe]&&(this._materials[us.RingWireframe]=new is.W({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._materials[us.RingWireframe])),this._materials[us.RingWireframe]}get _markerMaterial(){return null==this._materials[us.Marker]&&null!=this.symbolLayer.marker&&(this._materials[us.Marker]=new Xn({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:Vn(this.symbolLayer.marker.style)}),this._context.stage.add(this._materials[us.Marker])),this._materials[us.Marker]}destroy(){super.destroy(),this._forEachMaterial((e=>this._context.stage.remove(e))),this._materials.length=0}_getDrivenSize(e){return this._drivenProperties.size&&e.size?(0,$e.Lz)(function(e){for(let t=0;t<3;t++){const r=e[t];if("number"==typeof r)return isFinite(r)?r:0}return 0}(e.size)):1}_getDrivenColor(e){const t=(0,D.fA)(1,1,1,1);return this._drivenProperties.color&&e.color&&(t[0]=e.color[0],t[1]=e.color[1],t[2]=e.color[2],e.color.length>0&&(t[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(t[3]=e.opacity),t}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,ns,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(t);return this.ensureDrapedStatus("on-the-ground"===r.mode),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,r,t.uid)}applyRendererDiff(e,t){for(const r in e.diff){if("visualVariables"!==r)return Et.RecreateSymbol;{const e=this._fastUpdates;if(!(0,Lt.J_)(e,t,ss))return Et.RecreateSymbol;this._forEachMaterial((t=>t?.setParameters(e.materialParameters)))}}return Et.FastUpdate}prepareSymbolLayerPatch(e){if("partial"!==e.diff.type)return;const t=e.diff.diff,r={};"complete"===t.size?.type&&(r.width=this._computeMaterialWidth(t.size.newValue),delete t.size),"complete"===t.cap?.type&&(r.cap=zn(t.cap.newValue??"butt"),delete t.cap);const i=this._prepareMarkerPatch(e,t);this._prepareMaterialPatch(e,t,i),e.symbolLayerStatePatches.push((()=>this._forEachMaterial((e=>e?.setParameters(r)))))}layerOpacityChanged(){this._forEachMaterial(((e,t)=>this._updateMaterialLayerOpacity(e,t===us.Marker)))}_forEachMaterial(e){this._materials.forEach(e)}_updateMaterialLayerOpacity(e,t=!1){if(null==e)return;const r=e.parameters.color,i=this.symbolLayer?.material?.color,n=this._patternHidesLine&&!t?0:this._getCombinedOpacity(i),s=(0,D.fA)(r[0],r[1],r[2],n);e.setParameters({color:s})}layerElevationInfoChanged(e,t,r){const i=this._elevationContext.mode,n=(0,v.I2)(os.elevationModeChangeTypes,r,i);if(n!==v.uw.UPDATE)return n;const s=(0,v.nu)(i);return this.updateGraphics3DGraphicElevationInfo(e,t,(()=>s))}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial((t=>t?.setParameters(e))),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,t,r){const i=as(e.graphic.geometry),n="polygon"===i.type?i.rings:i.paths,s=new Array,o=(0,$.vt)(),a=(0,Gn.C)(i,this._context.elevationProvider,this._context.renderCoordsHelper,t),l="polygon"===i.type?"rings":"paths";this._logGeometryCreationWarnings(a,n,l,"LineSymbol3DLayer");for(let t=0;t<a.lines.length;t++){const n=a.lines[t],l=n.position,c=n.mapPositions;if(null!=this._context.clippingExtent&&((0,$.Ie)(o),(0,$.Hq)(o,c),!(0,$.KG)(o,this._context.clippingExtent)))continue;const u=this._createGeometry("polygon"===i.type?this._ringMaterial:this._lineMaterial,e,l,c,i.type,cs.ELEVATED,r);s.push(u),Qe.b.LINE_WIREFRAMES&&s.push(u.instantiate({material:"polygon"===i.type?this._wireframeRingMaterial:this._wireframeLineMaterial})),null!=this._markerMaterial&&s.push(u.instantiate({material:this._markerMaterial}))}if(0===s.length)return null;const c=new Gt.B({geometries:s,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:r}),u=new bt(this,c,s,null,null,ot,t);return u.alignedSampledElevation=a.sampledElevation,u.needsElevationUpdates=(0,v.nu)(t.mode),u}_createGeometry(e,t,r,i,n,s,o){const a=s===cs.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,l="polygon"===n,c=this._fastUpdates?.visualVariables.color,u=this._fastUpdates?.visualVariables.size,h=this._fastUpdates?.visualVariables.opacity,d=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:o,layerUid:this._context.layer.uid}),p={position:r,size:u?null:this._getDrivenSize(t.renderingInfo),color:c?null:this._getDrivenColor(t.renderingInfo),sizeFeature:u?(0,Lt.ul)(u.field,t.graphic):null,colorFeature:c?(0,Lt.ul)(c.field,t.graphic):null,opacityFeature:h?(0,Lt.ul)(h.field,t.graphic):null};return(0,Un.t)(e,{overlayInfo:a,removeDuplicateStartEnd:l,mapPositions:i,attributeData:p},d)}_createAsOverlay(e,t){const r=e.graphic,i=as(r.geometry),n="polygon"===i.type?i.rings:i.paths,s="polygon"===i.type?this._ringMaterial:this._lineMaterial;s.renderPriority=this._renderPriority;const o=Qe.b.LINE_WIREFRAMES?"polygon"===i.type?this._wireframeRingMaterial:this._wireframeLineMaterial:null,a=this._markerMaterial;null!=o&&(o.renderPriority=this._renderPriority-.001),null!=a&&(a.renderPriority=this._renderPriority-.002);const l=new Array,c=(0,$.vt)(),u=(0,$.Ie)(),h=(0,Gn.A)(i,this._context.overlaySR),d="polygon"===i.type?"rings":"paths";this._logGeometryCreationWarnings(h,n,d,"LineSymbol3DLayer");for(const n of h.lines){if((0,$.Ie)(c),(0,$.Hq)(c,n.position),!(0,$.KG)(c,this._context.clippingExtent))continue;(0,$.RF)(u,c);const h=s=>{const o=this._createGeometry(s,e,n.position,void 0,i.type,cs.DRAPED,r.uid),a=new xn.$(o,{layerUid:t,graphicUid:r.uid});l.push(a)};if(null!=a){h(a);const e=this.symbolLayer.marker.placement;"begin"!==e&&"begin-end"!==e||(0,$.Hq)(c,n.position,0,1),"end"!==e&&"begin-end"!==e||(0,$.Hq)(c,n.position,n.position.length-3,1)}h(s),Qe.b.LINE_WIREFRAMES&&h(o)}return new Qi(this,l,u,this._context.drapeSourceRenderer)}get _patternHidesLine(){const e=this.symbolLayer.pattern;return null!=e&&"style"===e.type&&"none"===e.style}_computeMaterialWidth(e){return e=e??(0,$e.PN)(1),this._drivenProperties.size?this._fastUpdates?.visualVariables.size?(0,$e.Lz)(1):1:(0,$e.Lz)(e)}_prepareMaterialPatch(e,t,r){const i=t.material;if(null==i)return void(r.changed&&r.useMaterialColor&&ls(this._getCombinedOpacityAndColor(this._materialColor),this._materials[us.Marker],e));if("collection"===i.type)return;const n="complete"===i.type?i.newValue?.color:"complete"===i.diff.color?.type?i.diff.color.newValue:null,s=this._getCombinedOpacityAndColor(n);r.useMaterialColor&&ls((0,D.o8)(s),this._materials[us.Marker],e),this._patternHidesLine&&(s[3]=0),ls(s,this._materials[us.Line],e),delete t.material}_prepareMarkerPatch(e,t){const r=t.marker,i=this._markerMaterial;if(null==r||"partial"!==r.type||null==r.diff||null!=r.diff.placement||null!=r.diff.style&&"complete"!==r.diff.style.type||null!=r.diff.color&&"complete"!==r.diff.color.type||null==i)return{changed:!1,useMaterialColor:null==this._markerColor};const n=r.diff.color,s=null!=n,o=s?n.newValue:null,a=null==o&&null==this._markerColor;o&&ls(this._getCombinedOpacityAndColor(o),i,e);const l=r.diff.style?.newValue;return l&&e.symbolLayerStatePatches.push((()=>i.setParameters({markerPrimitive:Vn(l)}))),delete t.marker,{changed:s,useMaterialColor:a}}}function as(e){switch(e.type){case"extent":if(e instanceof Jr.default)return Lr.A.fromExtent(e);break;case"polygon":case"polyline":return e}return null}function ls(e,t,r){null!=t&&r.symbolLayerStatePatches.push((()=>t.setParameters({color:e})))}var cs,us;os.elevationModeChangeTypes={definedChanged:v.uw.RECREATE,staysOnTheGround:v.uw.NONE,onTheGroundChanged:v.uw.RECREATE},function(e){e[e.DRAPED=0]="DRAPED",e[e.ELEVATED=1]="ELEVATED"}(cs||(cs={})),function(e){e[e.Line=0]="Line",e[e.Ring=1]="Ring",e[e.LineWireframe=2]="LineWireframe",e[e.RingWireframe=3]="RingWireframe",e[e.Marker=4]="Marker"}(us||(us={}));var hs=r(56919),ds=r(5047),ps=r(54466),fs=r(95123),ms=r(16824),gs=r(67376),ys=r(83614),_s=r(14921),vs=r(43),bs=r(54200);class xs extends bt{constructor(){super(...arguments),this.fastTransformUpdatesAllowed=!1,this._originalGeometries=[],this._fastTransformUpdatesEnabled=!1,this._autoDisableFastUpdatesTimeoutId=0}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}destroy(){super.destroy(),this._cancelAutoDisableFastUpdates()}enableFastTransformUpdates(e,t){if(!this.fastTransformUpdatesAllowed||this._fastTransformUpdatesEnabled)return;this._cancelAutoDisableFastUpdates(),this._fastTransformUpdatesEnabled=!0;const{stageObject:r}=this,i=r.geometries.slice();r.removeAllGeometries();const n=(0,Ye.sC)(Ss,r.transformation),s=t.getOrigin(n);for(const t of i){const i=e(t.material),n=t.instantiate({material:i});n.localOrigin=s,r.addGeometry(n)}this._originalGeometries=i}autoDisableFastTransformUpdates(e){this._cancelAutoDisableFastUpdates(),this._autoDisableFastUpdatesTimeoutId=setTimeout((()=>{this._autoDisableFastUpdatesTimeoutId=0,e()}),2e3)}updateAutoDisableFastTransformUpdates(e){this._autoDisableFastUpdatesTimeoutId&&this.autoDisableFastTransformUpdates(e)}_cancelAutoDisableFastUpdates(){clearTimeout(this._autoDisableFastUpdatesTimeoutId),this._autoDisableFastUpdatesTimeoutId=0}disableFastTransformUpdates(e){if(!this._fastTransformUpdatesEnabled)return;this._cancelAutoDisableFastUpdates(),this._fastTransformUpdatesEnabled=!1;const{stageObject:t}=this,r=t.geometries.map((t=>e(t.material)));t.removeAllGeometries();for(let e=0;e<this._originalGeometries.length;e++){const i=this._originalGeometries[e],n=r[e];n.setParameters({modelTransformation:null}),n===i.material?t.addGeometry(i):t.addGeometry(i.instantiate({material:n}))}this._originalGeometries.length=0}updateFastLocalOrigin(e,t,r){if(!this._fastTransformUpdatesEnabled)return;const{stageObject:i}=this;if(0===i.geometries.length)return;const n=i.geometries[0].localOrigin,s=(0,Ye.sC)(Ss,e),o=r.getOrigin(s);if(o===n)return;const a=t?.localMatrix??Xe.zK;i.shaderTransformation=null,i.transformation=e,i.geometries.forEach((e=>{e.transformation=a,e.localOrigin=o}))}updateTransform(e,t,r){const{stageObject:i}=this,n=t?.localMatrix??Xe.zK;if(!this._fastTransformUpdatesEnabled)return i.shaderTransformation=null,i.transformation=e,i.geometries.forEach((e=>e.transformation=n)),void this._updateEdgeTransform(r);const s=i.transformation,o=i.geometries[0].transformation,a=e,l=n,c=(0,Ye.lw)(ws,s,o),u=(0,Ye.lw)(Ts,a,l),h=(0,Ye.lw)(Cs,u,(0,Ye.B8)(Cs,o));i.shaderTransformation=h,this._setFastMaterialTransformation({matA:c,matB:u}),this._updateEdgeTransform(r)}alignWithElevation(e,t,r,i){if(!this._fastTransformUpdatesEnabled)return void super.alignWithElevation(e,t,r,i);null!=r&&(0,x.gf)(this.elevationContext.featureExpressionInfoContext,r);const{stageObject:n}=this;if(!n.geometries[0].material.parameters.modelTransformation)return;const s=n.transformation,o=n.geometries[0].transformation,a=(0,Ye.lw)(ws,s,o),l=n.effectiveTransformation,c=(0,Ye.C)(As,l);this.alignedSampledElevation=it(this,this.elevationContext,e.spatialReference,((r,i)=>(0,v.sE)(r,e,this.elevationContext,t,i)),t,c),n.shaderTransformation=c;const u=n.geometries[0].transformation,h=(0,Ye.lw)(Ts,c,u);this._setFastMaterialTransformation({matA:a,matB:h}),this._updateEdgeTransform(i)}_setFastMaterialTransformation({matA:e,matB:t}){const{stageObject:r}=this;if(0===r.geometries.length)return;const i=r.geometries[0].localOrigin,n=(0,Ye.kN)(Rs,(0,k.j)(Ss,i.vec3,-1)),s=(0,Ye.lw)(Es,n,e),o=(0,Ye.lw)(Ms,n,t),a=(0,Ye.B8)(Es,s),l=(0,Ye.lw)(Ms,o,a);for(const e of r.geometries)e.material.setParameters({modelTransformation:l})}_updateEdgeTransform(e){const{stageObject:t,_stageLayer:r}=this;r.stage.renderer.withEdgeView((r=>{r.fastUpdateObject3DEdgesTransform(t)||this.resetEdgeObject(e)}))}}const Ss=(0,m.vt)(),ws=(0,Xe.vt)(),Ts=(0,Xe.vt)(),As=(0,Xe.vt)(),Cs=(0,Xe.vt)(),Es=(0,Xe.vt)(),Ms=(0,Xe.vt)(),Rs=(0,Xe.vt)();class Ps{constructor(){this._fastTransformOriginalMaterials=new Map,this._fastTransformClonedMaterials=new Map,this._graphicReferenceCount=0}enable(e,t,r){e.enableFastTransformUpdates((e=>{if(this._graphicReferenceCount<=1){if(this._fastTransformOriginalMaterials.has(e))return e;const r=t.byMaterial(e);return this._fastTransformOriginalMaterials.set(e,r),t.delete(e),e}const i=new we.$U(e.parameters);return r.stage.add(i),this._fastTransformClonedMaterials.set(i,e),i}),r.localOriginFactory)}disable(e,t,r){const i=new Set,n=new Set;e.disableFastTransformUpdates((e=>{if(!this._fastTransformClonedMaterials.has(e)){const r=e,s=this._fastTransformOriginalMaterials.get(r);return t.has(s.uid)?(i.add(r),t.byUid(s.uid).material):(n.add(r),s.material)}const s=e,o=this._fastTransformClonedMaterials.get(s);return this._fastTransformClonedMaterials.delete(s),r.stage.remove(s),o}));for(const e of i)this._fastTransformOriginalMaterials.delete(e),r.stage.remove(e);for(const e of n){const r=this._fastTransformOriginalMaterials.get(e);this._fastTransformOriginalMaterials.delete(e),t.set(r.uid,r)}}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(e,t,r){this._graphicReferenceCount--,this.disable(e,t,r)}forEachMaterialInfo(e){this._fastTransformOriginalMaterials.forEach(e)}forEachClonedMaterial(e){this._fastTransformClonedMaterials.forEach(e)}destroy(e){e.removeMany(Array.from(this._fastTransformClonedMaterials.keys())),e.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),(({material:e})=>e))),this._fastTransformClonedMaterials.clear(),this._fastTransformOriginalMaterials.clear()}}class Os{constructor(){this._byUid=new Map,this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),(e=>e.material))}byUid(e){return this._byUid.get(e)}byMaterial(e){return this._byMaterial.get(e)}set(e,t){this._byUid.set(e,t),this._byMaterial.set(t.material,t)}delete(e){const t=this._byMaterial.get(e)?.uid;t&&(this._byUid.delete(t),this._byMaterial.delete(e))}has(e){return this._byUid.has(e)}forEachMaterialInfo(e){this._byUid.forEach(e)}clear(){this._byUid.clear(),this._byMaterial.clear()}}var Is=r(9933),Ls=r(69508),Ns=r(73313),Ds=r(5596),Fs=r(90553),zs=r(84264),Vs=r(73318),Us=r(59121);class Gs extends or.w{initializeProgram(e){return new lr.B(e.rctx,Gs.shader.get().build(this.configuration),ar.D)}initializePipeline(){const e=this.configuration,t=(0,hr.p3)(ur.dn.SRC_ALPHA,ur.dn.ONE,ur.dn.ONE_MINUS_SRC_ALPHA,ur.dn.ONE_MINUS_SRC_ALPHA),r=(t,r=null,i=null)=>(0,hr.Ey)({blending:r,depthTest:jn.m,depthWrite:i,colorWrite:hr.wE,stencilWrite:e.hasOccludees?jn.v0:null,stencilTest:e.hasOccludees?t?jn.a9:jn.qh:null});return e.output===Kt.V.Color?(this._occludeePipelineState=r(!0,e.transparent?t:null,hr.kn),r(!1,e.transparent?t:null,hr.kn)):r(!1)}get primitiveType(){return ur.WR.LINES}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}Gs.shader=new sr.$(Us.N,(()=>r.e(9538).then(r.bind(r,69505))));class Bs extends fr.E{constructor(){super(...arguments),this.output=Kt.V.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.hasOccludees=!1}}(0,i._)([(0,pr.W)({count:Kt.V.COUNT})],Bs.prototype,"output",void 0),(0,i._)([(0,pr.W)()],Bs.prototype,"hasSlicePlane",void 0),(0,i._)([(0,pr.W)()],Bs.prototype,"hasVertexColors",void 0),(0,i._)([(0,pr.W)()],Bs.prototype,"transparent",void 0),(0,i._)([(0,pr.W)()],Bs.prototype,"hasOccludees",void 0);class Hs extends tr.im{constructor(e){super(e,new js),this._configuration=new Bs,this.produces=new Map([[rr.N.OPAQUE_MATERIAL,e=>e===Kt.V.Color||e===Kt.V.Highlight||e===Kt.V.ObjectAndLayerIdColor]])}getConfiguration(e){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration}intersect(e,t,r,i,n,s){if(!r.options.selectionMode||!e.visible)return;if(!(0,Fs.zH)(t))return void c.A.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const o=e.attributes.get(le.r.POSITION).data,a=r.camera,l=to;(0,Or.C)(l,r.point),(0,k.s)(ro[0],l[0]-2,l[1]+2,0),(0,k.s)(ro[1],l[0]+2,l[1]+2,0),(0,k.s)(ro[2],l[0]+2,l[1]-2,0),(0,k.s)(ro[3],l[0]-2,l[1]-2,0);for(let e=0;e<4;e++)if(!a.unprojectFromRenderScreen(ro[e],io[e]))return;(0,Ds.Cr)(a.eye,io[0],io[1],no),(0,Ds.Cr)(a.eye,io[1],io[2],so),(0,Ds.Cr)(a.eye,io[2],io[3],oo),(0,Ds.Cr)(a.eye,io[3],io[0],ao);let u=Number.MAX_VALUE,h=0;for(let e=0;e<o.length-5;e+=3){if(Ws[0]=o[e]+t[12],Ws[1]=o[e+1]+t[13],Ws[2]=o[e+2]+t[14],qs[0]=o[e+3]+t[12],qs[1]=o[e+4]+t[13],qs[2]=o[e+5]+t[14],(0,Ds.mN)(no,Ws)<0&&(0,Ds.mN)(no,qs)<0||(0,Ds.mN)(so,Ws)<0&&(0,Ds.mN)(so,qs)<0||(0,Ds.mN)(oo,Ws)<0&&(0,Ds.mN)(oo,qs)<0||(0,Ds.mN)(ao,Ws)<0&&(0,Ds.mN)(ao,qs)<0)continue;if(a.projectToRenderScreen(Ws,Ys),a.projectToRenderScreen(qs,Xs),Ys[2]<0&&Xs[2]>0){(0,k.f)(Zs,Ws,qs);const e=a.frustum,t=-(0,Ds.mN)(e[Ls.FB.NEAR],Ws)/(0,k.m)(Zs,(0,Ds.Qj)(e[Ls.FB.NEAR]));(0,k.j)(Zs,Zs,t),(0,k.g)(Ws,Ws,Zs),a.projectToRenderScreen(Ws,Ys)}else if(Ys[2]>0&&Xs[2]<0){(0,k.f)(Zs,qs,Ws);const e=a.frustum,t=-(0,Ds.mN)(e[Ls.FB.NEAR],qs)/(0,k.m)(Zs,(0,Ds.Qj)(e[Ls.FB.NEAR]));(0,k.j)(Zs,Zs,t),(0,k.g)(qs,qs,Zs),a.projectToRenderScreen(qs,Xs)}else if(Ys[2]<0&&Xs[2]<0)continue;Ys[2]=0,Xs[2]=0;const r=(0,Ns.kb)((0,Ns.Cr)(Ys,Xs,Ks),l);r<u&&(u=r,(0,k.c)(Js,Ws),(0,k.c)(Qs,qs),h=e/3)}const d=r.rayBegin,p=r.rayEnd;if(u<4){let e=Number.MAX_VALUE;if((0,Ns.ld)((0,Ns.Cr)(Js,Qs,Ks),(0,Ns.Cr)(d,p,eo),$s)){(0,k.f)($s,$s,d);const t=(0,k.l)($s);(0,k.j)($s,$s,1/t),e=t/(0,k.p)(d,p)}s(e,$s,h,!1)}}intersectDraped(e,t,r,i,n,s){if(!r.options.selectionMode)return;const o=e.attributes.get(le.r.POSITION).data,a=e.attributes.get(le.r.SIZE),l=a?a.data[0]:0,c=i[0],u=i[1],h=((l+1)/2+4)*e.screenToWorldRatio;let d=Number.MAX_VALUE,p=0;for(let e=0;e<o.length-5;e+=3){const t=o[e],r=o[e+1],i=c-t,n=u-r,s=o[e+3]-t,a=o[e+4]-r,l=(0,rn.qE)((s*i+a*n)/(s*s+a*a),0,1),h=s*l-i,f=a*l-n,m=h*h+f*f;m<d&&(d=m,p=e/3)}d<h*h&&n(s.dist,s.normal,p,!1)}createGLMaterial(e){return new ks(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?Vs.dB:Vs.Ci;return new zs.Z(e)}}class ks extends er.A{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===Kt.V.Color&&this._updateOccludeeState(e),this.ensureTechnique(Gs,e)}}class js extends tr.qA{constructor(){super(...arguments),this.color=D.Un,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.hasOccludees=!1}}const Ws=(0,m.vt)(),qs=(0,m.vt)(),Zs=(0,m.vt)(),$s=(0,m.vt)(),Ys=(0,$e.r_)(),Xs=(0,$e.r_)(),Js=(0,m.vt)(),Qs=(0,m.vt)(),Ks=(0,Ns.vt)(),eo=(0,Ns.vt)(),to=(0,m.vt)(),ro=[(0,$e.r_)(),(0,$e.r_)(),(0,$e.r_)(),(0,$e.r_)()],io=[(0,m.vt)(),(0,m.vt)(),(0,m.vt)(),(0,m.vt)()],no=(0,Ds.vt)(),so=(0,Ds.vt)(),oo=(0,Ds.vt)(),ao=(0,Ds.vt)();var lo=r(27539);const co=["mesh"];class uo{constructor(e,t,r){this.normals=e,this.indices=t,this.didFlipNormals=r}}function ho(e,t){return t.faces??(0,qr.tM)(e.vertexAttributes.position.length/3)}function po(e,t,r,i){switch(r.shading||"flat"){default:case"source":return function(e,t,r,i){if(null==t)return fo(e,i);let n=!1;if(!r.trustSourceNormals)for(let r=0;r<i.length;r+=3){go(e,i,r,Eo);for(let e=0;e<3;e++){const s=3*i[r+e];To[0]=t[s],To[1]=t[s+1],To[2]=t[s+2],(0,k.m)(Eo,To)<0&&(t[s]=-t[s],t[s+1]=-t[s+1],t[s+2]=-t[s+2],n=!0)}}return new uo(t,i,n)}(e,t,r,i);case"flat":return fo(e,i);case"smooth":return function(e,t){const r={};for(let i=0;i<t.length;i+=3){const n=go(e,t,i,Eo);for(let e=0;e<3;e++){const s=t[i+e];let o=r[s];o||(o={normal:(0,m.vt)(),count:0},r[s]=o),(0,k.g)(o.normal,o.normal,n),o.count++}}const i=(0,ds.oe)(3*t.length),n=new Array(3*t.length);for(let e=0;e<t.length;e++){const s=r[t[e]];1!==s.count&&((0,k.n)(s.normal,s.normal),s.count=1);for(let t=0;t<3;t++)i[3*e+t]=s.normal[t];n[e]=e}return new uo(i,n,!1)}(e,i)}}function fo(e,t){const r=(0,ds.oe)(t.length),i=new Array(3*t.length);for(let n=0;n<t.length;n+=3){const s=go(e,t,n,Eo);for(let e=0;e<3;e++)r[n+e]=s[e],i[n+e]=n/3}return new uo(r,i,!1)}function mo(e,t,r,i,n,s){const o=3*t[r],a=3*t[r+1],l=3*t[r+2];i[0]=e[o],i[1]=e[o+1],i[2]=e[o+2],n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],s[0]=e[l],s[1]=e[l+1],s[2]=e[l+2]}function go(e,t,r,i){return mo(e,t,r,To,Ao,Co),(0,k.f)(Ao,Ao,To),(0,k.f)(Co,Co,To),(0,k.b)(To,Ao,Co),(0,k.n)(i,To),i}function yo(e){if(!e)return null;const{scale:t,offset:r,rotation:i}=e;return{scale:t,offset:r,rotation:(0,rn.kU)(i)}}function _o(e="repeat"){if("string"==typeof e){const t=vo(e);return{s:t,t:t}}return{s:vo(e.horizontal),t:vo(e.vertical)}}function vo(e){switch(e){case"clamp":return ur.pF.CLAMP_TO_EDGE;case"mirror":return ur.pF.MIRRORED_REPEAT;default:return ur.pF.REPEAT}}function bo(e){return null==e?"-":e instanceof P.A?e.toHex():e.contentHash}function xo(e){const{offset:t,scale:r,rotation:i}=e??So;return`${t[0]},${t[1]},${i},${r[0]},${r[1]}`}const So=new ms.A,wo=(0,m.vt)(),To=(0,m.vt)(),Ao=(0,m.vt)(),Co=(0,m.vt)(),Eo=(0,m.vt)(),Mo=(0,Xe.vt)(),Ro=(0,Xe.vt)(),Po=(0,$.vt)(),Oo=[new ps.A];var Io;!function(e){e[e.NONE=0]="NONE",e[e.RENDER=1]="RENDER"}(Io||(Io={}));var Lo=r(24540),No=r(55726),Do=r(84321);class Fo{constructor(e,t,r,i){this.graphics3DSymbolLayer=e,this.instanceIndex=t,this.elevationAligner=r,this.elevationContext=i,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const t=this._lodRenderer.instanceData;e!==t.getVisible(this.instanceIndex)&&t.setVisible(this.instanceIndex,e)}destroy(){null!=this.instanceIndex&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,t,r){if(this.elevationAligner){(0,x.gf)(this.elevationContext.featureExpressionInfoContext,r);const i=(r,i)=>(0,v.sE)(r,e,this.elevationContext,t,i),n=this.elevationAligner(this,this.elevationContext,e.spatialReference,i,t);null!=n&&(this.alignedSampledElevation=n)}}getCenterObjectSpace(e=(0,m.vt)()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Bo),(0,k.h)(e,this._lodRenderer.baseBoundingSphere.center,Bo)}getBoundingBoxObjectSpace(e=(0,$.vt)()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Bo);const t=this._lodRenderer.baseBoundingBox;(0,$.Ie)(e);for(let r=0;r<8;++r)(0,k.s)(Vo,1&r?t[3]:t[0],2&r?t[4]:t[1],4&r?t[5]:t[2]),(0,k.h)(Vo,Vo,Bo),(0,$.iT)(e,Vo);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Bo),e.render.origin[0]+=Bo[12],e.render.origin[1]+=Bo[13],e.render.origin[2]+=Bo[14],e.render.num++}async getProjectedBoundingBox(e,t,r,i,n){const s=this.getBoundingBoxObjectSpace(n),o=Go,a=(0,$.fT)(s)?1:o.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Bo);for(let e=0;e<a;e++){const t=o[e];Vo[0]=s[t[0]],Vo[1]=s[t[1]],Vo[2]=s[t[2]],(0,k.h)(Vo,Vo,Bo),zo[3*e]=Vo[0],zo[3*e+1]=Vo[1],zo[3*e+2]=Vo[2]}if(!e(zo,0,a))return null;(0,$.Ie)(s);let l=null;this.calculateRelativeScreenBounds&&(l=this.calculateRelativeScreenBounds());for(let e=0;e<3*a;e+=3){for(let t=0;t<3;t++)s[t]=Math.min(s[t],zo[e+t]),s[t+3]=Math.max(s[t+3],zo[e+t]);l&&r.push({location:zo.slice(e,e+3),screenSpaceBoundingRect:l})}if(t&&((0,$.gX)(s,Uo),"absolute-height"!==this.elevationContext.mode)){let e;const r=(0,gt.vY)(s,t.service.spatialReference,t);try{e=await t.service.queryElevation(Uo[0],Uo[1],i,r,"ground")}catch(e){}null!=e&&(0,$.cY)(s,0,0,-this.alignedSampledElevation+e)}return s}addObjectState(e,t){if(e===yt.Mg.Highlight){const r=new Do.X(e);this._addHighlightId(r),t.addExternal((e=>{this._removeHighlightId(e)}),r)}}removeObjectState(e){this._highlights.forEach((t=>e.remove(t)))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}}const zo=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Vo=(0,m.vt)(),Uo=(0,m.vt)(),Go=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],Bo=(0,Xe.vt)();const Ho=20;var ko=r(45869),jo=r(3521),Wo=r(27923),qo=r(69550),Zo=r(65631),$o=r(67521),Yo=r(38177),Xo=r(35363),Jo=r(92754),Qo=r(76185),Ko=r(86305);class ea{constructor(e,t,r){this._elementSize=t,this._buffer=Ko.g.createVertex(e,ur._U.STATIC_DRAW),this.resize(r)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+this._buffer.usedMemory}copyRange(e,t,r,i=0){const n=new Uint8Array(this.array,e*this.elementSize,(t-e)*this.elementSize);new Uint8Array(r.array,i*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(e,t){const r=e*this._elementSize,i=t*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),r,r,i)}resize(e){const t=e*this._elementSize,r=new ArrayBuffer(t);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=r,this._buffer.setSize(t),this._capacity=e}}class ta{constructor(e){this.modelOriginHi=e.getField(le.r.INSTANCEMODELORIGINHI,Jo.xs),this.modelOriginLo=e.getField(le.r.INSTANCEMODELORIGINLO,Jo.xs),this.model=e.getField(le.r.INSTANCEMODEL,Jo.jZ),this.modelNormal=e.getField(le.r.INSTANCEMODELNORMAL,Jo.jZ),this.featureAttribute=e.getField(le.r.INSTANCEFEATUREATTRIBUTE,Jo.Eq),this.color=e.getField(le.r.INSTANCECOLOR,Jo.XP),this.objectAndLayerIdColor=e.getField(le.r.INSTANCEOBJECTANDLAYERIDCOLOR,Jo.XP)}}class ra{constructor(e,t){this._rctx=e,this._instanceBufferLayout=t,this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,t=this._tailIndex;return e>=t?e-t:e+this._capacity-t}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){return this._buffer?.usedMemory??0}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){(0,Fs.vA)(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){(0,Fs.vA)(this._updating,"not updating"),this.size<V.$U*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){(0,Fs.vA)(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),(0,Fs.vA)(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){(0,Fs.vA)(this._updating,"not updating"),(0,Fs.vA)(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(ia,Math.floor(this._capacity*V.Ji));this._resize(e)}_shrink(){const e=Math.max(ia,Math.floor(this._capacity*V.He));this._resize(e)}_resize(e){if((0,Fs.vA)(this._updating,"not updating"),e===this._capacity)return;const t=new ea(this._rctx,this._instanceBufferLayout.stride,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const e=this.size,r=this._compactInstances(t);(0,Fs.vA)(r===e,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=r,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=t,this._view=new ta(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const t=this._headIndex,r=this._tailIndex;return r<t?(this._buffer.copyRange(r,t,e),t-r):r>t?(this._buffer.copyRange(r,this._capacity,e),t>0&&this._buffer.copyRange(0,t,e,this._capacity-r),t+(this._capacity-r)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,t){e<t?this._buffer.transferRange(e,t):e>t&&(t>0&&this._buffer.transferRange(0,t),this._buffer.transferRange(e,this._capacity))}}const ia=64;var na;!function(e){e[e.ALLOCATED=1]="ALLOCATED",e[e.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",e[e.VISIBLE=4]="VISIBLE",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",e[e.REMOVE=32]="REMOVE",e[e.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",e[e.ACTIVE=18]="ACTIVE"}(na||(na={}));class sa{constructor(e){this.localTransform=e.getField(le.r.LOCALTRANSFORM,Jo.E$),this.globalTransform=e.getField(le.r.GLOBALTRANSFORM,Jo.E$),this.modelOrigin=e.getField(le.r.MODELORIGIN,Jo.Xm),this.model=e.getField(le.r.INSTANCEMODEL,Jo.jZ),this.modelNormal=e.getField(le.r.INSTANCEMODELNORMAL,Jo.jZ),this.modelScaleFactors=e.getField(le.r.MODELSCALEFACTORS,Jo.gH),this.boundingSphere=e.getField(le.r.BOUNDINGSPHERE,Jo.Aj),this.featureAttribute=e.getField(le.r.FEATUREATTRIBUTE,Jo.Eq),this.color=e.getField(le.r.COLOR,Jo.XP),this.objectAndLayerIdColor=e.getField(le.r.OBJECTANDLAYERIDCOLOR,Jo.XP),this.state=e.getField(le.r.STATE,Jo.SL),this.lodLevel=e.getField(le.r.LODLEVEL,Jo.SL)}}let oa=class extends T.A{constructor(e,t){super(e),this.events=new ze.A,this._capacity=0,this._size=0,this._next=0,this._layout=function(e){let t=(0,Qt.BP)().mat4f64(le.r.LOCALTRANSFORM).mat4f64(le.r.GLOBALTRANSFORM).vec4f64(le.r.BOUNDINGSPHERE).vec3f64(le.r.MODELORIGIN).mat3f(le.r.INSTANCEMODEL).mat3f(le.r.INSTANCEMODELNORMAL).vec2f(le.r.MODELSCALEFACTORS);return e.includes(le.r.FEATUREATTRIBUTE)&&(t=t.vec4f(le.r.FEATUREATTRIBUTE)),e.includes(le.r.COLOR)&&(t=t.vec4u8(le.r.COLOR)),e.includes(le.r.OBJECTANDLAYERIDCOLOR)&&(t=t.vec4u8(le.r.OBJECTANDLAYERIDCOLOR)),t=t.u8(le.r.STATE).u8(le.r.LODLEVEL),t}(t),this._capacity=ia,this._buffer=this._layout.createBuffer(this._capacity),this._view=new sa(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,na.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const t=this._view.state;(0,Fs.vA)(e>=0&&e<this._capacity&&!!(t.get(e)&na.ALLOCATED),"invalid instance handle"),this._getStateFlag(e,na.ACTIVE)?this._setStateFlags(e,na.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const t=this._view.state;(0,Fs.vA)(e>=0&&e<this._capacity&&!!(t.get(e)&na.ALLOCATED),"invalid instance handle"),t.set(e,0),this._size--}setLocalTransform(e,t,r=!0){this._view.localTransform.setMat(e,t),r&&this.updateModelTransform(e)}getLocalTransform(e,t){this._view.localTransform.getMat(e,t)}setGlobalTransform(e,t,r=!0){this._view.globalTransform.setMat(e,t),r&&this.updateModelTransform(e)}getGlobalTransform(e,t){this._view.globalTransform.getMat(e,t)}updateModelTransform(e){const t=this._view,r=aa,i=la;t.localTransform.getMat(e,ca),t.globalTransform.getMat(e,ua);const n=(0,Ye.lw)(ua,ua,ca);(0,k.s)(r,n[12],n[13],n[14]),t.modelOrigin.setVec(e,r),(0,kr.z0)(i,n),t.model.setMat(e,i);const s=(0,Qo.wp)(aa,n);s.sort(),t.modelScaleFactors.set(e,0,s[1]),t.modelScaleFactors.set(e,1,s[2]),(0,kr.B8)(i,i),(0,kr.mg)(i,i),t.modelNormal.setMat(e,i),this._setStateFlags(e,na.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,t){const r=this._view;r.model.getMat(e,la),r.modelOrigin.getVec(e,aa),t[0]=la[0],t[1]=la[1],t[2]=la[2],t[3]=0,t[4]=la[3],t[5]=la[4],t[6]=la[5],t[7]=0,t[8]=la[6],t[9]=la[7],t[10]=la[8],t[11]=0,t[12]=aa[0],t[13]=aa[1],t[14]=aa[2],t[15]=1}applyShaderTransformation(e,t){null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,e,t)}getCombinedModelTransform(e,t){return this.getModelTransform(e,t),null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,e,t),t}getCombinedLocalTransform(e,t){this._view.localTransform.getMat(e,t),null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,e,t)}getCombinedMaxScaleFactor(e){let t=this._view.modelScaleFactors.get(e,1);return null!=this.shaderTransformation&&(this.shaderTransformation.scaleFactor(aa,this,e),t*=Math.max(aa[0],aa[1],aa[2])),t}getCombinedMedianScaleFactor(e){let t=this._view.modelScaleFactors.get(e,0);return null!=this.shaderTransformation&&(this.shaderTransformation.scaleFactor(aa,this,e),t*=function(e,t,r){return Math.max(Math.min(e,t),Math.min(Math.max(e,t),r))}(aa[0],aa[1],aa[2])),t}getModel(e,t){this._view.model.getMat(e,t)}setFeatureAttribute(e,t){this._view.featureAttribute.setVec(e,t)}getFeatureAttribute(e,t){this._view.featureAttribute.getVec(e,t)}setColor(e,t){this._view.color.setVec(e,t)}setObjectAndLayerIdColor(e,t){this._view.objectAndLayerIdColor.setVec(e,t)}setVisible(e,t){t!==this.getVisible(e)&&(this._setStateFlag(e,na.VISIBLE,t),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,na.VISIBLE)}setHighlight(e,t){t!==this.getHighlight(e)&&(this._setStateFlag(e,na.HIGHLIGHT,t),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,na.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let t=0;for(let r=0;r<this._capacity;++r)this.getState(r)&e&&++t;return t}_setStateFlags(e,t){const r=this._view.state;t=r.get(e)|t,r.set(e,t)}_clearStateFlags(e,t){const r=this._view.state;t=r.get(e)&~t,r.set(e,t)}_setStateFlag(e,t,r){r?this._setStateFlags(e,t):this._clearStateFlags(e,t)}_getStateFlag(e,t){return!!(this._view.state.get(e)&t)}_grow(){this._capacity=Math.max(ia,Math.floor(this._capacity*V.Ji)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new sa(this._buffer)}_findSlot(){const e=this._view.state;let t=this._next;for(;e.get(t)&na.ALLOCATED;)t=t+1===this._capacity?0:t+1;return this._next=t+1===this._capacity?0:t+1,t}};(0,i._)([(0,a.MZ)({constructOnly:!0})],oa.prototype,"shaderTransformation",void 0),(0,i._)([(0,a.MZ)()],oa.prototype,"_size",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],oa.prototype,"size",null),oa=(0,i._)([(0,u.$)("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],oa);const aa=(0,m.vt)(),la=(0,jr.vt)(),ca=(0,Xe.vt)(),ua=(0,Xe.vt)();class ha extends Xo.A{constructor(e,t){super((e=>(0,mt.w)(this._instanceData.view.boundingSphere.getVec(e,this._tmpSphere))),{maximumDepth:25}),this._instanceData=e,this._boundingSphere=t,this._tmpSphere=(0,mt.c)(),this._tmpMat4=(0,Xe.vt)()}addInstance(e){const t=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);(0,k.h)((0,mt.g)(this._tmpSphere),this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*(0,Qo.hG)(r),t.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}}class da{constructor(e,t){this._worldSpaceRadius=e,this._minScreenSpaceRadii=t}selectLevel(e,t,r){const i=r.computeScreenPixelSizeAt(e),n=this._worldSpaceRadius*t/i;let s=0;for(let e=1;e<this._minScreenSpaceRadii.length;++e)n>=this._minScreenSpaceRadii[e]&&(s=e);return s}}var pa=r(52798),fa=r(49845),ma=r(69445),ga=r(50456);r(59356);class ya extends ga.R6{constructor(e,t,r,i,n,s){super(e,t),this.layerUid=e,this.graphicUid=t,this.geometryId=r,this.triangleNr=i,this.baseBoundingSphere=n,this.numLodLevels=s}}class _a{constructor(e,t){const r=e.renderContext.rctx,i=t.geometry;this._materials=e.materials,i.material.setParameters({instancedDoublePrecision:!0});const n=i.material.createBufferWriter(),s=n.vertexBufferLayout,o=n.elementCount(i),a=s.createBuffer(o);n.write(null,null,i,a,0),this.geometry=i,this.material=i.material,this.glMaterials=new pa.c(i.material,this._materials),this.vertexBufferLayout=s,this.vbo=Ko.g.createVertex(r,ur._U.STATIC_DRAW,a.buffer),this.vao=new ma.Z(r,ar.D,{geometry:(0,qo.U)(s)},{geometry:this.vbo}),this.vertexCount=o}destroy(){this.glMaterials.dispose(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,t,r,i,n,s,o,a){const l=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,r,i,((r,i,c,u,h)=>{if(r>=0){if(null!=t&&!t(e.rayBegin,e.rayEnd,r))return;const u=new ya(s.layerUid,s.graphicUid(n),l,c,o,a);if((null==e.results.min.drapedLayerOrder||h>=e.results.min.drapedLayerOrder)&&(null==e.results.min.dist||r<e.results.min.dist)&&e.results.min.set(Yo.dz.LOD,u,r,i,e.transform.transform,h),e.options.store!==Yo.oH.MIN&&(null==e.results.max.drapedLayerOrder||h>=e.results.max.drapedLayerOrder)&&(null==e.results.max.dist||r>e.results.max.dist)&&e.results.max.set(Yo.dz.LOD,u,r,i,e.transform.transform,h),e.options.store===Yo.oH.ALL){const t=(0,fa.G7)(e.results.min.ray);t.set(Yo.dz.LOD,u,r,i,e.transform.transform,h),e.results.all.push(t)}}}))}}class va{static async create(e,t,r){const i=await Promise.allSettled(t.components.map((t=>e.controller.schedule((()=>new _a(e,t)),r)))),n=i.map((e=>"fulfilled"===e.status?e.value:null)).filter(V.Ru);if((0,d.G4)(r)||n.length!==i.length){n.forEach((e=>e.destroy())),(0,d.Te)(r);for(const e of i)if("rejected"===e.status)throw e.reason}return new va(t.minScreenSpaceRadius,n)}constructor(e,t){this.minScreenSpaceRadius=e,this.components=t}destroy(){this.components.forEach((e=>e.destroy()))}intersect(e,t,r,i,n,s,o){this.components.forEach((a=>a.intersect(e,t,r,i,n,s,this.boundingSphere,o)))}get boundingBox(){if(null==this._boundingBox){const e=(0,$.Ie)();this.components.forEach((t=>{null!=t.boundingInfo&&((0,$.iT)(e,t.boundingInfo.bbMin),(0,$.iT)(e,t.boundingInfo.bbMax))})),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(null==this._boundingSphere){const e=this.boundingBox,t=(0,m.vt)();(0,$.gX)(e,t),this._boundingSphere={center:t,radius:.5*(0,$._F)(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce(((e,t)=>e+t.triangleCount),0)}}var ba=r(84887),xa=r(84738),Sa=r(77032),wa=r(93380);let Ta=class extends $o.S{constructor(e,t){super(e),this.type=Yo.dz.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[new Array],this._highlightRenderInstanceData=[new Array],this._allRenderInstanceData=[this._defaultRenderInstanceData[0],this._highlightRenderInstanceData[0]],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new Zo.A,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.produces=new Map([[rr.N.OPAQUE_MATERIAL,e=>this._produces(e)],[rr.N.TRANSPARENT_MATERIAL,e=>!!this._hasTransparentLevels()&&this._produces(e)]]),this._instanceData=new oa({shaderTransformation:e.shaderTransformation},e.optionalFields),this.addHandles(t.registerTask(De.W6.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=function(e){let t=(0,Qt.BP)().vec3f(le.r.INSTANCEMODELORIGINHI).vec3f(le.r.INSTANCEMODELORIGINLO).mat3f(le.r.INSTANCEMODEL).mat3f(le.r.INSTANCEMODELNORMAL);return null!=e&&e.includes("featureAttribute")&&(t=t.vec4f(le.r.INSTANCEFEATUREATTRIBUTE)),null!=e&&e.includes("color")&&(t=t.vec4u8(le.r.INSTANCECOLOR)),null!=e&&e.includes("objectAndLayerIdColor")&&(t=t.vec4u8(le.r.INSTANCEOBJECTANDLAYERIDCOLOR)),t}(this.optionalFields),this._glInstanceBufferLayout=(0,qo.U)(this._instanceBufferLayout,1),this.addHandles([this._instanceData.events.on("instances-changed",(()=>this._requestUpdateCycle())),this._instanceData.events.on("instance-transform-changed",(({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)})),this._instanceData.events.on("instance-visibility-changed",(({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)})),this._instanceData.events.on("instance-highlight-changed",(()=>this._requestUpdateCycle(!0)))])}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get usedMemory(){return this._allRenderInstanceData.reduce(((e,t)=>t.reduce(((e,t)=>e+t.usedMemory),e)),0)}get renderStats(){const e=this._instanceData.size,t=[];return this._levels.forEach(((e,r)=>{const i=this._allRenderInstanceData[0][r].size+this._allRenderInstanceData[1][r].size,n=e.triangleCount;t.push({renderedInstances:i,renderedTriangles:i*n,trianglesPerInstance:n})})),{totalInstances:e,renderedInstances:t.reduce(((e,t)=>e+t.renderedInstances),0),renderedTriangles:t.reduce(((e,t)=>e+t.renderedTriangles),0),levels:t}}async initializeRenderContext(e,t){this._context=e;const r=e.renderContext.rctx,i=await Promise.allSettled(this.symbol.levels.map((i=>(this._defaultRenderInstanceData[0].push(new ra(r,this._instanceBufferLayout)),this._highlightRenderInstanceData[0].push(new ra(r,this._instanceBufferLayout)),va.create(e,i,t))))),n=i.map((e=>"fulfilled"===e.status?e.value:null)).filter(V.Ru);if((0,d.G4)(t)||n.length!==i.length){n.forEach((e=>e.destroy())),(0,d.Te)(t);for(const e of i)if("rejected"===e.status)throw e.reason}this._levels=n,this._levelSelector=(e=>{const t=e.baseBoundingSphere.radius,r=e.levels.map((e=>e.minScreenSpaceRadius));return new da(t,r)})(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach((e=>e.destroy())),this._defaultRenderInstanceData[0].forEach((e=>e.destroy())),this._highlightRenderInstanceData[0].forEach((e=>e.destroy()))}_hasTransparentLevels(){return this._levels.some((e=>e.components.some((e=>{const t=e.material.produces.get(rr.N.TRANSPARENT_MATERIAL);return t?.(Kt.V.Color)}))))}hasHighlights(){return this._highlightRenderInstanceData[0].some((e=>e.size>0))}_produces(e){return e!==Kt.V.Highlight&&e!==Kt.V.ShadowHighlight||this.hasHighlights()}prepareRender(e){if(!Qe.b.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const t=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),t||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(De.Bb),this._needFullCycle=!1)}}prepareTechniques(e){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output))return null;const t=this._getInstanceDatas(e.output);if(!t)return null;const r=new Array;return t.forEach((t=>this.levels.forEach(((i,n)=>{i.components.forEach((i=>r.push(this._beginComponent(e,t[n],i))))})))),r}renderNode(e,t){const r=this._getInstanceDatas(e.output);if(!r||null==t)return;let i=0;e.rctx.bindVAO(),r.forEach((r=>this.levels.forEach(((n,s)=>{n.components.forEach((n=>this._renderComponent(e,t[i++],r[s],n,s)))}))))}_getInstanceDatas(e){const t=e!==Kt.V.Highlight&&e!==Kt.V.ShadowHighlight,r=e!==Kt.V.ShadowExcludeHighlight;return t&&r?this._allRenderInstanceData:t?this._defaultRenderInstanceData:r?this._highlightRenderInstanceData:null}intersect(e,t,r,i){if(!this.baseMaterial.isVisible()||null==this._octree)return;const n=(0,m.vt)();(0,k.f)(n,i,r);const s=n=>{this._instanceData.getCombinedModelTransform(n,Ma),e.transform.set(Ma),(0,k.h)(Ra,r,e.transform.inverse),(0,k.h)(Pa,i,e.transform.inverse);const s=this._instanceData.getState(n),o=this._instanceData.getLodLevel(n),a=this._levels.length;(0,Fs.vA)(!!(s&na.ACTIVE),"invalid instance state"),(0,Fs.vA)(o>=0&&o<a,"invaid lod level"),this._levels[o].intersect(e,t,Ra,Pa,n,this.metadata,a)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(s):this._octree.forEachAlongRay(r,n,s)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){if(null==this._octreeCached){const e=this._instanceData,t=e.view?.state;if(!t)return null;this._octreeCached=new ha(e,this.baseBoundingSphere);for(let r=0;r<e.capacity;++r)t.get(r)&na.ACTIVE&&this._octreeCached.addInstance(r)}return this._octreeCached}_invalidateOctree(){this._octreeCached=(0,s.pR)(this._octreeCached)}queryDepthRange(e){if(null==this._octree)return{near:1/0,far:-1/0};const t=e.viewForward,r=this._octree.findClosest(t,Xo.A.DepthOrder.FRONT_TO_BACK,e.frustum),i=this._octree.findClosest(t,Xo.A.DepthOrder.BACK_TO_FRONT,e.frustum);if(null==r||null==i)return{near:1/0,far:-1/0};const n=e.eye,s=this._instanceData.view;s.boundingSphere.getVec(r,Ea),(0,k.f)(Ea,Ea,n);const o=(0,k.m)(Ea,t)-Ea[3];s.boundingSphere.getVec(i,Ea),(0,k.f)(Ea,Ea,n);const a=(0,k.m)(Ea,t)+Ea[3];return{near:Math.max(e.near,o),far:Math.min(e.far,a)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach((e=>e.forEach((e=>e.startUpdateCycle()))))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:t,_camera:r,_levelSelector:i}=this;this._allRenderInstanceData.forEach((e=>e.forEach((e=>e.beginUpdate()))));const n=this._instanceData,s=n.view;let o=n.size;const a=n.capacity;let l=this._instanceIndex;const c=Math.ceil(a/500);for(let u=0;u<o&&!e.done;++u){l===this._cycleStartIndex&&this._startUpdateCycle();const u=s.state.get(l);let h=0;if(!(u&na.ALLOCATED)){l=l+1===a?0:l+1,o++;continue}const d=s.lodLevel.get(l);if(u&na.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][d].freeTail(),u&na.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][d].freeTail(),u&na.REMOVE)n.freeInstance(l);else if(u&na.VISIBLE){let e=0;t&&(s.modelOrigin.getVec(l,Ca),e=i.selectLevel(Ca,n.getCombinedMedianScaleFactor(l),r)),h=u&~(na.ACTIVE|na.TRANSFORM_CHANGED),e>=0&&(u&na.HIGHLIGHT?(Aa(this._highlightRenderInstanceData[0][e],s,l),h|=na.HIGHLIGHT_ACTIVE):(Aa(this._defaultRenderInstanceData[0][e],s,l),h|=na.DEFAULT_ACTIVE)),s.state.set(l,h),s.lodLevel.set(l,e)}else h=u&~(na.ACTIVE|na.TRANSFORM_CHANGED),s.state.set(l,h);if(null!=this._octreeCached){const e=!!(u&na.ACTIVE),t=!!(h&na.ACTIVE);!e&&t?this._octreeCached.addInstance(l):e&&!t?this._octreeCached.removeInstance(l):e&&t&&u&na.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(l),this._octreeCached.addInstance(l))}l=l+1===a?0:l+1,l%c==0&&e.madeProgress()}this._instanceIndex=l,this._allRenderInstanceData.forEach((e=>e.forEach((e=>e.endUpdate())))),this._context.requestRender()}_beginComponent(e,t,r){if(0===t.size)return null;const i=r.glMaterials.load(e.rctx,e.bindParameters.slot,e.output);return null!=i?i.beginSlot(e.bindParameters):null}_renderComponent(e,t,r,i,n){if(!t)return;const{bindParameters:s,rctx:o}=e;o.runAppleAmdDriverHelper();const a=o.bindTechnique(t,s,i.material.parameters,Ia);o.bindVAO(i.vao),t.ensureAttributeLocations(i.vao),Qe.b.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===Kt.V.Color&&(a.setUniform4fv("externalColor",Oa[Math.min(n,Oa.length-1)]),a.setUniform1i("colorMixMode",ba.Um.replace));const l=r.capacity,c=r.headIndex,u=r.tailIndex,h=r.firstIndex,d=this._glInstanceBufferLayout,p=(e,n)=>{(0,wa.yu)(o,ar.D,r.buffer,d,e),o.drawArraysInstanced(t.primitiveType,0,i.vertexCount,n-e),(0,wa.Hi)(o,ar.D,r.buffer,d)};i.material.parameters.transparent&&null!=h?c>u?((0,Fs.vA)(h>=u&&h<=c,"invalid firstIndex"),p(h,c),p(u,h)):c<u&&(h<=c?((0,Fs.vA)(h>=0&&h<=c,"invalid firstIndex"),p(h,c),p(u,l),p(0,h)):((0,Fs.vA)(h>=u&&h<=l,"invalid firstIndex"),p(h,l),p(0,c),p(u,h))):c>u?p(u,c):c<u&&(p(0,c),p(u,l)),o.bindVAO(null)}};function Aa(e,t,r){const i=e.allocateHead();!function(e,t,r,i){(0,xa.Vk)(e.modelOrigin,t,r.modelOriginHi,r.modelOriginLo,i),r.model.copyFrom(i,e.model,t),r.modelNormal.copyFrom(i,e.modelNormal,t),e.color&&r.color&&r.color.copyFrom(i,e.color,t),e.objectAndLayerIdColor&&r.objectAndLayerIdColor&&r.objectAndLayerIdColor.copyFrom(i,e.objectAndLayerIdColor,t),e.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(i,e.featureAttribute,t)}(t,r,e.view,i)}(0,i._)([(0,a.MZ)({constructOnly:!0})],Ta.prototype,"symbol",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],Ta.prototype,"optionalFields",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],Ta.prototype,"metadata",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],Ta.prototype,"shaderTransformation",void 0),(0,i._)([(0,a.MZ)()],Ta.prototype,"_instanceData",void 0),(0,i._)([(0,a.MZ)()],Ta.prototype,"_cycleStartIndex",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],Ta.prototype,"_enableLevelSelection",null),(0,i._)([(0,a.MZ)()],Ta.prototype,"_updateCyclesWithStaticCamera",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],Ta.prototype,"running",null),Ta=(0,i._)([(0,u.$)("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],Ta);const Ca=(0,m.vt)(),Ea=(0,D.vt)(),Ma=(0,Xe.vt)(),Ra=(0,m.vt)(),Pa=(0,m.vt)(),Oa=[(0,D.fA)(1,0,1,1),(0,D.fA)(0,0,1,1),(0,D.fA)(0,1,0,1),(0,D.fA)(1,1,0,1),(0,D.fA)(1,0,0,1)],Ia=new Sa.V;class La{constructor(e,t,r,i,n,s,o,a,l,c,u,h){this.lodResources=e,this.lodRenderer=t,this.stageResources=r,this.originalMaterialParameters=i,this.resourceSize=n,this.isEsriSymbolResource=s,this.isWosr=o,this.resourceBoundingBox=a,this.symbolSize=l,this.extentPadding=c,this.physicalBasedRenderingEnabled=u,this.pivotOffset=h}}function Na(e,t,r){const i=(0,m.vt)();switch(r.anchor){case"center":(0,k.c)(i,(0,$.gX)(e)),(0,k.k)(i,i);break;case"top":{const t=(0,$.gX)(e);(0,k.s)(i,-t[0],-t[1],-e[5]);break}case"bottom":{const t=(0,$.gX)(e);(0,k.s)(i,-t[0],-t[1],-e[2]);break}case"relative":{const t=(0,$.gX)(e),n=(0,$.Ej)(e),s=r.anchorPosition,o=s?(0,m.fA)(s.x,s.y,s.z):m.uY;(0,k.B)(i,n,o),(0,k.g)(i,i,t),(0,k.k)(i,i);break}default:null!=t?(0,k.k)(i,t):(0,k.c)(i,m.uY)}return i}function Da(e){return"absolute-height"!==e.mode}const Fa=(0,m.vt)(),za=(0,Xe.vt)(),Va=(0,Xe.vt)(),Ua=(0,D.vt)(),Ga=new v.Uk;class Ba{constructor(e,t,r,i){this.vertices=e,this.positionsES=t,this.offset=i;const n=e.length,s=Math.floor(n/2),o=this.offset+3*s,a=r[o],l=r[o+1],c=r[o+2];this.origin=(0,m.fA)(a,l,c),this.positions=(0,ds.oe)(3*n);const u=this.offset+3*n;for(let e=this.offset;e<u;e+=3)this.positions[e]=r[e]-a,this.positions[e+1]=r[e+1]-l,this.positions[e+2]=r[e+2]-c;this.updatePathVertexInformation()}get usedMemory(){return(0,Lo.Ek)(this.positions)}updatePathVertexInformation(){const e=this.vertices.length,t=this.vertices[0];let r=this.offset;const i=this.positions;t.vRight[0]=i[r+3]-i[r],t.vRight[1]=i[r+4]-i[r+1],t.vRight[2]=i[r+5]-i[r+2],r+=3;let n=(0,k.l)(t.vRight);t.vMinSiblingLength=n,(0,k.n)(t.vRight,t.vRight);let s=t;for(let t=1;t<e;++t){const o=this.vertices[t];if(o.vLeft=s.vRight,t<e-1){o.vRight[0]=i[r+3]-i[r],o.vRight[1]=i[r+4]-i[r+1],o.vRight[2]=i[r+5]-i[r+2];const e=(0,k.l)(o.vRight);o.vMinSiblingLength=Math.min(n,e),n=e,(0,k.n)(o.vRight,o.vRight)}else(0,k.c)(o.vRight,o.vLeft),o.vMinSiblingLength=n;s=o,r+=3}}}class Ha{constructor(e,t,r,i,n,s={}){this.path=e,this.profile=t,this.extruder=r,this.startCap=i,this.endCap=n,this.options=s,this._extrusionVertexCount=0;const o=this.path.vertices.length-2;this.numExtrusionProfiles=r.numProfilesPerJoin()*o+2,this.numVerticesTotal=t.vertices.length*this.numExtrusionProfiles,this.startCap.vertexBufferStart=this.numVerticesTotal;const a=this.startCap.numVertices;this.numVerticesTotal+=a,this.endCap.vertexBufferStart=this.numVerticesTotal;const l=this.endCap.numVertices;this.numVerticesTotal+=l,this.pathVertexData=(0,qr.JH)(1*this.numVerticesTotal),this.profileRightAxes=(0,ds.oe)(4*this.numVerticesTotal),this.profileUpAxes=(0,ds.oe)(4*this.numVerticesTotal),this.profileVertexAndNormals=(0,ds.oe)(4*this.numVerticesTotal),this.positions=(0,ds.AK)(e.positions,e.offset,3*e.vertices.length),this._rebuildGeometry(),this.buildTopology()}get usedMemory(){return(0,Lo.Ek)(this.pathVertexData,this.profileRightAxes,this.profileUpAxes,this.profileVertexAndNormals)+this.path.usedMemory+this.profile.usedMemory}emitVertex(e,t,r,i,n){const s=4*this._extrusionVertexCount;if(this.profileRightAxes[s]=t.right[0],this.profileRightAxes[s+1]=t.right[1],this.profileRightAxes[s+2]=t.right[2],this.profileUpAxes[s]=t.up[0],this.profileUpAxes[s+1]=t.up[1],this.profileUpAxes[s+2]=t.up[2],this.profileVertexAndNormals[s]=r[0],this.profileVertexAndNormals[s+1]=r[1],this.profileVertexAndNormals[s+2]=i[0],this.profileVertexAndNormals[s+3]=i[1],this.pathVertexData[this._extrusionVertexCount]=e,n){const t=this.path.vertices[e],r=t.maxStretchDistance;this.profileRightAxes[s+3]=t.rotationRight[0]*r,this.profileUpAxes[s+3]=t.rotationRight[1]*r}else this.profileRightAxes[s+3]=0,this.profileUpAxes[s+3]=0;++this._extrusionVertexCount}emitCapVertex(e,t,r,i,n,s){const o=4*this._extrusionVertexCount;this.profileRightAxes[o]=t.right[0],this.profileRightAxes[o+1]=t.right[1],this.profileRightAxes[o+2]=t.right[2],this.profileRightAxes[o+3]=n,this.profileUpAxes[o]=t.up[0],this.profileUpAxes[o+1]=t.up[1],this.profileUpAxes[o+2]=t.up[2],this.profileUpAxes[o+3]=s,this.profileVertexAndNormals[o]=r[0],this.profileVertexAndNormals[o+1]=r[1],this.profileVertexAndNormals[o+2]=i[0],this.profileVertexAndNormals[o+3]=i[1],this.pathVertexData[this._extrusionVertexCount]=e,++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const{positions:e,offset:t,vertices:r}=this.path;this.positions=(0,ds.AK)(e,t,3*r.length);let i=0;const n=(e,t,r,n,s)=>this.emitCapVertex(i,e,t,r,n,s),s=(e,t,r,n)=>this.emitVertex(i,e,t,r,n);for(this.startCap.rebuildConnectingProfileGeometry(r[i],this.profile,n),i=1;i<r.length-1;++i)this.extruder.extrude(r[i],this.profile,s);this.endCap.rebuildConnectingProfileGeometry(r[i],this.profile,n),i=0,this.startCap.rebuildCapGeometry(r[i],n),i=r.length-1,this.endCap.rebuildCapGeometry(r[i],n)}buildTopology(){const e=this.profile.vertices.length,t=this.profile.numSegments,r=this.numExtrusionProfiles-1;let i=t*r*2*3;this.startCap.indexBufferStart=i,this.startCap.firstProfileVertexIndex=0,i+=this.startCap.numIndices,this.endCap.indexBufferStart=i,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const n=new Array,s=new Array,o=new Array,a=(e,t,r)=>{n.push(e),n.push(t),n.push(r),s.push(e),s.push(t),s.push(r),o.push(this.pathVertexData[e]),o.push(this.pathVertexData[t]),o.push(this.pathVertexData[r])};for(let i=0;i<t;++i){const t=this.profile.indices[2*i],n=this.profile.indices[2*i+1];for(let i=0;i<r;++i){const r=i*e+t,s=(i+1)*e+n,o=i*e+n;a(r,(i+1)*e+t,s),a(r,s,o)}}this.startCap.buildTopology(this.path.vertices[0],a),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],a),this.vertexIndices=(0,qr.Dg)(n),this.normalIndices=(0,qr.Dg)(s),this.pathVertexIndices=(0,qr.Dg)(o)}onPathChanged(){this._rebuildGeometry()}}class ka{rebuildConnectingProfileGeometry(e,t,r){for(let i=0;i<t.vertices.length;++i)r(e.frame,t.vertices[i],t.normals[i],0,0)}}class ja extends ka{constructor(){super(),this.numVertices=0,this.numIndices=0}rebuildCapGeometry(){}buildTopology(){}}class Wa extends ka{constructor(e,t=0,r=!1){super(),this.profile=e,this.profilePlaneOffset=t,this.flip=r}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,t,r){const i=this.profilePlaneOffset;for(let n=0;n<t.vertices.length;++n)r(e.frame,t.vertices[n],t.normals[n],i,0)}rebuildCapGeometry(e,t){const r=this.profile,i=this.flip?1:-1,n=this.profilePlaneOffset,s=$a;(0,Or.hZ)(s,0,0);for(let o=0;o<r.vertices.length;++o)t(e.frame,r.vertices[o],s,n,i)}buildTopology(e,t){const r=this.profile,i=this.vertexBufferStart+r.indices[0];for(let e=1;e<r.numSegments;++e){const n=r.indices[2*e],s=r.indices[2*e+1],o=this.vertexBufferStart+n,a=this.vertexBufferStart+s;this.flip?t(a,o,i):t(i,o,a)}}}class qa extends ka{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}get numVertices(){let e=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;return this.breakNormals&&(e+=this.profile.vertices.length),e}get numIndices(){let e=0;const t=this.profile;e+=2*t.numSegments*(this.numSegments-1);for(let r=0;r<t.numSegments;++r){const i=t.indices[2*r],n=t.indices[2*r+1];t.poleIndices[i]===t.poleIndices[n]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,t){const r=this.profile,i=e.frame,n=.5*this.sign,s=Za,o=$a;(0,Or.hZ)(o,0,0);for(const e of r.poles)e.normal?t(i,e.position,e.normal,n,0):t(i,e.position,o,n,this.sign);if(this.breakNormals)for(let e=0;e<r.vertices.length;++e)t(i,r.vertices[e],r.normals[e],0,0);for(let e=0;e<this.numSegments-1;++e){const a=(1-(e+1)/this.numSegments)*Math.PI*.5,l=Math.sin(a),c=Math.cos(a);for(let e=0;e<r.vertices.length;++e){const a=r.poles[r.poleIndices[e]];(0,Or.Re)(s,r.vertices[e],a.position),(0,Or.hs)(s,s,l),a.normal?((0,Or.WQ)(s,s,a.position),t(i,s,a.normal,n*c,0)):((0,Or.S8)(o,s),(0,Or.hs)(o,o,l),(0,Or.WQ)(s,s,a.position),t(i,s,o,n*c,this.sign*c))}}}buildTopology(e,t){const r=this.profile,i=this.breakNormals?this.vertexBufferStart+r.poles.length:this.firstProfileVertexIndex,n=this.breakNormals?this.vertexBufferStart+r.poles.length+r.vertices.length:this.vertexBufferStart+r.poles.length;for(let e=0;e<r.numSegments;++e){const s=r.indices[2*e],o=r.indices[2*e+1],a=this.vertexBufferStart+r.poleIndices[s],l=this.vertexBufferStart+r.poleIndices[o];let c=i+s,u=i+o;for(let e=0;e<this.numSegments-1;++e){const i=n+e*r.vertices.length+s,a=n+e*r.vertices.length+o;this.flip?(t(i,u,c),t(u,i,a)):(t(c,u,i),t(a,i,u)),c=i,u=a}this.flip?(t(a,u,c),a!==l&&t(a,l,u)):(t(c,u,a),a!==l&&t(u,l,a))}}}const Za=(0,Ir.vt)(),$a=(0,Ir.vt)();class Ya{numProfilesPerJoin(){return 1}extrude(e,t,r){for(let i=0;i<t.vertices.length;++i)r(e.frame,t.vertices[i],t.normals[i],!1)}}class Xa{constructor(e,t){this.cutoffAngle=e,this.numBendSubdivisions=t}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,t,r){const i=tl,{rotationAngle:n,rotationRight:s,frame:o}=e;if(Math.abs(n)>=this.cutoffAngle){const a=e.rotationFrameUp;for(let l=0;l<this.numBendSubdivisions+1;++l){(0,Ye.$0)(el,.5*-n+l*n/this.numBendSubdivisions,a),Qa(i,o,el);for(let a=0;a<t.vertices.length;++a)(0,Or.Om)(t.vertices[a],s)*n>=0?r(i,t.vertices[a],t.normals[a],!1):r(o,e.applyMiterStretch(Ka,t.vertices[a]),t.normals[a],!0)}}else for(let i=0;i<this.numBendSubdivisions+1;++i)for(let i=0;i<t.vertices.length;++i){const a=(0,Or.Om)(t.vertices[i],s)*n>=0;r(o,e.applyMiterStretch(Ka,t.vertices[i]),t.normals[i],!a)}}}class Ja{constructor(){this.up=(0,m.vt)(),this.right=(0,m.vt)()}}function Qa(e,t,r){(0,k.h)(e.up,t.up,r),(0,k.h)(e.right,t.right,r)}const Ka=(0,Ir.vt)(),el=(0,Xe.vt)(),tl=new Ja;class rl extends et.V{constructor(e,t,r,i,n,s){super(e,t,null,Yt.X.Mesh,s),this.path=r,this.geometrySR=i,this.stencilWidth=n}}var il;function nl(e){return"path"in e}!function(e){e[e.World=0]="World",e[e.Path=1]="Path"}(il||(il={}));var sl=r(45079);class ol{constructor(e){this.builder=e}onPathChanged(e){this.builder.onPathChanged()}}class al extends ol{constructor(e){super(e),this.vertexAttributeColor=(0,D.fA)(255,255,255,255),this.size=new Array,this.vertexAttributePosition=(0,ds.oe)(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;const{numVerticesTotal:t,pathVertexData:r,path:i,positions:n,profileRightAxes:s,profileUpAxes:o,profileVertexAndNormals:a}=this.builder;for(let l=0;l<t;++l){let t=r[l];const c=0===t||t===i.vertices.length-1;t*=3;const u=pl;let h=0,d=0;const p=4*l,f=(0,k.s)(fl,s[p],s[p+1],s[p+2]),m=(0,k.s)(ml,o[p],o[p+1],o[p+2]),g=(0,Or.hZ)(cl,a[p]*e[0],a[p+1]*e[1]);if(c)(0,k.b)(u,m,f),h=s[p+3]*e[0],d=o[p+3];else{const e=ul,t=hl;(0,Or.hZ)(e,s[p+3],o[p+3]);const r=(0,Or.Bw)(e);(0,Or.S8)(e,e);const i=(0,Or.Om)(g,e);if(Math.abs(i)>r){(0,Or.hZ)(t,-e[1],e[0]);const n=(0,Or.Om)(g,t);(0,Or.hs)(e,e,r*Math.sign(i)),(0,Or.hs)(t,t,n),(0,Or.WQ)(g,e,t)}(0,k.s)(u,0,0,0)}const y=(0,k.s)(dl,f[0]*g[0]+m[0]*g[1],f[1]*g[0]+m[1]*g[1],f[2]*g[0]+m[2]*g[1]),_=3*l;this.vertexAttributePosition[_]=n[t]+y[0]+u[0]*h,this.vertexAttributePosition[_+1]=n[t+1]+y[1]+u[1]*h,this.vertexAttributePosition[_+2]=n[t+2]+y[2]+u[2]*h;const v=(0,Or.hZ)(cl,a[p+2],a[p+3]);(0,mi.aT)(this.vertexAttributeNormal,l,f[0]*v[0]+m[0]*v[1]+u[0]*d,f[1]*v[0]+m[1]*v[1]+u[1]*d,f[2]*v[0]+m[2]*v[1]+u[2]*d)}}createGeometryData(){const e=this.builder.vertexIndices.length,{normalIndices:t,vertexIndices:r}=this.builder;return[[le.r.POSITION,new $t.n(this.vertexAttributePosition,r,3,!0)],[le.r.NORMALCOMPRESSED,new $t.n(this.vertexAttributeNormal,t,2,!0)],[le.r.COLOR,new $t.n(this.vertexAttributeColor,(0,qr.EH)(e),4)]]}onPathChanged(e){super.onPathChanged(e),this.bake(this.size)}intersect(e,t,r,i){const n=this.builder.vertexIndices,s=new $t.K(this.vertexAttributePosition,3),o=n.length/3;(0,sl.Z$)(e,t,0,o,n,s,void 0,r,((e,t,r)=>{i(e,r,t,!1)}))}}class ll extends ol{constructor(e,t,r,i){super(e),this.sizeAttributeValue=t,this.colorAttributeValue=r,this.opacityAttributeValue=i,this.vvData=null,this.baked=new al(e),this.vvData=(0,ds.oe)(4*this.builder.path.vertices.length);for(let e=0;e<this.builder.path.vertices.length;++e){this.vvData[4*e]=t,this.vvData[4*e+1]=r,this.vvData[4*e+2]=i;const n=0===e||e===this.builder.path.vertices.length-1;this.vvData[4*e+3]=n?1:0}}createGeometryData(){const{positions:e,profileRightAxes:t,profileUpAxes:r,profileVertexAndNormals:i,pathVertexIndices:n,vertexIndices:s}=this.builder;return[[le.r.POSITION,new $t.n(e,n,3,!0)],[le.r.PROFILERIGHT,new $t.n(t,s,4,!0)],[le.r.PROFILEUP,new $t.n(r,s,4,!0)],[le.r.PROFILEVERTEXANDNORMAL,new $t.n(i,s,4,!0)],[le.r.FEATUREVALUE,new $t.n(this.vvData,n,4,!0)]]}onPathChanged(e){super.onPathChanged(e);const t=e.getMutableAttribute(le.r.POSITION);t&&(t.data=this.builder.positions)}}const cl=(0,Ir.vt)(),ul=(0,Ir.vt)(),hl=(0,Ir.vt)(),dl=(0,m.vt)(),pl=(0,m.vt)(),fl=(0,m.vt)(),ml=(0,m.vt)();var gl=r(79578);const yl=(0,m.vt)();class _l{constructor(){this.vertices=new Array,this.normals=new Array,this.indices=new Array,this.poles=new Array,this.poleIndices=new Array}addVertex(e,t){return this.vertices.push((0,Ir.o8)(e)),this.normals.push((0,Ir.o8)(t)),this.vertices.length-1}addPole(e,t=null){return this.poles.push({position:(0,Ir.o8)(e),normal:t?(0,Ir.o8)(t):null}),this.poles.length-1}addSegment(e,t=null){this.indices.push(e.v0),this.indices.push(e.v1),t&&(this.poleIndices.push(t.v0),this.poleIndices.push(t.v1))}get numSegments(){return this.indices.length/2}translate(e,t){for(const r of this.vertices)r[0]+=e,r[1]+=t;for(const r of this.poles)r.position[0]+=e,r.position[1]+=t}get usedMemory(){return this.vertices.length*(0,Lo.Ek)(this.vertices[0])*2+(0,Lo.Ek)(this.indices)}}const vl={top:[0,-.5],bottom:[0,.5]};function bl(e){const t=new _l,r={v0:0,v1:0};t.addPole((0,Ir.fA)(0,0));for(let e=0;e<10;++e){const r=2*e*Math.PI/10,i=Math.cos(r),n=Math.sin(r),s=(0,Ir.fA)(.5*i,.5*n),o=(0,Ir.fA)(i,n);t.addVertex(s,o)}for(let e=0;e<9;++e){const i={v0:e,v1:e+1};t.addSegment(i,r)}const i={v0:9,v1:0};if(t.addSegment(i,r),"center"!==e){const r=vl[e];t.translate(r[0],r[1])}return t}const xl={center:bl("center"),top:bl("top"),bottom:bl("bottom")},Sl={center:wl("center"),top:wl("top"),bottom:wl("bottom")};function wl(e){const t=new _l,r=(0,Ir.fA)(-.5,-.5),i=(0,Ir.fA)(.5,-.5),n=(0,Ir.fA)(.5,.5),s=(0,Ir.fA)(-.5,.5),o=(0,Ir.fA)(0,-1),a=(0,Ir.fA)(1,0),l=(0,Ir.fA)(0,1),c=(0,Ir.fA)(-1,0);if(t.addPole((0,Ir.fA)(0,.5),l),t.addPole((0,Ir.fA)(0,.5)),t.addPole((0,Ir.fA)(0,-.5)),t.addPole((0,Ir.fA)(0,-.5),o),t.addVertex(r,o),t.addVertex(i,o),t.addSegment({v0:0,v1:1},{v0:3,v1:3}),t.addVertex(i,a),t.addVertex(n,a),t.addSegment({v0:2,v1:3},{v0:2,v1:1}),t.addVertex(n,l),t.addVertex(s,l),t.addSegment({v0:4,v1:5},{v0:0,v1:0}),t.addVertex(s,c),t.addVertex(r,c),t.addSegment({v0:6,v1:7},{v0:1,v1:2}),"center"!==e){const r=vl[e];t.translate(r[0],r[1])}return t}var Tl=r(8527);function Al(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function Cl(e,t,r){const i=t[0],n=t[1],s=t[2],o=t[3],a=r[0],l=r[1],c=r[2],u=r[3];return e[0]=i*a+s*l,e[1]=n*a+o*l,e[2]=i*c+s*u,e[3]=n*c+o*u,e}function El(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}const Ml=Cl,Rl=El;Object.freeze(Object.defineProperty({__proto__:null,LDU:function(e,t,r,i){return e[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-e[2]*r[1],[e,t,r]},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},adjoint:function(e,t){const r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},determinant:function(e){return e[0]*e[3]-e[2]*e[1]},equals:function(e,t){const r=e[0],i=e[1],n=e[2],s=e[3],o=t[0],a=t[1],l=t[2],c=t[3],u=(0,Tl.FD)();return Math.abs(r-o)<=u*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=u*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-l)<=u*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=u*Math.max(1,Math.abs(s),Math.abs(c))},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2)},fromRotation:function(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},invert:function(e,t){const r=t[0],i=t[1],n=t[2],s=t[3];let o=r*s-n*i;return o?(o=1/o,e[0]=s*o,e[1]=-i*o,e[2]=-n*o,e[3]=r*o,e):null},mul:Ml,multiply:Cl,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},multiplyScalarAndAdd:function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e},rotate:function(e,t,r){const i=t[0],n=t[1],s=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+s*a,e[1]=n*l+o*a,e[2]=i*-a+s*l,e[3]=n*-a+o*l,e},scale:function(e,t,r){const i=t[0],n=t[1],s=t[2],o=t[3],a=r[0],l=r[1];return e[0]=i*a,e[1]=n*a,e[2]=s*l,e[3]=o*l,e},set:Al,str:function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},sub:Rl,subtract:El,transpose:function(e,t){if(e===t){const r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}},Symbol.toStringTag,{value:"Module"})),Object.freeze(Object.defineProperty({__proto__:null,clone:function(e){return[e[0],e[1],e[2],e[3]]},create:function(){return[1,0,0,1]},createView:function(e,t){return new Float64Array(e,t,4)},fromValues:function(e,t,r,i){return[e,t,r,i]}},Symbol.toStringTag,{value:"Module"}));class Pl{constructor(){this.vLeft=(0,m.vt)(),this.vRight=(0,m.vt)(),this.vMinSiblingLength=0,this.frame=new Ja}setFrameFromUpVector(e){(0,k.c)(this.frame.up,e),(0,k.g)(Hl,this.vLeft,this.vRight),(0,k.n)(Hl,Hl),(0,k.j)(Bl,this.frame.up,(0,k.m)(Hl,this.frame.up)),(0,k.f)(kl,Hl,Bl),(0,k.n)(kl,kl),(0,k.b)(this.frame.right,kl,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}}class Ol extends Pl{get rotationFrameUp(){return this.frame.up}get rotationRight(){return Ir.Cw}get rotationAngle(){return(0,k.j)(Ul,this.frame.up,(0,k.m)(this.frame.up,this.vLeft)),(0,k.f)(Ul,this.vLeft,Ul),(0,k.k)(Ul,Ul),(0,k.n)(Ul,Ul),(0,k.j)(Gl,this.frame.up,(0,k.m)(this.frame.up,this.vRight)),(0,k.f)(Gl,this.vRight,Gl),(0,k.n)(Gl,Gl),(0,k.b)(Vl,this.rotationFrameUp,this.vLeft),Math.sign((0,k.m)(Vl,this.vRight))*(Math.PI-(0,rn.XM)((0,k.m)(Ul,Gl)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(e,t){const r=this.rotationAngle;if(Math.abs(r)<=0)return t;const i=(0,rn.J_)(Math.cos(.5*r));return(0,Or.hZ)(e,(i-1+1)*t[0],t[1])}}class Il extends Pl{get rotationFrameUp(){const e=Math.sign((0,k.m)(this.frame.right,this.vRight));return(0,k.b)(Nl,this.vRight,this.vLeft),(0,k.j)(Nl,Nl,e),(0,k.n)(Nl,Nl)}get rotationRight(){const e=this.rotationFrameUp,t=(0,k.m)(e,this.frame.up),r=(0,k.m)(e,this.frame.right);return(0,k.j)(Fl,this.frame.up,-r),(0,k.j)(zl,this.frame.right,t),(0,k.g)(Fl,Fl,zl),(0,k.n)(Fl,Fl),function(e,t,r){(0,Or.hZ)(e,(0,k.m)(r,t.right),(0,k.m)(r,t.up))}(Dl,this.frame,Fl),Dl}get rotationAngle(){const e=Math.sign((0,k.m)(this.frame.right,this.vRight));return(0,k.k)(Vl,this.vLeft),-e*(Math.PI-(0,rn.XM)((0,k.m)(Vl,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*(0,rn.J_)(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(e,t){const r=this.rotationAngle;if(0===Math.abs(r))return t;const i=(0,rn.J_)(Math.cos(.5*r)),n=this.rotationRight,s=Al(jl,1+(i-1)*n[0]*n[0],(i-1)*n[0]*n[1],(i-1)*n[0]*n[1],1+(i-1)*n[1]*n[1]);return(0,Or.ZF)(e,t,s)}}function Ll(e){switch(e){case il.World:return new Ol;case il.Path:return new Il}}const Nl=(0,m.vt)(),Dl=(0,Ir.vt)(),Fl=(0,m.vt)(),zl=(0,m.vt)(),Vl=(0,m.vt)(),Ul=(0,m.vt)(),Gl=(0,m.vt)(),Bl=(0,m.vt)(),Hl=(0,m.vt)(),kl=(0,m.vt)(),jl=[1,0,0,1];var Wl=r(50865),ql=r(26762),Zl=r(11520),$l=r(39387);const Yl=new Map([[le.r.POSITION,0],[le.r.PROFILERIGHT,1],[le.r.PROFILEUP,2],[le.r.PROFILEVERTEXANDNORMAL,3],[le.r.FEATUREVALUE,4],[le.r.OBJECTANDLAYERIDCOLOR,5]]);class Xl extends ql.W{constructor(){super(...arguments),this.ambient=(0,m.fA)(.2,.2,.2),this.diffuse=(0,m.fA)(.8,.8,.8),this.specular=(0,m.fA)(0,0,0),this.opacity=1,this.origin=(0,m.vt)(),this.modelTransformation=null}}class Jl extends or.w{initializeConfiguration(e,t){t.spherical=e.viewingMode===nr.RT.Global,t.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new lr.B(e.rctx,Jl.shader.get().build(this.configuration),Yl)}initializePipeline(){const e=this.configuration.transparencyPassType,t=this.configuration,r=e===Wn.y.NONE,i=e===Wn.y.FrontFace;return(0,hr.Ey)({blending:t.output===Kt.V.Color&&t.transparent?r?kn.V0:(0,kn.ez)(e):null,culling:t.hasSlicePlane&&!t.transparent&&t.doubleSidedMode!==Wl.W.None?hr.hG:null,depthTest:{func:(0,kn.K_)(e)},depthWrite:r||i?hr.kn:null,drawBuffers:t.output===Kt.V.Depth?{buffers:[ur.Hr.NONE]}:(0,kn.cl)(e),colorWrite:hr.wE,stencilWrite:t.hasOccludees?jn.v0:null,stencilTest:t.hasOccludees?jn.qh:null,polygonOffset:r||i?null:kn.SE})}}Jl.shader=new sr.$($l.P,(()=>r.e(2641).then(r.bind(r,17003))));class Ql extends fr.E{constructor(){super(...arguments),this.output=Kt.V.Color,this.doubleSidedMode=Wl.W.None,this.transparencyPassType=Wn.y.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1,this.objectAndLayerIdColorInstanced=!1}}(0,i._)([(0,pr.W)({count:Kt.V.COUNT})],Ql.prototype,"output",void 0),(0,i._)([(0,pr.W)({count:Wl.W.COUNT})],Ql.prototype,"doubleSidedMode",void 0),(0,i._)([(0,pr.W)({count:Wn.y.COUNT})],Ql.prototype,"transparencyPassType",void 0),(0,i._)([(0,pr.W)()],Ql.prototype,"spherical",void 0),(0,i._)([(0,pr.W)()],Ql.prototype,"receiveShadows",void 0),(0,i._)([(0,pr.W)()],Ql.prototype,"receiveAmbientOcclusion",void 0),(0,i._)([(0,pr.W)()],Ql.prototype,"vvSize",void 0),(0,i._)([(0,pr.W)()],Ql.prototype,"vvColor",void 0),(0,i._)([(0,pr.W)()],Ql.prototype,"vvOpacity",void 0),(0,i._)([(0,pr.W)()],Ql.prototype,"hasSlicePlane",void 0),(0,i._)([(0,pr.W)()],Ql.prototype,"transparent",void 0),(0,i._)([(0,pr.W)()],Ql.prototype,"hasOccludees",void 0),(0,i._)([(0,pr.W)()],Ql.prototype,"multipassEnabled",void 0),(0,i._)([(0,pr.W)()],Ql.prototype,"cullAboveGround",void 0),(0,i._)([(0,pr.W)()],Ql.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,i._)([(0,pr.W)({constValue:!1})],Ql.prototype,"occlusionPass",void 0),(0,i._)([(0,pr.W)({constValue:Zl.A9.Disabled})],Ql.prototype,"pbrMode",void 0),(0,i._)([(0,pr.W)({constValue:!0})],Ql.prototype,"hasVvInstancing",void 0),(0,i._)([(0,pr.W)({constValue:!1})],Ql.prototype,"useCustomDTRExponentForWater",void 0),(0,i._)([(0,pr.W)({constValue:!1})],Ql.prototype,"useFillLights",void 0),(0,i._)([(0,pr.W)({constValue:!1})],Ql.prototype,"hasColorTexture",void 0);class Kl extends tr.im{constructor(e){super(e,new rc),this.supportsEdges=!0,this.produces=new Map([[rr.N.OPAQUE_MATERIAL,e=>(this.parameters.castShadows&&(0,Kt.PJ)(e)||(0,Kt.XY)(e))&&!this.parameters.transparent],[rr.N.TRANSPARENT_MATERIAL,e=>(this.parameters.castShadows&&(0,Kt.PJ)(e)||(0,Kt.XY)(e))&&this.parameters.transparent]]),this._vertexAttributeLocations=Yl,this._configuration=new Ql,this._vertexBufferLayout=Kl.getVertexBufferLayout()}getConfiguration(e,t){return this._configuration.output=e,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e===Kt.V.Color&&(this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?Wl.W.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?Wl.W.WindingOrder:Wl.W.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=null!=t.ssao),this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==Kt.V.Shadow&&e!==Kt.V.ShadowExcludeHighlight&&e!==Kt.V.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,t,r,i,n,s){const o=e;if(!nl(o))return;const a=o.path,l=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const{offset:e,factor:t,minSize:r,maxSize:i}=this.parameters.vvSize,n=a.sizeAttributeValue;l[0]*=(0,rn.qE)(e[0]+n*t[0],r[0],i[0]),l[1]*=(0,rn.qE)(e[2]+n*t[2],r[2],i[2])}const c=new sl.JG(!1,r.options.normalRequired),u=Math.max(l[0],l[1]),h=e.boundingInfo;if(null==h)return void tc(a,l,i,n,c,s);const d=(0,$.fA)(h.bbMin[0]-u,h.bbMin[1]-u,h.bbMin[2]-u,h.bbMax[0]+u,h.bbMax[1]+u,h.bbMax[2]+u),p=[n[0]-i[0],n[1]-i[1],n[2]-i[2]],f=Math.sqrt(p[0]*p[0]+p[1]*p[1]+p[2]*p[2]),m=[f/p[0],f/p[1],f/p[2]];(0,sl.Wb)(d,i,m,r.tolerance)&&tc(a,l,i,n,c,s)}createBufferWriter(){return new zs.Z(this._vertexBufferLayout)}createGLMaterial(e){return new ec(e)}static getVertexBufferLayout(){const e=(0,Qt.BP)().vec3f(le.r.POSITION).vec4f(le.r.PROFILERIGHT).vec4f(le.r.PROFILEUP).vec4f(le.r.PROFILEVERTEXANDNORMAL).vec4f(le.r.FEATUREVALUE);return(0,l.A)("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(le.r.OBJECTANDLAYERIDCOLOR),e}}class ec extends er.A{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){null!=this.technique&&e.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output===Kt.V.Color&&(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(Jl,e)}}function tc(e,t,r,i,n,s){e.baked.size&&e.baked.size[0]===t[0]&&e.baked.size[1]===t[1]||e.baked.bake(t),e.baked.intersect(r,i,n,s)}class rc extends Xl{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}}const ic=["polyline"];function nc(e,t,r){const{origin:i,positions:n}=e;let s=e.offset;switch(t){default:case il.World:for(const t of e.vertices)ac[0]=n[s++]+i[0],ac[1]=n[s++]+i[1],ac[2]=n[s++]+i[2],r.worldUpAtPosition(ac,ac),t.setFrameFromUpVector(ac);break;case il.Path:ac[0]=n[s]+i[0],ac[1]=n[s+1]+i[1],ac[2]=n[s+2]+i[2],r.worldUpAtPosition(ac,ac),function(e,t){let r=null;const i=e.vertices.length,n=.99619469809,s=(0,m.vt)(),o=(0,m.vt)(),a=(0,m.vt)(),l=(0,m.vt)(),c=(0,m.vt)(),u=(0,m.vt)(),h=(0,Ds.vt)();let d=e.vertices[0];(0,k.c)(o,t),(0,k.s)(s,0,1,0),(0,ae.Xl)(d.vRight,o,s,s,a,o,n),(0,k.c)(d.frame.up,o),(0,k.c)(d.frame.right,a);const p=e.positions;let f=e.offset;r=d;for(let t=1;t<i;++t){d=e.vertices[t],(0,k.g)(c,d.vLeft,d.vRight);let i=(0,k.l)(c);i>0?(i=1/Math.sqrt(i),c[0]=c[0]*i,c[1]=c[1]*i,c[2]=c[2]*i):(c[0]=d.vRight[0],c[1]=d.vRight[1],c[2]=d.vRight[2]),u[0]=p[f]+r.frame.up[0],u[1]=p[f+1]+r.frame.up[1],u[2]=p[f+2]+r.frame.up[2],f+=3;const m=(0,k.s)(yl,p[f],p[f+1],p[f+2]);(0,Ds.O_)(m,c,h),(0,Ds.Ui)(h,(0,gl.LV)(u,d.vLeft),l)?(l[0]-=p[f],l[1]-=p[f+1],l[2]-=p[f+2],(0,k.n)(o,l),(0,k.b)(a,c,o),(0,k.n)(a,a)):(0,ae.Xl)(c,r.frame.up,r.frame.right,s,a,o,n),(0,k.c)(d.frame.up,o),(0,k.c)(d.frame.right,a),r=d}}(e,ac)}}function sc(e,t,r){switch(e){case"symbol-value":return r;case"proportional":return t;default:return e}}function oc(e,t,r,i){let n=0;const{origin:s,vertices:o,positions:a,positionsES:l}=e,c=e.offset+3*o.length;for(let t=e.offset;t<c;t+=3)(0,k.s)(ac,l[t],l[t+1],l[t+2]),r(ac,lc),n+=lc.sampledElevation,ac[0]=a[t]+s[0],ac[1]=a[t+1]+s[1],ac[2]=a[t+2]+s[2],i.setAltitude(ac,lc.z),a[t]=ac[0]-s[0],a[t+1]=ac[1]-s[1],a[t+2]=ac[2]-s[2];return e.updatePathVertexInformation(),n/o.length}const ac=(0,m.vt)(),lc=new v.Uk;var cc=r(61714),uc=r(61441);function hc(e,t,r,i,n=1){(0,k.s)(mc,1,0,0),(0,k.s)(gc,0,1,0),(0,k.s)(yc,0,0,1),function(e,t){(0,k.s)(Ec,0,0,0);for(let e=0;e<t.length-3;e+=3)Ec[0]+=t[e],Ec[1]+=t[e+1],Ec[2]+=t[e+2];(0,k.j)(e,Ec,1/(t.length/3-1))}(dc,r),(0,Ds.ci)(fc,r)&&function(e,t,r,i,n,s){null!=n?(n.basisMatrixAtPosition(s,wc),(0,k.s)(Tc,wc[0],wc[1],wc[2]),(0,k.s)(Ac,wc[4],wc[5],wc[6]),(0,k.s)(Cc,wc[8],wc[9],wc[10])):((0,k.s)(Tc,1,0,0),(0,k.s)(Ac,0,1,0),(0,k.s)(Cc,0,0,1));const o=(0,Ds.Qj)(e);(0,k.m)(o,Cc)<0&&(0,k.j)(o,o,-1),(0,k.c)(i,o);const a=(0,k.m)(o,Ac),l=(0,k.m)(o,Tc);Math.abs(a)>Math.abs(l)?((0,k.r)(t,Tc,o,-l),(0,k.n)(t,t),(0,k.b)(r,t,o),(0,k.n)(r,r),(0,k.j)(r,r,-1)):((0,k.r)(r,Ac,o,-a),(0,k.n)(r,r),(0,k.b)(t,r,o),(0,k.n)(t,t))}(fc,mc,gc,yc,i,dc),(0,Or.hZ)(_c,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),(0,Or.hZ)(vc,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let e=0;e<r.length;e+=3){(0,k.s)(pc,r[e],r[e+1],r[e+2]);const t=(0,k.m)(mc,pc),i=(0,k.m)(gc,pc);_c[0]=Math.min(_c[0],t),_c[1]=Math.min(_c[1],i),vc[0]=Math.max(vc[0],t),vc[1]=Math.max(vc[1],i)}const s=(0,k.m)(yc,dc);Mc(bc,_c[0],_c[1],s,mc,gc,yc),Mc(xc,vc[0],_c[1],s,mc,gc,yc),Mc(Sc,_c[0],vc[1],s,mc,gc,yc),(0,k.f)(xc,xc,bc),(0,k.j)(xc,xc,.5),(0,k.f)(Sc,Sc,bc),(0,k.j)(Sc,Sc,.5),(0,k.g)(bc,bc,xc),(0,k.g)(bc,bc,Sc);const o=_c[0]%n,a=_c[1]%n,l=_c[0]-o,c=_c[1]-a;for(let i=0;i<r.length;i+=3){(0,k.s)(pc,r[i],r[i+1],r[i+2]);const s=i/3,o=4*s;e[o]=((0,k.m)(mc,pc)-l)/n,e[o+1]=((0,k.m)(gc,pc)-c)/n,e[o+2]=l/n,e[o+3]=c/n;const a=9*s;for(let e=0;e<3;e++)t[a+e]=bc[e],t[a+e+3]=xc[e],t[a+e+6]=Sc[e]}}const dc=(0,m.vt)(),pc=(0,m.vt)(),fc=(0,Ds.vt)(),mc=(0,m.vt)(),gc=(0,m.vt)(),yc=(0,m.vt)(),_c=(0,Ir.vt)(),vc=(0,Ir.vt)(),bc=(0,m.vt)(),xc=(0,m.vt)(),Sc=(0,m.vt)(),wc=(0,Xe.vt)(),Tc=(0,m.vt)(),Ac=(0,m.vt)(),Cc=(0,m.vt)(),Ec=(0,m.vt)();function Mc(e,t,r,i,n,s,o){(0,k.s)(e,t*n[0]+r*s[0]+i*o[0],t*n[1]+r*s[1]+i*o[1],t*n[2]+r*s[2]+i*o[2])}var Rc=r(48042),Pc=r(67721),Oc=r(27291),Ic=r(25770);class Lc extends or.w{initializeProgram(e){return new lr.B(e.rctx,Lc.shader.get().build(this.configuration),(0,l.A)("enable-feature:objectAndLayerId-rendering")?zc:Fc)}_setPipelineState(e,t){const r=this.configuration,i=e===Wn.y.NONE,n=e===Wn.y.FrontFace;return(0,hr.Ey)({blending:r.output===Kt.V.Color?i?kn.V0:(0,kn.ez)(e):null,culling:(0,hr.Xt)(r.cullFace),depthTest:r.draped?null:{func:(0,kn.K_)(e)},depthWrite:r.draped?null:i?hr.kn:(0,kn.XO)(e),drawBuffers:r.output===Kt.V.Depth?{buffers:[ur.Hr.NONE]}:(0,kn.cl)(e),colorWrite:hr.wE,stencilWrite:r.hasOccludees?jn.v0:null,stencilTest:r.hasOccludees?t?jn.a9:jn.qh:null,polygonOffset:i||n?r.polygonOffset?Nc:null:(0,kn.aB)(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}Lc.shader=new sr.$(Ic.P,(()=>r.e(8067).then(r.bind(r,27386))));const Nc={factor:1,units:1};class Dc extends fr.E{constructor(){super(...arguments),this.output=Kt.V.Color,this.cullFace=yt.s2.None,this.transparencyPassType=Wn.y.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasOccludees=!1,this.enableOffset=!0,this.multipassEnabled=!1,this.cullAboveGround=!1,this.vvColor=!1,this.objectAndLayerIdColorInstanced=!1}}(0,i._)([(0,pr.W)({count:Kt.V.COUNT})],Dc.prototype,"output",void 0),(0,i._)([(0,pr.W)({count:yt.s2.COUNT})],Dc.prototype,"cullFace",void 0),(0,i._)([(0,pr.W)({count:Pc.O.COUNT})],Dc.prototype,"style",void 0),(0,i._)([(0,pr.W)({count:Wn.y.COUNT})],Dc.prototype,"transparencyPassType",void 0),(0,i._)([(0,pr.W)()],Dc.prototype,"hasSlicePlane",void 0),(0,i._)([(0,pr.W)()],Dc.prototype,"hasVertexColors",void 0),(0,i._)([(0,pr.W)()],Dc.prototype,"polygonOffset",void 0),(0,i._)([(0,pr.W)()],Dc.prototype,"hasOccludees",void 0),(0,i._)([(0,pr.W)()],Dc.prototype,"patternSpacing",void 0),(0,i._)([(0,pr.W)()],Dc.prototype,"lineWidth",void 0),(0,i._)([(0,pr.W)()],Dc.prototype,"enableOffset",void 0),(0,i._)([(0,pr.W)()],Dc.prototype,"draped",void 0),(0,i._)([(0,pr.W)()],Dc.prototype,"multipassEnabled",void 0),(0,i._)([(0,pr.W)()],Dc.prototype,"cullAboveGround",void 0),(0,i._)([(0,pr.W)()],Dc.prototype,"vvColor",void 0),(0,i._)([(0,pr.W)({constValue:!0})],Dc.prototype,"writeDepth",void 0),(0,i._)([(0,pr.W)({constValue:!1})],Dc.prototype,"occlusionPass",void 0),(0,i._)([(0,pr.W)({constValue:!1})],Dc.prototype,"hasVvInstancing",void 0),(0,i._)([(0,pr.W)({constValue:!1})],Dc.prototype,"vvSize",void 0),(0,i._)([(0,pr.W)({constValue:!1})],Dc.prototype,"vvOpacity",void 0);const Fc=new Map([[le.r.POSITION,0],[le.r.COLOR,3],[le.r.UVMAPSPACE,4],[le.r.COLORFEATUREATTRIBUTE,5],[le.r.BOUNDINGRECT,6]]),zc=new Map([[le.r.POSITION,0],[le.r.COLOR,3],[le.r.UVMAPSPACE,4],[le.r.COLORFEATUREATTRIBUTE,5],[le.r.BOUNDINGRECT,6],[le.r.OBJECTANDLAYERIDCOLOR,9]]);class Vc extends Oc.W{constructor(e){super(e,new Hc),this.supportsEdges=!0,this.produces=new Map([[rr.N.OPAQUE_MATERIAL,e=>(0,Kt.u5)(e)],[rr.N.TRANSPARENT_MATERIAL,e=>(0,Kt._o)(e)],[rr.N.TRANSPARENT_NO_SSAO_DEPTH,e=>(0,Kt.eh)(e)&&this.parameters.writeLinearDepth],[rr.N.DRAPED_MATERIAL,e=>this.parameters.draped&&e===Kt.V.Color||(0,Kt.u5)(e)]]),this._vertexAttributeLocations=(0,l.A)("enable-feature:objectAndLayerId-rendering")?zc:Fc,this._configuration=new Dc}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<kn.xt,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}createGLMaterial(e){return new Uc(e)}createBufferWriter(){const e=(0,Qt.BP)().vec3f(le.r.POSITION).vec4f(le.r.UVMAPSPACE);return this.parameters.draped||e.mat3f(le.r.BOUNDINGRECT),this.parameters.vvColor?e.f32(le.r.COLORFEATUREATTRIBUTE):e.vec4u8(le.r.COLOR),(0,l.A)("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(le.r.OBJECTANDLAYERIDCOLOR),new Gc(e)}}class Uc extends er.A{_updateParameters(e){return this.ensureTechnique(Lc,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===Kt.V.Color&&this._updateOccludeeState(e),this._updateParameters(e)}}class Gc extends zs.Z{write(e,t,r,i,n){(0,ir.SA)(r,this.vertexBufferLayout,e,t,i,n);for(const t of this.vertexBufferLayout.fields.keys()){const s=r.attributes.get(t),o=s?.indices;if(s&&o)switch(t){case le.r.UVMAPSPACE:{(0,Fs.vA)(4===s.size);const e=i.getField(t,Jo.Eq);e&&(0,ir.Ut)(s,e,n);break}case le.r.BOUNDINGRECT:{(0,Fs.vA)(9===s.size);const r=i.getField(t,Jo.jZ);r&&Bc(s,e,r,n);break}}}}}function Bc(e,t,r,i){const{data:n,indices:s}=e,o=t,a=r.typedBuffer,l=r.typedBufferStride,c=s.length;i*=l;for(let e=0;e<c;++e){const t=9*s[e],r=n[t],c=n[t+1],u=n[t+2];a[i]=o[0]*r+o[4]*c+o[8]*u+o[12],a[i+1]=o[1]*r+o[5]*c+o[9]*u+o[13],a[i+2]=o[2]*r+o[6]*c+o[10]*u+o[14];for(let e=3;e<9;++e)a[i+e]=n[t+e];i+=l}}class Hc extends Hn.S{constructor(){super(...arguments),this.color=(0,D.fA)(1,1,1,1),this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=yt.s2.None,this.hasOccludees=!1,this.style=Pc.O.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}}function kc(e,t){if(function(e){return e.material instanceof Vc&&!e.material.parameters.draped}(e)){const r=e.attributes.get(le.r.POSITION).data;hc(e.getMutableAttribute(le.r.UVMAPSPACE).data,e.getMutableAttribute(le.r.BOUNDINGRECT).data,r,t)}}function jc(e,t,r,i,n){const s=rt(e,t,r,i,n),o=e.stageObject.geometries;for(const e of o)kc(e,n);return s}const Wc=["polyline","polygon","extent"],qc=new Lt.wI({size:!1,color:!0,rotation:!1,opacity:!1});class Zc extends Dt{constructor(e,t,r,i){super(e,t,r,i),this._needsUV=!1}async doLoad(){this._fastUpdates=(0,Lt.s_)(this._context.renderer,qc)}_createMaterials(){if(this._materials.length>0)return;const e=this.symbolLayer?.material?.color,t=this._getCombinedOpacityAndColor(e);this._materials[Jc.Fill]=function(e,t){const r=e?.pattern??null;return null==r?new Rc.v(t):"none"===r.style||"solid"===r.style?("none"===r.style&&(t.color=(0,D.fA)(0,0,0,0),t.forceTransparentMode=!0),new Rc.v(t)):(t.style=function(e){switch(e){case"horizontal":return Pc.O.Horizontal;case"vertical":return Pc.O.Vertical;case"cross":return Pc.O.Cross;case"forward-diagonal":return Pc.O.ForwardDiagonal;case"backward-diagonal":return Pc.O.BackwardDiagonal;case"diagonal-cross":return Pc.O.DiagonalCross;default:return}}(r.style),new Vc(t))}(this.symbolLayer,{color:t,forceTransparentMode:this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...this._fastUpdates?.materialParameters}),this._needsUV=this._materials[Jc.Fill]instanceof Vc;const r=this.symbolLayer.outline;if(function(e){return null!=e?.size&&e.size>0&&null!=e.color&&(null==e.pattern||"style"!==e.pattern.type||"none"!==e.pattern.style)}(r)){const e=(0,rs.Xq)(r.pattern);this._materials[Jc.Outline]=new is.W({width:(0,$e.Lz)(r.size),color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:e,cap:zn(r.patternCap||"butt")})}this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,Wc,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),i=this.setGraphicElevationContext(t);return this.ensureDrapedStatus("on-the-ground"===i.mode),this._createMaterials(),this.draped?this._createAsOverlay(t,r):this._createAs3DShape(t,r,i)}applyRendererDiff(e,t){for(const r in e.diff){if("visualVariables"!==r)return Et.RecreateSymbol;if(!(0,Lt.J_)(this._fastUpdates,t,qc))return Et.RecreateSymbol;this._materials[Jc.Fill]?.setParameters(this._fastUpdates.materialParameters)}return Et.FastUpdate}layerOpacityChanged(){if(null!=this._materials[Jc.Fill]){const e=this._materials[Jc.Fill].parameters.color,t=this.symbolLayer?.material?.color,r=this._getCombinedOpacity(t);this._materials[Jc.Fill].setParameters({color:[e[0],e[1],e[2],r],forceTransparentMode:this.needsDrivenTransparentPass})}if(null!=this._materials[Jc.Outline]){const e=this._materials[Jc.Outline].parameters.color;this._materials[Jc.Outline].setParameters({color:[e[0],e[1],e[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,t,r){const i=this._elevationContext.mode,n=(0,v.I2)(Zc.elevationModeChangeTypes,r,i);if(n!==v.uw.UPDATE)return n;const s=(0,v.nu)(i);return this.updateGraphics3DGraphicElevationInfo(e,t,(()=>s))}slicePlaneEnabledChanged(){if(this._materials[Jc.Fill]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[Jc.Outline]){const e={hasSlicePlane:this._context.slicePlaneEnabled};this._materials[Jc.Outline].setParameters(e)}return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,t,r){const i=ti(e.geometry);if(!i)return null;const n=si(i,this._context.elevationProvider,this._context.renderCoordsHelper,r),s=new Yc(n,t,this._context.layer.uid,e.uid),o=s.renderData.position.length/3;if(this._needsUV&&(s.uvMapSpace=(0,ds.oe)(4*o,!0),s.boundingRect=(0,Wr.jh)(9*o,!0),hc(s.uvMapSpace,s.boundingRect,s.renderData.position,this._context.renderCoordsHelper)),s.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(s),this._createAs3DShapeFill(e,s),this._materials[Jc.Outline]&&this._createAs3DShapeOutline(s),this._logGeometryCreationWarnings(s.renderData,i.rings,"rings","FillSymbol3DLayer"),0===s.outGeometries.length)return null;const a=new Gt.B({geometries:s.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:e.uid}),l=new bt(this,a,s.outGeometries,null,null,jc,r);return l.alignedSampledElevation=s.renderData.sampledElevation,l.needsElevationUpdates=(0,v.nu)(r.mode),l}_createAs3DShapeFill(e,t){const r=t.renderData.polygons;for(const{position:i,mapPositions:n,holeIndices:s,index:o,count:a}of r){if(null!=this._context.clippingExtent&&((0,$.Ie)($c),(0,$.Hq)($c,n),!(0,$.KG)($c,this._context.clippingExtent)))continue;const r=Qr(n,s,this._context.elevationProvider.spatialReference);if(0===r.length)continue;const l=this._fastUpdates?.visualVariables.color,c=Kr({material:this._materials[Jc.Fill],indices:r,mapPositions:n,attributeData:{position:i,color:l?null:t.color,colorFeature:l?(0,Lt.ul)(l.field,e):null,uvMapSpace:this._needsUV?(0,ds.AK)(t.uvMapSpace,4*o,4*a):null,boundingRect:this._needsUV?(0,Wr.l5)(t.boundingRect,9*o,9*a):null,objectAndLayerIdColor:t.objectAndLayerIdColor}});t.outGeometries.push(c)}}_createAs3DShapeOutline(e){if(null==this._materials[Jc.Outline])return;const t=e.renderData.outlines;for(const{mapPositions:r,position:i}of t){if(null!=this._context.clippingExtent&&((0,$.Ie)($c),(0,$.Hq)($c,r),!(0,$.KG)($c,this._context.clippingExtent)))continue;const t=(0,Un.t)(this._materials[Jc.Outline],{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:r,attributeData:{position:i}},e.objectAndLayerIdColor);e.outGeometries.push(t)}}_createAsOverlay(e,t){const r=ti(e.geometry);if(null==r)return null;this._materials[Jc.Fill].renderPriority=this._renderPriority+this._renderPriorityStep/2,null!=this._materials[Jc.Outline]&&(this._materials[Jc.Outline].renderPriority=this._renderPriority);const i=oi(r,this._context.overlaySR),n=new Xc(i,t,this._context.layer.uid,e.uid),s=n.renderData.position.length/3;return this._needsUV&&(n.uvMapSpace=(0,ds.oe)(4*s,!0),function(e,t,r,i,n=1){if(r.isGeographic&&i===nr.RT.Global){const e=(0,Wr.jh)(t.length),i=t.length,n=(0,cc.tO)(r);for(let r=0;r<i;r+=3)(0,uc.RC)(t,r,e,r,n);t=e}(0,Or.hZ)(_c,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let e=0;e<t.length;e+=3)_c[0]=Math.min(_c[0],t[e]),_c[1]=Math.min(_c[1],t[e+1]);const s=_c[0]%n,o=_c[1]%n,a=_c[0]-s,l=_c[1]-o;for(let r=0;r<t.length;r+=3){const i=r/3*4;e[i]=(t[r]-a)/n,e[i+1]=(t[r+1]-l)/n,e[i+2]=a/n,e[i+3]=l/n}}(n.uvMapSpace,n.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),n.outBoundingBox=(0,$.Ie)(),n.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(n),this._createAsOverlayFill(e,n),this._materials[Jc.Outline]&&this._createAsOverlayOutline(n),this._logGeometryCreationWarnings(n.renderData,r.rings,"rings","FillSymbol3DLayer"),0===n.outGeometries.length?null:new Qi(this,n.outGeometries,n.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e,t){const r=t.renderData.polygons;for(const{position:i,holeIndices:n,index:s,count:o}of r){const r=(0,$.Ie)($c);if((0,$.Hq)(r,i),!(0,$.KG)(r,this._context.clippingExtent))continue;const a=(0,Hr.e)(i,n,3);if(0===a.length)continue;(0,$.RF)(t.outBoundingBox,r);const l=this._fastUpdates?.visualVariables.color,c=Kr({material:this._materials[Jc.Fill],indices:a,attributeData:{position:i,color:l?null:t.color,colorFeature:l?(0,Lt.ul)(l.field,e):null,uvMapSpace:this._needsUV?(0,ds.AK)(t.uvMapSpace,4*s,4*o):null,objectAndLayerIdColor:t.objectAndLayerIdColor}});t.outGeometries.push(new xn.$(c,t))}}_createAsOverlayOutline(e){if(null==this._materials[Jc.Outline])return;const t=e.renderData.outlines;for(let r=0;r<t.length;++r){const{position:i}=t[r];if((0,$.Ie)($c),(0,$.Hq)($c,i),!(0,$.KG)($c,this._context.clippingExtent))continue;(0,$.RF)(e.outBoundingBox,$c);const n=(0,Un.t)(this._materials[Jc.Outline],{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:i}},e.objectAndLayerIdColor);e.outGeometries.push(new xn.$(n,e))}}_getOutlineOpacity(){const e=this.symbolLayer?.outline?.color;return(this.draped?1:this._getLayerOpacity())*(null!=e?e.a:0)}_getOutlineColor(){const e=this.symbolLayer?.outline?.color,t=this._getOutlineOpacity();return(0,gt.$C)(null!=e?P.A.toUnitRGB(e):null,t)}test(){return{...super.test(),createAsOverlay:(e,t)=>this._createAsOverlay(e,t),createAs3DShape:(e,t,r)=>this._createAs3DShape(e,t,r)}}}Zc.elevationModeChangeTypes={definedChanged:v.uw.RECREATE,staysOnTheGround:v.uw.NONE,onTheGroundChanged:v.uw.RECREATE};const $c=(0,$.vt)();class Yc extends ri{constructor(e,t,r,i){super(e,r,i),this.color=t}}class Xc extends ri{constructor(e,t,r,i){super(e,r,i),this.color=t}}var Jc;!function(e){e[e.Fill=0]="Fill",e[e.Outline=1]="Outline"}(Jc||(Jc={}));class Qc{constructor(e,t="center",r=!1,i=(0,Ir.vt)(),n=(0,D.fA)(0,0,0,-1),s="world",o=(0,m.vt)(),a=0){this.verticalOffset=e,this.anchor=t,this.hasLabelVerticalOffset=r,this.screenOffset=i,this.centerOffset=n,this.centerOffsetUnits=s,this.translation=o,this.elevationOffset=a}}class Kc{constructor(e,t="center",r="center",i=null,n=(0,Ir.vt)()){this.placement=e,this.horizontalPlacement=t,this.verticalPlacement=r,this.text=i,this.displaySize=n}}var eu=r(80683);class tu{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=ru(e.color),this.haloStyle=function(e){return`rgb(${e.slice(0,3).map((e=>Math.floor(255*e))).toString()})`}(e.halo.color),this.backgroundStyle=0!==e.background.color[3]?ru(e.background.color):null}fontString(e){const t=this.definition.font;return`${t.style} ${t.weight} ${e}px ${t.family}, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji`}setFontProperties(e,t){e.font=this.fontString(t),e.textAlign="left",e.textBaseline="alphabetic"}static async fromSymbol(e,t){const r=e?.material?.color,i=P.A.toUnitRGBA(r)??D.uY,n=null!=e.size?(0,$e.Lz)(e.size):12,s=e.lineHeight,o=null!=e.background?P.A.toUnitRGBA(e.background.color):D.uY,a={family:e.font?.family??"sans-serif",decoration:e.font?.decoration??"none",weight:e.font?.weight??"normal",style:e.font?.style??"normal"},l=e.halo,u=null!=l?.color&&l.size>0?{size:(0,$e.Lz)(l.size),color:P.A.toUnitRGBA(l.color)}:{size:0,color:D.uY},h=new tu({color:i,size:n,background:{color:o,padding:null!=e.background?[.65*n,.5*n]:[0,0],borderRadius:null!=e.background?n*(6/16):0},lineSpacingFactor:s,font:a,halo:u,pixelRatio:t});if(e.font){let t=!1;const r=h.fontString(n);try{t=(await document.fonts.load(r)).some((e=>!(0,eu.NZ)(e)))}catch(e){c.A.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${r}'. Some text symbology may be rendered using the default browser font.`)}if(!t&&!iu.has(e.font.family))try{await(0,eu.Al)(e.font)}catch(e){}}return h}}function ru(e){return`rgba(${e.slice(0,3).map((e=>Math.floor(255*e))).toString()},${e[3]})`}const iu=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]);var nu=r(11231),su=r(33400),ou=r(10228),au=r(12569),lu=r(55213),cu=r(78541),uu=r(10956);const hu=4096;let du=class extends T.A{constructor(e){super(e),this.type=Yt.X.Texture,this.id=(0,nu.c)(),this.events=new ze.A,this._glTexture=null,this._atlas=new yu(256,256),this._needsRepack=!1,this._canRepack=!0,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._updateCanvasElementSize(this._atlas),this._reset()}unload(){this._glTexture=(0,s.WD)(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get glTexture(){return this._glTexture}static get maxSize(){return vu=ou.G.stableRendering?fu:0,[hu-fu-vu,hu-fu-vu-mu]}load(e){if(this._glTexture)return this._glTexture;const t=new uu.R;return t.wrapMode=ur.pF.CLAMP_TO_EDGE,t.samplingMode=ur.Cj.LINEAR_MIPMAP_LINEAR,t.hasMipmap=!0,t.preMultiplyAlpha=!0,t.maxAnisotropy=e.parameters.maxMaxAnisotropy,this._glTexture=new cu.g(e,t,this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(De.W6.TEXT_TEXTURE_ATLAS,this),this.setDirty(),this._glTexture}dispose(){this._elements.clear(),this._elementsToRender.clear(),this._frameWorker=(0,s.xt)(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=(0,s.WD)(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.setAttribute("width",e.width.toString()),this._canvas.setAttribute("height",e.height.toString())}_resizeAtlas(e,t){const{width:r,height:i}=this._atlas;r===e&&i===t||(this._atlas.width=e,this._atlas.height=t,this._glTexture?.resize(e,t),this._glTexture?.updateData(0,0,0,r,i,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach((e=>{const t=this._stageObjects.get(e.textRenderer.key);t?.forEach((t=>pu(t,e)))})),this._reset())}_reset(){this._elementsToRender.clear(),this._atlas.reset(),this._needsRepack=!0,this.setDirty()}_addAtlasElement(e,t,r,i){const n=this._atlas;if(n.width<r||n.height<i)return!1;let s=n.cursors.get(i);if(!s){if(n.height<n.nextY+i)return!1;s=[new _u(n.nextY)],n.cursors.set(i,s),n.nextY+=i}let o=s.find((e=>n.width>=e.x+r));if(null==o){if(n.height<n.nextY+i)return!1;o=new _u(n.nextY),n.nextY+=i,s.push(o)}return e.setNewPosition(o),this._elements.set(t,e),this._elementsToRender.set(t,e),o.x+=r,!0}_ensureStageObjects(e){const t=this._stageObjects.get(e);if(t)return t;const r=new Set;return this._stageObjects.set(e,r),r}_addStageObject(e,t){this._ensureStageObjects(e).add(t)}_removeStageObject(e,t){const r=this._stageObjects.get(e);r?.delete(t)&&(t.geometries[0].setAttributeData(le.r.SIZE,[0,0]),t.geometryVertexAttributeUpdated(t.geometries[0],le.r.SIZE),this._elementsToRender.delete(e))}_processAddition(e){const t=e.textRenderer.key;if(this._needsRepack)return void this._elements.set(t,e);const r=this._atlas,i=e.textRenderer.renderedWidth,n=e.textRenderer.renderedHeight,s=i+fu,o=n+fu+mu;if(!this._addAtlasElement(e,t,s,o)){if(this._canRepack)this._reset();else if(r.width<s){const e=Math.min((0,au.Mv)(Math.max(s,1.5*r.width)),hu);this._resizeAtlas(e,r.height)}else{const e=r.nextY+o,t=Math.min((0,au.Mv)(Math.max(e,1.5*r.height)),hu);if(t>r.height)this._resizeAtlas(r.width,t);else if(r.width<hu){const e=Math.min((0,au.Mv)(1.5*r.width),hu);this._resizeAtlas(e,r.height)}}this._elements.set(t,e)}}_renderElement(e){const t=e.commitNewPosition(),r=e.textRenderer;this._ctx.clearRect(t[0]-fu,t[1]-fu,r.renderedWidth+2*fu,r.renderedHeight+2*fu),r.render(this._ctx,t[0],t[1]);const i=this._stageObjects.get(r.key);i?.forEach((t=>pu(t,e)))}get running(){return this.updating}runTask(e){if(null==this._glTexture)return lu.G;for(;this._needsRepack&&(this._canRepack||this._atlas.height<hu&&this._atlas.height<hu);){this._canRepack=this._needsRepack=!1;const t=this._elements;this._elements=new Map,t.forEach((e=>this._processAddition(e))),e.madeProgress()}if(this._elementsToRender.size>0){for(const[t,r]of this._elementsToRender){if(e.done)break;this._renderElement(r),this._elementsToRender.delete(t),e.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=this._elementsToRender.size>0}addTextTexture(e,t){const r=e.key;this._addStageObject(r,t);let i=this._elements.get(r);null==i&&(i=new gu(this._atlas,e),this._processAddition(i),this.setDirty()),function(e,t){e.geometries[0].setAttributeData(le.r.SIZE,[t.textRenderer.displayWidth,t.textRenderer.displayHeight]),e.geometryVertexAttributeUpdated(e.geometries[0],le.r.SIZE)}(t,i),pu(t,i)}removeTextTexture(e,t){const r=e.key;if(!this._elements.get(r))return;this._removeStageObject(r,t);const i=this._stageObjects.get(r);i&&0!==i.size||this._elements.delete(r),0===i?.size&&this._stageObjects.delete(r),this._canRepack=!0}setDirty(){this._glTexture&&(this.updating=!0)}get test(){}};function pu(e,t){e.geometries[0].setAttributeData(le.r.UV0,t.uv),e.geometryVertexAttributeUpdated(e.geometries[0],le.r.UV0,!0)}(0,i._)([(0,a.MZ)({constructOnly:!0})],du.prototype,"view",void 0),(0,i._)([(0,a.MZ)({type:Boolean})],du.prototype,"updating",void 0),du=(0,i._)([(0,u.$)("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],du);const fu=2,mu=2;class gu{constructor(e,t){this._atlas=e,this.textRenderer=t,this._uv=(0,D.vt)(),this._newPosition=[0,0]}get uv(){if(null==this._xOffset||null==this._yOffset)return D.uY;const{renderedWidth:e,renderedHeight:t}=this.textRenderer;return(0,su.s)(this._uv,this._xOffset/this._atlas.width,(this._yOffset+t)/this._atlas.height,(this._xOffset+e)/this._atlas.width,this._yOffset/this._atlas.height)}setNewPosition(e){this._newPosition[0]=e.x,this._newPosition[1]=e.y}commitNewPosition(){return this._xOffset=this._newPosition[0],this._yOffset=this._newPosition[1],this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}}class yu{constructor(e,t){this.width=e,this.height=t,this.cursors=new Map,this.nextY=0}reset(){this.cursors.clear(),this.nextY=vu}}class _u{constructor(e){this.y=e,this.x=vu}}let vu=0;class bu{constructor(e,t,r){this._renderer=new un(e,t,r,du.maxSize)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=nn(xu,this._renderer.renderedWidth,this._renderer.renderedHeight),t=e.getContext("2d");return t.save(),this._renderer.render(t,0,0),t.restore(),new Sn.g(e,{wrap:{s:ur.pF.CLAMP_TO_EDGE,t:ur.pF.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}}const xu={canvas:null},Su=(0,m.fA)(0,0,1);function wu(e,t,r){e&&e.forEach((e=>{const i=t(e);null!=i&&r(i,e.graphic)}))}const Tu={mode:"relative-to-ground",offset:0};var Au=r(38504),Cu=r(97018),Eu=(r(15985),r(52352));class Mu extends or.w{initializeConfiguration(e,t){t.spherical=e.viewingMode===nr.RT.Global,t.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new lr.B(e.rctx,Mu.shader.get().build(this.configuration),ar.D)}_setPipelineState(e){const t=this.configuration,r=e===Wn.y.NONE,i=e===Wn.y.FrontFace;return(0,hr.Ey)({blending:t.output!==Kt.V.Normal&&t.output!==Kt.V.Highlight&&t.output!==Kt.V.ObjectAndLayerIdColor&&t.transparent?r?kn.V0:(0,kn.ez)(e):null,depthTest:t.draped?null:{func:(0,kn.K_)(e)},depthWrite:t.draped?null:r?t.writeDepth?hr.kn:null:(0,kn.XO)(e),drawBuffers:(0,kn.cl)(e),colorWrite:hr.wE,polygonOffset:r||i?null:(0,kn.aB)(t.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}Mu.shader=new sr.$(Eu.W,(()=>r.e(6628).then(r.bind(r,24240))));class Ru extends fr.E{constructor(){super(...arguments),this.output=Kt.V.Color,this.transparencyPassType=Wn.y.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.objectAndLayerIdColorInstanced=!1,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}}(0,i._)([(0,pr.W)({count:Kt.V.COUNT})],Ru.prototype,"output",void 0),(0,i._)([(0,pr.W)({count:Wn.y.COUNT})],Ru.prototype,"transparencyPassType",void 0),(0,i._)([(0,pr.W)()],Ru.prototype,"spherical",void 0),(0,i._)([(0,pr.W)()],Ru.prototype,"receiveShadows",void 0),(0,i._)([(0,pr.W)()],Ru.prototype,"hasSlicePlane",void 0),(0,i._)([(0,pr.W)()],Ru.prototype,"transparent",void 0),(0,i._)([(0,pr.W)()],Ru.prototype,"enableOffset",void 0),(0,i._)([(0,pr.W)()],Ru.prototype,"writeDepth",void 0),(0,i._)([(0,pr.W)()],Ru.prototype,"hasScreenSpaceReflections",void 0),(0,i._)([(0,pr.W)()],Ru.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,i._)([(0,pr.W)()],Ru.prototype,"hasCloudsReflections",void 0),(0,i._)([(0,pr.W)()],Ru.prototype,"objectAndLayerIdColorInstanced",void 0),(0,i._)([(0,pr.W)()],Ru.prototype,"draped",void 0),(0,i._)([(0,pr.W)()],Ru.prototype,"multipassEnabled",void 0),(0,i._)([(0,pr.W)()],Ru.prototype,"cullAboveGround",void 0),(0,i._)([(0,pr.W)({constValue:!1})],Ru.prototype,"occlusionPass",void 0),(0,i._)([(0,pr.W)({constValue:Zl.A9.Water})],Ru.prototype,"pbrMode",void 0),(0,i._)([(0,pr.W)({constValue:!0})],Ru.prototype,"useCustomDTRExponentForWater",void 0),(0,i._)([(0,pr.W)({constValue:!0})],Ru.prototype,"highStepCount",void 0),(0,i._)([(0,pr.W)({constValue:!1})],Ru.prototype,"useFillLights",void 0);class Pu extends er.A{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){const t=null!=e.ssr.lastFrameColor;t!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:t})}_updateCloudsReflectionState(e){const t=null!=e.cloudsFade.data;t!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:t})}ensureResources(e){return this._techniques.constructionContext.waterTextures.ensureResources(e)}beginSlot(e){return this._output===Kt.V.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniques.constructionContext.waterTextures.passParameters),this.ensureTechnique(Mu,e)}}class Ou extends Oc.W{constructor(e){super(e,new Iu),this._configuration=new Ru,this._animation=new Cu.a,this.produces=new Map([[rr.N.OPAQUE_MATERIAL,e=>(0,Kt._o)(e)&&!this.parameters.transparent||(0,Kt.u5)(e)],[rr.N.TRANSPARENT_MATERIAL,e=>(0,Kt._o)(e)&&this.parameters.transparent||(0,Kt.u5)(e)],[rr.N.DRAPED_MATERIAL,e=>this.parameters.draped&&e===Kt.V.Color||(0,Kt.u5)(e)],[rr.N.DRAPED_WATER,e=>e===Kt.V.Normal]])}getConfiguration(e,t){return this._configuration.output=e,this._configuration.writeDepth=!0,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<kn.xt,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}update(e){const t=Math.min(e.camera.relativeElevation,e.camera.distance);this._animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*t<Lu;const r=this._animation.advance(e);return this.setParameters({timeElapsed:(0,Au.y)(this._animation.time)*this.parameters.animationSpeed},!1),this._animation.enabled&&r}createGLMaterial(e){return new Pu(e)}createBufferWriter(){return new zs.Z((0,l.A)("enable-feature:objectAndLayerId-rendering")?Vs.Dq:Vs.zK)}get test(){}}class Iu extends tr.qA{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=(0,Ir.fA)(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=(0,D.fA)(0,0,0,0),this.transparent=!0,this.hasSlicePlane=!1,this.draped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.origin=(0,m.vt)(),this.modelTransformation=null}}const Lu=35e3,Nu={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},Du=["polyline","polygon","extent"];class Fu extends Dt{constructor(e,t,r,i){super(e,t,r,i)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,Du,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(t);return this.ensureDrapedStatus("on-the-ground"===r.mode),this.ensureMaterial(),this.draped?this._createAsOverlay(t):this._createAs3DShape(t,r,t.uid)}ensureMaterial(){if(this._materials[0])return;const e=new Iu,t=this.symbolLayer.color;null!=t&&(e.color=P.A.toUnitRGBA(t));const r=this._getCombinedOpacity(t,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],r],e.transparent=r<1||this.needsDrivenTransparentPass,e.waveDirection=null!=this.symbolLayer.waveDirection?Fu.headingVectorFromAngle(this.symbolLayer.waveDirection):(0,Ir.fA)(0,0);const i=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=Nu[i];e.waveStrength=n.waveStrength,e.waveTextureRepeat=n.textureRepeat,e.waveVelocity=n.waveVelocity,e.flowStrength=n.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.draped=this.draped,this._materials[0]=new Ou(e),this._context.stage.add(this._materials[0])}layerOpacityChanged(){if(null==this._materials[0])return;const e=this._materials[0].parameters.color,t=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=t<1||this.needsDrivenTransparentPass;this._materials[0].setParameters({color:[e[0],e[1],e[2],t],transparent:r})}layerElevationInfoChanged(e,t,r){const i=this._elevationContext.mode,n=(0,v.I2)(Fu.elevationModeChangeTypes,r,i);if(n!==v.uw.UPDATE)return n;const s=(0,v.nu)(i);return this.updateGraphics3DGraphicElevationInfo(e,t,(()=>s))}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,t,r){const i=ti(e.geometry);if(null==i)return null;const n=si(i,this._context.elevationProvider,this._context.renderCoordsHelper,t),s=n.position.length/3,o=(0,Wr.jh)(2*s);zu(o,n.mapPositions,s,this._context.elevationProvider.spatialReference);const a=new Hu(n,o,this._context.layer.uid,e.uid);if(a.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(a),this._create3DShapeGeometries(a),this._logGeometryCreationWarnings(a.renderData,i.rings,"rings","WaterSymbol3DLayer"),0===a.outGeometries.length)return null;const l=new Gt.B({geometries:a.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:r}),c=new bt(this,l,a.outGeometries,null,null,rt,t);return c.alignedSampledElevation=a.renderData.sampledElevation,c.needsElevationUpdates=(0,v.nu)(t.mode),c}_create3DShapeGeometries(e){const t=e.renderData.polygons,r=e.uvCoords;for(const{count:i,index:n,position:s,mapPositions:o,holeIndices:a}of t){if(null!=this._context.clippingExtent&&((0,$.Ie)(Bu),(0,$.Hq)(Bu,o),!(0,$.KG)(Bu,this._context.clippingExtent)))continue;const t=(0,Hr.e)(o,a,3);if(0===t.length)continue;const l=(0,Wr.l5)(r,2*n,2*i),c=ei({material:this._materials[0],indices:t,mapPositions:o,attributeData:{position:s,uv0:l}},e.objectAndLayerIdColor);e.outGeometries.push(c)}}_createAsOverlay(e){const t=ti(e.geometry);if(null==t)return null;this._materials[0].renderPriority=this._renderPriority;const r=oi(t,this._context.overlaySR),i=r.position.length/3,n=(0,Wr.jh)(2*i);zu(n,r.position,i,this._context.overlaySR);const s=new ku(r,n,this._context.layer.uid,e.uid);return s.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(s),s.outBoundingBox=(0,$.Ie)(),this._createAsOverlayWater(s),this._logGeometryCreationWarnings(s.renderData,t.rings,"rings","WaterSymbol3DLayer"),0===s.outGeometries.length?null:new Qi(this,s.outGeometries,s.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const t=e.uvCoords,r=e.renderData.polygons;for(const{position:i,holeIndices:n,index:s,count:o}of r){if((0,$.Ie)(Bu),(0,$.Hq)(Bu,i),!(0,$.KG)(Bu,this._context.clippingExtent))continue;(0,$.RF)(e.outBoundingBox,Bu);const r=(0,Hr.e)(i,n,3);if(0===r.length)continue;const a=(0,Wr.l5)(t,2*s,2*o),l=ei({material:this._materials[0],indices:r,attributeData:{position:i,uv0:a}},e.objectAndLayerIdColor);e.outGeometries.push(new xn.$(l,e))}}static headingVectorFromAngle(e){const t=(0,Ir.vt)(),r=(0,Tl.DF)(e);return t[0]=Math.sin(r),t[1]=Math.cos(r),t}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}}function zu(e,t,r,i){const n=(0,Br.GA)(i);(0,Y.Ie)(Uu);for(let e=0;e<r;e++)(0,Or.hZ)(Gu,t[3*e],t[3*e+1]),(0,Y.tK)(Uu,Gu);(0,su.b)(Uu,Uu,n);const s=Uu[0]%Fu.unitSizeOfTexture,o=Uu[1]%Fu.unitSizeOfTexture;Vu[0]=Uu[0]-s,Vu[1]=Uu[1]-o;for(let i=0;i<r;i++)e[2*i]=(t[3*i]*n-Vu[0])/Fu.unitSizeOfTexture,e[2*i+1]=(t[3*i+1]*n-Vu[1])/Fu.unitSizeOfTexture}Fu.unitSizeOfTexture=100,Fu.elevationModeChangeTypes={definedChanged:v.uw.RECREATE,staysOnTheGround:v.uw.NONE,onTheGroundChanged:v.uw.RECREATE};const Vu=(0,Ir.vt)(),Uu=(0,Y.vt)(),Gu=(0,Ir.vt)(),Bu=(0,$.vt)();class Hu extends ri{constructor(e,t,r,i){super(e,r,i),this.uvCoords=t}}class ku extends ri{constructor(e,t,r,i){super(e,r,i),this.uvCoords=t}}function ju(e,t,r,i){const n=qu[e.type]?.[t.type]||Wu[t.type];return n?new n(e,t,r,i):(c.A.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${t.type}`),null)}const Wu={icon:Mn,object:class extends Dt{getCachedSize(){const[e,t,r]=null!=this._resources?this._resources.symbolSize:[1,1,1];return{width:e,depth:t,height:r}}constructor(e,t,r,i){super(e,t,r,i),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.skipHighSymbolLodsChanged=!1,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=r.physicalBasedRenderingEnabled}async doLoad(e){if(!this._drivenProperties.size&&(0,gt.Hj)(this.symbolLayer))throw new Error;if(this._isPrimitive){const t=this.symbolLayer.resource,r=t&&function(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}(t?.primitive)?t.primitive:oe.r;this._resources=await this._createResourcesForPrimitive(r,e)}else{const t=await async function(e){if(null===e||null==e.styleName&&null==e.styleUrl)return null;const t=e.name;if(null==t)throw new n.A("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const r={portal:e.portal},i=await(0,jo.cF)(e,r).catch((()=>null));if(null===i)return null;const s=(0,Wo.p)(t,i.data);if(s&&!s.formatInfos?.some((e=>"gltf_basisu"===e.type)))return null;const o=await(0,Wo.I)(i,t,r,"webRef",((e,t)=>(0,jo.o5)(e,t,["gltf_basisu","gltf"]))).catch((()=>null));if(null===o||"point-3d"!==o.type)return null;const a=o.symbolLayers.items[0];return"object"===a.type?a.resource:null}(this.symbol.styleOrigin),r=t?.href??this.symbolLayer.resource?.href;this._resources=await this._createResourcesForUrl(r,e)}this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return null!=this._resources?this._resources.extentPadding:0}get _isPrimitive(){return!this.symbolLayer.resource?.href}get lodRenderer(){return this._resources?.lodRenderer}get materials(){return this._resources?.stageResources.materials??[]}_setMaterialTransparencyParameters(e,t=this.symbolLayer?.material?.color){const r=this._getCombinedOpacity(t),i=r<1||this.needsDrivenTransparentPass;return e.transparent=i,e.opacity=r,e.cullFace=i?yt.s2.None:yt.s2.Back,e}async _createResourcesForPrimitive(e,t){const r=this.symbolLayer,i=(0,$.vt)((0,No.Fq)(e)),n=(0,m.ci)((0,$.Ej)(i)),s=(0,m.ci)((0,No.Bb)(n,r)),o=(0,k.l)(s),a={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:[...lo.mX],ambient:m.Un,diffuse:m.Un,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},c=!!a.usePBR;this._setMaterialTransparencyParameters(a);const u=this.symbol;if("point-3d"===u.type&&u.verticalOffset){const{screenLength:e,minWorldLength:t,maxWorldLength:r}=u.verticalOffset;a.verticalOffset={screenLength:(0,$e.Lz)(e),minWorldLength:t||0,maxWorldLength:null!=r?r:1/0},a.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(a.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)a.externalColor=D.Un;else{const e=null!=r.material?r.material.color:null,t=null!=e?P.A.toUnitRGBA(e):D.Un;a.externalColor=t}this._fastUpdates=(0,Lt.s_)(this._context.renderer,this._fastVisualVariableConvertOptions(i,s,n,null)),a.isInstanced=!0,this._fastUpdates?(Object.assign(a,this._fastUpdates.materialParameters),this._optionalFields.push(le.r.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(a.hasInstancedColor=!0,this._optionalFields.push(le.r.COLOR)),(0,l.A)("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(le.r.OBJECTANDLAYERIDCOLOR);const h=me(e,new we.$U(a));if(!h)throw new Error(`Unknown object symbol primitive: ${e}`);const d=de(h).map((e=>({opacity:1,transparent:e.parameters.transparent}))),p=await this._createStageResources(h,c,t),f=await this._createLodRenderer(h,t);return new La(h,f,p,d,n,!1,!1,i,s,o,c,null)}async _createResourcesForUrl(e,t){const r={materialParameters:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=(0,Lt.s_)(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)),this._fastUpdates?(Object.assign(r.materialParameters,this._fastUpdates.materialParameters),this._optionalFields.push(le.r.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(r.materialParameters.hasInstancedColor=!0,this._optionalFields.push(le.r.COLOR)),(0,l.A)("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(le.r.OBJECTANDLAYERIDCOLOR);const i=this.symbol;if("point-3d"===i.type&&i.verticalOffset){const{screenLength:e,minWorldLength:t,maxWorldLength:n}=i.verticalOffset;r.materialParameters.verticalOffset={screenLength:(0,$e.Lz)(e),minWorldLength:t||0,maxWorldLength:null!=n?n:1/0},r.materialParameters.castShadows=!1}const n=this._context.physicalBasedRenderingEnabled;r.signal=t,r.usePBR=n,r.skipHighLods=this._context.skipHighSymbolLods;const s=await(0,ko.fetch)(e,r),o=s.isEsriSymbolResource,a=s.isWosr,c=function(e){return new he(e.map(((e,t)=>function(e,t){const r=e.stageResources.geometries.map((t=>new ce(t,e.stageResources.textures))),i=null==e.lodThreshold||0===e.lodThreshold&&t>0?function(e){const t=e.reduce(((e,{geometry:t})=>e+t.indexCount/3),0);return Math.sqrt(t*Ho/Math.PI)}(r):e.lodThreshold;return new ue(r,i,e.pivotOffset)}(e,t))))}(s.lods),u=this._context,h=this.symbolLayer.material,d=this._getExternalColorParameters(h),p=this.symbolLayer?.material?.color,f=this._getCombinedOpacity(p,{hasIntrinsicColor:!0}),g=this.needsDrivenTransparentPass,y=de(c),_=de(c).map((e=>({opacity:e.parameters.opacity||1,transparent:e.parameters.transparent})));y.forEach((e=>{const t=e.parameters;e.setParameters(d);const r=t.opacity*f,i=r<1||g||t.transparent;e.setParameters({opacity:r,transparent:i}),u.screenSizePerspectiveEnabled&&e.setParameters({screenSizePerspective:u.sharedResources.screenSizePerspectiveSettings})}));const v=s.referenceBoundingBox,b=(0,m.ci)((0,$.Ej)(v)),x=(0,m.ci)(c.levels[0].pivotOffset),S=(0,m.ci)((0,No.Bb)(b,this.symbolLayer)),w=(0,k.l)(S),T=this._fastUpdates;(0,Lt.J_)(T,this._context.renderer,this._fastVisualVariableConvertOptions(v,S,b,x))&&y.forEach((e=>e.setParameters(T.materialParameters)));const A=await this._createStageResources(c,n,t),C=await this._createLodRenderer(c,t);return new La(c,C,A,_,b,o,a,v,S,w,n,x)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,t,r){const i=this._context.stage,n=de(e);t!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),i.addMany(n),this._addDisposeResource((()=>i.removeMany(n)));const s=pe(e);i.addMany(s),this._addDisposeResource((()=>{s.forEach((e=>e.unload())),i.removeMany(s)})),await Promise.all(s.map((e=>this._context.stage.schedule((()=>e.load(i.renderView.renderingContext)),r)))),(0,d.Te)(r);const o=fe(e);return i.addMany(o),this._addDisposeResource((()=>i.removeMany(o))),{materials:n,textures:s,geometries:o}}async _createLodRenderer(e,t){const r=this._context.stage,i={layerUid:this._context.layer.uid,graphicUid:e=>this._instanceIndexToGraphicUid.get(e),notifyGraphicGeometryChanged:e=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(e)),notifyGraphicVisibilityChanged:e=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(e))},n=this._fastUpdates,s=n?{applyTransform:(e,t,r)=>{e.getFeatureAttribute(t,Ua),(0,Ye.C)(r,(0,Lt.b3)(n.materialParameters,Ua,r))},scaleFactor:(e,t,r)=>{t.getFeatureAttribute(r,Ua),(0,Lt.VC)(e,n.materialParameters,Ua)}}:null,o=new Ta({symbol:e,optionalFields:this._optionalFields,metadata:i,shaderTransformation:s},this._context.scheduler);return o.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource((()=>{r.removeRenderPlugin(o),o.destroy()})),await r.addRenderPlugin(o,t),o}_getExternalColorParameters(e){const t={};return this._drivenProperties.color?t.externalColor=D.Un:null!=e?.color?t.externalColor=P.A.toUnitRGBA(e.color):(t.externalColor=D.Un,t.colorMixMode="ignore"),t}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach((e=>e())),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry))return null;const r=Wt(t.geometry);if(null==r)return this.logger.warn(`unsupported geometry type for icon symbol: ${t.geometry.type}`),null;const i=this.setGraphicElevationContext(t),n=e.renderingInfo;return this._createAs3DShape(t,r,n,i,t.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(null==this._resources)return;const e=this._drivenProperties.opacity,t=!this._isPrimitive,r=this._resources.stageResources.materials,i=this._resources.originalMaterialParameters;for(let n=0;n<r.length;n++){const s=r[n],o=this.symbolLayer?.material?.color,a=i[n],l=this._getCombinedOpacity(o,{hasIntrinsicColor:t})*a.opacity,c=l<1||e||a.transparent;s.setParameters({opacity:l,transparent:c}),this._isPrimitive&&s.setParameters({cullFace:c?yt.s2.None:yt.s2.Back})}}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,v.Kf)}slicePlaneEnabledChanged(){if(null==this._resources)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(null==this._resources)return!0;const{stageResources:e,isWosr:t}=this._resources;for(const r of e.materials)this._isPrimitive?r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):t||r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return!1!==this._hasLoadedPBRTextures||!0!==this._context.physicalBasedRenderingEnabled||(this._hasLoadedPBRTextures=!0,!1)}applyRendererDiff(e,t){if(null==this._resources)return Et.RecreateSymbol;const{stageResources:{materials:r},lodRenderer:i,resourceBoundingBox:n,symbolSize:s,resourceSize:o,pivotOffset:a}=this._resources;for(const l in e.diff){if("visualVariables"!==l)return Et.RecreateSymbol;if(!(0,Lt.J_)(this._fastUpdates,t,this._fastVisualVariableConvertOptions(n,s,o,a)))return Et.RecreateSymbol;for(const e of r)e.setParameters(this._fastUpdates.materialParameters);i.notifyShaderTransformationChanged()}return Et.FastUpdate}computeComplexity(){if(null==this._resources)return super.computeComplexity();const e=this._resources.lodResources,t=Pe(e.levels),r=fe(e).reduce(((e,t)=>e+(e=>Array.from(e.attributes.values()).reduce(((e,t)=>e+(0,Lo.Ek)(t.data,t.indices)),0))(t)),0),i=pe(e).reduce(((e,t)=>e+t.memoryEstimate),0)+r,n={...Me(this.symbol,this.symbolLayer),resourceBytes:i};return new ye({verticesPerFeature:t,memory:n})}_hasLodRenderer(){return null!=this._resources}_createAs3DShape(e,t,r,i,n,s){if(!this._hasLodRenderer()||null==this._resources)return null;const o=this.getFastUpdateAttrValues(e),a=this._context.clippingExtent;if((0,g.g)(t,Fa,this._context.elevationProvider.spatialReference),null!=a&&!(0,$.Uc)(a,Fa))return null;const l=Da(i),c=this._computeGlobalTransform(t,i,Va,Ga),u=this._computeLocalTransform(this._resources,this.symbolLayer,r,za),h=this._resources.lodRenderer.instanceData,d=h.addInstance();this._instanceIndexToGraphicUid.set(d,n),h.setLocalTransform(d,u,!1),h.setGlobalTransform(d,c),o&&h.setFeatureAttribute(d,o),null==this._fastUpdates&&this._hasPerInstanceColor()&&h.setColor(d,(0,gt.$C)(r.color,r.opacity,255)),null!=this._context.stage.renderView.objectAndLayerIdRenderHelper&&h.setObjectAndLayerIdColor(d,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:n,layerUid:s}));const p=new Fo(this,d,st,i);return l&&(p.alignedSampledElevation=Ga.sampledElevation),p.needsElevationUpdates=(0,v.Kf)(i.mode),jt(p,t,this._context.elevationProvider),p}_computeGlobalTransform(e,t,r,i){return(0,v.sE)(e,this._context.elevationProvider,t,this._context.renderCoordsHelper,i),Fa[0]=e.x,Fa[1]=e.y,Fa[2]=i.z,(0,Je.l)(e.spatialReference,Fa,r,this._context.renderCoordsHelper.spatialReference),r}_computeLocalTransform(e,t,r,i){return(0,Ye.D_)(i),this._applyObjectRotation(r,!1,i),this._applyObjectRotation(t,!0,i),this._applyObjectScale(e,r,i),this._applyAnchor(e,t,i),i}_applyObjectScale(e,t,r){if(this._fastUpdates?.requiresShaderTransformation)return;const i=this._drivenProperties.size&&t.size?t.size:e.symbolSize,n=(0,gt.pW)(i,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);1===n[0]&&1===n[1]&&1===n[2]||(0,Ye.hs)(r,r,n)}prepareSymbolLayerPatch(e){if("partial"!==e.diff.type)return;const t=e.diff.diff;this._preparePatchTransform(e,t),this._preparePatchColor(e,t)}updateGeometry(e,t){if(null==this._resources)return!0;const r=t&&Wt(t);if(null==r)return!1;const i=this.getGeometryElevationMode(t);return e.elevationContext.mode===i&&(this._computeGlobalTransform(r,e.elevationContext,Va,Ga),Da(e.elevationContext)&&(e.alignedSampledElevation=Ga.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,Va,!0),jt(e,r,this._context.elevationProvider),!0)}_preparePatchTransform(e,t){if(!(t.heading||t.tilt||t.roll||t.width||t.height||t.depth||t.anchor||t.anchorPosition))return;if(null==this._resources)return;const r=(e,t,r)=>(null!=e&&"complete"===e.type?e.newValue:t)??r,i=r(t.heading,this.symbolLayer.heading,0),n=r(t.tilt,this.symbolLayer.tilt,0),s=r(t.roll,this.symbolLayer.roll,0),o=r(t.width,this.symbolLayer.width,void 0),a=r(t.height,this.symbolLayer.height,void 0),l=r(t.depth,this.symbolLayer.depth,void 0),c=r(t.anchor,this.symbolLayer.anchor,void 0),u=r(t.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete t.heading,delete t.tilt,delete t.roll,delete t.width,delete t.height,delete t.depth,delete t.anchor,delete t.anchorPosition;const h={heading:i,tilt:n,roll:s,anchor:c,anchorPosition:u},d=this._resources;this.loadStatus===Mt.LOADED&&e.symbolLayerStatePatches.push((()=>{d.symbolSize=(0,m.ci)((0,No.Bb)(d.resourceSize,{width:o,height:a,depth:l,isPrimitive:this.symbolLayer.isPrimitive}))})),e.graphics3DGraphicPatches.push(((e,t)=>{const r=this._computeLocalTransform(d,h,t,za),i=e.instanceIndex;d.lodRenderer.instanceData.setLocalTransform(i,r,!0)}))}_preparePatchColor(e,t){if(!t.material||"partial"!==t.material.type)return;const r=t.material.diff;if(!r.color||"complete"!==r.color.type||null==r.color.newValue||null==r.color.oldValue)return;const i=r.color.newValue,n=null!=i?P.A.toUnitRGBA(i):D.Un;delete r.color;const s=this._resources;null!=s&&e.graphics3DGraphicPatches.push((e=>{let t;this._hasPerInstanceColor()?(s.lodRenderer.instanceData.setColor(e.instanceIndex,n),t=this._setMaterialTransparencyParameters({},i)):t=this._setMaterialTransparencyParameters({externalColor:n},i);for(const e of s.stageResources.materials)e.setParameters(t)}))}_applyObjectRotation(e,t,r){if(!this._fastUpdates?.requiresShaderTransformation||!t)return(0,gt.$2)(e.heading,e.tilt,e.roll,r)}_applyAnchor(e,t,r){if(this._fastUpdates?.requiresShaderTransformation)return;const i=Na(e.resourceBoundingBox,e.pivotOffset,t);i&&(0,Ye.Tl)(r,r,i)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,t,r,i){const n=null!=e?(0,m.ci)((0,$.Ej)(e)):m.Un,s=null!=e?Na(e,i,this.symbolLayer):m.uY,o=this._context.renderCoordsHelper.unitInMeters,a=(0,gt.pW)(null!=t?t:void 0,t,r,o),l=(0,m.fA)(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new Lt.wI({size:!0,color:!0,rotation:!0,opacity:!1},n,t??m.Un,o,s,a,l)}},line:os,path:class extends Dt{constructor(e,t,r,i){super(e,t,r,i),this._intrinsicSize=(0,Ir.fA)(1,1),this._upVectorAlignment=il.Path,this._stencilWidth=.1,this.usedMemory=0,this.ensureDrapedStatus(!1)}async doLoad(){const e=null!=this.symbolLayer.width?this.symbolLayer.width:this.symbolLayer.height,t=null!=this.symbolLayer.height?this.symbolLayer.height:e;this._vvConvertOptions=new Lt.wI({size:!0,color:!0,rotation:!1,opacity:!0},[1,1,1],[e,1,t],this._context.renderCoordsHelper.unitInMeters),this._fastUpdates=this._context.renderer?.visualVariables?.length>0?(0,Lt.s_)(this._context.renderer,this._vvConvertOptions):null;const r=this.symbolLayer.anchor||"center";this._upVectorAlignment="heading"===this.symbolLayer.profileRotation?il.World:il.Path;const i=this.symbolLayer.profile||"circle";switch(i){default:case"circle":this._profile=xl[r];break;case"quad":this._profile=Sl[r]}switch(this.symbolLayer.join){case"round":this._extruder=new Xa(0,3);break;case"bevel":this._extruder=new Xa(0,1);break;case"miter":this._extruder=new Xa(.8*Math.PI,1);break;default:this._extruder=new Ya}const s=this.symbolLayer.cap||"butt";switch(s){case"none":this._startCap=new ja,this._endCap=new ja;break;case"butt":default:this._startCap=new Wa(this._profile,0),this._endCap=new Wa(this._profile,0,!0);break;case"square":this._startCap=new Wa(this._profile,-.5),this._endCap=new Wa(this._profile,.5,!0);break;case"round":{const e="quad"===i;this._startCap=new qa({profile:this._profile,flip:!1,breakNormals:e,subdivisions:3}),this._endCap=new qa({profile:this._profile,flip:!0,breakNormals:e,subdivisions:3});break}}const o=this.symbolLayer?.material?.color,a=this._getCombinedOpacityAndColor(o),l=(0,m.ci)(a),c=a[3],u=c<1||this.needsDrivenTransparentPass,h={diffuse:l,ambient:l,opacity:c,transparent:u,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:u||"none"===s?yt.s2.None:yt.s2.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&((0,Or.hZ)(this._intrinsicSize,e,t),!(0,gt.Mh)(this._intrinsicSize[0])||!(0,gt.Mh)(this._intrinsicSize[1])))throw new n.A("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates?.visualVariables.size||(0,Or.hs)(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates){const e={...h,...this._fastUpdates.materialParameters,size:(0,Ir.ci)(this._intrinsicSize)};this._materials[0]=new Kl(e)}else h.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,h.normalType=fi.W.Compressed,this._materials[0]=new we.$U(h);this._materials[0].setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials[0]=null,this._materials.length=0}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,ic,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(t),i=e.renderingInfo;return this._createAs3DShape(t,i,r,t.uid)}layerOpacityChanged(){const e=this.symbolLayer?.material?.color,t=this._getCombinedOpacity(e),r=t<1||this.needsDrivenTransparentPass;this._materials[0]?.setParameters({opacity:t,transparent:r})}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,v.Kf)}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._materials[0]?.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}applyRendererDiff(e,t){for(const r in e.diff){if("visualVariables"!==r)return Et.RecreateSymbol;if(!(0,Lt.J_)(this._fastUpdates,t,this._vvConvertOptions))return Et.RecreateSymbol;this._materials[0]?.setParameters(this._fastUpdates.materialParameters)}return Et.FastUpdate}_getVertexData(e){let t=0;const r=e.paths,i=[],n=e.spatialReference,s=this._context.elevationProvider.spatialReference,o=this._context.renderCoordsHelper.spatialReference;for(const e of r)t+=e.length;const a=(0,Wr.jh)(3*t);let l,c=0;for(const t of r){i.push({offset:c,numVertices:t.length});for(const r of t)a[c++]=r[0],a[c++]=r[1],a[c++]=e.hasZ?r[2]:0}return null==s||n.equals(s)||(0,W.projectBuffer)(a,n,0,a,s,0,t)?(null==s||s.equals(o)?l=(0,Wr.xm)(a):(l=(0,Wr.jh)(3*t),(0,W.projectBuffer)(a,s,0,l,o,0,t)),{pathVertexDataInfos:i,vertexDataES:a,vertexDataRS:l}):null}_createAs3DShape(e,t,r,i){this.usedMemory=0;const n=e.geometry,s=this._getVertexData(n);if(null==s)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(0===s.pathVertexDataInfos.length)return 0!==n.paths.length&&n.paths.some((e=>e.length>0))||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;const o=new Array,a=n.spatialReference,l=(0,$.vt)(),c=this._context.renderCoordsHelper,u=new Ke.aY(s.vertexDataES);for(const n of s.pathVertexDataInfos){const h=n.numVertices;if(h<2)continue;const d=n.offset;if(null!=this._context.clippingExtent&&((0,$.Ie)(l),(0,$.Hq)(l,s.vertexDataES,d,h),!(0,$.KG)(l,this._context.clippingExtent)))continue;const p=new Array,f=d+3*h;for(let e=d;e<f;e+=3){u.offset=e;const t=(0,v.nG)(u,this._context.elevationProvider,r,c);(0,k.s)(ac,s.vertexDataRS[e],s.vertexDataRS[e+1],s.vertexDataRS[e+2]),c.setAltitude(ac,t),s.vertexDataRS[e]=ac[0],s.vertexDataRS[e+1]=ac[1],s.vertexDataRS[e+2]=ac[2],p.push(Ll(this._upVectorAlignment))}const m=new Ba(p,s.vertexDataES,s.vertexDataRS,d);nc(m,this._upVectorAlignment,this._context.renderCoordsHelper);const g=new Ha(m,this._profile,this._extruder,this._startCap,this._endCap);let y=null;if(this._fastUpdates){const t=this._fastUpdates.visualVariables,r=(0,Lt.ul)(t.size?.field,e)??0,i=(0,Lt.ul)(t.color?.field,e)??0,n=(0,Lt.ul)(t.opacity?.field,e)??0;y=new ll(g,r,i,n)}else{const e=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const r=t.size;e[0]*=sc(r[0],"symbol-value"===r[2]?this.symbolLayer.height||0:r[2],this.symbolLayer.width||0),e[1]*=sc(r[2],"symbol-value"===r[0]?this.symbolLayer.width||0:r[0],this.symbolLayer.height||0)}let r;this._drivenProperties.color&&(r=t.color),this._drivenProperties.opacity&&null!=t.opacity&&(r=r?[r[0],r[1],r[2],t.opacity]:[1,1,1,t.opacity]);const i=new al(g);i.bake(e),r&&i.bakeVertexColors(r),y=i}const _=y.createGeometryData(),b=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:this._context.layer.uid}),x=new rl(this._materials[0],_,y,a,this._stencilWidth,b);x.transformation=(0,Ye.Tl)((0,Xe.vt)(),Xe.zK,g.path.origin),o.push(x),this.usedMemory+=g.usedMemory}if(0===o.length)return null;const h=new Gt.B({geometries:o,layerUid:this._context.layer.uid,graphicUid:i}),d=new bt(this,h,o,null,null,((e,t,r,i,n)=>function(e,t,r,i,n){const s=e.stageObject,o=s.geometries;let a=0;for(const e of o){if(!nl(e))continue;const t=e.path,o=t.builder.path;a+=oc(o,0,r,i),n!==il.World&&nc(o,n,i),t.onPathChanged(e),e.invalidateBoundingInfo(),s.geometryVertexAttributeUpdated(e,le.r.POSITION)}return a/o.length}(e,0,i,n,this._upVectorAlignment)),r);return d.alignedSampledElevation=0,d.needsElevationUpdates=(0,v.Kf)(r.mode),d}},fill:Zc,extrude:class extends Dt{constructor(e,t,r,i){super(e,t,r,i),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=(0,gt.Hj)(this._getSymbolSize());if(e)throw new n.A("graphics3dextrudesymbollayer:invalid-size",e)}const e=this.symbolLayer?.material?.color,t=this._getCombinedOpacityAndColor(e),r=(0,m.ci)(t),i=t[3],s=i<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:r,ambient:r,opacity:i,transparent:s,cullFace:s?yt.s2.None:yt.s2.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:fi.W.Compressed};this._materials[Ui.Main]=new we.$U(o),this._materials[Ui.Bottom]=new we.$U({...o,cullFace:yt.s2.Back}),this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,gi,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),i=this.setGraphicElevationContext(t);return this._createAs3DShape(t,e.renderingInfo,r,i,t.uid)}layerOpacityChanged(e,t){const r=this.symbolLayer?.material?.color,i=this._getCombinedOpacity(r),n=i<1||this.needsDrivenTransparentPass;this._materials[Ui.Main]?.setParameters({opacity:i,transparent:n}),this._materials[Ui.Bottom]?.setParameters({opacity:i,transparent:n});const s=this._getLayerOpacity();e.forEach((e=>{const r=t(e);null!=r&&r.layerOpacityChanged(s,this._context.isAsync)}))}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,v.Kf)}slicePlaneEnabledChanged(e,t){return this._materials[Ui.Main]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[Ui.Bottom]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach((e=>{const r=t(e);null!=r&&r.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)})),!0}physicalBasedRenderingChanged(){const e={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0};return this._materials[Ui.Main]?.setParameters(e),this._materials[Ui.Bottom]?.setParameters(e),!0}_getExtrusionSize(e){let t;return t=e.size&&this._drivenProperties.size?function(e,t=0){const r=e[t];return"number"==typeof r&&isFinite(r)?r:null}(e.size,2)??0:this._getSymbolSize(),t/=this._context.renderCoordsHelper.unitInMeters,t}applyRendererDiff(e,t){return this._drivenPropertiesChanged(t)?Et.RecreateSymbol:Et.RecreateGraphics}async queryForSnapping(e,t,r,i){const n=this._getExtrusionSize(r)*this._context.renderCoordsHelper.unitInMeters/(0,Br.G9)(t),{objectId:s,target:o}=e,a=(0,Gr.o8)(o);switch(a.z=(a.z??0)+n,e.type){case"edge":{const{start:t,end:r}=e,i=(0,Gr.o8)(t),o=(0,Gr.o8)(r);return i.z=(i.z??0)+n,o.z=(o.z??0)+n,[(0,$r.P)(s,a,1/0,i,o)]}case"vertex":return[(0,$r.k)(s,a,1/0),(0,$r.P)(s,o,1/0,o,a)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,t,r,i,n){const s=ti(e.geometry);if(null==s)return null;if(0===s.rings.length||!s.rings.some((e=>e.length>0)))return this._logGeometryValidationWarnings(s.rings,"rings","ExtrudeSymbol3DLayer"),null;const o=si(s,this._context.elevationProvider,this._context.renderCoordsHelper,i);this._logGeometryCreationWarnings(o,s.rings,"rings","ExtrudeSymbol3DLayer");const a=(0,gt.W$)(s);if(null==a)return null;const l=new Array,c=new Array,u=(0,$.vt)(),h=(0,Xe.vt)(),d=(0,m.vt)(),p=this._context.renderCoordsHelper.viewingMode===nr.RT.Global;p||this._context.renderCoordsHelper.worldUpAtPosition(null,d),(0,Je.l)(s.spatialReference,[a.x,a.y,0],h,this._context.renderCoordsHelper.spatialReference);const f=(0,Xe.vt)();(0,Ye.B8)(f,h);const g=(0,jr.vt)();(0,kr.Ge)(g,f);const{polygons:y,mapPositions:_,position:b}=o,x=new Map,S=this._materials[Ui.Main];for(const e of y){const i=e.count;if(this._context.clippingExtent&&((0,$.Ie)(u),(0,$.Hq)(u,e.mapPositions),!(0,$.KG)(u,this._context.clippingExtent)))continue;const s=(0,Hr.e)(e.mapPositions,e.holeIndices,3);if(0===s.length)continue;const o=s.length,a=6*i,m=(0,qr.my)(a+o),g=(0,qr.my)(o),y=(0,Wr.jh)(3*a),v=(0,Wr.jh)(3*a),w=(0,Wr.jh)(3*a),T=(0,Wr.jh)(a);_i(b,_,s,e,y,w,v,T,m,g,this._getExtrusionSize(t),d,p),(0,Zr.a)(y,y,f);const A=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),C=new Gi(y,w,(0,mi.fA)(v),T),E=yi(S,m,m.length-g.length,C,r,A),M=i,R=i,P=2*e.count,O=new Bi(M,R,P,o/3);Ri(E,O,h),x.set(E,O),l.push(E,yi(this._materials[Ui.Bottom],g,0,C,r,A)),c.push(C.heights)}if(0===l.length)return null;const w=new Gt.B({geometries:l,layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0});w.transformation=h;const T=(0,Se.Cc)(this.symbolLayer,{opacity:this._getLayerOpacity()}),A=null!=T?{baseMaterial:this._materials[Ui.Main],edgeMaterials:[T],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,C=new bt(this,w,l,null,null,((e,t,r,i,n)=>function(e,t,r,i,n,s,o){const a=e.stageObject,l=a.geometries,c=l.length,u="absolute-height"!==t.mode;let h=0;const d=a.transformation,p=(0,Ye.Qw)((0,Xe.vt)(),d);for(let e=0;e<c;e+=2){const t=l[e];if(!tt(t))continue;const c=t.getMutableAttribute(le.r.POSITION).data,f=s[e/2],m=new Ke.aY(t.mapPositions),g=c.length/3;let y=!1,_=0;{let e=0;for(let t=0;t<g;t++){Mi[0]=c[e],Mi[1]=c[e+1],Mi[2]=c[e+2],i(m,Ii),u&&(_+=Ii.sampledElevation),Qe.b.TESTS_DISABLE_OPTIMIZATIONS?((0,k.s)(Pi,m.array[m.offset],m.array[m.offset+1],Ii.z+f[e/3]),null!=r&&n.toRenderCoords(Pi,r,Pi),(0,k.h)(Pi,Pi,p)):((0,k.s)(Pi,c[e],c[e+1],c[e+2]),(0,k.h)(Pi,Pi,d),n.setAltitude(Pi,Ii.z+f[e/3]),(0,k.h)(Pi,Pi,p)),c[e]=Pi[0],c[e+1]=Pi[1],c[e+2]=Pi[2];const t=.01/n.unitInMeters;(Math.abs(Mi[0]-c[e])>=t||Math.abs(Mi[1]-c[e+1])>=t||Math.abs(Mi[2]-c[e+2])>=t)&&(y=!0),m.offset+=3,e+=3}}if(y){const r=o.get(t);r&&Ri(t,r,d),a.geometryVertexAttributeUpdated(l[e],le.r.NORMALCOMPRESSED),t.invalidateBoundingInfo(),a.geometryVertexAttributeUpdated(l[e],le.r.POSITION),l[e+1].invalidateBoundingInfo(),a.geometryVertexAttributeUpdated(l[e+1],le.r.POSITION)}h+=_/g}return h/c}(e,t,r,i,n,c,x)),i,A);return C.alignedSampledElevation=o.sampledElevation,C.needsElevationUpdates=(0,v.Kf)(i.mode),C}},text:class extends Dt{constructor(e,t,r,i){super(e,t,r,i),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=(0,gt.Hj)(this.symbolLayer.size);if(e)throw new n.A("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await tu.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const t=e.graphic,r=Wt(t.geometry);if(null==r)return this.logger.warn(`unsupported geometry type for text symbol: ${t.geometry.type}`),null;const i=this.symbolLayer.text;if(null==i||""===i)return null;const n=(0,Ze.YX)(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(null!=n&&!(0,Ze.Ie)(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const{verticalAlignment:s}=this.symbolLayer,o=new Qc(n);!function(e,t){switch(e){case"top":return(0,Or.hZ)(t,0,1);case"bottom":return(0,Or.hZ)(t,0,-1);default:(0,Or.C)(t,Ir.uY)}}(s,o.screenOffset);const a=new Kc(o,this.symbolLayer.horizontalAlignment,function(e){return"middle"===e?"center":e}(s));return this._createAs3DShape(t,r,i,a)}createLabel(e,t,r,i,n){const s=e.graphic,o=Wt(s.geometry);if(null==o)return this.logger.warn(`unsupported geometry type for label: ${s.geometry.type}`),null;const a=t.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(s,o,a,t,r,i,n)}setGraphicElevationContext(e,t,r=0){return super.setGraphicElevationContext(e,t),t.addOffsetRenderUnits(r),t}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,t){return wu(e,t,((e,t)=>{this.updateGraphicElevationContext(t,e)})),v.uw.UPDATE}slicePlaneEnabledChanged(e,t){return wu(e,t,(e=>{for(const t of e.stageObject.geometries)t.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})})),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(e,t){const r=t.elevationContext;this.setGraphicElevationContext(e,r,null!=t.metadata?t.metadata.elevationOffset:0),t.needsElevationUpdates=(0,v.nu)(r.mode)||"absolute-height"===r.mode}updateGeometry(e,t){if(this.draped||!this._validateGeometry(t))return!1;const{elevationContext:r,stageObject:i}=e;if(r.mode!==this.getGeometryElevationMode(t))return!1;const n=Wt(t);if(!n)return!1;const s=Ht(i,this._context,n,r);if(null==s)return!1;const o=qt(this._context,n);return i.geometries[0].localOrigin===o&&(e.alignedSampledElevation=s,jt(e,n,this._context.elevationProvider),!0)}_defaultElevationInfoNoZ(){return Tu}_createAs3DShape(e,t,r,i,n=null,o=null,a=(()=>i.placement.elevationOffset)){const c=this.setGraphicElevationContext(e,new b.F,i.placement.elevationOffset),u="polyline"===e.geometry?.type,h=e.uid;let p=null,f=null;if(null==o){const e=function(e){switch(e){case"left":return dn.Left;case"right":return dn.Right;default:return dn.Center}}(i.horizontalPlacement);p=new bu(r,e,this._textRenderParameters);let t=null;if(null!=this._context.sharedResources.textures){f=this._context.sharedResources.textures.fromData(p.key,(()=>p.create())),f.texture.events.on("unloaded",(()=>t=(0,s.Gz)(t)));const e=this._context.stage.renderView.textures.acquire(f.texture.id);if(null==e||(0,d.$X)(e))return f.release(),null;t=e}}const m=function(e,t){if("baseline"===t.verticalPlacement){const r=_n[t.horizontalPlacement],i=null!=e?e.baselineAnchorY:0;return(0,Ir.fA)(r,i)}const r=function(e,t){switch(t){case"bottom":return"left"===e?"bottom-left":"right"===e?"bottom-right":"bottom";case"center":return e;case"top":return"left"===e?"top-left":"right"===e?"top-right":"top"}}(t.horizontalPlacement,t.verticalPlacement);return vn[r]}(p,i),g={occlusionTest:!(0,l.A)("enable-feature:non-occluded-hud"),screenOffset:i.placement.screenOffset,anchorPosition:m,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:i.placement.centerOffsetUnits,drawInSecondSlot:!0};if(u&&(g.shaderPolygonOffset=1e-4),o?g.textureId=o.id:f&&(g.textureId=f.texture.id),null!=i.placement.verticalOffset){const{screenLength:e,minWorldLength:t,maxWorldLength:r}=i.placement.verticalOffset;g.verticalOffset={screenLength:(0,$e.Lz)(e),minWorldLength:t||0,maxWorldLength:null!=r?r:1/0}}const y={screenOffset:g.screenOffset,anchorPosition:m,centerOffsetUnits:g.centerOffsetUnits,verticalOffset:g.verticalOffset,shaderPolygonOffset:g.shaderPolygonOffset};if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:e,screenSizePerspectiveSettingsLabels:t}=this._context.sharedResources,r=sn(this._textRenderParameters);g.screenSizePerspective=t.overrideFontHeight(r.maxHeight),g.screenSizePerspectiveAlignment=e,y.fontHeight=r.maxHeight}g.hasSlicePlane=this._context.slicePlaneEnabled;const _=n?((e,t,r)=>{let i=e.get(r);return null==i&&(i=new wn.R(t),e.add(r,i)),i})(n,g,JSON.stringify(y)):new wn.R(g),x=i.placement.translation,S=p?(0,Ir.fA)(p.displayWidth,p.displayHeight):Ir.uY,w=i.placement.centerOffset,T=Su,A=(0,Ir.vt)(),C=(0,ae.DJ)(_,T,x,null,S,w,A,null),E=Bt(this._context,t,C,c,h);if(null==E)return null;const M=new bt(this,E.object,[C],null==n?[_]:null,f,((t,r,n,s,o,l)=>{const c=a()||i.placement.elevationOffset;return it(t,this.setGraphicElevationContext(e,r,c),0,s,o,l)}),c);M.alignedSampledElevation=E.sampledElevation,M.needsElevationUpdates=(0,v.nu)(c.mode)||"absolute-height"===c.mode,M.getScreenSize=(e=(0,Ir.vt)())=>(e[0]=p?p.displayWidth:i.displaySize[0],e[1]=p?p.displayHeight:i.displaySize[1],e);const R=new Ct(i.placement.elevationOffset,r);return M.metadata=R,jt(M,t,this._context.elevationProvider),M}},water:Fu},qu={"mesh-3d":{fill:class extends Dt{constructor(e,t,r,i){super(e,t,r,i),this._materialInfoCache=new Os,this._fastUpdateProcessor=new Ps,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){Qe.b.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new Hs({color:[1,0,1,1]}),this._debugTangentNormalMaterial=new Hs({color:[1,.5,0,1]}),this._debugFaceNormalMaterial=new Hs({color:[0,1,1,1]}))}destroy(){super.destroy(),this._textures.forEach((e=>e.unload())),this._context.stage.removeMany(this._materialInfoCache.materials),this._context.stage.removeMany(Array.from(this._textures.values())),this._materialInfoCache.clear(),this._textures.clear(),this._fastUpdateProcessor.destroy(this._context.stage)}get materials(){return this._materialInfoCache.materials}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,co,"fill on mesh-3d"))return null;const r=this.setGraphicElevationContext(t),i=e.renderingInfo;return this._createAs3DShape(t,i,r,t.uid)}onRemoveGraphic(e){this._fastUpdateProcessor.onRemoveGraphic(e,this._materialInfoCache,this._context)}layerOpacityChanged(e,t){const r=this._getLayerOpacity();this._updateMaterialParameters((e=>{e.material.setParameters({layerOpacity:r});const t=e.material.parameters;this._setMaterialTransparentParameter(t,e),e.material.setParameters({transparent:t.transparent})})),e.forEach((e=>t(e)?.layerOpacityChanged(r,this._context.isAsync)))}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,v.Kf)}slicePlaneEnabledChanged(e,t){return this._updateMaterialParameters((({material:e})=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})})),e.forEach((e=>t(e)?.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync))),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._updateMaterialParameters((({material:t})=>t.setParameters({usePBR:e}))),!0}updateTransform(e,t,r,i){if(!e.fastTransformUpdatesAllowed)return!1;const n=e.fastTransformUpdatesEnabled;switch(i){case _s.$.EnableFastUpdates:if(n)return!0;break;case _s.$.DisableFastUpdates:if(!n)return!0;break;default:if(!n)return!!this.updateTransform(e,t,r,_s.$.EnableFastUpdates)&&(e.autoDisableFastTransformUpdates((()=>this.updateTransform(e,t,r,_s.$.DisableFastUpdates))),!0)}const s=this._context.renderCoordsHelper.spatialReference,o=Ro,{origin:a,transform:l}=r;if(!(0,Je.l)(t,(0,k.s)(To,a.x,a.y,a.z??0),o,s))return!1;switch(i){case _s.$.EnableFastUpdates:this._fastUpdateProcessor.enable(e,this._materialInfoCache,this._context);break;case _s.$.DisableFastUpdates:this._fastUpdateProcessor.disable(e,this._materialInfoCache,this._context);break;case _s.$.UpdateFastLocalOrigin:e.updateFastLocalOrigin(o,l,this._context.localOriginFactory)}const{elevationContext:c}=e;c.centerPointInElevationSR=this._getCenterPointInElevationSR(o);const{elevationProvider:u,renderCoordsHelper:h}=this._context;return e.alignedSampledElevation=it(e,c,u.spatialReference,((e,t)=>(0,v.sE)(e,u,c,h,t)),h,o),e.updateTransform(o,l,this._context.isAsync),e.updateAutoDisableFastTransformUpdates((()=>this.updateTransform(e,t,r,_s.$.DisableFastUpdates))),!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_materialPropertiesDefault(e,t){const r=this._requiresSymbolVertexColors(),i=!!e.vertexAttributes.color,n=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:i,hasVertexTangents:n,uid:`vc:${i},vt:${n},vct${t},svc:${r}`}}_materialProperties(e,t,r){const i=this._materialPropertiesDefault(e,r);if(!t.material)return i;const{color:n,colorTexture:s,colorTextureTransform:o,normalTexture:a,normalTextureTransform:l,doubleSided:c,alphaCutoff:u,alphaMode:h}=t.material,d=bo(n),p=bo(s),f=xo(o),m=bo(a),g=xo(l);if(i.color=n,i.colorTexture=s,i.normalTexture=a,i.uid=`${i.uid},cmuid:${d},ctmuid:${p},cttuid:${f},ntmuid:${m},nttuid:${g},ds:${c},ac:${u},am:${h}`,t.material instanceof fs.A){const{metallic:e,roughness:r,metallicRoughnessTexture:n,metallicRoughnessTextureTransform:s,emissiveColor:a,emissiveTexture:c,emissiveTextureTransform:u,occlusionTexture:h,occlusionTextureTransform:d}=t.material,p=bo(n),f=xo(s),m=bo(a),g=bo(c),y=xo(u),_=bo(h),v=xo(d);i.metallic=e,i.roughness=r,i.metallicRoughnessTexture=n,i.emissiveColor=a,i.emissiveTexture=c,i.occlusionTexture=h,i.colorTextureTransform=yo(o),i.normalTextureTransform=yo(l),i.emissiveTextureTransform=yo(u),i.occlusionTextureTransform=yo(d),i.metallicRoughnessTextureTransform=yo(s),i.uid=`${i.uid},mrm:${e},mrr:${r},mrt:${p},mrtt:${f},emuid:${m},etmuid:${g},ett:${y},otmuid:${_},ott:${v}`}return i}_getInternalTextureId(e){const t=this._getInternalTexture(e,yt.sf.Opaque);return t?.id}_getInternalTexture(e,t){const r=function(e){return e.data??e.url}(e);if(!r)return null;const i=`${e.contentHash}/${t}`;let n=this._textures.get(i);if(!n){let s=null;const o=this._context.stage.renderView.renderingContext.parameters.maxMaxAnisotropy,a={wrap:_o(e.wrap),noUnpackFlip:!0,maxAnisotropy:o,mipmap:o>1};(0,vs.x3)(r)?(s=r.data,a.preMultiplyAlpha=!1,a.encoding=r.encoding):(s=r,a.preMultiplyAlpha=t!==yt.sf.Opaque,a.downsampleUncompressed=this._context.graphicsCoreOwner.view.qualitySettings.graphics3D.uncompressedTextureDownsamplingEnabled),n=new Sn.g(s,a),this._textures.set(i,n),n.load(this._context.stage.renderView.renderingContext),this._context.stage.add(n)}return n}_setInternalMaterialParameters(e,t){if(null!=e.color&&function(e,t){t.diffuse=P.A.toUnitRGB(e),t.opacity=e.a}(e.color,t),null!=e.colorTexture){const r=this._getInternalTexture(e.colorTexture,t.textureAlphaMode);r?(t.textureId=r.id,t.textureAlphaPremultiplied=!!r.parameters.preMultiplyAlpha):t.textureId=void 0}e.normalTexture&&(t.normalTextureId=this._getInternalTextureId(e.normalTexture)),e.emissiveColor&&(t.emissiveFactor=P.A.toUnitRGB(e.emissiveColor)),e.emissiveTexture&&(t.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),e.occlusionTexture&&(t.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),e.metallicRoughnessTexture&&(t.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),t.colorTextureTransformMatrix=(0,bs.G)(e.colorTextureTransform),t.normalTextureTransformMatrix=(0,bs.G)(e.normalTextureTransform);const r=null!=e.normalTextureTransform?.scale?e.normalTextureTransform?.scale:Ir.Un;t.scale=[r[0],r[1]],t.occlusionTextureTransformMatrix=(0,bs.G)(e.occlusionTextureTransform),t.emissiveTextureTransformMatrix=(0,bs.G)(e.emissiveTextureTransform),t.metallicRoughnessTextureTransformMatrix=(0,bs.G)(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){const t=this._drivenProperties.color;let r=this.symbolLayer.material?.colorMixMode??null;if(t)e.externalColor=D.Un;else{const t=this.symbolLayer.material?.color??null;t?e.externalColor=P.A.toUnitRGBA(t):(r=null,e.externalColor=D.Un)}r&&(e.colorMixMode=r),e.castShadows=!!this.symbolLayer.castShadows}_getOrCreateMaterial(e,t){const r=t.material?.color,i=t.material?.colorTexture,n=t.material?.alphaMode,s="blend"===n,o=!("opaque"===n)&&(function(e){const t=e.vertexAttributes.color;if(null==t)return!1;for(let e=3;e<t.length;e+=4)if(255!==t[e])return!0;return!1}(e)||null!=r&&r.a<1||i?.transparent||s),a=this._materialProperties(e,t,o),l=this._materialInfoCache.byUid(a.uid);if(l)return l.material;const c={uid:a.uid,material:null,isComponentTransparent:o,alphaMode:t.material?t.material.alphaMode:"opaque"},u=(0,lo.Jr)({normalTexture:a.normalTexture,metallicRoughnessTexture:a.metallicRoughnessTexture,metallicFactor:a.metallic,roughnessFactor:a.roughness,emissiveTexture:a.emissiveTexture,emissiveFactor:P.A.toUnitRGB(a.emissiveColor),occlusionTexture:a.occlusionTexture}),h={usePBR:this._usePBR(),isSchematic:u,hasVertexColors:a.hasVertexColors,hasSymbolColors:a.hasSymbolVertexColors,hasVertexTangents:a.hasVertexTangents,ambient:m.uY,diffuse:m.Un,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:yt.s2.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};h.mrrFactors=u?[...lo.mX]:[a.metallic,a.roughness,lo.Rk[2]],t.material&&(h.doubleSided=t.material.doubleSided,h.cullFace=t.material.doubleSided?yt.s2.None:yt.s2.Back,h.textureAlphaCutoff=t.material.alphaCutoff),this._setExternalMaterialParameters(h),this._setMaterialTransparentParameter(h,c),this._setInternalMaterialParameters(a,h);const d=new we.$U(h);return c.material=d,this._materialInfoCache.set(a.uid,c),this._context.stage.add(d),d}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,t){e.transparent=this.needsDrivenTransparentPass||t.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,"auto"===t.alphaMode?e.textureAlphaMode=e.transparent?yt.sf.MaskBlend:yt.sf.Opaque:e.textureAlphaMode="opaque"===t.alphaMode?yt.sf.Opaque:"mask"===t.alphaMode?yt.sf.Mask:yt.sf.Blend}_createFaceDebugNormals(e,t){const r=t.length,i=e.spatialReference.isGeographic?20015077/180:1,n=.1*Math.max(e.extent.width*i,e.extent.height*i,e.extent.zmax-e.extent.zmin),s=[],o=[],a=t[0].transformation,l=(0,kr.Ge)((0,jr.vt)(),a);for(let e=0;e<r;e++){const r=t[e].attributes.get(le.r.POSITION);if(!r)continue;const i=r.data,c=r.indices;for(let e=0;e<c.length;e+=3)go(i,c,e,Eo),mo(i,c,e,To,Ao,Co),(0,k.g)(To,To,Ao),(0,k.g)(To,To,Co),(0,k.j)(To,To,1/3),(0,k.h)(To,To,a),s.push(...To),(0,k.t)(Eo,Eo,l),(0,k.n)(Eo,Eo),(0,k.r)(To,To,Eo,n),s.push(...To),o.push(o.length),o.push(o.length)}return s.length?new et.V(this._debugFaceNormalMaterial,[[le.r.POSITION,new $t.n(s,o,3,!0)]],null,Yt.X.Line):null}_createPerVertexDebugVectors(e,t,r,i,n){const s=t.length,o=e.spatialReference.isGeographic?20015077/180:1,a=.1*n*Math.max(e.extent.width*o,e.extent.height*o,e.extent.zmax-e.extent.zmin),l=[],c=[],u=t[0].transformation,h=(0,kr.Ge)((0,jr.vt)(),u);r===le.r.TANGENT&&(0,kr.z0)(h,u);for(let e=0;e<s;e++){const i=t[e],n=i.attributes.get(le.r.POSITION),s=i.attributes.get(r);if(!n||!s)continue;const o=n.data,d=n.indices,p=s.data,f=s.indices;for(let e=0;e<d.length;e++){const t=3*d[e],r=f[e]*s.stride;(0,k.s)(To,o[t+0],o[t+1],o[t+2]),(0,k.h)(To,To,u),l.push(...To),(0,k.s)(Ao,p[r+0],p[r+1],p[r+2]),(0,k.t)(Ao,Ao,h),(0,k.n)(Ao,Ao),(0,k.r)(To,To,Ao,a),l.push(...To),c.push(c.length),c.push(c.length)}}return l.length?new et.V(i,[[le.r.POSITION,new $t.n(l,c,3,!0)]],null,Yt.X.Line):null}_createAs3DShape(e,t,r,i){const n=e.geometry;if("mesh"!==n.type)return null;const s=this._createGeometryInfo(n,t,i);if(null==s)return null;const{geometries:o,objectTransformation:a}=s;if(Qe.b.DRAW_MESH_GEOMETRY_NORMALS){const e=this._createPerVertexDebugVectors(n,o,le.r.NORMAL,this._debugVertexNormalMaterial,1),t=this._createPerVertexDebugVectors(n,o,le.r.TANGENT,this._debugTangentNormalMaterial,.5),r=this._createFaceDebugNormals(n,o);e&&o.push(e),t&&o.push(t),r&&o.push(r)}const l=new Gt.B({geometries:o,layerUid:this._context.layer.uid,graphicUid:i,isElevationSource:!0});l.transformation=a;const c=(0,Se.Cc)(this.symbolLayer,{opacity:this._getLayerOpacity()}),u=c?new vt(o[0].material,[c],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,h=new xs(this,l,o,null,null,it,r,u);this._fastUpdateProcessor.onAddGraphic(),h.needsElevationUpdates=(0,v.Kf)(r.mode),h.useObjectOriginAsAttachmentOrigin=!0,h.fastTransformUpdatesAllowed=this._fastTransformUpdatesAllowed(n),r.centerPointInElevationSR=this._getCenterPointInElevationSR(l.transformation);const{elevationProvider:d,renderCoordsHelper:p}=this._context;return h.alignedSampledElevation=it(h,r,d.spatialReference,((e,t)=>(0,v.sE)(e,d,r,p,t)),p),h}_fastTransformUpdatesAllowed(e){const{vertexSpace:t,spatialReference:r}=e;if(!(0,gs.Hq)(t))return!1;const{type:i}=t,{view:n}=this._context.graphicsCoreOwner,{viewingMode:s}=n.state,o=n.spatialReference;return s===nr.RT.Global&&"local"===i||s===nr.RT.Local&&(0,X.aI)(o,r)&&"georeferenced"===i&&!r.isGeographic}_getCenterPointInElevationSR(e){const t=(0,y.T)(0,0,0,null!=this._context.elevationProvider.spatialReference?this._context.elevationProvider.spatialReference:null);return(0,hs.E)([e[12],e[13],e[14]],this._context.renderCoordsHelper.spatialReference,t),t}_passthroughReprojectionInfo(e){return e.reprojection===Io.NONE&&!!e.objectTransformation}_createPositionBuffer(e,t){const r=e.vertexAttributes.position;let i=r,n=null;if(t.reprojection===Io.NONE)return{position:i,georeferencedPositionBuffer:n};const s=t.reprojection===Io.RENDER?t.transformBeforeProject:null;s&&(i=(0,Zr.a)(new Float64Array(i.length),i,s));const{normal:o,tangent:a}=e.vertexAttributes;this._passthroughReprojectionInfo(t)||!o&&!a||(n=i);const l=i===r||i===n?new Float64Array(i.length):i;return(0,W.projectBuffer)(i,e.spatialReference,0,l,this._context.renderCoordsHelper.spatialReference,0,i.length/3),{position:l,georeferencedPositionBuffer:n}}_createNormalBuffer(e,t,r,i){const n=e.vertexAttributes.normal;if(null==n)return null;let s=n;const o=i.reprojection===Io.RENDER?i.transformBeforeProject:null;o&&(s=(0,ys.qs)(s,new Float32Array(s.length),o));const a=this._context.graphicsCoreOwner.view.viewingMode;if(i.reprojection===Io.NONE)return s;if("local"===a){if(!(0,X.r1)(this._context.renderCoordsHelper.spatialReference))return s;if(null==r)return null;if(e.spatialReference.isGeographic){const e=s===n?new Float32Array(s.length):s;return(0,ys.gZ)(s,ys.OD.NORMAL,r,e)}if(e.spatialReference.isWebMercator){const e=s===n?new Float32Array(s.length):s;return(0,ys.GN)(s,ys.OD.NORMAL,r,e)}return s}if(null==r)return null;const l=s===n?new Float32Array(s.length):s;return(0,ys.X4)(s,r,t,e.spatialReference,l)}_createTangentBuffer(e,t,r,i){const n=e.vertexAttributes.tangent;if(null==n)return null;let s=n;const o=i.reprojection===Io.RENDER?i.transformBeforeProject:null;o&&(s=(0,ys.KM)(s,new Float32Array(s.length),o));const a=this._context.graphicsCoreOwner.view.viewingMode;if(i.reprojection===Io.NONE)return s;if("local"===a){if(!(0,X.r1)(this._context.renderCoordsHelper.spatialReference))return s;if(null==r)return null;if(e.spatialReference.isGeographic){const e=s===n?new Float32Array(s.length):s;return(0,ys.gZ)(s,ys.OD.TANGENT,r,e)}if(e.spatialReference.isWebMercator){const e=s===n?new Float32Array(s.length):s;return(0,ys.GN)(s,ys.OD.TANGENT,r,e)}return s}if(null==r)return null;const l=s===n?new Float32Array(s.length):s;return(0,ys.xA)(s,r,t,e.spatialReference,l)}_createSymbolColorBuffer(e){if(this._requiresSymbolVertexColors()){const t=this._getVertexOpacityAndColor(e),r=(0,Is.Eb)(this.symbolLayer?.material?.colorMixMode),i=new Uint8Array(4);return(0,Is._j)(t,r,i),i}return null}_createBuffers(e,t){const r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const i=e.vertexAttributes.normal,n=e.vertexAttributes.uv,s=e.vertexAttributes.tangent;if(i&&i.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(s&&s.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(n&&n.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const o=this._computeReprojectionInfo(e),{position:a,georeferencedPositionBuffer:l}=this._createPositionBuffer(e,o),c=function(e){return e.vertexAttributes.color}(e),u=this._createSymbolColorBuffer(t),h=this._createNormalBuffer(e,a,l,o),d=this._createTangentBuffer(e,a,l,o),p=n,{transformation:f,position:m,normal:g,tangent:y}=this._passthroughReprojectionInfo(o)?{transformation:o.objectTransformation,position:a,normal:h,tangent:d}:this._transformOriginLocal(e,a,h,d);return{positionBuffer:m,normalBuffer:g,tangentBuffer:y,uvBuffer:p,colorBuffer:c,symbolColorBuffer:u,objectTransformation:f,geometryTransformation:o.reprojection===Io.NONE&&o.geometryTransformation?o.geometryTransformation:(0,Xe.vt)()}}_computeReprojectionInfo(e){const{vertexSpace:t}=e,r="georeferenced"===t.type?(0,X.aI)(this._context.renderCoordsHelper.spatialReference,e.spatialReference)?Io.NONE:Io.RENDER:Io.NONE;if((0,gs.E9)(t))return{reprojection:r};const i=t.origin,n=(0,Xe.vt)(),s=e.transform?.localMatrix??Xe.zK;if(r===Io.NONE)return(0,Je.l)(e.spatialReference,i,n,this._context.renderCoordsHelper.spatialReference),{reprojection:r,objectTransformation:n,geometryTransformation:(0,Xe.o8)(s)};const o=(0,Ye.kN)((0,Xe.vt)(),i);return(0,Ye.lw)(o,o,s),{reprojection:r,transformBeforeProject:o}}_transformOriginLocal(e,t,r,i){const n=this._context.renderCoordsHelper.spatialReference,s=e.anchor;wo[0]=s.x,wo[1]=s.y,wo[2]=s.z??0;const o=(0,Xe.vt)();(0,Je.l)(e.spatialReference,wo,o,n),(0,Ye.B8)(Mo,o);const{position:a,normal:l,tangent:c}=e.vertexAttributes,u=t===a?new Float64Array(t.length):t;(0,Zr.a)(u,t,Mo);const h=r?r===l?new Float32Array(r.length):r:null,d=i?i===c?new Float32Array(i.length):i:null;return r&&h&&(0,ys.qs)(r,h,Mo),i&&d&&(0,ys.KM)(i,d,Mo),{transformation:o,position:u,normal:h,tangent:d}}_validateFaces(e,t){const r=e.vertexAttributes.position.length/3,i=t.faces;if(i){let e=-1;for(let t=0;t<i.length;t++){const r=i[t];r>e&&(e=r)}if(r<=e)return this.logger.warn(`Vertex index ${e} is out of bounds of the mesh position buffer`),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const t=e.vertexAttributes?.position;if(!t)return!1;const r=this._context.elevationProvider.spatialReference,i=(0,ys.project)({positions:t,transform:e.transform,vertexSpace:e.vertexSpace,inSpatialReference:e.spatialReference,outSpatialReference:r??e.spatialReference,localMode:this._context.stage.viewingMode===nr.RT.Local});if(!i)return!1;const n=i.length/3;return(0,$.Ie)(Po),(0,$.Hq)(Po,i,0,n),!(0,$.KG)(Po,this._context.clippingExtent)}_createGeometryInfo(e,t,r){if(!(0,j.canProjectWithoutEngine)(e.spatialReference,this._context.renderCoordsHelper.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(!this._validateVertexSpace(e))return null;if(this._isOutsideClippingArea(e))return null;const i=this._createBuffers(e,t);if(null==i)return null;const{positionBuffer:n,uvBuffer:s,colorBuffer:o,symbolColorBuffer:a,normalBuffer:l,tangentBuffer:c,objectTransformation:u,geometryTransformation:h}=i,d=function(e){return e.components??Oo}(e),p=new Array;let f=!1;const m=(0,Ye.sC)(To,u),g=this._context.localOriginFactory.getOrigin(m);for(const t of d){if(!this._validateFaces(e,t))return null;const i=ho(e,t);if(0===i.length)continue;const u=po(n,l,t,i);u.didFlipNormals&&(f=!0);const d=[[le.r.POSITION,new $t.n(n,i,3,!0)],[le.r.NORMAL,new $t.n(u.normals,u.indices,3,!0)]];o&&d.push([le.r.COLOR,new $t.n(o,i,4,!0)]),a&&d.push([le.r.SYMBOLCOLOR,new $t.n(a,(0,qr.EH)(i.length),4,!0)]),s&&d.push([le.r.UV0,new $t.n(s,i,2,!0)]),c&&d.push([le.r.TANGENT,new $t.n(c,i,4,!0)]);const m=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:r,layerUid:this._context.layer.uid}),y=this._getOrCreateMaterial(e,t),_=new et.V(y,d,null,Yt.X.Mesh,m);_.transformation=h,_.localOrigin=g,p.push(_)}return f&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:p,objectTransformation:u}}_updateMaterialParameters(e){this._materialInfoCache.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachClonedMaterial(((e,t)=>{t.setParameters(e.parameters)}))}_validateVertexSpace(e){const{_context:{graphicsCoreOwner:{view:{state:{viewingMode:t}}}}}=this,{vertexSpace:r}=e;return t!==nr.RT.Local||"local"!==r.type||(this.logger.warn("Displaying a mesh with a local vertex space in a view in local viewing mode is not supported."),!1)}test(){return{...super.test(),materials:this._materialInfoCache.materials}}}}};class Zu extends It{set symbol(e){this._symbol=e,e.symbolLayers.forEach(((t,r)=>{const i=this.symbolLayers[r];null!=i&&(i.symbol=e,i.symbolLayer=t)}))}get symbol(){return this._symbol}constructor(e,t,r){super(t.schedule),this._symbol=e,this._context=t,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let t=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(t=this._backgroundLayers.concat(t));const r=t.length;for(;this.symbolLayers.length<t.length;)this.symbolLayers.push(null);this.symbolLayers.length=t.length;const i=[];for(let n=0;n<r;n++){const s=t.at(n);if(!1===s.enabled)continue;$u.renderPriority=1-(1+n)/r,$u.renderPriorityStep=1/r,$u.ignoreDrivers=s.ignoreDrivers;const o=ju(this.symbol,s,this._context,$u),a=(0,d.NY)(e,(()=>{this.symbolLayers[n]=null,o.destroy()}));a&&i.push(a),this.symbolLayers[n]=o}if(await(0,qe.jJ)(this.symbolLayers,(async(e,t)=>{if(null!=e)try{await e.load(),this._extentPadding+=Math.max(this._extentPadding,e.extentPadding)}catch{this.symbolLayers[t]=null}})),i.forEach((e=>e.remove())),(0,d.Te)(e),this.symbolLayers.length&&!this.symbolLayers.some((e=>!!e)))throw new Error}getSymbolLayerSize(e){const t=this.symbolLayers[e];return null!=t?t.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some((e=>e?.queryForSnapping))}createGraphics3DGraphic(e,t){const r=e.graphic,i=this.symbolLayers.map((t=>t?.createGraphics3DGraphic(e)??null)),n=this._context.arcade||this._context.featureExpressionInfoContext?.arcade?.modules||null;return new Ur(r,t||this,i,e.layer,n)}get complexity(){return Ae(this.symbolLayers.map((e=>null!=e?e.complexity:null)))}globalPropertyChanged(e,t){const r=this.symbolLayers.length;for(let i=0;i<r;i++){const r=this.symbolLayers[i],n=e=>{const t=e.layers[i];return t instanceof bt?t:null};if(null!=r&&!r.globalPropertyChanged(e,t,n))return!1}return!0}applyRendererDiff(e,t){return this.loadStatus!==Mt.LOADED?Et.RecreateSymbol:this.symbolLayers.reduce(((r,i)=>r!==Et.RecreateSymbol&&null!=i?Math.min(r,i.applyRendererDiff(e,t)):r),Et.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===Mt.FAILED)return;if("partial"!==e.diff.type)return;const t=e.diff.diff;if(!t.symbolLayers||"partial"!==t.symbolLayers.type)return;const r=t.symbolLayers.diff;this.symbolLayers.forEach(((t,i)=>{if(null==t)return;const n=r[i];if(n){const r={diff:n,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};t.prepareSymbolLayerPatch(r),e.symbolStatePatches.push(...r.symbolLayerStatePatches),r.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push(((e,t)=>{const n=e.layers[i];null!=n&&r.graphics3DGraphicPatches.forEach((e=>e(n,t)))}))}}))}updateGeometry(e,t){return this._updateGeometryOrTransform(e,((e,r)=>e.updateGeometry(r,t)))}updateTransform(e,t,r,i){return this._updateGeometryOrTransform(e,((e,n)=>e.updateTransform(n,t,r,i)))}_updateGeometryOrTransform(e,t){for(let r=0;r<this.symbolLayers.length;r++){const i=this.symbolLayers[r];if(null==i)continue;const n=e.layers[r];if(!n||!t(i,n))return!1}return!0}onRemoveGraphic(e){for(let t=0;t<this.symbolLayers.length;t++){const r=this.symbolLayers[t];if(null==r)continue;const i=e.layers[t];null!=i&&r.onRemoveGraphic(i)}}getFastUpdateStatus(){let e=0,t=0,r=0;return this.symbolLayers.forEach((i=>{null!=i&&(i.loadStatus===Mt.LOADING?e++:i.isFastUpdatesEnabled()?r++:t++)})),{loading:e,slow:t,fast:r}}async queryForSnapping(e,t,r,i){const n=this.symbolLayers.filter(V.Ru).filter((e=>null!=e.queryForSnapping)).map((n=>n.queryForSnapping(e,t,r,i))),s=await Promise.all(n);return(0,d.Te)(i),s.flat()}destroy(){if(!this.destroyed){super.destroy();for(const e of this.symbolLayers)null!=e&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}}const $u=new class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};class Yu extends Zu{constructor(e,t,r){super(e,t,r),this._calloutSymbolLayer=null,this.symbol.hasVisibleCallout()&&(this._calloutSymbolLayer=function(e,t){if(!(0,Ze.YX)(e))return Er().error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${e.type}' does not support callouts`),null;if(!e.callout)return null;const r=Mr[e.callout.type];return r?new r(e,t):(Er().error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${e.callout.type}`),null)}(this.symbol,t))}async doLoad(e){const t=this._calloutSymbolLayer?(0,qe.Ke)(this._calloutSymbolLayer.load()):null;try{await super.doLoad(e),(0,d.Te)(e)}catch(e){throw this._calloutSymbolLayer?.abortLoad(),e}t&&await t}destroy(){super.destroy(),this._calloutSymbolLayer=(0,s.pR)(this._calloutSymbolLayer)}createGraphics3DGraphic(e,t){const r=super.createGraphics3DGraphic(e,t);if(null!=this._calloutSymbolLayer&&null!=r){const t=this._createCalloutGraphic(e);t&&r.setCalloutGraphic(t)}return r}globalPropertyChanged(e,t){return!!super.globalPropertyChanged(e,t)&&(!this._calloutSymbolLayer||this._calloutSymbolLayer.globalPropertyChanged(e,t,(e=>e.calloutLayer)))}updateGeometry(e,t){const r=super.updateGeometry(e,t);if(r&&this._calloutSymbolLayer){const r=e.calloutLayer;if(r)return this._calloutSymbolLayer.updateGeometry(r,t)}return r}_createCalloutGraphic(e){const t=e.renderingInfo;return e.renderingInfo=new Cr(t.renderer,t.symbol),this._calloutSymbolLayer.createGraphics3DGraphic(e)}}class Xu extends It{constructor(e,t,r){super(t),this.symbol=e,this._convert=r,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return null!=this.graphics3DSymbol?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const t=await this.symbol.fetchSymbol({signal:e});t.id=this.symbol.id,this.graphics3DSymbol=this._convert(t),null!=this.graphics3DSymbol&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return null!=this.graphics3DSymbol?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.complexity:Te}globalPropertyChanged(e,t){return null!=this.graphics3DSymbol&&this.graphics3DSymbol.globalPropertyChanged(e,t)}applyRendererDiff(e,t){return null!=this.graphics3DSymbol?this.graphics3DSymbol.applyRendererDiff(e,t):Et.RecreateSymbol}prepareSymbolPatch(e){null!=this.graphics3DSymbol&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,t){return null!=this.graphics3DSymbol&&this.graphics3DSymbol.updateGeometry(e,t)}updateTransform(e,t,r,i){return this.graphics3DSymbol?.updateTransform(e,t,r,i)??!1}onRemoveGraphic(){}getFastUpdateStatus(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){null!=this.graphics3DSymbol&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return void 0===this.graphics3DSymbol}}class Ju{constructor(e,t,r){this.visible=e,this.missing=t,this.pending=r}}class Qu{constructor(e){this._graphicsCore=e,this._idToState=new Map,this._states=new Set;const t=e.owner.layer?.objectIdField;t?(this._getGraphicId=e=>(0,J.RW)(e,t),this._getGraphics3DGraphicById=e=>this._graphicsCore.getGraphics3DGraphicByObjectId(e)):(this._getGraphicId=e=>e.uid,this._getGraphics3DGraphicById=e=>this._graphicsCore.getGraphics3DGraphicById(e))}destroy(){this._idToState.clear(),this._states.forEach(((e,t)=>this.remove(t)))}add(e){const t=(0,h.hA)((()=>this.remove(e)));if(this._states.has(e))return t;const r=this._getGraphicId(e.graphic),i=this._getGraphics3DGraphicById(r);return this._states.has(e)||this._states.add(e),this._ensureStateList(r).push(e),e.displaying=null!=i&&i.isVisible(),e.isDraped=null!=i&&i.isDraped,e.tracking=!0,null!=i&&e.emit("changed"),t}remove(e){if(this._states.has(e)){if(this._idToState.size){const t=this._getGraphicId(e.graphic),r=this._idToState.get(t);r&&((0,V.TF)(r,e),0===r.length&&this._idToState.delete(t))}this._states.delete(e),e.tracking=!1,e.displaying=!1}}addGraphic(e){this._forEachState(e,(t=>{t.displaying=e.isVisible(),t.isDraped=e.isDraped,t.emit("changed")}))}removeGraphic(e){this._forEachState(e,(e=>{e.displaying=!1,e.isDraped=!1}))}updateGraphicGeometry(e){this._forEachState(e,(e=>e.emit("changed")))}updateGraphicVisibility(e){this._forEachState(e,(t=>t.displaying=e.isVisible()))}allGraphicsDeleted(){this._states.forEach((e=>e.displaying=!1))}_ensureStateList(e){const t=this._idToState.get(e);if(t)return t;const r=new Array;return this._idToState.set(e,r),r}_forEachState(e,t){if(0===this._states.size||0===this._idToState.size)return;const r=this._getGraphicId(e.graphic),i=this._idToState.get(r);null!=i&&i.forEach(t)}}var Ku=r(50612);let eh=class extends T.A{constructor(e){super(e),this._index=new Ku.w(9,(0,l.A)("esri-csp-restrictions")?e=>({minX:e.extent[0],minY:e.extent[1],maxX:e.extent[2],maxY:e.extent[3]}):[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]),this._missing=new Set,this._boundsByFeature=new Map,this.spatialReference=null,this.hasZ=null,this.hasM=null,this.objectIdField=null,this.updating=!1}setup(e){this._addMany(e)}destroy(){this._missing.clear(),this._index=(0,s.pR)(this._index),this._boundsByFeature.clear(),this._boundsByFeature=null}update(){this._missing.size>0&&(this._addMany(Array.from(this._missing.values())),this.updating=!1,this._missing.clear())}get updatingRemaining(){return this._missing.size}queryGraphicUIDsInExtent(e,t,r){null!=t&&t.equals(this.spatialReference)&&(th.minX=e[0],th.minY=e[1],th.maxX=e[2],th.maxY=e[3],this.update(),this._index.search(th,(e=>r(e.graphic.uid))))}add(e){this._missing.add(e),this.updating=!0}remove(e){if(this._missing.delete(e))return void(this.updating=this._missing.size>0);if(!e.extent)return;this._index.remove(e);const t=(0,J.RW)(e.graphic,this._get("objectIdField"));null!=t&&this._boundsByFeature.delete(t)}_addMany(e){if(0===e.length)return;const t=this._get("objectIdField");for(const r of e){r.computeExtent(this.spatialReference);const e=(0,J.RW)(r.graphic,t);null!=e&&this._boundsByFeature.set(e,r.extent)}this._index.load(e)}clear(){this._index.clear(),this._missing.clear(),this._boundsByFeature.clear(),this.updating=!1}forEachInBounds(e,t){th.minX=e[0],th.minY=e[1],th.maxX=e[2],th.maxY=e[3],this.update(),this._index.search(th,(e=>{t(e)}))}getBounds(e,t){this.update();const r=this._boundsByFeature.get(e);return r?(0,$.Jt)(t,r):null}};(0,i._)([(0,a.MZ)({constructOnly:!0})],eh.prototype,"spatialReference",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],eh.prototype,"hasZ",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],eh.prototype,"hasM",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],eh.prototype,"objectIdField",void 0),(0,i._)([(0,a.MZ)()],eh.prototype,"updating",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],eh.prototype,"updatingRemaining",null),eh=(0,i._)([(0,u.$)("esri.views.3d.layers.graphics.SpatialIndex2D")],eh);const th={minX:0,minY:0,maxX:0,maxY:0};var rh=r(32e3);const ih=Symbol("layerHandles");let nh=class extends(ze.A.EventedMixin(T.A)){get spatialReference(){return this.view?.spatialReference}constructor(e){super(e),this._elevationOffset=0}initialize(){this._renderCoordsHelper=this.view.renderCoordsHelper,this._intersectLayers=[this.stageLayer],this._intersector=(0,fa.hz)(this.view.state.viewingMode),this._intersector.options.store=Yo.oH.MIN;const e=this._computeLayerExtent(this.spatialReference,this.stageLayer);this._zmin=e[2],this._zmax=e[5];const t=this.stageLayer.events;this.addHandles([t.on(["layerObjectAdded","layerObjectRemoved","geometryAdded","geometryRemoved"],(({object:e})=>this._objectChanged(e))),t.on("attributesChanged",(({attribute:e,object:t})=>(0,le.b)(e)&&this._objectChanged(t))),t.on(["transformationChanged","shaderTransformationChanged"],(e=>this._objectChanged(e)))],ih)}dispose(){this.removeHandles(ih)}elevationInfoChanged(){const e=null!=this.layer?this.layer.elevationInfo:null;if(null!=e&&"on-the-ground"!==e.mode){const t=(0,Br.G9)(this.layer.spatialReference),r=(0,rh.Ao)(e.unit??"meters");this._elevationOffset=(e.offset??0)*r/t}else this._elevationOffset=0}getElevation(e,t,r,i){if(ah[0]=e,ah[1]=t,ah[2]=r,!this._renderCoordsHelper.toRenderCoords(ah,i,ah))return c.A.getLogger(this).error("could not project point for elevation alignment"),null;const n=this._elevationOffset,s=this._zmin+n,o=this._zmax+n;return this._renderCoordsHelper.setAltitude(lh,o,ah),this._renderCoordsHelper.setAltitude(ch,s,ah),this._intersector.reset(lh,ch,null),this._intersector.intersect(this._intersectLayers,null,1,null,(e=>!!e.lastValidElevationBB)),this._intersector.results.min.getIntersectionPoint(ah)?this._renderCoordsHelper.getAltitude(ah):null}_objectChanged(e){const t=this.spatialReference;if(!e.lastValidElevationBB||!t)return;(0,$.Ie)(sh);const r=e.lastValidElevationBB;r.isEmpty()||this._expandExtent(t,r.min,r.max,sh);const{min:i,max:n}=e.boundingVolumeWorldSpace;this._expandExtent(t,i,n,sh),(0,$.ES)(sh,oh.extent),this._zmin=Math.min(this._zmin,sh[2]),this._zmax=Math.max(this._zmax,sh[5]),oh.spatialReference=t,this.emit("elevation-change",oh),(0,k.c)(r.min,i),(0,k.c)(r.max,n)}_computeLayerExtent(e,t){return(0,$.Ie)(sh),null!=e&&t.objects.forAll((t=>this._expandExtent(e,t.boundingVolumeWorldSpace.min,t.boundingVolumeWorldSpace.max,sh))),sh}_expandExtent(e,t,r,i){for(let n=0;n<8;++n)ah[0]=1&n?t[0]:r[0],ah[1]=2&n?t[1]:r[1],ah[2]=4&n?t[2]:r[2],this._renderCoordsHelper.fromRenderCoords(ah,ah,e),(0,$.iT)(i,ah);return i}};(0,i._)([(0,a.MZ)({constructOnly:!0})],nh.prototype,"layer",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],nh.prototype,"stageLayer",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],nh.prototype,"view",void 0),(0,i._)([(0,a.MZ)()],nh.prototype,"spatialReference",null),nh=(0,i._)([(0,u.$)("esri.views.3d.layers.support.StageLayerElevationProvider")],nh);const sh=(0,$.Ie)(),oh=new class{constructor(e="scene"){this.context=e,this.extent=(0,Y.Ie)()}},ah=(0,m.vt)(),lh=(0,m.vt)(),ch=(0,m.vt)(),uh=(0,m.vt)();var hh,dh=r(96687),ph=r(19860),fh=r(91998),mh=r(1296),gh=r(28088),yh=r(45532),_h=r(56922),vh=r(90972),bh=r(36e3);const xh=(0,m.vt)(),Sh=(0,$.vt)();let wh=hh=class extends T.A{get _viewSpatialReference(){return this.owner.view.spatialReference}get spatialIndex(){return this._spatialIndex||(this._spatialIndex=new eh({objectIdField:this.owner.layer?.objectIdField,spatialReference:this._viewSpatialReference,hasZ:!!this.hasZ,hasM:!!this.hasM}),this._spatialIndex.setup(Array.from(this.graphics3DGraphics.values()))),this._spatialIndex.update(),this._spatialIndex}get deconflictor(){return this._deconflictor}get labeler(){return this._labeler}get numberOfGraphics(){return this._numberOfGraphics}get effectiveUpdatePolicy(){return null!=this.currentRenderer&&"dictionary"===this.currentRenderer.type?fh.q.ASYNC:this._forcedUpdatePolicy??this.preferredUpdatePolicy}get featureStore(){return this._featureStore}get initializePromise(){return this._initializePromise}get scaleVisibility(){return this._scaleVisibility}get elevationAlignment(){return this._elevationAlignment}get objectStates(){return this._objectStates}get filterVisibility(){return this._filterVisibility}get updating(){return!!(this.dataUpdating||this._elevationAlignment?.updating||this._scaleVisibility?.updating||this._filterVisibility?.updating||this._rendererChangeAbortController||this._elevationInfoChangeAbortController||this._frameTaskHandle.updating||this.running)}get dataUpdating(){return!!(this._graphicsWaitingForSymbol.size>0||this._pendingUpdates.size>0||this._spatialIndex?.updating||this._updatingPendingLoadedGraphicsChange||this._dataUpdateQueue.running||this._loadingSymbols>0)}get running(){return this._pendingUpdates.size>0||!!this._spatialIndex?.updating||this._dataUpdateQueue.running||this._updateQueue.running}get suspendedOrOutsideOfView(){return this.owner.suspended||!!this.owner.suspendInfo?.outsideOfView}get updatingRemaining(){return this.updating?this._pendingUpdates.size+.1*(this._spatialIndex?.updatingRemaining||0)+.1*(this._elevationAlignment?.updatingRemaining||0):0}get displayFeatureLimit(){const e=this.owner&&this.owner.view&&this.owner.view.qualitySettings,t=e?.graphics3D.minTotalNumberOfFeatures??0,r=e?.graphics3D.maxTotalNumberOfFeatures??0,i=e?.graphics3D.maxNumberOfDrawCalls??0,n=e?.graphics3D.maxTotalNumberOfVertices??0,s=this.averageSymbolComplexity,o=Math.max(1,s?.verticesPerFeature??1),a=s&&s.drawCallsPerFeature>0&&i>0?i/s.drawCallsPerFeature:r,l=Math.ceil(n/o),c=Math.max(t,Math.min(r,l,a)),u=this._get("displayFeatureLimit");return u&&u.maximumTotalNumberOfVertices===n&&u.averageSymbolComplexity===s&&u.maximumNumberOfFeatures===c?u:new Ie(n,c,s)}get averageSymbolComplexity(){const e=function(e){const t=Ae(e);return t.numComplexities>0&&(t.verticesPerFeature/=t.numComplexities,t.verticesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.resourceBytes/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities),t}(this._symbolComplexities),t=this._get("averageSymbolComplexity");return 0===e.numComplexities||null!=t&&(e.estimated&&(t.verticesPerFeature>=e.verticesPerFeature||t.verticesPerCoordinate>=e.verticesPerCoordinate||t.drawCallsPerFeature>=e.drawCallsPerFeature)||t.verticesPerFeature===e.verticesPerFeature&&t.verticesPerCoordinate===e.verticesPerCoordinate&&t.drawCallsPerFeature===e.drawCallsPerFeature)?t:e}get usedMemory(){const e=null!=this.averageSymbolComplexity&&this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel*this._numberOfGraphics:0,t=this._getSymbolComplexitiesUsed().reduce(((e,t)=>e+t.memory.resourceBytes),0);if(null==this._symbolMaterials){this._symbolMaterials=[];for(const e of this._symbols.values())if(null!=e)for(const t of e.symbolLayers)if(t)for(const e of t.materials)e&&this._symbolMaterials.push(e)}const r=this.owner.view._stage.renderer.plugins,i=this.owner.view.basemapTerrain.overlayManager.renderer,n=this._symbolMaterials.reduce(((e,t)=>e+((r.getMaterialRenderer(t)||i.getMaterialRenderer(t))?.usedMemory??0)),0);return this._usedMemory+e+t+n}get usedMemoryPerGraphic(){if(this._usedMemory&&this._numberOfGraphics){const e=this._numberOfGraphics/(this._numberOfGraphics+Math.max(this._pendingAdds,this._pendingRemoves));return this._usedMemory/this._numberOfGraphics*e}if(null!=this.averageSymbolComplexity){const e=this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel:0;return this.averageSymbolComplexity.memory.bytesPerFeature+e}return 0}get unprocessedMemoryEstimate(){return(this._pendingAdds-this._pendingRemoves)*this.usedMemoryPerGraphic}get _symbolComplexities(){return this.currentRenderer?this._getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this._getSymbolComplexitiesUsed()}get visible(){return this._visible}_getConvertedSymbol(e){if("web-style"===e.type)return e.clone();const t=this._symbolConversionCache.get(e.id);if(null!=t)return t;const r=(0,K.t)(e,{geometryType:this.layer?.geometryType??void 0,retainId:!0,hasLabelingContext:this._hasLabelingContext(e),cimFallbackEnabled:!0}),i=r.symbol||null;return null==i&&r.error&&c.A.getLogger(this).error(r.error.message),this._symbolConversionCache.set(e.id,i),i}_getSymbolComplexitiesUsedOrRenderer(e){if(null==e)return[];const t=e.getSymbols(),r="backgroundFillSymbol"in e?e.backgroundFillSymbol:null;if(!r&&!t?.length)return[];const i=[],n=this._getSymbolComplexityUsedOrRenderer(r);null!=n&&i.push(n);for(const e of t){const t=this._getSymbolComplexityUsedOrRenderer(e);null!=t&&i.push(t)}return i}_getSymbolComplexityUsedOrRenderer(e){if(null==e)return null;const t=this._symbols.get(e.id);if(null!=t)return t.complexity;const r=this._getConvertedSymbol(e);return null!=r?function(e){return"web-style"===e.type?Te:Ae(e.symbolLayers.toArray().map((t=>Ee(e,t))))}(r):null}_getSymbolComplexitiesUsed(){const e=[];return this._symbols.forEach((t=>{null!=t&&e.push(t.complexity)})),e}get _objectIdField(){return this.layer.objectIdField}constructor(e){super(e),this._propertiesPool=new dh.M({computedExtent:Jr.default},this),this.computedExtent=null,this.currentRenderer=null,this.rendererHasGeometryOperations=!1,this._graphicStateTracking=null,this.graphics3DGraphics=new Map,this.stageLayer=null,this.stage=null,this._graphicsDrapedUids=new Set,this._graphicsBySymbol=new Map,this._symbolConversionCache=new Map,this._symbols=new Map,this._graphicsWithoutSymbol=new Map,this._graphicsWaitingForSymbol=new Map,this._graphicsUpdateId=0,this._frameTaskHandle=De.nu,this._dataUpdateQueue=new Q.T,this._updateQueue=new Q.T,this._suspendSymbolCleanup=!1,this._arcadeOnDemand=null,this._rendererChangeAbortController=null,this._elevationInfoChangeAbortController=null,this._initializeAbortController=null,this._elevationAlignment=null,this._scaleVisibility=null,this._filterVisibility=null,this._spatialIndex=null,this.extentPadding=0,this._updatingPendingLoadedGraphicsChange=null,this._featureStore=null,this._deconflictor=null,this._labeler=null,this._objectStates=null,this._viewElevationProvider=null,this._stageLayerElevationProvider=null,this._sharedSymbolResourcesOwnerHandle=null,this._whenGraphics3DGraphicRequests={},this._pendingUpdates=new Map,this._numberOfGraphics=0,this._numberOfGraphicsProvidingElevation=0,this._pendingAdds=0,this._pendingRemoves=0,this._applyPendingRemovesFirst=!1,this._loadingSymbols=0,this._pendingUpdatesPool=new B.A({allocator:e=>e||new Ah,deallocator:e=>(e.clear(),e)}),this._symbolWarningLogged=!1,this._geometryWarningLogged=!1,this._objectIdInvisibleSet=new Set,this._whenSymbolRemoved=new B.A,this.preferredUpdatePolicy=fh.q.SYNC,this._forcedUpdatePolicy=null,this.elevationFeatureExpressionEnabled=!0,this.owner=null,this.layer=null,this.graphicSymbolSupported=!0,this.getRenderingInfoWithoutRenderer=!1,this.setUidToIdOnAdd=!0,this.hasZ=null,this.hasM=null,this._usedMemory=0,this._visible=!1,this._startCreateGraphics=!1,this._unusedSymbolsCache=e.owner.view.resourceController.memoryController.newCache("graphics-3d-unused-symbols",(e=>e.destroy())),this.symbolCreationContext=new We(e.owner.view.resourceController.scheduler,((e,t)=>this._updateQueue.push(e,t)))}initialize(){this._featureStore=new He({objectIdField:this.owner.layer?.objectIdField,hasZ:!!this.hasZ,hasM:!!this.hasM,viewSpatialReference:this._viewSpatialReference,featureSpatialReference:this.owner.featureSpatialReference,getSpatialIndex:()=>this.spatialIndex,forEach:e=>this.graphics3DGraphics.forEach(e)});const e=(e,t,r)=>this.spatialIndex.queryGraphicUIDsInExtent(e,t,r),{componentFactories:t}=this;this._elevationAlignment=t.elevationAlignment?.(this,e),this._scaleVisibility=t.scaleVisibility?.(this,e),this._filterVisibility=t.filterVisibility?.({featureStore:this._featureStore,getFeatureCount:()=>this.graphics3DGraphics.size,updateFeatureVisibilities:e=>this.modifyGraphics3DGraphicVisibilities((t=>t.setVisibilityFlag(Ne.GRAPHIC,Le.FILTER,e((0,J.RW)(t.graphic,this._objectIdField))))),setAllFeaturesVisibility:e=>this.modifyGraphics3DGraphicVisibilities((t=>t.setVisibilityFlag(Ne.GRAPHIC,Le.FILTER,e))),clearFeaturesVisibility:()=>this.modifyGraphics3DGraphicVisibilities((e=>e.setVisibilityFlag(Ne.GRAPHIC,Le.FILTER,!0)))}),this._deconflictor=t.deconflictor?.(this),this._labeler=t.labeler?.(this,this._scaleVisibility),this._objectStates=t.objectStates?.(this),this._initializeAbortController=new AbortController,this._initializePromise=this._initializeAsync()}async _initializeAsync(){const e=this._initializeAbortController?.signal,t=this.owner.view;this._viewElevationProvider=new Fe(this._viewSpatialReference,t),this._initializeStage(t,this.layer.uid);const r=t.sharedSymbolResources;this.symbolCreationContext.sharedResources=r,this._sharedSymbolResourcesOwnerHandle=r.addGraphicsOwner(this.owner),null!=this.currentRenderer&&(this.symbolCreationContext.renderer=this.currentRenderer),this.symbolCreationContext.stage=this.stage,this.symbolCreationContext.streamDataRequester=r.streamDataRequester,this.symbolCreationContext.renderCoordsHelper=t.renderCoordsHelper,this.symbolCreationContext.layer=this.layer,this.symbolCreationContext.graphicsCoreOwner=this.owner,this.symbolCreationContext.localOriginFactory=new ph.g(t.renderSpatialReference),this.symbolCreationContext.elevationProvider=t.elevationProvider,this.symbolCreationContext.notifyGraphicGeometryChanged=e=>this.notifyGraphicGeometryChanged(e),this.symbolCreationContext.notifyGraphicVisibilityChanged=e=>this.notifyGraphicVisibilityChanged(e);const i=(0,x.MF)(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);if(this.symbolCreationContext.featureExpressionInfoContext=await(0,x.q6)(i,this._viewSpatialReference,e,c.A.getLogger(this)),(0,d.Te)(e),this.symbolCreationContext.screenSizePerspectiveEnabled=t.screenSizePerspectiveEnabled&&!!this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.symbolCreationContext.physicalBasedRenderingEnabled=!!this.owner.view.qualitySettings?.physicallyBasedRenderingEnabled,this.symbolCreationContext.skipHighSymbolLods=!!this.owner.view.qualitySettings?.graphics3D?.skipHighSymbolLods,"drapeSourceType"in this.owner){const{owner:e}=this;this.symbolCreationContext.drapeSourceRenderer=t.basemapTerrain.overlayManager.registerGeometryDrapeSource(e),this.addHandles((0,h.hA)((()=>t.basemapTerrain.overlayManager.unregisterDrapeSource(e))))}this.addHandles([(0,o.watch)((()=>this.suspendedOrOutsideOfView),(()=>this._updateQueue.unshift((()=>this._updateLayerVisibility()),null).catch(d.QZ))),(0,o.watch)((()=>[this.layer?.screenSizePerspectiveEnabled,this.owner.view?.screenSizePerspectiveEnabled]),(()=>{const e=t.screenSizePerspectiveEnabled&&!!this.layer.screenSizePerspectiveEnabled;e!==this.symbolCreationContext.screenSizePerspectiveEnabled&&(this.symbolCreationContext.screenSizePerspectiveEnabled=e,this._labeler?.reset(),this.recreateAllGraphicsAndSymbols())})),(0,o.watch)((()=>this.owner.slicePlaneEnabled),(e=>this._slicePlaneEnabledChange(!!e))),(0,o.watch)((()=>this.owner.view.state?.rasterPixelRatio),(()=>this._pixelRatioChange())),(0,o.watch)((()=>!!this.owner.view.qualitySettings?.physicallyBasedRenderingEnabled),(e=>this._physicalBasedRenderingChange(e))),(0,o.watch)((()=>!!this.owner.view.qualitySettings?.graphics3D?.skipHighSymbolLods),(e=>this._skipHighSymbolLoDsChange(e))),(0,o.when)((()=>t.basemapTerrain?.tilingScheme),(e=>{if(e.spatialReference.equals(this.symbolCreationContext.overlaySR)||null==t.basemapTerrain.spatialReference||(this.symbolCreationContext.overlaySR=t.basemapTerrain.spatialReference),this.hasHandles("loaded-graphics"))this.recreateAllGraphics();else{const e=()=>this.owner?.loadedGraphics;this.addHandles([(0,o.on)(e,"change",(e=>{this._graphicsCollectionChanged(e),this._signalUpdatingDuringAsyncLoadedGraphicsChange()}),{onListenerAdd:()=>{this.recreateAllGraphics(),this._signalUpdatingDuringAsyncLoadedGraphicsChange()}})],"loaded-graphics")}}),{initial:!0}),(0,o.watch)((()=>this.effectiveUpdatePolicy),(e=>{null!=this.stageLayer&&(this.stageLayer.updatePolicy=e),this.symbolCreationContext.isAsync=this.effectiveUpdatePolicy===fh.q.ASYNC,e===fh.q.SYNC&&this.runTask(De.Bb)}),o.pc)]),this._frameTaskHandle=t.resourceController.scheduler.registerTask(De.W6.GRAPHICS_CORE,this),this.layer&&"featureReduction"in this.layer&&this.addHandles((0,o.watch)((()=>this.layer.featureReduction),(()=>this._deconflictor?.featureReductionChange()))),this.notifyChange("averageSymbolComplexity"),this.rendererChange(this.owner.renderer).catch((()=>{})),this._initializeAbortController=null}_abortInitialize(){this._initializeAbortController&&(this._initializeAbortController.abort(),this._initializeAbortController=null)}destroy(){this._unusedSymbolsCache.destroy(),this._abortInitialize(),this._abortRendererChange(),this._abortElevationInfoChange(),this._frameTaskHandle.remove(),this._frameTaskHandle=De.nu,this._dataUpdateQueue.cancelAll(),this._updateQueue.cancelAll(),this._deconflictor=(0,s.xt)(this._deconflictor),this._labeler=(0,s.xt)(this._labeler),this._elevationAlignment=(0,s.pR)(this._elevationAlignment),this._scaleVisibility=(0,s.pR)(this._scaleVisibility),this._filterVisibility=(0,s.pR)(this._filterVisibility),this._objectStates=(0,s.pR)(this._objectStates),this.clear(),this._featureStore=(0,s.pR)(this._featureStore),this._updatingPendingLoadedGraphicsChange=(0,s.xt)(this._updatingPendingLoadedGraphicsChange),this._graphicStateTracking=(0,s.pR)(this._graphicStateTracking),this.stage&&(this.stageLayer=(0,s.pR)(this.stageLayer),this.stage=null),this._set("owner",null);for(const e in this._whenGraphics3DGraphicRequests)this._whenGraphics3DGraphicRequests[e].reject(new n.A("graphic:layer-destroyed","Layer has been destroyed"));this._whenGraphics3DGraphicRequests=null,this._sharedSymbolResourcesOwnerHandle=(0,s.xt)(this._sharedSymbolResourcesOwnerHandle),this._propertiesPool=(0,s.pR)(this._propertiesPool),this._pendingUpdatesPool=null,this._symbolConversionCache.clear(),this._objectIdInvisibleSet.clear(),this._spatialIndex=(0,s.pR)(this._spatialIndex)}clear(){this._objectStates?.allGraphicsDeleted(),null!=this._graphicStateTracking&&this._graphicStateTracking.allGraphicsDeleted(),this.graphics3DGraphics.forEach((e=>e.destroy())),this._spatialIndex?.clear(),this.graphics3DGraphics.clear(),this._numberOfGraphics=0,this._usedMemory=0,this._updateLayerVisibility(),this._symbols.forEach(s.pR),this._symbols.clear(),this._symbolMaterials=null,this._graphicsBySymbol.clear(),this._graphicsWithoutSymbol.clear(),this._graphicsWaitingForSymbol.clear(),this._pendingUpdates.clear(),this._pendingUpdatesPool.clear(),this._pendingAdds=0,this._pendingRemoves=0,this._applyPendingRemovesFirst=!1,this.notifyChange("dataUpdating"),this.notifyChange("running"),this.notifyChange("updatingRemaining"),this._featureStore.events.emit("changed")}_initializeStage(e,t){this.stage=e._stage,this.stageLayer=new mh.x(this.stage,{pickable:!this.suspendedOrOutsideOfView,updatePolicy:this.effectiveUpdatePolicy},t);const r=this.stageLayer.events;r.on("transformationChanged",(e=>this.notifyGraphicGeometryChanged(e.graphicUid))),r.on("shaderTransformationChanged",(e=>this.notifyGraphicGeometryChanged(e.graphicUid))),r.on("visibilityChanged",(e=>this.notifyGraphicVisibilityChanged(e.graphicUid))),r.on("geometryAdded",(e=>this.notifyGraphicGeometryChanged(e.object.graphicUid))),r.on("geometryRemoved",(e=>this.notifyGraphicGeometryChanged(e.object.graphicUid))),r.on("attributesChanged",(e=>(0,le.b)(e.attribute)&&this.notifyGraphicGeometryChanged(e.object.graphicUid)))}notifyGraphicGeometryChanged(e){if(null==this._graphicStateTracking||null==e)return;const t=this.graphics3DGraphics.get(e);t&&this._graphicStateTracking.updateGraphicGeometry(t)}notifyGraphicVisibilityChanged(e){if(null==this._graphicStateTracking||null==e)return;const t=this.graphics3DGraphics.get(e);t&&this._graphicStateTracking.updateGraphicVisibility(t)}_updateLayerVisibility(){const e=this.displayFeatureLimit.maximumNumberOfFeatures,t=this._numberOfGraphics>e*Ch,r=!this.suspendedOrOutsideOfView&&!t;r!==this._visible&&(this._visible=r,r?(this.stageLayer.pickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.pickable=!1,this._hideAllGraphics()),this._updateStageLayerVisibility())}_updateStageLayerVisibility(){this.stageLayer.visible=this._visible&&(null==this.layer.opacity||this.layer.opacity>0)}getGraphics3DGraphicById(e){return null!=e?this.graphics3DGraphics.get(e):void 0}getGraphics3DGraphicByObjectId(e){return this.owner.layer?.objectIdField?this._findGraphics3DGraphicByObjectId(e):null}_getGraphicObjectID(e,t=this.owner.layer?.objectIdField){return(0,J.RW)(e,t)}get graphics3DGraphicsByObjectID(){const e=this.owner.layer?.objectIdField;if(!e)return;const t=new Map;return this.graphics3DGraphics.forEach((r=>{if(!r)return;const i=r.graphic,n=this._getGraphicObjectID(i,e);null!=n&&t.set(n,r)})),t}get labelsEnabled(){return!!this._labeler?.layerLabelsEnabled()}async updateLabelingInfo(e){const t=this._deconflictor?.labelingInfoChange(e),r=this._labeler?.labelingInfoChange(e);await Promise.allSettled([t,r])}updateVisibilityInfo(){this._deconflictor?.labelingInfoChange(),this._labeler?.visibilityInfoChange()}get symbolUpdateType(){if(this._pendingUpdates.size>0)return"unknown";let e=0,t=0;return(0,U.Bs)(this._symbols,((r,i)=>{if(null!=r){const n=r.getFastUpdateStatus();if(n.loading>0)return!0;this._graphicsBySymbol.has(i)&&(t+=n.fast,e+=n.slow)}return!1}))?"unknown":t>=0&&0===e?"fast":e>=0&&0===t?"slow":"mixed"}runTask(e){if(this._dataUpdateQueue.runTask(e),this._updateQueue.runTask(e),this._applyPendingUpdates(e),this.notifyChange("running"),this.running||this.notifyChange("dataUpdating"),this.notifyChange("updatingRemaining"),!e.hasProgressed)return lu.G}setObjectIdVisibility(e,t){t?this._objectIdInvisibleSet.delete(e):this._objectIdInvisibleSet.add(e);const r=this._findGraphics3DGraphicByObjectId(e);null!=r&&this._updateUserVisibility(r)}_findGraphics3DGraphicByObjectId(e){return(0,U.$n)(this.graphics3DGraphics,(t=>this._getGraphicObjectID(t.graphic)===e))}_updateUserVisibility(e){if(null==e)return!1;const t=e.graphic,r=this._getGraphicObjectID(t),i=t.visible&&!this.owner.suspended&&(null==r||!this._objectIdInvisibleSet.has(r));return e.setVisibilityFlag(Ne.GRAPHIC,Le.USER,i)}_whenGraphics3DGraphic(e){const t=this.graphics3DGraphics.get(e.uid);if(t)return Promise.resolve(t);const r=this._whenGraphics3DGraphicRequests[e.uid];if(r)return r.promise;const i=(0,d.Tw)();return this._whenGraphics3DGraphicRequests[e.uid]=i,i.promise}async _boundsForGraphics3DGraphic(e,t){const r=this._viewSpatialReference,i=this.owner.view.renderSpatialReference,n=this.owner.view.basemapTerrain.spatialReference,s=this._viewElevationProvider?{service:this._viewElevationProvider,useViewElevation:null!=t&&!!t.useViewElevation,minDemResolution:null!=t?t.minDemResolution:null,minDemResolutionForPoints:this.owner.view.resolution}:null,o=await e.getProjectedBoundingBox(((e,t,n)=>(0,W.projectBuffer)(e,i,t,e,r,t,n)),((e,t,i)=>(0,W.projectBuffer)(e,n,t,e,r,t,i)),s,t?.signal);if(!o)return null;const a=o.boundingBox;if(o.requiresDrapedElevation){const e=this.symbolCreationContext.elevationProvider;if(e){(0,$.gX)(a,xh);const t=e.getElevation(xh[0],xh[1],0,r,"ground")??0;a[2]=Math.min(a[2],t),a[5]=Math.max(a[5],t)}}return{boundingBox:a,screenSpaceObjects:o.screenSpaceObjects}}async whenGraphicBounds(e,t){await(0,o.C_)((()=>this.owner?.loadedGraphics));const r=this.owner.layer?.objectIdField,i=this.owner.loadedGraphics.find((t=>t===e||null!=r&&null!=t.attributes&&e.attributes&&t.attributes[r]===e.attributes[r]));if(!i)throw new n.A("internal:graphic-not-part-of-view","Graphic is not part of this view");const s=await this._whenGraphics3DGraphic(i);return this._boundsForGraphics3DGraphic(s,t)}computeAttachmentOrigin(e,t){const r=this.graphics3DGraphics.get(e.uid);if(!r)return null;const i=r.computeAttachmentOrigin();if(0===i.render.num&&0===i.draped.num)return null;(0,k.s)(Eh,0,0,0);let n=0;if(i.render.num>0){if(!(0,q.F)(i.render.origin,this.symbolCreationContext.renderCoordsHelper.spatialReference,Mh,t))return null;(0,k.g)(Eh,Eh,Mh),n++}if(i.draped.num>0){const[e,r]=i.draped.origin,s=this._viewElevationProvider.getElevation(e,r,"ground")??0;if((0,k.s)(Mh,e,r,s),!(0,q.F)(Mh,this._viewElevationProvider.spatialReference,Mh,t))return null;(0,k.g)(Eh,Eh,Mh),n++}return n>1&&(0,k.j)(Eh,Eh,1/n),new yh.default({x:Eh[0],y:Eh[1],z:Eh[2],spatialReference:t})}getSymbolLayerSize(e,t){const r=this._symbols.get(e.id);if(null==r)throw new n.A("internal:symbol-not-part-of-view","Symbol is not part of this view");const i=e.symbolLayers.indexOf(t);if(-1===i)throw new n.A("internal:missing-symbol-layer","Symbol layer is not in symbol");const s=r.getSymbolLayerSize(i);if(null==s)throw new n.A("internal:missing-size","Symbol layer has no valid size");return s}_graphicsCollectionChanged(e){this._startCreateGraphics&&(this.add(e.added),this.remove(e.removed))}graphicUpdateHandler(e){const t=e.graphic.uid,r=this.graphics3DGraphics.get(t);if(null!=r||null!=this._graphicsWithoutSymbol.get(t))switch(e.property){case"visible":this._graphicUpdateVisibleHandler(r);break;case"geometry":this._graphicUpdateGeometryHandler(r,e);break;case"symbol":this._graphicUpdateSymbolHandler(r,e);break;case"attributes":break;case"origin-transform":this._graphicUpdateTransformHandler(r,e)}}_graphicUpdateGeometryHandler(e,t){this._graphicUpdateGeometryOrTransformHandler(e,t,(()=>!(null==t.newValue||null==e||!e.graphics3DSymbol.updateGeometry(e,t.newValue)||!(this._labeler?.updateGraphicGeometry(e)??1)||(this._labeler?.setDirty(),0))));const r=t.graphic.geometry;null!=r&&this._expandComputedExtent(r)}_graphicUpdateTransformHandler(e,t){const r=t.graphic.geometry;this._graphicUpdateGeometryOrTransformHandler(e,t,(()=>null!=t.newValue&&null!=e&&null!=r&&e.graphics3DSymbol.updateTransform(e,r.spatialReference,t.newValue,t.action)))}_graphicUpdateGeometryOrTransformHandler(e,t,r){if(null!=t.graphic.geometry)if(null!=e)r()||this._recreateGraphic(e.graphic);else{const e=t.graphic.symbol?.id;if(e){const t=this._symbols.get(e);if(null!=t&&t.loadStatus===Mt.LOADING)return}this._recreateGraphic(t.graphic)}else this._recreateGraphic(t.graphic)}_graphicUpdateSymbolHandler(e,t){const r=t.graphic,i=null!=e?e.graphics3DSymbol:null!=t.oldValue?this._symbols.get(t.oldValue.id):null;if(null==i||null==t.newValue)return void this._recreateGraphic(r);const n=i.symbol,s=this._getConvertedSymbol(t.newValue);if(null!=s&&(s.type!==n.type||"web-style"===s.type)||"web-style"===n.type)return void this._recreateGraphic(r);const o=this._graphicsBySymbol.get(n.id);if(o&&1!==o.size)return void this._recreateGraphic(r);const a=(0,C.Ui)(n,s);if(null==a)return void this._updateSymbolMapping(n.id,s);const l={diff:a,graphics3DGraphicPatches:[],symbolStatePatches:[]};if(i.prepareSymbolPatch(l),!(0,C.Im)(l.diff))return void this._recreateGraphic(r);const c=this._getRenderingInfo(r);if(null==c)return void this._recreateGraphic(r);const u=i.extentPadding;for(const e of l.symbolStatePatches)e();if(u!==i.extentPadding&&this._recomputeExtentPadding(),null!=e)for(const t of l.graphics3DGraphicPatches)t(e,c);this._updateSymbolMapping(n.id,s)}_graphicUpdateVisibleHandler(e){this._updateUserVisibility(e)&&(this._labeler?.setDirty(),this._deconflictor?.setDirty())}recreateGraphics(e){this._suspendSymbolCleanup=!0,this.remove(e),this.add(e),this._suspendSymbolCleanup=!1,this.effectiveUpdatePolicy===fh.q.SYNC&&this._cleanupSymbols()}_recreateGraphic(e){this.recreateGraphics([e])}_beginGraphicUpdate(e){const t=this._graphicsUpdateId;return this._graphicsUpdateId++,this._graphicsWaitingForSymbol.set(e.uid,t),1===this._graphicsWaitingForSymbol.size&&this.notifyChange("dataUpdating"),t}_endGraphicUpdate(e){e&&(this._graphicsWaitingForSymbol.delete(e.uid),0===this._graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("dataUpdating")))}_recomputeExtentPadding(){let e=0;this._symbols.forEach((t=>{null!=t&&(e=Math.max(e,t.extentPadding))})),this._set("extentPadding",e)}_expandComputedExtent(e){const t=Sh,r=e.spatialReference;(0,J.w9)(e,t);const i=this._viewSpatialReference,n=hh.tmpVec;if((0,X.aI)(r,i)||(0,Z.L)(t[0],t[1],0,r,n,i)&&(t[0]=n[0],t[1]=n[1],(0,Z.L)(t[3],t[4],0,r,n,i),t[3]=n[0],t[4]=n[1]),!(isFinite(t[0])&&isFinite(t[3])&&isFinite(t[1])&&isFinite(t[4])))return;const s=this.computedExtent;let o=null;const a=isFinite(t[2])&&isFinite(t[5]),l=a&&(null==s?.zmin||t[2]<s.zmin),c=a&&(null==s?.zmax||t[5]>s.zmax);s?(t[0]<s.xmin||t[1]<s.ymin||t[3]>s.xmax||t[4]>s.ymax||l||c)&&(o=this._propertiesPool.get("computedExtent"),o.xmin=Math.min(t[0],s.xmin),o.ymin=Math.min(t[1],s.ymin),o.xmax=Math.max(t[3],s.xmax),o.ymax=Math.max(t[4],s.ymax),o.spatialReference=i):(o=this._propertiesPool.get("computedExtent"),o.xmin=t[0],o.ymin=t[1],o.xmax=t[3],o.ymax=t[4],o.spatialReference=i),o&&(l&&(o.zmin=t[2]),c&&(o.zmax=t[5]),this._set("computedExtent",o))}_abortElevationInfoChange(){this._elevationInfoChangeAbortController&&(this._elevationInfoChangeAbortController.abort(),this._elevationInfoChangeAbortController=null)}async elevationInfoChange(){this._abortElevationInfoChange();const e=new AbortController;this._elevationInfoChangeAbortController=e;const t=(0,x.MF)(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=await(0,x.q6)(t,this._viewSpatialReference,e.signal,c.A.getLogger(this)),(0,d.Te)(e.signal),this._elevationInfoChangeAbortController=null,this._labeler?.elevationInfoChange(),this.forEachGraphics3DSymbol(((e,t,r)=>{e.globalPropertyChanged("elevationInfo",t)?t.forEach((e=>{const t=e.graphic,r=e.labelLayers;for(const e of r)e.graphics3DSymbolLayer.updateGraphicElevationContext(t,e)})):this._recreateSymbol(r)})),this.updateStageLayerElevationProvider(),this._elevationAlignment?.elevationInfoChange()}updateStageLayerElevationProvider(){this._stageLayerElevationProvider?(this.layer.elevationInfo&&"relative-to-scene"===this.layer.elevationInfo.mode||0===this._numberOfGraphicsProvidingElevation)&&(this.owner.view.elevationProvider.unregister(this._stageLayerElevationProvider),this._stageLayerElevationProvider=(0,s.WD)(this._stageLayerElevationProvider)):(!this.layer.elevationInfo||this.layer.elevationInfo&&"relative-to-scene"!==this.layer.elevationInfo.mode)&&this._numberOfGraphicsProvidingElevation>0&&(this._stageLayerElevationProvider=new nh({layer:this.layer,stageLayer:this.stageLayer,view:this.owner.view}),this.owner.view.elevationProvider.register("scene",this._stageLayerElevationProvider))}_clearSymbolsAndGraphics(){this.clear(),null!=this._filterVisibility&&this._filterVisibility.clear(),this._labeler?.reset(),this._deconflictor?.clear(),this._elevationAlignment?.clear(),this.stageLayer?.invalidateSpatialQueryAccelerator(),this._stageLayerElevationProvider&&(this.owner.view.elevationProvider.unregister(this._stageLayerElevationProvider),this._stageLayerElevationProvider=(0,s.WD)(this._stageLayerElevationProvider))}startCreateGraphics(){this._startCreateGraphics=!0,this.recreateAllGraphics()}recreateAllGraphics(){this._recreateAllGraphics(!1)}recreateAllGraphicsAndSymbols(){this._recreateAllGraphics(!0)}_recreateAllGraphics(e=!1){if(!this._startCreateGraphics)return;const{loadedGraphics:t,view:r}=this.owner,i=r.basemapTerrain.tilingScheme&&t?.length?t.toArray():null;!e&&i||this._clearSymbolsAndGraphics(),this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&!!this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this._set("computedExtent",null),i&&(e?this.add(i):this.recreateGraphics(i))}_recreateSymbol(e){const t=this._graphicsBySymbol.get(e),r=[];t&&(t.forEach(((e,t)=>{const i=e.usedMemory;this._conditionalRemove(e,t),this._spatialIndex?.remove(e),r.push(e.graphic),e.destroy(),this._removeGraphics3DGraphic(t,i),this._updateLayerVisibility(),this._featureStore.events.emit("changed")})),this._graphicsBySymbol.set(e,new Map));const i=this._symbols.get(e);(0,s.pR)(i),this._symbols.delete(e),this._symbolMaterials=null,this.add(r)}_recreateGraphicsForSymbol(e){const t=this._graphicsBySymbol.get(e);if(t){const e=[];t.forEach((t=>e.push(t.graphic))),this.recreateGraphics(e)}}_conditionalRemove(e,t){this._graphicsDrapedUids.delete(t),this._objectStates?.removeGraphic(e),this._labeler?.removeGraphic(e),this._deconflictor?.removeGraphic(e),null!=this._graphicStateTracking&&this._graphicStateTracking.removeGraphic(e)}add(e){e&&0!==e.length&&(this.owner.view.basemapTerrain?.tilingScheme?(this._updatePolicyForGraphics(e)===fh.q.ASYNC?this._addDelayed(e):this._addImmediate(e),this.notifyChange("dataUpdating")):c.A.getLogger(this).error("#add()","Cannot add graphics before terrain surface has been initialized"))}_updatePolicyForGraphics(e){if(this.effectiveUpdatePolicy===fh.q.SYNC&&("mesh"===this.layer.geometryType||null==this.layer.geometryType))for(const t of e)if(null!=t.geometry&&"mesh"===t.geometry.type&&!t.geometry.loaded)return fh.q.ASYNC;return this.effectiveUpdatePolicy}_addImmediate(e){this._geometryWarningLogged=!1,this._symbolWarningLogged=!1;for(const t of e)this._addGraphic(t,this._getRenderingInfo(t,c.A.getLogger(this)),fh.q.SYNC);this._cleanupSymbols(),this._labeler?.setDirty(),this._deconflictor?.setDirty()}_addDelayed(e){for(const t of e){const e=t.uid;let r=this._pendingUpdates.get(e);r?r.add?r.state!==Th.NEW&&r.abortController?.abort():this._pendingAdds++:(r=this._pendingUpdatesPool.pushNew(),this._pendingAdds++,this._pendingUpdates.set(e,r)),r.add=t}this.notifyChange("running"),this.notifyChange("updatingRemaining"),this.notifyChange("dataUpdating")}remove(e){this.effectiveUpdatePolicy===fh.q.ASYNC?this._removeDelayed(e):this._removeImmediate(e),this.notifyChange("dataUpdating")}_removeImmediate(e){for(const t of e)this._removeGraphic(t);this._cleanupSymbols(),this._labeler?.setDirty(),this._deconflictor?.setDirty()}_removeDelayed(e){for(const t of e){const e=t.uid,r=this._pendingUpdates.get(e);if(r)r.add&&(r.remove?r.add=null:this._pendingUpdates.delete(e),r.state===Th.LOADING&&r.abortController?.abort(),this._pendingAdds--);else{const r=this._pendingUpdatesPool.pushNew();r.remove=t,this._pendingUpdates.set(e,r),this._pendingRemoves++,this._applyPendingRemovesFirst=!0}}0===this._pendingUpdates.size&&this._finishPendingUpdates(),this.notifyChange("running"),this.notifyChange("updatingRemaining"),this.notifyChange("dataUpdating")}_finishPendingUpdates(){this._pendingUpdatesPool.clear(),this._cleanupSymbols(),(this._pendingAdds||this._pendingRemoves)&&c.A.getLogger(this).warn("pendingAdds/Removes in inconsistent state!"),this._pendingAdds=0,this._pendingRemoves=0,this._applyPendingRemovesFirst=!1}_applyPendingUpdates(e){if(this._geometryWarningLogged=!1,this._symbolWarningLogged=!1,0===this._pendingUpdates.size&&this._spatialIndex?.updating)return this._spatialIndex.update(),void e.madeProgress();if(this._applyPendingRemovesFirst){this._applyPendingRemovesFirst=!1;for(const[t,r]of this._pendingUpdates){if(e.done){this._applyPendingRemovesFirst=!0;break}if(r.remove&&!r.add&&(this._pendingRemoves--,e.madeProgress(),this._removeGraphic(r.remove),r.remove=null,this._pendingUpdates.delete(t),0===this._pendingRemoves))break}}for(const[t,r]of this._pendingUpdates){if(e.done)break;r.add&&r.state===Th.NEW&&this._processPendingUpdateNew(r);let i=this.effectiveUpdatePolicy;if(!r.remove||r.add&&r.state!==Th.READY||(this._pendingRemoves--,e.madeProgress(),this._removeGraphic(r.remove),r.remove=null,i=fh.q.SYNC),r.add)switch(r.state){case Th.READY:this._addGraphic(r.add,r.renderingInfo,i),r.add=null,this._pendingAdds--,e.madeProgress();break;case Th.REJECTED:r.add=null,this._pendingAdds--;case Th.LOADING:}null==r.remove&&null==r.add&&this._pendingUpdates.delete(t)}0===this._pendingUpdates.size&&(this._finishPendingUpdates(),this.notifyChange("running"),this.notifyChange("dataUpdating"))}_processPendingUpdateNew(e){if(!e.add)return void(e.state=Th.READY);const t=e.add.geometry;null==t||"mesh"!==t.type||t.loaded?this._processPendingUpdateNewRenderingInfo(e):this._processPendingUpdateNewMesh(e,t)}async _processPendingUpdateNewMesh(e,t){e.state=Th.LOADING,e.abortController=new AbortController;const r=e.abortController.signal;try{await t.load({signal:r})}catch(t){return this._processPendingUpdateNewError(e,t)}e.abortController=null,this._processPendingUpdateNewRenderingInfo(e)}_processPendingUpdateNewError(e,t){e.abortController=null,(0,d.zf)(t)?e.state=Th.NEW:e.state=Th.REJECTED}async _processPendingUpdateNewRenderingInfo(e){if(null==this.layer.renderer||"dictionary"!==this.layer.renderer.type)return e.renderingInfo=this._getRenderingInfo(e.add,c.A.getLogger(this)),void(e.state=Th.READY);e.state=Th.LOADING,e.abortController=new AbortController;let t=null;try{t=await this._getRenderingInfoAsync(e.add,{signal:e.abortController.signal})}catch(t){return e.abortController=null,void((0,d.zf)(t)?e.state=Th.NEW:e.state=Th.REJECTED)}null==t?.symbol?(this._symbolWarningLogged||(this._symbolWarningLogged=!0,c.A.getLogger(this).warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),e.renderingInfo=null):e.renderingInfo=t,e.state=Th.READY}_addGraphic(e,t,r){if(this._graphicsWithoutSymbol.set(e.uid,e),null==t?.symbol||!(0,J.N3)(e))return;if(null!=this.stage.renderView.objectAndLayerIdRenderHelper&&this.setUidToIdOnAdd){const t=(0,ie.ns)(this.owner.view.map,this.layer.uid);this.stage.renderView.objectAndLayerIdRenderHelper.setUidToObjectAndLayerId(e.objectId,e.uid,this.layer.id,this.layer.uid,!!this.layer.popupEnabled&&!t&&(0,gh.d0)(this.layer,this.owner.view.popup?.defaultPopupTemplateEnabled))}const i=t.symbol,n=this.getOrCreateGraphics3DSymbol(i,t.renderer);if(null==n)return;this._expandComputedExtent(e.geometry);const s=this._beginGraphicUpdate(e),o=new je(e,t,this.layer);let a=!1;const l=e=>{e===n.symbol.id&&(a=!0)};this._whenSymbolRemoved.push(l);const c=()=>{if(--this._loadingSymbols,!this.destroyed){if(this._whenSymbolRemoved.removeUnordered(l),this._graphicsWaitingForSymbol.get(e.uid)!==s||a||n.destroyed||this.graphicSymbolSupported&&e.symbol&&e.symbol.id!==n.symbol.id)--n.referenced,this._cleanupSymbols();else{const t=this._createGraphics3DGraphic(n,o);this._spatialIndex&&null!=t&&this._spatialIndex.add(t),--n.referenced,this._endGraphicUpdate(e)}this._featureStore.events.emit("changed"),this._labeler?.setDirty()}},u=t=>{--this._loadingSymbols,this.destroyed||(this._whenSymbolRemoved.removeUnordered(l),a||((0,d.zf)(t)?this.add([e]):n.destroyed||this._endGraphicUpdate(e)))};++this._loadingSymbols,r===fh.q.ASYNC?n.load((()=>this._dataUpdateQueue.push(c,null).catch(d.QZ)),(e=>this._dataUpdateQueue.push((()=>u(e)),null).catch(d.QZ))):n.load(c,u)}_removeGraphic(e){const t=e.uid,r=this.graphics3DGraphics.get(t);if(r){r.graphics3DSymbol.onRemoveGraphic(r);const e=r.usedMemory,i=r.isElevationSource;this._conditionalRemove(r,t),this._spatialIndex?.remove(r);const n=r.graphics3DSymbol.symbol.id;this._graphicsBySymbol.get(n)?.delete(t),this._graphicsWithoutSymbol.delete(t),this._removeGraphics3DGraphic(t,e,i),r.destroy(),this._featureStore.events.emit("changed")}else this._graphicsWithoutSymbol.delete(t),this._graphicsWaitingForSymbol.delete(t),0===this._graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("dataUpdating"))}_hasLabelingContext(e){if(e instanceof _h.A||e instanceof vh.A){const t=this.symbolCreationContext.layer;return!!t.labelingInfo&&t.labelingInfo.some((t=>t.symbol===e))}return!1}_hasValidSymbolCreationContext(e){return!(e instanceof _h.A&&!this._hasLabelingContext(e)&&(c.A.getLogger(this).error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),1))}_getRenderingInfo(e,t){const r=e.geometry;if(null==r)return t&&!this._geometryWarningLogged&&(this._geometryWarningLogged=!0,t.warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),null;if(!(0,j.canProjectWithoutEngine)(r.spatialReference,this._viewSpatialReference))return t&&!this._geometryWarningLogged&&(this._geometryWarningLogged=!0,t.warn(`Graphic in layer ${this.layer.id} has incompatible spatial reference and will not render`)),null;if(!this.graphicSymbolSupported&&null!=e.symbol)return t&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,t.warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),null;const i=this.rendererHasGeometryOperations?(0,R.wP)(e,this.layer):e;let n;return n=this.owner.getRenderingInfo&&(this.getRenderingInfoWithoutRenderer||null!=this.currentRenderer)?this.owner.getRenderingInfo(i,this.currentRenderer,this._arcadeOnDemand):{symbol:i.symbol||(0,ne.dX)(i.geometry)},null==n?.symbol?(t&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,t.warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),null):n}_getRenderingInfoAsync(e,t){if(null==e.geometry)return this._geometryWarningLogged||(this._geometryWarningLogged=!0,c.A.getLogger(this).warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),null;if(!this.graphicSymbolSupported&&null!=e.symbol)return this._symbolWarningLogged||(this._symbolWarningLogged=!0,c.A.getLogger(this).warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),null;const r=this.rendererHasGeometryOperations?(0,R.wP)(e,this.layer):e;return this.owner.getRenderingInfoAsync(r,this.currentRenderer,this._arcadeOnDemand,t)}_createGraphics3DSymbol(e,t){if(!this._hasValidSymbolCreationContext(e))return null;const r=this._getConvertedSymbol(e);if(!r)return null;let i;if(null!=t&&"backgroundFillSymbol"in t&&t.backgroundFillSymbol){const e=(0,K.t)(t.backgroundFillSymbol,{ignoreDrivers:!0});null!=e.symbol&&(i=e.symbol.symbolLayers)}const n=function(e,t,r){return"point-3d"===e.type?new Yu(e,t,r):new Zu(e,t,r)}(r,this.symbolCreationContext,i);return n.load((()=>{const e=n.extentPadding;e>this.extentPadding&&this._set("extentPadding",e),this.notifyChange("averageSymbolComplexity")}),(()=>{})),n}getOrCreateGraphics3DSymbol(e,t){let r=this._symbols.get(e.id);if(void 0===r){const i=this._unusedSymbolsCache.pop(e.id);r=null!=i?i:e instanceof bh.A?new Xu(e,(e=>this._dataUpdateQueue.push(e,null)),(e=>this._createGraphics3DSymbol(e,t))):this._createGraphics3DSymbol(e,t),this._symbols.set(e.id,r),this._symbolMaterials=null}return null!=r&&++r.referenced,r}trackGraphicState(e){return null==this._graphicStateTracking&&(this._graphicStateTracking=new Qu(this)),this._graphicStateTracking.add(e)}_addGraphics3DGraphic(e){this._usedMemory+=e.usedMemory,this.graphics3DGraphics.set(e.graphic.uid,e),this._numberOfGraphics++,e.isElevationSource&&(this._numberOfGraphicsProvidingElevation++,this.updateStageLayerElevationProvider()),this._updateLayerVisibility()}_removeGraphics3DGraphic(e,t,r=!1){this._usedMemory-=t,this.graphics3DGraphics.delete(e),this._numberOfGraphics--,r&&(this._numberOfGraphicsProvidingElevation--,this.updateStageLayerElevationProvider()),this._updateLayerVisibility()}_createGraphics3DGraphic(e,t){const r=t.graphic;if(this._graphicsWithoutSymbol.delete(r.uid),!this._symbols.has(e.symbol.id))return this.add([r]),null;if(this.graphics3DGraphics.has(r.uid))return null;const i=e.createGraphics3DGraphic(t);if(null==i)return null;this._addGraphics3DGraphic(i);const n=e.symbol.id;if(this._graphicsBySymbol.has(n)||this._graphicsBySymbol.set(n,new Map),this._graphicsBySymbol.get(n).set(r.uid,i),i.isDraped&&this._graphicsDrapedUids.add(r.uid),i.centroid=null,null!=r.geometry&&"point"!==r.geometry.type&&(i.centroid=(0,gt.W$)(r.geometry,this._viewSpatialReference)),this._updateUserVisibility(i),null!=this._scaleVisibility&&this._scaleVisibility.updateVisibility(i),null!=this._filterVisibility){const{defaultVisibility:e}=this._filterVisibility;i.setVisibilityFlag(Ne.GRAPHIC,Le.FILTER,e),e||this._filterVisibility.reapply()}this._deconflictor?.addGraphic(i),this._labeler?.addGraphic(i),this._objectStates?.addGraphic(i),i.initialize(this.stageLayer,this.owner),null!=this._graphicStateTracking&&this._graphicStateTracking.addGraphic(i);const s=this._whenGraphics3DGraphicRequests[r.uid];return s&&(delete this._whenGraphics3DGraphicRequests[r.uid],s.resolve(i)),this._symbolMaterials=null,i}_abortRendererChange(){this._rendererChangeAbortController&&(this._rendererChangeAbortController.abort(),this._rendererChangeAbortController=null)}async rendererChange(e){if(this._abortRendererChange(),e!==this.currentRenderer)if(this._validateRenderer(e),null==e&&this._currentRendererChange(null,!1),ee(e))if(e?.arcadeRequired){const t=new AbortController;this._rendererChangeAbortController=t;const{arcadeUtils:r}=await this._ensureArcade();(0,d.Te)(t);const i=r.hasGeometryOperations(e);i&&(await r.enableGeometryOperations(),(0,d.Te)(t)),this.effectiveUpdatePolicy===fh.q.ASYNC?await this._updateQueue.push((()=>this._currentRendererChange(e,i)),t.signal):this._currentRendererChange(e,i),this._rendererChangeAbortController=null}else if(this.effectiveUpdatePolicy===fh.q.ASYNC){const t=new AbortController;this._rendererChangeAbortController=t,await this._updateQueue.push((()=>this._currentRendererChange(e,!1)),t.signal),this._rendererChangeAbortController=null}else this._currentRendererChange(e,!1);else this._currentRendererChange(e,!1)}async _ensureArcade(){return null==this._arcadeOnDemand?(this._arcadeOnDemand=await(0,re.lw)(),this._arcadeOnDemand):this._arcadeOnDemand}_currentRendererChange(e,t){this.currentRenderer=e,this.rendererHasGeometryOperations=t,this.symbolCreationContext.arcade=this._arcadeOnDemand;const r=this.symbolCreationContext.renderer;if(e===r)return;if(this._symbolConversionCache.clear(),this._unusedSymbolsCache.clear(),null==e)return this.symbolCreationContext.renderer=null,void this.recreateAllGraphicsAndSymbols();const i=(0,C.Ui)(r,e);this._updateUnchangedSymbolMappings(i,e,r),this.symbolCreationContext.renderer=e,null!=i&&("complete"===i.type?this.recreateAllGraphicsAndSymbols():"partial"===i.type&&(this._applyRendererDiff(i,e,r)?this._labeler?.reset():this.recreateAllGraphicsAndSymbols()),this.notifyChange("averageSymbolComplexity"))}_diffHasSymbolChange(e){for(const t in e.diff)switch(t){case"visualVariables":case"defaultSymbol":case"uniqueValueInfos":break;case"uniqueValueGroups":case"authoringInfo":case"fieldDelimiter":delete e.diff[t];break;default:return!0}return!1}_applySymbolSetDiff(e,t,r){e=e||[],t=t||[];const i=[];for(const n of t){const t=this._graphicsBySymbol.get(n.id);t&&t.forEach(((s,o)=>{const a=s.graphic,l=this.layer instanceof M.A?this.layer:null,c=this._arcadeOnDemand;if(n===r.defaultSymbol&&r.getSymbol((0,R.wP)(a,l),{arcade:c})===r.defaultSymbol)return;const u=s.usedMemory;e.length||r.defaultSymbol?i.push(a):this._graphicsWithoutSymbol.set(o,a);const h=this.graphics3DGraphics.get(o);this._conditionalRemove(h,o),s.destroy(),t.delete(o),this._removeGraphics3DGraphic(o,u),this._updateLayerVisibility()})),this._whenSymbolRemoved.forAll((e=>e(n.id)))}(e.length||i.length)&&(this._graphicsWithoutSymbol.forEach((e=>i.push(e))),this._graphicsWithoutSymbol.clear(),this.add(i)),this._cleanupSymbols(),this._labeler?.setDirty(),this._deconflictor?.setDirty()}_applyUniqueValueRendererDiff(e,t,r){const i=e.diff.defaultSymbol,n=e.diff.uniqueValueInfos;if(i||n){const s=n?n.added.map((e=>e.symbol)).filter(V.Ru):[],o=n?n.removed.map((e=>e.symbol)).filter(V.Ru):[];if(n)for(let e=0;e<n.changed.length;e++)s.push(n.changed[e].newValue.symbol),o.push(n.changed[e].oldValue.symbol);return i?(r.defaultSymbol&&o.push(r.defaultSymbol),t.defaultSymbol&&s.push(t.defaultSymbol)):r.defaultSymbol&&s.length&&o.push(t.defaultSymbol),this._applySymbolSetDiff(s,o,t),delete e.diff.defaultSymbol,delete e.diff.uniqueValueInfos,!0}return!1}_calculateUnchangedSymbolMapping(e,t,r){if("unique-value"!==t?.type||"unique-value"!==r?.type||null!=e&&"partial"!==e.type)return[];const i=e=>null!=e?e.id:null,n=e&&e.diff,s=n?.defaultSymbol,o=n&&n.uniqueValueInfos;let a;if(o)a=o.unchanged.map((e=>({oldId:i(e.oldValue.symbol),newId:i(e.newValue.symbol)})));else{a=[];for(const e of r.uniqueValueInfos??[]){const r=i(e.symbol),n=t.uniqueValueInfos?.find((t=>t.value===e.value));n&&r!==i(n.symbol)&&a.push({oldId:r,newId:i(n.symbol)})}}return!s&&r.defaultSymbol&&a.push({oldId:i(r.defaultSymbol),newId:i(t.defaultSymbol)}),a}_updateSymbolMapping(e,t){const r=null!=t&&t?"string"==typeof t?t:t.id:null;if(null==e||e===r)return;const i=this._graphicsBySymbol.get(e);this._graphicsBySymbol.delete(e),void 0!==i&&this._graphicsBySymbol.set(r,i);const n=this._symbols.get(e);if(void 0!==n&&(this._symbols.delete(e),this._symbols.set(r,n),this._symbolMaterials=null,null!=n)){const e="string"==typeof t?null:t;null!=e?n.symbol=e:n.symbol.id=r}}_updateUnchangedSymbolMappings(e,t,r){const i=this._calculateUnchangedSymbolMapping(e,t,r);for(const{oldId:e,newId:t}of i)this._updateSymbolMapping(e,t)}_applyRendererDiff(e,t,r){if(this._diffHasSymbolChange(e))return!1;if(t instanceof z.A&&r instanceof z.A&&this._applyUniqueValueRendererDiff(e,t,r)&&0===Object.keys(e.diff).length)return!0;for(const[r]of this._graphicsBySymbol){const i=this._symbols.get(r);if(null!=i)switch(i.applyRendererDiff(e,t)){case Et.RecreateSymbol:this._recreateSymbol(r);break;case Et.RecreateGraphics:this._recreateGraphicsForSymbol(r);case Et.FastUpdate:}}return!0}opacityChange(){this.forEachGraphics3DSymbol(((e,t)=>e.globalPropertyChanged("opacity",t))),this._updateStageLayerVisibility()}_slicePlaneEnabledChange(e){e!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=e,this.stageLayer.sliceable=e,this.forEachGraphics3DSymbol(((e,t)=>e.globalPropertyChanged("slicePlaneEnabled",t))),this._deconflictor?.slicePlaneEnabledChange(),this._labeler?.slicePlaneEnabledChange())}_physicalBasedRenderingChange(e){this.symbolCreationContext.physicalBasedRenderingEnabled=e,this.forEachGraphics3DSymbol(((e,t,r)=>{e.globalPropertyChanged("physicalBasedRenderingEnabled",t)||this._recreateSymbol(r)}))}_skipHighSymbolLoDsChange(e){this.symbolCreationContext.skipHighSymbolLods=e,this.forEachGraphics3DSymbol(((e,t,r)=>{e.globalPropertyChanged("skipHighSymbolLods",t)||this._recreateSymbol(r)}))}_pixelRatioChange(){this.forEachGraphics3DSymbol(((e,t,r)=>{e.globalPropertyChanged("pixelRatio",t)||this._recreateSymbol(r)}))}_signalUpdatingDuringAsyncLoadedGraphicsChange(){this._updatingPendingLoadedGraphicsChange&&this._updatingPendingLoadedGraphicsChange.remove(),this._updatingPendingLoadedGraphicsChange=(0,H._)((()=>{this._updatingPendingLoadedGraphicsChange=null}))}setClippingExtent(e,t){const r=this.symbolCreationContext.clippingExtent,i=(0,Y.vt)();return function(e,t,r){if(null==e||null==r)return!1;let i=!0;return uh[0]=null!=e.xmin?e.xmin:0,uh[1]=null!=e.ymin?e.ymin:0,uh[2]=null!=e.zmin?e.zmin:0,i=i&&(0,W.projectBuffer)(uh,e.spatialReference,0,uh,r,0,1),t[0]=uh[0],t[1]=uh[1],uh[0]=null!=e.xmax?e.xmax:0,uh[1]=null!=e.ymax?e.ymax:0,uh[2]=null!=e.zmax?e.zmax:0,i=i&&(0,W.projectBuffer)(uh,e.spatialReference,0,uh,r,0,1),t[2]=uh[0],t[3]=uh[1],null==e.xmin&&(t[0]=-1/0),null==e.ymin&&(t[1]=-1/0),null==e.xmax&&(t[2]=1/0),null==e.ymax&&(t[3]=1/0),i}(e,i,t)?this.symbolCreationContext.clippingExtent=(0,$.Jt)((0,$.vt)(),i):this.symbolCreationContext.clippingExtent=null,!(0,$.aI)(this.symbolCreationContext.clippingExtent,r)}modifyGraphics3DGraphicVisibilities(e){if(this.destroyed)return;let t=!1;this.graphics3DGraphics.forEach((r=>{e(r)&&(t=!0)})),t&&(this._labeler?.setDirty(),this._deconflictor?.setDirty())}forEachGraphics3DSymbol(e){for(const[t,r]of this._symbols){if(null==r)return;e(r,this._graphicsBySymbol.get(t)||Rh,t)}}updateAllGraphicsVisibility(){null!=this._filterVisibility&&this._filterVisibility.reapply(),this.modifyGraphics3DGraphicVisibilities((e=>{const t=this._updateUserVisibility(e),r=null!=this._scaleVisibility&&this._scaleVisibility.updateVisibility(e);return t||r}))}_hideAllGraphics(){this.modifyGraphics3DGraphicVisibilities((e=>e.setVisibilityFlag(Ne.GRAPHIC,Le.USER,!1)))}_validateRenderer(e){const t=()=>`'${this.layer.title?`${this.layer.title}, `:""}id:${this.layer.id}'`,r=function(e,t){if(null==e)return null;if(!ee(e))return new n.A("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${e.type||e.declaredClass}'`,{renderer:e});switch(e.type){case"simple":return function(e,t){const r={...K.c,...t,cimFallbackEnabled:!0};return te(e,(0,K.t)(e.symbol,r).error)}(e,t);case"unique-value":return function(e,t){const r={...K.c,...t,cimFallbackEnabled:!0},i=e.uniqueValueInfos?.map((e=>(0,K.t)(e.symbol,r).error)).filter(V.Ru),n=(0,K.t)(e.defaultSymbol,r);return n.error&&i?.unshift(n.error),te(e,i)}(e,t);case"class-breaks":return function(e,t){const r={...K.c,...t,cimFallbackEnabled:!0},i=e.classBreakInfos.map((e=>(0,K.t)(e.symbol,r).error)).filter(V.Ru),n=(0,K.t)(e.defaultSymbol,r);return n.error&&i.unshift(n.error),te(e,i)}(e,t);case"dictionary":case"heatmap":return null}return null}(e,{geometryType:this.layer?.geometryType,logWarning:e=>c.A.getLogger(this).warn(`Symbology conversion for layer ${t()}: ${e}`)});if(r){const e=`Renderer for layer ${t} is not supported in a SceneView`;c.A.getLogger(this).warn(e,r.message)}}_cleanupSymbols(){if(this._graphicsWaitingForSymbol.size>0||this._suspendSymbolCleanup)return;let e=!1;this._symbols.forEach(((t,r)=>{if(null==t||t.referenced>0)return;const i=this._graphicsBySymbol.get(r);i&&0!==i.size||(this._graphicsBySymbol.delete(r),this._symbols.delete(r),this._symbolMaterials=null,this._unusedSymbolsCache.put(r,t,function(e){return 2216+4096*e.symbolLayers.length+e.complexity.memory.resourceBytes}(t),G.Ti),e=!0)})),e&&(this._recomputeExtentPadding(),this.notifyChange("averageSymbolComplexity"))}get test(){}get performanceInfo(){return new Ju(this.graphics3DGraphics.size,this._graphicsWithoutSymbol.size,this._pendingUpdates.size)}};var Th;wh.tmpVec=(0,m.vt)(),(0,i._)([(0,a.MZ)({readOnly:!0})],wh.prototype,"computedExtent",void 0),(0,i._)([(0,a.MZ)()],wh.prototype,"currentRenderer",void 0),(0,i._)([(0,a.MZ)()],wh.prototype,"rendererHasGeometryOperations",void 0),(0,i._)([(0,a.MZ)()],wh.prototype,"_frameTaskHandle",void 0),(0,i._)([(0,a.MZ)()],wh.prototype,"_dataUpdateQueue",void 0),(0,i._)([(0,a.MZ)()],wh.prototype,"_updateQueue",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],wh.prototype,"_viewSpatialReference",null),(0,i._)([(0,a.MZ)()],wh.prototype,"_rendererChangeAbortController",void 0),(0,i._)([(0,a.MZ)()],wh.prototype,"_elevationInfoChangeAbortController",void 0),(0,i._)([(0,a.MZ)()],wh.prototype,"_initializeAbortController",void 0),(0,i._)([(0,a.MZ)()],wh.prototype,"_elevationAlignment",void 0),(0,i._)([(0,a.MZ)()],wh.prototype,"_scaleVisibility",void 0),(0,i._)([(0,a.MZ)()],wh.prototype,"_filterVisibility",void 0),(0,i._)([(0,a.MZ)()],wh.prototype,"_initializePromise",void 0),(0,i._)([(0,a.MZ)()],wh.prototype,"_spatialIndex",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],wh.prototype,"extentPadding",void 0),(0,i._)([(0,a.MZ)()],wh.prototype,"_updatingPendingLoadedGraphicsChange",void 0),(0,i._)([(0,a.MZ)()],wh.prototype,"_featureStore",void 0),(0,i._)([(0,a.MZ)()],wh.prototype,"_objectStates",void 0),(0,i._)([(0,a.MZ)()],wh.prototype,"_loadingSymbols",void 0),(0,i._)([(0,a.MZ)()],wh.prototype,"preferredUpdatePolicy",void 0),(0,i._)([(0,a.MZ)()],wh.prototype,"_forcedUpdatePolicy",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],wh.prototype,"effectiveUpdatePolicy",null),(0,i._)([(0,a.MZ)({constructOnly:!0})],wh.prototype,"elevationFeatureExpressionEnabled",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],wh.prototype,"owner",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],wh.prototype,"layer",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],wh.prototype,"graphicSymbolSupported",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],wh.prototype,"getRenderingInfoWithoutRenderer",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],wh.prototype,"componentFactories",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],wh.prototype,"setUidToIdOnAdd",void 0),(0,i._)([(0,a.MZ)()],wh.prototype,"featureStore",null),(0,i._)([(0,a.MZ)()],wh.prototype,"initializePromise",null),(0,i._)([(0,a.MZ)()],wh.prototype,"scaleVisibility",null),(0,i._)([(0,a.MZ)()],wh.prototype,"elevationAlignment",null),(0,i._)([(0,a.MZ)()],wh.prototype,"objectStates",null),(0,i._)([(0,a.MZ)()],wh.prototype,"filterVisibility",null),(0,i._)([(0,a.MZ)({readOnly:!0})],wh.prototype,"updating",null),(0,i._)([(0,a.MZ)({readOnly:!0})],wh.prototype,"dataUpdating",null),(0,i._)([(0,a.MZ)({readOnly:!0})],wh.prototype,"running",null),(0,i._)([(0,a.MZ)({readOnly:!0})],wh.prototype,"suspendedOrOutsideOfView",null),(0,i._)([(0,a.MZ)({readOnly:!0,dependsOn:[]})],wh.prototype,"updatingRemaining",null),(0,i._)([(0,a.MZ)({readOnly:!0})],wh.prototype,"displayFeatureLimit",null),(0,i._)([(0,a.MZ)({readOnly:!0,dependsOn:[]})],wh.prototype,"averageSymbolComplexity",null),(0,i._)([(0,a.MZ)({constructOnly:!0})],wh.prototype,"hasZ",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],wh.prototype,"hasM",void 0),(0,i._)([(0,a.MZ)()],wh.prototype,"_objectIdField",null),wh=hh=(0,i._)([(0,u.$)("esri.views.3d.layers.graphics.Graphics3DCore")],wh),function(e){e[e.NEW=0]="NEW",e[e.LOADING=1]="LOADING",e[e.READY=2]="READY",e[e.REJECTED=3]="REJECTED"}(Th||(Th={}));class Ah{constructor(){this.add=null,this.renderingInfo=null,this.state=Th.NEW,this.abortController=null,this.remove=null}clear(){this.add=null,this.renderingInfo=null,this.state=Th.NEW,this.abortController=null,this.remove=null}}const Ch=10,Eh=(0,m.vt)(),Mh=(0,m.vt)(),Rh=new Map;class Ph{constructor(){this._extents=new B.A({allocator:e=>e||(0,Y.vt)()}),this._tmpExtent=(0,Y.vt)(),this._dirty=!1}get empty(){return 0===this._extents.length}get size(){return this._extents.length}clear(){this._extents.clear()}add(e){this._contains(e)||(this._removeContained(e),(0,Y.C)(this._extents.pushNew(),e),this._dirty=!0)}pop(){return this._dirty&&this._mergeTight(),this._extents.pop()}merge(e){return this._mergeTight(e),e.hasProgressed}_mergeTight(e=De.Bb){const t=this._extents,r=new Set;let i=0;for(;i!==t.length;){t.sort(((e,t)=>e[0]-t[0])),i=t.length,r.clear();for(let i=0;i<t.length;++i){if(e.done)return;const n=t.at(i);if(n){for(let e=i+1;e<t.length;++e){const i=t.at(e);if(null==i||i[0]>=n[2])break;r.add(i)}r.forEach((i=>{if(n===i)return;if(i[2]<=n[0])return void r.delete(i);const s=(0,Y.Wc)(n),o=(0,Y.Wc)(i),a=this._tmpExtent;(0,Y.fT)(n,i,a);const l=s+o;((0,Y.Wc)(a)-l)/l<.05&&((0,Y.C)(n,a),r.delete(i),t.remove(i),e.madeProgress())})),r.add(n)}}}this._dirty=!1}_contains(e){return this._extents.some((t=>(0,Y.gR)(t,e)))}_removeContained(e){this._extents.filterInPlace((t=>!(0,Y.gR)(e,t)))}get test(){}}let Oh=class extends T.A{constructor(e){super(e),this._dirtyExtents=new Ph,this._globalDirty=!1,this._averageExtentUpdateSize=0,this._dirtyGraphicsSet=new Set,this._updateElevation=!1,this.graphicsCoreOwner=null,this.graphicsCore=null,this.events=new ze.A}initialize(){const e=this.elevationProvider,t=this.graphicsCoreOwner.view.resourceController.scheduler;this._task=t.registerTask(Ih(this.graphicsCore.layer.elevationInfo?.mode),this),this.addHandles([e.on("elevation-change",(e=>this._elevationChanged(e))),(0,o.watch)((()=>this.graphicsCoreOwner.suspended),(()=>this._suspendedChange())),this._task,(0,o.watch)((()=>Ih(this.graphicsCore.layer.elevationInfo?.mode)),(e=>this._task.priority=e))])}destroy(){this._dirtyGraphicsSet.clear(),this.graphicsCoreOwner=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null,this.elevationProvider=null}clear(){this._dirtyGraphicsSet.clear(),this.notifyChange("updating")}_suspendedChange(){!0===this.graphicsCoreOwner.suspended?this._updateElevation=!1:!1===this.graphicsCoreOwner.suspended&&this._updateElevation&&(this._globalDirty=!0,this.notifyChange("updating"))}elevationInfoChange(){this._globalDirty=!0,this.notifyChange("updating")}get updating(){return this.running}get running(){return this._dirtyGraphicsSet.size>0||this._dirtyExtents&&!this._dirtyExtents.empty||this._globalDirty}get updatingRemaining(){return this._dirtyGraphicsSet.size+this._dirtyExtents.size*this._averageExtentUpdateSize}runTask(e){for(this._globalDirty&&(this._markAllGraphicsElevationDirty(),this._globalDirty=!1,e.madeProgress()),e.run((()=>this._dirtyExtents.merge(e)));this.running&&!e.done;)this._updateDirtyGraphics(e),this._updateDirtyExtents(e);this.notifyChange("updating")}_updateDirtyGraphics(e){const t=this.graphicsCoreOwner.view.renderCoordsHelper,r=this.graphicsCore.effectiveUpdatePolicy===fh.q.ASYNC;for(const i of this._dirtyGraphicsSet.keys()){const n=this.graphicsCore.getGraphics3DGraphicById(i);if(this._dirtyGraphicsSet.delete(i),null!=n&&(n.alignWithElevation(this.elevationProvider,t,r),this.graphicsCore.deconflictor?.setDirty(),e.madeProgress()),e.done)return}}_updateDirtyExtents(e){for(;!this._dirtyExtents.empty&&!e.done;){const t=this._dirtyExtents.pop(),r=this.elevationProvider.spatialReference;this.events.emit("invalidate-elevation",{extent:t,spatialReference:r});const i=this._dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(t,r,(e=>{const t=this.graphicsCore.getGraphics3DGraphicById(e);null!=t&&t.needsElevationUpdates()&&this._dirtyGraphicsSet.add(e)})),this._averageExtentUpdateSize=.1*(this._dirtyGraphicsSet.size-i)+.9*this._averageExtentUpdateSize,e.madeProgress()}}_markAllGraphicsElevationDirty(){this._dirtyExtents.clear(),this._dirtyGraphicsSet.clear(),this.graphicsCore.graphics3DGraphics.forEach(((e,t)=>this._dirtyGraphicsSet.add(t)))}_elevationChanged(e){if("scene"===e.context&&(!this.graphicsCore.layer.elevationInfo||"relative-to-scene"!==this.graphicsCore.layer.elevationInfo.mode))return;const t=e.extent;if(this.graphicsCoreOwner.suspended){if(!this._updateElevation){const e=this.graphicsCore.computedExtent;e&&t[2]>e.xmin&&t[0]<e.xmax&&t[3]>e.ymin&&t[1]<e.ymax&&(this._updateElevation=!0)}this.events.emit("invalidate-elevation",e)}else t[0]===-1/0?this._globalDirty=!0:this._dirtyExtents.add(t),this.notifyChange("updating")}};function Ih(e){return null==e?De.W6.ELEVATION_ALIGNMENT:"relative-to-scene"===e?De.W6.ELEVATION_ALIGNMENT_SCENE:De.W6.ELEVATION_ALIGNMENT}function Lh(e,t,r,i){return function(e,t,r,i){i.clip[0]=0,i.clip[1]=r?i.len:Number.MAX_VALUE;for(let r=0;r<e.length;r++)if(!Dh(e[r],t,i))return!1;return!0}(e,t,r,function(e,t,r,i){const n=Nh;return e?(r&&i&&(n.len=(0,k.p)(t,r)),(0,k.c)(n.dir,e)):i?(n.len=(0,k.p)(t,r),(0,k.f)(n.dir,r,t),(0,k.j)(n.dir,n.dir,1/n.len)):((0,k.f)(n.dir,r,t),(0,k.n)(n.dir,n.dir)),n}(i,t,r,!0))}(0,i._)([(0,a.MZ)()],Oh.prototype,"graphicsCoreOwner",void 0),(0,i._)([(0,a.MZ)()],Oh.prototype,"graphicsCore",void 0),(0,i._)([(0,a.MZ)()],Oh.prototype,"queryGraphicUIDsInExtent",void 0),(0,i._)([(0,a.MZ)()],Oh.prototype,"elevationProvider",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],Oh.prototype,"updating",null),(0,i._)([(0,a.MZ)({readOnly:!0})],Oh.prototype,"updatingRemaining",null),Oh=(0,i._)([(0,u.$)("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],Oh);const Nh={dir:(0,m.vt)(),len:0,clip:(0,Ir.vt)()};function Dh(e,t,r){const i=(0,k.m)((0,Ds.Qj)(e),r.dir),n=-(0,Ds.mN)(e,t);if(n<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return n>0;if((n<0||i<0)&&!(n<0&&i<0))return!0;const s=n/i;return i>0?s<r.clip[1]&&(r.clip[1]=s):s>r.clip[0]&&(r.clip[0]=s),r.clip[0]<=r.clip[1]}const Fh=.5*Math.PI,zh=Fh/Math.PI*180;class Vh{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:(0,m.vt)(),direction:(0,m.vt)()};for(let e=0;e<4;e++)this._extent[e]={origin:(0,m.vt)(),direction:(0,m.vt)(),cap:{next:null,direction:(0,m.vt)()}},this._planes[e]=(0,Ds.vt)();this._planes[Ls.FB.NEAR]=(0,Ds.vt)(),this._planes[Ls.FB.FAR]=(0,Ds.vt)(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,t,r,i=!0){const n=this._extent;this._toRenderBoundingExtent(e,t,r),(0,k.g)(this._center.origin,n[0].origin,n[2].origin),(0,k.j)(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),i||(0,k.j)(this._center.direction,this._center.direction,-1);for(let e=0;e<4;e++){const t=n[e];this._renderCoordsHelper.worldUpAtPosition(t.origin,t.direction);const r=n[3===e?0:e+1];t.cap.next=r.origin,(0,k.E)(t.cap.direction,t.origin,r.origin),(0,Ds.mR)(t.direction,t.cap.direction,t.origin,this._planes[e]),i||(0,k.j)(t.direction,t.direction,-1)}(0,Ds.mR)(n[0].cap.direction,n[1].cap.direction,n[0].origin,this._planes[Ls.FB.NEAR]),i?(0,Ds.ze)(this._planes[Ls.FB.NEAR],this._planes[Ls.FB.FAR]):((0,Ds.C)(this._planes[Ls.FB.FAR],this._planes[Ls.FB.NEAR]),(0,Ds.ze)(this._planes[Ls.FB.NEAR],this._planes[Ls.FB.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=t,this._minGlobalAltitude=.9*(0,cc.tO)(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,t,r=!1){if(null==e)return!1;if(this._renderCoordsHelper.viewingMode===nr.RT.Global){const r=this._maxSpanSpatialReference.isGeographic?zh:Fh*t;if(this._maxSpan>r)return!0;if(null!=e.altitude&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(0===this._maxSpan){const t=this._extent[0];return!(r||!e.intersectsRay((0,gl.LV)(t.origin,t.direction)))}for(let t=0;t<this._extent.length;t++){const i=this._extent[t];if(!r&&e.intersectsRay((0,gl.LV)(i.origin,i.direction)))return!0;if(e.intersectsLineSegment((0,Ns.Cr)(i.origin,i.cap.next,Wh),i.cap.direction))return!0}const i=r?this._planes:this._planesWithoutFar;for(let t=0;t<e.lines.length;t++){const r=e.lines[t];if(Lh(i,r.origin,r.endpoint,r.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,t,r){(0,Y.gX)(e,Gh),Gh[2]=r,(0,Je.l)(t,Gh,Bh,this._renderCoordsHelper.spatialReference),(0,Ye.B8)(Hh,Bh),(0,$.Ie)(kh);for(const{x0:i,x1:n,y0:s,y1:o}of Uh)for(let a=0;a<5;a++){const l=a/4;Gh[0]=(0,rn.Cc)(e[i],e[n],l),Gh[1]=(0,rn.Cc)(e[s],e[o],l),Gh[2]=r,(0,q.F)(Gh,t,Gh,this._renderCoordsHelper.spatialReference),(0,k.h)(Gh,Gh,Hh),(0,$.iT)(kh,Gh)}(0,k.s)(this._extent[0].origin,kh[0],kh[1],kh[2]),(0,k.s)(this._extent[1].origin,kh[3],kh[1],kh[2]),(0,k.s)(this._extent[2].origin,kh[3],kh[4],kh[2]),(0,k.s)(this._extent[3].origin,kh[0],kh[4],kh[2]);for(let e=0;e<4;++e)(0,k.h)(this._extent[e].origin,this._extent[e].origin,Bh)}_toRenderBoundingExtentLocal(e,t,r){Nr(e,t,jh,this._renderCoordsHelper.spatialReference),(0,k.s)(this._extent[0].origin,jh[0],jh[1],r),(0,k.s)(this._extent[1].origin,jh[2],jh[1],r),(0,k.s)(this._extent[2].origin,jh[2],jh[3],r),(0,k.s)(this._extent[3].origin,jh[0],jh[3],r)}_toRenderBoundingExtent(e,t,r){switch(this._renderCoordsHelper.viewingMode){case nr.RT.Global:this._toRenderBoundingExtentGlobal(e,t,r);break;case nr.RT.Local:this._toRenderBoundingExtentLocal(e,t,r);break;default:(0,se.Xb)(this._renderCoordsHelper.viewingMode)}}_isVisibleInFrustumGlobal(e){if((0,Ds.mN)(e.planes[Ls.FB.NEAR],this._center.origin)<0&&(0,k.m)(this._center.direction,e.direction)<0)return!0;for(let t=0;t<4;t++){const r=this._extent[t];if((0,Ds.mN)(e.planes[Ls.FB.NEAR],r.origin)<0&&(0,k.m)(r.direction,e.direction)<0)return!0}return!1}}const Uh=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],Gh=(0,m.vt)(),Bh=(0,Xe.vt)(),Hh=(0,Xe.vt)(),kh=(0,$.vt)(),jh=(0,Y.vt)(),Wh=(0,Ns.vt)();let qh=class extends T.A{constructor(e){super(e),this.suspended=!1,this._extent=null,this._extentIntersectionDirty=!0,this._isVisibleBelowSurfaceInternal=!1,this.graphicsCoreOwner=null,this.updating=!0}initialize(){const{graphicsCoreOwner:e}=this;this._extentIntersection=new Vh({renderCoordsHelper:e.view.renderCoordsHelper});const t=e.view,r=t.basemapTerrain,i=t.resourceController.scheduler;this.addHandles([t.on("resize",(()=>this._viewChange())),(0,o.watch)((()=>t.state.camera),(()=>this._viewChange()),o.OH),i.registerTask(De.W6.FRUSTUM_VISIBILITY,this),(0,o.watch)((()=>r.visibleElevationBounds),(()=>this._elevationBoundsChange()))]),"local"===t.viewingMode?this._isVisibleBelowSurface=!0:this.addHandles([(0,o.watch)((()=>[r.baseOpacity,r.wireframe,t.map?.ground?.navigationConstraint?.type]),(()=>this._updateIsVisibleBelowSurface()),o.Vh)])}destroy(){this._set("graphicsCoreOwner",null),this._extent=null,this._extentIntersection=null}_setDirty(){this.updating||this._set("updating",!0)}setExtent(e){this._extent=e,this._extentIntersectionDirty=!0,this._setDirty()}_viewChange(){this._setDirty()}_elevationBoundsChange(){this._setDirty(),this._extentIntersectionDirty=!0}set _isVisibleBelowSurface(e){this._isVisibleBelowSurfaceInternal=e,this._setDirty(),this._extentIntersectionDirty=!0}_updateIsVisibleBelowSurface(){const e=this.graphicsCoreOwner.view,t=e.basemapTerrain,r="local"===e.viewingMode,i="none"===e.map.ground?.navigationConstraint?.type;this._isVisibleBelowSurface=r||!t.opaque||i}_updateExtentIntersection(){if(!this._extentIntersectionDirty)return;this._extentIntersectionDirty=!1;const e=this.graphicsCoreOwner.view;let t;if(this._isVisibleBelowSurfaceInternal)t=-.3*(0,cc.tO)(e.spatialReference).radius;else{const{min:r,max:i}=e.basemapTerrain.visibleElevationBounds;t=r-Math.max(1,(i-r)*(1.2-1))}this._extentIntersection.update(this._extent,e.spatialReference,t)}get running(){return this.updating}runTask(e){if(this._set("updating",!1),!this._extent)return this._set("suspended",!1),lu.G;this._updateExtentIntersection();const t=this.graphicsCoreOwner.view.frustum,r=(0,cc.tO)(this.graphicsCoreOwner.view.spatialReference).radius;this._set("suspended",!this._extentIntersection.isVisibleInFrustum(t,r)),e.madeProgress()}};var Zh;(0,i._)([(0,a.MZ)({readOnly:!0})],qh.prototype,"suspended",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],qh.prototype,"graphicsCoreOwner",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],qh.prototype,"updating",void 0),qh=(0,i._)([(0,u.$)("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],qh),function(e){e[e.Object=0]="Object",e[e.RenderGeometry=1]="RenderGeometry",e[e.External=2]="External",e[e.COUNT=3]="COUNT"}(Zh||(Zh={}));class $h{constructor(){this._items=[]}addObject(e,t){this._items.push({type:Zh.Object,objectStateId:t,object:e})}addRenderGeometry(e,t,r){this._items.push({type:Zh.RenderGeometry,objectStateId:t,renderGeometry:e,owner:r})}addExternal(e,t){this._items.push({type:Zh.External,objectStateId:t,remove:e})}remove(e){for(let t=this._items.length-1;t>=0;--t){const r=this._items[t];r.objectStateId===e&&(Yh(r),this._items.splice(t,1))}}removeObject(e){for(let t=this._items.length-1;t>=0;--t){const r=this._items[t];r.type===Zh.Object&&r.object===e&&(Yh(r),this._items.splice(t,1))}}removeRenderGeometry(e){for(let t=this._items.length-1;t>=0;--t){const r=this._items[t];r.type===Zh.RenderGeometry&&r.renderGeometry===e&&(Yh(r),this._items.splice(t,1))}}removeAll(){this._items.forEach((e=>{Yh(e)})),this._items=[]}}function Yh(e){switch(e.type){case Zh.Object:e.objectStateId.channel===yt.Mg.Highlight?e.object.removeHighlight(e.objectStateId):e.objectStateId.channel===yt.Mg.MaskOccludee&&e.object.removeOcclude(e.objectStateId);break;case Zh.RenderGeometry:e.owner.removeRenderGeometryObjectState(e.renderGeometry,e.objectStateId);break;case Zh.External:e.remove(e.objectStateId)}}class Xh{constructor(e,t){this.stateType=e,this.objectIdField=t,this.objectStateSet=new $h,this.ids=new Set,this.paused=!1}hasGraphic(e){if(this.objectIdField){const t=e.graphic.attributes[this.objectIdField];return this.ids.has(t)}return this.ids.has(e.graphic.uid)}}class Jh{constructor(e){this._graphicsCore=e,this._stateSets=new Array}destroy(){this.reset(),this._stateSets=null}reset(){this._stateSets&&(this._stateSets.forEach((e=>e.objectStateSet.removeAll())),this._stateSets.length=0)}acquireSet(e,t){const r=new Xh(e,t);this._stateSets.push(r);const i=(0,h.hA)((()=>this.releaseSet(r)));return{set:r,handle:i}}releaseSet(e){e.objectStateSet.removeAll();const t=this._stateSets?this._stateSets.indexOf(e):-1;-1!==t&&this._stateSets.splice(t,1)}setUid(e,t){e.ids.add(t);const r=this._graphicsCore.graphics3DGraphics.get(t);r&&Qh(r,e)}setUids(e,t){t.forEach((t=>this.setUid(e,t)))}setObjectIds(e,t){t.forEach((t=>e.ids.add(t))),this._initializeSet(e)}addGraphic(e){this._stateSets.forEach((t=>{!t.paused&&t.hasGraphic(e)&&Qh(e,t)}))}removeGraphic(e){this._stateSets.forEach((t=>{t.hasGraphic(e)&&function(e,t){e.removeObjectState(t.objectStateSet)}(e,t)}))}allGraphicsDeleted(){this._stateSets&&this._stateSets.forEach((e=>e.objectStateSet.removeAll()))}_initializeSet(e){const t=this._graphicsCore.graphics3DGraphics;e.objectIdField?t.forEach((t=>{t&&e.hasGraphic(t)&&Qh(t,e)})):e.ids.forEach((r=>{const i=t.get(r);i&&Qh(i,e)}))}get test(){}}function Qh(e,t){e.addObjectStateSet(t.stateType,t.objectStateSet)}var Kh=r(39715);let ed=class extends T.A{constructor(e){super(e),this._scaleRangeActive=!1,this._layerScaleRangeVisibilityQuery=!1,this._extent=null,this._updatingHandles=new E.U,this.graphicsCoreOwner=null,this.layer=null,this.queryGraphicUIDsInExtent=null,this.graphicsCore=null,this.basemapTerrain=null,this.layerScaleEnabled=!0,this.suspended=!1,this._dirty=!0}initialize(){this.updateScaleRangeActive();const e=this.graphicsCoreOwner.view.resourceController.scheduler;this.addHandles(e.registerTask(De.W6.SCALE_VISIBILITY,this)),this._updatingHandles.add((()=>this.layer.effectiveScaleRange),(()=>this.layerMinMaxScaleChangeHandler()))}destroy(){this._updatingHandles.destroy(),this.removeHandles(),this._dirty=!1,this._extent=null,this.graphicsCoreOwner=null,this.layer=null,this.queryGraphicUIDsInExtent=null,this.graphicsCore=null,this.basemapTerrain=null}get updating(){return this._dirty||this._updatingHandles.updating}_setDirty(){this._dirty=!0}setExtent(e){const t=this.graphicsCoreOwner.view.spatialReference,r=this.graphicsCoreOwner.view.basemapTerrain.spatialReference;if(t===r)this._extent=e??null;else{const i=(0,Y.vt)();Nr(e,t,i,r)?this._extent=i:this._extent=null}this._setDirty()}scaleRangeActive(){return this._scaleRangeActive}updateScaleRangeActive(){const e=this.layer,t=e.effectiveScaleRange;let r=this.layerScaleEnabled&&null!=t&&td(t.minScale,t.maxScale);e.labelingInfo&&!r&&(r=e.labelingInfo.some((e=>e&&td(e.minScale??0,e.maxScale??0))));const i=this._scaleRangeActive!==r;return this._scaleRangeActive=r,r&&!this.hasHandles(rd)&&this.basemapTerrain?(this.addHandles(this.basemapTerrain.on("scale-change",(e=>this._scaleUpdateHandler(e))),rd),this.layerScaleEnabled&&this.addHandles(this.basemapTerrain.on("tiles-visibility-changed",(()=>this._setDirty())),rd)):!r&&this.hasHandles(rd)&&this.removeHandles(rd),i}get running(){return!(!this.graphicsCoreOwner.view.basemapTerrain||!this.updating)}runTask(e){const t=this.graphicsCoreOwner.view.basemapTerrain;if(this._extent&&t&&t.ready&&this._scaleRangeActive&&this.layerScaleEnabled){if(this._layerScaleRangeVisibilityQuery)return lu.G;{this._layerScaleRangeVisibilityQuery=!0;const{minScale:e,maxScale:r}=this.layer.effectiveScaleRange;t.queryVisibleScaleRange(this._extent,e,r,(e=>this._finishUpdate(e)))}}else this._finishUpdate(!0);e.madeProgress()}_finishUpdate(e){this._layerScaleRangeVisibilityQuery=!1,this._set("suspended",!e),this._dirty=!1}_visibleAtLayerScale(e){const t=this.layer.effectiveScaleRange;return!this.layerScaleEnabled||(0,Kh.JU)(e,t.minScale||0,t.maxScale||0)}_visibleAtLabelScale(e,t){return(0,Kh.JU)(e,t.minScale||0,t.maxScale||0)}_graphicScale(e){let t;return null!=e.centroid?t=e.centroid:null!=e.graphic.geometry&&"point"===e.graphic.geometry.type&&(t=e.graphic.geometry),t?this.graphicsCoreOwner.view.basemapTerrain?this.graphicsCoreOwner.view.basemapTerrain.getScale(t):1:null}_graphicVisible(e){if(!this.layerScaleEnabled)return!0;const t=this._graphicScale(e);return this._visibleAtLayerScale(t)}updateVisibility(e){if(this._scaleRangeActive){const t=this._graphicVisible(e);return e.setVisibilityFlag(Ne.GRAPHIC,Le.SCALE_RANGE,t)}return!1}updateGraphicLabelScaleVisibility(e){if(!this._scaleRangeActive)return!1;if(!e.labelLayers||0===e.labelLayers.length)return!1;const t=this._graphicScale(e),r=this._updateLabelScaleVisibility(e,t);return r&&(this.graphicsCore.deconflictor?.setDirty(),this.graphicsCore.labeler?.setDirty()),r}_updateLabelScaleVisibility(e,t){if(!e.labelLayers||0===e.labelLayers.length)return!1;const r=e.labelLayers[0]._labelClass;if(null!=r?.minScale&&null!=r.maxScale){const i=this._visibleAtLabelScale(t,r);if(e.setVisibilityFlag(Ne.LABEL,Le.SCALE_RANGE,i))return!0}return!1}_scaleUpdateHandler(e){if(this._setDirty(),!this.graphicsCore.visible)return;const t=e.extent,r=e.scale,i=this._visibleAtLayerScale(r);let n=!1;const s=this.graphicsCoreOwner.view.spatialReference,o=e.spatialReference;if(null==o)return void c.A.getLogger(this).error("scaleUpdate: Internal error, no SpatialReference given for tiles");const a=!o.equals(s);if(a&&!Nr(t,o,id,s))return void c.A.getLogger(this).error("scaleUpdate: Internal error, cannot project AABR from "+o+" to wkid "+s);const l=a?id:t;this.queryGraphicUIDsInExtent(l,s,(e=>{const s=this.graphicsCore.getGraphics3DGraphicById(e);if(null==s)return;const o=s.centroid;null!=o&&(t[0]>o.x||t[1]>o.y||t[2]<o.x||t[3]<o.y)||(s.setVisibilityFlag(Ne.GRAPHIC,Le.SCALE_RANGE,i)&&(n=!0),this._updateLabelScaleVisibility(s,r)&&(n=!0))})),n&&(this.graphicsCore.deconflictor?.setDirty(),this.graphicsCore.labeler?.setDirty())}layerMinMaxScaleChangeHandler(){this.updateScaleRangeActive()&&!this._scaleRangeActive?this.graphicsCore.modifyGraphics3DGraphicVisibilities((e=>e.setVisibilityFlag(Ne.GRAPHIC,Le.SCALE_RANGE,!0))):this._scaleRangeActive&&this.graphicsCore.updateAllGraphicsVisibility(),this._setDirty()}};function td(e,t){return e>0||t>0}(0,i._)([(0,a.MZ)()],ed.prototype,"graphicsCoreOwner",void 0),(0,i._)([(0,a.MZ)()],ed.prototype,"layer",void 0),(0,i._)([(0,a.MZ)()],ed.prototype,"queryGraphicUIDsInExtent",void 0),(0,i._)([(0,a.MZ)()],ed.prototype,"graphicsCore",void 0),(0,i._)([(0,a.MZ)()],ed.prototype,"basemapTerrain",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],ed.prototype,"layerScaleEnabled",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],ed.prototype,"suspended",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],ed.prototype,"updating",null),(0,i._)([(0,a.MZ)()],ed.prototype,"_dirty",void 0),ed=(0,i._)([(0,u.$)("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],ed);const rd="terrain-events",id=(0,Y.vt)();let nd=class extends T.A{constructor(e){super(e),this.type="graphics-3d",this.graphicsCore=null,this.drapeSourceType=N.Om.Features,this.scaleVisibilityEnabled=!1,this.frustumVisibilityEnabled=!1,this._suspendResumeExtent=null,this._updatingHandles=new E.U}initialize(){const{layer:e}=this,t="effectiveScaleRange"in e?e:null,r=this.scaleVisibilityEnabled&&null!=t,i=new wh({owner:this,layer:this.owner.layer,preferredUpdatePolicy:fh.q.SYNC,graphicSymbolSupported:!0,componentFactories:{elevationAlignment:(e,t)=>new Oh({graphicsCoreOwner:this,graphicsCore:e,queryGraphicUIDsInExtent:t,elevationProvider:this.view.elevationProvider}),scaleVisibility:r?(e,r)=>new ed({graphicsCoreOwner:this,layer:t,queryGraphicUIDsInExtent:r,graphicsCore:e,basemapTerrain:this.owner.view.basemapTerrain}):null,objectStates:e=>new Jh(e)}});if(this._set("graphicsCore",i),this.frustumVisibilityEnabled&&this._set("frustumVisibility",new qh({graphicsCoreOwner:this})),"fullOpacity"in this.owner){const e=this.owner;this._updatingHandles.add((()=>e.fullOpacity),(()=>this.graphicsCore.opacityChange()))}if("elevationInfo"in e){const t=e;this._updatingHandles.add((()=>t.elevationInfo),((e,t)=>{(0,C.Ui)(e,t)&&this._updatingHandles.addPromise(this.graphicsCore.elevationInfoChange())}))}this._set("initializePromise",this._initializeAsync()),this._updatingHandles.addPromise(this.initializePromise)}async _initializeAsync(){try{await this.graphicsCore.initializePromise}catch(e){if((0,d.zf)(e))return;throw e}this.destroyed||(this.addHandles((0,o.watch)((()=>this.view.clippingArea),(()=>this._updateClippingExtent()),o.OH)),this._updateClippingExtent(),this._setupSuspendResumeExtent(),this.graphicsCore.startCreateGraphics())}destroy(){this._updatingHandles.destroy(),this._set("frustumVisibility",(0,s.pR)(this.frustumVisibility)),this._set("graphicsCore",(0,s.pR)(this.graphicsCore))}get layer(){return this.owner.layer}get view(){return this.owner.view}get scaleVisibility(){return this.graphicsCore?.scaleVisibility}get elevationAlignment(){return this.graphicsCore?.elevationAlignment}get scaleVisibilitySuspended(){return!(null==this.scaleVisibility||!this.scaleVisibility.suspended)}get frustumVisibilitySuspended(){return null!=this.frustumVisibility&&this.frustumVisibility.suspended}get suspended(){return this.owner.suspended??!1}get updating(){return!!(this.graphicsCore?.updating||null!=this.scaleVisibility&&this.scaleVisibility.updating||null!=this.frustumVisibility&&this.frustumVisibility.updating||this._updatingHandles.updating)}get graphics3DGraphics(){return this.graphicsCore?.graphics3DGraphics}get graphics3DGraphicsByObjectID(){return this.graphicsCore?.graphics3DGraphicsByObjectID}get loadedGraphics(){return this.owner.loadedGraphics}get fullOpacity(){return this.owner.fullOpacity??1}get slicePlaneEnabled(){return this.owner.slicePlaneEnabled}get updatePolicy(){return this.owner.updatePolicy}notifyGraphicGeometryChanged(e){this.graphicsCore.notifyGraphicGeometryChanged(e)}notifyGraphicVisibilityChanged(e){this.graphicsCore.notifyGraphicVisibilityChanged(e)}getRenderingInfo(e,t,r){const i=function(e,t){const r=I(e,t),i=function(e,t){if(null!=e.symbol)return e.symbol;const r=I(e,t);return null!=r&&"dot-density"!==r.type?r.getSymbol(e,t):null}(e,t);if(null==i)return null;const n={renderer:r,symbol:i};if(null==r||!("visualVariables"in r)||!r.visualVariables)return n;const s=(0,O.getVisualVariableValues)(r,e,t)??[],o=["proportional","proportional","proportional"];for(const{variable:e,value:t}of s)switch(e.type){case"color":n.color=t.toRgba();break;case"size":if("outline"===e.target)n.outlineSize=t;else{const r=e.axis,i=e.useSymbolValue?"symbol-value":t;switch(r){case"width":o[0]=i;break;case"depth":o[1]=i;break;case"height":o[2]=i;break;case"width-and-depth":o[0]=o[1]=i;break;default:o[0]=o[1]=o[2]=i}}break;case"opacity":n.opacity=t;break;case"rotation":switch(e.axis){case"tilt":n.tilt=t;break;case"roll":n.roll=t;break;default:n.heading=t}}return"proportional"===o[0]&&"proportional"===o[1]&&"proportional"===o[2]||(n.size=o),n}(e,{renderer:t,arcade:r});if(i?.color){const e=i.color;e[0]=e[0]/255,e[1]=e[1]/255,e[2]=e[2]/255}return i}getRenderingInfoAsync(e,t,r,i){return async function(e,t){const r=I(e,t),i=await async function(e,t){if(null!=e.symbol)return e.symbol;const r=I(e,t);return null!=r?r.getSymbolAsync(e,t):null}(e,t);if(!i)return null;const n={renderer:r,symbol:i};if(!r||!("visualVariables"in r)||!r.visualVariables)return n;const s=(0,O.getVisualVariableValues)(r,e,t)??[],o=["proportional","proportional","proportional"];for(const{variable:e,value:t}of s)if("color"===e.type)n.color=P.A.toUnitRGBA(t);else if("size"===e.type)if("outline"===e.target)n.outlineSize=t;else{const r=e.axis,i=e.useSymbolValue?"symbol-value":t;"width"===r?o[0]=i:"depth"===r?o[1]=i:"height"===r?o[2]=i:o[0]=o[1]="width-and-depth"===r?i:o[2]=i}else"opacity"===e.type?n.opacity=t:"rotation"===e.type&&"tilt"===e.axis?n.tilt=t:"rotation"===e.type&&"roll"===e.axis?n.roll=t:"rotation"===e.type&&(n.heading=t);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(n.size=o),n}(e,{renderer:t,arcade:r,...i})}getHit(e){if(this.owner.loadedGraphics){const t=this.owner.loadedGraphics.find((t=>t.uid===e));if(t){const e=this.layer instanceof M.A?this.layer:null,r=(0,R.wP)(t,e);return{type:"graphic",graphic:r,layer:r.layer}}}return null}whenGraphicBounds(e,t){return this.graphicsCore?this.graphicsCore.whenGraphicBounds(e,t):Promise.reject()}computeAttachmentOrigin(e,t){return this.graphicsCore?this.graphicsCore.computeAttachmentOrigin(e,t):null}getSymbolLayerSize(e,t){return this.graphicsCore?this.graphicsCore.getSymbolLayerSize(e,t):null}maskOccludee(e){const t=this.graphicsCore?.objectStates;if(!t)return(0,h.hA)();const{set:r,handle:i}=t.acquireSet(yt.Mg.MaskOccludee,null);return t.setUid(r,e.uid),i}highlight(e){const t=this.graphicsCore?.objectStates;if(!t)return(0,h.hA)();if(e instanceof L.A)return sd;if("number"==typeof e)return this.highlight([e]);if(e instanceof w.default)return this.highlight([e]);if(e instanceof A.A&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof w.default){const r=e.map((e=>e.uid)),{set:i,handle:n}=t.acquireSet(yt.Mg.Highlight,null);return t.setUids(i,r),n}if("number"==typeof e[0]){const r=e,{set:i,handle:n}=t.acquireSet(yt.Mg.Highlight,null);return t.setObjectIds(i,r),n}}return sd}_setupSuspendResumeExtent(){const{scaleVisibility:e,frustumVisibility:t}=this;if(null==e&&null==t)return;const r=({computedExtent:r,extentPadding:i})=>{this._suspendResumeExtent=(0,gt.t8)(r,this._suspendResumeExtent,1.2,i),null!=e&&e.setExtent(this._suspendResumeExtent),null!=t&&t.setExtent(this._suspendResumeExtent)};this.addHandles((0,o.watch)((()=>({computedExtent:this.graphicsCore?.computedExtent,extentPadding:this.graphicsCore?.extentPadding})),(e=>r(e)),o.pc))}_updateClippingExtent(){const e=this.view.clippingArea;this.graphicsCore.setClippingExtent(e,this.view.spatialReference)&&this.graphicsCore.recreateAllGraphics()}};(0,i._)([(0,a.MZ)()],nd.prototype,"type",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],nd.prototype,"owner",void 0),(0,i._)([(0,a.MZ)()],nd.prototype,"layer",null),(0,i._)([(0,a.MZ)()],nd.prototype,"view",null),(0,i._)([(0,a.MZ)({constructOnly:!0})],nd.prototype,"graphicsCore",void 0),(0,i._)([(0,a.MZ)()],nd.prototype,"scaleVisibility",null),(0,i._)([(0,a.MZ)({constructOnly:!0})],nd.prototype,"frustumVisibility",void 0),(0,i._)([(0,a.MZ)()],nd.prototype,"elevationAlignment",null),(0,i._)([(0,a.MZ)()],nd.prototype,"scaleVisibilitySuspended",null),(0,i._)([(0,a.MZ)({readOnly:!0})],nd.prototype,"frustumVisibilitySuspended",null),(0,i._)([(0,a.MZ)()],nd.prototype,"suspended",null),(0,i._)([(0,a.MZ)({readOnly:!0})],nd.prototype,"updating",null),(0,i._)([(0,a.MZ)()],nd.prototype,"loadedGraphics",null),(0,i._)([(0,a.MZ)()],nd.prototype,"fullOpacity",null),(0,i._)([(0,a.MZ)()],nd.prototype,"slicePlaneEnabled",null),(0,i._)([(0,a.MZ)()],nd.prototype,"drapeSourceType",void 0),(0,i._)([(0,a.MZ)()],nd.prototype,"updatePolicy",null),(0,i._)([(0,a.MZ)({constructOnly:!0})],nd.prototype,"scaleVisibilityEnabled",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],nd.prototype,"frustumVisibilityEnabled",void 0),(0,i._)([(0,a.MZ)()],nd.prototype,"initializePromise",void 0),nd=(0,i._)([(0,u.$)("esri.views.3d.layers.graphics.GraphicsProcessor")],nd);const sd=(0,h.hA)(),od={candidates:[],sourceCandidateIndices:[]};class ad{constructor(e,t=0,r=0,i=0,n=0,s=null){this.usedMemory=e,this.displayedFeatures=t,this.totalFeatures=r,this.maximumFeatures=i,this.nodes=n,this.core=s}}var ld=r(1644),cd=r(68354),ud=r(58251);let hd=class extends(f(ud.A)){constructor(){super(...arguments),this.type="graphics-3d",this.symbologySnappingSupported=!0,this._slicePlaneEnabled=!1,this.fullExtentInLocalViewSpatialReference=null,this.ignoresMemoryFactor=!0}initialize(){this._set("processor",new nd({owner:this,scaleVisibilityEnabled:!0,frustumVisibilityEnabled:!0})),this.addResolvingPromise(this.processor.initializePromise),this.addHandles(this.layer.on("graphic-update",(e=>this.processor.graphicsCore.graphicUpdateHandler(e)))),this.addResolvingPromise(function(e){const t=e.view.spatialReference,r=e.layer.fullExtent,i=null!=r&&r.spatialReference;if(null==r||!i)return Promise.resolve(null);if(i.equals(t))return Promise.resolve(r.clone());const n=(0,ld.Cv)(r,t);return null!=n?Promise.resolve(n):e.view.state.isLocal?(0,cd.projectGeometry)(r,t,e.layer.portalItem).then((t=>!e.destroyed&&t?t:null)).catch((()=>null)):Promise.resolve(null)}(this).then((e=>this.fullExtentInLocalViewSpatialReference=e))),this.layer.internal?this.notifyChange("updating"):this.addHandles((0,o.when)((()=>this.view?.basemapTerrain?.ready),(()=>()=>this.notifyChange("updating")),{once:!0}))}destroy(){this._updatingHandles.removeAll(),this._set("processor",(0,s.pR)(this.processor))}get loadedGraphics(){return this.layer.graphics}get legendEnabled(){return this.canResume()&&!this.processor?.frustumVisibilitySuspended}get visibleAtCurrentScale(){return!this.processor?.scaleVisibilitySuspended}get slicePlaneEnabled(){const e=this.layer.internal;return this._slicePlaneEnabled&&!e}set slicePlaneEnabled(e){this._slicePlaneEnabled=e}getSuspendInfo(){const e=super.getSuspendInfo();return e.outsideOfView=this.processor?.frustumVisibilitySuspended??!1,e}getHit(e){return this.processor.getHit(e)}whenGraphicBounds(e,t){return this.processor.whenGraphicBounds(e,t)}computeAttachmentOrigin(e,t){return this.processor?.computeAttachmentOrigin(e,t)}getSymbolLayerSize(e,t){return this.processor.getSymbolLayerSize(e,t)}queryGraphics(){return Promise.resolve(this.loadedGraphics)}maskOccludee(e){return this.processor.maskOccludee(e)}highlight(e){return this.processor.highlight(e)}async elevationAlignPointsInFeatures(e,t){const{processor:r}=this;if(null==r?.graphics3DGraphics)throw new n.A("graphicslayerview3d:missing-processor","A Graphics3D processor is needed to resolve graphics elevation.");const{graphics3DGraphics:i}=r;return async function(e,t,r,i,n){const{elevationProvider:s,renderCoordsHelper:o}=e,{elevationInfo:a}=t,{pointsInFeatures:l,spatialReference:c}=i,u=S.A.fromJSON(c),h=(0,x.MF)(a,!0),p=await(0,x.q6)(h,u,n);(0,d.Te)(n);const f=[],w=new Set,T=new Set,A=new b.F,C=(0,y.T)(0,0,0,S.A.WGS84),E=new v.Uk,M=(0,m.vt)();C.spatialReference=u;const R=e.elevationProvider.spatialReference??e.spatialReference;for(const{objectId:e,points:i}of l){const l=r(e);if(null==l){for(const e of i)f.push(e.z??0);w.add(e);continue}l.isDraped&&T.add(e);const c=l.graphic.geometry;A.setFromElevationInfo((0,_.ze)(c,a)),A.updateFeatureExpressionInfoContext(p,l.graphic,t);for(const{x:e,y:t,z:r}of i)C.x=e,C.y=t,C.z=r??0,await(0,g.W)(C,M,R,0,{signal:n}),(0,v.sE)(M,s,A,o,E),f.push(E.z)}return{elevations:f,drapedObjectIds:T,failedObjectIds:w}}(this.view,this.layer,(e=>"number"==typeof e?i.get(e):void 0),e,t)}async queryForSymbologySnapping(e,t){return async function(e,t,r){if(null==e||0===t.candidates.length)return od;const i=e.graphics3DGraphicsByObjectID??e.graphics3DGraphics,n=[],s=[],{renderer:o}=e,a=null!=o&&"arcadeRequired"in o&&o.arcadeRequired?(0,re.lw)():null,l=async(t,{graphic:i,graphics3DSymbol:n})=>{const s=await a,l=await e.getRenderingInfoAsync(i,o,s,{signal:r});return null==l?[]:n.queryForSnapping(t,u,l,r)},{candidates:c,spatialReference:u}=t;for(let e=0;e<c.length;++e){const t=c[e],{objectId:r}=t,o="number"==typeof r?i?.get(r):void 0;if(null==o)continue;const{graphics3DSymbol:a}=o;a.symbologySnappingSupported&&(n.push(l(t,o)),s.push(e))}if(0===n.length)return od;const h=await Promise.all(n);(0,d.Te)(r);const p=[],f=[];for(let e=0;e<h.length;++e){const t=h[e],r=s[e];for(const e of t)p.push(e),f.push(r)}return{candidates:p,sourceCandidateIndices:f}}(this.processor,e,t)}get updatePolicy(){return this.processor?.graphicsCore.effectiveUpdatePolicy||fh.q.SYNC}isUpdating(){return this.view&&this.layer&&!(!this.processor?.updating&&(this.layer.internal||this.view.basemapTerrain?.ready))}get performanceInfo(){return new ad(this.usedMemory,this.loadedGraphics.length,-1,-1)}get usedMemory(){return this.processor?.graphicsCore?.usedMemory??0}get unloadedMemory(){return this.processor?.graphicsCore?.unprocessedMemoryEstimate}get test(){return{graphics3DProcessor:this.processor,loadedGraphics:this.loadedGraphics}}};(0,i._)([(0,a.MZ)()],hd.prototype,"loadedGraphics",null),(0,i._)([(0,a.MZ)({readOnly:!0})],hd.prototype,"legendEnabled",null),(0,i._)([(0,a.MZ)()],hd.prototype,"layer",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],hd.prototype,"processor",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],hd.prototype,"visibleAtCurrentScale",null),(0,i._)([(0,a.MZ)()],hd.prototype,"_slicePlaneEnabled",void 0),(0,i._)([(0,a.MZ)({type:Boolean})],hd.prototype,"slicePlaneEnabled",null),hd=(0,i._)([(0,u.$)("esri.views.3d.layers.GraphicsLayerView3D")],hd);const dd=hd},76589:function(e,t,r){r.d(t,{F:function(){return s}});var i=r(32e3),n=r(68546);class s{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=(0,i.Ao)(e)}get requiresSampledElevationInfo(){return"absolute-height"!==this.mode}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,t){const r=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?r:e+r}calculateOffsetRenderUnits(e){let t=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return null!=r&&(t+=(0,n.g7)(r)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=(0,i.Tg)(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,t,r){if(null==e)return void(this._featureExpressionInfoContext=null);const i=e?.arcade;i&&null!=t&&null!=r?(this._featureExpressionInfoContext=(0,n.o8)(e),(0,n.gf)(this._featureExpressionInfoContext,(0,n.VG)(i.modules,t,r))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const t=new s;return null!=e&&t.setFromElevationInfo(e),t}}},49618:function(e,t,r){r.d(t,{I2:function(){return g},Kf:function(){return _},Uk:function(){return x},ai:function(){return b},au:function(){return p},fe:function(){return v},nG:function(){return m},nu:function(){return y},sE:function(){return f},uw:function(){return i}});var i,n,s=r(73364),o=r(39714),a=r(32501),l=r(7456),c=r(57617),u=r(5915),h=r(60516),d=r(65839);function p(e,t,r,i,n,s,o,a,l,u,h){const d=S[h.mode];let p,f,m=0;if((0,c.projectBuffer)(e,t,r,i,l.spatialReference,n,a))return d.requiresAlignment(h)?(m=d.applyElevationAlignmentBuffer(i,n,s,o,a,l,u,h),p=s,f=o):(p=i,f=n),(0,c.projectBuffer)(p,l.spatialReference,f,s,u.spatialReference,o,a)?m:void 0}function f(e,t,r,i,n){const s=((0,u.v)(e)?e.z:(0,h.cN)(e)?e.array[e.offset+2]:e[2])||0;switch(r.mode){case"on-the-ground":{const r=(0,h.R1)(t,e,"ground")??0;return n.verticalDistanceToGround=0,n.sampledElevation=r,void(n.z=r)}case"relative-to-ground":{const o=(0,h.R1)(t,e,"ground")??0,a=r.geometryZWithOffset(s,i);return n.verticalDistanceToGround=a,n.sampledElevation=o,void(n.z=a+o)}case"relative-to-scene":{const o=(0,h.R1)(t,e,"scene")??0,a=r.geometryZWithOffset(s,i);return n.verticalDistanceToGround=a,n.sampledElevation=o,void(n.z=a+o)}case"absolute-height":{const o=r.geometryZWithOffset(s,i),a=(0,h.R1)(t,e,"ground")??0;return n.verticalDistanceToGround=o-a,n.sampledElevation=a,void(n.z=o)}default:return void(n.z=0)}}function m(e,t,r,i){return f(e,t,r,i,T),T.z}function g(e,t,r){return"on-the-ground"===t&&"on-the-ground"===r?e.staysOnTheGround:t===r||"on-the-ground"!==t&&"on-the-ground"!==r?null==t||null==r?e.definedChanged:i.UPDATE:e.onTheGroundChanged}function y(e){return"relative-to-ground"===e||"relative-to-scene"===e}function _(e){return"absolute-height"!==e}function v(e,t,r,i,n){f(t,r,n,i,T),b(e,T.verticalDistanceToGround);const o=T.sampledElevation,a=(0,s.C)(w,e.transformation);return A[0]=t.x,A[1]=t.y,A[2]=T.z,(0,l.l)(t.spatialReference,A,a,i.spatialReference)?e.transformation=a:console.warn("Could not locate symbol object properly, it might be misplaced"),o}function b(e,t){for(let r=0;r<e.geometries.length;++r){const i=e.geometries[r].getMutableAttribute(d.r.CENTEROFFSETANDDISTANCE);i&&i.data[3]!==t&&(i.data[3]=t,e.geometryVertexAttributeUpdated(e.geometries[r],d.r.CENTEROFFSETANDDISTANCE))}}class x{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}(n=i||(i={}))[n.NONE=0]="NONE",n[n.UPDATE=1]="UPDATE",n[n.RECREATE=2]="RECREATE";const S={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,r,i,n,s,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;t*=3,i*=3;for(let s=0;s<n;++s){const n=e[t],s=e[t+1],o=e[t+2];r[i]=n,r[i+1]=s,r[i+2]=null==c?o+l:l,t+=3,i+=3}return 0},requiresAlignment:function(e){const t=e.meterUnitOffset,r=e.featureExpressionInfoContext;return 0!==t||null!=r}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,r,i,n,s){let o=0;const a=s.spatialReference;t*=3,i*=3;for(let l=0;l<n;++l){const n=e[t],l=e[t+1],c=e[t+2],u=s.getElevation(n,l,c,a,"ground")??0;o+=u,r[i]=n,r[i+1]=l,r[i+2]=u,t+=3,i+=3}return o/n},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,r,i,n,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,h=s.spatialReference;t*=3,i*=3;for(let o=0;o<n;++o){const n=e[t],o=e[t+1],a=e[t+2],d=s.getElevation(n,o,a,h,"ground")??0;l+=d,r[i]=n,r[i+1]=o,r[i+2]=null==u?a+d+c:d+c,t+=3,i+=3}return l/n},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,r,i,n,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,h=s.spatialReference;t*=3,i*=3;for(let o=0;o<n;++o){const n=e[t],o=e[t+1],a=e[t+2],d=s.getElevation(n,o,a,h,"scene")??0;l+=d,r[i]=n,r[i+1]=o,r[i+2]=null==u?a+d+c:d+c,t+=3,i+=3}return l/n},requiresAlignment:()=>!0}},w=(0,o.vt)(),T=new x,A=(0,a.vt)()},68546:function(e,t,r){r.d(t,{KF:function(){return f},MF:function(){return p},VG:function(){return u},g7:function(){return d},gf:function(){return h},o8:function(){return l},q6:function(){return c}});var i=r(40633),n=r(60539),s=r(45328),o=r(54547);const a=()=>i.A.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function l(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}async function c(e,t,r,i){const s=e?.expression;if("string"!=typeof s)return null;const a=function(e){return"0"===e?0:null}(s);if(null!=a)return{cachedResult:a};const l=await(0,o.lw)();(0,n.Te)(r);const c=l.arcadeUtils,u=c.createSyntaxTree(s);return c.dependsOnView(u)?(null!=i&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:c.createFunction(u),context:c.createExecContext(null,{sr:t}),modules:l}}}function u(e,t,r){return e.arcadeUtils.createFeature(t.attributes,t.geometry,r)}function h(e,t){if(null!=e&&!m(e)){if(!t||!e.arcade)return void a().errorOncePerTick("Arcade support required but not provided");const r=t;r._geometry&&(r._geometry=(0,s.wZ)(r._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function d(e){if(null!=e){if(m(e))return e.cachedResult;const t=e.arcade;let r=t?.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof r&&(e.cachedResult=0,r=0),r}return 0}function p(e,t=!1){let r=e?.featureExpressionInfo;const i=r?.expression;return t||"0"===i||(r=null),r??null}const f={cachedResult:0};function m(e){return null!=e.cachedResult}},75302:function(e,t,r){r.d(t,{$2:function(){return T},$C:function(){return b},Hj:function(){return S},Mh:function(){return w},W$:function(){return g},pW:function(){return x},t8:function(){return v},vY:function(){return A}});var i=r(62938),n=r(73364),s=r(39714),o=r(32501),a=r(33400),l=r(41546),c=r(46157),u=r(24761),h=r(87416),d=r(72228),p=r(38441),f=r(46460),m=r(45328);function g(e,t){if("point"===e.type)return _(e,t,!1);if((0,m.gr)(e))switch(e.type){case"extent":return _(e.center,t,!1);case"polygon":return _(e.centroid,t,!1);case"polyline":return _(y(e),t,!0);case"mesh":return _(e.origin,t,!1)}else switch(e.type){case"extent":return _(function(e){return(0,f.T)(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),null!=e.zmin&&null!=e.zmax&&isFinite(e.zmin)&&isFinite(e.zmax)?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return _(function(e){const t=e.rings[0];if(!t||0===t.length)return null;const r=(0,d.S8)(e.rings,!!e.hasZ);return(0,f.T)(r[0],r[1],r[2],e.spatialReference)}(e),t,!0);case"polyline":return _(y(e),t,!0)}}function y(e){const t=e.paths[0];if(!t||0===t.length)return null;const r=(0,p.$H)(t,(0,p.Yl)(t)/2);return(0,f.T)(r[0],r[1],r[2],e.spatialReference)}function _(e,t,r){const i=r?e:(0,m.EL)(e);return t&&e?(0,c.projectPoint)(e,i,t)?i:null:i}function v(e,t,r,i=0){if(e){t||(t=(0,h.vt)());const n=e;let s=.5*n.width*(r-1),o=.5*n.height*(r-1);return n.width<1e-7*n.height?s+=o/20:n.height<1e-7*n.width&&(o+=s/20),(0,a.s)(t,n.xmin-s-i,n.ymin-o-i,n.xmax+s+i,n.ymax+o+i),t}return null}function b(e,t,r=null){const i=(0,l.o8)(l.Un);return null!=e&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),null!=t?i[3]=t:null!=e&&e.length>3&&(i[3]=e[3]),r&&(i[0]*=r,i[1]*=r,i[2]*=r,i[3]*=r),i}function x(e=o.Un,t,r,i=1){const n=new Array(3);if(null==t||null==r)n[0]=1,n[1]=1,n[2]=1;else{let i,s=0;for(let o=2;o>=0;o--){const a=e[o];let l;const c=null!=a,u=0===o&&!i&&!c,h=r[o];"symbol-value"===a||u?l=0!==h?t[o]/h:1:c&&"proportional"!==a&&isFinite(a)&&(l=0!==h?a/h:1),null!=l&&(n[o]=l,i=l,s=Math.max(s,Math.abs(l)))}for(let e=2;e>=0;e--)null==n[e]?n[e]=i:0===n[e]&&(n[e]=.001*s)}for(let e=2;e>=0;e--)n[e]/=i;return(0,o.ci)(n)}function S(e){return w(function(e){return null!=e.isPrimitive}(e)?[e.width,e.depth,e.height]:e)?null:"Symbol sizes may not be negative values"}function w(e){const t=e=>null==e||e>=0;return Array.isArray(e)?e.every(t):t(e)}function T(e,t,r,i=(0,s.vt)()){return e&&(0,n.Qr)(i,i,-e/180*Math.PI),t&&(0,n.eL)(i,i,t/180*Math.PI),r&&(0,n.Z8)(i,i,r/180*Math.PI),i}function A(e,t,r){if(null!=r.minDemResolution)return r.minDemResolution;const n=(0,i.GA)(t),s=(0,u.VL)(e)*n,o=(0,u.yr)(e)*n,a=(0,u.uJ)(e)*(t.isGeographic?1:n);return 0===s&&0===o&&0===a?r.minDemResolutionForPoints:.01*Math.max(s,o,a)}},45869:function(e,t,r){r.d(t,{fetch:function(){return ee}});var i=r(14520),n=r(15774),s=r(44705),o=r(87725),a=r(73364),l=r(39714),c=r(1932),u=r(20551),h=r(32501),d=r(24761),p=r(5047),f=r(92754),m=r(62693),g=r(32003),y=r(78598),_=r(96400),v=r(84111),b=r(44432),x=r(32680),S=r(33913),w=r(43),T=r(54200);class A{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}}class C{constructor(e,t,r){this.name=e,this.lodThreshold=t,this.pivotOffset=r,this.stageResources=new A,this.numberOfVertices=0}}var E=r(93040),M=r(77472),R=r(63952),P=r(39819),O=r(40633),I=r(7970),L=r(60539),N=r(58009),D=r(37819),F=r(9030),z=r(14905),V=r(54407),U=r(40321),G=r(59552),B=r(65839),H=r(42674),k=r(85456);const j=()=>O.A.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");function W(e){throw new P.A("",`Request for object resource failed: ${e}`)}function q(e){const t=e.params,r=t.topology;let i=!0;switch(t.vertexAttributes||(j().warn("Geometry must specify vertex attributes"),i=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const e=t.faces;if(e){if(t.vertexAttributes)for(const r in t.vertexAttributes){const t=e[r];t?.values?(null!=t.valueType&&"UInt32"!==t.valueType&&(j().warn(`Unsupported indexed geometry indices type '${t.valueType}', only UInt32 is currently supported`),i=!1),null!=t.valuesPerElement&&1!==t.valuesPerElement&&(j().warn(`Unsupported indexed geometry values per element '${t.valuesPerElement}', only 1 is currently supported`),i=!1)):(j().warn(`Indexed geometry does not specify face indices for '${r}' attribute`),i=!1)}}else j().warn("Indexed geometries must specify faces"),i=!1;break}default:j().warn(`Unsupported topology '${r}'`),i=!1}e.params.material||(j().warn("Geometry requires material"),i=!1);const n=e.params.vertexAttributes;for(const e in n)n[e].values||(j().warn("Geometries with externally defined attributes are not yet supported"),i=!1);return i}function Z(e){const t=(0,d.Ie)();return e.forEach((e=>{const r=e.boundingInfo;null!=r&&((0,d.iT)(t,r.bbMin),(0,d.iT)(t,r.bbMax))})),t}function $(e){switch(e){case"mask":return V.sf.Mask;case"maskAndTransparency":return V.sf.MaskBlend;case"none":return V.sf.Opaque;default:return V.sf.Blend}}function Y(e){const t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}const X=new N.R(1,2,"wosr");var J=r(11377),Q=r(12474),K=r(27539);async function ee(e,t){const r=function(e){const t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:null!=t[4]?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}((0,i.EM)(e));if("wosr"===r.fileType){const e=await(t.cache?t.cache.loadWOSR(r.url,t):async function(e,t){const r=await async function(e,t){const r=t?.streamDataRequester;if(r)return async function(e,t,r){const i=await(0,M.Ke)(t.request(e,"json",r));if(!0===i.ok)return i.value;(0,L.QP)(i.error),W(i.error.details.url)}(e,r,t);const i=await(0,M.Ke)((0,E.A)(e,t));if(!0===i.ok)return i.value.data;(0,L.QP)(i.error),W(i.error)}(e,t),i=await async function(e,t){const r=new Array;for(const i in e){const n=e[i],s=n.images[0].data;if(!s){j().warn("Externally referenced texture data is not yet supported");continue}const o=n.encoding+";base64,"+s,a="/textureDefinitions/"+i,l="rgba"===n.channels?n.alphaChannelUsage||"transparency":"none",c={noUnpackFlip:!0,wrap:{s:k.pF.REPEAT,t:k.pF.REPEAT},preMultiplyAlpha:$(l)!==V.sf.Opaque},u=t?.disableTextures?Promise.resolve(null):(0,F.D)(o,t);r.push(u.then((e=>({refId:a,image:e,parameters:c,alphaChannelUsage:l}))))}const i=await Promise.all(r),n={};for(const e of i)n[e.refId]=e;return n}(r.textureDefinitions??{},t);let n=0;for(const e in i)if(i.hasOwnProperty(e)){const t=i[e];n+=t?.image?t.image.width*t.image.height*4:0}return{resource:r,textures:i,size:n+(0,R.iL)(r)}}(r.url,t)),{engineResources:i,referenceBoundingBox:n}=function(e,t){const r=new Array,i=new Array,n=new Array,s=new I.O,o=e.resource,a=N.R.parse(o.version||"1.0","wosr");X.validate(a);const l=o.model.name,c=o.model.geometries,u=o.materialDefinitions??{},d=e.textures;let p=0;const f=new Map;for(let e=0;e<c.length;e++){const o=c[e];if(!q(o))continue;const a=Y(o),l=o.params.vertexAttributes,m=[],g=e=>{if("PerAttributeArray"===o.params.topology)return null;const t=o.params.faces;for(const r in t)if(r===e)return t[r].values;return null},y=l[B.r.POSITION],_=y.values.length/y.valuesPerElement;for(const e in l){const t=l[e],r=t.values,i=g(e)??(0,D.tM)(_);m.push([e,new z.n(r,i,t.valuesPerElement,!0)])}const v=a.texture,b=d&&d[v];if(b&&!f.has(v)){const{image:e,parameters:t}=b,r=new G.g(e,t);i.push(r),f.set(v,r)}const x=f.get(v),S=x?x.id:void 0,w=a.material;let T=s.get(w,v);if(null==T){const e=u[w.substring(w.lastIndexOf("/")+1)].params;1===e.transparency&&(e.transparency=0);const r=b&&b.alphaChannelUsage,i=e.transparency>0||"transparency"===r||"maskAndTransparency"===r,n=b?$(b.alphaChannelUsage):void 0,o={ambient:(0,h.ci)(e.diffuse),diffuse:(0,h.ci)(e.diffuse),opacity:1-(e.transparency||0),transparent:i,textureAlphaMode:n,textureAlphaCutoff:.33,textureId:S,initTextureTransparent:!0,doubleSided:!0,cullFace:V.s2.None,colorMixMode:e.externalColorMixMode||"tint",textureAlphaPremultiplied:b?.parameters.preMultiplyAlpha??!1};t?.materialParameters&&Object.assign(o,t.materialParameters),T=new H.$U(o),s.set(w,v,T)}n.push(T);const A=new U.V(T,m);p+=m.find((e=>e[0]===B.r.POSITION))?.[1]?.indices.length??0,r.push(A)}return{engineResources:[{name:l,stageResources:{textures:i,materials:n,geometries:r},pivotOffset:o.model.pivotOffset,numberOfVertices:p,lodThreshold:null}],referenceBoundingBox:Z(r)}}(e,t);return{lods:i,referenceBoundingBox:n,isEsriSymbolResource:!1,isWosr:!0}}const o=await(t.cache?t.cache.loadGLTF(r.url,t,!!t.usePBR):(0,x.y)(new b.R(t.streamDataRequester),r.url,t,t.usePBR)),A=o.model.meta?.ESRI_proxyEllipsoid,P=o.meta.isEsriSymbolResource&&null!=A&&"EsriRealisticTreesStyle"===o.meta.ESRI_webstyle;P&&!o.customMeta.esriTreeRendering&&(o.customMeta.esriTreeRendering=!0,function(e,t){for(let r=0;r<e.model.lods.length;++r){const i=e.model.lods[r];for(const n of i.parts){const i=n.attributes.normal;if(null==i)return;const s=n.attributes.position,o=s.count,c=(0,h.vt)(),d=(0,h.vt)(),p=(0,h.vt)(),m=new Uint8Array(4*o),g=new Float64Array(3*o),y=(0,a.B8)((0,l.vt)(),n.transform);let _=0,v=0;for(let a=0;a<o;a++){s.getVec(a,d),i.getVec(a,c),(0,u.h)(d,d,n.transform),(0,u.f)(p,d,t.center),(0,u.D)(p,p,t.radius);const o=p[2],l=(0,u.l)(p),h=Math.min(.45+.55*l*l,1);(0,u.D)(p,p,t.radius),null!==y&&(0,u.h)(p,p,y),(0,u.n)(p,p),r+1!==e.model.lods.length&&e.model.lods.length>1&&(0,u.o)(p,p,c,o>-1?.2:Math.min(-4*o-3.8,1)),g[_]=p[0],g[_+1]=p[1],g[_+2]=p[2],_+=3,m[v]=255*h,m[v+1]=255*h,m[v+2]=255*h,m[v+3]=255,v+=4}n.attributes.normal=new f.xs(g),n.attributes.color=new f.XP(m)}}}(o,A));const O=!!t.usePBR,ee=o.meta.isEsriSymbolResource?{usePBR:O,isSchematic:!1,treeRendering:P,mrrFactors:[...K.d_]}:{usePBR:O,isSchematic:!1,treeRendering:!1,mrrFactors:[...K.Rk]},re={...t.materialParameters,treeRendering:P},{engineResources:ie,referenceBoundingBox:ne}=function(e,t,r,i){const o=e.model,a=new Array,l=new Map,u=new Map,h=o.lods.length,b=(0,d.Ie)();return o.lods.forEach(((e,x)=>{const A=!0===i.skipHighLods&&(h>1&&0===x||h>3&&1===x)||!1===i.skipHighLods&&null!=i.singleLodIndex&&x!==i.singleLodIndex;if(A&&0!==x)return;const E=new C(e.name,e.lodThreshold,[0,0,0]);e.parts.forEach((e=>{const i=A?new H.$U({}):function(e,t,r,i,n,s,o){const a=t.material+(t.attributes.normal?"_normal":"")+(t.attributes.color?"_color":"")+(t.attributes.texCoord0?"_texCoord0":"")+(t.attributes.tangent?"_tangent":""),l=e.materials.get(t.material),u=null!=t.attributes.texCoord0,h=null!=t.attributes.normal;if(null==l)return null;const d=function(e){switch(e){case"BLEND":return V.sf.Blend;case"MASK":return V.sf.Mask;case"OPAQUE":case null:case void 0:return V.sf.Opaque}}(l.alphaMode);if(!s.has(a)){if(u){const t=(t,r=!1)=>{if(null!=t&&!o.has(t)){const i=e.textures.get(t);if(null!=i){const e=i.data;o.set(t,new G.g((0,w.x3)(e)?e.data:e,{...i.parameters,preMultiplyAlpha:!(0,w.x3)(e)&&r,encoding:(0,w.x3)(e)&&null!=e.encoding?e.encoding:void 0}))}}};t(l.textureColor,d!==V.sf.Opaque),t(l.textureNormal),t(l.textureOcclusion),t(l.textureEmissive),t(l.textureMetallicRoughness)}const r=l.color[0]**(1/Q.T),p=l.color[1]**(1/Q.T),f=l.color[2]**(1/Q.T),m=l.emissiveFactor[0]**(1/Q.T),g=l.emissiveFactor[1]**(1/Q.T),y=l.emissiveFactor[2]**(1/Q.T),_=null!=l.textureColor&&u?o.get(l.textureColor):null,v=(0,K.Jr)({normalTexture:l.textureNormal,metallicRoughnessTexture:l.textureMetallicRoughness,metallicFactor:l.metallicFactor,roughnessFactor:l.roughnessFactor,emissiveTexture:l.textureEmissive,emissiveFactor:l.emissiveFactor,occlusionTexture:l.textureOcclusion}),b=null!=l.normalTextureTransform?.scale?l.normalTextureTransform?.scale:c.Un;s.set(a,new H.$U({...i,transparent:d===V.sf.Blend,customDepthTest:V.it.Lequal,textureAlphaMode:d,textureAlphaCutoff:l.alphaCutoff,diffuse:[r,p,f],ambient:[r,p,f],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?V.s2.None:V.s2.Back,hasVertexColors:!!t.attributes.color,hasVertexTangents:!!t.attributes.tangent,normalType:h?J.W.Attribute:J.W.ScreenDerivative,castShadows:!0,receiveShadows:l.receiveShadows,receiveAmbientOcclusion:l.receiveAmbientOcclustion,textureId:null!=_?_.id:void 0,colorMixMode:l.colorMixMode,normalTextureId:null!=l.textureNormal&&u?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:null!=_&&!!_.parameters.preMultiplyAlpha,occlusionTextureId:null!=l.textureOcclusion&&u?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:null!=l.textureEmissive&&u?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:null!=l.textureMetallicRoughness&&u?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[m,g,y],mrrFactors:v?[...K.mX]:[l.metallicFactor,l.roughnessFactor,i.mrrFactors[2]],isSchematic:v,colorTextureTransformMatrix:(0,T.G)(l.colorTextureTransform),normalTextureTransformMatrix:(0,T.G)(l.normalTextureTransform),scale:[b[0],b[1]],occlusionTextureTransformMatrix:(0,T.G)(l.occlusionTextureTransform),emissiveTextureTransformMatrix:(0,T.G)(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:(0,T.G)(l.metallicRoughnessTextureTransform),...n}))}const p=s.get(a);if(r.stageResources.materials.push(p),u){const e=e=>{null!=e&&r.stageResources.textures.push(o.get(e))};e(l.textureColor),e(l.textureNormal),e(l.textureOcclusion),e(l.textureEmissive),e(l.textureMetallicRoughness)}return p}(o,e,E,t,r,l,u),{geometry:a,vertexCount:h}=function(e,t){const r=e.attributes.position.count,i=(0,S.x)(e.indices||r,e.primitiveType),o=(0,p.oe)(3*r),{typedBuffer:a,typedBufferStride:l}=e.attributes.position;(0,m.a)(o,a,e.transform,3,l);const c=[[B.r.POSITION,new z.n(o,i,3,!0)]];if(null!=e.attributes.normal){const t=(0,p.oe)(3*r),{typedBuffer:o,typedBufferStride:a}=e.attributes.normal;(0,s.Ge)(te,e.transform),(0,m.t)(t,o,te,3,a),(0,n.or)(te)&&(0,m.n)(t,t),c.push([B.r.NORMAL,new z.n(t,i,3,!0)])}if(null!=e.attributes.tangent){const t=(0,p.oe)(4*r),{typedBuffer:o,typedBufferStride:a}=e.attributes.tangent;(0,s.z0)(te,e.transform),(0,g.t)(t,o,te,4,a),(0,n.or)(te)&&(0,m.n)(t,t,4),c.push([B.r.TANGENT,new z.n(t,i,4,!0)])}if(null!=e.attributes.texCoord0){const t=(0,p.oe)(2*r),{typedBuffer:n,typedBufferStride:s}=e.attributes.texCoord0;(0,y.n)(t,n,2,s),c.push([B.r.UV0,new z.n(t,i,2,!0)])}const u=e.attributes.color;if(null!=u){const t=new Uint8Array(4*r);4===u.elementCount?u instanceof f.Eq?(0,g.s)(t,u,255):u instanceof f.XP?(0,v.c)(t,u):u instanceof f.Uz&&(0,g.s)(t,u,1/256):(t.fill(255),u instanceof f.xs?(0,m.s)(t,u.typedBuffer,255,4,u.typedBufferStride):e.attributes.color instanceof f.eI?(0,_.c)(t,u.typedBuffer,4,e.attributes.color.typedBufferStride):e.attributes.color instanceof f.nS&&(0,m.s)(t,u.typedBuffer,1/256,4,u.typedBufferStride)),c.push([B.r.COLOR,new z.n(t,i,4,!0)])}return{geometry:new U.V(t,c),vertexCount:r}}(e,null!=i?i:new H.$U({})),C=a.boundingInfo;null!=C&&0===x&&((0,d.iT)(b,C.bbMin),(0,d.iT)(b,C.bbMax)),null!=i&&(E.stageResources.geometries.push(a),E.numberOfVertices+=h)})),A||a.push(E)})),{engineResources:a,referenceBoundingBox:b}}(o,ee,re,t.skipHighLods&&null==r.specifiedLodIndex?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:r.specifiedLodIndex});return{lods:ie,referenceBoundingBox:ne,isEsriSymbolResource:o.meta.isEsriSymbolResource,isWosr:!1}}const te=(0,o.vt)()},46949:function(e,t,r){var i,n,s;r.d(t,{O7:function(){return n},Om:function(){return i},sv:function(){return s}}),function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"}(i||(i={})),function(e){e[e.MapLayer=0]="MapLayer",e[e.ViewLayer=1]="ViewLayer",e[e.Outline=2]="Outline",e[e.SnappingHint=3]="SnappingHint"}(n||(n={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(s||(s={}))},24129:function(e,t,r){r.d(t,{Gd:function(){return D},J_:function(){return L},VC:function(){return V},b3:function(){return z},s_:function(){return I},ul:function(){return U},wI:function(){return R}}),r(58941);var i,n,s,o=r(15774),a=r(44705),l=r(87725),c=r(73364),u=r(39714),h=r(20551),d=r(32501),p=r(85031),f=r(70974),m=r(39506);(s=i||(i={}))[s.Undefined=0]="Undefined",s[s.DefinedSize=1]="DefinedSize",s[s.DefinedScale=2]="DefinedScale",function(e){e[e.Undefined=0]="Undefined",e[e.DefinedAngle=1]="DefinedAngle"}(n||(n={}));class g{constructor(e){this.field=e}}class y extends g{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[i.Undefined,i.Undefined,i.Undefined]}}class _ extends g{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}}class v extends g{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}}class b{}function x(e){return null!=e}function S(e){return"number"==typeof e}function w(e){return"string"==typeof e}function T(e,t){e&&e.push(t)}function A(e,t,r,n,s){const o=e.minSize,a=e.maxSize;if(e.useSymbolValue){const e=n.symbolSize[r];return t.minSize[r]=e,t.maxSize[r]=e,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=i.DefinedSize,!0}if(x(e.field))return x(e.stops)?2===e.stops.length&&S(e.stops[0].size)&&S(e.stops[1].size)?(C(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,r),t.type[r]=i.DefinedSize,!0):(T(s,"Could not convert size info: stops only supported with 2 elements"),!1):S(o)&&S(a)&&x(e.minDataValue)&&x(e.maxDataValue)?(C(o,a,e.minDataValue,e.maxDataValue,t,r),t.type[r]=i.DefinedSize,!0):"unknown"===e.valueUnit?(T(s,"Could not convert size info: proportional size not supported"),!1):null!=p.j[e.valueUnit]?(t.minSize[r]=-1/0,t.maxSize[r]=1/0,t.offset[r]=0,t.factor[r]=1/p.j[e.valueUnit],t.type[r]=i.DefinedSize,!0):(T(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!x(e.field)){if(e.stops?.[0]&&S(e.stops[0].size))return t.minSize[r]=e.stops[0].size,t.maxSize[r]=e.stops[0].size,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=i.DefinedSize,!0;if(S(o))return t.minSize[r]=o,t.maxSize[r]=o,t.offset[r]=o,t.factor[r]=0,t.type[r]=i.DefinedSize,!0}return T(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function C(e,t,r,i,n,s){const o=Math.abs(i-r)>0?(t-e)/(i-r):0;n.minSize[s]=o>0?e:t,n.maxSize[s]=o>0?t:e,n.offset[s]=e-r*o,n.factor[s]=o}function E(e,t,r){e[4*t]=r.r/255,e[4*t+1]=r.g/255,e[4*t+2]=r.b/255,e[4*t+3]=r.a}function M(e,t,r){const i=2===r&&"arithmetic"===e.rotationType;t.offset[r]=i?90:0,t.factor[r]=i?-1:1,t.type[r]=1}class R{constructor(e,t=[1,1,1],r=[1,1,1],i=1,n=[0,0,0],s=[1,1,1],o=[0,0,0]){this.supports=e,this.modelSize=t,this.symbolSize=r,this.unitInMeters=i,this.anchor=n,this.scale=s,this.rotation=o}}function P(e,t,r){if(!e)return null;const n=e.reduce(((e,i)=>{if(!e)return e;if(i.valueExpression)return T(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(i.type){case"size":return t.supports.size?function(e,t,r,i){if(e.normalizationField||e.valueRepresentation)return T(i,"Could not convert size info: unsupported property"),null;if(!function(e){return null==e||w(e)}(e.field))return T(i,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return T(i,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size=new y(e.field);let n;switch(e.axis){case"width":return n=A(e,t.size,0,r,i),n?t:null;case"height":return n=A(e,t.size,2,r,i),n?t:null;case"depth":return n=A(e,t.size,1,r,i),n?t:null;case"width-and-depth":return n=A(e,t.size,0,r,i),n&&A(e,t.size,1,r,i),n?t:null;case null:case void 0:case"all":return n=A(e,t.size,0,r,i),n=n&&A(e,t.size,1,r,i),n=n&&A(e,t.size,2,r,i),n?t:null;default:return T(i,`Could not convert size info: unknown axis "${e.axis}""`),null}}(i,e,t,r):e;case"color":return t.supports.color?function(e,t,r){if(e.normalizationField)return T(r,"Could not convert color info: unsupported property"),null;if(w(e.field)){if(!e.stops)return T(r,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return T(r,"Could not convert color info: too many color stops"),null;t.color=new _(e.field);const i=e.stops;for(let e=0;e<8;++e){const r=i[Math.min(e,i.length-1)];t.color.values[e]=r.value,E(t.color.colors,e,r.color)}}}else{if(!(e.stops&&e.stops.length>=0))return T(r,"Could not convert color info: no field and no colors/stops"),null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.color.values[e]=1/0,E(t.color.colors,e,r)}}return t}(i,e,r):e;case"opacity":return t.supports.opacity?function(e,t,r){if(e.normalizationField)return T(r,"Could not convert opacity info: unsupported property"),null;if(w(e.field)){if(!e.stops)return T(r,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return T(r,"Could not convert opacity info: too many opacity stops"),null;t.opacity=new v(e.field);const i=e.stops;for(let e=0;e<8;++e){const r=i[Math.min(e,i.length-1)];t.opacity.values[e]=r.value,t.opacity.opacityValues[e]=r.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return T(r,"Could not convert opacity info: no field and no opacities/stops"),null;{const r=e.stops&&e.stops.length>=0?e.stops[0].opacity:0;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.opacity.values[e]=1/0,t.opacity.opacityValues[e]=r}}return t}(i,e,r):null;case"rotation":return t.supports.rotation?function(e,t,r){if(!w(e.field))return T(r,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return T(r,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return M(e,t.rotation,0),t;case"roll":return M(e,t.rotation,1),t;case null:case void 0:case"heading":return M(e,t.rotation,2),t;default:return T(r,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}(i,e,r):e;default:return null}}),new b);return!(e.length>0&&n)||n.size||n.color||n.opacity||n.rotation?n?.size&&!function(e,t,r){for(let r=0;r<3;++r){let n=t.unitInMeters;e.type[r]===i.DefinedSize&&(n*=t.modelSize[r],e.type[r]=i.DefinedScale),e.minSize[r]=e.minSize[r]/n,e.maxSize[r]=e.maxSize[r]/n,e.offset[r]=e.offset[r]/n,e.factor[r]=e.factor[r]/n}let n;if(e.type[0]!==i.Undefined)n=0;else if(e.type[1]!==i.Undefined)n=1;else{if(e.type[2]===i.Undefined)return T(r,"No size axis contains a valid size or scale"),!1;n=2}for(let t=0;t<3;++t)e.type[t]===i.Undefined&&(e.minSize[t]=e.minSize[n],e.maxSize[t]=e.maxSize[n],e.offset[t]=e.offset[n],e.factor[t]=e.factor[n],e.type[t]=e.type[n]);return!0}(n.size,t,r)?null:n:null}class O{constructor(e,t,r){this.visualVariables=e,this.materialParameters=t,this.requiresShaderTransformation=r}}function I(e,t){if(!e)return null;if(f.b.TESTS_DISABLE_FAST_UPDATES)return null;const r=P(e.visualVariables,t);return r?new O(r,F(r,t),!!r.size):null}function L(e,t,r){if(!t||!e)return!1;const i=e.visualVariables,n=P(t.visualVariables,r);return!!n&&!!(N(i.size,n.size,"size")&&N(i.color,n.color,"color")&&N(i.rotation,n.rotation,"rotation")&&N(i.opacity,n.opacity,"opacity"))&&(e.visualVariables=n,e.materialParameters=F(n,r),e.requiresShaderTransformation=!!n.size,!0)}function N(e,t,r){if(!!e!=!!t)return!1;if(e&&e.field!==t?.field)return!1;if(e&&"rotation"===r){const r=e,i=t;for(let e=0;e<3;e++)if(r.type[e]!==i.type[e]||r.offset[e]!==i.offset[e]||r.factor[e]!==i.factor[e])return!1}return!0}class D extends m.Y{constructor(e){super(),this.vvSize=e?.size??null,this.vvColor=e?.color??null,this.vvOpacity=e?.opacity??null}}function F(e,t){const r=new D(e);return r.vvSize&&(r.vvSymbolAnchor=t.anchor,(0,c.D_)(H),function(e,t,r,i=(0,u.vt)()){const n=e||0,s=t||0,o=r||0;0!==n&&(0,c.Qr)(i,i,-n/180*Math.PI),0!==s&&(0,c.eL)(i,i,s/180*Math.PI),0!==o&&(0,c.Z8)(i,i,o/180*Math.PI)}(t.rotation[2],t.rotation[0],t.rotation[1],H),r.vvSymbolRotationMatrix=r.vvSymbolRotationMatrix||(0,l.vt)(),(0,a.z0)(r.vvSymbolRotationMatrix,H)),r}function z(e,t,r){if(!e.vvSize)return r;(0,c.C)(G,r);const i=e.vvSymbolRotationMatrix;(0,c.hZ)(H,i[0],i[1],i[2],0,i[3],i[4],i[5],0,i[6],i[7],i[8],0,0,0,0,1),(0,c.lw)(G,G,H);for(let r=0;r<3;++r){const i=e.vvSize.offset[r]+t[0]*e.vvSize.factor[r];B[r]=(0,o.qE)(i,e.vvSize.minSize[r],e.vvSize.maxSize[r])}return(0,c.hs)(G,G,B),(0,c.Tl)(G,G,e.vvSymbolAnchor),G}function V(e,t,r){if(!t.vvSize)return(0,h.s)(e,1,1,1),e;for(let i=0;i<3;++i){const n=t.vvSize.offset[i]+r[0]*t.vvSize.factor[i];e[i]=(0,o.qE)(n,t.vvSize.minSize[i],t.vvSize.maxSize[i])}return e}function U(e,t){const r=null==e?0:t.attributes[e];return"number"==typeof r&&isFinite(r)?r:0}const G=(0,u.vt)(),B=(0,d.vt)(),H=(0,u.vt)()},26586:function(e,t,r){r.d(t,{Cc:function(){return p},CC:function(){return f},RF:function(){return d}});var i,n,s,o,a=r(52874),l=(r(58941),r(13520)),c=r(41546),u=r(33753),h=(r(82547),r(5161),r(77222),r(27264),r(52766),r(41356),r(65312));function d(e){return e&&e.enabled&&("extrude"===e.type||function(e){return"fill"===e.type}(e))&&null!=e.edges}function p(e,t){return function(e,t){if(null==e)return null;const r=null!=e.color?(0,c.ci)(a.A.toUnitRGBA(e.color)):(0,c.fA)(0,0,0,0),i=(0,l.Lz)(e.size),n=(0,l.Lz)(e.extensionLength);switch(e.type){case"solid":return f({color:r,size:i,extensionLength:n,...t});case"sketch":return function(e){return{...g,...e,type:s.Sketch}}({color:r,size:i,extensionLength:n,...t});default:return}}(function(e){return e&&e.enabled&&e.edges||null}(e),t)}function f(e){return{...m,...e,type:s.Solid}}r(54516),h.n,r(39506),r(40075),r(65839),(n=i||(i={}))[n.Uniform=0]="Uniform",n[n.Varying=1]="Varying",n[n.COUNT=2]="COUNT",r(11377),r(90576),r(4435),r(82598),r(14543),r(31190),r(78567),r(70340),function(e){e[e.Solid=0]="Solid",e[e.Sketch=1]="Sketch",e[e.Mixed=2]="Mixed",e[e.COUNT=3]="COUNT"}(s||(s={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.SILHOUETTE=1]="SILHOUETTE"}(o||(o={}));const m={color:(0,c.fA)(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:u.x.OPAQUE,hasSlicePlane:!1},g={color:(0,c.fA)(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:u.x.OPAQUE,hasSlicePlane:!1}},9933:function(e,t,r){r.d(t,{Eb:function(){return o},_j:function(){return a},k5:function(){return i}});var i,n,s=r(15774);function o(e){switch(e){case"multiply":default:return i.Multiply;case"ignore":return i.Ignore;case"replace":return i.Replace;case"tint":return i.Tint}}function a(e,t,r){if(null==e||t===i.Ignore)return r[0]=255,r[1]=255,r[2]=255,void(r[3]=255);const n=(0,s.qE)(Math.round(e[3]*c),0,c),o=0===n||t===i.Tint?0:t===i.Replace?u:h;r[0]=(0,s.qE)(Math.round(e[0]*l),0,l),r[1]=(0,s.qE)(Math.round(e[1]*l),0,l),r[2]=(0,s.qE)(Math.round(e[2]*l),0,l),r[3]=n+o}(n=i||(i={}))[n.Multiply=1]="Multiply",n[n.Ignore=2]="Ignore",n[n.Replace=3]="Replace",n[n.Tint=4]="Tint";const l=255,c=85,u=c,h=2*c},60516:function(e,t,r){r.d(t,{R1:function(){return o},aY:function(){return n},cN:function(){return s}});var i=r(5915);class n{constructor(e,t=null,r=0){this.array=e,this.spatialReference=t,this.offset=r}}function s(e){return"array"in e}function o(e,t,r="ground"){if((0,i.v)(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,r);if(s(t)){let i=t.offset;return e.getElevation(t.array[i++],t.array[i++],t.array[i]||0,t.spatialReference??e.spatialReference,r)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,r)}},65856:function(e,t,r){r.d(t,{BP:function(){return l},l5:function(){return c},q3:function(){return a}});var i=r(92754),n=r(28404),s=r(90553);class o{constructor(e,t){this.layout=e,this.buffer="number"==typeof t?new ArrayBuffer(t*e.stride):t;for(const t of e.fields.keys()){const r=e.fields.get(t);this[t]=new r.constructor(this.buffer,r.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,t){const r=this[e];return r&&r.elementCount===t.ElementCount&&r.elementType===t.ElementType?r:null}slice(e,t){return new o(this.layout,this.buffer.slice(e*this.stride,t*this.stride))}copyFrom(e,t=0,r=0,i=e.count){const n=this.stride;if(n%4==0){const s=new Uint32Array(e.buffer,t*n,i*n/4);new Uint32Array(this.buffer,r*n,i*n/4).set(s)}else{const s=new Uint8Array(e.buffer,t*n,i*n);new Uint8Array(this.buffer,r*n,i*n).set(s)}return this}get usedMemory(){return this.byteLength}dispose(){}}class a{constructor(e=null){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach((e=>this._fields.set(e[0],{...e[1],constructor:d(e[1].constructor)}))))}freeze(){return this}vec2f(e,t){return this._appendField(e,i.gH,t),this}vec2f64(e,t){return this._appendField(e,i.si,t),this}vec3f(e,t){return this._appendField(e,i.xs,t),this}vec3f64(e,t){return this._appendField(e,i.Xm,t),this}vec4f(e,t){return this._appendField(e,i.Eq,t),this}vec4f64(e,t){return this._appendField(e,i.Aj,t),this}mat3f(e,t){return this._appendField(e,i.jZ,t),this}mat3f64(e,t){return this._appendField(e,i.j0,t),this}mat4f(e,t){return this._appendField(e,i.Sx,t),this}mat4f64(e,t){return this._appendField(e,i.E$,t),this}vec4u8(e,t){return this._appendField(e,i.XP,t),this}f32(e,t){return this._appendField(e,i.Y$,t),this}f64(e,t){return this._appendField(e,i.qB,t),this}u8(e,t){return this._appendField(e,i.SL,t),this}u16(e,t){return this._appendField(e,i.h,t),this}i8(e,t){return this._appendField(e,i.bf,t),this}vec2i8(e,t){return this._appendField(e,i.D6,t),this}vec2i16(e,t){return this._appendField(e,i.mJ,t),this}vec2u8(e,t){return this._appendField(e,i.LC,t),this}vec4u16(e,t){return this._appendField(e,i.Uz,t),this}u32(e,t){return this._appendField(e,i.P,t),this}_appendField(e,t,r){if(this._fields.has(e))return void(0,s.vA)(!1,`${e} already added to vertex buffer layout`);const i=t.ElementCount*(0,n.GJ)(t.ElementType),o=this._stride;this._stride+=i,this._fields.set(e,{size:i,constructor:t,offset:o,optional:r})}createBuffer(e){return new o(this,e)}createView(e){return new o(this,e)}clone(){const e=new a;return e._stride=this._stride,e._fields=new Map,this._fields.forEach(((t,r)=>e._fields.set(r,t))),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach((t=>e=Math.max(e,(0,n.GJ)(t.constructor.ElementType)))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}}function l(){return new a}class c{constructor(e){this.fields=new Array,e.fields.forEach(((e,t)=>{const r={...e,constructor:h(e.constructor)};this.fields.push([t,r])})),this.stride=e.stride}}const u=[i.Y$,i.gH,i.xs,i.Eq,i.jZ,i.Sx,i.qB,i.si,i.Xm,i.Aj,i.j0,i.E$,i.SL,i.LC,i.eI,i.XP,i.h,i.Yi,i.nS,i.Uz,i.P,i.An,i.H$,i.ml,i.bf,i.D6,i.m8,i.TX,i.Qt,i.mJ,i.Vp,i.E7,i.My,i.UL,i.zD,i.Y4];function h(e){return`${e.ElementType}_${e.ElementCount}`}function d(e){return p.get(e)}const p=new Map;u.forEach((e=>p.set(h(e),e)))},69550:function(e,t,r){r.d(t,{U:function(){return s}});var i=r(85456),n=r(3817);function s(e,t=0){const r=e.stride;return Array.from(e.fields.keys()).map((i=>{const s=e.fields.get(i),a=s.constructor.ElementCount,l=o(s.constructor.ElementType),c=s.offset,u=s.optional?.glNormalized??!1;return new n._(i,a,l,c,r,u,t)}))}function o(e){const t=a[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const a={u8:i.pe.UNSIGNED_BYTE,u16:i.pe.UNSIGNED_SHORT,u32:i.pe.UNSIGNED_INT,i8:i.pe.BYTE,i16:i.pe.SHORT,i32:i.pe.INT,f32:i.pe.FLOAT}},70974:function(e,t,r){r.d(t,{b:function(){return l}});var i=r(53804),n=r(83525),s=r(23502),o=(r(58941),r(40633),r(13798),r(65953));let a=class extends n.A{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};(0,i._)([(0,s.MZ)()],a.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"DECONFLICTOR_SHOW_GRID",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"LABELS_SHOW_BORDER",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"TEXT_SHOW_BASELINE",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"TEXT_SHOW_BORDER",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"OVERLAY_SHOW_CENTER",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"SHOW_POI",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"I3S_TREE_SHOW_TILES",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"I3S_SHOW_MODIFICATIONS",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"LINE_WIREFRAMES",void 0),a=(0,i._)([(0,o.$)("esri.views.3d.support.debugFlags")],a);const l=new a},79366:function(e,t,r){r.d(t,{t:function(){return g},z:function(){return v}});var i=r(13786),n=r(1932),s=r(41546),o=r(61714),a=r(61441),l=r(50240),c=r(5047),u=r(37819),h=r(65420),d=r(14905),p=r(40359),f=r(40321),m=r(65839);function g(e,t,r=null){const n=[],g=t.mapPositions;!function(e,t){const{attributeData:{position:r},removeDuplicateStartEnd:i}=e,n=function(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}(r)&&i,s=r.length/3-(n?1:0),o=new Array(2*(s-1)),a=n?r.slice(0,-3):r;let l=0;for(let e=0;e<s-1;e++)o[l++]=e,o[l++]=e+1;t.push([m.r.POSITION,new d.n(a,o,3,n)])}(t,n);const v=n[0][1].data,b=n[0][1].indices.length,x=(0,u.EH)(b);return function(e,t,r){if(null!=e.attributeData.colorFeature)return;const i=e.attributeData.color;t.push([m.r.COLOR,new d.n(i??s.Un,r,4)])}(t,n,x),function(e,t,r){null==e.attributeData.sizeFeature&&t.push([m.r.SIZE,new d.n([e.attributeData.size??1],r,1,!0)])}(t,n,x),function(e,t,r){e.attributeData.normal&&t.push([m.r.NORMAL,new d.n(e.attributeData.normal,r,3)])}(t,n,x),function(e,t,r){null!=e.attributeData.colorFeature&&t.push([m.r.COLORFEATUREATTRIBUTE,new d.n([e.attributeData.colorFeature],r,1,!0)])}(t,n,x),function(e,t,r){null!=e.attributeData.sizeFeature&&t.push([m.r.SIZEFEATUREATTRIBUTE,new d.n([e.attributeData.sizeFeature],r,1,!0)])}(t,n,x),function(e,t,r){null!=e.attributeData.opacityFeature&&t.push([m.r.OPACITYFEATUREATTRIBUTE,new d.n([e.attributeData.opacityFeature],r,1,!0)])}(t,n,x),function(e,t,r){if(null==e.overlayInfo||e.overlayInfo.renderCoordsHelper.viewingMode!==h.RT.Global||!e.overlayInfo.spatialReference.isGeographic)return;const n=(0,l.jh)(r.length),s=(0,o.tO)(e.overlayInfo.spatialReference);for(let e=0;e<n.length;e+=3)(0,a.RC)(r,e,n,e,s);const u=r.length/3,p=(0,c.oe)(u+1);let f=y,g=_,v=0,b=0;(0,i.hZ)(f,n[b++],n[b++]),b++,p[0]=0;for(let e=1;e<u+1;++e)e===u&&(b=0),(0,i.hZ)(g,n[b++],n[b++]),b++,v+=(0,i.xg)(f,g),p[e]=v,[f,g]=[g,f];t.push([m.r.DISTANCETOSTART,new d.n(p,t[0][1].indices,1,!0)])}(t,n,v),new f.V(e,n,g,p.X.Line,r)}const y=(0,n.vt)(),_=(0,n.vt)();function v(e,t){if(null==e||0===e.length)return[];const r=[];return e.forEach((e=>{const i=e.length,n=(0,l.jh)(3*i);e.forEach(((e,t)=>{n[3*t]=e[0],n[3*t+1]=e[1],n[3*t+2]=e[2]}));const s={attributeData:{position:n,normal:t},removeDuplicateStartEnd:!1};r.push(s)})),r}},33710:function(e,t,r){r.d(t,{Cz:function(){return n},DZ:function(){return o},PV:function(){return s},vO:function(){return i}}),r(98323),r(85456),r(78541),r(10956);const i=64,n=i/2,s=i/(n/5),o=.25},98323:function(e,t,r){r.d(t,{CN:function(){return a},Q_:function(){return o},ny:function(){return l},sZ:function(){return c}}),r(58941);var i=r(5161),n=r(59552),s=r(85456);const o=128,a=.5;function l(e){return"cross"===e||"x"===e}function c(e,t=o,r=t*a,i=0){const l=function(e,t=o,r=t*a,i=0){switch(e){case"circle":default:return function(e,t){const r=e/2-.5;return f(e,d(r,r,t/2))}(t,r);case"square":return function(e,t){return u(e,t,!1)}(t,r);case"cross":return function(e,t,r=0){return h(e,t,!1,r)}(t,r,i);case"x":return function(e,t,r=0){return h(e,t,!0,r)}(t,r,i);case"kite":return function(e,t){return u(e,t,!0)}(t,r);case"triangle":return function(e,t){return f(e,p(e/2,t,t/2))}(t,r);case"arrow":return function(e,t){const r=t,i=t/2,n=e/2,s=.8*r,o=d(n,(e-t)/2-s,Math.sqrt(s*s+i*i)),a=p(n,r,i);return f(e,((e,t)=>Math.max(a(e,t),-o(e,t))))}(t,r)}}(e,t,r,i);return new n.g(l,{mipmap:!1,wrap:{s:s.pF.CLAMP_TO_EDGE,t:s.pF.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0,reloadable:!0})}function u(e,t,r){return r&&(t/=Math.SQRT2),f(e,((i,n)=>{let s=i-.5*e+.25,o=.5*e-n-.75;if(r){const e=(s+o)/Math.SQRT2;o=(o-s)/Math.SQRT2,s=e}return Math.max(Math.abs(s),Math.abs(o))-.5*t}))}function h(e,t,r,i=0){t-=i,r&&(t*=Math.SQRT2);const n=.5*t;return f(e,((t,s)=>{let o,a=t-.5*e,l=.5*e-s-1;if(r){const e=(a+l)/Math.SQRT2;l=(l-a)/Math.SQRT2,a=e}return a=Math.abs(a),l=Math.abs(l),o=a>l?a>n?Math.sqrt((a-n)*(a-n)+l*l):l:l>n?Math.sqrt(a*a+(l-n)*(l-n)):a,o-=i/2,o}))}function d(e,t,r){return(i,n)=>{const s=i-e,o=n-t;return Math.sqrt(s*s+o*o)-r}}function p(e,t,r){const i=Math.sqrt(t*t+r*r);return(n,s)=>{const o=Math.abs(n-e)-r,a=s-e+t/2+.75,l=(t*o+r*a)/i,c=-a;return Math.max(l,c)}}function f(e,t){const r=new Uint8Array(4*e*e);for(let n=0;n<e;n++)for(let s=0;s<e;s++){const o=s+e*n;let a=t(s,n);a=a/e+.5,(0,i.U)(a,r,4*o)}return r}},89765:function(e,t,r){r.d(t,{ab:function(){return be},gm:function(){return Pe}});var i=r(44705),n=r(87725),s=r(39714),o=r(32237),a=r(61769),l=r(20551),c=r(32501),u=r(33400),h=r(41546),d=r(61714),p=r(96611),f=r(7456),m=r(57617),g=r(61441),y=r(5596),_=r(57652),v=r(50973),b=r(65420),x=r(1932),S=r(14905);const w=1e-6,T=(0,c.vt)(),A=(0,c.vt)();function C(e,t,r,i,n,s,o,a,l,c){return function(e,t,r){let i=_e(e.maxVert[0],e.minVert[0]),n=0;for(let t=1;t<7;++t){const r=_e(e.maxVert[t],e.minVert[t]);r>i&&(i=r,n=t)}fe(t,e.minVert[n]),fe(r,e.maxVert[n])}(e,i,n),_e(i,n)<w?1:(de(o,i,n),ge(o,o),function(e,t,r,i){const{data:n,size:s}=e;let o=Number.NEGATIVE_INFINITY,a=0;for(let e=0;e<n.length;e+=s){F[0]=n[e]-t[0],F[1]=n[e+1]-t[1],F[2]=n[e+2]-t[2];const i=r[0]*F[0]+r[1]*F[1]+r[2]*F[2],s=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],l=F[0]*F[0]+F[1]*F[1]+F[2]*F[2]-i*i/s;l>o&&(o=l,a=e)}return fe(i,n,a),o}(t,i,o,s)<w?2:(de(a,n,s),ge(a,a),de(l,s,i),ge(l,l),me(r,a,o),ge(r,r),j(t,r,o,a,l,c),0))}const E=(0,c.vt)(),M=(0,c.vt)(),R=(0,c.vt)(),P=(0,c.vt)(),O=(0,c.vt)(),I=(0,c.vt)(),L=(0,c.vt)(),N=(0,c.vt)();function D(e,t,r,i,n,s,o,a,l){(function(e,t,r,i,n){!function(e,t,r,i,n){const{data:s,size:o}=e;fe(i,s),fe(n,i),r[0]=ve(W,t),r[1]=r[0];for(let e=o;e<s.length;e+=o){const o=s[e]*t[0]+s[e+1]*t[1]+s[e+2]*t[2];o<r[0]&&(r[0]=o,fe(i,s,e)),o>r[1]&&(r[1]=o,fe(n,s,e))}}(e,t,z,n,i);const s=ve(r,t);z[1]-w<=s&&(i[0]=void 0),z[0]+w>=s&&(n[0]=void 0)})(e,t,r,E,M),void 0!==E[0]&&(de(R,E,r),ge(R,R),de(P,E,i),ge(P,P),de(O,E,n),ge(O,O),me(I,P,s),ge(I,I),me(L,O,o),ge(L,L),me(N,R,a),ge(N,N),j(e,I,s,P,R,l),j(e,L,o,O,P,l),j(e,N,a,R,O,l)),void 0!==M[0]&&(de(R,M,r),ge(R,R),de(P,M,i),ge(P,P),de(O,M,n),ge(O,O),me(I,P,s),ge(I,I),me(L,O,o),ge(L,L),me(N,R,a),ge(N,N),j(e,I,s,P,R,l),j(e,L,o,O,P,l),j(e,N,a,R,O,l))}const F=[0,0,0],z=(0,x.vt)(),V=(0,c.vt)(),U=(0,c.vt)(),G=(0,c.vt)(),B=(0,c.vt)(),H=(0,c.vt)(),k=(0,c.vt)();function j(e,t,r,i,n,s){if(ye(t)<w)return;me(V,r,t),me(U,i,t),me(G,n,t),q(e,t,z),H[1]=z[0],B[1]=z[1],k[1]=B[1]-H[1];const o=[r,i,n],a=[V,U,G];for(let r=0;r<3;++r){q(e,o[r],z),H[0]=z[0],B[0]=z[1],q(e,a[r],z),H[2]=z[0],B[2]=z[1],k[0]=B[0]-H[0],k[2]=B[2]-H[2];const i=ue(k);i<s.quality&&(fe(s.b0,o[r]),fe(s.b1,t),fe(s.b2,a[r]),s.quality=i)}}const W=(0,c.vt)();function q(e,t,r){const{data:i,size:n}=e;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let e=0;e<i.length;e+=n){const n=i[e]*t[0]+i[e+1]*t[1]+i[e+2]*t[2];r[0]=Math.min(r[0],n),r[1]=Math.max(r[1],n)}}function Z(e,t,r){r.center=e,r.halfSize=(0,l.j)(t,t,.5),r.quaternion=a.zK}const $=(0,c.vt)(),Y=(0,c.vt)(),X=(0,c.vt)(),J=(0,c.vt)(),Q=(0,c.vt)(),K=(0,c.vt)();function ee(e,t,r){fe($,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?$[0]=0:Math.abs(t[1])>Math.abs(t[2])?$[1]=0:$[2]=0,ye($)<w&&($[0]=$[1]=$[2]=1),me(Y,t,$),ge(Y,Y),me(X,t,Y),ge(X,X),te(e,t,Y,X,J,Q),de(K,Q,J),ae(t,Y,X,J,Q,K,r)}function te(e,t,r,i,n,s){q(e,t,z),n[0]=z[0],s[0]=z[1],q(e,r,z),n[1]=z[0],s[1]=z[1],q(e,i,z),n[2]=z[0],s[2]=z[1]}const re=(0,c.vt)(),ie=(0,c.vt)(),ne=(0,c.vt)(),se=(0,n.fA)(1,0,0,0,1,0,0,0,1),oe=(0,a.vt)();function ae(e,t,r,i,n,s,o){se[0]=e[0],se[1]=e[1],se[2]=e[2],se[3]=t[0],se[4]=t[1],se[5]=t[2],se[6]=r[0],se[7]=r[1],se[8]=r[2],o.quaternion=function(e,t){const r=t[0]+t[4]+t[8];if(r>0){let i=Math.sqrt(r+1);e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i}else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);const i=(r+1)%3,n=(r+2)%3;let s=Math.sqrt(t[3*r+r]-t[3*i+i]-t[3*n+n]+1);e[r]=.5*s,s=.5/s,e[3]=(t[3*i+n]-t[3*n+i])*s,e[i]=(t[3*i+r]+t[3*r+i])*s,e[n]=(t[3*n+r]+t[3*r+n])*s}return e}(oe,se),he(re,i,n),pe(re,re,.5),pe(ie,e,re[0]),pe(ne,t,re[1]),he(ie,ie,ne),pe(ne,r,re[2]),o.center=(0,l.g)(ie,ie,ne),o.halfSize=(0,l.j)(re,s,.5)}class le{constructor(e){this.minVert=new Array(7),this.maxVert=new Array(7),this.buffer=new ArrayBuffer(448);let t=0;this.minProj=new Float64Array(this.buffer,t,7),t+=56,this.maxProj=new Float64Array(this.buffer,t,7),t+=56;for(let e=0;e<7;++e)this.minVert[e]=new Float64Array(this.buffer,t,3),t+=24;for(let e=0;e<7;++e)this.maxVert[e]=new Float64Array(this.buffer,t,3),t+=24;for(let e=0;e<7;++e)this.minProj[e]=Number.POSITIVE_INFINITY,this.maxProj[e]=Number.NEGATIVE_INFINITY;const r=new Array(7),i=new Array(7),{data:n,size:s}=e;for(let e=0;e<n.length;e+=s){let t=n[e];t<this.minProj[0]&&(this.minProj[0]=t,r[0]=e),t>this.maxProj[0]&&(this.maxProj[0]=t,i[0]=e),t=n[e+1],t<this.minProj[1]&&(this.minProj[1]=t,r[1]=e),t>this.maxProj[1]&&(this.maxProj[1]=t,i[1]=e),t=n[e+2],t<this.minProj[2]&&(this.minProj[2]=t,r[2]=e),t>this.maxProj[2]&&(this.maxProj[2]=t,i[2]=e),t=n[e]+n[e+1]+n[e+2],t<this.minProj[3]&&(this.minProj[3]=t,r[3]=e),t>this.maxProj[3]&&(this.maxProj[3]=t,i[3]=e),t=n[e]+n[e+1]-n[e+2],t<this.minProj[4]&&(this.minProj[4]=t,r[4]=e),t>this.maxProj[4]&&(this.maxProj[4]=t,i[4]=e),t=n[e]-n[e+1]+n[e+2],t<this.minProj[5]&&(this.minProj[5]=t,r[5]=e),t>this.maxProj[5]&&(this.maxProj[5]=t,i[5]=e),t=n[e]-n[e+1]-n[e+2],t<this.minProj[6]&&(this.minProj[6]=t,r[6]=e),t>this.maxProj[6]&&(this.maxProj[6]=t,i[6]=e)}for(let e=0;e<7;++e){let t=r[e];fe(this.minVert[e],n,t),t=i[e],fe(this.maxVert[e],n,t)}}}class ce{constructor(){this.b0=(0,c.fA)(1,0,0),this.b1=(0,c.fA)(0,1,0),this.b2=(0,c.fA)(0,0,1),this.quality=0}}function ue(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function he(e,t,r){e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2]}function de(e,t,r){e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2]}function pe(e,t,r){e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}function fe(e,t,r=0){e[0]=t[r],e[1]=t[r+1],e[2]=t[r+2]}function me(e,t,r){const i=t[0],n=t[1],s=t[2],o=r[0],a=r[1],l=r[2];e[0]=n*l-s*a,e[1]=s*o-i*l,e[2]=i*a-n*o}function ge(e,t){const r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(r>0){const i=1/Math.sqrt(r);e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}}function ye(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function _e(e,t){const r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return r*r+i*i+n*n}function ve(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}class be{constructor(e=c.uY,t=je,r=a.zK){this._data=[e[0],e[1],e[2],t[0],t[1],t[2],r[0],r[1],r[2],r[3]]}clone(){const e=new be;return e._data=this._data.slice(),e}invalidate(){this._data[3]=-1}get isValid(){return this._data[3]>=0}static fromData(e){const t=new be;return t._data=e.slice(),t}static fromJSON(e){return new be(e.center,e.halfSize,e.quaternion)}copy(e){this._data=e.data.slice()}get center(){return(0,l.s)(v.rq.get(),this._data[0],this._data[1],this._data[2])}get centerX(){return this._data[0]}get centerY(){return this._data[1]}get centerZ(){return this._data[2]}getCenter(e){return e[0]=this._data[0],e[1]=this._data[1],e[2]=this._data[2],e}set center(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2]}setCenter(e,t,r){this._data[0]=e,this._data[1]=t,this._data[2]=r}get halfSize(){return(0,l.s)(v.rq.get(),this._data[3],this._data[4],this._data[5])}get halfSizeX(){return this._data[3]}get halfSizeY(){return this._data[4]}get halfSizeZ(){return this._data[5]}getHalfSize(e){return e[0]=this._data[3],e[1]=this._data[4],e[2]=this._data[5],e}set halfSize(e){this._data[3]=e[0],this._data[4]=e[1],this._data[5]=e[2]}get quaternion(){return(0,o.hZ)(v.J8.get(),this._data[6],this._data[7],this._data[8],this._data[9])}getQuaternion(e){return e[0]=this._data[6],e[1]=this._data[7],e[2]=this._data[8],e[3]=this._data[9],e}set quaternion(e){this._data[6]=e[0],this._data[7]=e[1],this._data[8]=e[2],this._data[9]=e[3]}get data(){return this._data}getCorners(e){const t=xe,r=this._data;t[0]=r[6],t[1]=r[7],t[2]=r[8],t[3]=r[9];for(let i=0;i<8;++i){const n=e[i];n[0]=(1&i?-1:1)*r[3],n[1]=(2&i?-1:1)*r[4],n[2]=(4&i?-1:1)*r[5],(0,l.u)(n,n,t),n[0]+=r[0],n[1]+=r[1],n[2]+=r[2]}}doesIntersectFrustumConservativeApproximation(e){return this.intersectPlane(e[0])<=0&&this.intersectPlane(e[1])<=0&&this.intersectPlane(e[2])<=0&&this.intersectPlane(e[3])<=0&&this.intersectPlane(e[4])<=0&&this.intersectPlane(e[5])<=0}get radius(){const e=this._data[3],t=this._data[4],r=this._data[5];return Math.sqrt(e*e+t*t+r*r)}intersectSphere(e){Te[0]=this._data[0]-e[0],Te[1]=this._data[1]-e[1],Te[2]=this._data[2]-e[2];const t=this.getQuaternion(Se);return(0,o.Xr)(xe,t),(0,l.u)(Te,Te,xe),(0,l.v)(Te,Te),Ae[0]=Math.min(Te[0],this._data[3]),Ae[1]=Math.min(Te[1],this._data[4]),Ae[2]=Math.min(Te[2],this._data[5]),(0,l.w)(Ae,Te)<e[3]*e[3]}intersectSphereWithMBS(e,t=this.radius){const r=this._data;Te[0]=r[0]-e[0],Te[1]=r[1]-e[1],Te[2]=r[2]-e[2];const i=e[3],n=i+t;return!((0,l.x)(Te)>n*n)&&(xe[0]=-r[6],xe[1]=-r[7],xe[2]=-r[8],xe[3]=r[9],(0,l.u)(Te,Te,xe),(0,l.v)(Te,Te),Ae[0]=Math.min(Te[0],r[3]),Ae[1]=Math.min(Te[1],r[4]),Ae[2]=Math.min(Te[2],r[5]),(0,l.w)(Ae,Te)<i*i)}intersectPlane(e){const t=e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3],r=this.projectedRadius((0,y.Qj)(e));return t>r?1:t<-r?-1:0}intersectRay(e,t,r=0){const i=this._data,n=xe;n[0]=-i[6],n[1]=-i[7],n[2]=-i[8],n[3]=i[9],Te[0]=e[0]-i[0],Te[1]=e[1]-i[1],Te[2]=e[2]-i[2];const s=(0,l.u)(Te,Te,xe),o=(0,l.u)(Ae,t,xe);let a=-1/0,c=1/0;const u=this.getHalfSize(ze);for(let e=0;e<3;e++){const t=s[e],i=o[e],n=u[e]+r;if(Math.abs(i)>1e-6){const e=(n-t)/i,r=(-n-t)/i;a=Math.max(a,Math.min(e,r)),c=Math.min(c,Math.max(e,r))}else if(t>n||t<-n)return!1}return a<=c}projectedArea(e,t,r,n){const s=this.getQuaternion(Se);(0,o.Xr)(xe,s),Te[0]=e[0]-this._data[0],Te[1]=e[1]-this._data[1],Te[2]=e[2]-this._data[2],(0,l.u)(Te,Te,xe);const a=this.getHalfSize(ze),c=Te[0]<-a[0]?-1:Te[0]>a[0]?1:0,h=Te[1]<-a[1]?-1:Te[1]>a[1]?1:0,d=Te[2]<-a[2]?-1:Te[2]>a[2]?1:0,p=Math.abs(c)+Math.abs(h)+Math.abs(d);if(0===p)return 1/0;const f=1===p?4:6,m=6*(c+3*h+9*d+13);(0,i.I0)(Ve,s),(0,i.hs)(Ve,Ve,a);const g=this.getCenter(De);for(let e=0;e<f;e++){const r=Re[m+e];(0,l.s)(Te,((1&r)<<1)-1,(2&r)-1,((4&r)>>1)-1),(0,l.t)(Te,Te,Ve),(0,l.g)(Ce,g,Te),Ce[3]=1,(0,u.t)(Ce,Ce,t);const i=1/Math.max(1e-6,Ce[3]);Me[2*e]=Ce[0]*i,Me[2*e+1]=Ce[1]*i}const y=2*f-2;let _=Me[0]*(Me[3]-Me[y+1])+Me[y]*(Me[1]-Me[y-1]);for(let e=2;e<y;e+=2)_+=Me[e]*(Me[e+3]-Me[e-1]);return Math.abs(_)*r*n*.125}projectedRadius(e){const t=this.getQuaternion(Se);return(0,o.Xr)(xe,t),(0,l.u)(Te,e,xe),Math.abs(Te[0]*this._data[3])+Math.abs(Te[1]*this._data[4])+Math.abs(Te[2]*this._data[5])}minimumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]-this.projectedRadius((0,y.Qj)(e))}maximumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]+this.projectedRadius((0,y.Qj)(e))}toAaBoundingBox(e){const t=this.getQuaternion(Se),r=(0,i.I0)(Ve,t),n=this._data[3]*Math.abs(r[0])+this._data[4]*Math.abs(r[3])+this._data[5]*Math.abs(r[6]),s=this._data[3]*Math.abs(r[1])+this._data[4]*Math.abs(r[4])+this._data[5]*Math.abs(r[7]),o=this._data[3]*Math.abs(r[2])+this._data[4]*Math.abs(r[5])+this._data[5]*Math.abs(r[8]);e[0]=this._data[0]-n,e[1]=this._data[1]-s,e[2]=this._data[2]-o,e[3]=this._data[0]+n,e[4]=this._data[1]+s,e[5]=this._data[2]+o}transform(e,t,r,i=0,n=(0,p.lO)(r),s=(0,p.lO)(t),a=(0,g.jd)(t,s)){if(r===n)t.isGeographic?function(e,t,r,i,n=(0,p.lO)(r)){const s=(0,d.tO)(r),a=1+Math.max(0,i)/(s.radius+e.centerZ);e.getCenter(Ne),Ne[2]+=i,(0,m.projectBuffer)(Ne,r,0,Ne,n,0,1),t.center=Ne;const c=e.getQuaternion(Se);t.quaternion=c,(0,o.Xr)(xe,c),(0,l.s)(Be,0,0,1),(0,l.u)(Be,Be,xe);const u=e.getHalfSize(ze);(0,l.s)(Be,u[0]*Math.abs(Be[0]),u[1]*Math.abs(Be[1]),u[2]*Math.abs(Be[2])),(0,l.j)(Be,Be,s.inverseFlattening),(0,l.g)(Be,u,Be),t.halfSize=(0,l.j)(Be,Be,a)}(this,e,t,i,s):function(e,t,r,i,n=(0,p.lO)(r),s=(0,g.jd)(r,n)){e.getCorners(Ge),e.getCenter(Ne),Ne[2]+=i,(0,f.l)(r,Ne,Ue,n),t.setCenter(Ue[12],Ue[13],Ue[14]);const a=2*Math.sqrt(1+Ue[0]+Ue[5]+Ue[10]);xe[0]=(Ue[6]-Ue[9])/a,xe[1]=(Ue[8]-Ue[2])/a,xe[2]=(Ue[1]-Ue[4])/a,xe[3]=.25*a;const c=e.getQuaternion(Se);t.quaternion=(0,o.lw)(xe,xe,c),(0,o.Xr)(xe,xe),(0,l.s)(He,0,0,0);const u=t.getCenter(Fe);for(const e of Ge)e[2]+=i,s(e,0,e,0),(0,l.z)(Be,e,u),(0,l.u)(Be,Be,xe),(0,l.v)(Be,Be),(0,l.C)(He,He,Be);t.halfSize=He}(this,e,t,i,s,a);else if(t.isWGS84&&(r.isWebMercator||(0,_.r1)(r)))!function(e,t,r,i,n){t.getCenter(De),De[2]+=n;const s=(0,p.lO)(r);(0,m.projectBuffer)(De,e,0,De,s,0,1),Oe(s,t,De,r,i)}(t,this,r,e,i);else if(t.isWebMercator&&(0,_.r1)(r))!function(e,t,r,i,n){t.getCenter(De),De[2]+=n,Oe(e,t,De,r,i)}(t,this,r,e,i);else{const n=this.getCenter(De);n[2]+=i,(0,m.projectBuffer)(n,t,0,n,r,0,1),e.center=n,this!==e&&(e.quaternion=this.getQuaternion(Se),e.halfSize=this.getHalfSize(ze))}}}const xe=(0,a.vt)(),Se=(0,a.vt)(),we=(0,a.vt)(),Te=(0,c.vt)(),Ae=(0,c.vt)(),Ce=(0,h.vt)();function Ee(e,t=new be){return function(e,t){const{data:r,size:i}=e,n=r.length/i;if(n<=0)return;const s=new le(e);he(T,s.minProj,s.maxProj),pe(T,T,.5),de(A,s.maxProj,s.minProj);const o=ue(A),a=new ce;a.quality=o,n<14&&(e=new S.K(new Float64Array(s.buffer,112,42),3));const l=(0,c.vt)(),u=(0,c.vt)(),h=(0,c.vt)(),d=(0,c.vt)(),p=(0,c.vt)(),f=(0,c.vt)(),m=(0,c.vt)();switch(C(s,e,m,l,u,h,d,p,f,a)){case 1:return void Z(T,A,t);case 2:return void ee(e,d,t)}D(e,m,l,u,h,d,p,f,a),te(e,a.b0,a.b1,a.b2,J,Q);const g=(0,c.vt)();de(g,Q,J),a.quality=ue(g),a.quality<o?ae(a.b0,a.b1,a.b2,J,Q,g,t):Z(T,A,t)}(e,t),t}const Me=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],Re=(()=>{const e=new Int8Array(162);let t=0;const r=r=>{for(let i=0;i<r.length;i++)e[t+i]=r[i];t+=6};return r([6,2,3,1,5,4]),r([0,2,3,1,5,4]),r([0,2,3,7,5,4]),r([0,1,3,2,6,4]),r([0,1,3,2,0,0]),r([0,1,5,7,3,2]),r([0,1,3,7,6,4]),r([0,1,3,7,6,2]),r([0,1,5,7,6,2]),r([0,1,5,4,6,2]),r([0,1,5,4,0,0]),r([0,1,3,7,5,4]),r([0,2,6,4,0,0]),r([0,0,0,0,0,0]),r([1,3,7,5,0,0]),r([2,3,7,6,4,0]),r([2,3,7,6,0,0]),r([2,3,1,5,7,6]),r([0,1,5,7,6,2]),r([0,1,5,7,6,4]),r([0,1,3,7,6,4]),r([4,5,7,6,2,0]),r([4,5,7,6,0,0]),r([4,5,1,3,7,6]),r([0,2,3,7,5,4]),r([6,2,3,7,5,4]),r([6,2,3,1,5,4]),e})();function Pe(e,t,r,i,n){const s=e.getQuaternion(Se);n.quaternion=s,(0,o.Xr)(xe,s);const a=e.getCenter(De),u=e.getHalfSize(ze);if(i===b.RT.Global){(0,l.u)(Be,a,xe),(0,l.v)(He,Be),(0,l.y)(ke,He,u),(0,l.z)(ke,He,ke);const i=(0,l.l)(ke);(0,l.g)(ke,He,u);const s=(0,l.l)(ke);if(i<r)n.center=a,(0,l.s)(Be,r,r,r),n.halfSize=(0,l.g)(Be,u,Be);else{const o=s>0?1+t/s:1,a=i>0?1+r/i:1,c=(a+o)/2,h=(a-o)/2;(0,l.j)(ke,He,h),n.halfSize=(0,l.r)(ke,ke,u,c),(0,l.j)(ke,He,c),(0,l.r)(ke,ke,u,h),(0,l.A)(Be,Be),(0,l.B)(Be,ke,Be);const d=e.getQuaternion(we);n.center=(0,l.u)(Be,Be,d)}}else{n.center=(0,l.r)(Be,a,c.Cb,(r+t)/2);const e=(0,l.u)(Be,c.Cb,xe);(0,l.v)(e,e),n.halfSize=(0,l.r)(He,u,e,(r-t)/2)}return n}function Oe(e,t,r,n,s){const o=t.getQuaternion(Se),a=(0,i.I0)(Ve,o),l=t.getHalfSize(ze);for(let e=0;e<8;++e){for(let t=0;t<3;++t)Ne[t]=l[t]*(e&1<<t?-1:1);for(let t=0;t<3;++t){let i=r[t];for(let e=0;e<3;++e)i+=Ne[e]*a[3*e+t];Ie[3*e+t]=i}}(0,m.projectBuffer)(Ie,e,0,Ie,n,0,8),Ee(Le,s)}const Ie=new Array(24),Le=new S.K(Ie,3),Ne=(0,c.vt)(),De=(0,c.vt)(),Fe=(0,c.vt)(),ze=(0,c.vt)(),Ve=(0,n.vt)(),Ue=(0,s.vt)(),Ge=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Be=(0,c.vt)(),He=(0,c.vt)(),ke=(0,c.vt)(),je=(0,c.fA)(-1,-1,-1)},29800:function(e,t,r){r.d(t,{A:function(){return c},C:function(){return l}});var i=r(57617),n=r(50240),s=r(82588),o=r(49618),a=r(45147);function l(e,t,r,i){const a="polygon"===e.type?s.Wq.CCW_IS_HOLE:s.Wq.NONE,l="polygon"===e.type?e.rings:e.paths,{position:c,outlines:h}=(0,s.oR)(l,!!e.hasZ,a,e.spatialReference),d=(0,n.jh)(c.length),p=(0,o.au)(c,e.spatialReference,0,d,0,c,0,c.length/3,t,r,i),f=null!=p;return{lines:f?u(h,c,d):[],projectionSuccess:f,sampledElevation:p}}function c(e,t){const r="polygon"===e.type?s.Wq.CCW_IS_HOLE:s.Wq.NONE,n="polygon"===e.type?e.rings:e.paths,{position:o,outlines:l}=(0,s.oR)(n,!1,r),c=(0,i.projectBuffer)(o,e.spatialReference,0,o,t,0,o.length/3);for(let e=2;e<o.length;e+=3)o[e]=a.bi;return{lines:c?u(l,o):[],projectionSuccess:c}}function u(e,t,r=null){const i=new Array;for(const{index:s,count:o}of e){if(o<=1)continue;const e=3*s,a=3*o;i.push({position:(0,n.l5)(t,3*s,3*o),mapPositions:null!=r?(0,n.l5)(r,e,a):void 0})}return i}},45147:function(e,t,r){r.d(t,{bi:function(){return sr}});var i,n,s=r(53804),o=r(48996),a=r(58941),l=r(25738),c=r(95929),u=r(7187),h=r(28181),d=r(17660),p=r(23502),f=r(40633),m=(r(13798),r(65953)),g=r(73364),y=r(20551),_=r(32501),v=r(65420),b=r(46949),x=r(70974),S=r(86398),w=r(87416),T=r(79068);class A{constructor(){this._extent=(0,w.vt)(),this.resolution=0,this.renderLocalOrigin=(0,T.f)(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new C}get extent(){return this._extent}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const t=.001*e.range;if(this._extent[0]-t<=e.min){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,w.cY)(this._extent,e.range,0,t)}if(this._extent[2]+t>=e.max){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,w.cY)(this._extent,-e.range,0,t)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,(0,w.C)(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}}class C{constructor(){this.extents=[(0,w.vt)(),(0,w.vt)(),(0,w.vt)()],this.numViews=0}}(n=i||(i={}))[n.Color=0]="Color",n[n.ColorNoRasterImage=1]="ColorNoRasterImage",n[n.Highlight=2]="Highlight",n[n.WaterNormal=3]="WaterNormal",n[n.Occluded=4]="Occluded",n[n.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor";class E{constructor(e,t,r){this._fbos=e,this._format=t,this._name=r}get valid(){return null!=this._handle?.getTexture()}dispose(){this._handle=(0,c.Gz)(this._handle)}get texture(){return this._handle?.getTexture()}bind(e,t,r){this._handle&&this._handle.fbo?.width===t&&this._handle.fbo?.height===r||(this._handle?.release(),this._handle=this._fbos.acquire(t,r,this._name,this._format)),e.unbindTexture(this._handle?.fbo?.colorTexture),e.bindFramebuffer(this._handle?.fbo)}generateMipMap(){this._handle?.getTexture()?.descriptor?.hasMipmap&&this._handle?.getTexture()?.generateMipmap()}}var M=r(98680),R=r(27264);class P{constructor(e,t,r,i,n=M.N.RGBA_MIPMAP){this.output=r,this.content=i,this.fbo=new E(e,n,t)}get valid(){return this.fbo.valid}}class O{constructor(e){this.targets=[new P(e,"overlay color",R.V.Color,i.Color),new P(e,"overlay IM color",R.V.Color,i.ColorNoRasterImage),new P(e,"overlay highlight",R.V.Highlight,i.Highlight,M.N.RGBA4),new P(e,"overlay water",R.V.Normal,i.WaterNormal),new P(e,"overlay occluded",R.V.Color,i.Occluded)],(0,a.A)("enable-feature:objectAndLayerId-rendering")&&this.targets.push(new P(e,"overlay oid",R.V.ObjectAndLayerIdColor,i.ObjectAndLayerIdColor))}getTexture(e){return this.targets[e]?.fbo.texture}dispose(){for(const e of this.targets)e.fbo.dispose()}computeValidity(){return this.targets.reduce(((e,t,r)=>t.valid?e|=1<<r:e),0)}}var I,L,N=r(65631),D=r(41546),F=r(94211);F.Zo,(L=I||(I={}))[L.Material=0]="Material",L[L.ShadowMap=1]="ShadowMap",L[L.Highlight=2]="Highlight",L[L.ViewshedShadowMap=3]="ViewshedShadowMap",r(42426),r(11520),r(11388),r(41356),r(14543),r(39506),r(39838);var z,V,U=r(65312);(V=z||(z={}))[V.Disabled=0]="Disabled",V[V.Enabled=1]="Enabled",V[V.EnabledWithWater=2]="EnabledWithWater",V[V.COUNT=3]="COUNT",U.n,(0,D.vt)();var G=r(55747),B=r(7970),H=r(8610);class k{constructor(e){this._context=e,this._perConstructorInstances=new B.O,this._frameCounter=0,this._keepAliveFrameCount=W}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach((e=>e.forEach((e=>e.technique.destroy())))),this._perConstructorInstances.clear()}acquire(e,t=q){const r=t.key;let i=this._perConstructorInstances.get(e,r);if(null==i){const n=new e(this._context,t,(()=>this.release(n)));i=new j(n),this._perConstructorInstances.set(e,r,i)}return++i.refCount,i.technique}releaseAndAcquire(e,t,r){if(null!=r){if(t.key===r.key)return r;this.release(r)}return this.acquire(e,t)}release(e){if(null==e||this._perConstructorInstances.empty)return;const t=this._perConstructorInstances.get(e.constructor,e.key);null!=t&&(--t.refCount,0===t.refCount&&(t.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==W&&this._perConstructorInstances.forEach(((e,t)=>{e.forEach(((e,r)=>{0===e.refCount&&e.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(e.technique.destroy(),this._perConstructorInstances.delete(t,r))}))}))}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach(((t,r)=>{e.push((async(e,t)=>{const r=t.shader;r&&(await r.reload(),e.forEach((e=>e.technique.reload(this._context))))})(t,r))})),await Promise.all(e)}}class j{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}}const W=-1,q=new H.K;var Z=r(67521),$=r(90553);class Y{constructor(e,t,r,i){this._textures=e,this._techniques=t,this.materialChanged=r,this.requestRender=i,this._id2glMaterialRef=new B.O}dispose(){this._textures.destroy()}acquire(e,t,r){this._ownMaterial(e);const i=e.produces.get(t);if(!i?.(r))return null;let n=this._id2glMaterialRef.get(r,e.id);if(null==n){const t=e.createGLMaterial({material:e,techniques:this._techniques,textures:this._textures,output:r});n=new X(t),this._id2glMaterialRef.set(r,e.id,n)}return n.ref(),n.glMaterial}release(e,t){const r=this._id2glMaterialRef.get(t,e.id);null!=r&&(r.unref(),r.referenced||((0,c.WD)(r.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&f.A.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}}class X{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,(0,$.vA)(this._refCnt>=0)}get referenced(){return this._refCnt>0}}var J=r(19860),Q=r(24100),K=(r(38504),r(39714)),ee=r(1932),te=r(75256),re=r(60808),ie=r(98901),ne=r(78946),se=r(54407),oe=r(29165),ae=r(55890),le=r(95629);class ce{constructor(e,t){this.shadowMap=e,this.slicePlane=t,this.slot=oe.N.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=ae.y.NONE,this.alignPixelEnabled=!1,this.decorations=se.ID.ON,this.overlayStretch=1,this.viewshedEnabled=!1,this._camera=new N.A,this._inverseViewport=(0,ee.vt)(),this.oldLighting=new le.TA,this.newLighting=new le.TA,this._fadedLighting=new le.TA,this._lighting=this.newLighting,this.ssr=new ue,this.multipassEnabled=!1,this.multipassTerrain=new ne.h,this.multipassGeometry=new ie.U,this.hudRenderStyle=re.D.Occluded,this.cloudsFade=new te.ny,this.shadowHighlightsVisible=!1}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:t,newLighting:r}=this;e>=1?this._lighting=r:(this._fadedLighting.lerpLighting(t,r,e),this._lighting=this._fadedLighting)}}class ue{constructor(){this.fadeFactor=1,this.reprojectionMatrix=(0,K.vt)()}}class he{constructor(e,t,r=null){this.rctx=e,this.sliceHelper=r,this.lastFrameCamera=new N.A,this.output=R.V.Color,this.renderOccludedMask=de,this.bindParameters=new ce(t,null!=r?r.plane:null),this.bindParameters.alignPixelEnabled=!0}}const de=Q.m$.Occlude|Q.m$.OccludeAndTransparent|Q.m$.OccludeAndTransparentStencil;var pe=r(15774),fe=r(87725),me=r(13786),ge=r(33400);let ye=class extends N.A{constructor(){super(...arguments),this._projectionMatrix=(0,K.vt)()}get projectionMatrix(){return this._projectionMatrix}};(0,s._)([(0,p.MZ)()],ye.prototype,"_projectionMatrix",void 0),(0,s._)([(0,p.MZ)({readOnly:!0})],ye.prototype,"projectionMatrix",null),ye=(0,s._)([(0,m.$)("esri.views.3d.webgl-engine.lib.CascadeCamera")],ye);var _e,ve,be=r(12569),xe=r(85456),Se=r(78541);(ve=_e||(_e={}))[ve.Highlight=0]="Highlight",ve[ve.ExcludeHighlight=1]="ExcludeHighlight";class we{constructor(){this.camera=new ye,this.lightMat=(0,K.vt)()}}class Te{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}}class Ae{constructor(e,t){this._fbos=e,this._viewingMode=t,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new Te,this._projectionView=(0,K.vt)(),this._projectionViewInverse=(0,K.vt)(),this._modelViewLight=(0,K.vt)(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=(0,D.vt)(),this._cascades=[new we,new we,new we,new we],this._lastOrigin=null,this._maxTextureWidth=Math.min((0,a.A)("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){return this._handle?.getTexture()}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return(0,ge.s)(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeOffscreenBuffers(){this._handle=(0,c.Gz)(this._handle),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=(0,pe.qE)(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&null!=this.depthTexture}get cascades(){for(let e=0;e<this._numCascades;++e)De[e]=this._cascades[e];return De.length=this._numCascades,De}start(e,t,r,i,n){(0,$.vA)(this.enabled);const{near:s,far:o}=function(e){let{near:t,far:r}=e;return t<2&&(t=2),r<2&&(r=2),t>=r&&(t=2,r=4),{near:t,far:r}}(r);this._computeCascadeDistances(s,o,i),this._textureHeight=this._computeTextureHeight(e,n,i),this._setupMatrices(e,t);const{viewMatrix:a,projectionMatrix:l}=e;for(let e=0;e<this._numCascades;++e)this._constructCascade(e,l,a,t);this._lastOrigin=null,this.clear()}finish(){(0,$.vA)(this.enabled),this._handle?.detachDepth()}getShadowMapMatrices(e){if(!this._lastOrigin||!(0,y.e)(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||(0,_.vt)(),(0,y.c)(this._lastOrigin,e);for(let t=0;t<this._numCascades;++t){(0,g.Tl)(Fe,this._cascades[t].lightMat,e);for(let e=0;e<16;++e)ze[16*t+e]=Fe[e]}}return ze}moveSnapshot(e){(0,$.vA)(this.enabled),this._handle?.detachDepth(),this._snapshots[e]?.release(),this._snapshots[e]=this._handle,this._handle=null,this.clear()}copySnapshot(e){const t=this._handle?.getTexture()?.descriptor;if(!this.enabled||!t)return;this._snapshots[e]?.release();const{width:r,height:i}=t,n=e===_e.Highlight?"shadow highlight snapshot":"shadow no highlight snapshot";this._snapshots[e]=this._fbos.acquire(r,i,n,M.N.RGBA4);const s=this._fbos.rctx;this._bindFbo();const o=s.bindTexture(this._snapshots[e]?.getTexture(),Se.g.TEXTURE_UNIT_FOR_UPDATES);s.gl.copyTexSubImage2D(xe.Ap.TEXTURE_2D,0,0,0,0,0,r,i),s.bindTexture(o,Se.g.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(e){return this.enabled?this._snapshots[e]?.getTexture():null}clear(){const e=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),e.setClearColor(1,1,1,1),e.clear(xe.hn.COLOR_BUFFER_BIT|xe.hn.DEPTH_BUFFER_BIT)}_computeTextureHeight(e,t,r){const i=Math.min(window.devicePixelRatio,t)/e.pixelRatio,n=r?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,s=(0,be.Mv)(Math.floor(Math.max(e.fullWidth,e.fullHeight)*i*n)),o=Math.min(this._maxTextureWidth,this._numCascades*s);return(0,be.uT)(o/this._numCascades)}_ensureFbo(){this._handle?.fbo?.width===this._textureWidth&&this._handle?.fbo.height===this._textureHeight||(this._handle?.release(),this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",M.N.RGBA4)),this._handle?.acquireDepth(M.z.DEPTH16_BUFFER)}_discardSnapshot(e){this._snapshots[e]=(0,c.Gz)(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){const e=this._fbos.rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer(this._handle?.fbo)}_constructCascade(e,t,r,i){const n=this._cascades[e],s=-this._cascadeDistances[e],o=-this._cascadeDistances[e+1],a=(t[10]*s+t[14])/Math.abs(t[11]*s+t[15]),l=(t[10]*o+t[14])/Math.abs(t[11]*o+t[15]);(0,$.vA)(a<l);for(let e=0;e<8;++e){(0,ge.s)(Ee,e%4==0||e%4==3?-1:1,e%4==0||e%4==1?-1:1,e<4?a:l,1);const t=Me[e];(0,ge.t)(t,Ee,this._projectionViewInverse),t[0]/=t[3],t[1]/=t[3],t[2]/=t[3]}(0,y.k)(Ne,Me[0]),n.camera.viewMatrix=(0,g.Tl)(Ce,this._modelViewLight,Ne);for(let e=0;e<8;++e)(0,y.h)(Me[e],Me[e],n.camera.viewMatrix);let c=Me[0][2],u=Me[0][2];for(let e=1;e<8;++e)c=Math.min(c,Me[e][2]),u=Math.max(u,Me[e][2]);c-=200,u+=200,n.camera.near=-u,n.camera.far=-c,function(e,t,r,i,n){const s=1/Me[0][3],o=1/Me[4][3];(0,$.vA)(s<o);let a=s+Math.sqrt(s*o);const l=Math.sin((0,pe.XM)(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]));a/=l,function(e,t,r,i,n,s,o,a){(0,me.hZ)(Ve,0,0);for(let t=0;t<4;++t)(0,me.WQ)(Ve,Ve,e[t]);(0,me.hs)(Ve,Ve,.25),(0,me.hZ)(Ue,0,0);for(let t=4;t<8;++t)(0,me.WQ)(Ue,Ue,e[t]);(0,me.hs)(Ue,Ue,.25),(0,me.Cc)(Ge[0],e[4],e[5],.5),(0,me.Cc)(Ge[1],e[5],e[6],.5),(0,me.Cc)(Ge[2],e[6],e[7],.5),(0,me.Cc)(Ge[3],e[7],e[4],.5);let l=0,c=(0,me.hG)(Ge[0],Ve);for(let e=1;e<4;++e){const t=(0,me.hG)(Ge[e],Ve);t<c&&(c=t,l=e)}(0,me.Re)(Be,Ge[l],e[l+4]);const u=Be[0];let h,d;Be[0]=-Be[1],Be[1]=u,(0,me.Re)(He,Ue,Ve),(0,me.Om)(He,Be)<0&&(0,me.ze)(Be,Be),(0,me.Cc)(Be,Be,He,r),(0,me.S8)(Be,Be),h=d=(0,me.Om)((0,me.Re)(ke,e[0],Ve),Be);for(let t=1;t<8;++t){const r=(0,me.Om)((0,me.Re)(ke,e[t],Ve),Be);r<h?h=r:r>d&&(d=r)}(0,me.C)(i,Ve),(0,me.hs)(ke,Be,h-t),(0,me.WQ)(i,i,ke);let p=-1,f=1,m=0,g=0;for(let t=0;t<8;++t){(0,me.Re)(je,e[t],i),(0,me.S8)(je,je);const r=Be[0]*je[1]-Be[1]*je[0];r>0?r>p&&(p=r,m=t):r<f&&(f=r,g=t)}(0,$.MX)(p>0,"leftArea"),(0,$.MX)(f<0,"rightArea"),(0,me.hs)(We,Be,h),(0,me.WQ)(We,We,Ve),(0,me.hs)(qe,Be,d),(0,me.WQ)(qe,qe,Ve),Ze[0]=-Be[1],Ze[1]=Be[0];const y=(0,$.L)(i,e[g],qe,(0,me.WQ)(ke,qe,Ze),1,n),_=(0,$.L)(i,e[m],qe,ke,1,s),v=(0,$.L)(i,e[m],We,(0,me.WQ)(ke,We,Ze),1,o),b=(0,$.L)(i,e[g],We,ke,1,a);(0,$.MX)(y,"rayRay"),(0,$.MX)(_,"rayRay"),(0,$.MX)(v,"rayRay"),(0,$.MX)(b,"rayRay")}(Me,a,l,Re,Pe,Oe,Ie,Le),function(e,t,r,i,n){(0,me.Re)(Je,r,i),(0,me.hs)(Je,Je,.5),Qe[0]=Je[0],Qe[1]=Je[1],Qe[2]=0,Qe[3]=Je[1],Qe[4]=-Je[0],Qe[5]=0,Qe[6]=Je[0]*Je[0]+Je[1]*Je[1],Qe[7]=Je[0]*Je[1]-Je[1]*Je[0],Qe[8]=1,Qe[$e(0,2)]=-(0,me.Om)(Xe(Qe,0),e),Qe[$e(1,2)]=-(0,me.Om)(Xe(Qe,1),e);let s=(0,me.Om)(Xe(Qe,0),r)+Qe[$e(0,2)],o=(0,me.Om)(Xe(Qe,1),r)+Qe[$e(1,2)],a=(0,me.Om)(Xe(Qe,0),i)+Qe[$e(0,2)],l=(0,me.Om)(Xe(Qe,1),i)+Qe[$e(1,2)];s=-(s+a)/(o+l),Qe[$e(0,0)]+=Qe[$e(1,0)]*s,Qe[$e(0,1)]+=Qe[$e(1,1)]*s,Qe[$e(0,2)]+=Qe[$e(1,2)]*s,s=1/((0,me.Om)(Xe(Qe,0),r)+Qe[$e(0,2)]),o=1/((0,me.Om)(Xe(Qe,1),r)+Qe[$e(1,2)]),Qe[$e(0,0)]*=s,Qe[$e(0,1)]*=s,Qe[$e(0,2)]*=s,Qe[$e(1,0)]*=o,Qe[$e(1,1)]*=o,Qe[$e(1,2)]*=o,Qe[$e(2,0)]=Qe[$e(1,0)],Qe[$e(2,1)]=Qe[$e(1,1)],Qe[$e(2,2)]=Qe[$e(1,2)],Qe[$e(1,2)]+=1,s=(0,me.Om)(Xe(Qe,1),t)+Qe[$e(1,2)],o=(0,me.Om)(Xe(Qe,2),t)+Qe[$e(2,2)],a=(0,me.Om)(Xe(Qe,1),r)+Qe[$e(1,2)],l=(0,me.Om)(Xe(Qe,2),r)+Qe[$e(2,2)],s=-.5*(s/o+a/l),Qe[$e(1,0)]+=Qe[$e(2,0)]*s,Qe[$e(1,1)]+=Qe[$e(2,1)]*s,Qe[$e(1,2)]+=Qe[$e(2,2)]*s,s=(0,me.Om)(Xe(Qe,1),t)+Qe[$e(1,2)],o=(0,me.Om)(Xe(Qe,2),t)+Qe[$e(2,2)],a=-o/s,Qe[$e(1,0)]*=a,Qe[$e(1,1)]*=a,Qe[$e(1,2)]*=a,n[0]=Qe[0],n[1]=Qe[1],n[2]=0,n[3]=Qe[2],n[4]=Qe[3],n[5]=Qe[4],n[6]=0,n[7]=Qe[5],n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=Qe[6],n[13]=Qe[7],n[14]=0,n[15]=Qe[8]}(Re,Pe,Ie,Le,n.projectionMatrix),n.projectionMatrix[10]=2/(r-i),n.projectionMatrix[14]=-(r+i)/(r-i)}(r,i,c,u,n.camera),(0,g.lw)(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const h=this._textureHeight;n.camera.viewport=[e*h,0,h,h]}_setupMatrices(e,t){(0,g.lw)(this._projectionView,e.projectionMatrix,e.viewMatrix),(0,g.B8)(this._projectionViewInverse,this._projectionView);const r=this._viewingMode===v.RT.Global?e.eye:(0,y.s)(Ne,0,0,1);(0,g.t5)(this._modelViewLight,[0,0,0],[-t[0],-t[1],-t[2]],r)}_computeCascadeDistances(e,t,r){const i=r?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor((0,$.kL)(t/e,4)),i);const n=(t-e)/this._numCascades,s=(t/e)**(1/this._numCascades);let o=e,a=e;for(let e=0;e<this._numCascades+1;++e)this._cascadeDistances[e]=(0,pe.Cc)(o,a,this.settings.splitSchemeLambda),o*=s,a+=n}get test(){}}const Ce=(0,K.vt)(),Ee=(0,D.vt)(),Me=[];for(let e=0;e<8;++e)Me.push((0,D.vt)());const Re=(0,ee.vt)(),Pe=(0,ee.vt)(),Oe=(0,ee.vt)(),Ie=(0,ee.vt)(),Le=(0,ee.vt)(),Ne=(0,_.vt)(),De=[],Fe=(0,K.vt)(),ze=K.zK.concat(K.zK,K.zK,K.zK,K.zK),Ve=(0,ee.vt)(),Ue=(0,ee.vt)(),Ge=[(0,ee.vt)(),(0,ee.vt)(),(0,ee.vt)(),(0,ee.vt)()],Be=(0,ee.vt)(),He=(0,ee.vt)(),ke=(0,ee.vt)(),je=(0,ee.vt)(),We=(0,ee.vt)(),qe=(0,ee.vt)(),Ze=(0,ee.vt)();function $e(e,t){return 3*t+e}const Ye=(0,ee.vt)();function Xe(e,t){return(0,me.hZ)(Ye,e[t],e[t+3]),Ye}const Je=(0,ee.vt)(),Qe=(0,fe.vt)();var Ke=r(83525),et=r(90599),tt=r(38177),rt=r(50456);r(59356);class it extends rt.R6{constructor(e,t,r){super(e,t),this.triangleNr=r}}var nt=r(23545),st=r(49845),ot=r(96253),at=r(57701),lt=r(50659),ct=r(69550),ut=r(52798);class ht extends F.gy{constructor(e=(0,_.vt)()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}}class dt{constructor(e=0,t=0){this.from=e,this.to=t}get numElements(){return this.to-this.from}}function pt(e){const t=new Map;e.forAll((e=>t.set(e.from,e)));let r=!0;for(;r;){r=!1;for(let i=0;i<e.length;++i){const n=e.data[i],s=t.get(n.to);if(!s)return;n.to=s.to,t.delete(s.from),e.removeUnordered(s),r=!0}}}class ft extends dt{constructor(e,t,r){super(t,r),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return null!=this.geometry.highlights&&this.isVisible}get hasOccludees(){return null!=this.geometry.occludees}}class mt{constructor(){this.first=0,this.count=0}}class gt{constructor(){this._numElements=0,this._instances=new Map,this.holes=new u.A({allocator:e=>e||new dt,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=yt(),this.drawCommandsHighlight=yt(),this.drawCommandsOccludees=yt(),this.drawCommandsShadowHighlightRest=yt()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,t){this.deleteInstance(e),this._instances.set(e,t),this._numElements+=t.numElements}deleteInstance(e){const t=this._instances.get(e);t&&(this._numElements-=t.numElements,this._instances.delete(e))}updateInstance(e,t,r){const i=this._instances.get(e);i&&(this._numElements-=i.numElements,i.from=t,i.to=r,this._numElements+=i.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,0===this._instances.size)return;if(!this.needsMultipleCommands()){const t=this.drawCommandsDefault.pushNew(),r=this.holes.front();return null!=this.vao&&1===this.holes.length&&r.to===Math.floor(this.vao.byteSize/e)?(t.first=0,void(t.count=r.from)):(t.first=1/0,t.count=0,this._instances.forEach((e=>{t.first=Math.min(t.first,e.from),t.count=Math.max(t.count,e.to)})),void(t.count-=t.first))}const t=Array.from(this._instances.values()).sort(((e,t)=>e.from===t.from?e.to-t.to:e.from-t.from));for(const e of t)e.isVisible&&(_t(e.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,e),_t(e.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,e))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}}function yt(){return new u.A({allocator:e=>e||new mt,deallocator:e=>e})}function _t(e,t){const r=e.back();if(null==r){const r=e.pushNew();return r.first=t.from,void(r.count=t.numElements)}if(function(e,t){return e.first+e.count>=t.from}(r,t)){const e=t.from-r.first+t.numElements;r.count=e}else{const r=e.pushNew();r.first=t.from,r.count=t.numElements}}class vt{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach((e=>e.vao.dispose())),this.buffers.length=0}findBuffer(e){return this.buffers.find((t=>t.instances.has(e)))}}var bt=r(85408);class xt{constructor(e,t){this._cache=e(t,((e,t,r)=>{switch(t){case bt.k2.ALL:return e.forEach((e=>e.dispose())),0;case bt.k2.SOME:{const t=e.shift();return t&&(r-=Math.round(t.usedMemory),t.dispose()),r}}}))}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}getSize(e){return this._cache.getSize(e)}pop(e){const t=this._cache.peek(e);if(!t)return;const r=t.pop();if(t.length>0){if(r){const i=this._cache.getSize(e)-Math.round(r.usedMemory);this._cache.updateSize(e,t,i)}}else this._cache.pop(e);return r}put(e,t,r=bt.Cn){const i=this._cache.peek(e);if(!i)return void this._cache.put(e,[t],t.usedMemory,r);i.push(t);const n=this._cache.getSize(e)+Math.round(t.usedMemory);this._cache.updateSize(e,i,n)}}var St=r(69445),wt=r(86305);class Tt{constructor(e,t,r){this._rctx=e,this._locations=t,this._layout=r,this._cache=new xt(e.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(e){const t=e.toString();let r=this._cache.pop(t);return r||(r=new St.Z(this._rctx,this._locations,{geometry:this._layout},{geometry:wt.g.createVertex(this._rctx,xe._U.STATIC_DRAW)}),r.vertexBuffers.geometry.setSize(e),r)}deleteVao(e){if(null==e)return;const t=e.byteSize.toString();this._cache.put(t,e)}}let At=class extends Z.Ot{constructor(e){super(e),this._vaoCache=null,this._glMaterials=null,this._bufferWriter=null,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._produces=new Map,this.drapedPriority=0}destroy(){this._glMaterials=(0,c.WD)(this._glMaterials),this._dataByOrigin.forEach((e=>e.dispose())),this._dataByOrigin.clear(),this._vaoCache=(0,c.WD)(this._vaoCache)}initialize(){this.material.produces.forEach(((e,t)=>{this._produces.set(t,(t=>!(0===this._dataByOrigin.size||!(t!==R.V.Highlight&&t!==R.V.ShadowHighlight||this._hasHighlights))&&e(t)))}))}get produces(){return this._produces}initializeRenderContext(e,t){const{rctx:r}=e.renderContext;this._glMaterials=new ut.c(this.material,t??e.materials),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=new Tt(r,this.material.vertexAttributeLocations,(0,ct.U)(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get hasOccludees(){return this._hasOccludees}get isDecoration(){return this.material.parameters.isDecoration}queryRenderOccludedState(e){return this.material.queryRenderOccludedState(e)}get materialReference(){return this.material}get numGeometries(){let e=0;return this._dataByOrigin.forEach((t=>e+=t.buffers.reduce(((e,t)=>e+t.instances.size),0))),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach((t=>e+=t.buffers.reduce(((e,t)=>e+t.vao.usedMemory),0))),e}forEachGeometry(e){this._dataByOrigin.forEach((t=>t.buffers.forEach((t=>t.instances.forEach((t=>e(t.geometry)))))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const t=this._bufferWriter;if(null===t)return;const r=t.vertexBufferLayout.stride/4;for(const i of e){const e=i.renderGeometry,n=this._dataByOrigin.get(e.localOrigin.id),s=n?.findBuffer(e.id);if(null==s)return;const o=s.instances.get(e.id);if(i.updateType&(ot.k.GEOMETRY|ot.k.TRANSFORMATION)){const i=Vt(t.elementCount(o.geometry.geometry)*r),n=t.vertexBufferLayout.createView(i.buffer);this._writeGeometry(e,n,0),s.vao.vertexBuffers.geometry.setSubData(i,o.from*r,0,o.numElements*r)}i.updateType&(ot.k.HIGHLIGHT|ot.k.OCCLUDEE|ot.k.VISIBILITY)&&(s.drawCommandsDirty=!0)}}_computeDeltas(e,t){const r=new B.O;for(const t of e){const e=t.localOrigin;if(null==e)continue;let i=r.get(e.id,null);null==i&&(i=new Ct(e.vec3),r.set(e.id,null,i)),i.changes.push(t)}for(const e of t){const t=e.localOrigin;if(null==t)continue;const i=this._dataByOrigin.get(t.id),n=i?.findBuffer(e.id);if(null==n)continue;let s=r.get(t.id,n);null==s&&(s=new Ct(t.vec3),r.set(t.id,n,s)),s.changes.push(e)}return r}_addAndRemoveGeometries(e,t){if(null===this._bufferWriter||null===this._vaoCache)return;const{_bufferWriter:r,_dataByOrigin:i}=this,n=r.vertexBufferLayout.stride/4,s=this._computeDeltas(e,t);s.forEach(((e,t)=>{const o=e.get(null),a=null!=o?o.changes:[];s.delete(t,null);let l=i.get(t);if(e.forEach(((e,o)=>{if(s.delete(t,o),null==o)return void(0,$.vA)(!1,"No VAO for removed geometries");if(o.instances.size===e.changes.length)return this._vaoCache.deleteVao(o.vao),(0,lt.Xy)(l.buffers,o),void(0===l.buffers.length&&0===a.length&&i.delete(t));const c=o.numElements,u=o.vao.byteSize/4,h=a.reduce(((e,t)=>e+r.elementCount(t.geometry)),0),d=e.changes.reduce(((e,t)=>e+r.elementCount(t.geometry)),0),p=Math.min((c+h-d)*n,Ft),f=p>u;p>It&&p<u/2?(e.changes.forEach((({id:e})=>o.deleteInstance(e))),o.instances.forEach((({geometry:e})=>a.push(e))),this._vaoCache.deleteVao(o.vao),(0,lt.Xy)(l.buffers,o)):f?this._applyAndRebuild(o,a,e):this._applyRemoves(o,e)})),a.length>0)for(null==l&&(l=new vt(o.origin),i.set(t,l)),l.buffers.forEach((e=>this._applyAdds(e,a)));a.length>0;)l.buffers.push(this._applyAndRebuild(new gt,a,null))}))}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach((e=>{e.buffers.forEach((e=>{e.drawCommandsDirty&&(e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,(0,l.Bs)(e.instances,(t=>(e.updateDrawState(t),e.hasHiddenInstances&&e.hasHighlights&&e.hasOccludees))),e.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||e.hasHighlights,this._hasOccludees=this._hasOccludees||e.hasOccludees}))}))}_applyAndRebuild(e,t,r){if(null!=r)for(const t of r.changes)e.deleteInstance(t.id);const i=this._bufferWriter,n=i.vertexBufferLayout.stride,s=n/4,o=Math.floor(Ft/s);let a=e.numElements;for(;t.length>0;){const r=t.pop(),n=i.elementCount(r.geometry);if(a+n>o&&a>0){t.push(r);break}a+=n;const s=new ft(r,0,0);(0,$.vA)(null==e.instances.get(r.id)),e.addInstance(r.id,s)}const l=a*s,c=Vt(l),u=i.vertexBufferLayout.createView(c.buffer);let h=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach(((t,r)=>{this._writeGeometry(t.geometry,u,h);const n=h;h+=i.elementCount(t.geometry.geometry),e.updateInstance(r,n,h),e.updateDrawState(t)})),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(Ut(l)),e.vao.vertexBuffers.geometry.setSubData(c,0,0,h*s),e.holes.clear();const d=e.holes.pushNew();return d.from=h,d.to=Math.floor(e.vao.byteSize/n),e.updateDrawCommands(n),e}_applyRemoves(e,t){if(0===t.changes.length||null===this._bufferWriter)return;for(const r of t.changes){const t=r.id,i=e.instances.get(t);if(!i)continue;e.deleteInstance(t);const n=Ot.back();if(n){if(n.to===i.from){n.to=i.to;continue}if(n.from===i.to){n.from=i.from;continue}}const s=Ot.pushNew();s.from=i.from,s.to=i.to}pt(Ot);const r=this._bufferWriter.vertexBufferLayout.stride/4,i=Ot.reduce(((e,t)=>Math.max(e,t.numElements)),0)*r,n=Vt(i);n.fill(0,0,i);const s=e.vao.vertexBuffers.geometry;Ot.forAll((e=>s.setSubData(n,e.from*r,0,e.numElements*r))),e.holes.pushArray(Ot.data,Ot.length),Ot.forAll(((e,t)=>Ot.data[t]=null)),Ot.clear(),e.drawCommandsDirty=!0}_applyAdds(e,t){if(0===t.length||null===this._bufferWriter)return;if(!function(e){return null!=e.vao}(e))return void this._applyAndRebuild(e,t,null);const r=this._bufferWriter,i=r.vertexBufferLayout.stride/4,n=e.numElements,s=t.reduce(((e,t)=>e+r.elementCount(t.geometry)),0),o=Math.min((n+s)*i,Ft),a=4*o;if(e.vao.byteSize<Ut(Ft-It)&&a>e.vao.byteSize)return void this._applyAndRebuild(e,t,null);pt(e.holes);const l=new Array;for(const i of t){const t=r.elementCount(i.geometry),n=Et(e.holes,t);l.push(n)}const c=e.vao.vertexBuffers.geometry;let u=0,h=0,d=0;const p=Vt(o),f=r.vertexBufferLayout.createView(p.buffer);t.forEach(((t,n)=>{const s=l[n];if(null==s)return;if(d!==s){const e=d-h;e>0&&c.setSubData(p,h*i,0,e*i),h=s,u=0}const o=r.elementCount(t.geometry);this._writeGeometry(t,f,u),u+=o,d=s+o;const a=new ft(t,s,s+o);(0,$.vA)(null==e.instances.get(t.id)),e.addInstance(t.id,a),e.drawCommandsDirty=!0}));const m=d-h;m>0&&c.setSubData(p,h*i,0,m*i),(0,lt.$i)(t,((e,t)=>null==l[t]))}_writeGeometry(e,t,r){if(null===this._bufferWriter)return;const i=e.localOrigin.vec3;(0,$.M_)(Mt,-i[0],-i[1],-i[2]);const n=(0,g.lw)(Rt,Mt,e.transformation);(0,g.B8)(Pt,n),(0,g.mg)(Pt,Pt),this._bufferWriter.write(n,Pt,e.geometry,t,r)}updateAnimation(e){return this.material.update(e)}prepareTechnique(e){if(!this.material.shouldRender(e))return null;const{output:t,bindParameters:r}=e,i=this.material.produces.get(r.slot);if(!i?.(t))return null;const n=t===R.V.Highlight||t===R.V.ShadowHighlight;if(n&&!this._hasHighlights)return null;const s=t===R.V.ShadowExcludeHighlight,o=!(n||s);for(const i of this._dataByOrigin.values())for(const a of i.buffers){if(n&&!a.hasHighlights)continue;const i=(n?a.drawCommandsHighlight:s&&a.needsMultipleCommands()?a.drawCommandsShadowHighlightRest:a.drawCommandsDefault)||null,l=o&&a.drawCommandsOccludees||null;if(i?.length||l?.length){const i=this._glMaterials.load(e.rctx,r.slot,t),n=null!=i?i.beginSlot(r):null;if(null!=n)return n}}return null}renderNode(e,t){const{output:r,bindParameters:i}=e,n=r===R.V.Highlight||r===R.V.ShadowHighlight,s=r===R.V.ShadowExcludeHighlight,o=!(n||s),a=i.slot===oe.N.OCCLUDER_MATERIAL,l=i.slot===oe.N.TRANSPARENT_OCCLUDER_MATERIAL,c=e.rctx;c.runAppleAmdDriverHelper(),c.bindTechnique(t,i,this.material.parameters);for(const e of this._dataByOrigin.values())for(const r of e.buffers){if(n&&!r.hasHighlights)continue;const u=(n?r.drawCommandsHighlight:s&&r.needsMultipleCommands()?r.drawCommandsShadowHighlightRest:r.drawCommandsDefault)||null,h=o&&r.drawCommandsOccludees||null;(u?.length||h?.length)&&(t.program.bindDraw(new ht(e.origin),i,this.material.parameters),t.ensureAttributeLocations(r.vao),c.bindVAO(r.vao),u?.length&&(c.setPipelineState(t.getPipeline(!1,a,l)),u.forAll((e=>c.drawArrays(t.primitiveType,e.first,e.count)))),h?.length&&(c.setPipelineState(t.getPipeline(!0,a,l)),h.forAll((e=>c.drawArrays(t.primitiveType,e.first,e.count)))))}}get test(){}};(0,s._)([(0,p.MZ)({constructOnly:!0})],At.prototype,"material",void 0),At=(0,s._)([(0,m.$)("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],At);class Ct{constructor(e){this.origin=e,this.changes=new Array}}function Et(e,t){let r;if(!e.some((e=>!(e.numElements<t||(r=e,0)))))return null;const i=r.from;return r.from+=t,r.from>=r.to&&e.removeUnordered(r),i}const Mt=(0,K.vt)(),Rt=(0,K.vt)(),Pt=(0,K.vt)(),Ot=new u.A({allocator:e=>e||new dt,deallocator:null}),It=65536,Lt=4*It,Nt=1024,Dt=16777216,Ft=Dt/4;let zt=new Float32Array(It);function Vt(e){return zt.length<e&&(zt=new Float32Array(e)),zt}function Ut(e){const t=4*e;return t<=Nt?Nt:t<Lt?(0,pe.cU)(t):Math.max(Math.min(Math.ceil(1.5*t/Lt)*Lt,Dt),t)}let Gt=class extends Ke.A{constructor(e){super(e),this._pending=new Bt,this._changes=new nt.VR,this._materialRenderers=new Map,this._sortedMaterialRenderers=new u.A,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach((e=>e.destroy())),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materials(){return this.rendererContext.materials}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccludedDraped(){return(0,l.Bs)(this._materialRenderers,(e=>0!==e.numGeometries&&!e.queryRenderOccludedState(Q.m$.Occlude)))}get isEmpty(){return!this.updating&&0===this._materialRenderers.size&&0===this._geometries.size}getMaterialRenderer(e){return this._materialRenderers.get(e)}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=(0,at.$T)(this._changes);let t=!1;return e.forEach(((e,r)=>{let i=this.getMaterialRenderer(r);if(!i&&e.adds.length>0){const e=new At({material:r});e.initializeRenderContext(this.rendererContext.pluginContext,this._materials),i=e,this._materialRenderers.set(r,i),t=!0}i&&(i.modify(e),0===i.numGeometries&&(this._materialRenderers.delete(r),i.destroy(),t=!0))})),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),this._hasHighlights=(0,l.Bs)(this._materialRenderers,(e=>{const t=e.produces.get(oe.N.DRAPED_MATERIAL);return!!t&&t(R.V.Highlight)})),this._hasWater=(0,l.Bs)(this._materialRenderers,(e=>{const t=e.produces.get(oe.N.DRAPED_WATER);return!!t&&t(R.V.Normal)})),this.notifyChange("updating"),!0}addGeometries(e,t){if(0===e.length)return;const r=this._validateRenderGeometries(e);for(const e of r)this._geometries.set(e.id,e);const i=this._pending.empty;for(const e of r)this._pending.adds.add(e);i&&this.notifyChange("updating"),t===ot.q.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const r=this._pending.empty,i=this._pending.adds;for(const t of e)i.has(t)?(this._pending.removed.add(t),i.delete(t)):this._pending.removed.has(t)||this._pending.removes.add(t),this._geometries.delete(t.id);r&&!this._pending.empty&&this.notifyChange("updating"),t===ot.q.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const r=0===this._changes.updates.length;for(const r of e){const e=this._changes.updates.pushNew();e.renderGeometry=this._validateRenderGeometry(r),e.updateType=t}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case ot.k.TRANSFORMATION:case ot.k.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case ot.k.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedMaterialRenderers.forAll((r=>t=!!r.updateAnimation&&r.updateAnimation(e)||t)),t}shouldRender(e){return this._sortedMaterialRenderers.some((t=>t.prepareTechnique(e)))}render(e){this._sortedMaterialRenderers.forAll((t=>{const r=t.prepareTechnique(e);null!=r&&t.renderNode(e,r)}))}intersect(e,t,r,i,n){return this._geometries.forEach((s=>{if(i&&!i(s))return;this._intersectRenderGeometry(s,r,t,0,e,n);const o=this.rendererContext.longitudeCyclical;o&&(s.boundingSphere[0]-s.boundingSphere[3]<o.min&&this._intersectRenderGeometry(s,r,t,o.range,e,n),s.boundingSphere[0]+s.boundingSphere[3]>o.max&&this._intersectRenderGeometry(s,r,t,-o.range,e,n)),n++})),n}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;for(const t of this._materialRenderers.values())t.drapedPriority=e++,this._sortedMaterialRenderers.push(t);this._sortedMaterialRenderers.sort(((e,t)=>t.materialReference?.renderPriority===e.materialReference?.renderPriority?e.drapedPriority-t.drapedPriority:(t.materialReference?.renderPriority||0)-(e.materialReference?.renderPriority||0)))}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,t,r,i,n,s){if(!e.visible)return;let o=0;i+=e.transformation[12],o=e.transformation[13],Ht[0]=r[0]-i,Ht[1]=r[1]-o,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,n,Ht,((r,i,o)=>{!function(e,t,r,i,n,s,o){const a=new it(s,o,t),l=t=>{t.set(tt.dz.OVERLAY,a,e.dist,e.normal,e.transformation,r,i)};if((null==n.results.min.drapedLayerOrder||r>=n.results.min.drapedLayerOrder)&&(null==n.results.min.dist||n.results.ground.dist<=n.results.min.dist)&&l(n.results.min),n.options.store!==tt.oH.MIN&&(null==n.results.max.drapedLayerOrder||r<n.results.max.drapedLayerOrder)&&(null==n.results.max.dist||n.results.ground.dist>n.results.max.dist)&&l(n.results.max),n.options.store===tt.oH.ALL){const e=(0,st.G7)(n.ray);l(e),n.results.all.push(e)}}(t,o,s,e.material.renderPriority,n,e.layerUid,e.graphicUid)}),t)}_notifyGraphicGeometryChanged(e){if(null==this.drapeSource.notifyGraphicGeometryChanged)return;let t;for(const r of e){const e=r.graphicUid;null!=e&&e!==t&&(this.drapeSource.notifyGraphicGeometryChanged(e),t=e)}}_notifyGraphicVisibilityChanged(e){if(null==this.drapeSource.notifyGraphicVisibilityChanged)return;let t;for(const r of e){const e=r.graphicUid;null!=e&&e!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(e),t=e)}}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return null==e.localOrigin&&(e.localOrigin=this._localOriginFactory.getOrigin((0,et.g)(e.boundingSphere))),e}get test(){}};(0,s._)([(0,p.MZ)()],Gt.prototype,"drapeSource",void 0),(0,s._)([(0,p.MZ)()],Gt.prototype,"updating",null),(0,s._)([(0,p.MZ)()],Gt.prototype,"rctx",null),(0,s._)([(0,p.MZ)({constructOnly:!0})],Gt.prototype,"rendererContext",void 0),(0,s._)([(0,p.MZ)()],Gt.prototype,"_materials",null),(0,s._)([(0,p.MZ)()],Gt.prototype,"_localOriginFactory",null),(0,s._)([(0,p.MZ)({readOnly:!0})],Gt.prototype,"isEmpty",null),(0,s._)([(0,p.MZ)()],Gt.prototype,"_materialRenderers",void 0),(0,s._)([(0,p.MZ)()],Gt.prototype,"_geometries",void 0),Gt=(0,s._)([(0,m.$)("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Gt);class Bt{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}const Ht=(0,ee.vt)();var kt=r(34615),jt=r(22542),Wt=r(40502),qt=r(54101),Zt=r(57087);class $t extends jt.w{initializeProgram(e){return new qt.B(e.rctx,$t.shader.get().build(),Wt.D)}initializePipeline(){return this.configuration.hasAlpha?(0,Zt.Ey)({blending:(0,Zt.p3)(xe.dn.SRC_ALPHA,xe.dn.ONE,xe.dn.ONE_MINUS_SRC_ALPHA,xe.dn.ONE_MINUS_SRC_ALPHA),colorWrite:Zt.wE}):(0,Zt.Ey)({colorWrite:Zt.wE})}}$t.shader=new kt.$(G.a,(()=>r.e(6404).then(r.bind(r,41722))));class Yt extends H.K{constructor(){super(...arguments),this.hasAlpha=!1}}(0,s._)([(0,H.W)()],Yt.prototype,"hasAlpha",void 0);var Xt=r(91998),Jt=r(35910),Qt=r(94010);class Kt extends jt.w{initializeProgram(e){return new qt.B(e.rctx,Kt.shader.get().build(),Wt.D)}initializePipeline(){return(0,Zt.Ey)({blending:(0,Zt.ox)(xe.dn.ONE,xe.dn.ONE_MINUS_SRC_ALPHA),colorWrite:Zt.wE})}}Kt.shader=new kt.$(Qt.a,(()=>r.e(5835).then(r.bind(r,49706))));var er=r(48961),tr=r(10956);let rr=class extends Z.RW{constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new Qt.O,this.hasHighlights=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new u.A,this._passParameters=new G.T,this._materials=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new N.A,this.worldToPCSRatio=1,this.events=new o.A,this.longitudeCyclical=null,this.produces=new Map([[oe.N.DRAPED_MATERIAL,e=>e!==R.V.Highlight||this.hasHighlights],[oe.N.DRAPED_WATER,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const e=this.view._stage.renderer.fboCache,t=this.view._stage.renderView,{waterTextures:r,stippleTextures:i,markerTextures:n}=t;this._techniques=new k({rctx:this._rctx,viewingMode:v.RT.Local,stippleTextures:i,markerTextures:n,waterTextures:r}),this._renderContext=new he(this._rctx,new Ae(e,this.view.state.viewingMode),null),this.addHandles([(0,h.watch)((()=>r.updating),(()=>this.events.emit("content-changed")),h.pc),(0,h.watch)((()=>this.spatialReference),(e=>this._localOriginFactory=new J.g(e)),h.pc),(0,h.on)((()=>this.view.allLayerViews),"after-changes",(()=>this._sortedDrapeSourceRenderersDirty=!0))]),this._materials=new Y(t.textures,this._techniques,(()=>{this.notifyChange("rendersOccludedDraped"),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")}),(()=>this.events.emit("content-changed"))),this._bindParameters.slot=oe.N.DRAPED_MATERIAL,this._bindParameters.mainDepth=null,this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=ae.y.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new Jt.$p((0,_.fA)(1,1,1))]),this.addHandles(this.view.resourceController.scheduler.registerTask(er.W6.STAGE,this))}destroy(){this._renderers.forEach((e=>e.destroy())),this._renderers.clear(),this._debugTextureTechnique=(0,c.Gz)(this._debugTextureTechnique),this._passParameters.texture=(0,c.WD)(this._passParameters.texture),this._techniques=(0,c.pR)(this._techniques),this.disposeOverlays()}get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materials(){return this._materials}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initializeRenderContext(e){this.pluginContext=e}uninitializeRenderContext(){}renderNode(){}get updating(){return this._sortedDrapeSourceRenderersDirty||(0,l.Bs)(this._renderers,(e=>e.updating))}get hasOverlays(){return null!=this._overlays&&null!=this._renderTargets}getMaterialRenderer(e){for(const t of this._renderers.values()){const r=t.getMaterialRenderer(e);if(r)return r}return null}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map((e=>e.drapeSource.layer)).filter((e=>!!e))}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,Gt)}createDrapeSourceRenderer(e,t,r){const i=this._renderers.get(e);null!=i&&i.destroy();const n=new t({...r,rendererContext:this,drapeSource:e});return this._renderers.set(e,n),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles((0,h.watch)((()=>e.fullOpacity),(()=>this.events.emit("content-changed"))),e),n}removeDrapeSourceRenderer(e){if(null==e)return;const t=this._renderers.get(e);null!=t&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),t.destroy())}computeValidity(){return this._renderTargets?.computeValidity()??0}releaseRenderTargets(){this._renderTargets?.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&(0,d.bw)(e,(e=>e.drapeTargetType===b.sv.WithoutRasterImage))}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=(0,d.bw)(e,(e=>e.drapeSourceType===b.Om.Features)),this._hasDrapedRasterSource=(0,d.bw)(e,(e=>e.drapeSourceType===b.Om.RasterImage))):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,t,r=this._bindParameters.overlayStretch){null==this._overlays&&(this._renderTargets=new O(this.view._stage.renderer.fboCache),this._overlays=[new A,new A]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t),this._bindParameters.overlayStretch=r}disposeOverlays(){this._overlays=null,this._renderTargets=(0,c.WD)(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){if(null!=e)return e===i.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?this._renderTargets?.getTexture(i.Color):this._renderTargets?.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,(()=>!0))}_processDrapeSources(e,t){let r=!1;for(const[i,n]of this._renderers){if(e.done)break;(i.destroyed||t(i))&&n.commitChanges()&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&(null!=this._overlays&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=(0,l.Bs)(this._renderers,(e=>e.hasHighlights)),this.notifyChange("rendersOccludedDraped"),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(er.Bb,(e=>e.updatePolicy===Xt.q.SYNC))}get isEmpty(){return!x.b.OVERLAY_DRAW_DEBUG_TEXTURE&&!(0,l.Bs)(this._renderers,(e=>!e.isEmpty))}get hasWater(){return this._hasWater}get rendersOccludedDraped(){const e=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=or;const t=this._sortedRenderers.some((({renderer:e})=>e.shouldRender(this._renderContext)));return this._renderContext.renderOccludedMask=e,t}renders(e){return x.b.OVERLAY_DRAW_DEBUG_TEXTURE&&e!==i.Occluded||this._sortedRenderers.some((({renderer:e})=>e.shouldRender(this._renderContext)))}get mode(){return this.isEmpty?z.Disabled:this._renderTargets?.getTexture(i.WaterNormal)?z.EnabledWithWater:this._renderTargets?.getTexture(i.Color)?z.Enabled:z.Disabled}updateAnimation(e){let t=!1;return this._renderers.forEach((r=>t=r.updateAnimation(e)||t)),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const e of this._overlays)this.longitudeCyclical?e.setupGeometryViewsCyclical(this.longitudeCyclical):e.setupGeometryViewsDirect();for(const t of this._renderTargets.targets){if(t.content===i.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const r=this._drawTarget(S.vr.INNER,t,e),n=this._drawTarget(S.vr.OUTER,t,e);(r||n)&&t.fbo.generateMipMap()}}}_drawTarget(e,t,r){const n=this._overlays[e],s=n.canvasGeometries;if(0===s.numViews)return!1;const{alignPixelEnabled:o,contentPixelRatio:a}=r;this._screenToWorldRatio=a*n.mapUnitsPerPixel/this._bindParameters.overlayStretch;const l=t.output;if(this.isEmpty||l===R.V.Highlight&&!this.hasHighlights||l===R.V.Normal&&!this.hasWater||!n.hasSomeSizedView())return!1;const c=this._rctx;if(this._camera.pixelRatio=n.pixelRatio*a,this._renderContext.output=l,this._bindParameters.alignPixelEnabled=o,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=l===R.V.Normal?oe.N.DRAPED_WATER:oe.N.DRAPED_MATERIAL,t.content===i.Occluded&&(this._renderContext.renderOccludedMask=or),!this.renders(t.content))return this._renderContext.renderOccludedMask=de,!1;const u=n.resolution;this._rctx.setViewport(e===S.vr.INNER?0:u,0,u,u);const h=2*n.resolution,d=n.resolution,p=t.fbo;if(p.bind(c,h,d),e===S.vr.INNER&&(c.setClearColor(0,0,0,0),c.clear(xe.hn.COLOR_BUFFER_BIT)),x.b.OVERLAY_DRAW_DEBUG_TEXTURE&&t.content!==i.Occluded)for(let t=0;t<s.numViews;t++)this._setViewParameters(s.extents[t],n),this._ensureDebugPatternResources(n.resolution,nr[e]),this._rctx.bindTechnique(this._debugTextureTechnique,this._renderContext.bindParameters,this._passParameters),this._rctx.screen.draw();return this._sortedRenderers.forAll((({drapeSource:r,renderer:o})=>{if(t.content===i.ColorNoRasterImage&&r.drapeSourceType===b.Om.RasterImage)return;const{fullOpacity:a}=r,u=null!=a&&a<1&&l===R.V.Color?this.bindTemporaryFramebuffer(h,d):null;for(let e=0;e<s.numViews;e++)this._setViewParameters(s.extents[e],n),o.render(this._renderContext);if(u){p.bind(c,h,d),this._overlayParameters.texture=u.getTexture(),this._overlayParameters.opacity=a,this._overlayParameters.overlayIndex=e;const t=this.pluginContext.techniques.acquire(Kt);this._rctx.bindTechnique(t,this._renderContext.bindParameters,this._overlayParameters),this._rctx.screen.draw(),t.release(),u.release()}})),c.bindFramebuffer(null),this._renderContext.renderOccludedMask=de,!0}bindTemporaryFramebuffer(e,t){const r=this.view._stage.renderer.fboCache,i=r.acquire(e,t,"overlay tmp");return r.rctx.unbindTexture(i.fbo?.colorTexture),r.rctx.bindFramebuffer(i.fbo),r.rctx.clear(xe.hn.COLOR_BUFFER_BIT),i}async reloadShaders(){await this._techniques.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,r,i){this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let n=0;for(const{renderer:s}of this._sortedRenderers)n=s.intersect?.(e,t,r,i,n)??n}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),0===this._renderers.size)return;const e=this.view.map.allLayers,t=e.length;this._renderers.forEach(((r,i)=>{const n=e.indexOf(i.layer),s=n>=0,o=i.renderGroup??(s?b.O7.MapLayer:b.O7.ViewLayer),a=t*o+(s?n:0);this._sortedRenderers.push(new ir(i,r,a))})),this._sortedRenderers.sort(((e,t)=>e.index-t.index))}_setViewParameters(e,t){const r=this._camera;r.viewport=[0,0,t.resolution,t.resolution],(0,g.v3)(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),(0,g.kN)(r.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=(0,l.Bs)(this._renderers,(e=>e.hasWater));e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_ensureDebugPatternResources(e,t){if((0,y.s)(this._passParameters.color,t[0],t[1],t[2]),this._passParameters.texture)return;const r=new Uint8Array(e*e*4);let i=0;for(let t=0;t<e;t++)for(let n=0;n<e;n++){const s=Math.floor(n/10),o=Math.floor(t/10);s<2||o<2||10*s>e-20||10*o>e-20?(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=255):(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=1&s&&1&o?1&n^1&t?0:255:1&s^1&o?0:128)}const n=new tr.R(e);n.samplingMode=xe.Cj.NEAREST,this._passParameters.texture=new Se.g(this._rctx,n,r);const s=new Yt;s.hasAlpha=!0,this._debugTextureTechnique=this._techniques.acquire($t,s)}get test(){}};(0,s._)([(0,p.MZ)()],rr.prototype,"hasHighlights",void 0),(0,s._)([(0,p.MZ)()],rr.prototype,"_sortedDrapeSourceRenderersDirty",void 0),(0,s._)([(0,p.MZ)()],rr.prototype,"_techniques",void 0),(0,s._)([(0,p.MZ)({constructOnly:!0})],rr.prototype,"view",void 0),(0,s._)([(0,p.MZ)()],rr.prototype,"worldToPCSRatio",void 0),(0,s._)([(0,p.MZ)()],rr.prototype,"spatialReference",void 0),(0,s._)([(0,p.MZ)({type:Boolean,readOnly:!0})],rr.prototype,"updating",null),(0,s._)([(0,p.MZ)()],rr.prototype,"isEmpty",null),(0,s._)([(0,p.MZ)({readOnly:!0})],rr.prototype,"rendersOccludedDraped",null),rr=(0,s._)([(0,m.$)("esri.views.3d.terrain.OverlayRenderer")],rr);class ir{constructor(e,t,r){this.drapeSource=e,this.renderer=t,this.index=r}}const nr=[[1,.5,.5],[.5,.5,1]],sr=-2,or=Q.m$.OccludeAndTransparent},86398:function(e,t,r){var i,n,s,o;r.d(t,{vr:function(){return i}}),function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"}(i||(i={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(n||(n={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(s||(s={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(o||(o={}))},77222:function(e,t,r){r.d(t,{A:function(){return s}});var i=r(9933),n=r(39506);function s(e){e.vertex.code.add(n.H`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${n.H.int(i.k5.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${n.H.int(i.k5.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${n.H.int(i.k5.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${n.H.int(i.k5.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}},30087:function(e,t,r){r.d(t,{i$:function(){return c},oD:function(){return u},xJ:function(){return l}});var i=r(27264),n=r(66299),s=r(11687),o=r(39506);function a(e){e.varyings.add("linearDepth","float")}function l(e){e.vertex.uniforms.add(new s.G("nearFar",((e,t)=>t.camera.nearFar)))}function c(e){e.vertex.code.add(o.H`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function u(e,t){const{vertex:r}=e;switch(t.output){case i.V.Color:if(t.receiveShadows)return a(e),void r.code.add(o.H`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case i.V.Shadow:case i.V.ShadowHighlight:case i.V.ShadowExcludeHighlight:case i.V.ViewshedShadow:return e.include(n.em,t),a(e),l(e),c(e),void r.code.add(o.H`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}r.code.add(o.H`void forwardLinearDepth() {}`)}},36101:function(e,t,r){r.d(t,{M:function(){return n}});var i=r(39506);function n(e){e.vertex.code.add(i.H`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}},77423:function(e,t,r){r.d(t,{c:function(){return s}});var i=r(39506),n=r(65839);function s(e,t=!0){e.attributes.add(n.r.POSITION,"vec2"),t&&e.varyings.add("uv","vec2"),e.vertex.code.add(i.H`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${t?i.H`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}},27264:function(e,t,r){var i;function n(e){return s(e)||e===i.Depth||e===i.Normal||e===i.ObjectAndLayerIdColor}function s(e){return e===i.Shadow||e===i.ShadowHighlight||e===i.ShadowExcludeHighlight||e===i.ViewshedShadow}function o(e){return f(e)||e===i.Normal}function a(e){return e===i.Highlight||e===i.ObjectAndLayerIdColor}function l(e){return e===i.Color||a(e)}function c(e){return e===i.Color}function u(e){return c(e)||e===i.ObjectAndLayerIdColor}function h(e){return c(e)||e===i.Highlight}function d(e){return h(e)||m(e)}function p(e){return c(e)||a(e)}function f(e){return p(e)||m(e)}function m(e){return e===i.Depth}r.d(t,{MO:function(){return f},PJ:function(){return s},V:function(){return i},XY:function(){return o},_o:function(){return c},aD:function(){return d},cb:function(){return n},dX:function(){return p},eh:function(){return m},i3:function(){return l},u5:function(){return a},zW:function(){return u}}),function(e){e[e.Color=0]="Color",e[e.Depth=1]="Depth",e[e.Normal=2]="Normal",e[e.Shadow=3]="Shadow",e[e.ShadowHighlight=4]="ShadowHighlight",e[e.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",e[e.ViewshedShadow=6]="ViewshedShadow",e[e.Highlight=7]="Highlight",e[e.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",e[e.COUNT=9]="COUNT"}(i||(i={}))},13668:function(e,t,r){r.d(t,{HQ:function(){return c}});var i=r(73364),n=r(39714),s=r(20551),o=r(32501),a=r(4435),l=(r(82598),r(39506));function c(e,t){!function(e,t,...r){if(!t.hasSlicePlane){const r=l.H`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return t.hasSliceInVertexProgram&&e.vertex.code.add(r),void e.fragment.code.add(r)}t.hasSliceInVertexProgram&&e.vertex.uniforms.add(...r),e.fragment.uniforms.add(...r);const i=l.H`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,n=l.H`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,s=t.hasSliceHighlight?l.H`
        ${n}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:l.H`#define highlightSlice(_color_, _pos_) (_color_)`;t.hasSliceInVertexProgram&&e.vertex.code.add(i),e.fragment.code.add(i),e.fragment.code.add(s)}(e,t,new a.W("slicePlaneOrigin",((e,r)=>function(e,t,r){if(null==r.slicePlane)return o.uY;const i=u(e,t,r),n=h(i,r.slicePlane),a=d(e,i,r);return null!=a?(0,s.h)(m,n,a):n}(t,e,r))),new a.W("slicePlaneBasis1",((e,r)=>p(t,e,r,r.slicePlane?.basis1))),new a.W("slicePlaneBasis2",((e,r)=>p(t,e,r,r.slicePlane?.basis2))))}function u(e,t,r){return e.instancedDoublePrecision?(0,s.s)(f,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]):t.slicePlaneLocalOrigin}function h(e,t){return null!=e?(0,s.f)(m,t.origin,e):t.origin}function d(e,t,r){return e.hasSliceTranslatedView?null!=t?(0,i.Tl)(y,r.camera.viewMatrix,t):r.camera.viewMatrix:null}function p(e,t,r,i){if(null==i||null==r.slicePlane)return o.uY;const n=u(e,t,r),a=h(n,r.slicePlane),l=d(e,n,r);return null!=l?((0,s.g)(g,i,a),(0,s.h)(m,a,l),(0,s.h)(g,g,l),(0,s.f)(g,g,m)):i}l.Y;const f=(0,o.vt)(),m=(0,o.vt)(),g=(0,o.vt)(),y=(0,n.vt)()},34178:function(e,t,r){r.d(t,{d:function(){return s}});var i=r(30087),n=r(39506);function s(e){(0,i.i$)(e),e.vertex.code.add(n.H`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),e.vertex.code.add(n.H`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}},14812:function(e,t,r){r.d(t,{BK:function(){return x},nW:function(){return v}});var i=r(53804),n=r(44705),s=r(87725),o=r(39714),a=r(20551),l=r(32501),c=r(27264),u=r(90576),h=r(20830),d=r(4435),p=r(39506),f=r(78567),m=r(70340),g=r(8610),y=r(65839),_=r(44476);class v extends g.K{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}}(0,i._)([(0,g.W)()],v.prototype,"instancedDoublePrecision",void 0),(0,i._)([(0,g.W)()],v.prototype,"hasModelTransformation",void 0),p.Y;const b=(0,s.vt)();function x(e,t){const r=t.hasModelTransformation,i=t.instancedDoublePrecision;r&&(e.vertex.uniforms.add(new m.X("model",(e=>e.modelTransformation??o.zK))),e.vertex.uniforms.add(new f.k("normalLocalOriginFromModel",(e=>((0,n.Ge)(b,e.modelTransformation??o.zK),b))))),t.instanced&&i&&(e.attributes.add(y.r.INSTANCEMODELORIGINHI,"vec3"),e.attributes.add(y.r.INSTANCEMODELORIGINLO,"vec3"),e.attributes.add(y.r.INSTANCEMODEL,"mat3"),e.attributes.add(y.r.INSTANCEMODELNORMAL,"mat3"));const s=e.vertex;i&&(s.include(u.u,t),s.uniforms.add(new d.W("viewOriginHi",((e,t)=>(0,_.Zo)((0,a.s)(S,t.camera.viewInverseTransposeMatrix[3],t.camera.viewInverseTransposeMatrix[7],t.camera.viewInverseTransposeMatrix[11]),S))),new d.W("viewOriginLo",((e,t)=>(0,_.jA)((0,a.s)(S,t.camera.viewInverseTransposeMatrix[3],t.camera.viewInverseTransposeMatrix[7],t.camera.viewInverseTransposeMatrix[11]),S))))),s.code.add(p.H`
    vec3 getVertexInLocalOriginSpace() {
      return ${r?i?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":i?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${i?p.H`
          // Negated inputs are intentionally the first two arguments. The other way around the obfuscation in dpAdd() stopped
          // working for macOS 14+ and iOS 17+.
          // Issue: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(-instanceModelOriginHi, -instanceModelOriginLo, viewOriginHi, viewOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),s.code.add(p.H`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${r?i?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":i?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `),t.output===c.V.Normal&&((0,h.S7)(s),s.code.add(p.H`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${r?i?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":i?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `)),t.hasVertexTangents&&s.code.add(p.H`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${r?i?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":i?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)}const S=(0,l.vt)()},11377:function(e,t,r){r.d(t,{W:function(){return i},Y:function(){return l}});var i,n,s=r(82547),o=r(39506),a=r(65839);function l(e,t){switch(t.normalType){case i.Compressed:e.attributes.add(a.r.NORMALCOMPRESSED,"vec2"),e.vertex.code.add(o.H`vec3 decompressNormal(vec2 normal) {
float z = 1.0 - abs(normal.x) - abs(normal.y);
return vec3(normal + sign(normal) * min(z, 0.0), z);
}
vec3 normalModel() {
return decompressNormal(normalCompressed);
}`);break;case i.Attribute:e.attributes.add(a.r.NORMAL,"vec3"),e.vertex.code.add(o.H`vec3 normalModel() {
return normal;
}`);break;case i.ScreenDerivative:e.fragment.code.add(o.H`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:(0,s.Xb)(t.normalType);case i.COUNT:case i.Ground:}}(n=i||(i={}))[n.Attribute=0]="Attribute",n[n.Compressed=1]="Compressed",n[n.Ground=2]="Ground",n[n.ScreenDerivative=3]="ScreenDerivative",n[n.COUNT=4]="COUNT"},27271:function(e,t,r){r.d(t,{g:function(){return o}});var i=r(27264),n=r(39506),s=r(65839);function o(e,t){const r=t.output===i.V.ObjectAndLayerIdColor,o=t.objectAndLayerIdColorInstanced;r&&(e.varyings.add("objectAndLayerIdColorVarying","vec4"),o?e.attributes.add(s.r.INSTANCEOBJECTANDLAYERIDCOLOR,"vec4"):e.attributes.add(s.r.OBJECTANDLAYERIDCOLOR,"vec4")),e.vertex.code.add(n.H`
     void forwardObjectAndLayerIdColor() {
      ${r?o?n.H`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:n.H`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:n.H``} }`),e.fragment.code.add(n.H`
      void outputObjectAndLayerIdColor() {
        ${r?n.H`fragColor = objectAndLayerIdColorVarying;`:n.H``} }`)}},26762:function(e,t,r){r.d(t,{H:function(){return p},W:function(){return f}});var i=r(1932),n=r(91765),s=r(11687),o=r(82598),a=r(30636),l=r(454),c=r(39506),u=r(65839),h=r(77971);const d=8;function p(e,t){const r=u.r.FEATUREVALUE;e.attributes.add(r,"vec4");const i=e.vertex;i.code.add(c.H`
  bool isCapVertex() {
    return ${r}.w == 1.0;
  }
  `),i.uniforms.add(new s.G("size",(e=>e.size))),t.vvSize?(i.uniforms.add(new o.t("vvSizeMinSize",(e=>e.vvSize.minSize)),new o.t("vvSizeMaxSize",(e=>e.vvSize.maxSize)),new o.t("vvSizeOffset",(e=>e.vvSize.offset)),new o.t("vvSizeFactor",(e=>e.vvSize.factor))),i.code.add(c.H`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${r}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):i.code.add(c.H`vec2 getSize(){
return size;
}`),t.vvOpacity?(i.constants.add("vvOpacityNumber","int",d),i.uniforms.add(new l.x("vvOpacityValues",(e=>e.vvOpacity.values),d),new l.x("vvOpacityOpacities",(e=>e.vvOpacity.opacityValues),d)),i.code.add(c.H`
    vec4 applyOpacity(vec4 color) {
      float value = ${r}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):i.code.add(c.H`vec4 applyOpacity(vec4 color){
return color;
}`),t.vvColor?(i.constants.add("vvColorNumber","int",h.p),i.uniforms.add(new l.x("vvColorValues",(e=>e.vvColor.values),h.p),new a.F("vvColorColors",(e=>e.vvColor.colors),h.p)),i.code.add(c.H`
    vec4 getColor() {
      float value = ${r}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):i.code.add(c.H`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),e.include(n.I),e.attributes.add(u.r.PROFILERIGHT,"vec4"),e.attributes.add(u.r.PROFILEUP,"vec4"),e.attributes.add(u.r.PROFILEVERTEXANDNORMAL,"vec4"),i.code.add(c.H`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),i.code.add(c.H`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),i.code.add(c.H`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),i.code.add(c.H`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}class f extends h.S{constructor(){super(...arguments),this.size=(0,i.fA)(1,1)}}},91765:function(e,t,r){r.d(t,{I:function(){return s}});var i=r(39506),n=r(65839);function s(e){e.attributes.add(n.r.POSITION,"vec3"),e.vertex.code.add(i.H`vec3 positionModel() { return position; }`)}},55123:function(e,t,r){r.d(t,{s:function(){return u}});var i=r(58766),n=r(82598),s=r(14543),o=r(454),a=r(39506),l=r(65839);const c=8;function u(e,t){const r=e.vertex;r.uniforms.add(new s.m("intrinsicWidth",(e=>e.width))),t.vvSize?(e.attributes.add(l.r.SIZEFEATUREATTRIBUTE,"float"),r.uniforms.add(new n.t("vvSizeMinSize",(e=>e.vvSize.minSize)),new n.t("vvSizeMaxSize",(e=>e.vvSize.maxSize)),new n.t("vvSizeOffset",(e=>e.vvSize.offset)),new n.t("vvSizeFactor",(e=>e.vvSize.factor))),r.code.add(a.H`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add(l.r.SIZE,"float"),r.code.add(a.H`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add(l.r.OPACITYFEATUREATTRIBUTE,"float"),r.constants.add("vvOpacityNumber","int",8),r.uniforms.add(new o.x("vvOpacityValues",(e=>e.vvOpacity.values),c),new o.x("vvOpacityOpacities",(e=>e.vvOpacity.opacityValues),c)),r.code.add(a.H`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):r.code.add(a.H`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.include(i.A,t),e.attributes.add(l.r.COLORFEATUREATTRIBUTE,"float"),r.code.add(a.H`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(e.attributes.add(l.r.COLOR,"vec4"),r.code.add(a.H`vec4 getColor(){
return applyOpacity(color);
}`))}},40883:function(e,t,r){r.d(t,{K:function(){return l}});var i=r(77222),n=r(50295),s=r(39506),o=r(65839),a=r(84887);function l(e,t){t.hasSymbolColors?(e.include(i.A),e.attributes.add(o.r.SYMBOLCOLOR,"vec4"),e.varyings.add("colorMixMode","mediump float"),e.vertex.code.add(s.H`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(e.fragment.uniforms.add(new n.c("colorMixMode",(e=>a.Um[e.colorMixMode]))),e.vertex.code.add(s.H`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}},2457:function(e,t,r){r.d(t,{U:function(){return l},q:function(){return i}});var i,n,s=r(82547),o=r(39506),a=r(65839);function l(e,t){switch(t.textureCoordinateType){case i.Default:return e.attributes.add(a.r.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(o.H`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case i.Compressed:return e.attributes.add(a.r.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(o.H`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case i.Atlas:return e.attributes.add(a.r.UV0,"vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add(a.r.UVREGION,"vec4"),e.varyings.add("vuvRegion","vec4"),void e.vertex.code.add(o.H`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:(0,s.Xb)(t.textureCoordinateType);case i.None:return void e.vertex.code.add(o.H`void forwardTextureCoordinates() {}`);case i.COUNT:return}}(n=i||(i={}))[n.None=0]="None",n[n.Default=1]="Default",n[n.Atlas=2]="Atlas",n[n.Compressed=3]="Compressed",n[n.COUNT=4]="COUNT"},85709:function(e,t,r){r.d(t,{c:function(){return s}});var i=r(39506),n=r(65839);function s(e,t){t.hasVertexColors?(e.attributes.add(n.r.COLOR,"vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(i.H`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(i.H`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(i.H`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}},94211:function(e,t,r){r.d(t,{Mh:function(){return h},Zo:function(){return d},gy:function(){return p}});var i=r(82547),n=r(87725),s=r(41546),o=r(11377),a=r(66299),l=r(39506),c=r(31190),u=r(78567);function h(e,t){switch(t.normalType){case o.W.Attribute:case o.W.Compressed:e.include(o.Y,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add(new c.h("transformNormalGlobalFromModel",(e=>e.transformNormalGlobalFromModel)),new u.k("transformNormalViewFromGlobal",(e=>e.transformNormalViewFromGlobal))),e.vertex.code.add(l.H`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case o.W.Ground:e.include(a.em,t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(l.H`
        void forwardNormal() {
          vNormalWorld = ${t.spherical?l.H`normalize(vPositionWorldCameraRelative);`:l.H`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case o.W.ScreenDerivative:e.vertex.code.add(l.H`void forwardNormal() {}`);break;default:(0,i.Xb)(t.normalType);case o.W.COUNT:}}class d extends a.dO{constructor(){super(...arguments),this.transformNormalViewFromGlobal=(0,n.vt)()}}class p extends a.EM{constructor(){super(...arguments),this.transformNormalGlobalFromModel=(0,n.vt)(),this.toMapSpace=(0,s.vt)()}}},66299:function(e,t,r){r.d(t,{EM:function(){return g},dO:function(){return m},em:function(){return f}});var i=r(87725),n=r(39714),s=r(32501),o=r(91765),a=r(90576),l=r(4435),c=r(82598),u=r(39506),h=r(31190),d=r(78567),p=r(70340);function f(e,t){e.include(o.I);const r=e.vertex;r.include(a.u,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),r.uniforms.add(new c.t("transformWorldFromViewTH",(e=>e.transformWorldFromViewTH)),new c.t("transformWorldFromViewTL",(e=>e.transformWorldFromViewTL)),new d.k("transformViewFromCameraRelativeRS",(e=>e.transformViewFromCameraRelativeRS)),new p.X("transformProjFromView",(e=>e.transformProjFromView)),new h.h("transformWorldFromModelRS",(e=>e.transformWorldFromModelRS)),new l.W("transformWorldFromModelTH",(e=>e.transformWorldFromModelTH)),new l.W("transformWorldFromModelTL",(e=>e.transformWorldFromModelTL))),r.code.add(u.H`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),r.code.add(u.H`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${t.spherical?u.H`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:u.H`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),e.fragment.uniforms.add(new c.t("transformWorldFromViewTL",(e=>e.transformWorldFromViewTL))),r.code.add(u.H`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),e.fragment.code.add(u.H`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class m extends u.Y{constructor(){super(...arguments),this.transformWorldFromViewTH=(0,s.vt)(),this.transformWorldFromViewTL=(0,s.vt)(),this.transformViewFromCameraRelativeRS=(0,i.vt)(),this.transformProjFromView=(0,n.vt)()}}class g extends u.Y{constructor(){super(...arguments),this.transformWorldFromModelRS=(0,i.vt)(),this.transformWorldFromModelTH=(0,s.vt)(),this.transformWorldFromModelTL=(0,s.vt)()}}},28499:function(e,t,r){r.d(t,{r:function(){return a}});var i=r(82547),n=r(2457),s=r(39506);function o(e){e.fragment.code.add(s.H`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function a(e,t){switch(e.include(n.U,t),t.textureCoordinateType){case n.q.Default:case n.q.Compressed:return void e.fragment.code.add(s.H`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);case n.q.Atlas:return e.include(o),void e.fragment.code.add(s.H`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);default:(0,i.Xb)(t.textureCoordinateType);case n.q.None:case n.q.COUNT:return}}},74603:function(e,t,r){r.d(t,{G:function(){return c},V:function(){return h}});var i=r(33400),n=r(41546),s=r(19202),o=r(20830),a=r(38917),l=r(39506);function c(e,t){const r=e.vertex;t.hasVerticalOffset?(h(r),t.hasScreenSizePerspective&&(e.include(s.Y6),(0,s.OH)(r),(0,o.yu)(e.vertex,t)),r.code.add(l.H`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${t.spherical?l.H`vec3 worldNormal = normalize(worldPos + localOrigin);`:l.H`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${t.hasScreenSizePerspective?l.H`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:l.H`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):r.code.add(l.H`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const u=(0,n.vt)();function h(e){e.uniforms.add(new a.E("verticalOffset",((e,t)=>{const{minWorldLength:r,maxWorldLength:n,screenLength:s}=e.verticalOffset,o=Math.tan(.5*t.camera.fovY)/(.5*t.camera.fullViewport[3]),a=t.camera.pixelRatio||1;return(0,i.s)(u,s*a,o,r,n)})))}},15209:function(e,t,r){r.d(t,{E:function(){return v}});var i=r(30087),n=r(27264),s=r(13668),o=r(34178),a=r(11377),l=r(27271),c=r(2457),u=r(94211),h=r(84464),d=r(84435),p=r(58766),f=r(1354),m=r(20830),g=r(39506),y=r(39838),_=r(54407);function v(e,t){const{vertex:r,fragment:v}=e,b=t.hasColorTexture&&t.alphaDiscardMode!==_.sf.Opaque;switch(t.output){case n.V.Depth:(0,m.NB)(r,t),e.include(o.d,t),e.include(s.HQ,t),e.include(c.U,t),b&&v.uniforms.add(new y.N("tex",(e=>e.texture))),r.code.add(g.H`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),e.include(f.S,t),v.code.add(g.H`
          void main(void) {
            discardBySlice(vpos);
            ${b?g.H`
                    vec4 texColor = texture(tex, ${t.hasColorTextureTransform?g.H`colorUV`:g.H`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
          }
        `);break;case n.V.Shadow:case n.V.ShadowHighlight:case n.V.ShadowExcludeHighlight:case n.V.ViewshedShadow:case n.V.ObjectAndLayerIdColor:(0,m.NB)(r,t),e.include(o.d,t),e.include(c.U,t),e.include(p.A,t),e.include(h.L,t),e.include(s.HQ,t),e.include(l.g,t),(0,i.xJ)(e),e.varyings.add("depth","float"),b&&v.uniforms.add(new y.N("tex",(e=>e.texture))),r.code.add(g.H`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
forwardTextureCoordinates();
forwardObjectAndLayerIdColor();
}`),e.include(f.S,t),v.code.add(g.H`
          void main(void) {
            discardBySlice(vpos);
            ${b?g.H`
                    vec4 texColor = texture(tex, ${t.hasColorTextureTransform?g.H`colorUV`:g.H`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${t.output===n.V.ObjectAndLayerIdColor?g.H`outputObjectAndLayerIdColor();`:g.H`outputDepth(depth);`}
          }
        `);break;case n.V.Normal:{(0,m.NB)(r,t),e.include(o.d,t),e.include(a.Y,t),e.include(u.Mh,t),e.include(c.U,t),e.include(p.A,t),b&&v.uniforms.add(new y.N("tex",(e=>e.texture))),t.normalType===a.W.ScreenDerivative&&e.varyings.add("vPositionView","vec3");const i=t.normalType===a.W.Attribute||t.normalType===a.W.Compressed;r.code.add(g.H`
          void main(void) {
            vpos = getVertexInLocalOriginSpace();

            ${i?g.H`vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:g.H`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * vec4(vpos, 1.0)).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),e.include(s.HQ,t),e.include(f.S,t),v.code.add(g.H`
          void main() {
            discardBySlice(vpos);
            ${b?g.H`
                    vec4 texColor = texture(tex, ${t.hasColorTextureTransform?g.H`colorUV`:g.H`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${t.normalType===a.W.ScreenDerivative?g.H`vec3 normal = screenDerivativeNormal(vPositionView);`:g.H`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break}case n.V.Highlight:(0,m.NB)(r,t),e.include(o.d,t),e.include(c.U,t),e.include(p.A,t),b&&v.uniforms.add(new y.N("tex",(e=>e.texture))),r.code.add(g.H`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),e.include(s.HQ,t),e.include(f.S,t),e.include(d.Qh,t),v.code.add(g.H`
          void main() {
            discardBySlice(vpos);
            ${b?g.H`
                    vec4 texColor = texture(tex, ${t.hasColorTextureTransform?g.H`colorUV`:g.H`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}},10155:function(e,t,r){r.d(t,{K:function(){return s}});var i=r(45937),n=r(39506);function s(e){e.uniforms.add(new i.e("alignPixelEnabled",((e,t)=>t.alignPixelEnabled))),e.code.add(n.H`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),e.code.add(n.H`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}},1143:function(e,t,r){r.d(t,{Q:function(){return h},R:function(){return u}});var i=r(74603),n=r(19202),s=r(20830),o=r(38917),a=r(14543),l=r(39506),c=r(65839);const u=.5;function h(e,t){e.include(n.Y6),e.attributes.add(c.r.POSITION,"vec3"),e.attributes.add(c.r.NORMAL,"vec3"),e.attributes.add(c.r.CENTEROFFSETANDDISTANCE,"vec4");const r=e.vertex;(0,s.NB)(r,t),(0,s.yu)(r,t),r.uniforms.add(new o.E("viewport",((e,t)=>t.camera.fullViewport)),new a.m("polygonOffset",(e=>e.shaderPolygonOffset)),new a.m("cameraGroundRelative",((e,t)=>t.camera.aboveGround?1:-1))),t.hasVerticalOffset&&(0,i.V)(r),r.constants.add("smallOffsetAngle","float",.984807753012208),r.code.add(l.H`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.code.add(l.H`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${t.multipassEnabled?l.H.float(0):l.H`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),t.draped&&!t.hasVerticalOffset||(0,s.S7)(r),t.draped||(r.uniforms.add(new a.m("perDistancePixelRatio",((e,t)=>Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)))),r.code.add(l.H`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${l.H.float(u)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),t.screenCenterOffsetUnitsEnabled&&(0,s.Nz)(r),t.hasScreenSizePerspective&&(0,n.OH)(r),r.code.add(l.H`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?l.H`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled?"":l.H`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}},50399:function(e,t,r){r.d(t,{I:function(){return o}});var i=r(10155),n=r(78946),s=r(39506);function o(e,t){const{vertex:r,fragment:o}=e;r.include(i.K),t.multipassEnabled&&e.varyings.add("depth","float"),r.code.add(s.H`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.multipassEnabled?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),e.include(n.Q,t),o.code.add(s.H`
  void main() {
    fragColor = vec4(1);
    ${t.multipassEnabled?s.H`
        if(terrainDepthTest(depth)) {
          fragColor.g = 0.5;
        }`:""}
  }
  `)}},60808:function(e,t,r){var i;r.d(t,{D:function(){return i}}),function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"}(i||(i={}))},80231:function(e,t,r){r.d(t,{y:function(){return c}});var i=r(10155),n=r(60808),s=r(38917),o=r(14543),a=r(39506),l=r(39838);function c(e){e.vertex.uniforms.add(new o.m("renderTransparentlyOccludedHUD",((e,t)=>t.hudRenderStyle===n.D.Occluded?1:t.hudRenderStyle===n.D.NotOccluded?0:.75)),new s.E("viewport",((e,t)=>t.camera.fullViewport)),new l.N("hudVisibilityTexture",((e,t)=>t.hudVisibility?.getTexture()))),e.vertex.include(i.K),e.vertex.code.add(a.H`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}},84464:function(e,t,r){r.d(t,{L:function(){return o}});var i=r(27264),n=r(47483),s=r(39506);function o(e,t){switch(t.output){case i.V.Shadow:case i.V.ShadowHighlight:case i.V.ShadowExcludeHighlight:case i.V.ViewshedShadow:e.fragment.include(n.U),e.fragment.code.add(s.H`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth) {
fragColor = floatToRgba4(_calculateFragDepth(_linearDepth));
}`)}}},84435:function(e,t,r){r.d(t,{Qh:function(){return l},U:function(){return o},bO:function(){return a}});var i=r(41546),n=r(39506),s=r(39838);const o=(0,i.fA)(1,1,0,1),a=(0,i.fA)(1,0,1,1);function l(e){e.fragment.uniforms.add(new s.N("depthTexture",((e,t)=>t.mainDepth))),e.fragment.constants.add("occludedHighlightFlag","vec4",o).add("unoccludedHighlightFlag","vec4",a),e.fragment.code.add(n.H`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)}},23397:function(e,t,r){r.d(t,{E:function(){return a}});var i=r(13786),n=r(1932),s=(r(52766),r(11687)),o=r(39506);function a(e){e.uniforms.add(new s.G("zProjectionMap",((e,t)=>function(e){const t=e.projectionMatrix;return(0,i.hZ)(l,t[14],t[10])}(t.camera)))),e.code.add(o.H`float linearizeDepth(float depth) {
float depthNdc = depth * 2.0 - 1.0;
float c1 = zProjectionMap[0];
float c2 = zProjectionMap[1];
return -(c1 / (depthNdc + c2 + 1e-7));
}`),e.code.add(o.H`float depthFromTexture(sampler2D depthTexture, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
float depth = texelFetch(depthTexture, iuv, 0).r;
return depth;
}`),e.code.add(o.H`float linearDepthFromTexture(sampler2D depthTexture, vec2 uv) {
return linearizeDepth(depthFromTexture(depthTexture, uv));
}`)}const l=(0,n.vt)()},40602:function(e,t,r){r.d(t,{W:function(){return m}});var i=r(87725),n=r(1932),s=r(2457),o=r(28499),a=r(50865),l=r(11687),c=r(39506),u=r(78567),h=r(40075),d=r(39838),p=r(54516),f=r(65839);function m(e,t){const r=e.fragment;t.hasVertexTangents?(e.attributes.add(f.r.TANGENT,"vec4"),e.varyings.add("vTangent","vec4"),t.doubleSidedMode===a.W.WindingOrder?r.code.add(c.H`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):r.code.add(c.H`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):r.code.add(c.H`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),t.textureCoordinateType!==s.q.None&&(e.include(o.r,t),r.uniforms.add(t.pbrTextureBindType===p.c.Pass?new d.N("normalTexture",(e=>e.textureNormal)):new h.o("normalTexture",(e=>e.textureNormal))),t.hasNormalTextureTransform&&(r.uniforms.add(new l.G("scale",(e=>e.scale??n.Un))),r.uniforms.add(new u.k("normalTextureTransformMatrix",(e=>e.normalTextureTransformMatrix??i.zK)))),r.code.add(c.H`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;`),t.hasNormalTextureTransform&&r.code.add(c.H`mat3 normalTextureRotation = mat3(normalTextureTransformMatrix[0][0]/scale[0], normalTextureTransformMatrix[0][1]/scale[1], 0.0,
normalTextureTransformMatrix[1][0]/scale[0], normalTextureTransformMatrix[1][1]/scale[1], 0.0,
0.0, 0.0, 0.0 );
rawNormal.xy = (normalTextureRotation * vec3(rawNormal.x, rawNormal.y, 1.0)).xy;`),r.code.add(c.H`return tangentSpace * rawNormal;
}`))}},46042:function(e,t,r){r.d(t,{W:function(){return h}});var i=r(20551),n=r(32501),s=r(33400),o=r(41546),a=r(11520),l=r(82598),c=r(38917),u=r(39506);function h(e,t){const r=e.fragment,n=void 0!==t.lightingSphericalHarmonicsOrder?t.lightingSphericalHarmonicsOrder:2;0===n?(r.uniforms.add(new l.t("lightingAmbientSH0",((e,t)=>(0,i.s)(d,t.lighting.sh.r[0],t.lighting.sh.g[0],t.lighting.sh.b[0])))),r.code.add(u.H`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===n?(r.uniforms.add(new c.E("lightingAmbientSH_R",((e,t)=>(0,s.s)(p,t.lighting.sh.r[0],t.lighting.sh.r[1],t.lighting.sh.r[2],t.lighting.sh.r[3]))),new c.E("lightingAmbientSH_G",((e,t)=>(0,s.s)(p,t.lighting.sh.g[0],t.lighting.sh.g[1],t.lighting.sh.g[2],t.lighting.sh.g[3]))),new c.E("lightingAmbientSH_B",((e,t)=>(0,s.s)(p,t.lighting.sh.b[0],t.lighting.sh.b[1],t.lighting.sh.b[2],t.lighting.sh.b[3])))),r.code.add(u.H`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===n&&(r.uniforms.add(new l.t("lightingAmbientSH0",((e,t)=>(0,i.s)(d,t.lighting.sh.r[0],t.lighting.sh.g[0],t.lighting.sh.b[0]))),new c.E("lightingAmbientSH_R1",((e,t)=>(0,s.s)(p,t.lighting.sh.r[1],t.lighting.sh.r[2],t.lighting.sh.r[3],t.lighting.sh.r[4]))),new c.E("lightingAmbientSH_G1",((e,t)=>(0,s.s)(p,t.lighting.sh.g[1],t.lighting.sh.g[2],t.lighting.sh.g[3],t.lighting.sh.g[4]))),new c.E("lightingAmbientSH_B1",((e,t)=>(0,s.s)(p,t.lighting.sh.b[1],t.lighting.sh.b[2],t.lighting.sh.b[3],t.lighting.sh.b[4]))),new c.E("lightingAmbientSH_R2",((e,t)=>(0,s.s)(p,t.lighting.sh.r[5],t.lighting.sh.r[6],t.lighting.sh.r[7],t.lighting.sh.r[8]))),new c.E("lightingAmbientSH_G2",((e,t)=>(0,s.s)(p,t.lighting.sh.g[5],t.lighting.sh.g[6],t.lighting.sh.g[7],t.lighting.sh.g[8]))),new c.E("lightingAmbientSH_B2",((e,t)=>(0,s.s)(p,t.lighting.sh.b[5],t.lighting.sh.b[6],t.lighting.sh.b[7],t.lighting.sh.b[8])))),r.code.add(u.H`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),t.pbrMode!==a.A9.Normal&&t.pbrMode!==a.A9.Schematic||r.code.add(u.H`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const d=(0,n.vt)(),p=(0,o.vt)()},63684:function(e,t,r){r.d(t,{n:function(){return G}});var i=r(39506),n=r(39838),s=r(53804),o=r(15774),a=r(95929),l=r(28181),c=r(38504),u=r(23502),h=(r(58941),r(40633),r(13798),r(65953)),d=r(13786),p=r(98680),f=r(83525),m=r(39819),g=r(54407);let y=class extends f.A{constructor(e){super(e),this.view=null,this.consumes={required:[]},this.produces="composite-color",this._context=null,this._dirty=!0}initialize(){this.addHandles([(0,l.watch)((()=>this.view.ready),(e=>{e&&this.view._stage?.renderer.addRenderNode(this)}),l.Vh)])}destroy(){this.view._stage?.renderer?.removeRenderNode(this)}render(){throw new m.A("RenderNode:render-function-not-implemented","render() is not implemented.")}get camera(){return this.view.state.camera.clone()}get sunLight(){return this.bindParameters.lighting.legacy}get gl(){return this.view._stage.renderView.renderingContext.gl}acquireOutputFramebuffer(){const e=this._frameBuffer?.getTexture()?.descriptor,t=this.view._stage.renderer.fboCache.acquire(e?.width??640,e?.height??480,this.produces);return t.fbo?.initializeAndBind(),t}bindRenderTarget(){return this._frameBuffer?.fbo?.initializeAndBind(),this._frameBuffer}requestRender(e){e===g.C7.UPDATE&&this.view._stage?.renderView.requestRender(e),this._dirty=!0}resetWebGLState(){this.renderingContext.resetState(),this.renderingContext.bindFramebuffer(this._frameBuffer?.fbo)}get fboCache(){return this.view._stage.renderer.fboCache}get bindParameters(){return this._context.bindParameters}get renderingContext(){return this.view._stage.renderView.renderingContext}updateAnimation(){return!!this._dirty&&(this._dirty=!1,!0)}doRender(e,t){this._context=t,this._frameBuffer=e.find((({name:e})=>e===this.produces));try{return this.render(e)}finally{this._frameBuffer=null}}};(0,s._)([(0,u.MZ)({constructOnly:!0})],y.prototype,"view",void 0),(0,s._)([(0,u.MZ)({constructOnly:!0})],y.prototype,"consumes",void 0),(0,s._)([(0,u.MZ)()],y.prototype,"produces",void 0),y=(0,s._)([(0,h.$)("esri.views.3d.webgl.RenderNode")],y);const _=y;var v=r(3088),b=r(34615),x=r(22542),S=r(40502),w=r(54101),T=r(37739),A=r(57087);class C extends x.w{initializeProgram(e){return new w.B(e.rctx,C.shader.get().build(),S.D)}initializePipeline(){return(0,A.Ey)({colorWrite:A.wE})}}C.shader=new b.$(T.S,(()=>r.e(7809).then(r.bind(r,92891))));var E=r(1932);class M extends i.Y{constructor(){super(...arguments),this.projScale=1}}class R extends M{constructor(){super(...arguments),this.intensity=1}}class P extends i.Y{}class O extends P{constructor(){super(...arguments),this.blurSize=(0,E.vt)()}}var I=r(184);class L extends x.w{initializeProgram(e){return new w.B(e.rctx,L.shader.get().build(),S.D)}initializePipeline(){return(0,A.Ey)({colorWrite:A.wE})}}L.shader=new b.$(I.S,(()=>r.e(5912).then(r.bind(r,45352))));var N=r(85456),D=r(78541),F=r(10956);const z=2;let V=class extends _{constructor(e){super(e),this.consumes={required:["normals"]},this.produces="ssao",this.isEnabled=()=>!1,this._enableTime=(0,c.l5)(0),this._passParameters=new R,this._drawParameters=new O}initialize(){const e=Uint8Array.from(atob("eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM"),(e=>e.charCodeAt(0))),t=new F.R;t.wrapMode=N.pF.CLAMP_TO_EDGE,t.pixelFormat=N.Ab.RGB,t.wrapMode=N.pF.REPEAT,t.hasMipmap=!0,t.width=32,t.height=32,this._passParameters.noiseTexture=new D.g(this.renderingContext,t,e),this._ssaoTechnique=this.techniques.acquire(L),this._blurTechnique=this.techniques.acquire(C),this.addHandles((0,l.watch)((()=>this.isEnabled()),(()=>this._enableTime=(0,c.l5)(0))))}destroy(){this._passParameters.noiseTexture=(0,a.WD)(this._passParameters.noiseTexture),this._blurTechnique.release(),this._ssaoTechnique.release()}render(e){const t=this.bindParameters,r=e.find((({name:e})=>"normals"===e)),i=r?.getTexture(),n=r?.getTexture(N.nI),s=this.fboCache,a=t.camera,l=a.fullViewport[2],u=a.fullViewport[3],h=Math.round(l/z),f=Math.round(u/z);if(!this._ssaoTechnique.compiled||!this._blurTechnique.compiled)return this._enableTime=(0,c.l5)(performance.now()),this.requestRender(),s.acquire(h,f,"ssao",p.N.RED);0===this._enableTime&&(this._enableTime=(0,c.l5)(performance.now()));const m=this.renderingContext,y=this.view.qualitySettings.fadeDuration,_=a.relativeElevation,b=(0,o.qE)((v.b-_)/(v.b-v.O),0,1),x=y>0?Math.min(y,performance.now()-this._enableTime)/y:1,S=x*b;this._passParameters.normalTexture=i,this._passParameters.depthTexture=n,this._passParameters.projScale=1/a.computeScreenPixelSizeAtDist(1),this._passParameters.intensity=4*U/(0,I.g)(a)**6*S;const w=s.acquire(l,u,"ssao input",p.N.RG);m.unbindTexture(w.fbo.colorTexture),m.bindFramebuffer(w.fbo),m.setViewport(0,0,l,u),m.bindTechnique(this._ssaoTechnique,t,this._passParameters,this._drawParameters),m.screen.draw();const T=s.acquire(h,f,"ssao blur",p.N.RED);m.unbindTexture(T.fbo.colorTexture),m.bindFramebuffer(T.fbo),this._drawParameters.colorTexture=w.getTexture(),(0,d.hZ)(this._drawParameters.blurSize,0,z/u),m.bindTechnique(this._blurTechnique,t,this._passParameters,this._drawParameters),m.setViewport(0,0,h,f),m.screen.draw(),w.release();const A=s.acquire(h,f,"ssao",p.N.RED);return m.unbindTexture(A.fbo.colorTexture),m.bindFramebuffer(A.fbo),m.setViewport(0,0,l,u),m.setClearColor(1,1,1,0),m.clear(N.hn.COLOR_BUFFER_BIT),this._drawParameters.colorTexture=T.getTexture(),(0,d.hZ)(this._drawParameters.blurSize,z/l,0),m.bindTechnique(this._blurTechnique,t,this._passParameters,this._drawParameters),m.setViewport(0,0,h,f),m.screen.draw(),m.setViewport4fv(a.fullViewport),T.release(),x<1&&this.requestRender(g.C7.UPDATE),A}};(0,s._)([(0,u.MZ)()],V.prototype,"consumes",void 0),(0,s._)([(0,u.MZ)()],V.prototype,"produces",void 0),(0,s._)([(0,u.MZ)({constructOnly:!0})],V.prototype,"techniques",void 0),(0,s._)([(0,u.MZ)({constructOnly:!0})],V.prototype,"isEnabled",void 0),V=(0,s._)([(0,h.$)("esri.views.3d.webgl-engine.effects.ssao.SSAO")],V);const U=.5;function G(e,t){const r=e.fragment;t.receiveAmbientOcclusion?(r.uniforms.add(new n.N("ssaoTex",((e,t)=>t.ssao?.getTexture()))),r.constants.add("blurSizePixelsInverse","float",1/z),r.code.add(i.H`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):r.code.add(i.H`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}},97910:function(e,t,r){r.d(t,{a8:function(){return f},eU:function(){return m},kA:function(){return g}});var i=r(82547),n=r(46042),s=r(63684),o=r(42426),a=r(51942),l=r(11520),c=r(61629),u=r(45937),h=r(14543),d=r(39506),p=r(95629);function f(e){e.constants.add("ambientBoostFactor","float",p.uH)}function m(e){e.uniforms.add(new h.m("lightingGlobalFactor",((e,t)=>t.lighting.globalFactor)))}function g(e,t){const r=e.fragment;switch(e.include(s.n,t),t.pbrMode!==l.A9.Disabled&&e.include(a.c,t),e.include(n.W,t),e.include(c.p),r.code.add(d.H`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${t.pbrMode===l.A9.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),f(r),m(r),(0,o.Gc)(r),r.code.add(d.H`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${t.spherical?d.H`normalize(vPosWorld)`:d.H`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),(0,o.O4)(r),r.code.add(d.H`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),t.pbrMode){case l.A9.Disabled:case l.A9.WaterOnIntegratedMesh:case l.A9.Water:e.include(o.qU),r.code.add(d.H`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case l.A9.Normal:case l.A9.Schematic:r.code.add(d.H`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),r.code.add(d.H`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),t.useFillLights?r.uniforms.add(new u.e("hasFillLights",((e,t)=>t.enableFillLights))):r.constants.add("hasFillLights","bool",!1),r.code.add(d.H`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),r.uniforms.add(new h.m("lightingSpecularStrength",((e,t)=>t.lighting.mainLight.specularStrength)),new h.m("lightingEnvironmentStrength",((e,t)=>t.lighting.mainLight.environmentStrength))),r.code.add(d.H`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
float normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));
inputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),r.code.add(d.H`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = _emission == vec3(0.0) ? _emission : pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${t.pbrMode!==l.A9.Schematic||t.hasColorTexture?d.H`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`:d.H`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case l.A9.Simplified:case l.A9.TerrainWithWater:e.include(o.qU),r.code.add(d.H`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluatePBRSimplifiedLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:(0,i.Xb)(t.pbrMode);case l.A9.COUNT:}}},2120:function(e,t,r){r.d(t,{v:function(){return s},z:function(){return n}});var i=r(39506);function n(e){e.fragment.code.add(i.H`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function s(e){e.fragment.code.add(i.H`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}},31166:function(e,t,r){r.d(t,{q:function(){return f},h:function(){return m}});var i=r(52766),n=r(20830),s=r(38917),o=r(14543),a=r(39506),l=r(39838);function c(e){return e.pattern.map((t=>Math.round(t*e.pixelRatio)))}function u(e){return c(e).reduce(((e,t)=>Math.max(e,t)))}r(5161),r(85456),r(78541),r(10956);var h=r(33400),d=r(41546);const p=(0,d.vt)();function f(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?function(e,t){const r=!(t.draped&&t.stipplePreferContinuous),{vertex:c,fragment:f}=e;f.include(i.W),t.draped||((0,n.yu)(c,t),c.uniforms.add(new o.m("worldToScreenPerDistanceRatio",((e,t)=>1/t.camera.perScreenPixelRatio))),c.code.add(a.H`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),e.varyings.add("vStippleDistance","float"),e.varyings.add("vStippleDistanceLimits","vec2"),e.varyings.add("vStipplePatternStretch","float"),c.code.add(a.H`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${g};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),c.code.add(a.H`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),c.code.add(a.H`
    if (segmentLengthPseudoScreen >= ${r?"patternLength":"1e4"}) {
  `),(0,n.Nz)(c),c.code.add(a.H`float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
float segmentLengthScreenRounded = flooredRepetitions * patternLength;
float stretch = repetitions / flooredRepetitions;
vStipplePatternStretch = max(0.75, stretch);
return vec2(0.0, segmentLengthScreenRounded);
}
return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
}`),f.uniforms.add(new l.N("stipplePatternTexture",(e=>e.stippleTexture)),new o.m("stipplePatternSDFNormalizer",(e=>function(e){return e?(Math.floor(.5*(u(e)-1))+.5)/e.pixelRatio:1}(e.stipplePattern))),new o.m("stipplePatternPixelSizeInv",(e=>1/m(e)))),f.code.add(a.H`float getStippleSDF(out bool isClamped) {
float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;
float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;
u = fract(u);
float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;
return (sdf - 0.5) * vStipplePatternStretch + 0.5;
}
float getStippleSDF() {
bool ignored;
return getStippleSDF(ignored);
}
float getStippleAlpha() {
bool isClamped;
float stippleSDF = getStippleSDF(isClamped);
float antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);
return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
}`),t.stippleOffColorEnabled?(f.uniforms.add(new s.E("stippleOffColor",(e=>function(e){return null==e?d.uY:4===e.length?e:(0,h.s)(p,e[0],e[1],e[2],1)}(e.stippleOffColor)))),f.code.add(a.H`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):f.code.add(a.H`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}(e,t):function(e){e.fragment.code.add(a.H`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}(e)}function m(e){const t=e.stipplePattern;return t?function(e){if(null==e)return 1;const t=c(e);return Math.floor(t.reduce(((e,t)=>e+t)))}(e.stipplePattern)/t.pixelRatio:1}const g=a.H.float(.4)},42426:function(e,t,r){r.d(t,{Gc:function(){return s},O4:function(){return o},qU:function(){return a}});var i=r(82598),n=r(39506);function s(e){e.uniforms.add(new i.t("mainLightDirection",((e,t)=>t.lighting.mainLight.direction)))}function o(e){e.uniforms.add(new i.t("mainLightIntensity",((e,t)=>t.lighting.mainLight.intensity)))}function a(e){s(e.fragment),o(e.fragment),e.fragment.code.add(n.H`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}},91981:function(e,t,r){r.d(t,{r:function(){return l}});var i=r(33710),n=r(20830),s=r(14543),o=r(39506),a=r(50678);function l(e,t){const{vertex:r,constants:l}=e;l.add("markerSizePerLineWidth","float",i.PV),(0,n.Nz)(r),null==r.uniforms.get("markerScale")&&r.constants.add("markerScale","float",1),r.code.add(o.H`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),t.space===a.lM.World&&(r.constants.add("maxSegmentLengthFraction","float",.45),r.uniforms.add(new s.m("perRenderPixelRatio",((e,t)=>t.camera.perRenderPixelRatio))),r.code.add(o.H`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}},98901:function(e,t,r){r.d(t,{H:function(){return o},U:function(){return a}});var i=r(23397),n=r(39506),s=r(39838);function o(e){e.include(i.E),e.uniforms.add(new s.N("geometryDepthTexture",((e,t)=>t.multipassGeometry.depth?.attachment))),e.code.add(n.H`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos);
return (elementDepth < (geometryDepth - 1.0));
}`)}class a{}},78946:function(e,t,r){r.d(t,{Q:function(){return o},h:function(){return a}});var i=r(23397),n=r(39506),s=r(39838);function o(e,t){if(!t.multipassEnabled)return;e.fragment.include(i.E),e.fragment.uniforms.add(new s.N("terrainDepthTexture",((e,t)=>t.multipassTerrain.depth?.attachment)));const r=t.occlusionPass;e.fragment.code.add(n.H`
   ${r?"bool":"void"} terrainDepthTest(float fragmentDepth) {
      float depth = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0).r;
      float linearDepth = linearizeDepth(depth);
      ${r?n.H`return fragmentDepth < linearDepth && depth < 1.0;`:n.H`
          if(fragmentDepth ${t.cullAboveGround?">":"<="} linearDepth){
            discard;
          }`}
    }`)}class a{constructor(){this.cullAboveGround=!1}}},69701:function(e,t,r){r.d(t,{n:function(){return n}});var i=r(39506);function n(e,t){t.spherical?e.vertex.code.add(i.H`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):e.vertex.code.add(i.H`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),t.spherical?e.vertex.code.add(i.H`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):e.vertex.code.add(i.H`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}},50865:function(e,t,r){r.d(t,{W:function(){return i},r:function(){return a}});var i,n,s=r(82547),o=r(39506);function a(e,t){const r=e.fragment;switch(r.code.add(o.H`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),t.doubleSidedMode){case i.None:r.code.add(o.H`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case i.View:r.code.add(o.H`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case i.WindingOrder:r.code.add(o.H`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:(0,s.Xb)(t.doubleSidedMode);case i.COUNT:}}(n=i||(i={}))[n.None=0]="None",n[n.View=1]="View",n[n.WindingOrder=2]="WindingOrder",n[n.COUNT=3]="COUNT"},51942:function(e,t,r){r.d(t,{c:function(){return a},f:function(){return l}});var i=r(39506);function n(e){const t=e.fragment.code;t.add(i.H`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.add(i.H`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.add(i.H`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}var s=r(11520),o=r(61629);function a(e,t){const r=e.fragment.code;e.include(o.p),t.pbrMode!==s.A9.Normal&&t.pbrMode!==s.A9.Schematic&&t.pbrMode!==s.A9.Simplified&&t.pbrMode!==s.A9.TerrainWithWater||(r.add(i.H`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),r.add(i.H`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),t.pbrMode!==s.A9.Normal&&t.pbrMode!==s.A9.Schematic||(e.include(n),r.add(i.H`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),r.add(i.H`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),r.add(i.H`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),r.add(i.H`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function l(e,t){const r=e.fragment.code;e.include(o.p),r.add(i.H`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),r.add(i.H`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),r.add(i.H`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),r.add(i.H`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),r.add(i.H`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}},11520:function(e,t,r){r.d(t,{A9:function(){return i},_Z:function(){return d}});var i,n,s=r(28499),o=r(4435),a=r(82598),l=r(39506),c=r(40075),u=r(39838),h=r(54516);function d(e,t){const r=e.fragment,n=t.hasMetallicRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;if(t.pbrMode===i.Normal&&n&&e.include(s.r,t),t.pbrMode!==i.Schematic)if(t.pbrMode!==i.Disabled){if(t.pbrMode===i.Normal){r.code.add(l.H`vec3 mrr;
vec3 emission;
float occlusion;`);const e=t.pbrTextureBindType;t.hasMetallicRoughnessTexture&&(r.uniforms.add(e===h.c.Pass?new u.N("texMetallicRoughness",(e=>e.textureMetallicRoughness)):new c.o("texMetallicRoughness",(e=>e.textureMetallicRoughness))),r.code.add(l.H`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),t.hasEmissionTexture&&(r.uniforms.add(e===h.c.Pass?new u.N("texEmission",(e=>e.textureEmissive)):new c.o("texEmission",(e=>e.textureEmissive))),r.code.add(l.H`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),t.hasOcclusionTexture?(r.uniforms.add(e===h.c.Pass?new u.N("texOcclusion",(e=>e.textureOcclusion)):new c.o("texOcclusion",(e=>e.textureOcclusion))),r.code.add(l.H`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):r.code.add(l.H`float getBakedOcclusion() { return 1.0; }`),e===h.c.Pass?r.uniforms.add(new a.t("emissionFactor",(e=>e.emissiveFactor)),new a.t("mrrFactors",(e=>e.mrrFactors))):r.uniforms.add(new o.W("emissionFactor",(e=>e.emissiveFactor)),new o.W("mrrFactors",(e=>e.mrrFactors))),r.code.add(l.H`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${t.hasMetallicRoughnessTexture?l.H`applyMetallnessAndRoughness(${t.hasMetallicRoughnessTextureTransform?l.H`metallicRoughnessUV`:"vuv0"});`:""}

      ${t.hasEmissionTexture?l.H`applyEmission(${t.hasEmissiveTextureTransform?l.H`emissiveUV`:"vuv0"});`:""}

      ${t.hasOcclusionTexture?l.H`applyOcclusion(${t.hasOcclusionTextureTransform?l.H`occlusionUV`:"vuv0"});`:""}
    }
  `)}}else r.code.add(l.H`float getBakedOcclusion() { return 1.0; }`);else r.code.add(l.H`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}r(36634),(n=i||(i={}))[n.Disabled=0]="Disabled",n[n.Normal=1]="Normal",n[n.Schematic=2]="Schematic",n[n.Water=3]="Water",n[n.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",n[n.Simplified=5]="Simplified",n[n.TerrainWithWater=6]="TerrainWithWater",n[n.COUNT=7]="COUNT"},61629:function(e,t,r){r.d(t,{p:function(){return n}});var i=r(39506);function n(e){e.vertex.code.add(i.H`const float PI = 3.141592653589793;`),e.fragment.code.add(i.H`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}},56574:function(e,t,r){r.d(t,{Bz:function(){return p},G:function(){return d}}),r(39714),r(32501);var i=r(47483),n=r(38917),s=r(50295),o=r(39506),a=r(65312),l=r(54516);class c extends a.n{constructor(e,t,r){super(e,"mat4",l.c.Draw,((r,i,n,s)=>r.setUniformMatrix4fv(e,t(i,n,s))),r)}}class u extends a.n{constructor(e,t,r){super(e,"mat4",l.c.Pass,((r,i,n)=>r.setUniformMatrix4fv(e,t(i,n))),r)}}var h=r(39838);function d(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new u("shadowMapMatrix",((e,t)=>t.shadowMap.getShadowMapMatrices(e.origin)),4)),f(e))}function p(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new c("shadowMapMatrix",((e,t)=>t.shadowMap.getShadowMapMatrices(e.origin)),4)),f(e))}function f(e){const t=e.fragment;t.include(i.U),t.uniforms.add(new h.N("shadowMap",((e,t)=>t.shadowMap.depthTexture)),new s.c("numCascades",((e,t)=>t.shadowMap.numCascades)),new n.E("cascadeDistances",((e,t)=>t.shadowMap.cascadeDistances))),t.code.add(o.H`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {
float xScale = float(textureSize.y) / float(textureSize.x);
return vec2((float(i) + lvpos.x) * xScale, lvpos.y);
}
float readShadowMapDepth(ivec2 uv, sampler2D _depthTex) {
return rgba4ToFloat(texelFetch(_depthTex, uv, 0));
}
float posIsInShadow(ivec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, ivec2 texSize, sampler2D _depthTex) {
vec2 st = fract(uv * vec2(texSize) + vec2(0.5));
ivec2 base = ivec2(uv * vec2(texSize) - vec2(0.5));
float s00 = posIsInShadow(ivec2(base.x, base.y), lvpos, _depthTex);
float s10 = posIsInShadow(ivec2(base.x + 1, base.y), lvpos, _depthTex);
float s11 = posIsInShadow(ivec2(base.x + 1, base.y + 1), lvpos, _depthTex);
float s01 = posIsInShadow(ivec2(base.x, base.y + 1), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
ivec2 size = textureSize(shadowMap, 0);
vec2 uv = cascadeCoordinates(i, size, lvpos);
return filterShadow(uv, lvpos, size, shadowMap);
}`)}o.Y,o.Y},3088:function(e,t,r){r.d(t,{O:function(){return i},b:function(){return n}});const i=3e5,n=5e5},86207:function(e,t,r){r.d(t,{MU:function(){return c},O1:function(){return u},QM:function(){return h},Sx:function(){return l},q2:function(){return a}});var i=r(87725),n=r(2457),s=r(39506),o=r(78567);function a(e,t){t.hasColorTextureTransform?(e.vertex.uniforms.add(new o.k("colorTextureTransformMatrix",(e=>e.colorTextureTransformMatrix??i.zK))),e.varyings.add("colorUV","vec2"),e.vertex.code.add(s.H`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(s.H`void forwardColorUV(){}`)}function l(e,t){t.hasNormalTextureTransform&&t.textureCoordinateType!==n.q.None?(e.vertex.uniforms.add(new o.k("normalTextureTransformMatrix",(e=>e.normalTextureTransformMatrix??i.zK))),e.varyings.add("normalUV","vec2"),e.vertex.code.add(s.H`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(s.H`void forwardNormalUV(){}`)}function c(e,t){t.hasEmissionTextureTransform&&t.textureCoordinateType!==n.q.None?(e.vertex.uniforms.add(new o.k("emissiveTextureTransformMatrix",(e=>e.emissiveTextureTransformMatrix??i.zK))),e.varyings.add("emissiveUV","vec2"),e.vertex.code.add(s.H`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(s.H`void forwardEmissiveUV(){}`)}function u(e,t){t.hasOcclusionTextureTransform&&t.textureCoordinateType!==n.q.None?(e.vertex.uniforms.add(new o.k("occlusionTextureTransformMatrix",(e=>e.occlusionTextureTransformMatrix??i.zK))),e.varyings.add("occlusionUV","vec2"),e.vertex.code.add(s.H`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(s.H`void forwardOcclusionUV(){}`)}function h(e,t){t.hasMetallicRoughnessTextureTransform&&t.textureCoordinateType!==n.q.None?(e.vertex.uniforms.add(new o.k("metallicRoughnessTextureTransformMatrix",(e=>e.metallicRoughnessTextureTransformMatrix??i.zK))),e.varyings.add("metallicRoughnessUV","vec2"),e.vertex.code.add(s.H`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(s.H`void forwardMetallicRoughnessUV(){}`)}},58766:function(e,t,r){r.d(t,{A:function(){return u}});var i=r(82598),n=r(30636),s=r(454),o=r(39506),a=r(78567),l=r(65839),c=r(77971);function u(e,t){const{vertex:r,attributes:u}=e;t.hasVvInstancing&&(t.vvSize||t.vvColor)&&u.add(l.r.INSTANCEFEATUREATTRIBUTE,"vec4"),t.vvSize?(r.uniforms.add(new i.t("vvSizeMinSize",(e=>e.vvSize.minSize))),r.uniforms.add(new i.t("vvSizeMaxSize",(e=>e.vvSize.maxSize))),r.uniforms.add(new i.t("vvSizeOffset",(e=>e.vvSize.offset))),r.uniforms.add(new i.t("vvSizeFactor",(e=>e.vvSize.factor))),r.uniforms.add(new a.k("vvSymbolRotationMatrix",(e=>e.vvSymbolRotationMatrix))),r.uniforms.add(new i.t("vvSymbolAnchor",(e=>e.vvSymbolAnchor))),r.code.add(o.H`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),r.code.add(o.H`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.hasVvInstancing?o.H`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):r.code.add(o.H`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(r.constants.add("vvColorNumber","int",c.p),r.uniforms.add(new s.x("vvColorValues",(e=>e.vvColor.values),c.p),new n.F("vvColorColors",(e=>e.vvColor.colors),c.p)),r.code.add(o.H`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${t.hasVvInstancing?o.H`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):r.code.add(o.H`vec4 vvColor() { return vec4(1.0); }`)}},11388:function(e,t,r){r.d(t,{E:function(){return C}});var i=r(2120),n=r(39506);function s(e){e.fragment.code.add(n.H`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var o=r(51942),a=r(3088),l=r(23397),c=r(11687),u=r(14543),h=r(70340),d=r(39838);function p(e,t){const r=e.fragment;r.include(l.E),r.uniforms.add(new c.G("nearFar",((e,t)=>t.camera.nearFar))),r.uniforms.add(new d.N("depthMap",((e,t)=>t.depth?.attachment))),r.uniforms.add(new h.X("proj",((e,t)=>t.camera.projectionMatrix))),r.uniforms.add(new u.m("invResolutionHeight",((e,t)=>1/t.camera.height))),r.uniforms.add(new h.X("reprojectionMatrix",((e,t)=>t.ssr.reprojectionMatrix))),r.code.add(n.H`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${t.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}var f=r(15774),m=r(43587),g=r(47096),y=r(75256),_=r(58192),v=r(42426),b=r(45937),x=r(82598),S=r(65312),w=r(54516);class T extends S.n{constructor(e,t){super(e,"samplerCube",w.c.Pass,((r,i,n)=>r.bindTexture(e,t(i,n))))}}function A(e){const t=e.fragment;t.uniforms.add(new h.X("rotationMatrixClouds",((e,t)=>t.cloudsFade.parallax.transform)),new h.X("rotationMatrixCloudsCrossFade",((e,t)=>t.cloudsFade.parallaxNew.transform)),new x.t("anchorPosition",((e,t)=>t.cloudsFade.parallax.anchorPointClouds)),new x.t("anchorPositionCrossFade",((e,t)=>t.cloudsFade.parallaxNew.anchorPointClouds)),new u.m("cloudsHeight",(()=>_.k9)),new u.m("radiusCurvatureCorrectionFactor",((e,t)=>t.cloudsFade.parallax.radiusCurvatureCorrectionFactor)),new u.m("totalFadeInOut",((e,t)=>1-t.cloudsFade.opacity)),new u.m("crossFadeAnchorFactor",((e,t)=>(0,f.qE)(t.cloudsFade.fadeFactor,0,1))),new T("cubeMap",((e,t)=>t.cloudsFade.data?.cubeMap?.colorTexture??null)),new b.e("crossFade",((e,t)=>t.cloudsFade.fadeMode===y.OQ.CROSS_FADE)),new b.e("readChannelsRG",((e,t)=>t.cloudsFade.readChannels===g.c.RG)),new b.e("fadeTextureChannels",((e,t)=>t.cloudsFade.renderingStage===g.c2.FADING))),t.constants.add("planetRadius","float",m.$O.radius),t.code.add(n.H`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),t.code.add(n.H`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),t.code.add(n.H`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),(0,v.Gc)(t),(0,v.O4)(t),t.code.add(n.H`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),t.code.add(n.H`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),t.code.add(n.H`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),t.code.add(n.H`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),t.code.add(n.H`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function C(e,t){e.include(o.f,t),e.include(s),e.include(i.v),t.hasCloudsReflections&&e.include(A,t),t.hasScreenSpaceReflections&&e.include(p,t);const r=e.fragment;r.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",a.O).add("ssrHeightFadeEnd","float",a.b).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),r.code.add(n.H`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),r.uniforms.add(new u.m("lightingSpecularStrength",((e,t)=>t.lighting.mainLight.specularStrength)),new u.m("lightingEnvironmentStrength",((e,t)=>t.lighting.mainLight.environmentStrength))),r.code.add(n.H`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),t.hasCloudsReflections&&r.code.add(n.H`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),t.hasScreenSpaceReflections?(r.uniforms.add(new h.X("view",((e,t)=>t.camera.viewMatrix)),new d.N("lastFrameColorTexture",((e,t)=>t.ssr.lastFrameColor?.getTexture())),new u.m("fadeFactorSSR",((e,t)=>t.ssr.fadeFactor))),r.code.add(n.H`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):r.code.add(n.H`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),t.hasCloudsReflections?t.hasScreenSpaceReflections?r.code.add(n.H`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):r.code.add(n.H`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):r.code.add(n.H`return waterRenderedColor;
}`)}},15985:function(e,t,r){r.d(t,{V:function(){return d}});var i=r(13786),n=r(1932),s=r(33400),o=r(41546),a=r(2120),l=(r(56574),r(11687)),c=r(38917),u=r(39506),h=r(39838);function d(e){e.fragment.uniforms.add(new h.N("texWaveNormal",(e=>e.waveNormal)),new h.N("texWavePerturbation",(e=>e.wavePerturbation)),new c.E("waveParams",(e=>(0,s.s)(p,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset))),new l.G("waveDirection",(e=>(0,i.hZ)(f,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity)))),e.include(a.z),e.fragment.code.add(u.H`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const p=(0,o.vt)(),f=(0,n.vt)()},28686:function(e,t,r){r.d(t,{H:function(){return i},y:function(){return n}});const i=.1,n=.001},1354:function(e,t,r){r.d(t,{S:function(){return c}});var i=r(28686),n=r(39506);function s(e){e.fragment.code.add(n.H`
    #define discardOrAdjustAlpha(color) { if (color.a < ${n.H.float(i.y)}) { discard; } }
  `)}var o=r(65312);r(54516),o.n;var a=r(14543),l=r(54407);function c(e,t){!function(e,t,r){const i=e.fragment;switch(t.alphaDiscardMode!==l.sf.Mask&&t.alphaDiscardMode!==l.sf.MaskBlend||i.uniforms.add(r),t.alphaDiscardMode){case l.sf.Blend:return e.include(s);case l.sf.Opaque:i.code.add(n.H`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case l.sf.Mask:i.code.add(n.H`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case l.sf.MaskBlend:e.fragment.code.add(n.H`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}(e,t,new a.m("textureAlphaCutoff",(e=>e.textureAlphaCutoff)))}},82316:function(e,t,r){r.d(t,{Ir:function(){return u}});var i=r(13786),n=r(1932),s=r(33400),o=r(41546),a=r(11687),l=r(38917),c=r(39506);function u(e){e.fragment.uniforms.add(new l.E("projInfo",((e,t)=>function(e){const t=e.projectionMatrix;return 0===t[11]?(0,s.s)(h,2/(e.fullWidth*t[0]),2/(e.fullHeight*t[5]),(1+t[12])/t[0],(1+t[13])/t[5]):(0,s.s)(h,-2/(e.fullWidth*t[0]),-2/(e.fullHeight*t[5]),(1-t[8])/t[0],(1-t[9])/t[5])}(t.camera)))),e.fragment.uniforms.add(new a.G("zScale",((e,t)=>function(e){return 0===e.projectionMatrix[11]?(0,i.hZ)(d,0,1):(0,i.hZ)(d,1,0)}(t.camera)))),e.fragment.code.add(c.H`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}const h=(0,o.vt)(),d=(0,n.vt)()},23864:function(e,t,r){r.d(t,{a:function(){return n}});var i=r(39506);function n(e){e.code.add(i.H`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}},90576:function(e,t,r){r.d(t,{u:function(){return n}});var i=r(39506);function n({code:e},t){t.doublePrecisionRequiresObfuscation?e.add(i.H`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):e.add(i.H`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}},54613:function(e,t,r){r.d(t,{N:function(){return o}});var i=r(9933),n=r(23864),s=r(39506);function o(e){e.include(n.a),e.code.add(s.H`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${s.H.int(i.k5.Multiply)}) {
        return allMixed;
      }
      if (mode == ${s.H.int(i.k5.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${s.H.int(i.k5.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${s.H.int(i.k5.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${s.H.int(i.k5.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}},47483:function(e,t,r){r.d(t,{U:function(){return n}});var i=r(39506);function n(e){e.code.add(i.H`const float MAX_RGBA4_FLOAT =
15.0 / 16.0 +
15.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 / 16.0;
const vec4 FIXED_POINT_FACTORS_RGBA4 = vec4(1.0, 16.0, 16.0 * 16.0, 16.0 * 16.0 * 16.0);
vec4 floatToRgba4(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA4_FLOAT);
vec4 fixedPointU4 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS_RGBA4) * 16.0);
const float toU4AsFloat = 1.0 / 15.0;
return fixedPointU4 * toU4AsFloat;
}
const vec4 RGBA4_2_FLOAT_FACTORS = vec4(
15.0 / (16.0),
15.0 / (16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0 * 16.0)
);
float rgba4ToFloat(vec4 rgba) {
return dot(rgba, RGBA4_2_FLOAT_FACTORS);
}`)}},52766:function(e,t,r){r.d(t,{W:function(){return n}});var i=r(39506);function n(e){e.code.add(i.H`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}},19202:function(e,t,r){r.d(t,{OH:function(){return c},Y6:function(){return a},pM:function(){return l}});var i=r(20551),n=r(32501),s=r(82598),o=r(39506);function a(e){e.vertex.code.add(o.H`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(o.H`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),e.vertex.code.add(o.H`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),e.vertex.code.add(o.H`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(o.H`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),e.vertex.code.add(o.H`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function l(e){e.uniforms.add(new s.t("screenSizePerspective",(e=>u(e.screenSizePerspective))))}function c(e){e.uniforms.add(new s.t("screenSizePerspectiveAlignment",(e=>u(e.screenSizePerspectiveAlignment||e.screenSizePerspective))))}function u(e){return(0,i.s)(h,e.parameters.divisor,e.parameters.offset,e.minScaleFactor)}const h=(0,n.vt)()},20830:function(e,t,r){r.d(t,{yu:function(){return f},Nz:function(){return v},NB:function(){return m},S7:function(){return _}});var i=r(73364),n=r(39714),s=r(20551),o=r(32501),a=r(4435),l=r(82598),c=r(14543),u=r(65312),h=r(54516);class d extends u.n{constructor(e,t){super(e,"mat4",h.c.Draw,((r,i,n)=>r.setUniformMatrix4fv(e,t(i,n))))}}var p=r(70340);function f(e,t){t.instancedDoublePrecision?e.constants.add("cameraPosition","vec3",o.uY):e.uniforms.add(new a.W("cameraPosition",((e,t)=>(0,s.s)(y,t.camera.viewInverseTransposeMatrix[3]-e.origin[0],t.camera.viewInverseTransposeMatrix[7]-e.origin[1],t.camera.viewInverseTransposeMatrix[11]-e.origin[2]))))}function m(e,t){if(!t.instancedDoublePrecision)return void e.uniforms.add(new p.X("proj",((e,t)=>t.camera.projectionMatrix)),new d("view",((e,t)=>(0,i.Tl)(g,t.camera.viewMatrix,e.origin))),new a.W("localOrigin",(e=>e.origin)));const r=e=>(0,s.s)(y,e.camera.viewInverseTransposeMatrix[3],e.camera.viewInverseTransposeMatrix[7],e.camera.viewInverseTransposeMatrix[11]);e.uniforms.add(new p.X("proj",((e,t)=>t.camera.projectionMatrix)),new p.X("view",((e,t)=>(0,i.Tl)(g,t.camera.viewMatrix,r(t)))),new l.t("localOrigin",((e,t)=>r(t))))}const g=(0,n.vt)(),y=(0,o.vt)();function _(e){e.uniforms.add(new p.X("viewNormal",((e,t)=>t.camera.viewInverseTransposeMatrix)))}function v(e){e.uniforms.add(new c.m("pixelRatio",((e,t)=>t.camera.pixelRatio/t.overlayStretch)))}},45937:function(e,t,r){r.d(t,{e:function(){return s}});var i=r(65312),n=r(54516);class s extends i.n{constructor(e,t){super(e,"bool",n.c.Pass,((r,i,n)=>r.setUniform1b(e,t(i,n))))}}},30262:function(e,t,r){r.d(t,{t:function(){return s}});var i=r(65312),n=r(54516);class s extends i.n{constructor(e,t){super(e,"vec2",n.c.Draw,((r,i,n,s)=>r.setUniform2fv(e,t(i,n,s))))}}},11687:function(e,t,r){r.d(t,{G:function(){return s}});var i=r(65312),n=r(54516);class s extends i.n{constructor(e,t){super(e,"vec2",n.c.Pass,((r,i,n)=>r.setUniform2fv(e,t(i,n))))}}},4435:function(e,t,r){r.d(t,{W:function(){return s}});var i=r(65312),n=r(54516);class s extends i.n{constructor(e,t){super(e,"vec3",n.c.Draw,((r,i,n,s)=>r.setUniform3fv(e,t(i,n,s))))}}},82598:function(e,t,r){r.d(t,{t:function(){return s}});var i=r(65312),n=r(54516);class s extends i.n{constructor(e,t){super(e,"vec3",n.c.Pass,((r,i,n)=>r.setUniform3fv(e,t(i,n))))}}},41356:function(e,t,r){var i=r(65312);r(54516),i.n},38917:function(e,t,r){r.d(t,{E:function(){return s}});var i=r(65312),n=r(54516);class s extends i.n{constructor(e,t){super(e,"vec4",n.c.Pass,((r,i,n)=>r.setUniform4fv(e,t(i,n))))}}},30636:function(e,t,r){r.d(t,{F:function(){return s}});var i=r(65312),n=r(54516);class s extends i.n{constructor(e,t,r){super(e,"vec4",n.c.Pass,((r,i,n)=>r.setUniform4fv(e,t(i,n))),r)}}},14543:function(e,t,r){r.d(t,{m:function(){return s}});var i=r(65312),n=r(54516);class s extends i.n{constructor(e,t){super(e,"float",n.c.Pass,((r,i,n)=>r.setUniform1f(e,t(i,n))))}}},454:function(e,t,r){r.d(t,{x:function(){return s}});var i=r(65312),n=r(54516);class s extends i.n{constructor(e,t,r){super(e,"float",n.c.Pass,((r,i,n)=>r.setUniform1fv(e,t(i,n))),r)}}},50295:function(e,t,r){r.d(t,{c:function(){return s}});var i=r(65312),n=r(54516);class s extends i.n{constructor(e,t){super(e,"int",n.c.Pass,((r,i,n)=>r.setUniform1i(e,t(i,n))))}}},31190:function(e,t,r){r.d(t,{h:function(){return s}});var i=r(65312),n=r(54516);class s extends i.n{constructor(e,t){super(e,"mat3",n.c.Draw,((r,i,n)=>r.setUniformMatrix3fv(e,t(i,n))))}}},78567:function(e,t,r){r.d(t,{k:function(){return s}});var i=r(65312),n=r(54516);class s extends i.n{constructor(e,t){super(e,"mat3",n.c.Pass,((r,i,n)=>r.setUniformMatrix3fv(e,t(i,n))))}}},70340:function(e,t,r){r.d(t,{X:function(){return s}});var i=r(65312),n=r(54516);class s extends i.n{constructor(e,t){super(e,"mat4",n.c.Pass,((r,i,n)=>r.setUniformMatrix4fv(e,t(i,n))))}}},62988:function(e,t,r){r.d(t,{N5:function(){return l}});var i=r(39819),n=(r(58941),r(40633)),s=r(54516),o=r(90553);class a{constructor(){this._includedModules=new Map}include(e,t){this._includedModules.has(e)?this._includedModules.get(e):(this._includedModules.set(e,t),e(this.builder,t))}}class l extends a{constructor(){super(...arguments),this.vertex=new h,this.fragment=new h,this.attributes=new d,this.varyings=new p,this.extensions=new f,this.constants=new g,this.outputs=new m}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const t=this.extensions.generateSource(e),r=this.attributes.generateSource(e),i=this.varyings.generateSource(e),n="vertex"===e?this.vertex:this.fragment,s=n.uniforms.generateSource(),o=n.code.generateSource(),a="vertex"===e?_:y,l=this.constants.generateSource().concat(n.constants.generateSource()),c=this.outputs.generateSource(e);return`#version 300 es\n${t.join("\n")}\n\n${a}\n\n${l.join("\n")}\n\n${s.join("\n")}\n\n${r.join("\n")}\n\n${i.join("\n")}\n\n${c.join("\n")}\n\n${o.join("\n")}`}generateBindPass(e){const t=new Map;this.vertex.uniforms.entries.forEach((e=>{const r=e.bind[s.c.Pass];r&&t.set(e.name,r)})),this.fragment.uniforms.entries.forEach((e=>{const r=e.bind[s.c.Pass];r&&t.set(e.name,r)}));const r=Array.from(t.values()),i=r.length;return(t,n)=>{for(let s=0;s<i;++s)r[s](e,t,n)}}generateBindDraw(e){const t=new Map;this.vertex.uniforms.entries.forEach((e=>{const r=e.bind[s.c.Draw];r&&t.set(e.name,r)})),this.fragment.uniforms.entries.forEach((e=>{const r=e.bind[s.c.Draw];r&&t.set(e.name,r)}));const r=Array.from(t.values()),i=r.length;return(t,n,s)=>{for(let o=0;o<i;++o)r[o](e,t,n,s)}}}class c{constructor(e){this._stage=e,this._entries=new Map}add(...e){for(const t of e)this._add(t);return this._stage}get(e){return this._entries.get(e)}_add(e){if(null!=e){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new i.A(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else n.A.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder").error(`Trying to add null Uniform from ${(new Error).stack}.`)}generateSource(){return Array.from(this._entries.values()).map((e=>null!=e.arraySize?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`))}get entries(){return Array.from(this._entries.values())}}class u{constructor(e){this._stage=e,this._entries=new Array}add(e){return this._entries.push(e),this._stage}generateSource(){return this._entries}}class h extends a{constructor(){super(...arguments),this.uniforms=new c(this),this.code=new u(this),this.constants=new g}get builder(){return this}}class d{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(e){return"fragment"===e?[]:this._entries.map((e=>`in ${e[1]} ${e[0]};`))}}class p{constructor(){this._entries=new Map}add(e,t){this._entries.has(e)&&(0,o.vA)(this._entries.get(e)===t),this._entries.set(e,t)}generateSource(e){const t=new Array;return this._entries.forEach(((r,i)=>t.push("vertex"===e?`out ${r} ${i};`:`in ${r} ${i};`))),t}}class f{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const t="vertex"===e?f.ALLOWLIST_VERTEX:f.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter((e=>t.includes(e))).map((e=>`#extension ${e} : enable`))}}f.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],f.ALLOWLIST_VERTEX=[];class m{constructor(){this._entries=new Map}add(e,t,r=0){const i=this._entries.get(r);i?(0,o.vA)(i.name===e&&i.type===t,`Fragment shader output location ${r} occupied`):this._entries.set(r,{name:e,type:t})}generateSource(e){if("vertex"===e)return[];0===this._entries.size&&this._entries.set(0,{name:m.DEFAULT_NAME,type:m.DEFAULT_TYPE});const t=new Array;return this._entries.forEach(((e,r)=>t.push(`layout(location = ${r}) out ${e.type} ${e.name};`))),t}}m.DEFAULT_TYPE="vec4",m.DEFAULT_NAME="fragColor";class g{constructor(){this._entries=new Set}add(e,t,r){let i="ERROR_CONSTRUCTOR_STRING";switch(t){case"float":i=g._numberToFloatStr(r);break;case"int":i=g._numberToIntStr(r);break;case"bool":i=r.toString();break;case"vec2":i=`vec2(${g._numberToFloatStr(r[0])},                            ${g._numberToFloatStr(r[1])})`;break;case"vec3":i=`vec3(${g._numberToFloatStr(r[0])},                            ${g._numberToFloatStr(r[1])},                            ${g._numberToFloatStr(r[2])})`;break;case"vec4":i=`vec4(${g._numberToFloatStr(r[0])},                            ${g._numberToFloatStr(r[1])},                            ${g._numberToFloatStr(r[2])},                            ${g._numberToFloatStr(r[3])})`;break;case"ivec2":i=`ivec2(${g._numberToIntStr(r[0])},                             ${g._numberToIntStr(r[1])})`;break;case"ivec3":i=`ivec3(${g._numberToIntStr(r[0])},                             ${g._numberToIntStr(r[1])},                             ${g._numberToIntStr(r[2])})`;break;case"ivec4":i=`ivec4(${g._numberToIntStr(r[0])},                             ${g._numberToIntStr(r[1])},                             ${g._numberToIntStr(r[2])},                             ${g._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":i=`${t}(${Array.prototype.map.call(r,(e=>g._numberToFloatStr(e))).join(", ")})`}return this._entries.add(`const ${t} ${e} = ${i};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}}const y="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",_="precision highp float;\nprecision highp sampler2D;"},40075:function(e,t,r){r.d(t,{o:function(){return s}});var i=r(65312),n=r(54516);class s extends i.n{constructor(e,t){super(e,"sampler2D",n.c.Draw,((r,i,n)=>r.bindTexture(e,t(i,n))))}}},39838:function(e,t,r){r.d(t,{N:function(){return s}});var i=r(65312),n=r(54516);class s extends i.n{constructor(e,t){super(e,"sampler2D",n.c.Pass,((r,i,n)=>r.bindTexture(e,t(i,n))))}}},65312:function(e,t,r){r.d(t,{n:function(){return n}});var i=r(54516);class n{constructor(e,t,r,n,s=null){if(this.name=e,this.type=t,this.arraySize=s,this.bind={[i.c.Pass]:null,[i.c.Draw]:null},n)switch(r){case i.c.Pass:this.bind[i.c.Pass]=n;break;case i.c.Draw:this.bind[i.c.Draw]=n}}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}}},39506:function(e,t,r){r.d(t,{H:function(){return n},Y:function(){return i}});const i=class{};function n(e,...t){let r="";for(let i=0;i<t.length;i++)r+=e[i]+t[i];return r+=e[e.length-1],r}var s;(s=n||(n={})).int=function(e){return Math.round(e).toString()},s.float=function(e){return e.toPrecision(8)}},54516:function(e,t,r){var i;r.d(t,{c:function(){return i}}),function(e){e[e.Pass=0]="Pass",e[e.Draw=1]="Draw"}(i||(i={}))},34615:function(e,t,r){r.d(t,{$:function(){return i}});class i{constructor(e,t){this._module=e,this._loadModule=t}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}}},22542:function(e,t,r){r.d(t,{w:function(){return s}});var i=r(95929),n=r(85456);class s{constructor(e,t,r){this.release=r,this.initializeConfiguration(e,t),this._configuration=t.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e)}destroy(){this._program=(0,i.WD)(this._program),this._pipeline=this._configuration=null}reload(e){(0,i.WD)(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return n.WR.TRIANGLES}getPipeline(e,t,r){return this._pipeline}initializeConfiguration(e,t){}}},8610:function(e,t,r){r.d(t,{K:function(){return n},W:function(){return s}});var i=r(39506);class n extends i.Y{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map((()=>0)):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,t={key:this.key};for(const r of e)t[r]=this[r];return t}}function s(e={}){return(t,r)=>{if(t._parameterNames=t._parameterNames??[],t._parameterNames.push(r),null!=e.constValue)Object.defineProperty(t,r,{get:()=>e.constValue});else{const i=t._parameterNames.length-1,n=e.count||2,s=Math.ceil(Math.log2(n)),o=t._parameterBits??[0];let a=0;for(;o[a]+s>16;)a++,a>=o.length&&o.push(0);t._parameterBits=o;const l=o[a],c=(1<<s)-1<<l;o[a]+=s,Object.defineProperty(t,r,{get(){return this[i]},set(e){if(this[i]!==e&&(this[i]=e,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+e<<l&c,"number"!=typeof e&&"boolean"!=typeof e))throw new Error("Configuration value for "+r+" must be boolean or number, got "+typeof e)}})}}}},67521:function(e,t,r){r.d(t,{B7:function(){return o},Ot:function(){return c},RW:function(){return l},S:function(){return u}});var i=r(83525),n=r(27264);const s={required:[]},o={required:[n.V.Depth]};class a extends i.A{consumes(){return s}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}get materialReference(){return null}modify(e){}get numGeometries(){return 0}get hasOccludees(){return!1}queryRenderOccludedState(e){return!1}}class l extends a{}class c extends a{constructor(){super(...arguments),this.drapedPriority=0}}class u extends a{}},97018:function(e,t,r){r.d(t,{H:function(){return s},a:function(){return n}});var i=r(38504);class n{constructor(){this.enabled=!0,this._time=(0,i.l5)(0)}get time(){return this._time}advance({deltaTime:e,fixedTime:t}){return null!=t?this._time!==t&&(this._time=t,!0):(this._time=(0,i.l5)(this._time+e),0!==e)}}class s{constructor(e,t){this.deltaTime=e,this.fixedTime=t}}},14905:function(e,t,r){r.d(t,{K:function(){return i},n:function(){return n}});class i{constructor(e,t,r=t){this.data=e,this.size=t,this.stride=r}}class n extends i{constructor(e,t,r,i=!1,n=r){super(e,r,n),this.indices=t,this.exclusive=i}}},23545:function(e,t,r){r.d(t,{VR:function(){return n},a0:function(){return o}});var i=r(7187);class n{constructor(){this.adds=new i.A,this.removes=new i.A,this.updates=new i.A({allocator:e=>e||new s,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return 0===this.adds.length&&0===this.removes.length&&0===this.updates.length}}class s{}class o{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}},48015:function(e,t,r){r.d(t,{J:function(){return n}});var i=r(11231);class n{constructor(){this.id=(0,i.c)()}}},40359:function(e,t,r){var i;r.d(t,{X:function(){return i}}),function(e){e[e.Layer=0]="Layer",e[e.Object=1]="Object",e[e.Mesh=2]="Mesh",e[e.Line=3]="Line",e[e.Point=4]="Point",e[e.Material=5]="Material",e[e.Texture=6]="Texture",e[e.COUNT=7]="COUNT"}(i||(i={}))},40502:function(e,t,r){r.d(t,{D:function(){return n}});var i=r(65839);const n=new Map([[i.r.POSITION,0],[i.r.NORMAL,1],[i.r.NORMALCOMPRESSED,1],[i.r.UV0,2],[i.r.COLOR,3],[i.r.COLORFEATUREATTRIBUTE,3],[i.r.SIZE,4],[i.r.TANGENT,4],[i.r.CENTEROFFSETANDDISTANCE,5],[i.r.SYMBOLCOLOR,5],[i.r.FEATUREATTRIBUTE,6],[i.r.INSTANCEFEATUREATTRIBUTE,6],[i.r.INSTANCECOLOR,7],[i.r.OBJECTANDLAYERIDCOLOR,7],[i.r.INSTANCEOBJECTANDLAYERIDCOLOR,7],[i.r.INSTANCEMODEL,8],[i.r.INSTANCEMODELNORMAL,12],[i.r.INSTANCEMODELORIGINHI,11],[i.r.INSTANCEMODELORIGINLO,15]])},4875:function(e,t,r){r.d(t,{A:function(){return n}});var i=r(54407);class n{constructor(e){this._material=e.material,this._techniques=e.techniques,this._output=e.output}dispose(){this._techniques.release(this._technique)}get technique(){return this._technique}get _stippleTextures(){return this._techniques.constructionContext.stippleTextures}get _markerTextures(){return this._techniques.constructionContext.markerTextures}ensureTechnique(e,t){return this._technique=this._techniques.releaseAndAcquire(e,this._material.getConfiguration(this._output,t),this._technique),this._technique}ensureResources(e){return i.Am.LOADED}}},52798:function(e,t,r){r.d(t,{c:function(){return n}});var i=r(54407);class n{constructor(e,t){this._material=e,this._repository=t,this._map=new Map}dispose(){this._map.forEach(((e,t)=>{null!=e&&this._repository.release(this._material,t)}))}load(e,t,r){const n=this._material.produces.get(t);if(!n?.(r))return null;this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,t,r));const s=this._map.get(r);if(null!=s){if(s.ensureResources(e)===i.Am.LOADED)return s;this._repository.requestRender()}return null}}},36634:function(e,t,r){r.d(t,{N:function(){return c},m:function(){return l}});var i=r(95929),n=r(60539),s=r(39506),o=r(54407),a=r(4875);class l extends a.A{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textures=e.textures,this._textureId=e.textureId,this._acquire(e.textureId,(e=>this._texture=e)),this._acquire(e.normalTextureId,(e=>this._textureNormal=e)),this._acquire(e.emissiveTextureId,(e=>this._textureEmissive=e)),this._acquire(e.occlusionTextureId,(e=>this._textureOcclusion=e)),this._acquire(e.metallicRoughnessTextureId,(e=>this._textureMetallicRoughness=e))}dispose(){this._texture=(0,i.Gz)(this._texture),this._textureNormal=(0,i.Gz)(this._textureNormal),this._textureEmissive=(0,i.Gz)(this._textureEmissive),this._textureOcclusion=(0,i.Gz)(this._textureOcclusion),this._textureMetallicRoughness=(0,i.Gz)(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return 0===this._numLoading?o.Am.LOADED:o.Am.LOADING}get textureBindParameters(){return new c(null!=this._texture?this._texture.glTexture:null,null!=this._textureNormal?this._textureNormal.glTexture:null,null!=this._textureEmissive?this._textureEmissive.glTexture:null,null!=this._textureOcclusion?this._textureOcclusion.glTexture:null,null!=this._textureMetallicRoughness?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){null!=this._texture&&e===this._texture.id||(this._texture=(0,i.Gz)(this._texture),this._textureId=e,this._acquire(this._textureId,(e=>this._texture=e)))}_acquire(e,t){if(null==e)return void t(null);const r=this._textures.acquire(e);if((0,n.$X)(r))return++this._numLoading,void r.then((e=>{if(this._disposed)return(0,i.Gz)(e),void t(null);t(e)})).finally((()=>--this._numLoading));t(r)}}class c extends s.Y{constructor(e=null,t=null,r=null,i=null,n=null,s,o){super(),this.texture=e,this.textureNormal=t,this.textureEmissive=r,this.textureOcclusion=i,this.textureMetallicRoughness=n,this.scale=s,this.normalTextureTransformMatrix=o}}},40321:function(e,t,r){r.d(t,{V:function(){return T}});var i=r(39714),n=r(20551),s=r(37819),o=r(24540);function a(e){if(e.length<o.y9)return Array.from(e);if((0,o.cy)(e))return Float64Array.from(e);if(!("BYTES_PER_ELEMENT"in e))return Array.from(e);switch(e.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(e);case 2:return(0,o.jq)(e)?Uint16Array.from(e):Int16Array.from(e);case 4:return Float32Array.from(e);default:return Float64Array.from(e)}}var l=r(54407),c=r(7187),u=r(32501),h=r(90553);class d{constructor(e,t,r){this.primitiveIndices=e,this._numIndexPerPrimitive=t,this.position=r,this._children=void 0,(0,h.vA)(e.length>=1),(0,h.vA)(3===r.size||4===r.size);const{data:i,size:s,indices:o}=r;(0,h.vA)(o.length%this._numIndexPerPrimitive==0),(0,h.vA)(o.length>=e.length*this._numIndexPerPrimitive);const a=e.length;let l=s*o[this._numIndexPerPrimitive*e[0]];p.clear(),p.push(l);const c=(0,u.fA)(i[l],i[l+1],i[l+2]),d=(0,u.o8)(c);for(let t=0;t<a;++t){const r=this._numIndexPerPrimitive*e[t];for(let e=0;e<this._numIndexPerPrimitive;++e){l=s*o[r+e],p.push(l);let t=i[l];c[0]=Math.min(t,c[0]),d[0]=Math.max(t,d[0]),t=i[l+1],c[1]=Math.min(t,c[1]),d[1]=Math.max(t,d[1]),t=i[l+2],c[2]=Math.min(t,c[2]),d[2]=Math.max(t,d[2])}}this.bbMin=c,this.bbMax=d;const f=(0,n.o)((0,u.vt)(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(d[0]-c[0],d[1]-c[1]),d[2]-c[2]);let m=this.radius*this.radius;for(let e=0;e<p.length;++e){l=p.at(e);const t=i[l]-f[0],r=i[l+1]-f[1],n=i[l+2]-f[2],s=t*t+r*r+n*n;if(s<=m)continue;const o=Math.sqrt(s),a=.5*(o-this.radius);this.radius=this.radius+a,m=this.radius*this.radius;const c=a/o;f[0]+=t*c,f[1]+=r*c,f[2]+=n*c}this.center=f,p.clear()}getChildren(){if(this._children||(0,n.a)(this.bbMin,this.bbMax)<=1)return this._children;const e=(0,n.o)((0,u.vt)(),this.bbMin,this.bbMax,.5),t=this.primitiveIndices.length,r=new Uint8Array(t),i=new Array(8);for(let e=0;e<8;++e)i[e]=0;const{data:s,size:o,indices:a}=this.position;for(let n=0;n<t;++n){let t=0;const l=this._numIndexPerPrimitive*this.primitiveIndices[n];let c=o*a[l],u=s[c],h=s[c+1],d=s[c+2];for(let e=1;e<this._numIndexPerPrimitive;++e){c=o*a[l+e];const t=s[c],r=s[c+1],i=s[c+2];t<u&&(u=t),r<h&&(h=r),i<d&&(d=i)}u<e[0]&&(t|=1),h<e[1]&&(t|=2),d<e[2]&&(t|=4),r[n]=t,++i[t]}let l=0;for(let e=0;e<8;++e)i[e]>0&&++l;if(l<2)return;const c=new Array(8);for(let e=0;e<8;++e)c[e]=i[e]>0?new Uint32Array(i[e]):void 0;for(let e=0;e<8;++e)i[e]=0;for(let e=0;e<t;++e){const t=r[e];c[t][i[t]++]=this.primitiveIndices[e]}this._children=new Array;for(let e=0;e<8;++e)void 0!==c[e]&&this._children.push(new d(c[e],this._numIndexPerPrimitive,this.position));return this._children}static prune(){p.prune()}}const p=new c.A({deallocator:null});var f=r(48015),m=r(40359),g=r(67496);const y=(0,u.vt)(),_=(0,u.vt)(),v=(0,u.vt)(),b=(0,u.vt)();var x=r(84321),S=r(65839),w=r(84738);class T extends f.J{constructor(e,t,r=null,i=m.X.Mesh,n=null,o=-1){super(),this.material=e,this.mapPositions=r,this.type=i,this.objectAndLayerIdColor=n,this.edgeIndicesLength=o,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(const[e,r]of t)this._attributes.set(e,{...r,indices:(0,s.Dg)(r.indices)}),e===S.r.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(e).indices.length:this.edgeIndicesLength)}instantiate(e={}){const t=new T(e.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach(((e,r)=>{e.exclusive=!1,t._attributes.set(r,e)})),t._boundingInfo=this._boundingInfo,t.transformation=e.transformation||this.transformation,t}get attributes(){return this._attributes}getMutableAttribute(e){let t=this._attributes.get(e);return t&&!t.exclusive&&(t={...t,exclusive:!0,data:a(t.data)},this._attributes.set(e,t)),t}setAttributeData(e,t){const r=this._attributes.get(e);r&&this._attributes.set(e,{...r,exclusive:!0,data:t})}get indexCount(){const e=this._attributes.values().next().value.indices;return e?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===m.X.Mesh?this._computeAttachmentOriginTriangles(e):this.type===m.X.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(null!=this._transformation&&(0,n.h)(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){return function(e,t){if(!e)return!1;const{size:r,data:i,indices:s}=e;(0,n.s)(t,0,0,0),(0,n.s)(b,0,0,0);let o=0,a=0;for(let e=0;e<s.length-2;e+=3){const l=s[e]*r,c=s[e+1]*r,u=s[e+2]*r;(0,n.s)(y,i[l],i[l+1],i[l+2]),(0,n.s)(_,i[c],i[c+1],i[c+2]),(0,n.s)(v,i[u],i[u+1],i[u+2]);const h=(0,g.Q7)(y,_,v);h?((0,n.g)(y,y,_),(0,n.g)(y,y,v),(0,n.j)(y,y,1/3*h),(0,n.g)(t,t,y),o+=h):((0,n.g)(b,b,y),(0,n.g)(b,b,_),(0,n.g)(b,b,v),a+=3)}return!(0===a&&0===o||(0!==o?((0,n.j)(t,t,1/o),0):0===a||((0,n.j)(t,b,1/a),0)))}(this.attributes.get(S.r.POSITION),e)}_computeAttachmentOriginLines(e){const t=this.attributes.get(S.r.POSITION);return function(e,t,r){if(!e)return!1;(0,n.s)(r,0,0,0),(0,n.s)(b,0,0,0);let i=0,s=0;const{size:o,data:a,indices:l}=e,c=l.length-1,u=c+(t?2:0);for(let e=0;e<u;e+=2){const t=e<c?e+1:0,u=l[e<c?e:c]*o,h=l[t]*o;y[0]=a[u],y[1]=a[u+1],y[2]=a[u+2],_[0]=a[h],_[1]=a[h+1],_[2]=a[h+2],(0,n.j)(y,(0,n.g)(y,y,_),.5);const d=(0,n.F)(y,_);d>0?((0,n.g)(r,r,(0,n.j)(y,y,d)),i+=d):0===i&&((0,n.g)(b,b,y),s++)}return 0!==i?((0,n.j)(r,r,1/i),!0):0!==s&&((0,n.j)(r,b,1/s),!0)}(t,function(e,t){return!(!("isClosed"in e)||!e.isClosed)&&t.indices.length>2}(this.material.parameters,t),e)}_computeAttachmentOriginPoints(e){return function(e,t){if(!e)return!1;const{size:r,data:i,indices:s}=e;(0,n.s)(t,0,0,0);let o=-1,a=0;for(let e=0;e<s.length;e++){const n=s[e]*r;o!==n&&(t[0]+=i[n],t[1]+=i[n+1],t[2]+=i[n+2],a++),o=n}return a>1&&(0,n.j)(t,t,1/a),a>0}(this.attributes.get(S.r.POSITION),e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.attributes.get(S.r.POSITION);if(!e||0===e.indices.length)return null;const t=this.type===m.X.Mesh?3:1;(0,h.vA)(e.indices.length%t==0,"Indexing error: "+e.indices.length+" not divisible by "+t);const r=(0,s.tM)(e.indices.length/t);return new d(r,t,e)}get transformation(){return this._transformation??i.zK}set transformation(e){this._transformation=e&&e!==i.zK?(0,i.o8)(e):null}addHighlight(){const e=new x.X(l.Mg.Highlight);return this.highlights=(0,w.Ci)(this.highlights,e),e}removeHighlight(e){this.highlights=(0,w.PC)(this.highlights,e)}}},8470:function(e,t,r){r.d(t,{zC:function(){return ie},C1:function(){return A},EE:function(){return X},nW:function(){return J},td:function(){return P},_B:function(){return te},Nq:function(){return K},DJ:function(){return Z},uX:function(){return q},Z8:function(){return ee},CM:function(){return W},Gj:function(){return Y},Ho:function(){return j},Nb:function(){return Q},Xl:function(){return se},xh:function(){return re}});var i,n=r(1932),s=r(20551),o=r(43274),a=r(32501),l=r(50240),c=r(5047),u=r(37819),h=r(5596),d=r(79578),p=r(14905);!function(e){e.length=function(e,t){const r=e[t],i=e[t+1],n=e[t+2];return Math.sqrt(r*r+i*i+n*n)},e.normalize=function(e,t){const r=e[t],i=e[t+1],n=e[t+2],s=1/Math.sqrt(r*r+i*i+n*n);e[t]*=s,e[t+1]*=s,e[t+2]*=s},e.scale=function(e,t,r){e[t]*=r,e[t+1]*=r,e[t+2]*=r},e.add=function(e,t,r,i,n,s=t){(n=n||e)[s]=e[t]+r[i],n[s+1]=e[t+1]+r[i+1],n[s+2]=e[t+2]+r[i+2]},e.subtract=function(e,t,r,i,n,s=t){(n=n||e)[s]=e[t]-r[i],n[s+1]=e[t+1]-r[i+1],n[s+2]=e[t+2]-r[i+2]}}(i||(i={}));var f=r(40359),m=r(40321),g=r(90553),y=r(65839);const _=i,v=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],b=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],x=[0,0,1,0,1,1,0,1],S=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],w=new Array(36);for(let e=0;e<6;e++)for(let t=0;t<6;t++)w[6*e+t]=e;const T=new Array(36);for(let e=0;e<6;e++)T[6*e]=0,T[6*e+1]=1,T[6*e+2]=2,T[6*e+3]=2,T[6*e+4]=3,T[6*e+5]=0;function A(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(24);for(let e=0;e<8;e++)r[3*e]=v[e][0]*t[0],r[3*e+1]=v[e][1]*t[1],r[3*e+2]=v[e][2]*t[2];return new m.V(e,[[y.r.POSITION,new p.n(r,S,3,!0)],[y.r.NORMAL,new p.n(b,w,3)],[y.r.UV0,new p.n(x,T,2)]])}const C=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],E=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],M=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],R=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function P(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(18);for(let e=0;e<6;e++)r[3*e]=C[e][0]*t[0],r[3*e+1]=C[e][1]*t[1],r[3*e+2]=C[e][2]*t[2];return new m.V(e,[[y.r.POSITION,new p.n(r,M,3,!0)],[y.r.NORMAL,new p.n(E,R,3)]])}const O=(0,o.fA)(-.5,0,-.5),I=(0,o.fA)(.5,0,-.5),L=(0,o.fA)(0,0,.5),N=(0,o.fA)(0,.5,0),D=(0,o.vt)(),F=(0,o.vt)(),z=(0,o.vt)(),V=(0,o.vt)(),U=(0,o.vt)();(0,s.f)(D,O,N),(0,s.f)(F,O,I),(0,s.b)(z,D,F),(0,s.n)(z,z),(0,s.f)(D,I,N),(0,s.f)(F,I,L),(0,s.b)(V,D,F),(0,s.n)(V,V),(0,s.f)(D,L,N),(0,s.f)(F,L,O),(0,s.b)(U,D,F),(0,s.n)(U,U);const G=[O,I,L,N],B=[0,-1,0,z[0],z[1],z[2],V[0],V[1],V[2],U[0],U[1],U[2]],H=[0,1,2,3,1,0,3,2,1,3,0,2],k=[0,0,0,1,1,1,2,2,2,3,3,3];function j(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(12);for(let e=0;e<4;e++)r[3*e]=G[e][0]*t[0],r[3*e+1]=G[e][1]*t[1],r[3*e+2]=G[e][2]*t[2];return new m.V(e,[[y.r.POSITION,new p.n(r,H,3,!0)],[y.r.NORMAL,new p.n(B,k,3)]])}function W(e,t,r,i,n={uv:!0}){const s=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,h=Math.max(3,Math.floor(r)),d=Math.max(2,Math.floor(i)),f=(h+1)*(d+1),g=(0,c.oe)(3*f),_=(0,c.oe)(3*f),v=(0,c.oe)(2*f),b=[];let x=0;for(let e=0;e<=d;e++){const r=[],i=e/d,n=a+i*l,c=Math.cos(n);for(let e=0;e<=h;e++){const a=e/h,l=s+a*o,u=Math.cos(l)*c,d=Math.sin(n),p=-Math.sin(l)*c;g[3*x]=u*t,g[3*x+1]=d*t,g[3*x+2]=p*t,_[3*x]=u,_[3*x+1]=d,_[3*x+2]=p,v[2*x]=a,v[2*x+1]=i,r.push(x),++x}b.push(r)}const S=new Array;for(let e=0;e<d;e++)for(let t=0;t<h;t++){const r=b[e][t],i=b[e][t+1],n=b[e+1][t+1],s=b[e+1][t];0===e?(S.push(r),S.push(n),S.push(s)):e===d-1?(S.push(r),S.push(i),S.push(n)):(S.push(r),S.push(i),S.push(n),S.push(n),S.push(s),S.push(r))}const w=[[y.r.POSITION,new p.n(g,S,3,!0)],[y.r.NORMAL,new p.n(_,S,3,!0)]];return n.uv&&w.push([y.r.UV0,new p.n(v,S,2,!0)]),n.offset&&(w[0][0]=y.r.OFFSET,w.push([y.r.POSITION,new p.n(Float64Array.from(n.offset),(0,u.EH)(S.length),3,!0)])),new m.V(e,w)}function q(e,t,r,i){const n=function(e,t,r){const i=e;let n,s;if(r)n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],s=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const e=i*(1+Math.sqrt(5))/2;n=[-i,e,0,i,e,0,-i,-e,0,i,-e,0,0,-i,e,0,i,e,0,-i,-e,0,i,-e,e,0,-i,e,0,i,-e,0,-i,-e,0,i],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let t=0;t<n.length;t+=3)_.scale(n,t,e/_.length(n,t));let o={};function a(t,r){t>r&&([t,r]=[r,t]);const i=t.toString()+"."+r.toString();if(o[i])return o[i];let s=n.length;return n.length+=3,_.add(n,3*t,n,3*r,n,s),_.scale(n,s,e/_.length(n,s)),s/=3,o[i]=s,s}for(let e=0;e<t;e++){const e=s.length,t=new Array(4*e);for(let r=0;r<e;r+=3){const e=s[r],i=s[r+1],n=s[r+2],o=a(e,i),l=a(i,n),c=a(n,e),u=4*r;t[u]=e,t[u+1]=o,t[u+2]=c,t[u+3]=i,t[u+4]=l,t[u+5]=o,t[u+6]=n,t[u+7]=c,t[u+8]=l,t[u+9]=o,t[u+10]=l,t[u+11]=c}s=t,o={}}const l=(0,c.Wz)(n);for(let e=0;e<l.length;e+=3)_.normalize(l,e);return[[y.r.POSITION,new p.n((0,c.Wz)(n),s,3,!0)],[y.r.NORMAL,new p.n(l,s,3,!0)]]}(t,r,i);return new m.V(e,n)}function Z(e,t,r,i,s,o,l,c,h=null){const d=r?(0,a.o8)(r):(0,a.vt)(),g=t?(0,a.o8)(t):(0,a.fA)(0,0,1);l??=(0,n.vt)();const _=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],v=null!=s&&2===s.length?s:[1,1],b=(0,u.EH)(1),x=[[y.r.POSITION,new p.n(d,b,3,!0)],[y.r.NORMAL,new p.n(g,b,3,!0)],[y.r.UV0,new p.n(l,b,l.length)],[y.r.COLOR,new p.n(_,b,4,!0)],[y.r.SIZE,new p.n(v,b,2)]];if(null!=o&&(o=[o[0],o[1],o[2],o[3]],x.push([y.r.CENTEROFFSETANDDISTANCE,new p.n(o,b,4)])),c){const e=[c[0],c[1],c[2],c[3]];x.push([y.r.FEATUREATTRIBUTE,new p.n(e,b,4)])}return new m.V(e,x,null,f.X.Point,h)}const $=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function Y(e,t=$){const r=new Array(12);for(let e=0;e<4;e++)for(let i=0;i<3;i++)r[3*e+i]=t[e][i];const i=[0,1,2,2,3,0],n=[0,0,0,0,0,0],s=[[y.r.POSITION,new p.n(r,i,3,!0)],[y.r.NORMAL,new p.n([0,0,1],n,3,!0)],[y.r.UV0,new p.n([0,0,1,0,1,1,0,1],i,2,!0)],[y.r.COLOR,new p.n([255,255,255,255],n,4,!0)]];return new m.V(e,s)}function X(e,t,r,i,n,s=!0,a=!0){let l=0;const u=r,h=t;let d=(0,o.fA)(0,l,0),f=(0,o.fA)(0,l+h,0),g=(0,o.fA)(0,-1,0),_=(0,o.fA)(0,1,0);n&&(l=h,f=(0,o.fA)(0,0,0),d=(0,o.fA)(0,l,0),g=(0,o.fA)(0,1,0),_=(0,o.fA)(0,-1,0));const v=[f,d],b=[g,_],x=i+2,S=Math.sqrt(h*h+u*u);if(n)for(let e=i-1;e>=0;e--){const t=e*(2*Math.PI/i),r=(0,o.fA)(Math.cos(t)*u,l,Math.sin(t)*u);v.push(r);const n=(0,o.fA)(h*Math.cos(t)/S,-u/S,h*Math.sin(t)/S);b.push(n)}else for(let e=0;e<i;e++){const t=e*(2*Math.PI/i),r=(0,o.fA)(Math.cos(t)*u,l,Math.sin(t)*u);v.push(r);const n=(0,o.fA)(h*Math.cos(t)/S,u/S,h*Math.sin(t)/S);b.push(n)}const w=new Array,T=new Array;if(s){for(let e=3;e<v.length;e++)w.push(1),w.push(e-1),w.push(e),T.push(0),T.push(0),T.push(0);w.push(v.length-1),w.push(2),w.push(1),T.push(0),T.push(0),T.push(0)}if(a){for(let e=3;e<v.length;e++)w.push(e),w.push(e-1),w.push(0),T.push(e),T.push(e-1),T.push(1);w.push(0),w.push(2),w.push(v.length-1),T.push(1),T.push(2),T.push(b.length-1)}const A=(0,c.oe)(3*x);for(let e=0;e<x;e++)A[3*e]=v[e][0],A[3*e+1]=v[e][1],A[3*e+2]=v[e][2];const C=(0,c.oe)(3*x);for(let e=0;e<x;e++)C[3*e]=b[e][0],C[3*e+1]=b[e][1],C[3*e+2]=b[e][2];const E=[[y.r.POSITION,new p.n(A,w,3,!0)],[y.r.NORMAL,new p.n(C,T,3,!0)]];return new m.V(e,E)}function J(e,t,r,i,n,a,l){const u=n?(0,o.o8)(n):(0,o.fA)(1,0,0),h=a?(0,o.o8)(a):(0,o.fA)(0,0,0);l??=!0;const d=(0,o.vt)();(0,s.n)(d,u);const f=(0,o.vt)();(0,s.j)(f,d,Math.abs(t));const g=(0,o.vt)();(0,s.j)(g,f,-.5),(0,s.g)(g,g,h);const _=(0,o.fA)(0,1,0);Math.abs(1-(0,s.m)(d,_))<.2&&(0,s.s)(_,0,0,1);const v=(0,o.vt)();(0,s.b)(v,d,_),(0,s.n)(v,v),(0,s.b)(_,v,d);const b=2*i+(l?2:0),x=i+(l?2:0),S=(0,c.oe)(3*b),w=(0,c.oe)(3*x),T=(0,c.oe)(2*b),A=new Array(3*i*(l?4:2)),C=new Array(3*i*(l?4:2));l&&(S[3*(b-2)]=g[0],S[3*(b-2)+1]=g[1],S[3*(b-2)+2]=g[2],T[2*(b-2)]=0,T[2*(b-2)+1]=0,S[3*(b-1)]=S[3*(b-2)]+f[0],S[3*(b-1)+1]=S[3*(b-2)+1]+f[1],S[3*(b-1)+2]=S[3*(b-2)+2]+f[2],T[2*(b-1)]=1,T[2*(b-1)+1]=1,w[3*(x-2)]=-d[0],w[3*(x-2)+1]=-d[1],w[3*(x-2)+2]=-d[2],w[3*(x-1)]=d[0],w[3*(x-1)+1]=d[1],w[3*(x-1)+2]=d[2]);const E=(e,t,r)=>{A[e]=t,C[e]=r};let M=0;const R=(0,o.vt)(),P=(0,o.vt)();for(let e=0;e<i;e++){const t=e*(2*Math.PI/i);(0,s.j)(R,_,Math.sin(t)),(0,s.j)(P,v,Math.cos(t)),(0,s.g)(R,R,P),w[3*e]=R[0],w[3*e+1]=R[1],w[3*e+2]=R[2],(0,s.j)(R,R,r),(0,s.g)(R,R,g),S[3*e]=R[0],S[3*e+1]=R[1],S[3*e+2]=R[2],T[2*e]=e/i,T[2*e+1]=0,S[3*(e+i)]=S[3*e]+f[0],S[3*(e+i)+1]=S[3*e+1]+f[1],S[3*(e+i)+2]=S[3*e+2]+f[2],T[2*(e+i)]=e/i,T[2*e+1]=1;const n=(e+1)%i;E(M++,e,e),E(M++,e+i,e),E(M++,n,n),E(M++,n,n),E(M++,e+i,e),E(M++,n+i,n)}if(l){for(let e=0;e<i;e++){const t=(e+1)%i;E(M++,b-2,x-2),E(M++,e,x-2),E(M++,t,x-2)}for(let e=0;e<i;e++){const t=(e+1)%i;E(M++,e+i,x-1),E(M++,b-1,x-1),E(M++,t+i,x-1)}}const O=[[y.r.POSITION,new p.n(S,A,3,!0)],[y.r.NORMAL,new p.n(w,C,3,!0)],[y.r.UV0,new p.n(T,A,2,!0)]];return new m.V(e,O)}function Q(e,t,r,i,n,s){i=i||10,n=null==n||n,(0,g.vA)(t.length>1);const o=[],a=[];for(let e=0;e<i;e++){o.push([0,-e-1,-(e+1)%i-1]);const t=e/i*2*Math.PI;a.push([Math.cos(t)*r,Math.sin(t)*r])}return K(e,a,t,[[0,0,0]],o,n,s)}function K(e,t,r,i,n,l,u=(0,o.fA)(0,0,0)){const f=t.length,g=(0,c.oe)(r.length*f*3+(6*i.length||0)),_=(0,c.oe)(r.length*f*3+(i?6:0)),v=new Array,b=new Array;let x=0,S=0;const w=(0,a.vt)(),T=(0,a.vt)(),A=(0,a.vt)(),C=(0,a.vt)(),E=(0,a.vt)(),M=(0,a.vt)(),R=(0,a.vt)(),P=(0,a.vt)(),O=(0,a.vt)(),I=(0,a.vt)(),L=(0,a.vt)(),N=(0,a.vt)(),D=(0,a.vt)(),F=(0,h.vt)();(0,s.s)(O,0,1,0),(0,s.f)(T,r[1],r[0]),(0,s.n)(T,T),l?((0,s.g)(P,r[0],u),(0,s.n)(A,P)):(0,s.s)(A,0,0,1),se(T,A,O,O,E,A,oe),(0,s.c)(C,A),(0,s.c)(N,E);for(let e=0;e<i.length;e++)(0,s.j)(M,E,i[e][0]),(0,s.j)(P,A,i[e][2]),(0,s.g)(M,M,P),(0,s.g)(M,M,r[0]),g[x++]=M[0],g[x++]=M[1],g[x++]=M[2];_[S++]=-T[0],_[S++]=-T[1],_[S++]=-T[2];for(let e=0;e<n.length;e++)v.push(n[e][0]>0?n[e][0]:-n[e][0]-1+i.length),v.push(n[e][1]>0?n[e][1]:-n[e][1]-1+i.length),v.push(n[e][2]>0?n[e][2]:-n[e][2]-1+i.length),b.push(0),b.push(0),b.push(0);let z=i.length;const V=i.length-1;for(let e=0;e<r.length;e++){let i=!1;e>0&&((0,s.c)(w,T),e<r.length-1?((0,s.f)(T,r[e+1],r[e]),(0,s.n)(T,T)):i=!0,(0,s.g)(I,w,T),(0,s.n)(I,I),(0,s.g)(L,r[e-1],C),(0,h.O_)(r[e],I,F),(0,h.Ui)(F,(0,d.LV)(L,w),P)?((0,s.f)(P,P,r[e]),(0,s.n)(A,P),(0,s.b)(E,I,A),(0,s.n)(E,E)):se(I,C,N,O,E,A,oe),(0,s.c)(C,A),(0,s.c)(N,E)),l&&((0,s.g)(P,r[e],u),(0,s.n)(D,P));for(let n=0;n<f;n++)if((0,s.j)(M,E,t[n][0]),(0,s.j)(P,A,t[n][1]),(0,s.g)(M,M,P),(0,s.n)(R,M),_[S++]=R[0],_[S++]=R[1],_[S++]=R[2],(0,s.g)(M,M,r[e]),g[x++]=M[0],g[x++]=M[1],g[x++]=M[2],!i){const e=(n+1)%f;v.push(z+n),v.push(z+f+n),v.push(z+e),v.push(z+e),v.push(z+f+n),v.push(z+f+e);for(let e=0;e<6;e++){const t=v.length-6;b.push(v[t+e]-V)}}z+=f}const U=r[r.length-1];for(let e=0;e<i.length;e++)(0,s.j)(M,E,i[e][0]),(0,s.j)(P,A,i[e][1]),(0,s.g)(M,M,P),(0,s.g)(M,M,U),g[x++]=M[0],g[x++]=M[1],g[x++]=M[2];const G=S/3;_[S++]=T[0],_[S++]=T[1],_[S++]=T[2];const B=z-f;for(let e=0;e<n.length;e++)v.push(n[e][0]>=0?z+n[e][0]:-n[e][0]-1+B),v.push(n[e][2]>=0?z+n[e][2]:-n[e][2]-1+B),v.push(n[e][1]>=0?z+n[e][1]:-n[e][1]-1+B),b.push(G),b.push(G),b.push(G);const H=[[y.r.POSITION,new p.n(g,v,3,!0)],[y.r.NORMAL,new p.n(_,b,3,!0)]];return new m.V(e,H)}function ee(e,t,r,i){(0,g.vA)(t.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),(0,g.vA)(3===t[0].length,"createPolylineGeometry(): malformed vertex"),(0,g.vA)(null==r||r.length===t.length,"createPolylineGeometry: need same number of points and normals"),(0,g.vA)(null==r||3===r[0].length,"createPolylineGeometry(): malformed normal");const n=(0,l.jh)(3*t.length),s=new Array(2*(t.length-1));let o=0,a=0;for(let e=0;e<t.length;e++){for(let r=0;r<3;r++)n[o++]=t[e][r];e>0&&(s[a++]=e-1,s[a++]=e)}const h=[[y.r.POSITION,new p.n(n,s,3,!0)]];if(r){const e=(0,c.oe)(3*r.length);let i=0;for(let n=0;n<t.length;n++)for(let t=0;t<3;t++)e[i++]=r[n][t];h.push([y.r.NORMAL,new p.n(e,s,3,!0)])}return i&&h.push([y.r.COLOR,new p.n(i,(0,u.tM)(i.length/4),4)]),new m.V(e,h,null,f.X.Line)}function te(e,t,r,i,n,s=0){const o=new Array(18),a=[[-r,s,n/2],[i,s,n/2],[0,t+s,n/2],[-r,s,-n/2],[i,s,-n/2],[0,t+s,-n/2]];for(let e=0;e<6;e++)o[3*e]=a[e][0],o[3*e+1]=a[e][1],o[3*e+2]=a[e][2];return new m.V(e,[[y.r.POSITION,new p.n(o,[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5],3,!0)]])}function re(e,t){const r=e.getMutableAttribute(y.r.POSITION).data;for(let e=0;e<r.length;e+=3){const i=r[e],n=r[e+1],o=r[e+2];(0,s.s)(ae,i,n,o),(0,s.h)(ae,ae,t),r[e]=ae[0],r[e+1]=ae[1],r[e+2]=ae[2]}}function ie(e,t=e){const r=e.attributes,i=r.get(y.r.POSITION).data,n=r.get(y.r.NORMAL).data;if(n){const e=t.getMutableAttribute(y.r.NORMAL).data;for(let t=0;t<n.length;t+=3){const r=n[t+1];e[t+1]=-n[t+2],e[t+2]=r}}if(i){const e=t.getMutableAttribute(y.r.POSITION).data;for(let t=0;t<i.length;t+=3){const r=i[t+1];e[t+1]=-i[t+2],e[t+2]=r}}}function ne(e,t,r,i,n){return!(Math.abs((0,s.m)(t,e))>n||((0,s.b)(r,e,t),(0,s.n)(r,r),(0,s.b)(i,r,e),(0,s.n)(i,i),0))}function se(e,t,r,i,n,s,o){return ne(e,t,n,s,o)||ne(e,r,n,s,o)||ne(e,i,n,s,o)}const oe=.99619469809,ae=(0,a.vt)()},19860:function(e,t,r){r.d(t,{g:function(){return y}}),r(58941);var i=r(11231),n=r(20551),s=r(32501),o=r(41546),a=r(57617),l=r(14905),c=r(40359),u=r(40321),h=r(79068),d=r(10713),p=r(10228),f=r(65839),m=r(1296),g=r(65352);class y{constructor(e){this._originSR=e,this._rootOriginId="root/"+(0,i.c)(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const t=this._origins.get(this._rootOriginId);if(null==t){const t=p.Q.rootOrigin;if(null!=t)return this._origins.set(this._rootOriginId,(0,h.f)(t[0],t[1],t[2],this._rootOriginId)),this.getOrigin(e);const r=(0,h.f)(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,r),r}const r=this._gridSize,i=Math.round(e[0]/r),s=Math.round(e[1]/r),o=Math.round(e[2]/r),a=`${i}/${s}/${o}`;let l=this._origins.get(a);const c=.5*r;if((0,n.f)(_,e,t.vec3),_[0]=Math.abs(_[0]),_[1]=Math.abs(_[1]),_[2]=Math.abs(_[2]),_[0]<c&&_[1]<c&&_[2]<c){if(l){const t=Math.max(..._);if((0,n.f)(_,e,l.vec3),_[0]=Math.abs(_[0]),_[1]=Math.abs(_[1]),_[2]=Math.abs(_[2]),Math.max(..._)<t)return l}return t}return l||(l=(0,h.f)(i*r,s*r,o*r,a),this._origins.set(a,l)),l}_drawOriginBox(e,t=(0,o.fA)(1,1,0,1)){const r=window.view,i=r._stage,n=t.toString();if(!this._objects.has(n)){this._material=new g.W({width:2,color:t}),i.add(this._material);const e=new m.x(i,{pickable:!1}),r=new d.B({castShadow:!1});i.add(r),e.add(r),this._objects.set(n,r)}const s=this._objects.get(n),h=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],p=h.length,y=new Array(3*p),_=new Array,v=.5*this._gridSize;for(let t=0;t<p;t++)y[3*t]=e[0]+(1&h[t]?v:-v),y[3*t+1]=e[1]+(2&h[t]?v:-v),y[3*t+2]=e[2]+(4&h[t]?v:-v),t>0&&_.push(t-1,t);(0,a.projectBuffer)(y,this._originSR,0,y,r.renderSpatialReference,0,p);const b=new u.V(this._material,[[f.r.POSITION,new l.n(y,_,3,!0)]],null,c.X.Line);i.add(b),s.addGeometry(b)}get test(){}}const _=(0,s.vt)()},49845:function(e,t,r){r.d(t,{G7:function(){return S},hz:function(){return _}});var i=r(73364),n=r(39714),s=r(20551),o=r(32501),a=r(33400),l=r(41546),c=r(79578),u=r(65420),h=r(38177),d=r(50456),p=r(59356),f=r(22323);const m=1e-5;class g{constructor(e){this.options=new h.H6,this._results=new v,this.transform=new f.dg,this.tolerance=m,this.verticalOffset=null,this._ray=(0,c.vt)(),this._rayEnd=(0,o.vt)(),this._rayBeginTransformed=(0,o.vt)(),this._rayEndTransformed=(0,o.vt)(),this.viewingMode=e??u.RT.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,t,r){this.resetWithRay((0,c.Cr)(e,t,this._ray),r)}resetWithRay(e,t){this.camera=t,e!==this._ray&&(0,c.C)(e,this._ray),0!==this.options.verticalOffset?this.viewingMode===u.RT.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,(0,s.g)(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,t,r,i,n){this.point=t,this.filterPredicate=i,this.tolerance=r??m;const s=(0,f.ou)(this.verticalOffset);if(e&&e.length>0){const t=n?e=>{n(e)&&this.intersectObject(e)}:e=>{this.intersectObject(e)};for(const r of e){const e=r.getSpatialQueryAccelerator?.();null!=e?(null!=s?e.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,t,s):e.forEachAlongRay(this._ray.origin,this._ray.direction,t),this.options.selectionMode&&this.options.hud&&e.forEachDegenerateObject(t)):r.objects.forAll((e=>t(e)))}}this.sortResults()}intersectObject(e){const t=e.geometries;if(!t)return;const r=e.effectiveTransformation,i=(0,f.ou)(this.verticalOffset);for(const o of t){if(!o.visible)continue;const{material:t,id:a}=o;this.transform.setAndInvalidateLazyTransforms(r,o.transformation),(0,s.h)(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),(0,s.h)(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;null!=i&&(i.objectTransform=this.transform),t.intersect(o,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,((t,r,i,s,o,c)=>{if(t>=0){if(null!=this.filterPredicate&&!this.filterPredicate(this._ray.origin,this._rayEnd,t))return;const u=s?this._results.hud:this._results,p=s?s=>{const l=new d.B$(e,a,i,c);s.set(h.dz.HUD,l,t,r,n.zK,o)}:n=>n.set(h.dz.OBJECT,{object:e,geometryId:a,triangleNr:i},t,r,l,o);if((null==u.min.drapedLayerOrder||o>=u.min.drapedLayerOrder)&&(null==u.min.dist||t<u.min.dist)&&p(u.min),this.options.store!==h.oH.MIN&&(null==u.max.drapedLayerOrder||o<u.max.drapedLayerOrder)&&(null==u.max.dist||t>u.max.dist)&&p(u.max),this.options.store===h.oH.ALL)if(s){const e=new x(this._ray);p(e),this._results.hud.all.push(e)}else{const e=new b(this._ray);p(e),this._results.all.push(e)}}}))}}sortResults(e=this._results.all){e.sort(((e,t)=>e.dist!==t.dist?(e.dist??0)-(t.dist??0):e.drapedLayerOrder!==t.drapedLayerOrder?y(e.drapedLayerOrder,t.drapedLayerOrder):y(e.drapedLayerGraphicOrder,t.drapedLayerGraphicOrder)))}}function y(e,t){return(t??-Number.MAX_VALUE)-(e??-Number.MAX_VALUE)}function _(e){return new g(e)}class v{constructor(){this.min=new b((0,c.vt)()),this.max=new b((0,c.vt)()),this.hud={min:new x((0,c.vt)()),max:new x((0,c.vt)()),all:new Array},this.ground=new b((0,c.vt)()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}}class b{get ray(){return this._ray}get distanceInRenderSpace(){return null!=this.dist?((0,s.j)(w,this.ray.direction,this.dist),(0,s.l)(w)):null}getIntersectionPoint(e){return!!(0,p.i3)(this)&&((0,s.j)(w,this.ray.direction,this.dist),(0,s.g)(e,this.ray.origin,w),!0)}getTransformedNormal(e){return(0,s.c)(T,this.normal),T[3]=0,(0,a.t)(T,T,this.transformation),(0,s.c)(e,T),(0,s.n)(e,e)}constructor(e){this.intersector=h.dz.OBJECT,this.normal=(0,o.vt)(),this.transformation=(0,n.vt)(),this._ray=(0,c.vt)(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=h.dz.OBJECT,(0,c.C)(e,this._ray)}set(e,t,r,a,l,c,u){this.intersector=e,this.dist=r,(0,s.c)(this.normal,a??o.Cb),(0,i.C)(this.transformation,l??n.zK),this.target=t,this.drapedLayerOrder=c,this.drapedLayerGraphicOrder=u}copy(e){(0,c.C)(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,(0,s.c)(this.normal,e.normal),(0,i.C)(this.transformation,e.transformation)}}class x extends b{constructor(){super(...arguments),this.intersector=h.dz.HUD}}function S(e){return new b(e)}const w=(0,o.vt)(),T=(0,l.vt)()},38177:function(e,t,r){var i,n;r.d(t,{H6:function(){return s},dz:function(){return i},oH:function(){return n}}),function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL",e[e.TILES3D=8]="TILES3D"}(i||(i={}));class s{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=n.ALL,this.normalRequired=!0}}!function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"}(n||(n={}))},50456:function(e,t,r){r.d(t,{B$:function(){return s},R6:function(){return a}});var i=r(32501);class n{constructor(e,t,r){this.object=e,this.geometryId=t,this.triangleNr=r}}class s extends n{constructor(e,t,r,n){super(e,t,r),this.center=null!=n?(0,i.o8)(n):null}}class o{constructor(e){this.layerUid=e}}class a extends o{constructor(e,t){super(e),this.graphicUid=t}}},79068:function(e,t,r){r.d(t,{f:function(){return s}});var i=r(32501);class n{constructor(e,t){this.vec3=e,this.id=t}}function s(e,t,r,s){return new n((0,i.fA)(e,t,r),s)}},24100:function(e,t,r){r.d(t,{im:function(){return p},m$:function(){return i},qA:function(){return f}});var i,n,s=r(32501),o=r(39506),a=r(97018),l=r(54407),c=r(48015),u=r(40359),h=r(40502),d=r(84887);class p extends c.J{constructor(e,t){super(),this.type=u.X.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._vertexAttributeLocations=h.D,this._pp0=(0,s.fA)(0,0,1),this._pp1=(0,s.fA)(0,0,0),this._parameters=(0,d.qu)(e,t),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e,t=!0){(0,d.MB)(this._parameters,e)&&(this.validateParameters(this._parameters),t&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bindParameters.decorations===l.ID.ON)&&!!(this.parameters.renderOccluded&e.renderOccludedMask)}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){this.repository?.materialChanged(this)}queryRenderOccludedState(e){return this.isVisible()&&this.parameters.renderOccluded===e}intersectDraped(e,t,r,i,n,s){return this._pp0[0]=this._pp1[0]=i[0],this._pp0[1]=this._pp1[1]=i[1],this.intersect(e,t,r,this._pp0,this._pp1,n)}}a.H,(n=i||(i={}))[n.None=0]="None",n[n.Occlude=1]="Occlude",n[n.Transparent=2]="Transparent",n[n.OccludeAndTransparent=4]="OccludeAndTransparent",n[n.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",n[n.Opaque=16]="Opaque";class f extends o.Y{constructor(){super(...arguments),this.renderOccluded=i.Occlude,this.isDecoration=!1}}},96253:function(e,t,r){var i,n;r.d(t,{k:function(){return n},q:function(){return i}}),function(e){e[e.ADD=0]="ADD",e[e.UPDATE=1]="UPDATE",e[e.REMOVE=2]="REMOVE"}(i||(i={})),function(e){e[e.NONE=0]="NONE",e[e.VISIBILITY=1]="VISIBILITY",e[e.GEOMETRY=2]="GEOMETRY",e[e.TRANSFORMATION=4]="TRANSFORMATION",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.OCCLUDEE=16]="OCCLUDEE"}(n||(n={}))},13641:function(e,t,r){r.d(t,{aT:function(){return n},fA:function(){return s}});var i=r(15774);function n(e,t,r,i,n,s=2){const a=1/(Math.abs(r)+Math.abs(i)+Math.abs(n)),l=r*a,c=i*a,u=n<=0?(l>=0?1:-1)*(1-Math.abs(c)):l,h=n<=0?(c>=0?1:-1)*(1-Math.abs(l)):c,d=t*s;e[d]=o(u),e[d+1]=o(h)}function s(e){const t=e.length/3,r=new Int16Array(2*t);let i=0;for(let s=0;s<t;++s)n(r,s,e[i++],e[i++],e[i++]);return r}function o(e){return(0,i.qE)(Math.round(32767*e),-32767,32767)}r(20551),r(32501),r(5047)},10713:function(e,t,r){r.d(t,{B:function(){return g}}),r(58941);var i=r(73364),n=r(39714),s=r(20551),o=r(32501),a=r(90599),l=r(76185),c=r(54407),u=r(48015),h=r(40359),d=r(84321),p=r(90553),f=r(65839),m=r(84738);class g extends u.J{get geometries(){return this._geometries}get transformation(){return this._transformation??n.zK}set transformation(e){this._transformation=(0,i.C)(this._transformation??(0,n.vt)(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(e){this._shaderTransformation=e?(0,i.C)(this._shaderTransformation??(0,n.vt)(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}constructor(e={}){super(),this.type=h.X.Object,this._shaderTransformation=null,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new y),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){(0,p.vA)(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._emit("geometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const t=this._geometries.splice(e,1)[0];t&&(this._emit("geometryRemoved",{object:this,geometry:t}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(e,t,r=!1){this._emit("attributesChanged",{object:this,geometry:e,attribute:t,sync:r}),(0,f.b)(t)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const e of this._geometries)e.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new d.X(c.Mg.MaskOccludee);for(const t of this._geometries)t.occludees=(0,m.Ci)(t.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const t of this._geometries)t.occludees=(0,m.PC)(t.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new d.X(c.Mg.Highlight);for(const t of this._geometries)t.highlights=(0,m.Ci)(t.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const t of this._geometries)t.highlights=(0,m.PC)(t.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,t){return(0,i.lw)(t,this.transformation,e.transformation)}getCombinedShaderTransformation(e,t=(0,n.vt)()){return(0,i.lw)(t,this.effectiveTransformation,e.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new _,this._validateBoundingVolume(this._bvWorldSpace,T.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new _,this._validateBoundingVolume(this._bvObjectSpace,T.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,t){const r=t===T.ObjectSpace;for(const t of this._geometries){const i=t.boundingInfo;i&&v(i,e,r?t.transformation:this.getCombinedShaderTransformation(t))}(0,s.o)((0,a.g)(e.bounds),e.min,e.max,.5);for(const t of this._geometries){const i=t.boundingInfo;if(null==i)continue;const n=r?t.transformation:this.getCombinedShaderTransformation(t),o=(0,l.hG)(n);(0,s.h)(w,i.center,n);const c=(0,s.p)(w,(0,a.g)(e.bounds)),u=i.radius*o;e.bounds[3]=Math.max(e.bounds[3],c+u)}}_invalidateBoundingVolume(){const e=this._bvWorldSpace?.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,t){this._parentLayer&&this._parentLayer.events.emit(e,t)}get test(){}}class y{constructor(){this.min=(0,o.fA)(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=(0,o.fA)(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class _ extends y{constructor(){super(...arguments),this.bounds=(0,a.c)()}}function v(e,t,r){const n=e.bbMin,o=e.bbMax;if((0,i.tZ)(r)){const e=(0,s.s)(b,r[12],r[13],r[14]);(0,s.g)(x,n,e),(0,s.g)(S,o,e);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],x[e]),t.max[e]=Math.max(t.max[e],S[e])}else if((0,s.h)(x,n,r),(0,s.e)(n,o))for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],x[e]),t.max[e]=Math.max(t.max[e],x[e]);else{(0,s.h)(S,o,r);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],x[e],S[e]),t.max[e]=Math.max(t.max[e],x[e],S[e]);for(let e=0;e<3;++e){(0,s.c)(x,n),(0,s.c)(S,o),x[e]=o[e],S[e]=n[e],(0,s.h)(x,x,r),(0,s.h)(S,S,r);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],x[e],S[e]),t.max[e]=Math.max(t.max[e],x[e],S[e])}}}const b=(0,o.vt)(),x=(0,o.vt)(),S=(0,o.vt)(),w=(0,o.vt)();var T,A;(A=T||(T={}))[A.WorldSpace=0]="WorldSpace",A[A.ObjectSpace=1]="ObjectSpace"},84321:function(e,t,r){r.d(t,{X:function(){return n}});var i=r(11231);class n{constructor(e){this.channel=e,this.id=(0,i.c)()}}},35363:function(e,t,r){r.d(t,{A:function(){return k}});var i,n,s=r(56996),o=r(7187),a=r(20551),l=r(32501),c=r(69508),u=r(79578),h=r(90599),d=r(90553);class p{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,t){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new f,this._objectCount=0,t&&(void 0!==t.maximumObjectsPerNode&&(this._maximumObjectsPerNode=t.maximumObjectsPerNode),void 0!==t.maximumDepth&&(this._maximumDepth=t.maximumDepth))}destroy(){this._degenerateObjects.clear(),f.clearPool(),P[0]=null,D.prune(),B.prune()}add(e,t=e.length){this._objectCount+=t,this._grow(e,t);const r=f.acquire();for(let i=0;i<t;i++){const t=e[i];this._isDegenerate(t)?this._degenerateObjects.add(t):(r.init(this._root),this._add(t,r))}f.release(r)}remove(e,t=null){this._objectCount-=e.length;const r=f.acquire();for(const i of e){const e=t??(0,h.a)(this.objectToBoundingSphere(i),F);C(e[3])?(r.init(this._root),y(i,e,r)):this._degenerateObjects.delete(i)}f.release(r),this._shrink()}update(e,t){if(!C(t[3])&&this._isDegenerate(e))return;const r=function(e){return P[0]=e,P}(e);this.remove(r,t),this.add(r)}forEachAlongRay(e,t,r){const i=(0,u.LV)(e,t);m(this._root,(e=>{if(!function(e,t){return S((0,h.g)(t.bounds),2*-t.halfSize,L),S((0,h.g)(t.bounds),2*t.halfSize,N),(0,d.O_)(e.origin,e.direction,L,N)}(i,e))return!1;const t=e.node;return t.terminals.forAll((e=>{this._intersectsObject(i,e)&&r(e)})),null!==t.residents&&t.residents.forAll((e=>{this._intersectsObject(i,e)&&r(e)})),!0}))}forEachAlongRayWithVerticalOffset(e,t,r,i){const n=(0,u.LV)(e,t);m(this._root,(e=>{if(!function(e,t,r){return S((0,h.g)(t.bounds),2*-t.halfSize,L),S((0,h.g)(t.bounds),2*t.halfSize,N),r.applyToMinMax(L,N),(0,d.O_)(e.origin,e.direction,L,N)}(n,e,i))return!1;const t=e.node;return t.terminals.forAll((e=>{this._intersectsObjectWithOffset(n,e,i)&&r(e)})),null!==t.residents&&t.residents.forAll((e=>{this._intersectsObjectWithOffset(n,e,i)&&r(e)})),!0}))}forEach(e){m(this._root,(t=>{const r=t.node;return r.terminals.forAll(e),null!==r.residents&&r.residents.forAll(e),!0})),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,t,r,i=(()=>!0),n=1/0){let s=1/0,o=1/0,l=null;const u=T(e,t),d=a=>{if(--n,!i(a))return;const u=this.objectToBoundingSphere(a);if(!(0,c.m7)(r,u))return;const d=A(e,t,(0,h.g)(u)),p=d-u[3],f=d+u[3];p<s&&(s=p,o=f,l=a)};return g(this._root,(i=>{if(n<=0||!(0,c.m7)(r,i.bounds))return!1;if((0,a.j)(I,u,i.halfSize),(0,a.g)(I,I,(0,h.g)(i.bounds)),A(e,t,I)>o)return!1;const s=i.node;return s.terminals.forAll((e=>d(e))),null!==s.residents&&s.residents.forAll((e=>d(e))),!0}),e,t),l}forEachInDepthRange(e,t,r,i,n,s,o){let l=-1/0,u=1/0;const d={setRange:e=>{r===p.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,e.near),u=Math.min(u,e.far)):(l=Math.max(l,-e.far),u=Math.min(u,-e.near))}};d.setRange(i);const f=A(t,r,e),m=T(t,r),y=T(t,-r),_=e=>{if(!o(e))return;const i=this.objectToBoundingSphere(e),a=(0,h.g)(i),p=A(t,r,a)-f,m=p-i[3],g=p+i[3];m>u||g<l||!(0,c.m7)(s,i)||n(e,d)};g(this._root,(e=>{if(!(0,c.m7)(s,e.bounds))return!1;if((0,a.j)(I,m,e.halfSize),(0,a.g)(I,I,(0,h.g)(e.bounds)),A(t,r,I)-f>u)return!1;if((0,a.j)(I,y,e.halfSize),(0,a.g)(I,I,(0,h.g)(e.bounds)),A(t,r,I)-f<l)return!1;const i=e.node;return i.terminals.forAll((e=>_(e))),null!==i.residents&&i.residents.forAll((e=>_(e))),!0}),t,r)}forEachNode(e){m(this._root,(t=>e(t.node,t.bounds,t.halfSize,t.depth)))}forEachNeighbor(e,t){const r=(0,h.b)(t),i=(0,h.g)(t),n=t=>{const n=this.objectToBoundingSphere(t),s=(0,h.b)(n),o=r+s;return!((0,a.a)((0,h.g)(n),i)-o*o<=0)||e(t)};let s=!0;const o=e=>{s&&(s=n(e))};m(this._root,(e=>{const t=(0,h.b)(e.bounds),n=r+t;if((0,a.a)((0,h.g)(e.bounds),i)-n*n>0)return!1;const l=e.node;return l.terminals.forAll(o),s&&null!==l.residents&&l.residents.forAll(o),s})),s&&this.forEachDegenerateObject(o)}_intersectsObject(e,t){const r=this.objectToBoundingSphere(t);return!(r[3]>0)||(0,h.j)(r,e)}_intersectsObjectWithOffset(e,t,r){const i=this.objectToBoundingSphere(t);return!(i[3]>0)||(0,h.j)(r.applyToBoundingSphere(i),e)}_add(e,t){t.advanceTo(this.objectToBoundingSphere(e))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))}_split(e){const t=e.node.residents;e.node.residents=null;for(let r=0;r<t.length;r++){const i=f.acquire().init(e);this._add(t.at(r),i),f.release(i)}}_grow(e,t){if(0!==t&&(w(e,t,(e=>this.objectToBoundingSphere(e)),z),C(z[3])&&!this._fitsInsideTree(z)))if(v(this._root.node))(0,h.a)(z,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const e=this._rootBoundsForRootAsSubNode(z);this._placingRootViolatesMaxDepth(e)?this._rebuildTree(z,e):this._growRootAsSubNode(e),f.release(e)}}_rebuildTree(e,t){(0,a.c)((0,h.g)(V),(0,h.g)(t.bounds)),V[3]=t.halfSize,w([e,V],2,(e=>e),U);const r=f.acquire().init(this._root);this._root.initFrom(null,U,U[3]),this._root.increaseHalfSize(1.25),m(r,(e=>(this.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&this.add(e.node.residents.data,e.node.residents.length),!0))),f.release(r)}_placingRootViolatesMaxDepth(e){const t=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return m(this._root,(e=>(r=Math.max(r,e.depth),r+t<=this._maximumDepth))),r+t>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const t=e[3],r=e;let i=-1/0;const n=this._root.bounds,s=this._root.halfSize;for(let e=0;e<3;e++){const o=n[e]-s-(r[e]-t),a=r[e]+t-(n[e]+s),l=Math.max(0,Math.ceil(o/(2*s))),c=Math.max(0,Math.ceil(a/(2*s)))+1,u=2**Math.ceil(Math.log(l+c)*Math.LOG2E);i=Math.max(i,u),G[e].min=l,G[e].max=c}for(let e=0;e<3;e++){let t=G[e].min,r=G[e].max;const o=(i-(t+r))/2;t+=Math.ceil(o),r+=Math.floor(o);const a=n[e]-s-t*s*2;O[e]=a+(r+t)*s}const o=i*s;return O[3]=o*R,f.acquire().initFrom(null,O,o,0)}_growRootAsSubNode(e){const t=this._root.node;(0,a.c)((0,h.g)(z),(0,h.g)(this._root.bounds)),z[3]=this._root.halfSize,this._root.init(e),e.advanceTo(z,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let e=null;const t=this._root.node.children;let r=0,i=0;for(;i<t.length&&null==e;)r=i++,e=t[r];for(;i<t.length;)if(t[i++])return-1;return r}_isDegenerate(e){return!C(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const t=this._root.bounds,r=this._root.halfSize;return e[3]<=r&&e[0]>=t[0]-r&&e[0]<=t[0]+r&&e[1]>=t[1]-r&&e[1]<=t[1]+r&&e[2]>=t[2]-r&&e[2]<=t[2]+r}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:t,_objectCount:r}=this,i=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:t,objectCount:r,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:i}}}_nodeToJSON(e){const t=e.children.map((e=>e?this._nodeToJSON(e):null)),r=e.residents?.map((e=>this.objectToBoundingSphere(e))),i=e.terminals?.map((e=>this.objectToBoundingSphere(e)));return{children:t,residents:r,terminals:i}}static fromJSON(e){const t=new p((e=>e),{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return t._objectCount=e.objectCount,t._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),t}}class f{constructor(){this.bounds=(0,h.c)(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,t,r,i=this.depth){return this.node=null!=e?e:f.createEmptyNode(),t&&(0,h.a)(t,this.bounds),this.halfSize=r,this.depth=i,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*R}advance(e){let t=this.node.children[e];t||(t=f.createEmptyNode(),this.node.children[e]=t),this.node=t,this.halfSize/=2,this.depth++;const r=E[e];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,t,r=!1){for(;;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()){if(!r)return t&&t(this,-1),!1;this.node.residents=null}const i=this._childIndex(e);t&&t(this,i),this.advance(i)}}isLeaf(){return null!=this.node.residents}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const t=this.bounds;return(t[0]<e[0]?1:0)+(t[1]<e[1]?2:0)+(t[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new o.A({shrink:!0}),residents:new o.A({shrink:!0})}}static acquire(){return f._pool.acquire()}static release(e){f._pool.release(e)}static clearPool(){f._pool.prune()}}function m(e,t){let r=f.acquire().init(e);const i=[r];for(;0!==i.length;){if(r=i.pop(),t(r)&&!r.isLeaf())for(let e=0;e<r.node.children.length;e++)r.node.children[e]&&i.push(f.acquire().init(r).advance(e));f.release(r)}}function g(e,t,r,i=p.DepthOrder.FRONT_TO_BACK){let n=f.acquire().init(e);const s=[n];for(function(e,t,r){if(!B.length)for(let e=0;e<8;++e)B.push({index:0,distance:0});for(let r=0;r<8;++r){const i=E[r];B.data[r].index=r,B.data[r].distance=A(e,t,i)}B.sort(((e,t)=>e.distance-t.distance));for(let e=0;e<8;++e)r[e]=B.data[e].index}(r,i,H);0!==s.length;){if(n=s.pop(),t(n)&&!n.isLeaf())for(let e=7;e>=0;--e){const t=H[e];n.node.children[t]&&s.push(f.acquire().init(n).advance(t))}f.release(n)}}function y(e,t,r){D.clear();const i=r.advanceTo(t,((e,t)=>{D.push(e.node),D.push(t)}))?r.node.terminals:r.node.residents;if(i.removeUnordered(e),0===i.length)for(let e=D.length-2;e>=0&&_(D.data[e],D.data[e+1]);e-=2);}function _(e,t){return t>=0&&(e.children[t]=null),!!v(e)&&(null===e.residents&&(e.residents=new o.A({shrink:!0})),!0)}function v(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(let t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0}function b(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function x(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function S(e,t,r){r[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t}function w(e,t,r,i){if(1===t){const t=r(e[0]);(0,h.a)(t,i)}else{L[0]=1/0,L[1]=1/0,L[2]=1/0,N[0]=-1/0,N[1]=-1/0,N[2]=-1/0;for(let i=0;i<t;i++){const t=r(e[i]);C(t[3])&&(b(L,t),x(N,t))}(0,a.o)((0,h.g)(i),L,N,.5),i[3]=Math.max(N[0]-L[0],N[1]-L[1],N[2]-L[2])/2}}function T(e,t){let r,i=1/0;for(let n=0;n<8;++n){const s=A(e,t,M[n]);s<i&&(i=s,r=M[n])}return r}function A(e,t,r){return t*(e[0]*r[0]+e[1]*r[1]+e[2]*r[2])}function C(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}f._pool=new s.A(f),i=p||(p={}),(n=i.DepthOrder||(i.DepthOrder={}))[n.FRONT_TO_BACK=1]="FRONT_TO_BACK",n[n.BACK_TO_FRONT=-1]="BACK_TO_FRONT";const E=[(0,l.fA)(-1,-1,-1),(0,l.fA)(1,-1,-1),(0,l.fA)(-1,1,-1),(0,l.fA)(1,1,-1),(0,l.fA)(-1,-1,1),(0,l.fA)(1,-1,1),(0,l.fA)(-1,1,1),(0,l.fA)(1,1,1)],M=[(0,l.fA)(-1,-1,-1),(0,l.fA)(-1,-1,1),(0,l.fA)(-1,1,-1),(0,l.fA)(-1,1,1),(0,l.fA)(1,-1,-1),(0,l.fA)(1,-1,1),(0,l.fA)(1,1,-1),(0,l.fA)(1,1,1)],R=Math.sqrt(3),P=[null],O=(0,h.c)(),I=(0,l.vt)(),L=(0,l.vt)(),N=(0,l.vt)(),D=new o.A,F=(0,h.c)(),z=(0,h.c)(),V=(0,h.c)(),U=(0,h.c)(),G=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],B=new o.A,H=[0,0,0,0,0,0,0,0],k=p},46921:function(e,t,r){r.d(t,{K_:function(){return p},SE:function(){return h},V0:function(){return o},XO:function(){return c},aB:function(){return d},cl:function(){return f},ez:function(){return l},xt:function(){return u}});var i=r(55890),n=r(85456),s=r(57087);const o=(0,s.p3)(n.dn.SRC_ALPHA,n.dn.ONE,n.dn.ONE_MINUS_SRC_ALPHA,n.dn.ONE_MINUS_SRC_ALPHA),a=(0,s.p3)(n.dn.ONE,n.dn.ZERO,n.dn.ONE,n.dn.ONE_MINUS_SRC_ALPHA);function l(e){return e===i.y.FrontFace?null:a}function c(e){return e===i.y.FrontFace?s.kn:null}const u=5e5,h={factor:-1,units:-2};function d(e){return e?h:null}function p(e,t=n.MT.LESS){return e===i.y.NONE||e===i.y.FrontFace?t:n.MT.LEQUAL}function f(e){return e===i.y.ColorAlpha?{buffers:[n.Nm.COLOR_ATTACHMENT0,n.Nm.COLOR_ATTACHMENT1]}:null}},54101:function(e,t,r){r.d(t,{B:function(){return s}});var i=r(7187),n=r(41835);class s{constructor(e,t,r){this._context=e,this._locations=r,this._textures=new Map,this._freeTextureUnits=new i.A({deallocator:null}),this._glProgram=e.programCache.acquire(t.generate("vertex"),t.generate("fragment"),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=t.generateBindPass(this),this.bindDraw=t.generateBindDraw(this),this._fragmentUniforms=(0,n.en)()?t.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(e,t){this._glProgram.setUniform1i(e,t?1:0)}setUniform1i(e,t){this._glProgram.setUniform1i(e,t)}setUniform1f(e,t){this._glProgram.setUniform1f(e,t)}setUniform2fv(e,t){this._glProgram.setUniform2fv(e,t)}setUniform3fv(e,t){this._glProgram.setUniform3fv(e,t)}setUniform4fv(e,t){this._glProgram.setUniform4fv(e,t)}setUniformMatrix3fv(e,t){this._glProgram.setUniformMatrix3fv(e,t)}setUniformMatrix4fv(e,t){this._glProgram.setUniformMatrix4fv(e,t)}setUniform1fv(e,t){this._glProgram.setUniform1fv(e,t)}setUniform1iv(e,t){this._glProgram.setUniform1iv(e,t)}setUniform2iv(e,t){this._glProgram.setUniform3iv(e,t)}setUniform3iv(e,t){this._glProgram.setUniform3iv(e,t)}setUniform4iv(e,t){this._glProgram.setUniform4iv(e,t)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,t){if(null==t?.glName){const t=this._textures.get(e);return t&&(this._context.bindTexture(null,t.unit),this._freeTextureUnit(t),this._textures.delete(e)),null}let r=this._textures.get(e);return null==r?(r=this._allocTextureUnit(t),this._textures.set(e,r)):r.texture=t,this._context.useProgram(this),this.setUniform1i(e,r.unit),this._context.bindTexture(t,r.unit),r.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach(((e,t)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(t,e.unit)})),this._fragmentUniforms?.forEach((e=>{"sampler2D"!==e.type&&"samplerCube"!==e.type||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)}))}_allocTextureUnit(e){return{texture:e,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}}},45079:function(e,t,r){r.d(t,{JG:function(){return c},Uy:function(){return h},Wb:function(){return T},Z$:function(){return m}});var i=r(20551),n=r(32501),s=r(24761),o=r(40359),a=r(90553),l=r(65839);class c{constructor(e=!1,t=!0){this.isVerticalRay=e,this.normalRequired=t}}const u=(0,s.vt)();function h(e,t,r,n,s,u){if(!e.visible)return;const h=(0,i.z)(E,n,r),d=(e,t,r)=>{u(e,r,t,!1)},f=new c(!1,t.options.normalRequired);if(e.boundingInfo){(0,a.vA)(e.type===o.X.Mesh);const i=t.tolerance;p(e.boundingInfo,r,h,i,s,f,d)}else{const t=e.attributes.get(l.r.POSITION),i=t.indices;g(r,h,0,i.length/3,i,t.data,t.stride,s,f,d)}}const d=(0,n.vt)();function p(e,t,r,n,o,a,l){if(null==e)return;const c=function(e,t){return(0,i.s)(t,1/e[0],1/e[1],1/e[2])}(r,d);if((0,s.Ne)(u,e.bbMin),(0,s.vI)(u,e.bbMax),null!=o&&o.applyToAabb(u),T(u,t,c,n)){const{primitiveIndices:i,position:s}=e,c=i?i.length:s.indices.length/3;if(c>A){const i=e.getChildren();if(void 0!==i){for(const e of i)p(e,t,r,n,o,a,l);return}}!function(e,t,r,i,n,s,o,a,l,c,u){const h=e[0],d=e[1],p=e[2],m=t[0],g=t[1],y=t[2],{normalRequired:_}=c;for(let e=0;e<i;++e){const t=a[e],r=3*t,i=o*n[r];let c=s[i],v=s[i+1],x=s[i+2];const S=o*n[r+1];let w=s[S],T=s[S+1],A=s[S+2];const E=o*n[r+2];let M=s[E],R=s[E+1],P=s[E+2];null!=l&&([c,v,x]=l.applyToVertex(c,v,x,e),[w,T,A]=l.applyToVertex(w,T,A,e),[M,R,P]=l.applyToVertex(M,R,P,e));const O=w-c,I=T-v,L=A-x,N=M-c,D=R-v,F=P-x,z=g*F-D*y,V=y*N-F*m,U=m*D-N*g,G=O*z+I*V+L*U;if(Math.abs(G)<=C)continue;const B=h-c,H=d-v,k=p-x,j=B*z+H*V+k*U;if(G>0){if(j<0||j>G)continue}else if(j>0||j<G)continue;const W=H*L-I*k,q=k*O-L*B,Z=B*I-O*H,$=m*W+g*q+y*Z;if(G>0){if($<0||j+$>G)continue}else if($>0||j+$<G)continue;const Y=(N*W+D*q+F*Z)/G;Y>=0&&u(Y,t,_?b(O,I,L,N,D,F,f):null)}}(t,r,0,c,s.indices,s.data,s.stride,i,o,a,l)}}const f=(0,n.vt)();function m(e,t,r,n,s,o,a,l,c){const{data:u,stride:h}=o;g(e,(0,i.z)(E,t,e),r,n,s,u,h,a,l,c)}function g(e,t,r,n,s,o,a,l,c,u){const h=t,d=M,p=Math.abs(h[0]),f=Math.abs(h[1]),m=Math.abs(h[2]),g=p>=f?p>=m?0:2:f>=m?1:2,b=g,S=h[b]<0?2:1,w=(g+S)%3,T=(g+(3-S))%3,A=h[w]/h[b],C=h[T]/h[b],E=1/h[b],R=y,P=_,O=v,{normalRequired:I}=c;for(let t=r;t<n;++t){const r=3*t,n=a*s[r];(0,i.s)(d[0],o[n+0],o[n+1],o[n+2]);const c=a*s[r+1];(0,i.s)(d[1],o[c+0],o[c+1],o[c+2]);const h=a*s[r+2];(0,i.s)(d[2],o[h+0],o[h+1],o[h+2]),l&&((0,i.c)(d[0],l.applyToVertex(d[0][0],d[0][1],d[0][2],t)),(0,i.c)(d[1],l.applyToVertex(d[1][0],d[1][1],d[1][2],t)),(0,i.c)(d[2],l.applyToVertex(d[2][0],d[2][1],d[2][2],t))),(0,i.z)(R,d[0],e),(0,i.z)(P,d[1],e),(0,i.z)(O,d[2],e);const p=R[w]-A*R[b],f=R[T]-C*R[b],m=P[w]-A*P[b],g=P[T]-C*P[b],y=O[w]-A*O[b],_=O[T]-C*O[b],v=y*g-_*m,S=p*_-f*y,M=m*f-g*p;if((v<0||S<0||M<0)&&(v>0||S>0||M>0))continue;const L=v+S+M;if(0===L)continue;const N=v*(E*R[b])+S*(E*P[b])+M*(E*O[b]);if(N*Math.sign(L)<0)continue;const D=N/L;D>=0&&u(D,t,I?x(d):null)}}const y=(0,n.vt)(),_=(0,n.vt)(),v=(0,n.vt)();function b(e,t,r,n,s,o,a){return(0,i.s)(S,e,t,r),(0,i.s)(w,n,s,o),(0,i.b)(a,S,w),(0,i.n)(a,a),a}function x(e){return(0,i.z)(S,e[1],e[0]),(0,i.z)(w,e[2],e[0]),(0,i.b)(f,S,w),(0,i.n)(f,f),f}const S=(0,n.vt)(),w=(0,n.vt)();function T(e,t,r,i){return function(e,t,r,i,n){const s=(e[0]-i-t[0])*r[0],o=(e[3]+i-t[0])*r[0];let a=Math.min(s,o),l=Math.max(s,o);const c=(e[1]-i-t[1])*r[1],u=(e[4]+i-t[1])*r[1];if(l=Math.min(l,Math.max(c,u)),l<0)return!1;if(a=Math.max(a,Math.min(c,u)),a>l)return!1;const h=(e[2]-i-t[2])*r[2],d=(e[5]+i-t[2])*r[2];return l=Math.min(l,Math.max(h,d)),!(l<0)&&(a=Math.max(a,Math.min(h,d)),!(a>l)&&a<1/0)}(e,t,r,i)}const A=1e3,C=1e-7,E=(0,n.vt)(),M=[(0,n.vt)(),(0,n.vt)(),(0,n.vt)()]},15389:function(e,t,r){r.d(t,{$:function(){return c}});var i=r(11231),n=r(73364),s=r(39714),o=r(20551),a=r(90599),l=r(76185);class c{constructor(e,t={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=(0,s.vt)(),this._shaderTransformation=null,this._boundingSphere=null,this.id=(0,i.c)(),this.layerUid=t.layerUid,this.graphicUid=t.graphicUid,this.castShadow=t.castShadow??!1,null!=t.objectShaderTransformation&&this.objectShaderTransformationChanged(t.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){(0,n.C)(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){null==e?this._shaderTransformation=null:(this._shaderTransformation??=(0,s.vt)(),(0,n.lw)(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(null==this._boundingSphere&&(this._boundingSphere??=(0,a.c)(),(0,o.h)((0,a.g)(this._boundingSphere),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*(0,l.hG)(this.shaderTransformation)),this._boundingSphere):a.N}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??this.transformation}get attributes(){return this.geometry.attributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}}},29165:function(e,t,r){var i;r.d(t,{N:function(){return i}}),function(e){e[e.INTEGRATED_MESH=0]="INTEGRATED_MESH",e[e.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",e[e.OPAQUE_NO_SSAO_DEPTH=3]="OPAQUE_NO_SSAO_DEPTH",e[e.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_NO_SSAO_DEPTH=5]="TRANSPARENT_NO_SSAO_DEPTH",e[e.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN",e[e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=7]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",e[e.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN",e[e.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL",e[e.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL",e[e.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS",e[e.OPAQUE_ENVIRONMENT=12]="OPAQUE_ENVIRONMENT",e[e.TRANSPARENT_ENVIRONMENT=13]="TRANSPARENT_ENVIRONMENT",e[e.LASERLINES=14]="LASERLINES",e[e.LASERLINES_CONTRAST_CONTROL=15]="LASERLINES_CONTRAST_CONTROL",e[e.HUD_MATERIAL=16]="HUD_MATERIAL",e[e.LABEL_MATERIAL=17]="LABEL_MATERIAL",e[e.LINE_CALLOUTS=18]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=19]="LINE_CALLOUTS_HUD_DEPTH",e[e.DRAPED_MATERIAL=20]="DRAPED_MATERIAL",e[e.DRAPED_WATER=21]="DRAPED_WATER",e[e.VIEWSHED=22]="VIEWSHED",e[e.VOXEL=23]="VOXEL",e[e.MAX_SLOTS=24]="MAX_SLOTS"}(i||(i={}))},6200:function(e,t,r){r.d(t,{I$:function(){return h},a9:function(){return u},m:function(){return s},mK:function(){return d},qh:function(){return c},r8:function(){return l},sf:function(){return o},v0:function(){return a}});var i=r(54407),n=r(85456);const s={func:n.MT.LESS},o={func:n.MT.ALWAYS},a={mask:255},l={mask:0},c={function:{func:n.MT.ALWAYS,ref:i.dd.OutlineVisualElementMask,mask:i.dd.OutlineVisualElementMask},operation:{fail:n.eA.KEEP,zFail:n.eA.KEEP,zPass:n.eA.ZERO}},u={function:{func:n.MT.ALWAYS,ref:i.dd.OutlineVisualElementMask,mask:i.dd.OutlineVisualElementMask},operation:{fail:n.eA.KEEP,zFail:n.eA.KEEP,zPass:n.eA.REPLACE}},h={function:{func:n.MT.EQUAL,ref:i.dd.OutlineVisualElementMask,mask:i.dd.OutlineVisualElementMask},operation:{fail:n.eA.KEEP,zFail:n.eA.KEEP,zPass:n.eA.KEEP}},d={function:{func:n.MT.NOTEQUAL,ref:i.dd.OutlineVisualElementMask,mask:i.dd.OutlineVisualElementMask},operation:{fail:n.eA.KEEP,zFail:n.eA.KEEP,zPass:n.eA.KEEP}}},59552:function(e,t,r){r.d(t,{g:function(){return G}}),r(58941);var i=r(39819),n=r(48996),s=r(95929),o=r(60539),a=r(24540),l=r(90683),c=r(9030),u=r(86419),h=r(54407),d=r(53216);let p;var f,m;(m=f||(f={}))[m.ETC1_RGB=0]="ETC1_RGB",m[m.ETC2_RGBA=1]="ETC2_RGBA",m[m.BC1_RGB=2]="BC1_RGB",m[m.BC3_RGBA=3]="BC3_RGBA",m[m.BC4_R=4]="BC4_R",m[m.BC5_RG=5]="BC5_RG",m[m.BC7_M6_RGB=6]="BC7_M6_RGB",m[m.BC7_M5_RGBA=7]="BC7_M5_RGBA",m[m.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",m[m.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",m[m.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",m[m.ATC_RGB=11]="ATC_RGB",m[m.ATC_RGBA=12]="ATC_RGBA",m[m.FXT1_RGB=17]="FXT1_RGB",m[m.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",m[m.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",m[m.ETC2_EAC_R11=20]="ETC2_EAC_R11",m[m.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",m[m.RGBA32=13]="RGBA32",m[m.RGB565=14]="RGB565",m[m.BGR565=15]="BGR565",m[m.RGBA4444=16]="RGBA4444";var g=r(85456),y=r(78541),_=r(93380);let v=null,b=null;async function x(){return null==b&&(p??=(async()=>{const e=await r.e(5090).then(r.bind(r,90830)),t=await e.default({locateFile:e=>(0,d.s)(`esri/libs/basisu/${e}`)});return t.initializeBasis(),t})(),b=p,v=await b),b}function S(e,t,r,i,n){const s=(0,_.IB)(t?g.CQ.COMPRESSED_RGBA8_ETC2_EAC:g.CQ.COMPRESSED_RGB8_ETC2),o=n&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(r*i*s*o)}function w(e){return e.getNumImages()>=1&&!e.isUASTC()}function T(e){return e.getFaces()>=1&&e.isETC1S()}function A(e,t,r,i,n,s,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=e.capabilities,[u,h]=l?i?[f.ETC2_RGBA,g.CQ.COMPRESSED_RGBA8_ETC2_EAC]:[f.ETC1_RGB,g.CQ.COMPRESSED_RGB8_ETC2]:c?i?[f.BC3_RGBA,g.CQ.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[f.BC1_RGB,g.CQ.COMPRESSED_RGB_S3TC_DXT1_EXT]:[f.RGBA32,g.Ab.RGBA],d=t.hasMipmap?r:Math.min(1,r),p=[];for(let e=0;e<d;e++)p.push(new Uint8Array(o(e,u))),a(e,u,p[e]);return t.internalFormat=h,t.hasMipmap=p.length>1,t.samplingMode=t.hasMipmap?g.Cj.LINEAR_MIPMAP_LINEAR:g.Cj.LINEAR,t.width=n,t.height=s,new y.g(e,t,{type:"compressed",levels:p})}var C=r(48015),E=r(40359),M=r(40633);const R=()=>M.A.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil");function P(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const O=P("DXT1"),I=P("DXT3"),L=P("DXT5");function N(e,t){const r=new Int32Array(e,0,31);if(542327876!==r[0])return R().error("Invalid magic number in DDS header"),null;if(!(4&r[20]))return R().error("Unsupported format, must contain a FourCC code"),null;const i=r[21];let n,s;switch(i){case O:n=8,s=g.CQ.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case I:n=16,s=g.CQ.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case L:n=16,s=g.CQ.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return R().error("Unsupported FourCC code:",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(i)),null}let o=1,a=r[4],l=r[3];(3&a||3&l)&&(R().warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,u=l;let h,d;131072&r[2]&&!1!==t&&(o=Math.max(1,r[7]));let p=r[1]+4;const f=[];for(let t=0;t<o;++t)d=(a+3>>2)*(l+3>>2)*n,h=new Uint8Array(e,p,d),f.push(h),p+=d,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:f},internalFormat:s,width:c,height:u}}var D,F,z=r(12569),V=r(90553),U=r(10956);class G extends C.J{get parameters(){return this._parameters}constructor(e,t){super(),this._data=e,this.type=E.X.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new n.A,this._parameters={...H,...t},this._startPreload(e)}dispose(){this.unload(),this._data=this.frameUpdate=void 0}_startPreload(e){null!=e&&(e instanceof HTMLVideoElement?(this.frameUpdate=t=>this._frameUpdate(e,t),this._startPreloadVideoElement(e)):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!((0,l.w8)(e.src)||"auto"===e.preload&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const t=!e.paused;if(e.src=e.src,t&&e.autoplay){const t=()=>{e.removeEventListener("canplay",t),e.play()};e.addEventListener("canplay",t)}}}_startPreloadImageElement(e){(0,l.DB)(e.src)||(0,l.w8)(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}_createDescriptor(e){const t=new U.R;return t.wrapMode=this._parameters.wrap??g.pF.REPEAT,t.flipped=!this._parameters.noUnpackFlip,t.samplingMode=this._parameters.mipmap?g.Cj.LINEAR_MIPMAP_LINEAR:g.Cj.LINEAR,t.hasMipmap=!!this._parameters.mipmap,t.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,t.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?e.parameters.maxMaxAnisotropy:1),t}get glTexture(){return this._glTexture}get memoryEstimate(){return this._glTexture?.usedMemory||function(e,t){if(null==e)return 0;if((0,a.mw)(e)||(0,a.mg)(e))return t.encoding===h.JS.KTX2_ENCODING?function(e,t){if(null==v)return e.byteLength;const r=new v.KTX2File(new Uint8Array(e)),i=T(r)?S(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),t):0;return r.close(),r.delete(),i}(e,!!t.mipmap):t.encoding===h.JS.BASIS_ENCODING?function(e,t){if(null==v)return e.byteLength;const r=new v.BasisFile(new Uint8Array(e)),i=w(r)?S(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),t):0;return r.close(),r.delete(),i}(e,!!t.mipmap):e.byteLength;const{width:r,height:i}=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?B(e):t;return(t.mipmap?4/3:1)*r*i*(t.components||4)||0}(this._data,this._parameters)}load(e){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const t=this._data;return null==t?(this._glTexture=new y.g(e,this._createDescriptor(e),null),this._glTexture):(this._parameters.reloadable||(this._data=void 0),"string"==typeof t?this._loadFromURL(e,t):t instanceof Image?this._loadFromImageElement(e,t):t instanceof HTMLVideoElement?this._loadFromVideoElement(e,t):t instanceof ImageData||t instanceof HTMLCanvasElement?this._loadFromImage(e,t):((0,a.mw)(t)||(0,a.mg)(t))&&this._parameters.encoding===h.JS.DDS_ENCODING?this._loadFromDDSData(e,t):((0,a.mw)(t)||(0,a.mg)(t))&&this._parameters.encoding===h.JS.KTX2_ENCODING?this._loadFromKTX2(e,t):((0,a.mw)(t)||(0,a.mg)(t))&&this._parameters.encoding===h.JS.BASIS_ENCODING?this._loadFromBasis(e,t):(0,a.mg)(t)?this._loadFromPixelData(e,t):(0,a.mw)(t)?this._loadFromPixelData(e,new Uint8Array(t)):null)}_frameUpdate(e,t){return null==this._glTexture||e.readyState<D.HAVE_CURRENT_DATA||t===e.currentTime?t:(this._glTexture.setData(e),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),e.currentTime)}_loadFromDDSData(e,t){return this._glTexture=function(e,t,r){const i=N(r,t.hasMipmap??!1);if(null==i)throw new Error("DDS texture data is null");const{textureData:n,internalFormat:s,width:o,height:a}=i;return t.samplingMode=n.levels.length>1?g.Cj.LINEAR_MIPMAP_LINEAR:g.Cj.LINEAR,t.hasMipmap=n.levels.length>1,t.internalFormat=s,t.width=o,t.height=a,new y.g(e,t,n)}(e,this._createDescriptor(e),t),this._glTexture}_loadFromKTX2(e,t){return this._loadAsync((()=>async function(e,t,r){null==v&&(v=await x());const i=new v.KTX2File(new Uint8Array(r));if(!T(i))return null;i.startTranscoding();const n=A(e,t,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),((e,t)=>i.getImageTranscodedSizeInBytes(e,0,0,t)),((e,t,r)=>i.transcodeImage(r,e,0,0,t,0,-1,-1)));return i.close(),i.delete(),n}(e,this._createDescriptor(e),t).then((e=>(this._glTexture=e,e)))))}_loadFromBasis(e,t){return this._loadAsync((()=>async function(e,t,r){null==v&&(v=await x());const i=new v.BasisFile(new Uint8Array(r));if(!w(i))return null;i.startTranscoding();const n=A(e,t,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),((e,t)=>i.getImageTranscodedSizeInBytes(0,e,t)),((e,t,r)=>i.transcodeImage(r,0,e,t,0,0)));return i.close(),i.delete(),n}(e,this._createDescriptor(e),t).then((e=>(this._glTexture=e,e)))))}_loadFromPixelData(e,t){(0,V.vA)(this._parameters.width>0&&this._parameters.height>0);const r=this._createDescriptor(e);return r.pixelFormat=1===this._parameters.components?g.Ab.LUMINANCE:3===this._parameters.components?g.Ab.RGB:g.Ab.RGBA,r.width=this._parameters.width??0,r.height=this._parameters.height??0,this._glTexture=new y.g(e,r,t),this._glTexture}_loadFromURL(e,t){return this._loadAsync((async r=>{const i=await(0,c.D)(t,{signal:r});return(0,o.Te)(r),this._loadFromImage(e,i)}))}_loadFromImageElement(e,t){return t.complete?this._loadFromImage(e,t):this._loadAsync((async r=>{const i=await(0,u.Sx)(t,t.src,!1,r);return(0,o.Te)(r),this._loadFromImage(e,i)}))}_loadFromVideoElement(e,t){return t.readyState>=D.HAVE_CURRENT_DATA?this._loadFromImage(e,t):this._loadFromVideoElementAsync(e,t)}_loadFromVideoElementAsync(e,t){return this._loadAsync((r=>new Promise(((n,a)=>{const l=()=>{t.removeEventListener("loadeddata",c),t.removeEventListener("error",u),(0,s.xt)(h)},c=()=>{t.readyState>=D.HAVE_CURRENT_DATA&&(l(),n(this._loadFromImage(e,t)))},u=e=>{l(),a(e||new i.A("Failed to load video"))};t.addEventListener("loadeddata",c),t.addEventListener("error",u);const h=(0,o.u7)(r,(()=>u((0,o.NK)())))}))))}_loadFromImage(e,t){let r=t;if(!(r instanceof HTMLVideoElement)){const{maxTextureSize:t}=e.parameters;r=this._parameters.downsampleUncompressed?(0,z.IR)(r,t):(0,z.vM)(r,t)}const i=B(r);this._parameters.width=i.width,this._parameters.height=i.height;const n=this._createDescriptor(e);return n.pixelFormat=3===this._parameters.components?g.Ab.RGB:g.Ab.RGBA,n.width=i.width,n.height=i.height,this._glTexture=new y.g(e,n,r),this._glTexture}_loadAsync(e){const t=new AbortController;this._loadingController=t;const r=e(t.signal);this._loadingPromise=r;const i=()=>{this._loadingController===t&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(i,i),r}unload(){if(this._glTexture=(0,s.WD)(this._glTexture),null!=this._loadingController){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}}function B(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}(F=D||(D={}))[F.HAVE_NOTHING=0]="HAVE_NOTHING",F[F.HAVE_METADATA=1]="HAVE_METADATA",F[F.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",F[F.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",F[F.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA";const H={wrap:{s:g.pF.REPEAT,t:g.pF.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1}},55890:function(e,t,r){var i;r.d(t,{y:function(){return i}}),function(e){e[e.ColorAlpha=0]="ColorAlpha",e[e.FrontFace=1]="FrontFace",e[e.NONE=2]="NONE",e[e.COUNT=3]="COUNT"}(i||(i={}))},91998:function(e,t,r){var i;r.d(t,{q:function(){return i}}),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(i||(i={}))},90553:function(e,t,r){r.d(t,{L:function(){return l},MX:function(){return o},M_:function(){return u},O_:function(){return a},kL:function(){return c},vA:function(){return s},zH:function(){return h}});var i=r(1932);r(33400),(0,r(41546).vt)();class n{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}}function s(e,t){if(!e){t=t||"Assertion";const e=new Error(t).stack;throw new n(`${t} at ${e}`)}}function o(e,t){e||(t=t||"",console.warn("Verify failed: "+t+"\n"+new Error("verify").stack))}function a(e,t,r,i){let n,s=(r[0]-e[0])/t[0],o=(i[0]-e[0])/t[0];s>o&&(n=s,s=o,o=n);let a=(r[1]-e[1])/t[1],l=(i[1]-e[1])/t[1];if(a>l&&(n=a,a=l,l=n),s>l||a>o)return!1;a>s&&(s=a),l<o&&(o=l);let c=(r[2]-e[2])/t[2],u=(i[2]-e[2])/t[2];return c>u&&(n=c,c=u,u=n),!(s>u||c>o||(u<o&&(o=u),o<0))}function l(e,t,r,n,s,o=(0,i.vt)()){const a=(n[s]-r[s])*(t[0]-e[0])-(n[0]-r[0])*(t[s]-e[s]),l=(n[0]-r[0])*(e[s]-r[s])-(n[s]-r[s])*(e[0]-r[0]);if(0===a)return!1;const c=l/a;return o[0]=e[0]+c*(t[0]-e[0]),o[1]=e[s]+c*(t[s]-e[s]),!0}function c(e,t){return Math.log(e)/Math.log(t)}function u(e,t,r,i){e[12]=t,e[13]=r,e[14]=i}function h(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&1===e[15]}},69445:function(e,t,r){r.d(t,{Z:function(){return n}});var i=r(81438);class n extends i.Z{}},65839:function(e,t,r){var i;function n(e){return e===i.POSITION}r.d(t,{b:function(){return n},r:function(){return i}}),function(e){e.POSITION="position",e.NORMAL="normal",e.NORMALCOMPRESSED="normalCompressed",e.UV0="uv0",e.COLOR="color",e.SYMBOLCOLOR="symbolColor",e.SIZE="size",e.TANGENT="tangent",e.OFFSET="offset",e.PERSPECTIVEDIVIDE="perspectiveDivide",e.CENTEROFFSETANDDISTANCE="centerOffsetAndDistance",e.LENGTH="length",e.PREVPOSITION="prevPosition",e.NEXTPOSITION="nextPosition",e.SUBDIVISIONFACTOR="subdivisionFactor",e.COLORFEATUREATTRIBUTE="colorFeatureAttribute",e.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",e.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",e.DISTANCETOSTART="distanceToStart",e.UVMAPSPACE="uvMapSpace",e.BOUNDINGRECT="boundingRect",e.UVREGION="uvRegion",e.PROFILERIGHT="profileRight",e.PROFILEUP="profileUp",e.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",e.FEATUREVALUE="featureValue",e.INSTANCEMODELORIGINHI="instanceModelOriginHi",e.INSTANCEMODELORIGINLO="instanceModelOriginLo",e.INSTANCEMODEL="instanceModel",e.INSTANCEMODELNORMAL="instanceModelNormal",e.INSTANCECOLOR="instanceColor",e.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",e.LOCALTRANSFORM="localTransform",e.GLOBALTRANSFORM="globalTransform",e.BOUNDINGSPHERE="boundingSphere",e.MODELORIGIN="modelOrigin",e.MODELSCALEFACTORS="modelScaleFactors",e.FEATUREATTRIBUTE="featureAttribute",e.STATE="state",e.LODLEVEL="lodLevel",e.POSITION0="position0",e.POSITION1="position1",e.NORMAL2COMPRESSED="normal2Compressed",e.COMPONENTINDEX="componentIndex",e.VARIANTOFFSET="variantOffset",e.VARIANTSTROKE="variantStroke",e.VARIANTEXTENSION="variantExtension",e.SIDENESS="sideness",e.START="start",e.END="end",e.UP="up",e.EXTRUDE="extrude",e.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",e.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"}(i||(i={}))},1296:function(e,t,r){r.d(t,{x:function(){return d}});var i=r(48996),n=r(14606),s=r(95929),o=r(7187),a=r(48015),l=r(40359);const c=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];var u=r(35363),h=r(91998);class d extends a.J{get objects(){return this._objects}constructor(e,t,r=""){super(),this.stage=e,this.apiLayerUid=r,this.type=l.X.Layer,this.events=new i.A,this.visible=!0,this.pickable=!0,this.sliceable=!1,this._objects=new o.A,this._objectsAdded=new o.A,this._handles=new n.A,this.apiLayerUid=r,this.visible=t?.visible??!0,this.pickable=t?.pickable??!0,this.updatePolicy=t?.updatePolicy??h.q.ASYNC,this._disableOctree=t?.disableOctree??!1,e.add(this);for(const t of c)this._handles.add(this.events.on(t,(r=>e.handleEvent(t,r))))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),null!=this._octree&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),null!=this._octree&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),null!=this._octree&&this._objectsAdded.pushArray(e)}removeMany(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),null!=this._octree){for(let e=0;e<t.length;)this._objectsAdded.removeUnordered(t[e])?(t[e]=t[t.length-1],t.length-=1):++e;this._octree.remove(t)}}}sync(){this.updatePolicy!==h.q.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,t){null==this._octree||this._objectsAdded.includes(e)||this._octree.update(e,t)}getSpatialQueryAccelerator(){return null==this._octree&&this._objects.length>50&&!this._disableOctree?(this._octree=new u.A((e=>e.boundingVolumeWorldSpace.bounds)),this._octree.add(this._objects.data,this._objects.length)):null!=this._octree&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}invalidateSpatialQueryAccelerator(){this._octree=(0,s.pR)(this._octree),this._objectsAdded.clear()}}},54407:function(e,t,r){var i,n,s,o,a,l,c,u,h;r.d(t,{Am:function(){return o},C7:function(){return s},ID:function(){return u},JS:function(){return h},Mg:function(){return l},dd:function(){return a},it:function(){return n},s2:function(){return i},sf:function(){return c}}),function(e){e[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.COUNT=3]="COUNT"}(i||(i={})),function(e){e[e.Less=0]="Less",e[e.Lequal=1]="Lequal",e[e.COUNT=2]="COUNT"}(n||(n={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.UPDATE=1]="UPDATE"}(s||(s={})),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(o||(o={})),function(e){e[e.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",e[e.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(a||(a={})),function(e){e[e.Highlight=0]="Highlight",e[e.MaskOccludee=1]="MaskOccludee",e[e.COUNT=2]="COUNT"}(l||(l={})),function(e){e[e.Blend=0]="Blend",e[e.Opaque=1]="Opaque",e[e.Mask=2]="Mask",e[e.MaskBlend=3]="MaskBlend",e[e.COUNT=4]="COUNT"}(c||(c={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(u||(u={})),function(e){e.DDS_ENCODING="image/vnd-ms.dds",e.KTX2_ENCODING="image/ktx2",e.BASIS_ENCODING="image/x.basis"}(h||(h={}))},33753:function(e,t,r){var i;r.d(t,{x:function(){return i}}),function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.TRANSPARENT=1]="TRANSPARENT",e[e.OPAQUE=2]="OPAQUE"}(i||(i={}))},59356:function(e,t,r){r.d(t,{i3:function(){return n}}),r(20551);var i=r(32501);function n(e){return null!=e?.dist}r(2075),r(38177),(0,i.vt)()},57701:function(e,t,r){r.d(t,{$T:function(){return a},zj:function(){return n}});var i,n,s,o=r(23545);function a(e){const t=new Map,r=e=>{let r=t.get(e);return r||(r=new o.a0,t.set(e,r)),r};return e.removes.forAll((e=>{l(e)&&r(e.material).removes.push(e)})),e.adds.forAll((e=>{l(e)&&r(e.material).adds.push(e)})),e.updates.forAll((e=>{l(e.renderGeometry)&&r(e.renderGeometry.material).updates.push(e)})),t}function l(e){return e.geometry.indexCount>=1}(s=i||(i={}))[s.Default=0]="Default",s[s.Screenshot=1]="Screenshot",s[s.ObjectAndLayerID=2]="ObjectAndLayerID",function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"}(n||(n={}))},54035:function(e,t,r){r.d(t,{MD:function(){return a},cJ:function(){return o},hs:function(){return l},m0:function(){return s}});var i=r(15774);function n(e,t,r){const i=r.parameters;return c.scale=Math.min(i.divisor/(t-i.offset),1),c.factor=function(e){return Math.abs(e*e*e)}(e),c}function s(e,t){return(0,i.Cc)(e*Math.max(t.scale,t.minScaleFactor),e,t.factor)}function o(e,t,r,i){i.scale=function(e,t,r){const i=n(e,t,r);return i.minScaleFactor=0,s(1,i)}(e,t,r),i.factor=0,i.minScaleFactor=r.minScaleFactor}function a(e,t,r=[0,0]){const i=Math.min(Math.max(t.scale,t.minScaleFactor),1);return r[0]=e[0]*i,r[1]=e[1]*i,r}function l(e,t,r,i){return s(e,n(t,r,i))}r(65420),(0,i.kU)(10),(0,i.kU)(12),(0,i.kU)(70),(0,i.kU)(40);const c={scale:0,factor:0,minScaleFactor:0}},10228:function(e,t,r){r.d(t,{G:function(){return i},Q:function(){return n}});const i={stableRendering:!1},n={rootOrigin:null}},12569:function(e,t,r){r.d(t,{IR:function(){return a},Mv:function(){return s},uT:function(){return o},vM:function(){return l}});var i=r(39819);const n=16;function s(e){return Math.ceil(e/n)*n}function o(e){return Math.floor(e/n)*n}function a(e,t){let r=e.width*e.height;if(r<4096)return e instanceof ImageData?u(e):e;let i=e.width,n=e.height;do{i=Math.ceil(i/2),n=Math.ceil(n/2),r=i*n}while(r>1048576||null!=t&&(i>t||n>t));return c(e,i,n)}function l(e,t){const r=Math.max(e.width,e.height);if(r<=t)return e;const i=t/r;return c(e,Math.round(e.width*i),Math.round(e.height*i))}function c(e,t,r){if(e instanceof ImageData)return c(u(e),t,r);const i=document.createElement("canvas");return i.width=t,i.height=r,i.getContext("2d").drawImage(e,0,0,i.width,i.height),i}function u(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");if(null==r)throw new i.A("Failed to create 2d context from HTMLCanvasElement");return r.putImageData(e,0,0),t}},22323:function(e,t,r){r.d(t,{dg:function(){return d},ou:function(){return m}});var i=r(44705),n=r(87725),s=r(73364),o=r(39714),a=r(20551),l=r(32501),c=r(90599),u=r(65420),h=r(89765);class d{constructor(){this._transform=(0,o.vt)(),this._transformInverse=new p({value:this._transform},s.B8,o.vt),this._transformInverseTranspose=new p(this._transformInverse,s.mg,o.vt),this._transformTranspose=new p({value:this._transform},s.mg,o.vt),this._transformInverseRotation=new p({value:this._transform},i.dR,n.vt)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){(0,s.C)(this._transform,e)}multiplyTransform(e){(0,s.lw)(this._transform,this._transform,e)}set(e){(0,s.C)(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this._invalidateLazyTransforms()}}class p{constructor(e,t,r){this._original=e,this._update=t,this._dirty=!0,this._transform=r()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}}const f=new class{constructor(e=0){this.offset=e,this.sphere=(0,c.c)(),this.tmpVertex=(0,l.vt)()}applyToVertex(e,t,r){const i=this.objectTransform.transform,n=(0,a.s)(g,e,t,r),s=(0,a.h)(n,n,i),o=this.offset/(0,a.l)(s);(0,a.r)(s,s,s,o);const l=this.objectTransform.inverse;return(0,a.h)(this.tmpVertex,s,l),this.tmpVertex}applyToMinMax(e,t){const r=this.offset/(0,a.l)(e);(0,a.r)(e,e,e,r);const i=this.offset/(0,a.l)(t);(0,a.r)(t,t,t,i)}applyToAabb(e){const t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;const r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e}applyToBoundingSphere(e){const t=(0,a.l)((0,c.g)(e)),r=this.offset/t;return(0,a.r)((0,c.g)(this.sphere),(0,c.g)(e),(0,c.g)(e),r),this.sphere[3]=e[3]+e[3]*this.offset/t,this.sphere}};function m(e){return null!=e?(f.offset=e,f):null}new class{constructor(e=0){this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=(0,l.vt)(),this._tmpMbs=(0,c.c)(),this._tmpObb=new h.ab,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=(0,a.l)(e)}applyToVertex(e,t,r){const i=(0,a.s)(g,e,t,r),n=(0,a.s)(y,e,t,r+this.componentLocalOriginLength),s=this._totalOffset/(0,a.l)(n);return(0,a.r)(this._tmpVertex,i,n,s),this._tmpVertex}applyToAabb(e){const t=this.componentLocalOriginLength,r=e[0],i=e[1],n=e[2]+t,s=e[3],o=e[4],a=e[5]+t,l=Math.abs(r),c=Math.abs(i),u=Math.abs(n),h=Math.abs(s),d=Math.abs(o),p=Math.abs(a),f=.5*(1+Math.sign(r*s))*Math.min(l,h),m=.5*(1+Math.sign(i*o))*Math.min(c,d),g=.5*(1+Math.sign(n*a))*Math.min(u,p),y=Math.max(l,h),_=Math.max(c,d),v=Math.max(u,p),b=Math.sqrt(f*f+m*m+g*g),x=Math.sign(l+r),S=Math.sign(c+i),w=Math.sign(u+n),T=Math.sign(h+s),A=Math.sign(d+o),C=Math.sign(p+a),E=this._totalOffset;if(b<E)return e[0]-=(1-x)*E,e[1]-=(1-S)*E,e[2]-=(1-w)*E,e[3]+=T*E,e[4]+=A*E,e[5]+=C*E,e;const M=E/Math.sqrt(y*y+_*_+v*v),R=E/b,P=R-M,O=-P;return e[0]+=r*(x*O+R),e[1]+=i*(S*O+R),e[2]+=n*(w*O+R),e[3]+=s*(T*P+M),e[4]+=o*(A*P+M),e[5]+=a*(C*P+M),e}applyToMbs(e){const t=(0,a.l)((0,c.g)(e)),r=this._totalOffset/t;return(0,a.r)((0,c.g)(this._tmpMbs),(0,c.g)(e),(0,c.g)(e),r),this._tmpMbs[3]=e[3]+e[3]*this._totalOffset/t,this._tmpMbs}applyToObb(e){return(0,h.gm)(e,this._totalOffset,this._totalOffset,u.RT.Global,this._tmpObb),this._tmpObb}},new class{constructor(e=0){this.offset=e,this.tmpVertex=(0,l.vt)()}applyToVertex(e,t,r){const i=(0,a.s)(g,e,t,r),n=(0,a.g)(y,i,this.localOrigin),s=this.offset/(0,a.l)(n);return(0,a.r)(this.tmpVertex,i,n,s),this.tmpVertex}applyToAabb(e){const t=_,r=v,i=b;for(let n=0;n<3;++n)t[n]=e[0+n]+this.localOrigin[n],r[n]=e[3+n]+this.localOrigin[n],i[n]=t[n];const n=this.applyToVertex(t[0],t[1],t[2]);for(let t=0;t<3;++t)e[t]=n[t],e[t+3]=n[t];const s=t=>{const r=this.applyToVertex(t[0],t[1],t[2]);for(let t=0;t<3;++t)e[t]=Math.min(e[t],r[t]),e[t+3]=Math.max(e[t+3],r[t])};for(let e=1;e<8;++e){for(let n=0;n<3;++n)i[n]=e&1<<n?r[n]:t[n];s(i)}let o=0;for(let e=0;e<3;++e)t[e]*r[e]<0&&(o|=1<<e);if(0!==o&&7!==o)for(let e=0;e<8;++e)if(!(o&e)){for(let n=0;n<3;++n)i[n]=o&1<<n?0:e&1<<n?t[n]:r[n];s(i)}for(let t=0;t<3;++t)e[t]-=this.localOrigin[t],e[t+3]-=this.localOrigin[t];return e}};const g=(0,l.vt)(),y=(0,l.vt)(),_=(0,l.vt)(),v=(0,l.vt)(),b=(0,l.vt)()},35910:function(e,t,r){r.d(t,{$p:function(){return n},Qx:function(){return o},_y:function(){return s},e_:function(){return a}});var i=r(32501);class n{constructor(e=(0,i.vt)()){this.intensity=e}}class s{constructor(e=(0,i.vt)(),t=(0,i.fA)(.57735,.57735,.57735)){this.intensity=e,this.direction=t}}class o{constructor(e=(0,i.vt)(),t=(0,i.fA)(.57735,.57735,.57735),r=!0,n=1,s=1){this.intensity=e,this.direction=t,this.castShadows=r,this.specularStrength=n,this.environmentStrength=s}}class a{constructor(){this.r=[0],this.g=[0],this.b=[0]}}},95629:function(e,t,r){r.d(t,{TA:function(){return A},uH:function(){return T}});var i=r(15774),n=r(20551),s=r(32501),o=r(35910);function a(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]*t[i];return r}function l(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]*t;return r}function c(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]+t[i];return r}function u(e){return(e+1)*(e+1)}function h(e,t,r){const i=e[0],n=e[1],s=e[2],o=r||[];return o.length=u(t),t>=0&&(o[0]=.28209479177),t>=1&&(o[1]=.4886025119*i,o[2]=.4886025119*s,o[3]=.4886025119*n),t>=2&&(o[4]=1.09254843059*i*n,o[5]=1.09254843059*n*s,o[6]=.31539156525*(3*s*s-1),o[7]=1.09254843059*i*s,o[8]=.54627421529*(i*i-n*n)),o}function d(e,t){const r=u(e),i=t||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(let e=0;e<r;e++)i.r[e]=i.g[e]=i.b[e]=0;return i}function p(e,t){const r=function(e){return(0,i.qE)(Math.floor(Math.sqrt(e)-1),0,2)}(t.r.length);for(const i of e)(0,n.k)(b,i.direction),h(b,r,_),a(_,x),l(_,i.intensity[0],v),c(t.r,v),l(_,i.intensity[1],v),c(t.g,v),l(_,i.intensity[2],v),c(t.b,v);return t}function f(e,t){h(b,0,_);for(const r of e)t.r[0]+=_[0]*x[0]*r.intensity[0]*4*Math.PI,t.g[0]+=_[0]*x[0]*r.intensity[1]*4*Math.PI,t.b[0]+=_[0]*x[0]*r.intensity[2]*4*Math.PI;return t}const m=[],g=[],y=[],_=[0],v=[0],b=(0,s.vt)(),x=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];class S{constructor(){this.color=(0,s.vt)(),this.intensity=1}}class w{constructor(){this.direction=(0,s.vt)(),this.ambient=new S,this.diffuse=new S}}const T=.4;class A{constructor(){this._shOrder=2,this._legacy=new w,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new o.e_,this._mainLight=new o.Qx((0,s.vt)(),(0,s.fA)(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){(function(e,t,r,i){d(t,i),(0,n.s)(r.intensity,0,0,0);let s=!1;const a=m,l=g,u=y;a.length=0,l.length=0,u.length=0;for(const t of e)t instanceof o.Qx&&!s?((0,n.c)(r.direction,t.direction),(0,n.c)(r.intensity,t.intensity),r.specularStrength=t.specularStrength,r.environmentStrength=t.environmentStrength,r.castShadows=t.castShadows,s=!0):t instanceof o.Qx||t instanceof o._y?a.push(t):t instanceof o.$p?l.push(t):t instanceof o.e_&&u.push(t);p(a,i),f(l,i);for(const e of u)c(i.r,e.r),c(i.g,e.g),c(i.b,e.b)})(e,this._shOrder,this._mainLight,this._sphericalHarmonics),(0,n.c)(this._legacy.direction,this._mainLight.direction);const t=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*t,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*t,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*t,(0,n.j)(this._legacy.diffuse.color,this._mainLight.intensity,t),(0,n.c)(C,this._legacy.diffuse.color),(0,n.j)(C,C,T*this.globalFactor),(0,n.g)(this._legacy.ambient.color,this._legacy.ambient.color,C)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),(0,n.c)(this._mainLight.direction,e.mainLight.direction),(0,n.c)(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,t,r){if((0,n.o)(this._mainLight.intensity,e.mainLight.intensity,t.mainLight.intensity,r),this._mainLight.environmentStrength=(0,i.Cc)(e.mainLight.environmentStrength,t.mainLight.environmentStrength,r),this._mainLight.specularStrength=(0,i.Cc)(e.mainLight.specularStrength,t.mainLight.specularStrength,r),(0,n.c)(this._mainLight.direction,t.mainLight.direction),this._mainLight.castShadows=t.mainLight.castShadows,this.globalFactor=(0,i.Cc)(e.globalFactor,t.globalFactor,r),this.noonFactor=(0,i.Cc)(e.noonFactor,t.noonFactor,r),e.sh.r.length===t.sh.r.length)for(let n=0;n<t.sh.r.length;n++)this._sphericalHarmonics.r[n]=(0,i.Cc)(e.sh.r[n],t.sh.r[n],r),this._sphericalHarmonics.g[n]=(0,i.Cc)(e.sh.g[n],t.sh.g[n],r),this._sphericalHarmonics.b[n]=(0,i.Cc)(e.sh.b[n],t.sh.b[n],r);else for(let e=0;e<t.sh.r.length;e++)this._sphericalHarmonics.r[e]=t.sh.r[e],this._sphericalHarmonics.g[e]=t.sh.g[e],this._sphericalHarmonics.b[e]=t.sh.b[e]}}const C=(0,s.vt)()},48042:function(e,t,r){r.d(t,{v:function(){return P}});var i=r(58941),n=r(41546),s=r(65856),o=r(27264),a=r(54407),l=r(4875),c=r(46921),u=r(29165),h=r(65839),d=r(84264),p=r(27291),f=r(77971),m=r(34615),g=r(22542),y=r(40502),_=r(54101),v=r(6200),b=r(55890),x=r(38474),S=r(85456),w=r(57087);f.S;class T extends g.w{initializeProgram(e){return new _.B(e.rctx,T.shader.get().build(this.configuration),y.D)}_createPipeline(e,t){const r=this.configuration,i=e===b.y.NONE,n=e===b.y.FrontFace;return(0,w.Ey)({blending:r.output===o.V.Color&&r.transparent?i?c.V0:(0,c.ez)(e):null,culling:(0,w.Xt)(r.cullFace),depthTest:r.draped?null:{func:(0,c.K_)(e)},depthWrite:r.draped?null:(i||n)&&r.writeDepth?w.kn:null,drawBuffers:r.output===o.V.Depth?{buffers:[S.Hr.NONE]}:(0,c.cl)(e),colorWrite:w.wE,stencilWrite:r.hasOccludees?v.v0:null,stencilTest:r.hasOccludees?t?v.a9:v.qh:null,polygonOffset:i||n?r.polygonOffset?A:null:(0,c.aB)(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}T.shader=new m.$(x.C,(()=>r.e(2523).then(r.bind(r,62970))));const A={factor:1,units:1};var C=r(53804),E=r(8610),M=r(46121);class R extends M.E{constructor(){super(...arguments),this.output=o.V.Color,this.cullFace=a.s2.None,this.transparencyPassType=b.y.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1,this.draped=!1}}(0,C._)([(0,E.W)({count:o.V.COUNT})],R.prototype,"output",void 0),(0,C._)([(0,E.W)({count:a.s2.COUNT})],R.prototype,"cullFace",void 0),(0,C._)([(0,E.W)({count:b.y.COUNT})],R.prototype,"transparencyPassType",void 0),(0,C._)([(0,E.W)()],R.prototype,"hasSlicePlane",void 0),(0,C._)([(0,E.W)()],R.prototype,"hasVertexColors",void 0),(0,C._)([(0,E.W)()],R.prototype,"transparent",void 0),(0,C._)([(0,E.W)()],R.prototype,"polygonOffset",void 0),(0,C._)([(0,E.W)()],R.prototype,"enableOffset",void 0),(0,C._)([(0,E.W)()],R.prototype,"writeDepth",void 0),(0,C._)([(0,E.W)()],R.prototype,"hasOccludees",void 0),(0,C._)([(0,E.W)()],R.prototype,"multipassEnabled",void 0),(0,C._)([(0,E.W)()],R.prototype,"cullAboveGround",void 0),(0,C._)([(0,E.W)()],R.prototype,"objectAndLayerIdColorInstanced",void 0),(0,C._)([(0,E.W)()],R.prototype,"vvColor",void 0),(0,C._)([(0,E.W)()],R.prototype,"draped",void 0),(0,C._)([(0,E.W)({constValue:!1})],R.prototype,"occlusionPass",void 0),(0,C._)([(0,E.W)({constValue:!0})],R.prototype,"hasVvInstancing",void 0),(0,C._)([(0,E.W)({constValue:!1})],R.prototype,"vvSize",void 0),(0,C._)([(0,E.W)({constValue:!1})],R.prototype,"vvOpacity",void 0);class P extends p.W{constructor(e){super(e,new I),this.supportsEdges=!0,this.produces=new Map([[u.N.OPAQUE_MATERIAL,e=>e===o.V.Highlight||(0,o.zW)(e)&&!this._isTransparent],[u.N.OPAQUE_NO_SSAO_DEPTH,e=>(0,o.eh)(e)&&this.parameters.writeLinearDepth&&!this._isTransparent],[u.N.TRANSPARENT_MATERIAL,e=>(0,o.zW)(e)&&this._isTransparent&&this.parameters.writeDepth],[u.N.TRANSPARENT_NO_SSAO_DEPTH,e=>(0,o.eh)(e)&&this.parameters.writeLinearDepth&&this._isTransparent&&this.parameters.writeDepth],[u.N.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,e=>((0,o.zW)(e)||(0,o.eh)(e)&&this.parameters.writeLinearDepth)&&this._isTransparent&&!this.parameters.writeDepth],[u.N.DRAPED_MATERIAL,e=>(0,o.i3)(e)]]),this._configuration=new R}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<c.xt,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}createGLMaterial(e){return new O(e)}createBufferWriter(){const e=(0,s.BP)().vec3f(h.r.POSITION);return(0,i.A)("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(h.r.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(h.r.COLORFEATUREATTRIBUTE):e.vec4u8(h.r.COLOR),new d.Z(e)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}}class O extends l.A{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===o.V.Color&&this._updateOccludeeState(e),this.ensureTechnique(T,e)}}class I extends f.S{constructor(){super(...arguments),this.color=n.uY,this.forceTransparentMode=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=a.s2.None,this.hasOccludees=!1,this.draped=!1}}},84264:function(e,t,r){r.d(t,{Z:function(){return s}});var i=r(65839),n=r(93678);class s{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.attributes.get(i.r.POSITION).indices.length}write(e,t,r,i,s){(0,n.SA)(r,this.vertexBufferLayout,e,t,i,s)}}},73318:function(e,t,r){r.d(t,{Ci:function(){return s},Dq:function(){return l},dB:function(){return a},zK:function(){return o}});var i=r(65856),n=r(65839);const s=(0,i.BP)().vec3f(n.r.POSITION),o=(0,i.BP)().vec3f(n.r.POSITION).vec2f(n.r.UV0),a=(0,i.BP)().vec3f(n.r.POSITION).vec4u8(n.r.COLOR),l=(0,i.BP)().vec3f(n.r.POSITION).vec2f(n.r.UV0).vec4u8(n.r.OBJECTANDLAYERIDCOLOR)},42674:function(e,t,r){r.d(t,{$U:function(){return I}});var i=r(58941),n=r(20551),s=r(32501),o=r(65420),a=r(65856),l=r(27264),c=r(11377),u=r(50865),h=r(11520),d=r(54407),p=r(36634),f=r(24100),m=r(46921),g=r(45079),y=r(29165),_=r(65839),v=r(22323),b=r(84264),x=r(84887),S=r(77032),w=r(53804),T=r(2457),A=r(8610),C=r(55890),E=r(46121);class M extends E.E{constructor(){super(...arguments),this.output=l.V.Color,this.alphaDiscardMode=d.sf.Opaque,this.doubleSidedMode=u.W.None,this.pbrMode=h.A9.Disabled,this.cullFace=d.s2.None,this.transparencyPassType=C.y.NONE,this.normalType=c.W.Attribute,this.textureCoordinateType=T.q.None,this.customDepthTest=d.it.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}}(0,w._)([(0,A.W)({count:l.V.COUNT})],M.prototype,"output",void 0),(0,w._)([(0,A.W)({count:d.sf.COUNT})],M.prototype,"alphaDiscardMode",void 0),(0,w._)([(0,A.W)({count:u.W.COUNT})],M.prototype,"doubleSidedMode",void 0),(0,w._)([(0,A.W)({count:h.A9.COUNT})],M.prototype,"pbrMode",void 0),(0,w._)([(0,A.W)({count:d.s2.COUNT})],M.prototype,"cullFace",void 0),(0,w._)([(0,A.W)({count:C.y.COUNT})],M.prototype,"transparencyPassType",void 0),(0,w._)([(0,A.W)({count:c.W.COUNT})],M.prototype,"normalType",void 0),(0,w._)([(0,A.W)({count:T.q.COUNT})],M.prototype,"textureCoordinateType",void 0),(0,w._)([(0,A.W)({count:d.it.COUNT})],M.prototype,"customDepthTest",void 0),(0,w._)([(0,A.W)()],M.prototype,"spherical",void 0),(0,w._)([(0,A.W)()],M.prototype,"hasVertexColors",void 0),(0,w._)([(0,A.W)()],M.prototype,"hasSymbolColors",void 0),(0,w._)([(0,A.W)()],M.prototype,"hasVerticalOffset",void 0),(0,w._)([(0,A.W)()],M.prototype,"hasSlicePlane",void 0),(0,w._)([(0,A.W)()],M.prototype,"hasSliceHighlight",void 0),(0,w._)([(0,A.W)()],M.prototype,"hasColorTexture",void 0),(0,w._)([(0,A.W)()],M.prototype,"hasMetallicRoughnessTexture",void 0),(0,w._)([(0,A.W)()],M.prototype,"hasEmissionTexture",void 0),(0,w._)([(0,A.W)()],M.prototype,"hasOcclusionTexture",void 0),(0,w._)([(0,A.W)()],M.prototype,"hasNormalTexture",void 0),(0,w._)([(0,A.W)()],M.prototype,"hasScreenSizePerspective",void 0),(0,w._)([(0,A.W)()],M.prototype,"hasVertexTangents",void 0),(0,w._)([(0,A.W)()],M.prototype,"hasOccludees",void 0),(0,w._)([(0,A.W)()],M.prototype,"multipassEnabled",void 0),(0,w._)([(0,A.W)()],M.prototype,"hasModelTransformation",void 0),(0,w._)([(0,A.W)()],M.prototype,"offsetBackfaces",void 0),(0,w._)([(0,A.W)()],M.prototype,"vvSize",void 0),(0,w._)([(0,A.W)()],M.prototype,"vvColor",void 0),(0,w._)([(0,A.W)()],M.prototype,"receiveShadows",void 0),(0,w._)([(0,A.W)()],M.prototype,"receiveAmbientOcclusion",void 0),(0,w._)([(0,A.W)()],M.prototype,"textureAlphaPremultiplied",void 0),(0,w._)([(0,A.W)()],M.prototype,"instanced",void 0),(0,w._)([(0,A.W)()],M.prototype,"instancedColor",void 0),(0,w._)([(0,A.W)()],M.prototype,"objectAndLayerIdColorInstanced",void 0),(0,w._)([(0,A.W)()],M.prototype,"instancedDoublePrecision",void 0),(0,w._)([(0,A.W)()],M.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,w._)([(0,A.W)()],M.prototype,"writeDepth",void 0),(0,w._)([(0,A.W)()],M.prototype,"transparent",void 0),(0,w._)([(0,A.W)()],M.prototype,"enableOffset",void 0),(0,w._)([(0,A.W)()],M.prototype,"cullAboveGround",void 0),(0,w._)([(0,A.W)()],M.prototype,"snowCover",void 0),(0,w._)([(0,A.W)()],M.prototype,"hasColorTextureTransform",void 0),(0,w._)([(0,A.W)()],M.prototype,"hasEmissionTextureTransform",void 0),(0,w._)([(0,A.W)()],M.prototype,"hasNormalTextureTransform",void 0),(0,w._)([(0,A.W)()],M.prototype,"hasOcclusionTextureTransform",void 0),(0,w._)([(0,A.W)()],M.prototype,"hasMetallicRoughnessTextureTransform",void 0),(0,w._)([(0,A.W)({constValue:!1})],M.prototype,"occlusionPass",void 0),(0,w._)([(0,A.W)({constValue:!0})],M.prototype,"hasVvInstancing",void 0),(0,w._)([(0,A.W)({constValue:!1})],M.prototype,"useCustomDTRExponentForWater",void 0),(0,w._)([(0,A.W)({constValue:!1})],M.prototype,"supportsTextureAtlas",void 0),(0,w._)([(0,A.W)({constValue:!0})],M.prototype,"useFillLights",void 0);var R=r(34615),P=r(93776);class O extends S.R5{initializeConfiguration(e,t){super.initializeConfiguration(e,t),t.hasMetallicRoughnessTexture=!1,t.hasEmissionTexture=!1,t.hasOcclusionTexture=!1,t.hasNormalTexture=!1,t.hasModelTransformation=!1,t.normalType=c.W.Attribute,t.doubleSidedMode=u.W.WindingOrder,t.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,O.shader)}}O.shader=new R.$(P.R,(()=>r.e(5873).then(r.bind(r,90912))));class I extends f.im{constructor(e){super(e,D),this.supportsEdges=!0,this.produces=new Map([[y.N.OPAQUE_MATERIAL,e=>((0,l.XY)(e)||(0,l.PJ)(e))&&!this.parameters.transparent],[y.N.TRANSPARENT_MATERIAL,e=>((0,l.XY)(e)||(0,l.PJ)(e))&&this.parameters.transparent&&this.parameters.writeDepth],[y.N.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,e=>((0,l.XY)(e)||(0,l.PJ)(e))&&this.parameters.transparent&&!this.parameters.writeDepth]]),this._configuration=new M,this._vertexBufferLayout=function(e){const t=(0,a.BP)().vec3f(_.r.POSITION);return e.normalType===c.W.Compressed?t.vec2i16(_.r.NORMALCOMPRESSED,{glNormalized:!0}):t.vec3f(_.r.NORMAL),e.hasVertexTangents&&t.vec4f(_.r.TANGENT),(e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId)&&t.vec2f(_.r.UV0),e.hasVertexColors&&t.vec4u8(_.r.COLOR),e.hasSymbolColors&&t.vec4u8(_.r.SYMBOLCOLOR),(0,i.A)("enable-feature:objectAndLayerId-rendering")&&t.vec4u8(_.r.OBJECTANDLAYERIDCOLOR),t}(this.parameters)}isVisibleForOutput(e){return e!==l.V.Shadow&&e!==l.V.ShadowExcludeHighlight&&e!==l.V.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||0===e.layerOpacity)return!1;const{hasInstancedColor:t,hasVertexColors:r,hasSymbolColors:i,vvColor:n}=e,s="replace"===e.colorMixMode,o=e.opacity>0,a=e.externalColor&&e.externalColor[3]>0,l=t||n||i;return r&&l?s||o:r?s?a:o:l?s||o:s?a:o}getConfiguration(e,t){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=this.parameters.isInstanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.hasVerticalOffset=null!=this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=null!=this.parameters.screenSizePerspective,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,null!=this.parameters.customDepthTest&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?d.s2.None:this.parameters.cullFace,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=null!=this.parameters.modelTransformation,e===l.V.Color&&(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=u.W.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?u.W.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?u.W.WindingOrder:u.W.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=this.parameters.receiveAmbientOcclusion&&null!=t.ssao,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?h.A9.Schematic:h.A9.Normal:h.A9.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<m.xt,this._configuration.snowCover=this.hasSnowCover(t),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return null!=e.weather&&e.weatherVisible&&"snowy"===e.weather.type&&"enabled"===e.weather.snowCover}intersect(e,t,r,i,s,a){if(null!=this.parameters.verticalOffset){const e=r.camera;(0,n.s)(B,t[12],t[13],t[14]);let a=null;switch(r.viewingMode){case o.RT.Global:a=(0,n.n)(U,B);break;case o.RT.Local:a=(0,n.c)(U,V)}let l=0;const c=(0,n.f)(H,B,e.eye),u=(0,n.l)(c),h=(0,n.j)(c,c,1/u);let d=null;this.parameters.screenSizePerspective&&(d=(0,n.m)(a,h)),l+=(0,x.kE)(e,u,this.parameters.verticalOffset,d??0,this.parameters.screenSizePerspective),(0,n.j)(a,a,l),(0,n.t)(G,a,r.transform.inverseRotation),i=(0,n.f)(F,i,G),s=(0,n.f)(z,s,G)}(0,g.Uy)(e,r,i,s,(0,v.ou)(r.verticalOffset),a)}createGLMaterial(e){return new L(e)}createBufferWriter(){return new b.Z(this._vertexBufferLayout)}}class L extends p.m{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===l.V.Color&&(this._updateShadowState(e),this._updateOccludeeState(e));const t=this._material.parameters;this.updateTexture(t.textureId);const r=e.camera.viewInverseTransposeMatrix;return(0,n.s)(t.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(t.treeRendering?O:S.R5,e)}}class N extends S.uD{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}}const D=new N,F=(0,s.vt)(),z=(0,s.vt)(),V=(0,s.fA)(0,0,1),U=(0,s.vt)(),G=(0,s.vt)(),B=(0,s.vt)(),H=(0,s.vt)()},12474:function(e,t,r){r.d(t,{T:function(){return i}});const i=2.1},46121:function(e,t,r){r.d(t,{E:function(){return a}});var i=r(53804),n=r(14812),s=r(54516),o=r(8610);class a extends n.nW{}(0,i._)([(0,o.W)({constValue:!0})],a.prototype,"hasSliceHighlight",void 0),(0,i._)([(0,o.W)({constValue:!1})],a.prototype,"hasSliceInVertexProgram",void 0),(0,i._)([(0,o.W)({constValue:s.c.Pass})],a.prototype,"pbrTextureBindType",void 0)},6955:function(e,t,r){r.d(t,{R:function(){return q}});var i=r(58941),n=r(15774),s=r(44705),o=r(87725),a=r(73364),l=r(39714),c=r(1932),u=r(20551),h=r(32501),d=r(41546);var p=r(87416),f=r(92754),m=r(24129),g=r(70974),y=r(65856),_=r(27264),v=r(1143),b=r(36634),x=r(24100),S=r(29165),w=r(54035),T=r(90553),A=r(65839);class C{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}}var E=r(93678),M=r(84887),R=r(88008),P=r(65420),O=r(34615),I=r(22542),L=r(40502),N=r(46921),D=r(54101),F=r(55890),z=r(85456),V=r(57087);class U extends I.w{initializeConfiguration(e,t){t.spherical=e.viewingMode===P.RT.Global}initializeProgram(e){return new D.B(e.rctx,U.shader.get().build(this.configuration),L.D)}initializePipeline(){const e=this.configuration.transparencyPassType,t=this.configuration,r=e===F.y.NONE,i=e===F.y.FrontFace,n=this.configuration.hasPolygonOffset?G:null,s=t.draped?null:(r||i)&&t.output!==_.V.Highlight&&(t.depthEnabled||t.occlusionPass)?V.kn:null;return(0,V.Ey)({blending:t.output===_.V.Color||t.output===_.V.Highlight?r?B:(0,N.ez)(e):null,depthTest:t.draped?null:{func:z.MT.LEQUAL},depthWrite:s,drawBuffers:(0,N.cl)(e),colorWrite:V.wE,polygonOffset:n})}get primitiveType(){return this.configuration.occlusionPass?z.WR.POINTS:z.WR.TRIANGLES}}U.shader=new O.$(R.H,(()=>r.e(8121).then(r.bind(r,47416))));const G={factor:0,units:-4},B=(0,V.ox)(z.dn.ONE,z.dn.ONE_MINUS_SRC_ALPHA);var H=r(53804),k=r(8610),j=r(46121);class W extends j.E{constructor(){super(...arguments),this.output=_.V.Color,this.transparencyPassType=F.y.NONE,this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}}(0,H._)([(0,k.W)({count:_.V.COUNT})],W.prototype,"output",void 0),(0,H._)([(0,k.W)({count:F.y.COUNT})],W.prototype,"transparencyPassType",void 0),(0,H._)([(0,k.W)()],W.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,H._)([(0,k.W)()],W.prototype,"spherical",void 0),(0,H._)([(0,k.W)()],W.prototype,"occlusionTestEnabled",void 0),(0,H._)([(0,k.W)()],W.prototype,"signedDistanceFieldEnabled",void 0),(0,H._)([(0,k.W)()],W.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),(0,H._)([(0,k.W)()],W.prototype,"vvSize",void 0),(0,H._)([(0,k.W)()],W.prototype,"vvColor",void 0),(0,H._)([(0,k.W)()],W.prototype,"hasVerticalOffset",void 0),(0,H._)([(0,k.W)()],W.prototype,"hasScreenSizePerspective",void 0),(0,H._)([(0,k.W)()],W.prototype,"debugDrawLabelBorder",void 0),(0,H._)([(0,k.W)()],W.prototype,"hasSlicePlane",void 0),(0,H._)([(0,k.W)()],W.prototype,"hasPolygonOffset",void 0),(0,H._)([(0,k.W)()],W.prototype,"depthEnabled",void 0),(0,H._)([(0,k.W)()],W.prototype,"pixelSnappingEnabled",void 0),(0,H._)([(0,k.W)()],W.prototype,"draped",void 0),(0,H._)([(0,k.W)()],W.prototype,"multipassEnabled",void 0),(0,H._)([(0,k.W)()],W.prototype,"cullAboveGround",void 0),(0,H._)([(0,k.W)()],W.prototype,"occlusionPass",void 0),(0,H._)([(0,k.W)()],W.prototype,"objectAndLayerIdColorInstanced",void 0),(0,H._)([(0,k.W)({constValue:!0})],W.prototype,"hasSliceInVertexProgram",void 0),(0,H._)([(0,k.W)({constValue:!1})],W.prototype,"hasVvInstancing",void 0);class q extends x.im{constructor(e){super(e,new pe),this._configuration=new W,this.produces=new Map([[S.N.HUD_MATERIAL,e=>(0,_.dX)(e)&&!this.parameters.drawInSecondSlot],[S.N.LABEL_MATERIAL,e=>(0,_.dX)(e)&&this.parameters.drawInSecondSlot],[S.N.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[S.N.DRAPED_MATERIAL,e=>(0,_.dX)(e)]])}getConfiguration(e,t){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.draped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=t.slot===S.N.OCCLUSION_PIXELS&&this.parameters.occlusionTest,e===_.V.Color&&(this._configuration.debugDrawLabelBorder=!!g.b.LABELS_SHOW_BORDER),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,t,r,i,n,o){if(!(r.options.selectionMode&&r.options.hud&&e.visible&&r.point))return;const l=this.parameters,c=r.point,d=r.camera;let{scaleX:p,scaleY:f}=this._getScreenScale(e);p*=d.pixelRatio,f*=d.pixelRatio,(0,s.z0)(re,t),e.attributes.has(A.r.FEATUREATTRIBUTE)&&function(e){const t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=1/Math.sqrt(t*t+r*r+i*i),h=1/Math.sqrt(n*n+s*s+o*o),d=1/Math.sqrt(a*a+l*l+c*c);e[0]=t*u,e[1]=r*u,e[2]=i*u,e[3]=n*h,e[4]=s*h,e[5]=o*h,e[6]=a*d,e[7]=l*d,e[8]=c*d}(re);const m=e.attributes.get(A.r.POSITION),g=e.attributes.get(A.r.SIZE),y=e.attributes.get(A.r.NORMAL),_=e.attributes.get(A.r.CENTEROFFSETANDDISTANCE);(0,T.vA)(m.size>=3);const v=(0,R.c)(l),b="screen"===this.parameters.centerOffsetUnits;for(let e=0;e<m.data.length/m.size;e++){const i=e*m.size;(0,u.s)(J,m.data[i],m.data[i+1],m.data[i+2]),(0,u.h)(J,J,t);const n=e*g.size;he[0]=g.data[n]*p,he[1]=g.data[n+1]*f,(0,u.h)(J,J,d.viewMatrix);const s=e*_.size;if((0,u.s)(se,_.data[s],_.data[s+1],_.data[s+2]),!b&&(J[0]+=se[0],J[1]+=se[1],0!==se[2])){const e=se[2];(0,u.n)(se,J),(0,u.f)(J,J,(0,u.j)(se,se,e))}const x=e*y.size;if((0,u.s)(Q,y.data[x],y.data[x+1],y.data[x+2]),$(Q,re,d,le),this._applyVerticalOffsetTransformationView(J,le,d,X),d.applyProjection(J,K),K[0]>-1){b&&(se[0]||se[1])&&(K[0]+=se[0]*d.pixelRatio,0!==se[1]&&(K[1]+=(0,w.m0)(se[1],X.factorAlignment)*d.pixelRatio),d.unapplyProjection(K,J)),K[0]+=this.parameters.screenOffset[0]*d.pixelRatio,K[1]+=this.parameters.screenOffset[1]*d.pixelRatio,K[0]=Math.floor(K[0]),K[1]=Math.floor(K[1]),(0,w.MD)(he,X.factor,he);const e=ce*d.pixelRatio;let t=0;if(l.textureIsSignedDistanceField&&(t=l.outlineSize*d.pixelRatio/2),Y(c,K[0],K[1],he,e,t,l,v)){const e=r.ray;if((0,u.h)(te,J,(0,a.B8)(ne,d.viewMatrix)),K[0]=c[0],K[1]=c[1],d.unprojectFromRenderScreen(K,J)){const t=(0,h.vt)();(0,u.c)(t,e.direction);const r=1/(0,u.l)(t);(0,u.j)(t,t,r),o((0,u.p)(e.origin,J)*r,t,-1,!0,1,te)}}}}}intersectDraped(e,t,r,i,n,s){const o=e.attributes.get(A.r.POSITION),a=e.attributes.get(A.r.SIZE),l=this.parameters,c=(0,R.c)(l);let{scaleX:u,scaleY:h}=this._getScreenScale(e);u*=e.screenToWorldRatio,h*=e.screenToWorldRatio;const d=ue*e.screenToWorldRatio;for(let t=0;t<o.data.length/o.size;t++){const r=t*o.size,p=o.data[r],f=o.data[r+1],m=t*a.size;he[0]=a.data[m]*u,he[1]=a.data[m+1]*h;let g=0;l.textureIsSignedDistanceField&&(g=l.outlineSize*e.screenToWorldRatio/2),Y(i,p,f,he,d,g,l,c)&&n(s.dist,s.normal,-1,!1)}}createBufferWriter(){return new ge(this)}_updateScaleInfo(e,t,r){const i=this.parameters;null!=i.screenSizePerspective?(0,w.cJ)(r,t,i.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),null!=i.screenSizePerspectiveAlignment?(0,w.cJ)(r,t,i.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,t,r,i,n,s,o){const a=$(t,r,n,le);return this._applyVerticalGroundOffsetView(e,a,n,o),this._applyVerticalOffsetTransformationView(o,a,n,s),this._applyPolygonOffsetView(o,a,i[3],n,o),this._applyCenterOffsetView(o,i,o),o}applyShaderOffsetsNDC(e,t,r,i,n){return this._applyCenterOffsetNDC(e,t,r,i),null!=n&&(0,u.c)(n,i),this._applyPolygonOffsetNDC(i,t,r,i),i}_applyPolygonOffsetView(e,t,r,i,s){const o=i.aboveGround?1:-1;let a=Math.sign(r);0===a&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return(0,u.c)(s,e);const c=(0,n.qE)(Math.abs(t.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/i.viewport[2];return(0,u.j)(s,e,l>0?h:1/h),s}_applyVerticalGroundOffsetView(e,t,r,i){const n=(0,u.l)(e),s=r.aboveGround?1:-1,o=r.computeRenderPixelSizeAtDist(n)*v.R,a=(0,u.j)(J,t.normal,s*o);return(0,u.g)(i,e,a),i}_applyVerticalOffsetTransformationView(e,t,r,i){const n=this.parameters;if(!n.verticalOffset?.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const r=(0,u.l)(e);this._updateScaleInfo(i,r,t.cosAngle)}else i.factor.scale=1,i.factorAlignment.scale=1;return e}const s=(0,u.l)(e),o=n.screenSizePerspectiveAlignment??n.screenSizePerspective,a=(0,M.kE)(r,s,n.verticalOffset,t.cosAngle,o);return this._updateScaleInfo(i,s,t.cosAngle),(0,u.j)(t.normal,t.normal,a),(0,u.g)(e,e,t.normal)}_applyCenterOffsetView(e,t,r){const i="screen"!==this.parameters.centerOffsetUnits;return r!==e&&(0,u.c)(r,e),i&&(r[0]+=t[0],r[1]+=t[1],t[2]&&((0,u.n)(Q,r),(0,u.g)(r,r,(0,u.j)(Q,Q,t[2])))),r}_applyCenterOffsetNDC(e,t,r,i){const n="screen"!==this.parameters.centerOffsetUnits;return i!==e&&(0,u.c)(i,e),n||(i[0]+=t[0]/r.fullWidth*2,i[1]+=t[1]/r.fullHeight*2),i}_applyPolygonOffsetNDC(e,t,r,i){const n=this.parameters.shaderPolygonOffset;if(e!==i&&(0,u.c)(i,e),n){const e=r.aboveGround?1:-1,s=e*Math.sign(t[3]);i[2]-=(s||e)*n}return i}createGLMaterial(e){return new Z(e)}calculateRelativeScreenBounds(e,t,r=(0,p.vt)()){return function(e,t,r,i){i[0]=e.anchorPosition[0]*-t[0]+e.screenOffset[0]*r,i[1]=e.anchorPosition[1]*-t[1]+e.screenOffset[1]*r}(this.parameters,e,t,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}_getScreenScale(e){const t=e.attributes.get(A.r.FEATUREATTRIBUTE);if(null==t)return{scaleX:1,scaleY:1};const r=(0,d.ci)(t.data,ae),[i,n]=(0,m.VC)(oe,this.parameters,r);return{scaleX:i,scaleY:n}}}class Z extends b.m{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(U,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}}function $(e,t,r,i){return function(e){return(t=e)instanceof Float32Array&&t.length>=16||function(e){return Array.isArray(e)&&e.length>=16}(e);var t}(t)&&(t=(0,s.z0)(ie,t)),(0,u.t)(i.normal,e,t),(0,u.h)(i.normal,i.normal,r.viewInverseTransposeMatrix),i.cosAngle=(0,u.m)(ee,de),i}function Y(e,t,r,i,n,s,o,a){let l=t-n-(a[0]>0?i[0]*a[0]:0),c=l+i[0]+2*n,u=r-n-(a[1]>0?i[1]*a[1]:0),h=u+i[1]+2*n;const d=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&null!=d&&(l+=i[0]*d[0],u+=i[1]*d[1],c-=i[0]*(1-d[2]),h-=i[1]*(1-d[3]),l-=s,c+=s,u-=s,h+=s),e[0]>l&&e[0]<c&&e[1]>u&&e[1]<h}const X=new class{constructor(){this.factor=new C,this.factorAlignment=new C}},J=(0,h.vt)(),Q=(0,h.vt)(),K=(0,d.vt)(),ee=(0,h.vt)(),te=(0,h.vt)(),re=(0,o.vt)(),ie=(0,o.vt)(),ne=(0,l.vt)(),se=(0,h.vt)(),oe=(0,h.vt)(),ae=(0,d.vt)(),le={normal:ee,cosAngle:0},ce=1,ue=2,he=[0,0],de=(0,h.fA)(0,0,1);class pe extends b.N{constructor(){super(...arguments),this.renderOccluded=x.m$.Occlude,this.isDecoration=!1,this.color=(0,d.fA)(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=(0,c.fA)(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=(0,d.fA)(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.draped=!1}}const fe=(0,y.BP)().vec3f(A.r.POSITION).vec3f(A.r.NORMAL).vec2f(A.r.UV0).vec4u8(A.r.COLOR).vec2f(A.r.SIZE).vec4f(A.r.CENTEROFFSETANDDISTANCE).vec4f(A.r.FEATUREATTRIBUTE),me=fe.clone().vec4u8(A.r.OBJECTANDLAYERIDCOLOR);class ge{constructor(e){this._material=e,this.vertexBufferLayout=(0,i.A)("enable-feature:objectAndLayerId-rendering")?me:fe}elementCount(e){return 6*e.attributes.get(A.r.POSITION).indices.length}write(e,t,r,i,n){(0,E.Hk)(r.attributes.get(A.r.POSITION),e,i.position,n,6),(0,E.p1)(r.attributes.get(A.r.NORMAL),t,i.normal,n,6);const s=r.attributes.get(A.r.UV0).data;let o,a,l,c;if(null==s||s.length<4){const e=this._material.parameters;o=0,a=0,l=e.texCoordScale[0],c=e.texCoordScale[1]}else o=s[0],a=s[1],l=s[2],c=s[3];l=Math.min(1.99999,l+1),c=Math.min(1.99999,c+1);let u=r.attributes.get(A.r.POSITION).indices.length,h=n;const d=i.uv0;for(let e=0;e<u;++e)d.set(h,0,o),d.set(h,1,a),h++,d.set(h,0,l),d.set(h,1,a),h++,d.set(h,0,l),d.set(h,1,c),h++,d.set(h,0,l),d.set(h,1,c),h++,d.set(h,0,o),d.set(h,1,c),h++,d.set(h,0,o),d.set(h,1,a),h++;(0,E.tb)(r.attributes.get(A.r.COLOR),4,i.color,n,6);const{data:p,indices:m}=r.attributes.get(A.r.SIZE);u=m.length;const g=i.size;h=n;for(let e=0;e<u;++e){const t=p[2*m[e]],r=p[2*m[e]+1];for(let e=0;e<6;++e)g.set(h,0,t),g.set(h,1,r),h++}if(r.attributes.get(A.r.CENTEROFFSETANDDISTANCE)?(0,E.Ut)(r.attributes.get(A.r.CENTEROFFSETANDDISTANCE),i.centerOffsetAndDistance,n,6):(0,E.Pq)(i.centerOffsetAndDistance,n,6*u),r.attributes.get(A.r.FEATUREATTRIBUTE)?(0,E.Ut)(r.attributes.get(A.r.FEATUREATTRIBUTE),i.featureAttribute,n,6):(0,E.Pq)(i.featureAttribute,n,6*u),null!=r.objectAndLayerIdColor){const e=r.attributes.get(A.r.POSITION)?.indices;if(e){const t=e.length,s=i.getField(A.r.OBJECTANDLAYERIDCOLOR,f.XP);(0,E.tH)(r.objectAndLayerIdColor,s,t,n,6)}}}}},67721:function(e,t,r){var i;r.d(t,{O:function(){return i}}),function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Cross=2]="Cross",e[e.ForwardDiagonal=3]="ForwardDiagonal",e[e.BackwardDiagonal=4]="BackwardDiagonal",e[e.DiagonalCross=5]="DiagonalCross",e[e.COUNT=6]="COUNT"}(i||(i={}))},65352:function(e,t,r){r.d(t,{W:function(){return V}});var i=r(58941),n=r(40633),s=r(15774),o=r(13520),a=r(13786),l=r(20551),c=r(32501),u=r(41546),h=r(69508),d=r(73313),p=r(5596),f=r(65856),m=r(27264),g=r(4875),y=r(24100),_=r(29165),v=r(90553),b=r(65839),x=r(77971),S=r(50678),w=r(35904),T=r(34615),A=r(22542),C=r(46921),E=r(54101),M=r(6200),R=r(55890),P=r(85456),O=r(57087);const I=new Map([[b.r.POSITION,0],[b.r.PREVPOSITION,1],[b.r.NEXTPOSITION,2],[b.r.SUBDIVISIONFACTOR,3],[b.r.UV0,4],[b.r.COLOR,5],[b.r.COLORFEATUREATTRIBUTE,5],[b.r.SIZE,6],[b.r.SIZEFEATUREATTRIBUTE,6],[b.r.OPACITYFEATUREATTRIBUTE,7],[b.r.OBJECTANDLAYERIDCOLOR,8]]);class L extends A.w{initializeProgram(e){return new E.B(e.rctx,L.shader.get().build(this.configuration),I)}_makePipelineState(e,t){const r=this.configuration,i=e===R.y.NONE,n=e===R.y.FrontFace,s=(0,m.cb)(r.output);return(0,O.Ey)({blending:r.output===m.V.Color?i?C.V0:(0,C.ez)(e):null,depthTest:{func:(0,C.K_)(e)},depthWrite:i?r.writeDepth||s?O.kn:null:(0,C.XO)(e),drawBuffers:r.output===m.V.Depth?{buffers:[P.Hr.NONE]}:(0,C.cl)(e),colorWrite:O.wE,stencilWrite:r.hasOccludees?M.v0:null,stencilTest:r.hasOccludees?t?M.a9:M.qh:null,polygonOffset:i||n?r.hasPolygonOffset?N:null:C.SE})}initializePipeline(){const e=this.configuration;if(e.occluder){const t=e.hasPolygonOffset?N:null;this._occluderPipelineTransparent=(0,O.Ey)({blending:C.V0,polygonOffset:t,depthTest:M.sf,depthWrite:null,colorWrite:O.wE,stencilWrite:null,stencilTest:M.mK,drawBuffers:e.output===m.V.Depth?{buffers:[P.Hr.NONE]}:null}),this._occluderPipelineOpaque=(0,O.Ey)({blending:C.V0,polygonOffset:t,depthTest:M.sf,depthWrite:null,colorWrite:O.wE,stencilWrite:M.r8,stencilTest:M.I$,drawBuffers:e.output===m.V.Depth?{buffers:[P.Hr.NONE]}:null}),this._occluderPipelineMaskWrite=(0,O.Ey)({blending:null,polygonOffset:t,depthTest:M.m,depthWrite:null,colorWrite:null,stencilWrite:M.v0,stencilTest:M.a9,drawBuffers:e.output===m.V.Depth?{buffers:[P.Hr.NONE]}:null})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?P.WR.LINES:P.WR.TRIANGLE_STRIP}getPipeline(e,t,r){return e?this._occludeePipelineState:this.configuration.occluder?r?this._occluderPipelineTransparent:t?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}}L.shader=new T.$(w.R,(()=>r.e(3569).then(r.bind(r,75312))));const N={factor:0,units:-4};var D,F,z=r(95736);(F=D||(D={}))[F.LEFT_JOIN_START=-2]="LEFT_JOIN_START",F[F.LEFT_JOIN_END=-1]="LEFT_JOIN_END",F[F.LEFT_CAP_START=-4]="LEFT_CAP_START",F[F.LEFT_CAP_END=-5]="LEFT_CAP_END",F[F.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",F[F.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",F[F.RIGHT_CAP_START=4]="RIGHT_CAP_START",F[F.RIGHT_CAP_END=5]="RIGHT_CAP_END";class V extends y.im{constructor(e){super(e,new G),this._configuration=new z.Q,this.produces=new Map([[_.N.OPAQUE_MATERIAL,e=>e===m.V.Highlight||e===m.V.ObjectAndLayerIdColor||e===m.V.Color&&this.parameters.renderOccluded===y.m$.OccludeAndTransparentStencil],[_.N.OPAQUE_NO_SSAO_DEPTH,e=>(0,m.eh)(e)],[_.N.OCCLUDER_MATERIAL,e=>(0,m.MO)(e)&&this.parameters.renderOccluded===y.m$.OccludeAndTransparentStencil],[_.N.TRANSPARENT_OCCLUDER_MATERIAL,e=>(0,m.MO)(e)&&this.parameters.renderOccluded===y.m$.OccludeAndTransparentStencil],[_.N.TRANSPARENT_MATERIAL,e=>e===m.V.Color&&this.parameters.writeDepth&&this.parameters.renderOccluded!==y.m$.OccludeAndTransparentStencil],[_.N.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,e=>e===m.V.Color&&!this.parameters.writeDepth&&this.parameters.renderOccluded!==y.m$.OccludeAndTransparentStencil],[_.N.DRAPED_MATERIAL,e=>(0,m.i3)(e)]]),this._vertexAttributeLocations=I}getConfiguration(e,t){this._configuration.output=e,this._configuration.draped=t.slot===_.N.DRAPED_MATERIAL;const r=null!=this.parameters.stipplePattern&&e!==m.V.Highlight;return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&null!=this.parameters.stippleOffColor,this._configuration.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins="round"===this.parameters.join,this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=null!=this.parameters.markerParameters&&function(e){return e.anchor===S.kJ.Tip&&e.hideOnShortSegments&&"begin-end"===e.placement&&e.worldSpace}(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&null!=this.parameters.innerColor,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===y.m$.OccludeAndTransparentStencil,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,t,r,i,n,o){if(!r.options.selectionMode)return;const a=e.attributes.get(b.r.POSITION).data,l=e.attributes.get(b.r.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const t=e.attributes.get(b.r.SIZEFEATUREATTRIBUTE).data[0];c*=(0,s.qE)(this.parameters.vvSize.offset[0]+t*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const u=i[0],h=i[1],d=(c/2+4)*e.screenToWorldRatio;let p=Number.MAX_VALUE,f=0;for(let e=0;e<a.length-5;e+=3){const t=a[e],r=a[e+1],i=u-t,n=h-r,o=a[e+3]-t,l=a[e+4]-r,c=(0,s.qE)((o*i+l*n)/(o*o+l*l),0,1),d=o*c-i,m=l*c-n,g=d*d+m*m;g<p&&(p=g,f=e/3)}p<d*d&&n(o.dist,o.normal,f,!1)}intersect(e,t,r,i,o,c){if(!r.options.selectionMode||!e.visible)return;if(!(0,v.zH)(t))return void n.A.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const u=e.attributes,f=u.get(b.r.POSITION).data;let m=this.parameters.width;if(this.parameters.vvSize){const e=u.get(b.r.SIZEFEATUREATTRIBUTE).data[0];m*=(0,s.qE)(this.parameters.vvSize.offset[0]+e*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else u.has(b.r.SIZE)&&(m*=u.get(b.r.SIZE).data[0]);const g=r.camera,y=$;(0,a.C)(y,r.point);const _=m*g.pixelRatio/2+4*g.pixelRatio;(0,l.s)(ne[0],y[0]-_,y[1]+_,0),(0,l.s)(ne[1],y[0]+_,y[1]+_,0),(0,l.s)(ne[2],y[0]+_,y[1]-_,0),(0,l.s)(ne[3],y[0]-_,y[1]-_,0);for(let e=0;e<4;e++)if(!g.unprojectFromRenderScreen(ne[e],se[e]))return;(0,p.Cr)(g.eye,se[0],se[1],oe),(0,p.Cr)(g.eye,se[1],se[2],ae),(0,p.Cr)(g.eye,se[2],se[3],le),(0,p.Cr)(g.eye,se[3],se[0],ce);let x=Number.MAX_VALUE,S=0;const w=k(this.parameters,u)?f.length-2:f.length-5;for(let e=0;e<w;e+=3){j[0]=f[e]+t[12],j[1]=f[e+1]+t[13],j[2]=f[e+2]+t[14];const r=(e+3)%f.length;if(W[0]=f[r]+t[12],W[1]=f[r+1]+t[13],W[2]=f[r+2]+t[14],(0,p.mN)(oe,j)<0&&(0,p.mN)(oe,W)<0||(0,p.mN)(ae,j)<0&&(0,p.mN)(ae,W)<0||(0,p.mN)(le,j)<0&&(0,p.mN)(le,W)<0||(0,p.mN)(ce,j)<0&&(0,p.mN)(ce,W)<0)continue;if(g.projectToRenderScreen(j,Y),g.projectToRenderScreen(W,X),Y[2]<0&&X[2]>0){(0,l.f)(q,j,W);const e=g.frustum,t=-(0,p.mN)(e[h.FB.NEAR],j)/(0,l.m)(q,(0,p.Qj)(e[h.FB.NEAR]));(0,l.j)(q,q,t),(0,l.g)(j,j,q),g.projectToRenderScreen(j,Y)}else if(Y[2]>0&&X[2]<0){(0,l.f)(q,W,j);const e=g.frustum,t=-(0,p.mN)(e[h.FB.NEAR],W)/(0,l.m)(q,(0,p.Qj)(e[h.FB.NEAR]));(0,l.j)(q,q,t),(0,l.g)(W,W,q),g.projectToRenderScreen(W,X)}else if(Y[2]<0&&X[2]<0)continue;Y[2]=0,X[2]=0;const i=(0,d.kb)((0,d.Cr)(Y,X,K),y);i<x&&(x=i,(0,l.c)(J,j),(0,l.c)(Q,W),S=e/3)}const T=r.rayBegin,A=r.rayEnd;if(x<_*_){let e=Number.MAX_VALUE;if((0,d.ld)((0,d.Cr)(J,Q,K),(0,d.Cr)(T,A,ee),Z)){(0,l.f)(Z,Z,T);const t=(0,l.l)(Z);(0,l.j)(Z,Z,1/t),e=t/(0,l.p)(T,A)}c(e,Z,S,!1)}}get _layout(){const e=(0,f.BP)().vec3f(b.r.POSITION).vec3f(b.r.PREVPOSITION).vec3f(b.r.NEXTPOSITION).f32(b.r.SUBDIVISIONFACTOR).vec2f(b.r.UV0);return this.parameters.vvSize?e.f32(b.r.SIZEFEATUREATTRIBUTE):e.f32(b.r.SIZE),this.parameters.vvColor?e.f32(b.r.COLORFEATUREATTRIBUTE):e.vec4f(b.r.COLOR),this.parameters.vvOpacity&&e.f32(b.r.OPACITYFEATUREATTRIBUTE),(0,i.A)("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(b.r.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new B(this._layout,this.parameters)}createGLMaterial(e){return new U(e)}validateParameters(e){"miter"!==e.join&&(e.miterLimit=0),null!=e.markerParameters&&(e.markerScale=e.markerParameters.width/e.width)}}class U extends g.A{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextures.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===m.V.Color&&this._updateOccludeeState(e);const t=this._material.parameters.stipplePattern;return this._stipplePattern!==t&&(this._material.setParameters({stippleTexture:this._stippleTextures.swap(t,this._stipplePattern)}),this._stipplePattern=t),this.ensureTechnique(L,e)}}class G extends x.S{constructor(){super(...arguments),this.width=0,this.color=u.Un,this.join="miter",this.cap=z.x.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}}class B{constructor(e,t){this.vertexBufferLayout=e,this._parameters=t,this.numJoinSubdivisions=0;const r=t.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=w.r+r}}_isClosed(e){return k(this._parameters,e.attributes)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const t=e.attributes.get(b.r.POSITION).indices.length/2+1,r=this._isClosed(e);let i=r?2:4;return i+=((r?t:t-1)-(r?0:1))*(2*this.numJoinSubdivisions+4),i+=2,this._parameters.wireframe&&(i=2+4*(i-2)),i}write(e,t,r,n,s){const o=te,a=re,c=ie,u=r.attributes.get(b.r.POSITION),h=u.indices,d=u.data.length/3,p=r.attributes.get(b.r.DISTANCETOSTART)?.data;h&&h.length!==2*(d-1)&&console.warn("RibbonLineMaterial does not support indices");const f=r.attributes.get(b.r.SIZEFEATUREATTRIBUTE)?.data[0]??r.attributes.get(b.r.SIZE)?.data[0]??1;let m=[1,1,1,1],g=0;const y=this.vertexBufferLayout.fields.has(b.r.COLORFEATUREATTRIBUTE);y?g=r.attributes.get(b.r.COLORFEATUREATTRIBUTE).data[0]:r.attributes.has(b.r.COLOR)&&(m=r.attributes.get(b.r.COLOR).data);const _=(0,i.A)("enable-feature:objectAndLayerId-rendering")?r.objectAndLayerIdColor:null,v=this.vertexBufferLayout.fields.has(b.r.OPACITYFEATUREATTRIBUTE),x=v?r.attributes.get(b.r.OPACITYFEATUREATTRIBUTE).data[0]:0,S=new Float32Array(n.buffer),w=(0,i.A)("enable-feature:objectAndLayerId-rendering")?new Uint8Array(n.buffer):null,T=this.vertexBufferLayout.stride/4;let A=s*T;const C=A;let E=0;const M=p?(e,t,r)=>E=p[r]:(e,t,r)=>E+=(0,l.p)(e,t),R=(0,i.A)("enable-feature:objectAndLayerId-rendering"),P=(e,t,r,i,n,s,o)=>{if(S[A++]=t[0],S[A++]=t[1],S[A++]=t[2],S[A++]=e[0],S[A++]=e[1],S[A++]=e[2],S[A++]=r[0],S[A++]=r[1],S[A++]=r[2],S[A++]=i,S[A++]=o,S[A++]=n,S[A++]=f,y)S[A++]=g;else{const e=Math.min(4*s,m.length-4);S[A++]=m[e],S[A++]=m[e+1],S[A++]=m[e+2],S[A++]=m[e+3]}v&&(S[A++]=x),R&&(null!=_&&(w[4*A]=_[0],w[4*A+1]=_[1],w[4*A+2]=_[2],w[4*A+3]=_[3]),A++)};A+=T,(0,l.s)(a,u.data[0],u.data[1],u.data[2]),e&&(0,l.h)(a,a,e);const O=this._isClosed(r);if(O){const t=u.data.length-3;(0,l.s)(o,u.data[t],u.data[t+1],u.data[t+2]),e&&(0,l.h)(o,o,e)}else(0,l.s)(c,u.data[3],u.data[4],u.data[5]),e&&(0,l.h)(c,c,e),P(a,a,c,1,D.LEFT_CAP_START,0,0),P(a,a,c,1,D.RIGHT_CAP_START,0,0),(0,l.c)(o,a),(0,l.c)(a,c);const I=O?0:1,L=O?d:d-1;for(let t=I;t<L;t++){const r=(t+1)%d*3;(0,l.s)(c,u.data[r],u.data[r+1],u.data[r+2]),e&&(0,l.h)(c,c,e),M(o,a,t),P(o,a,c,0,D.LEFT_JOIN_END,t,E),P(o,a,c,0,D.RIGHT_JOIN_END,t,E);const i=this.numJoinSubdivisions;for(let e=0;e<i;++e){const r=(e+1)/(i+1);P(o,a,c,r,D.LEFT_JOIN_END,t,E),P(o,a,c,r,D.RIGHT_JOIN_END,t,E)}P(o,a,c,1,D.LEFT_JOIN_START,t,E),P(o,a,c,1,D.RIGHT_JOIN_START,t,E),(0,l.c)(o,a),(0,l.c)(a,c)}O?((0,l.s)(c,u.data[3],u.data[4],u.data[5]),e&&(0,l.h)(c,c,e),E=M(o,a,L),P(o,a,c,0,D.LEFT_JOIN_END,I,E),P(o,a,c,0,D.RIGHT_JOIN_END,I,E)):(E=M(o,a,L),P(o,a,a,0,D.LEFT_CAP_END,L,E),P(o,a,a,0,D.RIGHT_CAP_END,L,E)),H(S,C+T,S,C,T),A=H(S,A-T,S,A,T),this._parameters.wireframe&&this._addWireframeVertices(n,C,A,T)}_addWireframeVertices(e,t,r,i){const n=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT),s=new Float32Array(e.buffer,t*Float32Array.BYTES_PER_ELEMENT,r-t);let o=0;const a=e=>o=H(s,e,n,o,i);for(let e=0;e<s.length-1;e+=2*i)a(e),a(e+2*i),a(e+1*i),a(e+2*i),a(e+1*i),a(e+3*i)}}function H(e,t,r,i,n){for(let s=0;s<n;s++)r[i++]=e[t++];return i}function k(e,t){return!!e.isClosed&&t.get(b.r.POSITION).indices.length>2}const j=(0,c.vt)(),W=(0,c.vt)(),q=(0,c.vt)(),Z=(0,c.vt)(),$=(0,c.vt)(),Y=(0,o.r_)(),X=(0,o.r_)(),J=(0,c.vt)(),Q=(0,c.vt)(),K=(0,d.vt)(),ee=(0,d.vt)(),te=(0,c.vt)(),re=(0,c.vt)(),ie=(0,c.vt)(),ne=[(0,o.r_)(),(0,o.r_)(),(0,o.r_)(),(0,o.r_)()],se=[(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)()],oe=(0,p.vt)(),ae=(0,p.vt)(),le=(0,p.vt)(),ce=(0,p.vt)()},27291:function(e,t,r){r.d(t,{W:function(){return s}});var i=r(24100),n=r(45079);class s extends i.im{intersect(e,t,r,i,s,o){return(0,n.Uy)(e,r,i,s,void 0,o)}}},77971:function(e,t,r){r.d(t,{S:function(){return s},p:function(){return o}});var i=r(24129),n=r(24100);class s extends i.Gd{constructor(){super(...arguments),this.renderOccluded=n.m$.Occlude,this.isDecoration=!1}}const o=8},84887:function(e,t,r){r.d(t,{MB:function(){return l},Um:function(){return u},kE:function(){return o},qu:function(){return a}});var i=r(50659),n=r(15774),s=r(54035);function o(e,t,r,i,o){let a=(r.screenLength||0)*e.pixelRatio;null!=o&&(a=(0,s.hs)(a,i,t,o));const l=a*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return(0,n.qE)(l*t,r.minWorldLength||0,null!=r.maxWorldLength?r.maxWorldLength:1/0)}function a(e,t){const r=t?a(t):{};for(const t in e){let i=e[t];i?.forEach&&(i=c(i)),null==i&&t in r||(r[t]=i)}return r}function l(e,t){let r=!1;for(const n in t){const s=t[n];void 0!==s&&(Array.isArray(s)?null===e[n]?(e[n]=s.slice(),r=!0):(0,i.yo)(e[n],s)&&(r=!0):e[n]!==s&&(r=!0,e[n]=s))}return r}function c(e){const t=[];return e.forEach((e=>t.push(e))),t}const u={multiply:1,ignore:2,replace:3,tint:4}},93678:function(e,t,r){r.d(t,{Hk:function(){return d},Pq:function(){return h},SA:function(){return g},Ut:function(){return u},p1:function(){return p},tH:function(){return m},tb:function(){return f},uO:function(){return a},zC:function(){return y}});var i=r(73364),n=r(92754),s=r(90553),o=r(65839);function a(e,t,r,i=1){const{data:n,indices:s}=e,o=t.typedBuffer,a=t.typedBufferStride,l=s.length;if(r*=a,1===i)for(let e=0;e<l;++e)o[r]=n[s[e]],r+=a;else for(let e=0;e<l;++e){const t=n[s[e]];for(let e=0;e<i;e++)o[r]=t,r+=a}}function l(e,t,r){const{data:i,indices:n}=e,s=t.typedBuffer,o=t.typedBufferStride,a=n.length;r*=o;for(let e=0;e<a;++e){const t=2*n[e];s[r]=i[t],s[r+1]=i[t+1],r+=o}}function c(e,t,r,i){const{data:n,indices:s}=e,o=t.typedBuffer,a=t.typedBufferStride,l=s.length;if(r*=a,null==i||1===i)for(let e=0;e<l;++e){const t=3*s[e];o[r]=n[t],o[r+1]=n[t+1],o[r+2]=n[t+2],r+=a}else for(let e=0;e<l;++e){const t=3*s[e];for(let e=0;e<i;++e)o[r]=n[t],o[r+1]=n[t+1],o[r+2]=n[t+2],r+=a}}function u(e,t,r,i=1){const{data:n,indices:s}=e,o=t.typedBuffer,a=t.typedBufferStride,l=s.length;if(r*=a,1===i)for(let e=0;e<l;++e){const t=4*s[e];o[r]=n[t],o[r+1]=n[t+1],o[r+2]=n[t+2],o[r+3]=n[t+3],r+=a}else for(let e=0;e<l;++e){const t=4*s[e];for(let e=0;e<i;++e)o[r]=n[t],o[r+1]=n[t+1],o[r+2]=n[t+2],o[r+3]=n[t+3],r+=a}}function h(e,t,r){const i=e.typedBuffer,n=e.typedBufferStride;t*=n;for(let e=0;e<r;++e)i[t]=0,i[t+1]=0,i[t+2]=0,i[t+3]=0,t+=n}function d(e,t,r,n,s=1){if(!t)return void c(e,r,n,s);const{data:o,indices:a}=e,l=r.typedBuffer,u=r.typedBufferStride,h=a.length,d=t[0],p=t[1],f=t[2],m=t[4],g=t[5],y=t[6],_=t[8],v=t[9],b=t[10],x=t[12],S=t[13],w=t[14];n*=u;let T=0,A=0,C=0;const E=(0,i.tZ)(t)?e=>{T=o[e]+x,A=o[e+1]+S,C=o[e+2]+w}:e=>{const t=o[e],r=o[e+1],i=o[e+2];T=d*t+m*r+_*i+x,A=p*t+g*r+v*i+S,C=f*t+y*r+b*i+w};if(1===s)for(let e=0;e<h;++e)E(3*a[e]),l[n]=T,l[n+1]=A,l[n+2]=C,n+=u;else for(let e=0;e<h;++e){E(3*a[e]);for(let e=0;e<s;++e)l[n]=T,l[n+1]=A,l[n+2]=C,n+=u}}function p(e,t,r,n,s=1){if(!t)return void c(e,r,n,s);const{data:o,indices:a}=e,l=t,u=r.typedBuffer,h=r.typedBufferStride,d=a.length,p=l[0],f=l[1],m=l[2],g=l[4],y=l[5],_=l[6],v=l[8],b=l[9],x=l[10],S=!(0,i.ut)(l),w=1e-6,T=1-w;n*=h;let A=0,C=0,E=0;const M=(0,i.tZ)(l)?e=>{A=o[e],C=o[e+1],E=o[e+2]}:e=>{const t=o[e],r=o[e+1],i=o[e+2];A=p*t+g*r+v*i,C=f*t+y*r+b*i,E=m*t+_*r+x*i};if(1===s)if(S)for(let e=0;e<d;++e){M(3*a[e]);const t=A*A+C*C+E*E;if(t<T&&t>w){const e=1/Math.sqrt(t);u[n]=A*e,u[n+1]=C*e,u[n+2]=E*e}else u[n]=A,u[n+1]=C,u[n+2]=E;n+=h}else for(let e=0;e<d;++e)M(3*a[e]),u[n]=A,u[n+1]=C,u[n+2]=E,n+=h;else for(let e=0;e<d;++e){if(M(3*a[e]),S){const e=A*A+C*C+E*E;if(e<T&&e>w){const t=1/Math.sqrt(e);A*=t,C*=t,E*=t}}for(let e=0;e<s;++e)u[n]=A,u[n+1]=C,u[n+2]=E,n+=h}}function f(e,t,r,i,n=1){const{data:s,indices:o}=e,a=r.typedBuffer,l=r.typedBufferStride,c=o.length;if(i*=l,t!==s.length||4!==t)if(1!==n)if(4!==t)for(let e=0;e<c;++e){const t=3*o[e];for(let e=0;e<n;++e)a[i]=s[t],a[i+1]=s[t+1],a[i+2]=s[t+2],a[i+3]=255,i+=l}else for(let e=0;e<c;++e){const t=4*o[e];for(let e=0;e<n;++e)a[i]=s[t],a[i+1]=s[t+1],a[i+2]=s[t+2],a[i+3]=s[t+3],i+=l}else{if(4===t){for(let e=0;e<c;++e){const t=4*o[e];a[i]=s[t],a[i+1]=s[t+1],a[i+2]=s[t+2],a[i+3]=s[t+3],i+=l}return}for(let e=0;e<c;++e){const t=3*o[e];a[i]=s[t],a[i+1]=s[t+1],a[i+2]=s[t+2],a[i+3]=255,i+=l}}else{a[i]=s[0],a[i+1]=s[1],a[i+2]=s[2],a[i+3]=s[3];const e=new Uint32Array(r.typedBuffer.buffer,r.start),t=l/4,o=e[i/=4];i+=t;const u=c*n;for(let r=1;r<u;++r)e[i]=o,i+=t}}function m(e,t,r,i,n=1){const s=t.typedBuffer,o=t.typedBufferStride;if(i*=o,1===n)for(let t=0;t<r;++t)s[i]=e[0],s[i+1]=e[1],s[i+2]=e[2],s[i+3]=e[3],i+=o;else for(let t=0;t<r;++t)for(let t=0;t<n;++t)s[i]=e[0],s[i+1]=e[1],s[i+2]=e[2],s[i+3]=e[3],i+=o}function g(e,t,r,i,s,a){for(const l of t.fields.keys()){const t=e.attributes.get(l),c=t?.indices;if(t&&c)y(l,t,r,i,s,a);else if(l===o.r.OBJECTANDLAYERIDCOLOR&&null!=e.objectAndLayerIdColor){const t=e.attributes.get(o.r.POSITION)?.indices;if(t){const r=t.length,i=s.getField(l,n.XP);m(e.objectAndLayerIdColor,i,r,a)}}}}function y(e,t,r,a,c,h){switch(e){case o.r.POSITION:{(0,s.vA)(3===t.size);const i=c.getField(e,n.xs);(0,s.vA)(!!i,`No buffer view for ${e}`),i&&d(t,r,i,h);break}case o.r.NORMAL:{(0,s.vA)(3===t.size);const r=c.getField(e,n.xs);(0,s.vA)(!!r,`No buffer view for ${e}`),r&&p(t,a,r,h);break}case o.r.NORMALCOMPRESSED:{(0,s.vA)(2===t.size);const r=c.getField(e,n.mJ);(0,s.vA)(!!r,`No buffer view for ${e}`),r&&l(t,r,h);break}case o.r.UV0:{(0,s.vA)(2===t.size);const r=c.getField(e,n.gH);(0,s.vA)(!!r,`No buffer view for ${e}`),r&&l(t,r,h);break}case o.r.COLOR:case o.r.SYMBOLCOLOR:{const r=c.getField(e,n.XP);(0,s.vA)(!!r,`No buffer view for ${e}`),(0,s.vA)(3===t.size||4===t.size),!r||3!==t.size&&4!==t.size||f(t,t.size,r,h);break}case o.r.COLORFEATUREATTRIBUTE:{const r=c.getField(e,n.Y$);(0,s.vA)(!!r,`No buffer view for ${e}`),(0,s.vA)(1===t.size),r&&1===t.size&&function(e,t,r){const{data:i,indices:n}=e,s=t.typedBuffer,o=t.typedBufferStride,a=n.length,l=i[0];r*=o;for(let e=0;e<a;++e)s[r]=l,r+=o}(t,r,h);break}case o.r.TANGENT:{(0,s.vA)(4===t.size);const o=c.getField(e,n.Eq);(0,s.vA)(!!o,`No buffer view for ${e}`),o&&function(e,t,r,n,s=1){if(!t)return void u(e,r,n,s);const{data:o,indices:a}=e,l=t,c=r.typedBuffer,h=r.typedBufferStride,d=a.length,p=l[0],f=l[1],m=l[2],g=l[4],y=l[5],_=l[6],v=l[8],b=l[9],x=l[10],S=!(0,i.ut)(l),w=1e-6,T=1-w;if(n*=h,1===s)for(let e=0;e<d;++e){const t=4*a[e],r=o[t],i=o[t+1],s=o[t+2],l=o[t+3];let u=p*r+g*i+v*s,d=f*r+y*i+b*s,A=m*r+_*i+x*s;if(S){const e=u*u+d*d+A*A;if(e<T&&e>w){const t=1/Math.sqrt(e);u*=t,d*=t,A*=t}}c[n]=u,c[n+1]=d,c[n+2]=A,c[n+3]=l,n+=h}else for(let e=0;e<d;++e){const t=4*a[e],r=o[t],i=o[t+1],l=o[t+2],u=o[t+3];let d=p*r+g*i+v*l,A=f*r+y*i+b*l,C=m*r+_*i+x*l;if(S){const e=d*d+A*A+C*C;if(e<T&&e>w){const t=1/Math.sqrt(e);d*=t,A*=t,C*=t}}for(let e=0;e<s;++e)c[n]=d,c[n+1]=A,c[n+2]=C,c[n+3]=u,n+=h}}(t,r,o,h);break}case o.r.PROFILERIGHT:case o.r.PROFILEUP:case o.r.PROFILEVERTEXANDNORMAL:case o.r.FEATUREVALUE:{(0,s.vA)(4===t.size);const r=c.getField(e,n.Eq);(0,s.vA)(!!r,`No buffer view for ${e}`),r&&u(t,r,h)}}}},20794:function(e,t,r){r.d(t,{Xq:function(){return a},wk:function(){return o}});const i={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},n={dash:i.dash,"dash-dot":[...i.dash,...i.dot],dot:i.dot,"long-dash":i["long-dash"],"long-dash-dot":[...i["long-dash"],...i.dot],"long-dash-dot-dot":[...i["long-dash"],...i.dot,...i.dot],none:null,"short-dash":i["short-dash"],"short-dash-dot":[...i["short-dash"],...i["short-dot"]],"short-dash-dot-dot":[...i["short-dash"],...i["short-dot"],...i["short-dot"]],"short-dot":i["short-dot"],solid:null},s=8;function o(e){return{pattern:[e,e],pixelRatio:2}}function a(e){return null!=e&&"style"===e.type?function(e){return null!=e?function(e,t){return null==e?e:{pattern:e.slice(),pixelRatio:t}}(n[e],s):null}(e.style):null}},27539:function(e,t,r){r.d(t,{Jr:function(){return s},Rk:function(){return o},d_:function(){return l},mX:function(){return a}});var i=r(20551),n=r(32501);function s({normalTexture:e,metallicRoughnessTexture:t,metallicFactor:r,roughnessFactor:s,emissiveTexture:o,emissiveFactor:a,occlusionTexture:l}){return null==e&&null==t&&null==o&&(null==a||(0,i.e)(a,n.uY))&&null==l&&(null==s||1===s)&&(null==r||1===r)}const o=[1,1,.5],a=[0,.6,.2],l=[0,1,.2]},84738:function(e,t,r){r.d(t,{Ci:function(){return s},PC:function(){return o},Vk:function(){return a}});var i=r(32501),n=r(44476);function s(e,t){return null==e&&(e=[]),e.push(t),e}function o(e,t){if(null==e)return null;const r=e.filter((e=>e!==t));return 0===r.length?null:r}function a(e,t,r,i,s){l[0]=e.get(t,0),l[1]=e.get(t,1),l[2]=e.get(t,2),(0,n.jS)(l,c,3),r.set(s,0,c[0]),i.set(s,0,c[1]),r.set(s,1,c[2]),i.set(s,1,c[3]),r.set(s,2,c[4]),i.set(s,2,c[5])}const l=(0,i.vt)(),c=new Float32Array(6)},77032:function(e,t,r){r.d(t,{R5:function(){return C},V:function(){return A},uD:function(){return T}});var i=r(32501),n=r(41546),s=r(65420),o=r(27264),a=r(11377),l=r(2457),c=r(94211),u=r(28686),h=r(34615),d=r(22542),p=r(54407),f=r(40502),m=r(24100),g=r(46921),y=r(54101),_=r(6200),v=r(55890),b=r(27539),x=r(62480),S=r(85456),w=r(57087);class T extends c.Zo{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=(0,i.ci)(b.Rk),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=p.s2.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=(0,i.fA)(0,0,0),this.instancedDoublePrecision=!1,this.normalType=a.W.Attribute,this.receiveShadows=!0,this.receiveAmbientOcclusion=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=(0,i.fA)(.2,.2,.2),this.diffuse=(0,i.fA)(.8,.8,.8),this.externalColor=(0,n.fA)(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=(0,i.vt)(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=p.it.Less,this.textureAlphaMode=p.sf.Blend,this.textureAlphaCutoff=u.H,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=m.m$.Occlude,this.isDecoration=!1}}class A extends c.gy{constructor(){super(...arguments),this.origin=(0,i.vt)(),this.slicePlaneLocalOrigin=this.origin}}class C extends d.w{initializeConfiguration(e,t){t.spherical=e.viewingMode===s.RT.Global,t.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,t.textureCoordinateType=t.hasColorTexture||t.hasMetallicRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture||t.hasNormalTexture?l.q.Default:l.q.None,t.objectAndLayerIdColorInstanced=t.instanced}initializeProgram(e){return this._initializeProgram(e,C.shader)}_initializeProgram(e,t){return new y.B(e.rctx,t.get().build(this.configuration),f.D)}_makePipeline(e,t){const r=this.configuration,i=e===v.y.NONE,n=e===v.y.FrontFace;return(0,w.Ey)({blending:r.output===o.V.Color&&r.transparent?i?g.V0:(0,g.ez)(e):null,culling:M(r)?(0,w.Xt)(r.cullFace):null,depthTest:{func:(0,g.K_)(e,E(r.customDepthTest))},depthWrite:(i||n)&&r.writeDepth?w.kn:null,drawBuffers:r.output===o.V.Depth?{buffers:[S.Hr.NONE]}:(0,g.cl)(e),colorWrite:w.wE,stencilWrite:r.hasOccludees?_.v0:null,stencilTest:r.hasOccludees?t?_.a9:_.qh:null,polygonOffset:i||n?null:(0,g.aB)(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}function E(e){return e===p.it.Lequal?S.MT.LEQUAL:S.MT.LESS}function M(e){return e.cullFace!==p.s2.None||!e.hasSlicePlane&&!e.transparent&&!e.doubleSidedMode}C.shader=new h.$(x.D,(()=>r.e(2529).then(r.bind(r,576))))},50678:function(e,t,r){r.d(t,{Dt:function(){return h},kJ:function(){return n},lM:function(){return i}});var i,n,s,o=r(53804),a=r(27264),l=r(8610),c=r(55890),u=r(46121);(s=i||(i={}))[s.Draped=0]="Draped",s[s.Screen=1]="Screen",s[s.World=2]="World",s[s.COUNT=3]="COUNT",function(e){e[e.Center=0]="Center",e[e.Tip=1]="Tip",e[e.COUNT=2]="COUNT"}(n||(n={}));class h extends u.E{constructor(){super(...arguments),this.output=a.V.Color,this.transparencyPassType=c.y.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=i.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=n.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}get draped(){return this.space===i.Draped}}(0,o._)([(0,l.W)({count:a.V.COUNT})],h.prototype,"output",void 0),(0,o._)([(0,l.W)({count:c.y.COUNT})],h.prototype,"transparencyPassType",void 0),(0,o._)([(0,l.W)()],h.prototype,"occluder",void 0),(0,o._)([(0,l.W)()],h.prototype,"hasSlicePlane",void 0),(0,o._)([(0,l.W)()],h.prototype,"writeDepth",void 0),(0,o._)([(0,l.W)({count:i.COUNT})],h.prototype,"space",void 0),(0,o._)([(0,l.W)()],h.prototype,"hideOnShortSegments",void 0),(0,o._)([(0,l.W)()],h.prototype,"hasCap",void 0),(0,o._)([(0,l.W)({count:n.COUNT})],h.prototype,"anchor",void 0),(0,o._)([(0,l.W)()],h.prototype,"hasTip",void 0),(0,o._)([(0,l.W)()],h.prototype,"vvSize",void 0),(0,o._)([(0,l.W)()],h.prototype,"vvColor",void 0),(0,o._)([(0,l.W)()],h.prototype,"vvOpacity",void 0),(0,o._)([(0,l.W)()],h.prototype,"hasOccludees",void 0),(0,o._)([(0,l.W)()],h.prototype,"multipassEnabled",void 0),(0,o._)([(0,l.W)()],h.prototype,"cullAboveGround",void 0),(0,o._)([(0,l.W)({constValue:!1})],h.prototype,"occlusionPass",void 0),(0,o._)([(0,l.W)({constValue:!0})],h.prototype,"hasVvInstancing",void 0),(0,o._)([(0,l.W)({constValue:!0})],h.prototype,"hasSliceTranslatedView",void 0)},95736:function(e,t,r){r.d(t,{Q:function(){return u},x:function(){return i}});var i,n,s=r(53804),o=r(27264),a=r(8610),l=r(55890),c=r(46121);(n=i||(i={}))[n.BUTT=0]="BUTT",n[n.SQUARE=1]="SQUARE",n[n.ROUND=2]="ROUND",n[n.COUNT=3]="COUNT";class u extends c.E{constructor(){super(...arguments),this.output=o.V.Color,this.capType=i.BUTT,this.transparencyPassType=l.y.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}}(0,s._)([(0,a.W)({count:o.V.COUNT})],u.prototype,"output",void 0),(0,s._)([(0,a.W)({count:i.COUNT})],u.prototype,"capType",void 0),(0,s._)([(0,a.W)({count:l.y.COUNT})],u.prototype,"transparencyPassType",void 0),(0,s._)([(0,a.W)()],u.prototype,"occluder",void 0),(0,s._)([(0,a.W)()],u.prototype,"hasSlicePlane",void 0),(0,s._)([(0,a.W)()],u.prototype,"hasPolygonOffset",void 0),(0,s._)([(0,a.W)()],u.prototype,"writeDepth",void 0),(0,s._)([(0,a.W)()],u.prototype,"draped",void 0),(0,s._)([(0,a.W)()],u.prototype,"stippleEnabled",void 0),(0,s._)([(0,a.W)()],u.prototype,"stippleOffColorEnabled",void 0),(0,s._)([(0,a.W)()],u.prototype,"stipplePreferContinuous",void 0),(0,s._)([(0,a.W)()],u.prototype,"roundJoins",void 0),(0,s._)([(0,a.W)()],u.prototype,"applyMarkerOffset",void 0),(0,s._)([(0,a.W)()],u.prototype,"vvSize",void 0),(0,s._)([(0,a.W)()],u.prototype,"vvColor",void 0),(0,s._)([(0,a.W)()],u.prototype,"vvOpacity",void 0),(0,s._)([(0,a.W)()],u.prototype,"falloffEnabled",void 0),(0,s._)([(0,a.W)()],u.prototype,"innerColorEnabled",void 0),(0,s._)([(0,a.W)()],u.prototype,"hasOccludees",void 0),(0,s._)([(0,a.W)()],u.prototype,"multipassEnabled",void 0),(0,s._)([(0,a.W)()],u.prototype,"cullAboveGround",void 0),(0,s._)([(0,a.W)()],u.prototype,"wireframe",void 0),(0,s._)([(0,a.W)()],u.prototype,"objectAndLayerIdColorInstanced",void 0),(0,s._)([(0,a.W)({constValue:!1})],u.prototype,"occlusionPass",void 0),(0,s._)([(0,a.W)({constValue:!0})],u.prototype,"hasVvInstancing",void 0),(0,s._)([(0,a.W)({constValue:!0})],u.prototype,"hasSliceTranslatedView",void 0)},65631:function(e,t,r){r.d(t,{A:function(){return A}});var i,n=r(53804),s=r(83525),o=r(40633),a=r(15774),l=r(13520),c=r(23502),u=(r(58941),r(13798),r(65953)),h=r(73364),d=r(39714),p=r(13786),f=r(1932),m=r(20551),g=r(32501),y=r(33400),_=r(41546),v=r(69508),b=r(79578),x=r(29531),S=r(65420),w=r(57701);let T=i=class extends s.A{constructor(e){super(e),this._ray=(0,b.vt)(),this._viewport=(0,_.fA)(0,0,1,1),this._padding=(0,_.fA)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=(0,f.fA)(1,1e3),this._viewDirty=!0,this._viewMatrix=(0,d.vt)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=(0,d.vt)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=(0,d.vt)(),this._frustumDirty=!0,this._frustum=(0,v.vt)(),this._fullViewport=(0,_.vt)(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=(0,g.vt)(),this._up=(0,g.vt)(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(e){this._pixelRatio=e>0?e:1}get rows(){return this._rows}set rows(e){this._rows=Math.max(1,e)}get columns(){return this._columns}set columns(e){this._columns=Math.max(1,e)}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center,"_center")}get ray(){return(0,m.f)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){(0,h.C)(this._viewMatrix,e),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),(0,m.s)((0,g.vt)(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),(0,m.s)((0,g.vt)(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),(0,m.s)((0,g.vt)(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get screenViewport(){if(1===this.pixelRatio)return this._viewport;const e=(0,y.b)((0,_.vt)(),this._viewport,1/this.pixelRatio),t=this._get("screenViewport");return t&&(0,y.e)(e,t)?t:e}get screenPadding(){if(1===this.pixelRatio)return this._padding;const e=(0,y.b)((0,_.vt)(),this._padding,1/this.pixelRatio),t=this._get("screenPadding");return t&&(0,y.e)(e,t)?t:e}get x(){return this._viewport[0]}set x(e){e+=this._padding[w.zj.LEFT],this._viewport[0]!==e&&(this._viewport[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(e){e+=this._padding[w.zj.BOTTOM],this._viewport[1]!==e&&(this._viewport[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[w.zj.RIGHT]+this._padding[w.zj.LEFT]}set fullWidth(e){this.width=e-(this._padding[w.zj.RIGHT]+this._padding[w.zj.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[w.zj.TOP]+this._padding[w.zj.BOTTOM]}set fullHeight(e){this.height=e-(this._padding[w.zj.TOP]+this._padding[w.zj.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[w.zj.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[w.zj.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){(0,y.a)(this._padding,e)||(this._viewport[0]+=e[w.zj.LEFT]-this._padding[w.zj.LEFT],this._viewport[1]+=e[w.zj.BOTTOM]-this._padding[w.zj.BOTTOM],this._viewport[2]-=e[w.zj.RIGHT]+e[w.zj.LEFT]-(this._padding[w.zj.RIGHT]+this._padding[w.zj.LEFT]),this._viewport[3]-=e[w.zj.TOP]+e[w.zj.BOTTOM]-(this._padding[w.zj.TOP]+this._padding[w.zj.BOTTOM]),(0,y.c)(this._padding,e),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&((0,h.lw)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return(0,h.B8)((0,d.vt)(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||(0,d.vt)()}get fov(){return this._fov}set fov(e){this._fov=e,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return e=this._fov,t=this.width,r=this.height,2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+r*r));var e,t,r}set fovX(e){this._fov=function(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/t)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return e=this._fov,t=this.width,r=this.height,2*Math.atan(r*Math.tan(.5*e)/Math.sqrt(t*t+r*r));var e,t,r}set fovY(e){this._fov=function(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/r)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return(0,m.p)(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,h.B8)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,h.mg)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return null!=this.relativeElevation&&this.relativeElevation>=0}get _projectionMatrixInternal(){const e=this.width,t=this.height,r=this.near*Math.tan(this.fovY/2)*2,i=r*this._aspect,n=r/this.rows,s=i/this.columns,o=-i/2+this.column*s,a=o+s,l=-r/2+this.row*n,c=l+n,u=(0,h.$h)((0,d.vt)(),o*(1+2*this._padding[w.zj.LEFT]/e),a*(1+2*this._padding[w.zj.RIGHT]/e),l*(1+2*this._padding[w.zj.BOTTOM]/t),c*(1+2*this._padding[w.zj.TOP]/t),this.near,this.far),p=this._get("projectionMatrix");return p&&(0,h.aI)(p,u)?p:u}copyFrom(e){(0,m.c)(this._ray.origin,e.eye),this.center=e.center,this.up=e.up,(0,y.c)(this._viewport,e.viewport),this.notifyChange("_viewport"),(0,y.c)(this._padding,e.padding),this.notifyChange("_padding"),(0,p.C)(this._nearFar,e.nearFar),this.notifyChange("_nearFar"),this._fov=e.fov,this.row=e.row,this.column=e.column,this.rows=e.rows,this.columns=e.columns,this.relativeElevation=e.relativeElevation;const t=e;return this._viewDirty=t._viewDirty,this._viewDirty||((0,h.C)(this._viewMatrix,e.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||((0,v.C)(this._frustum,e.frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,h.C)(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,y.c)(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up}clone(){return(new i).copyFrom(this)}equals(e){return(0,m.e)(this.eye,e.eye)&&(0,m.e)(this.center,e.center)&&(0,m.e)(this.up,e.up)&&(0,y.a)(this._viewport,e.viewport)&&(0,y.a)(this._padding,e.padding)&&(0,p.t2)(this.nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation&&this.row===e.row&&this.column===e.column&&this.rows===e.rows&&this.columns===e.columns}almostEquals(e){const t=Math.max(1,1/this.pixelRatio,1/e.pixelRatio);if(Math.abs(e.fov-this._fov)>=.001||(0,y.d)(e.screenPadding,this.screenPadding)>=t||(0,y.d)(this.screenViewport,e.screenViewport)>=t||this.row!==e.row||this.column!==e.column||this.rows!==e.rows||this.columns!==e.columns)return!1;(0,m.z)(M,e.eye,e.center),(0,m.z)(R,this.eye,this.center);const r=(0,m.m)(M,R),i=(0,m.x)(M),n=(0,m.x)(R),s=5e-4;return r*r>=(1-1e-10)*i*n&&(0,m.w)(e.eye,this.eye)<Math.max(i,n)*s*s}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(e))}_viewDirectionDistance(e){return Math.abs((0,x.gr)(this.viewForward,(0,m.f)(M,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(e=(0,l.gs)()){return e[0]=(this.padding[w.zj.LEFT]+this.width/2)/this.pixelRatio,e[1]=(this.padding[w.zj.TOP]+this.height/2)/this.pixelRatio,e}getRenderCenter(e,t=.5,r=.5){return e[0]=this.padding[w.zj.LEFT]+this.width*t,e[1]=this.padding[w.zj.BOTTOM]+this.height*r,e[2]=.5,e}setGLViewport(e){const t=this.viewport,r=this.padding;e.setViewport(t[0]-r[3],t[1]-r[2],t[2]+r[1]+r[3],t[3]+r[0]+r[2])}applyProjection(e,t){e!==C&&(0,m.c)(C,e),C[3]=1,(0,y.t)(C,C,this.projectionMatrix);const r=Math.abs(C[3]);(0,m.j)(C,C,1/r);const i=this.fullViewport;t[0]=(0,a.Cc)(0,i[0]+i[2],.5+.5*C[0]),t[1]=(0,a.Cc)(0,i[1]+i[3],.5+.5*C[1]),t[2]=.5*(C[2]+1),t[3]=r}unapplyProjection(e,t){const r=this.fullViewport;C[0]=(e[0]/(r[0]+r[2])*2-1)*e[3],C[1]=(e[1]/(r[1]+r[3])*2-1)*e[3],C[2]=(2*e[2]-1)*e[3],C[3]=e[3],null!=this.inverseProjectionMatrix&&((0,y.t)(C,C,this.inverseProjectionMatrix),t[0]=C[0],t[1]=C[1],t[2]=C[2])}projectToScreen(e,t){return this.projectToRenderScreen(e,P),this.renderToScreen(P,t),t}projectToRenderScreen(e,t){if(C[0]=e[0],C[1]=e[1],C[2]=e[2],C[3]=1,(0,y.t)(C,C,this.viewProjectionMatrix),0===C[3])return null;const r=C;(0,m.j)(r,r,1/Math.abs(C[3]));const i=this.fullViewport,n=(0,a.Cc)(0,i[0]+i[2],.5+.5*r[0]),s=(0,a.Cc)(0,i[1]+i[3],.5+.5*r[1]);return"x"in t?(t.x=n,t.y=s):(t[0]=n,t[1]=s,t.length>2&&(t[2]=.5*(r[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,P),t)}unprojectFromRenderScreen(e,t){if((0,h.lw)(E,this.projectionMatrix,this.viewMatrix),!(0,h.B8)(E,E))return null;const r=this.fullViewport;return C[0]=2*(e[0]-r[0])/r[2]-1,C[1]=2*(e[1]-r[1])/r[3]-1,C[2]=2*e[2]-1,C[3]=1,(0,y.t)(C,C,E),0===C[3]?null:(t[0]=C[0]/C[3],t[1]=C[1]/C[3],t[2]=C[2]/C[3],t)}constrainWindowSize(e,t,r,i){const n=e*this.pixelRatio,s=t*this.pixelRatio,o=Math.max(n-r/2,0),a=Math.max(this.fullHeight-s-i/2,0),l=-Math.min(n-r/2,0),c=-Math.min(this.fullHeight-s-i/2,0),u=r-l- -Math.min(this.fullWidth-n-r/2,0),h=i-c- -Math.min(s-i/2,0);return[Math.round(o),Math.round(a),Math.round(u),Math.round(h)]}computeUp(e){e===S.RT.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(e,t){const r=e[0]*this.pixelRatio,i=this.fullHeight-e[1]*this.pixelRatio;return t[0]=r,t[1]=i,t}renderToScreen(e,t){const r=e[0]/this.pixelRatio,i=(this.fullHeight-e[1])/this.pixelRatio;t[0]=r,t[1]=i}_computeUpGlobal(){(0,m.f)(M,this.center,this.eye);const e=(0,m.l)(this.center);e<1?((0,m.s)(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs((0,m.m)(M,this.center))>.9999*(0,m.l)(M)*e||((0,m.b)(this._up,M,this.center),(0,m.b)(this._up,this._up,M),(0,m.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){(0,m.E)(M,this.eye,this.center),Math.abs(M[2])<=.9999&&((0,m.j)(M,M,M[2]),(0,m.s)(this._up,-M[0],-M[1],1-M[2]),(0,m.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(e,t,r=""){"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?(0,m.e)(e,t)||((0,m.c)(t,e),this._markViewDirty(),r.length&&this.notifyChange(r)):o.A.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&((0,v.ui)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&((0,h.t5)(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};(0,n._)([(0,c.MZ)()],T.prototype,"_viewport",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"_padding",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"_fov",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"_nearFar",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"_viewDirty",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"_viewMatrix",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"_pixelRatio",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"pixelRatio",null),(0,n._)([(0,c.MZ)()],T.prototype,"row",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"column",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"_rows",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"rows",null),(0,n._)([(0,c.MZ)()],T.prototype,"_columns",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"columns",null),(0,n._)([(0,c.MZ)()],T.prototype,"eye",null),(0,n._)([(0,c.MZ)()],T.prototype,"center",null),(0,n._)([(0,c.MZ)()],T.prototype,"_center",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"up",null),(0,n._)([(0,c.MZ)()],T.prototype,"_up",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"viewMatrix",null),(0,n._)([(0,c.MZ)({readOnly:!0})],T.prototype,"viewForward",null),(0,n._)([(0,c.MZ)({readOnly:!0})],T.prototype,"viewUp",null),(0,n._)([(0,c.MZ)({readOnly:!0})],T.prototype,"viewRight",null),(0,n._)([(0,c.MZ)({readOnly:!0})],T.prototype,"nearFar",null),(0,n._)([(0,c.MZ)()],T.prototype,"near",null),(0,n._)([(0,c.MZ)()],T.prototype,"far",null),(0,n._)([(0,c.MZ)()],T.prototype,"viewport",null),(0,n._)([(0,c.MZ)({readOnly:!0})],T.prototype,"screenViewport",null),(0,n._)([(0,c.MZ)({readOnly:!0})],T.prototype,"screenPadding",null),(0,n._)([(0,c.MZ)()],T.prototype,"x",null),(0,n._)([(0,c.MZ)()],T.prototype,"y",null),(0,n._)([(0,c.MZ)()],T.prototype,"width",null),(0,n._)([(0,c.MZ)()],T.prototype,"height",null),(0,n._)([(0,c.MZ)()],T.prototype,"fullWidth",null),(0,n._)([(0,c.MZ)()],T.prototype,"fullHeight",null),(0,n._)([(0,c.MZ)({readOnly:!0})],T.prototype,"_aspect",null),(0,n._)([(0,c.MZ)()],T.prototype,"padding",null),(0,n._)([(0,c.MZ)({readOnly:!0})],T.prototype,"projectionMatrix",null),(0,n._)([(0,c.MZ)({readOnly:!0})],T.prototype,"inverseProjectionMatrix",null),(0,n._)([(0,c.MZ)()],T.prototype,"fov",null),(0,n._)([(0,c.MZ)()],T.prototype,"fovX",null),(0,n._)([(0,c.MZ)()],T.prototype,"fovY",null),(0,n._)([(0,c.MZ)()],T.prototype,"viewInverseTransposeMatrix",null),(0,n._)([(0,c.MZ)({readOnly:!0})],T.prototype,"_projectionMatrixInternal",null),(0,n._)([(0,c.MZ)()],T.prototype,"relativeElevation",void 0),T=i=(0,n._)([(0,u.$)("esri.views.3d.webgl.RenderCamera")],T);const A=T,C=(0,_.vt)(),E=(0,d.vt)(),M=(0,g.vt)(),R=(0,g.vt)(),P=(0,l.r_)()},98680:function(e,t,r){var i,n;r.d(t,{N:function(){return i},z:function(){return n}}),function(e){e[e.RED=0]="RED",e[e.RG=1]="RG",e[e.RGBA4=2]="RGBA4",e[e.RGBA=3]="RGBA",e[e.RGBA_MIPMAP=4]="RGBA_MIPMAP",e[e.R16F=5]="R16F",e[e.RGBA16F=6]="RGBA16F"}(i||(i={})),function(e){e[e.DEPTH_STENCIL_TEXTURE=0]="DEPTH_STENCIL_TEXTURE",e[e.DEPTH16_BUFFER=1]="DEPTH16_BUFFER"}(n||(n={}))},65420:function(e,t,r){var i;r.d(t,{RT:function(){return i}}),function(e){e[e.Global=1]="Global",e[e.Local=2]="Local"}(i||(i={}))},58251:function(e,t,r){r.d(t,{A:function(){return m}});var i=r(53804),n=r(83525),s=r(48996),o=r(88781),a=r(40633),l=r(95929),c=r(62560),u=r(23502),h=(r(58941),r(13798),r(65953)),d=r(20248),p=r(39715);let f=class extends((0,o.sA)((0,c.g)(s.A.EventedMixin(n.A)))){constructor(e){super(e),this._updatingHandles=new d.U,this.layer=null,this.parent=null}initialize(){this.when().catch((e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",r=this.layer?.title||"no title";a.A.getLogger(this).error("#resolve()",`Failed to resolve layer view (layer title: '${r}', id: '${t}')`,e)}}))}destroy(){this._updatingHandles=(0,l.pR)(this._updatingHandles)}get fullOpacity(){return(this.layer?.opacity??1)*(this.parent?.fullOpacity??1)}get suspended(){return this.destroyed||!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer?.legendEnabled}get updating(){return!(!this._updatingHandles?.updating&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get updateSuspended(){return this.suspended}get visible(){return!0===this.layer?.visible}set visible(e){this._overrideIfSome("visible",e)}get visibleAtCurrentScale(){return!0}get visibleAtCurrentTimeExtent(){const e=this.view.timeExtent,t=this.layer?.visibilityTimeExtent;return!e||!t||!e.intersection(t).isEmpty}canResume(){const e=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&this.layer?.loaded&&!this.parent?.suspended&&this.view?.ready&&(0,p.g7)(e)&&this.visibleAtCurrentScale&&this.visibleAtCurrentTimeExtent||!1}getSuspendInfo(){const e=this.parent?.suspended?this.parent.suspendInfo:{};this.view?.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0);const t=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return(0,p.g7)(t)&&this.visibleAtCurrentScale||(e.outsideScaleRange=!0),this.visibleAtCurrentTimeExtent||(e.outsideVisibilityTimeExtent=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};(0,i._)([(0,u.MZ)()],f.prototype,"view",void 0),(0,i._)([(0,u.MZ)()],f.prototype,"fullOpacity",null),(0,i._)([(0,u.MZ)()],f.prototype,"layer",void 0),(0,i._)([(0,u.MZ)()],f.prototype,"parent",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],f.prototype,"suspended",null),(0,i._)([(0,u.MZ)({readOnly:!0})],f.prototype,"suspendInfo",null),(0,i._)([(0,u.MZ)({readOnly:!0})],f.prototype,"legendEnabled",null),(0,i._)([(0,u.MZ)({type:Boolean,readOnly:!0})],f.prototype,"updating",null),(0,i._)([(0,u.MZ)({readOnly:!0})],f.prototype,"updatingProgress",null),(0,i._)([(0,u.MZ)()],f.prototype,"updateSuspended",null),(0,i._)([(0,u.MZ)()],f.prototype,"visible",null),(0,i._)([(0,u.MZ)({readOnly:!0})],f.prototype,"visibleAtCurrentScale",null),(0,i._)([(0,u.MZ)({readOnly:!0})],f.prototype,"visibleAtCurrentTimeExtent",null),f=(0,i._)([(0,h.$)("esri.views.layers.LayerView")],f);const m=f},28088:function(e,t,r){r.d(t,{D8:function(){return s},TO:function(){return n},d0:function(){return o}});var i=r(53743);async function n(e,t=e.popupTemplate){if(null==t)return[];const r=await t.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:n}=t,{objectIdField:s,typeIdField:o,globalIdField:a,relationships:l}=e;if(r.includes("*"))return["*"];const c=n?(0,i.eX)(e):[],u=(0,i.DB)(e.fieldsIndex,[...r,...c]);return o&&u.push(o),u&&s&&e.fieldsIndex?.has(s)&&!u.includes(s)&&u.push(s),u&&a&&e.fieldsIndex?.has(a)&&!u.includes(a)&&u.push(a),l&&l.forEach((t=>{const{keyField:r}=t;u&&r&&e.fieldsIndex?.has(r)&&!u.includes(r)&&u.push(r)})),u}function s(e,t){return e.popupTemplate?e.popupTemplate:null!=t&&t.defaultPopupTemplateEnabled&&null!=e.defaultPopupTemplate?e.defaultPopupTemplate:null}function o(e,t){return null!=s(e,{defaultPopupTemplateEnabled:t})}},81197:function(e,t,r){var i;r.d(t,{M:function(){return i}}),function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"}(i||(i={}))},48961:function(e,t,r){r.d(t,{Bb:function(){return E},W6:function(){return i},nu:function(){return M}});var i,n,s=r(14606),o=(r(58941),r(40633)),a=r(95929),l=r(69739),c=r(7187),u=r(60539),h=r(28181),d=r(85445),p=r(38504),f=r(47558),m=r(16164),g=r(81197),y=r(55213);(n=i||(i={})).RESOURCE_CONTROLLER_IMMEDIATE="immediate",n.RESOURCE_CONTROLLER="schedule",n.SLIDE="slide",n.STREAM_DATA_LOADER="stream loader",n.ELEVATION_QUERY="elevation query",n.TERRAIN_SURFACE="terrain",n.SURFACE_GEOMETRY_UPDATES="surface geometry updates",n.LOD_RENDERER="LoD renderer",n.GRAPHICS_CORE="Graphics3D",n.I3S_CONTROLLER="I3S",n.POINT_CLOUD_LAYER="point cloud",n.FEATURE_TILE_FETCHER="feature fetcher",n.OVERLAY="overlay",n.STAGE="stage",n.GRAPHICS_DECONFLICTOR="graphics deconflictor",n.FILTER_VISIBILITY="Graphics3D filter visibility",n.SCALE_VISIBILITY="Graphics3D scale visibility",n.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",n.POINT_OF_INTEREST_FREQUENT="POI frequent",n.POINT_OF_INTEREST_INFREQUENT="POI infrequent",n.LABELER="labeler",n.FEATURE_QUERY_ENGINE="feature query",n.FEATURE_TILE_TREE="feature tile tree",n.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",n.ELEVATION_ALIGNMENT="elevation alignment",n.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",n.TEXT_TEXTURE_ATLAS="text texture atlas",n.TEXTURE_UNLOAD="texture unload",n.LINE_OF_SIGHT_TOOL="line of sight tool",n.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",n.ELEVATION_PROFILE="elevation profile",n.SNAPPING="snapping",n.SHADOW_ACCUMULATOR="shadow accumulator",n.CLOUDS_GENERATOR="clouds generator",n[n.NONE=0]="NONE",n[n.TEST_PRIO=1]="TEST_PRIO";const _=new Map([[i.RESOURCE_CONTROLLER_IMMEDIATE,0],[i.RESOURCE_CONTROLLER,4],[i.SLIDE,0],[i.STREAM_DATA_LOADER,0],[i.ELEVATION_QUERY,0],[i.TERRAIN_SURFACE,1],[i.SURFACE_GEOMETRY_UPDATES,1],[i.LOD_RENDERER,2],[i.GRAPHICS_CORE,2],[i.I3S_CONTROLLER,2],[i.POINT_CLOUD_LAYER,2],[i.FEATURE_TILE_FETCHER,2],[i.OVERLAY,4],[i.STAGE,4],[i.GRAPHICS_DECONFLICTOR,4],[i.FILTER_VISIBILITY,4],[i.SCALE_VISIBILITY,4],[i.FRUSTUM_VISIBILITY,4],[i.CLOUDS_GENERATOR,4],[i.POINT_OF_INTEREST_FREQUENT,6],[i.POINT_OF_INTEREST_INFREQUENT,30],[i.LABELER,8],[i.FEATURE_QUERY_ENGINE,8],[i.FEATURE_TILE_TREE,16],[i.FEATURE_TILE_TREE_ACTIVE,0],[i.ELEVATION_ALIGNMENT,12],[i.ELEVATION_ALIGNMENT_SCENE,14],[i.TEXT_TEXTURE_ATLAS,12],[i.TEXTURE_UNLOAD,12],[i.LINE_OF_SIGHT_TOOL,16],[i.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[i.SNAPPING,0],[i.SHADOW_ACCUMULATOR,30]]);function v(e){return _.has(e)?_.get(e):"number"==typeof e?e:1}const b=(0,p.l5)(6.5),x=(0,p.l5)(1),S=(0,p.l5)(30),w=(0,p.l5)(1e3/30),T=(0,p.l5)(100);var A,C;!function(e){e.Scheduler=class{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some((e=>e.needsUpdate))}constructor(){this._updating=(0,d.v)(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new l.A("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=g.M.INTERACTING,this._tasks=new c.A,this._runQueue=new c.A,this._load=0,this._idleStateCallbacks=new c.A,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=(0,h.watch)((()=>m.A.SCHEDULER_LOG_SLOW_TASKS),(e=>this._debug=e),h.Vh);for(const e of Object.keys(i))this.performanceInfo.tasks.set(i[e],new l.A(i[e]))}destroy(){this._tasks.toArray().forEach((e=>e.remove())),this._tasks.clear(),(0,a.xt)(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(e){this._updatingChanged(),e&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask((()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())})))}registerTask(e,r){const i=new t(this,e,r);return this._tasks.push(i),this._updatingChanged(),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new l.A(e)),i}registerIdleStateCallbacks(e,t){const r={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(r),this.state===g.M.IDLE&&this._idleUpdatesStartFired&&r.idleBegin();const i=this;return{remove:()=>this._removeIdleStateCallbacks(r),set idleBegin(e){i._idleUpdatesStartFired&&(r.idleEnd(),i._state===g.M.IDLE&&e()),r.idleBegin=e},set idleEnd(e){r.idleEnd=e}}}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,this.state!==g.M.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}get state(){return this._state}updateBudget(e){++this._frameNumber;let t=b,r=e.frameDuration,i=x;switch(this.state){case g.M.IDLE:t=(0,p.l5)(0),r=(0,p.l5)(Math.max(T,e.frameDuration)),i=S;break;case g.M.INTERACTING:r=(0,p.l5)(Math.max(w,e.frameDuration));case g.M.ANIMATING:}return r=(0,p.l5)(r-e.elapsedFrameTime-t),this.state!==g.M.IDLE&&r<x&&!this._forceTask?(this._forceTask=!0,!1):(r=(0,p.l5)(Math.max(r,i)),this._budget.reset(r,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case g.M.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case g.M.INTERACTING:this._runInteracting();break;default:this._runAnimating()}}stopFrame(){this._budget.reset((0,p.l5)(0),this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}removeTask(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e),this._updatingChanged()}_updateTask(e){this._tasks.forAll((t=>{t.name===e&&t.setPriority(e)}))}_getState(e){if(this._runQueue.some((t=>t.name===e)))return C.SCHEDULED;let t=C.IDLE;return this._tasks.forAll((r=>{r.name===e&&r.needsUpdate&&(r.schedulePriority<=1?t=C.READY:t!==C.READY&&(t=C.WAITING))})),t}_getRuntime(e){let t=0;return this._tasks.forAll((r=>{r.name===e&&(t+=r.runtime)})),t}_resetRuntimes(){this._tasks.forAll((e=>e.runtime=0))}_getRunning(){const e=new Map;if(this._tasks.forAll((t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;let t="";return e.forEach(((e,r)=>{t+=e>1?` ${e}x ${r}`:` ${r}`})),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce(((e,t)=>t.needsUpdate?++e:e),0);this._load=.9*this._load+e*(1-.9)}_schedule(){for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1))),this._tasks.forAll((e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.includes(e)&&e.blockFrame!==this._frameNumber&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forAll((r=>{r.needsUpdate&&0!==r.schedulePriority&&0!==r.basePriority&&r.blockFrame!==this._frameNumber&&(e=!0,t=Math.max(t,r.basePriority),1===r.schedulePriority?(r.schedulePriority=0,this._runQueue.push(r)):--r.schedulePriority)})),!e)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const e=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){const t=this._budget.now(),r=this._runQueue.pop();this._budget.resetProgress();try{r.task.runTask(this._budget)===y.G&&(r.blockFrame=this._frameNumber)}catch(e){o.A.getLogger("esri.views.support.Scheduler").error(`Exception in task "${r.name}"`,e),r.blockFrame=this._frameNumber}!this._budget.hasProgressed&&r.blockFrame!==this._frameNumber&&r.needsUpdate&&(r.name,i.I3S_CONTROLLER,r.blockFrame=this._frameNumber),r.schedulePriority=r.basePriority;const n=this._budget.now()-t;if(r.runtime+=n,this._frameTaskTimes.set(r.priority,this._frameTaskTimes.get(r.priority)+n),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-e)}}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-e)}_startFrameTaskTimes(){for(const e of Object.keys(i))this._frameTaskTimes.set(i[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach(((e,t)=>this.performanceInfo.tasks.get(t).record(e))),this.performanceInfo.total.record(e)}get test(){}};class t{get task(){return this._task.value}get updating(){return this._queue.running}constructor(e,t,r){this._scheduler=e,this.name=t,this.blockFrame=0,this.runtime=0,this._queue=new f.T,this._handles=new s.A,this._basePriority=v(t),this.schedulePriority=this._basePriority,this._task=(0,d.v)(null!=r?r:this._queue),this._handles.add((0,h.when)((()=>this.task.running),(t=>e.taskRunningChanged(t))))}remove(){this.processQueue(E),this._scheduler.removeTask(this),this.schedule=M.schedule,this.reschedule=M.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(e){if(this.name===e)return;this.name=e;const t=v(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.updating||this.task.running}schedule(e,t,r){return this._queue.push(e,t,r)}reschedule(e,t,r){return this._queue.unshift(e,t,r)}processQueue(e){return this._queue.runTask(e)}}class r{constructor(){this._begin="undefined"!=typeof performance?performance.now():0,this._budget=0,this._state=g.M.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e,t){this._begin=this.now(),this._budget=e,this._state=t,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}e.Budget=r}(A||(A={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(C||(C={}));const E=(()=>{const e=new A.Budget;return e.enabled=!1,e})(),M=new class{remove(){}processQueue(){}schedule(e,t,r){try{if((0,u.G4)(t)){const e=(0,u.NK)();return r?Promise.resolve(r(e)):Promise.reject(e)}return(0,u.z7)(e(E))}catch(e){return Promise.reject(e)}}reschedule(e,t,r){return this.schedule(e,t,r)}}},55213:function(e,t,r){r.d(t,{G:function(){return i}});const i=Symbol("Yield")},16164:function(e,t,r){r.d(t,{A:function(){return l}});var i=r(53804),n=r(83525),s=r(23502),o=(r(58941),r(40633),r(13798),r(65953));let a=class extends n.A{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};(0,i._)([(0,s.MZ)()],a.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),a=(0,i._)([(0,o.$)("esri.views.support.debugFlags")],a);const l=new a},86305:function(e,t,r){r.d(t,{g:function(){return c}});var i=r(50659),n=(r(58941),r(40633)),s=r(24540),o=r(41835),a=r(85456);const l=()=>n.A.getLogger("esri.views.webgl.BufferObject");class c{static createIndex(e,t,r){return new c(e,a.NZ.ELEMENT_ARRAY_BUFFER,t,r)}static createVertex(e,t,r){return new c(e,a.NZ.ARRAY_BUFFER,t,r)}static createUniform(e,t,r){return new c(e,a.NZ.UNIFORM_BUFFER,t,r)}static createPixelPack(e,t=a._U.STREAM_READ,r){const i=new c(e,a.NZ.PIXEL_PACK_BUFFER,t);return r&&i.setSize(r),i}static createPixelUnpack(e,t=a._U.STREAM_DRAW,r){return new c(e,a.NZ.PIXEL_UNPACK_BUFFER,t,r)}static createTransformFeedback(e,t=a._U.STATIC_DRAW,r){const i=new c(e,a.NZ.TRANSFORM_FEEDBACK_BUFFER,t);return i.setSize(r),i}constructor(e,t,r,i){this._context=e,this.bufferType=t,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(a.vt.BufferObject,this),this._glName=this._context.gl.createBuffer(),(0,o.Y2)(this._context.gl),i&&this.setData(i)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){return this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER?this._indexType===a.pe.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER||this.bufferType===a.NZ.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(a.vt.BufferObject,this),this._context=null):this._glName&&l().warn("Leaked WebGL buffer object")}setSize(e,t=null){if(this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&null!=t)switch(this._indexType=t,t){case a.pe.UNSIGNED_SHORT:e*=2;break;case a.pe.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let t=e.byteLength;this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&((0,s.jq)(e)&&(t/=2,this._indexType=a.pe.UNSIGNED_SHORT),(0,s.XJ)(e)&&(t/=4,this._indexType=a.pe.UNSIGNED_INT)),this._setBufferData(t,e)}_setBufferData(e,t=null){this._size=e;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const i=this._context.gl;null!=t?i.bufferData(this.bufferType,t,this.usage):i.bufferData(this.bufferType,e,this.usage),(0,o.Y2)(i),this._isVAOAware&&this._context.bindVAO(r)}setSubData(e,t,r,i){if(!e)return;const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:s}=this._context;s.bufferSubData(this.bufferType,t*e.BYTES_PER_ELEMENT,e,r,i-r),(0,o.Y2)(s),this._isVAOAware&&this._context.bindVAO(n)}getSubData(e,t=0,r,n){if(r<0||n<0)return;const s=function(e){return(0,i.Xj)(e)}(e)?e.BYTES_PER_ELEMENT:1;if(s*((r??0)+(n??0))>e.byteLength)return;t+s*(n??0)>this.usedMemory&&l().warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this.bufferType===a.NZ.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,a.NZ.TRANSFORM_FEEDBACK_BUFFER),o.getBufferSubData(a.NZ.TRANSFORM_FEEDBACK_BUFFER,t,e,r,n),this._context.unbindBuffer(a.NZ.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,a.NZ.COPY_READ_BUFFER),o.getBufferSubData(a.NZ.COPY_READ_BUFFER,t,e,r,n),this._context.unbindBuffer(a.NZ.COPY_READ_BUFFER))}async getSubDataAsync(e,t=0,r,i){await this._context.clientWaitAsync(),this.getSubData(e,t,r,i)}}},69452:function(e,t,r){var i;r.d(t,{p:function(){return i}}),function(e){e[e.Texture=0]="Texture",e[e.RenderBuffer=1]="RenderBuffer"}(i||(i={}))},78541:function(e,t,r){r.d(t,{g:function(){return c}});var i=r(39819),n=(r(58941),r(41835)),s=r(85456),o=r(69452),a=r(10956);class l extends a.R{constructor(e,t){switch(super(),this.context=e,Object.assign(this,t),this.internalFormat){case s.H0.R16F:case s.H0.R16I:case s.H0.R16UI:case s.H0.R32F:case s.H0.R32I:case s.H0.R32UI:case s.H0.R8_SNORM:case s.H0.R8:case s.H0.R8I:case s.H0.R8UI:this.pixelFormat=s.Ab.RED}}static validate(e,t){return new l(e,t)}}let c=class e{constructor(e,t=null,r=null){if(this.type=o.p.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,r=t;else{const r=l.validate(e,t);if(!r)throw new i.A("Texture descriptor invalid");this._descriptor=r}this._descriptor.target===s.Ap.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return(0,a.e)(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._glName&&this._descriptor.context.instanceCounter.decrement(s.vt.Texture,this),this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(e,t){const r=this._descriptor;if(r.width!==e||r.height!==t){if(this._wasImmutablyAllocated)throw new i.A("Immutable textures can't be resized!");r.width=e,r.height=t,this._descriptor.target===s.Ap.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let t=s.Ap.TEXTURE_CUBE_MAP_POSITIVE_X;t<=s.Ap.TEXTURE_CUBE_MAP_NEGATIVE_Z;t++)this._setData(e,t)}setData(e){this._setData(e)}_setData(t,r){if(!this._descriptor.context?.gl)return;const o=this._descriptor.context.gl;(0,n.Y2)(o),this._glName||(this._glName=o.createTexture(),this._glName&&this._descriptor.context.instanceCounter.increment(s.vt.Texture,this)),void 0===t&&(t=null);const a=this._descriptor,l=r??a.target,c=m(l);null===t&&(a.width=a.width||4,a.height=a.height||4,c&&(a.depth=a.depth??1));const y=this._descriptor.context.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),u(a),this._configurePixelStorage(),(0,n.Y2)(o);const _=this._deriveInternalFormat();if(f(t)){let e="width"in t?t.width:t.codedWidth,r="height"in t?t.height:t.codedHeight;const i=1;t instanceof HTMLVideoElement&&(e=t.videoWidth,r=t.videoHeight),a.width&&a.height,c&&a.depth,a.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(l,_,a.hasMipmap,e,r,i),this._texImage(l,0,_,e,r,i,t),(0,n.Y2)(o),a.hasMipmap&&this.generateMipmap(),a.width||(a.width=e),a.height||(a.height=r),c&&!a.depth&&(a.depth=i)}else{const{width:e,height:r,depth:u}=a;if(null==e||null==r)throw new i.A("Width and height must be specified!");if(c&&null==u)throw new i.A("Depth must be specified!");if(a.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(l,_,a.hasMipmap,e,r,u),p(t)){const n=t.levels,c=g(l,e,r,u),h=Math.min(c-1,n.length-1);o.texParameteri(a.target,this._descriptor.context.gl.TEXTURE_MAX_LEVEL,h);const d=_;if(!(d in s.CQ))throw new i.A("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel(((e,t,r,i)=>{const s=n[Math.min(e,n.length-1)];this._compressedTexImage(l,e,d,t,r,i,s)}),h)}else this._texImage(l,0,_,e,r,u,t),(0,n.Y2)(o),a.hasMipmap&&this.generateMipmap()}h(o,this._descriptor),d(o,this._descriptor),function(e,t){const r=e.capabilities.textureFilterAnisotropic;r&&e.gl.texParameterf(t.target,r.TEXTURE_MAX_ANISOTROPY,t.maxAnisotropy??1)}(this._descriptor.context,this._descriptor),(0,n.Y2)(o),this._descriptor.context.bindTexture(y,e.TEXTURE_UNIT_FOR_UPDATES)}updateData(t,r,n,s,o,a,l=0){a||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._descriptor,u=this._deriveInternalFormat(),{context:h,pixelFormat:d,dataType:m,target:g,isImmutable:y}=c;if(y&&!this._wasImmutablyAllocated)throw new i.A("Cannot update immutable texture before allocation!");const _=h.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES,!0);(r<0||n<0||r+s>c.width||n+o>c.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:v}=h;l&&v.pixelStorei(v.UNPACK_SKIP_ROWS,l),f(a)?v.texSubImage2D(g,t,r,n,s,o,d,m,a):p(a)?v.compressedTexSubImage2D(g,t,r,n,s,o,u,a.levels[t]):v.texSubImage2D(g,t,r,n,s,o,d,m,a),l&&v.pixelStorei(v.UNPACK_SKIP_ROWS,0),h.bindTexture(_,e.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(t,r,n,s,o,a,l,c){c||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const u=this._descriptor,h=this._deriveInternalFormat(),{context:d,pixelFormat:f,dataType:g,isImmutable:y,target:_}=u;if(y&&!this._wasImmutablyAllocated)throw new i.A("Cannot update immutable texture before allocation!");m(_)||console.warn("Attempting to set 3D texture data on a non-3D texture");const v=d.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);d.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),(r<0||n<0||s<0||r+o>u.width||n+a>u.height||s+l>u.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:b}=d;if(p(c))c=c.levels[t],b.compressedTexSubImage3D(_,t,r,n,s,o,a,l,h,c);else{const e=c;b.texSubImage3D(_,t,r,n,s,o,a,l,f,g,e)}d.bindTexture(v,e.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const t=this._descriptor;if(!t.hasMipmap){if(this._wasImmutablyAllocated)throw new i.A("Cannot add mipmaps to immutable texture after allocation");t.hasMipmap=!0,this._samplingModeDirty=!0,u(t)}t.samplingMode===s.Cj.LINEAR?(this._samplingModeDirty=!0,t.samplingMode=s.Cj.LINEAR_MIPMAP_NEAREST):t.samplingMode===s.Cj.NEAREST&&(this._samplingModeDirty=!0,t.samplingMode=s.Cj.NEAREST_MIPMAP_NEAREST);const r=this._descriptor.context.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(t.target),this._descriptor.context.bindTexture(r,e.TEXTURE_UNIT_FOR_UPDATES)}clearMipmap(){const e=this._descriptor;if(e.hasMipmap){if(this._wasImmutablyAllocated)throw new i.A("Cannot delete mipmaps to immutable texture after allocation");e.hasMipmap=!1,this._samplingModeDirty=!0,u(e)}e.samplingMode===s.Cj.LINEAR_MIPMAP_NEAREST?(this._samplingModeDirty=!0,e.samplingMode=s.Cj.LINEAR):e.samplingMode===s.Cj.NEAREST_MIPMAP_NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=s.Cj.NEAREST)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,u(this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._descriptor,t=e.context.gl;this._samplingModeDirty&&(h(t,e),this._samplingModeDirty=!1),this._wrapModeDirty&&(d(t,e),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(null!=this._descriptor.internalFormat)return this._descriptor.internalFormat===s.Ab.DEPTH_STENCIL&&(this._descriptor.internalFormat=s.Ab.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case s.ld.FLOAT:switch(this._descriptor.pixelFormat){case s.Ab.RGBA:return this._descriptor.internalFormat=s.H0.RGBA32F;case s.Ab.RGB:return this._descriptor.internalFormat=s.H0.RGB32F;default:throw new i.A("Unable to derive format")}case s.ld.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case s.Ab.RGBA:return this._descriptor.internalFormat=s.H0.RGBA8;case s.Ab.RGB:return this._descriptor.internalFormat=s.H0.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===s.Ab.DEPTH_STENCIL?s.Ab.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:t,flipped:r,preMultiplyAlpha:i}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,t),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i?1:0)}_texStorage(e,t,r,n,o,a){const{gl:l}=this._descriptor.context;if(!(t in s.H0))throw new i.A("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const c=r?g(e,n,o,a):1;if(m(e)){if(null==a)throw new i.A("Missing depth dimension for 3D texture upload");l.texStorage3D(e,c,t,n,o,a)}else l.texStorage2D(e,c,t,n,o);this._wasImmutablyAllocated=!0}_texImage(e,t,r,n,s,o,a){const l=this._descriptor.context.gl,c=m(e),{isImmutable:u,pixelFormat:h,dataType:d}=this._descriptor;if(u){if(null!=a){const r=a;if(c){if(null==o)throw new i.A("Missing depth dimension for 3D texture upload");l.texSubImage3D(e,t,0,0,0,n,s,o,h,d,r)}else l.texSubImage2D(e,t,0,0,n,s,h,d,r)}}else{const u=a;if(c){if(null==o)throw new i.A("Missing depth dimension for 3D texture upload");l.texImage3D(e,t,r,n,s,o,0,h,d,u)}else l.texImage2D(e,t,r,n,s,0,h,d,u)}}_compressedTexImage(e,t,r,n,s,o,a){const l=this._descriptor.context.gl,c=m(e);if(this._descriptor.isImmutable){if(null!=a)if(c){if(null==o)throw new i.A("Missing depth dimension for 3D texture upload");l.compressedTexSubImage3D(e,t,0,0,0,n,s,o,r,a)}else l.compressedTexSubImage2D(e,t,0,0,n,s,r,a)}else if(c){if(null==o)throw new i.A("Missing depth dimension for 3D texture upload");l.compressedTexImage3D(e,t,r,n,s,o,0,a)}else l.compressedTexImage2D(e,t,r,n,s,0,a)}_forEachMipmapLevel(e,t=1/0){let{width:r,height:n,depth:o,hasMipmap:a,target:l}=this._descriptor;const c=l===s.Ap.TEXTURE_3D;if(null==r||null==n||c&&null==o)throw new i.A("Missing texture dimensions for mipmap calculation");for(let i=0;e(i,r,n,o),a&&(1!==r||1!==n||c&&1!==o)&&!(i>=t);++i)r=Math.max(1,r>>1),n=Math.max(1,n>>1),c&&(o=Math.max(1,o>>1))}};function u(e){(null!=e.width&&e.width<0||null!=e.height&&e.height<0||null!=e.depth&&e.depth<0)&&console.error("Negative dimension parameters are not allowed!")}function h(e,t){let r=t.samplingMode,i=t.samplingMode;r===s.Cj.LINEAR_MIPMAP_NEAREST||r===s.Cj.LINEAR_MIPMAP_LINEAR?(r=s.Cj.LINEAR,t.hasMipmap||(i=s.Cj.LINEAR)):r!==s.Cj.NEAREST_MIPMAP_NEAREST&&r!==s.Cj.NEAREST_MIPMAP_LINEAR||(r=s.Cj.NEAREST,t.hasMipmap||(i=s.Cj.NEAREST)),e.texParameteri(t.target,e.TEXTURE_MAG_FILTER,r),e.texParameteri(t.target,e.TEXTURE_MIN_FILTER,i)}function d(e,t){"number"==typeof t.wrapMode?(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode)):(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode.s),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode.t))}function p(e){return null!=e&&"type"in e&&"compressed"===e.type}function f(e){return null!=e&&!p(e)&&!function(e){return null!=e&&"byteLength"in e}(e)}function m(e){return e===s.Ap.TEXTURE_3D||e===s.Ap.TEXTURE_2D_ARRAY}function g(e,t,r,i=1){let n=Math.max(t,r);return e===s.Ap.TEXTURE_3D&&(n=Math.max(n,i)),Math.round(Math.log(n)/Math.LN2)+1}c.TEXTURE_UNIT_FOR_UPDATES=0},10956:function(e,t,r){r.d(t,{R:function(){return s},e:function(){return o}});var i=r(85456),n=r(93380);class s{constructor(e=0,t=e){this.width=e,this.height=t,this.target=i.Ap.TEXTURE_2D,this.pixelFormat=i.Ab.RGBA,this.dataType=i.ld.UNSIGNED_BYTE,this.samplingMode=i.Cj.LINEAR,this.wrapMode=i.pF.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}}function o(e){return e.width<=0||e.height<=0?0:Math.round(e.width*e.height*(e.hasMipmap?4/3:1)*(null==e.internalFormat?4:(0,n.IB)(e.internalFormat)))}},93380:function(e,t,r){r.d(t,{Hi:function(){return l},IB:function(){return c},WH:function(){return o},yu:function(){return a}}),r(58941);var i=r(41835),n=r(85456),s=r(48347);function o(e){const t=e.gl;switch(t.getError()){case t.NO_ERROR:return null;case t.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case t.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case t.INVALID_OPERATION:return"The specified command is not allowed for the current state";case t.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case t.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case t.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function a(e,t,r,n,a=0){const l=e.gl;e.bindBuffer(r);for(const r of n){const n=t.get(r.name);if(void 0===n){console.warn(`There is no location for vertex attribute '${r.name}' defined.`);continue}const c=a*r.stride;if(r.count<=4)l.vertexAttribPointer(n,r.count,r.type,r.normalized,r.stride,r.offset+c),l.enableVertexAttribArray(n),r.divisor>0&&e.gl.vertexAttribDivisor(n,r.divisor);else if(9===r.count)for(let t=0;t<3;t++)l.vertexAttribPointer(n+t,3,r.type,r.normalized,r.stride,r.offset+12*t+c),l.enableVertexAttribArray(n+t),r.divisor>0&&e.gl.vertexAttribDivisor(n+t,r.divisor);else if(16===r.count)for(let t=0;t<4;t++)l.vertexAttribPointer(n+t,4,r.type,r.normalized,r.stride,r.offset+16*t+c),l.enableVertexAttribArray(n+t),r.divisor>0&&e.gl?.vertexAttribDivisor(n+t,r.divisor);else console.error("Unsupported vertex attribute element count: "+r.count);if((0,i.en)()){const t=o(e),i=(0,s._)(r.type),n=r.offset,a=Math.round(i/n)!==i/n?`. Offset not a multiple of stride. DataType requires ${i} bytes, but descriptor has an offset of ${n}`:"";t&&console.error(`Unable to bind vertex attribute "${r.name}" with baseInstanceOffset ${c}${a}:`,t,r)}}}function l(e,t,r,i){const s=e.gl;e.bindBuffer(r);for(const r of i){const i=t.get(r.name);if(r.count<=4)s.disableVertexAttribArray(i),r.divisor&&r.divisor>0&&e.gl?.vertexAttribDivisor(i,0);else if(9===r.count)for(let t=0;t<3;t++)s.disableVertexAttribArray(i+t),r.divisor&&r.divisor>0&&e.gl?.vertexAttribDivisor(i+t,0);else if(16===r.count)for(let t=0;t<4;t++)s.disableVertexAttribArray(i+t),r.divisor&&r.divisor>0&&e.gl?.vertexAttribDivisor(i+t,0);else console.error("Unsupported vertex attribute element count: "+r.count)}e.unbindBuffer(n.NZ.ARRAY_BUFFER)}function c(e){switch(e){case n.Ab.ALPHA:case n.Ab.LUMINANCE:case n.Ab.RED:case n.Ab.RED_INTEGER:case n.H0.R8:case n.H0.R8I:case n.H0.R8UI:case n.H0.R8_SNORM:case n.yQ.STENCIL_INDEX8:return 1;case n.Ab.LUMINANCE_ALPHA:case n.Ab.RG:case n.Ab.RG_INTEGER:case n.H0.RGBA4:case n.H0.R16F:case n.H0.R16I:case n.H0.R16UI:case n.H0.RG8:case n.H0.RG8I:case n.H0.RG8UI:case n.H0.RG8_SNORM:case n.H0.RGB565:case n.H0.RGB5_A1:case n.yQ.DEPTH_COMPONENT16:return 2;case n.Ab.DEPTH_COMPONENT:case n.Ab.RGB:case n.Ab.RGB_INTEGER:case n.H0.RGB8:case n.H0.RGB8I:case n.H0.RGB8UI:case n.H0.RGB8_SNORM:case n.H0.SRGB8:case n.yQ.DEPTH_COMPONENT24:return 3;case n.Ab.DEPTH_STENCIL:case n.Ab.DEPTH24_STENCIL8:case n.Ab.RGBA:case n.Ab.RGBA_INTEGER:case n.H0.RGBA8:case n.H0.R32F:case n.H0.R11F_G11F_B10F:case n.H0.RG16F:case n.H0.R32I:case n.H0.R32UI:case n.H0.RG16I:case n.H0.RG16UI:case n.H0.RGBA8I:case n.H0.RGBA8UI:case n.H0.RGBA8_SNORM:case n.H0.SRGB8_ALPHA8:case n.H0.RGB9_E5:case n.H0.RGB10_A2UI:case n.H0.RGB10_A2:case n.yQ.DEPTH_STENCIL:case n.yQ.DEPTH_COMPONENT32F:case n.yQ.DEPTH24_STENCIL8:return 4;case n.yQ.DEPTH32F_STENCIL8:return 5;case n.H0.RGB16F:case n.H0.RGB16I:case n.H0.RGB16UI:return 6;case n.H0.RG32F:case n.H0.RG32I:case n.H0.RG32UI:case n.H0.RGBA16F:case n.H0.RGBA16I:case n.H0.RGBA16UI:return 8;case n.H0.RGB32F:case n.H0.RGB32I:case n.H0.RGB32UI:return 12;case n.H0.RGBA32F:case n.H0.RGBA32I:case n.H0.RGBA32UI:return 16;case n.CQ.COMPRESSED_RGB_S3TC_DXT1_EXT:case n.CQ.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case n.CQ.COMPRESSED_RGBA_S3TC_DXT3_EXT:case n.CQ.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case n.CQ.COMPRESSED_R11_EAC:case n.CQ.COMPRESSED_SIGNED_R11_EAC:case n.CQ.COMPRESSED_RGB8_ETC2:case n.CQ.COMPRESSED_SRGB8_ETC2:case n.CQ.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case n.CQ.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;case n.CQ.COMPRESSED_RG11_EAC:case n.CQ.COMPRESSED_SIGNED_RG11_EAC:case n.CQ.COMPRESSED_RGBA8_ETC2_EAC:case n.CQ.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}},81438:function(e,t,r){r.d(t,{Z:function(){return c}});var i=r(40633),n=r(95929),s=r(24540),o=r(85456),a=r(93380);const l=()=>i.A.getLogger("esri.views.webgl.VertexArrayObject");let c=class{constructor(e,t,r,i,n=null){this._context=e,this._locations=t,this._layout=r,this._buffers=i,this._indexBuffer=n,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce(((e,t)=>e+this._buffers[t].usedMemory),null!=this._indexBuffer?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*s.zQ}dispose(){if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const e in this._buffers)this._buffers[e]?.dispose(),delete this._buffers[e];this._indexBuffer=(0,n.WD)(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&l().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(o.vt.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:e}=this._context,t=e.createVertexArray();e.bindVertexArray(t),this._bindLayout(),e.bindVertexArray(null),this._glName=t,this._context.instanceCounter.increment(o.vt.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:e,_layout:t,_indexBuffer:r}=this;e||l().error("Vertex buffer dictionary is empty!");const i=this._context.gl;for(const r in e){const i=e[r];i||l().error("Vertex buffer is uninitialized!");const n=t[r];n||l().error("Vertex element descriptor is empty!"),(0,a.yu)(this._context,this._locations,i,n)}null!=r&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,r.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}}},3817:function(e,t,r){r.d(t,{_:function(){return i}});class i{constructor(e,t,r,i,n,s=!1,o=0){this.name=e,this.count=t,this.type=r,this.offset=i,this.stride=n,this.normalized=s,this.divisor=o}}},41835:function(e,t,r){r.d(t,{Xc:function(){return c},Y2:function(){return u},en:function(){return l}});var i=r(39819),n=r(58941),s=r(40633);const o=()=>s.A.getLogger("esri.views.webgl.checkWebGLError"),a=!!(0,n.A)("enable-feature:webgl-debug");function l(){return a}function c(){return a}function u(e){if(l()){const t=e.getError();if(t){const r=function(e,t){switch(t){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}(e,t),n=(new Error).stack;o().error(new i.A("webgl-error","WebGL error occurred",{message:r,stack:n}))}}}},44476:function(e,t,r){function i(e,t,r){for(let i=0;i<r;++i)t[2*i]=e[i],t[2*i+1]=e[i]-t[2*i]}function n(e,t){const r=e.length;for(let i=0;i<r;++i)o[0]=e[i],t[i]=o[0];return t}function s(e,t){const r=e.length;for(let i=0;i<r;++i)o[0]=e[i],o[1]=e[i]-o[0],t[i]=o[1];return t}r.d(t,{Zo:function(){return n},jA:function(){return s},jS:function(){return i}});const o=new Float32Array(2)},85456:function(e,t,r){var i,n,s,o,a,l,c,u,h,d,p,f,m,g,y,_,v,b,x,S;r.d(t,{Ab:function(){return g},Ac:function(){return c},Ap:function(){return m},CQ:function(){return M},Cj:function(){return p},Co:function(){return x},H0:function(){return y},Hr:function(){return C},MT:function(){return h},NZ:function(){return a},Nm:function(){return A},R:function(){return S},Tb:function(){return o},WR:function(){return n},Y7:function(){return l},_U:function(){return b},dn:function(){return s},eA:function(){return d},hn:function(){return i},ld:function(){return _},nI:function(){return E},pF:function(){return f},pe:function(){return u},sS:function(){return I},tx:function(){return L},vt:function(){return T},xM:function(){return w},xV:function(){return R},yQ:function(){return v}}),function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"}(i||(i={})),function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(n||(n={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(s||(s={})),function(e){e[e.ADD=32774]="ADD",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.SUBTRACT=32778]="SUBTRACT",e[e.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(o||(o={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER"}(a||(a={})),function(e){e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(l||(l={})),function(e){e[e.CW=2304]="CW",e[e.CCW=2305]="CCW"}(c||(c={})),function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.HALF_FLOAT=5131]="HALF_FLOAT"}(u||(u={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(h||(h={})),function(e){e[e.ZERO=0]="ZERO",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP"}(d||(d={})),function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(p||(p={})),function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(f||(f={})),function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(m||(m={})),function(e){e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.RG=33319]="RG",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER"}(g||(g={})),function(e){e[e.RGBA4=32854]="RGBA4",e[e.R16F=33325]="R16F",e[e.RG16F=33327]="RG16F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.R32F=33326]="R32F",e[e.RG32F=33328]="RG32F",e[e.RGBA32F=34836]="RGBA32F",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB5_A1=32855]="RGB5_A1",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.RGB16F=34843]="RGB16F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.RGB565=36194]="RGB565",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2=32857]="RGB10_A2",e[e.RGB10_A2UI=36975]="RGB10_A2UI"}(y||(y={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.INT=5124]="INT",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(_||(_={})),function(e){e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(v||(v={})),function(e){e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_READ=35045]="STATIC_READ",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.STREAM_COPY=35042]="STREAM_COPY"}(b||(b={})),function(e){e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER"}(x||(x={})),function(e){e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(S||(S={}));const w=33984;var T,A,C;!function(e){e[e.Texture=0]="Texture",e[e.BufferObject=1]="BufferObject",e[e.VertexArrayObject=2]="VertexArrayObject",e[e.Shader=3]="Shader",e[e.Program=4]="Program",e[e.FramebufferObject=5]="FramebufferObject",e[e.Renderbuffer=6]="Renderbuffer",e[e.TransformFeedback=7]="TransformFeedback",e[e.Sync=8]="Sync",e[e.UNCOUNTED=9]="UNCOUNTED",e[e.LinesOfCode=9]="LinesOfCode",e[e.Uniform=10]="Uniform",e[e.COUNT=11]="COUNT"}(T||(T={})),function(e){e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(A||(A={})),function(e){e[e.NONE=0]="NONE",e[e.BACK=1029]="BACK"}(C||(C={}));const E=33306;var M,R,P,O,I,L,N;!function(e){e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"}(M||(M={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT=5124]="INT",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(R||(R={})),function(e){e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS"}(P||(P={})),function(e){e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED"}(O||(O={})),function(e){e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED"}(I||(I={})),function(e){e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(L||(L={})),function(e){e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(N||(N={}))},48347:function(e,t,r){r.d(t,{_:function(){return n}});var i=r(85456);function n(e){switch(e){case i.pe.BYTE:case i.pe.UNSIGNED_BYTE:return 1;case i.pe.SHORT:case i.pe.UNSIGNED_SHORT:case i.pe.HALF_FLOAT:return 2;case i.pe.FLOAT:case i.pe.INT:case i.pe.UNSIGNED_INT:return 4}}},57087:function(e,t,r){r.d(t,{Ey:function(){return x},Ms:function(){return k},Xt:function(){return c},hG:function(){return l},kn:function(){return u},ox:function(){return s},p3:function(){return o},wE:function(){return h}});var i=r(54407),n=r(85456);function s(e,t,r=n.Tb.ADD,i=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:r,opAlpha:r,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function o(e,t,r,i,s=n.Tb.ADD,o=n.Tb.ADD,a=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:r,dstAlpha:i,opRgb:s,opAlpha:o,color:{r:a[0],g:a[1],b:a[2],a:a[3]}}}const a={face:n.Y7.BACK,mode:n.Ac.CCW},l={face:n.Y7.FRONT,mode:n.Ac.CCW},c=e=>e===i.s2.Back?a:e===i.s2.Front?l:null,u={zNear:0,zFar:1},h={r:!0,g:!0,b:!0,a:!0};function d(e){return T.intern(e)}function p(e){return C.intern(e)}function f(e){return M.intern(e)}function m(e){return P.intern(e)}function g(e){return I.intern(e)}function y(e){return N.intern(e)}function _(e){return F.intern(e)}function v(e){return V.intern(e)}function b(e){return G.intern(e)}function x(e){return H.intern(e)}class S{constructor(e,t){this._makeKey=e,this._makeRef=t,this._interns=new Map}intern(e){if(!e)return null;const t=this._makeKey(e),r=this._interns;return r.has(t)||r.set(t,this._makeRef(e)),r.get(t)??null}}function w(e){return"["+e.join(",")+"]"}const T=new S(A,(e=>({__tag:"Blending",...e})));function A(e){return e?w([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const C=new S(E,(e=>({__tag:"Culling",...e})));function E(e){return e?w([e.face,e.mode]):null}const M=new S(R,(e=>({__tag:"PolygonOffset",...e})));function R(e){return e?w([e.factor,e.units]):null}const P=new S(O,(e=>({__tag:"DepthTest",...e})));function O(e){return e?w([e.func]):null}const I=new S(L,(e=>({__tag:"StencilTest",...e})));function L(e){return e?w([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const N=new S(D,(e=>({__tag:"DepthWrite",...e})));function D(e){return e?w([e.zNear,e.zFar]):null}const F=new S(z,(e=>({__tag:"ColorWrite",...e})));function z(e){return e?w([e.r,e.g,e.b,e.a]):null}const V=new S(U,(e=>({__tag:"StencilWrite",...e})));function U(e){return e?w([e.mask]):null}const G=new S(B,(e=>({__tag:"DrawBuffers",...e})));function B(e){return e?w(e.buffers):null}const H=new S((function(e){return e?w([A(e.blending),E(e.culling),R(e.polygonOffset),O(e.depthTest),L(e.stencilTest),D(e.depthWrite),z(e.colorWrite),U(e.stencilWrite),B(e.drawBuffers)]):null}),(e=>({blending:d(e.blending),culling:p(e.culling),polygonOffset:f(e.polygonOffset),depthTest:m(e.depthTest),stencilTest:g(e.stencilTest),depthWrite:y(e.depthWrite),colorWrite:_(e.colorWrite),stencilWrite:v(e.stencilWrite),drawBuffers:b(e.drawBuffers)})));class k{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._setDrawBuffers(e.drawBuffers),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(e){this._drawBuffers=this._setSubState(e,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(e,t,r,i){return(r||e!==t)&&(i(e),this._pipelineInvalid=!0),e}}},84624:function(e,t,r){r.d(t,{CJ:function(){return d}});var i=r(39819),n=r(21609),s=r(34194),o=r(47527),a=r(11432);const l=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),c=new Set(["catalog","csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","knowledge-graph","map-image","map-notes","media","ogc-feature","oriented-imagery","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function u(e,t){if(t.restrictedWebMapWriting){const r=function(e){return"basemap"===e.layerContainerType?l:"operational-layers"===e.layerContainerType?c:null}(t);return null==r||r.has(e.type)&&!(0,a.Ov)(e)}return!0}function h(e,t){"maxScale"in e&&(t.maxScale=(0,o.B)(e.maxScale)??void 0),"minScale"in e&&(t.minScale=(0,o.B)(e.minScale)??void 0)}function d(e,t,r){if(!e.persistenceEnabled)return null;if(!("write"in e)||!e.write)return r?.messages&&r.messages.push(new i.A("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted`,{layer:e})),null;if((0,a.Ov)(e)&&!e.isTable)t=e.resourceInfo;else if(u(e,r)){const t={};return e.write(t,r)?t:null}return null!=t&&function(e,t){if(function(e,t){if(t)if((0,a.Ov)(e)){const r=(0,s.wc)("featureCollection.layers",t),i=r?.[0]?.layerDefinition;i&&h(e,i)}else"group"!==e.type&&h(e,t)}(e,t),t&&(t.id=e.id,"blendMode"in e&&(t.blendMode=e.blendMode,"normal"===t.blendMode&&delete t.blendMode),t.opacity=(0,o.B)(e.opacity)??void 0,t.title=e.title||"Layer",t.visibility=e.visible,"legendEnabled"in e&&"wmts"!==e.type))if((0,a.Ov)(e)){const r=t.featureCollection;r&&(r.showLegend=e.legendEnabled)}else t.showLegend=e.legendEnabled}(e,t=(0,n.o8)(t)),t}}}]);
//# sourceMappingURL=views-3d-layers-GraphicsLayerView3D.js.map