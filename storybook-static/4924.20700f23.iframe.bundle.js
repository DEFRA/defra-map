"use strict";(self.webpackChunk_defra_flood_map=self.webpackChunk_defra_flood_map||[]).push([[4924],{"./node_modules/@arcgis/core/layers/support/TitleCreator.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>u});var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_core_Accessor_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js"),_core_asyncUtils_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/asyncUtils.js"),_core_Collection_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/core/Collection.js"),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_8__=(__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),__webpack_require__("./node_modules/@arcgis/core/core/RandomLCG.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),_fieldUtils_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/layers/support/fieldUtils.js"),_support_arcadeOnDemand_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/support/arcadeOnDemand.js");let d=class extends _core_Accessor_js__WEBPACK_IMPORTED_MODULE_1__.A{constructor(e){super(e),this._featureUtils=null,this.effectivePopupTemplate=null}get _arcadeTask(){return this.expressionsUsedInTitle.length>0?this._get("_arcadeTask")||(0,_core_asyncUtils_js__WEBPACK_IMPORTED_MODULE_2__.UT)((()=>(0,_support_arcadeOnDemand_js__WEBPACK_IMPORTED_MODULE_10__.lw)())):null}get featureUtilsPromise(){return this._get("featureUtilsPromise")??__webpack_require__.e(8924).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/widgets/Feature/support/featureUtils.js")).then((e=>this._featureUtils=e))}get calculatedExpressions(){const e=new _core_Collection_js__WEBPACK_IMPORTED_MODULE_3__.A;if(!this.expressionsUsedInTitle.length)return e;if(!this._arcadeTask?.value){for(const t of this.expressionsUsedInTitle??[])e.push({name:t.name,invalid:!0});return e}for(const t of this.expressionsUsedInTitle)try{const s=this._arcadeTask.value.arcade.parseScript(t.expression,["$layer","$map","$datastore"]);if(s.isAsync){e.push({name:t.name,invalid:!0});break}e.push({name:t.name,syntax:s,invalid:!1,func:this._arcadeTask.value.arcade.compileScript(s,{vars:{$feature:"any"}})})}catch{e.push({name:t.name,invalid:!0});break}return e}get expressionsUsedInTitle(){let e=this.effectivePopupTemplate?.title??"";return"string"!=typeof e?[]:(e=e.toLowerCase(),this.effectivePopupTemplate?.expressionInfos?.filter((t=>e.includes(`{expression/${t.name.toLowerCase()}}`)))??[])}get fieldInfoMap(){return this._featureUtils?this._createFieldInfoMap(this._featureUtils.getAllFieldInfos(this.effectivePopupTemplate)):null}get hasBadExpressions(){return this.calculatedExpressions.some((e=>!0===e.invalid))}get requiredFields(){const e=new Set;if(this._arcadeTask?.value&&!this.hasBadExpressions)for(const s of this.calculatedExpressions?.toArray()??[])try{const t=this._arcadeTask.value.arcade.extractFieldLiterals(s.syntax);for(const s of t){const t=s.split("."),i=this.fieldsIndex.get(t.at(-1)??"");i&&e.add(i.name)}}catch{}const t=this._extractFieldNames(this.workingTitle);for(const s of t){const t=this.fieldsIndex.get(s);t&&e.add(t.name)}return e}get titleFromDisplayField(){let e="";return this.displayField&&(e=this.fieldsIndex.get(this.displayField)?.name??""),e||(e=this.fieldsIndex.get(this.objectIdField)?.name??""),e?`{${e}}`:""}get workingTitle(){const e=this.effectivePopupTemplate?this.effectivePopupTemplate.title:"";return""===e||null==e||this.hasBadExpressions||"string"!=typeof e?this.titleFromDisplayField:e}async getTitle(e,t,s){try{const{attributes:i}=t,r=s?.timeZone??"system",[{substituteFieldsInLinksAndAttributes:a}]=await Promise.all([this.featureUtilsPromise,this._arcadeTask?.promise]);if(s.fetchMissingFields&&(t=await this._checkAndReQueryGraphic(e,t)),this.workingTitle&&this.fieldInfoMap){const s=this._createFormattedAttributes(e,t,r).global;return a({attributes:i,expressionAttributes:null,fieldInfoMap:this.fieldInfoMap,globalAttributes:s,layer:e,text:this.workingTitle})}return""}catch{}return""}async _checkAndReQueryGraphic(e,t){const s=t.getObjectId();if(null==s)return t;if(!(0,_fieldUtils_js__WEBPACK_IMPORTED_MODULE_9__.Kl)(this.requiredFields,t)){const t=e.createQuery();t.where="1=1",t.outFields=[...this.requiredFields],t.objectIds=[s];const i=await e.queryFeatures(t);if(1===i?.features.length)return i.features[0]}return t}_createFieldInfoMap(e){const t=new Map;if(!e)return t;for(const s of e){if(!s.fieldName)continue;const e=this.fieldsIndex.get(s.fieldName),i=e?.name??s.fieldName;s.fieldName=i,t.set(i.toLowerCase(),s)}return t}_createFormattedAttributes(e,t,s="system"){const i=this.effectivePopupTemplate?.fieldInfos??[],r={};if(!this._featureUtils)return{};if(!this.hasBadExpressions&&this.calculatedExpressions.length>0&&this._arcadeTask?.value){const s=this._arcadeTask.value.Feature.createFromGraphicLikeObject(t.geometry,t.attributes,e,null);for(const e of this.calculatedExpressions)try{r[`expression/${e.name}`]=e.func({vars:{$feature:s}})}catch{}}const a={...t.attributes,...r};return{global:this._featureUtils.formatAttributes({fieldInfos:i,attributes:a,graphic:t,timeZone:s,layer:e,fieldInfoMap:this.fieldInfoMap}),content:[]}}_extractFieldNames(e){return(0,_fieldUtils_js__WEBPACK_IMPORTED_MODULE_9__.nw)(e).filter((e=>!(0===e.indexOf("relationships/")||0===e.indexOf("expression/"))))}};(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.MZ)({readOnly:!0})],d.prototype,"_arcadeTask",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.MZ)()],d.prototype,"_featureUtils",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.MZ)({readOnly:!0})],d.prototype,"featureUtilsPromise",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.MZ)({readOnly:!0})],d.prototype,"calculatedExpressions",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.MZ)()],d.prototype,"displayField",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.MZ)()],d.prototype,"effectivePopupTemplate",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.MZ)()],d.prototype,"expressionsUsedInTitle",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.MZ)()],d.prototype,"fieldsIndex",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.MZ)()],d.prototype,"fieldInfoMap",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.MZ)()],d.prototype,"fields",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.MZ)()],d.prototype,"objectIdField",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.MZ)()],d.prototype,"requiredFields",null),d=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_8__.$)("esri.layers.support.TitleCreator")],d);const u=d},"./node_modules/@arcgis/core/layers/support/displayFilterUtils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ch:()=>c,mW:()=>i,u2:()=>u});var _core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/mathUtils.js"),_core_sql_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/sql.js");function i(e,n){return{...n,filterMode:e.mode}}function u(e,n){return l(e,n).next().value??null}function c(t,r,i){const u=function f(e){if("manual"===s(e))return null;const n=[Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY];for(const{minScale:t,maxScale:r}of e.filters)n[0]=Math.max(n[0],I(t)),n[1]=Math.min(n[1],d(r));return n}(t);if(u&&((0,_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__.gg)(r,u[0])||(0,_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__.ZH)(i,u[1])))return"";const c=Array.from(l(t,r,i)),m=function a(t,r,o){if(0===t.length)return!0;const i=I(t.at(0)?.minScale),u=d(t.at(-1)?.maxScale);if((0,_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__.ZH)(i,r)||(0,_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__.gg)(u,o))return!0;for(let e=0;e<t.length-1;e++){const r=t[e],o=t[e+1];if((0,_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__.ZH)(I(o.minScale),d(r.maxScale)))return!0}return!1}(c,r,i)?"1=1":c.map((e=>e.where||"1=1")).reduce(((e,n)=>(0,_core_sql_js__WEBPACK_IMPORTED_MODULE_1__.IW)(e,n)),"");return m&&"1=1"!==m?m:""}function*l(e,n,t){if("manual"===s(e)){const n=e.filters.find((n=>n.id===e.activeFilterId));n&&(yield n)}else{"object"==typeof n&&(n=n.scale);for(const r of e.filters)m(r.minScale,r.maxScale,n,t)&&(yield r)}}function m(e,n,o,i){return e=I(e),o=I(o),n=d(n),!(!(0,_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__.Sp)(o,e)&&(i??o)>e||(0,_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__.Hx)(n,o)||void 0!==i&&(0,_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__.Sp)(i,e))}function s(e){return"mode"in e?e.mode:e.filterMode}function I(e){return e||Number.POSITIVE_INFINITY}function d(e){return e||0}},"./node_modules/@arcgis/core/webdoc/interfaces.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{var A;__webpack_require__.d(__webpack_exports__,{X:()=>A}),function(A){A[A.SAVE=0]="SAVE",A[A.SAVE_AS=1]="SAVE_AS"}(A||(A={}))}}]);