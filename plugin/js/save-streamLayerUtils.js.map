{"version":3,"file":"js/save-streamLayerUtils.js","mappings":"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","sources":["webpack://defraMap/./node_modules/@arcgis/core/core/accessorSupport/originUtils.js","webpack://defraMap/./node_modules/@arcgis/core/core/multiOriginJSONSupportUtils.js","webpack://defraMap/./node_modules/@arcgis/core/layers/save/streamLayerUtils.js","webpack://defraMap/./node_modules/@arcgis/core/layers/save/utils.js","webpack://defraMap/./node_modules/@arcgis/core/portal/support/jsonContext.js","webpack://defraMap/./node_modules/@arcgis/core/webdoc/support/saveAPIKeyUtils.js","webpack://defraMap/./node_modules/@arcgis/core/webdoc/support/saveUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{isMultiOriginJSONMixin as r}from\"../multiOriginJSONSupportUtils.js\";function i(i){i?.writtenProperties&&i.writtenProperties.forEach((({target:i,propName:t,newOrigin:e})=>{r(i)&&e&&i.originOf(t)!==e&&i.updateOrigin(t,e)}))}export{i as updateOrigins};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nfunction i(i){return i&&\"getAtOrigin\"in i&&\"originOf\"in i}export{i as isMultiOriginJSONMixin};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{save as e,saveAs as t}from\"./utils.js\";import{getWGS84ExtentForItem as r,removeTypeKeyword as a,typeKeyword as s,addTypeKeyword as l}from\"../../portal/support/portalItemUtils.js\";const n=\"Stream Service\",i=\"Feed\",o=\"stream-layer-save\",m=\"stream-layer-save-as\";function u(e){return{isValid:\"stream\"===e.type&&!!e.url&&!e.webSocketUrl,errorMessage:\"Stream layer should be created using a url to a stream service\"}}function c(e){const t=e.layerJSON;return Promise.resolve(t&&Object.keys(t).length?t:null)}async function y(e,t){const{parsedUrl:n,title:i,fullExtent:o}=e;t.url=n.path,t.title||=i,t.extent=null,null!=o&&(t.extent=await r(o)),a(t,s.METADATA),l(t,s.SINGLE_LAYER)}async function p(t,r){return e({layer:t,itemType:n,additionalItemType:i,validateLayer:u,createItemData:c,errorNamePrefix:o},r)}async function f(e,r,a){return t({layer:e,itemType:n,validateLayer:u,createItemData:c,errorNamePrefix:m,newItem:r,setItemProperties:y},a)}export{p as save,f as saveAs};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import{updateOrigins as t}from\"../../core/accessorSupport/originUtils.js\";import r from\"../../portal/Portal.js\";import o from\"../../portal/PortalItem.js\";import{createForItemWrite as a}from\"../../portal/support/jsonContext.js\";import{addTypeKeyword as i,typeKeyword as n}from\"../../portal/support/portalItemUtils.js\";import{validateSaveAPIKey as s}from\"../../webdoc/support/saveAPIKeyUtils.js\";import{evaluateWriteErrors as p}from\"../../webdoc/support/saveUtils.js\";function l(t,r,o){const a=o(t);if(!a.isValid)throw new e(`${r}:invalid-parameters`,a.errorMessage,{layer:t})}async function m(e){const{layer:t,errorNamePrefix:r,validateLayer:o}=e;await t.load(),l(t,r,o)}function c(e,t){return`Layer (title: ${e.title}, id: ${e.id}) of type '${e.declaredClass}' ${t}`}function u(t){const{item:r,errorNamePrefix:o,layer:a,validateItem:i}=t;if(s(r),f(t),i){const t=i(r);if(!t.isValid)throw new e(`${o}:invalid-parameters`,t.errorMessage,{layer:a})}}function f(t){const{item:r,itemType:o,additionalItemType:a,errorNamePrefix:i,layer:n}=t,s=[o];if(a&&s.push(a),!s.includes(r.type)){const t=s.map((e=>`'${e}'`)).join(\", \");throw new e(`${i}:portal-item-wrong-type`,`Portal item type should be one of: \"${t}\"`,{item:r,layer:n})}}function d(t){const{layer:r,errorNamePrefix:o}=t,{portalItem:a}=r;if(!a)throw new e(`${o}:portal-item-not-set`,c(r,\"requires the portalItem property to be set\"));if(!a.loaded)throw new e(`${o}:portal-item-not-loaded`,c(r,\"cannot be saved to a portal item that does not exist or is inaccessible\"));u({...t,item:a})}function y(e){const{newItem:t,itemType:a}=e;let i=o.from(t);return i.id&&(i=i.clone(),i.id=null),i.type??=a,i.portal??=r.getDefault(),u({...e,item:i}),i}function w(e){return a(e,\"portal-item\")}async function I(e,t,r){\"beforeSave\"in e&&\"function\"==typeof e.beforeSave&&await e.beforeSave();const o=e.write({},t);return await Promise.all(t.resources?.pendingOperations??[]),p(t,{errorName:\"layer-write:unsupported\"},r),o}function v(e){i(e,n.JSAPI),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,r)=>r.indexOf(e)===t)))}async function P(e,t,r){const o=e.portal;await o.signIn(),await(o.user?.addItem({item:e,data:t,folder:r?.folder}))}async function $(e,r){const{layer:o,createItemData:a,createJSONContext:i,setItemProperties:n,saveResources:s,supplementalUnsupportedErrors:p}=e;await m(e),d(e);const l=o.portalItem,c=i?i(l):w(l),u=await I(o,c,{...r,supplementalUnsupportedErrors:p}),f=await a({layer:o,layerJSON:u},l);return await(n?.(o,l)),v(l),await l.update({data:f}),t(c),await(s?.(l,c)),l}async function j(e,r){const{layer:o,createItemData:a,createJSONContext:i,setItemProperties:n,saveResources:s,supplementalUnsupportedErrors:p}=e;await m(e);const l=y(e),c=i?i(l):w(l),u=await I(o,c,{...r,supplementalUnsupportedErrors:p}),f=await a({layer:o,layerJSON:u},l);return await n(o,l),v(l),await P(l,f,r),o.portalItem=l,t(c),await(s?.(l,c)),l}export{P as addItem,c as createErrorMessage,w as createJSONContextForWrite,d as ensureItemConfig,l as ensureLayerConfig,I as getLayerJSON,y as getPortalItem,$ as save,j as saveAs,v as setCommonItemProperties};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{urlToObject as t}from\"../../core/urlUtils.js\";import r from\"../Portal.js\";function e(t,r){return{...l(t,r),readResourcePaths:[]}}function o(r,e,o){const i=t(r.itemUrl);return{...l(r,e),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:i?{rootPath:i.path,writtenUrls:[]}:null,resources:o?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function l(e,o){return{origin:o,url:t(e.itemUrl),portal:e.portal||r.getDefault(),portalItem:e}}export{e as createForItemRead,o as createForItemWrite};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport o from\"../../config.js\";import r from\"../../core/Error.js\";import{supportsApiKey as p}from\"../../support/apiKeyUtils.js\";function i(i){if(o.apiKey&&p(i.portal.url))throw new r(\"save-api-key-utils:api-key-not-supported\",`Saving is not supported on ${i.portal.url} when using an api key`)}export{i as validateSaveAPIKey};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";async function r(e){const r=[];for(const o of e.allLayers)if(\"beforeSave\"in o&&\"function\"==typeof o.beforeSave){const e=o.beforeSave();e&&r.push(e)}await Promise.allSettled(r)}const o=new Set([\"layer:unsupported\",\"property:unsupported\",\"symbol:unsupported\",\"symbol-layer:unsupported\",\"url:unsupported\"]);function t(r,t,n){let s=(r.messages??[]).filter((({type:e})=>\"error\"===e)).map((({name:r,message:o,details:t})=>new e(r,o,t)));if(r.blockedRelativeUrls&&(s=s.concat(r.blockedRelativeUrls.map((r=>new e(\"url:unsupported\",`Relative url '${r}' is not supported`))))),n){const{ignoreUnsupported:e,supplementalUnsupportedErrors:r=[],requiredPropertyChecksDisabled:t}=n;e&&(s=s.filter((({name:e})=>!(o.has(e)||r.includes(e))))),t&&(s=s.filter((e=>\"web-document-write:property-required\"!==e.name)))}if(s.length>0)throw new e(t.errorName,\"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information\",{errors:s})}export{r as beforeSave,t as evaluateWriteErrors};\n"],"names":["i","writtenProperties","forEach","target","propName","t","newOrigin","e","originOf","updateOrigin","n","o","m","u","isValid","type","url","webSocketUrl","errorMessage","c","layerJSON","Promise","resolve","Object","keys","length","async","y","parsedUrl","title","fullExtent","path","extent","METADATA","SINGLE_LAYER","p","r","layer","itemType","additionalItemType","validateLayer","createItemData","errorNamePrefix","f","a","newItem","setItemProperties","load","l","id","declaredClass","item","validateItem","s","push","includes","map","join","d","portalItem","loaded","from","clone","portal","getDefault","w","I","beforeSave","write","all","resources","pendingOperations","errorName","v","JSAPI","typeKeywords","filter","indexOf","$","createJSONContext","saveResources","supplementalUnsupportedErrors","update","data","j","signIn","user","addItem","folder","P","readResourcePaths","itemUrl","messages","blockedRelativeUrls","verifyItemRelativeUrls","rootPath","writtenUrls","toAdd","toUpdate","toKeep","origin","apiKey","allLayers","allSettled","Set","name","message","details","concat","ignoreUnsupported","requiredPropertyChecksDisabled","has","errors"],"sourceRoot":""}