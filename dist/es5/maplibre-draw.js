(self.webpackChunk_defra_flood_map=self.webpackChunk_defra_flood_map||[]).push([[194],{17:function(e){e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var o,r,i;if(Array.isArray(t)){if((o=t.length)!=n.length)return!1;for(r=o;0!=r--;)if(!e(t[r],n[r]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((o=(i=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(r=o;0!=r--;)if(!Object.prototype.hasOwnProperty.call(n,i[r]))return!1;for(r=o;0!=r--;){var s=i[r];if(!e(t[s],n[s]))return!1}return!0}return t!=t&&n!=n}},186:function(e){e.exports=function(e){if(!e||!e.type)return null;var n=t[e.type];return n?"geometry"===n?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:e}]}:"feature"===n?{type:"FeatureCollection",features:[e]}:"featurecollection"===n?e:void 0:null};var t={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"}},628:function(e){e.exports.RADIUS=6378137,e.exports.FLATTENING=1/298.257223563,e.exports.POLAR_RADIUS=6356752.3142},778:function(e,t,n){var o=n(628);function r(e){var t=0;if(e&&e.length>0){t+=Math.abs(i(e[0]));for(var n=1;n<e.length;n++)t-=Math.abs(i(e[n]))}return t}function i(e){var t,n,r,i,a,c,u=0,l=e.length;if(l>2){for(c=0;c<l;c++)c===l-2?(r=l-2,i=l-1,a=0):c===l-1?(r=l-1,i=0,a=1):(r=c,i=c+1,a=c+2),t=e[r],n=e[i],u+=(s(e[a][0])-s(t[0]))*Math.sin(s(n[1]));u=u*o.RADIUS*o.RADIUS/2}return u}function s(e){return e*Math.PI/180}e.exports.geometry=function e(t){var n,o=0;switch(t.type){case"Polygon":return r(t.coordinates);case"MultiPolygon":for(n=0;n<t.coordinates.length;n++)o+=r(t.coordinates[n]);return o;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(n=0;n<t.geometries.length;n++)o+=e(t.geometries[n]);return o}},e.exports.ring=i},782:function(e,t,n){n.r(t),n.d(t,{Draw:function(){return Un},default:function(){return Vn}});var o={};n.r(o),n.d(o,{LAT_MAX:function(){return b},LAT_MIN:function(){return E},LAT_RENDERED_MAX:function(){return I},LAT_RENDERED_MIN:function(){return S},LNG_MAX:function(){return C},LNG_MIN:function(){return T},activeStates:function(){return m},classes:function(){return c},cursors:function(){return l},events:function(){return f},geojsonTypes:function(){return p},interactions:function(){return v},meta:function(){return y},modes:function(){return h},sources:function(){return u},types:function(){return d},updateActions:function(){return g}});var r={};n.r(r),n.d(r,{isActiveFeature:function(){return Ee},isEnterKey:function(){return Me},isEscapeKey:function(){return Oe},isFeature:function(){return Ie},isInactiveFeature:function(){return Se},isOfMetaType:function(){return me},isShiftDown:function(){return Ce},isShiftMousedown:function(){return ve},isTrue:function(){return xe},isVertex:function(){return Te},noTarget:function(){return be}});var i={};n.r(i),n.d(i,{CommonSelectors:function(){return r},ModeHandler:function(){return s},StringSet:function(){return P},constrainFeatureMovement:function(){return Be},createMidPoint:function(){return Le},createSupplementaryPoints:function(){return Ne},createVertex:function(){return Pe},doubleClickZoom:function(){return Ae},euclideanDistance:function(){return k},featuresAt:function(){return N},getFeatureAtAndSetCursors:function(){return F},isClick:function(){return V},isEventAtCoordinates:function(){return Ze},isTap:function(){return G},mapEventToBoundingBox:function(){return _},moveFeatures:function(){return je},sortFeatures:function(){return x},stringSetsAreEqual:function(){return at},theme:function(){return ye},toDenseArray:function(){return ae}});var s=function(e,t){const n={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},o={on(e,t,o){if(void 0===n[e])throw new Error(`Invalid event type: ${e}`);n[e].push({selector:t,fn:o})},render(e){t.store.featureChanged(e)}},r=function(e,r){const i=n[e];let s=i.length;for(;s--;){const e=i[s];if(e.selector(r)){e.fn.call(o,r)||t.store.render(),t.ui.updateMapClasses();break}}};return e.start.call(o),{render:e.render,stop(){e.stop&&e.stop()},trash(){e.trash&&(e.trash(),t.store.render())},combineFeatures(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures(){e.uncombineFeatures&&e.uncombineFeatures()},drag(e){r("drag",e)},click(e){r("click",e)},mousemove(e){r("mousemove",e)},mousedown(e){r("mousedown",e)},mouseup(e){r("mouseup",e)},mouseout(e){r("mouseout",e)},keydown(e){r("keydown",e)},keyup(e){r("keyup",e)},touchstart(e){r("touchstart",e)},touchmove(e){r("touchmove",e)},touchend(e){r("touchend",e)},tap(e){r("tap",e)}}},a=n(778);const c={CANVAS:"mapboxgl-canvas",CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},u={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},l={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},d={POLYGON:"polygon",LINE:"line_string",POINT:"point"},p={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},h={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select"},f={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},g={MOVE:"move",CHANGE_PROPERTIES:"change_properties",CHANGE_COORDINATES:"change_coordinates"},y={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},m={ACTIVE:"true",INACTIVE:"false"},v=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],E=-90,S=-85,b=90,I=85,T=-270,C=270,O={Point:0,LineString:1,MultiLineString:1,Polygon:2};function M(e,t){const n=O[e.geometry.type]-O[t.geometry.type];return 0===n&&e.geometry.type===p.POLYGON?e.area-t.area:n}var x=function(e){return e.map((e=>(e.geometry.type===p.POLYGON&&(e.area=a.geometry({type:p.FEATURE,property:{},geometry:e.geometry})),e))).sort(M).map((e=>(delete e.area,e)))},_=function(e,t=0){return[[e.point.x-t,e.point.y-t],[e.point.x+t,e.point.y+t]]};function w(e){if(this._items={},this._nums={},this._length=e?e.length:0,e)for(let t=0,n=e.length;t<n;t++)this.add(e[t]),void 0!==e[t]&&("string"==typeof e[t]?this._items[e[t]]=t:this._nums[e[t]]=t)}w.prototype.add=function(e){return this.has(e)||(this._length++,"string"==typeof e?this._items[e]=this._length:this._nums[e]=this._length),this},w.prototype.delete=function(e){return!1===this.has(e)||(this._length--,delete this._items[e],delete this._nums[e]),this},w.prototype.has=function(e){return!("string"!=typeof e&&"number"!=typeof e||void 0===this._items[e]&&void 0===this._nums[e])},w.prototype.values=function(){const e=[];return Object.keys(this._items).forEach((t=>{e.push({k:t,v:this._items[t]})})),Object.keys(this._nums).forEach((t=>{e.push({k:JSON.parse(t),v:this._nums[t]})})),e.sort(((e,t)=>e.v-t.v)).map((e=>e.k))},w.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var P=w;const L=[y.FEATURE,y.MIDPOINT,y.VERTEX];var N={click:function(e,t,n){return A(e,t,n,n.options.clickBuffer)},touch:function(e,t,n){return A(e,t,n,n.options.touchBuffer)}};function A(e,t,n,o){if(null===n.map)return[];const r=e?_(e,o):t,i={};n.options.styles&&(i.layers=n.options.styles.map((e=>e.id)).filter((e=>null!=n.map.getLayer(e))));const s=n.map.queryRenderedFeatures(r,i).filter((e=>-1!==L.indexOf(e.properties.meta))),a=new P,c=[];return s.forEach((e=>{const t=e.properties.id;a.has(t)||(a.add(t),c.push(e))})),x(c)}function F(e,t){const n=N.click(e,null,t),o={mouse:l.NONE};return n[0]&&(o.mouse=n[0].properties.active===m.ACTIVE?l.MOVE:l.POINTER,o.feature=n[0].properties.meta),-1!==t.events.currentModeName().indexOf("draw")&&(o.mouse=l.ADD),t.ui.queueMapClasses(o),t.ui.updateMapClasses(),n[0]}function k(e,t){const n=e.x-t.x,o=e.y-t.y;return Math.sqrt(n*n+o*o)}const R=4,D=12,U=500;function V(e,t,n={}){const o=null!=n.fineTolerance?n.fineTolerance:R,r=null!=n.grossTolerance?n.grossTolerance:D,i=null!=n.interval?n.interval:U;e.point=e.point||t.point,e.time=e.time||t.time;const s=k(e.point,t.point);return s<o||s<r&&t.time-e.time<i}const B=25,j=250;function G(e,t,n={}){const o=null!=n.tolerance?n.tolerance:B,r=null!=n.interval?n.interval:j;return e.point=e.point||t.point,e.time=e.time||t.time,k(e.point,t.point)<o&&t.time-e.time<r}const H=((e,t=21)=>(n=t)=>{let o="",r=0|n;for(;r--;)o+=e[Math.random()*e.length|0];return o})("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",32);function $(){return H()}const J=function(e,t){this.ctx=e,this.properties=t.properties||{},this.coordinates=t.geometry.coordinates,this.id=t.id||$(),this.type=t.geometry.type};J.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},J.prototype.incomingCoords=function(e){this.setCoordinates(e)},J.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()},J.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},J.prototype.setProperty=function(e,t){this.properties[e]=t},J.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:p.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},J.prototype.internal=function(e){const t={id:this.id,meta:y.FEATURE,"meta:type":this.type,active:m.INACTIVE,mode:e};if(this.ctx.options.userProperties)for(const e in this.properties)t[`user_${e}`]=this.properties[e];return{type:p.FEATURE,properties:t,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var Y=J;const q=function(e,t){Y.call(this,e,t)};(q.prototype=Object.create(Y.prototype)).isValid=function(){return"number"==typeof this.coordinates[0]&&"number"==typeof this.coordinates[1]},q.prototype.updateCoordinate=function(e,t,n){this.coordinates=3===arguments.length?[t,n]:[e,t],this.changed()},q.prototype.getCoordinate=function(){return this.getCoordinates()};var K=q;const X=function(e,t){Y.call(this,e,t)};(X.prototype=Object.create(Y.prototype)).isValid=function(){return this.coordinates.length>1},X.prototype.addCoordinate=function(e,t,n){this.changed();const o=parseInt(e,10);this.coordinates.splice(o,0,[t,n])},X.prototype.getCoordinate=function(e){const t=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[t]))},X.prototype.removeCoordinate=function(e){this.changed(),this.coordinates.splice(parseInt(e,10),1)},X.prototype.updateCoordinate=function(e,t,n){const o=parseInt(e,10);this.coordinates[o]=[t,n],this.changed()};var Z=X;const W=function(e,t){Y.call(this,e,t),this.coordinates=this.coordinates.map((e=>e.slice(0,-1)))};(W.prototype=Object.create(Y.prototype)).isValid=function(){return 0!==this.coordinates.length&&this.coordinates.every((e=>e.length>2))},W.prototype.incomingCoords=function(e){this.coordinates=e.map((e=>e.slice(0,-1))),this.changed()},W.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()},W.prototype.addCoordinate=function(e,t,n){this.changed();const o=e.split(".").map((e=>parseInt(e,10)));this.coordinates[o[0]].splice(o[1],0,[t,n])},W.prototype.removeCoordinate=function(e){this.changed();const t=e.split(".").map((e=>parseInt(e,10))),n=this.coordinates[t[0]];n&&(n.splice(t[1],1),n.length<3&&this.coordinates.splice(t[0],1))},W.prototype.getCoordinate=function(e){const t=e.split(".").map((e=>parseInt(e,10))),n=this.coordinates[t[0]];return JSON.parse(JSON.stringify(n[t[1]]))},W.prototype.getCoordinates=function(){return this.coordinates.map((e=>e.concat([e[0]])))},W.prototype.updateCoordinate=function(e,t,n){this.changed();const o=e.split("."),r=parseInt(o[0],10),i=parseInt(o[1],10);void 0===this.coordinates[r]&&(this.coordinates[r]=[]),this.coordinates[r][i]=[t,n]};var z=W;const Q={MultiPoint:K,MultiLineString:Z,MultiPolygon:z},ee=(e,t,n,o,r)=>{const i=n.split("."),s=parseInt(i[0],10),a=i[1]?i.slice(1).join("."):null;return e[s][t](a,o,r)},te=function(e,t){if(Y.call(this,e,t),delete this.coordinates,this.model=Q[t.geometry.type],void 0===this.model)throw new TypeError(`${t.geometry.type} is not a valid type`);this.features=this._coordinatesToFeatures(t.geometry.coordinates)};(te.prototype=Object.create(Y.prototype))._coordinatesToFeatures=function(e){const t=this.model.bind(this);return e.map((e=>new t(this.ctx,{id:$(),type:p.FEATURE,properties:{},geometry:{coordinates:e,type:this.type.replace("Multi","")}})))},te.prototype.isValid=function(){return this.features.every((e=>e.isValid()))},te.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()},te.prototype.getCoordinate=function(e){return ee(this.features,"getCoordinate",e)},te.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map((e=>e.type===p.POLYGON?e.getCoordinates():e.coordinates))))},te.prototype.updateCoordinate=function(e,t,n){ee(this.features,"updateCoordinate",e,t,n),this.changed()},te.prototype.addCoordinate=function(e,t,n){ee(this.features,"addCoordinate",e,t,n),this.changed()},te.prototype.removeCoordinate=function(e){ee(this.features,"removeCoordinate",e),this.changed()},te.prototype.getFeatures=function(){return this.features};var ne=te;function oe(e){this.map=e.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e}oe.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)},oe.prototype.setSelectedCoordinates=function(e){this._ctx.store.setSelectedCoordinates(e),e.reduce(((e,t)=>(void 0===e[t.feature_id]&&(e[t.feature_id]=!0,this._ctx.store.get(t.feature_id).changed()),e)),{})},oe.prototype.getSelected=function(){return this._ctx.store.getSelected()},oe.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},oe.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)},oe.prototype.getFeature=function(e){return this._ctx.store.get(e)},oe.prototype.select=function(e){return this._ctx.store.select(e)},oe.prototype.deselect=function(e){return this._ctx.store.deselect(e)},oe.prototype.deleteFeature=function(e,t={}){return this._ctx.store.delete(e,t)},oe.prototype.addFeature=function(e,t={}){return this._ctx.store.add(e,t)},oe.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},oe.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},oe.prototype.setActionableState=function(e={}){const t={trash:e.trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1};return this._ctx.events.actionable(t)},oe.prototype.changeMode=function(e,t={},n={}){return this._ctx.events.changeMode(e,t,n)},oe.prototype.fire=function(e,t){return this._ctx.events.fire(e,t)},oe.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)},oe.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)},oe.prototype.featuresAt=function(e,t,n="click"){if("click"!==n&&"touch"!==n)throw new Error("invalid buffer type");return N[n](e,t,this._ctx)},oe.prototype.newFeature=function(e){const t=e.geometry.type;return t===p.POINT?new K(this._ctx,e):t===p.LINE_STRING?new Z(this._ctx,e):t===p.POLYGON?new z(this._ctx,e):new ne(this._ctx,e)},oe.prototype.isInstanceOf=function(e,t){if(e===p.POINT)return t instanceof K;if(e===p.LINE_STRING)return t instanceof Z;if(e===p.POLYGON)return t instanceof z;if("MultiFeature"===e)return t instanceof ne;throw new Error(`Unknown feature class: ${e}`)},oe.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)};var re=oe;oe.prototype.onSetup=function(){},oe.prototype.onDrag=function(){},oe.prototype.onClick=function(){},oe.prototype.onMouseMove=function(){},oe.prototype.onMouseDown=function(){},oe.prototype.onMouseUp=function(){},oe.prototype.onMouseOut=function(){},oe.prototype.onKeyUp=function(){},oe.prototype.onKeyDown=function(){},oe.prototype.onTouchStart=function(){},oe.prototype.onTouchMove=function(){},oe.prototype.onTouchEnd=function(){},oe.prototype.onTap=function(){},oe.prototype.onStop=function(){},oe.prototype.onTrash=function(){},oe.prototype.onCombineFeature=function(){},oe.prototype.onUncombineFeature=function(){},oe.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};const ie={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},se=Object.keys(ie);var ae=function(e){return[].concat(e).filter((e=>void 0!==e))};function ce(){const e=this;if(!e.ctx.map||void 0===e.ctx.map.getSource(u.HOT))return a();const t=e.ctx.events.currentModeName();e.ctx.ui.queueMapClasses({mode:t});let n=[],o=[];e.isDirty?o=e.getAllIds():(n=e.getChangedIds().filter((t=>void 0!==e.get(t))),o=e.sources.hot.filter((t=>t.properties.id&&-1===n.indexOf(t.properties.id)&&void 0!==e.get(t.properties.id))).map((e=>e.properties.id))),e.sources.hot=[];const r=e.sources.cold.length;e.sources.cold=e.isDirty?[]:e.sources.cold.filter((e=>{const t=e.properties.id||e.properties.parent;return-1===n.indexOf(t)}));const i=r!==e.sources.cold.length||o.length>0;function s(n,o){const r=e.get(n).internal(t);e.ctx.events.currentModeRender(r,(n=>{n.properties.mode=t,e.sources[o].push(n)}))}function a(){e.isDirty=!1,e.clearChangedIds()}n.forEach((e=>s(e,"hot"))),o.forEach((e=>s(e,"cold"))),i&&e.ctx.map.getSource(u.COLD).setData({type:p.FEATURE_COLLECTION,features:e.sources.cold}),e.ctx.map.getSource(u.HOT).setData({type:p.FEATURE_COLLECTION,features:e.sources.hot}),a()}function ue(e){let t;this._features={},this._featureIds=new P,this._selectedFeatureIds=new P,this._selectedCoordinates=[],this._changedFeatureIds=new P,this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this.sources={hot:[],cold:[]},this.render=()=>{t||(t=requestAnimationFrame((()=>{t=null,ce.call(this),this._emitSelectionChange&&(this.ctx.events.fire(f.SELECTION_CHANGE,{features:this.getSelected().map((e=>e.toGeoJSON())),points:this.getSelectedCoordinates().map((e=>({type:p.FEATURE,properties:{},geometry:{type:p.POINT,coordinates:e.coordinates}})))}),this._emitSelectionChange=!1),this.ctx.events.fire(f.RENDER,{})})))},this.isDirty=!1}function le(e,t={}){const n=e._selectedCoordinates.filter((t=>e._selectedFeatureIds.has(t.feature_id)));e._selectedCoordinates.length===n.length||t.silent||(e._emitSelectionChange=!0),e._selectedCoordinates=n}ue.prototype.createRenderBatch=function(){const e=this.render;let t=0;return this.render=function(){t++},()=>{this.render=e,t>0&&this.render()}},ue.prototype.setDirty=function(){return this.isDirty=!0,this},ue.prototype.featureCreated=function(e,t={}){if(this._changedFeatureIds.add(e),!0!==(null!=t.silent?t.silent:this.ctx.options.suppressAPIEvents)){const t=this.get(e);this.ctx.events.fire(f.CREATE,{features:[t.toGeoJSON()]})}return this},ue.prototype.featureChanged=function(e,t={}){return this._changedFeatureIds.add(e),!0!==(null!=t.silent?t.silent:this.ctx.options.suppressAPIEvents)&&this.ctx.events.fire(f.UPDATE,{action:t.action?t.action:g.CHANGE_COORDINATES,features:[this.get(e).toGeoJSON()]}),this},ue.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},ue.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},ue.prototype.getAllIds=function(){return this._featureIds.values()},ue.prototype.add=function(e,t={}){return this._features[e.id]=e,this._featureIds.add(e.id),this.featureCreated(e.id,{silent:t.silent}),this},ue.prototype.delete=function(e,t={}){const n=[];return ae(e).forEach((e=>{this._featureIds.has(e)&&(this._featureIds.delete(e),this._selectedFeatureIds.delete(e),t.silent||-1===n.indexOf(this._features[e])&&n.push(this._features[e].toGeoJSON()),delete this._features[e],this.isDirty=!0)})),n.length&&this.ctx.events.fire(f.DELETE,{features:n}),le(this,t),this},ue.prototype.get=function(e){return this._features[e]},ue.prototype.getAll=function(){return Object.keys(this._features).map((e=>this._features[e]))},ue.prototype.select=function(e,t={}){return ae(e).forEach((e=>{this._selectedFeatureIds.has(e)||(this._selectedFeatureIds.add(e),this._changedFeatureIds.add(e),t.silent||(this._emitSelectionChange=!0))})),this},ue.prototype.deselect=function(e,t={}){return ae(e).forEach((e=>{this._selectedFeatureIds.has(e)&&(this._selectedFeatureIds.delete(e),this._changedFeatureIds.add(e),t.silent||(this._emitSelectionChange=!0))})),le(this,t),this},ue.prototype.clearSelected=function(e={}){return this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this},ue.prototype.setSelected=function(e,t={}){return e=ae(e),this.deselect(this._selectedFeatureIds.values().filter((t=>-1===e.indexOf(t))),{silent:t.silent}),this.select(e.filter((e=>!this._selectedFeatureIds.has(e))),{silent:t.silent}),this},ue.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this},ue.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},ue.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},ue.prototype.getSelected=function(){return this.getSelectedIds().map((e=>this.get(e)))},ue.prototype.getSelectedCoordinates=function(){return this._selectedCoordinates.map((e=>({coordinates:this.get(e.feature_id).getCoordinate(e.coord_path)})))},ue.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)},ue.prototype.setFeatureProperty=function(e,t,n,o={}){this.get(e).setProperty(t,n),this.featureChanged(e,{silent:o.silent,action:g.CHANGE_PROPERTIES})},ue.prototype.storeMapConfig=function(){v.forEach((e=>{this.ctx.map[e]&&(this._mapInitialConfig[e]=this.ctx.map[e].isEnabled())}))},ue.prototype.restoreMapConfig=function(){Object.keys(this._mapInitialConfig).forEach((e=>{this._mapInitialConfig[e]?this.ctx.map[e].enable():this.ctx.map[e].disable()}))},ue.prototype.getInitialConfigValue=function(e){return void 0===this._mapInitialConfig[e]||this._mapInitialConfig[e]};const de=["mode","feature","mouse"];function pe(e){let t=null,n=null;const o={onRemove(){return e.map.off("load",o.connect),clearInterval(n),o.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.boxZoomInitial&&e.map.boxZoom.enable(),e.map=null,e.container=null,e.store=null,t&&t.parentNode&&t.parentNode.removeChild(t),t=null,this},connect(){e.map.off("load",o.connect),clearInterval(n),o.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners()},onAdd(r){if(e.map=r,e.events=function(e){const t=Object.keys(e.options.modes).reduce(((t,n)=>(t[n]=function(e){const t=Object.keys(e);return function(n,o={}){let r={};const i=t.reduce(((t,n)=>(t[n]=e[n],t)),new re(n));return{start(){r=i.onSetup(o),se.forEach((t=>{const n=ie[t];let o=()=>!1;var s;e[n]&&(o=()=>!0),this.on(t,o,(s=n,e=>i[s](r,e)))}))},stop(){i.onStop(r)},trash(){i.onTrash(r)},combineFeatures(){i.onCombineFeatures(r)},uncombineFeatures(){i.onUncombineFeatures(r)},render(e,t){i.toDisplayFeatures(r,e,t)}}}}(e.options.modes[n]),t)),{});let n={},o={};const r={};let i=null,a=null;r.drag=function(t,n){n({point:t.point,time:(new Date).getTime()})?(e.ui.queueMapClasses({mouse:l.DRAG}),a.drag(t)):t.originalEvent.stopPropagation()},r.mousedrag=function(e){r.drag(e,(e=>!V(n,e)))},r.touchdrag=function(e){r.drag(e,(e=>!G(o,e)))},r.mousemove=function(t){if(1===(void 0!==t.originalEvent.buttons?t.originalEvent.buttons:t.originalEvent.which))return r.mousedrag(t);const n=F(t,e);t.featureTarget=n,a.mousemove(t)},r.mousedown=function(t){n={time:(new Date).getTime(),point:t.point};const o=F(t,e);t.featureTarget=o,a.mousedown(t)},r.mouseup=function(t){const o=F(t,e);t.featureTarget=o,V(n,{point:t.point,time:(new Date).getTime()})?a.click(t):a.mouseup(t)},r.mouseout=function(e){a.mouseout(e)},r.touchstart=function(t){if(!e.options.touchEnabled)return;o={time:(new Date).getTime(),point:t.point};const n=N.touch(t,null,e)[0];t.featureTarget=n,a.touchstart(t)},r.touchmove=function(t){if(e.options.touchEnabled)return a.touchmove(t),r.touchdrag(t)},r.touchend=function(t){if(t.originalEvent.preventDefault(),!e.options.touchEnabled)return;const n=N.touch(t,null,e)[0];t.featureTarget=n,G(o,{time:(new Date).getTime(),point:t.point})?a.tap(t):a.touchend(t)};const u=e=>!(8===e||46===e||e>=48&&e<=57);function d(n,o,r={}){a.stop();const c=t[n];if(void 0===c)throw new Error(`${n} is not valid`);i=n;const u=c(e,o);a=s(u,e),r.silent||e.map.fire(f.MODE_CHANGE,{mode:n}),e.store.setDirty(),e.store.render()}r.keydown=function(t){(t.srcElement||t.target).classList.contains(c.CANVAS)&&(8!==t.keyCode&&46!==t.keyCode||!e.options.controls.trash?u(t.keyCode)?a.keydown(t):49===t.keyCode&&e.options.controls.point?d(h.DRAW_POINT):50===t.keyCode&&e.options.controls.line_string?d(h.DRAW_LINE_STRING):51===t.keyCode&&e.options.controls.polygon&&d(h.DRAW_POLYGON):(t.preventDefault(),a.trash()))},r.keyup=function(e){u(e.keyCode)&&a.keyup(e)},r.zoomend=function(){e.store.changeZoom()},r.data=function(t){if("style"===t.dataType){const{setup:t,map:n,options:o,store:r}=e;o.styles.some((e=>n.getLayer(e.id)))||(t.addLayers(),r.setDirty(),r.render())}};const p={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start(){i=e.options.defaultMode,a=s(t[i](e),e)},changeMode:d,actionable:function(t){let n=!1;Object.keys(t).forEach((e=>{if(void 0===p[e])throw new Error("Invalid action type");p[e]!==t[e]&&(n=!0),p[e]=t[e]})),n&&e.map.fire(f.ACTIONABLE,{actions:p})},currentModeName(){return i},currentModeRender(e,t){return a.render(e,t)},fire(t,n){e.map&&e.map.fire(t,n)},addEventListeners(){e.map.on("mousemove",r.mousemove),e.map.on("mousedown",r.mousedown),e.map.on("mouseup",r.mouseup),e.map.on("data",r.data),e.map.on("touchmove",r.touchmove),e.map.on("touchstart",r.touchstart),e.map.on("touchend",r.touchend),e.container.addEventListener("mouseout",r.mouseout),e.options.keybindings&&(e.container.addEventListener("keydown",r.keydown),e.container.addEventListener("keyup",r.keyup))},removeEventListeners(){e.map.off("mousemove",r.mousemove),e.map.off("mousedown",r.mousedown),e.map.off("mouseup",r.mouseup),e.map.off("data",r.data),e.map.off("touchmove",r.touchmove),e.map.off("touchstart",r.touchstart),e.map.off("touchend",r.touchend),e.container.removeEventListener("mouseout",r.mouseout),e.options.keybindings&&(e.container.removeEventListener("keydown",r.keydown),e.container.removeEventListener("keyup",r.keyup))},trash(e){a.trash(e)},combineFeatures(){a.combineFeatures()},uncombineFeatures(){a.uncombineFeatures()},getMode(){return i}}}(e),e.ui=function(e){const t={};let n=null,o={mode:null,feature:null,mouse:null},r={mode:null,feature:null,mouse:null};function i(e){r=Object.assign(r,e)}function s(){if(!e.container)return;const t=[],n=[];de.forEach((e=>{r[e]!==o[e]&&(t.push(`${e}-${o[e]}`),null!==r[e]&&n.push(`${e}-${r[e]}`))})),t.length>0&&e.container.classList.remove(...t),n.length>0&&e.container.classList.add(...n),o=Object.assign(o,r)}function a(e,t={}){const o=document.createElement("button");return o.className=`${c.CONTROL_BUTTON} ${t.className}`,o.setAttribute("title",t.title),t.container.appendChild(o),o.addEventListener("click",(o=>{if(o.preventDefault(),o.stopPropagation(),o.target===n)return u(),void t.onDeactivate();l(e),t.onActivate()}),!0),o}function u(){n&&(n.classList.remove(c.ACTIVE_BUTTON),n=null)}function l(e){u();const o=t[e];o&&o&&"trash"!==e&&(o.classList.add(c.ACTIVE_BUTTON),n=o)}return{setActiveButton:l,queueMapClasses:i,updateMapClasses:s,clearMapClasses:function(){i({mode:null,feature:null,mouse:null}),s()},addButtons:function(){const n=e.options.controls,o=document.createElement("div");return o.className=`${c.CONTROL_GROUP} ${c.CONTROL_BASE}`,n?(n[d.LINE]&&(t[d.LINE]=a(d.LINE,{container:o,className:c.CONTROL_BUTTON_LINE,title:"LineString tool "+(e.options.keybindings?"(l)":""),onActivate:()=>e.events.changeMode(h.DRAW_LINE_STRING),onDeactivate:()=>e.events.trash()})),n[d.POLYGON]&&(t[d.POLYGON]=a(d.POLYGON,{container:o,className:c.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(e.options.keybindings?"(p)":""),onActivate:()=>e.events.changeMode(h.DRAW_POLYGON),onDeactivate:()=>e.events.trash()})),n[d.POINT]&&(t[d.POINT]=a(d.POINT,{container:o,className:c.CONTROL_BUTTON_POINT,title:"Marker tool "+(e.options.keybindings?"(m)":""),onActivate:()=>e.events.changeMode(h.DRAW_POINT),onDeactivate:()=>e.events.trash()})),n.trash&&(t.trash=a("trash",{container:o,className:c.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:()=>{e.events.trash()}})),n.combine_features&&(t.combine_features=a("combineFeatures",{container:o,className:c.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:()=>{e.events.combineFeatures()}})),n.uncombine_features&&(t.uncombine_features=a("uncombineFeatures",{container:o,className:c.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:()=>{e.events.uncombineFeatures()}})),o):o},removeButtons:function(){Object.keys(t).forEach((e=>{const n=t[e];n.parentNode&&n.parentNode.removeChild(n),delete t[e]}))}}}(e),e.container=r.getContainer(),e.store=new ue(e),t=e.ui.addButtons(),e.options.boxSelect){e.boxZoomInitial=r.boxZoom.isEnabled(),r.boxZoom.disable();const t=r.dragPan.isEnabled();r.dragPan.disable(),r.dragPan.enable(),t||r.dragPan.disable()}return r.loaded()?o.connect():(r.on("load",o.connect),n=setInterval((()=>{r.loaded()&&o.connect()}),16)),e.events.start(),t},addLayers(){e.map.addSource(u.COLD,{data:{type:p.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.map.addSource(u.HOT,{data:{type:p.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.options.styles.forEach((t=>{e.map.addLayer(t)})),e.store.setDirty(!0),e.store.render()},removeLayers(){e.options.styles.forEach((t=>{e.map.getLayer(t.id)&&e.map.removeLayer(t.id)})),e.map.getSource(u.COLD)&&e.map.removeSource(u.COLD),e.map.getSource(u.HOT)&&e.map.removeSource(u.HOT)}};return e.setup=o,o}const he="#3bb2d0",fe="#fbb03b",ge="#fff";var ye=[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"]],paint:{"fill-color":["case",["==",["get","active"],"true"],fe,he],"fill-opacity":.1}},{id:"gl-draw-lines",type:"line",filter:["any",["==","$type","LineString"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","active"],"true"],fe,he],"line-dasharray":["case",["==",["get","active"],"true"],[.2,2],[2,0]],"line-width":2}},{id:"gl-draw-point-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":ge}},{id:"gl-draw-point-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":["case",["==",["get","active"],"true"],fe,he]}},{id:"gl-draw-vertex-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":ge}},{id:"gl-draw-vertex-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":fe}},{id:"gl-draw-midpoint",type:"circle",filter:["all",["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":fe}}];function me(e){return function(t){const n=t.featureTarget;return!!n&&!!n.properties&&n.properties.meta===e}}function ve(e){return!!e.originalEvent&&!!e.originalEvent.shiftKey&&0===e.originalEvent.button}function Ee(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.active===m.ACTIVE&&e.featureTarget.properties.meta===y.FEATURE}function Se(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.active===m.INACTIVE&&e.featureTarget.properties.meta===y.FEATURE}function be(e){return void 0===e.featureTarget}function Ie(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.meta===y.FEATURE}function Te(e){const t=e.featureTarget;return!!t&&!!t.properties&&t.properties.meta===y.VERTEX}function Ce(e){return!!e.originalEvent&&!0===e.originalEvent.shiftKey}function Oe(e){return 27===e.keyCode}function Me(e){return 13===e.keyCode}function xe(){return!0}function _e(e,t){this.x=e,this.y=t}_e.prototype={clone(){return new _e(this.x,this.y)},add(e){return this.clone()._add(e)},sub(e){return this.clone()._sub(e)},multByPoint(e){return this.clone()._multByPoint(e)},divByPoint(e){return this.clone()._divByPoint(e)},mult(e){return this.clone()._mult(e)},div(e){return this.clone()._div(e)},rotate(e){return this.clone()._rotate(e)},rotateAround(e,t){return this.clone()._rotateAround(e,t)},matMult(e){return this.clone()._matMult(e)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(e){return this.x===e.x&&this.y===e.y},dist(e){return Math.sqrt(this.distSqr(e))},distSqr(e){const t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith(e){return this.angleWithSep(e.x,e.y)},angleWithSep(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult(e){const t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this},_add(e){return this.x+=e.x,this.y+=e.y,this},_sub(e){return this.x-=e.x,this.y-=e.y,this},_mult(e){return this.x*=e,this.y*=e,this},_div(e){return this.x/=e,this.y/=e,this},_multByPoint(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint(e){return this.x/=e.x,this.y/=e.y,this},_unit(){return this._div(this.mag()),this},_perp(){const e=this.y;return this.y=this.x,this.x=-e,this},_rotate(e){const t=Math.cos(e),n=Math.sin(e),o=t*this.x-n*this.y,r=n*this.x+t*this.y;return this.x=o,this.y=r,this},_rotateAround(e,t){const n=Math.cos(e),o=Math.sin(e),r=t.x+n*(this.x-t.x)-o*(this.y-t.y),i=t.y+o*(this.x-t.x)+n*(this.y-t.y);return this.x=r,this.y=i,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:_e},_e.convert=function(e){if(e instanceof _e)return e;if(Array.isArray(e))return new _e(+e[0],+e[1]);if(void 0!==e.x&&void 0!==e.y)return new _e(+e.x,+e.y);throw new Error("Expected [x, y] or {x, y} point format")};var we=function(e,t){const n=t.getBoundingClientRect();return new _e(e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0))};function Pe(e,t,n,o){return{type:p.FEATURE,properties:{meta:y.VERTEX,parent:e,coord_path:n,active:o?m.ACTIVE:m.INACTIVE},geometry:{type:p.POINT,coordinates:t}}}function Le(e,t,n){const o=t.geometry.coordinates,r=n.geometry.coordinates;if(o[1]>I||o[1]<S||r[1]>I||r[1]<S)return null;const i={lng:(o[0]+r[0])/2,lat:(o[1]+r[1])/2};return{type:p.FEATURE,properties:{meta:y.MIDPOINT,parent:e,lng:i.lng,lat:i.lat,coord_path:n.properties.coord_path},geometry:{type:p.POINT,coordinates:[i.lng,i.lat]}}}var Ne=function e(t,n={},o=null){const{type:r,coordinates:i}=t.geometry,s=t.properties&&t.properties.id;let a=[];function c(e,t){let o="",r=null;e.forEach(((e,i)=>{const c=null!=t?`${t}.${i}`:String(i),l=Pe(s,e,c,u(c));if(n.midpoints&&r){const e=Le(s,r,l);e&&a.push(e)}r=l;const d=JSON.stringify(e);o!==d&&a.push(l),0===i&&(o=d)}))}function u(e){return!!n.selectedPaths&&-1!==n.selectedPaths.indexOf(e)}return r===p.POINT?a.push(Pe(s,i,o,u(o))):r===p.POLYGON?i.forEach(((e,t)=>{c(e,null!==o?`${o}.${t}`:String(t))})):r===p.LINE_STRING?c(i,o):0===r.indexOf(p.MULTI_PREFIX)&&function(){const o=r.replace(p.MULTI_PREFIX,"");i.forEach(((r,i)=>{const s={type:p.FEATURE,properties:t.properties,geometry:{type:o,coordinates:r}};a=a.concat(e(s,n,i))}))}(),a},Ae={enable(e){setTimeout((()=>{e.map&&e.map.doubleClickZoom&&e._ctx&&e._ctx.store&&e._ctx.store.getInitialConfigValue&&e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()}),0)},disable(e){setTimeout((()=>{e.map&&e.map.doubleClickZoom&&e.map.doubleClickZoom.disable()}),0)}};const{LAT_MIN:Fe,LAT_MAX:ke,LAT_RENDERED_MIN:Re,LAT_RENDERED_MAX:De,LNG_MIN:Ue,LNG_MAX:Ve}=o;function Be(e,t){let n=Fe,o=ke,r=Fe,i=ke,s=Ve,a=Ue;e.forEach((e=>{const t=function(e){const t={Point:0,LineString:1,Polygon:2,MultiPoint:1,MultiLineString:2,MultiPolygon:3}[e.geometry.type],n=[e.geometry.coordinates].flat(t),o=n.map((e=>e[0])),r=n.map((e=>e[1])),i=e=>Math.min.apply(null,e),s=e=>Math.max.apply(null,e);return[i(o),i(r),s(o),s(r)]}(e),c=t[1],u=t[3],l=t[0],d=t[2];c>n&&(n=c),u<o&&(o=u),u>r&&(r=u),c<i&&(i=c),l<s&&(s=l),d>a&&(a=d)}));const c=t;return n+c.lat>De&&(c.lat=De-n),r+c.lat>ke&&(c.lat=ke-r),o+c.lat<Re&&(c.lat=Re-o),i+c.lat<Fe&&(c.lat=Fe-i),s+c.lng<=Ue&&(c.lng+=360*Math.ceil(Math.abs(c.lng)/360)),a+c.lng>=Ve&&(c.lng-=360*Math.ceil(Math.abs(c.lng)/360)),c}function je(e,t){const n=Be(e.map((e=>e.toGeoJSON())),t);e.forEach((e=>{const t=e.getCoordinates(),o=e=>{const t={lng:e[0]+n.lng,lat:e[1]+n.lat};return[t.lng,t.lat]},r=e=>e.map((e=>o(e)));let i;e.type===p.POINT?i=o(t):e.type===p.LINE_STRING||e.type===p.MULTI_POINT?i=t.map(o):e.type===p.POLYGON||e.type===p.MULTI_LINE_STRING?i=t.map(r):e.type===p.MULTI_POLYGON&&(i=t.map((e=>e.map((e=>r(e)))))),e.incomingCoords(i)}))}const Ge={onSetup:function(e){const t={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initialDragPanState:this.map.dragPan.isEnabled(),initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(t.initiallySelectedFeatureIds.filter((e=>void 0!==this.getFeature(e)))),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),t},fireUpdate:function(){this.fire(f.UPDATE,{action:g.MOVE,features:this.getSelected().map((e=>e.toGeoJSON()))})},fireActionable:function(){const e=this.getSelected(),t=e.filter((e=>this.isInstanceOf("MultiFeature",e)));let n=!1;if(e.length>1){n=!0;const t=e[0].type.replace("Multi","");e.forEach((e=>{e.type.replace("Multi","")!==t&&(n=!1)}))}const o=t.length>0,r=e.length>0;this.setActionableState({combineFeatures:n,uncombineFeatures:o,trash:r})},getUniqueIds:function(e){return e.length?e.map((e=>e.properties.id)).filter((e=>void 0!==e)).reduce(((e,t)=>(e.add(t),e)),new P).values():[]},stopExtendedInteractions:function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),(e.canDragMove||e.canBoxSelect)&&!0===e.initialDragPanState&&this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1},onStop:function(){Ae.enable(this)},onMouseMove:function(e,t){return Ie(t)&&e.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(e),!0},onMouseOut:function(e){return!e.dragMoving||this.fireUpdate()}};Ge.onTap=Ge.onClick=function(e,t){return be(t)?this.clickAnywhere(e,t):me(y.VERTEX)(t)?this.clickOnVertex(e,t):Ie(t)?this.clickOnFeature(e,t):void 0},Ge.clickAnywhere=function(e){const t=this.getSelectedIds();t.length&&(this.clearSelectedFeatures(),t.forEach((e=>this.doRender(e)))),Ae.enable(this),this.stopExtendedInteractions(e)},Ge.clickOnVertex=function(e,t){this.changeMode(h.DIRECT_SELECT,{featureId:t.featureTarget.properties.parent,coordPath:t.featureTarget.properties.coord_path,startPos:t.lngLat}),this.updateUIClasses({mouse:l.MOVE})},Ge.startOnActiveFeature=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(t.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=t.lngLat},Ge.clickOnFeature=function(e,t){Ae.disable(this),this.stopExtendedInteractions(e);const n=Ce(t),o=this.getSelectedIds(),r=t.featureTarget.properties.id,i=this.isSelected(r);if(!n&&i&&this.getFeature(r).type!==p.POINT)return this.changeMode(h.DIRECT_SELECT,{featureId:r});i&&n?(this.deselect(r),this.updateUIClasses({mouse:l.POINTER}),1===o.length&&Ae.enable(this)):!i&&n?(this.select(r),this.updateUIClasses({mouse:l.MOVE})):i||n||(o.forEach((e=>this.doRender(e))),this.setSelected(r),this.updateUIClasses({mouse:l.MOVE})),this.doRender(r)},Ge.onMouseDown=function(e,t){return e.initialDragPanState=this.map.dragPan.isEnabled(),Ee(t)?this.startOnActiveFeature(e,t):this.drawConfig.boxSelect&&ve(t)?this.startBoxSelect(e,t):void 0},Ge.startBoxSelect=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=we(t.originalEvent,this.map.getContainer()),e.canBoxSelect=!0},Ge.onTouchStart=function(e,t){if(Ee(t))return this.startOnActiveFeature(e,t)},Ge.onDrag=function(e,t){return e.canDragMove?this.dragMove(e,t):this.drawConfig.boxSelect&&e.canBoxSelect?this.whileBoxSelect(e,t):void 0},Ge.whileBoxSelect=function(e,t){e.boxSelecting=!0,this.updateUIClasses({mouse:l.ADD}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add(c.BOX_SELECT),this.map.getContainer().appendChild(e.boxSelectElement));const n=we(t.originalEvent,this.map.getContainer()),o=Math.min(e.boxSelectStartLocation.x,n.x),r=Math.max(e.boxSelectStartLocation.x,n.x),i=Math.min(e.boxSelectStartLocation.y,n.y),s=Math.max(e.boxSelectStartLocation.y,n.y),a=`translate(${o}px, ${i}px)`;e.boxSelectElement.style.transform=a,e.boxSelectElement.style.WebkitTransform=a,e.boxSelectElement.style.width=r-o+"px",e.boxSelectElement.style.height=s-i+"px"},Ge.dragMove=function(e,t){e.dragMoving=!0,t.originalEvent.stopPropagation();const n={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};je(this.getSelected(),n),e.dragMoveLocation=t.lngLat},Ge.onTouchEnd=Ge.onMouseUp=function(e,t){if(e.dragMoving)this.fireUpdate();else if(e.boxSelecting){const n=[e.boxSelectStartLocation,we(t.originalEvent,this.map.getContainer())],o=this.featuresAt(null,n,"click"),r=this.getUniqueIds(o).filter((e=>!this.isSelected(e)));r.length&&(this.select(r),r.forEach((e=>this.doRender(e))),this.updateUIClasses({mouse:l.MOVE}))}this.stopExtendedInteractions(e)},Ge.toDisplayFeatures=function(e,t,n){t.properties.active=this.isSelected(t.properties.id)?m.ACTIVE:m.INACTIVE,n(t),this.fireActionable(),t.properties.active===m.ACTIVE&&t.geometry.type!==p.POINT&&Ne(t).forEach(n)},Ge.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},Ge.onCombineFeatures=function(){const e=this.getSelected();if(0===e.length||e.length<2)return;const t=[],n=[],o=e[0].type.replace("Multi","");for(let r=0;r<e.length;r++){const i=e[r];if(i.type.replace("Multi","")!==o)return;i.type.includes("Multi")?i.getCoordinates().forEach((e=>{t.push(e)})):t.push(i.getCoordinates()),n.push(i.toGeoJSON())}if(n.length>1){const e=this.newFeature({type:p.FEATURE,properties:n[0].properties,geometry:{type:`Multi${o}`,coordinates:t}});this.addFeature(e),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([e.id]),this.fire(f.COMBINE_FEATURES,{createdFeatures:[e.toGeoJSON()],deletedFeatures:n})}this.fireActionable()},Ge.onUncombineFeatures=function(){const e=this.getSelected();if(0===e.length)return;const t=[],n=[];for(let o=0;o<e.length;o++){const r=e[o];this.isInstanceOf("MultiFeature",r)&&(r.getFeatures().forEach((e=>{this.addFeature(e),e.properties=r.properties,t.push(e.toGeoJSON()),this.select([e.id])})),this.deleteFeature(r.id,{silent:!0}),n.push(r.toGeoJSON()))}t.length>1&&this.fire(f.UNCOMBINE_FEATURES,{createdFeatures:t,deletedFeatures:n}),this.fireActionable()};var He=Ge;const $e=me(y.VERTEX),Je=me(y.MIDPOINT),Ye={fireUpdate:function(){this.fire(f.UPDATE,{action:g.CHANGE_COORDINATES,features:this.getSelected().map((e=>e.toGeoJSON()))})},fireActionable:function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:e.selectedCoordPaths.length>0})},startDragging:function(e,t){e.initialDragPanState=this.map.dragPan.isEnabled(),this.map.dragPan.disable(),e.canDragMove=!0,e.dragMoveLocation=t.lngLat},stopDragging:function(e){e.canDragMove&&!0===e.initialDragPanState&&this.map.dragPan.enable(),e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null},onVertex:function(e,t){this.startDragging(e,t);const n=t.featureTarget.properties,o=e.selectedCoordPaths.indexOf(n.coord_path);Ce(t)||-1!==o?Ce(t)&&-1===o&&e.selectedCoordPaths.push(n.coord_path):e.selectedCoordPaths=[n.coord_path];const r=this.pathsToCoordinates(e.featureId,e.selectedCoordPaths);this.setSelectedCoordinates(r)},onMidpoint:function(e,t){this.startDragging(e,t);const n=t.featureTarget.properties;e.feature.addCoordinate(n.coord_path,n.lng,n.lat),this.fireUpdate(),e.selectedCoordPaths=[n.coord_path]},pathsToCoordinates:function(e,t){return t.map((t=>({feature_id:e,coord_path:t})))},onFeature:function(e,t){0===e.selectedCoordPaths.length?this.startDragging(e,t):this.stopDragging(e)},dragFeature:function(e,t,n){je(this.getSelected(),n),e.dragMoveLocation=t.lngLat},dragVertex:function(e,t,n){const o=e.selectedCoordPaths.map((t=>e.feature.getCoordinate(t))),r=Be(o.map((e=>({type:p.FEATURE,properties:{},geometry:{type:p.POINT,coordinates:e}}))),n);for(let t=0;t<o.length;t++){const n=o[t];e.feature.updateCoordinate(e.selectedCoordPaths[t],n[0]+r.lng,n[1]+r.lat)}},clickNoTarget:function(){this.changeMode(h.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(h.SIMPLE_SELECT)},clickActiveFeature:function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()},onSetup:function(e){const t=e.featureId,n=this.getFeature(t);if(!n)throw new Error("You must provide a featureId to enter direct_select mode");if(n.type===p.POINT)throw new TypeError("direct_select mode doesn't handle point features");const o={featureId:t,feature:n,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(t,o.selectedCoordPaths)),this.setSelected(t),Ae.disable(this),this.setActionableState({trash:!0}),o},onStop:function(){Ae.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(e,t,n){e.featureId===t.properties.id?(t.properties.active=m.ACTIVE,n(t),Ne(t,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths}).forEach(n)):(t.properties.active=m.INACTIVE,n(t)),this.fireActionable(e)},onTrash:function(e){e.selectedCoordPaths.sort(((e,t)=>t.localeCompare(e,"en",{numeric:!0}))).forEach((t=>e.feature.removeCoordinate(t))),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),!1===e.feature.isValid()&&(this.deleteFeature([e.featureId]),this.changeMode(h.SIMPLE_SELECT,{}))},onMouseMove:function(e,t){const n=Ee(t),o=$e(t),r=Je(t),i=0===e.selectedCoordPaths.length;return n&&i||o&&!i?this.updateUIClasses({mouse:l.MOVE}):this.updateUIClasses({mouse:l.NONE}),(o||n||r)&&e.dragMoving&&this.fireUpdate(),this.stopDragging(e),!0},onMouseOut:function(e){return e.dragMoving&&this.fireUpdate(),!0}};Ye.onTouchStart=Ye.onMouseDown=function(e,t){return $e(t)?this.onVertex(e,t):Ee(t)?this.onFeature(e,t):Je(t)?this.onMidpoint(e,t):void 0},Ye.onDrag=function(e,t){if(!0!==e.canDragMove)return;e.dragMoving=!0,t.originalEvent.stopPropagation();const n={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};e.selectedCoordPaths.length>0?this.dragVertex(e,t,n):this.dragFeature(e,t,n),e.dragMoveLocation=t.lngLat},Ye.onClick=function(e,t){return be(t)?this.clickNoTarget(e,t):Ee(t)?this.clickActiveFeature(e,t):Se(t)?this.clickInactive(e,t):void this.stopDragging(e)},Ye.onTap=function(e,t){return be(t)?this.clickNoTarget(e,t):Ee(t)?this.clickActiveFeature(e,t):Se(t)?this.clickInactive(e,t):void 0},Ye.onTouchEnd=Ye.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)};var qe=Ye;const Ke={onSetup:function(){const e=this.newFeature({type:p.FEATURE,properties:{},geometry:{type:p.POINT,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:l.ADD}),this.activateUIButton(d.POINT),this.setActionableState({trash:!0}),{point:e}},stopDrawingAndRemove:function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(h.SIMPLE_SELECT)}};Ke.onTap=Ke.onClick=function(e,t){this.updateUIClasses({mouse:l.MOVE}),e.point.updateCoordinate("",t.lngLat.lng,t.lngLat.lat),this.fire(f.CREATE,{features:[e.point.toGeoJSON()]}),this.changeMode(h.SIMPLE_SELECT,{featureIds:[e.point.id]})},Ke.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})},Ke.toDisplayFeatures=function(e,t,n){const o=t.properties.id===e.point.id;if(t.properties.active=o?m.ACTIVE:m.INACTIVE,!o)return n(t)},Ke.onTrash=Ke.stopDrawingAndRemove,Ke.onKeyUp=function(e,t){if(Oe(t)||Me(t))return this.stopDrawingAndRemove(e,t)};var Xe=Ke,Ze=function(e,t){return!!e.lngLat&&e.lngLat.lng===t[0]&&e.lngLat.lat===t[1]};const We={onSetup:function(){const e=this.newFeature({type:p.FEATURE,properties:{},geometry:{type:p.POLYGON,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),Ae.disable(this),this.updateUIClasses({mouse:l.ADD}),this.activateUIButton(d.POLYGON),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}},clickAnywhere:function(e,t){if(e.currentVertexPosition>0&&Ze(t,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(h.SIMPLE_SELECT,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:l.ADD}),e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat)},clickOnVertex:function(e){return this.changeMode(h.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},onMouseMove:function(e,t){e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),Te(t)&&this.updateUIClasses({mouse:l.POINTER})}};We.onTap=We.onClick=function(e,t){return Te(t)?this.clickOnVertex(e,t):this.clickAnywhere(e,t)},We.onKeyUp=function(e,t){Oe(t)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(h.SIMPLE_SELECT)):Me(t)&&this.changeMode(h.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},We.onStop=function(e){this.updateUIClasses({mouse:l.NONE}),Ae.enable(this),this.activateUIButton(),void 0!==this.getFeature(e.polygon.id)&&(e.polygon.removeCoordinate(`0.${e.currentVertexPosition}`),e.polygon.isValid()?this.fire(f.CREATE,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(h.SIMPLE_SELECT,{},{silent:!0})))},We.toDisplayFeatures=function(e,t,n){const o=t.properties.id===e.polygon.id;if(t.properties.active=o?m.ACTIVE:m.INACTIVE,!o)return n(t);if(0===t.geometry.coordinates.length)return;const r=t.geometry.coordinates[0].length;if(!(r<3)){if(t.properties.meta=y.FEATURE,n(Pe(e.polygon.id,t.geometry.coordinates[0][0],"0.0",!1)),r>3){const o=t.geometry.coordinates[0].length-3;n(Pe(e.polygon.id,t.geometry.coordinates[0][o],`0.${o}`,!1))}if(r<=4){const e=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]];if(n({type:p.FEATURE,properties:t.properties,geometry:{coordinates:e,type:p.LINE_STRING}}),3===r)return}return n(t)}},We.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(h.SIMPLE_SELECT)};var ze=We;const Qe={onSetup:function(e){const t=(e=e||{}).featureId;let n,o,r="forward";if(t){if(n=this.getFeature(t),!n)throw new Error("Could not find a feature with the provided featureId");let i=e.from;if(i&&"Feature"===i.type&&i.geometry&&"Point"===i.geometry.type&&(i=i.geometry),i&&"Point"===i.type&&i.coordinates&&2===i.coordinates.length&&(i=i.coordinates),!i||!Array.isArray(i))throw new Error("Please use the `from` property to indicate which point to continue the line from");const s=n.coordinates.length-1;if(n.coordinates[s][0]===i[0]&&n.coordinates[s][1]===i[1])o=s+1,n.addCoordinate(o,...n.coordinates[s]);else{if(n.coordinates[0][0]!==i[0]||n.coordinates[0][1]!==i[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");r="backwards",o=0,n.addCoordinate(o,...n.coordinates[0])}}else n=this.newFeature({type:p.FEATURE,properties:{},geometry:{type:p.LINE_STRING,coordinates:[]}}),o=0,this.addFeature(n);return this.clearSelectedFeatures(),Ae.disable(this),this.updateUIClasses({mouse:l.ADD}),this.activateUIButton(d.LINE),this.setActionableState({trash:!0}),{line:n,currentVertexPosition:o,direction:r}},clickAnywhere:function(e,t){if(e.currentVertexPosition>0&&Ze(t,e.line.coordinates[e.currentVertexPosition-1])||"backwards"===e.direction&&Ze(t,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(h.SIMPLE_SELECT,{featureIds:[e.line.id]});this.updateUIClasses({mouse:l.ADD}),e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),"forward"===e.direction?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)):e.line.addCoordinate(0,t.lngLat.lng,t.lngLat.lat)},clickOnVertex:function(e){return this.changeMode(h.SIMPLE_SELECT,{featureIds:[e.line.id]})},onMouseMove:function(e,t){e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),Te(t)&&this.updateUIClasses({mouse:l.POINTER})}};Qe.onTap=Qe.onClick=function(e,t){if(Te(t))return this.clickOnVertex(e,t);this.clickAnywhere(e,t)},Qe.onKeyUp=function(e,t){Me(t)?this.changeMode(h.SIMPLE_SELECT,{featureIds:[e.line.id]}):Oe(t)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(h.SIMPLE_SELECT))},Qe.onStop=function(e){Ae.enable(this),this.activateUIButton(),void 0!==this.getFeature(e.line.id)&&(e.line.removeCoordinate(`${e.currentVertexPosition}`),e.line.isValid()?this.fire(f.CREATE,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(h.SIMPLE_SELECT,{},{silent:!0})))},Qe.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(h.SIMPLE_SELECT)},Qe.toDisplayFeatures=function(e,t,n){const o=t.properties.id===e.line.id;if(t.properties.active=o?m.ACTIVE:m.INACTIVE,!o)return n(t);t.geometry.coordinates.length<2||(t.properties.meta=y.FEATURE,n(Pe(e.line.id,t.geometry.coordinates["forward"===e.direction?t.geometry.coordinates.length-2:1],""+("forward"===e.direction?t.geometry.coordinates.length-2:1),!1)),n(t))};var et={simple_select:He,direct_select:qe,draw_point:Xe,draw_polygon:ze,draw_line_string:Qe};const tt={defaultMode:h.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:ye,modes:et,controls:{},userProperties:!1,suppressAPIEvents:!0},nt={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},ot={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function rt(e,t){return e.map((e=>e.source?e:Object.assign({},e,{id:`${e.id}.${t}`,source:"hot"===t?u.HOT:u.COLD})))}var it=n(17),st=n(186);function at(e,t){return e.length===t.length&&JSON.stringify(e.map((e=>e)).sort())===JSON.stringify(t.map((e=>e)).sort())}const ct={Polygon:z,LineString:Z,Point:K,MultiPolygon:ne,MultiLineString:ne,MultiPoint:ne};function ut(e){!function(e,t){const n={options:e=function(e={}){let t=Object.assign({},e);return e.controls||(t.controls={}),!1===e.displayControlsDefault?t.controls=Object.assign({},ot,e.controls):t.controls=Object.assign({},nt,e.controls),t=Object.assign({},tt,t),t.styles=rt(t.styles,"cold").concat(rt(t.styles,"hot")),t}(e)};t=function(e,t){t.modes=h;const n=void 0===e.options.suppressAPIEvents||!!e.options.suppressAPIEvents;return t.getFeatureIdsAt=function(t){return N.click({point:t},null,e).map((e=>e.properties.id))},t.getSelectedIds=function(){return e.store.getSelectedIds()},t.getSelected=function(){return{type:p.FEATURE_COLLECTION,features:e.store.getSelectedIds().map((t=>e.store.get(t))).map((e=>e.toGeoJSON()))}},t.getSelectedPoints=function(){return{type:p.FEATURE_COLLECTION,features:e.store.getSelectedCoordinates().map((e=>({type:p.FEATURE,properties:{},geometry:{type:p.POINT,coordinates:e.coordinates}})))}},t.set=function(n){if(void 0===n.type||n.type!==p.FEATURE_COLLECTION||!Array.isArray(n.features))throw new Error("Invalid FeatureCollection");const o=e.store.createRenderBatch();let r=e.store.getAllIds().slice();const i=t.add(n),s=new P(i);return r=r.filter((e=>!s.has(e))),r.length&&t.delete(r),o(),i},t.add=function(t){const o=JSON.parse(JSON.stringify(st(t))).features.map((t=>{if(t.id=t.id||$(),null===t.geometry)throw new Error("Invalid geometry: null");if(void 0===e.store.get(t.id)||e.store.get(t.id).type!==t.geometry.type){const o=ct[t.geometry.type];if(void 0===o)throw new Error(`Invalid geometry type: ${t.geometry.type}.`);const r=new o(e,t);e.store.add(r,{silent:n})}else{const o=e.store.get(t.id),r=o.properties;o.properties=t.properties,it(r,t.properties)||e.store.featureChanged(o.id,{silent:n}),it(o.getCoordinates(),t.geometry.coordinates)||o.incomingCoords(t.geometry.coordinates)}return t.id}));return e.store.render(),o},t.get=function(t){const n=e.store.get(t);if(n)return n.toGeoJSON()},t.getAll=function(){return{type:p.FEATURE_COLLECTION,features:e.store.getAll().map((e=>e.toGeoJSON()))}},t.delete=function(o){return e.store.delete(o,{silent:n}),t.getMode()!==h.DIRECT_SELECT||e.store.getSelectedIds().length?e.store.render():e.events.changeMode(h.SIMPLE_SELECT,void 0,{silent:n}),t},t.deleteAll=function(){return e.store.delete(e.store.getAllIds(),{silent:n}),t.getMode()===h.DIRECT_SELECT?e.events.changeMode(h.SIMPLE_SELECT,void 0,{silent:n}):e.store.render(),t},t.changeMode=function(o,r={}){return o===h.SIMPLE_SELECT&&t.getMode()===h.SIMPLE_SELECT?(at(r.featureIds||[],e.store.getSelectedIds())||(e.store.setSelected(r.featureIds,{silent:n}),e.store.render()),t):(o===h.DIRECT_SELECT&&t.getMode()===h.DIRECT_SELECT&&r.featureId===e.store.getSelectedIds()[0]||e.events.changeMode(o,r,{silent:n}),t)},t.getMode=function(){return e.events.getMode()},t.trash=function(){return e.events.trash({silent:n}),t},t.combineFeatures=function(){return e.events.combineFeatures({silent:n}),t},t.uncombineFeatures=function(){return e.events.uncombineFeatures({silent:n}),t},t.setFeatureProperty=function(o,r,i){return e.store.setFeatureProperty(o,r,i,{silent:n}),t},t}(n,t),n.api=t;const o=pe(n);t.onAdd=o.onAdd,t.onRemove=o.onRemove,t.types=d,t.options=e}(e,this)}ut.modes=et,ut.constants=o,ut.lib=i;var lt=ut,dt=n(165),pt=n(278);const ht=11102230246251565e-32,ft=134217729,gt=(3+8*ht)*ht;function yt(e,t,n,o,r){let i,s,a,c,u=t[0],l=o[0],d=0,p=0;l>u==l>-u?(i=u,u=t[++d]):(i=l,l=o[++p]);let h=0;if(d<e&&p<n)for(l>u==l>-u?(s=u+i,a=i-(s-u),u=t[++d]):(s=l+i,a=i-(s-l),l=o[++p]),i=s,0!==a&&(r[h++]=a);d<e&&p<n;)l>u==l>-u?(s=i+u,c=s-i,a=i-(s-c)+(u-c),u=t[++d]):(s=i+l,c=s-i,a=i-(s-c)+(l-c),l=o[++p]),i=s,0!==a&&(r[h++]=a);for(;d<e;)s=i+u,c=s-i,a=i-(s-c)+(u-c),u=t[++d],i=s,0!==a&&(r[h++]=a);for(;p<n;)s=i+l,c=s-i,a=i-(s-c)+(l-c),l=o[++p],i=s,0!==a&&(r[h++]=a);return 0===i&&0!==h||(r[h++]=i),h}function mt(e){return new Float64Array(e)}const vt=mt(4),Et=mt(8),St=mt(12),bt=mt(16),It=mt(4);function Tt(e,t,n,o,r,i){const s=(t-i)*(n-r),a=(e-r)*(o-i),c=s-a,u=Math.abs(s+a);return Math.abs(c)>=33306690738754716e-32*u?c:-function(e,t,n,o,r,i,s){let a,c,u,l,d,p,h,f,g,y,m,v,E,S,b,I,T,C;const O=e-r,M=n-r,x=t-i,_=o-i;S=O*_,p=ft*O,h=p-(p-O),f=O-h,p=ft*_,g=p-(p-_),y=_-g,b=f*y-(S-h*g-f*g-h*y),I=x*M,p=ft*x,h=p-(p-x),f=x-h,p=ft*M,g=p-(p-M),y=M-g,T=f*y-(I-h*g-f*g-h*y),m=b-T,d=b-m,vt[0]=b-(m+d)+(d-T),v=S+m,d=v-S,E=S-(v-d)+(m-d),m=E-I,d=E-m,vt[1]=E-(m+d)+(d-I),C=v+m,d=C-v,vt[2]=v-(C-d)+(m-d),vt[3]=C;let w=function(e,t){let n=t[0];for(let e=1;e<4;e++)n+=t[e];return n}(0,vt),P=22204460492503146e-32*s;if(w>=P||-w>=P)return w;if(d=e-O,a=e-(O+d)+(d-r),d=n-M,u=n-(M+d)+(d-r),d=t-x,c=t-(x+d)+(d-i),d=o-_,l=o-(_+d)+(d-i),0===a&&0===c&&0===u&&0===l)return w;if(P=11093356479670487e-47*s+gt*Math.abs(w),w+=O*l+_*a-(x*u+M*c),w>=P||-w>=P)return w;S=a*_,p=ft*a,h=p-(p-a),f=a-h,p=ft*_,g=p-(p-_),y=_-g,b=f*y-(S-h*g-f*g-h*y),I=c*M,p=ft*c,h=p-(p-c),f=c-h,p=ft*M,g=p-(p-M),y=M-g,T=f*y-(I-h*g-f*g-h*y),m=b-T,d=b-m,It[0]=b-(m+d)+(d-T),v=S+m,d=v-S,E=S-(v-d)+(m-d),m=E-I,d=E-m,It[1]=E-(m+d)+(d-I),C=v+m,d=C-v,It[2]=v-(C-d)+(m-d),It[3]=C;const L=yt(4,vt,4,It,Et);S=O*l,p=ft*O,h=p-(p-O),f=O-h,p=ft*l,g=p-(p-l),y=l-g,b=f*y-(S-h*g-f*g-h*y),I=x*u,p=ft*x,h=p-(p-x),f=x-h,p=ft*u,g=p-(p-u),y=u-g,T=f*y-(I-h*g-f*g-h*y),m=b-T,d=b-m,It[0]=b-(m+d)+(d-T),v=S+m,d=v-S,E=S-(v-d)+(m-d),m=E-I,d=E-m,It[1]=E-(m+d)+(d-I),C=v+m,d=C-v,It[2]=v-(C-d)+(m-d),It[3]=C;const N=yt(L,Et,4,It,St);S=a*l,p=ft*a,h=p-(p-a),f=a-h,p=ft*l,g=p-(p-l),y=l-g,b=f*y-(S-h*g-f*g-h*y),I=c*u,p=ft*c,h=p-(p-c),f=c-h,p=ft*u,g=p-(p-u),y=u-g,T=f*y-(I-h*g-f*g-h*y),m=b-T,d=b-m,It[0]=b-(m+d)+(d-T),v=S+m,d=v-S,E=S-(v-d)+(m-d),m=E-I,d=E-m,It[1]=E-(m+d)+(d-I),C=v+m,d=C-v,It[2]=v-(C-d)+(m-d),It[3]=C;const A=yt(N,St,4,It,bt);return bt[A-1]}(e,t,n,o,r,i,u)}function Ct(e,t){var n,o,r,i,s,a,c,u,l,d=0,p=e[0],h=e[1],f=t.length;for(n=0;n<f;n++){o=0;var g=t[n],y=g.length-1;if((u=g[0])[0]!==g[y][0]&&u[1]!==g[y][1])throw new Error("First and last coordinates in a ring must be the same");for(i=u[0]-p,s=u[1]-h;o<y;o++){if(a=(l=g[o+1])[0]-p,c=l[1]-h,0===s&&0===c){if(a<=0&&i>=0||i<=0&&a>=0)return 0}else if(c>=0&&s<=0||c<=0&&s>=0){if(0===(r=Tt(i,a,s,c,0,0)))return 0;(r>0&&c>0&&s<=0||r<0&&c<=0&&s>0)&&d++}u=l,s=c,i=a}}return d%2!=0}function Ot(e,t,n={}){if(!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");const o=(0,dt.uG)(e),r=(0,dt.bg)(t),i=r.type,s=t.bbox;let a=r.coordinates;if(s&&!1===function(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}(o,s))return!1;"Polygon"===i&&(a=[a]);let c=!1;for(var u=0;u<a.length;++u){const e=Ct(o,a[u]);if(0===e)return!n.ignoreBoundary;e&&(c=!0)}return c}mt(4),mt(4),mt(4),mt(4),mt(4),mt(4),mt(4),mt(4),mt(4),mt(8),mt(8),mt(8),mt(4),mt(8),mt(8),mt(8),mt(12),mt(192),mt(192),mt(4),mt(4),mt(4),mt(4),mt(4),mt(4),mt(4),mt(4),mt(8),mt(8),mt(8),mt(8),mt(8),mt(8),mt(8),mt(8),mt(8),mt(4),mt(4),mt(4),mt(8),mt(16),mt(16),mt(16),mt(32),mt(32),mt(48),mt(64),mt(1152),mt(1152),mt(4),mt(4),mt(4),mt(4),mt(4),mt(4),mt(4),mt(4),mt(4),mt(4),mt(24),mt(24),mt(24),mt(24),mt(24),mt(24),mt(24),mt(24),mt(24),mt(24),mt(1152),mt(1152),mt(1152),mt(1152),mt(1152),mt(2304),mt(2304),mt(3456),mt(5760),mt(8),mt(8),mt(8),mt(16),mt(24),mt(48),mt(48),mt(96),mt(192),mt(384),mt(384),mt(384),mt(768),mt(96),mt(96),mt(96),mt(1152);class Mt{constructor(e=[],t=xt){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,o=t[e];for(;e>0;){const r=e-1>>1,i=t[r];if(n(o,i)>=0)break;t[e]=i,e=r}t[e]=o}_down(e){const{data:t,compare:n}=this,o=this.length>>1,r=t[e];for(;e<o;){let o=1+(e<<1),i=t[o];const s=o+1;if(s<this.length&&n(t[s],i)<0&&(o=s,i=t[s]),n(i,r)>=0)break;t[e]=i,e=o}t[e]=r}}function xt(e,t){return e<t?-1:e>t?1:0}function _t(e,t){return e.p.x>t.p.x?1:e.p.x<t.p.x?-1:e.p.y!==t.p.y?e.p.y>t.p.y?1:-1:1}function wt(e,t){return e.rightSweepEvent.p.x>t.rightSweepEvent.p.x?1:e.rightSweepEvent.p.x<t.rightSweepEvent.p.x?-1:e.rightSweepEvent.p.y!==t.rightSweepEvent.p.y?e.rightSweepEvent.p.y<t.rightSweepEvent.p.y?1:-1:1}class Pt{constructor(e,t,n,o){this.p={x:e[0],y:e[1]},this.featureId=t,this.ringId=n,this.eventId=o,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(e){return this.p.x===e.p.x&&this.p.y===e.p.y}}let Lt=0,Nt=0,At=0;function Ft(e,t){const n="Feature"===e.type?e.geometry:e;let o=n.coordinates;"Polygon"!==n.type&&"MultiLineString"!==n.type||(o=[o]),"LineString"===n.type&&(o=[[o]]);for(let e=0;e<o.length;e++)for(let n=0;n<o[e].length;n++){let r=o[e][n][0],i=null;Nt+=1;for(let s=0;s<o[e][n].length-1;s++){i=o[e][n][s+1];const a=new Pt(r,Lt,Nt,At),c=new Pt(i,Lt,Nt,At+1);a.otherEvent=c,c.otherEvent=a,_t(a,c)>0?(c.isLeftEndpoint=!0,a.isLeftEndpoint=!1):(a.isLeftEndpoint=!0,c.isLeftEndpoint=!1),t.push(a),t.push(c),r=i,At+=1}}Lt+=1}class kt{constructor(e){this.leftSweepEvent=e,this.rightSweepEvent=e.otherEvent}}function Rt(e,t){if(null===e||null===t)return!1;if(e.leftSweepEvent.ringId===t.leftSweepEvent.ringId&&(e.rightSweepEvent.isSamePoint(t.leftSweepEvent)||e.rightSweepEvent.isSamePoint(t.leftSweepEvent)||e.rightSweepEvent.isSamePoint(t.rightSweepEvent)||e.leftSweepEvent.isSamePoint(t.leftSweepEvent)||e.leftSweepEvent.isSamePoint(t.rightSweepEvent)))return!1;const n=e.leftSweepEvent.p.x,o=e.leftSweepEvent.p.y,r=e.rightSweepEvent.p.x,i=e.rightSweepEvent.p.y,s=t.leftSweepEvent.p.x,a=t.leftSweepEvent.p.y,c=t.rightSweepEvent.p.x,u=t.rightSweepEvent.p.y,l=(u-a)*(r-n)-(c-s)*(i-o);if(0===l)return!1;const d=((c-s)*(o-a)-(u-a)*(n-s))/l,p=((r-n)*(o-a)-(i-o)*(n-s))/l;return d>=0&&d<=1&&p>=0&&p<=1&&[n+d*(r-n),o+d*(i-o)]}function Dt(e,t,n={}){const{removeDuplicates:o=!0,ignoreSelfIntersections:r=!0}=n;let i=[];"FeatureCollection"===e.type?i=i.concat(e.features):"Feature"===e.type?i.push(e):"LineString"!==e.type&&"Polygon"!==e.type&&"MultiLineString"!==e.type&&"MultiPolygon"!==e.type||i.push((0,pt.N4)(e)),"FeatureCollection"===t.type?i=i.concat(t.features):"Feature"===t.type?i.push(t):"LineString"!==t.type&&"Polygon"!==t.type&&"MultiLineString"!==t.type&&"MultiPolygon"!==t.type||i.push((0,pt.N4)(t));const s=function(e,t){const n=new Mt([],_t);return function(e,t){if("FeatureCollection"===e.type){const n=e.features;for(let e=0;e<n.length;e++)Ft(n[e],t)}else Ft(e,t)}(e,n),function(e,t){t=t||!1;const n=[],o=new Mt([],wt);for(;e.length;){const r=e.pop();if(r.isLeftEndpoint){const e=new kt(r);for(let i=0;i<o.data.length;i++){const s=o.data[i];if(t&&s.leftSweepEvent.featureId===r.featureId)continue;const a=Rt(e,s);!1!==a&&n.push(a)}o.push(e)}else!1===r.isLeftEndpoint&&o.pop()}return n}(n,t)}((0,pt.Lr)(i),r);let a=[];if(o){const e={};s.forEach((t=>{const n=t.join(",");e[n]||(e[n]=!0,a.push(t))}))}else a=s;return(0,pt.Lr)(a.map((e=>(0,pt.zx)(e))))}var Ut=n(850);function Vt(e,t={}){const n=(0,dt.bg)(e);switch(t.properties||"Feature"!==e.type||(t.properties=e.properties),n.type){case"Polygon":return function(e,t={}){return Bt((0,dt.bg)(e).coordinates,t.properties?t.properties:"Feature"===e.type?e.properties:{})}(n,t);case"MultiPolygon":return function(e,t={}){const n=(0,dt.bg)(e).coordinates,o=t.properties?t.properties:"Feature"===e.type?e.properties:{},r=[];return n.forEach((e=>{r.push(Bt(e,o))})),(0,pt.Lr)(r)}(n,t);default:throw new Error("invalid poly")}}function Bt(e,t){return e.length>1?(0,pt.NU)(e,t):(0,pt.wi)(e[0],t)}function jt(e,t,{ignoreSelfIntersections:n=!0}={ignoreSelfIntersections:!0}){let o=!0;return(0,Ut.iw)(e,(e=>{(0,Ut.iw)(t,(t=>{if(!1===o)return!1;o=function(e,t,n){switch(e.type){case"Point":switch(t.type){case"Point":return o=e.coordinates,r=t.coordinates,!(o[0]===r[0]&&o[1]===r[1]);case"LineString":return!Gt(t,e);case"Polygon":return!Ot(e,t)}break;case"LineString":switch(t.type){case"Point":return!Gt(e,t);case"LineString":return!function(e,t,n){return Dt(e,t,{ignoreSelfIntersections:n}).features.length>0}(e,t,n);case"Polygon":return!Ht(t,e,n)}break;case"Polygon":switch(t.type){case"Point":return!Ot(t,e);case"LineString":return!Ht(e,t,n);case"Polygon":return!function(e,t,n){for(const n of e.coordinates[0])if(Ot(n,t))return!0;for(const n of t.coordinates[0])if(Ot(n,e))return!0;return Dt(Vt(e),Vt(t),{ignoreSelfIntersections:n}).features.length>0}(t,e,n)}}var o,r;return!1}(e.geometry,t.geometry,n)}))})),o}function Gt(e,t){for(let n=0;n<e.coordinates.length-1;n++)if($t(e.coordinates[n],e.coordinates[n+1],t.coordinates))return!0;return!1}function Ht(e,t,n){for(const n of t.coordinates)if(Ot(n,e))return!0;return Dt(t,Vt(e),{ignoreSelfIntersections:n}).features.length>0}function $t(e,t,n){const o=n[0]-e[0],r=n[1]-e[1],i=t[0]-e[0],s=t[1]-e[1];return 0==o*s-r*i&&(Math.abs(i)>=Math.abs(s)?i>0?e[0]<=n[0]&&n[0]<=t[0]:t[0]<=n[0]&&n[0]<=e[0]:s>0?e[1]<=n[1]&&n[1]<=t[1]:t[1]<=n[1]&&n[1]<=e[1])}function Jt(e,t){var n=(0,dt.bg)(e),o=(0,dt.bg)(t),r=n.type,i=o.type;switch(r){case"MultiPoint":switch(i){case"LineString":return Yt(n,o);case"Polygon":return Kt(n,o);default:throw new Error("feature2 "+i+" geometry not supported")}case"LineString":switch(i){case"MultiPoint":return Yt(o,n);case"LineString":return function(e,t){if(Dt(e,t).features.length>0)for(var n=0;n<e.coordinates.length-1;n++)for(var o=0;o<t.coordinates.length-1;o++){var r=!0;if(0!==o&&o!==t.coordinates.length-2||(r=!1),Xt(e.coordinates[n],e.coordinates[n+1],t.coordinates[o],r))return!0}return!1}(n,o);case"Polygon":return qt(n,o);default:throw new Error("feature2 "+i+" geometry not supported")}case"Polygon":switch(i){case"MultiPoint":return Kt(o,n);case"LineString":return qt(o,n);default:throw new Error("feature2 "+i+" geometry not supported")}default:throw new Error("feature1 "+r+" geometry not supported")}}function Yt(e,t){for(var n=!1,o=!1,r=e.coordinates.length,i=0;i<r&&!n&&!o;){for(var s=0;s<t.coordinates.length-1;s++){var a=!0;0!==s&&s!==t.coordinates.length-2||(a=!1),Xt(t.coordinates[s],t.coordinates[s+1],e.coordinates[i],a)?n=!0:o=!0}i++}return n&&o}function qt(e,t){return Dt(e,Vt(t)).features.length>0}function Kt(e,t){var n=!1,o=!1,r=e.coordinates.length;for(let i=0;i<r&&(!n||!o);i++)Ot((0,pt.zx)(e.coordinates[i]),t)?n=!0:o=!0;return o&&n}function Xt(e,t,n,o){var r=n[0]-e[0],i=n[1]-e[1],s=t[0]-e[0],a=t[1]-e[1];return 0==r*a-i*s&&(o?Math.abs(s)>=Math.abs(a)?s>0?e[0]<=n[0]&&n[0]<=t[0]:t[0]<=n[0]&&n[0]<=e[0]:a>0?e[1]<=n[1]&&n[1]<=t[1]:t[1]<=n[1]&&n[1]<=e[1]:Math.abs(s)>=Math.abs(a)?s>0?e[0]<n[0]&&n[0]<t[0]:t[0]<n[0]&&n[0]<e[0]:a>0?e[1]<n[1]&&n[1]<t[1]:t[1]<n[1]&&n[1]<e[1])}function Zt(e,t,n={}){const o=(0,dt.uG)(e),r=(0,dt.$R)(t);for(let e=0;e<r.length-1;e++){let t=!1;if(n.ignoreEndVertices&&(0===e&&(t="start"),e===r.length-2&&(t="end"),0===e&&e+1===r.length-1&&(t="both")),Wt(r[e],r[e+1],o,t,void 0===n.epsilon?null:n.epsilon))return!0}return!1}function Wt(e,t,n,o,r){const i=n[0],s=n[1],a=e[0],c=e[1],u=t[0],l=t[1],d=u-a,p=l-c,h=(n[0]-a)*p-(n[1]-c)*d;if(null!==r){if(Math.abs(h)>r)return!1}else if(0!==h)return!1;return Math.abs(d)===Math.abs(p)&&0===Math.abs(d)?!o&&n[0]===e[0]&&n[1]===e[1]:o?"start"===o?Math.abs(d)>=Math.abs(p)?d>0?a<i&&i<=u:u<=i&&i<a:p>0?c<s&&s<=l:l<=s&&s<c:"end"===o?Math.abs(d)>=Math.abs(p)?d>0?a<=i&&i<u:u<i&&i<=a:p>0?c<=s&&s<l:l<s&&s<=c:"both"===o&&(Math.abs(d)>=Math.abs(p)?d>0?a<i&&i<u:u<i&&i<a:p>0?c<s&&s<l:l<s&&s<c):Math.abs(d)>=Math.abs(p)?d>0?a<=i&&i<=u:u<=i&&i<=a:p>0?c<=s&&s<=l:l<=s&&s<=c}function zt(e){return e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]}function Qt(e){for(var t=0;t<e.length-1;t++)for(var n=e[t],o=t+1;o<e.length-2;o++){var r=[e[o],e[o+1]];if(Zt(n,(0,pt.wi)(r)))return!0}return!1}function en(e,t,n){for(var o=(0,pt.n1)(e),r=n+1;r<t.length;r++)if(!jt(o,(0,pt.n1)(t[r]))&&Jt(o,(0,pt.wi)(t[r][0])))return!1;return!0}var tn=n(614);function nn(e){return nn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},nn(e)}function on(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function rn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?on(Object(n),!0).forEach((function(t){sn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):on(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function sn(e,t,n){return(t=function(e){var t=function(e){if("object"!=nn(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=nn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==nn(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function an(e){return function(e){if(Array.isArray(e))return ln(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||un(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function cn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,i,s,a=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(o=i.call(n)).done)&&(a.push(o.value),a.length!==t);c=!0);}catch(e){u=!0,r=e}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(u)throw r}}return a}}(e,t)||un(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function un(e,t){if(e){if("string"==typeof e)return ln(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ln(e,t):void 0}}function ln(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}var dn=["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"],pn=function(e){if(e[0].length<=1||function(e){var t,n,o,r,i,s,a,c,u,l,d,p,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01;if(e[0].length<=1)return!0;if(e[0].length<=3)for(var f=0;f<e[0].length;f++)for(var g=f+1;g<e[0].length;g++)if(t=e[0][f],n=e[0][g],void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,r=(o=cn(t,2))[0],i=o[1],a=(s=cn(n,2))[0],l=(u=function(e){return e*Math.PI/180})((c=s[1])-i),d=u(a-r),p=Math.pow(Math.sin(l/2),2)+Math.cos(u(i))*Math.cos(u(c))*Math.pow(Math.sin(d/2),2),12742e3*Math.atan2(Math.sqrt(p),Math.sqrt(1-p))<h)return!1;return!0}(e))return!0;if(!Array.isArray(e)||e.length<4)return!1;var t=e[0],n=e[e.length-1];if(t[0]!==n[0]||t[1]!==n[1])return!1;var o=(0,pt.n1)([e]);return!(!function(e){if(!e.type)return!1;const t=(0,dt.bg)(e),n=t.type,o=t.coordinates;switch(n){case"Point":return o.length>1;case"MultiPoint":for(var r=0;r<o.length;r++)if(o[r].length<2)return!1;return!0;case"LineString":if(o.length<2)return!1;for(r=0;r<o.length;r++)if(o[r].length<2)return!1;return!0;case"MultiLineString":if(o.length<2)return!1;for(r=0;r<o.length;r++)if(o[r].length<2)return!1;return!0;case"Polygon":for(r=0;r<t.coordinates.length;r++){if(o[r].length<4)return!1;if(!zt(o[r]))return!1;if(Qt(o[r]))return!1;if(r>0&&Dt((0,pt.n1)([o[0]]),(0,pt.n1)([o[r]])).features.length>1)return!1}return!0;case"MultiPolygon":for(r=0;r<t.coordinates.length;r++)for(var i=t.coordinates[r],s=0;s<i.length;s++){if(i[s].length<4)return!1;if(!zt(i[s]))return!1;if(Qt(i[s]))return!1;if(0===s&&!en(i,t.coordinates,r))return!1;if(s>0&&Dt((0,pt.n1)([i[0]]),(0,pt.n1)([i[s]])).features.length>1)return!1}return!0;default:return!1}}(o)||(0,tn.A)(o)<=0)},hn={onSetup:function(){return{}},onClick:function(){return!1},onKeyUp:function(){return!1},onDrag:function(){return!1},toDisplayFeatures:function(e,t,n){t.properties.active="false",n(t)}},fn=rn(rn({},qe),{},{onSetup:function(e){var t=this,n=qe.onSetup.call(this,e),o=e.container,r=e.featureId,i=e.selectedIndex,s=e.selectedType,a=e.isPanEnabled,c=e.editButton;if(n.container=o,n.editButton=c,n.isPanEnabled=a,n.featureId=r,n.vertecies=this.getVerticies(r),n.midpoints=this.getMidpoints(r),n.selectedIndex=void 0!==i?i:-1,n.selectedType=s,this.touchstartHandler=function(e){return t.onTouchstart(n,e)},this.touchendHandler=function(e){return t.onTouchend(n,e)},o.addEventListener("touchstart",this.touchstartHandler),o.addEventListener("touchend",this.touchendHandler),this.keydownHandler=function(e){return t.onKeydown(n,e)},this.keyupHandler=function(e){return t.onKeyup(n,e)},o.addEventListener("keydown",this.keydownHandler),o.addEventListener("keyup",this.keyupHandler),this.selectionChangeHandler=function(e){return t.onSelectionChange(n,e)},this.map.on("draw.selectionchange",this.selectionChangeHandler),this.map.on("draw.update",(function(e){return t.onUpdate(n,e)})),"midpoint"===s){var u=n.midpoints[i-n.vertecies.length];this.updateMidpoint(u)}return n},onSelectionChange:function(e,t){var n,o,r=null===(n=t.points[t.points.length-1])||void 0===n?void 0:n.geometry.coordinates,i=t.features[0].geometry.coordinates.flat(1).findIndex((function(e){return r&&e[0]===r[0]&&e[1]===r[1]}));e.selectedIndex=e.selectedIndex<0?i:e.selectedIndex,null!==(o=e.selectedType)&&void 0!==o||(e.selectedType=i>=0?"vertex":null)},onUpdate:function(e,t){var n,o=parseInt(null===(n=e.selectedCoordPaths[0])||void 0===n?void 0:n.split(".")[1],10);e.selectedIndex=isNaN(o)?e.selectedIndex:o},onTouchstart:function(e,t){console.log("onTouchstart")},onKeydown:function(e,t){" "===t.key&&e.selectedIndex<0&&(e.isPanEnabled=!1,this.updateVertex(e)),!t.altKey&&dn.includes(t.key)&&e.selectedIndex>=0&&(t.preventDefault(),t.stopPropagation(),"midpoint"===e.selectedType&&this.insertVertex(e,t),"vertex"===e.selectedType&&this.moveVertex(e,t)),t.altKey&&dn.includes(t.key)&&e.selectedIndex>=0&&this.updateVertex(e,t.key),"Escape"===t.key&&(e.isPanEnabled=!0,e.selectedIndex=-1,e.selectedType=null,this._ctx.api.changeMode("edit_vertex",{container:e.container,isPanEnabled:!0,featureId:e.featureId}))},onTouchend:function(e,t){console.log("onTouchend")},onKeyup:function(e,t){dn.includes(t.key)&&e.selectedIndex>=0&&t.stopPropagation(),"Delete"===t.key&&this.deleteVertex(e)},getVerticies:function(e){var t,n=this.getFeature(e);return(null==n||null===(t=n.coordinates)||void 0===t?void 0:t.flat(1))||[]},getMidpoints:function(e){var t=this.getFeature(e);if(!t)return[];for(var n=t.coordinates.flat(1),o=[],r=0;r<n.length;r++){var i=(r+1)%n.length,s=(n[r][0]+n[i][0])/2,a=(n[r][1]+n[i][1])/2;o.push([s,a])}return o},getVertexOrMidpoint:function(e,t){var n=this.map,o=e.vertecies.map((function(e){return Object.values(n.project(e))})),r=e.midpoints.map((function(e){return Object.values(n.project(e))})),i=[].concat(an(o),an(r)),s=function(e,t,n){var o=t.filter((function(t,o){var r=Math.abs(t[0]-e[0]),i=Math.abs(t[1]-e[1]);return("ArrowUp"===n?t[1]<=e[1]&&i>=r:"ArrowDown"===n?t[1]>e[1]&&i>=r:"ArrowLeft"===n?t[0]<=e[0]&&i<r:"ArrowRight"!==n||t[0]>e[0]&&i<r)&&JSON.stringify(t)!==JSON.stringify(e)}));o.length||o.push(e);var r=o.map((function(t){return n=Math.abs(e[0]-t[0]),o=Math.abs(e[1]-t[1]),Math.sqrt(Math.pow(n,2)+Math.pow(o,2));var n,o})),i=o[r.indexOf(Math.min.apply(Math,an(r)))];return t.findIndex((function(e){return JSON.stringify(e)===JSON.stringify(i)}))}(i[e.selectedIndex]||Object.values(n.project(n.getCenter())),i,t);return[s,s<e.vertecies.length?"vertex":"midpoint"]},updateMidpoint:function(e){var t=this.map;setTimeout((function(){t.getSource("mapbox-gl-draw-hot").setData({type:"Feature",properties:{meta:"midpoint",active:"true",id:"active-midpoint"},geometry:{type:"Point",coordinates:e}})}),0)},updateVertex:function(e,t){var n=e.container,o=e.isPanEnabled,r=e.featureId,i=cn(this.getVertexOrMidpoint(e,t),2),s=i[0],a=i[1];this._ctx.api.changeMode("edit_vertex",rn({container:n,isPanEnabled:o,featureId:r,selectedIndex:s,selectedType:a},"vertex"===a?{coordPath:"0.".concat(s)}:{}))},getOffset:function(e,t){var n=this.map,o=n.project(e),r=t.shiftKey?1:5;return"ArrowUp"===t.key?o.y-=r:"ArrowDown"===t.key?o.y+=r:"ArrowLeft"===t.key?o.x-=r:o.x+=r,n.unproject(o)},insertVertex:function(e,t){var n=this.getFeature(e.featureId),o=e.selectedIndex-e.vertecies.length,r=e.midpoints[o],i=this.getOffset(r,t);r=[i.lng,i.lat];var s=o,a=n.toGeoJSON();"Polygon"===a.geometry.type&&(a.geometry.coordinates[0].splice(s+1,0,r),this._ctx.api.add(a)),"LineString"===a.geometry.type&&(a.geometry.coordinates.splice(s+1,0,r),this._ctx.api.add(a)),e.vertecies=this.getVerticies(e.featureId),e.midpoints=this.getMidpoints(e.featureId);var c=s+1;this._ctx.api.changeMode("edit_vertex",{container:e.container,isPanEnabled:e.isPanEnabled,featureId:e.featureId,selectedIndex:c,selectedType:"vertex",coordPath:"0.".concat(c)})},moveVertex:function(e,t){var n=this.getFeature(e.featureId),o=n.coordinates.flat(1)[e.selectedIndex],r=this.getOffset(o,t),i=n.toGeoJSON();"Polygon"===i.geometry.type&&(i.geometry.coordinates[0][e.selectedIndex]=[r.lng,r.lat]),"LineString"===i.geometry.type&&(i.geometry.coordinates[e.selectedIndex]=[r.lng,r.lat]),this._ctx.api.add(i),e.vertecies=this.getVerticies(e.featureId),e.midpoints=this.getMidpoints(e.featureId)},deleteVertex:function(e){var t=this._ctx.api,n=this.getFeature(e.featureId).type,o=e.vertecies.length;if(!("Polygon"===n&&o<=3||"LineString"===n&&o<=2)){t.trash();var r=e.selectedIndex>=e.vertecies.length-1?0:e.selectedIndex;t.changeMode("edit_vertex",{container:e.container,isPanEnabled:e.isPanEnabled,featureId:e.featureId,selectedIndex:r,selectedType:"vertex",coordPath:"0.".concat(r)})}},onStop:function(e){this.map.off("draw.selectionchange",this.selectionChangeHandler),e.container.removeEventListener("keydown",this.keydownHandler),e.container.removeEventListener("keyup",this.keyupHandler)}}),gn=rn(rn({},ze),{},{onSetup:function(e){var t=this,n=this.map,o=ze.onSetup.call(this,e),r=e.interfaceType,i=e.container,s=e.featureId,a=e.editVertexButton;o.editVertexButton=a,o.interfaceType=r,o.container=i,o.featureId=s,i.querySelector("[data-vertex-target]")||i.insertAdjacentHTML("beforeend","\n  <svg width='38' height='38' viewBox='0 0 38 38' fill-rule='evenodd' fill='currentColor' style='display:none;position:absolute;top:50%;left:50%;margin:-19px 0 0 -19px' class='vertex-target' data-vertex-target>\n    <path d='M5.035 20H1v-2h4.035C5.525 11.069 11.069 5.525 18 5.035V1h2v4.035c6.931.49 12.475 6.034 12.965 12.965H37v2h-4.035c-.49 6.931-6.034 12.475-12.965 12.965V37h-2v-4.035C11.069 32.475 5.525 26.931 5.035 20zM19 7A12.01 12.01 0 0 0 7 19a12.01 12.01 0 0 0 12 12 12.01 12.01 0 0 0 12-12A12.01 12.01 0 0 0 19 7z'/>\n    <circle cx='19' cy='19' r='2'/>\n  </svg>\n");var c=i.lastElementChild;return c.style.display=["touch","keyboard"].includes(r)?"block":"none",o.vertexMarker=c,this.touchstartHandler=function(e){return t.onTouchstart(o,e)},this.touchendHandler=function(e){return t.onTouchend(o,e)},this.keydownHandler=function(e){return t.onKeydown(o,e)},this.keyupHandler=function(e){return t.onKeyup(o,e)},this.pointerdownHandler=function(e){return t.onPointerdown(o,e)},this.focusHandler=function(e){return t.onFocus(o,e)},this.blurHandler=function(e){return t.onBlur(o,e)},this.createHandler=function(e){return t.onCreate(o,e)},this.moveHandler=function(e){return t.onMove(o,e)},this.pointermoveHandler=function(e){return t.onPointermove(o,e)},this.editClickHandler=function(e){return t.onEditClick(o,e)},a.addEventListener("click",this.editClickHandler),i.addEventListener("keydown",this.keydownHandler),i.addEventListener("keyup",this.keyupHandler),i.addEventListener("focus",this.focusHandler),i.addEventListener("blur",this.blurHandler),n.on("touchstart",this.touchstartHandler),n.on("touchend",this.touchendHandler),n.on("pointerdown",this.pointerdownHandler),n.on("pointermove",this.pointermoveHandler),n.on("pointermove",this.pointermoveHandler),n.on("draw.create",this.createHandler),n.on("move",this.moveHandler),o},onTap:function(e,t){console.log("onTap",e)},onCreate:function(e,t){var n=this._ctx.api,o=t.features[0];n.delete(o.id),o.id=e.featureId,n.add(o)},onUpdate:function(e,t){console.log("onUpdate")},onEditClick:function(e,t){console.log("click")},onTouchstart:function(e,t){"touch"===e.interfaceType&&this.onMove(e,t),e.interfaceType="touch",e.vertexMarker.style.display="block"},onTouchend:function(e,t){"touch"===e.interfaceType&&this.onMove(e,t),e.interfaceType="touch",e.vertexMarker.style.display="block"},onKeydown:function(e,t){"Escape"!==t.key?("keyboard"===e.interfaceType&&this.onMove(e,t),e.interfaceType="keyboard",e.vertexMarker.style.display="block"):t.preventDefault()},onKeyup:function(e,t){"Escape"!==t.key&&("keyboard"===e.interfaceType&&this.onMove(e,t),"keyboard"===e.interfaceType&&"Enter"===t.key&&this.doClick(e),e.interfaceType="keyboard",e.vertexMarker.style.display="block")},onPointerdown:function(e,t){"touch"!==t.pointerType&&(e.interfaceType="pointer",e.vertexMarker.style.display="none")},onFocus:function(e,t){var n=e.vertexMarker,o=e.interfaceType;n.style.display=["touch","keyboard"].includes(o)?"block":"none"},onBlur:function(e,t){t.target!==e.container&&(e.vertexMarker.style.display="none")},doClick:function(e){var t=e.polygon.coordinates;if(pn(t)){var n=this.map,o=n.getCenter(),r=n.project(o),i={lngLat:o,point:r,originalEvent:new window.MouseEvent("click",{clientX:r.x,clientY:r.y,bubbles:!0,cancelable:!0})};ze.onClick.call(this,e,i),this._ctx.store.render()}},onMove:function(e,t){if(["touch","keyboard"].includes(e.interfaceType)){var n=this.map,o=n.getCenter(),r=n.project(o),i={lngLat:o,point:r,originalEvent:new window.MouseEvent("mousemove",{clientX:r.x,clientY:r.y,bubbles:!0,cancelable:!0})};ze.onMouseMove.call(this,e,i),this._ctx.store.render()}},onPointermove:function(e,t){"touch"!==t.pointerType&&(e.vertexMarker.style.display="none")},toDisplayFeatures:function(e,t,n){if(ze.toDisplayFeatures.call(this,e,t,n),"Polygon"===t.geometry.type)for(var o=t.geometry.coordinates[0],r=1;r<o.length-2;r++){var i="0.".concat(r);n(Pe(t.id,o[r],i))}},onStop:function(e){var t;ze.onStop.call(this,e);var n=e.container;n.removeEventListener("keydown",this.keydownHandler),n.removeEventListener("keyup",this.keyupHandler),n.removeEventListener("focus",this.focusHandler),n.removeEventListener("blur",this.blurHandler),this.map.off("pointerdown",this.pointerdownHandler),this.map.off("pointermove",this.pointermoveHandler),this.map.off("draw.create",this.createHandler),this.map.off("move",this.moveHandler),null===(t=n.querySelector("[data-vertex-target]"))||void 0===t||t.remove()}}),yn=function(e){return{id:"fill-active",type:"fill",filter:["all",["==","$type","Polygon"],["==","active","true"]],paint:{"fill-color":e,"fill-opacity":.1}}},mn=function(e){return{id:"stroke-active",type:"line",filter:["all",["==","$type","Polygon"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":e,"line-width":2,"line-opacity":1}}},vn=function(e){return{id:"stroke-inactive",type:"line",filter:["all",["==","$type","Polygon"],["==","active","false"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":e,"line-width":2,"line-opacity":.8}}},En=function(e){return{id:"stroke-preview-line",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":e,"line-width":2,"line-dasharray":[.2,2],"line-opacity":1}}},Sn=function(e){return{id:"midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":5,"circle-color":e}}},bn=function(e){return{id:"vertex",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"]],paint:{"circle-radius":7,"circle-color":e}}},In=function(e,t){return{id:"vertex-halo",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["==","active","true"]],paint:{"circle-radius":9,"circle-stroke-width":3,"circle-color":e,"circle-stroke-color":t}}},Tn=function(e){return{id:"vertex-active",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["==","active","true"]],paint:{"circle-radius":7,"circle-color":e}}},Cn=function(e,t){return{id:"midpoint-halo",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":7,"circle-stroke-width":3,"circle-color":e,"circle-stroke-color":t}}},On=function(e){return{id:"midpoint-active",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":e}}},Mn=function(e){return{id:"circle",type:"line",filter:["==","id","circle"],paint:{"line-color":e,"line-width":2,"line-opacity":.8}}},xn=n(651);function _n(e,t,n,o={}){const r=(0,dt.uG)(e),i=(0,pt.tR)(r[0]),s=(0,pt.tR)(r[1]),a=(0,pt.tR)(n),c=(0,pt.Gf)(t,o.units),u=Math.asin(Math.sin(s)*Math.cos(c)+Math.cos(s)*Math.sin(c)*Math.cos(a)),l=i+Math.atan2(Math.sin(a)*Math.sin(c)*Math.cos(s),Math.cos(c)-Math.sin(s)*Math.sin(u)),d=(0,pt.nv)(l),p=(0,pt.nv)(u);return(0,pt.zx)([d,p],o.properties)}function wn(e,t,n={}){const o=n.steps||64,r=n.properties?n.properties:!Array.isArray(e)&&"Feature"===e.type&&e.properties?e.properties:{},i=[];for(let r=0;r<o;r++)i.push(_n(e,t,-360*r/o,n).geometry.coordinates);return i.push(i[0]),(0,pt.n1)([i],r)}var Pn=n(245);function Ln(e){return Ln="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ln(e)}function Nn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function An(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Fn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?An(Object(n),!0).forEach((function(t){kn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):An(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function kn(e,t,n){return(t=Dn(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Rn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Dn(o.key),o)}}function Dn(e){var t=function(e){if("object"!=Ln(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Ln(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ln(t)?t:t+""}var Un=function(){return e=function e(t,n){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=t.container,i=t.map,s=t.style;Object.assign(this,n);var a=n.drawMode,c=n.shape,u=n.feature,l=n.interfaceType;this.provider=t,this.shape=c,t.draw=this,this.editVertexButton=r.parentNode.nextSibling.querySelector("[data-edit-vertex-button]");var d=u?Fn(Fn({},u),{},{id:c}):null;this.oFeature=d,lt.constants.classes.CONTROL_BASE="maplibregl-ctrl",lt.constants.classes.CONTROL_PREFIX="maplibregl-ctrl-",lt.constants.classes.CONTROL_GROUP="maplibregl-ctrl-group";var p=lt.modes;p.disabled=hn,p.edit_vertex=fn,p.draw_vertex=gn;var h,f,g,y,m=new lt({modes:p,styles:(h=s.name,f="dark"===h?"#ffffff":"#0b0c0c",g="dark"===h?"#373737":"#ffffff",y="dark"===h?"#ffffff":"#0b0c0c",[yn(f),mn(f),vn(f),En(f),Sn(f),bn(f),In(g,y),Tn(f),Cn(g,y),On(f),Mn(f)]),displayControlsDefault:!1,userProperties:!0});i.addControl(m),this.draw=m,d&&"default"===a?this.addFeature(d):(i.on("draw.modechange",(function(e){"simple_select"===e.mode&&m.changeMode("edit_vertex",{container:r.parentNode,featureId:o.shape,editVertexButton:o.editVertexButton,interfaceType:l})})),i.on("draw.vertexselected",(function(e){t.dispatchEvent(new CustomEvent("vertex",{detail:{isSelected:e.isSelected}}))})),this.add(a,c,l))},t=[{key:"add",value:function(e,t,n){var o=this.draw,r=this.provider.container;this.shape=t,"frame"===e&&(o.deleteAll(),o.changeMode("disabled")),"vertex"!==e||o.get(t)||o.changeMode("draw_vertex",{container:r.parentNode,featureId:t,editVertexButton:this.editVertexButton,interfaceType:n})}},{key:"edit",value:function(e,t){var n=this.oFeature,o=this.draw,r=this.provider,i=r.map,s=r.container;if(this.shape=t,n){var a=n.geometry.coordinates,c=this.getBoundsFromCoordinates(a[0]);i.fitBounds(c,{animate:!1})}"frame"===e&&(o.deleteAll(),o.changeMode("disabled")),"vertex"===e&&o.get(t)&&o.changeMode("edit_vertex",{container:s.parentNode,featureId:t,editVertexButton:this.editVertexButton})}},{key:"editPolygon",value:function(){this.addFeature(null,"polygon"),this.edit("vertex","polygon")}},{key:"cancel",value:function(){var e=this.draw,t=this.oFeature;e.deleteAll(),t&&e.add(t),e.changeMode("disabled")}},{key:"finish",value:function(e){var t=this.draw,n=this.provider.paddingBox;if(["square","circle"].includes(e)){var o=this.getFeatureFromElement(n,e);this.addFeature(o)}return this.oFeature=t.get(e),t.changeMode("disabled"),this.oFeature}},{key:"delete",value:function(){this.draw.deleteAll(),this.oFeature=null}},{key:"addFeature",value:function(e,t){var n=this.provider.paddingBox;null!=e||(e=this.getFeatureFromElement(n,t)),this.draw.add(e),this.draw.changeMode("disabled")}},{key:"getBoundsFromCoordinates",value:function(e){var t=1/0,n=1/0,o=-1/0,r=-1/0;return e.forEach((function(e){var i=e[0],s=e[1];t=i<t?i:t,n=s<n?s:n,o=i>o?i:o,r=s>r?s:r})),[t,n,o,r]}},{key:"getFeatureFromElement",value:function(e,t){var n=this.provider,o=n.map,r=n.scale,i=e.getBoundingClientRect(),s=(0,xn.Ig)(e,r),a=o.unproject([s.left,s.top]),c=o.unproject([s.left+i.width/r,s.top+i.height/r]),u={id:t,type:"Feature",geometry:{type:"Polygon"}};if("circle"===t){var l=o.getCenter(),d=new wn([l.lng,l.lat],(0,xn.Yf)([a.lng,a.lat],[c.lng,a.lat])/2,{units:"meters"}).geometry.coordinates[0].map((function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,i,s,a=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(o=i.call(n)).done)&&(a.push(o.value),a.length!==t);c=!0);}catch(e){u=!0,r=e}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(u)throw r}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Nn(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Nn(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,2),n=t[0],o=t[1];return[+n.toFixed(Pn.N.PRECISION),+o.toFixed(Pn.N.PRECISION)]}));u.geometry.coordinates=[d]}else{var p=[a.lng,a.lat,c.lng,c.lat],h=[[[p[0],p[1]],[p[2],p[1]],[p[2],p[3]],[p[0],p[3]],[p[0],p[1]]]];u.geometry.coordinates=h}return u}},{key:"setStyle",value:function(){var e=this.draw,t=this.shape;"edit_vertex"===(null==e?void 0:e.getMode())&&(e.changeMode("simple_select"),this.edit("vertex",t))}}],t&&Rn(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}(),Vn=Un}}]);
//# sourceMappingURL=maplibre-draw.js.map