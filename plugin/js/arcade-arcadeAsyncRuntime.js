"use strict";(self.webpackChunkdefraMap=self.webpackChunkdefraMap||[]).push([[7844,2377,5777],{94932:function(e,t,n){n.r(t),n.d(t,{executeScript:function(){return V},extend:function(){return Q},functionHelper:function(){return U}});var r=n(81216),o=n(26519),a=n(88464),i=n(45824),s=n(37568),l=n(70868),c=n(95341),u=n(69243),f=n(24962),d=n(73465),h=n(20234),p=n(90306),w=n(79146),g=n(86867),m=n(19371),y=n(77256),v=n(46556),b=n(57165);const A=100;async function I(e,t){const n=[];for(let r=0;r<t.arguments.length;r++)n.push(await _(e,t.arguments[r]));return n}async function S(e,t,n){return!0===t.preparsed?n(e,null,t.arguments):n(e,t,await I(e,t))}class D extends c.fF{constructor(e,t){super(),this.definition=null,this.context=null,this.definition=e,this.context=t}createFunction(e){return(...t)=>{const n={spatialReference:this.context.spatialReference,console:this.context.console,lrucache:this.context.lrucache,timeZone:this.context.timeZone??null,exports:this.context.exports,libraryResolver:this.context.libraryResolver,interceptor:this.context.interceptor,localScope:{},depthCounter:{depth:e.depthCounter+1},globalScope:this.context.globalScope};if(n.depthCounter.depth>64)throw new s.D$(e,s.TX.MaximumCallDepth,null);return J(this.definition,n,t,null)}}call(e,t){return k(e,t,((n,r,o)=>{const a={spatialReference:e.spatialReference,services:e.services,console:e.console,libraryResolver:e.libraryResolver,exports:e.exports,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:{},abortSignal:e.abortSignal,globalScope:e.globalScope,depthCounter:{depth:e.depthCounter.depth+1}};if(a.depthCounter.depth>64)throw new s.D$(e,s.TX.MaximumCallDepth,t);return J(this.definition,a,o,t)}))}marshalledCall(e,t,n,r){return r(e,t,(async(o,a,i)=>{const s={spatialReference:e.spatialReference,globalScope:n.globalScope,depthCounter:{depth:e.depthCounter.depth+1},libraryResolver:e.libraryResolver,exports:e.exports,console:e.console,abortSignal:e.abortSignal,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:{}};return i=i.map((t=>!(0,u.i)(t)||t instanceof c.CU?t:(0,c.o6)(t,e,r))),(0,c.o6)(await J(this.definition,s,i,t),n,r)}))}}class T extends r.x{constructor(e){super(e)}async global(e){const t=this.executingContext.globalScope[e.toLowerCase()];if(t.valueset||(t.value=await _(this.executingContext,t.node),t.valueset=!0),(0,u.i)(t.value)&&!(t.value instanceof c.CU)){const e=new c.CU;e.fn=t.value,e.parameterEvaluator=k,e.context=this.executingContext,t.value=e}return t.value}setGlobal(e,t){if((0,u.i)(t))throw new s.D$(null,s.TX.AssignModuleFunction,null);this.executingContext.globalScope[e.toLowerCase()]={value:t,valueset:!0,node:null}}hasGlobal(e){return void 0===this.executingContext.exports[e]&&(e=e.toLowerCase()),void 0!==this.executingContext.exports[e]}async loadModule(e){let t=e.spatialReference;null==t&&(t=new b.A({wkid:102100})),this.moduleScope=q({},e.customfunctions,e.timeZone),this.executingContext={spatialReference:t,services:e.services,libraryResolver:new o.a(e.libraryResolver._moduleSingletons,this.source.syntax.loadedModules),exports:{},abortSignal:void 0===e.abortSignal||null===e.abortSignal?{aborted:!1}:e.abortSignal,globalScope:this.moduleScope,console:e.console??W,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:null,depthCounter:{depth:1}},await _(this.executingContext,this.source.syntax)}}async function k(e,t,n){return!0===t.preparsed?n(e,null,t.arguments):n(e,t,await I(e,t))}async function _(e,t,n){if(t.breakpoint&&!0!==n){const n=t.breakpoint();return await n,_(e,t,!0)}try{switch(t?.type){case"VariableDeclarator":return await async function(e,t){let n=null;if(n=null===t.init?null:await _(e,t.init),null!==e.localScope){if(n===u.B&&(n=null),"Identifier"!==t.id.type)throw new s.D$(e,s.TX.InvalidIdentifier,t);const r=t.id.name.toLowerCase();return null!=e.localScope&&(e.localScope[r]={value:n,valueset:!0,node:t.init}),u.B}if("Identifier"!==t.id.type)throw new s.D$(e,s.TX.InvalidIdentifier,t);const r=t.id.name.toLowerCase();return n===u.B&&(n=null),e.globalScope[r]={value:n,valueset:!0,node:t.init},u.B}(e,t);case"ImportDeclaration":return await async function(e,t){const n=t.specifiers[0].local.name.toLowerCase(),r=e.libraryResolver.loadLibrary(n);let o=null;return e.libraryResolver._moduleSingletons?.has(r.uri)?o=e.libraryResolver._moduleSingletons.get(r.uri):(o=new T(r),await o.loadModule(e),e.libraryResolver._moduleSingletons?.set(r.uri,o)),e.globalScope[n]={value:o,valueset:!0,node:t},u.B}(e,t);case"ExportNamedDeclaration":return await async function(e,t){if(await _(e,t.declaration),"FunctionDeclaration"===t.declaration.type)e.exports[t.declaration.id.name.toLowerCase()]="function";else if("VariableDeclaration"===t.declaration.type)for(const n of t.declaration.declarations)e.exports[n.id.name.toLowerCase()]="variable";return u.B}(e,t);case"VariableDeclaration":return await M(e,t,0);case"BlockStatement":case"Program":return await async function(e,t){return R(e,t,0)}(e,t);case"FunctionDeclaration":return await async function(e,t){const n=t.id.name.toLowerCase();return e.globalScope[n]={valueset:!0,node:null,value:new D(t,e)},u.B}(e,t);case"ReturnStatement":return await async function(e,t){if(null===t.argument)return new u.z(u.B);const n=await _(e,t.argument);return new u.z(n)}(e,t);case"IfStatement":return await async function(e,t){const n=await _(e,t.test);if(!0===n)return _(e,t.consequent);if(!1===n)return null!==t.alternate?_(e,t.alternate):u.B;throw new s.D$(e,s.TX.BooleanConditionRequired,t)}(e,t);case"ExpressionStatement":return await async function(e,t){if("AssignmentExpression"===t.expression.type)return _(e,t.expression);if("CallExpression"===t.expression.type){const n=await _(e,t.expression);return n===u.B?u.B:new u.A(n)}const n=await _(e,t.expression);return n===u.B?u.B:new u.A(n)}(e,t);case"UpdateExpression":return await async function(e,t){const n=t.argument;if("MemberExpression"===n.type){const r={t:null},o=await _(e,n.object);let a=null;r.t=o,!0===n.computed?a=await _(e,n.property):"Identifier"===n.property.type&&(a=n.property.name);const l=r.t;let c;if((0,u.o)(l)){if(!(0,u.b)(a))throw new s.D$(e,s.TX.ArrayAccessorMustBeNumber,t);if(a<0&&(a=l.length+a),a<0||a>=l.length)throw new s.D$(e,s.TX.OutOfBounds,t);c=(0,u.g)(l[a]),l[a]="++"===t.operator?c+1:c-1}else if(l instanceof i.A){if(!1===(0,u.c)(a))throw new s.D$(e,s.TX.KeyAccessorMustBeString,t);if(!0!==l.hasField(a))throw new s.D$(e,s.TX.FieldNotFound,t,{key:a});c=(0,u.g)(l.field(a)),l.setField(a,"++"===t.operator?c+1:c-1)}else if(l instanceof T){if(!1===(0,u.c)(a))throw new s.D$(e,s.TX.ModuleAccessorMustBeString,t);if(!0!==l.hasGlobal(a))throw new s.D$(e,s.TX.ModuleExportNotFound,t);c=(0,u.g)(await l.global(a)),l.setGlobal(a,"++"===t.operator?c+1:c-1)}else{if(!(0,u.r)(l))throw(0,u.q)(l)?new s.D$(e,s.TX.Immutable,t):new s.D$(e,s.TX.InvalidParameter,t);if(!1===(0,u.c)(a))throw new s.D$(e,s.TX.KeyAccessorMustBeString,t);if(!0!==l.hasField(a))throw new s.D$(e,s.TX.FieldNotFound,t,{key:a});c=(0,u.g)(l.field(a)),l.setField(a,"++"===t.operator?c+1:c-1)}return!1===t.prefix?c:"++"===t.operator?c+1:c-1}const r="Identifier"===t.argument.type?t.argument.name.toLowerCase():"";if(!r)throw new s.D$(e,s.TX.InvalidIdentifier,t);let o;if(null!=e.localScope&&void 0!==e.localScope[r])return o=(0,u.g)(e.localScope[r].value),e.localScope[r]={value:"++"===t.operator?o+1:o-1,valueset:!0,node:t},!1===t.prefix?o:"++"===t.operator?o+1:o-1;if(void 0!==e.globalScope[r])return o=(0,u.g)(e.globalScope[r].value),e.globalScope[r]={value:"++"===t.operator?o+1:o-1,valueset:!0,node:t},!1===t.prefix?o:"++"===t.operator?o+1:o-1;throw new s.D$(e,s.TX.InvalidIdentifier,t)}(e,t);case"AssignmentExpression":return await async function(e,t){const n=t.left;if("MemberExpression"===n.type){const r=await _(e,n.object);let o=null;if(!0===n.computed)o=await _(e,n.property);else{if("Identifier"!==n.property.type)throw new s.D$(e,s.TX.InvalidIdentifier,t);o=n.property.name}const a=await _(e,t.right);if((0,u.o)(r)){if(!(0,u.b)(o))throw new s.D$(e,s.TX.ArrayAccessorMustBeNumber,t);if(o<0&&(o=r.length+o),o<0||o>r.length)throw new s.D$(e,s.TX.OutOfBounds,t);if(o===r.length){if("="!==t.operator)throw new s.D$(e,s.TX.OutOfBounds,t);r[o]=E(a,t.operator,r[o],t,e)}else r[o]=E(a,t.operator,r[o],t,e)}else if(r instanceof i.A){if(!1===(0,u.c)(o))throw new s.D$(e,s.TX.KeyAccessorMustBeString,t);if(!0===r.hasField(o))r.setField(o,E(a,t.operator,r.field(o),t,e));else{if("="!==t.operator)throw new s.D$(e,s.TX.FieldNotFound,t,{key:o});r.setField(o,E(a,t.operator,null,t,e))}}else if(r instanceof T){if(!1===(0,u.c)(o))throw new s.D$(e,s.TX.KeyAccessorMustBeString,t);if(!0!==r.hasGlobal(o))throw new s.D$(e,s.TX.ModuleExportNotFound,t);r.setGlobal(o,E(a,t.operator,await r.global(o),t,e))}else{if(!(0,u.r)(r))throw(0,u.q)(r)?new s.D$(e,s.TX.Immutable,t):new s.D$(e,s.TX.InvalidParameter,t);if(!1===(0,u.c)(o))throw new s.D$(e,s.TX.KeyAccessorMustBeString,t);if(!0===r.hasField(o))r.setField(o,E(a,t.operator,r.field(o),t,e));else{if("="!==t.operator)throw new s.D$(e,s.TX.FieldNotFound,t,{key:o});r.setField(o,E(a,t.operator,null,t,e))}}return u.B}const r=n.name.toLowerCase();if(null!=e.localScope&&void 0!==e.localScope[r]){const n=await _(e,t.right);return e.localScope[r]={value:E(n,t.operator,e.localScope[r].value,t,e),valueset:!0,node:t.right},u.B}if(void 0!==e.globalScope[r]){const n=await _(e,t.right);return e.globalScope[r]={value:E(n,t.operator,e.globalScope[r].value,t,e),valueset:!0,node:t.right},u.B}throw new s.D$(e,s.TX.InvalidIdentifier,t)}(e,t);case"ForStatement":return await function(e,t){try{return null!==t.init?_(e,t.init).then((()=>new Promise(((n,r)=>{$(e,t,{testResult:!0,lastAction:u.B},(e=>{n(e)}),(e=>{r(e)}),0)})))):new Promise(((n,r)=>{$(e,t,{testResult:!0,lastAction:u.B},(e=>{n(e)}),(e=>{r(e)}),0)}))}catch(e){return Promise.reject(e)}}(e,t);case"WhileStatement":return await async function(e,t){const n={testResult:!0,lastAction:u.B};if(n.testResult=await _(e,t.test),!1===n.testResult)return u.B;if(!0!==n.testResult)throw new s.D$(e,s.TX.BooleanConditionRequired,t);for(;!0===n.testResult&&(n.lastAction=await _(e,t.body),n.lastAction!==u.C)&&!(n.lastAction instanceof u.z);)if(n.testResult=await _(e,t.test),!0!==n.testResult&&!1!==n.testResult)throw new s.D$(e,s.TX.BooleanConditionRequired,t);return n.lastAction instanceof u.z?n.lastAction:u.B}(e,t);case"ForInStatement":return await async function(e,t){return new Promise(((n,r)=>{_(e,t.right).then((o=>{try{let a=null;a="VariableDeclaration"===t.left.type?_(e,t.left):Promise.resolve(),a.then((()=>{try{let a="";if("VariableDeclaration"===t.left.type){const e=t.left.declarations[0].id;"Identifier"===e.type&&(a=e.name)}else"Identifier"===t.left.type&&(a=t.left.name);if(!a)throw new s.D$(e,s.TX.InvalidIdentifier,t);a=a.toLowerCase();let l=null;if(null!=e.localScope&&void 0!==e.localScope[a]&&(l=e.localScope[a]),null===l&&void 0!==e.globalScope[a]&&(l=e.globalScope[a]),null===l)return void r(new s.D$(e,s.TX.InvalidIdentifier,t));(0,u.o)(o)||(0,u.c)(o)?N(e,t,o,{reject:r,resolve:n},l):(0,u.q)(o)?function(e,t,n,r,o,a){try{if(void 0===a&&(a="i"),0===n.length)return void r.resolve(u.B);X(e,t,n,o,0,a,(e=>{r.resolve(e)}),(e=>{r.reject(e)}),0)}catch(e){r.reject(e)}}(e,t,o,{reject:r,resolve:n},l):o instanceof i.A||(0,u.r)(o)?function(e,t,n,r,o){try{N(e,t,n.keys(),r,o,"k")}catch(e){r.reject(e)}}(e,t,o,{reject:r,resolve:n},l):(0,u.u)(o)?O(o.iterator(e.abortSignal),e,t,o,l,(e=>{n(e)}),(e=>{r(e)}),0):N(e,t,[],{reject:r,resolve:n},l)}catch(e){r(e)}}),r)}catch(e){r(e)}}),r)}))}(e,t);case"BreakStatement":return u.C;case"EmptyStatement":return u.B;case"ContinueStatement":return u.D;case"TemplateElement":return await async function(e,t){return t.value?t.value.cooked:""}(0,t);case"TemplateLiteral":return await async function(e,t){const n=[];for(let r=0;r<t.expressions.length;r++){const o=await _(e,t.expressions[r]);n[r]=(0,u.j)(o)}let r="",o=0;for(const a of t.quasis)r+=a.value?a.value.cooked:"",!1===a.tail&&(r+=n[o]?F(n[o],e,t):"",o++);return r}(e,t);case"Identifier":return await C(e,t);case"MemberExpression":return await async function(e,t){const n=await _(e,t.object);if(null===n)throw new s.D$(e,s.TX.MemberOfNull,t);if(!1===t.computed){if("Identifier"===t.property.type){if(n instanceof i.A||(0,u.r)(n))return n.field(t.property.name);if(n instanceof v.A)return(0,a.B)(n,t.property.name,e,t);if(n instanceof T){if(!n.hasGlobal(t.property.name))throw new s.D$(e,s.TX.InvalidIdentifier,t);return n.global(t.property.name)}throw new s.D$(e,s.TX.InvalidMemberAccessKey,t)}throw new s.D$(e,s.TX.InvalidMemberAccessKey,t)}let r=await _(e,t.property);if(n instanceof i.A||(0,u.r)(n)){if((0,u.c)(r))return n.field(r);throw new s.D$(e,s.TX.InvalidMemberAccessKey,t)}if(n instanceof T){if((0,u.c)(r))return n.global(r);throw new s.D$(e,s.TX.InvalidMemberAccessKey,t)}if(n instanceof v.A){if((0,u.c)(r))return(0,a.B)(n,r,e,t);throw new s.D$(e,s.TX.InvalidMemberAccessKey,t)}if((0,u.o)(n)){if((0,u.b)(r)&&isFinite(r)&&Math.floor(r)===r){if(r<0&&(r=n.length+r),r>=n.length||r<0)throw new s.D$(e,s.TX.OutOfBounds,t);return n[r]}throw new s.D$(e,s.TX.InvalidMemberAccessKey,t)}if((0,u.q)(n)){if((0,u.b)(r)&&isFinite(r)&&Math.floor(r)===r){if(r<0&&(r=n.length()+r),r>=n.length()||r<0)throw new s.D$(e,s.TX.OutOfBounds,t);return n.get(r)}throw new s.D$(e,s.TX.InvalidMemberAccessKey,t)}if((0,u.c)(n)){if((0,u.b)(r)&&isFinite(r)&&Math.floor(r)===r){if(r<0&&(r=n.length+r),r>=n.length||r<0)throw new s.D$(e,s.TX.OutOfBounds,t);return n[r]}throw new s.D$(e,s.TX.InvalidMemberAccessKey,t)}throw new s.D$(e,s.TX.InvalidMemberAccessKey,t)}(e,t);case"Literal":return t.value;case"CallExpression":return await async function(e,t){if("MemberExpression"===t.callee.type){const n=await _(e,t.callee.object);if(!(n instanceof T))throw new s.D$(e,s.TX.FunctionNotFound,t);const r=!1===t.callee.computed?t.callee.property.name:await _(e,t.callee.property);if(!n.hasGlobal(r))throw new s.D$(e,s.TX.FunctionNotFound,t);const o=await n.global(r);if(!(0,u.i)(o))throw new s.D$(e,s.TX.CallNonFunction,t);return o.call(e,t)}if("Identifier"!==t.callee.type)throw new s.D$(e,s.TX.FunctionNotFound,t);if(null!=e.localScope&&void 0!==e.localScope[t.callee.name.toLowerCase()]){const n=e.localScope[t.callee.name.toLowerCase()];if((0,u.i)(n.value))return n.value.call(e,t);throw new s.D$(e,s.TX.CallNonFunction,t)}if(void 0!==e.globalScope[t.callee.name.toLowerCase()]){const n=e.globalScope[t.callee.name.toLowerCase()];if((0,u.i)(n.value))return n.value.call(e,t);throw new s.D$(e,s.TX.CallNonFunction,t)}throw new s.D$(e,s.TX.FunctionNotFound,t)}(e,t);case"UnaryExpression":return await async function(e,t){const n=await _(e,t.argument);if((0,u.a)(n)){if("!"===t.operator)return!n;if("-"===t.operator)return-1*(0,u.g)(n);if("+"===t.operator)return 1*(0,u.g)(n);if("~"===t.operator)return~(0,u.g)(n);throw new s.D$(e,s.TX.UnsupportedUnaryOperator,t)}if("-"===t.operator)return-1*(0,u.g)(n);if("+"===t.operator)return 1*(0,u.g)(n);if("~"===t.operator)return~(0,u.g)(n);throw new s.D$(e,s.TX.UnsupportedUnaryOperator,t)}(e,t);case"BinaryExpression":return await async function(e,t){const n=[];n[0]=await _(e,t.left),n[1]=await _(e,t.right);const r=n[0],o=n[1];switch(t.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":return(0,u.G)((0,u.g)(r),(0,u.g)(o),t.operator);case"==":return(0,u.F)(r,o);case"!=":return!(0,u.F)(r,o);case"<":case">":case"<=":case">=":return(0,u.E)(r,o,t.operator);case"+":return(0,u.c)(r)||(0,u.c)(o)?(0,u.j)(r)+(0,u.j)(o):(0,u.g)(r)+(0,u.g)(o);case"-":return(0,u.g)(r)-(0,u.g)(o);case"*":return(0,u.g)(r)*(0,u.g)(o);case"/":return(0,u.g)(r)/(0,u.g)(o);case"%":return(0,u.g)(r)%(0,u.g)(o);default:throw new s.D$(e,s.TX.UnsupportedOperator,t)}}(e,t);case"LogicalExpression":return await async function(e,t){const n=await _(e,t.left);let r=null;if(!(0,u.a)(n))throw new s.D$(e,s.TX.LogicalExpressionOnlyBoolean,t);switch(t.operator){case"||":if(!0===n)return n;if(r=await _(e,t.right),(0,u.a)(r))return r;throw new s.D$(e,s.TX.LogicExpressionOrAnd,t);case"&&":if(!1===n)return n;if(r=await _(e,t.right),(0,u.a)(r))return r;throw new s.D$(e,s.TX.LogicExpressionOrAnd,t);default:throw new s.D$(e,s.TX.LogicExpressionOrAnd,t)}}(e,t);case"ArrayExpression":return await async function(e,t){const n=[];for(let r=0;r<t.elements.length;r++)n.push(await _(e,t.elements[r]));for(let r=0;r<n.length;r++){if((0,u.i)(n[r]))throw new s.D$(e,s.TX.NoFunctionInArray,t);n[r]===u.B&&(n[r]=null)}return n}(e,t);case"ObjectExpression":return await async function(e,t){const n=[];for(let r=0;r<t.properties.length;r++)n[r]=await _(e,t.properties[r]);const r={},o=new Map;for(let a=0;a<n.length;a++){const i=n[a];if((0,u.i)(i.value))throw new s.D$(e,s.TX.NoFunctionInDictionary,t);if(!1===(0,u.c)(i.key))throw new s.D$(e,s.TX.KeyMustBeString,t);let l=i.key.toString();const c=l.toLowerCase();o.has(c)?l=o.get(c):o.set(c,l),i.value===u.B?r[l]=null:r[l]=i.value}const a=new i.A(r);return a.immutable=!1,a}(e,t);case"Property":return await async function(e,t){const n=await _(e,t.value);return"Identifier"===t.key.type?{key:t.key.name,value:n}:{key:await _(e,t.key),value:n}}(e,t);default:throw new s.D$(e,s.TX.Unrecognized,t)}}catch(n){throw(0,s.Nh)(e,t,n)}}async function P(e,t,n){const r=await _(e,t.body);return n.lastAction=r,n.lastAction===u.C||n.lastAction instanceof u.z?(n.testResult=!1,n):null!==t.update?(await _(e,t.update),n):n}function $(e,t,n,r,o,a){try{(async function(e,t,n){if(null!==t.test){const r=await _(e,t.test);if(!0===e.abortSignal?.aborted)throw new s.D$(e,s.TX.Cancelled,t);if(n.testResult=r,!1===n.testResult)return n;if(!0!==n.testResult)throw new s.D$(e,s.TX.BooleanConditionRequired,t);return P(e,t,n)}return P(e,t,n)})(e,t,n).then((()=>{try{!0===n.testResult?++a>A?(a=0,setTimeout((()=>{$(e,t,n,r,o,a)}),0)):$(e,t,n,r,o,a):n.lastAction instanceof u.z?r(n.lastAction):r(u.B)}catch(e){o(e)}}),(e=>{o(e)}))}catch(e){o(e)}}function x(e,t,n,r,o,a,i,s,l,c){try{if(r<=a)return void s(u.B);o.value="k"===i?n[a]:a,_(e,t.body).then((f=>{try{f instanceof u.z?s(f):f===u.C?s(u.B):++c>A?(c=0,setTimeout((()=>{x(e,t,n,r,o,a+1,i,s,l,c)}),0)):x(e,t,n,r,o,a+1,i,s,l,c)}catch(e){l(e)}}),(e=>{l(e)}))}catch(e){l(e)}}function X(e,t,n,r,o,a,i,s,l){try{if(n.length()<=o)return void i(u.B);r.value="k"===a?n.get(o):o,_(e,t.body).then((c=>{c instanceof u.z?i(c):c===u.C?i(u.B):++l>A?(l=0,setTimeout((()=>{X(e,t,n,r,o+1,a,i,s,l)}),0)):X(e,t,n,r,o+1,a,i,s,l)}),(e=>{s(e)}))}catch(e){s(e)}}function N(e,t,n,r,o,a){try{if(void 0===a&&(a="i"),0===n.length)return void r.resolve(u.B);x(e,t,n,n.length,o,0,a,(e=>{r.resolve(e)}),(e=>{r.reject(e)}),0)}catch(e){r.reject(e)}}function O(e,t,n,r,o,a,i,s){try{e.next().then((c=>{try{if(null===c)a(u.B);else{const f=l.A.createFromGraphicLikeObject(c.geometry,c.attributes,r,t.timeZone);f._underlyingGraphic=c,o.value=f,_(t,n.body).then((l=>{try{l===u.C?a(u.B):l instanceof u.z?a(l):++s>A?(s=0,setTimeout((()=>{O(e,t,n,r,o,a,i,s)}),0)):O(e,t,n,r,o,a,i,s)}catch(e){i(e)}}),(e=>{i(e)}))}}catch(e){i(e)}}),(e=>{i(e)}))}catch(e){i(e)}}function E(e,t,n,r,o){switch(t){case"=":return e===u.B?null:e;case"/=":return(0,u.g)(n)/(0,u.g)(e);case"*=":return(0,u.g)(n)*(0,u.g)(e);case"-=":return(0,u.g)(n)-(0,u.g)(e);case"+=":return(0,u.c)(n)||(0,u.c)(e)?(0,u.j)(n)+(0,u.j)(e):(0,u.g)(n)+(0,u.g)(e);case"%=":return(0,u.g)(n)%(0,u.g)(e);default:throw new s.D$(o,s.TX.UnsupportedOperator,r)}}async function R(e,t,n){if(n>=t.body.length)return u.B;const r=await _(e,t.body[n]);return r instanceof u.z||r===u.C||r===u.D||n===t.body.length-1?r:R(e,t,n+1)}async function M(e,t,n){return n>=t.declarations.length||(await _(e,t.declarations[n]),n===t.declarations.length-1||await M(e,t,n+1)),u.B}async function C(e,t){const n=t.name.toLowerCase();if(null!=e.localScope&&void 0!==e.localScope[n]){const t=e.localScope[n];if(!0===t.valueset)return t.value;if(null!==t.d)return t.d;t.d=_(e,t.node);const r=await t.d;return t.value=r,t.valueset=!0,r}if(void 0!==e.globalScope[n]){const t=e.globalScope[n];if(!0===t.valueset)return t.value;if(null!==t.d)return t.d;t.d=_(e,t.node);const r=await t.d;return t.value=r,t.valueset=!0,r}throw new s.D$(e,s.TX.InvalidIdentifier,t)}function F(e,t,n){if((0,u.i)(e))throw new s.D$(t,s.TX.NoFunctionInTemplateLiteral,n);return e}const L={};async function j(e,t,n,r){const o=await _(e,t.arguments[n]);if((0,u.F)(o,r))return _(e,t.arguments[n+1]);const a=t.arguments.length-n;return 1===a?_(e,t.arguments[n]):2===a?null:3===a?_(e,t.arguments[n+2]):j(e,t,n+2,r)}async function B(e,t,n,r){if(!0===r)return _(e,t.arguments[n+1]);if(3==t.arguments.length-n)return _(e,t.arguments[n+2]);const o=await _(e,t.arguments[n+2]);if(!1===(0,u.a)(o))throw new s.D$(e,s.TX.ModuleExportNotFound,t.arguments[n+2]);return B(e,t,n+2,o)}async function J(e,t,n,r){const o=e.body;if(n.length!==e.params.length)throw new s.D$(t,s.TX.WrongNumberOfParameters,null);for(let r=0;r<n.length;r++){const o=e.params[r];"Identifier"===o.type&&null!=t.localScope&&(t.localScope[o.name.toLowerCase()]={d:null,value:n[r],valueset:!0,node:null})}const a=await _(t,o);if(a instanceof u.z)return a.value;if(a===u.C)throw new s.D$(t,s.TX.UnexpectedToken,r);if(a===u.D)throw new s.D$(t,s.TX.UnexpectedToken,r);return a instanceof u.A?a.value:a}(0,h.d)(L,S),(0,y.d)(L,S),(0,g.d)(L,S),(0,w.d)(L,S),(0,m.d)(L,S),(0,p.registerFunctions)({functions:L,compiled:!1,signatures:null,evaluateIdentifier:null,mode:"async",standardFunction:S,standardFunctionAsync:k}),L.iif=async function(e,t){(0,u.H)(null===t.arguments?[]:t.arguments,3,3,e,t);const n=await _(e,t.arguments[0]);if(!1===(0,u.a)(n))throw new s.D$(e,s.TX.BooleanConditionRequired,t);return _(e,n?t.arguments[1]:t.arguments[2])},L.defaultvalue=async function(e,t){(0,u.H)(null===t.arguments?[]:t.arguments,2,3,e,t);const n=await _(e,t.arguments[0]);if(3===t.arguments.length){const r=await _(e,t.arguments[1]),o=(0,a.j)(n,r);return null!=o&&""!==o?o:_(e,t.arguments[2])}return null==n||""===n?_(e,t.arguments[1]):n},L.decode=async function(e,t){if(t.arguments.length<2)throw new s.D$(e,s.TX.WrongNumberOfParameters,t);if(2===t.arguments.length)return _(e,t.arguments[1]);if((t.arguments.length-1)%2==0)throw new s.D$(e,s.TX.WrongNumberOfParameters,t);return j(e,t,1,await _(e,t.arguments[0]))},L.when=async function(e,t){if(t.arguments.length<3)throw new s.D$(e,s.TX.WrongNumberOfParameters,t);if(t.arguments.length%2==0)throw new s.D$(e,s.TX.WrongNumberOfParameters,t);const n=await _(e,t.arguments[0]);if(!1===(0,u.a)(n))throw new s.D$(e,s.TX.BooleanConditionRequired,t.arguments[0]);return B(e,t,0,n)};const H={fixSpatialReference:u.x,parseArguments:I,standardFunction:S,standardFunctionAsync:k,evaluateIdentifier:C};for(const e in L)L[e]={value:new c.UQ(L[e]),valueset:!0,node:null};const K=function(){};function q(e,t,n){const r=new K;null==e&&(e={}),null==t&&(t={});const o=new i.A({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});o.immutable=!1,r.textformatting={value:o,valueset:!0,node:null};for(const e in t)r[e]={value:new c.UQ(t[e]),native:!0,valueset:!0,node:null};for(const t in e)e[t]&&"esri.Graphic"===e[t].declaredClass?r[t]={value:l.A.createFromGraphic(e[t],n),valueset:!0,node:null}:r[t]={value:e[t],valueset:!0,node:null};return r}function W(e){console.log(e)}K.prototype=L,K.prototype.infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null},K.prototype.pi={value:Math.PI,valueset:!0,node:null};const U=H;function Q(e){const t={mode:"async",compiled:!1,functions:{},signatures:[],standardFunction:S,standardFunctionAsync:k,evaluateIdentifier:C};for(let n=0;n<e.length;n++)e[n].registerFunctions(t);for(const e in t.functions)L[e]={value:new c.UQ(t.functions[e]),valueset:!0,node:null},K.prototype[e]=L[e];for(let e=0;e<t.signatures.length;e++)(0,f.WC)(t.signatures[e],"async")}async function V(e,t){let n=t.spatialReference;null==n&&(n=new b.A({wkid:102100}));let r=null;e.usesModules&&(r=new o.a(new Map,e.loadedModules));const a=q(t.vars,t.customfunctions,t.timeZone),i={spatialReference:n,services:t.services,exports:{},libraryResolver:r,abortSignal:void 0===t.abortSignal||null===t.abortSignal?{aborted:!1}:t.abortSignal,globalScope:a,console:t.console??W,timeZone:t.timeZone??null,lrucache:t.lrucache,interceptor:t.interceptor,localScope:null,depthCounter:{depth:1}};let l=await _(i,e);if(l instanceof u.z&&(l=l.value),l instanceof u.A&&(l=l.value),l===u.B&&(l=null),l===u.C)throw new s.D$(i,s.TX.IllegalResult,null);if(l===u.D)throw new s.D$(i,s.TX.IllegalResult,null);if((0,u.i)(l))throw new s.D$(i,s.TX.IllegalResult,null);return l}Q([d.A])},90306:function(e,t,n){n.r(t),n.d(t,{registerFunctions:function(){return _}});var r=n(7156),o=n(63022),a=n(45824),i=n(37568),s=n(80749),l=n(69243),c=n(30165),u=n(36254),f=n(86875),d=n(62938),h=n(91484),p=n(46556),w=n(75160),g=n(71673),m=n(45532),y=n(44740),v=n(91508),b=n(74697),A=n(51432),I=n(93040);async function S(e,t,n){const o=r.id?.findCredential(e.restUrl);if(!o)return null;if("loaded"===e.loadStatus&&""===t&&e.user?.sourceJSON&&!1===n)return e.user.sourceJSON;const a={responseType:"json",query:{f:"json"}};if(n&&(a.query.returnUserLicenseTypeExtensions=!0),""===t){const t=await(0,I.A)(e.restUrl+"/community/self",a);if(t.data){const e=t.data;if(e?.username)return e}return null}const i=await(0,I.A)(e.restUrl+"/community/users/"+t,a);if(i.data){const e=i.data;return e.error?null:e}return null}function D(e){return 0===r.rE.indexOf("4.")?y.A.fromExtent(e):new y.A({spatialReference:e.spatialReference,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]})}function T(e,t,n){if((0,l.H)(e,2,2,t,n),e[0]instanceof p.A&&e[1]instanceof p.A);else if(e[0]instanceof p.A&&null===e[1]);else if(e[1]instanceof p.A&&null===e[0]);else if(null!==e[0]||null!==e[1])throw new i.D$(t,i.TX.InvalidParameter,n)}async function k(e,t){if("polygon"!==e.type&&"polyline"!==e.type&&"extent"!==e.type)return 0;let n=1;(e.spatialReference.vcsWkid||e.spatialReference.latestVcsWkid)&&(n=(0,u.G9)(e.spatialReference)/(0,d.GA)(e.spatialReference));let r=0;if("polyline"===e.type)for(const t of e.paths)for(let e=1;e<t.length;e++)r+=(0,u.BM)(t[e],t[e-1],n);else if("polygon"===e.type)for(const t of e.rings){for(let e=1;e<t.length;e++)r+=(0,u.BM)(t[e],t[e-1],n);(t[0][0]!==t[t.length-1][0]||t[0][1]!==t[t.length-1][1]||void 0!==t[0][2]&&t[0][2]!==t[t.length-1][2])&&(r+=(0,u.BM)(t[0],t[t.length-1],n))}else"extent"===e.type&&(r+=2*(0,u.BM)([e.xmin,e.ymin,0],[e.xmax,e.ymin,0],n),r+=2*(0,u.BM)([e.xmin,e.ymin,0],[e.xmin,e.ymax,0],n),r*=2,r+=4*Math.abs((0,l.K)(e.zmax,0)*n-(0,l.K)(e.zmin,0)*n));const o=new v.A({hasZ:!1,hasM:!1,spatialReference:e.spatialReference,paths:[[0,0],[0,r]]});return(0,w.planarLength)(o,t)}function _(e){"async"===e.mode&&(e.functions.disjoint=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>(T(o=(0,l.I)(o),t,n),null===o[0]||null===o[1]||(0,w.disjoint)(o[0],o[1]))))},e.functions.intersects=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>(T(o=(0,l.I)(o),t,n),null!==o[0]&&null!==o[1]&&(0,w.intersects)(o[0],o[1]))))},e.functions.touches=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>(T(o=(0,l.I)(o),t,n),null!==o[0]&&null!==o[1]&&(0,w.touches)(o[0],o[1]))))},e.functions.crosses=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>(T(o=(0,l.I)(o),t,n),null!==o[0]&&null!==o[1]&&(0,w.crosses)(o[0],o[1]))))},e.functions.within=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>(T(o=(0,l.I)(o),t,n),null!==o[0]&&null!==o[1]&&(0,w.within)(o[0],o[1]))))},e.functions.contains=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>(T(o=(0,l.I)(o),t,n),null!==o[0]&&null!==o[1]&&(0,w.contains)(o[0],o[1]))))},e.functions.overlaps=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>(T(o=(0,l.I)(o),t,n),null!==o[0]&&null!==o[1]&&(0,w.overlaps)(o[0],o[1]))))},e.functions.equals=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>((0,l.H)(o,2,2,t,n),o[0]===o[1]||(o[0]instanceof p.A&&o[1]instanceof p.A?(0,w.equals)(o[0],o[1]):((0,l.k)(o[0])&&(0,l.k)(o[1])||!!((0,l.n)(o[0])&&(0,l.n)(o[1])||(0,l.m)(o[0])&&(0,l.m)(o[1])))&&o[0].equals(o[1])))))},e.functions.relate=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,l.I)(o),(0,l.H)(o,3,3,t,n),o[0]instanceof p.A&&o[1]instanceof p.A)return(0,w.relate)(o[0],o[1],(0,l.j)(o[2]));if(o[0]instanceof p.A&&null===o[1])return!1;if(o[1]instanceof p.A&&null===o[0])return!1;if(null===o[0]&&null===o[1])return!1;throw new i.D$(t,i.TX.InvalidParameter,n)}))},e.functions.intersection=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>(T(o=(0,l.I)(o),t,n),null===o[0]||null===o[1]?null:(0,w.intersect)(o[0],o[1]))))},e.functions.union=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{const a=[];if(0===(o=(0,l.I)(o)).length)throw new i.D$(t,i.TX.WrongNumberOfParameters,n);if(1===o.length)if((0,l.o)(o[0])){const e=(0,l.I)(o[0]);for(let r=0;r<e.length;r++)if(null!==e[r]){if(!(e[r]instanceof p.A))throw new i.D$(t,i.TX.InvalidParameter,n);a.push(e[r])}}else{if(!(0,l.q)(o[0])){if(o[0]instanceof p.A)return(0,l.x)((0,s.Yq)(o[0]),t.spatialReference);if(null===o[0])return null;throw new i.D$(t,i.TX.InvalidParameter,n)}{const e=(0,l.I)(o[0].toArray());for(let r=0;r<e.length;r++)if(null!==e[r]){if(!(e[r]instanceof p.A))throw new i.D$(t,i.TX.InvalidParameter,n);a.push(e[r])}}}else for(let e=0;e<o.length;e++)if(null!==o[e]){if(!(o[e]instanceof p.A))throw new i.D$(t,i.TX.InvalidParameter,n);a.push(o[e])}return 0===a.length?null:(0,w.union)(a)}))},e.functions.difference=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>(T(o=(0,l.I)(o),t,n),null===o[0]?null:null===o[1]?(0,s.Yq)(o[0]):(0,w.difference)(o[0],o[1]))))},e.functions.symmetricdifference=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>(T(o=(0,l.I)(o),t,n),null===o[0]&&null===o[1]?null:null===o[0]?(0,s.Yq)(o[1]):null===o[1]?(0,s.Yq)(o[0]):(0,w.symmetricDifference)(o[0],o[1]))))},e.functions.clip=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,l.I)(o),(0,l.H)(o,2,2,t,n),!(o[1]instanceof h.default)&&null!==o[1])throw new i.D$(t,i.TX.InvalidParameter,n);if(null===o[0])return null;if(!(o[0]instanceof p.A))throw new i.D$(t,i.TX.InvalidParameter,n);return null===o[1]?null:(0,w.clip)(o[0],o[1])}))},e.functions.cut=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,l.I)(o),(0,l.H)(o,2,2,t,n),!(o[1]instanceof v.A)&&null!==o[1])throw new i.D$(t,i.TX.InvalidParameter,n);if(null===o[0])return[];if(!(o[0]instanceof p.A))throw new i.D$(t,i.TX.InvalidParameter,n);return null===o[1]?[(0,s.Yq)(o[0])]:(0,w.cut)(o[0],o[1])}))},e.functions.area=function(t,n){return e.standardFunctionAsync(t,n,(async(e,r,o)=>{if((0,l.H)(o,1,2,t,n),null===(o=(0,l.I)(o))[0])return 0;if((0,l.u)(o[0])){const e=await o[0].sumArea((0,s.uf)((0,l.K)(o[1],-1)),!1,t.abortSignal);if(t.abortSignal.aborted)throw new i.D$(t,i.TX.Cancelled,n);return e}if((0,l.o)(o[0])||(0,l.q)(o[0])){const e=(0,l.J)(o[0],t.spatialReference);return null===e?0:(0,w.planarArea)(e,(0,s.uf)((0,l.K)(o[1],-1)))}if(!(o[0]instanceof p.A))throw new i.D$(t,i.TX.InvalidParameter,n);return(0,w.planarArea)(o[0],(0,s.uf)((0,l.K)(o[1],-1)))}))},e.functions.areageodetic=function(t,n){return e.standardFunctionAsync(t,n,(async(e,r,o)=>{if((0,l.H)(o,1,2,t,n),null===(o=(0,l.I)(o))[0])return 0;if((0,l.u)(o[0])){const e=await o[0].sumArea((0,s.uf)((0,l.K)(o[1],-1)),!0,t.abortSignal);if(t.abortSignal.aborted)throw new i.D$(t,i.TX.Cancelled,n);return e}if((0,l.o)(o[0])||(0,l.q)(o[0])){const e=(0,l.J)(o[0],t.spatialReference);return null===e?0:(0,w.geodesicArea)(e,(0,s.uf)((0,l.K)(o[1],-1)))}if(!(o[0]instanceof p.A))throw new i.D$(t,i.TX.InvalidParameter,n);return(0,w.geodesicArea)(o[0],(0,s.uf)((0,l.K)(o[1],-1)))}))},e.functions.length=function(t,n){return e.standardFunctionAsync(t,n,(async(e,r,o)=>{if((0,l.H)(o,1,2,t,n),null===(o=(0,l.I)(o))[0])return 0;if((0,l.u)(o[0])){const e=await o[0].sumLength((0,s.SQ)((0,l.K)(o[1],-1)),!1,t.abortSignal);if(t.abortSignal.aborted)throw new i.D$(t,i.TX.Cancelled,n);return e}if((0,l.o)(o[0])||(0,l.q)(o[0])){const e=(0,l.L)(o[0],t.spatialReference);return null===e?0:(0,w.planarLength)(e,(0,s.SQ)((0,l.K)(o[1],-1)))}if(!(o[0]instanceof p.A))throw new i.D$(t,i.TX.InvalidParameter,n);return(0,w.planarLength)(o[0],(0,s.SQ)((0,l.K)(o[1],-1)))}))},e.functions.length3d=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if((0,l.H)(o,1,2,t,n),null===(o=(0,l.I)(o))[0])return 0;if((0,l.o)(o[0])||(0,l.q)(o[0])){const e=(0,l.L)(o[0],t.spatialReference);return null===e?0:!0===e.hasZ?k(e,(0,s.SQ)((0,l.K)(o[1],-1))):(0,w.planarLength)(e,(0,s.SQ)((0,l.K)(o[1],-1)))}if(!(o[0]instanceof p.A))throw new i.D$(t,i.TX.InvalidParameter,n);return!0===o[0].hasZ?k(o[0],(0,s.SQ)((0,l.K)(o[1],-1))):(0,w.planarLength)(o[0],(0,s.SQ)((0,l.K)(o[1],-1)))}))},e.functions.lengthgeodetic=function(t,n){return e.standardFunctionAsync(t,n,(async(e,r,o)=>{if((0,l.H)(o,1,2,t,n),null===(o=(0,l.I)(o))[0])return 0;if((0,l.u)(o[0])){const e=await o[0].sumLength((0,s.SQ)((0,l.K)(o[1],-1)),!0,t.abortSignal);if(t.abortSignal.aborted)throw new i.D$(t,i.TX.Cancelled,n);return e}if((0,l.o)(o[0])||(0,l.q)(o[0])){const e=(0,l.L)(o[0],t.spatialReference);return null===e?0:(0,w.geodesicLength)(e,(0,s.SQ)((0,l.K)(o[1],-1)))}if(!(o[0]instanceof p.A))throw new i.D$(t,i.TX.InvalidParameter,n);return(0,w.geodesicLength)(o[0],(0,s.SQ)((0,l.K)(o[1],-1)))}))},e.functions.distance=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{o=(0,l.I)(o),(0,l.H)(o,2,3,t,n);let a=o[0];((0,l.o)(o[0])||(0,l.q)(o[0]))&&(a=(0,l.M)(o[0],t.spatialReference));let c=o[1];if(((0,l.o)(o[1])||(0,l.q)(o[1]))&&(c=(0,l.M)(o[1],t.spatialReference)),!(a instanceof p.A))throw new i.D$(t,i.TX.InvalidParameter,n);if(!(c instanceof p.A))throw new i.D$(t,i.TX.InvalidParameter,n);return(0,w.distance)(a,c,(0,s.SQ)((0,l.K)(o[2],-1)))}))},e.functions.distancegeodetic=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{o=(0,l.I)(o),(0,l.H)(o,2,3,t,n);const a=o[0],c=o[1];if(!(a instanceof m.default))throw new i.D$(t,i.TX.InvalidParameter,n);if(!(c instanceof m.default))throw new i.D$(t,i.TX.InvalidParameter,n);const u=new v.A({paths:[],spatialReference:a.spatialReference});return u.addPath([a,c]),(0,w.geodesicLength)(u,(0,s.SQ)((0,l.K)(o[2],-1)))}))},e.functions.densify=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,l.I)(o),(0,l.H)(o,2,3,t,n),null===o[0])return null;if(!(o[0]instanceof p.A))throw new i.D$(t,i.TX.InvalidParameter,n);const a=(0,l.g)(o[1]);if(isNaN(a))throw new i.D$(t,i.TX.InvalidParameter,n);if(a<=0)throw new i.D$(t,i.TX.InvalidParameter,n);return o[0]instanceof y.A||o[0]instanceof v.A?(0,w.densify)(o[0],a,(0,s.SQ)((0,l.K)(o[2],-1))):o[0]instanceof h.default?(0,w.densify)(D(o[0]),a,(0,s.SQ)((0,l.K)(o[2],-1))):o[0]}))},e.functions.densifygeodetic=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,l.I)(o),(0,l.H)(o,2,3,t,n),null===o[0])return null;if(!(o[0]instanceof p.A))throw new i.D$(t,i.TX.InvalidParameter,n);const a=(0,l.g)(o[1]);if(isNaN(a))throw new i.D$(t,i.TX.InvalidParameter,n);if(a<=0)throw new i.D$(t,i.TX.InvalidParameter,n);return o[0]instanceof y.A||o[0]instanceof v.A?(0,w.geodesicDensify)(o[0],a,(0,s.SQ)((0,l.K)(o[2],-1))):o[0]instanceof h.default?(0,w.geodesicDensify)(D(o[0]),a,(0,s.SQ)((0,l.K)(o[2],-1))):o[0]}))},e.functions.generalize=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,l.I)(o),(0,l.H)(o,2,4,t,n),null===o[0])return null;if(!(o[0]instanceof p.A))throw new i.D$(t,i.TX.InvalidParameter,n);const a=(0,l.g)(o[1]);if(isNaN(a))throw new i.D$(t,i.TX.InvalidParameter,n);return(0,w.generalize)(o[0],a,(0,l.h)((0,l.K)(o[2],!0)),(0,s.SQ)((0,l.K)(o[3],-1)))}))},e.functions.buffer=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,l.I)(o),(0,l.H)(o,2,3,t,n),null===o[0])return null;if(!(o[0]instanceof p.A))throw new i.D$(t,i.TX.InvalidParameter,n);const a=(0,l.g)(o[1]);if(isNaN(a))throw new i.D$(t,i.TX.InvalidParameter,n);return 0===a?(0,s.Yq)(o[0]):(0,w.buffer)(o[0],a,(0,s.SQ)((0,l.K)(o[2],-1)))}))},e.functions.buffergeodetic=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,l.I)(o),(0,l.H)(o,2,3,t,n),null===o[0])return null;if(!(o[0]instanceof p.A))throw new i.D$(t,i.TX.InvalidParameter,n);const a=(0,l.g)(o[1]);if(isNaN(a))throw new i.D$(t,i.TX.InvalidParameter,n);return 0===a?(0,s.Yq)(o[0]):(0,w.geodesicBuffer)(o[0],a,(0,s.SQ)((0,l.K)(o[2],-1)))}))},e.functions.offset=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,l.I)(o),(0,l.H)(o,2,6,t,n),null===o[0])return null;if(!(o[0]instanceof y.A||o[0]instanceof v.A))throw new i.D$(t,i.TX.InvalidParameter,n);const a=(0,l.g)(o[1]);if(isNaN(a))throw new i.D$(t,i.TX.InvalidParameter,n);const c=(0,l.g)((0,l.K)(o[4],10));if(isNaN(c))throw new i.D$(t,i.TX.InvalidParameter,n);const u=(0,l.g)((0,l.K)(o[5],0));if(isNaN(u))throw new i.D$(t,i.TX.InvalidParameter,n);return(0,w.offset)(o[0],a,(0,s.SQ)((0,l.K)(o[2],-1)),(0,l.j)((0,l.K)(o[3],"round")).toLowerCase(),c,u)}))},e.functions.rotate=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,l.I)(o),(0,l.H)(o,2,3,t,n),null===o[0])return null;if(!(o[0]instanceof p.A))throw new i.D$(t,i.TX.InvalidParameter,n);const a=o[0]instanceof h.default?y.A.fromExtent(o[0]):o[0],s=(0,l.g)(o[1]);if(isNaN(s))throw new i.D$(t,i.TX.InvalidParameter,n);const c=(0,l.K)(o[2],null);if(null===c)return(0,w.rotate)(a,s);if(c instanceof m.default)return(0,w.rotate)(a,s,c);throw new i.D$(t,i.TX.InvalidParameter,n)}))},e.functions.centroid=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,l.I)(o),(0,l.H)(o,1,1,t,n),null===o[0])return null;let a=o[0];if(((0,l.o)(o[0])||(0,l.q)(o[0]))&&(a=(0,l.M)(o[0],t.spatialReference)),null===a)return null;if(!(a instanceof p.A))throw new i.D$(t,i.TX.InvalidParameter,n);return a instanceof m.default?(0,l.x)((0,s.Yq)(a),t.spatialReference):a instanceof y.A?a.centroid:a instanceof v.A?(0,u.tI)(a):a instanceof g.A?(0,u.e0)(a):a instanceof h.default?a.center:null}))},e.functions.measuretocoordinate=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,l.I)(o),(0,l.H)(o,2,2,t,n),null===o[0])return null;let s=o[0];if(((0,l.o)(o[0])||(0,l.q)(o[0]))&&(s=(0,l.L)(o[0],t.spatialReference)),null===s)return null;if(!(s instanceof p.A))throw new i.D$(t,i.TX.InvalidParameter,n);if(!(s instanceof v.A))throw new i.D$(t,i.TX.InvalidParameter,n);if((0,l.b)(!1===o[1]))throw new i.D$(t,i.TX.InvalidParameter,n);const c=(0,f.EP)(s,o[1]);return c?a.A.convertObjectToArcadeDictionary(c,(0,l.N)(t),!1,!0):null}))},e.functions.pointtocoordinate=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,l.I)(o),(0,l.H)(o,2,2,t,n),null===o[0])return null;let s=o[0];if(((0,l.o)(o[0])||(0,l.q)(o[0]))&&(s=(0,l.L)(o[0],t.spatialReference)),null===s)return null;if(!(s instanceof p.A))throw new i.D$(t,i.TX.InvalidParameter,n);if(!(s instanceof v.A))throw new i.D$(t,i.TX.InvalidParameter,n);const c=o[1];if(null===c)return null;if(!(c instanceof m.default))throw new i.D$(t,i.TX.InvalidParameter,n);if((0,l.b)(!1===o[1]))throw new i.D$(t,i.TX.InvalidParameter,n);const u=(0,f.sO)(s,c);return u?a.A.convertObjectToArcadeDictionary(u,(0,l.N)(t),!1,!0):null}))},e.functions.distancetocoordinate=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,l.I)(o),(0,l.H)(o,2,2,t,n),null===o[0])return null;let s=o[0];if(((0,l.o)(o[0])||(0,l.q)(o[0]))&&(s=(0,l.L)(o[0],t.spatialReference)),null===s)return null;if(!(s instanceof p.A))throw new i.D$(t,i.TX.InvalidParameter,n);if(!(s instanceof v.A))throw new i.D$(t,i.TX.InvalidParameter,n);if((0,l.b)(!1===o[1]))throw new i.D$(t,i.TX.InvalidParameter,n);const c=(0,f.du)(s,o[1]);return c?a.A.convertObjectToArcadeDictionary(c,(0,l.N)(t),!1,!0):null}))},e.functions.multiparttosinglepart=function(t,n){return e.standardFunctionAsync(t,n,(async(e,r,o)=>{if(o=(0,l.I)(o),(0,l.H)(o,1,1,t,n),null===o[0])return null;if(!(o[0]instanceof p.A))throw new i.D$(t,i.TX.InvalidParameter,n);if(o[0]instanceof m.default)return[(0,l.x)((0,s.Yq)(o[0]),t.spatialReference)];if(o[0]instanceof h.default)return[(0,l.x)((0,s.Yq)(o[0]),t.spatialReference)];const a=await(0,w.simplify)(o[0]);if(a instanceof y.A){const e=[],t=[];for(let n=0;n<a.rings.length;n++)if(a.isClockwise(a.rings[n])){const t=(0,b.rS)({rings:[a.rings[n]],hasZ:!0===a.hasZ,hasM:!0===a.hasM,spatialReference:a.spatialReference.toJSON()});e.push(t)}else t.push({ring:a.rings[n],pt:a.getPoint(n,0)});for(let n=0;n<t.length;n++)for(let r=0;r<e.length;r++)if(e[r].contains(t[n].pt)){e[r].addRing(t[n].ring);break}return e}if(a instanceof v.A){const e=[];for(let t=0;t<a.paths.length;t++){const n=(0,b.rS)({paths:[a.paths[t]],hasZ:!0===a.hasZ,hasM:!0===a.hasM,spatialReference:a.spatialReference.toJSON()});e.push(n)}return e}if(o[0]instanceof g.A){const e=[],n=(0,l.x)((0,s.Yq)(o[0]),t.spatialReference);for(let t=0;t<n.points.length;t++)e.push(n.getPoint(t));return e}return null}))},e.functions.issimple=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,l.I)(o),(0,l.H)(o,1,1,t,n),null===o[0])return!0;if(!(o[0]instanceof p.A))throw new i.D$(t,i.TX.InvalidParameter,n);return(0,w.isSimple)(o[0])}))},e.functions.simplify=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,l.I)(o),(0,l.H)(o,1,1,t,n),null===o[0])return null;if(!(o[0]instanceof p.A))throw new i.D$(t,i.TX.InvalidParameter,n);return(0,w.simplify)(o[0])}))},e.functions.convexhull=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,l.I)(o),(0,l.H)(o,1,1,t,n),null===o[0])return null;if(!(o[0]instanceof p.A))throw new i.D$(t,i.TX.InvalidParameter,n);return(0,w.convexHull)(o[0])}))},e.functions.getuser=function(t,n){return e.standardFunctionAsync(t,n,(async(e,r,s)=>{(0,l.H)(s,0,2,t,n);let u=(0,l.K)(s[1],""),f=!0===u;if(u=!0===u||!1===u?"":(0,l.j)(u),0===s.length||s[0]instanceof o.A){let e;e=t.services?.portal?t.services.portal:A.A.getDefault(),s.length>0&&(e=(0,c.R)(s[0],e));const n=await S(e,u,f);if(n){const e=JSON.parse(JSON.stringify(n));for(const t of["lastLogin","created","modified"])void 0!==e[t]&&null!==e[t]&&(e[t]=new Date(e[t]));return a.A.convertObjectToArcadeDictionary(e,(0,l.N)(t))}return null}let d=null;if((0,l.u)(s[0])&&(d=s[0]),d){if(f=!1,u)return null;await d.load();const e=await d.getOwningSystemUrl();if(!e){if(!u){const e=await d.getIdentityUser();return e?a.A.convertObjectToArcadeDictionary({username:e},(0,l.N)(t)):null}return null}let n;n=t.services?.portal?t.services.portal:A.A.getDefault(),n=(0,c.R)(new o.A(e),n);const r=await S(n,u,f);if(r){const e=JSON.parse(JSON.stringify(r));for(const t of["lastLogin","created","modified"])void 0!==e[t]&&null!==e[t]&&(e[t]=new Date(e[t]));return a.A.convertObjectToArcadeDictionary(e,(0,l.N)(t))}return null}throw new i.D$(t,i.TX.InvalidParameter,n)}))},e.functions.nearestcoordinate=function(t,n){return e.standardFunctionAsync(t,n,(async(e,r,o)=>{if(o=(0,l.I)(o),(0,l.H)(o,2,2,t,n),!(o[0]instanceof p.A||null===o[0]))throw new i.D$(t,i.TX.InvalidParameter,n);if(!(o[1]instanceof m.default||null===o[1]))throw new i.D$(t,i.TX.InvalidParameter,n);if(null===o[0]||null===o[1])return null;const s=await(0,w.nearestCoordinate)(o[0],o[1]);return null===s?null:a.A.convertObjectToArcadeDictionary({coordinate:s.coordinate,distance:s.distance,sideOfLine:0===s.distance?"straddle":s.isRightSide?"right":"left"},(0,l.N)(t),!1,!0)}))},e.functions.nearestvertex=function(t,n){return e.standardFunctionAsync(t,n,(async(e,r,o)=>{if(o=(0,l.I)(o),(0,l.H)(o,2,2,t,n),!(o[0]instanceof p.A||null===o[0]))throw new i.D$(t,i.TX.InvalidParameter,n);if(!(o[1]instanceof m.default||null===o[1]))throw new i.D$(t,i.TX.InvalidParameter,n);if(null===o[0]||null===o[1])return null;const s=await(0,w.nearestVertex)(o[0],o[1]);return null===s?null:a.A.convertObjectToArcadeDictionary({coordinate:s.coordinate,distance:s.distance,sideOfLine:0===s.distance?"straddle":s.isRightSide?"right":"left"},(0,l.N)(t),!1,!0)}))})}},30165:function(e,t,n){n.d(t,{R:function(){return o}});var r=n(51432);function o(e,t){return null===e?t:new r.A({url:e.field("url")})}},37797:function(e,t,n){n.d(t,{A:function(){return c}});var r=n(61226),o=(n(58941),n(60539)),a=n(51846),i=n(13370),s=n(90465),l=n(50193);class c{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new a.A}destroy(){this.close()}get closed(){return!this._clients?.length}open(e,t){return new Promise(((n,r)=>{let a=!0;const i=e=>{(0,o.Te)(t.signal),a&&(a=!1,e())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const s=e[a];(0,o.$X)(s)?this._clientPromises[a]=s.then((e=>(this._clients[a]=new l.A(e,t,this._ongoingJobsQueue),i(n),this._clients[a])),(()=>(i(r),null))):(this._clients[a]=new l.A(s,t,this._ongoingJobsQueue),this._clientPromises[a]=Promise.resolve(this._clients[a]),i(n))}}))}broadcast(e,t,n){const r=new Array(this._clientPromises.length);for(let o=0;o<this._clientPromises.length;++o){const a=this._clientPromises[o];r[o]=a.then((r=>r?.invoke(e,t,n)))}return r}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject((0,o.NK)(`Worker closing, aborting job calling '${e.methodName}'`));for(const e of this._clientPromises)e.then((e=>e?.close()));this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,(0,i.h)(this)}invoke(e,t,n){return this.apply(e,[t],n)}apply(e,t,n){const r=(0,o.Tw)();this._ongoingJobsQueue.push({methodName:e,data:t,invokeOptions:n,resolver:r});for(let e=0;e<this._clientPromises.length;e++){const t=this._clients[e];t?t.jobAdded():this._clientPromises[e].then((e=>e?.jobAdded()))}return r.promise}createInvokeProxy(e){return(0,s.L)(this,e)}on(e,t){return Promise.all(this._clientPromises).then((()=>(0,r.vE)(this._clients.map((n=>n.on(e,t))))))}openPorts(){return new Promise((e=>{const t=new Array(this._clientPromises.length);let n=t.length;for(let r=0;r<this._clientPromises.length;++r)this._clientPromises[r].then((o=>{o&&(t[r]=o.openPort()),0==--n&&e(t)}))}))}get test(){}}},90465:function(e,t,n){function r(e,t){return new Proxy({},{get:(n,r,o)=>(...n)=>{let o,a;const i=n[n.length-1];return function(e){return"object"==typeof e&&!Array.isArray(e)&&null!=e&&("signal"in e||"transferList"in e||0===Object.keys(e).length)}(i)&&(o=i.signal,a=i.transferList,n.pop()),e.apply(t?`${t}.${r.toString()}`:r.toString(),n,{transferList:a,signal:o})}})}n.d(t,{L:function(){return r}})},50193:function(e,t,n){n.d(t,{A:function(){return b}});var r=n(7156),o=n(39819),a=n(40212),i=n(61226),s=n(95929),l=n(60539),c=n(90465);const u={statsWorker:()=>n.e(1838).then(n.bind(n,27966)),geometryEngineWorker:()=>n.e(2384).then(n.bind(n,9568)),CSVSourceWorker:()=>n.e(2600).then(n.bind(n,14560)),EdgeProcessingWorker:()=>n.e(2933).then(n.bind(n,92273)),ElevationSamplerWorker:()=>n.e(5120).then(n.bind(n,55412)),FeatureServiceSnappingSourceWorker:()=>n.e(8246).then(n.bind(n,26827)),GeoJSONSourceWorker:()=>n.e(7253).then(n.bind(n,4389)),LercWorker:()=>n.e(6594).then(n.bind(n,67024)),MemorySourceWorker:()=>n.e(807).then(n.bind(n,8489)),PBFDecoderWorker:()=>n.e(8950).then(n.bind(n,19939)),FeaturePipelineWorker:()=>n.e(3806).then(n.bind(n,20716)),PointCloudWorker:()=>n.e(9722).then(n.bind(n,33764)),RasterWorker:()=>n.e(6221).then(n.bind(n,85563)),SceneLayerSnappingSourceWorker:()=>n.e(5974).then(n.bind(n,28820)),SceneLayerWorker:()=>n.e(5404).then(n.bind(n,90525)),WFSSourceWorker:()=>n.e(4900).then(n.bind(n,6412)),WorkerTileHandler:()=>n.e(3295).then(n.bind(n,27787)),Lyr3DWorker:()=>n.e(3213).then(n.bind(n,6883))};var f=n(64272),d=n(23532);const{CLOSE:h,ABORT:p,INVOKE:w,RESPONSE:g,OPEN_PORT:m,ON:y}=f.Go;class v{constructor(e){this._invoke=e,this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._timer=null,this._process=this._process.bind(this)}push(e){e.type===f.Go.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),null===this._timer&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class b{static connect(e,t){const n=new MessageChannel;let r;r="function"==typeof e?new e:"default"in e&&"function"==typeof e.default?new e.default:e;const o=new b(n.port1,{channel:n,client:r,schedule:t});return"object"==typeof r&&"remoteClient"in r&&(r.remoteClient=o),b.clients.set(o,r),n.port2}static loadWorker(e){const t=u[e];return t?t():Promise.resolve(null)}constructor(e,t,n){this._port=e,this._jobQueue=n,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new v((e=>this._onInvokeMessage(e))),this._client=t.client,this._onMessage=this._onMessage.bind(this),this._channel=t.channel,this._schedule=t.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:h}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,t,n){return this.apply(e,[t],n)}apply(e,t,n){const r=n?.signal,a=n?.transferList;if(!this._port)return Promise.reject(new o.A(f.T,`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:t}));const i=(0,f.Jc)();return new Promise(((n,o)=>{if((0,l.G4)(r))return this._processWork(),void o((0,l.NK)());const c=(0,l.u7)(r,(()=>{const e=this._outJobs.get(i);e&&(this._outJobs.delete(i),this._processWork(),(0,s.xt)(e.abortHandle),this._post({type:p,jobId:i}),o((0,l.NK)()))})),u={resolve:n,reject:o,abortHandle:c,debugInfo:e};this._outJobs.set(i,u),this._post({type:w,jobId:i,methodName:e,abortable:null!=r},t,a)}))}createInvokeProxy(e){return(0,c.L)(this,e)}on(e,t){const n=new MessageChannel;function r(e){t(e.data)}return this._port.postMessage({type:f.Go.ON,eventType:e,port:n.port2},[n.port2]),n.port1.addEventListener("message",r),n.port1.start(),(0,i.hA)((()=>{n.port1.postMessage({type:f.Go.CLOSE}),n.port1.close(),n.port1.removeEventListener("message",r)}))}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:m,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=2)return;const e=this._jobQueue?.pop();if(!e)return;const{methodName:t,data:n,invokeOptions:r,resolver:o}=e;this.apply(t,n,r).then((e=>o.resolve(e))).catch((e=>o.reject(e)))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach((e=>{(0,s.xt)(e.abortHandle),e.reject((0,l.NK)(`Worker closing, aborting job calling '${e.debugInfo}'`))})),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){null!=this._schedule?this._schedule((()=>this._processMessage(e,!0))):this._processMessage(e,!1)}_processMessage(e,t){const n=(0,f.VI)(e);if(n)switch(n.type){case g:this._onResponseMessage(n);break;case w:t?this._onInvokeMessage(n):this._invokeQueue.push(n);break;case p:this._onAbortMessage(n);break;case h:this._onCloseMessage();break;case m:this._onOpenPortMessage(n);break;case y:this._onOnMessage(n)}}_onAbortMessage(e){const t=this._inJobs,n=e.jobId,r=t.get(n);this._invokeQueue.push(e),r&&(r.controller&&r.controller.abort(),t.delete(n))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&b.clients.get(this)===e&&e.destroy(),b.clients.delete(this),e?.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:t,jobId:n,data:r=[],abortable:o}=e,a=o?new AbortController:null,i=this._inJobs;let s,c=this._client,u=c[t];try{if(!u&&t&&t.includes(".")){const e=t.split(".");for(let t=0;t<e.length-1;t++)c=c[e[t]],u=c[e[t+1]]}if("function"!=typeof u)throw new TypeError(`${t} is not a function`);r.push({client:this,signal:a?a.signal:null}),s=u.apply(c,r)}catch(e){return void this._post({type:g,jobId:n,error:(0,f.mF)(e)})}(0,l.$X)(s)?(i.set(n,{controller:a,promise:s}),s.then((e=>{i.has(n)&&(i.delete(n),this._post({type:g,jobId:n},e))}),(e=>{i.has(n)&&(i.delete(n),(0,l.zf)(e)||this._post({type:g,jobId:n,error:(0,f.mF)(e||{message:`Error encountered at method ${t}`})}))}))):this._post({type:g,jobId:n},s)}_onOpenPortMessage(e){new b(e.port,{client:this._client})}_onOnMessage(e){const{port:t}=e,n=this._client.on(e.eventType,(e=>{t.postMessage(e)})),r=(0,a.on)(e.port,"message",(e=>{const o=(0,f.VI)(e);o?.type===f.Go.CLOSE&&(r.remove(),n.remove(),t.close())}))}_onResponseMessage(e){const{jobId:t,error:n,data:r}=e,a=this._outJobs;if(!a.has(t))return;const i=a.get(t);a.delete(t),this._processWork(),(0,s.xt)(i.abortHandle),n?i.reject(o.A.fromJSON(JSON.parse(n))):i.resolve(r)}_post(e,t,n){return(0,f.u1)(this._port,e,t,n)}}b.kernelInfo={buildDate:d.$,fullVersion:r.ol,revision:d.u},b.clients=new Map},13370:function(e,t,n){n.d(t,{h:function(){return a},k:function(){return o}});const r=new FinalizationRegistry((e=>{e.close()}));function o(e,t){r.register(e,t,t)}function a(e){r.unregister(e)}},64272:function(e,t,n){n.d(t,{Go:function(){return i},Jc:function(){return c},T:function(){return a},VI:function(){return d},mF:function(){return u},oV:function(){return p},u1:function(){return f}});var r=n(58941),o=n(60539);const a="worker:port-closed";var i,s;(s=i||(i={}))[s.HANDSHAKE=0]="HANDSHAKE",s[s.OPEN=1]="OPEN",s[s.OPENED=2]="OPENED",s[s.RESPONSE=3]="RESPONSE",s[s.INVOKE=4]="INVOKE",s[s.ABORT=5]="ABORT",s[s.CLOSE=6]="CLOSE",s[s.OPEN_PORT=7]="OPEN_PORT",s[s.ON=8]="ON";let l=0;function c(){return l++}function u(e){return e?"string"==typeof e?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function f(e,t,n,o){if(t.type===i.OPEN_PORT)return void e.postMessage(t,[t.port]);if(t.type!==i.INVOKE&&t.type!==i.RESPONSE)return void e.postMessage(t);let a;if(function(e){return e&&"object"==typeof e&&("result"in e||"transferList"in e)}(n)?(a=h(n.transferList),t.data=n.result):(a=h(o),t.data=n),a){if((0,r.A)("ff"))for(const n of a)if("byteLength"in n&&n.byteLength>267386880){const n="Worker call with large ArrayBuffer would crash Firefox";switch(t.type){case i.INVOKE:throw n;case i.RESPONSE:return void f(e,{type:i.RESPONSE,jobId:t.jobId,error:u(n)})}}e.postMessage(t,a)}else e.postMessage(t)}function d(e){if(!e)return null;const t=e.data;return t?"string"==typeof t?JSON.parse(t):t:null}function h(e){if(!e?.length)return null;if((0,r.A)("esri-workers-arraybuffer-transfer"))return e;const t=e.filter((e=>!function(e){return e instanceof ArrayBuffer||"ArrayBuffer"===e?.constructor?.name}(e)));return t.length?t:null}async function p(e){try{return await e}catch(e){const t=e?.name===a;if(!(0,o.zf)(e)&&!t)throw e;return}}},86027:function(e,t,n){n.d(t,{n_:function(){return B},ho:function(){return H}});var r=n(39819),o=n(58941),a=n(60539),i=n(37797),s=n(13370),l=n(50193),c=n(40633),u=n(95929),f=n(93040),d=n(90683);const h={async request(e,t){const n=e.options,r=n.responseType;n.signal=t?.signal,n.responseType="native"===r||"native-request-init"===r?"native-request-init":r&&["blob","json","text"].includes(r)&&(0,d.sC)(e.url)?.after?r:"array-buffer";const o=await(0,f.A)(e.url,n),a={data:o.data,httpStatus:o.httpStatus,ssl:o.ssl};switch(o.requestOptions?.responseType){case"native-request-init":return delete a.data.signal,a;case"blob":a.data=await a.data.arrayBuffer();break;case"json":a.data=(new TextEncoder).encode(JSON.stringify(a.data)).buffer;break;case"text":a.data=(new TextEncoder).encode(a.data).buffer}return{result:a,transferList:[a.data]}}};var p=n(64272),w=n(53216),g=n(25591),m=(n(64122),n(7156));const y={};var v=n(29601);class b{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach((t=>{this[t]=(...n)=>e[t](...n)}))}}class A{constructor(){this._dispatcher=new b,this._workerPostMessage({type:p.Go.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){(0,v.d)((()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))}))}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,t,n){this._dispatcher.addEventListener(e,t,n)}removeEventListener(e,t,n){this._dispatcher.removeEventListener(e,t,n)}_workerPostMessage(e){(0,v.d)((()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))}))}async _workerMessageHandler(e){const t=(0,p.VI)(e);if(t&&t.type===p.Go.OPEN){const{modulePath:e,jobId:n}=t;let r=await l.A.loadWorker(e);r||(r=await import(e));const o=l.A.connect(r);this._workerPostMessage({type:p.Go.OPENED,jobId:n,data:o})}}}var I=n(22739),S=n(23532);const D=()=>c.A.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:T}=p.Go;let k,_;const P="Failed to create Worker. Fallback to execute module in main thread";async function $(e){return new Promise((t=>{function n(o){const a=(0,p.VI)(o);a&&a.type===T&&(e.removeEventListener("message",n),e.removeEventListener("error",r),t(e))}function r(t){t.preventDefault(),e.removeEventListener("message",n),e.removeEventListener("error",r),D().warn("Failed to create Worker. Fallback to execute module in main thread",t),(e=new A).addEventListener("message",n),e.addEventListener("error",r)}e.addEventListener("message",n),e.addEventListener("error",r)}))}let x=0;const{ABORT:X,INVOKE:N,OPEN:O,OPENED:E,RESPONSE:R}=p.Go;class M{static async create(e){const t=await async function(){if(!(0,o.A)("esri-workers"))return $(new A);if(!k&&!_)try{const e='let globalId=0;const outgoing=new Map,configuration={CONFIGURATION};self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;let s=null;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());s=()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))},t.addEventListener("abort",s)}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})})).finally((()=>{t&&t.removeEventListener("abort",s)}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\nModules version: ${r}\nAssets version: ${n??s}\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});'.split("{CONFIGURATION}").join(function(){let e;if(null!=g.default.default){const t={...g.default};delete t.default,e=JSON.parse(JSON.stringify(t))}else e=JSON.parse(JSON.stringify(g.default));e.assetsPath=(0,d.s2)(e.assetsPath),e.defaultAssetsPath=e.defaultAssetsPath?(0,d.s2)(e.defaultAssetsPath):void 0,e.request.interceptors=[],e.log.interceptors=[],e.locale=(0,I.JK)(),e.has={"esri-csp-restrictions":(0,o.A)("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":(0,o.A)("esri-2d-update-debug"),"esri-2d-log-updating":(0,o.A)("esri-2d-log-updating"),"featurelayer-pbf":(0,o.A)("featurelayer-pbf"),"featurelayer-fast-triangulation-enabled":(0,o.A)("featurelayer-fast-triangulation-enabled"),"featurelayer-simplify-thresholds":(0,o.A)("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":(0,o.A)("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":(0,o.A)("featurelayer-simplify-mobile-factor"),"featurelayer-query-max-depth":(0,o.A)("featurelayer-query-max-depth"),"featurelayer-query-pausing-enabled":(0,o.A)("featurelayer-query-pausing-enabled"),"featurelayer-snapshot-enabled":(0,o.A)("featurelayer-snapshot-enabled"),"esri-atomics":(0,o.A)("esri-atomics"),"esri-shared-array-buffer":(0,o.A)("esri-shared-array-buffer"),"esri-tiles-debug":(0,o.A)("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":(0,o.A)("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":(0,o.A)("feature-polyline-generalization-factor"),"host-webworker":1},e.workers.loaderUrl&&(e.workers.loaderUrl=(0,d.s2)(e.workers.loaderUrl)),e.workers.workerPath?e.workers.workerPath=(0,d.s2)(e.workers.workerPath):e.workers.workerPath=(0,d.s2)((0,w.s)("esri/core/workers/RemoteClient.js")),e.workers.useDynamicImport=!1;const t=g.default.workers.loaderConfig,n=function(e){const t={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:{...e.has},map:{...e.map},packages:e.packages?.concat()||[],paths:{...y.paths,...e.paths}};return e.hasOwnProperty("async")||(t.async=!0),e.hasOwnProperty("isDebug")||(t.isDebug=!1),e.baseUrl||(t.baseUrl=y.baseUrl),t}({baseUrl:t?.baseUrl,locale:(0,I.JK)(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...t?.has},map:{...t?.map},paths:{...t?.paths},packages:t?.packages||[]}),r={buildDate:S.$,fullVersion:m.ol,revision:S.u};return JSON.stringify({esriConfig:e,loaderConfig:n,kernelInfo:r})}());k=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){_=e||{}}let e;if(k)try{e=new Worker(k,{name:"esri-worker-"+x++})}catch(t){D().warn(P,_),e=new A}else D().warn(P,_),e=new A;return $(e)}();return new M(t,e)}constructor(e,t){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=t,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",(e=>{e.preventDefault(),c.A.getLogger("esri.core.workers.WorkerOwner").error(e)}))}terminate(){this.worker.terminate()}async open(e,t={}){const{signal:n}=t,r=(0,p.Jc)();return new Promise(((t,o)=>{const i={resolve:t,reject:o,abortHandle:(0,a.NY)(n,(()=>{this._outJobs.delete(r),this._post({type:X,jobId:r})}))};this._outJobs.set(r,i),this._post({type:O,jobId:r,modulePath:e})}))}_onMessage(e){const t=(0,p.VI)(e);if(t)switch(t.type){case E:this._onOpenedMessage(t);break;case R:this._onResponseMessage(t);break;case X:this._onAbortMessage(t);break;case N:this._onInvokeMessage(t)}}_onAbortMessage(e){const t=this._inJobs,n=e.jobId,r=t.get(n);r&&(r.controller&&r.controller.abort(),t.delete(n))}_onInvokeMessage(e){const{methodName:t,jobId:n,data:r,abortable:o}=e,i=o?new AbortController:null,s=this._inJobs,l=h[t];let c;try{if("function"!=typeof l)throw new TypeError(`${t} is not a function`);c=l.call(null,r,{signal:i?i.signal:null})}catch(e){return void this._post({type:R,jobId:n,error:(0,p.mF)(e)})}(0,a.$X)(c)?(s.set(n,{controller:i,promise:c}),c.then((e=>{s.has(n)&&(s.delete(n),this._post({type:R,jobId:n},e))}),(e=>{s.has(n)&&(s.delete(n),e||(e={message:"Error encountered at method"+t}),(0,a.zf)(e)||this._post({type:R,jobId:n,error:(0,p.mF)(e||{message:`Error encountered at method ${t}`})}))}))):this._post({type:R,jobId:n},c)}_onOpenedMessage(e){const{jobId:t,data:n}=e,r=this._outJobs.get(t);r&&(this._outJobs.delete(t),(0,u.xt)(r.abortHandle),r.resolve(n))}_onResponseMessage(e){const{jobId:t,error:n,data:o}=e,a=this._outJobs.get(t);a&&(this._outJobs.delete(t),(0,u.xt)(a.abortHandle),n?a.reject(r.A.fromJSON(JSON.parse(n))):a.resolve(o))}_post(e,t,n){return(0,p.u1)(this.worker,e,t,n)}}const C=(0,o.A)("host-browser")?Math.min(navigator.hardwareConcurrency-1,(0,o.A)("workers-pool-size")):0;let F=(0,o.A)("esri-mobile")?Math.min(C,3):C;F||(F=(0,o.A)("safari")&&(0,o.A)("mac")?7:2);let L=0;const j=[];function B(){W()}async function J(e,t){const n=new i.A,{registryTarget:r,...o}=t;return await n.open(e,o),r&&(0,s.k)(r,n),n}async function H(e,t={}){if("string"!=typeof e)throw new r.A("workers:undefined-module","modulePath is missing");let n=t.strategy||"distributed";if((0,o.A)("host-webworker")&&!(0,o.A)("esri-workers")&&(n="local"),"local"===n){let n=await l.A.loadWorker(e);n||(n=await import(e)),(0,a.Te)(t.signal);const r=t.client||n;return J([l.A.connect(n,t.schedule)],{...t,client:r})}if(await W(),(0,a.Te)(t.signal),"dedicated"===n){const n=L++%F;return J([await j[n].open(e,t)],t)}if(t.maxNumWorkers&&t.maxNumWorkers>0){const n=Math.min(t.maxNumWorkers,F);if(n<F){const r=new Array(n);for(let o=0;o<n;++o){const n=L++%F;r[o]=j[n].open(e,t)}return J(r,t)}}return J(j.map((n=>n.open(e,t))),t)}let K,q=null;async function W(){if(q)return q;K=new AbortController;const e=[];for(let t=0;t<F;t++){const n=M.create(t).then((e=>(j[t]=e,e)));e.push(n)}return q=Promise.all(e),q}},75160:function(e,t,n){n.r(t),n.d(t,{buffer:function(){return E},changeDefaultSpatialReferenceTolerance:function(){return z},clearDefaultSpatialReferenceTolerance:function(){return Z},clip:function(){return p},contains:function(){return g},convexHull:function(){return P},crosses:function(){return m},cut:function(){return w},densify:function(){return K},difference:function(){return $},disjoint:function(){return S},distance:function(){return y},equals:function(){return v},extendedSpatialReferenceInfo:function(){return h},flipHorizontal:function(){return B},flipVertical:function(){return J},generalize:function(){return H},geodesicArea:function(){return Q},geodesicBuffer:function(){return R},geodesicDensify:function(){return q},geodesicLength:function(){return V},intersect:function(){return X},intersectLinesToPoints:function(){return G},intersects:function(){return b},isSimple:function(){return k},nearestCoordinate:function(){return M},nearestVertex:function(){return C},nearestVertices:function(){return F},offset:function(){return O},overlaps:function(){return D},planarArea:function(){return W},planarLength:function(){return U},relate:function(){return T},rotate:function(){return j},simplify:function(){return _},symmetricDifference:function(){return x},touches:function(){return A},union:function(){return N},within:function(){return I}}),n(50917);var r=n(86027),o=n(45532),a=n(74697);function i(e){return Array.isArray(e)?e[0]?.spatialReference:e?.spatialReference}function s(e){return e?Array.isArray(e)?e.map(s):e.toJSON?e.toJSON():e:e}function l(e){return Array.isArray(e)?e.map((e=>(0,a.rS)(e))):(0,a.rS)(e)}let c;async function u(){return c||(c=(0,r.ho)("geometryEngineWorker",{strategy:"distributed"})),c}async function f(e,t){return(await u()).invoke("executeGEOperation",{operation:e,parameters:s(t)})}async function d(e,t){const n=await u();return Promise.all(n.broadcast("executeGEOperation",{operation:e,parameters:s(t)}))}function h(e){return f("extendedSpatialReferenceInfo",[e])}async function p(e,t){return l(await f("clip",[i(e),e,t]))}async function w(e,t){return l(await f("cut",[i(e),e,t]))}function g(e,t){return f("contains",[i(e),e,t])}function m(e,t){return f("crosses",[i(e),e,t])}function y(e,t,n){return f("distance",[i(e),e,t,n])}function v(e,t){return f("equals",[i(e),e,t])}function b(e,t){return f("intersects",[i(e),e,t])}function A(e,t){return f("touches",[i(e),e,t])}function I(e,t){return f("within",[i(e),e,t])}function S(e,t){return f("disjoint",[i(e),e,t])}function D(e,t){return f("overlaps",[i(e),e,t])}function T(e,t,n){return f("relate",[i(e),e,t,n])}function k(e){return f("isSimple",[i(e),e])}async function _(e){return l(await f("simplify",[i(e),e]))}async function P(e,t=!1){return l(await f("convexHull",[i(e),e,t]))}async function $(e,t){return l(await f("difference",[i(e),e,t]))}async function x(e,t){return l(await f("symmetricDifference",[i(e),e,t]))}async function X(e,t){return l(await f("intersect",[i(e),e,t]))}async function N(e,t=null){const n=function(e,t){let n;return Array.isArray(e)?n=e:(n=[],n.push(e),null!=t&&n.push(t)),n}(e,t);return l(await f("union",[i(n),n]))}async function O(e,t,n,r,o,a){return l(await f("offset",[i(e),e,t,n,r,o,a]))}async function E(e,t,n,r=!1){const o=[i(e),e,t,n,r];return l(await f("buffer",o))}async function R(e,t,n,r,o,a){const s=[i(e),e,t,n,r,o,a];return l(await f("geodesicBuffer",s))}async function M(e,t,n=!0){const r=await f("nearestCoordinate",[i(e),e,t,n]);return{...r,coordinate:o.default.fromJSON(r.coordinate)}}async function C(e,t){const n=await f("nearestVertex",[i(e),e,t]);return{...n,coordinate:o.default.fromJSON(n.coordinate)}}async function F(e,t,n,r){return(await f("nearestVertices",[i(e),e,t,n,r])).map((e=>({...e,coordinate:o.default.fromJSON(e.coordinate)})))}function L(e){return"xmin"in e?e.center:"x"in e?e:e.extent?.center}async function j(e,t,n){if(null==e)throw new Y;const r=e.spatialReference;if(null==(n=n??L(e)))throw new Y;const o=e.constructor.fromJSON(await f("rotate",[r,e,t,n]));return o.spatialReference=r,o}async function B(e,t){if(null==e)throw new Y;const n=e.spatialReference;if(null==(t=t??L(e)))throw new Y;const r=e.constructor.fromJSON(await f("flipHorizontal",[n,e,t]));return r.spatialReference=n,r}async function J(e,t){if(null==e)throw new Y;const n=e.spatialReference;if(null==(t=t??L(e)))throw new Y;const r=e.constructor.fromJSON(await f("flipVertical",[n,e,t]));return r.spatialReference=n,r}async function H(e,t,n,r){return l(await f("generalize",[i(e),e,t,n,r]))}async function K(e,t,n){return l(await f("densify",[i(e),e,t,n]))}async function q(e,t,n,r=0){return l(await f("geodesicDensify",[i(e),e,t,n,r]))}function W(e,t){return f("planarArea",[i(e),e,t])}function U(e,t){return f("planarLength",[i(e),e,t])}function Q(e,t,n){return f("geodesicArea",[i(e),e,t,n])}function V(e,t,n){return f("geodesicLength",[i(e),e,t,n])}async function G(e,t){return l(await f("intersectLinesToPoints",[i(e),e,t]))}async function z(e,t){await d("changeDefaultSpatialReferenceTolerance",[e,t])}async function Z(e){await d("clearDefaultSpatialReferenceTolerance",[e])}class Y extends Error{constructor(){super("Illegal Argument Exception")}}},23532:function(e,t,n){n.d(t,{$:function(){return r},u:function(){return o}});const r="20240621",o="96d683427103aedd3960cf342647a8857de30ca3"}}]);
//# sourceMappingURL=arcade-arcadeAsyncRuntime.js.map