"use strict";(self.webpackChunkdefraMap=self.webpackChunkdefraMap||[]).push([[6022],{9688:function(t,e,i){i.d(e,{lY:function(){return h},mT:function(){return d}});var n,r=i(50944),s=i(92955),o=i(3569);(n||(n={})).TimeZoneNotRecognized="TimeZoneNotRecognized";const a={[n.TimeZoneNotRecognized]:"Timezone identifier has not been recognized."};class l extends Error{constructor(t,e){super((0,r.HC)(a[t],e)),this.declaredRootClass="esri.arcade.arcadedate.dateerror",Error.captureStackTrace&&Error.captureStackTrace(this,l)}}function c(t,e,i){return t<e?t-e:t>i?t-i:0}function u(t,e,i){return t<e?e:t>i?i:t}class h{constructor(t){this._date=t,this.declaredRootClass="esri.arcade.arcadedate"}static fromParts(t=0,e=1,i=1,n=0,r=0,s=0,a=0,l){if(isNaN(t)||isNaN(e)||isNaN(i)||isNaN(n)||isNaN(r)||isNaN(s)||isNaN(a))return null;const f=o.c9.local(t,e).daysInMonth;let _=o.c9.fromObject({day:u(i,1,f),year:t,month:u(e,1,12),hour:u(n,0,23),minute:u(r,0,59),second:u(s,0,59),millisecond:u(a,0,999)},{zone:d(l)});return _=_.plus({months:c(e,1,12),days:c(i,1,f),hours:c(n,0,23),minutes:c(r,0,59),seconds:c(s,0,59),milliseconds:c(a,0,999)}),new h(_)}static get systemTimeZoneCanonicalName(){return Intl.DateTimeFormat().resolvedOptions().timeZone??"system"}static arcadeDateAndZoneToArcadeDate(t,e){const i=d(e);return t.isUnknownTimeZone||i===s.GB.instance?h.fromParts(t.year,t.monthJS+1,t.day,t.hour,t.minute,t.second,t.millisecond,i):new h(t._date.setZone(i))}static dateJSToArcadeDate(t){return new h(o.c9.fromJSDate(t,{zone:"system"}))}static dateJSAndZoneToArcadeDate(t,e="system"){const i=d(e);return new h(o.c9.fromJSDate(t,{zone:i}))}static unknownEpochToArcadeDate(t){return new h(o.c9.fromMillis(t,{zone:s.GB.instance}))}static unknownDateJSToArcadeDate(t){return new h(o.c9.fromMillis(t.getTime(),{zone:s.GB.instance}))}static epochToArcadeDate(t,e="system"){const i=d(e);return new h(o.c9.fromMillis(t,{zone:i}))}static dateTimeToArcadeDate(t){return new h(t)}clone(){return new h(this._date)}changeTimeZone(t){const e=d(t);return h.dateTimeToArcadeDate(this._date.setZone(e))}static dateTimeAndZoneToArcadeDate(t,e){const i=d(e);return t.zone===s.GB.instance||i===s.GB.instance?h.fromParts(t.year,t.month,t.day,t.hour,t.minute,t.second,t.millisecond,i):new h(t.setZone(i))}static nowToArcadeDate(t){const e=d(t);return new h(o.c9.fromJSDate(new Date,{zone:e}))}static nowUTCToArcadeDate(){return new h(o.c9.utc())}get isSystem(){return"system"===this.timeZone||this.timeZone===h.systemTimeZoneCanonicalName}equals(t){return this.isSystem&&t.isSystem?this.toNumber()===t.toNumber():this.isUnknownTimeZone===t.isUnknownTimeZone&&this._date.equals(t._date)}get isUnknownTimeZone(){return this._date.zone===s.GB.instance}get isValid(){return this._date.isValid}get hour(){return this._date.hour}get second(){return this._date.second}get day(){return this._date.day}get dayOfWeekISO(){return this._date.weekday}get dayOfWeekJS(){let t=this._date.weekday;return t>6&&(t=0),t}get millisecond(){return this._date.millisecond}get monthISO(){return this._date.month}get weekISO(){return this._date.weekNumber}get yearISO(){return this._date.weekYear}get monthJS(){return this._date.month-1}get year(){return this._date.year}get minute(){return this._date.minute}get zone(){return this._date.zone}get timeZoneOffset(){return this.isUnknownTimeZone?0:this._date.offset}get timeZone(){if(this.isUnknownTimeZone)return"unknown";if("system"===this._date.zone.type)return"system";const t=this.zone;return"fixed"===t.type?0===t.fixed?"UTC":t.formatOffset(0,"short"):t.name}stringify(){return JSON.stringify(this.toJSDate())}plus(t){return new h(this._date.plus(t))}diff(t,e="milliseconds"){return this._date.diff(t._date,e)[e]}toISODate(){return this._date.toISODate()}toISOString(t){return t?this._date.toISO({suppressMilliseconds:!0,includeOffset:!this.isUnknownTimeZone}):this._date.toISO({includeOffset:!this.isUnknownTimeZone})}toISOTime(t,e){return this._date.toISOTime({suppressMilliseconds:t,includeOffset:e&&!this.isUnknownTimeZone})}toFormat(t,e){return this.isUnknownTimeZone&&(t=t.replaceAll("Z","")),this._date.toFormat(t,e)}toJSDate(){return this._date.toJSDate()}toSQLValue(){return this._date.toFormat("yyyy-LL-dd HH:mm:ss")}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}toDateTime(){return this._date}toNumber(){return this._date.toMillis()}getTime(){return this._date.toMillis()}toUTC(){return new h(this._date.toUTC())}toLocal(){return new h(this._date.toLocal())}toString(){return this.toISOString(!0)}static fromReaderAsTimeStampOffset(t){if(!t)return null;const e=o.c9.fromISO(t,{setZone:!0});return new h(e)}}function d(t,e=!0){if(t instanceof o.bo)return t;if("system"===t.toLowerCase())return"system";if("utc"===t.toLowerCase())return"UTC";if("unknown"===t.toLowerCase())return s.GB.instance;if(/^[+-]?[0-9]{1,2}([:][0-9]{2})?$/.test(t)){const e=o.mQ.parseSpecifier("UTC"+(t.startsWith("+")||t.startsWith("-")?"":"+")+t);if(e)return e}const i=o.oh.create(t);if(!i.isValid){if(e)throw new l(n.TimeZoneNotRecognized);return null}return i}},80749:function(t,e,i){i.d(e,{Fq:function(){return l},SQ:function(){return o},Yc:function(){return s},Yq:function(){return a},uf:function(){return r}});var n=i(91484);function r(t){if(null==t)return null;if("number"==typeof t)return t;let e=t.toLowerCase();switch(e=e.replaceAll(/\s/g,""),e=e.replaceAll("-",""),e){case"meters":case"meter":case"m":case"squaremeters":case"squaremeter":return 109404;case"miles":case"mile":case"squaremile":case"squaremiles":return 109439;case"kilometers":case"kilometer":case"squarekilometers":case"squarekilometer":case"km":return 109414;case"acres":case"acre":case"ac":return 109402;case"hectares":case"hectare":case"ha":return 109401;case"yard":case"yd":case"yards":case"squareyards":case"squareyard":return 109442;case"feet":case"ft":case"foot":case"squarefeet":case"squarefoot":return 109405;case"nmi":case"nauticalmile":case"nauticalmiles":case"squarenauticalmile":case"squarenauticalmiles":return 109409}return null}function s(t){if(null==t)return null;switch(t.type){case"polygon":case"multipoint":case"polyline":return t.extent;case"point":return new n.default({xmin:t.x,ymin:t.y,xmax:t.x,ymax:t.y,spatialReference:t.spatialReference});case"extent":return t}return null}function o(t){if(null==t)return null;if("number"==typeof t)return t;let e=t.toLowerCase();switch(e=e.replaceAll(/\s/g,""),e=e.replaceAll("-",""),e){case"meters":case"meter":case"m":case"squaremeters":case"squaremeter":return 9001;case"miles":case"mile":case"squaremile":case"squaremiles":return 9093;case"kilometers":case"kilometer":case"squarekilometers":case"squarekilometer":case"km":return 9036;case"yard":case"yd":case"yards":case"squareyards":case"squareyard":return 9096;case"feet":case"ft":case"foot":case"squarefeet":case"squarefoot":return 9002;case"nmi":case"nauticalmile":case"nauticalmiles":case"squarenauticalmile":case"squarenauticalmiles":return 9030}return null}function a(t){if(null==t)return null;const e=t.clone();return void 0!==t.cache._geVersion&&(e.cache._geVersion=t.cache._geVersion),e}function l(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}},80562:function(t,e,i){i.d(e,{b:function(){return d},l:function(){return o},o:function(){return c}});var n,r=i(32150),s={exports:{}};void 0!==(n=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])&&(s.exports=n);const o=(0,r.g)(s.exports);var a,l={exports:{}};a=l,function(t){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];void 0!==e&&(a.exports=e)}();const c=(0,r.g)(l.exports);var u,h={exports:{}};u=h,function(t){var e=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"];void 0!==e&&(u.exports=e)}();const d=(0,r.g)(h.exports)},59122:function(t,e,i){i.d(e,{e:function(){return l}});var n,r,s,o=i(32150),a={exports:{}};n=a,r=function(){function t(t,i,r){r=r||2;var s,o,a,c,u,h,d,f=i&&i.length,_=f?i[0]*r:t.length,p=e(t,0,_,r,!0),m=[];if(!p||p.next===p.prev)return m;if(f&&(p=l(t,i,p,r)),t.length>80*r){s=a=t[0],o=c=t[1];for(var g=r;g<_;g+=r)(u=t[g])<s&&(s=u),(h=t[g+1])<o&&(o=h),u>a&&(a=u),h>c&&(c=h);d=0!==(d=Math.max(a-s,c-o))?1/d:0}return n(p,m,r,s,o,d),m}function e(t,e,i,n,r){var s,o;if(r===A(t,e,i,n)>0)for(s=e;s<i;s+=n)o=M(s,t[s],t[s+1],o);else for(s=i-n;s>=e;s-=n)o=M(s,t[s],t[s+1],o);if(o&&v(o,o.next)){var a=o.next;P(o),o=a}return o}function i(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!v(n,n.next)&&0!==y(n.prev,n,n.next))n=n.next;else{var r=n.prev;if(P(n),(n=e=r)===n.next)break;i=!0}}while(i||n!==e);return e}function n(t,e,l,c,u,h,d){if(t){!d&&h&&f(t,c,u,h);for(var _,p,m=t;t.prev!==t.next;)if(_=t.prev,p=t.next,h?s(t,c,u,h):r(t))e.push(_.i/l),e.push(t.i/l),e.push(p.i/l),P(t),t=p.next,m=p.next;else if((t=p)===m){d?1===d?n(t=o(i(t),e,l),e,l,c,u,h,2):2===d&&a(t,e,l,c,u,h):n(i(t),e,l,c,u,h,1);break}}}function r(t){var e=t.prev,i=t,n=t.next;if(y(e,i,n)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(m(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&y(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function s(t,e,i,n){var r=t.prev,s=t,o=t.next;if(y(r,s,o)>=0)return!1;for(var a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,c=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,u=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,h=_(a,l,e,i,n),d=_(c,u,e,i,n),f=t.prevZ,p=t.nextZ;f&&f.z>=h&&p&&p.z<=d;){if(f!==t.prev&&f!==t.next&&m(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&y(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==t.prev&&p!==t.next&&m(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&y(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=h;){if(f!==t.prev&&f!==t.next&&m(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&y(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==t.prev&&p!==t.next&&m(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&y(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function o(t,e,n){var r=t;do{var s=r.prev,o=r.next.next;!v(s,o)&&x(s,r,r.next,o)&&w(s,o)&&w(o,s)&&(e.push(s.i/n),e.push(r.i/n),e.push(o.i/n),P(r),P(r.next),r=t=o),r=r.next}while(r!==t);return i(r)}function a(t,e,r,s,o,a){var l=t;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&g(l,c)){var u=T(l,c);return l=i(l,l.next),u=i(u,u.next),n(l,e,r,s,o,a),void n(u,e,r,s,o,a)}c=c.next}l=l.next}while(l!==t)}function l(t,n,r,s){var o,a,l,u=[];for(o=0,a=n.length;o<a;o++)(l=e(t,n[o]*s,o<a-1?n[o+1]*s:t.length,s,!1))===l.next&&(l.steiner=!0),u.push(p(l));for(u.sort(c),o=0;o<u.length;o++)r=i(r=h(u[o],r),r.next);return r}function c(t,e){return t.x-e.x}function u(t){if(t.next.prev===t)return t;let e=t;for(;;){const i=e.next;if(i.prev===e||i===e||i===t)break;e=i}return e}function h(t,e){var n=function(t,e){var i,n=e,r=t.x,s=t.y,o=-1/0;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){var a=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>o){if(o=a,a===r){if(s===n.y)return n;if(s===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(r===o)return i;var l,c=i,u=i.x,h=i.y,f=1/0;n=i;do{r>=n.x&&n.x>=u&&r!==n.x&&m(s<h?r:o,s,u,h,s<h?o:r,s,n.x,n.y)&&(l=Math.abs(s-n.y)/(r-n.x),w(n,t)&&(l<f||l===f&&(n.x>i.x||n.x===i.x&&d(i,n)))&&(i=n,f=l)),n=n.next}while(n!==c);return i}(t,e);if(!n)return e;var r=T(n,t),s=i(n,n.next);let o=u(r);return i(o,o.next),s=u(s),u(e===n?s:e)}function d(t,e){return y(t.prev,t,e.prev)<0&&y(e.next,t,t.next)<0}function f(t,e,i,n){var r=t;do{null===r.z&&(r.z=_(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,i,n,r,s,o,a,l,c=1;do{for(i=t,t=null,s=null,o=0;i;){for(o++,n=i,a=0,e=0;e<c&&(a++,n=n.nextZ);e++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}s.nextZ=null,c*=2}while(o>1)}(r)}function _(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function p(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function m(t,e,i,n,r,s,o,a){return(r-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(n-a)-(i-o)*(e-a)>=0&&(i-o)*(s-a)-(r-o)*(n-a)>=0}function g(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&x(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(w(t,e)&&w(e,t)&&function(t,e){var i=t,n=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(y(t.prev,t,e.prev)||y(t,e.prev,e))||v(t,e)&&y(t.prev,t,t.next)>0&&y(e.prev,e,e.next)>0)}function y(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function v(t,e){return t.x===e.x&&t.y===e.y}function x(t,e,i,n){var r=S(y(t,e,i)),s=S(y(t,e,n)),o=S(y(i,n,t)),a=S(y(i,n,e));return r!==s&&o!==a||!(0!==r||!b(t,i,e))||!(0!==s||!b(t,n,e))||!(0!==o||!b(i,t,n))||!(0!==a||!b(i,e,n))}function b(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function S(t){return t>0?1:t<0?-1:0}function w(t,e){return y(t.prev,t,t.next)<0?y(t,e,t.next)>=0&&y(t,t.prev,e)>=0:y(t,e,t.prev)<0||y(t,t.next,e)<0}function T(t,e){var i=new E(t.i,t.x,t.y),n=new E(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function M(t,e,i,n){var r=new E(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function P(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function E(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function A(t,e,i,n){for(var r=0,s=e,o=i-n;s<i;s+=n)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}return t.deviation=function(t,e,i,n){var r=e&&e.length,s=r?e[0]*i:t.length,o=Math.abs(A(t,0,s,i));if(r)for(var a=0,l=e.length;a<l;a++){var c=e[a]*i,u=a<l-1?e[a+1]*i:t.length;o-=Math.abs(A(t,c,u,i))}var h=0;for(a=0;a<n.length;a+=3){var d=n[a]*i,f=n[a+1]*i,_=n[a+2]*i;h+=Math.abs((t[d]-t[_])*(t[f+1]-t[d+1])-(t[d]-t[f])*(t[_+1]-t[d+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},t.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var s=0;s<t[r].length;s++)for(var o=0;o<e;o++)i.vertices.push(t[r][s][o]);r>0&&(n+=t[r-1].length,i.holes.push(n))}return i},t},void 0!==(s=r())&&(n.exports=s);const l=(0,o.g)(a.exports)},67750:function(t,e,i){i.d(e,{A:function(){return D}});const n=[["(",")"],[")","("],["<",">"],[">","<"],["[","]"],["]","["],["{","}"],["}","{"],["«","»"],["»","«"],["‹","›"],["›","‹"],["⁽","⁾"],["⁾","⁽"],["₍","₎"],["₎","₍"],["≤","≥"],["≥","≤"],["〈","〉"],["〉","〈"],["﹙","﹚"],["﹚","﹙"],["﹛","﹜"],["﹜","﹛"],["﹝","﹞"],["﹞","﹝"],["﹤","﹥"],["﹥","﹤"]],r=["آ","أ","إ","ا"],s=["ﻵ","ﻷ","ﻹ","ﻻ"],o=["ﻶ","ﻸ","ﻺ","ﻼ"],a=["ا","ب","ت","ث","ج","ح","خ","د","ذ","ر","ز","س","ش","ص","ض","ط","ظ","ع","غ","ف","ق","ك","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ی","ئ","ؤ"],l=["ﺍ","ﺏ","ﺕ","ﺙ","ﺝ","ﺡ","ﺥ","ﺩ","ﺫ","ﺭ","ﺯ","ﺱ","ﺵ","ﺹ","ﺽ","ﻁ","ﻅ","ﻉ","ﻍ","ﻑ","ﻕ","ﻙ","ﻝ","ﻡ","ﻥ","ﻩ","ﻭ","ﻱ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯼ","ﺉ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺉ","ﺅ"],c=["ﺎ","ﺐ","ﺖ","ﺚ","ﺞ","ﺢ","ﺦ","ﺪ","ﺬ","ﺮ","ﺰ","ﺲ","ﺶ","ﺺ","ﺾ","ﻂ","ﻆ","ﻊ","ﻎ","ﻒ","ﻖ","ﻚ","ﻞ","ﻢ","ﻦ","ﻪ","ﻮ","ﻲ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯽ","ﺊ","ﺆ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺊ","ﺆ"],u=["ﺎ","ﺒ","ﺘ","ﺜ","ﺠ","ﺤ","ﺨ","ﺪ","ﺬ","ﺮ","ﺰ","ﺴ","ﺸ","ﺼ","ﻀ","ﻄ","ﻈ","ﻌ","ﻐ","ﻔ","ﻘ","ﻜ","ﻠ","ﻤ","ﻨ","ﻬ","ﻮ","ﻴ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯿ","ﺌ","ﺆ","ﹱ","ﹲ","ﹴ","ﹷ","ﹹ","ﹻ","ﹽ","ﹿ","ﺀ","ﺌ","ﺆ"],h=["ﺍ","ﺑ","ﺗ","ﺛ","ﺟ","ﺣ","ﺧ","ﺩ","ﺫ","ﺭ","ﺯ","ﺳ","ﺷ","ﺻ","ﺿ","ﻃ","ﻇ","ﻋ","ﻏ","ﻓ","ﻗ","ﻛ","ﻟ","ﻣ","ﻧ","ﻫ","ﻭ","ﻳ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯾ","ﺋ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺋ","ﺅ"],d=["ء","آ","أ","ؤ","إ","ا","ة","د","ذ","ر","ز","و","ى"],f=["ً","ً","ٌ","؟","ٍ","؟","َ","َ","ُ","ُ","ِ","ِ","ّ","ّ","ْ","ْ","ء","آ","آ","أ","أ","ؤ","ؤ","إ","إ","ئ","ئ","ئ","ئ","ا","ا","ب","ب","ب","ب","ة","ة","ت","ت","ت","ت","ث","ث","ث","ث","ج","ج","ج","ج","ح","ح","ح","ح","خ","خ","خ","خ","د","د","ذ","ذ","ر","ر","ز","ز","س","س","س","س","ش","ش","ش","ش","ص","ص","ص","ص","ض","ض","ض","ض","ط","ط","ط","ط","ظ","ظ","ظ","ظ","ع","ع","ع","ع","غ","غ","غ","غ","ف","ف","ف","ف","ق","ق","ق","ق","ك","ك","ك","ك","ل","ل","ل","ل","م","م","م","م","ن","ن","ن","ن","ه","ه","ه","ه","و","و","ى","ى","ي","ي","ي","ي","ﻵ","ﻶ","ﻷ","ﻸ","ﻹ","ﻺ","ﻻ","ﻼ","؟","؟","؟"],_=["ء","ف"],p=["غ","ي"],m=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],g=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],y=0,v=1,x=2,b=3,S=4,w=5,T=6,M=7,P=8,E=10,A=11,C=12,I=18,R=["UBAT_L","UBAT_R","UBAT_EN","UBAT_AN","UBAT_ON","UBAT_B","UBAT_S","UBAT_AL","UBAT_WS","UBAT_CS","UBAT_ES","UBAT_ET","UBAT_NSM","UBAT_LRE","UBAT_RLE","UBAT_PDF","UBAT_LRO","UBAT_RLO","UBAT_BN"],O=100,F=[O+0,y,y,y,y,O+1,O+2,O+3,v,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,O+4,S,S,S,y,S,y,S,y,S,S,S,y,y,S,S,y,y,y,y,y,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,y,y,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,y,y,y,y,y,y,y,y,y,y,y,y,y,y,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,y,y,S,S,y,y,S,S,y,y,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,y,y,y,O+5,M,M,O+6,O+7],z=[[I,I,I,I,I,I,I,I,I,T,w,T,P,w,I,I,I,I,I,I,I,I,I,I,I,I,I,I,w,w,w,T,P,S,S,A,A,A,S,S,S,S,S,E,9,E,9,9,x,x,x,x,x,x,x,x,x,x,9,S,S,S,S,S,S,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,S,S,S,S,S,S,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,S,S,S,S,I,I,I,I,I,I,w,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,9,S,A,A,A,A,S,S,S,S,y,S,S,I,S,S,A,A,x,x,S,y,S,S,S,x,y,S,S,S,S,S,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,S,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,S,y,y,y,y,y,y,y,y],[y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,S,S,S,S,S,S,S,S,S,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,S,S,y,y,y,y,y,y,y,S,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,S,y,S,S,S,S,S,S,S,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,v,C,v,C,C,v,C,C,v,C,S,S,S,S,S,S,S,S,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,S,S,S,S,S,v,v,v,v,v,S,S,S,S,S,S,S,S,S,S,S],[b,b,b,b,S,S,S,S,M,A,A,M,9,M,S,S,C,C,C,C,C,C,C,C,C,C,C,M,S,S,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,b,b,b,b,b,b,b,b,b,b,A,b,b,M,M,M,C,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,C,C,C,C,C,C,C,b,S,C,C,C,C,C,C,M,M,C,C,S,C,C,C,C,M,M,x,x,x,x,x,x,x,x,x,x,M,M,M,M,M,M],[M,M,M,M,M,M,M,M,M,M,M,M,M,M,S,M,M,C,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,S,S,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,C,C,C,C,C,C,C,C,C,C,C,M,S,S,S,S,S,S,S,S,S,S,S,S,S,S,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,C,C,C,C,C,C,C,C,C,v,v,S,S,S,S,v,S,S,S,S,S],[P,P,P,P,P,P,P,P,P,P,P,I,I,I,y,v,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,P,w,13,14,15,16,17,9,A,A,A,A,A,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,9,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,P,I,I,I,I,I,S,S,S,S,S,I,I,I,I,I,I,x,y,S,S,x,x,x,x,x,x,E,E,S,S,S,y,x,x,x,x,x,x,x,x,x,x,E,E,S,S,S,S,y,y,y,y,y,y,y,y,y,y,y,y,y,S,S,S,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S],[y,y,y,y,y,y,y,S,S,S,S,S,S,S,S,S,S,S,S,y,y,y,y,y,S,S,S,S,S,v,C,v,v,v,v,v,v,v,v,v,v,E,v,v,v,v,v,v,v,v,v,v,v,v,v,S,v,v,v,v,v,S,v,S,v,v,S,v,v,S,v,v,v,v,v,v,v,v,v,v,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M],[C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,C,C,C,C,C,C,C,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,9,S,9,S,S,9,S,S,S,S,S,S,S,S,S,A,S,S,E,E,S,S,S,S,S,A,A,S,S,S,S,S,M,M,M,M,M,S,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,S,S,I],[S,S,S,A,A,A,S,S,S,S,S,E,9,E,9,9,x,x,x,x,x,x,x,x,x,x,9,S,S,S,S,S,S,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,S,S,S,S,S,S,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,S,S,S,S,S,S,S,S,S,S,S,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,S,S,S,y,y,y,y,y,y,S,S,y,y,y,y,y,y,S,S,y,y,y,y,y,y,S,S,y,y,y,S,S,S,A,A,S,S,S,A,A,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S]];class D{constructor(){this.inputFormat="ILYNN",this.outputFormat="VLNNN",this.sourceToTarget=[],this.targetToSource=[],this.levels=[]}bidiTransform(t,e,i){if(this.sourceToTarget=[],this.targetToSource=[],!t)return"";if(function(t,e,i){nt=[],st=[];for(let n=0;n<i;n++)t[n]=n,e[n]=n,nt[n]=n}(this.sourceToTarget,this.targetToSource,t.length),!this.checkParameters(e,i))return t;e=this.inputFormat,i=this.outputFormat;let n=t;const a=ot,u=J(e.charAt(1)),d=J(i.charAt(1)),_=("I"===e.charAt(0)?"L":e.charAt(0))+u,p=("I"===i.charAt(0)?"L":i.charAt(0))+d,m=e.charAt(2)+i.charAt(2);a.defInFormat=_,a.defOutFormat=p,a.defSwap=m;const g=L(t,_,p,m,a);let y=!1;return"R"===i.charAt(1)?y=!0:"C"!==i.charAt(1)&&"D"!==i.charAt(1)||(y="rtl"===this.checkContextual(g)),this.sourceToTarget=nt,this.targetToSource=function(t){const e=new Array(t.length);for(let i=0;i<t.length;i++)e[t[i]]=i;return e}(this.sourceToTarget),rt=this.targetToSource,n=e.charAt(3)===i.charAt(3)?g:"S"===i.charAt(3)?function(t,e,i){if(0===e.length)return"";void 0===t&&(t=!0);const n=(e=String(e)).split("");let r=0,a=1,u=n.length;t||(r=n.length-1,a=-1,u=1);const d=function(t,e,i,n,r){let a=0;const u=[];let d=0;for(let r=e;r*i<n;r+=i)if(H(t[r])||Q(t[r])){if("ل"===t[r]&&W(t,r+i,i,n)){t[r]=et(t[r+i],0===a?s:o),r+=i,tt(t,r,i,n),u[d]=r,d++,a=0;continue}const e=t[r];1===a?t[r]=Y(t,r+i,i,n)?j(t[r]):K(t[r],c):!0===Y(t,r+i,i,n)?t[r]=K(t[r],h):t[r]=K(t[r],l),Q(e)||(a=1),!0===$(e)&&(a=0)}else a=0;return u}(n,r,a,u);let f="";for(let e=0;e<n.length;e++)G(d,d.length,e)>-1?(it(rt,e,!t,-1),nt.splice(e,1)):f+=n[e];return f}(y,g):function(t,e,i){if(0===t.length)return"";void 0===e&&(e=!0);let n="";const s=(t=String(t)).split("");for(let i=0;i<t.length;i++){let o=!1;if(s[i]>="ﹰ"&&s[i]<"\ufeff"){const a=t.charCodeAt(i);s[i]>="ﻵ"&&s[i]<="ﻼ"?(e?(i>0&&" "===s[i-1]?n=n.substring(0,n.length-1)+"ل":(n+="ل",o=!0),n+=r[(a-65269)/2]):(n+=r[(a-65269)/2],n+="ل",i+1<t.length&&" "===s[i+1]?i++:o=!0),o&&(it(rt,i,!0,1),nt.splice(i,0,nt[i]))):n+=f[a-65136]}else n+=s[i]}return n}(g,y),this.sourceToTarget=nt,this.targetToSource=rt,this.levels=st,n}_inputFormatSetter(t){if(!ht.test(t))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=t}_outputFormatSetter(t){if(!ht.test(t))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=t}checkParameters(t,e){return t?this._inputFormatSetter(t):t=this.inputFormat,e?this._outputFormatSetter(e):e=this.outputFormat,t!==e}checkContextual(t){let e=N(t);if("ltr"!==e&&"rtl"!==e){try{e=document.dir.toLowerCase()}catch(t){}"ltr"!==e&&"rtl"!==e&&(e="ltr")}return e}hasBidiChar(t){return dt.test(t)}}function L(t,e,i,n,r){const s=function(t,e,i){if(void 0===e.inFormat&&(e.inFormat=i.defInFormat),void 0===e.outFormat&&(e.outFormat=i.defOutFormat),void 0===e.swap&&(e.swap=i.defSwap),e.inFormat===e.outFormat)return e;const n=e.inFormat.substring(0,1),r=e.outFormat.substring(0,1);let s,o=e.inFormat.substring(1,4),a=e.outFormat.substring(1,4);return"C"===o.charAt(0)&&(s=N(t),o="ltr"===s||"rtl"===s?s.toUpperCase():"L"===e.inFormat.charAt(2)?"LTR":"RTL",e.inFormat=n+o),"C"===a.charAt(0)&&(s=N(t),"rtl"===s?a="RTL":"ltr"===s?(s=function(t){const e=t.split("");return e.reverse(),N(e.join(""))}(t),a=s.toUpperCase()):a="L"===e.outFormat.charAt(2)?"LTR":"RTL",e.outFormat=r+a),e}(t,{inFormat:e,outFormat:i,swap:n},r);if(s.inFormat===s.outFormat)return t;e=s.inFormat,i=s.outFormat,n=s.swap;const o=e.substring(0,1),a=e.substring(1,4),l=i.substring(0,1),c=i.substring(1,4);if(r.inFormat=e,r.outFormat=i,r.swap=n,"L"===o&&"VLTR"===i){if("LTR"===a)return r.dir=ct,B(t,r);if("RTL"===a)return r.dir=ut,B(t,r)}if("V"===o&&"V"===l)return r.dir="RTL"===a?ut:ct,U(t,r);if("L"===o&&"VRTL"===i)return"LTR"===a?(r.dir=ct,t=B(t,r)):(r.dir=ut,t=B(t,r)),U(t);if("VLTR"===e&&"LLTR"===i)return r.dir=ct,B(t,r);if("V"===o&&"L"===l&&a!==c)return t=U(t),"RTL"===a?L(t,"LLTR","VLTR",n,r):L(t,"LRTL","VRTL",n,r);if("VRTL"===e&&"LRTL"===i)return L(t,"LRTL","VRTL",n,r);if("L"===o&&"L"===l){const e=r.swap;return r.swap=e.substr(0,1)+"N","RTL"===a?(r.dir=ut,t=B(t,r),r.swap="N"+e.substr(1,2),r.dir=ct,t=B(t,r)):(r.dir=ct,t=B(t,r),r.swap="N"+e.substr(1,2),t=L(t,"VLTR","LRTL",r.swap,r)),t}return t}function N(t){const e=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(t);return e?e[0]<="z"?"ltr":"rtl":""}function B(t,e){const i=t.split(""),n=[];return k(i,n,e),function(t,e,i){if(0!==i.hiLevel&&i.swap.substr(0,1)!==i.swap.substr(1,2))for(let i=0;i<t.length;i++)1===e[i]&&(t[i]=X(t[i]))}(i,n,e),Z(2,i,n,e),Z(1,i,n,e),st=n,i.join("")}function k(t,e,i){const n=t.length,r=i.dir?g:m;let s=0,o=-1;const a=[],l=[];i.hiLevel=i.dir,i.lastArabic=!1,i.hasUbatAl=!1,i.hasUbatB=!1,i.hasUbatS=!1;for(let e=0;e<n;e++)a[e]=V(t[e]);for(let c=0;c<n;c++){const n=s,u=q(t,a,l,c,i);l[c]=u,s=r[n][u];const h=240&s;s&=15;const d=r[s][at];if(e[c]=d,h>0)if(16===h){for(let t=o;t<c;t++)e[t]=1;o=-1}else o=-1;if(r[s][lt])-1===o&&(o=c);else if(o>-1){for(let t=o;t<c;t++)e[t]=d;o=-1}a[c]===w&&(e[c]=0),i.hiLevel|=d}i.hasUbatS&&function(t,e,i,n){for(let r=0;r<i;r++)if(t[r]===T){e[r]=n.dir;for(let i=r-1;i>=0&&t[i]===P;i--)e[i]=n.dir}}(a,e,n,i)}function V(t){const e=t.charCodeAt(0),i=F[e>>8];return i<O?i:z[i-O][255&e]}function U(t,e){const i=t.split("");if(e){const t=[];k(i,t,e),st=t}return i.reverse(),nt.reverse(),i.join("")}function G(t,e,i){for(let n=0;n<e;n++)if(t[n]===i)return n;return-1}function H(t){for(let e=0;e<_.length;e++)if(t>=_[e]&&t<=p[e])return!0;return!1}function Y(t,e,i,n){for(;e*i<n&&Q(t[e]);)e+=i;return!!(e*i<n&&H(t[e]))}function W(t,e,i,n){for(;e*i<n&&Q(t[e]);)e+=i;let s=" ";if(!(e*i<n))return!1;s=t[e];for(let t=0;t<r.length;t++)if(r[t]===s)return!0;return!1}function Z(t,e,i,n){if(n.hiLevel<t)return;if(1===t&&n.dir===ut&&!n.hasUbatB)return e.reverse(),void nt.reverse();const r=e.length;let s,o,a,l,c,u=0;for(;u<r;){if(i[u]>=t){for(s=u+1;s<r&&i[s]>=t;)s++;for(o=u,a=s-1;o<a;o++,a--)l=e[o],e[o]=e[a],e[a]=l,c=nt[o],nt[o]=nt[a],nt[a]=c;u=s}u++}}function q(t,e,i,n,r){const s=e[n];return{UBAT_L:()=>(r.lastArabic=!1,y),UBAT_R:()=>(r.lastArabic=!1,v),UBAT_ON:()=>S,UBAT_AN:()=>b,UBAT_EN:()=>r.lastArabic?b:x,UBAT_AL:()=>(r.lastArabic=!0,r.hasUbatAl=!0,v),UBAT_WS:()=>S,UBAT_CS:()=>{let t,s;return n<1||n+1>=e.length||(t=i[n-1])!==x&&t!==b||(s=e[n+1])!==x&&s!==b?S:(r.lastArabic&&(s=b),s===t?s:S)},UBAT_ES:()=>(n>0?i[n-1]:w)===x&&n+1<e.length&&e[n+1]===x?x:S,UBAT_ET:()=>{if(n>0&&i[n-1]===x)return x;if(r.lastArabic)return S;let t=n+1;const s=e.length;for(;t<s&&e[t]===A;)t++;return t<s&&e[t]===x?x:S},UBAT_NSM:()=>{if("VLTR"===r.inFormat){const i=e.length;let r=n+1;for(;r<i&&e[r]===C;)r++;if(r<i){const i=t[n].charCodeAt(0),s=i>=1425&&i<=2303||64286===i,o=e[r];if(s&&(o===v||o===M))return v}}return n<1||e[n-1]===w?S:i[n-1]},UBAT_B:()=>(r.lastArabic=!0,r.hasUbatB=!0,r.dir),UBAT_S:()=>(r.hasUbatS=!0,S),UBAT_LRE:()=>(r.lastArabic=!1,S),UBAT_RLE:()=>(r.lastArabic=!1,S),UBAT_LRO:()=>(r.lastArabic=!1,S),UBAT_RLO:()=>(r.lastArabic=!1,S),UBAT_PDF:()=>(r.lastArabic=!1,S),UBAT_BN:()=>S}[R[s]]()}function X(t){let e,i=0,r=n.length-1;for(;i<=r;)if(e=Math.floor((i+r)/2),t<n[e][0])r=e-1;else{if(!(t>n[e][0]))return n[e][1];i=e+1}return t}function $(t){for(let e=0;e<d.length;e++)if(d[e]===t)return!0;return!1}function j(t){for(let e=0;e<a.length;e++)if(t===a[e])return u[e];return t}function K(t,e){for(let i=0;i<a.length;i++)if(t===a[i])return e[i];return t}function Q(t){return t>="ً"&&t<="ٕ"}function J(t){return"L"===t?"LTR":"R"===t?"RTL":"C"===t?"CLR":"D"===t?"CRL":""}function tt(t,e,i,n){for(;e*i<n&&Q(t[e]);)e+=i;return e*i<n&&(t[e]=" ",!0)}function et(t,e){for(let i=0;i<r.length;i++)if(t===r[i])return e[i];return t}function it(t,e,i,n){for(let r=0;r<t.length;r++)(t[r]>e||!i&&t[r]===e)&&(t[r]+=n)}let nt=[],rt=[],st=[];const ot={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},at=5,lt=6,ct=0,ut=1,ht=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,dt=/[\u0591-\u06ff\ufb1d-\ufefc]/},90152:function(t,e,i){i.d(e,{y:function(){return r}});const n=new(i(67750).A);function r(t){if(null==t)return["",!1];if(!n.hasBidiChar(t))return[t,!1];let e;return e="rtl"===n.checkContextual(t)?"IDNNN":"ICNNN",[n.bidiTransform(t,e,"VLYSN"),!0]}},42827:function(t,e,i){i.d(e,{A:function(){return n}});class n{constructor(t){this.size=0,this._start=0,this.maxSize=t,this._buffer=new Array(t)}get entries(){return this._buffer}enqueue(t){if(this.size===this.maxSize){const e=this._buffer[this._start];return this._buffer[this._start]=t,this._start=(this._start+1)%this.maxSize,e}return this._buffer[(this._start+this.size++)%this.maxSize]=t,null}dequeue(){if(0===this.size)return null;const t=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,t}peek(){return 0===this.size?null:this._buffer[this._start]}peekLast(){return 0===this.size?null:this._buffer[(this._start+(this.size-1))%this.maxSize]}find(t){if(0===this.size)return null;for(const e of this._buffer)if(null!=e&&t(e))return e;return null}clear(t){let e=this.dequeue();for(;null!=e;)t&&t(e),e=this.dequeue()}}},7970:function(t,e,i){i.d(e,{O:function(){return n}});class n{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===this._outer.size}get(t,e){return this._outer.get(t)?.get(e)}set(t,e,i){const n=this._outer.get(t);n?n.set(e,i):this._outer.set(t,new Map([[e,i]]))}delete(t,e){const i=this._outer.get(t);i&&(i.delete(e),0===i.size&&this._outer.delete(t))}forEach(t){this._outer.forEach(((e,i)=>t(e,i)))}}},5161:function(t,e,i){i.d(e,{T:function(){return s},U:function(){return r}});var n=i(15774);function r(t,e,i=0){const r=(0,n.qE)(t,0,l);for(let t=0;t<4;t++)e[i+t]=Math.floor(256*c(r*o[t]))}function s(t,e=0){let i=0;for(let n=0;n<4;n++)i+=t[e+n]*a[n];return i}const o=[1,256,65536,16777216],a=[1/256,1/65536,1/16777216,1/4294967296],l=s(new Uint8ClampedArray([255,255,255,255]));function c(t){return t-Math.floor(t)}},80683:function(t,e,i){i.d(e,{Al:function(){return c},NZ:function(){return u},Vb:function(){return r},af:function(){return h},rK:function(){return d}});var n=i(25591);const r="arial-unicode-ms",s="woff2",o=new Map,a=new Set;class l{constructor(t,e){this.fontFace=t,this.promise=e}}async function c(t){const e=f(t),i=d(t),r=o.get(e);if(r)return r.promise;const c=new FontFace(t.family,`url('${n.default.fontsUrl}/woff2/${i}.${s}') format('${s}')`,{style:t.style,weight:t.weight}),u=document.fonts;if(u.has(c)&&"loading"===c.status)return c.loaded;const h=c.load().then((()=>(u.add(c),c)));return o.set(e,new l(c,h)),a.add(c),h}function u(t){return a.has(t)}function h(t){if(!t)return r;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function d(t){const e=_(t)+p(t);return h(t.family)+(e.length>0?e:"-regular")}function f(t){const e=_(t)+p(t);return(t.family||r)+(e.length>0?e:"-regular")}function _(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function p(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}},43274:function(t,e,i){function n(){return new Float32Array(3)}function r(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function s(t,e,i){const n=new Float32Array(3);return n[0]=t,n[1]=e,n[2]=i,n}function o(){return n()}function a(){return s(1,1,1)}function l(){return s(1,0,0)}function c(){return s(0,1,0)}function u(){return s(0,0,1)}i.d(e,{fA:function(){return s},o8:function(){return r},vt:function(){return n}});const h=o(),d=a(),f=l(),_=c(),p=u();Object.freeze(Object.defineProperty({__proto__:null,ONES:d,UNIT_X:f,UNIT_Y:_,UNIT_Z:p,ZEROS:h,clone:r,create:n,createView:function(t,e){return new Float32Array(t,e,3)},fromValues:s,ones:a,unitX:l,unitY:c,unitZ:u,zeros:o},Symbol.toStringTag,{value:"Module"}))},43745:function(t,e,i){function n(){return new Float32Array(4)}function r(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function s(t,e,i,n){const r=new Float32Array(4);return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r}function o(){return n()}function a(){return s(1,1,1,1)}function l(){return s(1,0,0,0)}function c(){return s(0,1,0,0)}function u(){return s(0,0,1,0)}function h(){return s(0,0,0,1)}i.d(e,{fA:function(){return s},o8:function(){return r}});const d=o(),f=a(),_=l(),p=c(),m=u(),g=h();Object.freeze(Object.defineProperty({__proto__:null,ONES:f,UNIT_W:g,UNIT_X:_,UNIT_Y:p,UNIT_Z:m,ZEROS:d,clone:r,create:n,createView:function(t,e){return new Float32Array(t,e,4)},fromValues:s,ones:a,unitW:h,unitX:l,unitY:c,unitZ:u,zeros:o},Symbol.toStringTag,{value:"Module"}))},68225:function(t,e,i){i.d(e,{A:function(){return u}});var n,r,s=i(58941),o=i(56996);(r=n||(n={}))[r.varint=0]="varint",r[r.fixed64=1]="fixed64",r[r.delimited=2]="delimited",r[r.fixed32=5]="fixed32",r[r.unknown=99]="unknown";const a=4294967296,l=new TextDecoder("utf-8"),c=(0,s.A)("safari")||(0,s.A)("ios")?6:(0,s.A)("ff")?12:32;class u{constructor(t,e,i=0,r=(t?t.byteLength:0)){this._tag=0,this._dataType=n.unknown,this._init(t,e,i,r)}_init(t,e,i,n){this._data=t,this._dataView=e,this._pos=i,this._end=n}asUnsafe(){return this}clone(){return new u(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(t){this._pos=t}nextTag(t){for(;;){if(this._pos===this._end)return!1;const e=this._decodeVarint();if(this._tag=e>>3,this._dataType=7&e,!t||t===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const t=this._decodeVarint();return this._tag=t>>3,this._dataType=7&t,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let t=4294967295;if(t=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128)return t;if(t=(t|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128)return t;if(t=(t|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128)return t;if(t=(t|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128)return t;if(t=(t|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128)return t;throw new Error("Varint overflow")}getUInt64(){return this._decodeVarint()}getSInt32(){const t=this.getUInt32();return t>>>1^-(1&t)}getSInt64(){return this._decodeSVarint()}getBool(){const t=0!==this._data[this._pos];return this._skip(1),t}getEnum(){return this._decodeVarint()}getFixed64(){const t=this._dataView,e=this._pos,i=t.getUint32(e,!0)+t.getUint32(e+4,!0)*a;return this._skip(8),i}getSFixed64(){const t=this._dataView,e=this._pos,i=t.getUint32(e,!0)+t.getInt32(e+4,!0)*a;return this._skip(8),i}getDouble(){const t=this._dataView.getFloat64(this._pos,!0);return this._skip(8),t}getFixed32(){const t=this._dataView.getUint32(this._pos,!0);return this._skip(4),t}getSFixed32(){const t=this._dataView.getInt32(this._pos,!0);return this._skip(4),t}getFloat(){const t=this._dataView.getFloat32(this._pos,!0);return this._skip(4),t}getString(){const t=this._getLength(),e=this._pos,i=this._toString(this._data,e,e+t);return this._skip(t),i}getBytes(){const t=this._getLength(),e=this._pos,i=this._toBytes(this._data,e,e+t);return this._skip(t),i}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(t,e,i,n){const r=this.getMessage(),s=t(r,e,i,n);return r.release(),s}processMessage(t){const e=this.getMessage(),i=t(e);return e.release(),i}getMessage(){const t=this._getLength(),e=u.pool.acquire();return e._init(this._data,this._dataView,this._pos,this._pos+t),this._skip(t),e}release(){u.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case n.varint:this._decodeVarint();break;case n.fixed64:this._skip(8);break;case n.delimited:this._skip(this._getLength());break;case n.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(t){this._skip(t)}_skip(t){if(this._pos+t>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=t}_decodeVarint(){const t=this._data;let e=this._pos,i=0,n=0;if(this._end-e>=10)do{if(n=t[e++],i|=127&n,!(128&n))break;if(n=t[e++],i|=(127&n)<<7,!(128&n))break;if(n=t[e++],i|=(127&n)<<14,!(128&n))break;if(n=t[e++],i|=(127&n)<<21,!(128&n))break;if(n=t[e++],i+=268435456*(127&n),!(128&n))break;if(n=t[e++],i+=34359738368*(127&n),!(128&n))break;if(n=t[e++],i+=4398046511104*(127&n),!(128&n))break;if(n=t[e++],i+=562949953421312*(127&n),!(128&n))break;if(n=t[e++],i+=72057594037927940*(127&n),!(128&n))break;if(n=t[e++],i+=0x8000000000000000*(127&n),!(128&n))break;throw new Error("Varint too long!")}while(0);else{let r=1;for(;e!==this._end&&(n=t[e],128&n);)++e,i+=(127&n)*r,r*=128;if(e===this._end)throw new Error("Varint overrun!");++e,i+=n*r}return this._pos=e,i}_decodeSVarint(){const t=this._data;let e,i=0,n=0;const r=1&t[this._pos];if(n=t[this._pos++],i|=127&n,!(128&n))return r?-(i+1)/2:i/2;if(n=t[this._pos++],i|=(127&n)<<7,!(128&n))return r?-(i+1)/2:i/2;if(n=t[this._pos++],i|=(127&n)<<14,!(128&n))return r?-(i+1)/2:i/2;if(n=t[this._pos++],i|=(127&n)<<21,!(128&n))return r?-(i+1)/2:i/2;if(n=t[this._pos++],i+=268435456*(127&n),!(128&n))return r?-(i+1)/2:i/2;if(n=t[this._pos++],i+=34359738368*(127&n),!(128&n))return r?-(i+1)/2:i/2;if(n=t[this._pos++],i+=4398046511104*(127&n),!(128&n))return r?-(i+1)/2:i/2;if(e=BigInt(i),n=t[this._pos++],e+=0x2000000000000n*BigInt(127&n),!(128&n))return Number(r?-(e+1n)/2n:e/2n);if(n=t[this._pos++],e+=0x100000000000000n*BigInt(127&n),!(128&n))return Number(r?-(e+1n)/2n:e/2n);if(n=t[this._pos++],e+=0x8000000000000000n*BigInt(127&n),!(128&n))return Number(r?-(e+1n)/2n:e/2n);throw new Error("Varint too long!")}_getLength(){if(this._dataType!==n.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(t,e,i){if((i=Math.min(this._end,i))-e>c){const n=t.subarray(e,i);return l.decode(n)}let n="",r="";for(let s=e;s<i;++s){const e=t[s];128&e?r+="%"+e.toString(16):(n+=decodeURIComponent(r)+String.fromCharCode(e),r="")}return r.length&&(n+=decodeURIComponent(r)),n}_toBytes(t,e,i){return i=Math.min(this._end,i),new Uint8Array(t.buffer,e,i-e)}}u.pool=new o.A(u,void 0,(t=>{t._data=null,t._dataView=null}))},42042:function(t,e,i){i.d(e,{n:function(){return a}});var n=i(9688),r=i(22739),s=i(3569);function o(t){t=t.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$&]");let e="";const i=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const n of t.match(i)||[])switch(n){case"D":e+="d";break;case"DD":e+="dd";break;case"DDD":e+="o";break;case"d":e+="c";break;case"ddd":e+="ccc";break;case"dddd":e+="cccc";break;case"M":e+="L";break;case"MM":e+="LL";break;case"MMM":e+="LLL";break;case"MMMM":e+="LLLL";break;case"YY":e+="yy";break;case"Y":case"YYYY":e+="yyyy";break;case"Q":e+="q";break;case"X":case"x":e+=n;break;default:n.length>=2&&"["===n.slice(0,1)&&"]"===n.slice(-1)?e+=`'${n.slice(1,-1)}'`:e+=`'${n}'`}return e}class a{constructor(t,e,i){this._year=t,this._month=e,this._day=i,this.declaredRootClass="esri.core.sql.dateonly"}get month(){return this._month}get monthJS(){return this._month-1}get year(){return this._year}get day(){return this._day}get isValid(){return this.toDateTime("unknown").isValid}equals(t){return t instanceof a&&t.day===this.day&&t.month===this.month&&t.year===this.year}clone(){return new a(this._year,this._month,this._day)}toDateTime(t){return s.c9.fromObject({day:this.day,month:this.month,year:this.year},{zone:(0,n.mT)(t)})}toDateTimeLuxon(t){return s.c9.fromObject({day:this.day,month:this.month,year:this.year},{zone:(0,n.mT)(t)})}toString(){return`${this.year.toString().padStart(4,"0")}-${this.month.toString().padStart(2,"0")}-${this.day.toString().padStart(2,"0")}`}toFormat(t=null,e=!0){if(null===t||""===t)return this.toString();if(e&&(t=o(t)),!t)return"";const i=this.toDateTime("unknown");return n.lY.dateTimeToArcadeDate(i).toFormat(t,{locale:(0,r.JK)(),numberingSystem:"latn"})}toArcadeDate(){const t=this.toDateTime("unknown");return n.lY.dateTimeToArcadeDate(t)}toNumber(){return this.toDateTime("unknown").toMillis()}toJSDate(){return this.toDateTime("unknown").toJSDate()}toStorageFormat(){return this.toFormat("yyyy-LL-dd",!1)}toSQLValue(){return this.toFormat("yyyy-LL-dd",!1)}toSQLWithKeyword(){return"date '"+this.toFormat("yyyy-LL-dd",!1)+"'"}plus(t,e){return a.fromDateTime(this.toUTCDateTime().plus({[t]:e}))}toUTCDateTime(){return s.c9.utc(this.year,this.month,this.day,0,0,0,0)}difference(t,e){switch(e.toLowerCase()){case"days":case"day":case"d":return this.toUTCDateTime().diff(t.toUTCDateTime(),"days").days;case"months":case"month":return this.toUTCDateTime().diff(t.toUTCDateTime(),"months").months;case"minutes":case"minute":case"m":return"M"===e?this.toUTCDateTime().diff(t.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(t.toUTCDateTime(),"minutes").minutes;case"seconds":case"second":case"s":return this.toUTCDateTime().diff(t.toUTCDateTime(),"seconds").seconds;case"milliseconds":case"millisecond":case"ms":default:return this.toUTCDateTime().diff(t.toUTCDateTime(),"milliseconds").milliseconds;case"hours":case"hour":case"h":return this.toUTCDateTime().diff(t.toUTCDateTime(),"hours").hours;case"years":case"year":case"y":return this.toUTCDateTime().diff(t.toUTCDateTime(),"years").years}}static fromMilliseconds(t){const e=s.c9.fromMillis(t,{zone:s.mQ.utcInstance});return e.isValid?a.fromParts(e.year,e.month,e.day):null}static fromSeconds(t){const e=s.c9.fromSeconds(t,{zone:s.mQ.utcInstance});return e.isValid?a.fromParts(e.year,e.month,e.day):null}static fromReader(t){if(!t)return null;const e=t.split("-");return 3!==e.length?null:new a(parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10))}static fromParts(t,e,i){const n=new a(t,e,i);return!1===n.isValid?null:n}static fromDateJS(t){return a.fromParts(t.getFullYear(),t.getMonth()+1,t.getDay())}static fromDateTime(t){return a.fromParts(t.year,t.month,t.day)}static fromSqlTimeStampOffset(t){return this.fromDateTime(t.toDateTime())}static fromString(t,e=null){if(""===t)return null;if(null===t)return null;const i=[];if(e)(e=o(e))&&i.push(e);else if(null===e||""===e){const e=s.c9.fromISO(t,{setZone:!0});return e.isValid?a.fromParts(e.year,e.month,e.day):null}for(const n of i){const i=s.c9.fromFormat(t,e??n);if(i.isValid)return new a(i.year,i.month,i.day)}return null}static fromNow(t="system"){const e=s.c9.fromJSDate(new Date).setZone((0,n.mT)(t));return new a(e.year,e.month,e.day)}}},70891:function(t,e,i){i.d(e,{k:function(){return a}});var n=i(80749),r=i(22739),s=i(3569);function o(t){if(!t)return"";const e=/(a|A|hh?|HH?|mm?|ss?|SSS|S|.)/g;let i="";for(const n of t.match(e)||[])switch(n){case"SSS":case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":i+=n;break;case"A":case"a":i+="a";break;default:i+=`'${n}'`}return i}class a{constructor(t,e,i,n){this._hour=t,this._minute=e,this._second=i,this._millisecond=n,this.declaredRootClass="esri.core.sql.timeonly"}get hour(){return this._hour}get minute(){return this._minute}get second(){return this._second}get millisecond(){return this._millisecond}equals(t){return t instanceof a&&t.hour===this.hour&&t.minute===this.minute&&t.second===this.second&&t.millisecond===this.millisecond}clone(){return new a(this.hour,this.minute,this.second,this.millisecond)}isValid(){return(0,n.Fq)(this.hour)&&(0,n.Fq)(this.minute)&&(0,n.Fq)(this.second)&&(0,n.Fq)(this.millisecond)&&this.hour>=0&&this.hour<24&&this.minute>=0&&this.minute<60&&this.second>=0&&this.second<60&&this.millisecond>=0&&this.millisecond<1e3}toString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`+(this.millisecond>0?"."+this.millisecond.toString().padStart(3,"0"):"")}toSQLValue(){return this.toString()}toSQLWithKeyword(){return`time '${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}${this.millisecond>0?"."+this.millisecond.toString().padStart(3,"0"):""}'`}toStorageString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`}toFormat(t=null){return null===t||""===t?this.toString():(t=o(t))?s.c9.local(1970,1,1,this._hour,this._minute,this._second,this._millisecond).toFormat(t,{locale:(0,r.JK)(),numberingSystem:"latn"}):""}toNumber(){return this.millisecond+1e3*this.second+1e3*this.minute*60+60*this.hour*60*1e3}static fromParts(t,e,i,n){const r=new a(t,e,i,n);return r.isValid()?r:null}static fromReader(t){if(!t)return null;const e=t.split(":");return 3!==e.length?null:new a(parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10),0)}static fromMilliseconds(t){if(t>864e5||t<0)return null;const e=Math.floor(t/1e3%60),i=Math.floor(t/6e4%60),n=Math.floor(t/36e5%24),r=Math.floor(t%1e3);return new a(n,i,e,r)}static fromDateJS(t){return new a(t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds())}static fromDateTime(t){return new a(t.hour,t.minute,t.second,t.millisecond)}static fromSqlTimeStampOffset(t){return this.fromDateTime(t.toDateTime())}static fromString(t,e=null){if(""===t)return null;if(null===t)return null;const i=[];e?(e=o(e))&&i.push(e):null!==e&&""!==e||(i.push("HH:mm:ss"),i.push("HH:mm:ss.SSS"),i.push("hh:mm:ss a"),i.push("hh:mm:ss.SSS a"),i.push("HH:mm"),i.push("hh:mm a"),i.push("H:mm"),i.push("h:mm a"),i.push("H:mm:ss"),i.push("h:mm:ss a"),i.push("H:mm:ss.SSS"),i.push("h:mm:ss.SSS a"));for(const e of i){const i=s.c9.fromFormat(t,e);if(i.isValid)return new a(i.hour,i.minute,i.second,i.millisecond)}return null}plus(t,e){switch(t){case"days":case"years":case"months":return this.clone();case"hours":case"minutes":case"seconds":case"milliseconds":return a.fromDateTime(this.toUTCDateTime().plus({[t]:e}))}return null}toUTCDateTime(){return s.c9.utc(1970,1,1,this.hour,this.minute,this.second,this.millisecond)}difference(t,e){switch(e.toLowerCase()){case"days":case"day":case"d":return this.toUTCDateTime().diff(t.toUTCDateTime(),"days").days;case"months":case"month":return this.toUTCDateTime().diff(t.toUTCDateTime(),"months").months;case"minutes":case"minute":case"m":return"M"===e?this.toUTCDateTime().diff(t.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(t.toUTCDateTime(),"minutes").minutes;case"seconds":case"second":case"s":return this.toUTCDateTime().diff(t.toUTCDateTime(),"seconds").seconds;case"milliseconds":case"millisecond":case"ms":default:return this.toUTCDateTime().diff(t.toUTCDateTime(),"milliseconds").milliseconds;case"hours":case"hour":case"h":return this.toUTCDateTime().diff(t.toUTCDateTime(),"hours").hours;case"years":case"year":case"y":return this.toUTCDateTime().diff(t.toUTCDateTime(),"years").years}}}},33134:function(t,e,i){i.d(e,{z:function(){return a}});var n=i(21609),r=i(49077),s=i(74697),o=i(76613);class a{static fromOptimized(t,e,i=!1,n=!1,r=1){return(new l).initialize(t,e,i,n,r)}static fromJSON(t,e=!1,i=!1){const[n,r]=u(t);return(new h).initialize(n,r,e,i,1)}static fromOptimizedCIM(t,e,i=!1,n=!1,r=1){return(new d).initialize(t,e,i,n,r)}static fromJSONCIM(t,e=!1,i=!1,n=1){const[r,s]=u(t);return(new f).initialize(r,s,e,i,n)}static fromFeatureSetReader(t){const e=t.readGeometryForDisplay(),i=t.geometryType;return e&&i?this.fromOptimized(e,i):null}static fromFeatureSetReaderCIM(t){const e=t.readGeometryForDisplay(),i=t.geometryType;return e&&i?this.fromOptimizedCIM(e,i):null}static createEmptyOptimized(t,e=!1,i=!1,n=1){return(new l).initialize(new o.A,t,e,i,n)}static createEmptyJSON(t,e=!1,i=!1){return(new h).initialize([],t,e,i,1)}static createEmptyOptimizedCIM(t,e=!1,i=!1,n=1){return(new d).initialize(new o.A,t,e,i,n)}static createEmptyJSONCIM(t,e=!1,i=!1,n=1){return(new f).initialize([],t,e,i,n)}asJSON(){const t=(0,r.x)(this);return"esriGeometryEnvelope"===this.geometryType?{xmin:t[0][0][0],ymin:t[0][0][1],xmax:t[0][2][0],ymax:t[0][2][1]}:"esriGeometryMultipoint"===this.geometryType?{points:t.flat()}:"esriGeometryPoint"===this.geometryType?{x:t[0][0][0],y:t[0][0][1]}:"esriGeometryPolygon"===this.geometryType?{rings:t}:{paths:t}}getCurrentRingArea(){if(this.pathSize<3)return 0;let t,e,i=0;if(this.seekPathStart(),!this.nextPoint())return 0;t=this.x,e=this.y;const n=t,r=e;for(;this.nextPoint();)i+=(t-this.x)*(e+this.y),t=this.x,e=this.y;return i+=(t-n)*(e+r),-.5*i}invertY(){this.yFactor*=-1}}class l extends a{constructor(){super(...arguments),this._end=-1}initialize(t,e,i,n,r){return this.hasZ=i,this.hasM=n,this.geometryType=e,this._stride=2+Number(i)+Number(n),this._geometry=t,this._pathIndex=-1,this._pathOffset=0,this._pointOffset=-this._stride,this._end=-1,this.yFactor=r,this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(t){if(t>=0&&t<this.totalSize){if(this._pathIndex<t)for(;this._pathIndex<t&&this.nextPath(););else if(this._pathIndex>t)for(;this._pathIndex>t&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(t){const e=this._pathOffset+t*this._stride;return e>=0&&e<this._end&&(this._pointOffset=e,!0)}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){return!(this.pathIndex>=this.totalSize-1||(this._pathIndex>=0&&(this._pathOffset+=this._stride*this.pathSize),this._pathIndex++,this._pointOffset=this._pathOffset-this._stride,this._end=this._pointOffset+this._stride+this._stride*this.pathSize,0))}prevPath(){return!(this.pathIndex<=0||(this._pathIndex--,this._end=this._pathOffset,this._pathOffset-=this._stride*this.pathSize,this._pointOffset=this._pathOffset-this._stride,0))}pathLength(){const t=this._end,e=this._stride,i=this._geometry.coords;let n=0;for(let r=this._pathOffset+e;r<t;r+=e){const t=i[r-e],s=i[r-e+1],o=i[r]-t,a=i[r+1]-s;n+=Math.sqrt(o*o+a*a)}return n}startPath(){this._geometry.lengths.push(0)}pushPath(t){this.startPath(),this.pushPoints(t)}pushPoint(t){for(let e=0;e<this._stride;++e)this._geometry.coords.push(t[e]);this._geometry.lengths[this.totalSize-1]++}pushXY(t,e){this._geometry.coords.push(t,e),this._geometry.lengths[this.totalSize-1]++}pushPoints(t){for(const e of t)for(let t=0;t<this._stride;++t)this._geometry.coords.push(e[t]);this._geometry.lengths[this.totalSize-1]+=t.length}pushCursor(t){const e=t.asOptimized();this._geometry.coords.push(...e.coords),this._geometry.lengths.push(...e.lengths)}asOptimized(){const t=this._geometry.clone();if(1!==this.yFactor)for(let e=1;e<t.coords.length;e+=this._stride)t.coords[e]*=this.yFactor;return"esriGeometryPoint"===this.geometryType&&(t.lengths.length=0),t}isClosed(){const t=this._geometry.coords,e=this._pathOffset,i=this._end-this._stride;for(let n=0;n<this._stride;n++)if(t[e+n]!==t[i+n])return!1;return!0}clone(){return(new l).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce(((t,e)=>t+e))}get pathSize(){const{lengths:t}=this._geometry;return this._geometry.isPoint?1:this._pathIndex<0||this._pathIndex>t.length-1?0:t[this._pathIndex]}get totalSize(){return this._geometry.isPoint?1:this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(t){this._geometry.coords[this._pointOffset]=t}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(t){this._geometry.coords[this._pointOffset+1]=this.yFactor*t}get z(){return this._geometry.coords[this._pointOffset+2]}set z(t){this._geometry.coords[this._pointOffset+2]=t}get m(){const t=this.hasZ?3:2;return this._geometry.coords[this._pointOffset+t]}set m(t){this._geometry.coords[this._pointOffset+3]=t}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}}function c(t){const e=[t.x,t.y];return t.z&&e.push(t.z),t.m&&e.push(t.m),e}function u(t){return(0,s.Bi)(t)?[t.rings,"esriGeometryPolygon"]:(0,s.Rg)(t)?[t.paths,"esriGeometryPolyline"]:(0,s.U9)(t)?[[t.points],"esriGeometryMultipoint"]:(0,s.ZC)(t)?[[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]],"esriGeometryEnvelope"]:(0,s.fT)(t)?[[[c(t)]],"esriGeometryPoint"]:[[],"esriGeometryPolyline"]}class h extends a{initialize(t,e,i,n,r){return this._paths=t,this.geometryType=e,this.hasZ=i,this.hasM=n,this._pathIndex=this._pointIndex=-1,this.yFactor=r,this._mIndex=this.hasZ?3:2,this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(t){return this._pathIndex=t,this._pointIndex=-1,t>=0&&t<this.totalSize&&(this._currentPath=this._paths[t],!0)}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(t){return t>=0&&t<this._currentPath.length&&(this._pointIndex=t,this._currentPoint=this._currentPath[this._pointIndex],!0)}nextPoint(){return this._currentPoint=this._currentPath[++this._pointIndex],this._pointIndex<this._currentPath.length}prevPoint(){return this._currentPoint=this._currentPath[--this._pointIndex],this._pointIndex>=0}nextPath(){return this._pointIndex=-1,this._currentPath=this._paths[++this._pathIndex],this._pathIndex<this.totalSize}prevPath(){return this.pathIndex>0&&(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0)}pathLength(){const t=this._currentPath.length,e=this._currentPath;let i=0;for(let n=1;n<t;n++){const t=e[n-1],r=e[n],s=t[0],o=t[1],a=r[0]-s,l=r[1]-o;i+=Math.sqrt(a*a+l*l)}return i}startPath(){this._paths.push([])}pushPath(t){this._paths.push(t)}pushPoint(t){this._paths[this.totalSize-1].push(t)}pushXY(t,e){this._paths[this.totalSize-1].push([t,e])}pushPoints(t){this._paths[this.totalSize-1].push(...t)}pushCursor(t){const e=(0,r.x)(t);for(const t of e)this.pushPath(t)}asOptimized(){const t=new o.A;if("esriGeometryPoint"===this.geometryType)t.coords.push(...this._paths[0][0]),t.lengths.length=0;else for(const e of this._paths){for(const i of e)t.coords.push(i[0]),t.coords.push(i[1]*this.yFactor),this.hasZ&&t.coords.push(i[2]),this.hasM&&t.coords.push(i[this._mIndex]);t.lengths.push(e.length)}return t}isClosed(){const t=this._currentPath[0],e=this._currentPath[this._currentPath.length-1];for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}clone(){return(new h).initialize((0,n.o8)(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map((t=>t.length)).reduce(((t,e)=>t+e))}get pathSize(){return this._pathIndex<0||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(t){this._currentPoint[0]=t}get y(){return this.yFactor*this._currentPoint[1]}set y(t){this._currentPoint[1]=this.yFactor*t}get z(){return this._currentPoint[2]}set z(t){this._currentPoint[2]=t}get m(){return this._currentPoint[this._mIndex]}set m(t){this._currentPoint[this._mIndex]=t}get pathIndex(){return this._pathIndex}}class d extends l{initialize(t,e,i,n,r){return super.initialize(t,e,i,n,r),this._controlPoints||(this._controlPoints=this._controlPoints=new Array(this.totalSize).fill(void 0).map((t=>new Set))),this}startPath(){super.startPath(),this._controlPoints.push(new Set)}clone(){const t=(new d).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);return t._controlPoints=this._controlPoints,t}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(t){this._controlPoints[this.pathIndex].add(t)}getControlPointAt(t){return this._controlPoints[this.pathIndex].has(t)}}class f extends h{initialize(t,e,i,n,r){return super.initialize(t,e,i,n,r)}clone(){return(new f).initialize((0,n.o8)(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][4]=1}getControlPoint(){return 1===this._paths[this.pathIndex][this._pointIndex][4]}setControlPointAt(t){this._paths[this.pathIndex][t][4]=1}getControlPointAt(t){return 1===this._paths[this.pathIndex][t][4]}}},86029:function(t,e,i){i.d(e,{g:function(){return n}});const n={convertToGEGeometry:function(t,e){return null==e?null:t.convertJSONToGeometry(e)},exportPoint:function(t,e,i){const n=new r(t.getPointX(e),t.getPointY(e),i),s=t.hasZ(e),o=t.hasM(e);return s&&(n.z=t.getPointZ(e)),o&&(n.m=t.getPointM(e)),n},exportPolygon:function(t,e,i){return new s(t.exportPaths(e),i,t.hasZ(e),t.hasM(e))},exportPolyline:function(t,e,i){return new o(t.exportPaths(e),i,t.hasZ(e),t.hasM(e))},exportMultipoint:function(t,e,i){return new a(t.exportPoints(e),i,t.hasZ(e),t.hasM(e))},exportExtent:function(t,e,i){const n=t.hasZ(e),r=t.hasM(e),s=new l(t.getXMin(e),t.getYMin(e),t.getXMax(e),t.getYMax(e),i);if(n){const i=t.getZExtent(e);s.zmin=i.vmin,s.zmax=i.vmax}if(r){const i=t.getMExtent(e);s.mmin=i.vmin,s.mmax=i.vmax}return s}};class r{constructor(t,e,i){this.x=t,this.y=e,this.spatialReference=i,this.z=void 0,this.m=void 0}}class s{constructor(t,e,i,n){this.rings=t,this.spatialReference=e,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),n&&(this.hasM=n)}}class o{constructor(t,e,i,n){this.paths=t,this.spatialReference=e,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),n&&(this.hasM=n)}}class a{constructor(t,e,i,n){this.points=t,this.spatialReference=e,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),n&&(this.hasM=n)}}class l{constructor(t,e,i,n,r){this.xmin=t,this.ymin=e,this.xmax=i,this.ymax=n,this.spatialReference=r,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}},81484:function(t,e,i){i.d(e,{F:function(){return l},l:function(){return c}});var n=i(53216),r=i(58941);const s=128e3;let o=null,a=null;async function l(){return o||(o=async function(){const t=(0,r.A)("esri-csp-restrictions")?await i.e(5786).then(i.bind(i,70244)).then((t=>t.l)):await i.e(3740).then(i.bind(i,9502)).then((t=>t.l));a=await t.default({locateFile:t=>(0,n.s)(`esri/core/libs/libtess/${t}`)})}()),o}function c(t,e){const i=Math.max(t.length,s);return a.triangulate(t,e,i)}},30804:function(t,e,i){i.d(e,{d:function(){return c}});var n=i(87416),r=i(35068),s=i(72228),o=i(38441),a=i(96127);const l=222045e-19;function c(t){if(0===t.totalSize)return null;const e=(0,r.z8)(t);if(!e)return null;const i=4*(Math.abs(e[0])+Math.abs(e[2])+Math.abs(e[1])+Math.abs(e[3])+1)*l;let o=0,a=0;t.reset();for(let e=0;t.nextPath();e++){const i=t.getCurrentRingArea();i>a&&(a=i,o=e)}if(t.seekPath(o),0===t.pathSize)return null;t.seekPathStart();const c=(0,r.B$)(t);if(Math.abs(a)<=2*i*i)return[(c[0]+c[2])/2,(c[1]+c[3])/2];t.seekPathStart();const f=(0,s.w2)(t,(0,n.vt)());if(null===f)return null;if(t.totalPoints<4)return f;const _=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]],p=[NaN,NaN,NaN,NaN],m=[NaN,NaN,NaN,NaN];let g=!1,y=h(f,t,!0);0===y.distance&&(g=!0,_[0][0]=f[0],_[0][1]=f[1],y=h(f,t,!1)),p[0]=y.distance,m[0]=0;const v=[NaN,NaN];let w=!1,T=.25,M=-1,P=NaN;do{if(P=NaN,_[1]=d(t,x(c[0],c[2],T),0,e),isNaN(_[1][0])||isNaN(_[1][1])||(y=h(_[1],t,!1),P=y.distance),!isNaN(P)&&P>i&&u(_[1],t))w=!0,p[1]=P,m[1]=b(_[1],f);else if(!isNaN(P)&&P>M&&(M=P,v[0]=_[1][0],v[1]=_[1][1]),T-=.01,T<.1){if(!(M>=0))break;w=!0,p[1]=M,_[1][0]=v[0],_[1][1]=v[1],m[1]=b(_[1],f)}}while(!w);w=!1,T=.5,M=-1;let E=.01,A=1;do{if(P=NaN,_[2]=d(t,x(c[0],c[2],T),0,e),isNaN(_[2][0])||isNaN(_[2][1])||(y=h(_[2],t,!1),P=y.distance),!isNaN(P)&&P>i&&u(_[2],t))w=!0,p[2]=P,m[2]=b(_[2],f);else if(!isNaN(P)&&P>M)M=P,v[0]=_[2][0],v[1]=_[2][1];else if(P>M&&(M=P,v[0]=_[2][0],v[1]=_[2][1]),T=.5+E*A,E+=.01,A*=-1,T<.3||T>.7){if(!(M>=0))break;w=!0,p[2]=M,_[2][0]=v[0],_[2][1]=v[1],m[2]=b(_[2],f)}}while(!w);w=!1,T=.75,M=-1;do{if(P=NaN,_[3]=d(t,x(c[0],c[2],T),0,e),isNaN(_[3][0])||isNaN(_[3][1])||(y=h(_[3],t,!1),P=y.distance),!isNaN(P)&&P>i&&u(_[3],t))w=!0,p[3]=P,m[3]=b(_[3],f);else if(P>M&&(M=P,v[0]=_[3][0],v[1]=_[3][1]),T+=.01,T>.9){if(!(M>=0))break;w=!0,p[3]=M,_[3][0]=v[0],_[3][1]=v[1],m[3]=b(_[3],f)}}while(!w);const C=[0,1,2,3],I=g?0:1;let R;for(let t=I;t<4;t++)for(let t=I;t<3;t++){const e=m[t],i=m[t+1];S(e,i)>0&&(R=C[t],C[t]=C[t+1],C[t+1]=R,m[t]=i,m[t+1]=e)}let O=I,F=0,z=0;for(let t=I;t<4;t++){switch(t){case 0:z=2*p[C[t]];break;case 1:z=1.66666666*p[C[t]];break;case 2:z=1.33333333*p[C[t]];break;case 3:z=p[C[t]]}z>F&&(F=z,O=C[t])}return _[O]}function u(t,e){let i,n,r,s,o=0;for(e.reset();e.nextPath()&&e.nextPoint();)for(i=e.x,n=e.y;e.nextPoint();i=r,n=s)r=e.x,s=e.y,n>t[1]!=s>t[1]&&((r-i)*(t[1]-n)-(s-n)*(t[0]-i)>0?o++:o--);return 0!==o}function h(t,e,i){if(i&&u(t,e))return{coord:t,distance:0};let n=1/0,r=0,s=0,a=[0,0],l=[0,0];const c=[0,0];for(e.reset();e.nextPath()&&e.nextPoint();)if(!(e.pathSize<2))for(a[0]=e.x,a[1]=e.y;e.nextPoint();a=l){l=[e.x,e.y],(0,o.gR)(c,t,a,l);const i=b(t,c);i<n&&(n=i,r=c[0],s=c[1])}return{coord:[r,s],distance:Math.sqrt(n)}}function d(t,e,i,r){const s=[e,0];let o=1/0,l=1/0,c=!1,u=!1;const h=[[e,r[1]-1],[e,r[3]+1]],d=[0,0],_=[0,0],p=[0,0],m=[[0,0],[0,0]],g=(0,n.vt)();for(t.reset();t.nextPath()&&t.nextPoint();)if(!(t.pathSize<2))for(m[0][0]=t.x,m[0][1]=t.y;t.nextPoint();m[0][0]=m[1][0],m[0][1]=m[1][1]){if(m[1][0]=t.x,m[1][1]=t.y,null===f(g,m))continue;if(_[0]=h[0][0],_[1]=h[0][1],p[0]=h[1][0],p[1]=h[1][1],0===y(g,_,p))continue;if(!(0,a.Ql)(h[0],h[1],m[0],m[1],d))continue;const e=d[1];o>l?e<o&&(o=e,c=!0):e<l&&(l=e,u=!0)}return c&&u?s[1]=(o+l)/2:s[0]=s[1]=NaN,s}function f(t,e){if(e.length<2)return null;t||(t=(0,n.vt)());const[i,r]=e[0],[s,o]=e[1];return t[0]=Math.min(i,s),t[1]=Math.min(r,o),t[2]=Math.max(i,s),t[3]=Math.max(r,o),t}const _=1,p=4,m=3,g=12;function y(t,e,i){let n=v(e,t),r=v(i,t);const s=t[0],o=t[1],a=t[2],l=t[3];if(n&r)return 0;if(!(n|r))return 4;const c=(n?1:0)|(r?2:0);do{const c=i[0]-e[0],u=i[1]-e[1];if(c>u)n&m?(n&_?(e[1]+=u*(s-e[0])/c,e[0]=s):(e[1]+=u*(a-e[0])/c,e[0]=a),n=v(e,t)):r&m?(r&_?(i[1]+=u*(s-i[0])/c,i[0]=s):(i[1]+=u*(a-i[0])/c,i[0]=a),r=v(i,t)):n?(n&p?(e[0]+=c*(o-e[1])/u,e[1]=o):(e[0]+=c*(l-e[1])/u,e[1]=l),n=v(e,t)):(r&p?(i[0]+=c*(o-i[1])/u,i[1]=o):(i[0]+=c*(l-i[1])/u,i[1]=l),r=v(i,t));else if(n&g?(n&p?(e[0]+=c*(o-e[1])/u,e[1]=o):(e[0]+=c*(l-e[1])/u,e[1]=l),n=v(e,t)):r&g?(r&p?(i[0]+=c*(o-i[1])/u,i[1]=o):(i[0]+=c*(l-i[1])/u,i[1]=l),r=v(i,t)):n?(n&_?(e[1]+=u*(s-e[0])/c,e[0]=s):(e[1]+=u*(a-e[0])/c,e[0]=a),n=v(e,t)):(r&_?(i[1]+=u*(s-i[0])/c,i[0]=s):(i[1]+=u*(a-i[0])/c,i[0]=a),r=v(i,t)),n&r)return 0}while(n|r);return c}function v(t,e){return(t[0]<e[0]?1:0)|(t[0]>e[2]?1:0)<<1|(t[1]<e[1]?1:0)<<2|(t[1]>e[3]?1:0)<<3}function x(t,e,i){return t+(e-t)*i}function b(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])}function S(t,e){if(t<e)return-1;if(t>e)return 1;if(t===e)return 0;const i=isNaN(t),n=isNaN(e);return i<n?-1:i>n?1:0}},25150:function(t,e,i){i.d(e,{NH:function(){return o},ip:function(){return a},sU:function(){return c},vG:function(){return u}}),i(58941);var n=i(39819),r=i(60539),s=i(90683);function o(t){const e=l(t);return null!=e?e.toDataURL():""}async function a(t,e){const i=l(t);if(null==i)throw new n.A("imageToArrayBuffer","Unsupported image type");const o=function(t){if(!(t instanceof HTMLImageElement))return"image/png";const e=t.src;if((0,s.DB)(e)){const t=(0,s.r$)(e);return"image/jpeg"===t?.mediaType?t.mediaType:"image/png"}return/\.png$/i.test(e)?"image/png":/\.(jpg|jpeg)$/i.test(e)?"image/jpeg":"image/png"}(t),a=await new Promise((t=>i.toBlob(t,o)));if((0,r.Te)(e),!a)throw new n.A("imageToArrayBuffer","Failed to encode image");const c=await a.arrayBuffer();return(0,r.Te)(e),{data:c,type:o}}function l(t){if(t instanceof HTMLCanvasElement)return t;if(t instanceof HTMLVideoElement)return null;const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");return t instanceof HTMLImageElement?i.drawImage(t,0,0,t.width,t.height):t instanceof ImageData&&i.putImageData(t,0,0),e}function c(t){const e=[],i=new Uint8Array(t);for(let t=0;t<i.length;t++)e.push(String.fromCharCode(i[t]));return"data:application/octet-stream;base64,"+btoa(e.join(""))}function u(t){if(t.byteLength<8)return!1;const e=new Uint8Array(t);return 137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]}},80207:function(t,e,i){i.d(e,{b3:function(){return h},jZ:function(){return u}});var n=i(30905),r=i(87416),s=i(35068),o=i(38441),a=i(74697),l=i(65417),c=i(57652);function u(t){return d(t,!0)}function h(t){return d(t,!1)}function d(t,e){if(null==t)return null;const i=t.spatialReference,r=(0,c.Vp)(i),o=(0,n.Wj)(t)?t.toJSON():t;if(!r)return o;const u=(0,c.K8)(i)?102100:4326,h=l.j7[u].maxX,d=l.j7[u].minX;if((0,a.fT)(o))return _(o,h,d);if((0,a.U9)(o))return o.points=o.points.map((t=>_(t,h,d))),o;if((0,a.ZC)(o))return f(o,r);if((0,a.Bi)(o)||(0,a.Rg)(o)){const t=(0,s.Rg)(x,o),i={xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3]},n=(0,l.kd)(i.xmin,d)*(2*h),r=0===n?o:(0,l.kS)(o,n);return i.xmin+=n,i.xmax+=n,i.xmax>h?y(r,h,e):i.xmin<d?y(r,d,e):r}return o}function f(t,e){if(!e)return t;const i=function(t,e){const i=[],{ymin:n,ymax:r,xmin:s,xmax:o}=t,a=t.xmax-t.xmin,[l,c]=e.valid,{x:u,frameId:h}=p(t.xmin,e),{x:d,frameId:f}=p(t.xmax,e),_=u===d&&a>0;if(a>2*c){const t={xmin:s<o?u:d,ymin:n,xmax:c,ymax:r},e={xmin:l,ymin:n,xmax:s<o?d:u,ymax:r},a={xmin:0,ymin:n,xmax:c,ymax:r},_={xmin:l,ymin:n,xmax:0,ymax:r},p=[],g=[];m(t,a)&&p.push(h),m(t,_)&&g.push(h),m(e,a)&&p.push(f),m(e,_)&&g.push(f);for(let t=h+1;t<f;t++)p.push(t),g.push(t);i.push(new v(t,[h]),new v(e,[f]),new v(a,p),new v(_,g))}else u>d||_?i.push(new v({xmin:u,ymin:n,xmax:c,ymax:r},[h]),new v({xmin:l,ymin:n,xmax:d,ymax:r},[f])):i.push(new v({xmin:u,ymin:n,xmax:d,ymax:r},[h]));return i}(t,e).map((t=>t.extent));return i.length<2?i[0]||t:i.length>2?(t.xmin=e.valid[0],t.xmax=e.valid[1],t):{rings:i.map((t=>[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]))}}function _(t,e,i){if(Array.isArray(t)){const n=t[0];if(n>e){const i=(0,l.kd)(n,e);t[0]=n+i*(-2*e)}else if(n<i){const e=(0,l.kd)(n,i);t[0]=n+e*(-2*i)}}else{const n=t.x;if(n>e){const i=(0,l.kd)(n,e);t.x+=i*(-2*e)}else if(n<i){const e=(0,l.kd)(n,i);t.x+=e*(-2*i)}}return t}function p(t,e){const[i,n]=e.valid,r=2*n;let s,o=0;return t>n?(s=Math.ceil(Math.abs(t-n)/r),t-=s*r,o=s):t<i&&(s=Math.ceil(Math.abs(t-i)/r),t+=s*r,o=-s),{x:t,frameId:o}}function m(t,e){const{xmin:i,ymin:n,xmax:r,ymax:s}=e;return g(t,i,n)&&g(t,i,s)&&g(t,r,s)&&g(t,r,n)}function g(t,e,i){return e>=t.xmin&&e<=t.xmax&&i>=t.ymin&&i<=t.ymax}function y(t,e,i=!0){const n=!(0,a.Rg)(t);if(n&&(0,o.m3)(t),i)return(new b).cut(t,e);const r=n?t.rings:t.paths,s=n?4:2,l=r.length,c=-2*e;for(let t=0;t<l;t++){const e=r[t];if(e&&e.length>=s){const t=[];for(const i of e)t.push([i[0]+c,i[1]]);r.push(t)}}return n?t.rings=r:t.paths=r,t}class v{constructor(t,e){this.extent=t,this.frameIds=e}}const x=(0,r.vt)();class b{constructor(){this._linesIn=[],this._linesOut=[]}cut(t,e){let i;if(this._xCut=e,t.rings)this._closed=!0,i=t.rings,this._minPts=4;else{if(!t.paths)return null;this._closed=!1,i=t.paths,this._minPts=2}for(const t of i){if(!t||t.length<this._minPts)continue;let e=!0;for(const i of t)e?(this.moveTo(i),e=!1):this.lineTo(i);this._closed&&this.close()}this._pushLineIn(),this._pushLineOut(),i=[];for(const t of this._linesIn)t&&t.length>=this._minPts&&i.push(t);const n=-2*this._xCut;for(const t of this._linesOut)if(t&&t.length>=this._minPts){for(const e of t)e[0]+=n;i.push(t)}return this._closed?t.rings=i:t.paths=i,t}moveTo(t){this._pushLineIn(),this._pushLineOut(),this._prevSide=this._side(t[0]),this._moveTo(t[0],t[1],this._prevSide),this._prevPt=t,this._firstPt=t}lineTo(t){const e=this._side(t[0]);if(e*this._prevSide==-1){const i=this._intersect(this._prevPt,t);this._lineTo(this._xCut,i,0),this._prevSide=0,this._lineTo(t[0],t[1],e)}else this._lineTo(t[0],t[1],e);this._prevSide=e,this._prevPt=t}close(){const t=this._firstPt,e=this._prevPt;t[0]===e[0]&&t[1]===e[1]||this.lineTo(t),this._checkClosingPt(this._lineIn),this._checkClosingPt(this._lineOut)}_moveTo(t,e,i){this._closed?(this._lineIn.push([i<=0?t:this._xCut,e]),this._lineOut.push([i>=0?t:this._xCut,e])):(i<=0&&this._lineIn.push([t,e]),i>=0&&this._lineOut.push([t,e]))}_lineTo(t,e,i){this._closed?(S(this._lineIn,i<=0?t:this._xCut,e),S(this._lineOut,i>=0?t:this._xCut,e)):i<0?(0===this._prevSide&&this._pushLineOut(),this._lineIn.push([t,e])):i>0?(0===this._prevSide&&this._pushLineIn(),this._lineOut.push([t,e])):this._prevSide<0?(this._lineIn.push([t,e]),this._lineOut.push([t,e])):this._prevSide>0&&(this._lineOut.push([t,e]),this._lineIn.push([t,e]))}_checkClosingPt(t){const e=t.length;e>3&&t[0][0]===this._xCut&&t[e-2][0]===this._xCut&&t[1][0]===this._xCut&&(t[0][1]=t[e-2][1],t.pop())}_side(t){return t<this._xCut?-1:t>this._xCut?1:0}_intersect(t,e){const i=(this._xCut-t[0])/(e[0]-t[0]);return t[1]+i*(e[1]-t[1])}_pushLineIn(){this._lineIn&&this._lineIn.length>=this._minPts&&this._linesIn.push(this._lineIn),this._lineIn=[]}_pushLineOut(){this._lineOut&&this._lineOut.length>=this._minPts&&this._linesOut.push(this._lineOut),this._lineOut=[]}}function S(t,e,i){const n=t.length;n>1&&t[n-1][0]===e&&t[n-2][0]===e?t[n-1][1]=i:t.push([e,i])}},36729:function(t,e,i){i.d(e,{$B:function(){return d}});var n=i(53804),r=i(83525),s=i(58941),o=i(21609),a=i(40633),l=i(23502),c=i(65953),u=i(70994),h=i(25128);let d=class extends r.A{constructor(t){super(t),this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this.duration=(0,s.A)("mapview-transitions-duration"),this.effects=[]}set effect(t){if(this._get("effect")!==(t=t||"")){this._set("effect",t);try{this._transitionTo(f(t))}catch(e){this._transitionTo([]),a.A.getLogger(this).warn("Invalid Effect",{effect:t,error:e})}}}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(t){this._updateForScale(t)}get transitioning(){return null!==this._to}canTransitionTo(t){try{return this.scale>0&&_(this._current,f(t),this.scale)}catch{return!1}}transitionStep(t,e){this._applyTimeTransition(t),this._updateForScale(e)}endTransitions(){this._applyTimeTransition(this.duration)}_transitionTo(t){this.scale>0&&_(this._current,t,this.scale)?(this._final=t,this._to=(0,o.o8)(t),function(t,e,i){const n=t.length>e.length?t:e,r=t.length>e.length?e:t,s=r[r.length-1],o=s?.scale??i,a=s?.effects??[];for(let t=r.length;t<n.length;t++)r.push({scale:o,effects:[...a]});for(let t=0;t<n.length;t++)r[t].scale=-1===r[t].scale?i:r[t].scale,n[t].scale=-1===n[t].scale?i:n[t].scale,(0,h.O9)(r[t].effects,n[t].effects)}(this._current,this._to,this.scale),this._from=(0,o.o8)(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=t),this._set("effects",this._current[0]?(0,o.o8)(this._current[0].effects):[])}_applyTimeTransition(t){if(!(this._to&&this._from&&this._current&&this._final))return;this._time+=t;const e=Math.min(1,this._time/this.duration);for(let t=0;t<this._current.length;t++){const i=this._current[t],n=this._from[t],r=this._to[t];i.scale=p(n.scale,r.scale,e);for(let t=0;t<i.effects.length;t++){const s=i.effects[t],o=n.effects[t],a=r.effects[t];s.interpolate(o,a,e)}}1===e&&(this._current=this._final,this._set("effects",this._current[0]?(0,o.o8)(this._current[0].effects):[]),this._from=this._to=this._final=null)}_updateForScale(t){if(this._set("scale",t),0===this._current.length)return;const e=this._current,i=this._current.length-1;let n,r,s=1;if(1===e.length||t>=e[0].scale)r=n=e[0].effects;else if(t<=e[i].scale)r=n=e[i].effects;else for(let o=0;o<i;o++){const i=e[o],a=e[o+1];if(i.scale>=t&&a.scale<=t){s=(t-i.scale)/(a.scale-i.scale),n=i.effects,r=a.effects;break}}for(let t=0;t<this.effects.length;t++)this.effects[t].interpolate(n[t],r[t],s)}};function f(t){const e=(0,u.q)(t)||[];return function(t){const e=t[0];return!!e&&"type"in e}(e)?[{scale:-1,effects:e}]:e}function _(t,e,i){return!t[0]?.effects||!e[0]?.effects||!((-1===t[0]?.scale||-1===e[0]?.scale)&&(t.length>1||e.length>1)&&i<=0)&&(0,h.mj)(t[0].effects,e[0].effects)}function p(t,e,i){return t+(e-t)*i}(0,n._)([(0,l.MZ)()],d.prototype,"_to",void 0),(0,n._)([(0,l.MZ)()],d.prototype,"duration",void 0),(0,n._)([(0,l.MZ)({value:""})],d.prototype,"effect",null),(0,n._)([(0,l.MZ)({readOnly:!0})],d.prototype,"effects",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],d.prototype,"hasEffects",null),(0,n._)([(0,l.MZ)({value:0})],d.prototype,"scale",null),(0,n._)([(0,l.MZ)({readOnly:!0})],d.prototype,"transitioning",null),d=(0,n._)([(0,c.$)("esri.layers.effects.EffectView")],d)},65215:function(t,e,i){i.d(e,{N3:function(){return s},Om:function(){return r}});var n=i(76613);class r{constructor(t=null,e={},i,n){this.geometry=t,this.attributes=e,this.centroid=i,this.objectId=n,this.displayId=0,this.geohashX=0,this.geohashY=0}static fromJSON(t,e){const i=t.geometry?n.A.fromJSON(t.geometry):null,s=t.centroid?n.A.fromJSON(t.centroid):null,o=t.attributes[e];return new r(i,t.attributes,s,o)}weakClone(){const t=new r(this.geometry,this.attributes,this.centroid,this.objectId);return t.displayId=this.displayId,t.geohashX=this.geohashX,t.geohashY=this.geohashY,t}clone(){const t=this.geometry?.clone(),e=new r(t,{...this.attributes},this.centroid?.clone(),this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}}function s(t){return!!t.geometry?.coords?.length}},72887:function(t,e,i){i.d(e,{A:function(){return n}});class n{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const t=new n;return t.objectIdFieldName=this.objectIdFieldName,t.globalIdFieldName=this.globalIdFieldName,t.geohashFieldName=this.geohashFieldName,t.geometryProperties=this.geometryProperties,t.geometryType=this.geometryType,t.spatialReference=this.spatialReference,t.hasZ=this.hasZ,t.hasM=this.hasM,t.features=this.features,t.fields=this.fields,t.transform=this.transform,t.exceededTransferLimit=this.exceededTransferLimit,t.uniqueIdField=this.uniqueIdField,t.queryGeometry=this.queryGeometry,t.queryGeometryType=this.queryGeometryType,t}}},76613:function(t,e,i){i.d(e,{A:function(){return n}});class n{constructor(t=[],e=[],i=!1){this.lengths=t??[],this.coords=e??[],this.hasIndeterminateRingOrder=i}static fromJSON(t){return new n(t.lengths,t.coords,t.hasIndeterminateRingOrder)}static fromRect(t){const[e,i,r,s]=t,o=r-e,a=s-i;return new n([5],[e,i,o,0,0,a,-o,0,0,-a])}get isPoint(){return 0===this.lengths.length}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce(((t,e)=>t+e))}forEachVertex(t){let e=0;this.lengths.length||t(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const n=this.lengths[i];for(let i=0;i<n;i++)t(this.coords[2*(i+e)],this.coords[2*(i+e)+1]);e+=n}}deltaDecode(){const t=this.clone(),{coords:e,lengths:i}=t;let n=0;for(const t of i){for(let i=1;i<t;i++)e[2*(n+i)]+=e[2*(n+i)-2],e[2*(n+i)+1]+=e[2*(n+i)-1];n+=t}return t}clone(t){if(0===this.lengths.length)return new n([],[this.coords[0],this.coords[1]]);const e=2*(0===this.lengths.length?1:this.lengths.reduce(((t,e)=>t+e))),i=this.coords.slice(0,e);return t?(t.set(i),new n(this.lengths,t,this.hasIndeterminateRingOrder)):new n(Array.from(this.lengths),Array.from(i),this.hasIndeterminateRingOrder)}}},40302:function(t,e,i){function n(t,e){return t?e?4:3:e?3:2}function r(t,e,i,r){if(!e?.lengths.length)return null;t.lengths.length&&(t.lengths.length=0),t.coords.length&&(t.coords.length=0);const a=t.coords,l=[],c=i?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:u,coords:h}=e,d=n(i,r);let f=0;for(const t of u){const e=s(c,h,f,t,i,r);e&&l.push(e),f+=t*d}if(l.sort(((t,e)=>{let n=t[2]-e[2];return 0===n&&i&&(n=t[4]-e[4]),n})),l.length){let t=6*l[0][2];a[0]=l[0][0]/t,a[1]=l[0][1]/t,i&&(t=6*l[0][4],a[2]=0!==t?l[0][3]/t:0),(a[0]<c[0]||a[0]>c[1]||a[1]<c[2]||a[1]>c[3]||i&&(a[2]<c[4]||a[2]>c[5]))&&(a.length=0)}if(!a.length){const t=e.lengths[0]?o(h,0,u[0],i,r):null;if(!t)return null;a[0]=t[0],a[1]=t[1],i&&t.length>2&&(a[2]=t[2])}return t}function s(t,e,i,r,s,o){const a=n(s,o);let l=i,c=i+a,u=0,h=0,d=0,f=0,_=0;for(let i=0,n=r-1;i<n;i++,l+=a,c+=a){const i=e[l],n=e[l+1],r=e[l+2],o=e[c],a=e[c+1],p=e[c+2];let m=i*a-o*n;f+=m,u+=(i+o)*m,h+=(n+a)*m,s&&(m=i*p-o*r,d+=(r+p)*m,_+=m),i<t[0]&&(t[0]=i),i>t[1]&&(t[1]=i),n<t[2]&&(t[2]=n),n>t[3]&&(t[3]=n),s&&(r<t[4]&&(t[4]=r),r>t[5]&&(t[5]=r))}if(f>0&&(f*=-1),_>0&&(_*=-1),!f)return null;const p=[u,h,.5*f];return s&&(p[3]=d,p[4]=.5*_),p}function o(t,e,i,r,s){const o=n(r,s);let h=e,d=e+o,f=0,_=0,p=0,m=0;for(let e=0,n=i-1;e<n;e++,h+=o,d+=o){const e=t[h],i=t[h+1],n=t[h+2],s=t[d],o=t[d+1],g=t[d+2],y=r?l(e,i,n,s,o,g):a(e,i,s,o);if(y)if(f+=y,r){const t=u(e,i,n,s,o,g);_+=y*t[0],p+=y*t[1],m+=y*t[2]}else{const t=c(e,i,s,o);_+=y*t[0],p+=y*t[1]}}return f>0?r?[_/f,p/f,m/f]:[_/f,p/f]:i>0?r?[t[e],t[e+1],t[e+2]]:[t[e],t[e+1]]:null}function a(t,e,i,n){const r=i-t,s=n-e;return Math.sqrt(r*r+s*s)}function l(t,e,i,n,r,s){const o=n-t,a=r-e,l=s-i;return Math.sqrt(o*o+a*a+l*l)}function c(t,e,i,n){return[t+.5*(i-t),e+.5*(n-e)]}function u(t,e,i,n,r,s){return[t+.5*(n-t),e+.5*(r-e),i+.5*(s-i)]}i.d(e,{Q:function(){return r}})},78956:function(t,e,i){i.d(e,{LQ:function(){return c},ag:function(){return h},pL:function(){return u}});var n=i(58081),r=i(76613);const s=new r.A,o=new r.A,a=new r.A,l={esriGeometryPoint:n.DF,esriGeometryPolyline:n.BW,esriGeometryPolygon:n.z5,esriGeometryMultipoint:n.qK};function c(t,e,i,r=t.hasZ,s=t.hasM){if(null==e)return null;const o=t.hasZ&&r,l=t.hasM&&s;if(i){const c=(0,n.Nl)(a,e,t.hasZ,t.hasM,"esriGeometryPoint",i,r,s);return(0,n.DF)(c,o,l)}return(0,n.DF)(e,o,l)}function u(t,e,i,r,c,u,h=e,d=i){const f=e&&h,_=i&&d,p=null!=r?"coords"in r?r:r.geometry:null;if(null==p)return null;if(c){let r=(0,n.kz)(o,p,e,i,t,c,h,d);return u&&(r=(0,n.Nl)(a,r,f,_,t,u)),l[t]?.(r,f,_)??null}if(u){const r=(0,n.Nl)(a,p,e,i,t,u,h,d);return l[t]?.(r,f,_)??null}return(0,n.Q4)(s,p,e,i,h,d),l[t]?.(s,f,_)??null}function h(t){return t&&d in t?JSON.parse(JSON.stringify(t,f)):t}const d="_geVersion",f=(t,e)=>t!==d?e:void 0},74841:function(t,e,i){i.d(e,{Cv:function(){return m},Nk:function(){return f},lK:function(){return y}});var n=i(50659),r=i(60539),s=i(46157),o=i(86029),a=i(57652),l=i(1644);const c=[0,0];function u(t,e){if(!e)return null;if("x"in e){const i={x:0,y:0};return[i.x,i.y]=t(e.x,e.y,c),null!=e.z&&(i.z=e.z),null!=e.m&&(i.m=e.m),i}if("xmin"in e){const i={xmin:0,ymin:0,xmax:0,ymax:0};return[i.xmin,i.ymin]=t(e.xmin,e.ymin,c),[i.xmax,i.ymax]=t(e.xmax,e.ymax,c),e.hasZ&&(i.zmin=e.zmin,i.zmax=e.zmax,i.hasZ=!0),e.hasM&&(i.mmin=e.mmin,i.mmax=e.mmax,i.hasM=!0),i}return"rings"in e?{rings:h(e.rings,t),hasM:e.hasM,hasZ:e.hasZ}:"paths"in e?{paths:h(e.paths,t),hasM:e.hasM,hasZ:e.hasZ}:"points"in e?{points:d(e.points,t),hasM:e.hasM,hasZ:e.hasZ}:null}function h(t,e){const i=[];for(const n of t)i.push(d(n,e));return i}function d(t,e){const i=[];for(const n of t){const t=e(n[0],n[1],[0,0]);i.push(t),n.length>2&&t.push(n[2]),n.length>3&&t.push(n[3])}return i}async function f(t,e){if(!t||!e)return;const i=Array.isArray(t)?t.map((t=>null!=t.geometry?t.geometry.spatialReference:null)).filter(n.Ru):[t];await(0,s.initializeProjection)(i.map((t=>({source:t,dest:e}))))}const _=u.bind(null,l.je),p=u.bind(null,l.tD);function m(t,e,i,n){if(!t)return t;if(i||(i=e,e=t.spatialReference),!(0,a.fn)(e)||!(0,a.fn)(i)||(0,a.aI)(e,i))return t;if((0,l.y7)(e,i)){const e=(0,a.K8)(i)?_(t):p(t);return e.spatialReference=i,e}return(0,s.projectMany)(o.g,[t],e,i,null,n)[0]}const g=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(t,e,i,n){if(!t?.length||!e||!i||(0,a.aI)(e,i))return t;const s={geometries:t,inSpatialReference:e,outSpatialReference:i,geographicTransformation:n,resolve:(0,r.Tw)()};return this._jobs.push(s),this._timer??=setTimeout(this._process,10),s.resolve.promise}_process(){this._timer=null;const t=this._jobs.shift();if(!t)return;const{geometries:e,inSpatialReference:i,outSpatialReference:n,resolve:r,geographicTransformation:c}=t;(0,l.y7)(i,n)?(0,a.K8)(n)?r(e.map(_)):r(e.map(p)):r((0,s.projectMany)(o.g,e,i,n,c,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};function y(t,e,i,n){return g.push(t,e,i,n)}},20932:function(t,e,i){i.d(e,{GC:function(){return f},T2:function(){return _},v8:function(){return d}});var n=i(73037),r=i(62938),s=i(46157),o=i(38503),a=i(74697),l=i(65298),c=i(57652),u=i(74841);const h=new n.J({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),d=Object.freeze({});async function f(t,e,i){const{outFields:n,orderByFields:r,groupByFieldsForStatistics:s,outStatistics:o}=t;if(n)for(let t=0;t<n.length;t++)n[t]=n[t].trim();if(r)for(let t=0;t<r.length;t++)r[t]=r[t].trim();if(s)for(let t=0;t<s.length;t++)s[t]=s[t].trim();if(o)for(let t=0;t<o.length;t++)o[t].onStatisticField&&(o[t].onStatisticField=o[t].onStatisticField.trim());return t.geometry&&!t.outSR&&(t.outSR=t.geometry.spatialReference),_(t,e,i)}async function _(t,e,n){if(!t)return null;let{where:s}=t;if(t.where=s=s?.trim(),(!s||/^1 *= *1$/.test(s)||e&&e===s)&&(t.where=null),!t.geometry)return t;let f=await async function(t){const{distance:e,units:n}=t,s=t.geometry;if(null==e||"vertexAttributes"in s)return s;const o=s.spatialReference,a=n?h.fromJSON(n):(0,r.Ij)(o),l=o&&((0,c.EA)(o)||(0,c.K8)(o))?s:await(0,u.Nk)(o,c.KK).then((()=>(0,u.Cv)(s,c.KK)));return(await async function(){return(await i.e(4696).then(i.bind(i,28356))).geodesicBuffer}())(l.spatialReference,l,e,a)}(t);if(t.distance=0,t.units=null,"esriSpatialRelEnvelopeIntersects"===t.spatialRel){const{spatialReference:e}=t.geometry;f=(0,o.HA)(f),f.spatialReference=e}if(f){await(0,u.Nk)(f.spatialReference,n),f=function(t,e){const i=t.spatialReference;return p(t,e)&&(0,a.ZC)(t)?{spatialReference:i,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}:t}(f,n);const e=(await(0,l.el)((0,a.rS)(f)))[0];if(null==e)throw d;const i="quantizationParameters"in t&&t.quantizationParameters?.tolerance||"maxAllowableOffset"in t&&t.maxAllowableOffset||0,r=i&&p(f,n)?{densificationStep:8*i}:void 0,s=e.toJSON(),o=(0,u.Cv)(s,s.spatialReference,n,r);if(!o)throw d;o.spatialReference=n,t.geometry=o}return t}function p(t,e){if(!t)return!1;const i=t.spatialReference;return((0,a.ZC)(t)||(0,a.Bi)(t)||(0,a.Rg)(t))&&!(0,c.aI)(i,e)&&!(0,s.canProjectWithoutEngine)(i,e)}},62512:function(t,e,i){i.d(e,{tC:function(){return b},c0:function(){return x},xt:function(){return v}});var n=i(39819),r=i(61273),s=i(96127),o=i(74697),a=i(57652);function l(t,e){return t?e?4:3:e?3:2}function c(t,e,i,n,r,s){const o=l(r,s),{coords:a,lengths:c}=n;if(!c)return!1;for(let n=0,r=0;n<c.length;n++,r+=o)if(!u(t,e,i,a[r],a[r+1]))return!1;return!0}function u(t,e,i,n,r){if(!t)return!1;const s=l(e,i),{coords:o,lengths:a}=t;let c=!1,u=0;for(const t of a)c=h(c,o,s,u,t,n,r),u+=t*s;return c}function h(t,e,i,n,r,s,o){let a=t,l=n;for(let t=n,c=n+r*i;t<c;t+=i){l=t+i,l===c&&(l=n);const r=e[t],u=e[t+1],h=e[l],d=e[l+1];(u<o&&d>=o||d<o&&u>=o)&&r+(o-u)/(d-u)*(h-r)<s&&(a=!a)}return a}var d=i(58081),f=i(76613),_=i(78956),p=i(74841);const m="unsupported-query",g={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},y={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};function v(t,e,n,a,l){if((0,o.Bi)(e)&&"esriGeometryPoint"===n&&("esriSpatialRelIntersects"===t||"esriSpatialRelContains"===t)){const t=(0,d.Ye)(new f.A,e,!1,!1);return Promise.resolve((e=>function(t,e,i,n){return u(t,!1,!1,n.coords[0],n.coords[1])}(t,0,0,e)))}if((0,o.Bi)(e)&&"esriGeometryMultipoint"===n){const i=(0,d.Ye)(new f.A,e,!1,!1);if("esriSpatialRelContains"===t)return Promise.resolve((t=>c(i,!1,!1,t,a,l)))}if((0,o.ZC)(e)&&"esriGeometryPoint"===n&&("esriSpatialRelIntersects"===t||"esriSpatialRelContains"===t))return Promise.resolve((t=>(0,r.qz)(e,(0,_.pL)(n,a,l,t))));if((0,o.ZC)(e)&&"esriGeometryMultipoint"===n&&"esriSpatialRelContains"===t)return Promise.resolve((t=>(0,r.rL)(e,(0,_.pL)(n,a,l,t))));if((0,o.ZC)(e)&&"esriSpatialRelIntersects"===t){const t="mesh"===(h=n)?s.xB:(0,s.xK)(h);return Promise.resolve((i=>t(e,(0,_.pL)(n,a,l,i))))}var h;return i.e(4696).then(i.bind(i,28356)).then((i=>{const r=i[g[t]].bind(null,e.spatialReference,e);return t=>r((0,_.pL)(n,a,l,t))}))}async function x(t,e,i){const{spatialRel:r,geometry:s}=t;if(s){if(!function(t){return null!=t&&!0===y.spatialRelationship[t]}(r))throw new n.A(m,"Unsupported query spatial relationship",{query:t});if((0,a.fn)(s.spatialReference)&&(0,a.fn)(i)){if(!function(t){return null!=t&&!0===y.queryGeometry[(0,o.$B)(t)]}(s))throw new n.A(m,"Unsupported query geometry type",{query:t});if(!function(t){return null!=t&&!0===y.layerGeometry[t]}(e))throw new n.A(m,"Unsupported layer geometry type",{query:t});if(t.outSR)return(0,p.Nk)(t.geometry?.spatialReference,t.outSR)}}}function b(t){if((0,o.ZC)(t))return!0;if((0,o.Bi)(t)){for(const e of t.rings){if(5!==e.length)return!1;if(e[0][0]!==e[1][0]||e[0][0]!==e[4][0]||e[2][0]!==e[3][0]||e[0][1]!==e[3][1]||e[0][1]!==e[4][1]||e[1][1]!==e[2][1])return!1}return!0}return!1}},20973:function(t,e,i){async function n(t,e){if(!t)return null;const i=e.featureAdapter,{startTimeField:n,endTimeField:r}=t;let s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;if(n&&r)await e.forEach((t=>{const e=i.getAttribute(t,n),a=i.getAttribute(t,r);null==e||isNaN(e)||(s=Math.min(s,e)),null==a||isNaN(a)||(o=Math.max(o,a))}));else{const t=n||r;await e.forEach((e=>{const n=i.getAttribute(e,t);null==n||isNaN(n)||(s=Math.min(s,n),o=Math.max(o,n))}))}return{start:s,end:o}}function r(t,e,i){if(!e||!t)return null;const{startTimeField:n,endTimeField:r}=t;if(!n&&!r)return null;const{start:s,end:o}=e;if(null===s&&null===o)return null;if(void 0===s&&void 0===o)return()=>!1;const a=i.getAttributeAsTimestamp?.bind(i)??i.getAttribute.bind(i);return n&&r?function(t,e,i,n,r){return null!=n&&null!=r?s=>{const o=t(s,e),a=t(s,i);return(null==o||o<=r)&&(null==a||a>=n)}:null!=n?e=>{const r=t(e,i);return null==r||r>=n}:null!=r?i=>{const n=t(i,e);return null==n||n<=r}:void 0}(a,n,r,s,o):function(t,e,i,n){return null!=i&&null!=n&&i===n?n=>t(n,e)===i:null!=i&&null!=n?r=>{const s=t(r,e);return null!=s&&s>=i&&s<=n}:null!=i?n=>{const r=t(n,e);return null!=r&&r>=i}:null!=n?i=>{const r=t(i,e);return null!=r&&r<=n}:void 0}(a,n||r,s,o)}i.d(e,{I:function(){return r},W:function(){return n}})},58081:function(t,e,i){i.d(e,{B2:function(){return b},BW:function(){return L},Ch:function(){return rt},DF:function(){return w},Di:function(){return Y},E2:function(){return H},IE:function(){return x},Nl:function(){return J},Q4:function(){return st},Rk:function(){return at},Ux:function(){return Z},Ye:function(){return k},ZF:function(){return $},eU:function(){return V},eY:function(){return K},jH:function(){return Q},jQ:function(){return nt},kz:function(){return tt},oN:function(){return W},q3:function(){return j},qK:function(){return z},qN:function(){return F},z5:function(){return B},zv:function(){return q}});var n=i(39819),r=i(40633),s=i(95929),o=i(24761),a=i(87416),l=i(74697),c=i(65215),u=i(72887),h=i(76613);function d(t,e){return t?e?4:3:e?3:2}const f=()=>r.A.getLogger("esri.layers.graphics.featureConversionUtils"),_={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},p=(t,e,i,n,r,s)=>{t[i]=r,t[i+1]=s},m=(t,e,i,n,r,s)=>{t[i]=r,t[i+1]=s,t[i+2]=e[n+2]},g=(t,e,i,n,r,s)=>{t[i]=r,t[i+1]=s,t[i+2]=e[n+3]},y=(t,e,i,n,r,s)=>{t[i]=r,t[i+1]=s,t[i+2]=e[n+2],t[i+3]=e[n+3]};function v(t,e,i,n){if(t){if(i)return e&&n?y:m;if(e&&n)return g}else if(e&&n)return m;return p}function x({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function b({scale:t,translate:e},i){return Math.round((e[1]-i)/t[1])}function S({scale:t,translate:e},i,n){return i*t[n]+e[n]}function w(t,e,i){return t?e?i?I(t):P(t):i?A(t):T(t):null}function T(t){const e=t.coords;return{x:e[0],y:e[1]}}function M(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function P(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function E(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function A(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function C(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function I(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function R(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function O(t,e){return t&&e?R:t?E:e?C:M}function F(t,e,i=O(null!=e.z,null!=e.m)){return i(t,e)}function z(t,e,i){if(null==t)return null;const n=d(e,i),r=[];for(let e=0;e<t.coords.length;e+=n){const i=[];for(let r=0;r<n;r++)i.push(t.coords[e+r]);r.push(i)}return e?i?{points:r,hasZ:e,hasM:i}:{points:r,hasZ:e}:i?{points:r,hasM:i}:{points:r}}function D(t,e,i=d(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const n=t.coords;let r=0;for(const t of e.points)for(let e=0;e<i;e++)n[r++]=t[e];return t}function L(t,e,i){if(!t)return null;const n=d(e,i),{coords:r,lengths:s}=t,o=[];let a=0;for(const t of s){const e=[];for(let i=0;i<t;i++){const t=[];for(let e=0;e<n;e++)t.push(r[a++]);e.push(t)}o.push(e)}return e?i?{paths:o,hasZ:e,hasM:i}:{paths:o,hasZ:e}:i?{paths:o,hasM:i}:{paths:o}}function N(t,e,i=d(e.hasZ,e.hasM)){const{lengths:n,coords:r}=t;let s=0;for(const t of e.paths){for(const e of t)for(let t=0;t<i;t++)r[s++]=e[t];n.push(t.length)}return t}function B(t,e,i){if(!t)return null;const n=d(e,i),{coords:r,lengths:s}=t,o=[];let a=0;for(const t of s){const e=[];for(let i=0;i<t;i++){const t=[];for(let e=0;e<n;e++)t.push(r[a++]);e.push(t)}o.push(e)}return e?i?{rings:o,hasZ:e,hasM:i}:{rings:o,hasZ:e}:i?{rings:o,hasM:i}:{rings:o}}function k(t,e,i=e.hasZ,n=e.hasM){return V(t,e.rings,i,n)}function V(t,e,i,n){const r=d(i,n),{lengths:s,coords:o}=t;let a=0;lt(t);for(const t of e){for(const e of t)for(let t=0;t<r;t++)o[a++]=e[t];s.push(t.length)}return t}const U=[],G=[];function H(t,e,i,n,r){U[0]=t;const[s]=Y(G,U,e,i,n,r);return ct(U),ct(G),s}function Y(t,e,i,r,s,o){if(ct(t),!i){for(const i of e){const e=o?i.attributes[o]:void 0;t.push(new c.Om(null,i.attributes,null,e))}return t}switch(i){case"esriGeometryPoint":return function(t,e,i,n,r){const s=O(i,n);for(const{geometry:i,attributes:n}of e){const e=null!=i?s(new h.A,i):null;t.push(new c.Om(e,n,null,r?n[r]:void 0))}return t}(t,e,r,s,o);case"esriGeometryMultipoint":return function(t,e,i,n,r){const s=d(i,n);for(const{geometry:i,attributes:n}of e){const e=null!=i?D(new h.A,i,s):null;t.push(new c.Om(e,n,null,r?n[r]:void 0))}return t}(t,e,r,s,o);case"esriGeometryPolyline":return function(t,e,i,n,r){const s=d(i,n);for(const{geometry:i,attributes:n,centroid:o}of e){const e=null!=i?N(new h.A,i,s):null,a=null!=o?F(new h.A,o):null;t.push(new c.Om(e,n,a,r?n[r]:void 0))}return t}(t,e,r,s,o);case"esriGeometryPolygon":return function(t,e,i,n,r){for(const{geometry:s,centroid:o,attributes:a}of e){const e=null!=s?k(new h.A,s,i,n):null,l=r?a[r]:void 0;null!=o?t.push(new c.Om(e,a,M(new h.A,o),l)):t.push(new c.Om(e,a,null,l))}return t}(t,e,r,s,o);default:f().error("convertToFeatureSet:unknown-geometry",new n.A(`Unable to parse unknown geometry type '${i}'`)),ct(t)}return t}function W(t,e,i,n){G[0]=t,X(U,G,e,i,n);const r=U[0];return ct(U),ct(G),r}function Z(t,e,i){if(null==t)return null;const r=new h.A;return"hasZ"in t&&null==e&&(e=t.hasZ),"hasM"in t&&null==i&&(i=t.hasM),(0,l.fT)(t)?O(null!=e?e:null!=t.z,null!=i?i:null!=t.m)(r,t):(0,l.Bi)(t)?k(r,t,e,i):(0,l.Rg)(t)?N(r,t,d(e,i)):(0,l.U9)(t)?D(r,t,d(e,i)):void f().error("convertFromGeometry:unknown-geometry",new n.A(`Unable to parse unknown geometry type '${t}'`))}function q(t,e,i,r){const s=t&&("coords"in t?t:t.geometry);if(null==s)return null;switch(e){case"esriGeometryPoint":{let t=T;return i&&r?t=I:i?t=P:r&&(t=A),t(s)}case"esriGeometryMultipoint":return z(s,i,r);case"esriGeometryPolyline":return L(s,i,r);case"esriGeometryPolygon":return B(s,i,r);default:return f().error("convertToGeometry:unknown-geometry",new n.A(`Unable to parse unknown geometry type '${e}'`)),null}}function X(t,e,i,r,s){if(ct(t),null==i)return function(t,e){for(const i of e)t.push({attributes:i.attributes});return t}(t,e);switch(i){case"esriGeometryPoint":return function(t,e,i,n){let r=T;i&&n?r=I:i?r=P:n&&(r=A);for(const i of e){const{geometry:e,attributes:n}=i,s=null!=e?r(e):null;t.push({attributes:n,geometry:s})}return t}(t,e,r,s);case"esriGeometryMultipoint":return function(t,e,i,n){for(const{geometry:r,attributes:s}of e)t.push({attributes:s,geometry:null!=r?z(r,i,n):null});return t}(t,e,r,s);case"esriGeometryPolyline":return function(t,e,i,n){for(const{geometry:r,attributes:s}of e)t.push({attributes:s,geometry:null!=r?L(r,i,n):null});return t}(t,e,r,s);case"esriGeometryPolygon":return function(t,e,i,n){for(const{geometry:r,attributes:s,centroid:o}of e){const e=null!=r?B(r,i,n):null;if(null!=o){const i=T(o);t.push({attributes:s,centroid:i,geometry:e})}else t.push({attributes:s,geometry:e})}return t}(t,e,r,s);default:f().error("convertToFeatureSet:unknown-geometry",new n.A(`Unable to parse unknown geometry type '${i}'`))}return t}function $(t){const{objectIdFieldName:e,spatialReference:i,transform:n,fields:r,hasM:s,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:u,queryGeometry:h,queryGeometryType:d}=t,f={features:X([],a,l,o,s),fields:r,geometryType:l,objectIdFieldName:e,spatialReference:i,uniqueIdField:u,queryGeometry:q(h,d,!1,!1)};return n&&(f.transform=n),c&&(f.exceededTransferLimit=c),s&&(f.hasM=s),o&&(f.hasZ=o),f}function j(t,e){const i=new u.A,{hasM:r,hasZ:s,features:o,objectIdFieldName:a,spatialReference:l,geometryType:c,exceededTransferLimit:h,transform:d,fields:_}=t;return _&&(i.fields=_),i.geometryType=c??null,i.objectIdFieldName=a??e??null,i.spatialReference=l??null,i.objectIdFieldName?(o&&Y(i.features,o,c,s,r,i.objectIdFieldName),h&&(i.exceededTransferLimit=h),r&&(i.hasM=r),s&&(i.hasZ=s),d&&(i.transform=d),i):(f().error(new n.A("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function K(t){const{transform:e,features:i,hasM:n,hasZ:r}=t;if(!e)return t;for(const t of i)null!=t.geometry&&rt(t.geometry,t.geometry,n,r,e),null!=t.centroid&&rt(t.centroid,t.centroid,n,r,e);return t.transform=null,t}function Q(t,e){const{geometryType:i,features:n,hasM:r,hasZ:s}=e;if(!t)return e;for(let e=0;e<n.length;e++){const o=n[e],a=o.weakClone();a.geometry=new h.A,J(a.geometry,o.geometry,r,s,i,t),o.centroid&&(a.centroid=new h.A,J(a.centroid,o.centroid,r,s,"esriGeometryPoint",t)),n[e]=a}return e.transform=t,e}function J(t,e,i,n,r,s,o=i,a=n){if(lt(t),!e?.coords.length)return null;const l=_[r],{coords:c,lengths:u}=e,h=d(i,n),f=d(i&&o,n&&a),p=v(i,n,o,a);if(!u.length)return p(t.coords,c,0,0,x(s,c[0]),b(s,c[1])),lt(t,h,0),t;let m,g,y,S,w=0,T=0,M=T;for(const e of u){if(e<l)continue;let i=0;T=M,y=m=x(s,c[w]),S=g=b(s,c[w+1]),p(t.coords,c,T,w,y,S),i++,w+=h,T+=f;for(let n=1;n<e;n++,w+=h)y=x(s,c[w]),S=b(s,c[w+1]),y===m&&S===g||(p(t.coords,c,T,w,y-m,S-g),T+=f,i++,m=y,g=S);i>=l&&(t.lengths.push(i),M=T)}return ct(t.coords,M),t.coords.length?t:null}function tt(t,e,i,n,r,s,o=i,a=n){if(lt(t),!e?.coords.length)return null;const l=_[r],{coords:c,lengths:u}=e,h=d(i,n),f=d(i&&o,n&&a),p=v(i,n,o,a);if(!u.length)return p(t.coords,c,0,0,c[0],c[1]),lt(t,h,0),t;let m=0;const g=s*s;for(const e of u){if(e<l){m+=e*h;continue}const i=t.coords.length/f,n=m,r=m+(e-1)*h;p(t.coords,c,t.coords.length,n,c[n],c[n+1]),it(t.coords,c,h,g,p,n,r),p(t.coords,c,t.coords.length,r,c[r],c[r+1]);const s=t.coords.length/f-i;s>=l?t.lengths.push(s):ct(t.coords,i*f),m+=e*h}return t.coords.length?t:null}function et(t,e,i,n){const r=t[e],s=t[e+1],o=t[i],a=t[i+1],l=t[n],c=t[n+1];let u=o,h=a,d=l-u,f=c-h;if(0!==d||0!==f){const t=((r-u)*d+(s-h)*f)/(d*d+f*f);t>1?(u=l,h=c):t>0&&(u+=d*t,h+=f*t)}return d=r-u,f=s-h,d*d+f*f}function it(t,e,i,n,r,s,o){let a,l=n,c=0;for(let t=s+i;t<o;t+=i)a=et(e,t,s,o),a>l&&(c=t,l=a);l>n&&(c-s>i&&it(t,e,i,n,r,s,c),r(t,e,t.length,c,e[c],e[c+1]),o-c>i&&it(t,e,i,n,r,c,o))}function nt(t,e,i,n){if(!e?.coords?.length)return null;const r=d(i,n);let s=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,u=Number.NEGATIVE_INFINITY;if(e&&e.coords){const t=e.coords;for(let e=0;e<t.length;e+=r){const i=t[e],n=t[e+1];s=Math.min(s,i),c=Math.max(c,i),l=Math.min(l,n),u=Math.max(u,n)}}return(0,o.is)(t)?(0,o.BI)(t,s,l,c,u):(0,a.fA)(s,l,c,u,t),t}function rt(t,e,i,n,r){const{coords:o,lengths:a}=e,l=d(i,n);if(!o.length)return t!==e&&lt(t),t;(0,s.Lw)(r);const{originPosition:c,scale:u,translate:h}=r,f=ut;f.originPosition=c;const _=f.scale;_[0]=u[0]??1,_[1]=-(u[1]??1),_[2]=u[2]??1,_[3]=u[3]??1;const p=f.translate;if(p[0]=h[0]??0,p[1]=h[1]??0,p[2]=h[2]??0,p[3]=h[3]??0,!a.length){for(let e=0;e<l;++e)t.coords[e]=S(f,o[e],e);return t!==e&&lt(t,l,0),t}let m=0;for(let e=0;e<a.length;e++){const i=a[e];t.lengths[e]=i;for(let e=0;e<l;++e)t.coords[m+e]=S(f,o[m+e],e);let n=t.coords[m],r=t.coords[m+1];m+=l;for(let e=1;e<i;e++,m+=l){n+=o[m]*_[0],r+=o[m+1]*_[1],t.coords[m]=n,t.coords[m+1]=r;for(let e=2;e<l;++e)t.coords[m+e]=S(f,o[m+e],e)}}return t!==e&&lt(t,o.length,a.length),t}function st(t,e,i,n,r,s){if(lt(t),t.lengths.push(...e.lengths),i===r&&n===s)for(let i=0;i<e.coords.length;i++)t.coords.push(e.coords[i]);else{const o=d(i,n),a=v(i,n,r,s),l=e.coords;for(let e=0;e<l.length;e+=o)a(t.coords,l,t.coords.length,e,l[e],l[e+1])}return t}function ot(t,e,i,n){let r=0,s=t[n*e],o=t[n*(e+1)];for(let a=1;a<i;a++){const i=s+t[n*(e+a)],l=o+t[n*(e+a)+1],c=(i-s)*(l+o);s=i,o=l,r+=c}return.5*r}function at(t,e){const{coords:i,lengths:n}=t;let r=0,s=0;for(let t=0;t<n.length;t++){const o=n[t];s+=ot(i,r,o,e),r+=o}return Math.abs(s)}function lt(t,e=0,i=0){ct(t.lengths,i),ct(t.coords,e)}function ct(t,e=0){t.length!==e&&(t.length=e)}const ut={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]}},9030:function(t,e,i){i.d(e,{D:function(){return r}});var n=i(93040);async function r(t,e){const{data:i}=await(0,n.A)(t,{responseType:"image",...e});return i}},23454:function(t,e,i){i.d(e,{Aq:function(){return s},pC:function(){return o},rx:function(){return a}});var n=i(62096),r=i(29076);function s(t,e){t[4]=e}class o{constructor(t,e=!0,i=!0,n=0){this.isClosed=!1,this.geometryCursor=null,this.geometryCursor=!e&&"esriGeometryPolygon"===t.geometryType||!i&&"esriGeometryPolyline"===t.geometryType?null:t,this.geomUnitsPerPoint=n,this.iterateMultiPath=!1,this.iteratePath=!1,this.internalPlacement=new r.W}next(){if(!this.geometryCursor)return null;const t=this.processMultiPath(this.geometryCursor);return this.iterateMultiPath&&t||(this.geometryCursor=null),t}processMultiPath(t){for(;this.iteratePath||t.pathIndex<t.totalSize-1;){this.iteratePath||t.nextPath(),this.iterateMultiPath=!0;const e=this.processPath(t);if(e)return e}return this.iterateMultiPath=!1,null}}class a{constructor(t,e,i,n=0){this.isClosed=!1,this._tileKey=null,this.inputGeometries=t,this.acceptPolygon=e,this.acceptPolyline=i,this.geomUnitsPerPoint=n,this.iteratePath=!1,this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){let t=this.inputGeometries.next();for(;t&&(this.isClosed=this.acceptPolygon&&"esriGeometryPolygon"===t.geometryType||"esriGeometryEnvelope"===t.geometryType,this.multiPathCursor=t,!this.multiPathCursor);)t=this.inputGeometries.next();if(!this.multiPathCursor)return null;this._tileKey&&this.isClippingRequired(this.multiPathCursor)&&(this.multiPathCursor.reset(),this.multiPathCursor=(0,n.q)(this.multiPathCursor,256))}for(;this.iteratePath||this.multiPathCursor.nextPath();){this.multiPathCursor.seekPathStart();const t=this.processPath(this.multiPathCursor);if(t)return t}this.multiPathCursor=null}}isClippingRequired(t){return!1}}},62096:function(t,e,i){i.d(e,{k:function(){return a},q:function(){return l}});var n=i(33134),r=i(72139);const s=512;let o;class a{constructor(t){this._geometry=t}next(){const t=this._geometry;return this._geometry=null,t}}function l(t,e){o||(o=new r.O3(0,0,0,1));const i="esriGeometryPolygon"===t.geometryType,a=i?r.dC.Polygon:r.dC.LineString,l=i?3:2;let c,u;for(o.reset(a),o.setPixelMargin(e+1),o.setExtent(s);t.nextPath();)if(!(t.pathSize<l)){for(t.nextPoint(),c=t.x,u=-t.y,o.moveTo(c,u);t.nextPoint();)c=t.x,u=-t.y,o.lineTo(c,u);i&&o.close()}const h=o.result(!1);if(h){const e=n.z.createEmptyOptimizedCIM(t.geometryType);for(const t of h){e.startPath();for(const i of t)e.pushXY(i.x,-i.y)}return e.reset(),e}return null}},9635:function(t,e,i){i.d(e,{A:function(){return T},c:function(){return M}});var n=i(63514),r=i(82112),s=i(20391),o=i(11672),a=i(12281),l=i(2969),c=i(7889),u=i(48645),h=i(7088),d=i(17706),f=i(10183),_=i(1646),p=i(79323),m=i(34476),g=i(31771),y=i(15987),v=i(19511),x=i(20305),b=i(58892),S=i(80585),w=i(58676);function T(t){if(!t)return null;switch(t.type){case"CIMGeometricEffectAddControlPoints":return n.N.local();case"CIMGeometricEffectArrow":return r.B.local();case"CIMGeometricEffectBuffer":return s.s.local();case"CIMGeometricEffectControlMeasureLine":return o.v.local();case"CIMGeometricEffectCut":return a.y.local();case"CIMGeometricEffectDashes":return l.I.local();case"CIMGeometricEffectDonut":return c.O.local();case"CIMGeometricEffectJog":return u.U.local();case"CIMGeometricEffectMove":return h.V.local();case"CIMGeometricEffectOffset":return d.V.local();case"CIMGeometricEffectReverse":return f.C.local();case"CIMGeometricEffectRotate":return _.v.local();case"CIMGeometricEffectScale":return p.W.local();case"CIMGeometricEffectWave":return m.l.local()}return null}function M(t){if(!t)return null;switch(t.type){case"CIMMarkerPlacementAlongLineSameSize":return g.e.local();case"CIMMarkerPlacementAtExtremities":return y.y.local();case"CIMMarkerPlacementAtRatioPositions":return v.S.local();case"CIMMarkerPlacementInsidePolygon":return x.M.local();case"CIMMarkerPlacementOnLine":return b.R.local();case"CIMMarkerPlacementOnVertices":return S.A.local();case"CIMMarkerPlacementPolygonCenter":return w.L.local()}return null}},29076:function(t,e,i){i.d(e,{W:function(){return n}});class n{constructor(){this.setIdentity()}getAngle(){return(null==this.rz||0===this.rz&&1!==this.rzCos&&0!==this.rzSin)&&(this.rz=Math.atan2(this.rzSin,this.rzCos)),this.rz}setIdentity(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rzCos=1,this.rzSin=0}setTranslate(t,e){this.tx=t,this.ty=e}setTranslateZ(t){this.tz=t}setRotateCS(t,e){this.rz=void 0,this.rzCos=t,this.rzSin=e}setRotate(t){this.rz=t,this.rzCos=void 0,this.rzSin=void 0}setRotateY(t){this.ry=t}setScale(t){this.s=t}setMeasure(t){this.m=t}}},66981:function(t,e,i){i.d(e,{A:function(){return s}});var n=i(80683),r=i(87847);class s{constructor(){this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null,this.geometryEnginePromise=null}destroy(){this._inFlightResourceMap.clear(),this._resourceMap.clear()}getResource(t){return this._resourceMap.get(t)??null}async fetchResource(t,e){const i=this._resourceMap.get(t);if(i)return{width:i.width,height:i.height};let n=this._inFlightResourceMap.get(t);return n?n.then((t=>({width:t.width,height:t.height}))):(n=(0,r.M5)(t,e),this._inFlightResourceMap.set(t,n),n.then((e=>(this._inFlightResourceMap.delete(t),this._resourceMap.set(t,e),{width:e.width,height:e.height})),(()=>({width:0,height:0}))))}deleteResource(t){this._inFlightResourceMap.delete(t),this._resourceMap.delete(t)}loadFont(t){return(0,n.Al)(t)}}},14817:function(t,e,i){i.d(e,{Rj:function(){return D},mx:function(){return F},CK:function(){return z},IT:function(){return R},QF:function(){return k}});var n=i(80683),r=i(58941),s=i(21609),o=i(40633),a=i(56996),l=i(13520),c=i(33134),u=i(87416),h=i(35068),d=i(72228),f=i(74697),_=i(62096);class p{applyColorSubstituition(t,e){if(!e)return t;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:i,height:n}=t,r=this._rasterizationCanvas,s=r.getContext("2d",{willReadFrequently:!0});t!==r&&(r.width=i,r.height=n,s.drawImage(t,0,0,i,n));const o=s.getImageData(0,0,i,n).data;if(e)for(const t of e)if(t&&t.oldColor&&4===t.oldColor.length&&t.newColor&&4===t.newColor.length){const[e,i,n,r]=t.oldColor,[s,a,l,c]=t.newColor;if(e===s&&i===a&&n===l&&r===c)continue;for(let t=0;t<o.length;t+=4)e===o[t]&&i===o[t+1]&&n===o[t+2]&&r===o[t+3]&&(o[t]=s,o[t+1]=a,o[t+2]=l,o[t+3]=c)}const a=new ImageData(o,i,n);return s.putImageData(a,0,0),r}tintImageData(t,e){if(!e||e.length<4)return t;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:i,height:n}=t,r=this._rasterizationCanvas,s=r.getContext("2d",{willReadFrequently:!0});t!==r&&(r.width=i,r.height=n,s.drawImage(t,0,0,i,n));const o=s.getImageData(0,0,i,n),a=new Uint8Array(o.data),l=[e[0]/255,e[1]/255,e[2]/255,e[3]/255];for(let t=0;t<a.length;t+=4)a[t]*=l[0],a[t+1]*=l[1],a[t+2]*=l[2],a[t+3]*=l[3];const c=new ImageData(new Uint8ClampedArray(a.buffer),i,n);return s.putImageData(c,0,0),r}}var m=i(9635),g=i(29076),y=i(38821),v=i(33389);function x(t){const e=t.getFrame(0);if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement)return e;const i=document.createElement("canvas");i.width=t.width,i.height=t.height;const n=i.getContext("2d");return e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0),i}var b=i(82497),S=i(64303);function w(t){return`rgba(${t.slice(0,3).toString()},${t[3]})`}class T{constructor(t){t&&(this._textRasterizationCanvas=t)}rasterizeText(t,e){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const i=this._textRasterizationCanvas,n=i.getContext("2d",{willReadFrequently:!0});M(n,e),this._parameters=e,this._textLines=t.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const{decoration:r,weight:s}=e.font;this._lineThroughWidthOffset=r&&"line-through"===r?.1*this._lineHeight:0;const o=null!=e.backgroundColor||null!=e.borderLine,a=o?S.y7:0,c=this._computeTextWidth(n,e)+2*a,u=this._lineHeight*this._textLines.length+2*a;if(i.width=c+2*this._lineThroughWidthOffset,i.height=u,0===i.width||0===i.height)return i.width=i.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:i};this._renderedLineHeight=Math.round(this._lineHeight*e.pixelRatio),this._renderedHaloSize=(0,l.Lz)(e.halo.size)*e.pixelRatio,this._renderedWidth=c*e.pixelRatio,this._renderedHeight=u*e.pixelRatio,this._lineThroughWidthOffset*=e.pixelRatio;const h=e.color??[0,0,0,0],d=e.halo&&e.halo.color?e.halo.color:[0,0,0,0];this._fillStyle=w(h),this._haloStyle=`rgb(${d.slice(0,3).toString()})`;const f=this._renderedLineHeight,_=this._renderedHaloSize;n.save(),n.clearRect(0,0,i.width,i.height),M(n,e);const p=a*e.pixelRatio,m=function(t,e){return"center"===t?.5*e:"right"===t?e:0}(n.textAlign,this._renderedWidth-2*p)+_+p,g=_+p,y=_>0;let v=this._lineThroughWidthOffset,x=0;if(o){n.save();const t=e.backgroundColor??[0,0,0,0],r=e.borderLine?.color??[0,0,0,0],s=2*(0,l.Lz)(e.borderLine?.size??0);n.fillStyle=w(t),n.strokeStyle=w(r),n.lineWidth=s,n.fillRect(0,0,i.width,i.height),n.strokeRect(0,0,i.width,i.height),n.restore()}y&&this._renderHalo(n,m,g,v,x,e),x+=g,v+=m;for(const t of this._textLines)y?(n.globalCompositeOperation="destination-out",n.fillStyle="rgb(0, 0, 0)",n.fillText(t,v,x),n.globalCompositeOperation="source-over",n.fillStyle=this._fillStyle,n.fillText(t,v,x)):(n.fillStyle=this._fillStyle,n.fillText(t,v,x)),r&&"none"!==r&&this._renderDecoration(n,v,x,r,s),x+=f;n.restore();const b=this._renderedWidth+2*this._lineThroughWidthOffset,T=this._renderedHeight,P=n.getImageData(0,0,b,T),E=new Uint8Array(P.data);if(e.premultiplyColors){let t;for(let e=0;e<E.length;e+=4)t=E[e+3]/255,E[e]=E[e]*t,E[e+1]=E[e+1]*t,E[e+2]=E[e+2]*t}let A,C;switch(e.horizontalAlignment){case"left":A=-.5;break;case"right":A=.5;break;default:A=0}switch(e.verticalAlignment){case"bottom":C=-.5;break;case"top":C=.5;break;case"baseline":C=-1/6;break;default:C=0}return{size:[b,T],image:new Uint32Array(E.buffer),sdf:!1,simplePattern:!1,anchorX:A,anchorY:C,canvas:i}}_renderHalo(t,e,i,n,r,s){const o=this._renderedWidth,a=this._renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas")),this._haloRasterizationCanvas.width=o,this._haloRasterizationCanvas.height=a;const l=this._haloRasterizationCanvas,c=l.getContext("2d");c.clearRect(0,0,o,a),M(c,s);const{decoration:u,weight:h}=s.font;c.fillStyle=this._haloStyle,c.strokeStyle=this._haloStyle,c.lineJoin="round",this._renderHaloNative(c,e,i,u,h),t.globalAlpha=this._parameters.halo.color[3],t.drawImage(l,0,0,o,a,n,r,o,a),t.globalAlpha=1}_renderHaloNative(t,e,i,n,r){const s=this._renderedLineHeight,o=this._renderedHaloSize;for(const a of this._textLines){const l=2*o,c=5,u=.1;for(let s=0;s<c;s++){const o=(1-(c-1)*u+s*u)*l;t.lineWidth=o,t.strokeText(a,e,i),n&&"none"!==n&&this._renderDecoration(t,e,i,n,r,o)}i+=s}}computeTextSize(t,e){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const i=this._textRasterizationCanvas,n=i.getContext("2d");M(n,e),this._parameters=e,this._textLines=t.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const r=this._computeTextWidth(n,e),s=this._lineHeight*this._textLines.length;return i.width=r,i.height=s,[r*e.pixelRatio,s*e.pixelRatio]}_computeTextWidth(t,e){let i=0;for(const e of this._textLines)i=Math.max(i,t.measureText(e).width);const n=e.font;return("italic"===n.style||"oblique"===n.style||"string"==typeof n.weight&&("bold"===n.weight||"bolder"===n.weight)||"number"==typeof n.weight&&n.weight>600)&&(i+=.3*t.measureText("w").width),i+=2*(0,l.Lz)(this._parameters.halo.size),Math.round(i)}_computeLineHeight(){let t=1.275*this._parameters.size;const e=this._parameters.font.decoration;return e&&"underline"===e&&(t*=1.3),Math.round(t+2*(0,l.Lz)(this._parameters.halo.size))}_renderDecoration(t,e,i,n,r,s){const o=.9*this._lineHeight,a="bold"===r?.06:"bolder"===r?.09:.04;switch(t.textAlign){case"center":e-=this._renderedWidth/2;break;case"right":e-=this._renderedWidth}const l=t.textBaseline;if("underline"===n)switch(l){case"top":i+=o;break;case"middle":i+=o/2}else if("line-through"===n)switch(l){case"top":i+=o/1.5;break;case"middle":i+=o/3}const c=s?1.5*s:Math.ceil(o*a);t.save(),t.beginPath(),t.strokeStyle=t.fillStyle,t.lineWidth=c,t.moveTo(e-this._lineThroughWidthOffset,i),t.lineTo(e+this._renderedWidth+2*this._lineThroughWidthOffset,i),t.stroke(),t.restore()}}function M(t,e){const i=Math.max(e.size,.5),n=e.font,r=`${n.style} ${n.weight} ${(0,l.Lz)(i*e.pixelRatio).toFixed(1)}px ${n.family}, sans-serif`;let s;switch(t.font=r,t.textBaseline="top",e.horizontalAlignment){case"left":default:s="left";break;case"right":s="right";break;case"center":s="center"}t.textAlign=s}var P=i(7590),E=i(39686),A=i(17469),C=i(96700);const I=Math.PI/180;class R{constructor(t){this._t=t}static createIdentity(){return new R([1,0,0,0,1,0])}clone(){const t=this._t;return new R(t.slice())}transform(t){const e=this._t;return[e[0]*t[0]+e[1]*t[1]+e[2],e[3]*t[0]+e[4]*t[1]+e[5]]}static createScale(t,e){return new R([t,0,0,0,e,0])}scale(t,e){const i=this._t;return i[0]*=t,i[1]*=t,i[2]*=t,i[3]*=e,i[4]*=e,i[5]*=e,this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(t,e){return new R([0,0,t,0,0,e])}translate(t,e){const i=this._t;return i[2]+=t,i[5]+=e,this}static createRotate(t){const e=Math.cos(t),i=Math.sin(t);return new R([e,-i,0,i,e,0])}rotate(t){return R.multiply(this,R.createRotate(t),this)}angle(){const t=this._t[0],e=this._t[3],i=Math.sqrt(t*t+e*e);return[t/i,e/i]}static multiply(t,e,i){const n=t._t,r=e._t,s=n[0]*r[0]+n[3]*r[1],o=n[1]*r[0]+n[4]*r[1],a=n[2]*r[0]+n[5]*r[1]+r[2],l=n[0]*r[3]+n[3]*r[4],c=n[1]*r[3]+n[4]*r[4],u=n[2]*r[3]+n[5]*r[4]+r[5],h=i._t;return h[0]=s,h[1]=o,h[2]=a,h[3]=l,h[4]=c,h[5]=u,i}invert(){const t=this._t;let e=t[0]*t[4]-t[1]*t[3];if(0===e)return new R([0,0,0,0,0,0]);e=1/e;const i=(t[1]*t[5]-t[2]*t[4])*e,n=(t[2]*t[3]-t[0]*t[5])*e,r=t[4]*e,s=-t[1]*e,o=-t[3]*e,a=t[0]*e;return new R([r,s,i,o,a,n])}}class O{constructor(t,e){this._resourceManager=t,this._transfos=[],this._sizeTransfos=[],this._geomUnitsPerPoint=1,this._placementPool=new a.A(g.W,void 0,void 0,100),this._earlyReturn=!1,this._mapRotation=0,this._transfos.push(e||R.createIdentity()),this._sizeTransfos.push(e?e.scaleRatio():1)}setTransform(t,e){this._transfos=[t||R.createIdentity()],this._sizeTransfos=[e||(t?t.scaleRatio():1)]}setGeomUnitsPerPoint(t){this._geomUnitsPerPoint=t}transformPt(t){return this._transfos[this._transfos.length-1].transform(t)}transformSize(t){return t*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(t){return this._transfos[this._transfos.length-1].invert().transform(t)}reverseTransformSize(t){return t/this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformScalar(t){return t/this._transfos[this._transfos.length-1].scaleRatio()}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}prevGeomUnitsPerPoint(){return this._transfos.length>2?1:this._geomUnitsPerPoint}isEmbedded(){return this._transfos.length>1}back(){return this._transfos[this._transfos.length-1]}push(t,e){const i=e?t.scaleRatio():1;R.multiply(t,this.back(),t),this._transfos.push(t),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*i)}pop(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)}drawSymbol(t,e,i){if(t)switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this.drawMultiLayerSymbol(t,e);break;case"CIMTextSymbol":this.drawTextSymbol(t,e,i)}}drawMultiLayerSymbol(t,e){if(!t||!e)return;const i=t.symbolLayers;if(!i)return;const n=t.effects;if(n&&n.length>0){const t=this.executeEffects(n,e);if(t){let e=t.next();for(;e;)this.drawSymbolLayers(i,e.asJSON()),e=t.next()}}else this.drawSymbolLayers(i,e)}executeEffects(t,e){const i=this._resourceManager.geometryEngine;let n=new _.k(c.z.fromJSONCIM(e));for(const e of t){const t=(0,m.A)(e);t&&(n=t.execute(n,e,this.geomUnitsPerPoint(),null,i))}return n}drawSymbolLayers(t,e){let i=t.length;for(;i--;){const n=t[i];if(!n||!1===n.enable)continue;const r=n.effects;if(r&&r.length>0){const t=this.executeEffects(r,e);if(t){let e=null;for(;(e=t.next())&&(this.drawSymbolLayer(n,e.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(n,e);if(this._earlyReturn)return}}drawSymbolLayer(t,e){switch(t.type){case"CIMSolidFill":this.drawSolidFill(e,t.color);break;case"CIMHatchFill":this.drawHatchFill(e,t);break;case"CIMPictureFill":this.drawPictureFill(e,t);break;case"CIMGradientFill":this.drawGradientFill(e,t);break;case"CIMSolidStroke":this.drawSolidStroke(e,t.color,t.width,t.capStyle,t.joinStyle,t.miterLimit);break;case"CIMPictureStroke":this.drawPictureStroke(e,t);break;case"CIMGradientStroke":this.drawGradientStroke(e,t);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":this.drawMarkerLayer(t,e)}}drawHatchFill(t,e){const i=function(t,e,i){let n=(0,P.$w)(t.separation,y.D.CIMHatchFill.separation)*i,r=(0,P.$w)(t.rotation);if(0===n)return null;n<0&&(n=-n);let s=0;const o=.5*n;for(;s>o;)s-=n;for(;s<-o;)s+=n;const a=(0,u.vt)();(0,h.Rg)(a,e),a[0]-=o,a[1]-=o,a[2]+=o,a[3]+=o;const l=[[a[0],a[1]],[a[0],a[3]],[a[2],a[3]],[a[2],a[1]]];for(;r>180;)r-=180;for(;r<0;)r+=180;const c=Math.cos(r*I),d=Math.sin(r*I),f=-n*d,_=n*c;let p,m,g,v;s=(0,P.$w)(t.offsetX)*i*d-(0,P.$w)(t.offsetY)*i*c,p=g=Number.MAX_VALUE,m=v=-Number.MAX_VALUE;for(const t of l){const e=t[0],i=t[1],n=c*e+d*i,r=-d*e+c*i;p=Math.min(p,n),g=Math.min(g,r),m=Math.max(m,n),v=Math.max(v,r)}g=Math.floor(g/n)*n;let x=c*p-d*g-f*s/n,b=d*p+c*g-_*s/n,S=c*m-d*g-f*s/n,w=d*m+c*g-_*s/n;const T=1+Math.round((v-g)/n),M=[];for(let t=0;t<T;t++)x+=f,b+=_,S+=f,w+=_,M.push([[x,b],[S,w]]);return{paths:M}}(e,t,this.geomUnitsPerPoint());i&&(this.pushClipPath(t),this.drawMultiLayerSymbol(e.lineSymbol,i),this.popClipPath())}drawPictureFill(t,e){}drawGradientFill(t,e){}drawPictureStroke(t,e){}drawGradientStroke(t,e){}drawMarkerLayer(t,e){const i=t.markerPlacement;if(i){const n=(0,m.c)(i);if(n){const r="CIMMarkerPlacementInsidePolygon"===i.type||"CIMMarkerPlacementPolygonCenter"===i.type&&i.clipAtBoundary;r&&this.pushClipPath(e);const s=n.execute(c.z.fromJSONCIM(e),i,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine);if(s){let e=null;for(;(e=s.next())&&(this.drawMarker(t,e),!this._earlyReturn););}r&&this.popClipPath()}}else{const i=this._placementPool.acquire();if((0,f.fT)(e))i.tx=e.x,i.ty=e.y,this.drawMarker(t,i);else if((0,f.Bi)(e)){const n=(0,d.l8)(e);n&&([i.tx,i.ty]=n,this.drawMarker(t,i))}else for(const n of e.points)if(i.tx=n[0],i.ty=n[1],this.drawMarker(t,i),this._earlyReturn)break;this._placementPool.release(i)}}drawMarker(t,e){switch(t.type){case"CIMCharacterMarker":case"CIMPictureMarker":this.drawPictureMarker(t,e);break;case"CIMVectorMarker":this.drawVectorMarker(t,e)}}drawPictureMarker(t,e){if(!t)return;const i=this._resourceManager.getResource(t.url),n=(0,P.$w)(t.size,y.D.CIMPictureMarker.size);if(null==i||n<=0)return;const r=i.width,s=i.height;if(!r||!s)return;const o=r/s,a=(0,P.$w)(t.scaleX,1),l=R.createIdentity(),c=t.anchorPoint;if(c){let e=c.x,i=c.y;"Absolute"!==t.anchorPointUnits&&(e*=n*o*a,i*=n),l.translate(-e,-i)}let u=(0,P.$w)(t.rotation);t.rotateClockwise&&(u=-u),this._mapRotation&&(u+=this._mapRotation),u&&l.rotate(u*I);let h=(0,P.$w)(t.offsetX),d=(0,P.$w)(t.offsetY);if(h||d){if(this._mapRotation){const t=I*this._mapRotation,e=Math.cos(t),i=Math.sin(t),n=h*i+d*e;h=h*e-d*i,d=n}l.translate(h,d)}const f=this.geomUnitsPerPoint();1!==f&&l.scale(f,f);const _=e.getAngle();_&&l.rotate(_),l.translate(e.tx,e.ty),this.push(l,!1),this.drawImage(t,n),this.pop()}drawVectorMarker(t,e){if(!t)return;const i=t.markerGraphics;if(!i)return;const n=(0,P.$w)(t.size,y.D.CIMVectorMarker.size),r=t.frame,s=r?r.ymax-r.ymin:0,a=n&&s?n/s:1,l=R.createIdentity();r&&l.translate(.5*-(r.xmax+r.xmin),.5*-(r.ymax+r.ymin));const c=t.anchorPoint;if(c){let e=c.x,i=c.y;"Absolute"!==t.anchorPointUnits?r&&(e*=r.xmax-r.xmin,i*=r.ymax-r.ymin):(e/=a,i/=a),l.translate(-e,-i)}1!==a&&l.scale(a,a);let u=(0,P.$w)(t.rotation);t.rotateClockwise&&(u=-u),this._mapRotation&&(u+=this._mapRotation),u&&l.rotate(u*I);let h=(0,P.$w)(t.offsetX),d=(0,P.$w)(t.offsetY);if(h||d){if(this._mapRotation){const t=I*this._mapRotation,e=Math.cos(t),i=Math.sin(t),n=h*i+d*e;h=h*e-d*i,d=n}l.translate(h,d)}const f=this.geomUnitsPerPoint();1!==f&&l.scale(f,f);const _=e.getAngle();_&&l.rotate(_),l.translate(e.tx,e.ty),this.push(l,t.scaleSymbolsProportionally);for(const t of i){t?.symbol&&t.geometry||o.A.getLogger("esri.symbols.cim.CIMSymbolDrawHelper").error("Invalid marker graphic",t);let e=t.textString;if("number"==typeof e&&(e=e.toString()),this.drawSymbol(t.symbol,t.geometry,e),this._earlyReturn)break}this.pop()}drawTextSymbol(t,e,i){if(!t)return;if(!(0,f.fT)(e))return;if((0,P.$w)(t.height,y.D.CIMTextSymbol.height)<=0)return;const n=R.createIdentity();let r=(0,P.$w)(t.angle);r=-r,r&&n.rotate(r*I);const s=(0,P.$w)(t.offsetX),o=(0,P.$w)(t.offsetY);(s||o)&&n.translate(s,o);const a=this.geomUnitsPerPoint();1!==a&&n.scale(a,a),n.translate(e.x,e.y),this.push(n,!1),this.drawText(t,i),this.pop()}}class F extends O{constructor(t,e){super(t,e),this.reset()}reset(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0}envelope(){return new b.A(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return(0,u.fA)(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(t){if(t&&!(this._clipCount>0))if((0,f.Bi)(t))this._processPath(t.rings,0);else if((0,f.Rg)(t))this._processPath(t.paths,0);else if((0,f.ZC)(t)){const e=B(t);e&&this._processPath(e.rings,0)}else console.error("drawSolidFill Unexpected geometry type!")}drawSolidStroke(t,e,i){if(!t||this._clipCount>0||null==i||i<=0)return;const n=Math.max(.5*this.transformSize((0,P.$w)(i,y.D.CIMSolidStroke.width)),.25);if((0,f.Bi)(t))this._processPath(t.rings,n);else if((0,f.Rg)(t))this._processPath(t.paths,n);else if((0,f.ZC)(t)){const e=B(t);e&&this._processPath(e.rings,n)}else console.error("drawSolidStroke unexpected geometry type!")}drawMarkerLayer(t,e){(0,f.Bi)(e)&&t.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===t.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===t.markerPlacement.type&&t.markerPlacement.clipAtBoundary)?this._processPath(e.rings,0):super.drawMarkerLayer(t,e)}drawHatchFill(t,e){this.drawSolidFill(t)}drawPictureFill(t,e){this.drawSolidFill(t)}drawGradientFill(t,e){this.drawSolidFill(t)}drawPictureStroke(t,e){this.drawSolidStroke(t,null,e.width)}drawGradientStroke(t,e){this.drawSolidStroke(t,null,e.width)}pushClipPath(t){this.drawSolidFill(t),this._clipCount++}popClipPath(){this._clipCount--}drawImage(t,e){const{url:i}=t,n=(0,P.$w)(t.scaleX,1);let r=n*e,s=e;const o=this._resourceManager.getResource(i);if(null!=o){const t=o.height/o.width;r=n*(e?t>1?e:e/t:o.width),s=e?t>1?e*t:e:o.height}this._merge(this.transformPt([-r/2,-s/2]),0),this._merge(this.transformPt([-r/2,s/2]),0),this._merge(this.transformPt([r/2,-s/2]),0),this._merge(this.transformPt([r/2,s/2]),0)}drawText(t,e){if(!e||0===e.length)return;this._textRasterizer||(this._textRasterizer=new T);const i=V(t);let[n,r]=this._textRasterizer.computeTextSize(e,i);n=(0,l.PN)(n),r=(0,l.PN)(r);let s=0;switch(t.horizontalAlignment){case"Left":s=n/2;break;case"Right":s=-n/2}let o=0;switch(t.verticalAlignment){case"Bottom":o=r/2;break;case"Top":o=-r/2;break;case"Baseline":o=r/6}this._merge(this.transformPt([-n/2+s,-r/2+o]),0),this._merge(this.transformPt([-n/2+s,r/2+o]),0),this._merge(this.transformPt([n/2+s,-r/2+o]),0),this._merge(this.transformPt([n/2+s,r/2+o]),0)}_processPath(t,e){if(t)for(const i of t){const t=i?i.length:0;if(t>1){this._merge(this.transformPt(i[0]),e);for(let n=1;n<t;n++)this._merge(this.transformPt(i[n]),e)}}}_merge(t,e){t[0]-e<this._xmin&&(this._xmin=t[0]-e),t[0]+e>this._xmax&&(this._xmax=t[0]+e),t[1]-e<this._ymin&&(this._ymin=t[1]-e),t[1]+e>this._ymax&&(this._ymax=t[1]+e)}}class z extends O{constructor(){super(...arguments),this._searchPoint=[0,0],this._searchDistPoint=0,this._textInfo=null}hitTest(t,e,i,n,s,o){const a=o*(0,l.Lz)(1);this.setTransform(),this.setGeomUnitsPerPoint(a),this._searchPoint=[(t[0]+t[2])/2,(t[1]+t[3])/2],this._searchDistPoint=(t[2]-t[0])/2/a,this._textInfo=n;const c=e&&("CIMPointSymbol"===e.type&&"Map"!==e.angleAlignment||"CIMTextSymbol"===e.type);if(this._mapRotation=c?s:0,!(0,r.A)("esri-mobile")){const t=(0,l.PN)(E._M*window.devicePixelRatio),i=(0,l.PN)(E.ie);("CIMLineSymbol"!==e?.type&&"CIMPolygonSymbol"!==e?.type||!e.symbolLayers?.some(P.jn))&&"CIMMeshSymbol"!==e?.type&&((0,P.YC)(e)??0)<i&&(this._searchDistPoint=t)}return this._earlyReturn=!1,this.drawSymbol(e,i),this._earlyReturn}drawSolidFill(t,e){this._hitTestFill(t)}drawHatchFill(t,e){this._hitTestFill(t)}drawPictureFill(t,e){this._hitTestFill(t)}drawGradientFill(t,e){this._hitTestFill(t)}drawSolidStroke(t,e,i,n,r,s){this._hitTestStroke(t,i)}drawPictureStroke(t,e){this._hitTestStroke(t,e.width)}drawGradientStroke(t,e){this._hitTestStroke(t,e.width)}drawMarkerLayer(t,e){t.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===t.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===t.markerPlacement.type&&t.markerPlacement.clipAtBoundary)?this._hitTestFill(e):super.drawMarkerLayer(t,e)}pushClipPath(t){}popClipPath(){}drawImage(t,e){const{url:i}=t,n=(0,P.$w)(t.scaleX,1),r=this._resourceManager.getResource(i);if(null==r||0===r.height||0===e)return;const s=e*this.geomUnitsPerPoint(),o=s*n*(r.width/r.height),a=this.reverseTransformPt(this._searchPoint),l=this._searchDistPoint;Math.abs(a[0])<o/2+l&&Math.abs(a[1])<s/2+l&&(this._earlyReturn=!0)}drawText(t,e){const i=this._textInfo;if(!i)return;const n=i.get(t);if(!n)return;if(!n.glyphMosaicItems.glyphs.length)return;const r=(0,C.hV)((0,P.$w)(t.height,y.D.CIMTextSymbol.height)),{lineGapType:s,lineGap:o}=t,a=s?k(s,(0,P.$w)(o),r):0,l="CIMBackgroundCallout"===t.callout?.type,c=(0,A.Tl)(n.glyphMosaicItems,{scale:r/E.eG,angle:0,xOffset:0,yOffset:0,horizontalAlignment:t.horizontalAlignment,verticalAlignment:t.verticalAlignment,maxLineWidth:(0,C.Lu)(t.lineWidth),lineHeight:E.DY*Math.max(.25,Math.min(a||1,4)),decoration:t.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:l}),u=this.reverseTransformPt(this._searchPoint),h=u[0],d=u[1];for(const t of c.glyphs)if(h>t.xTopLeft&&h<t.xBottomRight&&d>-t.yBottomRight&&d<-t.yTopLeft){this._earlyReturn=!0;break}}_hitTestFill(t){let e=null;if((0,f.ZC)(t)){const i=t;e=[[[i.xmin,i.ymin],[i.xmin,i.ymax],[i.xmax,i.ymax],[i.xmax,i.ymin],[i.xmin,i.ymin]]]}else if((0,f.Bi)(t))e=t.rings;else{if(!(0,f.Rg)(t))return;e=t.paths}const i=this.reverseTransformPt(this._searchPoint);(function(t,e){let i=0;for(const n of e){const e=n.length;for(let r=1;r<e;r++){const e=n[r-1],s=n[r];e[1]>t[1]!=s[1]>t[1]&&((s[0]-e[0])*(t[1]-e[1])-(s[1]-e[1])*(t[0]-e[0])>0?i++:i--)}}return 0!==i})(i,e)&&(this._earlyReturn=!0),this._earlyReturn||L(i,e,this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint())&&(this._earlyReturn=!0)}_hitTestStroke(t,e){let i=null;if((0,f.ZC)(t)){const e=t;i=[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}else if((0,f.Bi)(t))i=t.rings;else{if(!(0,f.Rg)(t))return;i=t.paths}L(this.reverseTransformPt(this._searchPoint),i,(0,P.$w)(e,y.D.CIMSolidStroke.width)*this.geomUnitsPerPoint()/2+this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint())&&(this._earlyReturn=!0)}}class D extends O{constructor(t,e,i,n){super(e,i),this._applyAdditionalRenderProps=n,this._colorSubstitutionHelper=new p,this._ctx=t}drawSolidFill(t,e){if(!t)return;if((0,f.Bi)(t))this._buildPath(t.rings,!0);else if((0,f.Rg)(t))this._buildPath(t.paths,!0);else if((0,f.ZC)(t))this._buildPath(B(t).rings,!0);else{if(!(0,f.U9)(t))return;console.log("CanvasDrawHelper.drawSolidFill - No implementation!")}const i=this._ctx;i.fillStyle="string"==typeof e?e:"rgba("+Math.round(e[0])+","+Math.round(e[1])+","+Math.round(e[2])+","+(e[3]??255)/255+")",i.fill("evenodd")}drawSolidStroke(t,e,i,n,r,s){if(!t||!e||0===i)return;if((0,f.Bi)(t))this._buildPath(t.rings,!0);else if((0,f.Rg)(t))this._buildPath(t.paths,!1);else{if(!(0,f.ZC)(t))return void console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");this._buildPath(B(t).rings,!0)}const o=this._ctx;o.strokeStyle="string"==typeof e?e:"rgba("+Math.round(e[0])+","+Math.round(e[1])+","+Math.round(e[2])+","+(e[3]??255)/255+")",o.lineWidth=Math.max(this.transformSize(i),.5),this._setCapStyle(n),this._setJoinStyle(r),o.miterLimit=s,o.stroke()}pushClipPath(t){if(this._ctx.save(),(0,f.Bi)(t))this._buildPath(t.rings,!0);else if((0,f.Rg)(t))this._buildPath(t.paths,!0);else{if(!(0,f.ZC)(t))return;this._buildPath(B(t).rings,!0)}this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(t,e){const{colorSubstitutions:i,url:n,tintColor:r}=t,s=(0,P.$w)(t.scaleX,1),o=this._resourceManager.getResource(n);if(null==o)return;let a=e*(o.width/o.height),l=e;e||(a=o.width,l=o.height);const c=(0,P.UE)(n)||"src"in o&&(0,P.UE)(o.src);let u="getFrame"in o?x(o):o;i&&(u=this._colorSubstitutionHelper.applyColorSubstituition(u,i)),this._applyAdditionalRenderProps&&!c&&r&&(u=this._colorSubstitutionHelper.tintImageData(u,r));const h=this.transformPt([0,0]),[d,f]=this.getTransformAngle(),_=this.transformSize(1),p=this._ctx;p.save(),p.setTransform({m11:s*_*d,m12:s*_*f,m21:-_*f,m22:_*d,m41:h[0],m42:h[1]}),p.drawImage(u,-a/2,-l/2,a,l),p.restore()}drawText(t,e){if(!e||0===e.length)return;this._textRasterizer||(this._textRasterizer=new T);const i=V(t);i.size*=this.transformSize((0,l.PN)(1));const n=this._textRasterizer.rasterizeText(e,i);if(!n)return;const{size:r,anchorX:s,anchorY:o,canvas:a}=n,c=r[0]*(s+.5),u=r[1]*(o-.5),h=this._ctx,d=this.transformPt([0,0]),[f,_]=this.getTransformAngle();h.save(),h.setTransform({m11:1*f,m12:1*_,m21:-1*_,m22:1*f,m41:d[0]-1*c,m42:d[1]+1*u}),h.drawImage(a,0,0),h.restore()}drawPictureFill(t,e){if(!t)return;let{colorSubstitutions:i,height:n,offsetX:r,offsetY:s,rotation:o,scaleX:a,tintColor:l,url:c}=e;const u=this._resourceManager.getResource(c);if(null==u)return;if((0,f.Bi)(t))this._buildPath(t.rings,!0);else if((0,f.Rg)(t))this._buildPath(t.paths,!0);else if((0,f.ZC)(t))this._buildPath(B(t).rings,!0);else{if(!(0,f.U9)(t))return;console.log("CanvasDrawHelper.drawPictureFill - No implementation!")}const h=this._ctx,d=(0,P.UE)(c)||"src"in u&&(0,P.UE)(u.src);let _,p="getFrame"in u?x(u):u;if(i&&(p=this._colorSubstitutionHelper.applyColorSubstituition(p,i)),this._applyAdditionalRenderProps){d||l&&(p=this._colorSubstitutionHelper.tintImageData(p,l)),_=h.createPattern(p,"repeat");const t=this.transformSize(1);o||(o=0),r?r*=t:r=0,s?s*=t:s=0,n&&(n*=t);const e=n?n/u.height:1,i=a&&n?a*n/u.width:1;if(0!==o||1!==e||1!==i||0!==r||0!==s){const t=new DOMMatrix;t.rotateSelf(0,0,-o).translateSelf(r,s).scaleSelf(i,e,1),_.setTransform(t)}}else _=h.createPattern(p,"repeat");h.save(),h.fillStyle=_,h.fill("evenodd"),h.restore()}drawPictureStroke(t,e){if(!t)return;let{colorSubstitutions:i,capStyle:n,joinStyle:r,miterLimit:o,tintColor:a,url:c,width:u}=e;const h=this._resourceManager.getResource(c);if(null==h)return;let d;if((0,f.Bi)(t))d=t.rings;else if((0,f.Rg)(t))d=t.paths;else{if(!(0,f.ZC)(t))return(0,f.U9)(t)?void console.log("CanvasDrawHelper.drawPictureStroke - No implementation!"):void 0;d=B(t).rings}u||(u=h.width);const _=(0,P.UE)(c)||"src"in h&&(0,P.UE)(h.src);let p="getFrame"in h?x(h):h;i&&(p=this._colorSubstitutionHelper.applyColorSubstituition(p,i)),this._applyAdditionalRenderProps&&(_||a&&(p=this._colorSubstitutionHelper.tintImageData(p,a)));const m=Math.max(this.transformSize((0,l.Lz)(u)),.5),g=m/p.width,y=this._ctx,v=y.createPattern(p,"repeat-y");let b,S;y.save(),this._setCapStyle(n),this._setJoinStyle(r),void 0!==o&&(y.miterLimit=o),y.lineWidth=m;for(let t of d)if(t=(0,s.o8)(t),G(t),t&&!(t.length<=1)){b=this.transformPt(t[0]);for(let e=1;e<t.length;e++){S=this.transformPt(t[e]);const i=N(b,S),n=new DOMMatrix;n.translateSelf(0,b[1]-m/2).scaleSelf(g,g,1).rotateSelf(0,0,90-i),v.setTransform(n),y.strokeStyle=v,y.beginPath(),y.moveTo(b[0],b[1]),y.lineTo(S[0],S[1]),y.stroke(),b=S}}y.restore()}_buildPath(t,e){const i=this._ctx;if(i.beginPath(),t)for(const n of t){const t=n?n.length:0;if(t>1){let r=this.transformPt(n[0]);i.moveTo(r[0],r[1]);for(let e=1;e<t;e++)r=this.transformPt(n[e]),i.lineTo(r[0],r[1]);e&&i.closePath()}}}_setCapStyle(t){switch(t){case v.uT.Butt:this._ctx.lineCap="butt";break;case v.uT.Round:this._ctx.lineCap="round";break;case v.uT.Square:this._ctx.lineCap="square"}}_setJoinStyle(t){switch(t){case v.wd.Bevel:this._ctx.lineJoin="bevel";break;case v.wd.Round:this._ctx.lineJoin="round";break;case v.wd.Miter:this._ctx.lineJoin="miter"}}}function L(t,e,i){for(const n of e){const e=n.length;for(let r=1;r<e;r++){const e=n[r-1],s=n[r];let o=(s[0]-e[0])*(s[0]-e[0])+(s[1]-e[1])*(s[1]-e[1]);if(0===o)continue;o=Math.sqrt(o);const a=((s[0]-e[0])*(t[1]-e[1])-(s[1]-e[1])*(t[0]-e[0]))/o;if(Math.abs(a)<i){const n=((s[0]-e[0])*(t[0]-e[0])+(s[1]-e[1])*(t[1]-e[1]))/o;if(n>-i&&n<o+i)return!0}}}return!1}function N(t,e){const i=e[0]-t[0],n=e[1]-t[1];return 180/Math.PI*Math.atan2(n,i)}const B=t=>t?{spatialReference:t.spatialReference,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}:null,k=(t,e,i)=>{switch(t){case"ExtraLeading":return 1+e/i;case"Multiple":return e;case"Exact":return e/i}};function V(t,e=1){const i=(0,P.DW)(t),r=(0,P._d)(t.fontStyleName),s=t.fontFamilyName??n.Vb,{weight:o,style:a}=r,l=e*(t.height||5),c=(0,P.Bu)(t.horizontalAlignment),u=(0,P.Nl)(t.verticalAlignment),h=(0,P.pM)(t),d=(0,P.pM)(t.haloSymbol),f=null!=d?e*(t.haloSize??0):0,_="CIMBackgroundCallout"===t.callout?.type?t.callout.backgroundSymbol:null,p=(0,P.pM)(_),m=(0,P.xo)(_),g=(0,P._1)(_);return{color:h,size:l,horizontalAlignment:c,verticalAlignment:u,font:{family:s,style:(0,P.pV)(a),weight:(0,P.Kn)(o),decoration:i},halo:{size:f||0,color:d,style:a},backgroundColor:p,borderLine:null!=m&&null!=g?{size:m,color:g}:null,pixelRatio:1,premultiplyColors:!0}}const U=1e-4;function G(t){let e,i,n,r,s,o=t[0],a=1;for(;a<t.length;)e=t[a][0]-o[0],i=t[a][1]-o[1],r=0!==e?i/e:Math.PI/2,void 0!==n&&r-n<=U?(t.splice(a-1,1),o=s):(s=o,o=t[a],a++),n=r}},57176:function(t,e,i){i.d(e,{BW:function(){return H},Sc:function(){return O},Vb:function(){return E},ll:function(){return R},ni:function(){return D},wp:function(){return F}});var n=i(90152),r=i(58941),s=i(21609),o=i(40633),a=i(13798),l=i(13520),c=i(87416),u=i(35068),h=i(90046),d=i(29076),f=i(14817),_=i(38821),p=i(33389),m=i(7590),g=i(74661),y=i(7056),v=i(39686),x=i(17469),b=i(96700);const S=Math.PI,w=S/2,T=Math.PI/180,M=96/72,P=()=>o.A.getLogger("esri.symbols.cim.CIMSymbolHelper");function E(t){let e;switch(t.type){case"cim":return t.data;case"web-style":return t;case"simple-marker":{const i=F.fromSimpleMarker(t);if(!i)throw new Error("InternalError: Cannot convert symbol to CIM");e=i;break}case"picture-marker":e=F.fromPictureMarker(t);break;case"simple-line":e=F.fromSimpleLineSymbol(t);break;case"simple-fill":e=F.fromSimpleFillSymbol(t);break;case"picture-fill":e=F.fromPictureFillSymbol(t);break;case"text":e=F.fromTextSymbol(t)}return{type:"CIMSymbolReference",symbol:e}}function A(t,e,i){switch(e.type){case"CIMSymbolReference":return A(t,e.symbol,i);case"CIMPointSymbol":null==i&&(i={x:0,y:0}),t.drawSymbol(e,i);break;case"CIMLineSymbol":null==i&&(i={paths:[[[0,0],[10,0]]]}),t.drawSymbol(e,i);break;case"CIMPolygonSymbol":null==i&&(i={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]}),t.drawSymbol(e,i);break;case"CIMTextSymbol":{const i={x:0,y:0};t.drawSymbol(e,i);break}case"CIMVectorMarker":{const i=new d.W;t.drawMarker(e,i);break}}return t.envelope()}function C(t){if(!t)return 0;switch(t.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAtExtremities":case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementAtRatioPositions":case"CIMMarkerPlacementOnLine":case"CIMMarkerPlacementOnVertices":return Math.abs(t.offset);default:return 0}}function I(t){if(!t)return 0;switch(t.type){case"CIMGeometricEffectArrow":return Math.abs(.5*t.width);case"CIMGeometricEffectBuffer":return Math.abs(t.size);case"CIMGeometricEffectControlMeasureLine":return 500;case"CIMGeometricEffectExtension":case"CIMGeometricEffectRadial":return Math.abs(t.length);case"CIMGeometricEffectJog":return Math.abs(.5*t.length);case"CIMGeometricEffectMove":return Math.max(Math.abs((0,m.$w)(t.offsetX)),Math.abs((0,m.$w)(t.offsetY)));case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":return Math.abs(t.offset);case"CIMGeometricEffectRegularPolygon":return Math.abs(t.radius);case"CIMGeometricEffectRotate":case"CIMGeometricEffectScale":default:return 0;case"CIMGeometricEffectTaperedPolygon":return.5*Math.max(Math.abs(t.fromWidth),Math.abs(t.toWidth));case"CIMGeometricEffectWave":return Math.abs(t.amplitude);case"CIMGeometricEffectDonut":return Math.abs(t.width)}}function R(t){if(!t)return 0;let e=0;for(const i of t)e+=I(i);return e}class O{static getSymbolInflateSize(t,e,i,n,r){return t||(t=[0,0,0,0]),e?this._getInflateSize(t,e,i,n,r):t}static safeSize(t){const e=Math.max(Math.abs(t[0]),Math.abs(t[2])),i=Math.max(Math.abs(t[1]),Math.abs(t[3]));return Math.sqrt(e*e+i*i)}static _vectorMarkerBounds(t,e,i,n){let r=!0;const s=(0,c.vt)();if(e?.markerGraphics)for(const o of e.markerGraphics){const e=[0,0,0,0];o.geometry&&((0,u.Rg)(s,o.geometry),e[0]=0,e[1]=0,e[2]=0,e[3]=0,this.getSymbolInflateSize(e,o.symbol,i,0,n),s[0]+=e[0],s[1]+=e[1],s[2]+=e[2],s[3]+=e[3],r?(t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],r=!1):(t[0]=Math.min(t[0],s[0]),t[1]=Math.min(t[1],s[1]),t[2]=Math.max(t[2],s[2]),t[3]=Math.max(t[3],s[3])))}return t}static _getInflateSize(t,e,i,n,r){if(function(t){return void 0!==t.symbolLayers}(e)){const s=this._getLayersInflateSize(t,e.symbolLayers,i,n,r),o=R(e.effects);return o>0&&(s[0]-=o,s[1]-=o,s[2]+=o,s[3]+=o),s}return this._getTextInflatedSize(t,e,r)}static _getLayersInflateSize(t,e,i,n,r){let s=!0;if(!e)return t;for(const o of e){if(!o)continue;let e=[0,0,0,0];switch(o.type){case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const t=o;let i=t.width;null!=i&&(t.capStyle===p.uT.Square||t.joinStyle===p.wd.Miter?i/=1.4142135623730951:i/=2,e[0]=-i,e[1]=-i,e[2]=i,e[3]=i);break}case"CIMCharacterMarker":case"CIMVectorMarker":case"CIMPictureMarker":{const t=o;if("CIMVectorMarker"===o.type){const t=o;if(e=this._vectorMarkerBounds(e,t,i,r),t.frame){const i=(t.frame.xmin+t.frame.xmax)/2,n=(t.frame.ymin+t.frame.ymax)/2;if(e[0]-=i,e[1]-=n,e[2]-=i,e[3]-=n,null!=t.size){const i=t.size/(t.frame.ymax-t.frame.ymin);e[0]*=i,e[1]*=i,e[2]*=i,e[3]*=i}}}else if("CIMPictureMarker"===o.type){const n=o,r=i.getResource(n.url);let s=1;if(null!=r&&r.height&&(s=r.width/r.height),null!=t.size){const i=t.size/2,r=t.size*s*n.scaleX/2;e=[-r,-i,r,i]}}else if(null!=t.size){const i=t.size/2;e=[-i,-i,i,i]}if(t.anchorPoint){let i,n;"Absolute"===t.anchorPointUnits?(i=t.anchorPoint.x,n=t.anchorPoint.y):(i=t.anchorPoint.x*(e[2]-e[0]),n=t.anchorPoint.y*(e[3]-e[1]));const r=1.25*Math.sqrt(i*i+n*n);e[0]-=r,e[1]-=r,e[2]+=r,e[3]+=r}let s=(0,m.$w)(t.rotation);if(t.rotateClockwise&&(s=-s),n&&(s-=n),s){const t=T*s,i=Math.cos(t),n=Math.sin(t),r=(0,c.vt)([y.MG,y.MG,-y.MG,-y.MG]);(0,c.tK)(r,[e[0]*i-e[1]*n,e[0]*n+e[1]*i]),(0,c.tK)(r,[e[0]*i-e[3]*n,e[0]*n+e[3]*i]),(0,c.tK)(r,[e[2]*i-e[1]*n,e[2]*n+e[1]*i]),(0,c.tK)(r,[e[2]*i-e[3]*n,e[2]*n+e[3]*i]),e=r}let a=(0,m.$w)(t.offsetX),l=(0,m.$w)(t.offsetY);if(n){const t=T*n,e=Math.cos(t),i=Math.sin(t),r=a*i+l*e;a=a*e-l*i,l=r}e[0]+=a,e[1]+=l,e[2]+=a,e[3]+=l;const u=C(t.markerPlacement);u>0&&(e[0]-=u,e[1]-=u,e[2]+=u,e[3]+=u);break}}const a=R(o.effects);a>0&&(e[0]-=a,e[1]-=a,e[2]+=a,e[3]+=a),s?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],s=!1):(t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[2]),t[3]=Math.max(t[3],e[3]))}return t}static _getTextInflatedSize(t,e,i){const n=(0,b.hV)(e.height??_.D.CIMTextSymbol.height);if(t[0]=-n/2,t[1]=-n/2,t[2]=n/2,t[3]=n/2,!i)return t;const r=i.get(e);if(!r)return t;if(!r.glyphMosaicItems.glyphs.length)return t;const{lineGapType:s,lineGap:o}=e,a=s?(0,f.QF)(s,o??0,n):0,l="CIMBackgroundCallout"===e.callout?.type,c=(0,x.Tl)(r.glyphMosaicItems,{scale:n/v.eG,angle:(0,m.$w)(e.angle),xOffset:(0,m.$w)(e.offsetX),yOffset:(0,m.$w)(e.offsetY),horizontalAlignment:e.horizontalAlignment,verticalAlignment:e.verticalAlignment,maxLineWidth:(0,b.Lu)(e.lineWidth),lineHeight:v.DY*Math.max(.25,Math.min(a||1,4)),decoration:e.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:l}).boundsT,u=Math.sqrt(c.width*c.width+c.height*c.height);return t[0]-=c.x+u,t[1]-=c.y-u,t[2]+=c.x+u,t[3]+=-c.y+u,t}}class F{static getEnvelope(t,e,i){if(!t)return null;const n=new f.mx(i);if(Array.isArray(t)){let i;for(const r of t)i?i.union(A(n,r,e)):i=A(n,r,e);return i}return A(n,t,e)}static getTextureAnchor(t,e){const i=this.getEnvelope(t,null,e);if(!i)return[0,0,0];const n=(i.x+.5*i.width)*M,r=(i.y+.5*i.height)*M,s=i.width*M+2,o=i.height*M+2;return[-n/s,-r/o,o]}static rasterize(t,e,i,n,r=!0){const s=i||this.getEnvelope(e,null,n);if(!s)return[null,0,0,0,0];const o=(s.x+.5*s.width)*M,a=(s.y+.5*s.height)*M;t.width=s.width*M,t.height=s.height*M,i||(t.width+=2,t.height+=2);const l=t.getContext("2d",{willReadFrequently:!0}),c=f.IT.createScale(M,-M);c.translate(.5*t.width-o,.5*t.height+a);const u=new f.Rj(l,n,c);switch(e.type){case"CIMPointSymbol":{const t={type:"point",x:0,y:0};u.drawSymbol(e,t);break}case"CIMVectorMarker":{const t=new d.W;u.drawMarker(e,t);break}}const h=l.getImageData(0,0,t.width,t.height),_=new Uint8Array(h.data);if(r){let t;for(let e=0;e<_.length;e+=4)t=_[e+3]/255,_[e]=_[e]*t,_[e+1]=_[e+1]*t,_[e+2]=_[e+2]*t}return[_,t.width,t.height,-o/t.width,-a/t.height]}static fromTextSymbol(t){const{text:e}=t;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:F.createCIMTextSymbolfromTextSymbol(t),textString:e}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(t){const{height:e,outline:i,width:n,xoffset:r,xscale:s,yoffset:o,yscale:a}=t,l=[],c={type:"CIMPolygonSymbol",symbolLayers:l};if(i){const t=Z(i);t&&l.push(t)}let u=t.url;"esriPFS"===t.type&&t.imageData&&(u=t.imageData);const h="angle"in t?t.angle??0:0,d=(n??0)*(s||1),f=(e??0)*(a||1);return l.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:p.O$.Picture,tintColor:null,url:u,height:f,width:d,offsetX:(0,m.$w)(r),offsetY:(0,m.$w)(o),rotation:(0,m.$w)(-h),colorSubstitutions:null}),c}static fromSimpleFillSymbol(t){const{color:e,style:i,outline:n}=t,r=[],o={type:"CIMPolygonSymbol",symbolLayers:r};if(n){const t=Z(n);t&&r.push(t)}if(i&&"solid"!==i&&"none"!==i&&"esriSFSSolid"!==i&&"esriSFSNull"!==i){const t={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:k(e),capStyle:p.uT.Butt,joinStyle:p.wd.Miter,width:.75}]};let n=0;const o=(0,l.PN)(W(i)?8:10);switch(i){case"vertical":case"esriSFSVertical":n=90;break;case"forward-diagonal":case"esriSFSForwardDiagonal":case"diagonal-cross":case"esriSFSDiagonalCross":n=-45;break;case"backward-diagonal":case"esriSFSBackwardDiagonal":n=45;break;case"cross":case"esriSFSCross":n=0}r.push({type:"CIMHatchFill",lineSymbol:t,offsetX:0,offsetY:0,rotation:n,separation:o}),"cross"===i||"esriSFSCross"===i?r.push({type:"CIMHatchFill",lineSymbol:(0,s.o8)(t),offsetX:0,offsetY:0,rotation:90,separation:o}):"diagonal-cross"!==i&&"esriSFSDiagonalCross"!==i||r.push({type:"CIMHatchFill",lineSymbol:(0,s.o8)(t),offsetX:0,offsetY:0,rotation:45,separation:o})}else!i||"solid"!==i&&"esriSFSSolid"!==i||r.push({type:"CIMSolidFill",enable:!0,color:k(e)});return o}static fromSimpleLineSymbol(t){const{cap:e,color:i,join:n,marker:r,miterLimit:s,style:o,width:a}=t;let l=null;"solid"!==o&&"none"!==o&&"esriSLSSolid"!==o&&"esriSLSNull"!==o&&(l=[{type:"CIMGeometricEffectDashes",dashTemplate:H(o,e),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const c=[];if(r){let t;switch(r.placement){case"begin-end":t=p.$2.Both;break;case"begin":t=p.$2.JustBegin;break;case"end":t=p.$2.JustEnd;break;default:t=p.$2.None}const e=F.fromSimpleMarker(r,a,i).symbolLayers[0];e.markerPlacement={type:"CIMMarkerPlacementAtExtremities",placePerPart:!1,angleToLine:!0,offset:0,extremityPlacement:t,offsetAlongLine:0},c.push(e)}return c.push({type:"CIMSolidStroke",color:"none"!==o&&"esriSLSNull"!==o?k(i):[0,0,0,0],capStyle:D(e),joinStyle:L(n),miterLimit:s,width:a,effects:l}),{type:"CIMLineSymbol",symbolLayers:c}}static fromPictureMarker(t){const{angle:e,height:i,width:n,xoffset:r,yoffset:s}=t;let o=t.url;return"esriPMS"===t.type&&t.imageData&&(o=t.imageData),{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:p.O$.Picture,tintColor:null,url:o,size:i,width:n,offsetX:(0,m.$w)(r),offsetY:(0,m.$w)(s),rotation:(0,m.$w)(-e)}]}}static createCIMTextSymbolfromTextSymbol(t){const{angle:e,color:i,font:r,haloColor:s,haloSize:o,horizontalAlignment:a,kerning:l,lineWidth:c,text:u,verticalAlignment:h,xoffset:d,yoffset:f,backgroundColor:_,borderLineColor:g,borderLineSize:y}=t;let v,x,b,S,w,T;r&&(v=r.family,x=r.style,b=r.weight,S=r.size,w=r.decoration);let M=!1;return u&&(M=(0,n.y)(u)[1]),(_||y)&&(T={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:k(_)},{type:"CIMSolidStroke",color:k(g),width:y}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null}),{type:"CIMTextSymbol",angle:e,blockProgression:p.TZ.BTT,depth3D:1,extrapolateBaselines:!0,fontEffects:p.Y.Normal,fontEncoding:p.bj.Unicode,fontFamilyName:v||"Arial",fontStyleName:V(x,b),fontType:p.g7.Unspecified,haloSize:o,height:S,hinting:p.mU.Default,horizontalAlignment:N(a??"center"),kerning:l,letterWidth:100,ligatures:!0,lineGapType:"Multiple",lineWidth:c,offsetX:(0,m.$w)(d),offsetY:(0,m.$w)(f),strikethrough:"line-through"===w,underline:"underline"===w,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:k(i)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:k(s)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:M?p.f0.RTL:p.f0.LTR,verticalAlignment:B(h??"baseline"),verticalGlyphOrientation:p.vG.Right,wordSpacing:100,billboardMode3D:p.xn.FaceNearPlane,callout:T}}static createPictureMarkerRasterizationParam(t){const{angle:e,height:i,width:n,xoffset:r,yoffset:s}=t,o=t.url??t.source?.url??t.source?.imageData;return o?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:p.O$.Picture,tintColor:null,url:o,size:i,width:n,offsetX:(0,m.$w)(r),offsetY:(0,m.$w)(s),rotation:(0,m.$w)(-e)}}:null}static createPictureFillRasterizationParam(t){const{width:e,height:i,xoffset:n,yoffset:r,url:s}=t;return s?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureFill",scaleX:1,textureFilter:p.O$.Picture,tintColor:null,url:s,width:e,height:i,offsetX:(0,m.$w)(n),offsetY:(0,m.$w)(r),rotation:0}}:null}static fromSimpleMarker(t,e,i){const{style:n}=t,r=t.color??i;if("path"===n||"esriSMSPath"===n){const e=[];if("outline"in t&&t.outline){const i=t.outline;e.push({type:"CIMSolidStroke",enable:!0,width:i.width,color:k(i.color),path:t.path})}e.push({type:"CIMSolidFill",enable:!0,color:k(r),path:t.path});const[i,n]=Y("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:-(0,m.$w)(t.angle),size:(0,m.$w)(t.size||6),offsetX:(0,m.$w)(t.xoffset),offsetY:(0,m.$w)(t.yoffset),scaleSymbolsProportionally:!1,frame:i,markerGraphics:[{type:"CIMMarkerGraphic",geometry:n,symbol:{type:"CIMPolygonSymbol",symbolLayers:e}}]}]}}const s=[];let o,a,l=t.size;if("outline"in t&&t.outline&&"none"!==t.outline.style&&"esriSLSNull"!==t.outline.style){const e=t.outline,i="solid"!==e.style&&"esriSLSSolid"!==e.style;[o,a]=i?Y(n,t.size):Y(n);const r=e.width??g.A7.width;if(i){const e=r/t.size,i=(o.xmax-o.xmin)*e/2,n=(o.ymax-o.ymin)*e/2;o.xmin-=i,o.xmax+=i,o.ymin-=n,o.ymax+=n,l&&(l+=r)}const c="cross"!==t.style&&"x"!==t.style||"dot"===t?.outline.style||"short-dot"===t?.outline.style?p.yS.HalfGap:p.yS.FullPattern,u=i?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:H(e.style,null).map((t=>e.width&&e.width>0?t*e.width:t)),lineDashEnding:c,controlPointEnding:p.yS.FullPattern}]:void 0;s.push({type:"CIMSolidStroke",capStyle:i?p.uT.Round:p.uT.Butt,enable:!0,width:r,color:k(e.color),effects:u})}else!e||"line-marker"!==t.type||"cross"!==t.style&&"x"!==t.style?[o,a]=Y(n):([o,a]=Y(n),s.push({type:"CIMSolidStroke",enable:!0,width:e,color:k(r)}));s.push({type:"CIMSolidFill",enable:!0,color:k(r)});const c={type:"CIMPolygonSymbol",symbolLayers:s};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:(0,m.$w)(-t.angle),size:(0,m.$w)(l||6*e),offsetX:(0,m.$w)(t.xoffset),offsetY:(0,m.$w)(t.yoffset),scaleSymbolsProportionally:!1,frame:o,markerGraphics:[{type:"CIMMarkerGraphic",geometry:a,symbol:c}]}]}}static fromCIMHatchFill(t,e){const i=e*(t.separation??_.D.CIMHatchFill.separation),n=i/2,r=(0,s.o8)(t.lineSymbol);r.symbolLayers?.forEach((t=>{switch(t.type){case"CIMSolidStroke":null!=t.width&&(t.width*=e),t.effects?.forEach((t=>{if("CIMGeometricEffectDashes"===t.type){const i=t.dashTemplate;t.dashTemplate=i?.map((t=>t*e))}}));break;case"CIMVectorMarker":{null!=t.size&&(t.size*=e);const i=t.markerPlacement;null!=i&&"placementTemplate"in i&&(i.placementTemplate=i.placementTemplate.map((t=>t*e)));break}}}));let o=this._getLineSymbolPeriod(r)||4;for(;o<4;)o*=2;const a=o/2;return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-n,ymax:n},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-a,0],[a,0]]]},symbol:r}],size:i}}static fetchResources(t,e,i,n=null){return t&&e?(z(t,(t=>{(function(t,e,i){t.effects&&null==e.geometryEngine&&(e.geometryEnginePromise?i.push(e.geometryEnginePromise):(0,m.yH)(t.effects)&&(e.geometryEnginePromise=(0,m._H)(),i.push(e.geometryEnginePromise),e.geometryEnginePromise.then((t=>e.geometryEngine=t))))})(t,e,i),"url"in t&&t.url&&i.push(e.fetchResource(t.url,{signal:n}))})),i):i}static fetchFonts(t,e,i){if(t&&e)if("symbolLayers"in t&&t.symbolLayers){for(const n of t.symbolLayers)if("CIMVectorMarker"===n.type&&n.markerGraphics)for(const t of n.markerGraphics)t?.symbol&&F.fetchFonts(t.symbol,e,i)}else if("CIMTextSymbol"===t.type){const{fontFamilyName:n,fontStyleName:r}=t;if(!n||"calcitewebcoreicons"===n.toLowerCase())return;const{style:s,weight:o}=(0,m._d)(r),a=(0,m.DW)(t),l=new h.A({family:n,style:s,weight:o,decoration:a});i.push(e.loadFont(l).catch((()=>{P().error(`Unsupported font ${n} in CIM symbol`)})))}}static _getLineSymbolPeriod(t){if(t){const e=this._getEffectsRepeat(t.effects);if(e)return e;if(t.symbolLayers)for(const e of t.symbolLayers)if(e){const t=this._getEffectsRepeat(e.effects);if(t)return t;switch(e.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const t=this._getPlacementRepeat(e.markerPlacement);if(t)return t}}}}return 0}static _getEffectsRepeat(t){if(t)for(const e of t)if(e)switch(e.type){case"CIMGeometricEffectDashes":{const t=e.dashTemplate;if(t&&t.length){let e=0;for(const i of t)e+=i;return 1&t.length&&(e*=2),e}break}case"CIMGeometricEffectWave":return e.period;default:P().error(`unsupported geometric effect type ${e.type}`)}return 0}static _getPlacementRepeat(t){if(t)switch(t.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineVariableSize":{const e=t.placementTemplate;if(e&&e.length){let t=0;for(const i of e)t+=+i;return 1&e.length&&(t*=2),t}break}}return 0}static fromCIMInsidePolygon(t){const e=t.markerPlacement,i={...t};i.markerPlacement=null,i.anchorPoint=null;const n=Math.abs(e.stepX),r=Math.abs(e.stepY),s=(e.randomness??100)/100;let o,c,u,h;if("Random"===e.gridType){const t=(0,l.PN)(v.yv),i=Math.max(Math.floor(t/n),1),d=Math.max(Math.floor(t/r),1);o=i*n/2,c=d*r/2,u=2*c;const f=new a.A(e.seed),_=s*n/1.5,p=s*r/1.5;h=[];for(let t=0;t<i;t++)for(let e=0;e<d;e++){const i=t*n-o+_*(.5-f.getFloat()),s=e*r-c+p*(.5-f.getFloat());h.push({x:i,y:s}),0===t&&h.push({x:i+2*o,y:s}),0===e&&h.push({x:i,y:s+2*c})}}else!0===e.shiftOddRows?(o=n/2,c=r,u=2*r,h=[{x:-o,y:0},{x:o,y:0},{x:0,y:c},{x:0,y:-c}]):(o=n/2,c=r/2,u=r,h=[{x:-n,y:0},{x:0,y:-r},{x:-n,y:-r},{x:0,y:0},{x:n,y:0},{x:0,y:r},{x:n,y:r},{x:-n,y:r},{x:n,y:-r}]);return{type:"CIMVectorMarker",frame:{xmin:-o,xmax:o,ymin:-c,ymax:c},markerGraphics:h.map((t=>({type:"CIMMarkerGraphic",geometry:t,symbol:{type:"CIMPointSymbol",symbolLayers:[i]}}))),size:u}}}function z(t,e){if(t)switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const i=t.symbolLayers;if(!i)return;for(const t of i)if(e(t),"CIMVectorMarker"===t.type){const i=t.markerGraphics;if(!i)continue;for(const t of i)if(t){const i=t.symbol;i&&z(i,e)}}break}}}const D=t=>{if(!t)return p.uT.Butt;switch(t){case"butt":return p.uT.Butt;case"square":return p.uT.Square;case"round":return p.uT.Round}},L=t=>{if(!t)return p.wd.Miter;switch(t){case"miter":return p.wd.Miter;case"round":return p.wd.Round;case"bevel":return p.wd.Bevel}},N=t=>{if(null==t)return"Center";switch(t){case"left":return"Left";case"right":return"Right";case"center":return"Center"}},B=t=>{if(null==t)return"Center";switch(t){case"baseline":return"Baseline";case"top":return"Top";case"middle":return"Center";case"bottom":return"Bottom"}},k=t=>{if(!t)return[0,0,0,0];const{r:e,g:i,b:n,a:r}=t;return[e,i,n,255*r]},V=(t,e)=>{const i=U(e),n=G(t);return i&&n?`${i}-${n}`:`${i}${n}`},U=t=>{if(!t)return"";switch(t.toLowerCase()){case"bold":case"bolder":return"bold"}return""},G=t=>{if(!t)return"";switch(t.toLowerCase()){case"italic":case"oblique":return"italic"}return""},H=(t,e)=>{const i=(0,r.A)("safari")?.001:0,n="butt"===e;switch(t){case"dash":case"esriSLSDash":return n?[4,3]:[3,4];case"dash-dot":case"esriSLSDashDot":return n?[4,3,1,3]:[3,4,i,4];case"dot":case"esriSLSDot":return n?[1,3]:[i,4];case"long-dash":case"esriSLSLongDash":return n?[8,3]:[7,4];case"long-dash-dot":case"esriSLSLongDashDot":return n?[8,3,1,3]:[7,4,i,4];case"long-dash-dot-dot":case"esriSLSDashDotDot":return n?[8,3,1,3,1,3]:[7,4,i,4,i,4];case"short-dash":case"esriSLSShortDash":return n?[4,1]:[3,2];case"short-dash-dot":case"esriSLSShortDashDot":return n?[4,1,1,1]:[3,2,i,2];case"short-dash-dot-dot":case"esriSLSShortDashDotDot":return n?[4,1,1,1,1,1]:[3,2,i,2,i,2];case"short-dot":case"esriSLSShortDot":return n?[1,1]:[i,2];case"solid":case"esriSLSSolid":case"none":return P().error("Unexpected: style does not require rasterization"),[0,0];default:return P().error(`Tried to rasterize SLS, but found an unexpected style: ${t}!`),[0,0]}},Y=(t,e=100)=>{const i=e/2;let n,r;const s=t;if("circle"===s||"esriSMSCircle"===s){const t=.25;let e=Math.acos(1-t/i),s=Math.ceil(S/e/4);0===s&&(s=1),e=w/s,s*=4;const o=[];o.push([i,0]);for(let t=1;t<s;t++)o.push([i*Math.cos(t*e),-i*Math.sin(t*e)]);o.push([i,0]),n={rings:[o]},r={xmin:-i,ymin:-i,xmax:i,ymax:i}}else if("cross"===s||"esriSMSCross"===s){const t=0;n={paths:[[[t,i],[t,-i]],[[i,t],[-i,t]]]},r={xmin:-i,ymin:-i,xmax:i,ymax:i}}else if("diamond"===s||"esriSMSDiamond"===s)n={rings:[[[-i,0],[0,i],[i,0],[0,-i],[-i,0]]]},r={xmin:-i,ymin:-i,xmax:i,ymax:i};else if("square"===s||"esriSMSSquare"===s)n={rings:[[[-i,-i],[-i,i],[i,i],[i,-i],[-i,-i]]]},r={xmin:-i,ymin:-i,xmax:i,ymax:i};else if("x"===s||"esriSMSX"===s)n={paths:[[[i,i],[-i,-i]],[[i,-i],[-i,i]]]},r={xmin:-i,ymin:-i,xmax:i,ymax:i};else if("triangle"===s||"esriSMSTriangle"===s){const t=.5773502691896257*e,i=-t,s=2/3*e,o=s-e;n={rings:[[[i,o],[0,s],[t,o],[i,o]]]},r={xmin:i,ymin:o,xmax:t,ymax:s}}else"arrow"===s&&(n={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},r={xmin:-i,ymin:-i,xmax:i,ymax:i});return[r,n]},W=t=>"vertical"===t||"horizontal"===t||"cross"===t||"esriSFSCross"===t||"esriSFSVertical"===t||"esriSFSHorizontal"===t;function Z(t){if(!t)return null;let e=null;const{cap:i,color:n,join:r,miterLimit:s,style:o,width:a}=t;return"solid"!==o&&"none"!==o&&"esriSLSSolid"!==o&&"esriSLSNull"!==o&&(e=[{type:"CIMGeometricEffectDashes",dashTemplate:H(o,i),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]),{type:"CIMSolidStroke",color:"esriSLSNull"!==o&&"none"!==o?k(n):[0,0,0,0],capStyle:D(i),joinStyle:L(r),miterLimit:s,width:a,effects:e}}},93996:function(t,e,i){i.d(e,{I:function(){return o},U:function(){return s}});var n=i(33134),r=i(33389);const s=.03;class o{constructor(t=0,e=!1){}isEmpty(t){if(!t.nextPoint())return!0;let e,i,n,r;for(e=t.x,i=t.y;t.nextPoint();e=i,i=r)if(n=t.x,r=t.y,n!==e||r!==i)return t.seekPathStart(),!1;return t.seekPathStart(),!0}normalize(t){const e=Math.sqrt(t[0]*t[0]+t[1]*t[1]);0!==e&&(t[0]/=e,t[1]/=e)}getLength(t,e,i,n){const r=i-t,s=n-e;return Math.sqrt(r*r+s*s)}getSegLength(t){const[[e,i],[n,r]]=t;return this.getLength(e,i,n,r)}getCoord2D(t,e,i,n,r){return[t+(i-t)*r,e+(n-e)*r]}getSegCoord2D(t,e){const[[i,n],[r,s]]=t;return this.getCoord2D(i,n,r,s,e)}getAngle(t,e,i,n,r){const s=i-t,o=n-e;return Math.atan2(o,s)}getAngleCS(t,e,i,n,r){const s=i-t,o=n-e,a=Math.sqrt(s*s+o*o);return a>0?[s/a,o/a]:[1,0]}getSegAngleCS(t,e){const[[i,n],[r,s]]=t;return this.getAngleCS(i,n,r,s,e)}cut(t,e,i,n,r,s){return[r<=0?[t,e]:this.getCoord2D(t,e,i,n,r),s>=1?[i,n]:this.getCoord2D(t,e,i,n,s)]}getSubCurve(t,e,i){const r=n.z.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(r,t,e,i)?r:null}appendSubCurve(t,e,i,n){t.startPath(),e.seekPathStart();let r=0,s=!0;if(!e.nextPoint())return!1;let o=e.x,a=e.y;for(;e.nextPoint();){const l=this.getLength(o,a,e.x,e.y);if(0!==l){if(s){if(r+l>i){const c=(i-r)/l;let u=1,h=!1;r+l>=n&&(u=(n-r)/l,h=!0);const d=this.cut(o,a,e.x,e.y,c,u);if(d&&t.pushPoints(d),h)break;s=!1}}else{if(r+l>n){const i=this.cut(o,a,e.x,e.y,0,(n-r)/l);i&&t.pushPoint(i[1]);break}t.pushXY(e.x,e.y)}r+=l,o=e.x,a=e.y}else o=e.x,a=e.y}return!0}getCIMPointAlong(t,e){if(!t.nextPoint())return null;let i,n,r,s,o=0;for(i=t.x,n=t.y;t.nextPoint();i=r,n=s){r=t.x,s=t.y;const a=this.getLength(i,n,r,s);if(0!==a){if(o+a>e){const t=(e-o)/a;return this.getCoord2D(i,n,r,s,t)}o+=a}}return null}offset(t,e,i,n,s){if(!t||t.length<2)return null;let o=0,a=t[o++],l=o;for(;o<t.length;){const e=t[o];e[0]===a[0]&&e[1]===a[1]||(o!==l&&(t[l]=t[o]),a=t[l++]),o++}const c=t[0][0]===t[l-1][0]&&t[0][1]===t[l-1][1];if(c&&--l,l<(c?3:2))return null;const u=[];a=c?t[l-1]:null;let h=t[0];for(let s=0;s<l;s++){const o=s===l-1?c?t[0]:null:t[s+1];if(a)if(o){const t=[o[0]-h[0],o[1]-h[1]];this.normalize(t);const s=[h[0]-a[0],h[1]-a[1]];this.normalize(s);const l=s[0]*t[1]-s[1]*t[0],c=s[0]*t[0]+s[1]*t[1];if(0===l&&1===c){h=o;continue}if(l>=0==e<=0){if(c<1){const i=[t[0]-s[0],t[1]-s[1]];this.normalize(i);const r=Math.sqrt((1+c)/2);if(r>1/n){const t=-Math.abs(e)/r;u.push([h[0]-i[0]*t,h[1]-i[1]*t])}}}else switch(i){case r.xw.Mitered:{const i=Math.sqrt((1+c)/2);if(i>0&&1/i<n){const n=[t[0]-s[0],t[1]-s[1]];this.normalize(n);const r=Math.abs(e)/i;u.push([h[0]-n[0]*r,h[1]-n[1]*r]);break}}case r.xw.Bevelled:u.push([h[0]+s[1]*e,h[1]-s[0]*e]),u.push([h[0]+t[1]*e,h[1]-t[0]*e]);break;case r.xw.Rounded:if(c<1){u.push([h[0]+s[1]*e,h[1]-s[0]*e]);const i=Math.floor(2.5*(1-c));if(i>0){const n=1/i;let r=n;for(let o=1;o<i;o++,r+=n){const i=[s[1]*(1-r)+t[1]*r,-s[0]*(1-r)-t[0]*r];this.normalize(i),u.push([h[0]+i[0]*e,h[1]+i[1]*e])}}u.push([h[0]+t[1]*e,h[1]-t[0]*e])}break;case r.xw.Square:default:if(l<0)u.push([h[0]+(s[1]+s[0])*e,h[1]+(s[1]-s[0])*e]),u.push([h[0]+(t[1]-t[0])*e,h[1]-(t[0]+t[1])*e]);else{const i=Math.sqrt((1+Math.abs(c))/2),n=[t[0]-s[0],t[1]-s[1]];this.normalize(n);const r=e/i;u.push([h[0]-n[0]*r,h[1]-n[1]*r])}}}else{const t=[h[0]-a[0],h[1]-a[1]];this.normalize(t),u.push([h[0]+t[1]*e,h[1]-t[0]*e])}else{const t=[o[0]-h[0],o[1]-h[1]];this.normalize(t),u.push([h[0]+t[1]*e,h[1]-t[0]*e])}a=h,h=o}return u.length<(c?3:2)?null:(c&&u.push([u[0][0],u[0][1]]),u)}}},65661:function(t,e,i){i.d(e,{VA:function(){return a},YQ:function(){return n},Z1:function(){return u},ps:function(){return l}});var n,r,s=i(33134),o=i(93996);class a{constructor(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}isEmpty(){return 0===this._values.length}size(){return this._values.length}init(t,e,i=!0){if(this._setEmpty(),!t||0===t.length)return!1;for(let e=0;e<t.length;e++){let n=Math.abs(t[e]);i&&n<1e-7&&(n=1e-7),this._values.push(n),this._length+=n}return e&&1&t.length&&(this._length*=2),0!==this._length&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)}scale(t){const e=this._values?this._values.length:0;for(let i=0;i<e;++i)this._values[i]*=t;this._length*=t,this.extPtGap*=t,this.ctrlPtGap*=t}addValue(t){this._length+=t,this._values.push(t)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0}}class l{constructor(){this.pt=null,this.ca=0,this.sa=0}}(r=n||(n={}))[r.FAIL=0]="FAIL",r[r.END=1]="END",r[r.CONTINUE=2]="CONTINUE";class c{constructor(){this.reset()}reset(){this.segment=null,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1}isValid(){return null!==this.segment}copyTo(t){t.segment=this.segment,t.segmentLength=this.segmentLength,t.abscissa=this.abscissa,t.isPathEnd=this.isPathEnd,t.isPartEnd=this.isPartEnd}}class u extends o.I{constructor(t=0,e=!1){super(t,e),this._tolerance=o.U,this._currentPosition=new c}updateTolerance(t){this._tolerance=o.U*t}init(t,e,i=!0){return i?(this._patternLength=e.length(),this._partExtPtGap=e.extPtGap,this._partCtrlPtGap=e.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._pathCursor=t,this._seg=-1,this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(t,e=n.FAIL){const i=new c;return!!this._nextPosition(t,i,null,e)&&(i.copyTo(this._currentPosition),!0)}curPointAndAngle(t){t.pt=this._getPoint(this._currentPosition);const[e,i]=this._getAngleCS(this._currentPosition);t.ca=e,t.sa=i}nextPointAndAngle(t,e,i=n.FAIL){const r=new c;if(!this._nextPosition(t,r,null,i))return!1;r.copyTo(this._currentPosition),e.pt=this._getPoint(r);const[s,o]=this._getAngleCS(r);return e.ca=s,e.sa=o,!0}nextCurve(t){if(0===t)return null;const e=s.z.createEmptyOptimizedCIM("esriGeometryPolyline");e.startPath(),e.nextPath();const i=new c;return this._nextPosition(t,i,e,n.END)?(i.copyTo(this._currentPosition),e):null}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(t){return this._pathCursor.seekInPath(t),[this._pathCursor.x,this._pathCursor.y]}getSeg(t){return[this.getPt(t),this.getPt(t+1)]}_nextPosition(t,e,i,r){if(this._currentPosition.isPathEnd)return!1;let s=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(s/=this._currentPosition.segmentLength),this._currentPosition.copyTo(e);e.abscissa+t*this._partLengthRatio>e.segmentLength+this._tolerance;){if(i){if(0===i.pathSize)if(0===s){const t=e.segment[0];i.pushXY(t[0],t[1])}else i.pushPoint(this.getSegCoord2D(e.segment,s));const t=e.segment[1];i.pushXY(t[0],t[1])}if(s=0,t-=(e.segmentLength-e.abscissa)/this._partLengthRatio,this._partSegCount)e.segment=this._nextSegment(),e.segmentLength=this.getSegLength(e.segment),e.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart())return r!==n.FAIL&&(e.segmentLength=this.getSegLength(e.segment),e.isPartEnd=!0,r===n.END?(e.abscissa=e.segmentLength,e.isPathEnd=!0):e.abscissa=e.segmentLength+t,!0);this._currentPosition.copyTo(e)}}if(e.abscissa+=t*this._partLengthRatio,i){0===i.pathSize&&(0===s?i.pushPoint(e.segment[0]):i.pushPoint(this.getSegCoord2D(e.segment,s)));const t=e.abscissa/e.segmentLength;1===t?i.pushPoint(e.segment[1]):i.pushPoint(this.getSegCoord2D(e.segment,t))}return this._partSegCount||Math.abs(e.abscissa-e.segmentLength)<this._tolerance&&(e.isPathEnd=this._partIsLast,e.isPartEnd=!0),!0}_getPoint(t){const e=t.segmentLength<=0?0:t.abscissa/t.segmentLength;return this.getSegCoord2D(this._currentPosition.segment,e)}_getAngleCS(t){const e=t.segmentLength<=0?0:t.abscissa/t.segmentLength;return this.getSegAngleCS(this._currentPosition.segment,e)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}let t=this._partSegCount;for(;t;)this._previousSegment(),--t;this._currentPosition.segment=this._nextSegment(),this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;const e=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(e);let i=e+this._partSegCount+1;if(i>=this._pathCursor.pathSize&&(i=0),this._ctrlPtEnd=this._pathCursor.getControlPointAt(i),this._patternLength>0){const t=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,e=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let i=Math.round((this._partLength-(t+e))/this._patternLength);i<=0&&(i=t+e>0?0:1),this._partLengthRatio=this._partLength/(t+e+i*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+1}}},82497:function(t,e,i){i.d(e,{A:function(){return n}});class n{constructor(t=0,e=0,i=0,n=0){this.x=t,this.y=e,this.width=i,this.height=n}static fromExtent(t){return new n(t.xmin,-t.ymax,t.xmax-t.xmin,t.ymax-t.ymin)}get isEmpty(){return this.width<=0||this.height<=0}union(t){this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.width=Math.max(this.width,t.width),this.height=Math.max(this.height,t.height)}}},44508:function(t,e,i){i.d(e,{Fj:function(){return u},Z7:function(){return c},ce:function(){return h},eR:function(){return a}});var n=i(5161),r=i(74697),s=i(82497),o=i(39686);function a(t){switch(t.type){case"CIMPointSymbol":{const e=t.symbolLayers;if(!e||1!==e.length)return null;const i=e[0];return"CIMVectorMarker"!==i.type?null:a(i)}case"CIMVectorMarker":{const e=t.markerGraphics;if(!e||1!==e.length)return null;const i=e[0];if(!i)return null;const n=i.geometry;if(!n)return null;const r=i.symbol;return!r||"CIMPolygonSymbol"!==r.type&&"CIMLineSymbol"!==r.type||r.symbolLayers?.some((t=>!!t.effects))?null:{type:"sdf",geom:n,asFill:"CIMPolygonSymbol"===r.type}}}}function l(t){let e=1/0,i=-1/0,n=1/0,r=-1/0;for(const s of t)for(const t of s)t[0]<e&&(e=t[0]),t[0]>i&&(i=t[0]),t[1]<n&&(n=t[1]),t[1]>r&&(r=t[1]);return[e,n,i,r]}function c(t){return t?t.rings?l(t.rings):t.paths?l(t.paths):(0,r.ZC)(t)?[t.xmin,t.ymin,t.xmax,t.ymax]:null:null}function u(t,e,i,n,r){const[s,a,l,c]=t;if(l<s||c<a)return[0,0,0,1];const u=l-s,h=c-a,d=o.p,f=o.hM,_=Math.floor(.5*(.5*d-f)),p=(d-2*(_+f))/Math.max(u,h),m=Math.round(u*p)+2*_,g=Math.round(h*p)+2*_;let y=1;e&&(y=g/p/(e.ymax-e.ymin));let v=0,x=0,b=1;n&&(r?e&&i&&e.ymax-e.ymin>0&&(b=(e.xmax-e.xmin)/(e.ymax-e.ymin),v=n.x/(i*b),x=n.y/i):(v=n.x,x=n.y)),e&&(v=.5*(e.xmax+e.xmin)+v*(e.xmax-e.xmin),x=.5*(e.ymax+e.ymin)+x*(e.ymax-e.ymin)),v-=s,x-=a,v*=p,x*=p,v+=_,x+=_;let S=v/m-.5,w=x/g-.5;return r&&i&&(S*=i*b,w*=i),[y,S,w,b]}function h(t){const e=function(t){return t?t.rings?t.rings:t.paths?t.paths:void 0!==t.xmin&&void 0!==t.ymin&&void 0!==t.xmax&&void 0!==t.ymax?[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]:null:null}(t.geom),i=function(t){let e=1/0,i=-1/0,n=1/0,r=-1/0;for(const s of t)for(const t of s)t[0]<e&&(e=t[0]),t[0]>i&&(i=t[0]),t[1]<n&&(n=t[1]),t[1]>r&&(r=t[1]);return new s.A(e,n,i-e,r-n)}(e),n=o.p,r=o.hM,a=Math.floor(.5*(.5*n-r)),l=(n-2*(a+r))/Math.max(i.width,i.height),c=Math.round(i.width*l)+2*a,u=Math.round(i.height*l)+2*a,h=[];for(const n of e)if(n&&n.length>1){const e=[];for(const r of n){let[n,s]=r;n-=i.x,s-=i.y,n*=l,s*=l,n+=a-.5,s+=a-.5,t.asFill?e.push([n,s]):e.push([Math.round(n),Math.round(s)])}if(t.asFill){const t=e.length-1;e[0][0]===e[t][0]&&e[0][1]===e[t][1]||e.push(e[0])}h.push(e)}const f=function(t,e,i,n){const r=e*i,s=new Array(r),o=n*n+1;for(let t=0;t<r;++t)s[t]=o;for(const r of t){const t=r.length;for(let o=1;o<t;++o){const t=r[o-1],a=r[o];let l,c,u,h;t[0]<a[0]?(l=t[0],c=a[0]):(l=a[0],c=t[0]),t[1]<a[1]?(u=t[1],h=a[1]):(u=a[1],h=t[1]);let d=Math.floor(l)-n,f=Math.floor(c)+n,_=Math.floor(u)-n,p=Math.floor(h)+n;d<0&&(d=0),f>e&&(f=e),_<0&&(_=0),p>i&&(p=i);const m=a[0]-t[0],g=a[1]-t[1],y=m*m+g*g;for(let n=d;n<f;n++)for(let r=_;r<p;r++){const o=n+.5,l=r+.5;let c,u,h=(o-t[0])*m+(l-t[1])*g;h<0?(c=t[0],u=t[1]):h>y?(c=a[0],u=a[1]):(h/=y,c=t[0]+h*m,u=t[1]+h*g);const d=(o-c)*(o-c)+(l-u)*(l-u),f=(i-r-1)*e+n;d<s[f]&&(s[f]=d)}}}for(let t=0;t<r;++t)s[t]=Math.sqrt(s[t]);return s}(h,c,u,a);return t.asFill&&function(t,e,i,n,r){for(const s of t){const t=s.length;for(let o=1;o<t;++o){const t=s[o-1],a=s[o];let l,c,u,h;t[0]<a[0]?(l=t[0],c=a[0]):(l=a[0],c=t[0]),t[1]<a[1]?(u=t[1],h=a[1]):(u=a[1],h=t[1]);let d=Math.floor(l),f=Math.floor(c)+1,_=Math.floor(u),p=Math.floor(h)+1;d<n&&(d=n),f>e-n&&(f=e-n),_<n&&(_=n),p>i-n&&(p=i-n);for(let s=_;s<p;++s){if(t[1]>s==a[1]>s)continue;const o=s+.5,l=(i-s-1)*e;for(let e=d;e<f;++e)e+.5<(a[0]-t[0])*(o-t[1])/(a[1]-t[1])+t[0]&&(r[l+e]=-r[l+e]);for(let t=n;t<d;++t)r[l+t]=-r[l+t]}}}}(h,c,u,a,f),[d(f,a),c,u]}function d(t,e){const i=2*e,r=t.length,s=new Uint8Array(4*r);for(let e=0;e<r;++e){const r=.5-t[e]/i;(0,n.U)(r,s,4*e)}return s}},2014:function(t,e,i){i.d(e,{$:function(){return n},s:function(){return r}});const n=15.5,r=1024},47072:function(t,e,i){i.d(e,{V:function(){return l}});var n=i(33134),r=i(49077),s=i(62096),o=i(9635),a=i(57176);class l{static executeEffects(t,e,i,n){const r=(0,a.ll)(t);let l=new s.k(e);for(const e of t){const t=(0,o.A)(e);t&&(l=t.execute(l,e,1.3333333333333333,i,n,r))}return l}static applyEffects(t,e,i){if(!t)return e;const l=(0,a.ll)(t);let c,u=new s.k(n.z.fromJSONCIM(e));for(const e of t){const t=(0,o.A)(e);t&&(u=t.execute(u,e,1,null,i,l))}const h=[];let d=null;for(;c=u.next();)h.push(...(0,r.x)(c)),d=c.geometryType;return 0===h.length||null===d?null:"esriGeometryPolygon"===d?{rings:h}:{paths:h}}}},63514:function(t,e,i){i.d(e,{N:function(){return n}});class n{static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(t,e,i,n,s){return new r(t,e,i)}}n.instance=null;class r{constructor(t,e,i){this._inputGeometries=t,this._angleTolerance=void 0!==e.angleTolerance?e.angleTolerance:120,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let t=this._inputGeometries.next();for(;t;){if("esriGeometryPolygon"===t.geometryType)this._isClosed=!0;else if("esriGeometryPolyline"===t.geometryType)this._isClosed=!1;else{if("esriGeometryEnvelope"!==t.geometryType){t=this._inputGeometries.next();continue}if(this._maxCosAngle)return t;this._isClosed=!0}for(;t.nextPath();)this._processPath(t);return t.reset(),t}return null}_processPath(t){if(t.nextPoint()){const e=t.x,i=t.y;let n=e,r=i,s=t.pathSize,o=0,a=0,l=0,c=0,u=0,h=0;this._isClosed&&++s;for(let d=1;t.nextPoint()||d<s;++d){let f,_;this._isClosed&&d===s-1?(f=e,_=i):(f=t.x,_=t.y);const p=f-n,m=_-r,g=Math.sqrt(p*p+m*m);d>1&&g>0&&l>0&&(o*p+a*m)/g/l<=this._maxCosAngle&&t.setControlPointAt(d-1),1===d&&(c=p,u=m,h=g),g>0&&(n=f,r=_,o=p,a=m,l=g)}this._isClosed&&l>0&&h>0&&(o*c+a*u)/h/l<=this._maxCosAngle&&t.setControlPointAt(0)}}}},82112:function(t,e,i){i.d(e,{B:function(){return u}});var n=i(33134),r=i(49077),s=i(23454),o=i(93996),a=i(33389);const l=1.7320508075688772,c=a.oF.OpenEnded;class u{static local(){return null===u.instance&&(u.instance=new u),u.instance}execute(t,e,i,n,r){return new h(t,e,i)}}u.instance=null;class h extends s.rx{constructor(t,e,i){super(t,!1,!0),this._curveHelper=new o.I,this._width=(void 0!==e.width?e.width:5)*i,this._arrowType=void 0!==e.geometricEffectArrowType?e.geometricEffectArrowType:void 0!==e.arrowType?e.arrowType:c,this._offsetFlattenError=o.U*i}processPath(t){const e=n.z.createEmptyOptimizedCIM(t.geometryType);switch(this._arrowType){case a.oF.OpenEnded:default:this._constructSimpleArrow(e,t,!0);break;case a.oF.Block:this._constructSimpleArrow(e,t,!1);break;case a.oF.Crossed:this._constructCrossedArrow(e,t)}return e}_constructSimpleArrow(t,e,i){const n=e.pathLength();let s=this._width;n<2*s&&(s=n/2);const o=this._curveHelper.getSubCurve(e,0,n-s);if(!o||!o.nextPath())return;o.seekPathStart();const a=s/2;if(this._curveHelper.isEmpty(o))return;const l=(0,r.A)(o),c=this._constructOffset(l,-a);if(!c)return;const u=this._constructOffset(l,a);if(!u)return;const h=this._constructArrowBasePoint(c,-a/2);if(!h)return;const d=this._constructArrowBasePoint(u,a/2);if(!d)return;e.seekInPath(e.pathSize-1);const f=[e.x,e.y];t.pushPath(u),t.nextPath(),t.nextPoint(),t.setControlPoint(),t.pushPoint(d),t.nextPoint(),t.setControlPoint(),t.pushPoint(f),t.nextPoint(),t.setControlPoint(),t.pushPoint(h),t.nextPoint(),t.setControlPoint(),t.pushPoints(c.reverse()),t.setControlPoint(),i||(t.setControlPointAt(0),t.setControlPointAt(t.pathSize-1),t.pushPoint(u[0])),t.reset()}_constructCrossedArrow(t,e){const i=e.pathLength();let n=this._width;i<n*(1+l+1)&&(n=i/(1+l+1)),e.seekPathStart();const s=this._curveHelper.getSubCurve(e,0,i-n*(1+l));if(!s)return;s.nextPath();const o=n/2;if(this._curveHelper.isEmpty(s))return;const a=(0,r.A)(s),c=this._constructOffset(a,o);if(!c)return;const u=this._constructOffset(a,-o);if(!u)return;const h=this._curveHelper.getSubCurve(e,0,i-n);if(!h)return;if(h.nextPath(),this._curveHelper.isEmpty(h))return;const d=(0,r.A)(h),f=this._constructOffset(d,o);if(!f)return;const _=this._constructOffset(d,-o);if(!_)return;const p=f[f.length-1],m=this._constructArrowBasePoint(f,o/2);if(!m)return;const g=_[_.length-1],y=this._constructArrowBasePoint(_,-o/2);if(!y)return;e.seekInPath(e.pathSize-1);const v=[e.x,e.y];t.pushPath(c),t.nextPath(),t.nextPoint(),t.setControlPoint(),t.pushPoint(g),t.nextPoint(),t.setControlPoint(),t.pushPoint(y),t.nextPoint(),t.setControlPoint(),t.pushPoint(v),t.nextPoint(),t.setControlPoint(),t.pushPoint(m),t.nextPoint(),t.setControlPoint(),t.pushPoint(p),t.nextPoint(),t.setControlPoint(),t.pushPoints(u.reverse()),t.nextPoint(),t.setControlPoint(),t.reset()}_constructOffset(t,e){return this._curveHelper.offset(t,e,a.xw.Rounded,4,this._offsetFlattenError)}_constructArrowBasePoint(t,e){if(!t||t.length<2)return null;const i=t[t.length-2],n=t[t.length-1],r=[n[0]-i[0],n[1]-i[1]];return this._curveHelper.normalize(r),[n[0]+r[1]*e,n[1]-r[0]*e]}}},20391:function(t,e,i){i.d(e,{s:function(){return c}}),i(50917);var n=i(33134),r=i(49077),s=i(62096),o=i(93996),a=i(33389),l=i(57165);class c{static local(){return null===c.instance&&(c.instance=new c),c.instance}execute(t,e,i,n,r,s){return new u(t,e,i,n,r,s)}}c.instance=null;class u{constructor(t,e,i,n,r,s){this._inputGeometries=t,this._tileKey=n,this._geometryEngine=r,this._curveHelper=new o.I,this._size=(void 0!==e.size?e.size:1)*i,this._maxInflateSize=s*i,this._offsetFlattenError=o.U*i}next(){let t;for(;t=this._inputGeometries.next();){if(0===this._size)return t;if("esriGeometryEnvelope"===t.geometryType)if(this._size>0){const e=n.z.createEmptyOptimizedCIM(t.geometryType),i=(0,r.x)(t)[0],s=this._curveHelper.offset(i,this._size,a.xw.Rounded,4,this._offsetFlattenError);if(s)return e.pushPath(s),e}else if(this._size<0){const e=t.asJSON();if(Math.min(e.xmax-e.xmin,e.ymax-e.ymin)+2*this._size>0)return n.z.fromJSONCIM({xmin:e.xmin-this._size,xmax:e.xmax+this._size,ymin:e.ymin-this._size,ymax:e.ymax+this._size})}const e=this._geometryEngine;if(null==e)return null;const i=this._tileKey?(0,s.q)(t,this._maxInflateSize):t;if(!i)continue;const o=e.buffer(l.A.WebMercator,i.asJSON(),this._size,1);return o?n.z.fromJSONCIM(o):null}return null}}},11672:function(t,e,i){i.d(e,{v:function(){return a}});var n=i(33134),r=i(49077),s=i(23454),o=i(33389);class a{static local(){return null===a.instance&&(a.instance=new a),a.instance}execute(t,e,i,n,r){return new l(t,e,i)}}a.instance=null;class l{constructor(t,e,i){this._defaultPointSize=20,this._inputGeometries=t,this._geomUnitsPerPoint=i,this._rule=e.rule??o.uQ.FullGeometry,this._defaultSize=this._defaultPointSize*i}next(){let t;for(;t=this._inputGeometries.next();){const e=this._processGeom((0,r.x)(t));if(e?.length)return n.z.fromJSONCIM({paths:e})}return null}_clone(t){return[t[0],t[1]]}_mid(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}_mix(t,e,i,n){return[t[0]*e+i[0]*n,t[1]*e+i[1]*n]}_add(t,e){return[t[0]+e[0],t[1]+e[1]]}_add2(t,e,i){return[t[0]+e,t[1]+i]}_sub(t,e){return[t[0]-e[0],t[1]-e[1]]}_dist(t,e){return Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1]))}_norm(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}_normalize(t,e=1){const i=e/this._norm(t);t[0]*=i,t[1]*=i}_leftPerpendicular(t){const e=-t[1],i=t[0];t[0]=e,t[1]=i}_leftPerp(t){return[-t[1],t[0]]}_rightPerpendicular(t){const e=t[1],i=-t[0];t[0]=e,t[1]=i}_rightPerp(t){return[t[1],-t[0]]}_dotProduct(t,e){return t[0]*e[0]+t[1]*e[1]}_crossProduct(t,e){return t[0]*e[1]-t[1]*e[0]}_rotateDirect(t,e,i){const n=t[0]*e-t[1]*i,r=t[0]*i+t[1]*e;t[0]=n,t[1]=r}_makeCtrlPt(t){const e=[t[0],t[1]];return(0,s.Aq)(e,1),e}_addAngledTicks(t,e,i,n){const r=this._sub(i,e);this._normalize(r);const s=this._crossProduct(r,this._sub(n,e));let o;o=s>0?this._rightPerp(r):this._leftPerp(r);const a=Math.abs(s)/2,l=[];l.push([e[0]+(o[0]-r[0])*a,e[1]+(o[1]-r[1])*a]),l.push(e),l.push(i),l.push([i[0]+(o[0]+r[0])*a,i[1]+(o[1]+r[1])*a]),t.push(l)}_addBezier2(t,e,i,n,r){if(0==r--)return void t.push(n);const s=this._mid(e,i),o=this._mid(i,n),a=this._mid(s,o);this._addBezier2(t,e,s,a,r),this._addBezier2(t,a,o,n,r)}_addBezier3(t,e,i,n,r,s){if(0==s--)return void t.push(r);const o=this._mid(e,i),a=this._mid(i,n),l=this._mid(n,r),c=this._mid(o,a),u=this._mid(a,l),h=this._mid(c,u);this._addBezier3(t,e,o,c,h,s),this._addBezier3(t,h,u,l,r,s)}_add90DegArc(t,e,i,n,r){const s=r??this._crossProduct(this._sub(i,e),this._sub(n,e))>0,o=this._mid(e,i),a=this._sub(o,e);s?this._leftPerpendicular(a):this._rightPerpendicular(a),o[0]+=a[0],o[1]+=a[1],this._addBezier3(t,e,this._mix(e,.33333,o,.66667),this._mix(i,.33333,o,.66667),i,4)}_addArrow(t,e,i){const n=e[0],r=e[1],s=e[e.length-1],o=this._sub(n,r),a=this._norm(o);this._normalize(o);const l=Math.abs(this._crossProduct(o,this._sub(s,r)));let c=this._dotProduct(o,this._sub(s,r));c<.05*a?c=.05*a:c>.95*a&&(c=.95*a);const u=.5*l,h=this._leftPerp(o),d=[r[0]+o[0]*c,r[1]+o[1]*c],f=e.length-1,_=[];_.push(i?[-h[0],-h[1]]:h);let p=[-o[0],-o[1]];for(let t=1;t<f-1;t++){const i=this._sub(e[t+1],e[t]);this._normalize(i);const n=this._dotProduct(i,p),r=this._crossProduct(i,p),s=Math.sqrt((1+n)/2),o=this._sub(i,p);this._normalize(o),o[0]/=s,o[1]/=s,_.push(r<0?[-o[0],-o[1]]:o),p=i}_.push(this._rightPerp(p));for(let i=_.length-1;i>0;i--)t.push([e[i][0]+_[i][0]*u,e[i][1]+_[i][1]*u]);t.push([d[0]+_[0][0]*u,d[1]+_[0][1]*u]),t.push([d[0]+_[0][0]*l,d[1]+_[0][1]*l]),t.push(n),t.push([d[0]-_[0][0]*l,d[1]-_[0][1]*l]),t.push([d[0]-_[0][0]*u,d[1]-_[0][1]*u]);for(let i=1;i<_.length;i++)t.push([e[i][0]-_[i][0]*u,e[i][1]-_[i][1]*u])}_cp2(t,e,i){return t.length>=2?t[1]:this._add2(t[0],e*this._defaultSize,i*this._defaultSize)}_cp3(t,e,i,n){if(t.length>=3)return t[2];const r=this._mix(t[0],1-i,e,i),s=this._sub(e,t[0]);return this._normalize(s),this._rightPerpendicular(s),[r[0]+s[0]*n*this._defaultSize,r[1]+s[1]*n*this._defaultSize]}_arrowPath(t){if(t.length>2)return t;const e=t[0],i=this._cp2(t,-4,0),n=this._sub(e,i);this._normalize(n);const r=this._rightPerp(n);return[e,i,[e[0]+(r[0]-n[0])*this._defaultSize,e[1]+(r[1]-n[1])*this._defaultSize]]}_arrowLastSeg(t){const e=t[0],i=this._cp2(t,-4,0);let n;if(t.length>=3)n=t[t.length-1];else{const t=this._sub(e,i);this._normalize(t);const r=this._rightPerp(t);n=[e[0]+(r[0]-t[0])*this._defaultSize,e[1]+(r[1]-t[1])*this._defaultSize]}return[i,n]}_processGeom(t){if(!t)return null;const e=[];for(const i of t){if(!i||0===i.length)continue;const t=i.length;let n=i[0];switch(this._rule){case o.uQ.PerpendicularFromFirstSegment:{const t=this._cp2(i,0,-1),r=this._cp3(i,t,.5,4),s=[];s.push(r),s.push(this._mid(n,t)),e.push(s);break}case o.uQ.ReversedFirstSegment:{const t=this._cp2(i,0,-1);e.push([t,n]);break}case o.uQ.PerpendicularToSecondSegment:{if(i.length<3)return[];const t=this._cp2(i,-4,1),r=this._cp3(i,t,.882353,-1.94),s=[];s.push(this._mid(t,r)),s.push(n),e.push(s);break}case o.uQ.SecondSegmentWithTicks:{if(i.length<3)return[];const t=this._cp2(i,-4,1),r=this._cp3(i,t,.882353,-1.94),s=this._sub(r,t);let o;o=this._crossProduct(s,this._sub(n,t))>0?this._rightPerp(s):this._leftPerp(s);const a=[];a.push([t[0]+(o[0]-s[0])/3,t[1]+(o[1]-s[1])/3]),a.push(t),a.push(r),a.push([r[0]+(o[0]+s[0])/3,r[1]+(o[1]+s[1])/3]),e.push(a);break}case o.uQ.DoublePerpendicular:{const t=this._cp2(i,0,-1),r=this._cp3(i,t,.5,3),s=this._mid(n,t),o=this._sub(s,r);this._normalize(o);const a=this._crossProduct(o,this._sub(n,r));this._leftPerpendicular(o);const l=[];l.push(n),l.push([r[0]+o[0]*a,r[1]+o[1]*a]),e.push(l);const c=[];c.push([r[0]-o[0]*a,r[1]-o[1]*a]),c.push(t),e.push(c);break}case o.uQ.OppositeToFirstSegment:{const t=this._cp2(i,0,-1),r=this._cp3(i,t,.5,3),s=this._mid(n,t),o=this._sub(s,r);this._normalize(o);const a=this._crossProduct(o,this._sub(n,r));this._leftPerpendicular(o);const l=[];l.push([r[0]+o[0]*a,r[1]+o[1]*a]),l.push([r[0]-o[0]*a,r[1]-o[1]*a]),e.push(l);break}case o.uQ.TriplePerpendicular:{const t=this._cp2(i,0,-1),r=this._cp3(i,t,.5,4),s=this._mid(n,t),o=this._sub(s,r);this._normalize(o);const a=this._crossProduct(o,this._sub(n,r));this._leftPerpendicular(o);const l=[];l.push([r[0]+o[0]*a*.8,r[1]+o[1]*a*.8]),l.push([s[0]+.8*(n[0]-s[0]),s[1]+.8*(n[1]-s[1])]),e.push(l),e.push([r,s]);const c=[];c.push([r[0]-o[0]*a*.8,r[1]-o[1]*a*.8]),c.push([s[0]+.8*(t[0]-s[0]),s[1]+.8*(t[1]-s[1])]),e.push(c);break}case o.uQ.HalfCircleFirstSegment:{const t=this._cp2(i,0,-1),r=this._cp3(i,t,.5,4),s=this._mid(n,t);let o=this._sub(t,n);const a=Math.cos(Math.PI/18),l=Math.sin(Math.PI/18),c=Math.sqrt((1+a)/2),u=Math.sqrt((1-a)/2),h=[];let d;this._crossProduct(o,this._sub(r,n))>0?(h.push(n),o=this._sub(n,s),d=t):(h.push(t),o=this._sub(t,s),d=n),this._rotateDirect(o,c,u),o[0]/=c,o[1]/=c;for(let t=1;t<=18;t++)h.push(this._add(s,o)),this._rotateDirect(o,a,l);h.push(d),e.push(h);break}case o.uQ.HalfCircleSecondSegment:{const t=this._cp2(i,0,-1),r=this._cp3(i,t,1,-1);let s=this._sub(n,t);this._normalize(s);const o=this._crossProduct(s,this._sub(r,t))/2;this._leftPerpendicular(s);const a=[t[0]+s[0]*o,t[1]+s[1]*o];s=this._sub(t,a);const l=Math.cos(Math.PI/18);let c=Math.sin(Math.PI/18);o>0&&(c=-c);const u=[t];for(let t=1;t<=18;t++)this._rotateDirect(s,l,c),u.push(this._add(a,s));e.push(u);break}case o.uQ.HalfCircleExtended:{const r=this._cp2(i,0,-2),s=this._cp3(i,r,1,-1);let o;if(t>=4)o=i[3];else{const t=this._sub(n,r);o=this._add(s,t)}const a=this._dist(r,s)/2/.75,l=this._sub(r,n);this._normalize(l,a);const c=this._sub(s,o);this._normalize(c,a);const u=[o,s];e.push(u);const h=[this._clone(s)];this._addBezier3(h,s,this._add(s,c),this._add(r,l),r,4),h.push(n),e.push(h);break}case o.uQ.OpenCircle:{const t=this._cp2(i,-2,0),r=this._sub(t,n),s=Math.cos(Math.PI/18),o=-Math.sin(Math.PI/18),a=[t];for(let t=1;t<=33;t++)this._rotateDirect(r,s,o),a.push(this._add(n,r));e.push(a);break}case o.uQ.CoverageEdgesWithTicks:{const r=this._cp2(i,0,-1);let s,o;if(t>=3)s=i[2];else{const t=this._sub(r,n),e=this._leftPerp(t);s=[n[0]+e[0]-.25*t[0],n[1]+e[1]-.25*t[1]]}if(t>=4)o=i[3];else{const t=this._mid(n,r),e=this._sub(n,r);this._normalize(e),this._leftPerpendicular(e);const i=this._crossProduct(e,this._sub(s,t));this._rightPerpendicular(e),o=[s[0]+e[0]*i*2,s[1]+e[1]*i*2]}const a=this._sub(r,n);let l,c;l=this._crossProduct(a,this._sub(s,n))>0?this._rightPerp(a):this._leftPerp(a),c=[],c.push(s),c.push(n),c.push([n[0]+(l[0]-a[0])/3,n[1]+(l[1]-a[1])/3]),e.push(c),l=this._crossProduct(a,this._sub(o,r))>0?this._rightPerp(a):this._leftPerp(a),c=[],c.push([r[0]+(l[0]+a[0])/3,r[1]+(l[1]+a[1])/3]),c.push(r),c.push(o),e.push(c);break}case o.uQ.GapExtentWithDoubleTicks:{const r=this._cp2(i,0,2),s=this._cp3(i,r,0,1);let o;if(t>=4)o=i[3];else{const t=this._sub(r,n);o=this._add(s,t)}this._addAngledTicks(e,n,r,this._mid(s,o)),this._addAngledTicks(e,s,o,this._mid(n,r));break}case o.uQ.GapExtentMidline:{const r=this._cp2(i,2,0),s=this._cp3(i,r,0,1);let o;if(t>=4)o=i[3];else{const t=this._sub(r,n);o=this._add(s,t)}const a=[];a.push(this._mid(n,s)),a.push(this._mid(r,o)),e.push(a);break}case o.uQ.Chevron:{const r=this._cp2(i,-1,-1);let s;if(t>=3)s=i[2];else{const t=this._sub(r,n);this._leftPerpendicular(t),s=this._add(n,t)}e.push([r,this._makeCtrlPt(n),s]);break}case o.uQ.PerpendicularWithArc:{const r=this._cp2(i,0,-2),s=this._cp3(i,r,.5,-1),o=this._sub(r,n),a=this._norm(o);o[0]/=a,o[1]/=a;const l=this._crossProduct(o,this._sub(s,n));let c=this._dotProduct(o,this._sub(s,n));c<.05*a?c=.05*a:c>.95*a&&(c=.95*a);const u=[n[0]+o[0]*c,n[1]+o[1]*c];let h=this._leftPerp(o),d=[];if(d.push([u[0]-h[0]*l,u[1]-h[1]*l]),d.push([u[0]+h[0]*l,u[1]+h[1]*l]),e.push(d),t>=4){const t=i[3];let r=this._dotProduct(o,this._sub(t,n));r<.1*a?r=.1*a:r>.9*a&&(r=.9*a);const s=[n[0]+o[0]*r,n[1]+o[1]*r],l=this._crossProduct(o,this._sub(t,n)),c=[];c.push([s[0]-h[0]*l,s[1]-h[1]*l]),c.push([s[0]+h[0]*l,s[1]+h[1]*l]),e.push(c)}const f=[r[0]+h[0]*l,r[1]+h[1]*l];h=this._sub(r,f);const _=Math.cos(Math.PI/18);let p=Math.sin(Math.PI/18);l<0&&(p=-p),d=[n,r];for(let t=1;t<=9;t++)this._rotateDirect(h,_,p),d.push(this._add(f,h));e.push(d);break}case o.uQ.ClosedHalfCircle:{const t=this._cp2(i,2,0),r=this._mid(n,t),s=this._sub(t,r),o=Math.cos(Math.PI/18),a=Math.sin(Math.PI/18),l=[n,t];for(let t=1;t<=18;t++)this._rotateDirect(s,o,a),l.push(this._add(r,s));e.push(l);break}case o.uQ.TripleParallelExtended:{const t=this._cp2(i,0,-2),r=this._cp3(i,t,1,-2),o=this._mid(n,t),a=this._sub(r,t);this._normalize(a);const l=Math.abs(this._crossProduct(a,this._sub(o,t)))/2,c=this._dist(t,r),u=[t,n];u.push([n[0]+a[0]*c*.5,n[1]+a[1]*c*.5]),e.push(u);const h=[];h.push([o[0]-a[0]*l,o[1]-a[1]*l]),h.push([o[0]+a[0]*c*.375,o[1]+a[1]*c*.375]),(0,s.Aq)(h[h.length-1],1),h.push([o[0]+a[0]*c*.75,o[1]+a[1]*c*.75]),e.push(h);const d=[t,r];e.push(d);break}case o.uQ.ParallelWithTicks:{const t=this._cp2(i,3,0),r=this._cp3(i,t,.5,-1),s=this._sub(r,t);this._normalize(s);const o=this._crossProduct(s,this._sub(r,n));this._leftPerpendicular(s),this._addAngledTicks(e,n,t,r),this._addAngledTicks(e,this._mix(n,1,s,o),this._mix(t,1,s,o),this._mid(n,t));break}case o.uQ.Parallel:{const t=this._cp2(i,3,0),r=this._cp3(i,t,.5,-1),s=this._sub(t,n);this._normalize(s);const o=this._leftPerp(s),a=this._crossProduct(s,this._sub(r,n));let l=[n,t];e.push(l),l=[],l.push([n[0]+o[0]*a,n[1]+o[1]*a]),l.push([t[0]+o[0]*a,t[1]+o[1]*a]),e.push(l);break}case o.uQ.PerpendicularToFirstSegment:{const t=this._cp2(i,3,0),r=this._cp3(i,t,.5,-1),s=this._mid(n,t),o=this._sub(t,n);this._normalize(o);const a=this._crossProduct(o,this._sub(r,n));this._leftPerpendicular(o);const l=[];l.push([s[0]-o[0]*a*.25,s[1]-o[1]*a*.25]),l.push([s[0]+o[0]*a*1.25,s[1]+o[1]*a*1.25]),e.push(l);break}case o.uQ.ParallelOffset:{const t=this._cp2(i,3,0),r=this._cp3(i,t,.5,-1),s=this._sub(t,n);this._normalize(s);const o=this._crossProduct(s,this._sub(r,n));this._leftPerpendicular(s);const a=[];a.push([n[0]-s[0]*o,n[1]-s[1]*o]),a.push([t[0]-s[0]*o,t[1]-s[1]*o]),e.push(a);const l=[];l.push([n[0]+s[0]*o,n[1]+s[1]*o]),l.push([t[0]+s[0]*o,t[1]+s[1]*o]),e.push(l);break}case o.uQ.OffsetOpposite:{const t=this._cp2(i,3,0),r=this._cp3(i,t,.5,-1),s=this._sub(t,n);this._normalize(s);const o=this._crossProduct(s,this._sub(r,n));this._leftPerpendicular(s);const a=[];a.push([n[0]-s[0]*o,n[1]-s[1]*o]),a.push([t[0]-s[0]*o,t[1]-s[1]*o]),e.push(a);break}case o.uQ.OffsetSame:{const t=this._cp2(i,3,0),r=this._cp3(i,t,.5,-1),s=this._sub(t,n);this._normalize(s);const o=this._crossProduct(s,this._sub(r,n));this._leftPerpendicular(s);const a=[];a.push([n[0]+s[0]*o,n[1]+s[1]*o]),a.push([t[0]+s[0]*o,t[1]+s[1]*o]),e.push(a);break}case o.uQ.CircleWithArc:{let r=this._cp2(i,3,0);const o=this._cp3(i,r,.5,-1);let a,l;if(t>=4)a=i[3],l=this._crossProduct(this._sub(a,r),this._sub(o,r))>0;else{a=r,l=this._crossProduct(this._sub(a,n),this._sub(o,n))>0;const t=24*this._geomUnitsPerPoint,e=this._sub(a,n);this._normalize(e,t);const i=Math.sqrt(2)/2;this._rotateDirect(e,i,l?i:-i),r=this._add(n,e)}const c=this._sub(r,n),u=Math.cos(Math.PI/18),h=Math.sin(Math.PI/18),d=[r];for(let t=1;t<=36;t++)this._rotateDirect(c,u,h),d.push(this._add(n,c));this._add90DegArc(d,r,a,o,l),(0,s.Aq)(d[d.length-8],1),e.push(d);break}case o.uQ.DoubleJog:{let r,s=this._cp2(i,-3,1),o=this._cp3(i,s,-1,-.5);if(t>=4)r=i[3];else{const t=n;n=s,r=o;const e=this._dist(n,t),i=this._dist(r,t);let a=30*this._geomUnitsPerPoint;.5*e<a&&(a=.5*e),.5*i<a&&(a=.5*i),s=this._mix(n,a/e,t,(e-a)/e),o=this._mix(r,a/i,t,(i-a)/i)}const a=this._mid(n,s),l=this._mid(r,o),c=this._dist(n,s),u=this._dist(o,r);let h=Math.min(c,u)/8;h=Math.min(h,24*this._geomUnitsPerPoint);const d=Math.cos(Math.PI/4);let f=this._sub(n,s);this._normalize(f,h),this._crossProduct(f,this._sub(r,s))>0?this._rotateDirect(f,d,-d):this._rotateDirect(f,d,d);let _=[];_.push(s),_.push(this._add(a,f)),_.push(this._sub(a,f)),_.push(n),e.push(_),f=this._sub(r,o),this._normalize(f,h),this._crossProduct(f,this._sub(n,o))<0?this._rotateDirect(f,d,d):this._rotateDirect(f,d,-d),_=[],_.push(o),_.push(this._add(l,f)),_.push(this._sub(l,f)),_.push(r),e.push(_);break}case o.uQ.PerpendicularOffset:{const t=this._cp2(i,-4,1),r=this._cp3(i,t,.882353,-1.94),s=this._sub(r,t);this._crossProduct(s,this._sub(n,t))>0?this._rightPerpendicular(s):this._leftPerpendicular(s);const o=[s[0]/8,s[1]/8],a=this._sub(this._mid(t,r),o);e.push([a,n]);break}case o.uQ.LineExcludingLastSegment:{const t=this._arrowPath(i),n=[];let r=t.length-2;for(;r--;)n.push(t[r]);e.push(n);break}case o.uQ.MultivertexArrow:{const t=this._arrowPath(i),n=[];this._addArrow(n,t,!1),e.push(n);break}case o.uQ.CrossedArrow:{const t=this._arrowPath(i),n=[];this._addArrow(n,t,!0),e.push(n);break}case o.uQ.ChevronArrow:{const[t,r]=this._arrowLastSeg(i),s=10*this._geomUnitsPerPoint,o=this._sub(n,t),a=this._norm(o);this._normalize(o);const l=this._crossProduct(o,this._sub(r,t));let c=this._dotProduct(o,this._sub(r,t));c<.05*a?c=.05*a:c>.95*a-s&&(c=.95*a-s);const u=[t[0]+o[0]*c,t[1]+o[1]*c],h=this._leftPerp(o),d=[];d.push([u[0]+h[0]*l+o[0]*s,u[1]+h[1]*l+o[1]*s]),d.push(n),d.push([u[0]-h[0]*l+o[0]*s,u[1]-h[1]*l+o[1]*s]),e.push(d);break}case o.uQ.ChevronArrowOffset:{const[t,r]=this._arrowLastSeg(i),s=this._sub(n,t),o=this._norm(s);this._normalize(s);const a=this._crossProduct(s,this._sub(r,t));let l=this._dotProduct(s,this._sub(r,t));l<.05*o?l=.05*o:l>.95*o&&(l=.95*o);const c=[t[0]+s[0]*l,t[1]+s[1]*l];this._leftPerpendicular(s);const u=[];u.push([c[0]+s[0]*a*.5,c[1]+s[1]*a*.5]),u.push(this._mid(c,n)),u.push([c[0]-s[0]*a*.5,c[1]-s[1]*a*.5]),e.push(u);break}case o.uQ.PartialFirstSegment:{const[t,r]=this._arrowLastSeg(i),s=this._sub(n,t),o=this._norm(s);this._normalize(s);let a=this._dotProduct(s,this._sub(r,t));a<.05*o?a=.05*o:a>.95*o&&(a=.95*o);const l=[t[0]+s[0]*a,t[1]+s[1]*a];e.push([t,l]);break}case o.uQ.Arch:{const t=this._cp2(i,0,-1),r=this._cp3(i,t,.5,1),s=this._sub(n,t),o=this._mix(r,1,s,.55),a=this._mix(r,1,s,-.55),l=[n];this._addBezier2(l,n,o,r,4),this._addBezier2(l,r,a,t,4),e.push(l);break}case o.uQ.CurvedParallelTicks:{const t=this._cp2(i,-4,1),r=this._cp3(i,t,.882353,-1.94),s=this._sub(r,t);this._crossProduct(s,this._sub(n,t))>0?this._rightPerpendicular(s):this._leftPerpendicular(s);const o=[s[0]/8,s[1]/8],a=this._sub(this._mid(t,r),o),l=this._sub(this._mix(t,.75,r,.25),o),c=this._sub(this._mix(t,.25,r,.75),o),u=[t];this._addBezier2(u,t,l,a,3),this._addBezier2(u,a,c,r,3),e.push(u);for(let t=0;t<8;t++){const i=u[2*t+1],n=[this._clone(i)];n.push(this._add(i,[s[0]/4,s[1]/4])),e.push(n)}break}case o.uQ.Arc90Degrees:{const t=this._cp2(i,0,-1),r=this._cp3(i,t,.5,1),s=[t];this._add90DegArc(s,t,n,r),e.push(s);break}case o.uQ.TipWithPerpendicularAndTicks:{const[t,r]=this._arrowLastSeg(i),s=10*this._geomUnitsPerPoint,o=this._sub(n,t),a=this._norm(o);this._normalize(o);let l=this._crossProduct(o,this._sub(r,t)),c=this._dotProduct(o,this._sub(r,t));c<.05*a?c=.05*a:c>.95*a-s&&(c=.95*a-s);const u=this._leftPerp(o),h=[n[0]-o[0]*s,n[1]-o[1]*s],d=.5*Math.max(a-c-s,s);l=Math.abs(l);const f=[];f.push([h[0]+u[0]*(l+d)-o[0]*d,h[1]+u[1]*(l+d)-o[1]*d]),f.push([h[0]+u[0]*l,h[1]+u[1]*l]),f.push([h[0]-u[0]*l,h[1]-u[1]*l]),f.push([h[0]-u[0]*(l+d)-o[0]*d,h[1]-u[1]*(l+d)-o[1]*d]),e.push(f),e.push([h,n]);break}case o.uQ.FullGeometry:default:e.push(i)}}return e}}},12281:function(t,e,i){i.d(e,{y:function(){return o}});var n=i(33134),r=i(23454),s=i(93996);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,i,n,r){return new a(t,e,i)}}o.instance=null;class a extends r.rx{constructor(t,e,i){super(t,!0,!0),this._curveHelper=new s.I,this._beginCut=(void 0!==e.beginCut?e.beginCut:1)*i,this._endCut=(void 0!==e.endCut?e.endCut:1)*i,this._middleCut=(void 0!==e.middleCut?e.middleCut:0)*i,this._invert=void 0!==e.invert&&e.invert,this._beginCut<0&&(this._beginCut=0),this._endCut<0&&(this._endCut=0),this._middleCut<0&&(this._middleCut=0)}processPath(t){const{_beginCut:e,_endCut:i,_middleCut:r}=this,s=t.pathLength(),o=n.z.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._invert){if(0!==e||0!==i||0!==r)if(e+i+r>=s)for(o.startPath();t.nextPoint();)o.pushXY(t.x,t.y);else this._curveHelper.appendSubCurve(o,t,0,e),this._curveHelper.appendSubCurve(o,t,.5*(s-r),.5*(s+r)),this._curveHelper.appendSubCurve(o,t,s-i,i)}else if(0===e&&0===i&&0===r)for(o.startPath();t.nextPoint();)o.pushXY(t.x,t.y);else e+i+r<s&&(0===r?this._curveHelper.appendSubCurve(o,t,e,s-i):(this._curveHelper.appendSubCurve(o,t,e,.5*(s-r)),this._curveHelper.appendSubCurve(o,t,.5*(s+r),s-i)));return 0===o.totalSize?null:o}}},2969:function(t,e,i){i.d(e,{I:function(){return u}});var n=i(33134),r=i(49077),s=i(38441),o=i(23454),a=i(33389),l=i(65661),c=i(7590);class u{static local(){return null===u.instance&&(u.instance=new u),u.instance}execute(t,e,i,n,r){return new h(t,e,i,n)}}u.instance=null;class h extends o.rx{constructor(t,e,i,n){super(t,!0,!0),this._firstCurve=null,this._walker=new l.Z1,this._walker.updateTolerance(i),this._endings=e.lineDashEnding,this._customDashPos=-(e.offsetAlongLine??0)*i,this._offsetAtEnd=(e.customEndingOffset??0)*i,this._tileKey=n;let r=(0,c.K3)(e).dashTemplate;null==r&&(r=[]),r.length%2&&(r=[...r,...r]);let s=0;for(let t=0;t<r.length;t++){let e=Math.abs(r[t]);e<1e-7&&(e=1e-7),s+=e}this._patternLength=s,this._numOfDashesPerPattern=r.length/2,this._pattern=new l.VA,this._pattern.init(r,!0),this._pattern.scale(i)}processPath(t){if(0===this._pattern.length()){this.iteratePath=!1;const e=(0,r.A)(t);return n.z.fromJSONCIM({paths:[e]})}if(!this.iteratePath){let e=!0;switch(this._endings){case a.yS.HalfPattern:case a.yS.HalfGap:default:this._pattern.extPtGap=0;break;case a.yS.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case a.yS.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case a.yS.NoConstraint:this.isClosed||(e=!1);break;case a.yS.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}const i=t.pathLength();if(this._pattern.isEmpty()||i<.1*this._pattern.length()){const e=(0,r.A)(t);return n.z.fromJSONCIM({paths:[e]})}if(!this._walker.init(t,this._pattern,e)){const e=(0,r.A)(t);return n.z.fromJSONCIM({paths:[e]})}}let e;if(this.iteratePath)e=this._pattern.nextValue();else{let t;switch(this._endings){case a.yS.HalfPattern:default:t=.5*this._pattern.firstValue();break;case a.yS.HalfGap:t=.5*-this._pattern.lastValue();break;case a.yS.FullGap:t=-this._pattern.lastValue();break;case a.yS.FullPattern:t=0;break;case a.yS.NoConstraint:case a.yS.Custom:t=-this._customDashPos}let i=t/this._pattern.length();i-=Math.floor(i),t=i*this._pattern.length(),this._pattern.reset(),e=this._pattern.nextValue();let n=!1;for(;t>=e;)t-=e,e=this._pattern.nextValue(),n=!n;e-=t,n?(this._walker.nextPosition(e),e=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(e),e=this._pattern.nextValue(),this._walker.nextPosition(e),e=this._pattern.nextValue())}let i=this._walker.nextCurve(e);if(i)if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)i.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else e=this._pattern.nextValue(),!this._walker.nextPosition(e)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(i.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,i=this._firstCurve,this._firstCurve=null;return i?.reset(),i}isClippingRequired(t){const e=(0,r.x)(t);let i=0;for(const t of e)i+=(0,s.Yl)(t);return Math.round(this._numOfDashesPerPattern*(i/this._patternLength))>1e3}}},7889:function(t,e,i){i.d(e,{O:function(){return a}}),i(50917);var n=i(33134),r=i(62096),s=i(33389),o=i(57165);class a{static local(){return null===a.instance&&(a.instance=new a),a.instance}execute(t,e,i,n,r,s){return new l(t,e,i,n,r,s)}}a.instance=null;class l{constructor(t,e,i,n,r,o){switch(this._inputGeometries=t,this._tileKey=n,this._geometryEngine=r,this._maxInflateSize=o*i,this._width=(void 0!==e.width?e.width:2)*i,e.method){case s.M1.Mitered:case s.M1.Bevelled:case s.M1.Rounded:case s.M1.TrueBuffer:case s.M1.Square:}this._option=e.option}next(){let t;for(;t=this._inputGeometries.next();){if("esriGeometryEnvelope"===t.geometryType&&this._width>0){const e=t.asJSON();return Math.min(e.xmax-e.xmin,e.ymax-e.ymin)-2*this._width<0?t:n.z.fromJSONCIM({paths:[[[e.xmin+this._width,e.ymin+this._width],[e.xmax-this._width,e.ymin+this._width],[e.xmax-this._width,e.ymax-this._width],[e.xmin+this._width,e.ymax-this._width],[e.xmin+this._width,e.ymin+this._width]],[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]})}if("esriGeometryPolygon"===t.geometryType){if(0===this._width)return t.clone();const e=this._geometryEngine;if(null==e)return null;const i=this._tileKey?(0,r.q)(t,this._maxInflateSize):t.clone();if(!i)continue;const n=e.buffer(o.A.WebMercator,i.asJSON(),-this._width,1);if(n)for(const t of n.rings)if(t){i.startPath();for(const e of t.reverse())i.pushXY(e[0],i.yFactor*e[1])}return i}}return null}}},48645:function(t,e,i){i.d(e,{U:function(){return o}});var n=i(33134),r=i(23454),s=i(93996);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,i,n,r){return new a(t,e,i)}}o.instance=null;class a extends r.rx{constructor(t,e,i){super(t,!1,!0),this._curveHelper=new s.I,this._length=(void 0!==e.length?e.length:20)*i,this._angle=void 0!==e.angle?e.angle:225,this._position=void 0!==e.position?e.position:50,this._length<0&&(this._length=-this._length),this._position<20&&(this._position=20),this._position>80&&(this._position=80),this._mirror=!1}processPath(t){const e=n.z.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._curveHelper.isEmpty(t))return null;t.seekInPath(0);const i=t.x,r=t.y;t.seekInPath(t.pathSize-1);const s=t.x,o=t.y,a=[s-i,o-r];this._curveHelper.normalize(a);const l=i+(s-i)*this._position/100,c=r+(o-r)*this._position/100,u=Math.cos((90-this._angle)/180*Math.PI);let h=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(h=-h),this._mirror=!this._mirror;const d=[l-this._length/2*u,c-this._length/2*h],f=[l+this._length/2*u,c+this._length/2*h];return e.pushPath([[i,r],d,f,[s,o]]),e}}},7088:function(t,e,i){i.d(e,{V:function(){return n}});class n{static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(t,e,i,n,s){return new r(t,e,i)}}n.instance=null;class r{constructor(t,e,i){this._inputGeometries=t,this._offsetX=void 0!==e.offsetX?e.offsetX*i:0,this._offsetY=void 0!==e.offsetY?e.offsetY*i:0}next(){let t=this._inputGeometries.next();for(;t;){if(t.totalSize>0)return this._move(t.clone(),this._offsetX,this._offsetY);t=this._inputGeometries.next()}return null}_move(t,e,i){for(;t.nextPath();)for(;t.nextPoint();)t.x=t.x+e,t.y=t.y+i;return t.reset(),t}}},17706:function(t,e,i){i.d(e,{V:function(){return u}}),i(50917);var n=i(33134),r=i(49077),s=i(74697),o=i(62096),a=i(93996),l=i(33389),c=i(57165);class u{static local(){return null===u.instance&&(u.instance=new u),u.instance}execute(t,e,i,n,r,s){return new h(t,e,i,n,r,s)}}u.instance=null;class h{constructor(t,e,i,n,r,s){this._inputGeometries=t,this._tileKey=n,this._geometryEngine=r,this._curveHelper=new a.I,this._offset=(e.offset??1)*i,this._method=e.method,this._maxInflateSize=Math.max(Math.abs(s*i),10),this._option=e.option,this._offsetFlattenError=a.U*i}next(){let t;for(;t=this._inputGeometries.next();){if(0===this._offset)return t.clone();if("esriGeometryEnvelope"===t.geometryType){if(this._method===l.xw.Rounded&&this._offset>0){const e=(0,r.A)(t),i=this._curveHelper.offset(e,-this._offset,this._method,4,this._offsetFlattenError);if(i){const e=n.z.createEmptyOptimizedCIM(t.geometryType);return e.pushPath(i),e}return null}const e=t.asJSON();if((0,s.ZC)(e)&&Math.min(e.xmax-e.xmin,e.ymax-e.ymin)+2*this._offset>0)return n.z.fromJSONCIM({xmin:e.xmin-this._offset,xmax:e.xmax+this._offset,ymin:e.ymin-this._offset,ymax:e.ymax+this._offset})}const e=this._geometryEngine;if(null==e)continue;const i=this._tileKey?(0,o.q)(t,this._maxInflateSize):t.clone();if(!i)continue;const a=e.offset(c.A.WebMercator,i.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError);return a?n.z.fromJSONCIM(a):null}return null}}},10183:function(t,e,i){i.d(e,{C:function(){return n}});class n{static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(t,e,i,n,s){return new r(t,e,i)}}n.instance=null;class r{constructor(t,e,i){this._inputGeometries=t,this._reverse=void 0===e.reverse||e.reverse}next(){let t=this._inputGeometries.next();for(;t;){if(!this._reverse)return t;if("esriGeometryPolyline"===t.geometryType)return s(t.clone());t=this._inputGeometries.next()}return null}}function s(t){for(;t.nextPath();)for(let e=0;e<t.pathSize/2;e++){t.seekInPath(e);const i=t.x,n=t.y;t.seekInPath(t.pathSize-e-1);const r=t.x,s=t.y;t.x=i,t.y=n,t.seekInPath(e),t.x=r,t.y=s}return t.reset(),t}},1646:function(t,e,i){i.d(e,{v:function(){return r}});var n=i(35068);class r{static local(){return null===r.instance&&(r.instance=new r),r.instance}execute(t,e,i,n,r){return new s(t,e,i)}}r.instance=null;class s{constructor(t,e,i){this._inputGeometries=t,this._rotateAngle=void 0!==e.angle?e.angle*Math.PI/180:0}next(){let t=this._inputGeometries.next();for(;t;){if(0===this._rotateAngle||"esriGeometryPoint"===t.geometryType)return t;if(t.totalSize>0){const e=(0,n.z8)(t),i=(e[2]+e[0])/2,r=(e[3]+e[1])/2;return t.reset(),this._rotate(t.clone(),i,r)}t=this._inputGeometries.next()}return null}_rotate(t,e,i){const n=Math.cos(this._rotateAngle),r=Math.sin(this._rotateAngle);for(;t.nextPath();)for(;t.nextPoint();){const s=t.x-e,o=t.y-i;t.x=e+s*n-o*r,t.y=i+s*r+o*n}return t.reset(),t}}},79323:function(t,e,i){i.d(e,{W:function(){return r}});var n=i(35068);class r{static local(){return null===r.instance&&(r.instance=new r),r.instance}execute(t,e,i,n,r){return new s(t,e,i)}}r.instance=null;class s{constructor(t,e,i){this._inputGeometries=t,this._xFactor=void 0!==e.xScaleFactor?e.xScaleFactor:1.15,this._yFactor=void 0!==e.yScaleFactor?e.yScaleFactor:1.15}next(){const t=this._inputGeometries.next();if(t){if(1===this._xFactor&&1===this._yFactor)return t;if("esriGeometryPoint"===t.geometryType)return t;if(t.totalSize>0){const e=(0,n.z8)(t),i=(e[2]+e[0])/2,r=(e[3]+e[1])/2;return t.reset(),this._scaleCursor(t.clone(),i,r)}}return null}_scaleCursor(t,e,i){for(;t.nextPath();)for(;t.nextPoint();)t.x=e+(t.x-e)*this._xFactor,t.y=i+(t.y-i)*this._yFactor;return t.reset(),t}}},34476:function(t,e,i){i.d(e,{l:function(){return o}});var n=i(33134),r=i(33389),s=i(65661);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,i,n,r){return new a(t,e,i)}}o.instance=null;class a{constructor(t,e,i){this._inputGeometries=t,this._height=(void 0!==e.amplitude?e.amplitude:2)*i,this._period=(void 0!==e.period?e.period:3)*i,this._style=e.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new s.VA,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new s.Z1,this._walker.updateTolerance(i)}next(){let t=this._inputGeometries.next();for(;t;){if(0===this._height||0===this._period)return t;const e=this._processGeom(t);if(e)return e;t=this._inputGeometries.next()}return null}_processGeom(t){const e=n.z.createEmptyOptimizedCIM(t.geometryType);for(;t.nextPath();){e.startPath();const i=t.pathLength();if(this._walker.init(t,this._pattern))switch(this._style){case r.WE.Sinus:default:this._constructCurve(e,i,!1);break;case r.WE.Square:this._constructSquare(e,i);break;case r.WE.Triangle:this._constructTriangle(e,i);break;case r.WE.Random:this._constructCurve(e,i,!0)}else for(;t.nextPoint();)e.pushXY(t.x,t.y)}return e}_constructCurve(t,e,i){let n=Math.round(e/this._period);0===n&&(n=1);const r=16*n+1,o=e/n,a=this._period/16,l=1/r,c=2*Math.PI*e/o,u=2*Math.PI*Math.random(),h=2*Math.PI*Math.random(),d=2*Math.PI*Math.random(),f=.75-Math.random()/2,_=.75-Math.random()/2,p=new s.ps;this._walker.curPointAndAngle(p),t.pushPoint(p.pt);let m=0;for(;;){if(!this._walker.nextPointAndAngle(a,p)){t.pushPoint(this._walker.getPathEnd());break}{const e=m;let n;if(m+=l,i){const t=this._height/2*(1+.3*Math.sin(f*c*e+u));n=t*Math.sin(c*e+h),n+=t*Math.sin(_*c*e+d),n/=2}else n=.5*this._height*Math.sin(.5*c*e);t.pushXY(p.pt[0]-n*p.sa,p.pt[1]+n*p.ca)}}}_constructSquare(t,e){Math.round(e/this._period);let i=!0;for(;;){let e=!1;if(this._walker.curPositionIsValid()){const n=new s.ps;this._walker.curPointAndAngle(n);const r=new s.ps;if(this._walker.nextPointAndAngle(this._period,r)){const o=new s.ps;this._walker.nextPointAndAngle(this._period,o)&&(i?(t.pushPoint(n.pt),i=!1):t.pushPoint(n.pt),t.pushXY(n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca),t.pushXY(r.pt[0]-this._height/2*r.sa,r.pt[1]+this._height/2*r.ca),t.pushXY(r.pt[0]+this._height/2*r.sa,r.pt[1]-this._height/2*r.ca),t.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca),e=!0)}}if(!e){t.pushPoint(this._walker.getPathEnd());break}}}_constructTriangle(t,e){Math.round(e/this._period);let i=!0;for(;;){let e=!1;if(this._walker.curPositionIsValid()){const n=new s.ps;this._walker.curPointAndAngle(n);const r=new s.ps;if(this._walker.nextPointAndAngle(this._period/2,r)){const o=new s.ps;this._walker.nextPointAndAngle(this._period,o)&&(this._walker.nextPosition(this._period/2)&&(i?(t.pushPoint(n.pt),i=!1):t.pushPoint(n.pt),t.pushXY(r.pt[0]-this._height/2*r.sa,r.pt[1]+this._height/2*r.ca),t.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca)),e=!0)}}if(!e){t.pushPoint(this._walker.getPathEnd());break}}}}},84646:function(t,e,i){i.d(e,{l:function(){return r}});var n=i(9635);class r{static getPlacement(t,e,i,r,s,o){const a=(0,n.c)(i);return a?(-1===e&&t.invertY(),a.execute(t,i,r,s,o)):null}}},31771:function(t,e,i){i.d(e,{e:function(){return o}});var n=i(23454),r=i(33389),s=i(65661);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,i,n,r){return new a(t,e,i)}}o.instance=null;class a extends n.pC{constructor(t,e,i){super(t),this._geometryWalker=new s.Z1,this._geometryWalker.updateTolerance(i),this._angleToLine=e.angleToLine??!0,this._offset=(e.offset?e.offset:0)*i,this._originalEndings=e.endings,this._offsetAtEnd=(e.customEndingOffset?e.customEndingOffset:0)*i,this._position=-(e.offsetAlongLine?e.offsetAlongLine:0)*i,this._pattern=new s.VA,this._pattern.init(e.placementTemplate,!1),this._pattern.scale(i),this._endings=this._originalEndings}processPath(t){if(this._pattern.isEmpty())return null;let e;if(this.iteratePath)e=this._pattern.nextValue();else{this._originalEndings===r.e_.WithFullGap&&this.isClosed?this._endings=r.e_.WithMarkers:this._endings=this._originalEndings,this._pattern.extPtGap=0;let i,n=!0;switch(this._endings){case r.e_.NoConstraint:i=-this._position,i=this._adjustPosition(i),n=!1;break;case r.e_.WithHalfGap:default:i=-this._pattern.lastValue()/2;break;case r.e_.WithFullGap:i=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case r.e_.WithMarkers:i=0;break;case r.e_.Custom:i=-this._position,i=this._adjustPosition(i),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(t,this._pattern,n))return null;this._pattern.reset();let s=0;for(;i>s;)i-=s,s=this._pattern.nextValue();s-=i,e=s,this.iteratePath=!0}const i=new s.ps;return this._geometryWalker.nextPointAndAngle(e,i)?this._endings===r.e_.WithFullGap&&this._geometryWalker.isPathEnd()?(this.iteratePath=!1,null):this._endings===r.e_.WithMarkers&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(i.pt[0]-this._offset*i.sa,i.pt[1]+this._offset*i.ca),this._angleToLine&&this.internalPlacement.setRotateCS(i.ca,i.sa),this.internalPlacement):(this.iteratePath=!1,null)}_adjustPosition(t){let e=t/this._pattern.length();return e-=Math.floor(e),e*this._pattern.length()}}},15987:function(t,e,i){i.d(e,{y:function(){return o}});var n=i(23454),r=i(93996),s=i(33389);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,i,n,r){return new a(t,e,i)}}o.instance=null;class a extends n.pC{constructor(t,e,i){super(t,!1,!0),this._curveHelper=new r.I,this._placePerPart=e.placePerPart??!1,this._angleToLine=void 0===e.angleToLine||e.angleToLine,this._offset=void 0!==e.offset?e.offset*i:0,this._type=e.extremityPlacement,this._position=void 0!==e.offsetAlongLine?e.offsetAlongLine*i:0,this._beginProcessed=!1}processMultiPath(t){return this._placePerPart?super.processMultiPath(t):this.processPath(t)}processPath(t){let e;switch(this._type){case s.$2.Both:default:this._beginProcessed?(e=this._atExtremities(t,this._position,!1),this._beginProcessed=!1,this.iterateMultiPath=!1,this.iteratePath=!1):(e=this._atExtremities(t,this._position,!0),this._beginProcessed=!0,this.iterateMultiPath=!0,this.iteratePath=!0);break;case s.$2.JustBegin:e=this._atExtremities(t,this._position,!0);break;case s.$2.JustEnd:e=this._atExtremities(t,this._position,!1);case s.$2.None:}return e}_atExtremities(t,e,i){if(this._placePerPart||(i?t.seekPath(0):t.seekPath(t.totalSize-1)),i||t.seekPathEnd(),i?t.nextPoint():t.prevPoint()){let n=0,[r,s]=[0,0],[o,a]=[t.x,t.y];for(;i?t.nextPoint():t.prevPoint();){r=o,s=a,o=t.x,a=t.y;const i=this._curveHelper.getLength(r,s,o,a);if(n+i>e){const t=(e-n)/i,[l,c]=this._curveHelper.getAngleCS(r,s,o,a,t),u=this._curveHelper.getCoord2D(r,s,o,a,t);return this.internalPlacement.setTranslate(u[0]-this._offset*c,u[1]+this._offset*l),this._angleToLine&&this.internalPlacement.setRotateCS(-l,-c),this.internalPlacement}n+=i}}return null}}},19511:function(t,e,i){i.d(e,{S:function(){return s}});var n=i(23454),r=i(65661);class s{static local(){return null===s.instance&&(s.instance=new s),s.instance}execute(t,e,i,n,r){return new o(t,e,i)}}s.instance=null;class o extends n.pC{constructor(t,e,i){super(t),this._walker=new r.Z1,this._walker.updateTolerance(i),this._angleToLine=void 0===e.angleToLine||e.angleToLine,this._offset=void 0!==e.offset?e.offset*i:0,this._beginGap=void 0!==e.beginPosition?e.beginPosition*i:0,this._endGap=void 0!==e.endPosition?e.endPosition*i:0,this._flipFirst=void 0===e.flipFirst||e.flipFirst,this._pattern=new r.VA,this._pattern.init(e.positionArray,!1,!1),this._subPathLen=0,this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0}processPath(t){if(this._pattern.isEmpty())return null;let e;if(this.iteratePath){const t=this._pattern.nextValue()*this._subPathLen,i=this._beginGap+t;e=i-this._prevPos,this._prevPos=i}else{if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=t.pathLength()-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(t,this._pattern,!1))return null;this._pattern.reset();const i=this._pattern.nextValue()*this._subPathLen,n=this._beginGap+i;e=n-this._prevPos,this._prevPos=n,this.iteratePath=!0}const i=new r.ps;if(!this._walker.nextPointAndAngle(e,i,r.YQ.END))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(i.pt[0]-this._offset*i.sa,i.pt[1]+this._offset*i.ca);const n=this._isFirst&&this._flipFirst;let s,o;return this._angleToLine?(s=i.ca,o=i.sa):(s=1,o=0),n&&(s=-s,o=-o),this.internalPlacement.setRotateCS(s,o),this._isFirst=!1,this._posCount--,0===this._posCount&&(this.iteratePath=!1),this.internalPlacement}}},20305:function(t,e,i){i.d(e,{M:function(){return c}});var n=i(13798),r=i(29076),s=i(33389);const o=512,a=24,l=1e-6;class c{static local(){return null===c.instance&&(c.instance=new c),c.instance}execute(t,e,i,n,r){return new u(t,e,i,n,r)}}c.instance=null;class u{constructor(t,e,i,a,l){if(this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._accelerationMap=null,this._testInsidePolygon=!1,this._verticalSubdivision=!0,this._stepX=Math.abs(e.stepX??16)*i,this._stepY=Math.abs(e.stepY??16)*i,this._stepX=Math.round(128*this._stepX)/128,this._stepY=Math.round(128*this._stepY)/128,0!==this._stepX&&0!==this._stepY){if(this._gridType=e.gridType??s.Q1.Fixed,this._gridType===s.Q1.Random){const t=e.seed??13,i=1;this._randomLCG=new n.A(t*i),this._randomness=(e.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0,this._buildRandomValues()}else{if(this._randomness=0,this._gridAngle=e.gridAngle??0,this._shiftOddRows=e.shiftOddRows??!1,this._offsetX=(e.offsetX??0)*i,this._offsetY=(e.offsetY??0)*i,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}if(this._graphicOriginX=0,this._graphicOriginY=0,null!=a){const[t,e,i,n]=a.split("/"),r=parseFloat(t),s=parseFloat(e),l=parseFloat(i),c=parseFloat(n);this._graphicOriginX=-(c*2**r+l)*o,this._graphicOriginY=s*o,this._testInsidePolygon=!0}this._internalPlacement=new r.W,this._calculateMinMax(t),this._geometryCursor=t}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!u._randValues){u._randValues=[];for(let t=0;t<a;t++)for(let t=0;t<a;t++)u._randValues.push(this._randomLCG.getFloat()),u._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(t){let e,i,n,r,s,a,l,c,u,h,d,f,_,p;this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,l=c=_=d=Number.MAX_VALUE,u=h=p=f=-Number.MAX_VALUE;const m=1!==this._cosAngle;for(t.reset();t.nextPath();)for(;t.nextPoint();)a=t.x,s=t.y,e=a-this._graphicOriginX-this._offsetX,i=s-this._graphicOriginY-this._offsetY,m?(n=this._cosAngle*e-this._sinAngle*i,r=this._sinAngle*e+this._cosAngle*i):(n=e,r=i),l=Math.min(l,n),u=Math.max(u,n),c=Math.min(c,r),h=Math.max(h,r),d=Math.min(d,s),f=Math.max(f,s),_=Math.min(_,a),p=Math.max(p,a);d=d!==Number.MAX_VALUE?d:-o-this._stepY,f=f!==-Number.MAX_VALUE?f:this._stepY,_=_!==Number.MAX_VALUE?_:-this._stepX,p=p!==-Number.MAX_VALUE?p:o+this._stepX;const g=f-d,y=p-_;if(this._verticalSubdivision=g>=y,this._polygonMin=this._verticalSubdivision?d:_,this._testInsidePolygon){let t=0-this._graphicOriginX-this._offsetX-this._stepX,e=o-this._graphicOriginX-this._offsetX+this._stepX,i=-o-this._graphicOriginY-this._offsetY-this._stepY,n=0-this._graphicOriginY-this._offsetY+this._stepY;if(m){const r=[[t,i],[t,n],[e,i],[e,n]];t=i=Number.MAX_VALUE,e=n=-Number.MAX_VALUE;for(const s of r){const r=this._cosAngle*s[0]-this._sinAngle*s[1],o=this._sinAngle*s[0]+this._cosAngle*s[1];t=Math.min(t,r),e=Math.max(e,r),i=Math.min(i,o),n=Math.max(n,o)}}l=l!==Number.MAX_VALUE?Math.max(l,t):t,c=c!==Number.MAX_VALUE?Math.max(c,i):i,u=u!==-Number.MAX_VALUE?Math.min(u,e):e,h=h!==-Number.MAX_VALUE?Math.min(h,n):n}this._xMin=Math.round(l/this._stepX),this._xMax=Math.round(u/this._stepX),this._yMin=Math.round(c/this._stepY),this._yMax=Math.round(h/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1,this._buildAccelerationMap(t,_,p,d,f)}_buildAccelerationMap(t,e,i,n,r){t.reset();const s=new Map,a=this._verticalSubdivision,l=a?r-n:i-e;let c=Math.ceil(l/10);if(c<=1)return;const u=Math.floor(l/c);let d,f,_,p,m,g,y,v,x,b,S;for(c++,this._delta=u,a?(x=-o-2*this._stepY,b=2*this._stepY,S=n):(x=-2*this._stepX,b=o+2*this._stepX,S=e);t.nextPath();)if(!(t.pathSize<2)&&t.nextPoint())for(d=t.x,f=t.y;t.nextPoint();d=_,f=p){if(_=t.x,p=t.y,a){if(f===p||f<x&&p<x||f>b&&p>b)continue;m=Math.min(f,p),g=Math.max(f,p)}else{if(d===_||d<x&&_<x||d>b&&_>b)continue;m=Math.min(d,_),g=Math.max(d,_)}for(;m<g;)y=Math.floor((m-S)/u),h(y,d,f,_,p,s),m+=u;v=Math.floor((g-S)/u),v>y&&h(v,d,f,_,p,s)}this._accelerationMap=s}_nextInside(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--}let t=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(t+=.5*this._stepX);const e=this._currentY*this._stepY+this._offsetY;let i,n;if(this._currentX++,this._gridType===s.Q1.Random){const r=(this._currentX%a+a)%a,s=(this._currentY%a+a)%a;i=this._graphicOriginX+t+this._stepX*this._randomness*(.5-u._randValues[s*a+r])*2/3,n=this._graphicOriginY+e+this._stepY*this._randomness*(.5-u._randValues[s*a+r+1])*2/3}else i=this._graphicOriginX+this._cosAngle*t+this._sinAngle*e,n=this._graphicOriginY-this._sinAngle*t+this._cosAngle*e;if(!this._testInsidePolygon||this._isInsidePolygon(i,n,this._geometryCursor))return this._internalPlacement.setTranslate(i,n),this._internalPlacement}}_isInsidePolygon(t,e,i){if(null==this._accelerationMap)return function(t,e,i){let n,r,s,o,a=0;for(t+=l,e+=l,i.reset();i.nextPath();)if(i.nextPoint())for(n=i.x,r=i.y;i.nextPoint();n=s,r=o)s=i.x,o=i.y,r>e!=o>e&&((s-n)*(e-r)-(o-r)*(t-n)>0?a++:a--);return 0!==a}(t,e,i);t+=l,e+=l;const n=this._verticalSubdivision,r=n?e:t,s=Math.floor((r-this._polygonMin)/this._delta),o=this._accelerationMap.get(s);if(!o)return!1;let a,c,u,h=0;for(const i of o){if(a=i[0],c=i[1],n){if(a[1]>e==c[1]>e)continue;u=(c[0]-a[0])*(e-a[1])-(c[1]-a[1])*(t-a[0])}else{if(a[0]>t==c[0]>t)continue;u=(c[1]-a[1])*(t-a[0])-(c[0]-a[0])*(e-a[1])}u>0?h++:h--}return 0!==h}}function h(t,e,i,n,r,s){let o=s.get(t);o||(o=[],s.set(t,o)),o.push([[e,i],[n,r]])}},58892:function(t,e,i){i.d(e,{R:function(){return o}});var n=i(23454),r=i(93996),s=i(33389);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,i,n,r){return new a(t,e,i)}}o.instance=null;class a extends n.pC{constructor(t,e,i){super(t),this._curveHelper=new r.I,this._angleToLine=void 0===e.angleToLine||e.angleToLine,this._offset=void 0!==e.offset?e.offset*i:0,this._relativeTo=e.relativeTo,this._position=void 0!==e.startPointOffset?e.startPointOffset*i:0,this._epsilon=.001*i}processPath(t){const e=this._position;if(this._relativeTo===s.ip.SegmentMidpoint){if(this.iteratePath||(this.iteratePath=!0),t.nextPoint()){let[e,i]=[t.x,t.y],[n,r]=[0,0];for(;t.nextPoint();){n=t.x,r=t.y;const s=this._curveHelper.getLength(e,i,n,r);if(s<this._epsilon){e=n,i=r;continue}const o=.5+this._position/s,[a,l]=this._curveHelper.getAngleCS(e,i,n,r,o),c=this._curveHelper.getCoord2D(e,i,n,r,o);return this.internalPlacement.setTranslate(c[0]-this._offset*l,c[1]+this._offset*a),this._angleToLine&&this.internalPlacement.setRotateCS(a,l),this.internalPlacement}}return this.iteratePath=!1,null}const i=this._relativeTo===s.ip.LineEnd;return this.onLine(t,e,i)}onLine(t,e,i){let n,r=!1;switch(this._relativeTo){case s.ip.LineMiddle:default:t.seekPathStart(),n=t.pathLength()/2+e;break;case s.ip.LineBeginning:n=e;break;case s.ip.LineEnd:n=e,r=!0}i?t.seekPathEnd():t.seekPathStart();let o=0;if(i?t.prevPoint():t.nextPoint()){let[e,s]=[t.x,t.y],[a,l]=[0,0];for(;i?t.prevPoint():t.nextPoint();){a=t.x,l=t.y;const i=this._curveHelper.getLength(e,s,a,l);if(o+i>n){const t=(n-o)/i,[c,u]=this._curveHelper.getAngleCS(e,s,a,l,t),h=this._curveHelper.getCoord2D(e,s,a,l,t),d=r?-this._offset:this._offset;return this.internalPlacement.setTranslate(h[0]-d*u,h[1]+d*c),this._angleToLine&&(r?this.internalPlacement.setRotateCS(-c,-u):this.internalPlacement.setRotateCS(c,u)),this.internalPlacement}e=a,s=l,o+=i}}return null}}},80585:function(t,e,i){i.d(e,{A:function(){return s}});var n=i(23454),r=i(93996);class s{static local(){return null===s.instance&&(s.instance=new s),s.instance}execute(t,e,i,n,r){return new o(t,e,i)}}s.instance=null;class o extends n.pC{constructor(t,e,i){super(t),this._curveHelper=new r.I,this._angleToLine=void 0===e.angleToLine||e.angleToLine,this._offset=void 0!==e.offset?e.offset*i:0,this._endPoints=void 0===e.placeOnEndPoints||e.placeOnEndPoints,this._controlPoints=void 0===e.placeOnControlPoints||e.placeOnControlPoints,this._regularVertices=void 0===e.placeOnRegularVertices||e.placeOnRegularVertices,this._tags=[],this._tagIterator=0}processPath(t){if(this.iteratePath||(this._preparePath(t),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;const e=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(e[2]);let i=e[0],n=e[1];if(0!==this._offset){const t=Math.cos(e[2]),r=Math.sin(e[2]);i-=this._offset*r,n+=this._offset*t}return this.internalPlacement.setTranslate(i,n),this._tagIterator++,this.internalPlacement}_preparePath(t){this._tags.length=0,this._tagIterator=0,t.seekPathStart();const e=t.isClosed();let i=0,n=!1,r=0,s=0;if(t.seekPathStart(),t.nextPoint()){let o=t.x,l=t.y,c=t.getControlPoint(),u=!0,h=t.nextPoint();for(;h;){const d=t.x,f=t.y,_=t.getControlPoint();(this._angleToLine||0!==this._offset)&&(r=this._curveHelper.getAngle(o,l,d,f,0)),u?(u=!1,e?(i=r,n=c):(this._endPoints||this._controlPoints&&c)&&this._tags.push([o,l,r])):c?this._controlPoints&&this._tags.push([o,l,a(s,r)]):this._regularVertices&&this._tags.push([o,l,a(s,r)]),(this._angleToLine||0!==this._offset)&&(s=this._curveHelper.getAngle(o,l,d,f,1)),h=t.nextPoint(),h||(e?_||n?this._controlPoints&&this._tags.push([d,f,a(s,i)]):this._regularVertices&&this._tags.push([d,f,a(s,i)]):(this._endPoints||this._controlPoints&&_)&&this._tags.push([d,f,s])),o=d,l=f,c=_}}this._tagIterator=0}}function a(t,e){const i=Math.PI;for(;Math.abs(e-t)>i+2e-15;)e-t>i?e-=2*i:e+=2*i;return(t+e)/2}},58676:function(t,e,i){i.d(e,{L:function(){return l}});var n=i(35068),r=i(72228),s=i(30804),o=i(29076),a=i(33389);class l{static local(){return null===l.instance&&(l.instance=new l),l.instance}execute(t,e,i,n,r){return new c(t,e,i)}}l.instance=null;class c{constructor(t,e,i){this._geometryCursor=t,this._offsetX=void 0!==e.offsetX?e.offsetX*i:0,this._offsetY=void 0!==e.offsetY?e.offsetY*i:0,this._method=void 0!==e.method?e.method:a.YI.OnPolygon,this._internalPlacement=new o.W}next(){const t=this._geometryCursor;return this._geometryCursor=null,t?this._polygonCenter(t):null}_polygonCenter(t){let e=!1;switch(this._method){case a.YI.CenterOfMass:{const i=(0,r.TP)(t);i&&(this._internalPlacement.setTranslate(i[0]+this._offsetX,i[1]+this._offsetY),e=!0)}break;case a.YI.BoundingBoxCenter:{const i=(0,n.z8)(t);i&&(this._internalPlacement.setTranslate((i[2]+i[0])/2+this._offsetX,(i[3]+i[1])/2+this._offsetY),e=!0)}break;case a.YI.OnPolygon:default:{const i=(0,s.d)(t);null!==i&&(this._internalPlacement.setTranslate(i[0]+this._offsetX,i[1]+this._offsetY),e=!0)}}return e?this._internalPlacement:null}}},84728:function(t,e,i){i.d(e,{c:function(){return a},k:function(){return l}});var n=i(5161),r=i(15774),s=i(2014);const o=t=>"vertical"===t||"horizontal"===t||"cross"===t||"esriSFSCross"===t||"esriSFSVertical"===t||"esriSFSHorizontal"===t;function a(t,e,i){const n=e.style,s=(0,r.yR)(Math.ceil(i)),a=o(n)?8*s:16*s,l=2*s;t.width=a,t.height=a;const c=t.getContext("2d");c.strokeStyle="#FFFFFF",c.lineWidth=s,c.beginPath(),"vertical"!==n&&"cross"!==n&&"esriSFSCross"!==n&&"esriSFSVertical"!==n||(c.moveTo(a/2,-l),c.lineTo(a/2,a+l)),"horizontal"!==n&&"cross"!==n&&"esriSFSCross"!==n&&"esriSFSHorizontal"!==n||(c.moveTo(-l,a/2),c.lineTo(a+l,a/2)),"backward-diagonal"!==n&&"diagonal-cross"!==n&&"esriSFSDiagonalCross"!==n&&"esriSFSBackwardDiagonal"!==n||(c.moveTo(-l,-l),c.lineTo(a+l,a+l),c.moveTo(a-l,-l),c.lineTo(a+l,l),c.moveTo(-l,a-l),c.lineTo(l,a+l)),"forward-diagonal"!==n&&"diagonal-cross"!==n&&"esriSFSForwardDiagonal"!==n&&"esriSFSDiagonalCross"!==n||(c.moveTo(a+l,-l),c.lineTo(-l,a+l),c.moveTo(l,-l),c.lineTo(-l,l),c.moveTo(a+l,a-l),c.lineTo(a-l,a+l)),c.stroke();const u=c.getImageData(0,0,t.width,t.height),h=new Uint8Array(u.data);let d;for(let t=0;t<h.length;t+=4)d=h[t+3]/255,h[t]=h[t]*d,h[t+1]=h[t+1]*d,h[t+2]=h[t+2]*d;return[h,t.width,t.height,s]}function l(t,e){null==t&&(t=[]);const i="Butt"===e,r="Square"===e,o=!i&&!r;t.length%2==1&&(t=[...t,...t]);const a=s.$,l=2*a;let c=0;for(const e of t)c+=e;const u=Math.round(c*a),h=new Float32Array(u*l),d=.5*a;let f=0,_=0,p=.5,m=!0;for(const e of t){for(f=_,_+=e*a;p<=_;){let t=.5;for(;t<l;){const e=(t-.5)*u+p-.5,n=o?(t-a)*(t-a):Math.abs(t-a);h[e]=m?i?Math.max(Math.max(f+d-p,n),Math.max(p-_+d,n)):n:o?Math.min((p-f)*(p-f)+n,(p-_)*(p-_)+n):r?Math.min(Math.max(p-f,n),Math.max(_-p,n)):Math.min(Math.max(p-f+d,n),Math.max(_+d-p,n)),t++}p++}m=!m}const g=h.length,y=new Uint8Array(4*g);for(let t=0;t<g;++t){const e=(o?Math.sqrt(h[t]):h[t])/a;(0,n.U)(e,y,4*t)}return[y,u,l]}},79083:function(t,e,i){i.d(e,{C:function(){return g}});var n=i(53804),r=i(83525),s=(i(39819),i(58941)),o=(i(40633),i(23502)),a=(i(13798),i(65953)),l=i(39686),c=i(15774),u=i(45273);class h{constructor(t,e,i){this._width=t*i,this._height=e*i,this._pixelRatio=i;const n=Math.ceil(this._width/1),r=Math.ceil(this._height/1);this._cols=n,this._rows=r,this._cells=u.y.create(n*r)}insertMetrics(t){this._markMetrics(t)}hasCollision(t){let e=0;for(const{computedX:i,computedY:n,width:r,height:s}of t.bounds){const t=(r+l.C2)*this._pixelRatio,o=(s+l.C2)*this._pixelRatio;switch(this._collide(i,n,t,o)){case 2:return 2;case 1:e++}}return e===t.bounds.length?1:0}getCellId(t,e){return t+e*this._cols}has(t){return this._cells.has(t)}hasRange(t,e){return this._cells.hasRange(t,e)}set(t){this._cells.set(t)}setRange(t,e){this._cells.setRange(t,e)}_collide(t,e,i,n){const r=t-i/2,s=e-n/2,o=r+i,a=s+n;if(o<0||a<0||r>this._width||s>this._height)return 1;const l=(0,c.qE)(Math.floor(r/1),0,this._cols),u=(0,c.qE)(Math.floor(s/1),0,this._rows),h=(0,c.qE)(Math.ceil(o/1),0,this._cols),d=(0,c.qE)(Math.ceil(a/1),0,this._rows);for(let t=u;t<=d;t++)for(let e=l;e<=h;e++){const i=this.getCellId(e,t);if(this.has(i))return 2}return 0}_mark(t,e,i,n,r){const s=t-i/2,o=e-n/2,a=s+i,l=o+n,u=(0,c.qE)(Math.floor(s/1),0,this._cols),h=(0,c.qE)(Math.floor(o/1),0,this._rows),d=(0,c.qE)(Math.ceil(a/1),0,this._cols),f=(0,c.qE)(Math.ceil(l/1),0,this._rows);for(let t=h;t<=f;t++)for(let e=u;e<=d;e++){const i=this.getCellId(e,t);this.set(i)}return!1}_markMetrics(t){for(const{computedX:e,computedY:i,width:n,height:r}of t.bounds){const s=(n+l.C2)*this._pixelRatio,o=(r+l.C2)*this._pixelRatio;this._mark(e,i,s,o,t.entityTexel)}}}const d=254,f=255;function _(t,e){const i=t.children.slice();i.sort(((t,e)=>t.tileAge-e.tileAge)),i.forEach((t=>{null!=t.labelMetrics&&t.isReady&&e(t,t.labelMetrics)}))}function p(t,e){return(!t.minScale||t.minScale>=e)&&(!t.maxScale||t.maxScale<=e)}class m{run(t,e,i,n){const r=[];for(let e=t.length-1;e>=0;e--){const i=t[e];i.labelingCollisionInfos?.length&&r.push(...i.labelingCollisionInfos)}(0,s.A)("esri-2d-update-debug")&&r.length&&console.debug("CollisionEngine.run"),this._transformMetrics(r),this._runCollision(r,e,i,n);for(const t of r)t.container.requestRender()}_runCollision(t,e,i,n){const[r,s]=e.state.size,o=new h(r,s,e.pixelRatio);for(const{container:e,deconflictionEnabled:r,visible:s}of t){const t=e.attributeView;r?s?(this._prepare(e),this._collideVisible(o,e,i,n),this._collideInvisible(o,e)):_(e,((e,i)=>{for(const e of i)t.setLabelMinZoom(e.entityTexel,f)})):_(e,((e,n)=>{for(const e of n)p(e,i)?(t.setLabelMinZoom(e.entityTexel,0),s&&o.insertMetrics(e)):t.setLabelMinZoom(e.entityTexel,d)}))}}_isFiltered(t,e,i){const n=e.getFilterFlags(t),r=!i.hasFilter||!!(n&l.LY),s=null==i.featureEffect||i.featureEffect.excludedLabelsVisible||!!(n&l.g0);return!(r&&s)}_prepare(t){const e=t.attributeView,i=new Set;_(t,((n,r)=>{for(const n of r){const r=n.entityTexel;i.has(r)||(i.add(r),this._isFiltered(r,e,t.layerView)?e.setLabelMinZoom(r,d):0!==e.getLabelMinZoom(r)?e.setLabelMinZoom(r,f):e.setLabelMinZoom(r,0))}}))}_collideVisible(t,e,i,n){const r=e.attributeView,s=new Set;_(e,((e,o)=>{for(let a=0;a<o.length;a++){const l=o[a].entityTexel;if(s.has(l))continue;if(e.key.level!==n){r.setLabelMinZoom(l,d),s.add(l);continue}if(!p(o[a],i)){r.setLabelMinZoom(l,d),s.add(l);continue}if(0!==r.getLabelMinZoom(l)){s.add(l);continue}let c=!1,u=!0;const h=a;let f=a;for(;f<o.length;f++){const e=o[f];if(e.entityTexel!==l)break;if(!c)switch(t.hasCollision(e)){case 1:break;case 2:c=!0,u=!1;break;case 0:u=!1}}if(!c)for(let e=h;e<f;e++)t.insertMetrics(o[e]);a=f-1,u||(s.add(l),r.setLabelMinZoom(l,c?d:0))}}))}_collideInvisible(t,e){const i=e.attributeView,n=new Set;_(e,((e,r)=>{for(let e=0;e<r.length;e++){const s=r[e].entityTexel;if(n.has(s))continue;if(i.getLabelMinZoom(s)!==f){n.add(s);continue}let o=!1,a=!0;const l=e;let c=e;for(;c<r.length;c++){const e=r[c];if(e.entityTexel!==s)break;if(!o)switch(t.hasCollision(e)){case 1:break;case 2:o=!0,a=!1;break;case 0:a=!1}}if(!o)for(let e=l;e<c;e++)t.insertMetrics(r[e]);e=c-1,a||(n.add(s),i.setLabelMinZoom(s,o?f:0))}}))}_transformMetrics(t){for(const{container:e,geometryType:i,vvEvaluators:n}of t)_(e,((t,r)=>{const s=e.attributeView,o=t.transforms.labelMat2d;o[4]=Math.round(o[4]),o[5]=Math.round(o[5]);const a="polyline"===i;for(const t of r){const{entityTexel:e,anchorX:i,anchorY:r}=t;let l=t.referenceBounds?.size??0;const c=n[0];if(null!=c){const t=c(s.getVVSize(e));l=isNaN(t)||null==t||t===1/0?l:t}const u=t.directionX*(l/2),h=t.directionY*(l/2);for(const e of t.bounds){let t=i,n=r;if(a){let i=t+e.x+u,r=n+e.y+h;i=o[0]*i+o[2]*r+o[4],r=o[1]*i+o[3]*r+o[5],e.computedX=Math.floor(i),e.computedY=Math.floor(r)}else{t=o[0]*i+o[2]*r+o[4],n=o[1]*i+o[3]*r+o[5];const s=t+e.x+u,a=n+e.y+h;e.computedX=s,e.computedY=a}}}}))}}let g=class extends r.A{constructor(t){super(t),this._lastUpdate=0,this.collisionEngine=new m,this.lastUpdateId=-1,this.updateRequested=!1,this.view=null}get updating(){return(0,s.A)("esri-2d-log-updating")&&console.log(`Updating LabelManager ${this.updateRequested}:\n-> updateRequested: ${this.updateRequested}`),this.updateRequested}update(t){const e=performance.now();e-this._lastUpdate>=32?(this._lastUpdate=e,this.doUpdate(t)):this.requestUpdate()}viewChange(){this.requestUpdate()}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view?.requestUpdate())}processUpdate(t){this.updateRequested&&(this.updateRequested=!1,this.update(t))}doUpdate(t){const e=this.view;if(e)try{const i=t.state.scale,n=e.featuresTilingScheme.getClosestInfoForScale(i).level;this.collisionEngine.run(e.allLayerViews.items,t,i,n)}catch(t){}}};(0,n._)([(0,o.MZ)()],g.prototype,"updateRequested",void 0),(0,n._)([(0,o.MZ)()],g.prototype,"updating",null),(0,n._)([(0,o.MZ)()],g.prototype,"view",void 0),g=(0,n._)([(0,a.$)("esri.views.2d.LabelManager")],g)},89838:function(t,e,i){i.d(e,{OP:function(){return o},V4:function(){return r},rZ:function(){return s}}),i(58941);var n=i(40633);function r(t,e,i){if(null==t)return null;const r=e.readArcadeFeature();e.contextTimeZone=i.$view?.timeZone;try{return t.evaluate({...i,$feature:r},t.services)}catch(t){return n.A.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",t),null}}function s(t){return null==t||t===1/0||t===-1/0||"number"==typeof t&&isNaN(t)}function o(t,e,i,n){if(null==t)return null!=n?n:null;const r=e.readArcadeFeature();e.contextTimeZone=i.$view?.timeZone;const o=t.evaluate({...i,$feature:r},t.services);return s(o)?null!=n?n:null:o}},53838:function(t,e,i){i.d(e,{j:function(){return m}});var n=i(39819),r=i(58941),s=i(40633),o=i(39686),a=i(7459),l=i(88413),c=i(85456),u=i(96402),h=i(78541),d=i(10956);class f{constructor(t,e,i){this._texture=null,this._lastTexture=null,this._fbos={},this.texelSize=4;const{buffer:n,pixelType:r,textureOnly:s}=t,o=(0,l.Qz)(r);this.blockIndex=i,this.pixelType=r,this.size=e,this.textureOnly=s,s||(this.data=new o(n)),this._resetRange()}destroy(){this._texture?.dispose();for(const t in this._fbos){const e=this._fbos[t];e&&("0"===t&&e.detachColorTexture(),e.dispose()),this._fbos[t]=null}this._texture=null}get _textureDesc(){const t=new d.R;return t.wrapMode=c.pF.CLAMP_TO_EDGE,t.samplingMode=c.Cj.NEAREST,t.dataType=this.pixelType,t.width=this.size,t.height=this.size,t}setData(t,e,i){const n=(0,a.Q4)(t),r=this.data,s=n*this.texelSize+e;!r||s>=r.length||(r[s]=i,this.dirtyStart=Math.min(this.dirtyStart,n),this.dirtyEnd=Math.max(this.dirtyEnd,n))}getData(t,e){if(null==this.data)return null;const i=(0,a.Q4)(t)*this.texelSize+e;return!this.data||i>=this.data.length?null:this.data[i]}getTexture(t){return this._texture??this._initTexture(t)}getFBO(t,e=0){if(!this._fbos[e]){const i=0===e?this.getTexture(t):this._textureDesc;this._fbos[e]=new u.H(t,i)}return this._fbos[e]}get hasDirty(){const t=this.dirtyStart;return this.dirtyEnd>=t}updateTexture(t,e){try{const i=this.dirtyStart,o=this.dirtyEnd;if(!this.hasDirty)return;(0,r.A)("esri-2d-update-debug")&&console.debug(`Version[${e}] AttributeStoreView.updateTexture`,{start:i,end:o,firstBytes:new Uint8Array(this.data.buffer.slice(0,16)),block:this}),this._resetRange();const a=this.data.buffer,c=this.getTexture(t),u=4,h=(i-i%this.size)/this.size,d=(o-o%this.size)/this.size,f=h,_=this.size,p=d,m=h*this.size*u,g=(_+p*this.size)*u-m,y=(0,l.Qz)(this.pixelType),v=new y(a,m*y.BYTES_PER_ELEMENT,g),x=this.size,b=p-f+1;if(b>this.size)return void s.A.getLogger("esri.views.2d.engine.webgl.AttributeStoreView").error(new n.A("mapview-webgl","Out-of-bounds index when updating AttributeData"));c.updateData(0,0,f,x,b,v)}catch(t){}}update(t){const{data:e,start:i,end:n}=t;if(null!=e&&null!=this.data){const n=this.data,r=i*this.texelSize;for(let i=0;i<e.length;i++){const s=1<<i%this.texelSize;t.layout&s&&(n[r+i]=e[i])}}this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,n)}resize(t,e){const i=this.size;if(this.size=e,this.textureOnly)return void(i!==this.size&&(this._lastTexture=this._texture,this._texture=null));const n=(0,l.Qz)(this.pixelType);this.destroy(),this.data=new n(t.buffer)}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}_initTexture(t){const e=new h.g(t,this._textureDesc,this.data??void 0);if(null!=this._lastTexture&&this._fbos[0]){const i=this._lastTexture.descriptor.width,n=this._lastTexture.descriptor.height,r=this._lastTexture.descriptor.dataType,s=this._lastTexture.descriptor.pixelFormat,o=this.getFBO(t),a=(0,l.AV)(r),c=new((0,l.Qz)(r))(new ArrayBuffer(i*n*a*this.texelSize)),u=t.getBoundFramebufferObject(),{x:h,y:d,width:f,height:_}=t.getViewport();t.bindFramebuffer(o),o.readPixels(0,0,i,n,s,r,c),e.updateData(0,0,0,2*i,n/2,c),t.setViewport(h,d,f,_),t.bindFramebuffer(u)}return this.destroy(),this._texture=e,this._texture}}class _{constructor(){this.size=0,this._pendingAttributeUpdates=[],this._version=0,this._epoch=0,this._locked=!1}_initialize(t){if(!t)throw new Error("InternalError: initArgs must be defined");const e=t.blockDescriptors;if(this.size=t.blockSize,(0,r.A)("esri-2d-update-debug")&&console.debug("AttributeStoreView.initialize",{message:t}),null==this._data)this._data=e.map(((t,e)=>null!=t?new f(t,this.size,e):null));else for(let t=0;t<this._data.length;t++){const i=this._data[t],n=e[t];null!=n&&(null==i?this._data[t]=new f(n,this.size,t):i.resize(n,this.size))}}destroy(){for(const t of this._data??[])t?.destroy();this._defaultTexture?.dispose(),this._defaultTexture=null,this._pendingAttributeUpdates=[]}isEmpty(){return null==this._data}getBlock(t){return null==this._data?null:this._data[t]}setLabelMinZoom(t,e){this.setData(t,0,1,e)}getLabelMinZoom(t){return this.getData(t,0,1,255)}getFilterFlags(t){return this.getData(t,0,0,0)}getVVSize(t){return this.getData(t,o.dV.VV,0,0)}getData(t,e,i,n){if(!this._data)return 0;const r=this._data[e];if(null==r)return 0;const s=r.getData(t,i);return null!=s?s:n}setData(t,e,i,n){this._data[e].setData(t,i,n)}lockTextureUploads(){this._locked=!0}unlockTextureUploads(){this._locked=!1,this.update()}requestUpdate(t){this._version=t.version,this._pendingAttributeUpdates.push(t),(0,r.A)("esri-2d-update-debug")&&console.debug(`Version[${this._version}] AttributeStoreView.requestUpdate`,{message:t})}get currentEpoch(){return this._epoch}update(){if(this._locked)return;const t=this._pendingAttributeUpdates;this._pendingAttributeUpdates=[];for(const e of t){const{blockData:t,initArgs:i,sendUpdateEpoch:n,version:s}=e;(0,r.A)("esri-2d-update-debug")&&console.debug(`Version[${this._version}] Epoch[${n}] AttributeStoreView.applyUpdate`),this._version=s,this._epoch=n,null!=i&&this._initialize(i);const o=this._data;for(let e=0;e<t.length;e++){const i=t[e],n=o[e];null!=n&&null!=i&&((0,r.A)("esri-2d-update-debug")&&console.debug(`Version[${this._version}] CpuBlock[${e}] AttributeStoreView.update`,{block:i}),n.update(i))}}}getUniforms(t){return{filterFlags:{texture:this._getTexture(t,o.dV.FilterFlags),unit:o.uM},animation:{texture:this._getTexture(t,o.dV.Animation),unit:o.z2},gpgpu:{texture:this._getTexture(t,o.dV.GPGPU),unit:o.Sr},visualVariableData:{texture:this._getTexture(t,o.dV.VV),unit:o.nM},dataDriven0:{texture:this._getTexture(t,o.dV.DD0),unit:o.lL},dataDriven1:{texture:this._getTexture(t,o.dV.DD1),unit:o.sn},dataDriven2:{texture:this._getTexture(t,o.dV.DD2),unit:o.n9},size:this.size}}_getTexture(t,e){const i=this._data?.[e];return i?(i.updateTexture(t,this._version),i.getTexture(t)):this._getDefaultTexture(t)}_getDefaultTexture(t){if(null==this._defaultTexture){const e=new d.R;e.wrapMode=c.pF.CLAMP_TO_EDGE,e.samplingMode=c.Cj.NEAREST,e.width=1,e.height=1,this._defaultTexture=new h.g(t,e,new Uint8Array(4))}return this._defaultTexture}}var p=i(82087);class m extends p.A{constructor(t){super(t),this._statisticsByLevel=new Map,this.attributeView=new _}destroy(){this.children.forEach((t=>t.destroy())),this.removeAllChildren(),this.attributeView.destroy()}doRender(t){t.context.capabilities.enable("textureFloatLinear"),super.doRender(t)}createRenderParams(t){const e=super.createRenderParams(t);return e.attributeView=this.attributeView,e.instanceStore=this._instanceStore,e.statisticsByLevel=this._statisticsByLevel,e}}},7965:function(t,e,i){i.d(e,{m:function(){return a}});var n=i(25090),r=i(36729),s=i(77515),o=i(30488);class a extends s.q{constructor(){super(...arguments),this._childrenSet=new Set,this._needsSort=!1,this._children=[],this._effectView=null,this._highlightOptions=null,this._highlightGradient=null}get blendMode(){return this._blendMode}set blendMode(t){this._blendMode=t,this.requestRender()}get children(){return this._children}get clips(){return this._clips}set clips(t){this._clips=t,this.children.forEach((e=>e.clips=t))}get computedEffects(){return this._effectView?.effects??null}get effect(){return this._effectView?.effect??""}set effect(t){(this._effectView||t)&&(this._effectView||(this._effectView=new r.$B),this._effectView.effect=t,this.requestRender())}get highlightOptions(){return this._highlightOptions}set highlightOptions(t){if(!t)return this._highlightOptions=null,void(this._highlightGradient&&(this._highlightGradient.destroy(),this._highlightGradient=null,this.requestRender()));this._highlightOptions?.equals(t)||(this._highlightOptions=t,this._highlightGradient=(0,o.u4)(this._highlightGradient,t),this.requestRender())}get hasBlending(){return!!this.blendMode}get hasHighlight(){return this.children.some((t=>t.hasHighlight))}get hasLabels(){return this.children.some((t=>t.hasLabels))}get requiresDedicatedFBO(){return this.children.some((t=>"blendMode"in t&&t.blendMode&&"normal"!==t.blendMode))}updateTransitionProperties(t,e){super.updateTransitionProperties(t,e),this._effectView&&(this._effectView.transitionStep(t,e),this._effectView.transitioning&&this.requestRender())}doRender(t){const e=this.createRenderParams(t),{painter:i}=e;i.beforeRenderLayer(e,this._clips?.length?255:0,this.computedOpacity),this.renderChildren(e),i.afterRenderLayer(e,this.computedOpacity)}addChild(t){return this.addChildAt(t,this.children.length)}addChildAt(t,e=this.children.length){if(!t)return t;if(this.contains(t))return t;this._needsSort=!0;const i=t.parent;return i&&i!==this&&i.removeChild(t),e>=this.children.length?this.children.push(t):this.children.splice(e,0,t),this._childrenSet.add(t),t.parent=this,t.stage=this.stage,this!==this.stage&&(t.clips=this.clips),this.requestRender(),t}contains(t){return this._childrenSet.has(t)}endTransitions(){super.endTransitions(),this._effectView&&(this._effectView.endTransitions(),this.requestRender())}removeAllChildren(){this._childrenSet.clear(),this._needsSort=!0;for(const t of this.children)this!==this.stage&&(t.clips=null),t.stage=null,t.parent=null;this.children.length=0}removeChild(t){return this.contains(t)?this.removeChildAt(this.children.indexOf(t)):t}removeChildAt(t){if(t<0||t>=this.children.length)return null;this._needsSort=!0;const e=this.children.splice(t,1)[0];return this._childrenSet.delete(e),this!==this.stage&&(e.clips=null),e.stage=null,e.parent=null,e}sortChildren(t){this._needsSort&&(this.children.sort(t),this._needsSort=!1)}beforeRender(t){super.beforeRender(t);for(const e of this.children)e.beforeRender(t)}afterRender(t){super.afterRender(t);for(const e of this.children)e.afterRender(t)}_createTransforms(){return{displayViewScreenMat3:(0,n.vt)()}}onAttach(){super.onAttach();const t=this.stage;for(const e of this.children)e.stage=t}onDetach(){super.onDetach();for(const t of this.children)t.stage=null}renderChildren(t){for(const e of this.children)e.processRender(t)}createRenderParams(t){return{...t,requireFBO:this.requiresDedicatedFBO,blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:t.globalOpacity*this.computedOpacity,inFadeTransition:this.inFadeTransition,highlightGradient:this._highlightGradient||t.highlightGradient}}}},77515:function(t,e,i){i.d(e,{q:function(){return o}});var n=i(48996),r=i(58941),s=i(60539);class o extends n.A{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(t){this._clips=t,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(t){this._opacity!==t&&(this._opacity=Math.min(1,Math.max(t,0)),this.requestRender())}get stage(){return this._stage}set stage(t){if(this._stage===t)return;const e=this._stage;this._stage=t,t?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):e?.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return null==this._transforms&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(t){this._visible!==t&&(this._visible=t,this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=(0,s.Tw)(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=(0,s.Tw)(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){this._fadeInResolver?.(),this._fadeInResolver=null,this._fadeOutResolver?.(),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(t){this.updateTransitionProperties(t.deltaTime,t.state.scale),this.setTransform(t.state)}afterRender(t){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){this.parent?.removeChild(this)}setTransform(t){}processRender(t){this.stage&&this.computedVisible&&this.doRender(t)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(t,e){const i=0===(0,r.A)("mapview-transitions-duration")?0:1/(0,r.A)("mapview-transitions-duration");if(this.fadeTransitionEnabled&&0!==i){const e=this._fadeOutResolver||!this.visible?0:this.opacity,n=this.computedOpacity;if(n===e)this.computedVisible=this.visible;else{const r=t*i;this.computedOpacity=n>e?Math.max(e,n-r):Math.min(e,n+r),this.computedVisible=this.computedOpacity>0;const s=e===this.computedOpacity;this.inFadeTransition=!s,s||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(t){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}},20152:function(t,e,i){i.d(e,{d:function(){return C}});var n=i(73936),r=i(43745),s=i(88413),o=i(52937),a=i(94020),l=i(85456),c=i(10904);class u extends o.A{constructor(){super(...arguments),this._color=(0,r.fA)(0,1,0,1)}dispose(){this._program&&this._program.dispose()}prepareState({context:t}){t.setStencilTestEnabled(!0),t.setBlendingEnabled(!1),t.setFaceCullingEnabled(!1),t.setColorMask(!1,!1,!1,!1),t.setStencilOp(l.eA.KEEP,l.eA.KEEP,l.eA.REPLACE),t.setStencilWriteMask(255),t.setStencilFunction(l.MT.ALWAYS,0,255)}draw(t,e){const{context:i,state:n,requestRender:r,allowDelayedRender:o}=t,u=(0,s.ES)("clip",{geometry:[{location:0,name:"a_pos",count:2,type:l.pe.SHORT}]}),h=e.getVAO(i,n,u.attributes,u.bufferLayouts);null!=h.indexBuffer&&(this._program||(this._program=(0,c.r)(i,a.T)),!o||null==r||this._program.compiled?(i.useProgram(this._program),this._program.setUniform2fv("u_coord_range",[1,1]),this._program.setUniform4fv("u_color",this._color),this._program.setUniformMatrix3fv("u_dvsMat3",n.displayMat3),i.bindVAO(h),i.drawElements(l.WR.TRIANGLES,h.indexBuffer.size,l.pe.UNSIGNED_INT,0),i.bindVAO()):r())}}var h=i(39686);class d extends o.A{constructor(){super(...arguments),this._desc={vsPath:"overlay/overlay",fsPath:"overlay/overlay",attributes:new Map([["a_pos",0],["a_uv",1]])}}dispose(){}prepareState({context:t}){t.setBlendingEnabled(!0),t.setColorMask(!0,!0,!0,!0),t.setBlendFunctionSeparate(l.dn.ONE,l.dn.ONE_MINUS_SRC_ALPHA,l.dn.ONE,l.dn.ONE_MINUS_SRC_ALPHA),t.setStencilWriteMask(0),t.setStencilTestEnabled(!0),t.setStencilFunction(l.MT.GREATER,255,255)}draw(t,e){const{context:i,painter:n,requestRender:r,allowDelayedRender:o}=t;if(!e.isReady)return;const{computedOpacity:a,dvsMat3:c,isWrapAround:u,perspectiveTransform:d,texture:f,wrapAroundShift:_}=e;t.timeline.begin(this.name);const p=n.materialManager.getProgram(this._desc);if(o&&null!=r&&!p.compiled)return void r();const m=(0,s.ES)("overlay",{geometry:[{location:0,name:"a_pos",count:2,type:l.pe.FLOAT}],tex:[{location:1,name:"a_uv",count:2,type:l.pe.UNSIGNED_SHORT}]}),g=e.getVAO(i,m.bufferLayouts,m.attributes);g&&(i.bindVAO(g),i.useProgram(p),i.bindTexture(f,h.YS),p.setUniformMatrix3fv("u_dvsMat3",c),p.setUniform1i("u_texture",h.YS),p.setUniform1f("u_opacity",a),p.setUniform2fv("u_perspective",d),p.setUniform2fv("u_texSize",e.textureSize),p.setUniform1f("u_wrapAroundShift",0),e.draw(t.context),u&&(p.setUniform1f("u_wrapAroundShift",_),e.draw(t.context)),i.bindVAO(),t.timeline.end(this.name))}}var f=i(829),_=i(55382),p=i(15774),m=i(25090),g=i(86305),y=i(81438);class v extends o.A{constructor(){super(...arguments),this._color=(0,r.fA)(1,0,0,1),this._patternMatrix=(0,m.vt)(),this._programOptions={id:!1,pattern:!1}}dispose(){this._vao&&(this._vao.dispose(),this._vao=null)}drawMany(t,e){const{context:i,painter:n,requestRender:r,allowDelayedRender:s}=t;this._loadWGLResources(t);const o=t.displayLevel,a=t.styleLayer,c=a.backgroundMaterial,u=n.vectorTilesMaterialManager,d=a.getPaintValue("background-color",o),f=a.getPaintValue("background-opacity",o),_=a.getPaintValue("background-pattern",o),m=void 0!==_,g=1|window.devicePixelRatio,y=t.spriteMosaic;let v,x;const b=g>h.C_?2:1,S=this._programOptions;S.pattern=m;const w=u.getMaterialProgram(i,c,S);if(!s||null==r||w.compiled){if(i.bindVAO(this._vao),i.useProgram(w),m){const t=y.getMosaicItemPosition(_,!0);if(null!=t){const{tl:e,br:n,page:r}=t;v=n[0]-e[0],x=n[1]-e[1];const s=y.getPageSize(r);null!=s&&(y.bind(i,l.Cj.LINEAR,r,h.$U),w.setUniform4f("u_tlbr",e[0],e[1],n[0],n[1]),w.setUniform2fv("u_mosaicSize",s),w.setUniform1i("u_texture",h.$U))}w.setUniform1f("u_opacity",f)}else{const t=d[3]*f;this._color[0]=t*d[0],this._color[1]=t*d[1],this._color[2]=t*d[2],this._color[3]=t,w.setUniform4fv("u_color",this._color)}w.setUniform1f("u_depth",a.z||0);for(const t of e){if(w.setUniform1f("u_coord_range",t.rangeX),w.setUniformMatrix3fv("u_dvsMat3",t.transforms.displayViewScreenMat3),m){const e=Math.max(2**(Math.round(o)-t.key.level),1),i=b*t.width*e,n=i/(0,p.yR)(v),r=i/(0,p.yR)(x);this._patternMatrix[0]=n,this._patternMatrix[4]=r,w.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)}i.setStencilFunction(l.MT.EQUAL,0,255),i.drawArrays(l.WR.TRIANGLE_STRIP,0,4)}}else r()}_loadWGLResources(t){if(this._vao)return;const{context:e,styleLayer:i}=t,n=i.backgroundMaterial,r=new Int8Array([0,0,1,0,0,1,1,1]),s=g.g.createVertex(e,l._U.STATIC_DRAW,r),o=new y.Z(e,n.getAttributeLocations(),n.getLayoutInfo(),{geometry:s});this._vao=o}}var x=i(5367);class b extends o.A{constructor(){super(...arguments),this._programOptions={id:!1}}dispose(){}drawMany(t,e){const{context:i,displayLevel:n,requiredLevel:r,state:s,painter:o,spriteMosaic:a,styleLayerUID:c,requestRender:u,allowDelayedRender:h}=t;if(!e.some((t=>t.layerData.get(c)?.circleIndexCount??!1)))return;const d=t.styleLayer,f=d.circleMaterial,_=o.vectorTilesMaterialManager,p=d.getPaintValue("circle-translate",n),m=d.getPaintValue("circle-translate-anchor",n),g=this._programOptions,y=_.getMaterialProgram(i,f,g);if(h&&null!=u&&!y.compiled)return void u();i.useProgram(y),y.setUniformMatrix3fv("u_displayMat3",m===x.Cq.VIEWPORT?s.displayMat3:s.displayViewMat3),y.setUniform2fv("u_circleTranslation",p),y.setUniform1f("u_depth",d.z),y.setUniform1f("u_antialiasingWidth",1.2);let v=-1;for(const t of e){if(!t.layerData.has(c))continue;t.key.level!==v&&(v=t.key.level,f.setDataUniforms(y,n,d,v,a));const e=t.layerData.get(c);if(!e.circleIndexCount)continue;e.prepareForRendering(i);const s=e.vao;null!=s&&(i.bindVAO(s),y.setUniformMatrix3fv("u_dvsMat3",t.transforms.displayViewScreenMat3),r!==t.key.level?i.setStencilFunction(l.MT.EQUAL,t.stencilRef,255):i.setStencilFunction(l.MT.GREATER,255,255),i.drawElements(l.WR.TRIANGLES,e.circleIndexCount,l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.circleIndexStart),t.triangleCount+=e.circleIndexCount/3)}}}const S=1/65536;class w extends o.A{constructor(){super(...arguments),this._fillProgramOptions={id:!1,pattern:!1},this._outlineProgramOptions={id:!1}}dispose(){}drawMany(t,e){const{displayLevel:i,renderPass:n,spriteMosaic:r,styleLayerUID:s}=t;let o=!1;for(const t of e)if(t.layerData.has(s)){const e=t.layerData.get(s);if(e.fillIndexCount>0||e.outlineIndexCount>0){o=!0;break}}if(!o)return;const a=t.styleLayer,l=a.getPaintProperty("fill-pattern"),c=void 0!==l,u=c&&l.isDataDriven;let h;if(c&&!u){const t=l.getValue(i);h=r.getMosaicItemPosition(t,!0)}const d=!c&&a.getPaintValue("fill-antialias",i);let f=!0,_=1;if(!c){const t=a.getPaintProperty("fill-color"),e=a.getPaintProperty("fill-opacity");if(!t?.isDataDriven&&!e?.isDataDriven){const t=a.getPaintValue("fill-color",i);_=a.getPaintValue("fill-opacity",i)*t[3],_>=1&&(f=!1)}}if(f&&"opaque"===n)return;const p=a.getPaintValue("fill-translate",i),m=a.getPaintValue("fill-translate-anchor",i);(f||"translucent"!==n)&&this._drawFill(t,s,a,e,p,m,c,h,u);const g=!a.hasDataDrivenOutlineColor&&a.outlineUsesFillColor&&_<1;d&&"opaque"!==n&&!g&&this._drawOutline(t,s,a,e,p,m)}_drawFill(t,e,i,n,r,s,o,a,c){if(o&&!c&&null==a)return;const{context:u,displayLevel:d,state:f,painter:_,pixelRatio:p,spriteMosaic:m,requestRender:g,allowDelayedRender:y}=t,v=i.fillMaterial,b=_.vectorTilesMaterialManager,w=p>h.C_?2:1,T=this._fillProgramOptions;T.pattern=o;const M=b.getMaterialProgram(u,v,T);if(y&&null!=g&&!M.compiled)return void g();if(u.useProgram(M),null!=a){const{page:t}=a,e=m.getPageSize(t);null!=e&&(m.bind(u,l.Cj.LINEAR,t,h.$U),M.setUniform2fv("u_mosaicSize",e),M.setUniform1i("u_texture",h.$U))}M.setUniformMatrix3fv("u_displayMat3",s===x.Cq.VIEWPORT?f.displayMat3:f.displayViewMat3),M.setUniform2fv("u_fillTranslation",r),M.setUniform1f("u_depth",i.z+S);let P=-1;for(const t of n){if(!t.layerData.has(e))continue;t.key.level!==P&&(P=t.key.level,v.setDataUniforms(M,d,i,P,m));const n=t.layerData.get(e);if(!n.fillIndexCount)continue;n.prepareForRendering(u);const r=n.fillVAO;if(null!=r){if(u.bindVAO(r),M.setUniformMatrix3fv("u_dvsMat3",t.transforms.displayViewScreenMat3),u.setStencilFunction(l.MT.EQUAL,t.stencilRef,255),o){const e=Math.max(2**(Math.round(d)-t.key.level),1),i=t.rangeX/(w*t.width*e);M.setUniform1f("u_patternFactor",i)}if(c){const t=n.patternMap;if(!t)continue;for(const[e,i]of t){const t=m.getPageSize(e);null!=t&&(m.bind(u,l.Cj.LINEAR,e,h.$U),M.setUniform2fv("u_mosaicSize",t),M.setUniform1i("u_texture",h.$U),u.drawElements(l.WR.TRIANGLES,i[1],l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*i[0]))}}else u.drawElements(l.WR.TRIANGLES,n.fillIndexCount,l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*n.fillIndexStart);t.triangleCount+=n.fillIndexCount/3}}}_drawOutline(t,e,i,n,r,s){const{context:o,displayLevel:a,state:c,painter:u,pixelRatio:h,spriteMosaic:d,requestRender:f,allowDelayedRender:_}=t,p=i.outlineMaterial,m=u.vectorTilesMaterialManager,g=.75/h,y=this._outlineProgramOptions,v=m.getMaterialProgram(o,p,y);if(_&&null!=f&&!v.compiled)return void f();o.useProgram(v),v.setUniformMatrix3fv("u_displayMat3",s===x.Cq.VIEWPORT?c.displayMat3:c.displayViewMat3),v.setUniform2fv("u_fillTranslation",r),v.setUniform1f("u_depth",i.z+S),v.setUniform1f("u_outline_width",g);let b=-1;for(const t of n){if(!t.layerData.has(e))continue;t.key.level!==b&&(b=t.key.level,p.setDataUniforms(v,a,i,b,d));const n=t.layerData.get(e);if(n.prepareForRendering(o),!n.outlineIndexCount)continue;const r=n.outlineVAO;null!=r&&(o.bindVAO(r),v.setUniformMatrix3fv("u_dvsMat3",t.transforms.displayViewScreenMat3),o.setStencilFunction(l.MT.EQUAL,t.stencilRef,255),o.drawElements(l.WR.TRIANGLES,n.outlineIndexCount,l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*n.outlineIndexStart),t.triangleCount+=n.outlineIndexCount/3)}}}class T extends o.A{constructor(){super(...arguments),this._programOptions={id:!1,pattern:!1,sdf:!1}}dispose(){}drawMany(t,e){const{context:i,displayLevel:n,state:r,painter:s,pixelRatio:o,spriteMosaic:a,styleLayerUID:c,requestRender:u,allowDelayedRender:d}=t;if(!e.some((t=>t.layerData.get(c)?.lineIndexCount??!1)))return;const f=t.styleLayer,_=f.lineMaterial,p=s.vectorTilesMaterialManager,m=f.getPaintValue("line-translate",n),g=f.getPaintValue("line-translate-anchor",n),y=f.getPaintProperty("line-pattern"),v=void 0!==y,b=v&&y.isDataDriven;let S,w;if(v&&!b){const t=y.getValue(n);S=a.getMosaicItemPosition(t)}let T=!1;if(!v){const t=f.getPaintProperty("line-dasharray");if(w=void 0!==t,T=w&&t.isDataDriven,w&&!T){const e=t.getValue(n),i=f.getDashKey(e,f.getLayoutValue("line-cap",n));S=a.getMosaicItemPosition(i)}}const M=1/o,P=this._programOptions;P.pattern=v,P.sdf=w;const E=p.getMaterialProgram(i,_,P);if(d&&null!=u&&!E.compiled)return void u();if(i.useProgram(E),E.setUniformMatrix3fv("u_displayViewMat3",r.displayViewMat3),E.setUniformMatrix3fv("u_displayMat3",g===x.Cq.VIEWPORT?r.displayMat3:r.displayViewMat3),E.setUniform2fv("u_lineTranslation",m),E.setUniform1f("u_depth",f.z),E.setUniform1f("u_antialiasing",M),S&&null!=S){const{page:t}=S,e=a.getPageSize(t);null!=e&&(a.bind(i,l.Cj.LINEAR,t,h.$U),E.setUniform2fv("u_mosaicSize",e),E.setUniform1i("u_texture",h.$U))}let A=-1;for(const t of e){if(!t.layerData.has(c))continue;t.key.level!==A&&(A=t.key.level,_.setDataUniforms(E,n,f,A,a));const e=2**(n-A)/o;E.setUniform1f("u_zoomFactor",e);const r=t.layerData.get(c);if(!r.lineIndexCount)continue;r.prepareForRendering(i);const s=r.vao;if(null!=s){if(i.bindVAO(s),E.setUniformMatrix3fv("u_dvsMat3",t.transforms.displayViewScreenMat3),i.setStencilFunction(l.MT.EQUAL,t.stencilRef,255),b||T){const t=r.patternMap;if(!t)continue;for(const[e,n]of t){const t=a.getPageSize(e);null!=t&&(a.bind(i,l.Cj.LINEAR,e,h.$U),E.setUniform2fv("u_mosaicSize",t),E.setUniform1i("u_texture",h.$U),i.drawElements(l.WR.TRIANGLES,n[1],l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*n[0]))}}else i.drawElements(l.WR.TRIANGLES,r.lineIndexCount,l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*r.lineIndexStart);t.triangleCount+=r.lineIndexCount/3}}}}var M=i(14583),P=i(92422),E=i(36753);class A extends o.A{constructor(){super(...arguments),this._iconProgramOptions={id:!1,sdf:!1},this._sdfProgramOptions={id:!1},this._spritesTextureSize=(0,M.vt)()}dispose(){}drawMany(t,e){const i=t.styleLayer;this._drawIcons(t,i,e),this._drawText(t,i,e)}_drawIcons(t,e,i){const{context:n,displayLevel:r,painter:s,spriteMosaic:o,state:a,styleLayerUID:l,requestRender:c,allowDelayedRender:u}=t,d=e.iconMaterial,f=s.vectorTilesMaterialManager;let _,p=!1;for(const t of i)if(t.layerData.has(l)&&(_=t.layerData.get(l),_.iconPerPageElementsMap.size>0)){p=!0;break}if(!p)return;const m=e.getPaintValue("icon-translate",r),g=e.getPaintValue("icon-translate-anchor",r);let y=e.getLayoutValue("icon-rotation-alignment",r);y===x.I5.AUTO&&(y=e.getLayoutValue("symbol-placement",r)===x.kt.POINT?x.I5.VIEWPORT:x.I5.MAP);const v=y===x.I5.MAP,b=e.getLayoutValue("icon-keep-upright",r)&&v,S=_.isIconSDF,w=this._iconProgramOptions;w.sdf=S;const T=f.getMaterialProgram(n,d,w);if(u&&null!=c&&!T.compiled)return void c();n.useProgram(T),T.setUniformMatrix3fv("u_displayViewMat3",y===x.I5.MAP?a.displayViewMat3:a.displayMat3),T.setUniformMatrix3fv("u_displayMat3",g===x.Cq.VIEWPORT?a.displayMat3:a.displayViewMat3),T.setUniform2fv("u_iconTranslation",m),T.setUniform1f("u_depth",e.z),T.setUniform1f("u_mapRotation",(0,E.wV)(a.rotation)),T.setUniform1f("u_keepUpright",b?1:0),T.setUniform1f("u_level",10*r),T.setUniform1i("u_texture",h.$U),T.setUniform1f("u_fadeDuration",P.zk/1e3);let M=-1;for(const s of i){if(!s.layerData.has(l))continue;if(s.key.level!==M&&(M=s.key.level,d.setDataUniforms(T,r,e,M,o)),_=s.layerData.get(l),0===_.iconPerPageElementsMap.size)continue;_.prepareForRendering(n),_.updateOpacityInfo();const i=_.iconVAO;if(null!=i){n.bindVAO(i),T.setUniformMatrix3fv("u_dvsMat3",s.transforms.displayViewScreenMat3),T.setUniform1f("u_time",(performance.now()-_.lastOpacityUpdate)/1e3);for(const[e,i]of _.iconPerPageElementsMap)this._renderIconRange(t,T,i,e,s)}}}_renderIconRange(t,e,i,n,r){const{context:s,spriteMosaic:o}=t;this._spritesTextureSize[0]=o.getWidth(n)/4,this._spritesTextureSize[1]=o.getHeight(n)/4,e.setUniform2fv("u_mosaicSize",this._spritesTextureSize),o.bind(s,l.Cj.LINEAR,n,h.$U),this._setStencilState(t,r),s.drawElements(l.WR.TRIANGLES,i[1],l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*i[0]),r.triangleCount+=i[1]/3}_drawText(t,e,i){const{context:n,displayLevel:r,glyphMosaic:s,painter:o,pixelRatio:a,spriteMosaic:l,state:c,styleLayerUID:u,requestRender:d,allowDelayedRender:f}=t,_=e.textMaterial,p=o.vectorTilesMaterialManager;let m,g=!1;for(const t of i)if(t.layerData.has(u)&&(m=t.layerData.get(u),m.glyphPerPageElementsMap.size>0)){g=!0;break}if(!g)return;const y=e.getPaintProperty("text-opacity");if(y&&!y.isDataDriven&&0===y.getValue(r))return;const v=e.getPaintProperty("text-color"),b=!v||v.isDataDriven||v.getValue(r)[3]>0,S=e.getPaintProperty("text-halo-width"),w=e.getPaintProperty("text-halo-color"),T=(!S||S.isDataDriven||S.getValue(r)>0)&&(!w||w.isDataDriven||w.getValue(r)[3]>0);if(!b&&!T)return;let A=e.getLayoutValue("text-rotation-alignment",r);A===x.I5.AUTO&&(A=e.getLayoutValue("symbol-placement",r)===x.kt.POINT?x.I5.VIEWPORT:x.I5.MAP);const C=A===x.I5.MAP,I=e.getLayoutValue("text-keep-upright",r)&&C,R=.8*3/a;this._glyphTextureSize||(this._glyphTextureSize=(0,M.fA)(s.width/4,s.height/4));const O=e.getPaintValue("text-translate",r),F=e.getPaintValue("text-translate-anchor",r),z=this._sdfProgramOptions,D=p.getMaterialProgram(n,_,z);if(f&&null!=d&&!D.compiled)return void d();n.useProgram(D),D.setUniformMatrix3fv("u_displayViewMat3",A===x.I5.MAP?c.displayViewMat3:c.displayMat3),D.setUniformMatrix3fv("u_displayMat3",F===x.Cq.VIEWPORT?c.displayMat3:c.displayViewMat3),D.setUniform2fv("u_textTranslation",O),D.setUniform1f("u_depth",e.z+152587890625e-16),D.setUniform2fv("u_mosaicSize",this._glyphTextureSize),D.setUniform1f("u_mapRotation",(0,E.wV)(c.rotation)),D.setUniform1f("u_keepUpright",I?1:0),D.setUniform1f("u_level",10*r),D.setUniform1i("u_texture",h.mg),D.setUniform1f("u_antialiasingWidth",R),D.setUniform1f("u_fadeDuration",P.zk/1e3);let L=-1;for(const o of i){if(!o.layerData.has(u))continue;if(o.key.level!==L&&(L=o.key.level,_.setDataUniforms(D,r,e,L,l)),m=o.layerData.get(u),0===m.glyphPerPageElementsMap.size)continue;m.prepareForRendering(n),m.updateOpacityInfo();const i=m.textVAO;if(null==i)continue;n.bindVAO(i),D.setUniformMatrix3fv("u_dvsMat3",o.transforms.displayViewScreenMat3),this._setStencilState(t,o);const a=(performance.now()-m.lastOpacityUpdate)/1e3;D.setUniform1f("u_time",a),m.glyphPerPageElementsMap.forEach(((t,e)=>{this._renderGlyphRange(n,t,e,s,D,T,b,o)}))}}_renderGlyphRange(t,e,i,n,r,s,o,a){n.bind(t,l.Cj.LINEAR,i,h.mg),s&&(r.setUniform1f("u_halo",1),t.drawElements(l.WR.TRIANGLES,e[1],l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e[0]),a.triangleCount+=e[1]/3),o&&(r.setUniform1f("u_halo",0),t.drawElements(l.WR.TRIANGLES,e[1],l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e[0]),a.triangleCount+=e[1]/3)}_setStencilState(t,e){const{context:i,is3D:n,stencilSymbols:r}=t;if(i.setStencilTestEnabled(!0),r)return i.setStencilWriteMask(255),void i.setStencilFunction(l.MT.ALWAYS,e.stencilRef,255);i.setStencilWriteMask(0),n?i.setStencilFunction(l.MT.EQUAL,e.stencilRef,255):i.setStencilFunction(l.MT.GREATER,255,255)}}const C={clip:u,stencil:f.A,bitmap:n.A,overlay:d,tileDebugInfo:_.A,vtlBackground:v,vtlFill:w,vtlLine:T,vtlCircle:b,vtlSymbol:A}},67529:function(t,e,i){i.d(e,{$r:function(){return o},M$:function(){return a},mF:function(){return s}});var n=i(52874),r=i(95457);const s={selection:t=>new r.A({color:new n.A([t.color.r/2,t.color.g/2,t.color.b/2,t.color.a])}),highlight:t=>t,popup:t=>new r.A({color:new n.A([t.color.g,t.color.b,t.color.r,t.color.a])})};function o(t){if(!t)return 0;let e=1;for(const i in s){if(i===t)break;e<<=1}return e}const a=Object.keys(s)},92422:function(t,e,i){i.d(e,{IT:function(){return n},av:function(){return s},o2:function(){return r},zk:function(){return o}});const n=!0,r=32,s=1.5,o=200},58013:function(t,e,i){i.d(e,{u:function(){return f}});var n=i(67348),r=i(10793),s=i(44705),o=i(25090),a=i(20551),l=i(43274),c=i(39686),u=i(54631);const h=(0,o.vt)(),d=(0,l.vt)();class f extends u.Y{constructor(t,e,i,n){super(t,e,i,n,c.CQ,c.CQ)}destroy(){super.destroy()}setTransform(t){const e=this.resolution/t.resolution,i=this.transforms.tileMat3,[o,a]=t.toScreenNoRotation([0,0],[this.x,this.y]),l=this.width/this.rangeX*e,c=this.height/this.rangeY*e;(0,s.hZ)(i,l,0,0,0,c,0,o,a,1),(0,s.lw)(this.transforms.displayViewScreenMat3,t.displayViewMat3,i);const u=this.transforms.labelMat2d,h=window.devicePixelRatio,d=(0,n.hZ)((0,r.vt)(),l*h,0,0,c*h,o*h,a*h);(0,n.lw)(u,t.viewMat2d,d)}_createTransforms(){return{labelMat2d:(0,r.vt)(),tileMat3:(0,o.vt)(),displayViewScreenMat3:(0,o.vt)()}}containsScreenPoint(t,e,i){const n=(0,s.lw)(h,t.viewMat3,this.transforms.tileMat3),r=(0,s.B8)(h,n);if(null==r)return!0;(0,a.s)(d,...e,1);const o=(0,a.t)(d,d,r),l=i*(this.resolution/t.resolution);return o[0]>=-l&&o[0]<this.width+l&&o[1]>=-l&&o[1]<this.height+l}}},94860:function(t,e,i){i.d(e,{Pd:function(){return s},VS:function(){return a},oI:function(){return o}});var n=i(85456),r=i(3817);const s={geometry:[new r._("a_pos",2,n.pe.BYTE,0,2)]},o={geometry:[new r._("a_pos",2,n.pe.BYTE,0,4),new r._("a_tex",2,n.pe.BYTE,2,4)]},a={geometry:[new r._("a_pos",2,n.pe.UNSIGNED_SHORT,0,4)]}},46065:function(t,e,i){i.d(e,{A:function(){return s}});var n=i(88231),r=i(24964);class s{constructor(t,e){this.id=t,this.sortKey=e,this.records=[]}serialize(t){return t.push(this.id),t.writeF32(this.sortKey),(0,r.j)(t,this.records),t}static deserialize(t){const e=t.readInt32(),i=t.readF32(),o=new s(e,i);return o.records=(0,r._)(t,n.A)??[],o}}s.byteSizeHint=2*Uint32Array.BYTES_PER_ELEMENT+n.A.byteSizeHint},7459:function(t,e,i){i.d(e,{KQ:function(){return n},Q4:function(){return s},Ss:function(){return o}});const n=8388607,r=8388608,s=t=>t&n;function o(t,e){return((e?r:0)|t)>>>0}},88231:function(t,e,i){i.d(e,{A:function(){return n}});class n{constructor(t,e,i,n,r,s,o){this.instanceId=t,this.textureKey=e,this.indexStart=i,this.indexCount=n,this.vertexStart=r,this.vertexCount=s,this.overlaps=o}updateBaseOffsets(t){this.vertexStart+=t.vertexFrom,this.indexStart+=t.indexFrom}clone(){return new n(this.instanceId,this.textureKey,this.indexStart,this.indexCount,this.vertexStart,this.vertexCount,this.overlaps)}static write(t,e,i,n,r,s,o,a){t.push(e),t.push(i),t.push(n),t.push(r),t.push(s),t.push(o),t.push(a)}serialize(t){return t.push(this.instanceId),t.push(this.textureKey),t.push(this.indexStart),t.push(this.indexCount),t.push(this.vertexStart),t.push(this.vertexCount),t.push(this.overlaps),t}static deserialize(t){const e=t.readInt32(),i=t.readInt32(),r=t.readInt32(),s=t.readInt32(),o=t.readInt32(),a=t.readInt32(),l=t.readInt32();return new n(e,i,r,s,o,a,l)}}n.byteSizeHint=7*Uint32Array.BYTES_PER_ELEMENT},27657:function(t,e,i){i.d(e,{R:function(){return R}});var n=i(58941),r=i(40633),s=i(10793),o=i(58013),a=i(39686),l=i(46065),c=i(28230),u=i(83258),h=i(86847),d=i(85456);function f(t,e){return t<<16|255&e}class _{constructor(t,e,i,n,r){this.instance=t,this.materialKey=e,this.target=i,this.start=n,this.count=r}get textureKey(){return 255&this.materialKey}get indexEnd(){return this.start+this.count}extend(t){this.count+=t}render(t){this.instance.techniqueRef.render(t,this)}getStencilReference(){return this.target.stencilRef}getAttributePrecisionPackFactors(){const t=this.instance.instanceId;return this.target.getMesh(t).getAttributePrecisionPackFactors()}draw(t,e){(0,h.Eq)(t)?this.drawCompute(t.context,e):this.drawGeometry(t.context,e)}drawCompute(t,e){const i=this.instance.instanceId,n=this.target.getMesh(i).getComputeVAO(t,e),r=this.start*Uint32Array.BYTES_PER_ELEMENT/3;t.bindVAO(n),t.drawElements(d.WR.POINTS,this.count/3,d.pe.UNSIGNED_INT,r),t.bindVAO(null)}drawGeometry(t,e){const i=this.instance.instanceId,n=this.target.getMesh(i).getGeometryVAO(t,e),r=this.start*Uint32Array.BYTES_PER_ELEMENT;t.bindVAO(n),t.drawElements(d.WR.TRIANGLES,this.count,d.pe.UNSIGNED_INT,r),t.bindVAO(null)}}class p{constructor(){this._length=0,this._minOrderedLength=0,this._materialKeys=new Set}static fromDisplayEntities(t,e,i,n){const r=new p;for(const s of t.values())for(const t of s.records){const s=i.getInstance(t.instanceId),o=f(s.instanceId,t.textureKey);r.addRecord(s,o,t.indexStart,t.indexCount,t.vertexStart,t.vertexCount,e,n)}return r}get length(){return this._length}get minOrderedLength(){return this._minOrderedLength}get minUnorderedLength(){return this._materialKeys.size}render(t){const{drawPhase:e}=t;for(const i of this.infos())i.instance.techniqueRef.drawPhase&e&&i.render(t)}addRecord(t,e,i,n,r,s,o,a){let l=i,h=n;if(h||(l=r,h=s),!h)return;if(null==this._head){const i=new _(t,e,o,l,h);return this._head=new u.B(i),this._tail=this._head,this._length++,void this._minOrderedLength++}if(a===c.ch.STRICT_ORDER)return this._insert(t,e,o,l,h,this._tail,null);let d=null,f=this._head;const p=t.instanceId,m=t.techniqueRef.symbologyPlane;if(a===c.ch.STRICT_MARKERS_AND_TEXT&&(m===c.uC.MARKER||m===c.uC.TEXT))return this._insert(t,e,o,l,h,this._tail,null);for(;f;){const i=f.data.instance,n=i.instanceId,r=i.techniqueRef.symbologyPlane,s=d?.data.instance.instanceId;if(m<r||p===s&&p!==n)return this._insert(t,e,o,l,h,d,f);d=f,f=f.next}this._insert(t,e,o,l,h,d,null)}*infos(){if(null!=this._head)for(const t of this._head.values())yield t}_insert(t,e,i,n,r,s,o){if(null==s&&null==o){const s=new _(t,e,i,n,r);return this._head=new u.B(s),this._tail=this._head,this._length++,void this._minOrderedLength++}return e!==this._tail.data.materialKey&&this._minOrderedLength++,this._materialKeys.add(e),null==s&&null!=o?this._insertAtHead(t,e,i,n,r,o):null!=s&&null==o?this._insertAtEnd(t,e,i,n,r,s):null!=s&&null!=o?this._insertAtMiddle(t,e,i,n,r,s,o):void 0}_insertAtHead(t,e,i,n,r,s){const o=n+r;if(e===s.data.materialKey&&i===s.data.target&&o===s.data.start)s.data.start=n,s.data.count+=r;else{const o=new _(t,e,i,n,r);this._head=new u.B(o),this._head.next=s,this._length++}}_insertAtEnd(t,e,i,n,r,s){if(s.data.materialKey===e&&s.data.indexEnd===n)s.data.count+=r;else{const o=new _(t,e,i,n,r);this._tail=new u.B(o),s.next=this._tail,this._length++}}_insertAtMiddle(t,e,i,n,r,s,o){const a=n+r;if(s.data.materialKey===e&&s.data.target===i&&s.data.indexEnd===n)s.data.count+=r,s.data.materialKey===o.data.materialKey&&s.data.target===o.data.target&&s.data.indexEnd===o.data.start&&(s.data.count+=o.data.count,s.next=o.next,this._length--);else if(e===o.data.materialKey&&i===o.data.target&&a===o.data.start)o.data.start=n,o.data.count+=r;else{const a=new _(t,e,i,n,r),l=new u.B(a);s.next=l,l.next=o,this._length++}}}class m{constructor(t){this._indexOnly=t,this.vertex={count:0,operations:[]},this.index={count:0,operations:[]}}copyRecord(t){let e=0;this._indexOnly||(e=this.vertex.count-t.vertexStart,this.vertex.operations.push({srcFrom:t.vertexStart,dstFrom:this.vertex.count,count:t.vertexCount,mutate:0}),t.vertexStart=this.vertex.count,this.vertex.count+=t.vertexCount);let i=!1;if(this._indexOnly&&this.index.operations.length>=1){const e=this.index.operations[this.index.operations.length-1];e.srcFrom+e.count===t.indexStart&&(e.count+=t.indexCount,i=!0)}i||this.index.operations.push({srcFrom:t.indexStart,dstFrom:this.index.count,count:t.indexCount,mutate:e}),t.indexStart=this.index.count,this.index.count+=t.indexCount}}var g=i(57650),y=i(95929),v=i(85475),x=i(28055),b=i(86305);class S{constructor(t,e,i,n){this._pool=n;const r=x.W.create(e*i*Uint32Array.BYTES_PER_ELEMENT,this._pool);this.size=e,this.strideInt=i,this.bufferType=t,this.dirty={start:1/0,end:0},this.memoryStats={bytesUsed:0,bytesReserved:e*i*Uint32Array.BYTES_PER_ELEMENT},this._gpu=null,this._cpu=r,this.clear()}get elementSize(){return this._cpu.length/this.strideInt}get intSize(){return this.fillPointer*this.strideInt}get byteSize(){return this.intSize*Uint32Array.BYTES_PER_ELEMENT}get invalidated(){return this.bufferSize>0&&!this._gpu}get invalidatedComputeBuffer(){return this.bufferSize>0&&!this._gpuComputeTriangles}invalidate(){this._invalidateTriangleBuffer(),this._gpu?.dispose(),this._gpu=null}_invalidateTriangleBuffer(){this._gpuComputeTriangles?.dispose(),this._gpuComputeTriangles=null}destroy(){this._gpu?.dispose(),this._gpuComputeTriangles?.dispose(),this._cpu?.destroy()}clear(){this.dirty.start=1/0,this.dirty.end=0,this.freeList=new u.P({start:0,end:this._cpu.length/this.strideInt}),this.fillPointer=0}ensure(t){if(!(this.maxAvailableSpace()>=t)&&t*this.strideInt>this._cpu.length-this.fillPointer){this.invalidate();const e=this._cpu.length/this.strideInt,i=Math.round(1.25*(e+t)),n=i*this.strideInt;this._cpu.expand(n*Uint32Array.BYTES_PER_ELEMENT),this.freeList.free(e,i-e),this.memoryStats.bytesReserved+=(i-e)*this.strideInt*Uint32Array.BYTES_PER_ELEMENT}}set(t,e){this._cpu.array[t]!==e&&(this._cpu.array[t]=e,this.dirty.start=Math.min(t,this.dirty.start),this.dirty.end=Math.max(t+1,this.dirty.end))}getGPUBuffer(t,e=!1){if(!this.bufferSize)return null;if(e){if("index"!==this.bufferType)throw new Error("Tired to get triangle buffer, but target is not an index buffer");return null==this._gpuComputeTriangles&&(this._gpuComputeTriangles=this._createComputeBuffer(t)),this._gpuComputeTriangles}return null==this._gpu&&(this._gpu=this._createBuffer(t)),this._gpu}getView(t,e){return this._cpu.getUint32View(t,e/Uint32Array.BYTES_PER_ELEMENT)}get bufferSize(){return this._cpu.length/this.strideInt}maxAvailableSpace(){return this.freeList.maxAvailableSpace()}insert(t,e,i,n){const r=i*this.strideInt;if(!r)return 0;const s=e*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,o=new Uint32Array(t,s,r),a=this.freeList.firstFit(i);(0,y.Lw)(a,"First fit region must be defined");const l=a*this.strideInt,c=r;if(this._cpu.array.set(o,l),0!==n)for(let t=0;t<o.length;t++)this._cpu.array[t+l]+=n;return this.dirty.start=Math.min(this.dirty.start,l),this.dirty.end=Math.max(this.dirty.end,l+c),this.fillPointer=Math.max(this.fillPointer,l+c),this.memoryStats.bytesUsed+=i*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,a}copyFrom(t,e,i,n,r){const s=i*this.strideInt;if(!s)return 0;const o=e*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,a=t._cpu.getUint32View(o,s),l=this.freeList.firstFit(i);(0,y.Lw)(l,"First fit region must be defined");const c=l*this.strideInt,u=s;if(this._cpu.array.set(a,c),0!==n)for(let t=0;t<s;t++)this._cpu.array[c+t*this.strideInt+r]+=n;return this.dirty.start=Math.min(this.dirty.start,c),this.dirty.end=Math.max(this.dirty.end,c+u),this.fillPointer=Math.max(this.fillPointer,c+u),this.memoryStats.bytesUsed+=i*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,l}free(t,e,i){const n=t*this.strideInt,r=(t+e)*this.strideInt;if(!0===i)for(let i=t;i!==t+e;i++)this._cpu.array[i*this.strideInt]=2147450879;this.dirty.start=Math.min(this.dirty.start,n),this.dirty.end=Math.max(this.dirty.end,r),this.freeList.free(t,e),this.memoryStats.bytesUsed-=e*this.strideInt*Uint32Array.BYTES_PER_ELEMENT}upload(){if(this.dirty.end){if(this._invalidateTriangleBuffer(),null==this._gpu)return this.dirty.start=1/0,void(this.dirty.end=0);this._gpu.setSubData(this._cpu.array,this.dirty.start,this.dirty.start,this.dirty.end),this.dirty.start=1/0,this.dirty.end=0}}reshuffle(t,e){if(0===e.length)return;const i=this.byteSize,n=t*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,r=i>n,s=this._cpu,o=x.W.create(n,this._pool);r||o.array.set(this._cpu.getUint32View(0,this.intSize));for(const t of e)if(r||t.srcFrom!==t.dstFrom||0!==t.mutate){this.dirty.start=Math.min(this.dirty.start,t.dstFrom*this.strideInt),this.dirty.end=Math.max(this.dirty.end,(t.dstFrom+t.count)*this.strideInt);for(let e=0;e<t.count;e++){const i=(t.dstFrom+e)*this.strideInt,n=(t.srcFrom+e)*this.strideInt;for(let e=0;e<this.strideInt;e++)o.array[i+e]=s.array[n+e]+t.mutate}}this._cpu.destroy(),this._cpu=o,r&&this.invalidate(),this.freeList.clear(),this.memoryStats.bytesUsed=this.memoryStats.bytesReserved=n}_createBuffer(t){const e=d._U.DYNAMIC_DRAW;return"index"===this.bufferType?b.g.createIndex(t,e,this._cpu.array):b.g.createVertex(t,e,this._cpu.array)}_createComputeBuffer(t){const e=d._U.DYNAMIC_DRAW,i=new Uint32Array(this.fillPointer/3);for(let t=0;t<this.fillPointer;t+=3)i[t/3]=this._cpu.array[t];return b.g.createIndex(t,e,i)}}var w=i(5544),T=i(81438);class M{constructor(t,e){if(this._bufferPool=t,this._layout=e,this._invalidated=!1,this._position=this._layout.attributes.find((t=>"pos"===t.name||"position"===t.name)),!this._position)throw new Error("InternalError: Unable to find position attribute")}destroy(){this._indexBuffer=(0,y.pR)(this._indexBuffer),this._vertexBuffer=(0,y.pR)(this._vertexBuffer),this._computeVAO?.disposeVAOOnly(),this._geometryVAO?.disposeVAOOnly()}get layout(){return this._layout}getDrawArgs(t,e,i,n){return n?{primitive:d.WR.POINTS,count:e/3,offset:i/3}:{primitive:t,count:e,offset:i}}getAttributePrecisionPackFactors(){const t={};for(const e of this.layout.attributes)e.packPrecisionFactor&&(t[e.name]=e.packPrecisionFactor);return t}getDebugVertexInfo(t=!1){if(!this._vertexBuffer)return null;const e=this._layout,i=e.stride,n=this._vertexBuffer.getView(0,this._vertexBuffer.byteSize),r=new DataView(n.slice().buffer);let s=n.byteLength/i;t&&(s=this._indexBuffer.fillPointer/3);const o=this._indexBuffer.getView(0,this._indexBuffer.byteSize);let a=0;const l=[];for(let n=0;n<s;n++){t&&(a=o[3*n]*i);const s={};for(const t of e.attributes){let e=`${t.offset} ${t.name}`,i=(0,w.q)(r,t,a);if(t.packPrecisionFactor)if(e+=` (precision: ${t.packPrecisionFactor})`,"number"==typeof i)i/=t.packPrecisionFactor;else for(let e=0;e<i.length;e++)i[e]/=t.packPrecisionFactor;s[e]=i}a+=i,l.push(s)}return{vertices:l,layout:e}}_ensure(t,e){if(this._vertexBuffer&&this._indexBuffer)this._indexBuffer.ensure(Math.max(t,1e3)),this._vertexBuffer.ensure(Math.max(e,1e3));else{const i=this._layout.stride/Uint32Array.BYTES_PER_ELEMENT;this._indexBuffer=new S("index",Math.max(t,1e3),1,this._bufferPool),this._vertexBuffer=new S("vertex",Math.max(e,1e3),i,this._bufferPool)}}append(t){const e=t.layout.stride,i=t.indices.byteLength/Uint32Array.BYTES_PER_ELEMENT,n=t.vertices.byteLength/e;this._ensure(i,n);const{vertices:r,indices:s}=t,o=this._vertexBuffer.insert(r,0,r.byteLength/e,0);return{vertexFrom:o,indexFrom:this._indexBuffer.insert(s,0,s.byteLength/4,o)}}copyRecordFrom(t,e,i,n){const{indexStart:r,indexCount:s,vertexStart:o,vertexCount:a}=e;this._ensure(s,a);const l=t._position,c=i*(l.packPrecisionFactor??1),u=n*(l.packPrecisionFactor??1),h=l.offset,d=(0,v.M9)(c,u),f=this._vertexBuffer.copyFrom(t._vertexBuffer,o,a,d,h),_=this._indexBuffer.copyFrom(t._indexBuffer,r,s,f-o,0),p=e.clone();return p.vertexStart=f,p.indexStart=_,p.overlaps=0,p}remove(t,e,i,n){this._indexBuffer.free(t,e),this._vertexBuffer.free(i,n)}upload(){this._invalidated=!0}getGeometryVAO(t,e){if(!this._vertexBuffer||!this._indexBuffer||!this._vertexBuffer.bufferSize)return null;if(this._invalidated){(this._vertexBuffer.invalidated||this._indexBuffer.invalidated)&&(this._vertexBuffer.invalidate(),this._indexBuffer.invalidate(),this._geometryVAO?.disposeVAOOnly(),this._geometryVAO=null),this._vertexBuffer.upload(),this._indexBuffer.upload();const i=this._indexBuffer.getGPUBuffer(t,!1),n=this._vertexBuffer.getGPUBuffer(t);this._geometryVAO||(this._geometryVAO=new T.Z(t,e.locations,function(t,e){const i=[],n=t.attributes.filter((t=>e.locations.has(t.name)));for(const e of n)i.push({name:e.name,type:e.type,count:e.count,divisor:0,normalized:e.normalized??!1,offset:e.offset,stride:t.stride});return{geometry:i}}(this.layout,e),{geometry:n},i)),this._invalidated=!1}return this._geometryVAO}getComputeVAO(t,e){if(!this._vertexBuffer||!this._indexBuffer||!this._vertexBuffer.bufferSize)return null;(this._vertexBuffer.invalidated||this._indexBuffer.invalidatedComputeBuffer)&&(this._vertexBuffer.invalidate(),this._indexBuffer.invalidate(),this._computeVAO?.disposeVAOOnly(),this._computeVAO=null),this._vertexBuffer.upload(),this._indexBuffer.upload();const i=this._indexBuffer.getGPUBuffer(t,!0),n=this._vertexBuffer.getGPUBuffer(t);return this._computeVAO||(this._computeVAO=new T.Z(t,e.locations,function(t,e){const i=[],n=t.attributes.filter((t=>e.locations.has(t.name)));for(const r of n){i.push({name:r.name,type:r.type,count:r.count,divisor:0,normalized:r.normalized??!1,offset:r.offset,stride:t.stride});const n=e.computeAttributeMap[r.name];null!=n&&2===n.length&&(i.push({name:n[0],count:r.count,divisor:0,type:r.type,normalized:r.normalized??!1,offset:r.offset+t.stride,stride:t.stride}),i.push({name:n[1],count:r.count,divisor:0,type:r.type,normalized:r.normalized??!1,offset:r.offset+2*t.stride,stride:t.stride}))}return{geometry:i}}(this.layout,e),{geometry:n},i),this._invalidated=!1),this._computeVAO}get memoryStats(){return{bytesUsed:this._vertexBuffer.memoryStats.bytesUsed+this._indexBuffer.memoryStats.bytesUsed,bytesReserved:this._vertexBuffer.memoryStats.bytesReserved+this._indexBuffer.memoryStats.bytesReserved,vertex:this._vertexBuffer.memoryStats,index:this._indexBuffer.memoryStats}}reshuffle(t){this._vertexBuffer&&this._vertexBuffer.reshuffle(t.vertex.count,t.vertex.operations),this._indexBuffer&&this._indexBuffer.reshuffle(t.index.count,t.index.operations)}}class P{constructor(t){this._pos=0,this._buffer=t,this._i32View=new Int32Array(this._buffer),this._f32View=new Float32Array(this._buffer)}readInt32(){return this._i32View[this._pos++]}readF32(){return this._f32View[this._pos++]}}var E=i(24964);function A(t){return t?{entities:(0,E._)(new P(t.entities),l.A),vertexData:t.data.map(C)}:null}function C(t){const e=t.layout.stride,i=new DataView(t.vertices),n=[],r=t.vertices.byteLength/e;let s=0;for(let o=0;o<r;o++){const r={};for(const e of t.layout.attributes){let t=`${e.offset} ${e.name}`,n=(0,w.q)(i,e,s);if(e.packPrecisionFactor)if(t+=` (precision: ${e.packPrecisionFactor})`,"number"==typeof n)n/=e.packPrecisionFactor;else for(let t=0;t<n.length;t++)n[t]/=e.packPrecisionFactor;r[t]=n}s+=e,n.push(r)}return{vertices:n,layout:t.layout}}let I=0;class R extends o.u{constructor(t,e,i,n,r=!1){super(t,e,i,n),this._meshes=new Map,this._entities=[],this._invalidated=!1,this._nextUploadAllowed=!1,this.tileAge=I++,this._metrics=[],this._entityIds=new Set,this._entityIdsFromBuffer=new Set,this._attributeEpoch=0,this._encounteredEnd=!1,this.visible=!0,this.transforms.labelMat2d=(0,s.vt)(),this.enableDeferredUploads=r}destroy(){super.destroy(),this.clear()}clear(){for(const t of this._meshes.values())t.destroy();this._meshes.clear(),this._entities=[],this._metrics=[],this._displayList=null,this._invalidated=!0,this._entityIds.clear(),this._nextUploadAllowed=!0}beforeRender(t){super.beforeRender(t),this._needsReshuffle&&t.reshuffleManager.schedule(this)}tryReady(t){const e=this._invalidated&&!this._uploadAllowed;return!(this._isReady||e||!this._encounteredEnd||!(t>=this._attributeEpoch)||((0,n.A)("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.ready [epoch=${t}]`),this.ready(),this.requestRender(),0))}get labelMetrics(){return this._metrics}get hasData(){return!!this._meshes.size}get needsUpload(){return this._invalidated}get _uploadAllowed(){return!this.enableDeferredUploads||this._nextUploadAllowed}upload(){this._nextUploadAllowed=!0}getDisplayList(t,e){if(this._uploadAllowed&&this._invalidated){this._entities.sort(((t,e)=>{const i=e.sortKey,n=t.sortKey;return n===i?t.id-e.id:n-i})),e===c.ch.BATCHING&&this.reshuffle(!0),this._displayList=p.fromDisplayEntities(this._entities,this,t,e);for(const t of this._meshes.values())t.upload();this.debugInfo.display.length=this._displayList.length,this.debugInfo.display.minOrderedLength=this._displayList.minOrderedLength,this.debugInfo.display.minUnorderedLength=this._displayList.minUnorderedLength,this.requestRender(),this._invalidated=!1,this._nextUploadAllowed=!1}return this._displayList}getMesh(t){if(!this._meshes.has(t))throw new Error(`InternalError: Unable to find VAO for instance: ${t}`);return this._meshes.get(t)}getSortKeys(t){const e=new Map;for(const{id:i,sortKey:n}of this._entities)if(t.has(i)&&e.set(i,n),e.size===t.size)break;return e}onMessage(t){switch(t.type){case"append":this._onAppendMessage(t);break;case"update":this._onUpdateMessage(t)}if(this._aggregateMemoryStats(),this.requestRender(),t.end){if((0,n.A)("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.end [epoch=${t.attributeEpoch}]`),!t.attributeEpoch)throw new Error("InternalError: Attribute epoch not defined.");this._attributeEpoch=t.attributeEpoch,this._encounteredEnd=!0}}_onAppendMessage(t){if((0,n.A)("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.append`,{append:A(t?.append)}),t.clear&&this.clear(),!t.append)return;const e=(0,E._)(new P(t.append.entities),l.A);this._insert(e,t.append.data,!1)}_onUpdateMessage(t){(0,n.A)("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.update`,{isPixelBuffer:t.isPixelBuffer,modify:A(t.modify),remove:t.remove});const e=(0,E._)(new P(t.modify.entities),l.A),i=e.map((t=>t.id)),r=t.isPixelBuffer??!1,s=[...t.remove,...i];r?this._removeByIdsFromBuffer(s):this._removeByIds(s),this._insert(e,t.modify.data,r)}reshuffle(t=!1){if(this.destroyed)return;const e=new Map;for(const i of this._entities)for(const n of i.records){const i=this._meshes.get(n.instanceId);let r=e.get(i);r||(r=new m(t),e.set(i,r)),r.copyRecord(n)}for(const[t,i]of e)t.reshuffle(i);this._invalidated=!0,this._aggregateMemoryStats(),(0,n.A)("esri-2d-update-debug")&&r.A.getLogger("esri.views.2d.engine.webgl.FeatureTile").info(`Tile ${this.key.id} was reshuffled.`)}copyPixelBufferedEntitesFrom(t,e,i,n){const r=i*a.CQ,s=n*a.CQ;for(const i of t._entities){let n=null;for(const o of i.records)if(o.overlaps&e){const e=t.getMesh(o.instanceId),a=this._ensureMesh(o.instanceId,e.layout).copyRecordFrom(e,o,r,s);n||(n=new l.A(i.id,i.sortKey),this._entityIdsFromBuffer.add(i.id),this._entities.push(n)),n.records.push(a)}}this._invalidated=!0}_ensureMesh(t,e){return this._meshes.has(t)||this._meshes.set(t,new M(this._stage.bufferPool,e)),this._meshes.get(t)}_insert(t,e,i){if(!t.length)return;this._removeDuplicatedBufferedEntites(t);const n=this._insertVertexData(e);for(const e of t){for(const t of e.records)t.updateBaseOffsets(n.get(t.instanceId));i?this._tryInsertBufferedEntity(e):this._insertEntity(e)}this._invalidated=!0}_insertVertexData(t){const e=new Map;for(const i of t){const{instanceId:t,layout:n}=i,r=this._ensureMesh(t,n).append(i);if(i.metrics){const t=(0,E._)(new P(i.metrics),g.f)??[];this._metrics.push(...t)}e.set(t,r)}return e}_insertEntity(t){(0,n.A)("esri-2d-update-debug")&&this._entityIds.has(t.id)&&console.error(`Tile ${this.key.id} insertEnitty: Already have entityId ${t.id}`),this._entityIds.add(t.id),this._entities.push(t)}_tryInsertBufferedEntity(t){this._entityIds.has(t.id)?this._removeRecordsFromMesh(t.records):(this._entityIdsFromBuffer.add(t.id),this._entities.push(t))}_removeDuplicatedBufferedEntites(t){if(!this._entityIdsFromBuffer.size)return;const e=[];for(const i of t)this._entityIdsFromBuffer.has(i.id)&&e.push(i.id);this._removeByIds(e)}_removeByIdsFromBuffer(t){this._removeByIds(t.filter((t=>this._entityIdsFromBuffer.has(t))))}_removeByIds(t){if(0===t.length)return;const e=new Set(t),i=[];for(const t of this._entities)e.has(t.id)?this._remove(t):i.push(t);this._entities=i,this._invalidated=!0}_remove(t){this._removeRecordsFromMesh(t.records),this._entityIds.delete(t.id),this._entityIdsFromBuffer.delete(t.id)}_removeRecordsFromMesh(t){for(const e of t){const{instanceId:t,indexStart:i,indexCount:n,vertexStart:r,vertexCount:s}=e;this._meshes.get(t)?.remove(i,n,r,s)}}_aggregateMemoryStats(){this.debugInfo.memory.bytesUsed=0,this.debugInfo.memory.bytesReserved=0;for(const[t,e]of this._meshes)this.debugInfo.memory.bytesUsed+=e.memoryStats.bytesUsed,this.debugInfo.memory.bytesReserved+=e.memoryStats.bytesReserved}get _needsReshuffle(){if(this.destroyed)return!1;const{bytesUsed:t,bytesReserved:e}=this.debugInfo.memory,i=t/e,{minOrderedLength:n,length:r}=this.debugInfo.display;return e>a._x&&i<a.eI||r>a.Xh&&n/r<a.Vl}}},36753:function(t,e,i){i.d(e,{p6:function(){return o},wV:function(){return s}}),Math.PI;const n=256/360,r=1/Math.LN2;function s(t){return function(t,e){return(t%=e)>=0?t:t+e}(t*n,256)}function o(t){return Math.log(t)*r}},28055:function(t,e,i){i.d(e,{W:function(){return a},o:function(){return c}});var n=i(58941),r=i(95929),s=i(83258);const o=(0,n.A)("esri-2d-log-allocations");class a{static create(t,e){const i=e.acquireUint32Array(t);return new a(i,e)}constructor(t,e){this._array=t,this._pool=e}get array(){return this._array}get length(){return this._array.length}getUint32View(t,e){return new Uint32Array(this._array.buffer,t+this._array.byteOffset,e)}expand(t){if(t<=this._array.byteLength)return;const e=this._pool.acquireUint32Array(t);e.set(this._array),this._pool.releaseUint32Array(this._array),this._array=e}destroy(){this._pool.releaseUint32Array(this._array)}}class l{constructor(){this._data=new ArrayBuffer(l.BYTE_LENGTH),this._freeList=new s.P({start:0,end:this._data.byteLength})}static get BYTE_LENGTH(){return 16e6}get buffer(){return this._data}acquireUint32Array(t){const e=this._freeList.firstFit(t);return null==e?null:new Uint32Array(this._data,e,t/Uint32Array.BYTES_PER_ELEMENT)}releaseUint32Array(t){this._freeList.free(t.byteOffset,t.byteLength)}}class c{constructor(){this._pages=[],this._pagesByBuffer=new Map,this._bytesAllocated=0}destroy(){this._pages=[],this._pagesByBuffer=null}get _bytesTotal(){return this._pages.length*l.BYTE_LENGTH}acquireUint32Array(t){if(this._bytesAllocated+=t,o&&console.log(`Allocating ${t}, (${this._bytesAllocated} / ${this._bytesTotal})`),t>=l.BYTE_LENGTH)return new Uint32Array(t/Uint32Array.BYTES_PER_ELEMENT);for(const e of this._pages){const i=e.acquireUint32Array(t);if(null!=i)return i}const e=this._addPage().acquireUint32Array(t);return(0,r.Lw)(e,"Expected to allocate page"),e}releaseUint32Array(t){this._bytesAllocated-=t.byteLength,o&&console.log(`Freeing ${t.byteLength}, (${this._bytesAllocated} / ${this._bytesTotal})`);const e=this._pagesByBuffer.get(t.buffer);e&&e.releaseUint32Array(t)}_addPage(){const t=new l;return this._pages.push(t),this._pagesByBuffer.set(t.buffer,t),t}}},58975:function(t,e,i){i.d(e,{U:function(){return l}});var n=i(42827),r=i(48996),s=i(58941),o=i(58250);const a=(0,s.A)("esri-2d-profiler");class l{constructor(t,e){if(this._events=new r.A,this._entries=new Map,this._timings=new n.A(10),this._currentContainer=null,this._currentPass=null,this._currentBrush=null,this._currentSummary=null,!a)return;this._ext=(0,o._R)(t.gl,{}),this._debugOutput=e;const i=t.gl;if(!this.enableCommandLogging)return;let s;for(s in i)if("function"==typeof i[s]){const t=i[s],e=s.includes("draw");i[s]=(...n)=>(this._events.emit("command",{container:this._currentContainer,pass:this._currentPass,brush:this._currentBrush,method:s,args:n,isDrawCommand:e}),this._currentSummary&&(this._currentSummary.commands++,e&&this._currentSummary.drawCommands++),t.apply(i,n))}}get enableCommandLogging(){return!("object"==typeof a&&a.disableCommands)}recordContainerStart(t){a&&(this._currentContainer=t)}recordContainerEnd(){a&&(this._currentContainer=null)}recordPassStart(t){a&&(this._currentPass=t,this._initSummary())}recordPassEnd(){a&&(this._currentPass=null,this._emitSummary())}recordBrushStart(t){a&&(this._currentBrush=t)}recordBrushEnd(){a&&(this._currentBrush=null)}recordStart(t){if(a&&null!=this._ext){if(this._entries.has(t)){const e=this._entries.get(t),i=this._ext.resultAvailable(e.query),n=this._ext.disjoint();if(i&&!n){const i=this._ext.getResult(e.query)/1e6;let n=0;if(null!=this._timings.enqueue(i)){const t=this._timings.entries,e=t.length;let i=0;for(const e of t)i+=e;n=i/e}const r=i.toFixed(2),s=n?n.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed(`Frame report for ${t}, ${r} ms (${s} last 10 avg)\n${e.commandsLen} Commands (${e.drawCommands} draw)`),console.log("RenderPass breakdown: "),console.table(e.summaries),console.log("Commands: ",e.commands),console.groupEnd()):console.log(`Frame report for ${t}, ${r} ms (${s} last 10 avg)`),this._debugOutput.innerHTML=`${r} (${s})`}for(const t of e.handles)t.remove();this._ext.deleteQuery(e.query),this._entries.delete(t)}const e={name:t,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(e.handles.push(this._events.on("command",(t=>{e.commandsLen++,e.commands.push(t),t.isDrawCommand&&e.drawCommands++}))),e.handles.push(this._events.on("summary",(t=>{e.summaries.push(t)})))),this._ext.beginTimeElapsed(e.query),this._entries.set(t,e)}}recordEnd(t){a&&null!=this._ext&&this._entries.has(t)&&this._ext.endTimeElapsed()}_initSummary(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})}_emitSummary(){this.enableCommandLogging&&this._currentSummary&&this._events.emit("summary",this._currentSummary)}}},54904:function(t,e,i){i.d(e,{A:function(){return n}});class n{constructor(t=0,e=0,i=0,n=0){this.x=t,this.y=e,this.width=i,this.height=n}get isEmpty(){return this.width<=0||this.height<=0}union(t){this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.width=Math.max(this.width,t.width),this.height=Math.max(this.height,t.height)}}},82087:function(t,e,i){i.d(e,{A:function(){return c}});var n=i(58941),r=i(28230),s=i(57672),o=i(829),a=i(55382);const l=(t,e)=>t.key.level-e.key.level!=0?t.key.level-e.key.level:t.key.row-e.key.row!=0?t.key.row-e.key.row:t.key.col-e.key.col;class c extends s.A{constructor(t){super(),this._tileInfoView=t}renderChildren(t){this.sortChildren(l),this.setStencilReference(t),super.renderChildren(t)}createRenderParams(t){const{state:e}=t,i=super.createRenderParams(t);return i.requiredLevel=this._tileInfoView.getClosestInfoForScale(e.scale).level,i.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(e.scale),i}prepareRenderPasses(t){const e=super.prepareRenderPasses(t);return e.push(t.registerRenderPass({name:"stencil",brushes:[o.A],drawPhase:r.S5.DEBUG|r.S5.MAP|r.S5.HIGHLIGHT|r.S5.LABEL,target:()=>this.getStencilTarget()})),(0,n.A)("esri-tiles-debug")&&e.push(t.registerRenderPass({name:"tileInfo",brushes:[a.A],drawPhase:r.S5.DEBUG,target:()=>this.children})),e}getStencilTarget(){return this.children}setStencilReference(t){let e=1;for(const t of this.children)t.stencilRef=e++}}},54631:function(t,e,i){i.d(e,{Y:function(){return o}});var n=i(44705),r=i(77515),s=i(36008);class o extends r.q{constructor(t,e,i,n,r,o,a=r,l=o){super(),this.tileDebugInfoTexture=null,this.debugInfo={display:{length:0,minOrderedLength:0,minUnorderedLength:0,triangleCount:0},memory:{bytesUsed:0,bytesReserved:0}},this._destroyed=!1,this.key=new s.A(t),this.resolution=e,this.x=i,this.y=n,this.width=r,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.tileDebugInfoTexture&&(this.tileDebugInfoTexture.dispose(),this.tileDebugInfoTexture=null),this._destroyed=!0}get debugSlot(){let t=this;for(;t.parent!==this._stage;){if(!t.parent)return 0;t=t.parent}return this._stage.children.indexOf(t)}setTransform(t){const e=this.resolution/(t.resolution*t.pixelRatio),i=this.transforms.tileMat3,[r,s]=t.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*e,a=this.height/this.rangeY*e;(0,n.hZ)(i,o,0,0,0,a,0,r,s,1),(0,n.lw)(this.transforms.displayViewScreenMat3,t.displayViewMat3,i)}get destroyed(){return this._destroyed}}},42542:function(t,e,i){i.d(e,{i:function(){return _}});var n=i(33389),r=i(39686);function s(t,e){return t.x===e.x&&t.y===e.y}function o(t){if(!t)return;const e=t.length;if(e<=1)return;let i=0;for(let n=1;n<e;n++)s(t[n],t[i])||++i===n||(t[i]=t[n]);t.length=i+1}function a(t,e){return t.x=e.y,t.y=-e.x,t}function l(t,e){return t.x=-e.y,t.y=e.x,t}function c(t,e){return t.x=e.x,t.y=e.y,t}function u(t,e){return t.x=-e.x,t.y=-e.y,t}function h(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function d(t,e){return t.x*e.x+t.y*e.y}function f(t,e,i,n){return t.x=e.x*i+e.y*n,t.y=e.x*n-e.y*i,t}class _{constructor(t,e,i){this._writeVertex=t,this._writeTriangle=e,this._canUseThinTessellation=i,this._prevNormal={x:void 0,y:void 0},this._nextNormal={x:void 0,y:void 0},this._textureNormalLeft={x:0,y:1},this._textureNormalRight={x:0,y:-1},this._textureNormal={x:void 0,y:void 0},this._joinNormal={x:void 0,y:void 0},this._inner={x:void 0,y:void 0},this._outer={x:void 0,y:void 0},this._roundStart={x:void 0,y:void 0},this._roundEnd={x:void 0,y:void 0},this._startBreak={x:void 0,y:void 0},this._endBreak={x:void 0,y:void 0},this._innerPrev={x:void 0,y:void 0},this._innerNext={x:void 0,y:void 0},this._bevelStart={x:void 0,y:void 0},this._bevelEnd={x:void 0,y:void 0},this._bevelMiddle={x:void 0,y:void 0}}tessellate(t,e,i=this._canUseThinTessellation){o(t),i&&e.halfWidth<r.Gh&&!e.offset?this._tessellateThin(t,e):this._tessellate(t,e)}_tessellateThin(t,e){if(t.length<2)return;const i=e.wrapDistance||65535;let n=e.initialDistance||0,r=!1,s=t[0].x,o=t[0].y;const a=t.length;for(let e=1;e<a;++e){r&&(r=!1,n=0);let a=t[e].x,l=t[e].y,c=a-s,u=l-o,h=Math.sqrt(c*c+u*u);if(c/=h,u/=h,n+h>i){r=!0;const t=(i-n)/h;h=i-n,a=(1-t)*s+t*a,l=(1-t)*o+t*l,--e}const d=this._writeVertex(s,o,0,0,c,u,u,-c,0,-1,n),f=this._writeVertex(s,o,0,0,c,u,-u,c,0,1,n);n+=h;const _=this._writeVertex(a,l,0,0,c,u,u,-c,0,-1,n),p=this._writeVertex(a,l,0,0,c,u,-u,c,0,1,n);this._writeTriangle(d,f,_),this._writeTriangle(f,_,p),s=a,o=l}}_tessellate(t,e){const i=t[0],r=t[t.length-1],o=s(i,r),_=o?3:2;if(t.length<_)return;const p=e.pixelCoordRatio,m=null!=e.capType?e.capType:n.xR.BUTT,g=null!=e.joinType?e.joinType:n.JO.MITER,y=null!=e.miterLimit?Math.min(e.miterLimit,4):2,v=null!=e.roundLimit?Math.min(e.roundLimit,1.05):1.05,x=null!=e.halfWidth?e.halfWidth:2,b=!!e.textured;let S,w,T,M=null;const P=this._prevNormal,E=this._nextNormal;let A=-1,C=-1;const I=this._joinNormal;let R,O;const F=this._textureNormalLeft,z=this._textureNormalRight,D=this._textureNormal;let L=-1,N=-1;const B=e.wrapDistance||65535;let k=e.initialDistance||0;const V=this._writeVertex,U=this._writeTriangle,G=(t,e,i,n,r,s)=>{const o=V(w,T,R,O,i,n,t,e,r,s,k);return L>=0&&N>=0&&o>=0&&U(L,N,o),L=N,N=o,o};o&&(S=t[t.length-2],E.x=r.x-S.x,E.y=r.y-S.y,C=h(E),E.x/=C,E.y/=C);let H=!1;for(let e=0;e<t.length;++e){if(H&&(H=!1,k=0),S&&(P.x=-E.x,P.y=-E.y,A=C,k+A>B&&(H=!0)),H){const i=(B-k)/A;A=B-k,S={x:(1-i)*S.x+i*t[e].x,y:(1-i)*S.y+i*t[e].y},--e}else S=t[e];w=S.x,T=S.y;const i=e<=0&&!H,r=e===t.length-1;if(i||(k+=A),M=r?o?t[1]:null:t[e+1],M?(E.x=M.x-w,E.y=M.y-T,C=h(E),E.x/=C,E.y/=C):(E.x=void 0,E.y=void 0),!o){if(i){l(I,E),R=I.x,O=I.y,m===n.xR.SQUARE&&(G(-E.y-E.x,E.x-E.y,E.x,E.y,0,-1),G(E.y-E.x,-E.x-E.y,E.x,E.y,0,1)),m===n.xR.ROUND&&(G(-E.y-E.x,E.x-E.y,E.x,E.y,-1,-1),G(E.y-E.x,-E.x-E.y,E.x,E.y,-1,1)),m!==n.xR.ROUND&&m!==n.xR.BUTT||(G(-E.y,E.x,E.x,E.y,0,-1),G(E.y,-E.x,E.x,E.y,0,1));continue}if(r){a(I,P),R=I.x,O=I.y,m!==n.xR.ROUND&&m!==n.xR.BUTT||(G(P.y,-P.x,-P.x,-P.y,0,-1),G(-P.y,P.x,-P.x,-P.y,0,1)),m===n.xR.SQUARE&&(G(P.y-P.x,-P.x-P.y,-P.x,-P.y,0,-1),G(-P.y-P.x,P.x-P.y,-P.x,-P.y,0,1)),m===n.xR.ROUND&&(G(P.y-P.x,-P.x-P.y,-P.x,-P.y,1,-1),G(-P.y-P.x,P.x-P.y,-P.x,-P.y,1,1));continue}}let s,_,V=(W=E,-((Y=P).x*W.y-Y.y*W.x));if(Math.abs(V)<.01)d(P,E)>0?(I.x=P.x,I.y=P.y,V=1,s=Number.MAX_VALUE,_=!0):(l(I,E),V=1,s=1,_=!1);else{I.x=(P.x+E.x)/V,I.y=(P.y+E.y)/V,s=h(I);const t=(s-1)*x*p;_=s>4||t>A&&t>C}R=I.x,O=I.y;let U=g;switch(g){case n.JO.BEVEL:s<1.05&&(U=n.JO.MITER);break;case n.JO.ROUND:s<v&&(U=n.JO.MITER);break;case n.JO.MITER:s>y&&(U=n.JO.BEVEL)}switch(U){case n.JO.MITER:if(G(I.x,I.y,-P.x,-P.y,0,-1),G(-I.x,-I.y,-P.x,-P.y,0,1),r)break;if(b){const t=H?0:k;L=this._writeVertex(w,T,R,O,E.x,E.y,I.x,I.y,0,-1,t),N=this._writeVertex(w,T,R,O,E.x,E.y,-I.x,-I.y,0,1,t)}break;case n.JO.BEVEL:{const t=V<0;let e,i,n,s;if(t){const t=L;L=N,N=t,e=F,i=z}else e=z,i=F;if(_)n=t?l(this._innerPrev,P):a(this._innerPrev,P),s=t?a(this._innerNext,E):l(this._innerNext,E);else{const e=t?u(this._inner,I):c(this._inner,I);n=e,s=e}const o=t?a(this._bevelStart,P):l(this._bevelStart,P);G(n.x,n.y,-P.x,-P.y,e.x,e.y);const h=G(o.x,o.y,-P.x,-P.y,i.x,i.y);if(r)break;const d=t?l(this._bevelEnd,E):a(this._bevelEnd,E);if(_){const t=this._writeVertex(w,T,R,O,-P.x,-P.y,0,0,0,0,k);L=this._writeVertex(w,T,R,O,E.x,E.y,s.x,s.y,e.x,e.y,k),N=this._writeVertex(w,T,R,O,E.x,E.y,d.x,d.y,i.x,i.y,k),this._writeTriangle(h,t,N)}else{if(b){const t=this._bevelMiddle;t.x=(o.x+d.x)/2,t.y=(o.y+d.y)/2,f(D,t,-P.x,-P.y),G(t.x,t.y,-P.x,-P.y,D.x,D.y),f(D,t,E.x,E.y),L=this._writeVertex(w,T,R,O,E.x,E.y,t.x,t.y,D.x,D.y,k),N=this._writeVertex(w,T,R,O,E.x,E.y,s.x,s.y,e.x,e.y,k)}else{const t=L;L=N,N=t}G(d.x,d.y,E.x,E.y,i.x,i.y)}if(t){const t=L;L=N,N=t}break}case n.JO.ROUND:{const t=V<0;let e,i;if(t){const t=L;L=N,N=t,e=F,i=z}else e=z,i=F;const n=t?u(this._inner,I):c(this._inner,I);let o,h;_?(o=t?l(this._innerPrev,P):a(this._innerPrev,P),h=t?a(this._innerNext,E):l(this._innerNext,E)):(o=n,h=n);const p=t?a(this._roundStart,P):l(this._roundStart,P),m=t?l(this._roundEnd,E):a(this._roundEnd,E),g=G(o.x,o.y,-P.x,-P.y,e.x,e.y),y=G(p.x,p.y,-P.x,-P.y,i.x,i.y);if(r)break;const v=this._writeVertex(w,T,R,O,-P.x,-P.y,0,0,0,0,k);_||this._writeTriangle(L,N,v);const x=u(this._outer,n),S=this._writeVertex(w,T,R,O,E.x,E.y,m.x,m.y,i.x,i.y,k);let M,A;const C=s>2;if(C){let e;s!==Number.MAX_VALUE?(x.x/=s,x.y/=s,e=d(P,x),e=(s*(e*e-1)+1)/e):e=-1,M=t?a(this._startBreak,P):l(this._startBreak,P),M.x+=P.x*e,M.y+=P.y*e,A=t?l(this._endBreak,E):a(this._endBreak,E),A.x+=E.x*e,A.y+=E.y*e}f(D,x,-P.x,-P.y);const B=this._writeVertex(w,T,R,O,-P.x,-P.y,x.x,x.y,D.x,D.y,k);f(D,x,E.x,E.y);const U=b?this._writeVertex(w,T,R,O,E.x,E.y,x.x,x.y,D.x,D.y,k):B,H=v,Y=b?this._writeVertex(w,T,R,O,E.x,E.y,0,0,0,0,k):v;let W=-1,Z=-1;if(C&&(f(D,M,-P.x,-P.y),W=this._writeVertex(w,T,R,O,-P.x,-P.y,M.x,M.y,D.x,D.y,k),f(D,A,E.x,E.y),Z=this._writeVertex(w,T,R,O,E.x,E.y,A.x,A.y,D.x,D.y,k)),b?C?(this._writeTriangle(H,y,W),this._writeTriangle(H,W,B),this._writeTriangle(Y,U,Z),this._writeTriangle(Y,Z,S)):(this._writeTriangle(H,y,B),this._writeTriangle(Y,U,S)):C?(this._writeTriangle(v,y,W),this._writeTriangle(v,W,Z),this._writeTriangle(v,Z,S)):(this._writeTriangle(v,y,B),this._writeTriangle(v,U,S)),_?(L=this._writeVertex(w,T,R,O,E.x,E.y,h.x,h.y,e.x,e.y,k),N=S):(L=b?this._writeVertex(w,T,R,O,E.x,E.y,h.x,h.y,e.x,e.y,k):g,this._writeTriangle(L,Y,S),N=S),t){const t=L;L=N,N=t}break}}}var Y,W}}},88413:function(t,e,i){i.d(e,{AV:function(){return h},ES:function(){return m},IF:function(){return x},Qz:function(){return d},UE:function(){return g},bX:function(){return y},sZ:function(){return v}});var n=i(39819),r=i(40633),s=(i(33389),i(13798),i(58941),i(41835),i(85456)),o=(i(96402),i(80562),i(69452),i(48347)),a=i(78541),l=i(10956),c=i(3817);const u=()=>r.A.getLogger("esri.views.2d.engine.webgl.Utils");function h(t){switch(t){case s.ld.UNSIGNED_BYTE:return 1;case s.ld.UNSIGNED_SHORT_4_4_4_4:return 2;case s.ld.FLOAT:return 4;default:return void u().error(new n.A("webgl-utils",`Unable to handle type ${t}`))}}function d(t){switch(t){case s.ld.UNSIGNED_BYTE:return Uint8Array;case s.ld.UNSIGNED_SHORT_4_4_4_4:return Uint16Array;case s.ld.FLOAT:return Float32Array;default:return void u().error(new n.A("webgl-utils",`Unable to handle type ${t}`))}}const f=t=>{const e=new Map;for(const i in t)for(const n of t[i])e.set(n.name,n.location);return e},_=t=>{const e={};for(const i in t){const n=t[i];e[i]=n?.length?n[0].stride:0}return e},p=new Map,m=(t,e)=>{if(!p.has(t)){const i=function(t){const e={};for(const i in t){const n=t[i];let r=0;e[i]=n.map((t=>{const e=new c._(t.name,t.count,t.type,r,0,t.normalized||!1);return r+=t.count*(0,o._)(t.type),e})),e[i]?.forEach((t=>t.stride=r))}return e}(e),n={strides:_(i),bufferLayouts:i,attributes:f(e)};p.set(t,n)}return p.get(t)},g=t=>t.includes("data:image/svg+xml");function y(t){const e=[];for(let i=0;i<t.length;i++)e.push(t.charCodeAt(i));return e}function v(t,e,i){const n=new l.R(e.width,e.height);return n.dataType=e.dataType,e.depth&&(n.depth=e.depth),e.flipped&&(n.flipped=e.flipped),e.hasMipmap&&(n.hasMipmap=e.hasMipmap),n.internalFormat=e.internalFormat,e.isImmutable&&(n.isImmutable=e.isImmutable),e.isOpaque&&(n.isOpaque=e.isOpaque),e.maxAnisotropy&&(n.maxAnisotropy=e.maxAnisotropy),n.pixelFormat=e.pixelFormat,e.preMultiplyAlpha&&(n.preMultiplyAlpha=e.preMultiplyAlpha),e.samplingMode&&(n.samplingMode=e.samplingMode),e.target&&(n.target=e.target),n.uniform=e.uniform,e.unpackAlignment&&(n.unpackAlignment=e.unpackAlignment),e.wrapMode&&(n.wrapMode=e.wrapMode),new a.g(t,n,i)}function x(t){return"url"in t&&"urlHash"in t?{...t,url:""}:t}},77416:function(t,e,i){i.d(e,{A:function(){return l}});var n=i(25731),r=i(86305),s=i(85456),o=i(81438),a=i(3817);class l{constructor(t,e){this._rctx=t,this._attributes=[{name:"position",offset:0,type:s.pe.SHORT,count:2}],this.layout={hash:(0,n.hU)(this._attributes),attributes:this._attributes,stride:4},this._vertexBuffer=r.g.createVertex(t,s._U.STATIC_DRAW,new Uint16Array(e)),this._vao=new o.Z(t,new Map([["a_position",0]]),{geometry:[new a._("a_position",2,s.pe.SHORT,0,4)]},{geometry:this._vertexBuffer}),this._count=e.length/2}bind(){this._rctx.bindVAO(this._vao)}unbind(){this._rctx.bindVAO(null)}dispose(){this._vao.dispose()}draw(){this._rctx.bindVAO(this._vao),this._rctx.drawArrays(s.WR.TRIANGLE_STRIP,0,this._count)}}},57672:function(t,e,i){i.d(e,{A:function(){return M}}),i(58941);var n=i(20152),r=i(7965),s=i(39819),o=i(40633),a=i(28181),l=i(25090),c=i(77515),u=i(59122),h=i(13786),d=i(1932),f=i(58081),_=i(76613),p=i(85475),m=i(86305),g=i(85456);const y=(t,e,i,n)=>{let r=0;for(let n=1;n<i;n++){const i=t[2*(e+n-1)],s=t[2*(e+n-1)+1];r+=(t[2*(e+n)]-i)*(t[2*(e+n)+1]+s)}return n?r>0:r<0},v=({coords:t,lengths:e},i)=>{const n=[];for(let r=0,s=0;r<e.length;s+=e[r],r+=1){const o=s,a=[];for(;r<e.length-1&&y(t,s+e[r],e[r+1],i);r+=1,s+=e[r])a.push(s+e[r]-o);const l=t.slice(2*o,2*(s+e[r])),c=(0,u.e)(l,a,2);for(const t of c)n.push(t+o)}return n};class x{constructor(t,e,i,n=!1){this._cache={},this.vertices=t,this.indices=e,this.primitiveType=i,this.isMapSpace=n}static fromPath(t){const e=(0,f.eU)(new _.A,t.path,!1,!1),i=e.coords,n=new Uint32Array(v(e,!0)),r=new Uint32Array(i.length/2);for(let t=0;t<r.length;t++)r[t]=(0,p.M9)(Math.floor(i[2*t]),Math.floor(i[2*t+1]));return new x({geometry:r},n,g.WR.TRIANGLES)}static fromGeometry(t,e){const i=e.geometry?.type;switch(i){case"polygon":return x.fromPolygon(t,e.geometry);case"extent":return x.fromMapExtent(t,e.geometry);default:return o.A.getLogger("esri.views.2d.engine.webgl.Mesh2D").error(new s.A("mapview-bad-type",`Unable to create a mesh from type ${i}`,e)),x.fromScreenExtent({xmin:0,ymin:0,xmax:1,ymax:1})}}static fromPolygon(t,e){const i=(0,f.Ye)(new _.A,e,!1,!1),n=i.coords,r=new Uint32Array(v(i,!1)),s=new Uint32Array(n.length/2),o=(0,d.vt)(),a=(0,d.vt)();for(let e=0;e<s.length;e++)(0,h.hZ)(o,n[2*e],n[2*e+1]),t.toScreen(a,o),s[e]=(0,p.M9)(Math.floor(a[0]),Math.floor(a[1]));return new x({geometry:s},r,g.WR.TRIANGLES,!0)}static fromScreenExtent({xmin:t,xmax:e,ymin:i,ymax:n}){const r={geometry:new Uint32Array([(0,p.M9)(t,i),(0,p.M9)(e,i),(0,p.M9)(t,n),(0,p.M9)(t,n),(0,p.M9)(e,i),(0,p.M9)(e,n)])},s=new Uint32Array([0,1,2,3,4,5]);return new x(r,s,g.WR.TRIANGLES)}static fromMapExtent(t,e){const[i,n]=t.toScreen([0,0],[e.xmin,e.ymin]),[r,s]=t.toScreen([0,0],[e.xmax,e.ymax]),o={geometry:new Uint32Array([(0,p.M9)(i,n),(0,p.M9)(r,n),(0,p.M9)(i,s),(0,p.M9)(i,s),(0,p.M9)(r,n),(0,p.M9)(r,s)])},a=new Uint32Array([0,1,2,3,4,5]);return new x(o,a,g.WR.TRIANGLES)}destroy(){null!=this._cache.indexBuffer&&this._cache.indexBuffer.dispose();for(const t in this._cache.vertexBuffers)null!=this._cache.vertexBuffers[t]&&this._cache.vertexBuffers[t].dispose()}get elementType(){return(t=>{switch(this.indices.BYTES_PER_ELEMENT){case 1:return g.pe.UNSIGNED_BYTE;case 2:return g.pe.UNSIGNED_SHORT;case 4:return g.pe.UNSIGNED_INT;default:throw new s.A("Cannot get DataType of array")}})()}getIndexBuffer(t,e=g._U.STATIC_DRAW){return this._cache.indexBuffer||(this._cache.indexBuffer=m.g.createIndex(t,e,this.indices)),this._cache.indexBuffer}getVertexBuffers(t,e=g._U.STATIC_DRAW){return this._cache.vertexBuffers||(this._cache.vertexBuffers=Object.keys(this.vertices).reduce(((i,n)=>({...i,[n]:m.g.createVertex(t,e,this.vertices[n])})),{})),this._cache.vertexBuffers}}var b=i(57008),S=i(81438);class w extends c.q{constructor(t,e){super(),this._clip=e,this._cache={},this.stage=t,this._handle=(0,a.watch)((()=>e.version),(()=>this._invalidate())),this.ready()}static fromClipArea(t,e){return new w(t,e)}_destroyGL(){null!=this._cache.mesh&&(this._cache.mesh.destroy(),this._cache.mesh=null),null!=this._cache.vao&&(this._cache.vao.dispose(),this._cache.vao=null)}destroy(){this._destroyGL(),this._handle.remove()}getVAO(t,e,i,n){const[r,s]=e.size;if("geometry"!==this._clip.type&&this._lastWidth===r&&this._lastHeight===s||(this._lastWidth=r,this._lastHeight=s,this._destroyGL()),null==this._cache.vao){const r=this._createMesh(e,this._clip),s=r.getIndexBuffer(t),o=r.getVertexBuffers(t);this._cache.mesh=r,this._cache.vao=new S.Z(t,i,n,o,s)}return this._cache.vao}_createTransforms(){return{displayViewScreenMat3:(0,l.vt)()}}_invalidate(){this._destroyGL(),this.requestRender()}_createMesh(t,e){switch(e.type){case"rect":return x.fromScreenExtent((0,b.p)(e,t.size[0],t.size[1]));case"path":return x.fromPath(e);case"geometry":return x.fromGeometry(t,e);default:return o.A.getLogger("esri.views.2d.engine.webgl.ClippingInfo").error(new s.A("mapview-bad-type","Unable to create ClippingInfo mesh from clip of type: ${clip.type}")),x.fromScreenExtent({xmin:0,ymin:0,xmax:1,ymax:1})}}}var T=i(28230);class M extends r.m{set clips(t){super.clips=t,this._updateClippingInfo(t)}renderChildren(t){t.painter.setPipelineState(null),null==this._renderPasses&&(this._renderPasses=this.prepareRenderPasses(t.painter));for(const e of this._renderPasses)try{e.render(t)}catch(t){}}prepareRenderPasses(t){return[t.registerRenderPass({name:"clip",brushes:[n.d.clip],target:()=>this._clippingInfos,drawPhase:T.S5.MAP|T.S5.LABEL|T.S5.LABEL_ALPHA|T.S5.DEBUG|T.S5.HIGHLIGHT})]}_updateClippingInfo(t){null!=this._clippingInfos&&(this._clippingInfos.forEach((t=>t.destroy())),this._clippingInfos=null),null!=t&&t.length&&(this._clippingInfos=t.items.map((t=>w.fromClipArea(this.stage,t)))),this.requestRender()}}},96564:function(t,e,i){i.d(e,{Dy:function(){return d},UD:function(){return c},fO:function(){return u},gy:function(){return o},iT:function(){return h},xy:function(){return l}});var n=i(40633);const r=()=>n.A.getLogger("esri.views.2d.engine.webgl.alignmentUtils");var s,o,a;function l(t){if(!t)return s.Center;switch(t){case"Left":case"left":return s.Left;case"Right":case"right":return s.Right;case"Justify":return r().warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),s.Center;case"Center":case"center":return s.Center}}function c(t){if(!t)return o.Center;switch(t){case"Top":case"top":return o.Top;case"Center":case"middle":return o.Center;case"Baseline":case"baseline":return o.Baseline;case"Bottom":case"bottom":return o.Bottom}}function u(t){switch(t){case"above-left":case"esriServerPointLabelPlacementAboveLeft":return["right","bottom"];case"above-center":case"above-along":case"esriServerPointLabelPlacementAboveCenter":case"esriServerLinePlacementAboveAlong":return["center","bottom"];case"above-right":case"esriServerPointLabelPlacementAboveRight":return["left","bottom"];case"center-left":case"esriServerPointLabelPlacementCenterLeft":return["right","middle"];case"center-center":case"center-along":case"esriServerPointLabelPlacementCenterCenter":case"esriServerLinePlacementCenterAlong":case"always-horizontal":case"esriServerPolygonPlacementAlwaysHorizontal":return["center","middle"];case"center-right":case"esriServerPointLabelPlacementCenterRight":return["left","middle"];case"below-left":case"esriServerPointLabelPlacementBelowLeft":return["right","top"];case"below-center":case"below-along":case"esriServerPointLabelPlacementBelowCenter":case"esriServerLinePlacementBelowAlong":return["center","top"];case"below-right":case"esriServerPointLabelPlacementBelowRight":return["left","top"];default:return console.debug(`Found invalid placement type ${t}`),["center","middle"]}}function h(t){switch(t){case s.Right:case"right":return-1;case s.Center:case"center":return 0;case s.Left:case"left":return 1;default:return console.debug(`Found invalid horizontal alignment ${t}`),0}}function d(t){switch(t){case o.Top:case"top":return 1;case o.Center:case"middle":return 0;case o.Bottom:case o.Baseline:case"baseline":case"bottom":return-1;default:return console.debug(`Found invalid vertical alignment ${t}`),0}}(a=s||(s={}))[a.Left=-1]="Left",a[a.Center=0]="Center",a[a.Right=1]="Right",function(t){t[t.Top=1]="Top",t[t.Center=0]="Center",t[t.Bottom=-1]="Bottom",t[t.Baseline=2]="Baseline"}(o||(o={}))},93937:function(t,e,i){i.d(e,{ZH:function(){return c}});var n=i(61226),r=i(38504),s=(i(25150),i(33389)),o=i(95415);function a(t,e){const{width:i,height:n,getFrame:s}=t,o=t.frameDurations.slice(),a=o.pop();return o.push((0,r.l5)(a+e)),{frameCount:t.frameCount,duration:t.duration+e,frameDurations:o,getFrame:s,width:i,height:n}}class l{constructor(t,e,i,n){this._animation=t,this._repeatType=i,this._onFrameData=n,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];let r=0;for(;e>r;)r+=this.timeToFrame,this.nextFrame();const s=this._animation.getFrame(this._currentFrame);this._onFrameData(s)}nextFrame(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case s.fu.None:this._currentFrame-=this._direction;break;case s.fu.Loop:this._currentFrame=0;break;case s.fu.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case s.fu.None:this._currentFrame-=this._direction;break;case s.fu.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case s.fu.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];const t=this._animation.getFrame(this._currentFrame);this._onFrameData(t)}}function c(t,e,i,c){const u=null==e.playAnimation||e.playAnimation,h=function(t,e,i,n){let c,{repeatType:u}=e;if(null==u&&(u=s.fu.Loop),!0===e.reverseAnimation&&(t=function(t){const{width:e,height:i}=t,n=t.frameDurations.reverse();return{frameCount:t.frameCount,duration:t.duration,frameDurations:n,getFrame:e=>{const i=t.frameDurations.length-1-e;return t.getFrame(i)},width:e,height:i}}(t)),null!=e.duration&&(t=function(t,e){const{width:i,height:n,getFrame:s}=t,o=e/t.duration,a=t.frameDurations.map((t=>(0,r.l5)(t*o)));return{frameCount:t.frameCount,duration:t.duration,frameDurations:a,getFrame:s,width:i,height:n}}(t,(0,r.l5)(1e3*e.duration))),null!=e.repeatDelay){const i=1e3*e.repeatDelay;u===s.fu.Loop?t=a(t,(0,r.l5)(i)):u===s.fu.Oscillate&&(t=function(t,e){const{width:i,height:n,getFrame:s}=t,o=t.frameDurations.slice(),a=o.shift();return o.unshift((0,r.l5)(a+e)),{frameCount:t.frameCount,duration:t.duration+e,frameDurations:o,getFrame:s,width:i,height:n}}(a(t,(0,r.l5)(i/2)),(0,r.l5)(i/2)))}if(null!=e.startTimeOffset)c=(0,r.l5)(1e3*e.startTimeOffset);else if(null!=e.randomizeStartTime){const n=82749913,s=null!=e.randomizeStartSeed?e.randomizeStartSeed:n,a=(0,o.J)(i,s);c=(0,r.l5)(a*function(t){return(0,r.l5)(t.frameDurations.reduce(((t,e)=>t+e),0))}(t))}else c=(0,r.l5)(0);return new l(t,c,u,n)}(t,e,i,c);let d,f=h.timeToFrame;return function t(){d=u?setTimeout((()=>{h.nextFrame(),f=h.timeToFrame,t()}),f):void 0}(),(0,n.hA)((()=>u&&clearTimeout(d)))}},73936:function(t,e,i){i.d(e,{A:function(){return c}});var n=i(39686),r=i(77416),s=i(52937),o=i(85456);const a={nearest:{defines:[],samplingMode:o.Cj.NEAREST,mips:!1},bilinear:{defines:[],samplingMode:o.Cj.LINEAR,mips:!1},bicubic:{defines:["bicubic"],samplingMode:o.Cj.LINEAR,mips:!1},trilinear:{defines:[],samplingMode:o.Cj.LINEAR_MIPMAP_LINEAR,mips:!0}},l=(t,e,i)=>{if("dynamic"===i.samplingMode){const{state:i}=t,n=e.resolution/e.pixelRatio/i.resolution,r=Math.round(t.pixelRatio)!==t.pixelRatio,s=n>1.05||n<.95;return i.rotation||s||r||e.isSourceScaled||e.rotation?a.bilinear:a.nearest}return a[i.samplingMode]};class c extends s.A{constructor(){super(...arguments),this._desc={vsPath:"raster/bitmap",fsPath:"raster/bitmap",attributes:new Map([["a_pos",0]])}}dispose(){this._quad&&this._quad.dispose()}prepareState({context:t}){t.setBlendingEnabled(!0),t.setColorMask(!0,!0,!0,!0),t.setStencilWriteMask(0),t.setStencilTestEnabled(!0)}draw(t,e){const{context:i,renderingOptions:s,painter:a,requestRender:c,allowDelayedRender:u}=t;if(!e.source||!e.isReady)return;const h=l(t,e,s),d=a.materialManager.getProgram(this._desc,h.defines);if(u&&null!=c&&!d.compiled)return void c();t.timeline.begin(this.name),"additive"===e.blendFunction?i.setBlendFunctionSeparate(o.dn.ONE,o.dn.ONE,o.dn.ONE,o.dn.ONE):i.setBlendFunctionSeparate(o.dn.ONE,o.dn.ONE_MINUS_SRC_ALPHA,o.dn.ONE,o.dn.ONE_MINUS_SRC_ALPHA),i.setStencilFunction(o.MT.EQUAL,e.stencilRef,255),this._quad||(this._quad=new r.A(i,[0,0,1,0,0,1,1,1]));const{coordScale:f,computedOpacity:_,transforms:p}=e;e.setSamplingProfile(h),e.bind(t.context,n.YS),i.useProgram(d),d.setUniformMatrix3fv("u_dvsMat3",p.displayViewScreenMat3),d.setUniform1i("u_texture",n.YS),d.setUniform2fv("u_coordScale",f),d.setUniform1f("u_opacity",_),this._quad.draw(),t.timeline.end(this.name)}}},52937:function(t,e,i){i.d(e,{A:function(){return n}});class n{constructor(){this.name=this.constructor.name||"UnnamedBrush",this.brushEffect=null}prepareState(t,e){}draw(t,e,i){}drawMany(t,e,i){for(const n of e)n.visible&&this.draw(t,n,i)}}},829:function(t,e,i){i.d(e,{A:function(){return h}});var n=i(43745),r=i(94860),s=i(52937),o=i(94020),a=i(86305),l=i(85456),c=i(10904),u=i(81438);class h extends s.A{constructor(){super(...arguments),this._color=(0,n.fA)(1,0,0,1),this._initialized=!1}dispose(){this._solidProgram&&(this._solidProgram.dispose(),this._solidProgram=null),this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null)}prepareState({context:t}){t.setDepthWriteEnabled(!1),t.setDepthTestEnabled(!1),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!1),t.setColorMask(!1,!1,!1,!1),t.setStencilOp(l.eA.KEEP,l.eA.KEEP,l.eA.REPLACE),t.setStencilWriteMask(255)}draw(t,e){const{context:i,requestRender:n,allowDelayedRender:r}=t;this._initialized||this._initialize(i),!r||null==n||this._solidProgram.compiled?(i.setStencilFunctionSeparate(l.Y7.FRONT_AND_BACK,l.MT.GREATER,e.stencilRef,255),i.bindVAO(this._solidVertexArrayObject),i.useProgram(this._solidProgram),this._solidProgram.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),this._solidProgram.setUniform2fv("u_coord_range",[e.rangeX,e.rangeY]),this._solidProgram.setUniform1f("u_depth",0),this._solidProgram.setUniform4fv("u_color",this._color),i.drawArrays(l.WR.TRIANGLE_STRIP,0,4),i.bindVAO()):n()}_initialize(t){if(this._initialized)return!0;const e=(0,c.r)(t,o.T);if(!e)return!1;const i=new Int8Array([0,0,1,0,0,1,1,1]),n=a.g.createVertex(t,l._U.STATIC_DRAW,i),s=new u.Z(t,o.T.attributes,r.Pd,{geometry:n});return this._solidProgram=e,this._solidVertexArrayObject=s,this._initialized=!0,!0}}},55382:function(t,e,i){i.d(e,{A:function(){return m}});var n=i(43745),r=i(94860),s=i(27657),o=i(52937),a=i(94020),l=i(47272),c=i(86305),u=i(85456),h=i(10904),d=i(78541),f=i(10956),_=i(81438);const p=16;class m extends o.A{constructor(){super(...arguments),this._color=(0,n.fA)(1,0,0,1)}dispose(){this._outlineProgram?.dispose(),this._outlineProgram=null,this._tileInfoProgram?.dispose(),this._tileInfoProgram=null,this._outlineVertexArrayObject?.dispose(),this._outlineVertexArrayObject=null,this._tileInfoVertexArrayObject?.dispose(),this._tileInfoVertexArrayObject=null,this._ctx=null}prepareState({context:t}){t.setBlendingEnabled(!0),t.setBlendFunctionSeparate(u.dn.ONE,u.dn.ONE_MINUS_SRC_ALPHA,u.dn.ONE,u.dn.ONE_MINUS_SRC_ALPHA),t.setColorMask(!0,!0,!0,!0),t.setStencilWriteMask(0),t.setStencilTestEnabled(!1)}draw(t,e){const{context:i,requestRender:n,allowDelayedRender:r}=t;if(!e.isReady&&e instanceof s.R&&e.hasData)return;if(this._loadWGLResources(i),r&&null!=n&&(!this._outlineProgram.compiled||!this._tileInfoProgram.compiled))return void n();i.bindVAO(this._outlineVertexArrayObject),i.useProgram(this._outlineProgram),this._outlineProgram.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),this._outlineProgram.setUniform2f("u_coord_range",e.rangeX,e.rangeY),this._outlineProgram.setUniform1f("u_depth",0),this._outlineProgram.setUniform4fv("u_color",this._color),i.drawArrays(u.WR.LINE_STRIP,0,4);const o=this._getTexture(i,e);o?(i.bindVAO(this._tileInfoVertexArrayObject),i.useProgram(this._tileInfoProgram),i.bindTexture(o,0),this._tileInfoProgram.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),this._tileInfoProgram.setUniform1f("u_depth",0),this._tileInfoProgram.setUniform2f("u_coord_ratio",e.rangeX/e.width,e.rangeY/e.height),this._tileInfoProgram.setUniform2f("u_delta",0,0),this._tileInfoProgram.setUniform2f("u_dimensions",o.descriptor.width,o.descriptor.height),i.drawArrays(u.WR.TRIANGLE_STRIP,0,4),i.bindVAO()):i.bindVAO()}_loadWGLResources(t){if(this._outlineProgram&&this._tileInfoProgram)return;const e=(0,h.r)(t,a.T),i=(0,h.r)(t,l.H),n=new Int8Array([0,0,1,0,1,1,0,1]),s=c.g.createVertex(t,u._U.STATIC_DRAW,n),o=new _.Z(t,a.T.attributes,r.Pd,{geometry:s}),d=new Int8Array([0,0,1,0,0,1,1,1]),f=c.g.createVertex(t,u._U.STATIC_DRAW,d),p=new _.Z(t,l.H.attributes,r.Pd,{geometry:f});this._outlineProgram=e,this._tileInfoProgram=i,this._outlineVertexArrayObject=o,this._tileInfoVertexArrayObject=p}_getTexture(t,e){if(!this._ctx){const t=document.createElement("canvas");t.width=512,t.height=512,this._ctx=t.getContext("2d")}if(!e.tileDebugInfoTexture){const i=new f.R;i.wrapMode=u.pF.CLAMP_TO_EDGE,i.samplingMode=u.Cj.LINEAR,i.isImmutable=!0,i.width=512,i.height=512,e.tileDebugInfoTexture=new d.g(t,i)}const i=this._ctx;i.clearRect(0,0,i.canvas.width,i.canvas.height),i.textAlign="left",i.textBaseline="top",i.font="14px sans-serif",i.lineWidth=2,i.fillStyle="white",i.strokeStyle="black";const{debugSlot:n}=e;let r=8+99.2*n;const s=`${n}) ${e.key.id} (${e.constructor.name})`;i.strokeText(s,8,r),i.fillText(s,8,r),r+=p;const{debugInfo:o}=e;if(o){const{length:t,minOrderedLength:e,minUnorderedLength:n,triangleCount:s}=o.display;if(t>0){const e=`Length: ${t}`;i.strokeText(e,8,r),i.fillText(e,8,r),r+=p}if(e){const t=`Min ordered length: ${e}`;i.strokeText(t,8,r),i.fillText(t,8,r),r+=p}if(n){const t=`Min unordered length: ${n}`;i.strokeText(t,8,r),i.fillText(t,8,r),r+=p}if(s>0){s>1e5&&(i.fillStyle="red",i.strokeStyle="white");const t=`Triangle count: ${s}`;i.strokeText(t,8,r),i.fillText(t,8,r),r+=p}const{bytesUsed:a,bytesReserved:l}=o.memory;if(i.fillStyle="white",i.strokeStyle="black",a>0||l>0){const t=`Memory usage: ${a} of ${l} bytes`;i.strokeText(t,8,r),i.fillText(t,8,r),r+=p}}return e.tileDebugInfoTexture.setData(i.canvas),e.tileDebugInfoTexture}}},87573:function(t,e,i){i.d(e,{A:function(){return r}});var n=i(14583);class r{constructor(t,e,i,r){this.computedX=0,this.computedY=0,this.center=(0,n.fA)(t,e),this.centerT=(0,n.vt)(),this.halfWidth=i/2,this.halfHeight=r/2,this.width=i,this.height=r}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+this.halfHeight}get trX(){return this.center[0]-this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+this.halfWidth}get ymin(){return this.y-this.halfHeight}get ymax(){return this.y+this.halfHeight}set x(t){this.center[0]=t}set y(t){this.center[1]=t}clone(){return new r(this.x,this.y,this.width,this.height)}serialize(t){return t.writeF32(this.center[0]),t.writeF32(this.center[1]),t.push(this.width),t.push(this.height),t}findCollisionDelta(t,e=4){const i=Math.abs(t.centerT[0]-this.centerT[0]),n=Math.abs(t.centerT[1]-this.centerT[1]),r=(t.halfWidth+this.halfWidth+e)/i,s=(t.halfHeight+this.halfHeight+e)/n,o=Math.min(r,s);return Math.log2(o)}extend(t){const e=Math.min(this.xmin,t.xmin),i=Math.min(this.ymin,t.ymin),n=Math.max(this.xmax,t.xmax)-e,r=Math.max(this.ymax,t.ymax)-i,s=e+n/2,o=i+r/2;this.width=n,this.height=r,this.halfWidth=n/2,this.halfHeight=r/2,this.x=s,this.y=o}static deserialize(t){const e=t.readF32(),i=t.readF32(),n=t.readInt32(),s=t.readInt32();return new r(e,i,n,s)}}},57650:function(t,e,i){i.d(e,{f:function(){return s}});var n=i(87573),r=i(24964);class s{constructor(t,e,i,n,r,s,o,a,l=[]){this.entityTexel=t,this.anchorX=e,this.anchorY=i,this.directionX=n,this.directionY=r,this.maxScale=s,this.minScale=o,this.referenceBounds=a,this.bounds=l}serialize(t){t.push(this.entityTexel),t.writeF32(this.anchorX),t.writeF32(this.anchorY),t.writeF32(this.directionX),t.writeF32(this.directionY),t.writeF32(this.maxScale),t.writeF32(this.minScale),null===this.referenceBounds?(t.writeF32(0),t.writeF32(0),t.writeF32(0)):(t.writeF32(this.referenceBounds.size),t.writeF32(this.referenceBounds.offsetX),t.writeF32(this.referenceBounds.offsetY)),(0,r.j)(t,this.bounds)}static deserialize(t){const e=t.readInt32(),i=t.readF32(),o=t.readF32(),a=t.readF32(),l=t.readF32(),c=t.readF32(),u=t.readF32(),h=t.readF32(),d=t.readF32(),f=t.readF32(),_=(0,r._)(t,n.A)??[];return new s(e,i,o,a,l,c,u,{size:h,offsetX:d,offsetY:f},_)}}},83258:function(t,e,i){i.d(e,{B:function(){return n},P:function(){return r}});class n{constructor(t){if(this.next=null,!Array.isArray(t))return void(this.data=t);this.data=t[0];let e=this;for(let i=1;i<t.length;i++)e.next=new n([t[i]]),e=e.next}*values(){let t=this;for(;t;)yield t.data,t=t.next}forEach(t){let e=this;for(;e;)t(e.data),e=e.next}get last(){return this.next?this.next.last:this}}class r{constructor(t){this._head=null,null!=t&&(this._head=new n(t))}get head(){return this._head}maxAvailableSpace(){if(null==this._head)return 0;let t=0;return this._head.forEach((e=>{const i=e.end-e.start;t=Math.max(t,i)})),t}firstFit(t){if(null==this._head)return null;let e=null,i=this._head;for(;i;){const n=i.data.end-i.data.start;if(n===t)return e?e.next=i.next:this._head=i.next,i.data.start;if(n>t){const e=i.data.start;return i.data.start+=t,e}e=i,i=i.next}return null}free(t,e){const i=t+e;if(null==this._head){const e=new n({start:t,end:i});return void(this._head=e)}if(i<=this._head.data.start){if(i===this._head.data.start)return void(this._head.data.start-=e);const r=new n({start:t,end:i});return r.next=this._head,void(this._head=r)}let r=this._head,s=r.next;for(;s;){if(s.data.start>=i){if(r.data.end===t){if(r.data.end+=e,r.data.end===s.data.start){const t=s.data.end-s.data.start;return r.data.end+=t,void(r.next=s.next)}return}if(s.data.start===i)return void(s.data.start-=e);const o=new n({start:t,end:i});return o.next=r.next,void(r.next=o)}r=s,s=s.next}if(t===r.data.end)return void(r.data.end+=e);const o=new n({start:t,end:i});r.next=o}clear(){this._head=null}}},39232:function(t,e,i){i.d(e,{Ci:function(){return o},HQ:function(){return r},No:function(){return a},XK:function(){return s},aY:function(){return n}});const n=1,r=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],o=256,a={outlineWidth:1.3,outerHaloWidth:.4,innerHaloWidth:.4,outlinePosition:0}},28230:function(t,e,i){var n,r,s,o,a,l,c,u,h;i.d(e,{Be:function(){return a},Gn:function(){return s},RI:function(){return c},S5:function(){return r},ch:function(){return u},uC:function(){return h}}),function(t){t[t.FILL=0]="FILL",t[t.LINE=1]="LINE",t[t.MARKER=2]="MARKER",t[t.TEXT=3]="TEXT",t[t.LABEL=4]="LABEL"}(n||(n={})),function(t){t[t.NONE=0]="NONE",t[t.MAP=1]="MAP",t[t.LABEL=2]="LABEL",t[t.LABEL_ALPHA=4]="LABEL_ALPHA",t[t.HITTEST=8]="HITTEST",t[t.HIGHLIGHT=16]="HIGHLIGHT",t[t.CLIP=32]="CLIP",t[t.DEBUG=64]="DEBUG",t[t.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES"}(r||(r={})),function(t){t[t.SIZE=0]="SIZE",t[t.COLOR=1]="COLOR",t[t.OPACITY=2]="OPACITY",t[t.ROTATION=3]="ROTATION"}(s||(s={})),function(t){t[t.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE",t[t.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE",t[t.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE",t[t.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"}(o||(o={})),function(t){t[t.SPRITE=0]="SPRITE",t[t.GLYPH=1]="GLYPH"}(a||(a={})),function(t){t[t.DEFAULT=0]="DEFAULT",t[t.SIMPLE=1]="SIMPLE",t[t.DOT_DENSITY=2]="DOT_DENSITY",t[t.OUTLINE_FILL=3]="OUTLINE_FILL",t[t.OUTLINE_FILL_SIMPLE=4]="OUTLINE_FILL_SIMPLE",t[t.HEATMAP=5]="HEATMAP",t[t.PIE_CHART=6]="PIE_CHART"}(l||(l={})),function(t){t[t.All=0]="All",t[t.Highlight=1]="Highlight",t[t.InsideEffect=2]="InsideEffect",t[t.OutsideEffect=3]="OutsideEffect"}(c||(c={})),function(t){t[t.BATCHING=0]="BATCHING",t[t.STRICT_ORDER=1]="STRICT_ORDER",t[t.STRICT_MARKERS_AND_TEXT=2]="STRICT_MARKERS_AND_TEXT"}(u||(u={})),function(t){t[t.FILL=0]="FILL",t[t.LINE=1]="LINE",t[t.MARKER=2]="MARKER",t[t.TEXT=3]="TEXT"}(h||(h={}))},95415:function(t,e,i){i.d(e,{A:function(){return s},J:function(){return r}});var n=i(50944);function r(t,e){let i;if("string"==typeof t)i=(0,n.Wm)(t+`-seed(${e})`);else{let n=12;i=t^e;do{i=107*(i>>8^i)+n|0}while(0!=--n)}return(1+i/(1<<31))/2}function s(t){return Math.floor(r(t,o)*a)}const o=53290320,a=10},80308:function(t,e,i){i.d(e,{U:function(){return a}});var n=i(46065),r=i(88231);class s{get length(){return this._pos}constructor(t,e){this._pos=0;const i=e?this._roundToNearest(e,t.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(i),this._buffer=new t(this._array),this._ctor=t,this._i16View=new Int16Array(this._array)}_roundToNearest(t,e){const i=Math.round(t);return 1===e?i:i+(e-i%e)}_ensureSize(t){if(this._pos+t>=this._buffer.length){const e=this._roundToNearest(1.25*(this._array.byteLength+t*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),i=new ArrayBuffer(e),n=new this._ctor(i);n.set(this._buffer,0),this._array=i,this._buffer=n,this._i16View=new Int16Array(this._array)}}ensureSize(t){this._ensureSize(t)}writeF32(t){this._ensureSize(1);const e=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=t,this._pos++,e}push(t){this._ensureSize(1);const e=this._pos;return this._buffer[this._pos++]=t,e}writeFixed(t){this._buffer[this._pos++]=t}setValue(t,e){this._buffer[t]=e}i1616Add(t,e,i){this._i16View[2*t]+=e,this._i16View[2*t+1]+=i}getValue(t){return this._buffer[t]}getValueF32(t){return new Float32Array(this._array,4*t,1)[0]}incr(t){if(this._buffer.length<t)throw new Error("Increment index overflows the target buffer");this._buffer[t]++}decr(t){this._buffer[t]--}writeRegion(t){this._ensureSize(t.length);const e=this._pos;return this._buffer.set(t,this._pos),this._pos+=t.length,e}writeManyFrom(t,e,i){this._ensureSize(i-e);for(let n=e;n!==i;n++)this.writeFixed(t._buffer[n])}buffer(){const t=this._array.slice(0,4*this._pos);return this.destroy(),t}toArray(){return[...this._buffer]}seek(t){this._pos=t}destroy(){this._array=null,this._buffer=null}}class o{constructor(t,e,i=0){const n=6*i*Uint32Array.BYTES_PER_ELEMENT,r=4*i*e.stride,o=e.stride/4,a=e.attributes.find((t=>"pos"===t.name||"position"===t.name));if(!a)throw new Error("InternalError: Unable to find position attribute");this.layout={...e,position:a},this._indices=new s(Uint32Array,n),this._vertices=new s(Uint32Array,r),this._metrics=new s(Uint32Array,0),this._metricCountOffset=this._metrics.push(0),this._strideInt=o,this._instanceId=t}serialize(t){const e=this._indices.buffer(),i=this._vertices.buffer(),n=this._metrics.length?this._metrics.buffer():null;return t.push(e,i),{instanceId:this._instanceId,layout:this.layout,indices:e,vertices:i,metrics:n}}get strideInt(){return this._strideInt}get vertexCount(){return this._vertices.length/this._strideInt}get indexCount(){return this._indices.length}get indexWriter(){return this._indices}get vertexWriter(){return this._vertices}get metricWriter(){return this._metrics}vertexEnsureSize(t){this._vertices.ensureSize(t)}indexEnsureSize(t){this._indices.ensureSize(t)}writeIndex(t){this._indices.push(t)}writeVertex(t){this._vertices.push(t)}writeVertexRegion(t){this._vertices.writeRegion(t)}writeVertexF32(t){this._vertices.writeF32(t)}writeMetric(t){this._metrics.incr(this._metricCountOffset),t.serialize(this._metrics)}}class a{constructor(t,e=0){this._id=t,this._sizeHint=e,this._entityRecordCountOffset=0,this._entityCountOffset=0,this._entityIdIndex=0,this._entitySortKeyIndex=0,this._instanceIdToVertexData=new Map,this._recordIndexStart=0,this._recordIndexCount=0,this._recordVertexStart=0,this._recordVertexCount=0,this._current={metric:null,writer:null,start:0,sortKey:0,instanceId:0,layoutHash:0,indexStart:0,vertexStart:0,textureKey:0,metricBoxLenPointer:0},this._entities=new s(Uint32Array,this._sizeHint*n.A.byteSizeHint),this._entityCountOffset=this._entities.push(0)}get id(){return this._id}serialize(){const t=new Array,e=[],i=this._entities.buffer();for(const i of this._instanceIdToVertexData.values())e.push(i.serialize(t));return{message:{data:e,entities:i},transferList:t}}vertexCount(){return this._current.writer?.vertexCount??0}indexCount(){return this._current.writer?.indexCount??0}vertexEnsureSize(t){this._current.writer.vertexEnsureSize(t)}indexEnsureSize(t){this._current.writer.indexEnsureSize(t)}vertexWrite(t){this._current.writer.writeVertex(t)}vertexWriteRegion(t){this._current.writer.writeVertexRegion(t)}vertexWriteF32(t){this._current.writer.writeVertexF32(t)}recordBounds(t,e,i,n){}indexWrite(t){this._current.writer.writeIndex(t)}metricStart(t){this._current.metric=t}metricEnd(){const t=this._current.writer;this._current.metric.bounds.length&&t.writeMetric(this._current.metric)}metricBoxWrite(t){this._current.metric.bounds.push(t)}entityStart(t,e=t){this._entityIdIndex=this._entities.push(t),this._entitySortKeyIndex=this._entities.writeF32(e),this._entityRecordCountOffset=this._entities.push(0)}entityRecordCount(){return this._entities.getValue(this._entityRecordCountOffset)}entityEnd(){0===this.entityRecordCount()?this._entities.seek(this._entityIdIndex):this._entities.incr(this._entityCountOffset)}recordCount(){return this._entities.getValue(this._entityRecordCountOffset)}recordStart(t,e,i=0){this._current.writer=this._getVertexWriter(t,e),this._current.indexStart=this._current.writer.indexCount,this._current.vertexStart=this._current.writer.vertexCount,this._current.instanceId=t,this._current.layoutHash=e.hash,this._current.textureKey=i}recordEnd(t=0){const e=this._current.vertexStart,i=this._current.writer.vertexCount-e;if(!i)return!1;const n=this._current.indexStart,s=this._current.writer.indexCount-n;return this._recordIndexStart=n,this._recordIndexCount=s,this._recordVertexStart=e,this._recordVertexCount=i,this._entities.incr(this._entityRecordCountOffset),r.A.write(this._entities,this._current.instanceId,this._current.textureKey,n,s,e,i,t),!0}copyLast(t,e){const i=this._recordVertexStart+this._recordVertexCount;this._entities.incr(this._entityRecordCountOffset),r.A.write(this._entities,this._current.instanceId,this._current.textureKey,this._recordIndexStart+this._recordIndexCount,this._recordIndexCount,i,this._recordVertexCount,0);const n=this._current.writer.indexWriter,s=this._current.writer.vertexWriter,o=this._recordIndexStart+this._recordIndexCount,a=this._recordVertexCount;for(let t=this._recordIndexStart;t!==o;t++){const e=n.getValue(t);n.push(e+a)}const l=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT,c=this._recordVertexStart*l,u=(this._recordVertexStart+this._recordVertexCount)*l;for(let t=c;t!==u;t++){const e=s.getValue(t);s.push(e)}const h=this._current.writer.layout.position,d=h.packPrecisionFactor??1,f=h.offset/Uint32Array.BYTES_PER_ELEMENT,_=t*d,p=e*d;for(let t=i*l;t<=s.length;t+=l)s.i1616Add(t+f,_,p)}copyLastFrom(t,e,i){const n=t._entities.getValue(t._entityIdIndex);if(n!==this._entities.getValue(this._entityIdIndex)){const e=t._entities.getValueF32(t._entitySortKeyIndex);this.entityStart(n,e)}this.recordStart(t._current.instanceId,t._current.writer.layout,t._current.textureKey);const r=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT,s=this._current.vertexStart,o=t._current.vertexStart-s,a=this._current.writer.indexWriter,l=this._current.writer.vertexWriter,c=t._current.writer.indexWriter,u=t._current.writer.vertexWriter;for(let e=t._current.indexStart;e!==c.length;e++){const t=c.getValue(e);a.push(t-o)}for(let e=t._current.vertexStart*r;e!==u.length;e++){const t=u.getValue(e);l.push(t)}const h=this._current.writer.layout.position,d=h.packPrecisionFactor??1,f=h.offset/Uint32Array.BYTES_PER_ELEMENT,_=e*d,p=i*d;for(let t=s*r;t<=l.length;t+=r)l.i1616Add(t+f,_,p);this.recordEnd()}_getVertexWriter(t,e){const i=this._instanceIdToVertexData;return i.has(t)||i.set(t,new o(t,e,this._sizeHint)),i.get(t)}}},93561:function(t,e,i){i.d(e,{J:function(){return o}});var n=i(50944),r=i(88413);class s{}class o extends s{constructor(t){super(),this._fetcher=t,this._controller=new AbortController,this._pendingIds=new Set,this._pendingRequests=[],this._resourceIdToResource=new Map}destroy(){this._controller.abort()}get _abortOptions(){return{signal:this._controller.signal}}enqueueRequest(t){const e=(0,r.IF)(t.resource),i=(0,n.Wm)(JSON.stringify(e));return this._pendingIds.has(i)||(this._pendingIds.add(i),this._pendingRequests.push({...t,resourceId:i})),i}async fetchEnqueuedResources(){const t=this._pendingRequests;this._pendingIds.clear(),this._pendingRequests=[];const e=await this._fetcher.fetch(t,this._abortOptions);for(let i=0;i<e.length;i++){const n=t[i].resourceId;this._resourceIdToResource.set(n,e[i])}}async fetchResourceImmediate(t){const e=await this._fetcher.fetch([t],this._abortOptions);if(1!==e.length)throw new Error("FeaturePipelineResourceProxy: failed to fetch resources");return e[0]}async fetchDictionaryResourceImmediate(t){const e=await this._fetcher.fetchDictionary([t],this._abortOptions);if(1!==e.length)throw new Error("FeaturePipelineResourceProxy: failed to fetch dictionary resources");return e[0]}getResource(t){return this._resourceIdToResource.get(t)}}},17469:function(t,e,i){i.d(e,{Tl:function(){return T}});var n=i(67348),r=i(10793),s=i(13786),o=i(14583),a=i(96564),l=i(54904),c=i(87573);const u=22,h=4,d=u+h,f=u-6,_=3,p=Math.PI/180;class m{constructor(t,e,i,n){this._rotationT=(0,r.vt)(),this._xBounds=0,this._yBounds=0,this.minZoom=0,this.maxZoom=255,this._bounds=null;const s=i.rect,o=new Float32Array(8);t*=n,e*=n;const a=i.code?s.width*n:i.metrics.width,l=i.code?s.height*n:i.metrics.height;this.width=a,this.height=l,o[0]=t,o[1]=e,o[2]=t+a,o[3]=e,o[4]=t,o[5]=e+l,o[6]=t+a,o[7]=e+l,this._data=o,this._setTextureCoords(s),this._scale=n,this._mosaic=i,this.x=t,this.y=e,this.maxOffset=Math.max(t+a,e+l)}get mosaic(){return this._mosaic}set angle(t){this._angle=t,(0,n.$0)(this._rotationT,-t),this._setOffsets()}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){return this._offsets||this._setOffsets(),this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){const{height:t,width:e}=this._mosaic.metrics,i=e*this._scale,s=Math.abs(t)*this._scale,o=new Float32Array(8);o[0]=this.x,o[1]=this.y,o[2]=this.x+i,o[3]=this.y,o[4]=this.x,o[5]=this.y+s,o[6]=this.x+i,o[7]=this.y+s;const a=(0,n.lw)((0,r.vt)(),this._rotationT,this._transform);(0,r.gb)(o,o,a);let l=1/0,u=1/0,h=0,d=0;for(let t=0;t<4;t++){const e=o[2*t],i=o[2*t+1];l=Math.min(l,e),u=Math.min(u,i),h=Math.max(h,e),d=Math.max(d,i)}const f=h-l,_=d-u,p=l+f/2,m=u+_/2;this._bounds=new c.A(p,m,f,_)}return this._bounds}setTransform(t){this._transform=t,this._offsets=null}_setOffsets(){this._offsets||(this._offsets={topLeft:[0,0],topRight:[0,0],bottomLeft:[0,0],bottomRight:[0,0]});const t=(0,n.lw)((0,r.vt)(),this._rotationT,this._transform);this._offsets.topLeft[0]=this._data[0],this._offsets.topLeft[1]=this._data[1],this._offsets.topRight[0]=this._data[2],this._offsets.topRight[1]=this._data[3],this._offsets.bottomLeft[0]=this._data[4],this._offsets.bottomLeft[1]=this._data[5],this._offsets.bottomRight[0]=this._data[6],this._offsets.bottomRight[1]=this._data[7],(0,s.l0)(this._offsets.topLeft,this._offsets.topLeft,t),(0,s.l0)(this._offsets.topRight,this._offsets.topRight,t),(0,s.l0)(this._offsets.bottomLeft,this._offsets.bottomLeft,t),(0,s.l0)(this._offsets.bottomRight,this._offsets.bottomRight,t)}_setTextureCoords({x:t,y:e,width:i,height:n}){this._texcoords={topLeft:[t,e],topRight:[t+i,e],bottomLeft:[t,e+n],bottomRight:[t+i,e+n]}}}const g=(t,e)=>({code:0,page:0,sdf:!0,rect:new l.A(0,0,11,8),textureBinding:e,metrics:{advance:0,height:4,width:t,left:0,top:0}});function y(t,e){return t.forEach((t=>(0,s.l0)(t,t,e))),{topLeft:t[0],topRight:t[1],bottomLeft:t[2],bottomRight:t[3]}}class v{constructor(t,e,i){this._rotation=0,this._decorate(t,e,i),this.glyphs=t,this.bounds=this._createBounds(t),this.isMultiline=e.length>1,this._hasRotation=0!==i.angle,this._transform=this._createGlyphTransform(this.bounds,i),this._borderLineSizePx=i.borderLineSizePx,(i.borderLineSizePx||i.hasBackground)&&([this.bounds,this.textBox]=this.shapeBackground(this._transform));for(const e of t)e.setTransform(this._transform)}setRotation(t){if(0===t&&0===this._rotation)return;this._rotation=t;const e=this._transform,i=(0,n.$0)((0,r.vt)(),t);(0,n.lw)(e,i,e);for(const t of this.glyphs)t.setTransform(this._transform)}_decorate(t,e,i){if(!i.decoration||"none"===i.decoration||!t.length)return;const n=i.scale,r="underline"===i.decoration?d:f,s=t[0].textureBinding;for(const i of e){const e=i.startX*n,o=i.startY*n,a=(i.width+i.glyphWidthEnd)*n;t.push(new m(e,o+r*n,g(a,s),1))}}shapeBackground(t){const e=(1.5+(this._borderLineSizePx||0))/2,i=this._borderLineSizePx?e:0,{xmin:n,ymin:r,xmax:s,ymax:o,x:a,y:l,width:u,height:h}=this.bounds,d=[n-8,r-8],f=[s+8,r-8],_=[n-8,o+8],p=[s+8,o+8],m=y([[d[0]-e,d[1]-e],[f[0]+e,f[1]-e],[d[0]+i,d[1]+i],[f[0]-i,f[1]+i]],t),g=y([[_[0]+i,_[1]-i],[p[0]-i,p[1]-i],[_[0]-e,_[1]+e],[p[0]+e,p[1]+e]],t),v=y([[d[0]-e,d[1]-e],[d[0]+i,d[1]+i],[_[0]-e,_[1]+e],[_[0]+i,_[1]-i]],t),x=y([[f[0]-i,f[1]+i],[f[0]+e,f[1]-e],[p[0]-i,p[1]-i],[p[0]+e,p[1]+e]],t),b={main:y([d,f,_,p],t),top:m,bot:g,left:v,right:x};return[new c.A(a,l,u+2*e,h+2*e),b]}get boundsT(){const t=this.bounds,e=(0,s.hZ)((0,o.vt)(),t.x,t.y);if((0,s.l0)(e,e,this._transform),this._hasRotation){const i=Math.max(t.width,t.height);return new c.A(e[0],e[1],i,i)}return new c.A(e[0],e[1],t.width,t.height)}_createBounds(t){let e=1/0,i=1/0,n=0,r=0;for(const s of t)e=Math.min(e,s.xTopLeft),i=Math.min(i,s.yTopLeft),n=Math.max(n,s.xBottomRight),r=Math.max(r,s.yBottomRight);const s=n-e,o=r-i;return new c.A(e+s/2,i+o/2,s,o)}_createGlyphTransform(t,e){const i=p*e.angle,a=(0,r.vt)(),l=(0,o.vt)();return(0,n.Tl)(a,a,(0,s.hZ)(l,e.xOffset,-e.yOffset)),e.useCIMAngleBehavior?(0,n.e$)(a,a,i):((0,n.Tl)(a,a,(0,s.hZ)(l,t.x,t.y)),(0,n.e$)(a,a,i),(0,n.Tl)(a,a,(0,s.hZ)(l,-t.x,-t.y))),a}}class x{constructor(t,e,i,n,r,s){this.glyphWidthEnd=0,this.startX=0,this.startY=0,this.start=Math.max(0,Math.min(e,i)),this.end=Math.max(0,Math.max(e,i)),this.end<t.length&&(this.glyphWidthEnd=t[this.end].metrics.width),this.width=n,this.yMin=r,this.yMax=s}}const b=t=>10===t,S=t=>32===t;function w(t,e){let i=0;for(let e=0;e<t.length;e++){const{width:n}=t[e];i=Math.max(n,i)}const n="underline"===e.decoration?h:0,r=t[0].yMin;return{x:0,y:r,height:t[t.length-1].yMax+e.lineHeight*(t.length-1)+n-r,width:i}}function T(t,e){const i=e.scale,n=new Array,{glyphs:r,isRightToLeft:s}=t,o=function(t,e,i){const n=new Array,r=1/i.scale,s=i.maxLineWidth*r,o=e?t.length-1:0,a=e?-1:t.length,l=e?-1:1;let c=o,u=0,h=0,d=c,f=d,_=0,p=1/0,m=0;for(;c!==a;){const{code:e,metrics:i}=t[c],r=Math.abs(i.top);if(b(e)||S(e)||(p=Math.min(p,r),m=Math.max(m,r+i.height)),b(e))c!==o&&(n.push(new x(t,d,c-l,u,p===1/0?0:p,m)),p=1/0,m=0),u=0,d=c+l,f=c+l,h=0;else if(S(e))f=c+l,h=0,_=i.advance,u+=i.advance;else if(u>s){if(f!==d){const e=f-2*l;u-=_,n.push(new x(t,d,e,u-h,p,m)),p=1/0,m=0,d=f,u=h}else n.push(new x(t,d,c-l,u,p,m)),p=1/0,m=0,d=c,f=c,u=0;u+=i.advance,h+=i.advance}else u+=i.advance,h+=i.advance;c+=l}const g=new x(t,d,c-l,u,p,m);return g.start>=0&&g.end<t.length&&n.push(g),n}(r,s,e),l=o.length?w(o,e):{x:0,y:0,height:0,width:0},c=(0,a.xy)(e.horizontalAlignment),h=(0,a.UD)(e.verticalAlignment),d=h===a.gy.Baseline?1:0,f=d?0:h-1,p=(1-d)*-l.y+f*(l.height/2)+(d?1:0)*-u;for(let t=0;t<o.length;t++){const{start:s,end:a,width:l}=o[t];let u=-1*(c+1)*(l/2)-_;const h=t*e.lineHeight+p-_;o[t].startX=u,o[t].startY=h;for(let t=s;t<=a;t++){const e=r[t];if(b(e.code))continue;const s=new m(u+e.metrics.left,h-e.metrics.top,e,i);u+=e.metrics.advance,n.push(s)}}return new v(n,o,e)}},69825:function(t,e,i){i.d(e,{uS:function(){return U},FE:function(){return V},lO:function(){return B},XZ:function(){return k}}),i(59122);var n=i(81484),r=i(72139),s=i(76613),o=i(39686);function a(t,e,i,n,r,s,o){O=0;const a=(n-i)*s,c=r&&r.length,h=c?(r[0]-i)*s:a;let d,f,_,p,g,y=l(e,i,0,0,h,s,!0);if(y&&y.next!==y.prev){if(c&&(y=m(e,i,n,r,y,s)),a>80*s){d=_=e[0+i*s],f=p=e[1+i*s];for(let t=s;t<h;t+=s){const n=e[t+i*s],r=e[t+1+i*s];d=Math.min(d,n),f=Math.min(f,r),_=Math.max(_,n),p=Math.max(p,r)}g=Math.max(_-d,p-f),g=0!==g?1/g:0}u(y,t,s,d,f,g,o,0)}}function l(t,e,i,n,r,s,o){let a;if(o===function(t,e,i,n,r,s){let o=0;for(let i=n,a=r-s;i<r;i+=s)o+=(t[a+e*s]-t[i+e*s])*(t[i+1+e*s]+t[a+1+e*s]),a=i;return o}(t,e,0,n,r,s)>0)for(let i=n;i<r;i+=s)a=f(i+e*s,t[i+e*s],t[i+1+e*s],a);else for(let i=r-s;i>=n;i-=s)a=f(i+e*s,t[i+e*s],t[i+1+e*s],a);return a&&T(a,a.next)&&(_(a),a=a.next),a}function c(t,e=t){if(!t)return t;let i,n=t;do{if(i=!1,n.steiner||!T(n,n.next)&&0!==v(n.prev,n,n.next))n=n.next;else{if(_(n),n=e=n.prev,n===n.next)break;i=!0}}while(i||n!==e);return e}function u(t,e,i,n,r,s,o,a){if(!t)return;!a&&s&&(t=y(t,n,r,s));let l=t;for(;t.prev!==t.next;){const f=t.prev,p=t.next;if(s?d(t,n,r,s):h(t))e.push(f.index/i+o),e.push(t.index/i+o),e.push(p.index/i+o),_(t),t=p.next,l=p.next;else if((t=p)===l){a?1===a?u(t=P(t,e,i,o),e,i,n,r,s,o,2):2===a&&E(t,e,i,n,r,s,o):u(c(t),e,i,n,r,s,o,1);break}}}function h(t){const e=t.prev,i=t,n=t.next;if(v(e,i,n)>=0)return!1;let r=t.next.next;const s=r;let o=0;for(;r!==t.prev&&(0===o||r!==s);){if(o++,b(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&v(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function d(t,e,i,n){const r=t.prev,s=t,o=t.next;if(v(r,s,o)>=0)return!1;const a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,c=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,u=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,h=w(a,l,e,i,n),d=w(c,u,e,i,n);let f=t.prevZ,_=t.nextZ;for(;f&&f.z>=h&&_&&_.z<=d;){if(f!==t.prev&&f!==t.next&&b(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&v(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,_!==t.prev&&_!==t.next&&b(r.x,r.y,s.x,s.y,o.x,o.y,_.x,_.y)&&v(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(;f&&f.z>=h;){if(f!==t.prev&&f!==t.next&&b(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&v(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;_&&_.z<=d;){if(_!==t.prev&&_!==t.next&&b(r.x,r.y,s.x,s.y,o.x,o.y,_.x,_.y)&&v(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function f(t,e,i,n){const r=I.create(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function _(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function p(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function m(t,e,i,n,r,s){const o=new Array;for(let r=0,a=n.length;r<a;r++){const c=l(t,e,0,n[r]*s,r<a-1?n[r+1]*s:i*s,s,!1);c===c.next&&(c.steiner=!0),o.push(p(c))}o.sort(M);for(const t of o)r=g(t,r);return r}function g(t,e){const i=function(t,e){let i=e;const n=t.x,r=t.y;let s,o=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const t=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=n&&t>o){if(o=t,t===n){if(r===i.y)return i;if(r===i.next.y)return i.next}s=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!s)return null;if(n===o)return s.prev;const a=s,l=s.x,c=s.y;let u,h=1/0;for(i=s.next;i!==a;)n>=i.x&&i.x>=l&&n!==i.x&&b(r<c?n:o,r,l,c,r<c?o:n,r,i.x,i.y)&&(u=Math.abs(r-i.y)/(n-i.x),(u<h||u===h&&i.x>s.x)&&S(i,t)&&(s=i,h=u)),i=i.next;return s}(t,e);if(!i)return e;const n=C(i,t);return c(n,n.next),c(i,i.next)}function y(t,e,i,n){let r;for(;r!==t;r=r.next){if(r=r||t,null===r.z&&(r.z=w(r.x,r.y,e,i,n)),r.prev.next!==r||r.next.prev!==r)return r.prev.next=r,r.next.prev=r,y(t,e,i,n);r.prevZ=r.prev,r.nextZ=r.next}return t.prevZ.nextZ=null,t.prevZ=null,function(t){let e,i=1;for(;;){let n,r=t;t=null,e=null;let s=0;for(;r;){s++,n=r;let o=0;for(;o<i&&n;o++)n=n.nextZ;let a=i;for(;o>0||a>0&&n;){let i;0===o?(i=n,n=n.nextZ,a--):0!==a&&n?r.z<=n.z?(i=r,r=r.nextZ,o--):(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,o--),e?e.nextZ=i:t=i,i.prevZ=e,e=i}r=n}if(e.nextZ=null,i*=2,s<2)return t}}(t)}function v(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function x(t,e,i,n){return!!(T(t,e)&&T(i,n)||T(t,n)&&T(i,e))||v(t,e,i)>0!=v(t,e,n)>0&&v(i,n,t)>0!=v(i,n,e)>0}function b(t,e,i,n,r,s,o,a){return(r-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(n-a)-(i-o)*(e-a)>=0&&(i-o)*(s-a)-(r-o)*(n-a)>=0}function S(t,e){return v(t.prev,t,t.next)<0?v(t,e,t.next)>=0&&v(t,t.prev,e)>=0:v(t,e,t.prev)<0||v(t,t.next,e)<0}function w(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function T(t,e){return t.x===e.x&&t.y===e.y}function M(t,e){return t.x-e.x}function P(t,e,i,n){let r=t;do{const s=r.prev,o=r.next.next;!T(s,o)&&x(s,r,r.next,o)&&S(s,o)&&S(o,s)&&(e.push(s.index/i+n),e.push(r.index/i+n),e.push(o.index/i+n),_(r),_(r.next),r=t=o),r=r.next}while(r!==t);return r}function E(t,e,i,n,r,s,o){let a=t;do{let t=a.next.next;for(;t!==a.prev;){if(a.index!==t.index&&A(a,t)){let l=C(a,t);return a=c(a,a.next),l=c(l,l.next),u(a,e,i,n,r,s,o,0),void u(l,e,i,n,r,s,o,0)}t=t.next}a=a.next}while(a!==t)}function A(t,e){return t.next.index!==e.index&&t.prev.index!==e.index&&!function(t,e){let i=t;do{if(i.index!==t.index&&i.next.index!==t.index&&i.index!==e.index&&i.next.index!==e.index&&x(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&S(t,e)&&S(e,t)&&function(t,e){let i=t,n=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)}function C(t,e){const i=I.create(t.index,t.x,t.y),n=I.create(e.index,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}class I{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}static create(t,e,i){const n=O<R.length?R[O++]:new I;return n.index=t,n.x=e,n.y=i,n.prev=null,n.next=null,n.z=null,n.prevZ=null,n.nextZ=null,n.steiner=!1,n}}const R=[];let O=0;for(let t=0;t<8096;t++)R.push(new I);const F=1e-5,z=new r.O3(0,0,0,1,0),D=new r.O3(0,0,0,1,0);function L(t,e,i){let n=0;for(let r=1;r<i;r++){const i=t[2*(e+r-1)],s=t[2*(e+r-1)+1];n+=(t[2*(e+r)]-i)*(t[2*(e+r)+1]+s)}return n}function N(t,e,i,n,r){let s=0;for(let o=i;o<n;o+=3){const i=2*(t[o]-r),n=2*(t[o+1]-r),a=2*(t[o+2]-r);s+=Math.abs((e[i]-e[a])*(e[n+1]-e[i+1])-(e[i]-e[n])*(e[a+1]-e[i+1]))}return s}function B(t,e){const{coords:i,lengths:n,hasIndeterminateRingOrder:r}=e,s=t;if(r)return!1;let o=0;for(let t=0;t<n.length;){let e=t,r=n[t],l=L(i,o,r);const c=[];for(;++e<n.length;){const t=n[e],s=L(i,o+r,t);if(!(s>0))break;l+=s,c.push(o+r),r+=t}const u=s.length;a(s,i,o,o+r,c,2,0);const h=N(s,i,u,s.length,0),d=Math.abs(l);if(Math.abs((h-d)/Math.max(1e-7,d))>F)return s.length=0,!1;t=e,o+=r}return!0}function k(t){const{coords:e,lengths:i}=t,{buffer:r}=(0,n.l)(e,i);return r}function V(t,e){if(null==t)return null;if(!function(t,e,i){let n=0;for(let e=0;e<t.lengths.length;e++){const r=t.lengths[e];for(let e=0;e<r;e++){const r=t.coords[2*(e+n)],s=t.coords[2*(e+n)+1];if(r<-128||r>i||s<-128||s>i)return!0}n+=r}return!1}(t,0,o.CQ+128))return t;z.setPixelMargin(e),z.reset(r.dC.Polygon);let i=0;for(let e=0;e<t.lengths.length;e++){const n=t.lengths[e];let r=t.coords[2*(0+i)],s=t.coords[2*(0+i)+1];z.moveTo(r,s);for(let e=1;e<n;e++)r=t.coords[2*(e+i)],s=t.coords[2*(e+i)+1],z.lineTo(r,s);z.close(),i+=n}const n=z.result(!1);if(!n)return null;const a=[],l=[];for(const t of n){let e=0;for(const i of t)l.push(i.x),l.push(i.y),e++;a.push(e)}return new s.A(a,l)}function U(t,e){D.setPixelMargin(e);const i=D,n=-e,s=o.CQ+e;let a=[],l=!1;if(!t.nextPath())return null;let c=!0;for(;c;){t.seekPathStart();const e=[];if(!t.pathSize)return null;i.reset(r.dC.LineString),t.nextPoint();let o=t.x,u=t.y;if(l)i.moveTo(o,u);else{if(o<n||o>s||u<n||u>s){l=!0;continue}e.push({x:o,y:u})}let h=!1;for(;t.nextPoint();)if(o=t.x,u=t.y,l)i.lineTo(o,u);else{if(o<n||o>s||u<n||u>s){h=!0;break}e.push({x:o,y:u})}if(h)l=!0;else{if(l){const t=i.resultWithStarts();if(t)for(const e of t)a.push(e)}else a.push({line:e,start:0});c=t.nextPath(),l=!1}}return a=a.filter((t=>t.line.length>1)),0===a.length?null:a}z.setExtent(o.CQ),D.setExtent(o.CQ)},85475:function(t,e,i){i.d(e,{Kl:function(){return l},M9:function(){return o},fw:function(){return a}});const n=new Float32Array(1),r=new Uint32Array(n.buffer);function s(t){return n[0]=t,r[0]}function o(t,e){return 65535&t|e<<16}function a(t){const e=s(t),i=e>>>31;let n=e>>>23&255,r=8388607&e;return n-=127,n>15?i<<15|31744:n<-25?0:(n<-14&&(r+=8388608,r/=2**(-14-n),n=-15),n+=15,r/=8192,r=function(t,e){const i=Math.floor(t),n=t-i;return i<1023&&(n>.5||.5===n&&i%2==1)?i+1:i}(r),i<<15|n<<10|r)}function l(t){let e=t>>>15,i=t>>10&31,n=1023&t;return e=e?-1:1,i-=15,n/=1024,i>-15?n+=1:i=-14,e*2**i*n}},98282:function(t,e,i){i.d(e,{Y7:function(){return L},HS:function(){return N},mm:function(){return B},A:function(){return V},k2:function(){return k},ZA:function(){return D},E8:function(){return F},hF:function(){return I},C5:function(){return C},uK:function(){return O},Pi:function(){return R}});var n=i(53804),r=(i(58941),i(40633)),s=i(50944),o=i(39819),a=i(54516),l=i(90553);class c{constructor(){this._includedModules=new Map}include(t,e){this._includedModules.has(t)?this._includedModules.get(t):(this._includedModules.set(t,e),t(this.builder,e))}}class u extends c{constructor(){super(...arguments),this.vertex=new f,this.fragment=new f,this.attributes=new _,this.varyings=new p,this.extensions=new m,this.constants=new g}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(t,e=!0){const i=this.extensions.generateSource(t),n=this.attributes.generateSource(t),r=this.varyings.generateSource(t),s="vertex"===t?this.vertex:this.fragment,o=s.uniforms.generateSource(),a=s.code.generateSource(),l="vertex"===t?y:function(t=!0){return`#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif\n${t?"out vec4 fragColor;":""}\n`}(e),c=this.constants.generateSource().concat(s.constants.generateSource());return`${e?"#version 300 es":""}\n${i.join("\n")}\n${l}\n${c.join("\n")}\n${o.join("\n")}\n${n.join("\n")}\n${r.join("\n")}\n${a.join("\n")}`}generateBindPass(t){const e=new Map;this.vertex.uniforms.entries.forEach((t=>{const i=t.bind[a.c.Pass];i&&e.set(t.name,i)})),this.fragment.uniforms.entries.forEach((t=>{const i=t.bind[a.c.Pass];i&&e.set(t.name,i)}));const i=Array.from(e.values()),n=i.length;return(e,r)=>{for(let s=0;s<n;++s)i[s](t,e,r)}}generateBindDraw(t){const e=new Map;this.vertex.uniforms.entries.forEach((t=>{const i=t.bind[a.c.Draw];i&&e.set(t.name,i)})),this.fragment.uniforms.entries.forEach((t=>{const i=t.bind[a.c.Draw];i&&e.set(t.name,i)}));const i=Array.from(e.values()),n=i.length;return(e,r,s)=>{for(let o=0;o<n;++o)i[o](t,e,r,s)}}}class h{constructor(){this._entries=new Map}add(...t){for(const e of t)this._add(e)}get(t){return this._entries.get(t)}_add(t){if(null!=t){if(this._entries.has(t.name)&&!this._entries.get(t.name).equals(t))throw new o.A(`Duplicate uniform name ${t.name} for different uniform type`);this._entries.set(t.name,t)}else r.A.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder").error(`Trying to add null Uniform from ${(new Error).stack}.`)}generateSource(){return Array.from(this._entries.values()).map((t=>null!=t.arraySize?`uniform ${t.type} ${t.name}[${t.arraySize}];`:`uniform ${t.type} ${t.name};`))}get entries(){return Array.from(this._entries.values())}}class d{constructor(){this._entries=new Array}add(t){this._entries.push(t)}generateSource(){return this._entries}}class f extends c{constructor(){super(...arguments),this.uniforms=new h,this.code=new d,this.constants=new g}get builder(){return this}}class _{constructor(){this._entries=new Array}add(t,e){this._entries.push([t,e])}generateSource(t){return"fragment"===t?[]:this._entries.map((t=>`in ${t[1]} ${t[0]};`))}}class p{constructor(){this._entries=new Map}add(t,e){this._entries.has(t)&&(0,l.vA)(this._entries.get(t)===e),this._entries.set(t,e)}generateSource(t){const e=new Array;return this._entries.forEach(((i,n)=>e.push("vertex"===t?`out ${i} ${n};`:`in ${i} ${n};`))),e}}class m{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){const e="vertex"===t?m.ALLOWLIST_VERTEX:m.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter((t=>e.includes(t))).map((t=>`#extension ${t} : enable`))}}m.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],m.ALLOWLIST_VERTEX=[];class g{constructor(){this._entries=new Set}add(t,e,i){let n="ERROR_CONSTRUCTOR_STRING";switch(e){case"float":n=g._numberToFloatStr(i);break;case"int":n=g._numberToIntStr(i);break;case"bool":n=i.toString();break;case"vec2":n=`vec2(${g._numberToFloatStr(i[0])},                            ${g._numberToFloatStr(i[1])})`;break;case"vec3":n=`vec3(${g._numberToFloatStr(i[0])},                            ${g._numberToFloatStr(i[1])},                            ${g._numberToFloatStr(i[2])})`;break;case"vec4":n=`vec4(${g._numberToFloatStr(i[0])},                            ${g._numberToFloatStr(i[1])},                            ${g._numberToFloatStr(i[2])},                            ${g._numberToFloatStr(i[3])})`;break;case"ivec2":n=`ivec2(${g._numberToIntStr(i[0])},                             ${g._numberToIntStr(i[1])})`;break;case"ivec3":n=`ivec3(${g._numberToIntStr(i[0])},                             ${g._numberToIntStr(i[1])},                             ${g._numberToIntStr(i[2])})`;break;case"ivec4":n=`ivec4(${g._numberToIntStr(i[0])},                             ${g._numberToIntStr(i[1])},                             ${g._numberToIntStr(i[2])},                             ${g._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":n=`${e}(${Array.prototype.map.call(i,(t=>g._numberToFloatStr(t))).join(", ")})`}return this._entries.add(`const ${e} ${t} = ${n};`),this}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}}const y="precision highp float;\nprecision highp sampler2D;";var v=i(70931);function x(t,e,i){const n=e.split("\n");for(const e of n)if(e.trim().length){{let e="";null!=i&&(e+=`/*id:${i??"000"}*/   `),t.body+=e.padEnd(14)}t.body+=" ".repeat(t.indent)+e+"\n"}}class b{write(t){for(const e of t.rootOutputNodes())t.shouldPruneOutputNode(e)||(e.variableName=this._write(t,e.node));return t}_createVarName(t,e){let i="";return"boolean"!=typeof e&&"number"!=typeof e&&e.debugInfo.name&&(i=`${e.debugInfo.name}_`),`${i}v${t.varCount++}`}_write(t,e,i=!1){if("number"==typeof e)return e.toString();if("boolean"==typeof e)return e.toString();let n=t.getEmit(e);if(n)return n;switch(e.shaderType){case"scope-node":n=this._writeScopeNode(t,e);break;case"primitive-node":n=this._writePrimitiveNode(t,e,i);break;case"function-node":n=this._writeFunctionNode(t,e);break;case"property-access-node":n=this._writePropertyAccessNode(t,e);break;case"text-node":n=e.text;break;case"block-node":n=this._writeBlockNode(t,e);break;case"condition-node":n=this._writeConditionNode(t,e)}return t.setEmit(e,n),n}_writeScopeNode(t,e){const i=new e.child.constructor;i.setDebugName(e.debugInfo.name);const n=this._write(t,i,!0);return x(t,`{ /*ScopeStart: ${e.uid} ${e.debugInfo.name}*/`),t.indent+=2,x(t,`${n} = ${this._write(t,e.child)};`),t.indent-=2,x(t,`} /*ScopeEnd: ${e.uid} ${e.debugInfo.name}*/`),n}_writeConditionNode(t,e){const i=new e.ifTrue.constructor,n=this._write(t,i,!0);x(t,`if (${this._write(t,e.condition)}) {`),t.indent+=2;const r=t.createSubgraphContext(),s=this._write(r,e.ifTrue);if(t.body+=r.body,s&&x(t,`${n} = ${s};`),t.indent-=2,x(t,"}"),e.ifFalse){x(t,"else {"),t.indent+=2;const i=t.createSubgraphContext(),r=this._write(i,e.ifFalse);t.body+=i.body,r&&x(t,`${n} = ${r};`),t.indent-=2,x(t,"}")}return n}_writeBlockNode(t,e){const{captureList:i,generator:n,returnType:r}=e,s={};for(const e in i){if(!i[e])continue;const n=this._write(t,i[e]);s[e]=n}const o=new r,a=this._write(t,o,!0);if(s.out=a,e.subgraph){const i=t.createSubgraphContext(),n=this._write(i,e.subgraph.child),r=i.body;s.subgraph={varName:n,body:r}}const l=n(s);return x(t,"{\n"),t.indent+=2,x(t,l),t.indent-=2,x(t,"}\n"),a}_writePropertyAccessNode(t,e){const i=this._write(t,e.target);return"string"==typeof e.property&&e.property.includes("[")?`${i}${e.property}`:"string"!=typeof e.property?`${i}[${this._write(t,e.property)}]`:`${i}.${e.property}`}_writeFunctionNode(t,e){const i=e.returnType.type;if(e.isInfix){const[n,r]=e.children.map((e=>this._write(t,e))),s=this._createVarName(t,e);return x(t,`${i.padEnd(5)} ${s} = ${n} ${e.token} ${r};`,e.uid),s}const n=e.children.map((e=>this._write(t,e))).join(", "),r=this._createVarName(t,e);return x(t,`${i.padEnd(5)} ${r} = ${e.token}(${n});`,e.uid),r}_writePrimitiveNode(t,e,i=!1){const n=t.getInput(e);if(n)return n.isUsed=!0,n.variableName;const r=1===e.children.length&&e.children[0]?.type===e.type;if(e.isImplicit||r)return this._write(t,e.children[0]);const s=this._createVarName(t,e);if(i)return x(t,`${e.type.padEnd(5)} ${s};`,e.uid),s;const o=!e.debugInfo.name&&!e.isMutable;if(o&&"float"===e.type&&"number"==typeof e.children[0])return Number.isInteger(e.children[0])?e.children[0].toFixed(1):e.children[0].toString();if(o&&"int"===e.type&&"number"==typeof e.children[0]&&Number.isInteger(e.children[0]))return e.children[0].toString();const a=e.children.map((e=>this._write(t,e))).join(", ");return"array"===e.type?(x(t,`${e.type.padEnd(5)} ${s} = [${a}];`,e.uid),s):o?`${e.type}(${a})`:(x(t,`${e.type.padEnd(5)} ${s} = ${e.type}(${a});`,e.uid),s)}}var S=i(44784);class w{constructor(t,e,i){this.variableName=t,this.variableInputType=e,this.node=i,this.type="shader-input",this.isUsed=!1}clone(){return new w(this.variableName,this.variableInputType,(0,S.vA)(this.node))}}class T{constructor(t,e,i){this.outVariableName=t,this.outVariableType=e,this.node=i,this.type="shader-output"}clone(){const t=new T(this.outVariableName,this.outVariableType,(0,S.vA)(this.node));return t.variableName=this.variableName,t}}class M{static createVertex(t,e,i,n,r,s){const o=[];for(const e in t){const n=t[e],r=i.get(e);r?o.push(new w(r,"builtin",n)):o.push(new w("a_"+e,"attribute",n))}for(const t of n){const e=t.uniformHydrated;o.push(new w(t.uniformName,"uniform",e))}const a=[];for(const t in e){const i=e[t];"glPosition"===t?a.push(new T("gl_Position","builtin",i)):"glPointSize"===t?a.push(new T("gl_PointSize","builtin",i)):a.push(new T("v_"+t,"varying",i))}return new M(o,a,r,s)}static createFragment(t,e,i,n,r,s){const o=[],a=Array.from(r.rootOutputNodes());for(const e in t){const n=t[e],r=i.get(e);if(r){o.push(new w(r,"builtin",n));continue}const s=a.find((t=>t.node===n));s&&o.push(new w(s.outVariableName,s.outVariableType,n))}for(const t of n){const e=t.uniformHydrated;o.push(new w(t.uniformName,"uniform",e))}const l=[];for(const t in e){const n=e[t],r=i.get(t);if("discard"===t)l.push(new T(null,"discard",n));else{if(!r)throw new Error(`Member ${t} in shader fragment output shoule be tagged as builtin`);l.push(new T(r,"builtin",n))}}return new M(o,l,s)}constructor(t,e,i,n){this.type="shader-graph-context",this.indent=0,this.body="",this.varCount=0,this._inputShaderTypesByNodeUid=new Map,this._nodeEmitMap=new Map;for(const e of t)this._inputShaderTypesByNodeUid.set(e.node.uid,e);this._outputShaderTypes=e,this._transformFeedbackBindings=i,this._transformFeedbackNames=new Set(i.map((t=>"v_"+t.propertyKey))),this._usedInFragmentShader=n}shouldPruneOutputNode(t){return!!this._usedInFragmentShader&&"builtin"!==t.outVariableType&&!this._transformFeedbackNames.has(t.outVariableName)&&!this._usedInFragmentShader.has(t.node.uid)}setEmit(t,e){this._nodeEmitMap.set(t.uid,e)}getEmit(t){return this._nodeEmitMap.get(t.uid)}inputs(){return this._inputShaderTypesByNodeUid.values()}getInput(t){return this._inputShaderTypesByNodeUid.get(t.uid)}*rootOutputNodes(){for(const t of this._outputShaderTypes)yield t}*nodes(){const t=[];for(const e of this._outputShaderTypes.values())t.push(e.node);for(;t.length;){const e=t.pop();"number"!=typeof e&&"boolean"!=typeof e&&t.push(...e.children.filter(Boolean)),yield e}}*nodesOfTypeOrFunction(){for(const t of this.nodes())"number"!=typeof t&&"boolean"!=typeof t&&(yield t)}createSubgraphContext(){const t=this.clone();return t.body="",t.indent=this.indent+2,t._nodeEmitMap=new Map(this._nodeEmitMap),t}clone(){const t=new M([],this._outputShaderTypes,this._transformFeedbackBindings,this._usedInFragmentShader);return t._inputShaderTypesByNodeUid=this._inputShaderTypesByNodeUid,t.indent=this.indent,t.body=this.body,t.varCount=this.varCount,t._nodeEmitMap=this._nodeEmitMap,t}insertVertexShader(t){t.vertex.code.add(""),this._insertInputs(t,"vertex"),t.vertex.code.add(""),t.vertex.code.add("// OUTPUTS: "),t.vertex.code.add("// --------------------------------------------------------- ");for(const e of this.rootOutputNodes()){const i="builtin"===e.outVariableType;this.shouldPruneOutputNode(e)||(i?t.vertex.code.add(`// ${e.outVariableType.padEnd(7)} ${e.node.type.padEnd(9)} ${e.outVariableName};`):t.vertex.code.add(`${e.outVariableType.padEnd(10)} ${e.node.type.padEnd(9)} ${e.outVariableName};`))}t.vertex.code.add(""),t.vertex.code.add("void main() {"),t.vertex.code.add("  "+this.body.split("\n").join("\n  "));for(const e of this.rootOutputNodes())this.shouldPruneOutputNode(e)||t.vertex.code.add(`  ${e.outVariableName} = ${e.variableName};`);t.vertex.code.add("}")}insertFragmentShader(t){this._insertInputs(t,"fragment"),t.fragment.code.add(""),t.fragment.code.add("void main() {"),t.fragment.code.add("  "+this.body.split("\n").join("\n  "));for(const e of this.rootOutputNodes())"discard"===e.outVariableType?(t.fragment.code.add("  // TODO: Should ensure codegen for discard appears first in fragment shader"),t.fragment.code.add(`  if (${e.variableName}) {`),t.fragment.code.add("    discard;"),t.fragment.code.add("  }"),t.fragment.code.add("  ")):t.fragment.code.add(`  ${e.outVariableName} = ${e.variableName};`);t.fragment.code.add("}")}_insertInputs(t,e){t[e].code.add("// INPUTS: "),t[e].code.add("// --------------------------------------------------------- ");for(const i of this.inputs())i.isUsed&&"builtin"!==i.variableInputType&&("array"===i.node.type?t[e].code.add(`${i.variableInputType.padEnd(10)} ${i.node.elementType.type.padEnd(9)} ${i.variableName}[${i.node.size}];`):t[e].code.add(`${i.variableInputType.padEnd(10)} ${i.node.type.padEnd(9)} ${i.variableName};`))}}var P=i(22516);function E(t){return new t}function A(t,e,i){const n=t.constructor[e]??[];t.constructor.hasOwnProperty(e)||Object.defineProperty(t.constructor,e,{value:n.slice()}),t.constructor[e].push(i)}function C(t,e){return(i,n)=>{A(i,"locations",{typeCtor:e,propertyKey:n,parameterIndex:null,index:t})}}const I=t=>(e,i,n)=>{A(e,"inputs",{inputCtor:t,propertyKey:i,parameterIndex:n})},R=t=>(e,i)=>{A(e,"uniforms",{typeCtor:t,propertyKey:i})},O=t=>(e,i)=>{A(e,"options",{typeCtor:t,propertyKey:i})},F=(t,e)=>{A(t,"defines",{propertyKey:e})},z=(t,e)=>(i,n)=>{i.constructor.builtins.push({builtin:t,propertyKey:n,typeCtor:e})};class D{}D.builtins=[],(0,n._)([z("gl_VertexID",v.Ai)],D.prototype,"glVertexID",void 0);class L{}class N{}N.builtins=[],(0,n._)([z("gl_FragCoord",v.Zb)],N.prototype,"glFragCoord",void 0),(0,n._)([z("gl_PointCoord",v.ZY)],N.prototype,"glPointCoord",void 0);class B{}(0,n._)([(t,e)=>{A(t,"builtins",{builtin:"gl_FragColor",propertyKey:e})}],B.prototype,"glFragColor",void 0);class k{constructor(){this.type="uniform-group"}get _uniforms(){return this.constructor.uniforms??[]}}class V{constructor(){this.logShader=!1,this.computeAttributes={}}get vertexInput(){const t=this._shaderModuleClass.inputs.findLast((t=>"vertex"===t.propertyKey&&0===t.parameterIndex));if(!t)throw new Error("Unable to find vertex input parameter");return t}get computeInput(){return this._shaderModuleClass.inputs.findLast((t=>"vertex"===t.propertyKey&&1===t.parameterIndex))}get fragmentInput(){const t=this._shaderModuleClass.inputs.findLast((t=>"fragment"===t.propertyKey));if(!t)throw new Error("Unable to find fragment input parameter");return t}get transformFeedbackBindings(){return this.fragmentInput.inputCtor.transformFeedbackBindings??[]}get locations(){return[...this.vertexInput.inputCtor.locations,...this.computeInput?.inputCtor.locations??[]]}get locationsMap(){const t=new Map,e=new Set;for(const i of this.locations)e.has(i.index)?r.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.GraphShaderModule").warnOnce("mapview-rendering",`Unable to assigned attribute ${i.propertyKey} to ${i.index}. Index already in use`,{locationsMap:t}):(t.set(i.propertyKey,i.index),e.add(i.index));return t}get locationInfo(){if(!this._locationInfo){const t=this.locationsMap,e=Array.from(t.entries()).map((([t,e])=>`${t}.${e}`)).join("."),i=(0,s.Wm)(e),n=this.computeAttributes;this._locationInfo={hash:i,locations:t,computeAttributeMap:n}}return this._locationInfo}get renamedLocationsMap(){const t=new Map;for(const e of this.locations)t.set("a_"+e.propertyKey,e.index);return t}get optionPropertyKeys(){if(!this._optionPropertyKeys){const t=new Set;for(const e of this._options)t.add(e.propertyKey);this._optionPropertyKeys=t}return this._optionPropertyKeys}get _shaderModuleClass(){return this.constructor}get _defines(){return this._shaderModuleClass.defines??[]}get _options(){return this._shaderModuleClass.options??[]}get _uniforms(){return this._shaderModuleClass.uniforms??[]}getProgram(t,e,i,n){try{const{vertex:r,fragment:s,uniformBindings:o}=this._generateShaders(t,e,i,n);return new P.K(r,s,this.renamedLocationsMap,this.locationInfo,o,this.transformFeedbackBindings)}catch(t){return new P.K("","",this.renamedLocationsMap,this.locationInfo,[],this.transformFeedbackBindings)}}getDebugUniformClassInfo(t){const e=this._options.find((e=>e.propertyKey===t));if(e)return{type:"option",className:e.typeCtor};const i=this._uniforms.find((e=>e.propertyKey===t));if(!i)throw new Error(`Unable to find uniform class type for property: ${t}`);return{type:"required",className:i.typeCtor}}getShaderKey(t,e,i,n){const r=Object.keys(t).map((e=>`${e}.${t[e]}`)).join("."),s=Object.keys(i).map((t=>`${t}.${i[t]}`)).join("."),o=Object.keys(n).map((t=>`${t}.${n[t]}`)).join("."),a=Object.keys(e).filter((t=>this.optionPropertyKeys.has(t)&&e[t])).join(".");return`${this.constructor.name}.${r}.${s}.${o}.${a}`}_generateShaders(t,e,i,n){const r=[];this._setDefines(i),this._setOptionalUniforms(r,e),this._setRequiredUniforms(r);const s=this._hydrateVertexInput(n),o=this._injectPackPrecisionFactor(s,t),a=this._hydrateComputeInput(),l=a&&this._injectComputePackPrecisionFactor(a,t),c=this.vertex(o,l),u=this._hydrateFragmentInput(c),h=this.fragment(u),d=new Set;for(const t in h){const e=h[t];(0,S.rz)(d,e)}const f=this._getVertexInputBuiltins(),_=M.createVertex({...s,...a},c,f,r,this.transformFeedbackBindings,d);(new b).write(_);const p=this._getFragmentInputBuiltins(h);p.set("glPointCoord","gl_PointCoord");const m=M.createFragment(u,h,p,r,_,this.transformFeedbackBindings);(new b).write(m);const g=this._createShaderBuilder(_,m),y=g.generate("vertex",!1),v=g.generate("fragment",!1);return this.logShader&&(console.log(y),console.log(v)),{vertex:y,fragment:v,uniformBindings:r}}_setDefines(t){for(const e in t)this[e]=t[e]}_setOptionalUniforms(t,e){for(const i of this._options)e[i.propertyKey]?this[i.propertyKey]=this._hydrateUniformGroup(t,i):this[i.propertyKey]=null}_setRequiredUniforms(t){for(const e of this._uniforms)this[e.propertyKey]=this._hydrateUniformGroup(t,e)}_hydrateUniformGroup(t,e){const i=new(0,e.typeCtor);for(const n of i._uniforms??[]){const r=E(n.typeCtor),s=`u_${e.propertyKey}_${n.propertyKey}`,o=r.type,a=[e.propertyKey,n.propertyKey].join(".");if("type"in n.typeCtor&&"array"===n.typeCtor.type){const e=r;t.push({shaderModulePath:a,uniformName:s,uniformType:o,uniformArrayLength:e.size,uniformArrayElementType:e.elementType.type,uniformHydrated:r})}else t.push({shaderModulePath:a,uniformName:s,uniformType:o,uniformHydrated:r});i[n.propertyKey]=r}return i}_hydrateVertexInput(t){const e=this.vertexInput.inputCtor,i=e.locations.reduce(((e,i)=>!1===t[i.propertyKey]?e:{...e,[i.propertyKey]:E(i.typeCtor)}),{});for(const{propertyKey:t,typeCtor:n}of e.builtins){const e=E(n);i[t]=e}return i}_hydrateComputeInput(){return null==this.computeInput?null:this.computeInput.inputCtor.locations.reduce(((t,e)=>({...t,[e.propertyKey]:E(e.typeCtor)})),{})}_injectPackPrecisionFactor(t,e){const i={};for(const n in t){const r=t[n],s=e[n];if(s){if("float"!==r.type&&"vec2"!==r.type&&"vec3"!==r.type&&"vec4"!==r.type)throw new Error(`InternalError: packPrecisionFactor requires GenType, but found ${r.type}`);i[n]=r.divide(new v.nt(s))}else i[n]=r}return i}_injectComputePackPrecisionFactor(t,e){const i={},n=new Map;for(const t in this.computeAttributes)for(const e of this.computeAttributes[t]??[])n.set(e,t);for(const r in t){const s=t[r],o=n.get(r);if(!o)continue;const a=e[o];if(a){if("float"!==s.type&&"vec2"!==s.type&&"vec3"!==s.type&&"vec4"!==s.type)throw new Error(`InternalError: packPrecisionFactor requires GenType, but found ${s.type}`);i[r]=s.divide(new v.nt(a))}else i[r]=s}return i}_hydrateFragmentInput(t){const e={};for(const i in t)e[i]=t[i];for(const{propertyKey:t,typeCtor:i}of N.builtins){const n=E(i);e[t]=n}return e}_getVertexInputBuiltins(){const t=this.vertexInput.inputCtor,e=new Map;for(const{builtin:i,propertyKey:n}of t.builtins)e.set(n,i);return e}_getFragmentInputBuiltins(t){const e=t.constructor,i=new Map;for(const t of e.builtins??[])i.set(t.propertyKey,t.builtin);return i}_createShaderBuilder(t,e){const i=new u;return this._insertDebugInfo(i),t.insertVertexShader(i),e.insertFragmentShader(i),i}_insertDebugInfo(t){t.vertex.code.add("// DEFINES: "),t.vertex.code.add("// --------------------------------------------------------- ");for(const e of this._defines)this[e.propertyKey]?t.vertex.code.add(`//   ${e.propertyKey}: true`):t.vertex.code.add(`//   ${e.propertyKey}: false`);t.vertex.code.add(""),t.vertex.code.add("// OPTIONS: "),t.vertex.code.add("// --------------------------------------------------------- ");for(const e of this._options)this[e.propertyKey]?t.vertex.code.add(`//   ${e.propertyKey}: true`):t.vertex.code.add(`//   ${e.propertyKey}: false`)}}},44784:function(t,e,i){function n(t,e){const i=[];for(i.push(e);i.length;){const e=i.pop();if("object"==typeof e&&!t.has(e.uid)){t.add(e.uid);for(const t of e.children)i.push(t)}}}i.d(e,{XL:function(){return c},aw:function(){return h},rR:function(){return u},rz:function(){return n},vA:function(){return s},vL:function(){return o},zg:function(){return l}});class r{constructor(){this.uid=r.NodeCount++,this._debugName=null,this._isMutable=!1,this.isImplicit=!1}get isMutable(){return this._isMutable}setMutable(){return this._isMutable=!0,this}setDebugName(t){return t=t.split(" ").map(((t,e)=>e>0?t.charAt(0).toUpperCase()+t.slice(1):t)).join(""),this._debugName=t,this.isImplicit&&this.children[0]instanceof r&&this.children[0].setDebugName(t),this}get debugInfo(){return{name:this._debugName??""}}cloneInto(t){t._debugName=this._debugName,t._isMutable=this._isMutable,t.isImplicit=this.isImplicit,t.uid=this.uid}}function s(t){return"object"==typeof t?t.clone():t}r.NodeCount=0;class o extends r{constructor(){super(...arguments),this.shaderType="primitive-node"}}class a extends r{constructor(t){super(),this.child=t,this.shaderType="scope-node"}get children(){return[this.child]}clone(){const t=new a(s(this.child));return this.cloneInto(t),t}}class l extends r{constructor(t,e,i){super(),this.property=t,this.target=e,this.returnType=i,this.shaderType="property-access-node"}get children(){const t=[this.target];return"string"!=typeof this.property&&t.push(this.property),t}clone(){const t=new l(this.property,s(this.target),this.returnType);return this.cloneInto(t),t}}class c extends r{constructor(t,e,i){super(),this.condition=t,this.ifTrue=e,this.ifFalse=i,this.shaderType="condition-node"}get children(){return[this.condition,this.ifTrue,this.ifFalse]}clone(){const t=s(this.ifTrue),e=this.ifFalse?s(this.ifFalse):null,i=new c(this.condition,t,e);return this.cloneInto(i),i}}class u extends r{constructor(t,e,i,n){super(),this.captureList=t,this.returnType=e,this.generator=n,this.shaderType="block-node",i&&(this.subgraph=new a(i))}get children(){return Object.keys(this.captureList).map((t=>this.captureList[t])).concat(this.subgraph??[])}clone(){const t={};for(const e in this.captureList)t[e]=s(this.captureList[e]);const e=new u(t,this.returnType,this.subgraph?s(this.subgraph.child):this.subgraph,this.generator);return this.cloneInto(e),e}}class h extends r{constructor(t,e,i,n,r,s=!1){super(),this.token=t,this._children=e,this.isInfix=i,this.isPropertyAccess=n,this.returnType=r,this.isTernary=s,this.shaderType="function-node"}get children(){return this._children}clone(){const t=new h(this.token,this._children.map(s),this.isInfix,this.isPropertyAccess,this.returnType,this.isTernary);return this.cloneInto(t),t}}},70931:function(t,e,i){i.d(e,{$5:function(){return _t},$I:function(){return H},AU:function(){return Dt},Ai:function(){return N},Bw:function(){return Ct},F8:function(){return Lt},Io:function(){return Mt},LC:function(){return dt},MM:function(){return pt},My:function(){return S},Om:function(){return Pt},PM:function(){return Bt},RI:function(){return Et},S8:function(){return zt},Sj:function(){return ut},T9:function(){return It},TF:function(){return Nt},Tk:function(){return rt},U:function(){return G},US:function(){return kt},Uo:function(){return yt},Wh:function(){return W},Xe:function(){return ft},ZY:function(){return M},Zb:function(){return E},Zc:function(){return q},aX:function(){return mt},eB:function(){return P},eR:function(){return X},fV:function(){return Z},gn:function(){return Tt},j1:function(){return st},jc:function(){return At},jh:function(){return Ot},jk:function(){return Rt},ln:function(){return $},mk:function(){return St},nf:function(){return ht},nt:function(){return T},or:function(){return gt},qE:function(){return wt},tn:function(){return vt},w0:function(){return j},x:function(){return O},z7:function(){return w},ze:function(){return it},zi:function(){return Ft}});var n,r,s,o,a,l,c,u,h,d,f,_,p,m,g=i(53804),y=i(44784);function v(t){return new Proxy(t,{get(e,i){if("constructor"===i)return new Proxy(e.constructor,{construct:(t,e,i)=>v(new t(...e))});if(i in e)return e[i];if("string"==typeof i){const e=function(t){const e=[["float","vec2","vec3","vec4"],["int","ivec2","ivec3","ivec4"],["uint","uvec2","uvec3","uvec4"],["bool","bvec2","bvec3","bvec4"]];for(const i of e)if(i.includes(t))return i.map((t=>Y[t]));throw new Error("Unable to find type family")}(t.type);return K(t,i,e[i.length-1])}}})}function x(t){return new Proxy(t,{construct:(t,e,i)=>v(new t(...e))})}class b extends Error{}let S=n=class extends y.vL{constructor(t,e){super(),this.elementType=t,this.size=e,this.children=[],this.type="array"}clone(){const t=new n(this.elementType,this.size);return super.cloneInto(t),t}get(t){if("number"==typeof t){const e=new N(t);return e.isImplicit=!0,K(this,e,this.elementType.constructor)}return K(this,t,this.elementType.constructor)}last(){return this.get(this.size-1)}first(){return this.get(0)}findIndex(t,e,i){return function(t,e,i=0,n=t.size){const r=new N(i).setMutable().setDebugName("FindIndexIterator"),s=e(t.get(r)).setDebugName("FindIndexPredicate"),o=nt({iter:r},N,s,(({out:t,iter:e,subgraph:i})=>`\n${t} = -1;\n\nfor (; ${e} < ${n}; ${e}++) {\n\n${i.body}\n\n  if (${i.varName}) {\n    ${t} = ${e};\n    break;\n  }\n\n}\n`)).setDebugName("FindIndexBlock");return o}(this,t,e,i)}glslFindIndex(t,e,i){return function(t,e,i=0,n=t.size){const r=nt({array:t},N,null,(({out:t,array:r})=>`\n${t} = -1;\nfor (int i = ${i}; i < ${n}; i++) {\n  bool condition;\n  ${e({array:r,i:"i",out:"condition"})}\n  if (condition) {\n    ${t} = i;\n    break;\n  }\n}\n`)).setDebugName("GlslFindIndexBlock");return r}(this,t,e,i)}static ofType(t,e){const i={construct:(i,r)=>new n(new t,e)};return new Proxy(n,i)}};S.type="array",S=n=(0,g._)([function(t){return new Proxy(t,{construct:(t,e,i)=>function(t){return new Proxy(t,{get(e,i){if(i in e)return e[i];if("string"==typeof i){const e=parseInt(i,10);if(!isNaN(e))return K(t,`[${e}]`,t.elementType.constructor)}}})}(new t(...e))})}],S);class w extends y.vL{constructor(){super(...arguments),this.type="sampler2D",this.children=[]}clone(){const t=new w;return t.children=this.children.map(y.vA),super.cloneInto(t),t}}w.type="sampler2D";class T extends y.vL{constructor(t){super(),this.type="float",this.children=[t]}clone(){const t=new T((0,y.vA)(this.children[0]));return super.cloneInto(t),t}multiply(t){return ot(this,"number"==typeof t?D(t,T):t)}divide(t){return at(this,"number"==typeof t?D(t,T):t)}add(t){return lt(this,"number"==typeof t?D(t,T):t)}subtract(t){return ct(this,"number"==typeof t?D(t,T):t)}}T.type="float";let M=r=class extends y.vL{constructor(t,e){super(),this.type="vec2",this.children=[t,e].filter((t=>null!=t))}clone(){const t=new r((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]));return super.cloneInto(t),t}get 0(){return K(this,"[0]",T)}get 1(){return K(this,"[1]",T)}get 2(){throw new b}get 3(){throw new b}multiply(t){return ot(this,"number"==typeof t?D(t,T):t)}divide(t){return at(this,"number"==typeof t?D(t,T):t)}add(t){return lt(this,"number"==typeof t?D(t,T):t)}subtract(t){return ct(this,"number"==typeof t?D(t,T):t)}};M.type="vec2",M=r=(0,g._)([x],M);let P=s=class extends y.vL{constructor(t,e,i){super(),this.type="vec3",this.children=[t,e,i].filter((t=>null!=t))}get 0(){return K(this,"[0]",T)}get 1(){return K(this,"[1]",T)}get 2(){return K(this,"[2]",T)}get 3(){throw new b}clone(){const t=new s((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]));return super.cloneInto(t),t}multiply(t){return ot(this,"number"==typeof t?D(t,T):t)}divide(t){return at(this,"number"==typeof t?D(t,T):t)}add(t){return lt(this,"number"==typeof t?D(t,T):t)}subtract(t){return ct(this,"number"==typeof t?D(t,T):t)}};P.type="vec3",P=s=(0,g._)([x],P);let E=o=class extends y.vL{constructor(t,e,i,n){super(),this.type="vec4",this.children=[t,e,i,n].filter((t=>null!=t))}clone(){const t=new o((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(t),t}get 0(){return K(this,"[0]",T)}get 1(){return K(this,"[1]",T)}get 2(){return K(this,"[2]",T)}get 3(){return K(this,"[3]",T)}multiply(t){return ot(this,"number"==typeof t?D(t,T):t)}divide(t){return at(this,"number"==typeof t?D(t,T):t)}add(t){return lt(this,"number"==typeof t?D(t,T):t)}subtract(t){return ct(this,"number"==typeof t?D(t,T):t)}};E.type="vec4",E=o=(0,g._)([x],E);let A=a=class extends y.vL{constructor(t){super(),this.type="uint",this.children=[t]}clone(){const t=new a((0,y.vA)(this.children[0]));return super.cloneInto(t),t}};A.type="uint",A=a=(0,g._)([x],A);let C=l=class extends y.vL{constructor(t,e){super(),this.type="uvec2",this.children=[t,e].filter((t=>null!=t))}clone(){const t=new l((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]));return super.cloneInto(t),t}};C.type="uvec2",C=l=(0,g._)([x],C);let I=c=class extends y.vL{constructor(t,e,i){super(),this.type="uvec3",this.children=[t,e,i].filter((t=>null!=t))}clone(){const t=new c((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]));return super.cloneInto(t),t}};I.type="uvec3",I=c=(0,g._)([x],I);let R=u=class extends y.vL{constructor(t,e,i,n){super(),this.type="uvec4",this.children=[t,e,i,n].filter((t=>null!=t))}clone(){const t=new u((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(t),t}};R.type="uvec4",R=u=(0,g._)([x],R);class O extends y.vL{constructor(t){super(),this.type="bool",this.children=[t]}and(t){return yt(this,t)}or(t){return gt(this,t)}clone(){const t=new O((0,y.vA)(this.children[0]));return super.cloneInto(t),t}}O.type="bool";let F=h=class extends y.vL{constructor(t,e){super(),this.type="bvec2",this.children=[t,e].filter((t=>null!=t))}all(){return xt(this)}any(){return bt(this)}clone(){const t=new h((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]));return super.cloneInto(t),t}};F.type="bvec2",F=h=(0,g._)([x],F);let z=d=class extends y.vL{constructor(t,e,i){super(),this.type="bvec3",this.children=[t,e,i].filter((t=>null!=t))}all(){return xt(this)}any(){return bt(this)}clone(){const t=new d((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]));return super.cloneInto(t),t}};function D(t,e){return"number"==typeof t?new e(t):t}z.type="bvec3",z=d=(0,g._)([x],z);let L=f=class extends y.vL{constructor(t,e,i,n){super(),this.type="bvec4",this.children=[t,e,i,n].filter((t=>null!=t))}all(){return xt(this)}any(){return bt(this)}clone(){const t=new f((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(t),t}};L.type="bvec4",L=f=(0,g._)([x],L);class N extends y.vL{constructor(t){super(),this.type="int",this.children=[t]}multiply(t){return ot(this,D(t,N))}add(t){return lt(this,D(t,N))}subtract(t){return ct(this,D(t,N))}divide(t){return at(this,D(t,N))}clone(){const t=new N((0,y.vA)(this.children[0]));return super.cloneInto(t),t}}N.type="int";let B=_=class extends y.vL{constructor(t,e){super(),this.type="ivec2",this.children=[t,e].filter((t=>null!=t))}clone(){const t=new _((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]));return super.cloneInto(t),t}};B.type="ivec2",B=_=(0,g._)([x],B);let k=p=class extends y.vL{constructor(t,e,i){super(),this.type="ivec3",this.children=[t,e,i].filter((t=>null!=t))}clone(){const t=new p((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]));return super.cloneInto(t),t}};k.type="ivec3",k=p=(0,g._)([x],k);let V=m=class extends y.vL{constructor(t,e,i,n){super(),this.type="ivec4",this.children=[t,e,i,n].filter((t=>null!=t))}clone(){const t=new m((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(t),t}};V.type="ivec4",V=m=(0,g._)([x],V);class U extends y.vL{constructor(t,e,i,n){super(),this.type="mat2",this.children=[t,e,i,n]}clone(){const t=new U((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(t),t}}U.type="mat2";class G extends y.vL{static identity(){return new G(1,0,0,0,1,0,0,0,1)}static fromRotation(t){const e=Lt(t),i=Tt(t);return new G(i,e,0,it(e),i,0,0,0,1)}constructor(t,e,i,n,r,s,o,a,l){super(),this.type="mat3",this.children=[t,e,i,n,r,s,o,a,l]}add(t){return lt(this,t)}multiply(t){return ot(this,t)}clone(){const t=new G((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]),(0,y.vA)(this.children[4]),(0,y.vA)(this.children[5]),(0,y.vA)(this.children[6]),(0,y.vA)(this.children[7]),(0,y.vA)(this.children[8]));return super.cloneInto(t),t}}G.type="mat3";class H extends y.vL{static identity(){return new H(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}constructor(t,e,i,n,r,s,o,a,l,c,u,h,d,f,_,p){super(),this.type="mat4",this.children=[t,e,i,n,r,s,o,a,l,c,u,h,d,f,_,p]}static fromColumns(t,e,i,n){return new H(t.x,t.y,t.z,t.w,e.x,e.y,e.z,e.w,i.x,i.y,i.z,i.w,n.x,n.y,n.z,n.w)}multiply(t){return ot(this,t)}clone(){const t=new H((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]),(0,y.vA)(this.children[4]),(0,y.vA)(this.children[5]),(0,y.vA)(this.children[6]),(0,y.vA)(this.children[7]),(0,y.vA)(this.children[8]),(0,y.vA)(this.children[9]),(0,y.vA)(this.children[10]),(0,y.vA)(this.children[11]),(0,y.vA)(this.children[12]),(0,y.vA)(this.children[13]),(0,y.vA)(this.children[14]),(0,y.vA)(this.children[15]));return super.cloneInto(t),t}}H.type="mat4";const Y={float:T,vec2:M,vec3:P,vec4:E,int:N,ivec2:B,ivec3:k,ivec4:V,uint:A,uvec2:C,uvec3:I,uvec4:R,bool:O,bvec2:F,bvec3:z,bvec4:L},W=(...t)=>new N(...t),Z=(...t)=>new T(...t),q=(...t)=>new M(...t),X=(...t)=>new P(...t),$=(...t)=>new E(...t),j=(...t)=>new G(...t);function K(t,e,i){const n=new i(new y.zg(e,t,i));return n.isImplicit=!0,n}function Q(t,e,i,n=null){if(n){const r=new n,s=new n(new y.aw(t,[e,i],!0,!1,r));return s.isImplicit=!0,s}if("float"===e.type||"int"===e.type){const n=new i.constructor(new y.aw(t,[e,i],!0,!1,i.constructor));return n.isImplicit=!0,n}if(("mat2"===e.type||"mat3"===e.type||"mat4"===e.type)&&"float"!==i.type){const n=new i.constructor(new y.aw(t,[e,i],!0,!1,i.constructor));return n.isImplicit=!0,n}const r=new e.constructor(new y.aw(t,[e,i],!0,!1,e.constructor));return r.isImplicit=!0,r}function J(t,e,i=e.constructor){const n=new i(new y.aw(t,[e],!1,!1,i));return n.isImplicit=!0,n}function tt(t,e,i,n=e.constructor){const r=new n(new y.aw(t,[e,i],!1,!1,n));return r.isImplicit=!0,r}function et(t,e,i,n,r=e.constructor){const s=new r(new y.aw(t,[e,i,n],!1,!1,r));return s.isImplicit=!0,s}function it(t){return ot(t,Z(-1))}function nt(t,e,i,n){return new e(new y.rR(t,e,i,n))}function rt(t,e,i){const n="function"==typeof e?e():e,r="function"==typeof i?i():i,s=new n.constructor(new y.XL(t,n,r));return s.isImplicit=!0,s}function st(...t){const e=t.map((([t,e])=>"function"==typeof e?[t,e()]:[t,e])),i=e[0][1].constructor,n=e.findIndex((t=>!0===t[0]));if(-1===n)throw new Error("A cond must have a fallthrough case with `true`/; ");const r=e.slice(0,n),s=e[n][1],o=new i(r.reduceRight(((t,e)=>rt(e[0],e[1],t)),s));return o.isImplicit=!0,o}function ot(t,e){return Q("*",t,e)}function at(t,e){return Q("/",t,e)}function lt(t,e){return Q("+",t,e)}function ct(t,e){return Q("-",t,e)}function ut(t,e){return Q(">>",t,e)}function ht(t,e){return Q("&",t,e)}function dt(t,e){return Q("==",t,e,O)}function ft(t,e){return Q("<",t,e,O)}function _t(t,e){return Q("<=",t,e,O)}function pt(t,e){return Q(">",t,e,O)}function mt(t,e){return Q(">=",t,e,O)}function gt(...t){return t.length<=1?t[0]:t.slice(1).reduce(((t,e)=>function(t,e){return Q("||",t,e,O)}(t,e)),t[0])}function yt(...t){return t.length<=1?t[0]:t.slice(1).reduce(((t,e)=>function(t,e){return Q("&&",t,e,O)}(t,e)),t[0])}function vt(t){return J("abs",t)}function xt(t){return J("all",t,O)}function bt(t){return J("any",t,O)}function St(t){return J("ceil",t)}function wt(t,e,i){return et("clamp",t,e,i,t.constructor)}function Tt(t){return J("cos",t)}function Mt(t,e){return tt("distance",t,e,T)}function Pt(t,e){return tt("dot",t,e,T)}function Et(t){return J("floor",t)}function At(t){return J("fract",t)}function Ct(t){return J("length",t,T)}function It(t,e){return tt("max",t,e)}function Rt(t,e){return tt("min",t,e)}function Ot(t,e,i){return et("mix",t,e,i)}function Ft(t,e){return tt("mod",t,e)}function zt(t){return J("normalize",t)}function Dt(t){return"bool"===t.type?J("!",t):J("not",t)}function Lt(t){return J("sin",t)}function Nt(t,e,i){return et("smoothstep",t,e,i)}function Bt(t,e){return tt("step",t,e,e.constructor)}function kt(t,e){return tt("texture2D",t,e,E)}},92543:function(t,e,i){i.d(e,{c:function(){return r}});var n=i(86329);class r{constructor(t,e,i){this._instanceId=t,this.techniqueRef=e,this._input=i}get instanceId(){return(0,n.P)(this._instanceId)}createMeshInfo(t){return{id:(0,n.P)(this._instanceId),techniqueType:this.techniqueRef.type,inputParams:t,optionalAttributes:this._input.optionalAttributes}}getInput(){return this._input}setInput(t){this._input=t}}},78119:function(t,e,i){i.d(e,{YS:function(){return Xt},n_:function(){return jt},Wn:function(){return $t}});var n=i(39686),r=i(28230);class s{constructor(){this.drawPhase=r.S5.MAP|r.S5.HITTEST|r.S5.HIGHLIGHT|r.S5.DEBUG}startup(){}shutdown(t){}}class o extends s{constructor(){super(...arguments),this.overrideStencilRef=null,this.symbologyPlane=r.uC.FILL,this.postProcessingEnabled=!1}postProcess(t,e){}}var a=i(86847),l=i(81728),c=i(53804),u=i(98282),h=i(70931),d=i(33702),f=i(64522);class _ extends u.ZA{}(0,c._)([(0,u.C5)(0,h.ZY)],_.prototype,"pos",void 0);class p extends d.DM{}class m extends u.k2{}(0,c._)([(0,u.Pi)(h.nt)],m.prototype,"dotSize",void 0);class g extends u.k2{}(0,c._)([(0,u.Pi)(h.z7)],g.prototype,"locations",void 0),(0,c._)([(0,u.Pi)(h.nt)],g.prototype,"pixelRatio",void 0),(0,c._)([(0,u.Pi)(h.nt)],g.prototype,"tileZoomFactor",void 0);class y extends u.A{vertex(t){const e=new h.U(1,0,0,0,-1,0,0,1,1).multiply(new h.eB(t.pos.xy.divide(n.CQ),1)),i=(0,h.US)(this.draw.locations,e.xy),r=(0,h.T9)(this.instance.dotSize.divide(2),new h.nt(1));let s=new h.nt(0);s=s.add((0,h.PM)(i.a,new h.nt(1e-6)).multiply(2));let o=r.add(this.instance.dotSize);const a=this.view.displayViewScreenMat3.multiply(new h.eB(t.pos.add(.5),1)),l=new h.Zb(a.xy,s,1),c=this.instance.dotSize.divide(o),u=new h.nt(-1).divide(r.divide(o));return o=o.multiply(this.draw.pixelRatio.multiply(this.draw.tileZoomFactor)),{glPosition:l,glPointSize:o,color:i,ratio:c,invEdgeRatio:u}}fragment(t){const e=(0,h.Bw)(t.glPointCoord.subtract(.5)).multiply(2),i=(0,h.TF)(new h.nt(0),new h.nt(1),t.invEdgeRatio.multiply(e.subtract(t.ratio)).add(1)),n=new u.mm;return n.glFragColor=t.color.multiply(i),n}}(0,c._)([(0,u.Pi)(m)],y.prototype,"instance",void 0),(0,c._)([(0,u.Pi)(g)],y.prototype,"draw",void 0),(0,c._)([(0,u.Pi)(f.o)],y.prototype,"view",void 0),(0,c._)([(0,c.a)(0,(0,u.hF)(_))],y.prototype,"vertex",null),(0,c._)([(0,c.a)(0,(0,u.hF)(p))],y.prototype,"fragment",null);var v=i(66425),x=i(86486);class b extends d.rz{}(0,c._)([(0,u.C5)(3,h.nt)],b.prototype,"inverseArea",void 0);class S extends u.k2{}(0,c._)([(0,u.Pi)(h.My.ofType(h.Zb,2))],S.prototype,"isActive",void 0),(0,c._)([(0,u.Pi)(h.My.ofType(h.Zb,8))],S.prototype,"colors",void 0),(0,c._)([(0,u.Pi)(h.nt)],S.prototype,"dotValue",void 0);class w extends u.k2{}(0,c._)([(0,u.Pi)(h.z7)],w.prototype,"dotTexture0",void 0),(0,c._)([(0,u.Pi)(h.z7)],w.prototype,"dotTexture1",void 0),(0,c._)([(0,u.Pi)(h.nt)],w.prototype,"tileZoomFactor",void 0),(0,c._)([(0,u.Pi)(h.nt)],w.prototype,"pixelRatio",void 0),(0,c._)([(0,u.Pi)(h.nt)],w.prototype,"tileDotsOverArea",void 0);class T extends d.f_{_dotThreshold(t,e,i){return t.divide(e).divide(i)}vertex(t){const e=new h.U(2/n.CQ,0,0,0,-2/n.CQ,0,-1,1,1).multiply(new h.eB(t.pos,1)),i=this.clip(t.id),r=new h.Zb(e.xy,i,1),s=this.storage.getVVData(t.id).multiply(this.instance.isActive.get(0)).multiply(t.inverseArea),o=this.storage.getDataDrivenData0(t.id).multiply(this.instance.isActive.get(1)).multiply(t.inverseArea),a=this.draw.tileZoomFactor.multiply(n.CQ).divide(this.draw.pixelRatio),l=this._dotThreshold(s,this.instance.dotValue,this.draw.tileDotsOverArea),c=this._dotThreshold(o,this.instance.dotValue,this.draw.tileDotsOverArea),u=t.pos.add(.5).divide(a);return{glPosition:r,color:new h.Zb(0,0,0,0),textureCoords:u,thresholds0:l,thresholds1:c}}fragment(t){const e=new u.mm,i=(0,h.US)(this.draw.dotTexture0,t.textureCoords),n=(0,h.US)(this.draw.dotTexture1,t.textureCoords),r=t.thresholds0.subtract(i),s=t.thresholds1.subtract(n);let o;const a=h.$I.fromColumns(this.instance.colors[0],this.instance.colors[1],this.instance.colors[2],this.instance.colors[3]),l=h.$I.fromColumns(this.instance.colors[4],this.instance.colors[5],this.instance.colors[6],this.instance.colors[7]);if(this.blending){const t=(0,h.PM)(new h.nt(0),r),e=(0,h.PM)(new h.nt(0),s),i=(0,h.Om)(t,r).add((0,h.Om)(e,s)),n=(0,h.PM)(i,new h.nt(0)),c=new h.nt(1).subtract(n),u=i.add(n),d=r.multiply(t).divide(u),f=s.multiply(e).divide(u),_=a.multiply(d).add(l.multiply(f));o=c.multiply(_)}else{const t=(0,h.T9)((0,x.xf)(r),(0,x.xf)(s)),e=(0,h.PM)(t,new h.nt(0)),i=new h.nt(1).subtract(e),n=(0,h.PM)(t,r),c=(0,h.PM)(t,s),u=a.multiply(n).add(l.multiply(c));o=i.multiply(u)}return e.glFragColor=o,e}hittest(t){return(0,v.My)(this.hittestRequest)}}(0,c._)([u.E8],T.prototype,"blending",void 0),(0,c._)([(0,u.Pi)(S)],T.prototype,"instance",void 0),(0,c._)([(0,u.Pi)(w)],T.prototype,"draw",void 0),(0,c._)([(0,c.a)(0,(0,u.hF)(b))],T.prototype,"vertex",null),(0,c._)([(0,c.a)(0,(0,u.hF)(d.DM))],T.prototype,"fragment",null);var M=i(13798),P=i(85456);const E={[P.pe.BYTE]:1,[P.pe.UNSIGNED_BYTE]:1,[P.pe.SHORT]:2,[P.pe.UNSIGNED_SHORT]:2,[P.pe.HALF_FLOAT]:2,[P.pe.INT]:4,[P.pe.UNSIGNED_INT]:4,[P.pe.FLOAT]:4};var A=i(86305),C=i(81438),I=i(3817);class R{constructor(t,e){this._boundPart=null;const i=[];for(const n of e.vertex){const e=A.g.createVertex(t,P._U.STATIC_DRAW,n);i.push(e)}const n=[];for(const i of e.index||[]){const e=A.g.createIndex(t,P._U.STATIC_DRAW,i);n.push(e)}this.groups=[];for(const r of e.groups){let s;if(null!=r.index){if(!e.index)throw new Error("No index data.");const{BYTES_PER_ELEMENT:t}=e.index[r.index];2===t?s=P.pe.UNSIGNED_SHORT:4===t&&(s=P.pe.UNSIGNED_INT)}const o=null!=r.index?n[r.index]:null,a=new Map,l={},c={};for(const t of r.attributes){const{name:e,count:n,type:r,offset:s,normalized:o,divisor:u,stride:h,vertex:d,location:f}=t,_=`vertex-buffer-${d}`;let p=l[_];p||(p=l[_]=[]);const m=new I._(e,n,r,s,h,o,u);p.push(m),a.set(e,f),c[_]=i[d]}const u=new C.Z(t,a,l,c,o);this.groups.push({...r,vertexArray:u,locations:a,layout:l,indexing:s})}this.parts=e.parts}bind(t,e){this._boundPart=e;const{group:i}=this.parts[this._boundPart],{vertexArray:n}=this.groups[i];t.bindVAO(n)}draw(t){if(null==this._boundPart)throw new Error("Mesh.bind() has not been called.");const{start:e,count:i}=this.parts[this._boundPart],{group:n}=this.parts[this._boundPart],{indexing:r,primitive:s}=this.groups[n];r?t.drawElements(s,i,r,e*E[r]):t.drawArrays(s,e,i)}unbind(t){this._boundPart=null,t.bindVAO(null)}destroy(){for(const{vertexArray:t}of this.groups)t.dispose()}}var O=i(25731);class F extends R{static create(t,e){const i=[];let{stride:n,hash:r}=e.layout;if(null==n){n=0;for(const{count:t,type:i,offset:r}of e.layout.attributes){if(null!=r)throw new Error("Stride cannot be computed automatically when attribute offsets are supplied explicitly.");n+=t*E[i]}}let s=0,o=0;for(const{count:t,name:r,offset:a,type:l,normalized:c}of e.layout.attributes){null!=a&&(o=a);const e={name:r,location:s,vertex:0,count:t,type:l,offset:o,stride:n,divisor:0,normalized:null!=c&&c};i.push(e),s++,o+=t*E[l]}const a={attributes:i,primitive:e.primitive};null!=e.index&&(a.index=0);let{count:l}=e;if(null==l&&(l=e.index?e.index.length:e.vertex.byteLength/n,Math.floor(l)!==l))throw new Error(`The byte length of vertex data must be an exact multiple of the stride, which is ${n}.`);const c={start:0,count:l,group:0,primitive:e.primitive},u={vertex:[e.vertex],parts:[c],groups:[a]};return null!=e.index&&(u.index=[e.index]),null==r&&(r=(0,O.hU)(i)),new F(t,u,{hash:r,attributes:i,stride:n})}constructor(t,e,i){super(t,e),this.layout=i}bind(t,e=0){super.bind(t,e)}}var z=i(96402),D=i(49414),L=i(15167),N=i(78541),B=i(10956);class k{constructor(){this._dotTextureSize=0,this._dotTextures=null,this._dotMesh=null}destroy(){this._disposeTextures(),this._dotFBO&&this._dotFBO.dispose(),this._dotMesh&&this._dotMesh.destroy()}getFBO(t){if(null==this._dotFBO){const e=n.CQ,i=n.CQ,r=new B.R(e,i);r.samplingMode=P.Cj.NEAREST,r.wrapMode=P.pF.CLAMP_TO_EDGE;const s=new D.l(t,new L.q(P.yQ.DEPTH_STENCIL,e,i));this._dotFBO=new z.H(t,r,s)}return this._dotFBO}getDotDensityMesh(t){if(null==this._dotMesh){const e=n.CQ,i=e*e,r=2,s=new Int16Array(i*r);for(let t=0;t<e;t++)for(let i=0;i<e;i++)s[r*(i+t*e)]=i,s[r*(i+t*e)+1]=t;const o=[{count:2,type:P.pe.UNSIGNED_SHORT,name:"a_position",offset:0}],a={hash:(0,O.hU)(o),attributes:o,stride:4};this._dotMesh=F.create(t,{primitive:P.WR.POINTS,vertex:s,count:i,layout:a})}return this._dotMesh}getDotDensityTextures(t,e,i){if(this._dotTextureSize===e&&this._seed===i||(this._disposeTextures(),this._dotTextureSize=e,this._seed=i),null===this._dotTextures){const n=new M.A(i);this._dotTextures=[this._allocDotDensityTexture(t,e,n),this._allocDotDensityTexture(t,e,n)]}return this._dotTextures}_disposeTextures(){if(this._dotTextures){for(let t=0;t<this._dotTextures.length;t++)this._dotTextures[t].dispose();this._dotTextures=null}}_allocDotDensityTexture(t,e,i){const n=new Float32Array(e*e*4);for(let t=0;t<n.length;t++)n[t]=i.getFloat();const r=new B.R;return r.dataType=P.ld.FLOAT,r.samplingMode=P.Cj.NEAREST,r.width=e,r.height=e,new N.g(t,r,n)}}var V=i(42203),U=i(58991);function G(t){const e=1/t;return{antialiasing:e,blur:0+e}}var H=i(47461),Y=i(54537),W=i(51741),Z=i(15087),q=i(40633),X=i(95929),$=i(39819);class j{constructor(t,e,i,n){this.dataType=t,this.samplingMode=e,this.pixelFormat=i,this.internalFormat=n}}class K{destroy(){this._accumulateFramebuffer=(0,X.WD)(this._accumulateFramebuffer),this._resolveGradientTexture=(0,X.WD)(this._resolveGradientTexture),this._prevGradientHash=null,this._qualityProfile=null}get initialized(){return null!=this._accumulateFramebuffer&&null!=this._resolveGradientTexture}get accumulateFramebuffer(){return this._accumulateFramebuffer}get resolveGradientTexture(){return this._resolveGradientTexture}loadQualityProfile(t){if(null==this._qualityProfile){const e=function(t,e){const{textureFloatLinear:i,colorBufferFloat:n}=t.capabilities,r=n?.textureFloat,s=n?.textureHalfFloat,o=n?.floatBlend,a=t.driverTest.floatBufferBlend.result;if(!r&&!s)throw new $.A("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");if(!(o&&a||s))throw new $.A("heatmap:missing-float-blend","HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float."+(a?"":" This device claims support for EXT_float_blend, but does not actually support it."));const l=r&&o&&a,c=s,u=i,h=!!n?.R32F,d=!!n?.R16F;if(l&&u)return u||e.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),new j(P.ld.FLOAT,u?P.Cj.LINEAR:P.Cj.NEAREST,h?P.Ab.RED:P.Ab.RGBA,h?P.H0.R32F:P.Ab.RGBA);if(c)return new j(P.ld.HALF_FLOAT,P.Cj.LINEAR,d?P.Ab.RED:P.Ab.RGBA,d?P.H0.R16F:P.Ab.RGBA);throw new $.A("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.")}(t,q.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.heatmap.HeatmapResources"));this._qualityProfile={...e,defines:{usesHalfFloatPrecision:e.dataType!==P.ld.FLOAT}}}return this._qualityProfile}ensureAccumulateFBO(t,e,i){if(null==this._accumulateFramebuffer){const{dataType:n,samplingMode:r,pixelFormat:s,internalFormat:o}=this.loadQualityProfile(t),a=new B.R(e,i);a.pixelFormat=s,a.internalFormat=o,a.dataType=n,a.samplingMode=r,a.wrapMode=P.pF.CLAMP_TO_EDGE;const l=new L.q(P.yQ.DEPTH_STENCIL,e,i);this._accumulateFramebuffer=new z.H(t,a,l)}else{const{width:t,height:n}=this._accumulateFramebuffer;t===e&&n===i||this._accumulateFramebuffer.resize(e,i)}return this._accumulateFramebuffer}ensureResolveGradientTexture(t,e,i){if(null==this._resolveGradientTexture){const e=new B.R;e.wrapMode=P.pF.CLAMP_TO_EDGE,this._resolveGradientTexture=new N.g(t,e)}else this._prevGradientHash!==e&&(this._resolveGradientTexture.resize(i.length/4,1),this._resolveGradientTexture.setData(i),this._prevGradientHash=e);return this._resolveGradientTexture}}function Q(t){return t?.25:1}class J extends d.rz{}(0,c._)([(0,u.C5)(5,h.ZY)],J.prototype,"offset",void 0);class tt extends d.DM{}class et extends u.k2{}(0,c._)([(0,u.Pi)(h.nt)],et.prototype,"radius",void 0),(0,c._)([(0,u.Pi)(h.nt)],et.prototype,"isFieldActive",void 0);class it extends d.f_{constructor(){super(...arguments),this.usesHalfFloatPrecision=!1}vertex(t){const{radius:e,isFieldActive:i}=this.kernelControls,n=t.offset,r=i.multiply(this.storage.getVVData(t.id).x).add(new h.nt(1).subtract(i)),s=this.view.displayViewScreenMat3.multiply(new h.eB(t.pos,1)).add(this.view.displayViewMat3.multiply(new h.eB(n,0)).multiply(e)),o=this.clip(t.id);return{glPosition:new h.Zb(s.xy,o,1),offset:n,fieldValue:r,color:new h.Zb(0),...this.maybeRunHittest(t,{},null)}}fragment(t){const{offset:e,fieldValue:i}=t,n=(0,h.Bw)(e),r=(0,h.PM)(n,new h.nt(1)),s=new h.nt(1).subtract(n.multiply(n)),o=s.multiply(s),a=r.multiply(o).multiply(i).multiply(new h.nt(Q(this.usesHalfFloatPrecision)));return this.getFragmentOutput(new h.Zb(a),t)}hittest(t){const{viewMat3:e,tileMat3:i}=this.view,n=e.multiply(i).multiply(new h.eB(t.pos,1));return(0,v.g$)(n.xy,this.kernelControls.radius,this.hittestRequest.position)}}(0,c._)([u.E8],it.prototype,"usesHalfFloatPrecision",void 0),(0,c._)([(0,u.Pi)(et)],it.prototype,"kernelControls",void 0),(0,c._)([(0,c.a)(0,(0,u.hF)(J))],it.prototype,"vertex",null),(0,c._)([(0,c.a)(0,(0,u.hF)(tt))],it.prototype,"fragment",null);class nt extends u.ZA{}(0,c._)([(0,u.C5)(0,h.ZY)],nt.prototype,"pos",void 0);class rt extends u.HS{}class st extends u.k2{}(0,c._)([(0,u.Pi)(h.z7)],st.prototype,"texture",void 0),(0,c._)([(0,u.Pi)(h.ZY)],st.prototype,"minAndInvRange",void 0),(0,c._)([(0,u.Pi)(h.nt)],st.prototype,"normalization",void 0);class ot extends u.k2{}(0,c._)([(0,u.Pi)(h.z7)],ot.prototype,"texture",void 0);class at extends u.A{constructor(){super(...arguments),this.usesHalfFloatPrecision=!1}vertex(t){return{glPosition:new h.Zb(t.pos.multiply(2).subtract(1),1,1),uv:t.pos}}fragment(t){const{accumulatedDensity:e,gradient:i}=this;let n=(0,h.US)(e.texture,t.uv).r.multiply(new h.nt(Q(this.usesHalfFloatPrecision)));n=n.multiply(e.normalization),n=n.subtract(e.minAndInvRange.x).multiply(e.minAndInvRange.y);const r=(0,h.US)(i.texture,new h.ZY(n,.5)),s=new u.mm;return s.glFragColor=new h.Zb(r.rgb.multiply(r.a),r.a),s}}function lt(t){return t.key.level+1}(0,c._)([u.E8],at.prototype,"usesHalfFloatPrecision",void 0),(0,c._)([(0,u.Pi)(st)],at.prototype,"accumulatedDensity",void 0),(0,c._)([(0,u.Pi)(ot)],at.prototype,"gradient",void 0),(0,c._)([(0,c.a)(0,(0,u.hF)(nt))],at.prototype,"vertex",null),(0,c._)([(0,c.a)(0,(0,u.hF)(rt))],at.prototype,"fragment",null);const ct={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:{write:!1,test:{ref:lt,compare:P.MT.GEQUAL,mask:255,op:{fail:P.eA.KEEP,zFail:P.eA.KEEP,zPass:P.eA.REPLACE}}}},ut={...ct,stencil:!1},ht={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1};function dt(t,e){const{referenceScale:i,radius:n}=t.uniforms;return n*(0!==i?i/e.scale:1)}var ft=i(40846),_t=i(39979),pt=i(81432),mt=i(12026);class gt extends u.k2{getVVRotationMat4(t){return(0,h.Tk)((0,x.M8)(t),h.$I.identity(),(()=>{const e=this._getNormalizedAngle(t).multiply(ft.os),i=(0,h.F8)(e),n=(0,h.gn)(e);return new h.$I(n,i,0,0,i.multiply(new h.nt(-1)),n,0,0,0,0,1,0,0,0,0,1)}))}getVVRotationMat3(t){return(0,h.Tk)((0,x.M8)(t),h.U.identity(),(()=>{const e=this._getNormalizedAngle(t).multiply(ft.os),i=(0,h.F8)(e),n=(0,h.gn)(e);return new h.U(n,i,0,i.multiply(new h.nt(-1)),n,0,0,0,1)}))}_getNormalizedAngle(t){const e=(0,h.LC)(this.rotationType,new h.nt(ft.H_.Arithmatic));return(0,h.Tk)(e,new h.nt(90).subtract(t),t)}}(0,c._)([(0,u.Pi)(h.nt)],gt.prototype,"rotationType",void 0);var yt=i(13635),vt=i(21385),xt=i(21813),bt=i(76347),St=i(90906);class wt extends d.rz{}(0,c._)([(0,u.C5)(3,h.Zb)],wt.prototype,"color",void 0),(0,c._)([(0,u.C5)(4,h.ZY)],wt.prototype,"offset",void 0),(0,c._)([(0,u.C5)(5,h.ZY)],wt.prototype,"textureUV",void 0),(0,c._)([(0,u.C5)(6,h.nt)],wt.prototype,"fontSize",void 0),(0,c._)([(0,u.C5)(7,h.nt)],wt.prototype,"referenceSize",void 0),(0,c._)([(0,u.C5)(8,h.nt)],wt.prototype,"haloFontSize",void 0),(0,c._)([(0,u.C5)(9,h.Zb)],wt.prototype,"haloColor",void 0),(0,c._)([(0,u.C5)(10,h.ZY)],wt.prototype,"zoomRange",void 0),(0,c._)([(0,u.C5)(11,h.nt)],wt.prototype,"clipAngle",void 0),(0,c._)([(0,u.C5)(12,h.Zb)],wt.prototype,"referenceSymbol",void 0);class Tt extends u.Y7{}(0,c._)([(0,u.C5)(13,h.ZY)],Tt.prototype,"offsetNextVertex1",void 0),(0,c._)([(0,u.C5)(14,h.ZY)],Tt.prototype,"offsetNextVertex2",void 0);class Mt extends d.DM{}class Pt extends d.f_{constructor(){super(...arguments),this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"]},this.isHaloPass=!1,this.isBackgroundPass=!1,this.isLabel=!1}clipLabel(t,e,i){const r=e.multiply(1.4173228346456692),s=(0,h.tn)(this.view.rotation.subtract(r)),o=(0,h.jk)(new h.nt(360).subtract(s),s);let a=new h.nt(0);const l=(0,h.RI)(this.view.currentZoom.multiply(n.fq)).divide(n.fq),c=t.x,u=t.y,d=new h.nt(1).subtract((0,h.PM)(c,l)).multiply(2),f=(0,h.PM)(new h.nt(90),o).multiply(2),_=new h.nt(2).multiply(new h.nt(1).subtract((0,h.PM)(l,u)));return a=a.add(i.multiply(d)),a=a.add(i.multiply(f)),a=a.add(_),a}vertex(t,e){const i=(0,x.mh)(t.bitset,ft.bg),r=new h.nt(1).subtract(i);let s=t.fontSize,o=s.divide(ft.au);const a=this.isHaloPass?t.haloColor:this._getVertexColor(t),l=this.isLabel?this.storage.getAnimationValue(t.id):new h.nt(1),c=this.isLabel?a.multiply(l):a,u=this.view.displayViewScreenMat3.multiply(new h.eB(t.pos,1));let d=t.offset,f=new h.nt(1),_=h.U.identity(),p=new h.ZY(0);if(this.isLabel){if(!t.referenceSymbol)throw new Error("InternalError: Optional attribute 'referenceSymbol' expected for labels");const e=t.referenceSymbol,i=e.xy,r=e.z,s=this._unpackDirection(e.w),o=(0,St.Mg)(this,t.id,r).divide(2),a=s.multiply(o.add(n.C2));p=i.add(a),d=d.add(p)}else f=(0,St.Mg)(this,t.id,t.referenceSize).divide(t.referenceSize),s=s.multiply(f),o=o.multiply(f),d=d.multiply(f),_=(0,St.TL)(this,t.id),d=_.multiply(new h.eB(d,0)).xy;const m=(0,x.mh)(t.bitset,ft.ti),g=this._getViewRotationMatrix(m).multiply(new h.eB(d,0));let y=this.isLabel?this.clipLabel(t.zoomRange,t.clipAngle,m):this.clip(t.id,t.zoomRange);y=this.isBackgroundPass?y.add(r.multiply(2)):y.add(i.multiply(2));const v=this.isLabel?(0,h.or)((0,h.MM)(y,new h.nt(1)),(0,h.LC)(l,new h.nt(0))):new h.x(!1),b=new h.Zb(u.xy.add(g.xy),y,1),S=t.textureUV.divide(this.mosaicInfo.size);let w=new h.nt(0);return this.isHaloPass&&(w=t.haloFontSize.divide(o).divide(ft.$w)),{glPosition:b,color:c,size:o,textureUV:S,antialiasingWidth:new h.nt(.105*ft.au).divide(s).divide(this.view.pixelRatio),haloDistanceOffset:w,...this.maybeRunHittest(t,e,{vvSizeAdjustment:f,vvRotation:_,labelOffset:p,labelClipped:v})}}_getViewRotationMatrix(t){const e=this.view.displayViewMat3,i=this.view.displayMat3,n=new h.nt(1).subtract(t);return e.multiply(t).add(i.multiply(n))}fragment(t){const e=new h.nt(2/8),i=new h.nt(1).subtract(e),n=(0,h.US)(this.mosaicInfo.texture,t.textureUV).a;let r=i.subtract(t.haloDistanceOffset);this.highlight&&(r=r.divide(2));const s=t.antialiasingWidth,o=(0,h.TF)(r.subtract(s),r.add(s),n);return this.getFragmentOutput(t.color.multiply(o),t)}hittest(t,e,{vvSizeAdjustment:i,vvRotation:n,labelOffset:r,labelClipped:s}){let o,a,l;this.isLabel?(o=new h.eB(t.offset.add(r),0),a=new h.eB(e.offsetNextVertex1.add(r),0),l=new h.eB(e.offsetNextVertex2.add(r),0)):(o=n.multiply(new h.eB(t.offset.multiply(i),0)),a=n.multiply(new h.eB(e.offsetNextVertex1.multiply(i),0)),l=n.multiply(new h.eB(e.offsetNextVertex2.multiply(i),0)));const{viewMat3:c,tileMat3:u}=this.view,d=c.multiply(u).multiply(new h.eB(t.pos,1)),f=d.add(u.multiply(o)).xy,_=d.add(u.multiply(a)).xy,p=d.add(u.multiply(l)).xy,m=(0,v.Bo)(this.hittestRequest.position,f.xy,_.xy,p.xy);return this.isLabel?(0,h.Tk)(s,(0,v.My)(this.hittestRequest),m):m}_unpackDirection(t){const e=new h.Ai(t),i=(0,h.Sj)(e,new h.Ai(2)),n=(0,h.nf)(e,new h.Ai(3));return new h.ZY(new h.nt(i).subtract(1),new h.nt(n).subtract(1))}_getVertexColor(t){let e=t.color;if(this.visualVariableColor){const i=this.storage.getColorValue(t.id);e=this.visualVariableColor.getColor(i,t.color,new h.x(!1))}if(this.visualVariableOpacity){const i=this.storage.getOpacityValue(t.id),n=this.visualVariableOpacity.getOpacity(i);e=e.multiply(n)}return e}}(0,c._)([(0,u.uK)(pt._)],Pt.prototype,"visualVariableColor",void 0),(0,c._)([(0,u.uK)(mt.i)],Pt.prototype,"visualVariableOpacity",void 0),(0,c._)([(0,u.uK)(gt)],Pt.prototype,"visualVariableRotation",void 0),(0,c._)([(0,u.uK)(yt.n)],Pt.prototype,"visualVariableSizeMinMaxValue",void 0),(0,c._)([(0,u.uK)(vt.F)],Pt.prototype,"visualVariableSizeScaleStops",void 0),(0,c._)([(0,u.uK)(xt.N)],Pt.prototype,"visualVariableSizeStops",void 0),(0,c._)([(0,u.uK)(bt.d)],Pt.prototype,"visualVariableSizeUnitValue",void 0),(0,c._)([(0,u.Pi)(_t.b)],Pt.prototype,"mosaicInfo",void 0),(0,c._)([u.E8],Pt.prototype,"isHaloPass",void 0),(0,c._)([u.E8],Pt.prototype,"isBackgroundPass",void 0),(0,c._)([u.E8],Pt.prototype,"isLabel",void 0),(0,c._)([(0,c.a)(0,(0,u.hF)(wt)),(0,c.a)(1,(0,u.hF)(Tt))],Pt.prototype,"vertex",null),(0,c._)([(0,c.a)(0,(0,u.hF)(Mt))],Pt.prototype,"fragment",null);var Et=i(59224),At=i(2014);class Ct extends Et.Xc{}(0,c._)([(0,u.C5)(9,h.nt)],Ct.prototype,"accumulatedDistance",void 0),(0,c._)([(0,u.C5)(10,h.ZY)],Ct.prototype,"segmentDirection",void 0),(0,c._)([(0,u.C5)(11,h.Zb)],Ct.prototype,"tlbr",void 0);class It extends Et.cM{_getLineWidthRatio(t,e){const i=new h.nt(At.$),n=(0,x.mh)(t.bitset,ft.kx);return n.multiply((0,h.T9)(e,new h.nt(.25))).add(new h.nt(1).subtract(n)).divide(i)}_getSDFAlpha(t){const{halfWidth:e,normal:i,tlbr:n,patternSize:r,accumulatedDistance:s,lineWidthRatio:o}=t,a=r.x.multiply(new h.nt(2)).multiply(o),l=(0,h.jc)(s.divide(a)),c=new h.nt(.25).multiply(i.y).add(new h.nt(.5)),u=(0,h.jh)(n.xy,n.zw,new h.ZY(l,c)),d=(0,x.Rj)((0,h.US)(this.mosaicInfo.texture,u)).subtract(new h.nt(.5)).multiply(e),f=(0,h.qE)(new h.nt(.5).subtract(d),new h.nt(0),new h.nt(1));return new h.Zb(f)}_getPatternColor(t){const{halfWidth:e,normal:i,color:n,accumulatedDistance:r,patternSize:s,sampleAlphaOnly:o,tlbr:a}=t,l=s.y.multiply(new h.nt(2).multiply(e).divide(s.x)),c=(0,h.jc)(r.divide(l)),u=new h.nt(.5).multiply(i.y).add(new h.nt(.5)),d=(0,h.jh)(a.xy,a.zw,new h.ZY(u,c));let f=(0,h.US)(this.mosaicInfo.texture,d);return null!=this.visualVariableColor&&(f=(0,h.Tk)((0,h.MM)(o,new h.nt(.5)),new h.Zb(n.a),n)),f}vertex(t,e){const{segmentDirection:i,tlbr:n,bitset:r}=t,s=(0,Et.$0)(this,t),o=t.accumulatedDistance.divide(this.view.displayZoomFactor).add((0,h.Om)(i,s.scaledOffset)),a=new h.ZY(n.z.subtract(n.x),n.w.subtract(n.y)),l=n.divide(this.mosaicInfo.size.xyxy),c=(0,x.mh)(r,ft.b5),u=(0,x.mh)(r,ft.cn),d=(0,h.Tk)((0,h.MM)(c,new h.nt(.5)),this._getLineWidthRatio(t,s.scaledHalfWidth),new h.nt(1));return{...s,tlbr:l,patternSize:a,accumulatedDistance:o,isSDF:c,sampleAlphaOnly:u,lineWidthRatio:d,...this.maybeRunHittest(t,e,s.halfWidth)}}fragment(t){const{color:e,opacity:i,isSDF:n}=t,r=(0,Et.xw)(t,this.antialiasingControls.blur),s=(0,h.Tk)((0,h.MM)(n,new h.nt(.5)),this._getSDFAlpha(t),this._getPatternColor(t)),o=e.multiply(i).multiply(r).multiply(s);return this.getFragmentOutput(o,t)}}(0,c._)([(0,u.Pi)(_t.b)],It.prototype,"mosaicInfo",void 0),(0,c._)([(0,c.a)(0,(0,u.hF)(Ct)),(0,c.a)(1,(0,u.hF)(d.$Z))],It.prototype,"vertex",null);var Rt=i(97473);class Ot extends d.rz{}(0,c._)([(0,u.C5)(3,h.Zb)],Ot.prototype,"color",void 0),(0,c._)([(0,u.C5)(4,h.Zb)],Ot.prototype,"outlineColor",void 0),(0,c._)([(0,u.C5)(5,h.ZY)],Ot.prototype,"offset",void 0),(0,c._)([(0,u.C5)(6,h.ZY)],Ot.prototype,"textureUV",void 0),(0,c._)([(0,u.C5)(7,h.Zb)],Ot.prototype,"sizing",void 0),(0,c._)([(0,u.C5)(8,h.nt)],Ot.prototype,"placementAngle",void 0),(0,c._)([(0,u.C5)(9,h.nt)],Ot.prototype,"sizeRatio",void 0),(0,c._)([(0,u.C5)(10,h.ZY)],Ot.prototype,"zoomRange",void 0);class Ft extends u.Y7{}(0,c._)([(0,u.C5)(12,h.ZY)],Ft.prototype,"offsetNextVertex1",void 0),(0,c._)([(0,u.C5)(13,h.ZY)],Ft.prototype,"offsetNextVertex2",void 0),(0,c._)([(0,u.C5)(14,h.ZY)],Ft.prototype,"textureUVNextVertex1",void 0),(0,c._)([(0,u.C5)(15,h.ZY)],Ft.prototype,"textureUVNextVertex2",void 0);class zt extends d.DM{}function Dt(t,e,i,n){return e.multiply(t.x).add(i.multiply(t.y)).add(n.multiply(t.z))}function Lt(t){return t.multiply(t).divide(128)}class Nt extends d.f_{constructor(){super(...arguments),this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],textureUV:["textureUVNextVertex1","textureUVNextVertex2"]}}vertex(t,e){const i=Lt(t.sizing.x),n=Lt(t.sizing.y),r=Lt(t.sizing.z),s=t.placementAngle,o=(0,x.mh)(t.bitset,Rt.c.bitset.isSDF),a=(0,x.mh)(t.bitset,Rt.c.bitset.isMapAligned),l=(0,x.mh)(t.bitset,Rt.c.bitset.scaleSymbolsProportionally),c=(0,x.K5)(t.bitset,Rt.c.bitset.colorLocked),u=(0,St.cF)(this,t.id),d=(0,St.G7)(this,t.id,t.color,c).multiply(u),f=this.view.displayViewScreenMat3.multiply(new h.eB(t.pos.xy,1)),_=(0,St.Mg)(this,t.id,r).divide(r),p=i.multiply(_),m=t.offset.xy.multiply(_);let g=n.multiply(l.multiply(_.subtract(1)).add(1));g=(0,h.jk)(g,(0,h.T9)(p.subtract(.99),new h.nt(0)));const y=(0,h.T9)(g,new h.nt(1)),v=(0,h.jk)(g,new h.nt(1)),b=h.U.fromRotation(s.multiply(ft.rp)),S=(0,St.TL)(this,t.id),w=this._getViewRotationMatrix(a).multiply(S).multiply(b).multiply(new h.eB(m.xy,0)),T=this.clip(t.id,t.zoomRange),M=new h.Zb(f.xy.add(w.xy),T,1),P=t.textureUV.divide(this.mosaicInfo.size),E=t.outlineColor.multiply(v),A=(0,x.mh)(t.bitset,Rt.c.bitset.overrideOutlineColor),C=t.sizeRatio.multiply(p).multiply(.5);return{glPosition:M,color:d,textureUV:P,outlineColor:E,outlineSize:y,distanceToPx:C,isSDF:o,overrideOutlineColor:A,...this.maybeRunHittest(t,e,{pos:t.pos,size:p,sizeCorrection:_,isMapAligned:a,outlineSize:y,distanceToPx:C,isSDF:o})}}fragment(t){const e=this._getColor(t.textureUV,t);return this.getFragmentOutput(e,t)}hittest(t,e,i){return(0,h.Tk)((0,h.Xe)(i.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(t,e,i),this._hittestMarker(t,e,i))}_getViewRotationMatrix(t){const e=this.view.displayViewMat3,i=this.view.displayMat3,n=new h.nt(1).subtract(t);return e.multiply(t).add(i.multiply(n))}_getViewScreenMatrix(t){const e=this.view.viewMat3.multiply(this.view.tileMat3),i=this.view.tileMat3,n=new h.nt(1).subtract(t);return e.multiply(t).add(i.multiply(n))}_getColor(t,e){return(0,h.Tk)((0,h.LC)(e.isSDF,new h.nt(1)),this._getSDFColor(t,e),this._getSpriteColor(t,e))}_getSpriteColor(t,e){return(0,h.US)(this.mosaicInfo.texture,t).multiply(e.color)}_getSDFColor(t,e){const i=(0,h.US)(this.mosaicInfo.texture,t),n=new h.nt(.5).subtract((0,x.Rj)(i)).multiply(e.distanceToPx).multiply(ft.V5),r=(0,h.qE)(new h.nt(.5).subtract(n),new h.nt(0),new h.nt(1)),s=e.color.multiply(r);let o=e.outlineSize;this.highlight&&(o=(0,h.T9)(o,e.overrideOutlineColor.multiply(4)));const a=o.multiply(.5),l=(0,h.tn)(n).subtract(a),c=(0,h.qE)(new h.nt(.5).subtract(l),new h.nt(0),new h.nt(1)),u=(0,h.jh)(e.outlineColor,e.color,e.overrideOutlineColor).multiply(c);return new h.nt(1).subtract(u.a).multiply(s).add(u)}_hittestSmallMarker(t,e,i){const{position:n,distance:r,smallSymbolDistance:s}=this.hittestRequest,o=r.subtract(s),{viewMat3:a,tileMat3:l}=this.view,c=a.multiply(l).multiply(new h.eB(i.pos,1)).xy,u=i.size.multiply(.5);return(0,h.Io)(c,n).subtract(u).add(o)}_hittestMarker(t,e,i){const{pos:n,sizeCorrection:r,isMapAligned:s}=i,o=new h.eB(t.offset.multiply(r),0),a=new h.eB(e.offsetNextVertex1.multiply(r),0),l=new h.eB(e.offsetNextVertex2.multiply(r),0),{viewMat3:c,tileMat3:u}=this.view,d=c.multiply(u).multiply(new h.eB(n,1)),f=this._getViewScreenMatrix(s),_=d.add(f.multiply(o)).xy,p=d.add(f.multiply(a)).xy,m=d.add(f.multiply(l)).xy,g=this.hittestRequest.position,y=this.hittestRequest.distance,x=(0,v.Bo)(g,n,p,m);return(0,h.Tk)((0,h.MM)(x,y),x,this._hittestSamples(_,p,m,t,e,i))}_hittestSamples(t,e,i,n,r,s){const{outlineSize:o,isSDF:a,distanceToPx:l}=s,c=this.hittestRequest.position,u=this.hittestRequest.distance,d=(0,v.Bs)(c.add(new h.ZY((0,h.ze)(u),(0,h.ze)(u))),t,e,i),f=(0,v.Bs)(c.add(new h.ZY(0,(0,h.ze)(u))),t,e,i),_=(0,v.Bs)(c.add(new h.ZY(u,(0,h.ze)(u))),t,e,i),p=(0,v.Bs)(c.add(new h.ZY((0,h.ze)(u),0)),t,e,i),m=(0,v.Bs)(c,t,e,i),g=(0,v.Bs)(c.add(new h.ZY(u,0)),t,e,i),y=(0,v.Bs)(c.add(new h.ZY((0,h.ze)(u),u)),t,e,i),x=(0,v.Bs)(c.add(new h.ZY(0,u)),t,e,i),b=(0,v.Bs)(c.add(new h.ZY(u,u)),t,e,i),S=n.textureUV.divide(this.mosaicInfo.size),w=r.textureUVNextVertex1.divide(this.mosaicInfo.size),T=r.textureUVNextVertex2.divide(this.mosaicInfo.size),M={color:new h.Zb(1),outlineColor:new h.Zb(1),overrideOutlineColor:new h.nt(1),outlineSize:o,distanceToPx:l,isSDF:a};let P=new h.nt(0);return P=P.add((0,v.kW)(d).multiply(this._getColor(Dt(d,S,w,T),M).a)),P=P.add((0,v.kW)(f).multiply(this._getColor(Dt(f,S,w,T),M).a)),P=P.add((0,v.kW)(_).multiply(this._getColor(Dt(_,S,w,T),M).a)),P=P.add((0,v.kW)(p).multiply(this._getColor(Dt(p,S,w,T),M).a)),P=P.add((0,v.kW)(m).multiply(this._getColor(Dt(m,S,w,T),M).a)),P=P.add((0,v.kW)(g).multiply(this._getColor(Dt(g,S,w,T),M).a)),P=P.add((0,v.kW)(y).multiply(this._getColor(Dt(y,S,w,T),M).a)),P=P.add((0,v.kW)(x).multiply(this._getColor(Dt(x,S,w,T),M).a)),P=P.add((0,v.kW)(b).multiply(this._getColor(Dt(b,S,w,T),M).a)),(0,h.PM)(P,new h.nt(.05)).multiply((0,v.My)(this.hittestRequest))}}(0,c._)([(0,u.uK)(pt._)],Nt.prototype,"visualVariableColor",void 0),(0,c._)([(0,u.uK)(mt.i)],Nt.prototype,"visualVariableOpacity",void 0),(0,c._)([(0,u.uK)(gt)],Nt.prototype,"visualVariableRotation",void 0),(0,c._)([(0,u.uK)(yt.n)],Nt.prototype,"visualVariableSizeMinMaxValue",void 0),(0,c._)([(0,u.uK)(vt.F)],Nt.prototype,"visualVariableSizeScaleStops",void 0),(0,c._)([(0,u.uK)(xt.N)],Nt.prototype,"visualVariableSizeStops",void 0),(0,c._)([(0,u.uK)(bt.d)],Nt.prototype,"visualVariableSizeUnitValue",void 0),(0,c._)([(0,u.Pi)(_t.b)],Nt.prototype,"mosaicInfo",void 0),(0,c._)([(0,c.a)(0,(0,u.hF)(Ot)),(0,c.a)(1,(0,u.hF)(Ft))],Nt.prototype,"vertex",null),(0,c._)([(0,c.a)(0,(0,u.hF)(zt))],Nt.prototype,"fragment",null);var Bt=i(50944),kt=i(22516);class Vt{constructor(){this.computeAttributes={}}get locationsMap(){const t=new Map;for(const e in this.locations)t.set(e,this.locations[e].index);return t}get optionPropertyKeys(){if(!this._optionPropertyKeys){const t=new Set(Object.keys(this.options));this._optionPropertyKeys=t}return this._optionPropertyKeys}get _transformFeedbackBindings(){return[]}get locationInfo(){if(!this._locationInfo){const t=this.locationsMap,e=Array.from(t.entries()).map((([t,e])=>`${t}.${e}`)).join("."),i=(0,Bt.Wm)(e);this._locationInfo={hash:i,locations:t,computeAttributeMap:this.computeAttributes}}return this._locationInfo}get renamedLocationsMap(){const t=new Map;for(const[e,i]of this.locationsMap.entries())t.set("a_"+e,i);return t}getShaderKey(t,e,i){return`${Object.keys(t).map((e=>`${e}.${t[e]}`)).join(".")}.${Object.keys(i).filter((t=>i[t])).map((t=>`${t}_${i[t].toString()}`)).join(".")}.${Object.keys(e).filter((t=>this.optionPropertyKeys.has(t))).join(".")}`}getProgram(t,e,i,n){let r="",s="";for(const t in i)if(i[t]){const e="boolean"==typeof i[t]?`#define ${t}\n`:`#define ${t} ${i[t]}\n`;r+=e,s+=e}return r+=this.vertexShader,s+=this.fragmentShader,new kt.K(r,s,this.renamedLocationsMap,this.locationInfo,this._getUniformBindings(e),this._transformFeedbackBindings)}_getUniformBindings(t){const e=[];for(const t in this.required){const i=this.required[t];e.push({uniformHydrated:null,shaderModulePath:t,uniformName:t,uniformType:i.type,uniformArrayElementType:Ut(i),uniformArrayLength:Gt(i)})}for(const i in t){const n=this.options[i];if(t[i])for(const t in n){const r=n[t];e.push({uniformHydrated:null,shaderModulePath:`${i}.${t}`,uniformName:t,uniformType:r.type,uniformArrayElementType:Ut(r),uniformArrayLength:Gt(r)})}}return e}}const Ut=t=>"array"===t.type?t.elementType?.type:void 0,Gt=t=>"array"===t.type?t.size:void 0;var Ht=i(44723);const Yt={hittestDist:h.nt,hittestPos:h.ZY},Wt={filterFlags:h.z7,animation:h.z7,visualVariableData:h.z7,dataDriven0:h.z7,dataDriven1:h.z7,dataDriven2:h.z7,gpgpu:h.z7,size:h.nt},Zt={displayViewScreenMat3:h.U,displayViewMat3:h.U,displayMat3:h.U,viewMat3:h.U,tileMat3:h.U,displayZoomFactor:h.nt,requiredZoomFactor:h.nt,tileOffset:h.ZY,currentScale:h.nt,currentZoom:h.nt,metersPerSRUnit:h.nt};class qt extends Vt{constructor(){super(...arguments),this.vertexShader=(0,Ht.Q)("materials/pie/pie.vert"),this.fragmentShader=(0,Ht.Q)("materials/pie/pie.frag"),this.required={...Wt,...Zt,outlineWidth:h.nt,colors:h.My,defaultColor:h.Zb,othersColor:h.Zb,outlineColor:h.Zb,donutRatio:h.nt,sectorThreshold:h.nt},this.options={hittestUniforms:Yt,visualVariableSizeMinMaxValue:{minMaxValueAndSize:h.Zb},visualVariableSizeScaleStops:{sizes:{...h.My.ofType(h.nt,8),type:"array",elementType:h.nt,size:8},values:{...h.My.ofType(h.nt,8),type:"array",elementType:h.nt,size:8}},visualVariableSizeStops:{sizes:{...h.My.ofType(h.nt,8),type:"array",elementType:h.nt,size:8},values:{...h.My.ofType(h.nt,8),type:"array",elementType:h.nt,size:8}},visualVariableSizeUnitValue:{unitValueToPixelsRatio:h.nt},visualVariableOpacity:{opacities:{...h.My.ofType(h.nt,8),type:"array",elementType:h.nt,size:8},opacityValues:{...h.My.ofType(h.nt,8),type:"array",elementType:h.nt,size:8}}},this.locations={pos:{index:0,type:h.ZY},id:{index:1,type:h.eB},bitset:{index:2,type:h.nt},offset:{index:3,type:h.ZY},texCoords:{index:4,type:h.ZY},size:{index:5,type:h.ZY},referenceSize:{index:6,type:h.nt},zoomRange:{index:7,type:h.ZY}},this.defines={VV_SIZE_MIN_MAX_VALUE:"boolean",VV_SIZE_SCALE_STOPS:"boolean",VV_SIZE_FIELD_STOPS:"boolean",VV_SIZE_UNIT_VALUE:"boolean",VV_OPACITY:"boolean",HITTEST:"boolean",numberOfFields:"number",highlight:"boolean",inside:"boolean",outside:"boolean"}}setNumberOfFields(t){this.required.colors={...h.My.ofType(h.Zb,t),type:"array",elementType:h.Zb,size:t}}}const Xt={fill:new class extends o{constructor(){super(...arguments),this.type=l.N.Fill,this.shaders={geometry:new V.z}}render(t,e){const{painter:i}=t,n=e.instance.getInput();i.setShader({shader:this.shaders.geometry,uniforms:{...(0,a.r3)(t,e.target,n.uniforms),...(0,a.QA)(t,e.target)},defines:(0,a.vT)(t),optionalAttributes:n.optionalAttributes,useComputeBuffer:(0,a.Eq)(t)}),i.setPipelineState((0,a.Qu)(t)),i.submitDraw(t,e)}},patternFill:new class extends o{constructor(){super(...arguments),this.type=l.N.PatternFill,this.shaders={geometry:new W.vx}}render(t,e){const{context:i,painter:n}=t,r=e.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,a.r3)(t,e.target,r.uniforms),...(0,a.QA)(t,e.target),mosaicInfo:n.textureManager.getMosaicInfo(i,e.textureKey),localTileOffset:(0,a.Pr)(e.target)},defines:{...(0,a.vT)(t)},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,a.Eq)(t)}),n.setPipelineState((0,a.Qu)(t)),n.submitDraw(t,e)}},complexFill:new class extends o{constructor(){super(...arguments),this.type=l.N.ComplexFill,this.shaders={geometry:new U.Ps}}render(t,e){const{context:i,painter:n}=t,r=e.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,a.r3)(t,e.target,r.uniforms),...(0,a.QA)(t,e.target),mosaicInfo:n.textureManager.getMosaicInfo(i,e.textureKey),localTileOffset:(0,a.Pr)(e.target)},defines:{...(0,a.vT)(t)},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,a.Eq)(t)}),n.setPipelineState((0,a.Qu)(t)),n.submitDraw(t,e)}},outlineFill:new class extends o{constructor(){super(...arguments),this.type=l.N.OutlineFill,this.shaders={geometry:new Y.nj}}render(t,e){const{painter:i,pixelRatio:n}=t,r=e.instance.getInput();i.setShader({shader:this.shaders.geometry,uniforms:{...(0,a.r3)(t,e.target,r.uniforms),...(0,a.QA)(t,e.target),antialiasingControls:G(n)},defines:{...(0,a.vT)(t)},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,a.Eq)(t)}),i.setPipelineState((0,a.Qu)(t)),i.submitDraw(t,e)}},patternOutlineFill:new class extends o{constructor(){super(...arguments),this.type=l.N.PatternOutlineFill,this.shaders={geometry:new Z.tA}}render(t,e){const{context:i,painter:n,pixelRatio:r}=t,s=e.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,a.r3)(t,e.target,s.uniforms),...(0,a.QA)(t,e.target),antialiasingControls:G(r),mosaicInfo:n.textureManager.getMosaicInfo(i,e.textureKey),localTileOffset:(0,a.Pr)(e.target)},defines:{...(0,a.vT)(t)},optionalAttributes:s.optionalAttributes,useComputeBuffer:(0,a.Eq)(t)}),n.setPipelineState((0,a.Qu)(t)),n.submitDraw(t,e)}},complexOutlineFill:new class extends o{constructor(){super(...arguments),this.type=l.N.ComplexOutlineFill,this.shaders={geometry:new H.RH}}render(t,e){const{context:i,painter:n,pixelRatio:r}=t,s=e.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,a.r3)(t,e.target,s.uniforms),...(0,a.QA)(t,e.target),antialiasingControls:G(r),mosaicInfo:n.textureManager.getMosaicInfo(i,e.textureKey),localTileOffset:(0,a.Pr)(e.target)},defines:{...(0,a.vT)(t)},optionalAttributes:s.optionalAttributes,useComputeBuffer:(0,a.Eq)(t)}),n.setPipelineState((0,a.Qu)(t)),n.submitDraw(t,e)}},marker:new class extends o{constructor(){super(...arguments),this.type=l.N.Marker,this.shaders={geometry:new Nt},this.symbologyPlane=r.uC.MARKER}render(t,e){const{context:i,painter:n}=t,r=e.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,a.r3)(t,e.target,r.uniforms),...(0,a.QA)(t,e.target),mosaicInfo:n.textureManager.getMosaicInfo(i,e.textureKey,!0)},defines:{...(0,a.vT)(t)},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,a.Eq)(t)}),n.setPipelineState((0,a.Qu)(t)),n.submitDraw(t,e)}},pieChart:new class extends o{constructor(){super(...arguments),this.type=l.N.PieChart,this.shaders={geometry:new qt},this.symbologyPlane=r.uC.MARKER}render(t,e){const{painter:i}=t,{instance:n,target:r}=e,s=this.shaders.geometry,o=n.getInput(),l=o.uniforms.numberOfFields,c=(0,a.Eq)(t),u=(0,a.QA)(t,r),h=(0,a.vT)(t);s.setNumberOfFields(l),i.setShader({shader:s,uniforms:{...(0,a.r3)(t,e.target,o.uniforms.shader),...u.storage,...u.view,hittestUniforms:u.hittestRequest?{hittestDist:u.hittestRequest?.distance,hittestPos:u.hittestRequest?.position}:null},defines:{VV_SIZE_MIN_MAX_VALUE:!!o.uniforms.shader.visualVariableSizeMinMaxValue,VV_SIZE_SCALE_STOPS:!!o.uniforms.shader.visualVariableSizeScaleStops,VV_SIZE_FIELD_STOPS:!!o.uniforms.shader.visualVariableSizeStops,VV_SIZE_UNIT_VALUE:!!o.uniforms.shader.visualVariableSizeUnitValue,VV_OPACITY:!!o.uniforms.shader.visualVariableOpacity,HITTEST:c,highlight:u.highlight?1:0,...h,numberOfFields:l},optionalAttributes:{},useComputeBuffer:c}),i.setPipelineState((0,a.Qu)(t)),i.submitDraw(t,e)}},line:new class extends o{constructor(){super(...arguments),this.type=l.N.Line,this.shaders={geometry:new Et.cM},this.symbologyPlane=r.uC.LINE}render(t,e){const{painter:i,pixelRatio:n}=t,r=e.instance.getInput();i.setShader({shader:this.shaders.geometry,uniforms:{...(0,a.r3)(t,e.target,r.uniforms),...(0,a.QA)(t,e.target),antialiasingControls:G(n)},defines:{...(0,a.vT)(t)},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,a.Eq)(t)}),i.setPipelineState((0,a.Qu)(t)),i.submitDraw(t,e)}},texturedLine:new class extends o{constructor(){super(...arguments),this.type=l.N.TexturedLine,this.shaders={geometry:new It},this.symbologyPlane=r.uC.LINE}render(t,e){const{context:i,painter:n,pixelRatio:r}=t,s=e.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,a.r3)(t,e.target,s.uniforms),...(0,a.QA)(t,e.target),antialiasingControls:G(r),mosaicInfo:n.textureManager.getMosaicInfo(i,e.textureKey)},defines:{...(0,a.vT)(t)},optionalAttributes:s.optionalAttributes,useComputeBuffer:(0,a.Eq)(t)}),n.setPipelineState((0,a.Qu)(t)),n.submitDraw(t,e)}},text:new class extends o{constructor(){super(...arguments),this.type=l.N.Text,this.shaders={geometry:new Pt},this.symbologyPlane=r.uC.TEXT}render(t,e){const{context:i,painter:n}=t,r=(0,a.vT)(t),s=e.instance.getInput(),o={shader:this.shaders.geometry,uniforms:{...(0,a.r3)(t,e.target,s.uniforms),...(0,a.QA)(t,e.target),mosaicInfo:n.textureManager.getMosaicInfo(i,e.textureKey)},defines:{...r,isHaloPass:!1,isBackgroundPass:!0,isLabel:!1},optionalAttributes:s.optionalAttributes,useComputeBuffer:(0,a.Eq)(t)};n.setShader(o),n.setPipelineState((0,a.Qu)(t)),n.submitDraw(t,e),n.setShader({...o,defines:{...r,isHaloPass:!0,isBackgroundPass:!1,isLabel:!1}}),n.submitDraw(t,e),n.setShader({...o,defines:{...r,isHaloPass:!1,isBackgroundPass:!1,isLabel:!1}}),n.submitDraw(t,e)}},label:new class extends o{constructor(){super(...arguments),this.type=l.N.Label,this.shaders={geometry:new Pt},this.drawPhase=r.S5.LABEL|r.S5.LABEL_ALPHA|r.S5.HITTEST,this.symbologyPlane=r.uC.TEXT}render(t,e){const{context:i,painter:n}=t,r=(0,a.vT)(t),s={...(0,a.Qu)(t)},o=e.instance.getInput(),l={shader:this.shaders.geometry,uniforms:{...(0,a.r3)(t,e.target,o.uniforms),...(0,a.QA)(t,e.target),mosaicInfo:n.textureManager.getMosaicInfo(i,e.textureKey)},defines:{...r,isHaloPass:!1,isBackgroundPass:!0,isLabel:!0},optionalAttributes:o.optionalAttributes,useComputeBuffer:(0,a.Eq)(t)};n.setShader(l),n.setPipelineState(s),n.submitDraw(t,e),n.setShader({...l,defines:{...r,isHaloPass:!0,isBackgroundPass:!1,isLabel:!0}}),n.setPipelineState(s),n.submitDraw(t,e),n.setShader({...l,defines:{...r,isHaloPass:!1,isBackgroundPass:!1,isLabel:!0}}),n.setPipelineState(s),n.submitDraw(t,e)}},heatmap:new class extends o{constructor(){super(...arguments),this.type=l.N.Heatmap,this.shaders={accumulate:new it,resolve:new at},this.postProcessingEnabled=!0,this._isBound=!1,this._resources=new Map,this.overrideStencilRef=lt}shutdown(t){super.shutdown(t),this._resources.get(t)?.destroy(),this._resources.delete(t),this._prevFBO=null,this._unbind()}render(t,e){const{context:i,painter:n,state:r}=t,s=e.instance.getInput(),{isFieldActive:o}=s.uniforms,l=this._getOrCreateResourcesRecord(i),c=l.loadQualityProfile(i);if((0,a.dJ)(t))return;(0,a.Eq)(t)||this._bind(t,l,s),n.setShader({shader:this.shaders.accumulate,uniforms:{...(0,a.QA)(t,e.target),kernelControls:{radius:dt(s,r),isFieldActive:o?1:0}},defines:{...(0,a.vT)(t),...c.defines},optionalAttributes:{},useComputeBuffer:(0,a.Eq)(t)});const u=(0,a.Eq)(t)?ut:ct;n.setPipelineState(u),n.submitDraw(t,e)}postProcess(t,e){if((0,a.Eq)(t)||(0,a.dJ)(t))return;const{context:i,painter:n}=t,r=this._resources.get(i);if(null==this._prevFBO||null==this._prevViewport||!r?.initialized)return;const{defines:s}=r.loadQualityProfile(i),{minDensity:o,maxDensity:l,radius:c}=e.getInput().uniforms,u=r.accumulateFramebuffer,h=r.resolveGradientTexture;n.setShader({shader:this.shaders.resolve,uniforms:{accumulatedDensity:{texture:{unit:8,texture:u.colorTexture},minAndInvRange:[o,1/(l-o)],normalization:3/(c*c*Math.PI)},gradient:{texture:{unit:9,texture:h}}},defines:s,optionalAttributes:{},useComputeBuffer:!1}),i.bindFramebuffer(this._prevFBO),i.setViewport(0,0,this._prevViewport.width,this._prevViewport.height),i.bindTexture(u.colorTexture,8),i.bindTexture(h,9),n.setPipelineState(ht),n.submitDrawQuad(i),this._unbind()}_getOrCreateResourcesRecord(t){let e=this._resources.get(t);return null==e&&(e=new K,this._resources.set(t,e)),e}_unbind(){this._prevFBO=null,this._prevViewport=null,this._isBound=!1}_bind(t,e,i){if(this._isBound)return;const{context:n,state:r,pixelRatio:s}=t,o=n.getBoundFramebufferObject(),a=n.getViewport();this._prevFBO=o,this._prevViewport=a;const{gradient:l,gradientHash:c}=i.uniforms;e.ensureResolveGradientTexture(n,c,l);const{width:u,height:h}=a,d=function(t,e){const i=e>1.5?.25:.5;return t<1/(2*i)?1:i}(dt(i,r),s),f=u*d,_=h*d,p=e.ensureAccumulateFBO(n,f,_);n.blitFramebuffer(o,p,0,0,o.width,o.height,0,0,p.width,p.height,P.hn.STENCIL_BUFFER_BIT,P.Cj.NEAREST),n.bindFramebuffer(p),n.setViewport(0,0,p.width,p.height),n.setColorMask(!0,!0,!0,!0),n.setClearColor(0,0,0,0),n.clear(P.hn.COLOR_BUFFER_BIT),this._isBound=!0}},dotDensity:new class extends o{constructor(){super(...arguments),this.type=l.N.DotDensity,this.shaders={polygon:new T,point:new y,fill:new V.z},this._resources=new Map}render(t,e){(0,a.dJ)(t)||(0,a.Eq)(t)?this._renderPolygons(t,e):this._renderDotDensity(t,e)}_renderPolygons(t,e){const{painter:i}=t;i.setShader({shader:this.shaders.fill,uniforms:{...(0,a.QA)(t,e.target),visualVariableColor:null,visualVariableOpacity:null},defines:{...(0,a.vT)(t)},optionalAttributes:{zoomRange:!1},useComputeBuffer:(0,a.Eq)(t)}),i.setPipelineState((0,a.Qu)(t)),i.submitDraw(t,e)}_renderDotDensity(t,e){const{context:i,painter:r,requiredLevel:s}=t,o=e.instance.getInput().uniforms,l=this._getOrCreateResourcesRecord(i),c=l.getDotDensityTextures(i,n.CQ,o.seed),u=1/2**(s-e.target.key.level),h=n.CQ,d=h*window.devicePixelRatio*h*window.devicePixelRatio,f=1/u*(1/u),_=o.dotScale?t.state.scale/o.dotScale:1,p=o.dotValue*_*f;r.setShader({shader:this.shaders.polygon,uniforms:{...(0,a.QA)(t,e.target),instance:{isActive:o.isActive,colors:o.colors,dotValue:Math.max(1,p)},draw:{dotTexture0:{unit:n.Cp,texture:c[0]},dotTexture1:{unit:n.vN,texture:c[1]},tileZoomFactor:u,pixelRatio:window.devicePixelRatio,tileDotsOverArea:d/(n.CQ*window.devicePixelRatio*n.CQ*window.devicePixelRatio)}},defines:{...(0,a.vT)(t),blending:o.blending},optionalAttributes:{},useComputeBuffer:!1}),r.setPipelineState((0,a.Qu)(t));const m=i.getViewport();i.setViewport(0,0,n.CQ,n.CQ);const g=i.getBoundFramebufferObject(),y=l.getFBO(i);i.bindFramebuffer(y),i.setClearColor(0,0,0,0),r.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}),r.updatePipelineState(i),i.clear(P.hn.COLOR_BUFFER_BIT),r.submitDraw(t,e),i.bindFramebuffer(g),i.setViewport(m.x,m.y,m.width,m.height);const v=l.getFBO(i).colorTexture;r.setShader({shader:this.shaders.point,uniforms:{view:(0,a.L4)(t,e.target),instance:{dotSize:o.dotSize},draw:{locations:{unit:n.Cp,texture:v},tileZoomFactor:1,pixelRatio:window.devicePixelRatio}},defines:{...(0,a.vT)(t)},optionalAttributes:{},useComputeBuffer:!1}),r.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}),r.submitDrawMesh(i,l.getDotDensityMesh(i))}shutdown(t){super.shutdown(t),this._resources.get(t)?.destroy(),this._resources.delete(t)}_getOrCreateResourcesRecord(t){let e=this._resources.get(t);return null==e&&(e=new k,this._resources.set(t,e)),e}}};function $t(){for(const t in Xt)Xt[t].startup()}function jt(t){for(const e in Xt)Xt[e].shutdown(t)}},81728:function(t,e,i){var n;i.d(e,{N:function(){return n}}),function(t){t[t.Fill=0]="Fill",t[t.PatternFill=1]="PatternFill",t[t.ComplexFill=2]="ComplexFill",t[t.OutlineFill=3]="OutlineFill",t[t.PatternOutlineFill=4]="PatternOutlineFill",t[t.ComplexOutlineFill=5]="ComplexOutlineFill",t[t.Marker=6]="Marker",t[t.PieChart=7]="PieChart",t[t.Line=8]="Line",t[t.TexturedLine=9]="TexturedLine",t[t.Text=10]="Text",t[t.Label=11]="Label",t[t.Heatmap=12]="Heatmap",t[t.DotDensity=13]="DotDensity",t[t.Test=14]="Test"}(n||(n={}))},56791:function(t,e,i){i.d(e,{k:function(){return o}});var n=i(31654),r=i(85456);const s={createComputedParams:t=>t,optionalAttributes:{},attributes:{id:{type:r.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:r.pe.UNSIGNED_BYTE,count:1},pos:{type:r.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},inverseArea:{type:r.pe.FLOAT,count:1,packTessellation:({inverseArea:t})=>t}}};class o extends n.N{constructor(){super(...arguments),this.vertexSpec=s}createTesselationParams(t){return{inverseArea:1/t.readGeometryArea()}}}},86847:function(t,e,i){i.d(e,{Eq:function(){return d},L4:function(){return u},Pr:function(){return v},QA:function(){return m},Qu:function(){return y},dJ:function(){return h},r3:function(){return p},vT:function(){return g}});var n=i(62938),r=i(39686),s=i(28230),o=i(85456);const a={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:{write:!1,test:{ref:t=>t.stencilRef,compare:o.MT.EQUAL,mask:255,op:{fail:o.eA.KEEP,zFail:o.eA.KEEP,zPass:o.eA.REPLACE}}}},l={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:!1},c={...a,color:{write:[!0,!0,!0,!0],blendMode:"delete"}};function u({pixelRatio:t,state:e,displayLevel:i,requiredLevel:r},s){const o=1/2**(i-s.key.level),a=1/2**(r-s.key.level);return{displayMat3:Array.from(e.displayMat3),displayViewMat3:Array.from(e.displayViewMat3),displayViewScreenMat3:Array.from(s.transforms.displayViewScreenMat3),viewMat3:Array.from(e.viewMat3),tileMat3:Array.from(s.transforms.tileMat3),displayZoomFactor:o,requiredZoomFactor:a,tileOffset:[s.x,s.y],currentScale:e.scale,currentZoom:i,metersPerSRUnit:(0,n.GA)(e.spatialReference),rotation:e.rotation,pixelRatio:t}}function h(t){return"highlight"===t.passOptions?.type}function d(t){return"hittest"===t.passOptions?.type}function f(t){if(!d(t))return null;const{position:e,distance:i,smallSymbolDistance:n,smallSymbolSizeThreshold:r}=t.passOptions;return{position:e,distance:i,smallSymbolDistance:n,smallSymbolSizeThreshold:r}}function _(t){if(!h(t))return null;const{activeReasons:e,highlightAll:i}=t.passOptions;return{activeReasons:e,highlightAll:i?1:0}}function p(t,e,i){const n={};for(const r in i)i[r]instanceof Function?n[r]=i[r](t,e):n[r]=i[r];return n}function m(t,e){const{attributeView:i,context:n}=t;return{storage:i.getUniforms(n),view:u(t,e),hittestRequest:f(t),highlight:_(t)}}function g(t){return{inside:t.selection===s.RI.InsideEffect,outside:t.selection===s.RI.OutsideEffect}}function y(t){return d(t)?l:h(t)&&"clear"===t.passOptions.stepType?c:a}function v(t){const{row:e,col:i}=t.key,n=i*r.CQ,s=e*r.CQ;return{tileOffsetFromLocalOrigin:[n%r.YV,s%r.YV],maxIntsToLocalOrigin:[Math.floor(n/r.YV),Math.floor(s/r.YV)]}}},31654:function(t,e,i){i.d(e,{N:function(){return l}});var n=i(58941),r=i(81484),s=i(69825),o=i(54601);const a=(0,n.A)("featurelayer-fast-triangulation-enabled");class l extends o.r{async loadDependencies(){await Promise.all([super.loadDependencies(),(0,r.F)()])}_write(t,e,i){const n=i?.asOptimized()??e.readGeometryForDisplay(),r=this._clip(n);r&&(t.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(t,e,r),t.recordEnd())}_clip(t){if(!t)return null;const e=this.hasEffects;return(0,s.FE)(t,e?256:8)}_writeGeometry(t,e,i){const n=i.maxLength>100,r=[],o=this.createTesselationParams(e);if(!n&&a&&(0,s.lO)(r,i))return void(r.length&&this._writeVertices(t,e,i.coords,o,r));const l=(0,s.XZ)(i);this._writeVertices(t,e,l,o)}_writeVertices(t,e,i,n,r){const s=e.getDisplayId(),o=t.vertexCount(),a=this.hasEffects;let l=0;if(r)for(const e of r){const r=i[2*e],o=i[2*e+1];a&&t.recordBounds(r,o,0,0),this._writeVertex(t,s,r,o,n),l++}else for(let e=0;e<i.length;e+=2){const r=Math.round(i[e]),o=Math.round(i[e+1]);a&&t.recordBounds(r,o,0,0),this._writeVertex(t,s,r,o,n),l++}t.indexEnsureSize(l);for(let e=0;e<l;e++)t.indexWrite(e+o)}}},46869:function(t,e,i){i.d(e,{KE:function(){return d},KI:function(){return u},lB:function(){return h},oI:function(){return c}});var n=i(13520),r=i(7056),s=i(54417),o=i(83919),a=i(40846),l=i(85456);function c(t){const{sprite:e,aspectRatio:i,scaleProportionally:r}=t,s=(0,n.Lz)(t.height),o=s>0?s:e.height;let a=s*i;return a<=0?a=e.width:r&&(a*=e.width/e.height),{width:a,height:o}}function u(t){const{applyRandomOffset:e,sampleAlphaOnly:i}=t;return(0,s.xo)([[a.Fz,e],[a.cn,i]])}const h={createComputedParams:t=>t,optionalAttributes:o.l.optionalAttributes,attributes:{...o.l.attributes,bitset:{count:1,type:l.pe.UNSIGNED_BYTE,pack:u},width:{count:1,type:l.pe.HALF_FLOAT,pack:t=>c(t).width},height:{count:1,type:l.pe.HALF_FLOAT,pack:t=>c(t).height},offset:{count:2,type:l.pe.HALF_FLOAT,pack:({offsetX:t,offsetY:e})=>[(0,n.Lz)(t),-(0,n.Lz)(e)]},scale:{count:2,type:l.pe.UNSIGNED_BYTE,packPrecisionFactor:16,pack:({scaleX:t,scaleY:e})=>[t,e]},angle:{count:1,type:l.pe.UNSIGNED_BYTE,pack:({angle:t})=>(0,r.wV)(t)}}};class d extends o.m{constructor(){super(...arguments),this.vertexSpec=h}}},57413:function(t,e,i){i.d(e,{O:function(){return m}});var n=i(13520),r=i(33134),s=i(46869),o=i(54417),a=i(31859),l=i(47461),c=i(40846),u=i(85456);const h=s.lB,d=a.e4,f={createComputedParams:t=>t,optionalAttributes:h.optionalAttributes,attributes:{...h.attributes,bitset:{type:u.pe.UNSIGNED_BYTE,count:1,pack:t=>(0,s.KI)(t)},aux1:{count:1,type:u.pe.HALF_FLOAT,pack:t=>(0,s.oI)(t).width},aux2:{count:1,type:u.pe.HALF_FLOAT,pack:t=>(0,s.oI)(t).height},aux3:{count:2,type:u.pe.HALF_FLOAT,pack:({offsetX:t,offsetY:e})=>[(0,n.Lz)(t),(0,n.Lz)(e)]},aux4:{count:2,type:u.pe.UNSIGNED_BYTE,pack:({scaleX:t,scaleY:e})=>[t*l.cZ,e*l.cZ]}}},_={createComputedParams:t=>t,optionalAttributes:h.optionalAttributes,attributes:{...h.attributes,color:d.attributes.color,bitset:{type:u.pe.UNSIGNED_BYTE,count:1,pack:t=>(0,o.xo)([[c.Xx,!0]])},aux1:{count:1,type:u.pe.HALF_FLOAT,pack:t=>(0,n.Lz)(.5*t.width)},aux2:{count:1,type:u.pe.HALF_FLOAT,pack:t=>(0,n.Lz)(.5*t.referenceWidth)},aux3:{count:2,type:u.pe.HALF_FLOAT,packTessellation:({extrusionOffsetX:t,extrusionOffsetY:e})=>[t,e]},aux4:{count:2,type:u.pe.UNSIGNED_BYTE,packTessellation:({normalX:t,normalY:e})=>[t*l.cZ+l.v9,e*l.cZ+l.v9]}}};class p extends a.eY{constructor(){super(...arguments),this.vertexSpec=_}}class m extends a.w0{constructor(){super(...arguments),this.vertexSpec=f}_createOutlineWriter(t,e,i,n){return new p(t,e,i,n)}_write(t,e,i){const n=i?.asOptimized()??e.readGeometryForDisplay(),s=this._clip(n);if(!s)return;const o=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,o),this._writeGeometry(t,e,s),this._lineMeshWriter.writeLineVertices(t,r.z.fromOptimizedCIM(s,"esriGeometryPolyline"),e),t.recordEnd()}ensurePacked(t,e,i){super.ensurePacked(t,e,i),this._lineMeshWriter.ensurePacked(t,e,i)}enqueueRequest(t,e,i){super.enqueueRequest(t,e,i),this._lineMeshWriter.enqueueRequest(t,e,i)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}},28615:function(t,e,i){i.d(e,{Y:function(){return l},v:function(){return a}});var n=i(39686),r=i(31654),s=i(54417),o=i(85456);const a={createComputedParams:t=>t,optionalAttributes:{zoomRange:{type:o.pe.SHORT,count:2,packPrecisionFactor:n.fq,pack:({scaleInfo:t},{tileInfo:e})=>(0,s.My)(t,e)}},attributes:{id:{type:o.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:o.pe.UNSIGNED_BYTE,count:1},pos:{type:o.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},color:{type:o.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:t})=>(0,s.Jb)(t)}}};class l extends r.N{constructor(){super(...arguments),this.vertexSpec=a}createTesselationParams(t){return null}}},31859:function(t,e,i){i.d(e,{Lm:function(){return h},e4:function(){return d},eY:function(){return f},w0:function(){return _}});var n=i(33134),r=i(69825),s=i(28615),o=i(54417),a=i(67293),l=i(25731),c=i(40846),u=i(85456);const h={createComputedParams:t=>t,optionalAttributes:a.Eq.optionalAttributes,attributes:{...a.Eq.attributes,bitset:{type:u.pe.UNSIGNED_BYTE,count:1,pack:t=>0},color:{type:u.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:t})=>(0,o.Jb)(t)}}},d={createComputedParams:t=>t,optionalAttributes:a.Eq.optionalAttributes,attributes:{...a.Eq.attributes,bitset:{type:u.pe.UNSIGNED_BYTE,count:1,pack:t=>(0,o.xo)([[c.Xx,!0]])},color:{type:u.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:t})=>(0,o.Jb)(t)}}};class f extends a.Bw{constructor(){super(...arguments),this.vertexSpec=d}}class _ extends s.Y{constructor(t,e,i,n){super(t,e,i,n),this.vertexSpec=h,this._lineMeshWriter=this._createOutlineWriter(t,e,i,n)}_createOutlineWriter(t,e,i,n){return new f(t,e,i,n)}_write(t,e,i){const r=i?.asOptimized()??e.readGeometryForDisplay(),s=this._clip(r);s&&(t.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(t,e,s),this._lineMeshWriter.writeLineVertices(t,n.z.fromOptimizedCIM(s,"esriGeometryPolyline"),e),t.recordEnd())}_clip(t){return t?(0,r.FE)(t,(0,l.Z0)(this.evaluatedMeshParams)):null}ensurePacked(t,e,i){super.ensurePacked(t,e,i),this._lineMeshWriter.ensurePacked(t,e,i)}enqueueRequest(t,e,i){super.enqueueRequest(t,e,i),this._lineMeshWriter.enqueueRequest(t,e,i)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}},83919:function(t,e,i){i.d(e,{l:function(){return o},m:function(){return a}});var n=i(39686),r=i(28615),s=i(85456);const o={createComputedParams:t=>t,optionalAttributes:r.v.optionalAttributes,attributes:{...r.v.attributes,tlbr:{count:4,type:s.pe.UNSIGNED_SHORT,pack:({sprite:t})=>{const{rect:e,width:i,height:r}=t,s=e.x+n.hM,o=e.y+n.hM;return[s,o,s+i,o+r]}},inverseRasterizationScale:{count:1,type:s.pe.BYTE,packPrecisionFactor:16,pack:({sprite:t})=>1/t.rasterizationScale}}};class a extends r.Y{constructor(){super(...arguments),this.vertexSpec=o}_write(t,e,i){const n=i?.asOptimized()??e.readGeometryForDisplay(),r=this._clip(n);if(!r)return;const s=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,s),this._writeGeometry(t,e,r),t.recordEnd()}}},21099:function(t,e,i){i.d(e,{Q:function(){return c}});var n=i(33134),r=i(31859),s=i(83919);const o={optionalAttributes:s.l.optionalAttributes,createComputedParams:t=>t,attributes:{...s.l.attributes,...r.Lm.attributes}},a={optionalAttributes:s.l.optionalAttributes,createComputedParams:t=>t,attributes:{...s.l.attributes,...r.e4.attributes}};class l extends r.eY{constructor(){super(...arguments),this.vertexSpec=a}}class c extends r.w0{constructor(){super(...arguments),this.vertexSpec=o}_createOutlineWriter(t,e,i,n){return new l(t,e,i,n)}_write(t,e,i){const r=i?.asOptimized()??e.readGeometryForDisplay(),s=this._clip(r);if(!s)return;const o=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,o),this._writeGeometry(t,e,s),this._lineMeshWriter.writeLineVertices(t,n.z.fromOptimizedCIM(s,"esriGeometryPolyline"),e),t.recordEnd()}ensurePacked(t,e,i){super.ensurePacked(t,e,i),this._lineMeshWriter.ensurePacked(t,e,i)}enqueueRequest(t,e,i){super.enqueueRequest(t,e,i),this._lineMeshWriter.enqueueRequest(t,e,i)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}},54417:function(t,e,i){i.d(e,{By:function(){return g},Jb:function(){return f},My:function(){return u},i8:function(){return m},mR:function(){return h},qE:function(){return p},ue:function(){return _},xo:function(){return d}});var n=i(52874),r=i(39819),s=i(40633),o=i(33389);const a=()=>s.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.meshWriterUtils"),l=0,c=100;function u(t,e){return[!!t?.minScale&&e.scaleToZoom(t.minScale)||l,!!t?.maxScale&&e.scaleToZoom(t.maxScale)||c]}function h(t){return 1<<t}function d(t){let e=0;for(const[i,n]of t)n&&(e|=1<<i);return e}function f(t){let e;if(!t)return[0,0,0,0];if("string"==typeof t){const i=n.A.fromString(t);if(!i)return a().errorOnce(new r.A("mapview:mesh-processing","Unable to parse string into color",{color:t})),[0,0,0,0];e=i.toArray()}else e=t;const[i,s,o,l]=e;return[i*(l/255),s*(l/255),o*(l/255),l]}function _(t){switch(t){case"butt":case o.uT.Butt:return o.xR.BUTT;case"round":case o.uT.Round:return o.xR.ROUND;case"square":case o.uT.Square:return o.xR.SQUARE}}function p(t){switch(t){case"bevel":case o.wd.Bevel:return o.JO.BEVEL;case"miter":case o.wd.Miter:return o.JO.MITER;case"round":case o.wd.Round:return o.JO.ROUND}}function m(t,e){return Math.round(Math.min(Math.sqrt(t*e),255))}function g(t,e){return Math.round(t*e)/e}},37463:function(t,e,i){i.d(e,{h:function(){return o}});var n=i(54601),r=i(85456);const s={createComputedParams:t=>t,optionalAttributes:{},attributes:{pos:{type:r.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:r.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:r.pe.UNSIGNED_BYTE,count:1},offset:{type:r.pe.BYTE,count:2,packAlternating:{count:4,pack:()=>[[-1,-1],[1,-1],[-1,1],[1,1]]}}}};class o extends n.r{constructor(){super(...arguments),this.vertexSpec=s}_write(t,e){t.recordStart(this.instanceId,this.attributeLayout);const i=e.getDisplayId();if("esriGeometryPoint"===e.geometryType){const n=e.readXForDisplay(),r=e.readYForDisplay();this._writeQuad(t,i,n,r)}else if("esriGeometryMultipoint"===e.geometryType){const n=e.readGeometryForDisplay();n?.forEachVertex(((e,n)=>{e>=0&&e<=512&&n>=0&&n<=512&&this._writeQuad(t,i,e,n)}))}t.recordEnd()}_writeQuad(t,e,i,n){const r=t.vertexCount();this._writeVertex(t,e,i,n),t.indexWrite(r+0),t.indexWrite(r+1),t.indexWrite(r+2),t.indexWrite(r+1),t.indexWrite(r+3),t.indexWrite(r+2)}}},67293:function(t,e,i){i.d(e,{Bw:function(){return p},Eq:function(){return f}});var n=i(13520),r=i(33134),s=i(39686),o=i(42542),a=i(69825),l=i(54417),c=i(54601),u=i(25731),h=i(85456);class d{constructor(){this.extrusionOffsetX=0,this.extrusionOffsetY=0,this.normalX=0,this.normalY=0,this.directionX=0,this.directionY=0,this.distance=0}}const f={createComputedParams:t=>t,optionalAttributes:{zoomRange:{type:h.pe.SHORT,count:2,packPrecisionFactor:s.fq,pack:({scaleInfo:t},{tileInfo:e})=>(0,l.My)(t,e)}},attributes:{id:{type:h.pe.UNSIGNED_BYTE,count:3,pack:"id"},pos:{type:h.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},bitset:{type:h.pe.UNSIGNED_BYTE,count:1},color:{type:h.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:t})=>(0,l.Jb)(t)},offset:{type:h.pe.BYTE,count:2,packPrecisionFactor:16,packTessellation:({extrusionOffsetX:t,extrusionOffsetY:e})=>[(0,l.By)(t,16),(0,l.By)(e,16)]},normal:{type:h.pe.BYTE,count:2,packPrecisionFactor:16,packTessellation:({normalX:t,normalY:e})=>[(0,l.By)(t,16),(0,l.By)(e,16)]},halfWidth:{type:h.pe.HALF_FLOAT,count:1,pack:({width:t})=>(0,n.Lz)(.5*t)},referenceHalfWidth:{type:h.pe.HALF_FLOAT,count:1,pack:({referenceWidth:t})=>(0,n.Lz)(.5*t)}}};class _{constructor(){this.id=0,this.bitset=0,this.indexCount=0,this.vertexCount=0,this.vertexFrom=0,this.vertexBounds=0}}class p extends c.r{constructor(t,e,i,n){super(t,e,i,n),this.vertexSpec=f,this._currentWrite=new _,this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0,wrapDistance:65535,textured:!1},this._tessParams=new d,this._initializeTessellator()}writeLineVertices(t,e,i){const n=this._getLines(e);null!=n&&this._writeVertices(t,i,n)}_initializeTessellator(){this._lineTessellator=new o.i(this._writeTesselatedVertex.bind(this),this._writeTriangle.bind(this),!0)}_write(t,e,i){const n=i??r.z.fromFeatureSetReaderCIM(e);n&&this._writeGeometry(t,e,n)}_writeGeometry(t,e,i,n){t.recordStart(this.instanceId,this.attributeLayout,n),this.writeLineVertices(t,i,e),t.recordEnd()}_getLines(t){return(0,a.uS)(t,(0,u.Z0)(this.evaluatedMeshParams))}_writeVertices(t,e,i){const{_currentWrite:r,_tessellationOptions:o,evaluatedMeshParams:a}=this,{width:c,capType:u,joinType:h,miterLimit:d,hasSizeVV:f}=a,_=(0,n.Lz)(.5*c);o.halfWidth=_,o.capType=(0,l.ue)(u),o.joinType=(0,l.qE)(h),o.miterLimit=d;const p=!f;r.out=t,r.id=e.getDisplayId(),r.vertexCount=0,r.indexCount=0,r.vertexFrom=t.vertexCount(),r.vertexBounds=p&&_<s.Gh?0:1;for(const{line:t,start:e}of i)o.initialDistance=e%65535,this._lineTessellator.tessellate(t,o,p)}_writeTesselatedVertex(t,e,i,n,r,s,o,a,l,c,u){const{out:h,id:d,vertexBounds:f}=this._currentWrite;return this.hasEffects&&h.recordBounds(t,e,f,f),this._tessParams.extrusionOffsetX=o,this._tessParams.extrusionOffsetY=a,this._tessParams.normalX=l,this._tessParams.normalY=c,this._tessParams.directionX=r,this._tessParams.directionY=s,this._tessParams.distance=u,this._writeVertex(h,d,t,e,this._tessParams),this._currentWrite.vertexFrom+this._currentWrite.vertexCount++}_writeTriangle(t,e,i){const{out:n}=this._currentWrite;n.indexEnsureSize(3),n.indexWrite(t),n.indexWrite(e),n.indexWrite(i),this._currentWrite.indexCount+=3}}},63124:function(t,e,i){i.d(e,{K:function(){return u}});var n=i(33134),r=i(39686),s=i(54417),o=i(67293),a=i(40846),l=i(85456);const c={createComputedParams:t=>t,optionalAttributes:o.Eq.optionalAttributes,attributes:{...o.Eq.attributes,bitset:{type:l.pe.UNSIGNED_BYTE,count:1,pack:({shouldSampleAlphaOnly:t,shouldScaleDash:e,isSDF:i})=>(0,s.xo)([[a.cn,t],[a.kx,e],[a.b5,i]])},tlbr:{type:l.pe.UNSIGNED_SHORT,count:4,pack:({sprite:t})=>{const{rect:e,width:i,height:n}=t,s=e.x+r.hM,o=e.y+r.hM;return[s,o,s+i,o+n]}},accumulatedDistance:{type:l.pe.UNSIGNED_SHORT,count:1,packTessellation:({distance:t})=>t},segmentDirection:{type:l.pe.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:t,directionY:e})=>[t,e]}}};class u extends o.Bw{constructor(t,e,i,n){super(t,e,i,n),this.vertexSpec=c,this._tessellationOptions.textured=!0}_write(t,e,i){const r=i??n.z.fromFeatureSetReaderCIM(e);if(!r)return;const{sprite:s}=this.evaluatedMeshParams;this._writeGeometry(t,e,r,s?.textureBinding)}}},82806:function(t,e,i){i.d(e,{H:function(){return b}});var n=i(13520),r=i(67348),s=i(10793),o=i(13786),a=i(33134),l=i(2014),c=i(33389),u=i(84646),h=i(39686),d=i(54417),f=i(7590);class _{static from(t){return"width"in t?this.fromSimpleMeshParams(t):this.fromComplexMeshParams(t)}static fromSimpleMeshParams(t){const e=new _(t.sprite,t.color,t.outlineColor,t.minPixelBuffer,t.placement,t.scaleInfo,t.effects),{type:i,width:r,height:s,angle:o,alignment:a,outlineSize:l,referenceSize:c,sprite:u,overrideOutlineColor:h}=t;return e.rawWidth=(0,n.Lz)(r),e.rawHeight=(0,n.Lz)(s),e.angle=o,e.alignment=a,e.outlineSize=(0,n.Lz)(l),e.referenceSize=(0,n.Lz)(c),e.overrideOutlineColor=h,e.offsetX=(0,n.Lz)(t.offsetX),e.offsetY=(0,n.Lz)(t.offsetY),"simple"!==i||u.sdf||(e.rawWidth=u.width,e.rawHeight=u.height),e.sizeRatio=u.sdf?2:1,e._computeSize(t,!1),e}static fromComplexMeshParams(t){const e=new _(t.sprite,t.color,t.outlineColor,t.minPixelBuffer,t.placement,t.scaleInfo,t.effects);let{alignment:i,transforms:r,size:s,scaleX:o,anchorX:a,anchorY:l,angle:c,colorLocked:u,frameHeight:h,widthRatio:d,offsetX:p,offsetY:m,outlineSize:g,referenceSize:y,scaleFactor:v,sizeRatio:x,isAbsoluteAnchorPoint:b,rotateClockwise:S,scaleSymbolsProportionally:w,sprite:T}=t;if(r&&r.infos.length>0){const t=(0,f.zb)(s,c,S,p,m,r);s=t.size,c=t.rotation,p=t.offsetX,m=t.offsetY,S=!1}v&&(s*=v,p*=v,m*=v);const M=o*(T.width/T.height);e.alignment=i,e.rawHeight=(0,n.Lz)(s),e.rawWidth=e.rawHeight*M,e.referenceSize=(0,n.Lz)(y),e.sizeRatio=x,e.angle=c,e.rotateClockwise=S,e.anchorX=a,e.anchorY=l,e.offsetX=(0,n.Lz)(p),e.offsetY=(0,n.Lz)(m),b&&s&&(T.sdf?e.anchorX=a/(s*d):e.anchorX=a/(s*M),e.anchorY=l/s);const P=w&&h?s/h:1;return e.outlineSize=0===g||isNaN(g)?0:(0,n.Lz)(g)*P,e.scaleSymbolsProportionally=w,e.colorLocked=u,e._computeSize(t,!0),e}constructor(t,e,i,n,r,s,o){this.sprite=t,this.color=e,this.outlineColor=i,this.minPixelBuffer=n,this.placement=r,this.scaleInfo=s,this.effects=o,this.rawWidth=0,this.rawHeight=0,this.angle=0,this.outlineSize=0,this.referenceSize=0,this.sizeRatio=1,this.alignment=c.C1.SCREEN,this.scaleSymbolsProportionally=!1,this.overrideOutlineColor=!1,this.colorLocked=!1,this.anchorX=0,this.anchorY=0,this.computedWidth=0,this.computedHeight=0,this.texXmin=0,this.texYmin=0,this.texXmax=0,this.texYmax=0,this.offsetX=0,this.offsetY=0,this.rotateClockwise=!0}get boundsInfo(){return{size:Math.max(this.computedHeight,this.computedWidth),offsetX:this.offsetX,offsetY:this.offsetY}}_computeSize(t,e){const{sprite:i,hasSizeVV:n}=t,r=!!i.sdf,{rawWidth:s,rawHeight:o,sizeRatio:a,outlineSize:l}=this,c=s*a,u=o*a;if(r&&!n){const t=e&&s>o?c:s,i=o,n=l+2;this.computedWidth=Math.min(t+n,c),this.computedHeight=Math.min(i+n,u)}else this.computedWidth=c,this.computedHeight=u;const d=r?Math.max(i.width,i.height)/Math.max(c,u):1,f=.5*(c-this.computedWidth)*d,_=.5*(u-this.computedHeight)*d,p=i.rect.x+h.hM+f,m=i.rect.y+h.hM+_,g=p+i.width-2*f,y=m+i.height-2*_;this.texXmin=Math.floor(p),this.texYmin=Math.floor(m),this.texXmax=Math.ceil(g),this.texYmax=Math.ceil(y),this.computedWidth*=(this.texXmax-this.texXmin)/(g-p),this.computedHeight*=(this.texYmax-this.texYmin)/(y-m),this.anchorX*=c/this.computedWidth,this.anchorY*=u/this.computedHeight}}var p=i(97473),m=i(68758),g=i(54601),y=i(85456);const v=128/Math.PI;const x={createComputedParams:t=>_.from(t),optionalAttributes:{zoomRange:{type:y.pe.SHORT,count:2,packPrecisionFactor:h.fq,pack:({scaleInfo:t},{tileInfo:e})=>(0,d.My)(t,e)}},attributes:{pos:{type:y.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:y.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:y.pe.UNSIGNED_BYTE,count:1,pack:({sprite:t,alignment:e,scaleSymbolsProportionally:i,overrideOutlineColor:n,colorLocked:r})=>{let s=0;return t.sdf&&(s|=(0,d.mR)(p.c.bitset.isSDF)),e===c.C1.MAP&&(s|=(0,d.mR)(p.c.bitset.isMapAligned)),i&&(s|=(0,d.mR)(p.c.bitset.scaleSymbolsProportionally)),n&&(s|=(0,d.mR)(p.c.bitset.overrideOutlineColor)),r&&(s|=(0,d.mR)(p.c.bitset.colorLocked)),s}},offset:{type:y.pe.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({angle:t,computedWidth:e,computedHeight:i,anchorX:n,anchorY:a,offsetX:l,offsetY:c,rotateClockwise:u})=>{const h=function(t,e,i,n,o=!1){const a=(0,s.vt)(),l=o?1:-1;return(0,r.D_)(a),(e||i)&&(0,r.Tl)(a,a,[e,-i]),n&&(0,r.e$)(a,a,.017453292519944444*l*-n),a}(0,l,c,-t,u),d=-(.5+n)*e,f=-(.5-a)*i,_=[d,f],p=[d+e,f],m=[d,f+i],g=[d+e,f+i];return(0,o.l0)(_,_,h),(0,o.l0)(p,p,h),(0,o.l0)(m,m,h),(0,o.l0)(g,g,h),[_,p,m,g]}}},textureUV:{type:y.pe.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({texXmax:t,texXmin:e,texYmax:i,texYmin:n})=>[[e,n],[t,n],[e,i],[t,i]]}},color:{type:y.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:t})=>(0,d.Jb)(t)},outlineColor:{type:y.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:t})=>(0,d.Jb)(t)},sizing:{type:y.pe.UNSIGNED_BYTE,count:4,pack:({rawWidth:t,rawHeight:e,outlineSize:i,referenceSize:n})=>{const r=Math.max(t,e);return[(0,d.i8)(r,128),(0,d.i8)(i,128),(0,d.i8)(n,128),0]}},placementAngle:{type:y.pe.UNSIGNED_BYTE,count:1,packTessellation:({placementAngle:t})=>function(t){return function(t,e){return t%=256,Math.abs(t>=0?t:t+256)}(t*v)}(t)},sizeRatio:{type:y.pe.UNSIGNED_SHORT,count:1,packPrecisionFactor:64,pack:({sizeRatio:t})=>t}}};class b extends g.r{constructor(){super(...arguments),this.vertexSpec=x}getBoundsInfo(){return this.evaluatedMeshParams.boundsInfo}_write(t,e,i){const n=this.evaluatedMeshParams.sprite?.textureBinding,r=e.getDisplayId();t.recordStart(this.instanceId,this.attributeLayout,n);const s=this.evaluatedMeshParams.minPixelBuffer,o=Math.max(this.evaluatedMeshParams.computedWidth,s),a=Math.max(this.evaluatedMeshParams.computedHeight,s),c=this.evaluatedMeshParams.offsetX,u=-this.evaluatedMeshParams.offsetY;if(null!=this.evaluatedMeshParams.placement)this._writePlacedMarkers(t,e,i,o,a);else if(i?.nextPath()){i.nextPoint();const e=i.x,n=i.y;t.recordBounds(e+c,n+u,o,a),this._writeQuad(t,r,e,n)}else if("esriGeometryPolygon"===e.geometryType){const i=e.readCentroidForDisplay();if(!i)return;const[n,s]=i.coords;t.recordBounds(n+c,s+u,o,a),this._writeQuad(t,r,n,s)}else if("esriGeometryPoint"===e.geometryType){const i=e.readXForDisplay(),n=e.readYForDisplay();t.recordBounds(i+c,n+u,o,a),this._writeQuad(t,r,i,n)}else{const i=e.readGeometryForDisplay();i?.forEachVertex(((e,i)=>{t.recordBounds(e+c,i+u,o,a),Math.abs(e)>l.s||Math.abs(i)>l.s||this._writeQuad(t,r,e,i)}))}t.recordEnd()}_writePlacedMarkers(t,e,i,r,s){const o=i??a.z.fromFeatureSetReaderCIM(e)?.clone();if(!o)return;const c=u.l.getPlacement(o,-1,this.evaluatedMeshParams.placement,(0,n.Lz)(1),t.id,(0,m.z)());if(!c)return;const h=e.getDisplayId();let d=c.next();const f=this.evaluatedMeshParams.offsetX,_=-this.evaluatedMeshParams.offsetY;for(;null!=d;){const e=d.tx,i=-d.ty;if(Math.abs(e)>l.s||Math.abs(i)>l.s){d=c.next();continue}const n=-d.getAngle();t.recordBounds(e+f,i+_,r,s),this._writeQuad(t,h,e,i,n),d=c.next()}}_writeQuad(t,e,i,n,r){const s=t.vertexCount(),o=null==r?null:{placementAngle:r};this._writeVertex(t,e,i,n,o),t.indexWrite(s+0),t.indexWrite(s+1),t.indexWrite(s+2),t.indexWrite(s+1),t.indexWrite(s+3),t.indexWrite(s+2)}}},97473:function(t,e,i){i.d(e,{c:function(){return n}});const n={bitset:{isSDF:0,isMapAligned:1,scaleSymbolsProportionally:2,overrideOutlineColor:3,colorLocked:4}}},54601:function(t,e,i){i.d(e,{r:function(){return f}});var n=i(33134),r=i(47072),s=i(68758),o=i(85475),a=(i(58941),i(25731)),l=i(85456);function c(t){switch(t){case l.pe.BYTE:case l.pe.UNSIGNED_BYTE:return 1;case l.pe.SHORT:case l.pe.UNSIGNED_SHORT:case l.pe.HALF_FLOAT:return 2;case l.pe.FLOAT:case l.pe.INT:case l.pe.UNSIGNED_INT:return 4}}class u{static fromVertexSpec(t,e){const{attributes:i,optionalAttributes:n}=t;let r,s,o;const a=[];for(const t in i){const e=i[t];"position"===e.pack?r={...e,name:t,offset:0}:"id"===e.pack?s={...e,name:t,offset:4}:"bitset"===t?o={...e,name:t,offset:7}:a.push({...e,name:t})}for(const t in n)if(!0===e[t]){const e=n[t];a.push({...e,name:t})}const l=function(t){const e=[],i=[],n=[];for(const r of t){const t=c(r.type)*r.count;switch(t%2||t%4||4){case 4:e.push(r);continue;case 2:i.push(r);continue;case 1:n.push(r);continue;default:throw new Error("Found unexpected dataType byte count")}}return e.push(...i),e.push(...n),e}(a),h=[];let d=8,f=1;for(const t of l)h.push({...t,offset:d}),d+=c(t.type)*t.count,t.packAlternating&&(f=Math.max(t.packAlternating.count,f));const _=Uint32Array.BYTES_PER_ELEMENT,p=d%_;return new u(r,s,o,h,d+(p?_-p:0),f)}constructor(t,e,i,n,r,s){this.position=t,this.id=e,this.bitset=i,this.standardAttributes=n,this.stride=r,this.packVertexCount=s,n.push(i),this._attributes=[t,e,i,...n]}get attributeLayout(){if(!this._attributeLayout){const t=(0,a.hU)(this._attributes),e=this._attributes.map((t=>({name:t.name,count:t.count,offset:t.offset,type:t.type,packPrecisionFactor:t.packPrecisionFactor,normalized:t.normalized??!1})));this._attributeLayout={attributes:e,hash:t,stride:this.stride}}return this._attributeLayout}}var h=i(5544);class d{static fromVertexSpec(t,e){const i=u.fromVertexSpec(t,e);return new d(i)}constructor(t){this._spec=t,this._packed=new Uint8Array(this._spec.stride*this._spec.packVertexCount),this._packedU32View=new Uint32Array(this._packed.buffer),this._dataView=new DataView(this._packed.buffer)}get attributeLayout(){return this._spec.attributeLayout}get stride(){return this._spec.stride}writeVertex(t,e,i,n,r,s){for(let t=0;t<this._spec.packVertexCount;t++){const o=t*this._spec.stride;this._packPosition(i,n,o),this._packId(e,o);const a=this._spec.bitset;if(s){if(a.packTessellation){const t=a.packTessellation(s,r);this._pack(t,a,o)}for(const t of this._spec.standardAttributes)if(null!=t.packTessellation){const e=t.packTessellation(s,r);this._pack(e,t,o)}else if(t.packAlternating?.packTessellation){const e=t.packAlternating.packTessellation(s,r);for(let i=0;i<this._spec.packVertexCount;i++){const n=e[i];this._pack(n,t,i*this._spec.stride)}}}}t.vertexWriteRegion(this._packedU32View)}pack(t,e){for(const i of this._spec.standardAttributes)if(i.pack&&"string"!=typeof i.pack){const n=i.pack(t,e);for(let t=0;t<this._spec.packVertexCount;t++)this._pack(n,i,t*this._spec.stride)}else if(i.packAlternating?.pack){const n=i.packAlternating.pack(t,e);for(let t=0;t<this._spec.packVertexCount;t++){const e=n[t];this._pack(e,i,t*this._spec.stride)}}}_packPosition(t,e,i){const{offset:n}=this._spec.position,r=this._spec.position.packPrecisionFactor??1,s=(0,o.M9)(t*r,e*r);this._dataView.setUint32(i+n,s,!0)}_packId(t,e){const i=t*(this._spec.id.packPrecisionFactor??1),n=4278190080&this._dataView.getUint32(e+this._spec.id.offset,!0);this._dataView.setUint32(e+this._spec.id.offset,i|n,!0)}_pack(t,e,i){(0,h.F)(this._dataView,t,e,i)}}class f{constructor(t,e,i,n){this._instanceId=t,this._evaluator=e,this._enabledOptionalAttributes=i,this._viewParams=n,this._evaluator.evaluator=t=>this.vertexSpec.createComputedParams(t)}get _vertexPack(){if(!this._cachedVertexPack){const t=d.fromVertexSpec(this.vertexSpec,this._enabledOptionalAttributes);this._evaluator.hasDynamicProperties||t.pack(this._evaluator.evaluatedMeshParams,this._viewParams),this._cachedVertexPack=t}return this._cachedVertexPack}get evaluatedMeshParams(){return this._evaluator.evaluatedMeshParams}get hasEffects(){return!!this.evaluatedMeshParams.effects}get instanceId(){return this._instanceId}get attributeLayout(){return this._vertexPack.attributeLayout}setReferences(t){this._references=t}getBoundsInfo(){return null}getTileInfo(){return this._viewParams.tileInfo}async loadDependencies(){(function(t){if(!t)return!1;for(const e of t)switch(e.effect.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1})(this._evaluator.inputMeshParams.effects?.effectInfos)&&await(0,s.R)()}enqueueRequest(t,e,i){this._evaluator.hasDynamicProperties&&this._evaluator.enqueueRequest(t,e,i)}write(t,e,i,o,a){this.ensurePacked(e,i,o);const l=this.evaluatedMeshParams.effects;if(!l||0===l.length)return void this._write(t,i,void 0,a);const c=i.readGeometryForDisplay()?.clone();if(!c)return;const u=n.z.fromOptimizedCIM(c,i.geometryType),h=(0,s.z)();u.invertY();const d=t.id||"",f=r.V.executeEffects(l,u,d,h);let _;for(;_=f.next();)_.invertY(),this._write(t,i,_,a)}ensurePacked(t,e,i){if(!this._evaluator.hasDynamicProperties)return;const n=this._evaluator.evaluateMeshParams(t,e,i);this._vertexPack.pack(n,this._viewParams)}_writeVertex(t,e,i,n,r){const s=this.evaluatedMeshParams;this._vertexPack.writeVertex(t,e,i,n,s,r)}}},23702:function(t,e,i){i.d(e,{o:function(){return rt}});var n=i(81728),r=i(56791),s=i(46869),o=i(57413),a=i(28615),l=i(31859),c=i(83919),u=i(21099),h=i(37463),d=i(25738),f=i(13520),_=i(67348),p=i(10793),m=i(13786),g=i(14583),y=i(1932),v=i(58081),x=i(76613),b=i(96564),S=i(7459),w=i(87573),T=i(57650),M=i(2014);function P(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function E(t,e){return Math.sqrt(t*t+e*e)}function A(t){const e=E(t[0],t[1]);t[0]/=e,t[1]/=e}function C(t,e){return E(t[0]-e[0],t[1]-e[1])}function I(t){return t.length-1}function R(t){let e=0;for(let i=0;i<I(t);i++)e+=O(t,i);return e}function O(t,e,i=1){let[n,r]=function(t,e){return t[e+1]}(t,e);return[n,r]=[Math.round(n),Math.round(r)],Math.sqrt(n*n+r*r)*i}class F{constructor(t,e,i,n,r){this._segments=t,this._index=e,this._distance=i,this._xStart=n,this._yStart=r,this._done=!1}static create(t){return new F(t,0,0,t[0][0],t[0][1])}clone(){return new F(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(t){return this._index===t._index||t._index===this._index-1&&(0===this._distance||1===t._distance)||t._index===this._index+1&&(1===this._distance||0===t._distance)}leq(t){return this._index<t._index||this._index===t._index&&this._distance<=t._distance}geq(t){return this._index>t._index||this._index===t._index&&this._distance>=t._distance}get _segment(){return this._segments[this._index+1]}get angle(){const t=this.dy,e=(0*t+-1*-this.dx)/(1*this.length);let i=Math.acos(e);return t>0&&(i=2*Math.PI-i),i}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const{dx:t,dy:e}=this;return Math.sqrt(t*t+e*e)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return this._index-1>=0}hasNext(){return this._index+1<I(this._segments)}next(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}prev(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}_seekBackwards(t,e){const i=this.backwardLength;if(t<=i)return this._distance=(i-t)/this.length,this;let n=this.backwardLength;for(;this.prev();){if(n+this.length>t)return this._seekBackwards(t-n);n+=this.length}return this._distance=0,e?this:null}seek(t,e=!1){if(t<0)return this._seekBackwards(Math.abs(t),e);if(t<=this.remainingLength)return this._distance=(this.backwardLength+t)/this.length,this;let i=this.remainingLength;for(;this.next();){if(i+this.length>t)return this.seek(t-i,e);i+=this.length}return this._distance=1,e?this:null}}function z(t,e,i,n=!0){const r=R(t),s=F.create(t),o=r/2;if(!n)return s.seek(o),void(Math.abs(s.x)<M.s&&Math.abs(s.y)<M.s&&i(s.clone(),0,o+0*e,r));const a=Math.max((r-e)/2,0),l=Math.floor(a/e),c=o-l*e;s.seek(c);for(let t=-l;t<=l;t++)Math.abs(s.x)<M.s&&Math.abs(s.y)<M.s&&i(s.clone(),t,o+t*e,r),s.seek(e)}function D(t,e){const i=e;for(let e=0;e<t.length;e++){let n=t[e];L(n,i);const r=[];r.push(n[0]);for(let t=1;t<n.length;t++){const[e,i]=n[t-1],[s,o]=n[t],a=s-e,l=o-i;r.push([a,l])}t[e]=r,n=r}return t}function L(t,e){const i=1e-6;if(e<=0)return;const n=t.length;if(n<3)return;const r=[];let s=0;r.push(0);for(let e=1;e<n;e++)s+=C(t[e],t[e-1]),r.push(s);e=Math.min(e,.2*s);const o=[];o.push(t[0][0]),o.push(t[0][1]);const a=t[n-1][0],l=t[n-1][1],c=P([0,0],t[0],t[1]);A(c),t[0][0]+=e*c[0],t[0][1]+=e*c[1],P(c,t[n-1],t[n-2]),A(c),t[n-1][0]+=e*c[0],t[n-1][1]+=e*c[1];for(let t=1;t<n;t++)r[t]+=e;r[n-1]+=e;const u=.5*e;for(let s=1;s<n-1;s++){let a=0,l=0,c=0;for(let n=s-1;n>=0&&!(r[n+1]<r[s]-u);n--){const o=u+r[n+1]-r[s],h=r[n+1]-r[n],d=r[s]-r[n]<u?1:o/h;if(Math.abs(d)<i)break;const f=d*d,_=d*o-.5*f*h,p=d*h/e,m=t[n+1],g=t[n][0]-m[0],y=t[n][1]-m[1];a+=p/_*(m[0]*d*o+.5*f*(o*g-h*m[0])-f*d*h*g/3),l+=p/_*(m[1]*d*o+.5*f*(o*y-h*m[1])-f*d*h*y/3),c+=p}for(let o=s+1;o<n&&!(r[o-1]>r[s]+u);o++){const n=u-r[o-1]+r[s],h=r[o]-r[o-1],d=r[o]-r[s]<u?1:n/h;if(Math.abs(d)<i)break;const f=d*d,_=d*n-.5*f*h,p=d*h/e,m=t[o-1],g=t[o][0]-m[0],y=t[o][1]-m[1];a+=p/_*(m[0]*d*n+.5*f*(n*g-h*m[0])-f*d*h*g/3),l+=p/_*(m[1]*d*n+.5*f*(n*y-h*m[1])-f*d*h*y/3),c+=p}o.push(a/c),o.push(l/c)}o.push(a),o.push(l);for(let e=0,i=0;e<n;e++)t[e][0]=o[i++],t[e][1]=o[i++]}var N=i(54417),B=i(53972);const k=(0,d.Bj)((t=>{let e=0;if(0===t)return 1/0;for(;!(t%2);)e++,t/=2;return e}));class V extends B.G8{constructor(){super(...arguments),this._zoomLevel=0}_write(t,e,i,n){if(this._zoomLevel=n||0,null!=i)throw new Error("InternalError: EffectGeometry not support for LabelMeshWriter");switch(e.geometryType){case"esriGeometryPoint":{const i=e.readXForDisplay(),n=e.readYForDisplay();return this._writePoint(t,i,n,e)}case"esriGeometryEnvelope":case"esriGeometryPolygon":case"esriGeometryMultipoint":{const i=e.readCentroidForDisplay();if(!i)return;const[n,r]=i.coords;return this._writePoint(t,n,r,e)}case"esriGeometryPolyline":this._writeLines(t,e)}}_writePoint(t,e,i,n){const r=this._getShaping();if(!r)return;let s=this._getPointReferenceBounds();s||(s={offsetX:0,offsetY:0,size:0});const o=r.boundsT,a=(0,b.xy)(this.evaluatedMeshParams.horizontalAlignment),l=(0,b.UD)(this.evaluatedMeshParams.verticalAlignment),c=this.evaluatedMeshParams.scaleInfo?.maxScale??0,u=this.evaluatedMeshParams.scaleInfo?.minScale??0,h=(0,S.Q4)(n.getDisplayId());t.metricStart(new T.f(h,e,i,a,l,c,u,s)),t.metricBoxWrite(o),this._writeGlyphs(t,n.getDisplayId(),e,i,r,0,s),t.metricEnd()}_getPointReferenceBounds(){if(!this._references)return null;for(const t of this._references){const e=t.getBoundsInfo();if(e)return e}return null}_writeLines(t,e){const{scaleInfo:i,verticalAlignment:n}=this.evaluatedMeshParams,r=this.evaluatedMeshParams.repeatLabelDistance||128,s=this._getShaping("middle");if(!s)return;const o=(t,e,i,n)=>this._placeSubdivGlyphs(t,e,i,n),a=(s.bounds.width+r)/2;this._current={out:t,id:e.getDisplayId(),shaping:s,zoomRange:(0,N.My)(i,this.getTileInfo()),referenceBounds:this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0},offsetDirection:null},this._verticalPlacement="bottom"===n?"above":"top"===n?"below":null,this._verticalPlacement?this._writeAboveAndBelowAlong(e,o,a):this._writeCenterAlong(e,o,a)}_writeAboveAndBelowAlong(t,e,i){const{repeatLabel:n,fontSize:r}=this.evaluatedMeshParams,{shaping:s}=this._current,o=(0,f.Lz)(r),a=t.readGeometryForDisplay();if(!a)return;const l=new x.A;(0,v.kz)(l,a,!1,!1,"esriGeometryPolyline",1);const c=U(new x.A,l,o),u=U(new x.A,l,-o),h=(0,v.zv)(u,"esriGeometryPolyline",!1,!1),d=D((0,v.zv)(c,"esriGeometryPolyline",!1,!1).paths,s.bounds.width),_=D(h.paths,s.bounds.width);this._current.offsetDirection="above";for(const t of d)z(t,i,e,!!n);this._current.offsetDirection="below";for(const t of _)z(t,i,e,!!n)}_writeCenterAlong(t,e,i){const{repeatLabel:n}=this.evaluatedMeshParams,{shaping:r}=this._current,s=D(t.readLegacyGeometryForDisplay().paths,r.bounds.width);for(const t of s)z(t,i,e,!!n)}_placeSubdivGlyphs(t,e,i,n){const{allowOverrun:r,labelPosition:s,repeatLabelDistance:o}=this.evaluatedMeshParams,a=this._current.zoomRange[0],l=k(e),c=this._current.shaping.bounds.width/2,u=Math.sqrt(o||128)/2,h=Math.min(i,n-i),d=this._current.shaping.isMultiline?B.GJ:Math.log2(h/(u+c/2)),f=0===e?d:Math.min(l,d),_=Math.max(a,this._zoomLevel+1-f),p=this._zoomLevel-_,m=this._current.shaping.bounds.width/2*2**p;this._current.shaping.isMultiline?0===e&&this._placeStraight(t,_):r&&p<0?this._placeStraightAlong(t,a):"parallel"===s?this._placeStraightAlong(t,_):"curved"===s&&this._placeCurved(t,_,m)}_placeStraight(t,e){const{out:i,id:n,shaping:r,referenceBounds:s}=this._current,{x:o,y:a}=t,l=(0,S.Q4)(n),c=this.evaluatedMeshParams.scaleInfo?.maxScale??0,u=this.evaluatedMeshParams.scaleInfo?.minScale??0;i.metricStart(new T.f(l,t.x,t.y,0,0,c,u,null)),i.metricBoxWrite(r.boundsT);const h=t.angle*(180/Math.PI)%360,d=(t.angle*(180/Math.PI)+180)%360;this._writeGlyphs(i,n,o,a,r,0,s,{clipAngle:h,mapAligned:!0,isLineLabel:!0,minZoom:e}),this._writeGlyphs(i,n,o,a,r,0,s,{clipAngle:d,mapAligned:!0,isLineLabel:!0,minZoom:e}),i.metricEnd()}_placeCurved(t,e,i){const{out:n,id:r}=this._current,s=t.clone(),o=t.angle*(180/Math.PI)%360,a=(t.angle*(180/Math.PI)+180)%360,l=(0,S.Q4)(r),c=this.evaluatedMeshParams.scaleInfo?.maxScale??0,u=this.evaluatedMeshParams.scaleInfo?.minScale??0;n.metricStart(new T.f(l,t.x,t.y,0,0,c,u,null)),this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||(this._placeFirst(s,e,1,o),this._placeBack(t,s,e,i,1,o),this._placeForward(t,s,e,i,1,o)),this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||(this._placeFirst(s,e,0,a),this._placeBack(t,s,e,i,0,a),this._placeForward(t,s,e,i,0,a)),n.metricEnd()}_placeStraightAlong(t,e){const{out:i,id:n,shaping:r,zoomRange:s,referenceBounds:o}=this._current,{boxBorderLineColor:a,boxBackgroundColor:l}=this.evaluatedMeshParams,c=t.clone(),u=t.angle*(180/Math.PI)%360,h=(t.angle*(180/Math.PI)+180)%360;if(r.glyphs.length>0&&(a||l)){const a=Math.max(e,s[0],0),l=Math.min(B.GJ,s[1]),c=(0,_.$0)((0,p.vt)(),-t.angle),d={minZoom:a,maxZoom:l,clipAngle:u,mapAligned:!0,isLineLabel:!0},m=(0,f.Lz)(this.evaluatedMeshParams.offsetX),y=(0,f.Lz)(this.evaluatedMeshParams.offsetY);if(!this._verticalPlacement||this._verticalPlacement===this._current.offsetDirection){const e=(0,g.fA)(m,-1*y),[s,a]=r.shapeBackground((0,_.Tl)((0,p.vt)(),c,e));i.recordStart(this.instanceId,this.attributeLayout,r.glyphs[0].textureBinding);const l=2*Math.max(s.width,s.height);i.recordBounds(t.x+s.x,t.y+s.y,l,l),this._writeTextBox(i,n,t.x,t.y,a,o,d),i.recordEnd()}if(!this._verticalPlacement||this._verticalPlacement!==this._current.offsetDirection){const e=(0,g.fA)(m,y),[s,a]=r.shapeBackground((0,_.Tl)((0,p.vt)(),c,e));d.clipAngle=h,i.recordStart(this.instanceId,this.attributeLayout,r.glyphs[0].textureBinding);const l=2*Math.max(s.width,s.height);i.recordBounds(t.x+s.x,t.y+s.y,l,l),this._writeTextBox(i,n,t.x,t.y,a,o,d),i.recordEnd()}}const d=(0,S.Q4)(n),m=this.evaluatedMeshParams.scaleInfo?.maxScale??0,y=this.evaluatedMeshParams.scaleInfo?.minScale??0;i.metricStart(new T.f(d,t.x,t.y,0,0,m,y,null)),this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||this._placeFirst(c,e,1,u,!0),this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||this._placeFirst(c,e,0,h,!0),i.metricEnd()}_placeBack(t,e,i,n,r,s){const o=t.clone();let a=t.backwardLength+0;for(;o.prev()&&!(a>=n);)this._placeOnSegment(o,e,a,i,-1,r,s),a+=o.length+0}_placeForward(t,e,i,n,r,s){const o=t.clone();let a=t.remainingLength+0;for(;o.next()&&!(a>=n);)this._placeOnSegment(o,e,a,i,1,r,s),a+=o.length+0}_placeFirst(t,e,i,n,r=!1){const{out:s,id:o,shaping:a,zoomRange:l,referenceBounds:c}=this._current,u=a.glyphs;for(const h of u){const u=h.x>a.bounds.x?i:1-i,d=u*t.remainingLength+(1-u)*t.backwardLength,f=Math.abs(h.x+h.width/2-a.bounds.x),_=Math.max(0,this._zoomLevel+Math.log2(f/(d+0))),p=Math.max(e,r?0:_);h.maxZoom=Math.min(l[1],B.GJ),h.angle=t.angle+(1-i)*Math.PI,h.minZoom=Math.max(l[0],p),this._writeLineGlyph(s,o,t.x,t.y,a.bounds,h,n,c,!0),i&&this._isVisible(h.minZoom,h.maxZoom)&&s.metricBoxWrite(h.bounds)}}_placeOnSegment(t,e,i,n,r,s,o){const{out:a,id:l,shaping:c,referenceBounds:u}=this._current,h=c.glyphs,d=t.dx/t.length,f=t.dy/t.length,_={x:t.x+i*-r*d,y:t.y+i*-r*f};for(const d of h){const h=d.x>c.bounds.x?s:1-s;if(!(h&&1===r||!h&&-1===r))continue;const f=Math.abs(d.x+d.width/2-c.bounds.x),p=Math.max(0,this._zoomLevel+Math.log2(f/i)-.1),m=Math.max(n,this._zoomLevel+Math.log2(f/(i+t.length+0)));if(0!==p&&(d.angle=t.angle+(1-s)*Math.PI,d.minZoom=m,d.maxZoom=p,this._writeLineGlyph(a,l,_.x,_.y,c.bounds,d,o,u,!0),s&&this._isVisible(d.minZoom,d.maxZoom))){const i=d.bounds,n=t.x-e.x,r=t.y-e.y,s=new w.A(i.center[0]+n,i.center[1]+r,i.width,i.height);a.metricBoxWrite(s)}}}_writeLineGlyph(t,e,i,n,r,s,o,a,l){const c=i+r.x,u=n+r.y,h=2*(this.evaluatedMeshParams.minPixelBuffer?this.evaluatedMeshParams.minPixelBuffer/this._textMeshTransformProps.fontSize:1),d=Math.max(r.width,r.height)*h;t.recordStart(this.instanceId,this.attributeLayout,s.textureBinding),t.recordBounds(c,u,d,d);const{texcoords:f,offsets:_}=s,p=this._textMeshTransformProps.fontSize;this._writeQuad(t,e,i,n,{texcoords:f,offsets:_,fontSize:p,color:(0,N.Jb)(this.evaluatedMeshParams.color),isBackground:!1,referenceBounds:a,minZoom:Math.max(this._current.zoomRange[0],s.minZoom),maxZoom:Math.min(this._current.zoomRange[1],s.maxZoom),clipAngle:o,mapAligned:l,isLineLabel:!0}),t.recordEnd()}_isVisible(t,e){const i=this._zoomLevel;return t<=i&&i<=e}}function U(t,e,i){const{coords:n,lengths:r}=e,s=(0,y.vt)(),o=(0,y.vt)(),a=(0,y.vt)(),l=(0,y.vt)(),c=(0,y.vt)(),u=(0,y.vt)();let h=0;for(let e=0;e<r.length;e++){const d=r[e];for(let e=0;e<d;e++){const r=2*(e+h-1),f=2*(e+h),_=2*(e+h+1);e>0?(0,m.hZ)(s,n[r],n[r+1]):(0,m.hZ)(s,0,0),(0,m.hZ)(o,n[f],n[f+1]),e<d-1?(0,m.hZ)(a,n[_],n[_+1]):(0,m.hZ)(a,0,0),0===e?(0,m.hZ)(l,0,0):((0,m.jb)(l,o,s),(0,m.S8)(l,l),(0,m.hZ)(l,l[1],-l[0])),e===d-1?(0,m.hZ)(c,0,0):((0,m.jb)(c,a,o),(0,m.S8)(c,c),(0,m.hZ)(c,c[1],-c[0])),(0,m.WQ)(u,l,c),(0,m.S8)(u,u);const p=u[0]*c[0]+u[1]*c[1];0!==p&&(0,m.hs)(u,u,p),(0,m.hs)(u,u,i),t.coords.push(o[0]+u[0],o[1]+u[1])}t.lengths.push(d),h+=d}return t}var G=i(67293),H=i(63124),Y=i(82806),W=i(50659),Z=i(39819),q=i(21609),X=i(40633),$=i(95415),j=i(25731),K=i(37069);async function Q(t,e,i=!1){const{defaultValue:n,valueExpressionInfo:r,value:s}=e;if(r){const{expression:s}=r,o=await t.createComputedField({expression:s},i);return o?{...e,computed:o,defaultValue:n}:null}return{...e,computed:new K.G(s),defaultValue:n}}async function J(t,e){const{defaultValue:i,valueExpressionInfo:n}=e,{expression:r}=n,s=await t.createComputedField({expression:r});return s?{...e,computed:s,defaultValue:i}:null}const tt=t=>"boolean"!=typeof t&&"number"!=typeof t&&"valueExpressionInfo"in t,et=t=>t.some((t=>{for(const e in t){const i=t[e];if(tt(i))return!0}return!1}));class it{static async create(t,e,i){const n={},r=new Map,s=new Map,o=new Map,a=new Map,l=new Map;for(const c in i){const u=i[c];if(null!=u&&"object"==typeof u)if(Array.isArray(u)){if("object"==typeof u[0])throw new Error(`InternalError: Cannot handle ${c}. Nested array params are not supported`);n[c]=u}else if("valueExpressionInfo"in u){if(u.value){n[c]=u.value;continue}const e=await J(t,u);if(!e){n[c]=u.defaultValue;continue}r.set(c,e),n[c]=null}else switch(u.type){case"cim-effect-infos":if(u.effectInfos.some((t=>t.overrides.length))){s.set(c,{effects:await Promise.all(u.effectInfos.map((async e=>{const i=e.overrides.map((e=>Q(t,e)));return{effect:e.effect,compiledOverrides:(await Promise.all(i)).filter(W.Ru)}})))});break}n[c]=u.effectInfos.map((t=>t.effect));break;case"cim-marker-placement-param":u.overrides.length&&o.set(c,{placementInfo:u,compiledOverrides:(await Promise.all(u.overrides.map((e=>Q(t,e))))).filter(W.Ru)}),n[c]=u.placement;break;case"text-rasterization-param":{if(u.overrides.length){const e=u.overrides.map((e=>Q(t,e,u.useLegacyLabelEvaluationRules)));a.set(c,{compiledOverrides:(await Promise.all(e)).filter(W.Ru),rasterizationParam:u,objectIdToResourceId:new Map});continue}const i={type:"cim-rasterization-info",resource:u.resource};n[c]=await e.fetchResourceImmediate(i)??null;break}case"sprite-rasterization-param":{if(u.overrides.length){const e=u.overrides.map((e=>Q(t,e)));a.set(c,{compiledOverrides:(await Promise.all(e)).filter(W.Ru),rasterizationParam:u,objectIdToResourceId:new Map});continue}if("animated"===u.resource.type){a.set(c,{compiledOverrides:[],rasterizationParam:u,objectIdToResourceId:new Map});continue}const i={type:"cim-rasterization-info",resource:u.resource};n[c]=await e.fetchResourceImmediate(i)??null;break}case"cim-marker-transform-param":{const{params:e}=u;if(et(e)){const i={compiledMarkerInfos:[]};await Promise.all(e.map((async e=>{const n={props:{}};for(const i in e)if(tt(e[i])){const r=await J(t,e[i]);n.compiledExpressionMap||(n.compiledExpressionMap=new Map);const s=n.compiledExpressionMap;r&&s.set(i,r)}else n.props[i]=e[i];i.compiledMarkerInfos.push(n)}))),l.set(c,i)}else n[c]={type:"cim-marker-transform-info",infos:e};break}default:n[c]=u}else n[c]=u}return new it(i,n,r,s,o,a,l)}constructor(t,e,i,n,r,s,o){this.inputMeshParams=t,this._resolvedMeshParams=e,this._dynamicProperties=i,this._dynamicEffectProperties=n,this._dynamicPlacementProperties=r,this._dynamicAsyncProperties=s,this._dynamicTransformProperties=o,this.evaluator=t=>t}get hasDynamicProperties(){return!!(this._dynamicProperties.size||this._dynamicAsyncProperties.size||this._dynamicEffectProperties.size||this._dynamicTransformProperties.size||this._dynamicPlacementProperties.size)}get evaluatedMeshParams(){return this._evaluatedMeshParams||(this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams)),this._evaluatedMeshParams}enqueueRequest(t,e,i){for(const n of this._dynamicAsyncProperties.values()){const r=(0,q.o8)(n.rasterizationParam.resource);"animated"===n.rasterizationParam.resource.type&&n.rasterizationParam.resource.randomizeStartTime&&(r.primitiveName="__RESERVED__PRIMITIVE__NAME__",r.startGroup=(0,$.A)(e.getObjectId()||0));for(const{primitiveName:t,propertyName:s,computed:o,defaultValue:a,valueExpressionInfo:l}of n.compiledOverrides)try{const l="animated"===n.rasterizationParam.resource.type?r.primitiveName:t;(0,j.Ph)(r,l,s,o,e,i,a)}catch(e){X.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.mesh.MeshWriterInputEvaluator").errorOnce(new Z.A("invalid-arcade-expression",`Encountered an error when evaluating the arcade expression '${l?.expression}' (primitive: '${t}', property: '${s}')`,e))}const s=t.enqueueRequest({type:"cim-rasterization-info",resource:r});n.objectIdToResourceId.set(e.getObjectId(),s)}}evaluateMeshParams(t,e,i){for(const[t,n]of this._dynamicProperties.entries())this._resolvedMeshParams[t]=n.computed.readWithDefault(e,i,n.defaultValue);for(const[t,n]of this._dynamicPlacementProperties.entries())for(const{computed:r,defaultValue:s,propertyName:o}of n.compiledOverrides){const a=r.readWithDefault(e,i,s);n.placementInfo.placement[o]=a,this._resolvedMeshParams[t]=n.placementInfo.placement}for(const[t,n]of this._dynamicEffectProperties.entries())for(const r of n.effects){for(const{computed:t,defaultValue:n,propertyName:s}of r.compiledOverrides){const o=t.readWithDefault(e,i,n);r.effect[s]=o}this._resolvedMeshParams[t]=n.effects.map((t=>t.effect))}for(const[t,n]of this._dynamicTransformProperties.entries()){const r={type:"cim-marker-transform-info",infos:[]};for(const t of n.compiledMarkerInfos){const n={...t.props};if(t.compiledExpressionMap)for(const[r,s]of t.compiledExpressionMap){const t=s.computed.readWithDefault(e,i,s.defaultValue);n[r]="number"==typeof t||"boolean"==typeof t?t:s.defaultValue}r.infos.push(n)}this._resolvedMeshParams[t]=r}for(const[i,n]of this._dynamicAsyncProperties.entries()){const r=n.objectIdToResourceId.get(e.getObjectId());if(null==r)continue;const s=t.getResource(r);this._resolvedMeshParams[i]=s}return this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams),this.evaluatedMeshParams}}var nt=i(77981);class rt{async createMeshWriter(t,e,i,n){const r=this._getMeshWriter(n.techniqueType),s=await it.create(t,e,n.inputParams),o=new r(n.id,s,n.optionalAttributes,i);return await o.loadDependencies(),o}_getMeshWriter(t){switch(t){case n.N.Fill:return a.Y;case n.N.DotDensity:return r.k;case n.N.ComplexFill:return s.KE;case n.N.PatternFill:return c.m;case n.N.OutlineFill:return l.w0;case n.N.PatternOutlineFill:return u.Q;case n.N.ComplexOutlineFill:return o.O;case n.N.Marker:return Y.H;case n.N.PieChart:return nt.v;case n.N.Text:return B.G8;case n.N.Line:return G.Bw;case n.N.TexturedLine:return H.K;case n.N.Heatmap:return h.h;case n.N.Label:return V;case n.N.Test:throw new Error("Internal Error: Found invalid mesh writer")}}}},5544:function(t,e,i){i.d(e,{F:function(){return s},q:function(){return o}});var n=i(85475),r=i(85456);function s(t,e,i,s){const o=i.packPrecisionFactor??1;switch(i.type){case r.pe.BYTE:if(1===i.count)t.setInt8(s+i.offset,e*o);else for(let n=0;n<i.count;n++){const r=n*Int8Array.BYTES_PER_ELEMENT;t.setInt8(s+i.offset+r,e[n]*o)}break;case r.pe.UNSIGNED_BYTE:if(1===i.count)t.setUint8(s+i.offset,e*o);else for(let n=0;n<i.count;n++){const r=n*Uint8Array.BYTES_PER_ELEMENT;t.setUint8(s+i.offset+r,e[n]*o)}break;case r.pe.SHORT:if(1===i.count)t.setInt16(s+i.offset,e*o,!0);else for(let n=0;n<i.count;n++){const r=n*Int16Array.BYTES_PER_ELEMENT;t.setInt16(s+i.offset+r,e[n]*o,!0)}break;case r.pe.UNSIGNED_SHORT:if(1===i.count)t.setUint16(s+i.offset,e*o,!0);else for(let n=0;n<i.count;n++){const r=n*Uint16Array.BYTES_PER_ELEMENT;t.setUint16(s+i.offset+r,e[n]*o,!0)}break;case r.pe.INT:if(1===i.count)t.setInt32(s+i.offset,e*o,!0);else for(let n=0;n<i.count;n++){const r=n*Int32Array.BYTES_PER_ELEMENT;t.setInt32(s+i.offset+r,e[n]*o,!0)}break;case r.pe.UNSIGNED_INT:if(1===i.count)t.setUint32(s+i.offset,e*o,!0);else for(let n=0;n<i.count;n++){const r=n*Uint32Array.BYTES_PER_ELEMENT;t.setUint32(s+i.offset+r,e[n]*o,!0)}break;case r.pe.FLOAT:if(1===i.count)t.setFloat32(s+i.offset,e*o,!0);else for(let n=0;n<i.count;n++){const r=n*Float32Array.BYTES_PER_ELEMENT;t.setFloat32(s+i.offset+r,e[n]*o,!0)}break;case r.pe.HALF_FLOAT:if(1===i.count)t.setUint16(s+i.offset,(0,n.fw)(e*o),!0);else for(let r=0;r<i.count;r++){const a=r*Uint16Array.BYTES_PER_ELEMENT;t.setUint16(s+i.offset+a,(0,n.fw)(e[r]*o),!0)}}}function o(t,e,i){switch(e.type){case r.pe.BYTE:{if(1===e.count)return t.getInt8(i+e.offset);const n=[];for(let r=0;r<e.count;r++){const s=r*Int8Array.BYTES_PER_ELEMENT;n.push(t.getInt8(i+e.offset+s))}return n}case r.pe.UNSIGNED_BYTE:{if(1===e.count)return t.getUint8(i+e.offset);const n=[];for(let r=0;r<e.count;r++){const s=r*Uint8Array.BYTES_PER_ELEMENT;n.push(t.getUint8(i+e.offset+s))}return n}case r.pe.SHORT:{if(1===e.count)return t.getInt16(i+e.offset,!0);const n=[];for(let r=0;r<e.count;r++){const s=r*Int16Array.BYTES_PER_ELEMENT;n.push(t.getInt16(i+e.offset+s,!0))}return n}case r.pe.UNSIGNED_SHORT:{if(1===e.count)return t.getUint16(i+e.offset,!0);const n=[];for(let r=0;r<e.count;r++){const s=r*Uint16Array.BYTES_PER_ELEMENT;n.push(t.getUint16(i+e.offset+s,!0))}return n}case r.pe.INT:{if(1===e.count)return t.getInt32(i+e.offset,!0);const n=[];for(let r=0;r<e.count;r++){const s=r*Int32Array.BYTES_PER_ELEMENT;n.push(t.getInt32(i+e.offset+s,!0))}return n}case r.pe.UNSIGNED_INT:{if(1===e.count)return t.getUint32(i+e.offset,!0);const n=[];for(let r=0;r<e.count;r++){const s=r*Uint32Array.BYTES_PER_ELEMENT;n.push(t.getUint32(i+e.offset+s,!0))}return n}case r.pe.FLOAT:{if(1===e.count)return t.getFloat32(i+e.offset,!0);const n=[];for(let r=0;r<e.count;r++){const s=r*Float32Array.BYTES_PER_ELEMENT;n.push(t.getFloat32(i+e.offset+s,!0))}return n}case r.pe.HALF_FLOAT:{if(1===e.count)return(0,n.Kl)(t.getUint16(i+e.offset,!0));const r=[];for(let s=0;s<e.count;s++){const o=s*Uint16Array.BYTES_PER_ELEMENT;r.push((0,n.Kl)(t.getUint16(i+e.offset+o,!0)))}return r}}}},86329:function(t,e,i){function n(t){return t}function r(t){return t}i.d(e,{P:function(){return n},U:function(){return r}})},68758:function(t,e,i){i.d(e,{R:function(){return s},z:function(){return r}});let n=null;function r(){return n}async function s(){n=await i.e(4696).then(i.bind(i,28356))}},25731:function(t,e,i){i.d(e,{Ph:function(){return s},Z0:function(){return a},hU:function(){return r}});var n=i(50944);function r(t){const e=t.map((({name:t,count:e,type:i})=>`${t}.${e}.${i}`)).join(",");return(0,n.Wm)(e)}function s(t,e,i,n,r,o,a){if(t.primitiveName===e)for(const e in t)if(e===i){let i=n?.readWithDefault(r,o,t[e]&&a);return"text"===t.type&&(i=i.toString()),void(t[e]=i)}if("type"in t&&null!=t.type)switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(t.symbolLayers)for(const l of t.symbolLayers)s(l,e,i,n,r,o,a);break;case"CIMHatchFill":t.lineSymbol&&s(t.lineSymbol,e,i,n,r,o,a);break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if("CIMVectorMarker"===t.type&&t.markerGraphics)for(const l of t.markerGraphics)s(l,e,i,n,r,o,a),s(l.symbol,e,i,n,r,o,a)}}const o=400;function a(t){const e=t.width;return null!=t.effects?o:Math.max(1.25*e,8)}},77981:function(t,e,i){i.d(e,{v:function(){return l}});var n=i(13520),r=i(54417),s=i(54601),o=i(85456);const a={createComputedParams:t=>t,optionalAttributes:{},attributes:{pos:{type:o.pe.SHORT,count:2,packPrecisionFactor:10,pack:"position"},id:{type:o.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:o.pe.UNSIGNED_BYTE,count:1,pack:t=>0},offset:{type:o.pe.SHORT,count:2,packPrecisionFactor:16,packAlternating:{count:4,pack:({size:t})=>{const e=(0,n.Lz)(t),i=-e/2,r=-e/2;return[[i,r],[i+e,r],[i,r+e],[i+e,r+e]]}}},texCoords:{type:o.pe.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:()=>[[0,1],[1,1],[0,0],[1,0]]}},size:{type:o.pe.UNSIGNED_BYTE,count:2,pack:({size:t})=>[t,t]},referenceSize:{type:o.pe.UNSIGNED_BYTE,count:1,pack:({size:t})=>(0,n.Lz)(t)},zoomRange:{type:o.pe.UNSIGNED_BYTE,count:2,pack:({scaleInfo:t},{tileInfo:e})=>(0,r.My)(t,e)}}};class l extends s.r{constructor(){super(...arguments),this.vertexSpec=a}_write(t,e){const i=e.getDisplayId(),r=this.evaluatedMeshParams.minPixelBuffer,s=Math.max((0,n.Lz)(this.evaluatedMeshParams.size),r);let o,a;if("esriGeometryPoint"===e.geometryType)o=e.readXForDisplay(),a=e.readYForDisplay();else{const t=e.readCentroidForDisplay();if(!t)return;o=t?.coords[0],a=t?.coords[1]}t.recordStart(this.instanceId,this.attributeLayout),t.recordBounds(o,a,s,s);const l=t.vertexCount();this._writeVertex(t,i,o,a),t.indexWrite(l+0),t.indexWrite(l+1),t.indexWrite(l+2),t.indexWrite(l+1),t.indexWrite(l+3),t.indexWrite(l+2),t.recordEnd()}}},33702:function(t,e,i){i.d(e,{f_:function(){return m},$Z:function(){return _},DM:function(){return p},rz:function(){return f}});var n=i(53804),r=i(67529),s=i(98282),o=i(70931),a=i(58941),l=i(86486);class c extends s.k2{getVisualVariableData(t){if(!this._vvData){const e=this.getAttributeDataCoords(t);this._vvData=(0,o.US)(this.visualVariableData,e).setDebugName("storage2")}return this._vvData}getAttributeDataCoords(t){if(!this._uv){const e=(0,l.Kt)(t),i=this.size,n=(0,o.Wh)(e.x),r=(0,o.Wh)(e.y).multiply((0,o.Wh)(256)),s=(0,o.Wh)(e.z).multiply((0,o.Wh)(256)).multiply((0,o.Wh)(256)),a=(0,o.fV)(n.add(r).add(s)),c=(0,o.zi)(a,i),u=a.subtract(c).divide(i);this._uv=new o.ZY(c,u).add(.5).divide(i)}return this._uv}getFilterData(t){const e=this.getAttributeDataCoords(t);return(0,o.US)(this.filterFlags,e).setDebugName("storage0")}getAnimationData(t){const e=this.getAttributeDataCoords(t);return(0,o.US)(this.animation,e).setDebugName("storage1")}getVVData(t){return this.getVisualVariableData(t)}getDataDrivenData0(t){const e=this.getAttributeDataCoords(t);return(0,o.US)(this.dataDriven0,e).setDebugName("storage30")}getDataDrivenData1(t){const e=this.getAttributeDataCoords(t);return(0,o.US)(this.dataDriven1,e).setDebugName("storage31")}getDataDrivenData2(t){const e=this.getAttributeDataCoords(t);return(0,o.US)(this.dataDriven2,e).setDebugName("storage32")}getGPGPUData(t){const e=this.getAttributeDataCoords(t);return(0,o.US)(this.gpgpu,e).setDebugName("storage4")}getFilterFlags(t){return(0,a.A)("webgl-ignores-sampler-precision")?(0,o.mk)(this.getFilterData(t).x.multiply((0,o.fV)(255))):this.getFilterData(t).x.multiply((0,o.fV)(255))}getAnimationValue(t){return this.getAnimationData(t).x}getSizeValue(t){return this.getVisualVariableData(t).x}getColorValue(t){return this.getVisualVariableData(t).y}getOpacityValue(t){return this.getVisualVariableData(t).z}getRotationValue(t){return this.getVisualVariableData(t).w}}(0,n._)([(0,s.Pi)(o.z7)],c.prototype,"filterFlags",void 0),(0,n._)([(0,s.Pi)(o.z7)],c.prototype,"animation",void 0),(0,n._)([(0,s.Pi)(o.z7)],c.prototype,"gpgpu",void 0),(0,n._)([(0,s.Pi)(o.z7)],c.prototype,"visualVariableData",void 0),(0,n._)([(0,s.Pi)(o.z7)],c.prototype,"dataDriven0",void 0),(0,n._)([(0,s.Pi)(o.z7)],c.prototype,"dataDriven1",void 0),(0,n._)([(0,s.Pi)(o.z7)],c.prototype,"dataDriven2",void 0),(0,n._)([(0,s.Pi)(o.nt)],c.prototype,"size",void 0);class u extends s.k2{}(0,n._)([(0,s.Pi)(o.nt)],u.prototype,"activeReasons",void 0),(0,n._)([(0,s.Pi)(o.nt)],u.prototype,"highlightAll",void 0);class h extends s.k2{}(0,n._)([(0,s.Pi)(o.ZY)],h.prototype,"position",void 0),(0,n._)([(0,s.Pi)(o.nt)],h.prototype,"distance",void 0),(0,n._)([(0,s.Pi)(o.nt)],h.prototype,"smallSymbolDistance",void 0),(0,n._)([(0,s.Pi)(o.nt)],h.prototype,"smallSymbolSizeThreshold",void 0);var d=i(64522);class f extends s.ZA{}(0,n._)([(0,s.C5)(0,o.eB)],f.prototype,"id",void 0),(0,n._)([(0,s.C5)(1,o.nt)],f.prototype,"bitset",void 0),(0,n._)([(0,s.C5)(2,o.ZY)],f.prototype,"pos",void 0);class _ extends s.Y7{}(0,n._)([(0,s.C5)(14,o.ZY)],_.prototype,"nextPos1",void 0),(0,n._)([(0,s.C5)(15,o.ZY)],_.prototype,"nextPos2",void 0);class p extends s.HS{}class m extends s.A{clip(t,e){let i=new o.nt(0);const n=this.storage.getFilterFlags(t);if(i=i.add((0,o.fV)(2).multiply((0,o.fV)(1).subtract((0,l.i6)(n,0)))),this.inside?i=i.add((0,o.fV)(2).multiply((0,o.fV)(1).subtract((0,l.i6)(n,1)))):this.outside?i=i.add((0,o.fV)(2).multiply((0,l.i6)(n,1))):this.highlight&&(i=i.add((0,o.fV)(2).multiply((0,o.fV)(1).subtract(this._checkHighlight(n))))),null!=e){const t=new o.nt(1).subtract((0,o.PM)(e.x,this.view.currentZoom)),n=(0,o.PM)(e.y,this.view.currentZoom);i=i.add(new o.nt(2).multiply(t.add(n)))}return i}getFragmentOutput(t,e,i=new o.nt(1/255)){const n=new s.mm;return n.glFragColor=this._maybeWriteHittest(e)??this._maybeHighlight(t,i)??t,n}_maybeHighlight(t,e){return this.highlight?new o.Zb(t.rgb,(0,o.PM)(e,t.a)):null}_checkHighlight(t){let e=this._checkHighlightBit(t,0);for(let i=1;i<r.M$.length;i++)e=e.add(this._checkHighlightBit(t,i));return(0,o.PM)(new o.nt(.1),e.add(this.highlight.highlightAll))}_checkHighlightBit(t,e){return(0,l.yS)(t,e).multiply((0,l.mh)(this.highlight.activeReasons,e))}maybeRunHittest(t,e,i){if(null==this.hittestRequest)return null;const n=this.hittest(t,e,i);let r=(0,o.Tk)((0,o.MM)(n,this.hittestRequest.distance),new o.nt(2),new o.nt(0));const s=this.storage.getAttributeDataCoords(t.id),a=(0,l.nb)(s);r=r.add(this.clip(t.id,t.zoomRange));const c=new o.Zb(new o.nt(1/255),0,0,0);return{glPointSize:new o.nt(1),glPosition:new o.Zb(a,r,1),color:c}}_maybeWriteHittest(t){return null!=this.hittestRequest?t.color:null}}(0,n._)([s.E8],m.prototype,"inside",void 0),(0,n._)([s.E8],m.prototype,"outside",void 0),(0,n._)([(0,s.uK)(u)],m.prototype,"highlight",void 0),(0,n._)([(0,s.Pi)(c)],m.prototype,"storage",void 0),(0,n._)([(0,s.Pi)(d.o)],m.prototype,"view",void 0),(0,n._)([(0,s.uK)(h)],m.prototype,"hittestRequest",void 0)},58991:function(t,e,i){i.d(e,{Bh:function(){return p},KP:function(){return _},Ps:function(){return m}});var n=i(53804),r=i(98282),s=i(70931),o=i(33702),a=i(40846),l=i(42203),c=i(31299),u=i(39979),h=i(86486);class d extends l._{}(0,n._)([(0,r.C5)(5,s.Zb)],d.prototype,"tlbr",void 0),(0,n._)([(0,r.C5)(6,s.nt)],d.prototype,"width",void 0),(0,n._)([(0,r.C5)(7,s.nt)],d.prototype,"height",void 0),(0,n._)([(0,r.C5)(8,s.ZY)],d.prototype,"offset",void 0),(0,n._)([(0,r.C5)(9,s.ZY)],d.prototype,"scale",void 0),(0,n._)([(0,r.C5)(10,s.nt)],d.prototype,"angle",void 0);class f extends o.DM{}function _(t,e){const i=t.view.requiredZoomFactor,n=new s.ZY(e.width,e.height),r=n.multiply(e.scale).multiply(i),o=e.angle.multiply(a.rp),l=(0,s.F8)(o),c=(0,s.gn)(o),u=function(t,e,i,n,r){const o=(0,s.LC)((0,h.mh)(r,a.Fz),(0,s.fV)(1)),l=(0,h.Rj)(new s.Zb(t,0));return(0,s.Tk)(o,(0,s.w0)(n.divide(e.x),i.divide(e.y),0,(0,s.ze)(i.divide(e.x)),n.divide(e.y),0,(0,h._9)((0,s.Zc)(l,0)),(0,h._9)((0,s.Zc)(0,l)),1),(0,s.w0)(n.divide(e.x),i.divide(e.y),0,(0,s.ze)(i.divide(e.x)),n.divide(e.y),0,0,0,1))}(e.id,r,l,c,e.bitset),d=t.localTileOffset.getPatternOffsetAtTileOrigin(n,l,c),f=i.multiply(e.scale).multiply(e.offset.subtract(d)).divide(r),_=new s.eB(e.pos,1),p=u.multiply(_).xy.subtract(f),m=e.tlbr.divide(t.mosaicInfo.size.xyxy);let g=(0,h.mh)(e.bitset,a.cn);return null!=t.visualVariableColor&&(g=(0,s.Tk)((0,h.M8)(t.storage.getColorValue(e.id)),new s.nt(0),g)),{tileTextureCoord:p,tlbr:m,sampleAlphaOnly:g}}function p(t,e){const i=(0,s.zi)(e.tileTextureCoord,new s.nt(1)),n=(0,s.jh)(e.tlbr.xy,e.tlbr.zw,i);let r=(0,s.US)(t.mosaicInfo.texture,n);return r=(0,s.Tk)((0,s.MM)(e.sampleAlphaOnly,new s.nt(.5)),r.aaaa,r),e.color.multiply(r)}class m extends l.z{vertex(t,e){return{...super.vertex(t,e),..._(this,t)}}fragment(t){const e=p(this,t);return this.getFragmentOutput(e,t,new s.nt(0))}}(0,n._)([(0,r.Pi)(u.b)],m.prototype,"mosaicInfo",void 0),(0,n._)([(0,r.Pi)(c.P)],m.prototype,"localTileOffset",void 0),(0,n._)([(0,n.a)(0,(0,r.hF)(d)),(0,n.a)(1,(0,r.hF)(o.$Z))],m.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(f))],m.prototype,"fragment",null)},47461:function(t,e,i){i.d(e,{RH:function(){return v},cZ:function(){return _},v9:function(){return m}});var n=i(53804),r=i(98282),s=i(70931),o=i(33702),a=i(58991),l=i(66425),c=i(59224),u=i(31299),h=i(39979),d=i(54537),f=i(15087);const _=16,p=1/_,m=128;class g extends o.rz{}(0,n._)([(0,r.C5)(3,s.Zb)],g.prototype,"color",void 0),(0,n._)([(0,r.C5)(4,s.Zb)],g.prototype,"tlbr",void 0),(0,n._)([(0,r.C5)(5,s.nt)],g.prototype,"angle",void 0),(0,n._)([(0,r.C5)(6,s.nt)],g.prototype,"aux1",void 0),(0,n._)([(0,r.C5)(7,s.nt)],g.prototype,"aux2",void 0),(0,n._)([(0,r.C5)(8,s.ZY)],g.prototype,"aux3",void 0),(0,n._)([(0,r.C5)(9,s.ZY)],g.prototype,"aux4",void 0),(0,n._)([(0,r.C5)(10,s.ZY)],g.prototype,"zoomRange",void 0);class y extends f.A1{}class v extends d.My{vertex(t,e){const{aux1:i,aux2:n,aux3:r,aux4:o}=t,l={...t,width:i,height:n,offset:r,scale:o.multiply(p)},c={...t,halfWidth:i,referenceHalfWidth:n,offset:r,normal:o.subtract(m).multiply(p)},u=(0,d.Yb)(this,c),h=(0,a.KP)(this,l),f=(0,s.MM)(u.isOutline,new s.nt(.5));return{...u,...h,...this.maybeRunHittest(t,e,f)}}fragment(t){const{isOutline:e}=t,i=(0,s.MM)(e,new s.nt(.5)),n=(0,c.o7)(t,this.antialiasingControls.blur),r=(0,a.Bh)(this,t),o=(0,s.Tk)(i,n,r),l=(0,s.Tk)(i,new s.nt(1/255),new s.nt(0));return this.getFragmentOutput(o,t,l)}hittest(t,e,i){return(0,s.Tk)(i,(0,l.My)(this.hittestRequest),(0,l.Lq)(this,t,e))}}(0,n._)([(0,r.Pi)(h.b)],v.prototype,"mosaicInfo",void 0),(0,n._)([(0,r.Pi)(u.P)],v.prototype,"localTileOffset",void 0),(0,n._)([(0,n.a)(0,(0,r.hF)(g)),(0,n.a)(1,(0,r.hF)(o.$Z))],v.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(y))],v.prototype,"fragment",null)},42203:function(t,e,i){i.d(e,{_:function(){return h},z:function(){return d}});var n=i(53804),r=i(98282),s=i(70931),o=i(33702),a=i(66425),l=i(81432),c=i(12026),u=i(90906);class h extends o.rz{}(0,n._)([(0,r.C5)(3,s.Zb)],h.prototype,"color",void 0),(0,n._)([(0,r.C5)(4,s.ZY)],h.prototype,"zoomRange",void 0);class d extends o.f_{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(t,e){const i=(0,u.cF)(this,t.id),n=(0,u.G7)(this,t.id,t.color).multiply(i),r=this.view.displayViewScreenMat3.multiply(new s.eB(t.pos.xy,1)),o=this.clip(t.id,t.zoomRange);return{glPosition:new s.Zb(r.xy,o,1),color:n,...this.maybeRunHittest(t,e,null)}}fragment(t){return this.getFragmentOutput(t.color,t,new s.nt(0))}hittest(t,e){return(0,a.Lq)(this,t,e)}}(0,n._)([(0,r.uK)(l._)],d.prototype,"visualVariableColor",void 0),(0,n._)([(0,r.uK)(c.i)],d.prototype,"visualVariableOpacity",void 0),(0,n._)([(0,n.a)(0,(0,r.hF)(h)),(0,n.a)(1,(0,r.hF)(o.$Z))],d.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(o.DM))],d.prototype,"fragment",null)},59224:function(t,e,i){i.d(e,{$0:function(){return b},Xc:function(){return m},cM:function(){return w},fF:function(){return g},fg:function(){return y},o7:function(){return S},xw:function(){return x}});var n=i(53804),r=i(98282),s=i(70931),o=i(33702),a=i(40846),l=i(66425),c=i(81432),u=i(12026),h=i(13635),d=i(21385),f=i(21813),_=i(76347),p=i(90906);class m extends o.rz{}(0,n._)([(0,r.C5)(3,s.Zb)],m.prototype,"color",void 0),(0,n._)([(0,r.C5)(4,s.ZY)],m.prototype,"offset",void 0),(0,n._)([(0,r.C5)(5,s.ZY)],m.prototype,"normal",void 0),(0,n._)([(0,r.C5)(6,s.nt)],m.prototype,"halfWidth",void 0),(0,n._)([(0,r.C5)(7,s.nt)],m.prototype,"referenceHalfWidth",void 0),(0,n._)([(0,r.C5)(8,s.ZY)],m.prototype,"zoomRange",void 0);class g extends o.DM{}class y extends r.k2{}function v(t){return(0,s.T9)(new s.nt(a.Fb).multiply((0,s.PM)(t,new s.nt(a.J5))),new s.nt(1))}function x(t,e){const{halfWidth:i,normal:n}=t,r=v(i),o=(0,s.Bw)(n).multiply(i);return(0,s.qE)(r.multiply(i.subtract(o)).divide(e.add(r).subtract(new s.nt(1))),new s.nt(0),new s.nt(1))}function b(t,e){const{id:i,offset:n,pos:r,normal:o,zoomRange:l}=e,{displayViewScreenMat3:c,displayViewMat3:u}=t.view,h=(0,p.G7)(t,i,e.color),d=(0,p.cF)(t,i),f=function(t,e){const{id:i,halfWidth:n,referenceHalfWidth:r}=e;if((0,p.G5)(t)){const e=new s.nt(2).multiply(r),o=(0,p.Mg)(t,i,e);return new s.nt(.5).multiply(n.divide((0,s.T9)(r,new s.nt(a.Ni)))).multiply(o)}return n}(t,e),_=new s.nt(.5).multiply(t.antialiasingControls.antialiasing),m=(0,s.T9)(f.add(_),new s.nt(.45)).add(new s.nt(.1).multiply(_)),g=v(m).multiply(m).multiply(n),y=u.multiply(new s.eB(g,new s.nt(0))),x=c.multiply(new s.eB(r,new s.nt(1))).add(y),b=new s.nt(2).multiply((0,s.PM)(f,new s.nt(0))).add(t.clip(i,l)),S=new s.Zb(x.xy,b,1);return{color:h,opacity:d,halfWidth:m,normal:o,scaledOffset:g,scaledHalfWidth:f,glPosition:new s.Zb(S.xy,b,1)}}function S(t,e){const{opacity:i,color:n}=t,r=x(t,e);return i.multiply(n).multiply(r)}(0,n._)([(0,r.Pi)(s.nt)],y.prototype,"antialiasing",void 0),(0,n._)([(0,r.Pi)(s.nt)],y.prototype,"blur",void 0);class w extends o.f_{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(t,e){const i=b(this,t);return{...i,...this.maybeRunHittest(t,e,i.halfWidth)}}fragment(t){const e=S(t,this.antialiasingControls.blur);return this.getFragmentOutput(e,t)}hittest(t,e,i){const{viewMat3:n,tileMat3:r}=this.view,o=n.multiply(r),a=o.multiply(new s.eB(t.pos,1)),c=o.multiply(new s.eB(e.nextPos1,1)),u=o.multiply(new s.eB(e.nextPos2,1)),{distance:h,smallSymbolDistance:d,smallSymbolSizeThreshold:f}=this.hittestRequest,_=(0,s.PM)(i,f.multiply(.5)).multiply(h.subtract(d)),p=this.hittestRequest.position;return(0,s.jk)((0,l.E2)(p,a.xy,c.xy),(0,l.E2)(p,a.xy,u.xy)).subtract(i).add(_)}}(0,n._)([(0,r.Pi)(y)],w.prototype,"antialiasingControls",void 0),(0,n._)([(0,r.uK)(c._)],w.prototype,"visualVariableColor",void 0),(0,n._)([(0,r.uK)(u.i)],w.prototype,"visualVariableOpacity",void 0),(0,n._)([(0,r.uK)(h.n)],w.prototype,"visualVariableSizeMinMaxValue",void 0),(0,n._)([(0,r.uK)(d.F)],w.prototype,"visualVariableSizeScaleStops",void 0),(0,n._)([(0,r.uK)(f.N)],w.prototype,"visualVariableSizeStops",void 0),(0,n._)([(0,r.uK)(_.d)],w.prototype,"visualVariableSizeUnitValue",void 0),(0,n._)([(0,n.a)(0,(0,r.hF)(m)),(0,n.a)(1,(0,r.hF)(o.$Z))],w.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(g))],w.prototype,"fragment",null)},31299:function(t,e,i){i.d(e,{P:function(){return a}});var n=i(53804),r=i(98282),s=i(70931),o=i(40846);class a extends r.k2{getPatternOffsetAtTileOrigin(t,e=new s.nt(0),i=new s.nt(1)){const n=new s.ZY(o.YV).divide(t);let r=t.multiply((0,s.jc)(this.maxIntsToLocalOrigin.multiply(n))).add(this.tileOffsetFromLocalOrigin).subtract(new s.nt(.5).multiply(t));return r=new s.ZY(r.x.multiply(i).subtract(r.y.multiply(e)),r.x.multiply(e).add(r.y.multiply(i))),(0,s.zi)(r,t)}}(0,n._)([(0,r.Pi)(s.ZY)],a.prototype,"tileOffsetFromLocalOrigin",void 0),(0,n._)([(0,r.Pi)(s.ZY)],a.prototype,"maxIntsToLocalOrigin",void 0)},39979:function(t,e,i){i.d(e,{b:function(){return o}});var n=i(53804),r=i(98282),s=i(70931);class o extends r.k2{}(0,n._)([(0,r.Pi)(s.ZY)],o.prototype,"size",void 0),(0,n._)([(0,r.Pi)(s.z7)],o.prototype,"texture",void 0)},54537:function(t,e,i){i.d(e,{A7:function(){return v},My:function(){return b},Yb:function(){return x},nj:function(){return S},wG:function(){return y}});var n=i(53804),r=i(98282),s=i(70931),o=i(33702),a=i(40846),l=i(66425),c=i(59224),u=i(86486),h=i(81432),d=i(12026),f=i(13635),_=i(21385),p=i(21813),m=i(76347),g=i(90906);class y extends o.rz{}(0,n._)([(0,r.C5)(3,s.ZY)],y.prototype,"offset",void 0),(0,n._)([(0,r.C5)(4,s.Zb)],y.prototype,"color",void 0),(0,n._)([(0,r.C5)(5,s.ZY)],y.prototype,"normal",void 0),(0,n._)([(0,r.C5)(6,s.nt)],y.prototype,"halfWidth",void 0),(0,n._)([(0,r.C5)(7,s.nt)],y.prototype,"referenceHalfWidth",void 0),(0,n._)([(0,r.C5)(8,s.ZY)],y.prototype,"zoomRange",void 0);class v extends c.fF{}function x(t,e,i){const{id:n,bitset:r}=e,o=(0,u.mh)(r,a.Xx),l=(0,s.MM)(o,new s.nt(.5)),h=(0,c.$0)(t,e),d=(0,s.Tk)(l,h.halfWidth,new s.nt(0)),f=(0,g.cF)(t,n),_=(0,g.G7)(t,n,e.color),p=(0,s.Tk)(l,e.color,_.multiply(f)),m=t.view.displayViewScreenMat3.multiply(new s.eB(e.pos.xy,1)),y=t.clip(e.id),v=new s.Zb(m.xy,y,1),x=(0,s.Tk)(l,h.glPosition,v),b=i&&t.maybeRunHittest(e,i,l);return{isOutline:o,color:p,opacity:new s.nt(1),halfWidth:d,normal:h.normal,glPosition:x,...b}}class b extends o.f_{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}}(0,n._)([(0,r.Pi)(c.fg)],b.prototype,"antialiasingControls",void 0),(0,n._)([(0,r.uK)(h._)],b.prototype,"visualVariableColor",void 0),(0,n._)([(0,r.uK)(d.i)],b.prototype,"visualVariableOpacity",void 0),(0,n._)([(0,r.uK)(f.n)],b.prototype,"visualVariableSizeMinMaxValue",void 0),(0,n._)([(0,r.uK)(_.F)],b.prototype,"visualVariableSizeScaleStops",void 0),(0,n._)([(0,r.uK)(p.N)],b.prototype,"visualVariableSizeStops",void 0),(0,n._)([(0,r.uK)(m.d)],b.prototype,"visualVariableSizeUnitValue",void 0);class S extends b{vertex(t,e){return x(this,t,e)}fragment(t){const{color:e,isOutline:i}=t,n=(0,s.MM)(i,new s.nt(.5)),r=(0,c.o7)(t,this.antialiasingControls.blur),o=(0,s.Tk)(n,r,e),a=(0,s.Tk)(n,new s.nt(1/255),new s.nt(0));return this.getFragmentOutput(o,t,a)}hittest(t,e,i){return(0,s.Tk)(i,(0,l.My)(this.hittestRequest),(0,l.Lq)(this,t,e))}}(0,n._)([(0,n.a)(0,(0,r.hF)(y)),(0,n.a)(1,(0,r.hF)(o.$Z))],S.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(v))],S.prototype,"fragment",null)},51741:function(t,e,i){i.d(e,{_u:function(){return d},dW:function(){return f},vx:function(){return _}});var n=i(53804),r=i(98282),s=i(70931),o=i(33702),a=i(42203),l=i(31299),c=i(39979);class u extends a._{}(0,n._)([(0,r.C5)(5,s.Zb)],u.prototype,"tlbr",void 0),(0,n._)([(0,r.C5)(6,s.nt)],u.prototype,"inverseRasterizationScale",void 0);class h extends o.DM{}function d(t,e){const i=e.tlbr.xy,n=e.tlbr.zw,r=n.x.subtract(i.x),o=i.y.subtract(n.y),a=new s.ZY(r,o).multiply(e.inverseRasterizationScale),l=a.multiply(t.view.requiredZoomFactor),c=function(t){const e=new s.nt(1),i=new s.nt(0);return new s.U(e.divide(t.x),i.divide(t.y),0,(0,s.ze)(i.divide(t.x)),e.divide(t.y),0,0,0,1)}(l),u=t.localTileOffset.getPatternOffsetAtTileOrigin(a).divide(l),h=new s.eB(e.pos,1);return{tileTextureCoord:c.multiply(h).xy.subtract(u),tlbr:e.tlbr.divide(t.mosaicInfo.size.xyxy)}}function f(t,e){const i=(0,s.zi)(t.tileTextureCoord,new s.nt(1)),n=(0,s.jh)(t.tlbr.xy,t.tlbr.zw,i),r=(0,s.US)(e.texture,n);return t.color.multiply(r)}class _ extends a.z{vertex(t,e){return{...super.vertex(t,e),...d(this,t)}}fragment(t){const e=f(t,this.mosaicInfo);return this.getFragmentOutput(e,t,new s.nt(0))}}(0,n._)([(0,r.Pi)(c.b)],_.prototype,"mosaicInfo",void 0),(0,n._)([(0,r.Pi)(l.P)],_.prototype,"localTileOffset",void 0),(0,n._)([(0,n.a)(0,(0,r.hF)(u)),(0,n.a)(1,(0,r.hF)(o.$Z))],_.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(h))],_.prototype,"fragment",null)},15087:function(t,e,i){i.d(e,{A1:function(){return f},tA:function(){return _}});var n=i(53804),r=i(98282),s=i(70931),o=i(33702),a=i(59224),l=i(31299),c=i(39979),u=i(54537),h=i(51741);class d extends u.wG{}(0,n._)([(0,r.C5)(9,s.Zb)],d.prototype,"tlbr",void 0),(0,n._)([(0,r.C5)(10,s.nt)],d.prototype,"inverseRasterizationScale",void 0);class f extends u.A7{}class _ extends u.nj{vertex(t,e){return{...(0,u.Yb)(this,t,e),...(0,h._u)(this,t)}}fragment(t){const{isOutline:e}=t,i=(0,s.MM)(e,new s.nt(.5)),n=(0,a.o7)(t,this.antialiasingControls.blur),r=(0,h.dW)(t,this.mosaicInfo),o=(0,s.Tk)(i,n,r),l=(0,s.Tk)(i,new s.nt(1/255),new s.nt(0));return this.getFragmentOutput(o,t,l)}}(0,n._)([(0,r.Pi)(c.b)],_.prototype,"mosaicInfo",void 0),(0,n._)([(0,r.Pi)(l.P)],_.prototype,"localTileOffset",void 0),(0,n._)([(0,n.a)(0,(0,r.hF)(d)),(0,n.a)(1,(0,r.hF)(o.$Z))],_.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(f))],_.prototype,"fragment",null)},64522:function(t,e,i){i.d(e,{o:function(){return o}});var n=i(53804),r=i(98282),s=i(70931);class o extends r.k2{}(0,n._)([(0,r.Pi)(s.U)],o.prototype,"displayViewScreenMat3",void 0),(0,n._)([(0,r.Pi)(s.U)],o.prototype,"displayViewMat3",void 0),(0,n._)([(0,r.Pi)(s.U)],o.prototype,"displayMat3",void 0),(0,n._)([(0,r.Pi)(s.U)],o.prototype,"viewMat3",void 0),(0,n._)([(0,r.Pi)(s.U)],o.prototype,"tileMat3",void 0),(0,n._)([(0,r.Pi)(s.nt)],o.prototype,"displayZoomFactor",void 0),(0,n._)([(0,r.Pi)(s.nt)],o.prototype,"requiredZoomFactor",void 0),(0,n._)([(0,r.Pi)(s.ZY)],o.prototype,"tileOffset",void 0),(0,n._)([(0,r.Pi)(s.nt)],o.prototype,"currentScale",void 0),(0,n._)([(0,r.Pi)(s.nt)],o.prototype,"currentZoom",void 0),(0,n._)([(0,r.Pi)(s.nt)],o.prototype,"metersPerSRUnit",void 0),(0,n._)([(0,r.Pi)(s.nt)],o.prototype,"rotation",void 0),(0,n._)([(0,r.Pi)(s.nt)],o.prototype,"pixelRatio",void 0)},81432:function(t,e,i){i.d(e,{_:function(){return a}});var n=i(53804),r=i(98282),s=i(70931),o=i(86486);class a extends r.k2{getColor(t,e,i){return(0,s.j1)([(0,s.or)((0,o.M8)(t),i),e],[(0,s.$5)(t,this.values.first()),this.colors.first()],[(0,s.aX)(t,this.values.last()),this.colors.last()],[!0,()=>{const e=this.values.findIndex((e=>(0,s.MM)(e,t))),i=this.values.get(e),n=e.subtract(1),r=this.values.get(n),o=t.subtract(r).divide(i.subtract(r));return(0,s.jh)(this.colors.get(n),this.colors.get(e),o)}])}}(0,n._)([(0,r.Pi)(s.My.ofType(s.Zb,8))],a.prototype,"colors",void 0),(0,n._)([(0,r.Pi)(s.My.ofType(s.nt,8))],a.prototype,"values",void 0)},12026:function(t,e,i){i.d(e,{i:function(){return a}});var n=i(53804),r=i(98282),s=i(70931),o=i(86486);class a extends r.k2{getOpacity(t){return(0,s.j1)([(0,o.M8)(t),new s.nt(1)],[(0,s.$5)(t,this.opacityValues.first()),this.opacities.first()],[(0,s.aX)(t,this.opacityValues.last()),this.opacities.last()],[!0,()=>{const e=this.opacityValues.findIndex((e=>(0,s.MM)(e,t))),i=this.opacityValues.get(e),n=e.subtract(1),r=this.opacityValues.get(n),o=t.subtract(r).divide(i.subtract(r));return(0,s.jh)(this.opacities.get(n),this.opacities.get(e),o)}])}}(0,n._)([(0,r.Pi)(s.My.ofType(s.nt,8))],a.prototype,"opacities",void 0),(0,n._)([(0,r.Pi)(s.My.ofType(s.nt,8))],a.prototype,"opacityValues",void 0)},13635:function(t,e,i){i.d(e,{n:function(){return a}});var n=i(53804),r=i(98282),s=i(70931),o=i(86486);class a extends r.k2{getSize(t,e){const i=this.minMaxValueAndSize.xy,n=this.minMaxValueAndSize.zw;return(0,s.Tk)((0,o.M8)(t),e,(()=>{const e=t.subtract(i.x).divide(i.y.subtract(i.x)),r=(0,s.qE)(e,new s.nt(0),new s.nt(1));return n.x.add(r.multiply(n.y.subtract(n.x)))}))}}(0,n._)([(0,r.Pi)(s.Zb)],a.prototype,"minMaxValueAndSize",void 0)},21385:function(t,e,i){i.d(e,{F:function(){return o}});var n=i(53804),r=i(98282),s=i(70931);class o extends r.k2{getSizeForViewScale(t){return(0,s.j1)([(0,s.$5)(t,this.values.first()),this.sizes.first()],[(0,s.aX)(t,this.values.last()),this.sizes.last()],[!0,()=>{const e=this.values.findIndex((e=>(0,s.MM)(e,t))),i=this.values.get(e),n=e.subtract(1),r=this.values.get(n),o=t.subtract(r).divide(i.subtract(r));return(0,s.jh)(this.sizes.get(n),this.sizes.get(e),o)}])}}(0,n._)([(0,r.Pi)(s.My.ofType(s.nt,8))],o.prototype,"sizes",void 0),(0,n._)([(0,r.Pi)(s.My.ofType(s.nt,8))],o.prototype,"values",void 0)},21813:function(t,e,i){i.d(e,{N:function(){return a}});var n=i(53804),r=i(98282),s=i(70931),o=i(86486);class a extends r.k2{getSize(t,e){const i=(0,s.j1)([(0,o.M8)(t),e],[(0,s.$5)(t,this.values.first()),this.sizes.first()],[(0,s.aX)(t,this.values.last()),this.sizes.last()],[!0,()=>{const e=this.values.findIndex((e=>(0,s.MM)(e,t))),i=this.values.get(e),n=e.subtract(1),r=this.values.get(n),o=t.subtract(r).divide(i.subtract(r));return(0,s.jh)(this.sizes.get(n),this.sizes.get(e),o)}]);return(0,s.Tk)((0,o.M8)(i),e,i)}}(0,n._)([(0,r.Pi)(s.My.ofType(s.nt,8))],a.prototype,"sizes",void 0),(0,n._)([(0,r.Pi)(s.My.ofType(s.nt,8))],a.prototype,"values",void 0)},76347:function(t,e,i){i.d(e,{d:function(){return a}});var n=i(53804),r=i(98282),s=i(70931),o=i(86486);class a extends r.k2{getSize(t,e){return(0,s.Tk)((0,o.M8)(t),e,t.multiply(this.unitValueToPixelsRatio))}}(0,n._)([(0,r.Pi)(s.nt)],a.prototype,"unitValueToPixelsRatio",void 0)},40846:function(t,e,i){var n;i.d(e,{$w:function(){return u},Fb:function(){return a},Fz:function(){return m},H_:function(){return n},J5:function(){return l},M:function(){return d},Ni:function(){return h},V5:function(){return o},Xx:function(){return p},YV:function(){return b},au:function(){return c},b5:function(){return y},bg:function(){return v},cn:function(){return _},kx:function(){return g},os:function(){return r},qM:function(){return f},rp:function(){return s},ti:function(){return x}}),function(t){t[t.Geographic=0]="Geographic",t[t.Arithmatic=1]="Arithmatic"}(n||(n={}));const r=3.14159265359/180,s=3.14159265359/128,o=1,a=1.1,l=1,c=24,u=8,h=1e-5,d=.05,f=1e-30,_=4,p=0,m=2,g=2,y=3,v=0,x=3,b=16777216},66425:function(t,e,i){i.d(e,{Bo:function(){return u},Bs:function(){return l},E2:function(){return o},Lq:function(){return d},My:function(){return h},g$:function(){return f},kW:function(){return a}});var n=i(70931),r=i(40846),s=i(86486);function o(t,e,i){const r=i.subtract(e),s=(a=t.subtract(e),l=r,(0,n.Om)(a,(0,n.S8)(l))),o=(0,n.qE)(s.divide((0,n.Bw)(r)),new n.nt(0),new n.nt(1));var a,l;return(0,n.Io)(t,e.add(o.multiply(i.subtract(e))))}function a(t){const e=(0,n.tn)(t);return(0,n.PM)(e.x.add(e.y).add(e.z),new n.nt(1.05))}function l(t,e,i,r){const s=new n.U(i.x.multiply(r.y).subtract(r.x.multiply(i.y)),r.x.multiply(e.y).subtract(e.x.multiply(r.y)),e.x.multiply(i.y).subtract(i.x.multiply(e.y)),i.y.subtract(r.y),r.y.subtract(e.y),e.y.subtract(i.y),r.x.subtract(i.x),e.x.subtract(r.x),i.x.subtract(e.x)),o=e.x.multiply(i.y.subtract(r.y)),a=i.x.multiply(r.y.subtract(e.y)),l=r.x.multiply(e.y.subtract(i.y)),c=o.add(a).add(l);return new n.nt(1).divide(c).multiply(s.multiply(new n.eB(1,t)))}function c(t,e,i,r){return(0,n.LC)(a(l(t,e,i,r)),new n.nt(1))}function u(t,e,i,a){const l=i.subtract(e),u=a.subtract(e),h=(0,s.tL)(l,u),d=(0,n.Uo)((0,n.Xe)(h,new n.nt(r.M)),(0,n.MM)(h,new n.nt(-r.M)));return(0,n.j1)([(0,n.Uo)((0,n.AU)(d),c(t.xy,e,i,a)),new n.nt(-1)],[!0,()=>{const r=o(t,e,i),s=o(t,i,a),l=o(t,a,e);return(0,n.jk)((0,n.jk)(r,s),l)}])}function h(t){return t.distance.add(1)}function d(t,e,i){const{viewMat3:r,tileMat3:s}=t.view,o=r.multiply(s),a=o.multiply(new n.eB(e.pos,1)),l=o.multiply(new n.eB(i.nextPos1,1)),c=o.multiply(new n.eB(i.nextPos2,1));return u(t.hittestRequest.position,a.xy,l.xy,c.xy)}function f(t,e,i){return(0,n.Io)(t,i).subtract(e)}},86486:function(t,e,i){i.d(e,{K5:function(){return h},Kt:function(){return _},M8:function(){return a},Rj:function(){return p},_9:function(){return o},i6:function(){return d},mh:function(){return u},nb:function(){return c},tL:function(){return l},xf:function(){return m},yS:function(){return f}});var n=i(67529),r=i(70931),s=i(40846);function o(t){const e=(0,r.fV)(12.9898),i=(0,r.fV)(78.233),n=(0,r.fV)(43758.5453),s=(0,r.Om)(t,(0,r.Zc)(e,i)),o=(0,r.zi)(s,(0,r.fV)(3.14));return(0,r.jc)((0,r.F8)(o).multiply(n))}function a(t){return(0,r.LC)(t,(0,r.fV)(s.qM))}function l(t,e){return t.x.multiply(e.y).subtract(e.x.multiply(t.y))}function c(t){return t.multiply(2).subtract(1)}function u(t,e){const i=(0,r.fV)(2**e);return(0,r.zi)((0,r.RI)(t.divide(i)),(0,r.fV)(2))}function h(t,e){return(0,r.MM)(u(t,e),(0,r.fV)(.5))}function d(t,e){return u(t,e+n.M$.length)}function f(t,e){return u(t,e)}function _(t){const e=u(t.z,7),i=(0,r.fV)(1).subtract(e),n=t.xyz.subtract((0,r.eR)(0,0,(0,r.fV)(128)));return i.multiply(t).add(e.multiply(n))}function p(t){const e=(0,r.ln)(255/256,255/65536,255/16777216,255/4294967296);return(0,r.Om)(t,e)}function m(t){return(0,r.T9)((0,r.T9)((0,r.T9)(t.x,t.y),t.z),t.w)}},90906:function(t,e,i){i.d(e,{G5:function(){return r},G7:function(){return o},Mg:function(){return s},TL:function(){return l},cF:function(){return a}});var n=i(70931);function r(t){return null!=t.visualVariableSizeMinMaxValue||null!=t.visualVariableSizeScaleStops||null!=t.visualVariableSizeStops||null!=t.visualVariableSizeUnitValue}function s(t,e,i){if(r(t)){const n=t.storage.getSizeValue(e);return t.visualVariableSizeMinMaxValue?.getSize(n,i)??t.visualVariableSizeScaleStops?.getSizeForViewScale(t.view.currentScale)??t.visualVariableSizeStops?.getSize(n,i)??t.visualVariableSizeUnitValue?.getSize(n,i)}return i}function o(t,e,i,r=new n.x(!1)){if(null==t.visualVariableColor)return i;const s=t.storage.getColorValue(e);return t.visualVariableColor.getColor(s,i,r)}function a(t,e){if(null==t.visualVariableOpacity)return new n.nt(1);const i=t.storage.getOpacityValue(e);return t.visualVariableOpacity.getOpacity(i)}function l(t,e){if(null==t.visualVariableRotation)return n.U.identity();const i=t.storage.getRotationValue(e);return t.visualVariableRotation.getVVRotationMat3(i)}},53972:function(t,e,i){i.d(e,{G8:function(){return I},GJ:function(){return g}});var n=i(15774),r=i(13520),s=i(33134),o=i(84646),a=i(96564),l=i(39686),c=i(17469),u=i(54417),h=i(68758),d=i(54601),f=i(40846),_=i(7590);class p{constructor(t){const{offsetX:e,offsetY:i,postAngle:n,fontSize:r,scaleFactor:s,transforms:o}=t;if(this.offsetX=e,this.offsetY=i,this.postAngle=n,this.fontSize=Math.min(r,96),this.transforms=o,o&&o.infos.length>1){const t=(0,_.zb)(r,n,!1,e,i,o);this.fontSize=Math.min(t.size,96),this.postAngle=t.rotation,this.offsetX=t.offsetX,this.offsetY=t.offsetY}s&&(this.fontSize*=s,this.offsetX*=s,this.offsetY*=s)}}var m=i(85456);const g=28,y=[4,4],v=[16,4],x={topLeft:v,topRight:v,bottomLeft:v,bottomRight:v},b=[4,2],S=[4,6],w={topLeft:b,topRight:b,bottomLeft:S,bottomRight:S},T={topLeft:b,topRight:S,bottomLeft:b,bottomRight:S},M={topLeft:S,topRight:S,bottomLeft:y,bottomRight:y},P={topLeft:y,topRight:y,bottomLeft:S,bottomRight:S},E={topLeft:S,topRight:y,bottomLeft:S,bottomRight:y},A={topLeft:y,topRight:S,bottomLeft:y,bottomRight:S},C={createComputedParams:t=>t,optionalAttributes:{zoomRange:{type:m.pe.UNSIGNED_SHORT,count:2,packPrecisionFactor:l.fq,packTessellation:({minZoom:t,maxZoom:e})=>[t||0,e||g]},clipAngle:{type:m.pe.UNSIGNED_BYTE,count:1,packTessellation:({clipAngle:t})=>R(t||0)},referenceSymbol:{type:m.pe.BYTE,count:4,packPrecisionFactor:1,packTessellation:(t,e)=>{if(!t.referenceBounds)return[0,0,0,0];const i=(0,a.iT)(e.horizontalAlignment),n=(0,a.Dy)(e.verticalAlignment),{offsetX:s,offsetY:o,size:l}=t.referenceBounds;return[(0,r.Lz)(s),-(0,r.Lz)(o),(0,r.Lz)(l),i+1<<2|n+1]}}},attributes:{pos:{type:m.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:m.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:m.pe.UNSIGNED_BYTE,count:1,packTessellation:({isBackground:t,mapAligned:e})=>(0,u.xo)([[f.bg,t],[f.ti,!!e]])},offset:{type:m.pe.SHORT,count:2,packPrecisionFactor:8,packAlternating:{count:4,packTessellation:({offsets:t})=>{const{bottomLeft:e,bottomRight:i,topLeft:n,topRight:r}=t;return[n,r,e,i]}}},textureUV:{type:m.pe.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,packTessellation:({texcoords:t})=>{const{bottomLeft:e,bottomRight:i,topLeft:n,topRight:r}=t;return[n,r,e,i]}}},color:{type:m.pe.UNSIGNED_BYTE,count:4,normalized:!0,packTessellation:({color:t})=>t},fontSize:{type:m.pe.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,packTessellation:({fontSize:t})=>(0,r.Lz)(t)},referenceSize:{type:m.pe.UNSIGNED_BYTE,count:1,packPrecisionFactor:4,packTessellation:({fontSize:t},{referenceSize:e})=>(0,r.Lz)(e??t)},haloColor:{type:m.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({haloColor:t})=>(0,u.Jb)(t)},haloFontSize:{type:m.pe.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,pack:({haloFontSize:t})=>(0,r.Lz)(t)}}};class I extends d.r{constructor(){super(...arguments),this.vertexSpec=C,this._textMeshParamsPropsInitialized=!1}ensurePacked(t,e,i){super.ensurePacked(t,e,i),this._textMeshParamsPropsInitialized&&!this._evaluator.hasDynamicProperties||(this._textMeshTransformProps=new p(this.evaluatedMeshParams),this._textMeshParamsPropsInitialized=!0)}_write(t,e,i){const n=this._getShaping();if(!n)return;const r=e.getDisplayId();if(null!=this.evaluatedMeshParams.placement)return this._writePlacedTextMarkers(t,e,n,i);if(i?.nextPath())return i.nextPoint(),this._writeGlyphs(t,r,i.x,i.y,n,0);if("esriGeometryPolygon"===e.geometryType){const i=e.readCentroidForDisplay();if(!i)return;const[s,o]=i.coords;return this._writeGlyphs(t,r,s,o,n,0)}if("esriGeometryMultipoint"===e.geometryType){const i=e.readGeometryForDisplay();return void i?.forEachVertex(((e,i)=>this._writeGlyphs(t,r,e,i,n,0)))}const s=e.readXForDisplay(),o=e.readYForDisplay();return this._writeGlyphs(t,r,s,o,n,0)}_writePlacedTextMarkers(t,e,i,n){const a=n??s.z.fromFeatureSetReaderCIM(e);if(!a)return;const l=o.l.getPlacement(a,-1,this.evaluatedMeshParams.placement,(0,r.Lz)(1),t.id,(0,h.z)());if(!l)return;const c=e.getDisplayId();let u=l.next();for(;null!=u;){const e=u.tx,n=-u.ty,r=-u.getAngle();this._writeGlyphs(t,c,e,n,i,r),u=l.next()}}_getShaping(t){const e=this._textMeshTransformProps,i=this.evaluatedMeshParams;if(!i.glyphs?.glyphs.length)return null;const s=Math.round((0,r.Lz)(e.fontSize)),o=(0,r.Lz)(e.offsetX),a=(0,r.Lz)(e.offsetY),u=(0,n.qE)((0,r.Lz)(i.lineWidth),l.GR,l.cp),h=l.DY*(0,n.qE)(i.lineHeightRatio,.25,4);return(0,c.Tl)(i.glyphs,{scale:s/l.eG,angle:e.postAngle,xOffset:o,yOffset:a,horizontalAlignment:i.horizontalAlignment,verticalAlignment:t||i.verticalAlignment,maxLineWidth:u,lineHeight:h,decoration:i.decoration,borderLineSizePx:(0,r.Lz)(i.boxBorderLineSize),hasBackground:!!i.boxBackgroundColor,useCIMAngleBehavior:i.useCIMAngleBehavior})}_writeGlyphs(t,e,i,n,s,o,a,l){const c=this.evaluatedMeshParams,h=this._textMeshTransformProps,d=h.fontSize,f=(0,r.Lz)(h.offsetX),_=(0,r.Lz)(h.offsetY),[p,m]=(0,u.My)(c.scaleInfo,this.getTileInfo());0!==o&&s.setRotation(o);const g=s.bounds,y=i+g.x+f,v=n+g.y-_,x=2*(c.minPixelBuffer?c.minPixelBuffer/d:1),b=Math.max(g.width,g.height)*x;s.textBox&&(t.recordStart(this.instanceId,this.attributeLayout,s.glyphs[0].textureBinding),t.recordBounds(y,v,b,b),this._writeTextBox(t,e,i,n,s.textBox,a,l),t.recordEnd());for(const r of s.glyphs){t.recordStart(this.instanceId,this.attributeLayout,r.textureBinding),t.recordBounds(y,v,b,b);const{texcoords:s,offsets:o}=r;this._writeQuad(t,e,i,n,{texcoords:s,offsets:o,fontSize:d,color:(0,u.Jb)(c.color),isBackground:!1,referenceBounds:a,minZoom:p,maxZoom:m,...l}),t.recordEnd()}0!==o&&s.setRotation(-o)}_writeTextBox(t,e,i,n,r,s,o){const a=this.evaluatedMeshParams,{fontSize:l}=this._textMeshTransformProps,{boxBackgroundColor:c,boxBorderLineColor:h}=a,d={isBackground:!0,fontSize:l,referenceBounds:s,...o};c&&(this._writeQuad(t,e,i,n,{texcoords:x,offsets:r.main,color:(0,u.Jb)(c),...d}),h||(this._writeQuad(t,e,i,n,{texcoords:M,offsets:r.top,color:(0,u.Jb)(c),...d}),this._writeQuad(t,e,i,n,{texcoords:P,offsets:r.bot,color:(0,u.Jb)(c),...d}),this._writeQuad(t,e,i,n,{texcoords:E,offsets:r.left,color:(0,u.Jb)(c),...d}),this._writeQuad(t,e,i,n,{texcoords:A,offsets:r.right,color:(0,u.Jb)(c),...d}))),h&&(this._writeQuad(t,e,i,n,{texcoords:w,offsets:r.top,color:(0,u.Jb)(h),...d}),this._writeQuad(t,e,i,n,{texcoords:w,offsets:r.bot,color:(0,u.Jb)(h),...d}),this._writeQuad(t,e,i,n,{texcoords:T,offsets:r.left,color:(0,u.Jb)(h),...d}),this._writeQuad(t,e,i,n,{texcoords:T,offsets:r.right,color:(0,u.Jb)(h),...d}))}_writeQuad(t,e,i,n,r){const s=t.vertexCount();this._writeVertex(t,e,i,n,r),t.indexWrite(s+0),t.indexWrite(s+1),t.indexWrite(s+2),t.indexWrite(s+1),t.indexWrite(s+3),t.indexWrite(s+2)}}const R=t=>Math.round(t*(254/360))},22516:function(t,e,i){i.d(e,{K:function(){return c}});var n=i(39819),r=i(40633),s=i(34194),o=(i(13798),i(58941),i(41835),i(85456),i(96402),i(95904)),a=(i(69452),i(78541),i(88413));function l(t,e,i){const s=e.length;if(s!==i){const o=new n.A("Invalid Uniform",`Invalid length, expected ${i} but got ${s}`,{uniformName:t,values:e});r.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.typed.TypedShaderProgram").errorOnce(o)}}class c{constructor(t,e,i,n,r,s){this._program=null,this._vao=null,this._temporaryTextures=[],this.vertexShader=t,this.fragmentShader=e,this._locations=i,this._locationInfo=n,this._uniformBindings=r,this._transformFeedbackBindings=s}destroy(){this._program&&this._program.dispose(),this.cleanupTemporaryTextures()}get locations(){return this._locations}get locationInfo(){return this._locationInfo}setUniforms(t){this._uniforms=t}cleanupTemporaryTextures(){for(const t of this._temporaryTextures)t.dispose();this._temporaryTextures=[]}bind(t){const e=this._uniforms;if(!this._program){const e=new Map;for(const[t,i]of this._locations)e.set(t,i);const i=[];for(const t of this._transformFeedbackBindings??[]){const{index:e,propertyKey:n}=t;i[e]=`v_${n}`}this._program=new o.B(t,this.vertexShader,this.fragmentShader,e,new Map,i)}const i=this._program;t.useProgram(i);for(const n of this._uniformBindings){const{shaderModulePath:r,uniformName:o,uniformType:c,uniformArrayLength:u}=n,h=(0,s.wc)(r,e);if(null==h){if("sampler2D"===c)continue;throw new Error(`Failed to find uniform value for ${r}`)}switch("array"===c?n.uniformArrayElementType:c){case"sampler2D":{const{unit:e,texture:n}=h;if(i.setUniform1i(o,e),"type"in n)t.bindTexture(n,e);else{const i=(0,a.sZ)(t,n.descriptor,n.data);t.bindTexture(i,e)}break}case"int":if(!u){i.setUniform1i(o,h);break}l(n.uniformName,h,u),i.setUniform1iv(o,h);break;case"float":if(!u){i.setUniform1f(o,h);break}l(n.uniformName,h,u),i.setUniform1fv(o,h);break;case"vec2":if(!u){i.setUniform2f(o,h[0],h[1]);break}l(n.uniformName,h,u),i.setUniform2fv(o,h.flat());break;case"vec3":if(!u){i.setUniform3f(o,h[0],h[1],h[2]);break}l(n.uniformName,h,u),i.setUniform3fv(o,h.flat());break;case"vec4":if(!u){i.setUniform4f(o,h[0],h[1],h[2],h[3]);break}l(n.uniformName,h,u),i.setUniform4fv(o,h.flat());break;case"mat3":i.setUniformMatrix3fv(o,h.flat());break;case"mat4":i.setUniformMatrix4fv(o,h.flat());break;default:throw new Error(`Unable to set uniform for type ${c}`)}}}}},94020:function(t,e,i){i.d(e,{T:function(){return r}});var n=i(44723);const r={shaders:{vertexShader:(0,n.Q)("background/background.vert"),fragmentShader:(0,n.Q)("background/background.frag")},attributes:new Map([["a_pos",0]])}},52432:function(t,e,i){i.d(e,{J:function(){return r}});var n=i(44723);const r={shaders:{vertexShader:(0,n.Q)("bitBlit/bitBlit.vert"),fragmentShader:(0,n.Q)("bitBlit/bitBlit.frag")},attributes:new Map([["a_pos",0],["a_tex",1]])}},17040:function(t,e,i){i.d(e,{G:function(){return s},Z:function(){return r}});var n=i(44723);const r={shaders:{vertexShader:(0,n.Q)("highlight/textured.vert"),fragmentShader:(0,n.Q)("highlight/highlight.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])},s={shaders:{vertexShader:(0,n.Q)("highlight/textured.vert"),fragmentShader:(0,n.Q)("highlight/blur.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])}},95680:function(t,e,i){i.d(e,{h:function(){return o},j:function(){return s}});var n=i(44723),r=i(10904);const s={shaders:{vertexShader:(0,n.Q)("magnifier/magnifier.vert"),fragmentShader:(0,n.Q)("magnifier/magnifier.frag")},attributes:new Map([["a_pos",0]])};function o(t){return(0,r.r)(t,s)}},50437:function(t,e,i){i.d(e,{p:function(){return a}});var n=i(44723),r=i(72785);const s=t=>{let e="";e+=t[0].toUpperCase();for(let i=1;i<t.length;i++){const n=t[i];n===n.toUpperCase()?(e+="_",e+=n):e+=n.toUpperCase()}return e},o=t=>{const e={};for(const i in t)e[s(i)]=t[i];return(0,r.I)(e)},a=(t,e,i,r)=>{const s=t+t.substring(t.lastIndexOf("/")),a=e+e.substring(e.lastIndexOf("/")),l=o(r);return{attributes:i,shaders:{vertexShader:l+(0,n.Q)(`${s}.vert`),fragmentShader:l+(0,n.Q)(`${a}.frag`)}}}},21024:function(t,e,i){i.d(e,{P:function(){return r}});var n=i(44723);const r={shaders:{vertexShader:(0,n.Q)("stencil/stencil.vert"),fragmentShader:(0,n.Q)("stencil/stencil.frag")},attributes:new Map([["a_pos",0]])}},47272:function(t,e,i){i.d(e,{H:function(){return r}});var n=i(44723);const r={shaders:{vertexShader:(0,n.Q)("tileInfo/tileInfo.vert"),fragmentShader:(0,n.Q)("tileInfo/tileInfo.frag")},attributes:new Map([["a_pos",0]])}},44723:function(t,e,i){i.d(e,{Q:function(){return s}});const n=new(i(65644).Z)((r={background:{"background.frag":"uniform lowp vec4 u_color;\nvoid main() {\ngl_FragColor = u_color;\n}","background.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump vec2 u_coord_range;\nuniform mediump float u_depth;\nvoid main() {\nvec3 v_pos = u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0);\ngl_Position = vec4(v_pos.xy, 0.0, 1.0);\n}"},bitBlit:{"bitBlit.frag":"uniform lowp sampler2D u_tex;\nuniform lowp float u_opacity;\nvarying mediump vec2 v_uv;\nvoid main() {\nlowp vec4 color = texture2D(u_tex, v_uv);\ngl_FragColor = color * u_opacity;\n}","bitBlit.vert":"attribute vec2 a_pos;\nattribute vec2 a_tex;\nvarying mediump vec2 v_uv;\nvoid main(void) {\ngl_Position = vec4(a_pos , 0.0, 1.0);\nv_uv = a_tex;\n}"},blend:{"blend.frag":"precision mediump float;\nuniform sampler2D u_layerTexture;\nuniform lowp float u_opacity;\nuniform lowp float u_inFadeOpacity;\n#ifndef NORMAL\nuniform sampler2D u_backbufferTexture;\n#endif\nvarying mediump vec2 v_uv;\nfloat rgb2v(in vec3 c) {\nreturn max(c.x, max(c.y, c.z));\n}\nvec3 rgb2hsv(in vec3 c) {\nvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\nvec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\nfloat d = q.x - min(q.w, q.y);\nfloat e = 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(in vec3 c) {\nvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec3 tint(in vec3 Cb, in vec3 Cs) {\nfloat vIn = rgb2v(Cb);\nvec3 hsvTint = rgb2hsv(Cs);\nvec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);\nreturn hsv2rgb(hsvOut);\n}\nfloat overlay(in float Cb, in float Cs) {\nreturn (1.0 - step(0.5, Cs)) * (1.0 - 2.0 * (1.0 - Cs ) * (1.0 - Cb)) + step(0.5, Cs) * (2.0 * Cs * Cb);\n}\nfloat colorDodge(in float Cb, in float Cs) {\nreturn (Cb == 0.0) ? 0.0 : (Cs == 1.0) ? 1.0 : min(1.0, Cb / (1.0 - Cs));\n}\nfloat colorBurn(in float Cb, in float Cs) {\nreturn (Cb == 1.0) ? 1.0 : (Cs == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - Cb) / Cs);\n}\nfloat hardLight(in float Cb, in float Cs) {\nreturn (1.0 - step(0.5, Cs)) * (2.0 * Cs * Cb) + step(0.5, Cs) * (1.0 - 2.0 * (1.0 - Cs) * (1.0 - Cb));\n}\nfloat reflectBlend(in float Cb, in float Cs) {\nreturn (Cs == 1.0) ? Cs : min(Cb * Cb / (1.0 - Cs), 1.0);\n}\nfloat softLight(in float Cb, in float Cs) {\nif (Cs <= 0.5) {\nreturn Cb - (1.0 - 2.0 * Cs) * Cb * (1.0 - Cb);\n}\nif (Cb <= 0.25) {\nreturn Cb + (2.0 * Cs - 1.0) * Cb * ((16.0 * Cb - 12.0) * Cb + 3.0);\n}\nreturn Cb + (2.0 * Cs - 1.0) * (sqrt(Cb) - Cb);\n}\nfloat vividLight(in float Cb, in float Cs) {\nreturn (1.0 - step(0.5, Cs)) * colorBurn(Cb, 2.0 * Cs) + step(0.5, Cs) * colorDodge(Cb, (2.0 * (Cs - 0.5)));\n}\nfloat minv3(in vec3 c) {\nreturn min(min(c.r, c.g), c.b);\n}\nfloat maxv3(in vec3 c) {\nreturn max(max(c.r, c.g), c.b);\n}\nfloat lumv3(in vec3 c) {\nreturn dot(c, vec3(0.3, 0.59, 0.11));\n}\nfloat satv3(vec3 c) {\nreturn maxv3(c) - minv3(c);\n}\nvec3 clipColor(vec3 color) {\nfloat lum = lumv3(color);\nfloat mincol = minv3(color);\nfloat maxcol = maxv3(color);\nif (mincol < 0.0) {\ncolor = lum + ((color - lum) * lum) / (lum - mincol);\n}\nif (maxcol > 1.0) {\ncolor = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);\n}\nreturn color;\n}\nvec3 setLum(vec3 cbase, vec3 clum) {\nfloat lbase = lumv3(cbase);\nfloat llum = lumv3(clum);\nfloat ldiff = llum - lbase;\nvec3 color = cbase + vec3(ldiff);\nreturn clipColor(color);\n}\nvec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)\n{\nfloat minbase = minv3(cbase);\nfloat sbase = satv3(cbase);\nfloat ssat = satv3(csat);\nvec3 color;\nif (sbase > 0.0) {\ncolor = (cbase - minbase) * ssat / sbase;\n} else {\ncolor = vec3(0.0);\n}\nreturn setLum(color, clum);\n}\nvoid main() {\nvec4 src = texture2D(u_layerTexture, v_uv);\n#ifdef NORMAL\ngl_FragColor = src *  u_opacity;\n#else\nvec4 dst = texture2D(u_backbufferTexture, v_uv);\nvec3 Cs = src.a == 0.0 ? src.rgb : vec3(src.rgb / src.a);\nvec3 Cb = dst.a == 0.0 ? dst.rgb : vec3(dst.rgb / dst.a);\nfloat as = u_opacity * src.a;\nfloat ab = dst.a;\n#ifdef DESTINATION_OVER\ngl_FragColor = vec4(as * Cs * (1.0 - ab) + ab * Cb, as + ab - as * ab);\n#endif\n#ifdef SOURCE_IN\nvec4 color = vec4(as * Cs * ab, as * ab);\nvec4 fadeColor = (1.0 - u_opacity) * u_inFadeOpacity * vec4(ab * Cb, ab);\ngl_FragColor = color + fadeColor;\n#endif\n#ifdef DESTINATION_IN\nvec4 color = vec4(ab * Cb * as, ab * as);\nvec4 fadeColor = (1.0 - u_opacity) * u_inFadeOpacity * vec4(ab * Cb, ab);\ngl_FragColor = color + fadeColor;\n#endif\n#ifdef SOURCE_OUT\ngl_FragColor = vec4(as * Cs * (1.0 - ab), as * (1.0 - ab));\n#endif\n#ifdef DESTINATION_OUT\ngl_FragColor = vec4(ab * Cb * (1.0 - as), ab * (1.0 - as));\n#endif\n#ifdef SOURCE_ATOP\ngl_FragColor = vec4(as * Cs * ab + ab * Cb * (1.0 - as), ab);\n#endif\n#ifdef DESTINATION_ATOP\ngl_FragColor = vec4(as * Cs * (1.0 - ab) + ab * Cb * as, as);\n#endif\n#ifdef XOR\ngl_FragColor = vec4(as * Cs * (1.0 - ab) + ab * Cb * (1.0 - as),\nas * (1.0 - ab) + ab * (1.0 - as));\n#endif\n#ifdef MULTIPLY\ngl_FragColor = vec4(as * Cs * ab * Cb + (1.0 - ab) * as * Cs + (1.0 - as) * ab * Cb,\nas + ab * (1.0 - as));\n#endif\n#ifdef SCREEN\ngl_FragColor = vec4((Cs + Cb - Cs * Cb) * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef OVERLAY\nvec3 f = vec3(overlay(Cb.r, Cs.r), overlay(Cb.g, Cs.g), overlay(Cb.b, Cs.b));\ngl_FragColor = vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef DARKEN\ngl_FragColor = vec4(min(Cs, Cb) * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef LIGHTER\ngl_FragColor = vec4(as * Cs + ab * Cb, as + ab);\n#endif\n#ifdef LIGHTEN\ngl_FragColor = vec4(max(Cs, Cb) * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef COLOR_DODGE\nvec3 f = clamp(vec3(colorDodge(Cb.r, Cs.r), colorDodge(Cb.g, Cs.g), colorDodge(Cb.b, Cs.b)), vec3(0.0), vec3(1.0));\ngl_FragColor = vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef COLOR_BURN\nvec3 f = vec3(colorBurn(Cb.r, Cs.r), colorBurn(Cb.g, Cs.g), colorBurn(Cb.b, Cs.b));\ngl_FragColor = vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef HARD_LIGHT\nvec3 f = vec3(hardLight(Cb.r, Cs.r), hardLight(Cb.g, Cs.g), hardLight(Cb.b, Cs.b));\ngl_FragColor = vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef SOFT_LIGHT\nvec3 f = vec3(softLight(Cb.r, Cs.r), softLight(Cb.g, Cs.g), softLight(Cb.b, Cs.b));\ngl_FragColor = vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef DIFFERENCE\ngl_FragColor = vec4(abs(Cb - Cs) * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef EXCLUSION\nvec3 f = Cs + Cb - 2.0 * Cs * Cb;\ngl_FragColor = vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef INVERT\ngl_FragColor = vec4((1.0 - Cb) * as * ab + Cb * ab * (1.0 - as), ab);\n#endif\n#ifdef VIVID_LIGHT\nvec3 f = vec3(clamp(vividLight(Cb.r, Cs.r), 0.0, 1.0),\nclamp(vividLight(Cb.g, Cs.g), 0.0, 1.0),\nclamp(vividLight(Cb.b, Cs.b), 0.0, 1.0));\ngl_FragColor = vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef HUE\nvec3 f = setLumSat(Cs,Cb,Cb);\ngl_FragColor = vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef SATURATION\nvec3 f = setLumSat(Cb,Cs,Cb);\ngl_FragColor = vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef COLOR\nvec3 f = setLum(Cs,Cb);\ngl_FragColor = vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef LUMINOSITY\nvec3 f = setLum(Cb,Cs);\ngl_FragColor = vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef PLUS\ngl_FragColor = clamp(vec4(src.r + Cb.r, src.g + Cb.g, src.b + Cb.b, as + ab), 0.0, 1.0);\n#endif\n#ifdef MINUS\ngl_FragColor = vec4(clamp(vec3(Cb.r - src.r, Cb.g - src.g, Cb.b - src.b), 0.0, 1.0), ab * as);\n#endif\n#ifdef AVERAGE\nvec3 f = (Cb + Cs) / 2.0;\ngl_FragColor = vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef REFLECT\nvec3 f = clamp(vec3(reflectBlend(Cb.r, Cs.r),\nreflectBlend(Cb.g, Cs.g),\nreflectBlend(Cb.b, Cs.b)), vec3(0.0), vec3(1.0));\ngl_FragColor = vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#endif\n}","blend.vert":"attribute vec2 a_position;\nvarying mediump vec2 v_uv;\nvoid main(void) {\ngl_Position = vec4(a_position , 0.0, 1.0);\nv_uv = (a_position + 1.0) / 2.0;\n}"},debug:{overlay:{"overlay.frag":"precision mediump float;\nvarying vec4 v_color;\nvoid main(void) {\ngl_FragColor = v_color;\n}","overlay.vert":"attribute vec3 a_PositionAndFlags;\nuniform mat3 u_dvsMat3;\nuniform vec4 u_colors[4];\nuniform float u_opacities[4];\nvarying vec4 v_color;\nvoid main(void) {\nvec2 position = a_PositionAndFlags.xy;\nfloat flags = a_PositionAndFlags.z;\nint colorIndex = int(mod(flags, 4.0));\nvec4 color;\nfor (int i = 0; i < 4; i++) {\ncolor = u_colors[i];\nif (i == colorIndex) {\nbreak;\n}\n}\nint opacityIndex = int(mod(floor(flags / 4.0), 4.0));\nfloat opacity;\nfor (int i = 0; i < 4; i++) {\nopacity = u_opacities[i];\nif (i == opacityIndex) {\nbreak;\n}\n}\nv_color = color * opacity;\ngl_Position = vec4((u_dvsMat3 * vec3(position, 1.0)).xy, 0.0, 1.0);\n}"}},dot:{dot:{"dot.frag":"precision mediump float;\nvarying vec4 v_color;\nvarying float v_dotRatio;\nvarying float v_invEdgeRatio;\nuniform highp float u_tileZoomFactor;\nvoid main()\n{\nfloat dist = length(gl_PointCoord - vec2(.5, .5)) * 2.;\nfloat alpha = smoothstep(0., 1., v_invEdgeRatio * (dist - v_dotRatio) + 1.);\ngl_FragColor = v_color * alpha;\n}","dot.vert":"precision highp float;\nattribute vec2 a_pos;\nuniform sampler2D u_texture;\nuniform highp mat3 u_dvsMat3;\nuniform highp float u_tileZoomFactor;\nuniform highp float u_dotSize;\nuniform highp float u_pixelRatio;\nvarying vec2 v_pos;\nvarying vec4 v_color;\nvarying float v_dotRatio;\nvarying float v_invEdgeRatio;\nconst float EPSILON = 0.000001;\nvoid main()\n{\nmat3 tileToTileTexture = mat3(  1., 0., 0.,\n0., -1., 0.,\n0., 1., 1.  );\nvec3 texCoords = tileToTileTexture * vec3(a_pos.xy / 512., 1.);\nv_color = texture2D(u_texture, texCoords.xy);\nfloat smoothEdgeWidth = max(u_dotSize / 2., 1.) ;\nfloat z = 0.;\nz += 2.0 * step(v_color.a, EPSILON);\ngl_PointSize = (smoothEdgeWidth + u_dotSize);\ngl_Position = vec4((u_dvsMat3 * vec3(a_pos + .5, 1.)).xy, z, 1.);\nv_dotRatio = u_dotSize / gl_PointSize;\nv_invEdgeRatio = -1. / ( smoothEdgeWidth / gl_PointSize );\ngl_PointSize  *= (u_pixelRatio * u_tileZoomFactor);\n}"}},filtering:{"bicubic.glsl":"vec4 computeWeights(float v) {\nfloat b = 1.0 / 6.0;\nfloat v2 = v * v;\nfloat v3 = v2 * v;\nfloat w0 = b * (-v3 + 3.0 * v2 - 3.0 * v + 1.0);\nfloat w1 = b * (3.0 * v3  - 6.0 * v2 + 4.0);\nfloat w2 = b * (-3.0 * v3 + 3.0 * v2 + 3.0 * v + 1.0);\nfloat w3 = b * v3;\nreturn vec4(w0, w1, w2, w3);\n}\nvec4 bicubicOffsetsAndWeights(float v) {\nvec4 w = computeWeights(v);\nfloat g0 = w.x + w.y;\nfloat g1 = w.z + w.w;\nfloat h0 = 1.0 - (w.y / g0) + v;\nfloat h1 = 1.0 + (w.w / g1) - v;\nreturn vec4(h0, h1, g0, g1);\n}\nvec4 sampleBicubicBSpline(sampler2D sampler, vec2 coords, vec2 texSize) {\nvec2 eX = vec2(1.0 / texSize.x, 0.0);\nvec2 eY = vec2(0.0, 1.0 / texSize.y);\nvec2 texel = coords * texSize - 0.5;\nvec3 hgX = bicubicOffsetsAndWeights(fract(texel).x).xyz;\nvec3 hgY = bicubicOffsetsAndWeights(fract(texel).y).xyz;\nvec2 coords10 = coords + hgX.x * eX;\nvec2 coords00 = coords - hgX.y * eX;\nvec2 coords11 = coords10 + hgY.x * eY;\nvec2 coords01 = coords00 + hgY.x * eY;\ncoords10 = coords10 - hgY.y * eY;\ncoords00 = coords00 - hgY.y * eY;\nvec4 color00 = texture2D(sampler, coords00);\nvec4 color10 = texture2D(sampler, coords10);\nvec4 color01 = texture2D(sampler, coords01);\nvec4 color11 = texture2D(sampler, coords11);\ncolor00 = mix(color00, color01, hgY.z);\ncolor10 = mix(color10, color11, hgY.z);\ncolor00 = mix(color00, color10, hgX.z);\nreturn color00;\n}","bilinear.glsl":"vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {\nvec2 texelStart = floor(coords * texSize);\nvec2 coord0 = texelStart / texSize;\nvec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;\nvec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;\nvec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;\nvec4 color0 = texture2D(sampler, coord0);\nvec4 color1 = texture2D(sampler, coord1);\nvec4 color2 = texture2D(sampler, coord2);\nvec4 color3 = texture2D(sampler, coord3);\nvec2 blend = fract(coords * texSize);\nvec4 color01 = mix(color0, color1, blend.x);\nvec4 color23 = mix(color2, color3, blend.x);\nvec4 color = mix(color01, color23, blend.y);\n#ifdef NNEDGE\nfloat alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);\ncolor = color * alpha + (1.0 - alpha) * texture2D(sampler, coords);\n#endif\nreturn color;\n}","epx.glsl":"vec4 sampleEPX(sampler2D sampler, float size, vec2 coords, vec2 texSize) {\nvec2 invSize = 1.0 / texSize;\nvec2 texel = coords * texSize;\nvec2 texel_i = floor(texel);\nvec2 texel_frac = fract(texel);\nvec4 colorP = texture2D(sampler, texel_i * invSize);\nvec4 colorP1 = vec4(colorP);\nvec4 colorP2 = vec4(colorP);\nvec4 colorP3 = vec4(colorP);\nvec4 colorP4 = vec4(colorP);\nvec4 colorA = texture2D(sampler, (texel_i - vec2(0.0, 1.0)) * invSize);\nvec4 colorB = texture2D(sampler, (texel_i + vec2(1.0, 0.0)) * invSize);\nvec4 colorC = texture2D(sampler, (texel_i - vec2(1.0, 0.0)) * invSize);\nvec4 colorD = texture2D(sampler, (texel_i + vec2(0.0, 1.0)) * invSize);\nif (colorC == colorA && colorC != colorD && colorA != colorB) {\ncolorP1 = colorA;\n}\nif (colorA == colorB && colorA != colorC && colorB != colorD) {\ncolorP2 = colorB;\n}\nif (colorD == colorC && colorD != colorB && colorC != colorA) {\ncolorP3 = colorC;\n}\nif (colorB == colorD && colorB != colorA && colorD != colorC) {\ncolorP4 = colorD;\n}\nvec4 colorP12 = mix(colorP1, colorP2, texel_frac.x);\nvec4 colorP34 = mix(colorP1, colorP2, texel_frac.x);\nreturn mix(colorP12, colorP34, texel_frac.y);\n}"},fx:{integrate:{"integrate.frag":"precision mediump float;\nuniform lowp sampler2D u_sourceTexture;\nuniform lowp sampler2D u_maskTexture;\nuniform mediump float u_zoomLevel;\nuniform highp float u_timeDelta;\nuniform highp float u_animationTime;\nvarying highp vec2 v_texcoord;\n#include <materials/utils.glsl>\nvoid main()\n{\n#ifdef DELTA\nvec4 texel = texture2D(u_sourceTexture, v_texcoord);\nvec4 data0 = texture2D(u_maskTexture, v_texcoord);\nfloat flags = data0.r * 255.0;\nfloat groupMinZoom = data0.g * 255.0;\nfloat epsilon = 5.;\nfloat wouldClip = float(groupMinZoom < epsilon);\nfloat direction = wouldClip * 1.0 + (1.0 - wouldClip) * -1.0;\nfloat dt = u_timeDelta / max(u_animationTime, 0.0001);\nvec4 nextState = vec4(texel + direction * dt);\ngl_FragColor =  vec4(nextState);\n#elif defined(UPDATE)\nvec4 texel = texture2D(u_sourceTexture, v_texcoord);\ngl_FragColor = texel;\n#endif\n}","integrate.vert":"precision mediump float;\nattribute vec2 a_pos;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord = a_pos;\ngl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}"}},heatmap:{heatmapResolve:{"heatmapResolve.frag":"precision highp float;\n#ifdef HEATMAP_PRECISION_HALF_FLOAT\n#define COMPRESSION_FACTOR 4.0\n#else\n#define COMPRESSION_FACTOR 1.0\n#endif\nuniform sampler2D u_texture;\nuniform sampler2D u_gradient;\nuniform vec2 u_densityMinAndInvRange;\nuniform float u_densityNormalization;\nvarying vec2 v_uv;\nvoid main() {\nvec4 data = texture2D(u_texture, v_uv);\nfloat density = data.r * COMPRESSION_FACTOR;\ndensity *= u_densityNormalization;\ndensity = (density - u_densityMinAndInvRange.x) * u_densityMinAndInvRange.y;\nvec4 color = texture2D(u_gradient, vec2(density, 0.5));\ngl_FragColor = vec4(color.rgb * color.a, color.a);\n}","heatmapResolve.vert":"precision highp float;\nattribute vec2 a_pos;\nvarying vec2 v_uv;\nvoid main() {\nv_uv = a_pos;\ngl_Position = vec4(a_pos * 2.0 - 1.0, 1., 1.);\n}"}},highlight:{"blur.frag":"varying mediump vec2 v_texcoord;\nuniform mediump vec4 u_direction;\nuniform mediump mat4 u_channelSelector;\nuniform mediump float u_sigma;\nuniform sampler2D u_texture;\nmediump float gauss1(mediump vec2 dir) {\nreturn exp(-dot(dir, dir) / (2.0 * u_sigma * u_sigma));\n}\nmediump vec4 selectChannel(mediump vec4 sample) {\nreturn u_channelSelector * sample;\n}\nvoid accumGauss1(mediump float i, inout mediump float tot, inout mediump float weight) {\nmediump float w = gauss1(i * u_direction.xy);\ntot += selectChannel(texture2D(u_texture, v_texcoord + i * u_direction.zw))[3] * w;\nweight += w;\n}\nvoid main(void) {\nmediump float tot = 0.0;\nmediump float weight = 0.0;\naccumGauss1(-5.0, tot, weight);\naccumGauss1(-4.0, tot, weight);\naccumGauss1(-3.0, tot, weight);\naccumGauss1(-2.0, tot, weight);\naccumGauss1(-1.0, tot, weight);\naccumGauss1(0.0, tot, weight);\naccumGauss1(1.0, tot, weight);\naccumGauss1(2.0, tot, weight);\naccumGauss1(3.0, tot, weight);\naccumGauss1(4.0, tot, weight);\naccumGauss1(5.0, tot, weight);\ngl_FragColor = vec4(0.0, 0.0, 0.0, tot / weight);\n}","highlight.frag":"varying mediump vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform mediump float u_sigma;\nuniform sampler2D u_shade;\nuniform mediump vec2 u_minMaxDistance;\nmediump float estimateDistance() {\nmediump float y = texture2D(u_texture, v_texcoord)[3];\nconst mediump float y0 = 0.5;\nmediump float m0 = 1.0 / (sqrt(2.0 * 3.1415) * u_sigma);\nmediump float d = (y - y0) / m0;\nreturn d;\n}\nmediump vec4 shade(mediump float d) {\nmediump float mappedDistance = (d - u_minMaxDistance.x) / (u_minMaxDistance.y - u_minMaxDistance.x);\nmappedDistance = clamp(mappedDistance, 0.0, 1.0);\nreturn texture2D(u_shade, vec2(mappedDistance, 0.5));\n}\nvoid main(void) {\nmediump float d = estimateDistance();\ngl_FragColor = shade(d);\n}","textured.vert":"attribute mediump vec2 a_position;\nattribute mediump vec2 a_texcoord;\nvarying mediump vec2 v_texcoord;\nvoid main(void) {\ngl_Position = vec4(a_position, 0.0, 1.0);\nv_texcoord = a_texcoord;\n}"},magnifier:{"magnifier.frag":"uniform lowp vec4 u_background;\nuniform mediump sampler2D u_readbackTexture;\nuniform mediump sampler2D u_maskTexture;\nuniform mediump sampler2D u_overlayTexture;\nuniform bool u_maskEnabled;\nuniform bool u_overlayEnabled;\nvarying mediump vec2 v_texCoord;\nconst lowp float barrelFactor = 1.1;\nlowp vec2 barrel(lowp vec2 uv) {\nlowp vec2 uvn = uv * 2.0 - 1.0;\nif (uvn.x == 0.0 && uvn.y == 0.0) {\nreturn vec2(0.5, 0.5);\n}\nlowp float theta = atan(uvn.y, uvn.x);\nlowp float r = pow(length(uvn), barrelFactor);\nreturn r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;\n}\nvoid main(void)\n{\nlowp vec4 color = texture2D(u_readbackTexture, barrel(v_texCoord));\ncolor = (color + (1.0 - color.a) * u_background);\nlowp float mask = u_maskEnabled ? texture2D(u_maskTexture, v_texCoord).a : 1.0;\ncolor *= mask;\nlowp vec4 overlayColor = u_overlayEnabled ? texture2D(u_overlayTexture, v_texCoord) : vec4(0);\ngl_FragColor = overlayColor + (1.0 - overlayColor.a) * color;\n}","magnifier.vert":"precision mediump float;\nattribute mediump vec2 a_pos;\nuniform mediump vec4 u_drawPos;\nvarying mediump vec2 v_texCoord;\nvoid main(void)\n{\nv_texCoord = a_pos;\ngl_Position = vec4(u_drawPos.xy + vec2(a_pos - 0.5) * u_drawPos.zw, 0.0, 1.0);\n}"},materials:{"attributeData.glsl":"uniform highp sampler2D filterFlags;\nuniform highp sampler2D animation;\nuniform highp sampler2D gpgpu;\nuniform highp sampler2D visualVariableData;\nuniform highp sampler2D dataDriven0;\nuniform highp sampler2D dataDriven1;\nuniform highp sampler2D dataDriven2;\nuniform float size;\nhighp vec2 getAttributeDataCoords(in highp vec3 id) {\nhighp vec3  texel = unpackDisplayIdTexel(id);\nhighp float u32 = float(int(texel.r) + int(texel.g) * 256 + int(texel.b) * 256 * 256);\nhighp float col = mod(u32, size);\nhighp float row = (u32 - col) / size;\nhighp float u = col / size;\nhighp float v = row / size;\nreturn vec2(u, v);\n}\nhighp vec2 getAttributeDataTextureCoords(in highp vec3 id) {\nreturn (getAttributeDataCoords(id) * 2.0) - 1.0 + (.5 / vec2(size));\n}\nhighp vec4 getFilterData(in highp vec3 id) {\nvec2 coords = getAttributeDataCoords(id);\nreturn texture2D(filterFlags, coords);\n}\nhighp vec4 getAnimation(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(animation, coords);\n}\nhighp vec4 getVisualVariableData(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(visualVariableData, coords);\n}\nhighp vec4 getDataDriven0(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(dataDriven0, coords);\n}\nhighp vec4 getDataDriven1(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(dataDriven1, coords);\n}\nhighp vec4 getGPGPU(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(gpgpu, coords);\n}\nhighp vec4 getDataDriven2(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(dataDriven2, coords);\n}\nfloat u88VVToFloat(in vec2 v) {\nbool isMagic = v.x == 255.0 && v.y == 255.0;\nif (isMagic) {\nreturn NAN_MAGIC_NUMBER;\n}\nreturn (v.x + v.y * float(0x100)) - 32768.0;\n}","barycentric.glsl":"float inTriangle(vec3 bary) {\nvec3 absBary = abs(bary);\nreturn step((absBary.x + absBary.y + absBary.z), 1.05);\n}\nvec3 xyToBarycentric(in vec2 pos, in vec2 v0,  in vec2 v1, in vec2 v2) {\nmat3 xyToBarycentricMat3 = mat3(\nv1.x * v2.y - v2.x * v1.y, v2.x * v0.y - v0.x * v2.y, v0.x * v1.y - v1.x * v0.y,\nv1.y - v2.y, v2.y - v0.y, v0.y - v1.y,\nv2.x - v1.x, v0.x - v2.x, v1.x - v0.x\n);\nfloat A2 = v0.x * (v1.y - v2.y) + v1.x * (v2.y - v0.y) + v2.x * (v0.y - v1.y);\nreturn (1. / A2) * xyToBarycentricMat3 * vec3(1., pos);\n}","constants.glsl":"const float C_DEG_TO_RAD = 3.14159265359 / 180.0;\nconst float C_256_TO_RAD = 3.14159265359 / 128.0;\nconst float C_RAD_TO_DEG = 180.0 / 3.141592654;\nconst float POSITION_PRECISION = 1.0 / 8.0;\nconst float FILL_POSITION_PRECISION = 1.0 / 1.0;\nconst float SOFT_EDGE_RATIO = 1.0;\nconst float THIN_LINE_WIDTH_FACTOR = 1.1;\nconst float THIN_LINE_HALF_WIDTH = 1.0;\nconst float EXTRUDE_SCALE_PLACEMENT_PADDING = 1.0 / 4.0;\nconst float OFFSET_PRECISION = 1.0 / 8.0;\nconst float OUTLINE_SCALE = 1.0 / 5.0;\nconst float SDF_FONT_SIZE = 24.0;\nconst float MAX_SDF_DISTANCE = 8.0;\nconst float PLACEMENT_PADDING = 8.0;\nconst float EPSILON = 0.00001;\nconst float EPSILON_HITTEST = 0.05;\nconst int MAX_FILTER_COUNT = 2;\nconst int ATTR_VV_SIZE = 0;\nconst int ATTR_VV_COLOR = 1;\nconst int ATTR_VV_OPACITY = 2;\nconst int ATTR_VV_ROTATION = 3;\nconst highp float NAN_MAGIC_NUMBER = 1e-30;\nconst int BITSET_GENERIC_LOCK_COLOR = 1;\nconst int BITSET_GENERIC_CONSIDER_ALPHA_ONLY = 4;\nconst int BITSET_MARKER_ALIGNMENT_MAP = 0;\nconst int BITSET_MARKER_OUTLINE_ALLOW_COLOR_OVERRIDE = 2;\nconst int BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY = 3;\nconst int BITSET_TYPE_FILL_OUTLINE = 0;\nconst int BITSET_FILL_RANDOM_PATTERN_OFFSET = 2;\nconst int BITSET_FILL_HAS_UNRESOLVED_REPLACEMENT_COLOR = 3;\nconst int BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR = 5;\nconst int BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR = 6;\nconst int BITSET_LINE_SCALE_DASH = 2;",fill:{"common.glsl":"#include <materials/symbologyTypeUtils.glsl>\n#ifdef PATTERN\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_sampleAlphaOnly;\n#endif\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nuniform lowp vec4 u_isActive[ 2 ];\nuniform highp float u_dotValue;\nuniform highp float u_tileDotsOverArea;\nuniform highp float u_dotTextureDotCount;\nuniform mediump float u_tileZoomFactor;\n#endif\nvarying highp vec3 v_id;\nvarying lowp vec4 v_color;\nvarying lowp float v_opacity;\nvarying mediump vec4 v_aux1;\n#ifdef PATTERN\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nvarying lowp float v_isOutline;\n#endif\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nvarying highp vec2 v_dotTextureCoords;\nvarying highp vec4 v_dotThresholds[ 2 ];\n#endif","fill.frag":"precision highp float;\n#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/fill/common.glsl>\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\n#endif\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nuniform mediump mat4 u_dotColors[ 2 ];\nuniform sampler2D u_dotTextures[ 2 ];\nuniform vec4 u_dotBackgroundColor;\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#include <materials/shared/line/common.glsl>\n#include <materials/shared/line/line.frag>\nlowp vec4 drawLine() {\nfloat v_lineWidth = v_aux1.x;\nvec2  v_normal    = v_aux1.yz;\nLineData inputs = LineData(\nv_color,\nv_normal,\nv_lineWidth,\nv_opacity,\nv_id\n);\nreturn shadeLine(inputs);\n}\n#endif\nlowp vec4 drawFill() {\nlowp vec4 out_color = vec4(0.);\n#ifdef HITTEST\nout_color = v_color;\n#elif defined(PATTERN)\nmediump vec4 v_tlbr = v_aux1;\nmediump vec2 normalizedTextureCoord = mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\nif (v_sampleAlphaOnly > 0.5) {\ncolor.rgb = vec3(color.a);\n}\nout_color = v_opacity * v_color * color;\n#elif SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY && !defined(HIGHLIGHT)\nvec4 textureThresholds0 = texture2D(u_dotTextures[0], v_dotTextureCoords);\nvec4 textureThresholds1 = texture2D(u_dotTextures[1], v_dotTextureCoords);\nvec4 difference0 = v_dotThresholds[0] - textureThresholds0;\nvec4 difference1 = v_dotThresholds[1] - textureThresholds1;\n#ifdef DD_DOT_BLENDING\nvec4 isPositive0 = step(0.0, difference0);\nvec4 isPositive1 = step(0.0, difference1);\nfloat weightSum = dot(isPositive0, difference0) + dot(isPositive1, difference1);\nfloat lessThanEqZero = step(weightSum, 0.0);\nfloat greaterThanZero = 1.0 - lessThanEqZero ;\nfloat divisor = (weightSum + lessThanEqZero);\nvec4 weights0 = difference0 * isPositive0 / divisor;\nvec4 weights1 = difference1 * isPositive1 / divisor;\nvec4 dotColor = u_dotColors[0] * weights0 + u_dotColors[1] * weights1;\nvec4 preEffectColor = greaterThanZero * dotColor + lessThanEqZero * u_dotBackgroundColor;\n#else\nfloat diffMax = max(max4(difference0), max4(difference1));\nfloat lessThanZero = step(diffMax, 0.0);\nfloat greaterOrEqZero = 1.0 - lessThanZero;\nvec4 isMax0 = step(diffMax, difference0);\nvec4 isMax1 = step(diffMax, difference1);\nvec4 dotColor = u_dotColors[0] * isMax0 + u_dotColors[1] * isMax1;\nvec4 preEffectColor = greaterOrEqZero * dotColor + lessThanZero * u_dotBackgroundColor;\n#endif\nout_color = preEffectColor;\n#else\nout_color = v_opacity * v_color;\n#endif\n#ifdef HIGHLIGHT\nout_color.a = 1.0;\n#endif\nreturn out_color;\n}\nvoid main() {\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nif (v_isOutline > 0.5) {\ngl_FragColor = drawLine();\n} else {\ngl_FragColor = drawFill();\n}\n#else\ngl_FragColor = drawFill();\n#endif\n}","fill.vert":"#include <materials/symbologyTypeUtils.glsl>\n#define PACKED_LINE\nprecision highp float;\nattribute float a_bitset;\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nattribute float a_inverseArea;\nvec4 a_color = vec4(0.0, 0.0, 0.0, 1.0);\nvec2 a_zoomRange = vec2(0.0, 10000.0);\n#else\nattribute vec4 a_color;\nattribute vec4 a_aux2;\nattribute vec4 a_aux3;\n#ifndef SYMBOLOGY_TYPE_IS_SIMPLE_LIKE\nattribute vec4 a_aux1;\nattribute vec2 a_zoomRange;\n#else\nvec2 a_zoomRange = vec2(0.0, 10000.0);\n#endif\n#endif\nuniform vec2 u_tileOffset;\nuniform vec2 u_maxIntNumOfCrossing;\n#include <util/encoding.glsl>\n#include <materials/vcommon.glsl>\n#include <materials/fill/common.glsl>\n#include <materials/fill/hittest.glsl>\nconst float INV_SCALE_COMPRESSION_FACTOR = 1.0 / 128.0;\nconst float MAX_REPRESENTABLE_INT = 16777216.0;\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nvec4 dotThreshold(vec4 featureAttrOverFeatureArea, float dotValue, float tileDotsOverArea) {\nreturn featureAttrOverFeatureArea * (1.0 / dotValue)  * (1.0 / tileDotsOverArea);\n}\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#include <materials/shared/line/common.glsl>\n#include <materials/shared/line/line.vert>\nvoid drawLine(out lowp vec4 out_color, out highp vec3 out_pos) {\nLineData outputs = buildLine(\nout_pos,\na_id,\na_pos,\na_color,\n(a_aux3.xy - 128.) / 16.,\n(a_aux3.zw - 128.) / 16.,\n0.,\na_aux2.z / 16.,\na_bitset,\nvec4(0.),\nvec2(0.),\na_aux2.w / 16.\n);\nv_id      = outputs.id;\nv_opacity = outputs.opacity;\nv_aux1    = vec4(outputs.lineHalfWidth, outputs.normal, 0.);\nout_color = outputs.color;\n}\n#endif\nvoid drawFill(out lowp vec4 out_color, out highp vec3 out_pos) {\nfloat a_bitSet = a_bitset;\nout_color = getColor(a_color, a_bitSet, BITSET_GENERIC_LOCK_COLOR);\nv_opacity = getOpacity();\nv_id      = norm(a_id);\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nmat3 tileToTileNormalized = mat3(  2. / 512.,  0.,  0.,\n0., -2. / 512.,  0.,\n-1.,  1.,  1.  );\nout_pos   = tileToTileNormalized * vec3((a_pos * FILL_POSITION_PRECISION), 1.);\n#else\nout_pos   = u_dvsMat3 * vec3(a_pos * FILL_POSITION_PRECISION, 1.);\n#endif\n#ifdef PATTERN\nvec4  a_tlbr   = a_aux1;\nfloat a_width  = a_aux2.x;\nfloat a_height = a_aux2.y;\nvec2  a_offset = a_aux2.zw;\nvec2  a_scale  = a_aux3.xy;\nfloat a_angle  = a_aux3.z;\nif (getBit(a_bitset, BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR) > 0.5) {\na_width *= INV_SCALE_COMPRESSION_FACTOR;\n}\nif (getBit(a_bitset, BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR) > 0.5) {\na_height *= INV_SCALE_COMPRESSION_FACTOR;\n}\nvec2 scale = INV_SCALE_COMPRESSION_FACTOR * a_scale;\nfloat width = u_zoomFactor * a_width * scale.x;\nfloat height = u_zoomFactor * a_height * scale.y;\nfloat angle = C_256_TO_RAD * a_angle;\nfloat sinA = sin(angle);\nfloat cosA = cos(angle);\nfloat dx = 0.0;\nfloat dy = 0.0;\nif (getBit(a_bitset, BITSET_FILL_RANDOM_PATTERN_OFFSET) > 0.5) {\nfloat id = rgba2float(vec4(a_id, 0.0));\ndx = rand(vec2(id, 0.0));\ndy = rand(vec2(0.0, id));\n}\nmat3 patternMatrix = mat3(cosA / width, sinA / height, 0,\n-sinA / width, cosA / height, 0,\ndx,            dy,           1);\nvec2 patternSize = vec2(a_width, a_height);\nvec2 numPatternsPerMaxInt = vec2(MAX_REPRESENTABLE_INT) / patternSize;\nvec2 maxIntCrossingOffsetCorrection = patternSize * fract(u_maxIntNumOfCrossing * numPatternsPerMaxInt);\nvec2 tileOffset = u_tileOffset + maxIntCrossingOffsetCorrection - 0.5 * patternSize;\ntileOffset = vec2(tileOffset.x * cosA - tileOffset.y * sinA, tileOffset.x * sinA + tileOffset.y * cosA);\ntileOffset = mod(tileOffset, patternSize);\nvec2 symbolOffset = u_zoomFactor * scale * vec2(a_offset - tileOffset) / vec2(width, height);\nv_tileTextureCoord = (patternMatrix * vec3(a_pos * FILL_POSITION_PRECISION, 1.0)).xy - symbolOffset;\nv_aux1 = a_tlbr / u_mosaicSize.xyxy;\nv_sampleAlphaOnly = getBit(a_bitset, BITSET_GENERIC_CONSIDER_ALPHA_ONLY);\nif (getBit(a_bitSet, BITSET_FILL_HAS_UNRESOLVED_REPLACEMENT_COLOR) > 0.5) {\n#ifdef VV_COLOR\nv_sampleAlphaOnly *= (1.0 - float(isNan(VV_ADATA[ATTR_VV_COLOR]))) * (1.0 - getBit(a_bitSet, BITSET_GENERIC_LOCK_COLOR));\n#else\nv_sampleAlphaOnly = 0.0;\n#endif\n}\n#elif SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nvec4 ddAttributeData0 = getAttributeData2(a_id) * u_isActive[0] * a_inverseArea;\nvec4 ddAttributeData1 = getAttributeData3(a_id) * u_isActive[1] * a_inverseArea;\nfloat size = u_tileZoomFactor * 512.0 * 1.0 / u_pixelRatio;\nv_dotThresholds[0] = dotThreshold(ddAttributeData0, u_dotValue, u_tileDotsOverArea);\nv_dotThresholds[1] = dotThreshold(ddAttributeData1, u_dotValue, u_tileDotsOverArea);\nv_dotTextureCoords = (a_pos * FILL_POSITION_PRECISION + 0.5) / size;\n#endif\n}\n#ifdef HITTEST\nvoid draw(out lowp vec4 out_color, out highp vec3 out_pos) {\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nif (getBit(a_bitset, BITSET_TYPE_FILL_OUTLINE) > 0.5) {\nout_pos = vec3(0., 0., 2.);\nreturn;\n}\n#endif\nhittestFill(out_color, out_pos);\ngl_PointSize = 1.0;\n}\n#elif defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nvoid draw(out lowp vec4 out_color, out highp vec3 out_pos) {\nv_isOutline = getBit(a_bitset, BITSET_TYPE_FILL_OUTLINE);\nif (v_isOutline > 0.5) {\ndrawLine(out_color, out_pos);\n} else {\ndrawFill(out_color, out_pos);\n}\n}\n#else\n#define draw drawFill\n#endif\nvoid main()\n{\nINIT;\nhighp vec3 pos  = vec3(0.);\nhighp vec4 color  = vec4(0.);\ndraw(color, pos);\nv_color = color;\ngl_Position = vec4(clip(v_color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}","hittest.glsl":"#ifdef HITTEST\n#include <materials/hittest/common.glsl>\nattribute vec2 a_pos1;\nattribute vec2 a_pos2;\nvoid hittestFill(\nout lowp vec4 out_color,\nout highp vec3 out_pos\n) {\nvec3 pos        = u_viewMat3 * u_tileMat3 * vec3(a_pos  * FILL_POSITION_PRECISION, 1.);\nvec3 pos1       = u_viewMat3 * u_tileMat3 * vec3(a_pos1 * FILL_POSITION_PRECISION, 1.);\nvec3 pos2       = u_viewMat3 * u_tileMat3 * vec3(a_pos2 * FILL_POSITION_PRECISION, 1.);\nfloat hittestDist = u_hittestDist;\nfloat dist = distPointTriangle(u_hittestPos, pos.xy, pos1.xy, pos2.xy);\nout_pos = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif (dist < 0. || dist >= hittestDist) {\nout_pos.z += 2.0;\n}\nout_color = vec4(1. / 255., 0, 0, dist == 0. ? (1. / 255.) : 0.);\n}\n#endif"},hittest:{"common.glsl":"#ifdef HITTEST\nuniform float hittestDist;\nuniform highp vec2 hittestPos;\nfloat projectScalar(vec2 a, vec2 b) {\nreturn dot(a, normalize(b));\n}\nfloat distPointSegment(vec2 p0, vec2 p1, vec2 p2) {\nvec2 L = p2 - p1;\nvec2 A = p0 - p1;\nfloat projAL = projectScalar(A, L);\nfloat t = clamp(projAL / length(L), 0., 1.);\nreturn distance(p0, p1 + t * (p2 - p1));\n}\nvoid hittestMarker(out lowp vec4 out_color, out highp vec3 out_pos, in highp vec3 pos, float size) {\nfloat dist = distance(pos, vec3(hittestPos, 1.));\nout_pos = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif ((dist - size) > hittestDist) {\nout_pos.z += 2.0;\n}\nout_color = vec4(1. / 255., 0, 0, (dist - size) < 0. ? (1. / 255.) : 0.);\n}\nfloat intersectPointTriangleBary(vec2 p, vec2 a, vec2 b, vec2 c) {\nreturn inTriangle(xyToBarycentric(p, a, b, c));\n}\nfloat distPointTriangle(vec2 p, vec2 a, vec2 b, vec2 c) {\nvec2 ba = b - a;\nvec2 ca = c - a;\nfloat crossProduct = ba.x * ca.y - ca.x * ba.y;\nbool isParallel = crossProduct < EPSILON_HITTEST && crossProduct > -EPSILON_HITTEST;\nif (isParallel) {\nreturn -1.;\n}\nif (intersectPointTriangleBary(p.xy, a, b, c) == 1.) {\nreturn 0.;\n}\nfloat distAB = distPointSegment(p, a, b);\nfloat distBC = distPointSegment(p, b, c);\nfloat distCA = distPointSegment(p, c, a);\nreturn min(min(distAB, distBC), distCA);\n}\n#endif"},icon:{"common.glsl":"#include <util/encoding.glsl>\nuniform lowp vec2 u_mosaicSize;\nvarying lowp vec4 v_color;\nvarying highp vec3 v_id;\nvarying highp vec4 v_sizeTex;\nvarying mediump vec3 v_pos;\nvarying lowp float v_opacity;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nvarying lowp vec4 v_outlineColor;\nvarying mediump float v_outlineWidth;\nvarying mediump float v_distRatio;\nvarying mediump float v_overridingOutlineColor;\nvarying mediump float v_isThin;\n#endif\n#ifdef SDF\nvec4 getColor(vec2 v_size, vec2 v_tex) {\n#ifdef HITTEST\nlowp vec4 fillPixelColor = vec4(1.0);\n#else\nlowp vec4 fillPixelColor = v_color;\n#endif\nfloat d = 0.5 - rgba2float(texture2D(u_texture, v_tex));\nfloat size = max(v_size.x, v_size.y);\nfloat dist = d * size * SOFT_EDGE_RATIO * v_distRatio;\nfillPixelColor *= clamp(0.5 - dist, 0.0, 1.0);\nfloat outlineWidth = v_outlineWidth;\n#ifdef HIGHLIGHT\noutlineWidth = max(outlineWidth, 4.0 * v_isThin);\n#endif\nif (outlineWidth > 0.25) {\nlowp vec4 outlinePixelColor = v_overridingOutlineColor * v_color + (1.0 - v_overridingOutlineColor) * v_outlineColor;\nfloat clampedOutlineSize = min(outlineWidth, size);\noutlinePixelColor *= clamp(0.5 - abs(dist) + clampedOutlineSize * 0.5, 0.0, 1.0);\nreturn v_opacity * ((1.0 - outlinePixelColor.a) * fillPixelColor + outlinePixelColor);\n}\nreturn v_opacity * fillPixelColor;\n}\n#else\nvec4 getColor(vec2 _v_size, vec2 v_tex) {\nlowp vec4 texColor = texture2D(u_texture, v_tex);\nreturn v_opacity * texColor * v_color;\n}\n#endif",heatmapAccumulate:{"common.glsl":"varying lowp vec4 v_hittestResult;\nvarying mediump vec2 v_offsetFromCenter;\nvarying highp float v_fieldValue;","heatmapAccumulate.frag":"precision mediump float;\n#include <materials/icon/heatmapAccumulate/common.glsl>\n#ifdef HEATMAP_PRECISION_HALF_FLOAT\n#define COMPRESSION_FACTOR 0.25\n#else\n#define COMPRESSION_FACTOR 1.0\n#endif\nuniform lowp sampler2D u_texture;\nvoid main() {\n#ifdef HITTEST\ngl_FragColor = v_hittestResult;\n#else\nfloat radius = length(v_offsetFromCenter);\nfloat shapeWeight = step(radius, 1.0);\nfloat oneMinusRadiusSquared = 1.0 - radius * radius;\nfloat kernelWeight = oneMinusRadiusSquared * oneMinusRadiusSquared;\ngl_FragColor = vec4(shapeWeight * kernelWeight * v_fieldValue * COMPRESSION_FACTOR);\n#endif\n}","heatmapAccumulate.vert":"precision highp float;\nattribute vec2 a_vertexOffset;\nvec4 a_color = vec4(0.0);\nvec2 a_zoomRange = vec2(0.0, 10000.0);\nuniform float u_radius;\nuniform float u_isFieldActive;\n#include <materials/vcommon.glsl>\n#include <materials/hittest/common.glsl>\n#include <materials/icon/heatmapAccumulate/common.glsl>\nvoid main() {\nfloat filterFlags = getFilterFlags();\n#ifdef HITTEST\nhighp vec4 out_hittestResult = vec4(0.);\nhighp vec3 out_pos = vec3(0.);\nvec3 pos = u_viewMat3 * u_tileMat3 * vec3(a_pos * POSITION_PRECISION, 1.0);\nhittestMarker(out_hittestResult, out_pos, pos, u_radius);\nv_hittestResult = out_hittestResult;\ngl_PointSize = 1.;\ngl_Position = vec4(clip(a_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\nv_offsetFromCenter = sign(a_vertexOffset);\nv_fieldValue = getAttributeData2(a_id).x * u_isFieldActive + 1.0 - u_isFieldActive;\nvec3 centerPos = u_dvsMat3 * vec3(a_pos * POSITION_PRECISION, 1.0);\nvec3 vertexPos = centerPos + u_displayViewMat3 * vec3(v_offsetFromCenter, 0.0) * u_radius;\ngl_Position = vec4(clip(a_color, vertexPos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},"hittest.glsl":"#ifdef HITTEST\n#include <materials/hittest/common.glsl>\nattribute vec2 a_vertexOffset1;\nattribute vec2 a_vertexOffset2;\nattribute vec2 a_texCoords1;\nattribute vec2 a_texCoords2;\nvec2 getTextureCoords(in vec3 bary, in vec2 texCoords0, in vec2 texCoords1, in vec2 texCoords2) {\nreturn texCoords0 * bary.x + texCoords1 * bary.y + texCoords2 * bary.z;\n}\nvoid hittestIcon(\ninout lowp vec4 out_color,\nout highp vec3 out_pos,\nin vec3 pos,\nin vec3 offset,\nin vec2 size,\nin float scaleFactor,\nin float isMapAligned\n) {\nout_pos = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nvec3 posBase = u_viewMat3 * u_tileMat3  * pos;\nvec3 offset1 = scaleFactor * vec3(a_vertexOffset1 / 16.0, 0.);\nvec3 offset2 = scaleFactor * vec3(a_vertexOffset2 / 16.0, 0.);\nvec2 pos0    = (posBase + getMatrixNoDisplay(isMapAligned) * offset).xy;\nvec2 pos1    = (posBase + getMatrixNoDisplay(isMapAligned) * offset1).xy;\nvec2 pos2    = (posBase + getMatrixNoDisplay(isMapAligned) * offset2).xy;\nvec3 bary0 = xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, -u_hittestDist), pos0, pos1, pos2);\nvec3 bary1 = xyToBarycentric(u_hittestPos + vec2(0., -u_hittestDist), pos0, pos1, pos2);\nvec3 bary2 = xyToBarycentric(u_hittestPos + vec2(u_hittestDist, -u_hittestDist), pos0, pos1, pos2);\nvec3 bary3 = xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, 0.), pos0, pos1, pos2);\nvec3 bary4 = xyToBarycentric(u_hittestPos, pos0, pos1, pos2);\nvec3 bary5 = xyToBarycentric(u_hittestPos + vec2(u_hittestDist, 0.), pos0, pos1, pos2);\nvec3 bary6 = xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, u_hittestDist), pos0, pos1, pos2);\nvec3 bary7 = xyToBarycentric(u_hittestPos + vec2(0., u_hittestDist), pos0, pos1, pos2);\nvec3 bary8 = xyToBarycentric(u_hittestPos + vec2(u_hittestDist, u_hittestDist), pos0, pos1, pos2);\nvec2 tex0 = a_texCoords  / u_mosaicSize;\nvec2 tex1 = a_texCoords1 / u_mosaicSize;\nvec2 tex2 = a_texCoords2 / u_mosaicSize;\nfloat alphaSum = 0.;\nalphaSum += inTriangle(bary0) * getColor(size, getTextureCoords(bary0, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary1) * getColor(size, getTextureCoords(bary1, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary2) * getColor(size, getTextureCoords(bary2, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary3) * getColor(size, getTextureCoords(bary3, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary4) * getColor(size, getTextureCoords(bary4, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary5) * getColor(size, getTextureCoords(bary5, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary6) * getColor(size, getTextureCoords(bary6, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary7) * getColor(size, getTextureCoords(bary7, tex0, tex1, tex2)).a;\nout_pos.z += step(alphaSum, .05) * 2.0;\nout_color = vec4(1. / 255., 0., 0., alphaSum / 255.);\n}\n#endif","icon.frag":"precision mediump float;\n#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/icon/common.glsl>\nvoid main()\n{\n#ifdef HITTEST\nvec4 color = v_color;\n#else\nvec4 color = getColor(v_sizeTex.xy, v_sizeTex.zw);\n#endif\n#ifdef HIGHLIGHT\ncolor.a = step(1.0 / 255.0, color.a);\n#endif\ngl_FragColor = color;\n}","icon.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_outlineColor;\nattribute vec4 a_sizeAndOutlineWidth;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nattribute vec2 a_bitSetAndDistRatio;\nattribute vec2 a_zoomRange;\n#include <materials/vcommon.glsl>\n#include <materials/icon/common.glsl>\n#include <materials/icon/hittest.glsl>\nfloat getMarkerScaleFactor(inout vec2 size, in float referenceSize) {\n#ifdef VV_SIZE\nfloat f = getSize(size.y) / size.y;\nfloat sizeFactor = size.y / referenceSize;\nreturn getSize(referenceSize) / referenceSize;\n#else\nreturn 1.;\n#endif\n}\nvoid main()\n{\nINIT;\nfloat a_bitSet = a_bitSetAndDistRatio.x;\nvec3  pos           = vec3(a_pos * POSITION_PRECISION, 1.0);\nvec2  size          = a_sizeAndOutlineWidth.xy * a_sizeAndOutlineWidth.xy / 128.0;\nvec3  offset        = vec3(a_vertexOffset / 16.0, 0.);\nfloat outlineSize   = a_sizeAndOutlineWidth.z * a_sizeAndOutlineWidth.z / 128.0;\nfloat isMapAligned  = getBit(a_bitSet, BITSET_MARKER_ALIGNMENT_MAP);\nfloat referenceSize = a_sizeAndOutlineWidth.w * a_sizeAndOutlineWidth.w / 128.0;\nfloat scaleSymbolProportionally = getBit(a_bitSet, BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY);\nfloat scaleFactor               = getMarkerScaleFactor(size, referenceSize);\nsize.xy     *= scaleFactor;\noffset.xy   *= scaleFactor;\noutlineSize *= scaleSymbolProportionally * (scaleFactor - 1.0) + 1.0;\nvec2 v_tex   = a_texCoords / u_mosaicSize;\nfloat filterFlags = getFilterFlags();\nv_color    = getColor(a_color, a_bitSet, BITSET_GENERIC_LOCK_COLOR);\nv_opacity  = getOpacity();\nv_id       = norm(a_id);\nv_pos      = u_dvsMat3 * pos + getMatrix(isMapAligned) * getRotation()  * offset;\nv_sizeTex  = vec4(size.xy, v_tex.xy);\n#ifdef SDF\nv_isThin   = getBit(a_bitSet, BITSET_MARKER_OUTLINE_ALLOW_COLOR_OVERRIDE);\n#ifdef VV_COLOR\nv_overridingOutlineColor = v_isThin;\n#else\nv_overridingOutlineColor = 0.0;\n#endif\nv_outlineWidth = min(outlineSize, max(max(size.x, size.y) - 0.99, 0.0));\nv_outlineColor = a_outlineColor;\nv_distRatio = a_bitSetAndDistRatio.y / 128.0;\n#endif\n#ifdef HITTEST\nhighp vec4 out_color = vec4(0.);\nhighp vec3 out_pos   = vec3(0.);\nhittestIcon(out_color, out_pos, pos, offset, size, scaleFactor, isMapAligned);\nv_color = out_color;\ngl_PointSize = 1.;\ngl_Position = vec4(clip(v_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\ngl_Position = vec4(clip(v_color, v_pos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},label:{"common.glsl":"uniform mediump float u_zoomLevel;\nuniform mediump float u_mapRotation;\nuniform mediump float u_mapAligned;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying mediump vec2 v_tex;\nvarying mediump vec4 v_color;\nvarying lowp vec4 v_animation;","label.frag":"#include <materials/text/text.frag>","label.vert":"precision highp float;\n#include <materials/vcommon.glsl>\n#include <materials/text/common.glsl>\nattribute vec4 a_color;\nattribute vec4 a_haloColor;\nattribute vec4 a_texAndSize;\nattribute vec4 a_refSymbolAndPlacementOffset;\nattribute vec4 a_glyphData;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nuniform float u_isHaloPass;\nuniform float u_isBackgroundPass;\nuniform float u_mapRotation;\nuniform float u_mapAligned;\nfloat getZ(in float minZoom, in float maxZoom, in float angle) {\nfloat glyphAngle = angle * 360.0 / 254.0;\nfloat mapAngle = u_mapRotation * 360.0 / 254.0;\nfloat diffAngle = min(360.0 - abs(mapAngle - glyphAngle), abs(mapAngle - glyphAngle));\nfloat z = 0.0;\nz += u_mapAligned * (2.0 * (1.0 - step(minZoom, u_currentZoom)));\nz += u_mapAligned * 2.0 * step(90.0, diffAngle);\nz += 2.0 * (1.0 - step(u_currentZoom, maxZoom));\nreturn z;\n}\nvoid main()\n{\nINIT;\nfloat groupMinZoom    = getMinZoom();\nfloat glyphMinZoom    = a_glyphData.x;\nfloat glyphMaxZoom    = a_glyphData.y;\nfloat glyphAngle      = a_glyphData.z;\nfloat a_isBackground  = a_glyphData.w;\nfloat a_minZoom          = max(groupMinZoom, glyphMinZoom);\nfloat a_placementPadding = a_refSymbolAndPlacementOffset.x * EXTRUDE_SCALE_PLACEMENT_PADDING;\nvec2  a_placementDir     = unpack_u8_nf32(a_refSymbolAndPlacementOffset.zw);\nfloat a_refSymbolSize    = a_refSymbolAndPlacementOffset.y;\nfloat fontSize           = a_texAndSize.z;\nfloat haloSize           = a_texAndSize.w * OUTLINE_SCALE;\nvec2  vertexOffset = a_vertexOffset * OFFSET_PRECISION;\nvec3  pos          = vec3(a_pos * POSITION_PRECISION, 1.0);\nfloat z            = getZ(a_minZoom, glyphMaxZoom, glyphAngle);\nfloat fontScale    = fontSize / SDF_FONT_SIZE;\nfloat halfSize     = getSize(a_refSymbolSize) / 2.0;\nfloat animation    = pow(getAnimationState(), vec4(2.0)).r;\nfloat isText = 1.0 - a_isBackground;\nfloat isBackground = u_isBackgroundPass * a_isBackground;\nvec4  nonHaloColor = (isBackground + isText) * a_color;\nv_color     = animation * ((1.0 - u_isHaloPass) * nonHaloColor + (u_isHaloPass * a_haloColor));\nv_opacity   = 1.0;\nv_tex       = a_texCoords / u_mosaicSize;\nv_edgeDistanceOffset = u_isHaloPass * haloSize / fontScale / MAX_SDF_DISTANCE;\nv_antialiasingWidth  = 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\nvec2 placementOffset = a_placementDir * (halfSize + a_placementPadding);\nvec3 glyphOffset     = u_displayMat3 * vec3(vertexOffset + placementOffset, 0.0);\nvec3 v_pos           = vec3((u_dvsMat3 * pos + glyphOffset).xy, z);\nfloat isHidden = u_isBackgroundPass * isText + (1.0 - u_isBackgroundPass) * a_isBackground;\nv_pos.z += 2.0 * isHidden;\ngl_Position = vec4(v_pos, 1.0);\n#ifdef DEBUG\nv_color = vec4(a_color.rgb, z == 0.0 ? 1.0 : 0.645);\n#endif\n}"},line:{"common.glsl":"varying lowp vec4 v_color;\nvarying highp vec3 v_id;\nvarying mediump vec2 v_normal;\nvarying mediump float v_lineHalfWidth;\nvarying lowp float v_opacity;\n#ifdef PATTERN\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\n#endif\n#if defined(PATTERN) || defined(SDF)\nvarying highp float v_accumulatedDistance;\n#endif\n#ifdef SDF\nvarying mediump float v_lineWidthRatio;\n#endif","hittest.glsl":"#include <materials/hittest/common.glsl>\n#ifdef HITTEST\nattribute vec2 a_pos1;\nattribute vec2 a_pos2;\nvoid hittestLine(out lowp vec4 out_color, out highp vec3 out_pos, float halfWidth) {\nvec3 pos        = u_viewMat3 * u_tileMat3 * vec3(a_pos  * POSITION_PRECISION, 1.);\nvec3 pos1       = u_viewMat3 * u_tileMat3 * vec3(a_pos1 * POSITION_PRECISION, 1.);\nvec3 pos2       = u_viewMat3 * u_tileMat3 * vec3(a_pos2 * POSITION_PRECISION, 1.);\nvec3 outTextureCoords = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nfloat dist = min(distPointSegment(u_hittestPos, pos.xy, pos1.xy),\ndistPointSegment(u_hittestPos, pos.xy, pos2.xy)) - halfWidth;\nout_pos = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif (dist >= u_hittestDist) {\nout_pos.z += 2.0;\n}\nout_color = vec4(1. / 255., 0, 0, dist <= 0. ? (1. / 255.) : 0.);\n}\n#endif","line.frag":"precision lowp float;\n#include <util/encoding.glsl>\n#include <materials/constants.glsl>\n#include <materials/symbologyTypeUtils.glsl>\n#include <materials/line/common.glsl>\n#include <materials/shared/line/common.glsl>\n#include <materials/shared/line/line.frag>\n#ifdef HITTEST\nvoid main() {\ngl_FragColor = v_color;\n}\n#else\nvoid main() {\nLineData inputs = LineData(\nv_color,\nv_normal,\nv_lineHalfWidth,\nv_opacity,\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nv_tlbr,\nv_patternSize,\n#endif\n#ifdef SDF\nv_lineWidthRatio,\n#endif\n#if defined(PATTERN) || defined(SDF)\nv_accumulatedDistance,\n#endif\n#endif\nv_id\n);\ngl_FragColor = shadeLine(inputs);\n}\n#endif","line.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_offsetAndNormal;\nattribute vec2 a_accumulatedDistanceAndHalfWidth;\nattribute vec4 a_tlbr;\nattribute vec4 a_segmentDirection;\nattribute vec2 a_aux;\nattribute vec2 a_zoomRange;\n#include <materials/vcommon.glsl>\n#include <materials/symbologyTypeUtils.glsl>\n#include <materials/line/common.glsl>\n#include <materials/line/hittest.glsl>\n#include <materials/shared/line/common.glsl>\n#include <materials/shared/line/line.vert>\n#ifdef HITTEST\nvoid draw() {\nfloat aa        = 0.5 * u_antialiasing;\nfloat a_halfWidth = a_accumulatedDistanceAndHalfWidth.y / 16.;\nfloat a_cimHalfWidth = a_aux.x / 16. ;\nvec2  a_offset = a_offsetAndNormal.xy / 16.;\nfloat baseWidth = getBaseLineHalfWidth(a_halfWidth, a_cimHalfWidth);\nfloat halfWidth = getLineHalfWidth(baseWidth, aa);\nhighp vec3 pos  = vec3(0.);\nv_color = vec4(0.);\nhittestLine(v_color, pos, halfWidth);\ngl_PointSize = 1.;\ngl_Position = vec4(clip(v_color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}\n#else\nvoid draw()\n{\nhighp vec3 pos = vec3(0.);\nLineData outputs = buildLine(\npos,\na_id,\na_pos,\na_color,\na_offsetAndNormal.xy / 16.,\na_offsetAndNormal.zw / 16.,\na_accumulatedDistanceAndHalfWidth.x,\na_accumulatedDistanceAndHalfWidth.y / 16.,\na_segmentDirection.w,\na_tlbr,\na_segmentDirection.xy / 16.,\na_aux.x / 16.\n);\nv_id              = outputs.id;\nv_color           = outputs.color;\nv_normal          = outputs.normal;\nv_lineHalfWidth   = outputs.lineHalfWidth;\nv_opacity         = outputs.opacity;\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nv_tlbr          = outputs.tlbr;\nv_patternSize   = outputs.patternSize;\n#endif\n#ifdef SDF\nv_lineWidthRatio = outputs.lineWidthRatio;\n#endif\n#if defined(PATTERN) || defined(SDF)\nv_accumulatedDistance = outputs.accumulatedDistance;\n#endif\n#endif\ngl_Position = vec4(clip(outputs.color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}\n#endif\nvoid main() {\nINIT;\ndraw();\n}"},pie:{"pie.common.glsl":"uniform float outlineWidth;\nuniform mediump float sectorThreshold;\nvarying vec3  v_id;\nvarying vec3  v_pos;\nvarying vec2  v_offset;\nvarying vec4  v_color;\nvarying float v_size;\nvarying float v_numOfEntries;\nvarying float v_maxSectorAngle;\nvarying vec2  v_filteredSectorToColorId[numberOfFields];\nvarying vec2  v_texCoords;\nvarying float v_outlineWidth;\nvarying float v_opacity;\nstruct FilteredChartInfo {\nfloat endSectorAngle;\nint colorId;\n};","pie.frag":"precision highp float;\n#include <util/atan2.glsl>\n#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/pie/pie.common.glsl>\nuniform lowp vec4 colors[numberOfFields];\nuniform lowp vec4 defaultColor;\nuniform lowp vec4 othersColor;\nuniform lowp vec4 outlineColor;\nuniform float donutRatio;\nlowp vec4 getSectorColor(in int index, in vec2 filteredSectorToColorId[numberOfFields]) {\nmediump int colorIndex = int(filteredSectorToColorId[index].y);\nreturn colors[colorIndex];\n}\nconst int OTHER_SECTOR_ID = 255;\n#ifdef HITTEST\nvec4 getColor() {\nfloat distanceSize = length(v_offset) * v_size;\nfloat donutSize = donutRatio * v_size;\nfloat alpha = step(donutSize, distanceSize) * (1.0 - step(v_size, distanceSize));\nreturn v_color;\n}\n#else\nvec4 getColor() {\nfloat angle = 90.0 - C_RAD_TO_DEG * atan2(v_offset.y, v_offset.x);\nif (angle < 0.0) {\nangle += 360.0;\n} else if (angle > 360.0) {\nangle = mod(angle, 360.0);\n}\nint numOfEntries = int(v_numOfEntries);\nfloat maxSectorAngle = v_maxSectorAngle;\nlowp vec4 fillColor = (maxSectorAngle > 0.0 || sectorThreshold > 0.0) ? othersColor : defaultColor;\nlowp vec4 prevColor = vec4(0.0);\nlowp vec4 nextColor = vec4(0.0);\nfloat startSectorAngle = 0.0;\nfloat endSectorAngle = 0.0;\nif (angle < maxSectorAngle) {\nfor (int index = 0; index < numberOfFields; ++index) {\nstartSectorAngle = endSectorAngle;\nendSectorAngle = v_filteredSectorToColorId[index].x;\nif (endSectorAngle > angle) {\nfillColor = getSectorColor(index, v_filteredSectorToColorId);\nprevColor = sectorThreshold != 0.0 && index == 0 && abs(360.0 - maxSectorAngle) < EPSILON ? othersColor :\ngetSectorColor(index > 0 ? index - 1 : numOfEntries - 1, v_filteredSectorToColorId);\nnextColor = sectorThreshold != 0.0 && abs(endSectorAngle - maxSectorAngle) < EPSILON ? othersColor :\ngetSectorColor(index < numOfEntries - 1 ? index + 1 : 0, v_filteredSectorToColorId);\nbreak;\n}\nif (index == numOfEntries - 1) {\nbreak;\n}\n}\n} else {\nprevColor = getSectorColor(numOfEntries - 1, v_filteredSectorToColorId);\nnextColor = getSectorColor(0, v_filteredSectorToColorId);\nstartSectorAngle = maxSectorAngle;\nendSectorAngle = 360.0;\n}\nlowp vec4 outlineColor = outlineColor;\nfloat offset = length(v_offset);\nfloat distanceSize = offset * v_size;\nif (startSectorAngle != 0.0 || endSectorAngle != 360.0) {\nfloat distanceToStartSector = (angle - startSectorAngle);\nfloat distanceToEndSector = (endSectorAngle - angle);\nfloat sectorThreshold = 0.6;\nfloat beginSectorAlpha = smoothstep(0.0, sectorThreshold, distanceToStartSector * offset);\nfloat endSectorAlpha = smoothstep(0.0, sectorThreshold, distanceToEndSector * offset);\nif (endSectorAlpha > 0.0) {\nfillColor = mix(nextColor, fillColor, endSectorAlpha);\n} else if (beginSectorAlpha > 0.0) {\nfillColor = mix(prevColor, fillColor, beginSectorAlpha);\n}\n}\nfloat donutSize = donutRatio * (v_size - v_outlineWidth);\nfloat endOfDonut = donutSize - v_outlineWidth;\nfloat aaThreshold = 0.75;\nfloat innerCircleAlpha = endOfDonut - aaThreshold > 0.0 ? smoothstep(endOfDonut - aaThreshold, endOfDonut + aaThreshold, distanceSize) : 1.0;\nfloat outerCircleAlpha = 1.0 - smoothstep(v_size - aaThreshold, v_size + aaThreshold , distanceSize);\nfloat circleAlpha = innerCircleAlpha * outerCircleAlpha;\nfloat startOfOutline = v_size - v_outlineWidth;\nif (startOfOutline > 0.0 && v_outlineWidth > 0.25) {\nfloat outlineFactor = smoothstep(startOfOutline - aaThreshold, startOfOutline + aaThreshold, distanceSize);\nfloat innerLineFactor = donutSize - aaThreshold > 0.0 ? 1.0 - smoothstep(donutSize - aaThreshold, donutSize + aaThreshold , distanceSize) : 0.0;\nfillColor = mix(fillColor, outlineColor, innerLineFactor + outlineFactor);\n}\nreturn v_opacity * circleAlpha * fillColor;\n}\n#endif\nvoid main()\n{\nvec4 color = getColor();\n#ifdef highlight\ncolor.a = step(1.0 / 255.0, color.a);\n#endif\ngl_FragColor = color;\n}","pie.vert":"#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/barycentric.glsl>\n#include <materials/vcommon.glsl>\n#include <materials/vv.glsl>\n#include <materials/attributeData.glsl>\n#include <materials/pie/pie.common.glsl>\n#include <materials/hittest/common.glsl>\nattribute float a_bitSet;\nattribute vec2  a_offset;\nattribute vec2  a_texCoords;\nattribute vec2  a_size;\nattribute float a_referenceSize;\nattribute vec2  a_zoomRange;\nint filterValue(in float sectorAngle,\nin int currentIndex,\ninout FilteredChartInfo filteredInfo,\ninout vec2 filteredSectorToColorId[numberOfFields]) {\nif (sectorAngle > sectorThreshold * 360.0) {\nfilteredInfo.endSectorAngle += sectorAngle;\nfilteredSectorToColorId[filteredInfo.colorId] = vec2(filteredInfo.endSectorAngle, currentIndex);\n++filteredInfo.colorId;\n}\nreturn 0;\n}\nint filterValues(inout vec2 filteredSectorToColorId[numberOfFields],\ninout FilteredChartInfo filteredInfo,\nin float sectorAngles[numberOfFields]) {\nfor (int index = 0; index < numberOfFields; ++index) {\nfloat sectorValue = sectorAngles[index];\nfilterValue(sectorValue, index, filteredInfo, filteredSectorToColorId);\n}\nreturn filteredInfo.colorId;\n}\nvec2 getMarkerSize(inout vec2 offset, inout vec2 baseSize, inout float outlineSize, in float a_referenceSize, in float bitSet) {\nvec2 outSize = baseSize;\n#ifdef VV_SIZE\nfloat r = getSize(a_referenceSize, currentScale) / a_referenceSize;\noutSize.xy *= r;\noffset.xy *= r;\nfloat scaleSymbolProportionally = getBit(bitSet, BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY);\noutlineSize *= scaleSymbolProportionally * (r - 1.0) + 1.0;\n#endif\nreturn outSize;\n}\nvec3 getOffset(in vec2 in_offset, float a_bitSet) {\nfloat isMapAligned = getBit(a_bitSet, BITSET_MARKER_ALIGNMENT_MAP);\nvec3  offset       = vec3(in_offset, 0.0);\nreturn getMatrix(isMapAligned) * offset;\n}\nfloat filterNaNValues(in float value) {\nreturn value != NAN_MAGIC_NUMBER && value > 0.0 ? value : 0.0;\n}\nvoid main()\n{\nINIT;\nvec2  a_size   = a_size;\nvec2  a_offset = a_offset / 16.0;\nfloat outlineSize = outlineWidth;\nfloat a_bitSet = a_bitSet;\nfloat a_referenceSize = a_referenceSize;\nvec2 a_texCoords = a_texCoords / 4.0;\nvec2 markerSize = getMarkerSize(a_offset, a_size, outlineSize, a_referenceSize, a_bitSet);\nfloat filterFlags = getFilterFlags();\nvec3  pos         = vec3(a_pos / 10.0, 1.0);\nv_opacity      = getOpacity();\nv_id           = norm(a_id);\nv_pos          = displayViewScreenMat3 * pos + getOffset(a_offset, a_bitSet);\nv_offset       = sign(a_texCoords - 0.5);\nv_size         = max(markerSize.x, markerSize.y);\nv_outlineWidth = outlineSize;\nfloat attributeData[10];\nvec4 attributeData3 = getDataDriven0(a_id);\nattributeData[0] = filterNaNValues(attributeData3.x);\nattributeData[1] = filterNaNValues(attributeData3.y);\nattributeData[2] = filterNaNValues(attributeData3.z);\nattributeData[3] = filterNaNValues(attributeData3.w);\n#if (numberOfFields > 4)\nvec4 attributeData4 = getDataDriven1(a_id);\nattributeData[4] = filterNaNValues(attributeData4.x);\nattributeData[5] = filterNaNValues(attributeData4.y);\nattributeData[6] = filterNaNValues(attributeData4.z);\nattributeData[7] = filterNaNValues(attributeData4.w);\n#endif\n#if (numberOfFields > 8)\nvec4 attributeData5 = getDataDriven2(a_id);\nattributeData[8] = filterNaNValues(attributeData5.x);\nattributeData[9] = filterNaNValues(attributeData5.y);\n#endif\nfloat sum = 0.0;\nfor (int i = 0; i < numberOfFields; ++i) {\nsum += attributeData[i];\n}\nfloat sectorAngles[numberOfFields];\nfor (int i = 0; i < numberOfFields; ++i) {\nsectorAngles[i] = 360.0 * attributeData[i] / sum;\n}\nvec2 filteredSectorToColorId[numberOfFields];\nFilteredChartInfo filteredInfo = FilteredChartInfo(0.0, 0);\nint numOfEntries = filterValues(filteredSectorToColorId, filteredInfo, sectorAngles);\nv_numOfEntries = float(numOfEntries);\nv_maxSectorAngle = filteredInfo.endSectorAngle;\nv_filteredSectorToColorId = filteredSectorToColorId;\n#ifdef HITTEST\nhighp vec3 out_pos = vec3(0.0);\nv_color            = vec4(0.0);\nhittestMarker(v_color, out_pos, viewMat3 * tileMat3 *  pos, v_size);\ngl_PointSize = 1.0;\ngl_Position = vec4(clip(v_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\ngl_Position = vec4(clip(v_color, v_pos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},shared:{line:{"common.glsl":"#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) && defined(PATTERN)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_sampleAlphaOnly;\n#endif\nstruct LineData {\nlowp vec4 color;\nmediump vec2 normal;\nmediump float lineHalfWidth;\nlowp float opacity;\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nmediump vec4 tlbr;\nmediump vec2 patternSize;\n#endif\n#ifdef SDF\nmediump float lineWidthRatio;\n#endif\n#if defined(PATTERN) || defined(SDF)\nhighp float accumulatedDistance;\n#endif\n#endif\nhighp vec3 id;\n};","line.frag":"uniform lowp float u_blur;\n#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) && !defined(HIGHLIGHT)\n#if defined(PATTERN) || defined(SDF)\nuniform sampler2D u_texture;\nuniform highp float u_pixelRatio;\n#endif\n#endif\n#if defined(SDF) && !defined(HIGHLIGHT) && !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nlowp vec4 getLineColor(LineData line) {\nmediump float adjustedPatternWidth = line.patternSize.x * 2.0 * line.lineWidthRatio;\nmediump float relativeTexX = fract(line.accumulatedDistance / adjustedPatternWidth);\nmediump float relativeTexY = 0.5 + 0.25 * line.normal.y;\nmediump vec2 texCoord = mix(line.tlbr.xy, line.tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d = rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist = d * line.lineHalfWidth;\nreturn line.opacity * clamp(0.5 - dist, 0.0, 1.0) * line.color;\n}\n#elif defined(PATTERN) && !defined(HIGHLIGHT) && !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nlowp vec4 getLineColor(LineData line) {\nmediump float lineHalfWidth = line.lineHalfWidth;\nmediump float adjustedPatternHeight = line.patternSize.y * 2.0 * lineHalfWidth / line.patternSize.x;\nmediump float relativeTexY = fract(line.accumulatedDistance / adjustedPatternHeight);\nmediump float relativeTexX = 0.5 + 0.5 * line.normal.y;\nmediump vec2 texCoord = mix(line.tlbr.xy, line.tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color = texture2D(u_texture, texCoord);\n#ifdef VV_COLOR\nif (v_sampleAlphaOnly > 0.5) {\ncolor.rgb = vec3(color.a);\n}\n#endif\nreturn line.opacity * line.color * color;\n}\n#else\nlowp vec4 getLineColor(LineData line) {\nreturn line.opacity * line.color;\n}\n#endif\nvec4 shadeLine(LineData line)\n{\nmediump float thinLineFactor = max(THIN_LINE_WIDTH_FACTOR * step(line.lineHalfWidth, THIN_LINE_HALF_WIDTH), 1.0);\nmediump float fragDist = length(line.normal) * line.lineHalfWidth;\nlowp float alpha = clamp(thinLineFactor * (line.lineHalfWidth - fragDist) / (u_blur + thinLineFactor - 1.0), 0.0, 1.0);\nlowp vec4 out_color = getLineColor(line) * alpha;\n#ifdef HIGHLIGHT\nout_color.a = step(1.0 / 255.0, out_color.a);\n#endif\n#ifdef ID\nif (out_color.a < 1.0 / 255.0) {\ndiscard;\n}\nout_color = vec4(line.id, 0.0);\n#endif\nreturn out_color;\n}","line.vert":"float getBaseLineHalfWidth(in float lineHalfWidth, in float referenceHalfWidth) {\n#ifdef VV_SIZE\nfloat refLineWidth = 2.0 * referenceHalfWidth;\nreturn 0.5 * (lineHalfWidth / max(referenceHalfWidth, EPSILON)) * getSize(refLineWidth);\n#else\nreturn lineHalfWidth;\n#endif\n}\nfloat getLineHalfWidth(in float baseWidth, in float aa) {\nfloat halfWidth = max(baseWidth + aa, 0.45) + 0.1 * aa;\n#ifdef HIGHLIGHT\nhalfWidth = max(halfWidth, 2.0);\n#endif\nreturn halfWidth;\n}\nvec2 getDist(in vec2 offset, in float halfWidth) {\nfloat thinLineFactor = max(THIN_LINE_WIDTH_FACTOR * step(halfWidth, THIN_LINE_HALF_WIDTH), 1.0);\nreturn thinLineFactor * halfWidth * offset;\n}\nLineData buildLine(\nout vec3 out_pos,\nin vec3 in_id,\nin vec2 in_pos,\nin vec4 in_color,\nin vec2 in_offset,\nin vec2 in_normal,\nin float in_accumulatedDist,\nin float in_lineHalfWidth,\nin float in_bitSet,\nin vec4 in_tlbr,\nin vec2 in_segmentDirection,\nin float in_referenceHalfWidth\n)\n{\nfloat aa        = 0.5 * u_antialiasing;\nfloat baseWidth = getBaseLineHalfWidth(in_lineHalfWidth, in_referenceHalfWidth);\nfloat halfWidth = getLineHalfWidth(baseWidth, aa);\nfloat z         = 2.0 * step(baseWidth, 0.0);\nvec2  dist      = getDist(in_offset, halfWidth);\nvec3  offset    = u_displayViewMat3 * vec3(dist, 0.0);\nvec3  pos       = u_dvsMat3 * vec3(in_pos * POSITION_PRECISION, 1.0) + offset;\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nvec4  color     = in_color;\nfloat opacity   = 1.0;\n#else\nvec4  color     = getColor(in_color, in_bitSet, BITSET_GENERIC_LOCK_COLOR);\nfloat opacity   = getOpacity();\n#ifdef SDF\nconst float SDF_PATTERN_HALF_WIDTH = 15.5;\nfloat scaleDash = getBit(in_bitSet, BITSET_LINE_SCALE_DASH);\nfloat lineWidthRatio = (scaleDash * max(halfWidth - 0.55 * u_antialiasing, 0.25) + (1.0 - scaleDash)) / SDF_PATTERN_HALF_WIDTH;\n#endif\n#endif\n#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) && defined(PATTERN)\nv_sampleAlphaOnly = getBit(in_bitSet, BITSET_GENERIC_CONSIDER_ALPHA_ONLY);\n#endif\nout_pos = vec3(pos.xy, z);\nreturn LineData(\ncolor,\nin_normal,\nhalfWidth,\nopacity,\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nin_tlbr / u_mosaicSize.xyxy,\nvec2(in_tlbr.z - in_tlbr.x, in_tlbr.w - in_tlbr.y),\n#endif\n#ifdef SDF\nlineWidthRatio,\n#endif\n#if defined(PATTERN) || defined(SDF)\nin_accumulatedDist * u_zoomFactor + dot(in_segmentDirection, dist),\n#endif\n#endif\nnorm(in_id)\n);\n}"}},"symbologyTypeUtils.glsl":"#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_OUTLINE_FILL || SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_OUTLINE_FILL_SIMPLE\n#define SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#endif\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_SIMPLE || SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_OUTLINE_FILL_SIMPLE\n#define SYMBOLOGY_TYPE_IS_SIMPLE_LIKE\n#endif",text:{"common.glsl":"uniform highp vec2 u_mosaicSize;\nvarying highp vec3 v_id;\nvarying mediump vec3 v_pos;\nvarying lowp float v_opacity;\nvarying lowp vec4 v_color;\nvarying highp vec2 v_tex;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying lowp float v_transparency;","hittest.glsl":"#include <materials/hittest/common.glsl>","text.frag":"precision mediump float;\n#include <materials/text/common.glsl>\nuniform lowp sampler2D u_texture;\n#ifdef HITTEST\nvec4 getColor() {\nreturn v_color;\n}\n#else\nvec4 getColor()\n{\nfloat SDF_CUTOFF = (2.0 / 8.0);\nfloat SDF_BASE_EDGE_DIST = 1.0 - SDF_CUTOFF;\nlowp float dist = texture2D(u_texture, v_tex).a;\nmediump float edge = SDF_BASE_EDGE_DIST - v_edgeDistanceOffset;\n#ifdef HIGHLIGHT\nedge /= 2.0;\n#endif\nlowp float aa = v_antialiasingWidth;\nlowp float alpha = smoothstep(edge - aa, edge + aa, dist);\nreturn alpha * v_color * v_opacity;\n}\n#endif\nvoid main()\n{\ngl_FragColor = getColor();\n}","text.vert":"precision highp float;\n#include <materials/utils.glsl>\n#include <materials/vcommon.glsl>\n#include <materials/text/common.glsl>\n#include <materials/text/hittest.glsl>\nattribute vec4 a_color;\nattribute vec4 a_haloColor;\nattribute vec4 a_texFontSize;\nattribute vec4 a_aux;\nattribute vec2 a_zoomRange;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nuniform float u_isHaloPass;\nuniform float u_isBackgroundPass;\nfloat getTextSize(inout vec2 offset, inout float baseSize, in float referenceSize) {\n#ifdef VV_SIZE\nfloat r = getSize(referenceSize) / referenceSize;\nbaseSize *= r;\noffset.xy *= r;\nreturn baseSize;\n#endif\nreturn baseSize;\n}\nvoid main()\n{\nINIT;\nfloat a_isBackground  = a_aux.y;\nfloat a_referenceSize = a_aux.z * a_aux.z / 256.0;\nfloat a_bitSet        = a_aux.w;\nfloat a_fontSize      = a_texFontSize.z;\nvec2  a_offset        = a_vertexOffset * OFFSET_PRECISION;\nvec3  in_pos        = vec3(a_pos * POSITION_PRECISION, 1.0);\nfloat fontSize      = getTextSize(a_offset, a_fontSize, a_referenceSize);\nfloat fontScale     = fontSize / SDF_FONT_SIZE;\nvec3  offset        = getRotation() * vec3(a_offset, 0.0);\nmat3  extrudeMatrix = getBit(a_bitSet, 0) == 1.0 ? u_displayViewMat3 : u_displayMat3;\nfloat isText = 1.0 - a_isBackground;\nfloat isBackground = u_isBackgroundPass * a_isBackground;\nvec4  nonHaloColor  = (isBackground * a_color) + (isText * getColor(a_color, a_bitSet, 1));\nv_color   = u_isHaloPass * a_haloColor + (1.0 - u_isHaloPass) * nonHaloColor;\nv_opacity = getOpacity();\nv_id      = norm(a_id);\nv_tex     = a_texCoords / u_mosaicSize;\nv_pos     = u_dvsMat3 * in_pos + extrudeMatrix * offset;\nfloat isHidden = u_isBackgroundPass * isText + (1.0 - u_isBackgroundPass) * a_isBackground;\nv_pos.z += 2.0 * isHidden;\nv_edgeDistanceOffset = u_isHaloPass * OUTLINE_SCALE * a_texFontSize.w / fontScale / MAX_SDF_DISTANCE;\nv_antialiasingWidth  = 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\n#ifdef HITTEST\nhighp vec3 out_pos  = vec3(0.);\nv_color = vec4(0.);\nhittestMarker(v_color, out_pos, u_viewMat3 * u_tileMat3 *  vec3(a_pos * POSITION_PRECISION, 1.0)\n+ u_tileMat3 * offset, fontSize / 2.);\ngl_PointSize = 1.;\ngl_Position = vec4(clip(v_color, out_pos, getFilterFlags(), a_zoomRange), 1.0);\n#else\ngl_Position =  vec4(clip(v_color, v_pos, getFilterFlags(), a_zoomRange), 1.0);\n#endif\n}"},"utils.glsl":"float rshift(in float u32, in int amount) {\nreturn floor(u32 / pow(2.0, float(amount)));\n}\nfloat getBit(in float bitset, in int bitIndex) {\nfloat offset = pow(2.0, float(bitIndex));\nreturn mod(floor(bitset / offset), 2.0);\n}\nconst int highlightReasonsLength = 3;\nfloat getFilterBit(in float bitset, in int bitIndex) {\nreturn getBit(bitset, bitIndex + highlightReasonsLength);\n}\nfloat getHighlightBit(in float bitset, in int bitIndex) {\nreturn getBit(bitset, bitIndex);\n}\nhighp vec3 unpackDisplayIdTexel(in highp vec3 bitset) {\nfloat isAggregate = getBit(bitset.b, 7);\nreturn (1.0 - isAggregate) * bitset + isAggregate * (vec3(bitset.rgb) - vec3(0.0, 0.0, float(0x80)));\n}\nvec4 unpack(in float u32) {\nfloat r = mod(rshift(u32, 0), 255.0);\nfloat g = mod(rshift(u32, 8), 255.0);\nfloat b = mod(rshift(u32, 16), 255.0);\nfloat a = mod(rshift(u32, 24), 255.0);\nreturn vec4(r, g, b, a);\n}\nvec3 norm(in vec3 v) {\nreturn v /= 255.0;\n}\nvec4 norm(in vec4 v) {\nreturn v /= 255.0;\n}\nfloat max4(vec4 target) {\nreturn max(max(max(target.x, target.y), target.z), target.w);\n}\nvec2 unpack_u8_nf32(vec2 bytes) {\nreturn (bytes - 127.0) / 127.0;\n}\nhighp float rand(in vec2 co) {\nhighp float a = 12.9898;\nhighp float b = 78.233;\nhighp float c = 43758.5453;\nhighp float dt = dot(co, vec2(a,b));\nhighp float sn = mod(dt, 3.14);\nreturn fract(sin(sn) * c);\n}","vcommon.glsl":"#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/attributeData.glsl>\n#include <materials/vv.glsl>\n#include <materials/barycentric.glsl>\nattribute vec2 a_pos;\nattribute highp vec3 a_id;\nuniform highp mat3 displayViewScreenMat3;\nuniform highp mat3 displayViewMat3;\nuniform highp mat3 displayMat3;\nuniform highp mat3 tileMat3;\nuniform highp mat3 viewMat3;\nuniform highp float pixelRatio;\nuniform mediump float zoomFactor;\nuniform mediump float antialiasing;\nuniform mediump float currentScale;\nuniform mediump float currentZoom;\nuniform mediump float metersPerSRUnit;\nvec4 VV_ADATA = vec4(0.0);\nvoid loadVisualVariableData(inout vec4 target) {\ntarget.rgba = getVisualVariableData(a_id);\n}\n#ifdef VV\n#define INIT loadVisualVariableData(VV_ADATA)\n#else\n#define INIT\n#endif\nvec4 getColor(in vec4 a_color, in float a_bitSet, int index) {\n#ifdef VV_COLOR\nfloat isColorLocked   = getBit(a_bitSet, index);\nreturn getVVColor(VV_ADATA[ATTR_VV_COLOR], a_color, isColorLocked);\n#else\nreturn a_color;\n#endif\n}\nfloat getOpacity() {\n#ifdef VV_OPACITY\nreturn getVVOpacity(VV_ADATA[ATTR_VV_OPACITY]);\n#else\nreturn 1.0;\n#endif\n}\nfloat getSize(in float in_size, in float currentScale) {\n#ifdef VV_SIZE\nreturn getVVSize(in_size, VV_ADATA[ATTR_VV_SIZE], currentScale);\n#else\nreturn in_size;\n#endif\n}\nmat3 getRotation() {\n#ifdef VV_ROTATION\nreturn getVVRotationMat3(mod(VV_ADATA[ATTR_VV_ROTATION], 360.0));\n#else\nreturn mat3(1.0);\n#endif\n}\nfloat getFilterFlags() {\n#ifdef IGNORES_SAMPLER_PRECISION\nreturn ceil(getFilterData(a_id).x * 255.0);\n#else\nreturn getFilterData(a_id).x * 255.0;\n#endif\n}\nvec4 getAnimationState() {\nreturn getAnimation(a_id);\n}\nfloat getMinZoom() {\nvec4 data0 = getFilterData(a_id) * 255.0;\nreturn data0.g;\n}\nmat3 getMatrixNoDisplay(float isMapAligned) {\nreturn isMapAligned * viewMat3 * tileMat3 + (1.0 - isMapAligned) * tileMat3;\n}\nmat3 getMatrix(float isMapAligned) {\nreturn isMapAligned * displayViewMat3 + (1.0 - isMapAligned) * displayMat3;\n}\nfloat checkHighlightBit(float filterFlags, int index) {\nreturn getHighlightBit(filterFlags, index);\n}\nfloat checkHighlight(float filterFlags) {\nfloat result = checkHighlightBit(filterFlags, 0);\nfor (int i = 1; i < highlightReasonsLength; i++) {\nresult = result + checkHighlightBit(filterFlags, i);\n}\nreturn step(0.1, result);\n}\nvec3 clip(inout vec4 color, inout vec3 pos, in float filterFlags, in vec2 minMaxZoom) {\npos.z += 2.0 * (1.0 - getFilterBit(filterFlags, 0));\n#ifdef inside\npos.z += 2.0 * (1.0 - getFilterBit(filterFlags, 1));\n#elif defined(outside)\npos.z += 2.0 * getFilterBit(filterFlags, 1);\n#elif defined(highlight)\n#if !defined(highlight_all)\npos.z += 2.0 * (1.0 - checkHighlight(filterFlags));\n#endif\n#endif\npos.z += 2.0 * (step(minMaxZoom.y, currentZoom) + (1.0 - step(minMaxZoom.x, currentZoom)));\nreturn pos;\n}","vv.glsl":"#if defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\n#define VV_SIZE\n#endif\n#if defined(VV_COLOR) || defined(VV_SIZE) || defined(VV_OPACITY) || defined(VV_ROTATION)\n#define VV\n#endif\n#ifdef VV_COLOR\nuniform highp float colorValues[8];\nuniform vec4 colors[8];\n#endif\n#ifdef VV_SIZE_MIN_MAX_VALUE\nuniform highp vec4 minMaxValueAndSize;\n#endif\n#ifdef VV_SIZE_SCALE_STOPS\nuniform highp float values[8];\nuniform float sizes[8];\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nuniform highp float values[8];\nuniform float sizes[8];\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nuniform highp float unitMeterRatio;\n#endif\n#ifdef VV_OPACITY\nuniform highp float opacityValues[8];\nuniform float opacities[8];\n#endif\n#ifdef VV_ROTATION\nuniform lowp float rotationType;\n#endif\nbool isNan(float val) {\nreturn (val == NAN_MAGIC_NUMBER);\n}\n#ifdef VV_SIZE_MIN_MAX_VALUE\nfloat getVVMinMaxSize(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nfloat interpolationRatio = (sizeValue  - minMaxValueAndSize.x) / (minMaxValueAndSize.y - minMaxValueAndSize.x);\ninterpolationRatio = clamp(interpolationRatio, 0.0, 1.0);\nreturn minMaxValueAndSize.z + interpolationRatio * (minMaxValueAndSize.w - minMaxValueAndSize.z);\n}\n#endif\n#ifdef VV_SIZE_SCALE_STOPS\nfloat getVVScaleStopsSize(float currentScale) {\nfloat outSize;\nif (currentScale <= values[0]) {\noutSize = sizes[0];\n} else {\nif (currentScale >= values[7]) {\noutSize = sizes[7];\n} else {\nint index;\nindex = -1;\nfor (int i = 0; i < 8; i++) {\nif (values[i] > currentScale) {\nindex = i;\nbreak;\n}\n}\nint prevIndex = index - 1;\nfloat a = currentScale - values[prevIndex];\nfloat b = values[index] - values[prevIndex];\noutSize = mix(sizes[prevIndex], sizes[index], a / b);\n}\n}\nreturn outSize;\n}\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nconst int VV_SIZE_N = 8;\nfloat getVVStopsSize(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nif (sizeValue <= values[0]) {\nreturn sizes[0];\n}\nfor (int i = 1; i < VV_SIZE_N; ++i) {\nif (values[i] >= sizeValue) {\nfloat f = (sizeValue - values[i-1]) / (values[i] - values[i-1]);\nreturn mix(sizes[i-1], sizes[i], f);\n}\n}\nreturn sizes[VV_SIZE_N - 1];\n}\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nfloat getVVUnitValue(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nreturn sizeValue * (metersPerSRUnit / unitMeterRatio);\n}\n#endif\n#ifdef VV_OPACITY\nconst int VV_OPACITY_N = 8;\nfloat getVVOpacity(float opacityValue) {\nif (isNan(opacityValue)) {\nreturn 1.0;\n}\nif (opacityValue <= opacityValues[0]) {\nreturn opacities[0];\n}\nfor (int i = 1; i < VV_OPACITY_N; ++i) {\nif (opacityValues[i] >= opacityValue) {\nfloat f = (opacityValue - opacityValues[i-1]) / (opacityValues[i] - opacityValues[i-1]);\nreturn mix(opacities[i-1], opacities[i], f);\n}\n}\nreturn opacities[VV_OPACITY_N - 1];\n}\n#endif\n#ifdef VV_ROTATION\nmat4 getVVRotation(float rotationValue) {\nif (isNan(rotationValue)) {\nreturn mat4(1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, 0,\n0, 0, 0, 1);\n}\nfloat rotation = rotationValue;\nif (rotationType == 1.0) {\nrotation = 90.0 - rotation;\n}\nfloat angle = C_DEG_TO_RAD * rotation;\nfloat sinA = sin(angle);\nfloat cosA = cos(angle);\nreturn mat4(cosA, sinA, 0, 0,\n-sinA,  cosA, 0, 0,\n0,     0, 1, 0,\n0,     0, 0, 1);\n}\nmat3 getVVRotationMat3(float rotationValue) {\nif (isNan(rotationValue)) {\nreturn mat3(1, 0, 0,\n0, 1, 0,\n0, 0, 1);\n}\nfloat rotation = rotationValue;\nif (rotationType == 1.0) {\nrotation = 90.0 - rotation;\n}\nfloat angle = C_DEG_TO_RAD * -rotation;\nfloat sinA = sin(angle);\nfloat cosA = cos(angle);\nreturn mat3(cosA, -sinA, 0,\nsinA, cosA, 0,\n0,    0,    1);\n}\n#endif\n#ifdef VV_COLOR\nconst int VV_COLOR_N = 8;\nvec4 getVVColor(float colorValue, vec4 fallback, float isColorLocked) {\nif (isNan(colorValue) || isColorLocked == 1.0) {\nreturn fallback;\n}\nif (colorValue <= colorValues[0]) {\nreturn colors[0];\n}\nfor (int i = 1; i < VV_COLOR_N; ++i) {\nif (colorValues[i] >= colorValue) {\nfloat f = (colorValue - colorValues[i-1]) / (colorValues[i] - colorValues[i-1]);\nreturn mix(colors[i-1], colors[i], f);\n}\n}\nreturn colors[VV_COLOR_N - 1];\n}\n#endif\nfloat getVVSize(in float size, in float vvSize, in float currentScale)  {\n#ifdef VV_SIZE_MIN_MAX_VALUE\nreturn getVVMinMaxSize(vvSize, size);\n#elif defined(VV_SIZE_SCALE_STOPS)\nfloat outSize = getVVScaleStopsSize(currentScale);\nreturn isNan(outSize) ? size : outSize;\n#elif defined(VV_SIZE_FIELD_STOPS)\nfloat outSize = getVVStopsSize(vvSize, size);\nreturn isNan(outSize) ? size : outSize;\n#elif defined(VV_SIZE_UNIT_VALUE)\nreturn getVVUnitValue(vvSize, size);\n#else\nreturn size;\n#endif\n}"},overlay:{overlay:{"overlay.frag":"precision lowp float;\nuniform lowp sampler2D u_texture;\nuniform lowp float u_opacity;\nvarying mediump vec2 v_uv;\nvoid main() {\nvec4 color = texture2D(u_texture, v_uv);\ngl_FragColor = color *  u_opacity;\n}","overlay.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_uv;\nuniform highp mat3 u_dvsMat3;\nuniform mediump vec2 u_perspective;\nuniform highp float u_wrapAroundShift;\nuniform mediump vec2 u_texSize;\nvarying mediump vec2 v_uv;\nvoid main(void) {\nv_uv = a_uv / u_texSize;\nfloat w = 1.0 + dot(a_uv, u_perspective);\nvec3 pos = u_dvsMat3 * vec3(a_pos + vec2(u_wrapAroundShift, 0.0), 1.0);\ngl_Position = vec4(w * pos.xy, 0.0, w);\n}"}},"post-processing":{blit:{"blit.frag":"precision mediump float;\nuniform sampler2D u_texture;\nvarying vec2 v_uv;\nvoid main() {\ngl_FragColor = texture2D(u_texture, v_uv);\n}"},bloom:{composite:{"composite.frag":"precision mediump float;\nvarying vec2 v_uv;\nuniform sampler2D u_blurTexture1;\nuniform sampler2D u_blurTexture2;\nuniform sampler2D u_blurTexture3;\nuniform sampler2D u_blurTexture4;\nuniform sampler2D u_blurTexture5;\nuniform float u_bloomStrength;\nuniform float u_bloomRadius;\nuniform float u_bloomFactors[NUMMIPS];\nuniform vec3 u_bloomTintColors[NUMMIPS];\nfloat lerpBloomFactor(const in float factor) {\nfloat mirrorFactor = 1.2 - factor;\nreturn mix(factor, mirrorFactor, u_bloomRadius);\n}\nvoid main() {\nvec4 color = u_bloomStrength * (\nlerpBloomFactor(u_bloomFactors[0]) * vec4(u_bloomTintColors[0], 1.0) * texture2D(u_blurTexture1, v_uv) +\nlerpBloomFactor(u_bloomFactors[1]) * vec4(u_bloomTintColors[1], 1.0) * texture2D(u_blurTexture2, v_uv) +\nlerpBloomFactor(u_bloomFactors[2]) * vec4(u_bloomTintColors[2], 1.0) * texture2D(u_blurTexture3, v_uv) +\nlerpBloomFactor(u_bloomFactors[3]) * vec4(u_bloomTintColors[3], 1.0) * texture2D(u_blurTexture4, v_uv) +\nlerpBloomFactor(u_bloomFactors[4]) * vec4(u_bloomTintColors[4], 1.0) * texture2D(u_blurTexture5, v_uv)\n);\ngl_FragColor = clamp(color, 0.0, 1.0);\n}"},gaussianBlur:{"gaussianBlur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nuniform vec2 u_direction;\nvarying vec2 v_uv;\n#define KERNEL_RADIUS RADIUS\n#define SIGMA RADIUS\nfloat gaussianPdf(in float x, in float sigma) {\nreturn 0.39894 * exp(-0.5 * x * x / ( sigma * sigma)) / sigma;\n}\nvoid main() {\nvec2 invSize = 1.0 / u_texSize;\nfloat fSigma = float(SIGMA);\nfloat weightSum = gaussianPdf(0.0, fSigma);\nvec4 pixelColorSum = texture2D(u_colorTexture, v_uv) * weightSum;\nfor (int i = 1; i < KERNEL_RADIUS; i ++) {\nfloat x = float(i);\nfloat w = gaussianPdf(x, fSigma);\nvec2 uvOffset = u_direction * invSize * x;\nvec4 sample1 = texture2D(u_colorTexture, v_uv + uvOffset);\nvec4 sample2 = texture2D(u_colorTexture, v_uv - uvOffset);\npixelColorSum += (sample1 + sample2) * w;\nweightSum += 2.0 * w;\n}\ngl_FragColor = pixelColorSum /weightSum;\n}"},luminosityHighPass:{"luminosityHighPass.frag":"precision mediump float;\nuniform sampler2D u_texture;\nuniform vec3 u_defaultColor;\nuniform float u_defaultOpacity;\nuniform float u_luminosityThreshold;\nuniform float u_smoothWidth;\nvarying vec2 v_uv;\nvoid main() {\nvec4 texel = texture2D(u_texture, v_uv);\nvec3 luma = vec3(0.299, 0.587, 0.114);\nfloat v = dot(texel.xyz, luma);\nvec4 outputColor = vec4(u_defaultColor.rgb, u_defaultOpacity);\nfloat alpha = smoothstep(u_luminosityThreshold, u_luminosityThreshold + u_smoothWidth, v);\ngl_FragColor = mix(outputColor, texel, alpha);\n}"}},blur:{gaussianBlur:{"gaussianBlur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nuniform vec2 u_direction;\nuniform float u_sigma;\nvarying vec2 v_uv;\n#define KERNEL_RADIUS RADIUS\nfloat gaussianPdf(in float x, in float sigma) {\nreturn 0.39894 * exp(-0.5 * x * x / ( sigma * sigma)) / sigma;\n}\nvoid main() {\nvec2 invSize = 1.0 / u_texSize;\nfloat fSigma = u_sigma;\nfloat weightSum = gaussianPdf(0.0, fSigma);\nvec4 pixelColorSum = texture2D(u_colorTexture, v_uv) * weightSum;\nfor (int i = 1; i < KERNEL_RADIUS; i ++) {\nfloat x = float(i);\nfloat w = gaussianPdf(x, fSigma);\nvec2 uvOffset = u_direction * invSize * x;\nvec4 sample1 = texture2D(u_colorTexture, v_uv + uvOffset);\nvec4 sample2 = texture2D(u_colorTexture, v_uv - uvOffset);\npixelColorSum += (sample1 + sample2) * w;\nweightSum += 2.0 * w;\n}\ngl_FragColor = pixelColorSum /weightSum;\n}"},"radial-blur":{"radial-blur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nconst float sampleDist = 1.0;\nconst float sampleStrength = 2.2;\nvoid main(void) {\nfloat samples[10];\nsamples[0] = -0.08;\nsamples[1] = -0.05;\nsamples[2] = -0.03;\nsamples[3] = -0.02;\nsamples[4] = -0.01;\nsamples[5] =  0.01;\nsamples[6] =  0.02;\nsamples[7] =  0.03;\nsamples[8] =  0.05;\nsamples[9] =  0.08;\nvec2 dir = 0.5 - v_uv;\nfloat dist = sqrt(dir.x * dir.x + dir.y * dir.y);\ndir = dir / dist;\nvec4 color = texture2D(u_colorTexture,v_uv);\nvec4 sum = color;\nfor (int i = 0; i < 10; i++) {\nsum += texture2D(u_colorTexture, v_uv + dir * samples[i] * sampleDist);\n}\nsum *= 1.0 / 11.0;\nfloat t = dist * sampleStrength;\nt = clamp(t, 0.0, 1.0);\ngl_FragColor = mix(color, sum, t);\n}"}},dra:{"dra.frag":"precision mediump float;\nuniform sampler2D u_minColor;\nuniform sampler2D u_maxColor;\nuniform sampler2D u_texture;\nvarying vec2 v_uv;\nvoid main() {\nvec4 minColor = texture2D(u_minColor, vec2(0.5));\nvec4 maxColor = texture2D(u_maxColor, vec2(0.5));\nvec4 color = texture2D(u_texture, v_uv);\nvec3 minColorUnpremultiply = minColor.rgb / minColor.a;\nvec3 maxColorUnpremultiply = maxColor.rgb / maxColor.a;\nvec3 colorUnpremultiply = color.rgb / color.a;\nvec3 range = maxColorUnpremultiply - minColorUnpremultiply;\ngl_FragColor = vec4(color.a * (colorUnpremultiply - minColorUnpremultiply) / range, color.a);\n}","min-max":{"min-max.frag":"#extension GL_EXT_draw_buffers : require\nprecision mediump float;\n#define CELL_SIZE 2\nuniform sampler2D u_minTexture;\nuniform sampler2D u_maxTexture;\nuniform vec2 u_srcResolution;\nuniform vec2 u_dstResolution;\nvarying vec2 v_uv;\nvoid main() {\nvec2 srcPixel = floor(gl_FragCoord.xy) * float(CELL_SIZE);\nvec2 onePixel = vec2(1.0) / u_srcResolution;\nvec2 uv = (srcPixel + 0.5) / u_srcResolution;\nvec4 minColor = vec4(1.0);\nvec4 maxColor = vec4(0.0);\nfor (int y = 0; y < CELL_SIZE; ++y) {\nfor (int x = 0; x < CELL_SIZE; ++x) {\nvec2 offset = uv + vec2(x, y) * onePixel;\nminColor = min(minColor, texture2D(u_minTexture, offset));\nmaxColor = max(maxColor, texture2D(u_maxTexture, offset));\n}\n}\ngl_FragData[0] = minColor;\ngl_FragData[1] = maxColor;\n}"}},"drop-shadow":{composite:{"composite.frag":"precision mediump float;\nuniform sampler2D u_layerFBOTexture;\nuniform sampler2D u_blurTexture;\nuniform vec4 u_shadowColor;\nuniform vec2 u_shadowOffset;\nuniform highp mat3 u_displayViewMat3;\nvarying vec2 v_uv;\nvoid main() {\nvec3 offset = u_displayViewMat3 * vec3(u_shadowOffset, 0.0);\nvec4 layerColor = texture2D(u_layerFBOTexture, v_uv);\nvec4 blurColor = texture2D(u_blurTexture, v_uv - offset.xy / 2.0);\ngl_FragColor = ((1.0 - layerColor.a) * blurColor.a * u_shadowColor + layerColor);\n}"}},"edge-detect":{"frei-chen":{"frei-chen.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nvarying vec2 v_uv;\nvec2 texel = vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[9];\nconst mat3 g0 = mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );\nconst mat3 g1 = mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );\nconst mat3 g2 = mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );\nconst mat3 g3 = mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );\nconst mat3 g4 = mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );\nconst mat3 g5 = mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );\nconst mat3 g6 = mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );\nconst mat3 g7 = mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );\nconst mat3 g8 = mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );\nvoid main() {\nG[0] = g0,\nG[1] = g1,\nG[2] = g2,\nG[3] = g3,\nG[4] = g4,\nG[5] = g5,\nG[6] = g6,\nG[7] = g7,\nG[8] = g8;\nmat3 I;\nfloat cnv[9];\nvec3 sample;\nfor (float i = 0.0; i < 3.0; i++) {\nfor (float j = 0.0; j < 3.0; j++) {\nsample = texture2D(u_colorTexture, v_uv + texel * vec2(i - 1.0,j - 1.0)).rgb;\nI[int(i)][int(j)] = length(sample);\n}\n}\nfor (int i = 0; i < 9; i++) {\nfloat dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] = dp3 * dp3;\n}\nfloat M = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);\nfloat S = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);\ngl_FragColor = vec4(vec3(sqrt(M / S)), texture2D(u_colorTexture, v_uv).a);\n}"},sobel:{"sobel.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nuniform vec2 u_texSize;\nvec2 texel = vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[2];\nconst mat3 g0 = mat3( 1.0, 2.0, 1.0, 0.0, 0.0, 0.0, -1.0, -2.0, -1.0 );\nconst mat3 g1 = mat3( 1.0, 0.0, -1.0, 2.0, 0.0, -2.0, 1.0, 0.0, -1.0 );\nvoid main() {\nmat3 I;\nfloat cnv[2];\nvec3 sample;\nG[0] = g0;\nG[1] = g1;\nfor (float i = 0.0; i < 3.0; i++) {\nfor (float j = 0.0; j < 3.0; j++) {\nsample = texture2D( u_colorTexture, v_uv + texel * vec2(i-1.0,j-1.0) ).rgb;\nI[int(i)][int(j)] = length(sample);\n}\n}\nfor (int i = 0; i < 2; i++) {\nfloat dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] = dp3 * dp3;\n}\ngl_FragColor = vec4(vec3(0.5 * sqrt(cnv[0] * cnv[0] + cnv[1] * cnv[1])), texture2D(u_colorTexture, v_uv).a);\n}"}},"edge-enhance":{"edge-enhance.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nuniform vec2 u_texSize;\nvec2 texel = vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[2];\nconst mat3 g0 = mat3( 1.0, 0.0, -1.0, 1.0, 0.0, -1.0, 1.0, 0.0, -1.0 );\nconst mat3 g1 = mat3( 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, -1.0, -1.0, -1.0 );\nvoid main() {\nmat3 I;\nfloat cnv[2];\nvec3 sample;\nG[0] = g0;\nG[1] = g1;\nfor (float i = 0.0; i < 3.0; i++) {\nfor (float j = 0.0; j < 3.0; j++) {\nsample = texture2D( u_colorTexture, v_uv + texel * vec2(i-1.0,j-1.0) ).rgb;\nI[int(i)][int(j)] = length(sample);\n}\n}\nfor (int i = 0; i < 2; i++) {\nfloat dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] = dp3 * dp3;\n}\nvec4 color = texture2D(u_colorTexture, v_uv);\ngl_FragColor = vec4(0.5 * sqrt(cnv[0] * cnv[0] + cnv[1] * cnv[1]) * color);\n}"},filterEffect:{"filterEffect.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform mat4 u_coefficients;\nvarying vec2 v_uv;\nvoid main() {\nvec4 color = texture2D(u_colorTexture, v_uv);\nvec4 rgbw = u_coefficients * vec4(color.a > 0.0 ? color.rgb / color.a : vec3(0.0), 1.0);\nfloat a = color.a;\ngl_FragColor = vec4(a * rgbw.rgb, a);\n}"},pp:{"pp.vert":"precision mediump float;\nattribute vec2 a_position;\nvarying vec2 v_uv;\nvoid main() {\ngl_Position = vec4(a_position, 0.0, 1.0);\nv_uv = (a_position + 1.0) / 2.0;\n}"}},raster:{bitmap:{"bitmap.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform highp vec2 u_coordScale;\nuniform lowp float u_opacity;\n#include <filtering/bicubic.glsl>\nvoid main() {\n#ifdef BICUBIC\nvec4 color = sampleBicubicBSpline(u_texture, v_texcoord, u_coordScale);\n#else\nvec4 color = texture2D(u_texture, v_texcoord);\n#endif\ngl_FragColor = vec4(color.rgb * u_opacity, color.a * u_opacity);\n}","bitmap.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord = a_pos;\ngl_Position = vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"},common:{"common.glsl":"uniform sampler2D u_image;\nuniform int u_bandCount;\nuniform bool u_flipY;\nuniform float u_opacity;\nuniform int u_resampling;\nuniform vec2 u_srcImageSize;\n#ifdef APPLY_PROJECTION\n#include <raster/common/projection.glsl>\n#endif\n#ifdef BICUBIC\n#include <filtering/bicubic.glsl>\n#endif\n#ifdef BILINEAR\n#include <filtering/bilinear.glsl>\n#endif\nvec2 getPixelLocation(vec2 coords) {\nvec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;\n#ifdef APPLY_PROJECTION\ntargetLocation = projectPixelLocation(targetLocation);\n#endif\nreturn targetLocation;\n}\nbool isOutside(vec2 coords){\nif (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {\nreturn true;\n} else {\nreturn false;\n}\n}\nvec4 getPixel(vec2 pixelLocation) {\n#ifdef BICUBIC\nvec4 color = sampleBicubicBSpline(u_image, pixelLocation, u_srcImageSize);\n#elif defined(BILINEAR)\nvec4 color = sampleBilinear(u_image, pixelLocation, u_srcImageSize);\n#else\nvec4 color = texture2D(u_image, pixelLocation);\n#endif\nreturn color;\n}","common.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform highp float u_scale;\nuniform highp vec2 u_offset;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord = a_pos * u_scale + u_offset;\ngl_Position = vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}","contrastBrightness.glsl":"uniform float u_contrastOffset;\nuniform float u_brightnessOffset;\nvec4 adjustContrastBrightness(vec4 currentPixel, bool isFloat) {\nvec4 pixelValue = isFloat ? currentPixel * 255.0 : currentPixel;\nfloat maxI = 255.0;\nfloat mid = 128.0;\nfloat c = u_contrastOffset;\nfloat b = u_brightnessOffset;\nvec4 v;\nif (c > 0.0 && c < 100.0) {\nv = (200.0 * pixelValue - 100.0 * maxI + 2.0 * maxI * b) / (2.0 * (100.0 - c)) + mid;\n} else if (c <= 0.0 && c > -100.0) {\nv = (200.0 * pixelValue - 100.0 * maxI + 2.0 * maxI * b) * (100.0 + c) / 20000.0 + mid;\n} else if (c == 100.0) {\nv = (200.0 * pixelValue - 100.0 * maxI + (maxI + 1.0) * (100.0 - c) + 2.0 * maxI * b);\nv = (sign(v) + 1.0) / 2.0;\n} else if (c == -100.0) {\nv = vec4(mid, mid, mid, currentPixel.a);\n}\nvec3 rgb = clamp(v.rgb / 255.0, 0.0, 1.0);\nreturn vec4(rgb, currentPixel.a);\n}","getSurfaceValues.glsl":"#include <raster/common/mirror.glsl>\nvoid getSurfaceValues(sampler2D imageTexture, vec2 texCoord, vec2 srcImageSize, inout float values[10]) {\nvec2 onePixel = 1.0 / srcImageSize;\nvec4 va = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(-1.0, -1.0)));\nvec4 vb = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(0.0, -1.0)));\nvec4 vc = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(1.0, -1.0)));\nvec4 vd = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(-1.0, 0.0)));\nvec4 ve = texture2D(imageTexture, mirror(texCoord));\nvec4 vf = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(1.0, 0.0)));\nvec4 vg = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(-1.0, 1.0)));\nvec4 vh = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(0.0, 1.0)));\nvec4 vi = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(1.0, 1.0)));\nfloat alpha = va.a * vb.a * vc.a * vd.a * ve.a * vf.a * vg.a * vh.a * vi.a;\nvalues[0] = va.r;\nvalues[1] = vb.r;\nvalues[2] = vc.r;\nvalues[3] = vd.r;\nvalues[4] = ve.r;\nvalues[5] = vf.r;\nvalues[6] = vg.r;\nvalues[7] = vh.r;\nvalues[8] = vi.r;\nvalues[9] = alpha;\n}","inverse.glsl":"float invertValue(float value) {\nfloat s = sign(value);\nreturn (s * s) / (value + abs(s) - 1.0);\n}","mirror.glsl":"vec2 mirror(vec2 pos) {\nvec2 pos1 = abs(pos);\nreturn step(pos1, vec2(1.0, 1.0)) * pos1 + step(1.0, pos1) * (2.0 - pos1);\n}","projection.glsl":"uniform sampler2D u_transformGrid;\nuniform vec2 u_transformSpacing;\nuniform vec2 u_transformGridSize;\nuniform vec2 u_targetImageSize;\nvec2 projectPixelLocation(vec2 coords) {\n#ifdef LOOKUP_PROJECTION\nvec4 pv = texture2D(u_transformGrid, coords);\nreturn vec2(pv.r, pv.g);\n#endif\nvec2 index_image = floor(coords * u_targetImageSize);\nvec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\nvec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;\nvec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\nvec2 srcLocation;\nvec2 transform_location = index_transform + oneTransformPixel * 0.5;\nif (pos.s <= pos.t) {\nvec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\nvec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\nsrcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));\n} else {\nvec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\nvec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\nsrcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));\n}\nreturn srcLocation;\n}"},flow:{"getFadeOpacity.glsl":"uniform float u_decayRate;\nuniform float u_fadeToZero;\nfloat getFadeOpacity(float x) {\nfloat cutOff = mix(0.0, exp(-u_decayRate), u_fadeToZero);\nreturn (exp(-u_decayRate * x) - cutOff) / (1.0 - cutOff);\n}","getFragmentColor.glsl":"vec4 getFragmentColor(vec4 color, float dist, float size, float featheringSize) {\nfloat featheringStart = clamp(0.5 - featheringSize / size, 0.0, 0.5);\nif (dist > featheringStart) {\ncolor *= 1.0 - (dist - featheringStart) / (0.5 - featheringStart);\n}\nreturn color;\n}",imagery:{"imagery.frag":"precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform float u_Min;\nuniform float u_Max;\nuniform float u_featheringSize;\n#include <raster/flow/vv.glsl>\nfloat getIntensity(float v) {\nreturn u_Min + v * (u_Max - u_Min);\n}\nvoid main(void) {\nvec4 sampled = texture2D(u_texture, v_texcoord);\nfloat intensity = getIntensity(sampled.r);\ngl_FragColor = getColor(intensity);\ngl_FragColor.a *= getOpacity(sampled.r);\ngl_FragColor.a *= sampled.a;\ngl_FragColor.rgb *= gl_FragColor.a;\n}","imagery.vert":"attribute vec2 a_position;\nattribute vec2 a_texcoord;\nuniform mat3 u_dvsMat3;\nvarying vec2 v_texcoord;\nvoid main(void) {\nvec2 xy = (u_dvsMat3 * vec3(a_position, 1.0)).xy;\ngl_Position = vec4(xy, 0.0, 1.0);\nv_texcoord = a_texcoord;\n}"},particles:{"particles.frag":"precision highp float;\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying float v_size;\nuniform float u_featheringSize;\n#include <raster/flow/getFragmentColor.glsl>\nvoid main(void) {\ngl_FragColor = getFragmentColor(v_color, length(v_texcoord - 0.5), v_size, u_featheringSize);\n}","particles.vert":"attribute vec4 a_xyts0;\nattribute vec4 a_xyts1;\nattribute vec4 a_typeIdDurationSeed;\nattribute vec4 a_extrudeInfo;\nuniform mat3 u_dvsMat3;\nuniform mat3 u_displayViewMat3;\nuniform float u_time;\nuniform float u_trailLength;\nuniform float u_flowSpeed;\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying float v_size;\nuniform float u_featheringSize;\nuniform float u_introFade;\n#include <raster/flow/vv.glsl>\n#include <raster/flow/getFadeOpacity.glsl>\nvoid main(void) {\nvec2 position0 = a_xyts0.xy;\nfloat t0 = a_xyts0.z;\nfloat speed0 = a_xyts0.w;\nvec2 position1 = a_xyts1.xy;\nfloat t1 = a_xyts1.z;\nfloat speed1 = a_xyts1.w;\nfloat type = a_typeIdDurationSeed.x;\nfloat id = a_typeIdDurationSeed.y;\nfloat duration = a_typeIdDurationSeed.z;\nfloat seed = a_typeIdDurationSeed.w;\nvec2 e0 = a_extrudeInfo.xy;\nvec2 e1 = a_extrudeInfo.zw;\nfloat animationPeriod = duration + u_trailLength;\nfloat scaledTime = u_time * u_flowSpeed;\nfloat randomizedTime = scaledTime + seed * animationPeriod;\nfloat t = mod(randomizedTime, animationPeriod);\nfloat fUnclamped = (t - t0) / (t1 - t0);\nfloat f = clamp(fUnclamped, 0.0, 1.0);\nfloat clampedTime = mix(t0, t1, f);\nfloat speed = mix(speed0, speed1, f);\nvec2 extrude;\nvec2 position;\nfloat fadeOpacity;\nfloat introOpacity;\nif (type == 2.0) {\nif (fUnclamped < 0.0 || (fUnclamped > 1.0 && t1 != duration)) {\ngl_Position = vec4(0.0, 0.0, -2.0, 1.0);\nreturn;\n}\nvec2 ortho = mix(e0, e1, f);\nvec2 parallel;\nparallel = normalize(position1 - position0) * 0.5;\nif (id == 1.0) {\nextrude = ortho;\nv_texcoord = vec2(0.5, 0.0);\n} else if (id == 2.0) {\nextrude = -ortho;\nv_texcoord = vec2(0.5, 1.0);\n} else if (id == 3.0) {\nextrude = ortho + parallel;\nv_texcoord = vec2(1.0, 0.0);\n} else if (id == 4.0) {\nextrude = -ortho + parallel;\nv_texcoord = vec2(1.0, 1.0);\n}\nfadeOpacity = getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity = 1.0 - exp(-clampedTime);\nv_size = getSize(speed);\nv_color = getColor(speed);\nv_color.a *= getOpacity(speed);\nposition = mix(position0, position1, f);\n} else {\nif (fUnclamped < 0.0) {\ngl_Position = vec4(0.0, 0.0, -2.0, 1.0);\nreturn;\n}\nif (id == 1.0) {\nextrude = e0;\nv_texcoord = vec2(0.5, 0.0);\nfadeOpacity = getFadeOpacity((t - t0) / u_trailLength);\nintroOpacity = 1.0 - exp(-t0);\nv_size = getSize(speed0);\nv_color = getColor(speed0);\nv_color.a *= getOpacity(speed0);\nposition = position0;\n} else if (id == 2.0) {\nextrude = -e0;\nv_texcoord = vec2(0.5, 1.0);\nfadeOpacity = getFadeOpacity((t - t0) / u_trailLength);\nintroOpacity = 1.0 - exp(-t0);\nv_size = getSize(speed0);\nv_color = getColor(speed0);\nv_color.a *= getOpacity(speed0);\nposition = position0;\n} else if (id == 3.0) {\nextrude = mix(e0, e1, f);\nv_texcoord = vec2(0.5, 0.0);\nfadeOpacity = getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity = 1.0 - exp(-clampedTime);\nv_size = getSize(speed);\nv_color = getColor(speed);\nv_color.a *= getOpacity(speed);\nposition = mix(position0, position1, f);\n} else if (id == 4.0) {\nextrude = -mix(e0, e1, f);\nv_texcoord = vec2(0.5, 1.0);\nfadeOpacity = getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity = 1.0 - exp(-clampedTime);\nv_size = getSize(speed);\nv_color = getColor(speed);\nv_color.a *= getOpacity(speed);\nposition = mix(position0, position1, f);\n}\n}\nvec2 xy = (u_dvsMat3 * vec3(position, 1.0) + u_displayViewMat3 * vec3(extrude * v_size, 0.0)).xy;\ngl_Position = vec4(xy, 0.0, 1.0);\nv_color.a *= fadeOpacity;\nv_color.a *= mix(1.0, introOpacity, u_introFade);\nv_color.rgb *= v_color.a;\n}"},streamlines:{"streamlines.frag":"precision highp float;\nvarying float v_side;\nvarying float v_time;\nvarying float v_totalTime;\nvarying float v_timeSeed;\nvarying vec4 v_color;\nvarying float v_size;\nuniform float u_time;\nuniform float u_trailLength;\nuniform float u_flowSpeed;\nuniform float u_featheringSize;\nuniform float u_introFade;\n#include <raster/flow/getFragmentColor.glsl>\n#include <raster/flow/getFadeOpacity.glsl>\nvoid main(void) {\nfloat t = mod(v_timeSeed * (v_totalTime + u_trailLength) + u_time * u_flowSpeed, v_totalTime + u_trailLength) - v_time;\nvec4 color = v_color * step(0.0, t) * getFadeOpacity(t / u_trailLength);\ncolor *= mix(1.0, 1.0 - exp(-v_time), u_introFade);\ngl_FragColor = getFragmentColor(color, length((v_side + 1.0) / 2.0 - 0.5), v_size, u_featheringSize);\n}","streamlines.vert":"attribute vec3 a_positionAndSide;\nattribute vec3 a_timeInfo;\nattribute vec2 a_extrude;\nattribute float a_speed;\nuniform mat3 u_dvsMat3;\nuniform mat3 u_displayViewMat3;\nvarying float v_time;\nvarying float v_totalTime;\nvarying float v_timeSeed;\nvarying vec4 v_color;\nvarying float v_side;\nvarying float v_size;\nuniform float u_featheringSize;\n#include <raster/flow/vv.glsl>\nvoid main(void) {\nvec4 lineColor = getColor(a_speed);\nfloat lineOpacity = getOpacity(a_speed);\nfloat lineSize = getSize(a_speed);\nvec2 position = a_positionAndSide.xy;\nv_side = a_positionAndSide.z;\nvec2 xy = (u_dvsMat3 * vec3(position, 1.0) + u_displayViewMat3 * vec3(a_extrude * lineSize, 0.0)).xy;\ngl_Position = vec4(xy, 0.0, 1.0);\nv_time = a_timeInfo.x;\nv_totalTime = a_timeInfo.y;\nv_timeSeed = a_timeInfo.z;\nv_color = lineColor;\nv_color.a *= lineOpacity;\nv_color.rgb *= v_color.a;\nv_size = lineSize;\n}"},"vv.glsl":"#define MAX_STOPS 8\n#ifdef VV_COLOR\nuniform float u_color_stops[MAX_STOPS];\nuniform vec4 u_color_values[MAX_STOPS];\nuniform int u_color_count;\n#else\nuniform vec4 u_color;\n#endif\n#ifdef VV_OPACITY\nuniform float u_opacity_stops[MAX_STOPS];\nuniform float u_opacity_values[MAX_STOPS];\nuniform int u_opacity_count;\n#else\nuniform float u_opacity;\n#endif\n#ifdef VV_SIZE\nuniform float u_size_stops[MAX_STOPS];\nuniform float u_size_values[MAX_STOPS];\nuniform int u_size_count;\n#else\nuniform float u_size;\n#endif\nuniform float u_featheringOffset;\nvec4 getColor(float x) {\n#ifdef VV_COLOR\nvec4 color = u_color_values[0];\n{\nfor (int i = 1; i < MAX_STOPS; i++) {\nif (i >= u_color_count) {\nbreak;\n}\nfloat x1 = u_color_stops[i - 1];\nif (x < x1) {\nbreak;\n}\nfloat x2 = u_color_stops[i];\nvec4 y2 = u_color_values[i];\nif (x < x2) {\nvec4 y1 = u_color_values[i - 1];\ncolor = y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\ncolor = y2;\n}\n}\n}\n#else\nvec4 color = u_color;\n#endif\nreturn color;\n}\nfloat getOpacity(float x) {\n#ifdef VV_OPACITY\nfloat opacity = u_opacity_values[0];\n{\nfor (int i = 1; i < MAX_STOPS; i++) {\nif (i >= u_opacity_count) {\nbreak;\n}\nfloat x1 = u_opacity_stops[i - 1];\nif (x < x1) {\nbreak;\n}\nfloat x2 = u_opacity_stops[i];\nfloat y2 = u_opacity_values[i];\nif (x < x2) {\nfloat y1 = u_opacity_values[i - 1];\nopacity = y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\nopacity = y2;\n}\n}\n}\n#else\nfloat opacity = u_opacity;\n#endif\nreturn opacity;\n}\nfloat getSize(float x) {\n#ifdef VV_SIZE\nfloat size = u_size_values[0];\n{\nfor (int i = 1; i < MAX_STOPS; i++) {\nif (i >= u_size_count) {\nbreak;\n}\nfloat x1 = u_size_stops[i - 1];\nif (x < x1) {\nbreak;\n}\nfloat x2 = u_size_stops[i];\nfloat y2 = u_size_values[i];\nif (x < x2) {\nfloat y1 = u_size_values[i - 1];\nsize = y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\nsize = y2;\n}\n}\n}\n#else\nfloat size = u_size;\n#endif\nreturn size + 2.0 * u_featheringSize * u_featheringOffset;\n}"},hillshade:{"hillshade.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include <raster/common/common.glsl>\nuniform int u_hillshadeType;\nuniform float u_sinZcosAs[6];\nuniform float u_sinZsinAs[6];\nuniform float u_cosZs[6];\nuniform float u_weights[6];\nuniform vec2 u_factor;\nuniform float u_minValue;\nuniform float u_maxValue;\n#include <raster/lut/colorize.glsl>\n#include <raster/common/getSurfaceValues.glsl>\nvec3 rgb2hsv(vec3 c) {\nvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\nvec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\nfloat d = q.x - min(q.w, q.y);\nfloat e = 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\nvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec4 overlay(float val, float minValue, float maxValue, float hillshade) {\nval = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);\nvec4 rgb = colorize(vec4(val, val, val, 1.0), 255.0);\nvec3 hsv = rgb2hsv(rgb.xyz);\nhsv.z = hillshade;\nreturn vec4(hsv2rgb(hsv), 1.0) * rgb.a;\n}\nvoid main() {\nvec2 pixelLocation = getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel = getPixel(pixelLocation);\nif (currentPixel.a == 0.0) {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nfloat pv[10];\ngetSurfaceValues(u_image, pixelLocation, u_srcImageSize, pv);\nfloat alpha = pv[9];\nfloat dzx = (pv[2] + 2.0 * pv[5] + pv[8] - pv[0] - 2.0 * pv[3] - pv[6]) * u_factor.s;\nfloat dzy = (pv[6] + 2.0 * pv[7] + pv[8] - pv[0] - 2.0 * pv[1] - pv[2]) * u_factor.t;\nfloat dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);\nfloat hillshade = 0.0;\nif (u_hillshadeType == 0){\nfloat cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;\nfloat z = (u_cosZs[0] + cosDelta) / dzd;\nif (z < 0.0)  z = 0.0;\nhillshade = z;\n} else {\nfor (int k = 0; k < 6; k++) {\nfloat cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\nfloat z = (u_cosZs[k] + cosDelta) / dzd;\nif (z < 0.0) z = 0.0;\nhillshade = hillshade + z * u_weights[k];\nif (k == 5) break;\n}\n}\n#ifdef APPLY_COLORMAP\ngl_FragColor = overlay(pv[4], u_minValue, u_maxValue, hillshade) * alpha * u_opacity;\n#else\ngl_FragColor = vec4(hillshade, hillshade, hillshade, 1.0) * alpha * u_opacity;\n#endif\n}"},lut:{"colorize.glsl":"uniform sampler2D u_colormap;\nuniform float u_colormapOffset;\nuniform float u_colormapMaxIndex;\nvec4 colorize(vec4 currentPixel, float scaleFactor) {\nfloat clrIndex = clamp(currentPixel.r * scaleFactor - u_colormapOffset, 0.0, u_colormapMaxIndex);\nvec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);\nvec4 color = texture2D(u_colormap, clrPosition);\nvec4 result = vec4(color.rgb, color.a * currentPixel.a);\nreturn result;\n}","lut.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include <raster/common/common.glsl>\n#include <raster/lut/colorize.glsl>\nvoid main() {\nvec2 pixelLocation = getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel = getPixel(pixelLocation);\nvec4 result = colorize(currentPixel, 1.0);\ngl_FragColor = vec4(result.xyz, 1.0) * result.a * u_opacity;\n}"},magdir:{"magdir.frag":"precision mediump float;\nvarying vec4 v_color;\nuniform lowp float u_opacity;\nvoid main() {\ngl_FragColor = v_color * u_opacity;\n}","magdir.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_vv;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform vec2 u_symbolSize;\nuniform vec2 u_symbolPercentRange;\nuniform vec2 u_dataRange;\nuniform float u_rotation;\nuniform vec4 u_colors[12];\nvarying vec4 v_color;\nvoid main()\n{\nfloat angle = a_offset.y + u_rotation;\n#ifndef ROTATION_GEOGRAPHIC\nangle = 3.14159265359 * 2.0 - angle - 3.14159265359 / 2.0;\n#endif\nvec2 offset = vec2(cos(angle), sin(angle)) * a_offset.x;\n#ifdef DATA_RANGE\nfloat valuePercentage = clamp((a_vv.y - u_dataRange.x) / (u_dataRange.y - u_dataRange.x), 0.0, 1.0);\nfloat sizeRatio = u_symbolPercentRange.x + valuePercentage * (u_symbolPercentRange.y - u_symbolPercentRange.x);\nfloat sizePercentage = clamp(sizeRatio, u_symbolPercentRange.x, u_symbolPercentRange.y);\n#else\nfloat sizePercentage = (u_symbolPercentRange.x + u_symbolPercentRange.y) / 2.0;\n#endif\nvec2 pos = a_pos + offset * sizePercentage * u_symbolSize;\nv_color = u_colors[int(a_vv.x)];\ngl_Position = vec4(u_dvsMat3 * vec3(pos * u_coordScale, 1.0), 1.0);\n}"},reproject:{"reproject.frag":"precision mediump float;\nvarying vec2 v_texcoord;\n#include <raster/common/common.glsl>\nvoid main() {\nvec2 pixelLocation = getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\nreturn;\n}\nvec4 currentPixel = getPixel(pixelLocation);\ngl_FragColor = vec4(currentPixel.rgb, 1.0) * currentPixel.a * u_opacity;\n}","reproject.vert":"precision mediump float;\nattribute vec2 a_position;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord = a_position;\ngl_Position = vec4(2.0 * (a_position - 0.5), 0.0, 1.0);\n}"},rfx:{aspect:{"aspect.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_cellSize;\nuniform vec2 u_srcImageSize;\n#include <raster/common/getSurfaceValues.glsl>\nconst float pi = 3.14159265359;\nvoid main() {\nfloat pv[10];\ngetSurfaceValues(u_image, v_texcoord, u_srcImageSize, pv);\nfloat alpha = pv[9];\nfloat dzx = (pv[2] + 2.0 * pv[5] + pv[8] - pv[0] - 2.0 * pv[3] - pv[6]) / (8.0 * u_cellSize[0]);\nfloat dzy = -(pv[6] + 2.0 * pv[7] + pv[8] - pv[0] - 2.0 * pv[1] - pv[2]) / (8.0 * u_cellSize[1]);\nalpha *= sign(abs(dzx) + abs(dzy));\nfloat aspect_rad = (dzx == 0.0) ? (step(0.0, dzy) * 0.5 * pi + step(dzy, 0.0) * 1.5 * pi) : mod((2.5 * pi + atan(dzy, -dzx)), 2.0 * pi);\nfloat aspect = aspect_rad * 180.0 / pi;\ngl_FragColor = vec4(aspect, aspect, aspect, 1.0) * alpha;\n}"},bandarithmetic:{"bandarithmetic.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform mediump mat3 u_bandIndexMat3;\nuniform float u_adjustments[3];\n#include <raster/common/inverse.glsl>\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nvec3 pv2 = u_bandIndexMat3 * pv.rgb;\nfloat nir = pv2.r;\nfloat red = pv2.g;\nfloat index;\n#ifdef NDXI\nindex = (nir - red) * invertValue(nir + red);\n#elif defined(SR)\nindex = nir * invertValue(red);\n#elif defined(CI)\nindex = nir * invertValue(red) - 1.0;\n#elif defined(SAVI)\nindex = (nir - red) * invertValue(nir + red + u_adjustments[0]) * (1.0 + u_adjustments[0]);\n#elif defined(TSAVI)\nfloat s = u_adjustments[0];\nfloat a = u_adjustments[1];\nfloat x = u_adjustments[2];\nfloat y = -a * s + x * (1.0 + s * s);\nindex = (s * (nir - s * red - a)) * invertValue(a * nir + red + y);\n#elif defined(MSAVI)\nfloat nir2 = 2.0 * nir + 1.0;\nindex = 0.5 * (nir2 - sqrt(nir2 * nir2 - 8.0 * (nir - red)));\n#elif defined(GEMI)\nfloat eta = (2.0 * (nir * nir - red * red) + 1.5 * nir + 0.5 * red) * invertValue(nir + red + 0.5);\nindex = eta * (1.0 - 0.25 * eta) - (red - 0.125) * invertValue(1.0 - red);\n#elif defined(PVI)\nfloat a = u_adjustments[0];\nfloat b = u_adjustments[1];\nfloat y = sqrt(1.0 + a * a);\nindex = (nir - a * red - b) * invertValue(y);\n#elif defined(VARI)\nindex = (pv2.g - pv2.r) * invertValue(pv2.g + pv2.r - pv2.b);\n#elif defined(MTVI)\nfloat green = pv2.b;\nfloat v = sqrt(pow((2.0 * nir + 1.0), 2.0) - (6.0 * nir - 5.0 * sqrt(red)) - 0.5);\nindex = 1.5 * (1.2 * (nir - green) - 2.5 * (red - green)) * invertValue(v);\n#elif defined(RTVICORE)\nfloat green = pv2.b;\nindex = 100.0 * (nir - red) - 10.0 * (nir - green);\n#elif defined(EVI)\nfloat blue = pv2.b;\nfloat denom = nir + 6.0 * red - 7.5 * blue + 1.0;\nindex =  (2.5 * (nir - red)) * invertValue(denom);\n#elif defined(WNDWI)\nfloat g = pv2.r;\nfloat n = pv2.g;\nfloat s = pv2.s;\nfloat a = u_adjustments[0];\nfloat denom = g + a * n + (1.0 - a) * s;\nindex = (g - a * n - (1 - a) * s) * invertValue(denom);\n#elif defined(BAI)\nindex = invertValue(pow((0.1 - red), 2.0) + pow((0.06 - nir), 2.0));\n#else\ngl_FragColor = pv;\nreturn;\n#endif\ngl_FragColor = vec4(index, index, index, pv.a);\n}"},compositeband:{"compositeband.frag":"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\n#ifdef ONE_CONSTANT\nuniform float u_image1Const;\n#ifdef TWO_CONSTANT\nuniform float u_image2Const;\n#endif\nuniform mat3 u_imageSwap;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\nvec4 pv0 = texture2D(u_image, v_texcoord);\nfloat a = pv0.r;\nfloat alpha = pv0.a;\n#ifdef TWO_CONSTANT\nfloat b = u_image1Const;\nfloat c = u_image2Const;\nvec3 abc = u_imageSwap * vec3(a, b, c);\na = abc.s;\nb = abc.t;\nc = abc.p;\n#elif defined(ONE_CONSTANT)\nvec4 pv1 = texture2D(u_image1, v_texcoord);\nfloat b = pv1.r;\nfloat c = u_image1Const;\nvec3 abc = u_imageSwap * vec3(a, b, c);\na = abc.s;\nb = abc.t;\nc = abc.p;\nalpha *= pv1.a;\n#else\nvec4 pv1 = texture2D(u_image1, v_texcoord);\nvec4 pv2 = texture2D(u_image2, v_texcoord);\nfloat b = pv1.r;\nfloat c = pv2.r;\nalpha = alpha * pv1.a * pv2.a;\n#endif\ngl_FragColor = vec4(a, b, c, alpha);\n}"},computechange:{"computechange.frag":"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\n#ifdef ONE_CONSTANT\nuniform float u_image1Const;\nuniform mat3 u_imageSwap;\n#endif\nvarying vec2 v_texcoord;\nuniform vec2 u_domainRange;\n#include <raster/common/inverse.glsl>\nvoid main() {\nvec4 pv0 = texture2D(u_image, v_texcoord);\nfloat a = pv0.r;\n#ifdef ONE_CONSTANT\nfloat b = u_image1Const;\nvec3 abc = u_imageSwap * vec3(a, b, 0);\na = abc.s;\nb = abc.t;\n#else\nvec4 pv1 = texture2D(u_image1, v_texcoord);\nfloat b = pv1.r;\n#endif\nfloat result = a;\nfloat alpha = pv0.a;\n#ifdef DIFFERENCE\nresult = a - b;\n#elif defined(RELATIVE)\nresult = (a - b) * invertValue(max(abs(a), abs(b)));\n#endif\nbool isInvalid = result < u_domainRange.s || result > u_domainRange.t;\nresult = isInvalid ? 0.0 : result;\nalpha *= float(!isInvalid);\n#ifdef ROUND_OUTPUT\nresult = floor(result + 0.5);\n#endif\ngl_FragColor = vec4(result, result, result, alpha);\n}"},contrast:{"contrast.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#include <raster/common/contrastBrightness.glsl>\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nvec4 result = adjustContrastBrightness(pv, false) ;\ngl_FragColor = vec4(result.rgb * 255.0, result.a);\n}"},convolution:{"convolution.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_srcImageSize;\n#define KERNEL_SIZE_ROWS ROWS\n#define KERNEL_SIZE_COLS COLS\nuniform vec2 u_clampRange;\nuniform float u_kernel[25];\n#include <raster/common/mirror.glsl>\nvoid main() {\nvec3 rgb = vec3(0.0, 0.0, 0.0);\nvec2 resolution = 1.0 / u_srcImageSize;\nfloat rowOffset = -float(floor(float(KERNEL_SIZE_ROWS) / 2.0));\nfloat colOffset = -float(floor(float(KERNEL_SIZE_COLS) / 2.0));\nfloat alpha = 1.0;\nfor (int row = 0; row < KERNEL_SIZE_ROWS; row++) {\nfloat pos_row = rowOffset + float(row);\nfor (int col = 0; col < KERNEL_SIZE_COLS; col++) {\nvec2 pos = v_texcoord + vec2(colOffset + float(col), pos_row) * resolution;\nvec4 pv = texture2D(u_image, mirror(pos));\nrgb += pv.rgb * u_kernel[row * KERNEL_SIZE_COLS + col];\nalpha *= pv.a;\n}\n}\nrgb = clamp(rgb, u_clampRange.s, u_clampRange.t);\ngl_FragColor = vec4(rgb * alpha, alpha);\n}"},curvature:{"curvature.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform float u_zlFactor;\nuniform vec2 u_srcImageSize;\n#include <raster/common/getSurfaceValues.glsl>\nvoid main() {\nfloat pv[10];\ngetSurfaceValues(u_image, v_texcoord, u_srcImageSize, pv);\nfloat alpha = pv[9];\nfloat d = ((pv[3] + pv[5]) * 0.5 - pv[4]);\nfloat e = ((pv[1] + pv[7]) * 0.5 - pv[4]);\nfloat curvature = 0.0;\n#ifdef STANDARD\ncurvature = -u_zlFactor * (d + e);\ngl_FragColor = vec4(curvature, curvature, curvature, alpha);\n#else\nfloat f = (-pv[0] + pv[2] + pv[6] - pv[8]) / 4.0;\nfloat g = (-pv[3] + pv[5]) / 2.0;\nfloat h = (pv[1] - pv[7]) / 2.0;\nfloat g2 = g * g;\nfloat h2 = h * h;\n#ifdef PROFILE\ncurvature = (u_zlFactor * (d * g2 + e * h2 + f * g * h)) / (g2 + h2);\n#else\ncurvature = (-u_zlFactor * (d * h2 + e * g2 - f * g * h)) / (g2 + h2);\n#endif\n#endif\ngl_FragColor = vec4(curvature, curvature, curvature, alpha);\n}"},extractband:{"extractband.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform mediump mat3 u_bandIndexMat3;\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nvec3 pv2 = u_bandIndexMat3 * pv.rgb;\ngl_FragColor = vec4(pv2, pv.a);\n}"},focalstatistics:{"focalstatistics.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_srcImageSize;\n#define KERNEL_SIZE_ROWS ROWS\n#define KERNEL_SIZE_COLS COLS\nuniform vec2 u_clampRange;\n#include <raster/common/mirror.glsl>\n#include <raster/common/inverse.glsl>\nvoid main() {\nvec2 resolution = 1.0 / u_srcImageSize;\nfloat rowOffset = -float(floor(float(KERNEL_SIZE_ROWS) / 2.0));\nfloat colOffset = -float(floor(float(KERNEL_SIZE_COLS) / 2.0));\nfloat count = 0.0;\n#ifdef STDDEV\nvec3 sum = vec3(0.0, 0.0, 0.0);\nvec3 sum2 = vec3(0.0, 0.0, 0.0);\n#endif\nvec4 currentPixel = texture2D(u_image, v_texcoord);\nvec3 rgb = currentPixel.rgb;\nfor (int row = 0; row < KERNEL_SIZE_ROWS; row++) {\nfloat pos_row = rowOffset + float(row);\nfor (int col = 0; col < KERNEL_SIZE_COLS; col++) {\nvec2 pos = v_texcoord + vec2(colOffset + float(col), pos_row) * resolution;\nvec4 pv = texture2D(u_image, mirror(pos));\ncount += pv.a;\n#ifdef MIN\nrgb = min(rgb, pv.rgb);\n#elif defined(MAX)\nrgb = max(rgb, pv.rgb);\n#elif defined(MEAN)\nrgb += pv.rgb;\n#elif defined(STDDEV)\nsum += pv.rgb;\nsum2 += (pv.rgb * pv.rgb);\n#endif\n}\n}\n#ifdef MEAN\nrgb *= invertValue(count);\n#elif defined(STDDEV)\nrgb = sqrt((sum2 - sum * sum * invertValue(count)) * invertValue(count));\n#endif\nfloat alpha = step(0.9999, count);\nrgb = clamp(rgb, u_clampRange.s, u_clampRange.t);\n#ifdef FILL\nrgb = (1.0 - currentPixel.a) * rgb + currentPixel.a * currentPixel.rgb;\n#endif\ngl_FragColor = vec4(rgb * alpha, alpha);\n}"},grayscale:{"grayscale.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec3 u_weights;\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nfloat value = dot(u_weights, pv.rgb);\ngl_FragColor = vec4(value, value, value, pv.a);\n}"},local:{"local.frag":"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\n#ifdef ONE_CONSTANT\nuniform float u_image1Const;\n#ifdef TWO_CONSTANT\nuniform float u_image2Const;\n#endif\nuniform mat3 u_imageSwap;\n#endif\nvarying vec2 v_texcoord;\nuniform vec2 u_domainRange;\n#include <raster/common/inverse.glsl>\nvoid main() {\nvec4 pv0 = texture2D(u_image, v_texcoord);\nfloat a = pv0.r;\n#ifdef TWO_IMAGES\n#ifdef ONE_CONSTANT\nfloat b = u_image1Const;\nvec3 abc = u_imageSwap * vec3(a, b, 0);\na = abc.s;\nb = abc.t;\n#else\nvec4 pv1 = texture2D(u_image1, v_texcoord);\nfloat b = pv1.r;\n#endif\n#elif defined(CONDITIONAL)\n#ifdef TWO_CONSTANT\nfloat b = u_image1Const;\nfloat c = u_image2Const;\nvec3 abc = u_imageSwap * vec3(a, b, c);\na = abc.s;\nb = abc.t;\nc = abc.p;\n#elif defined(ONE_CONSTANT)\nvec4 pv1 = texture2D(u_image1, v_texcoord);\nfloat b = pv1.r;\nfloat c = u_image1Const;\nvec3 abc = u_imageSwap * vec3(a, b, c);\na = abc.s;\nb = abc.t;\nc = abc.p;\n#else\nvec4 pv1 = texture2D(u_image1, v_texcoord);\nvec4 pv2 = texture2D(u_image2, v_texcoord);\nfloat b = pv1.r;\nfloat c = pv2.r;\n#endif\n#endif\nfloat result = a;\nfloat alpha = pv0.a;\n#ifdef PLUS\nresult = a + b;\n#elif defined(MINUS)\nresult = a - b;\n#elif defined(TIMES)\nresult = a * b;\n#elif defined(DIVIDE)\nresult = a * invertValue(b);\nalpha *= float(abs(sign(b)));\n#elif defined(FLOATDIVIDE)\nresult = a * invertValue(b);\nalpha *= float(abs(sign(b)));\n#elif defined(FLOORDIVIDE)\nresult = floor(a * invertValue(b));\nalpha *= float(abs(sign(b)));\n#elif defined(SQUARE)\nresult = a * a;\n#elif defined(SQRT)\nresult = sqrt(a);\n#elif defined(POWER)\nresult = pow(a, b);\n#elif defined(LN)\nresult = a <= 0.0 ? 0.0: log(a);\nalpha *= float(a > 0.0);\n#elif defined(LOG_1_0)\nresult = a <= 0.0 ? 0.0: log2(a) * invertValue(log2(10.0));\nalpha *= float(a > 0.0);\n#elif defined(LOG_2)\nresult = a <= 0.0 ? 0.0: log2(a);\nalpha *= float(a > 0.0);\n#elif defined(EXP)\nresult = exp(a);\n#elif defined(EXP_1_0)\nresult = pow(10.0, a);\n#elif defined(EXP_2)\nresult = pow(2.0, a);\n#elif defined(ROUNDDOWN)\nresult = floor(a);\n#elif defined(ROUNDUP)\nresult = ceil(a);\n#elif defined(INT)\nresult = float(sign(a)) * floor(abs(a));\n#elif defined(MOD)\nresult = mod(a, b);\n#elif defined(NEGATE)\nresult = -a;\n#elif defined(ABS)\nresult = abs(a);\n#elif defined(ACOS)\nresult = abs(a) > 1.0 ? 0.0: acos(a);\nalpha *= step(abs(a), 1.00001);\n#elif defined(ACOSH)\nresult = acosh(a);\n#elif defined(ASIN)\nresult = abs(a) > 1.0 ? 0.0: asin(a);\nalpha *= step(abs(a), 1.00001);\n#elif defined(ASINH)\nresult = asinh(a);\n#elif defined(ATAN)\nresult = atan(a);\n#elif defined(ATANH)\nresult = abs(a) > 1.0 ? 0.0: atanh(a);\nalpha *= step(abs(a), 1.0);\n#elif defined(ATAN_2)\nresult = atan(a, b);\n#elif defined(COS)\nresult = cos(a);\n#elif defined(COSH)\nresult = cosh(a);\n#elif defined(SIN)\nresult = sin(a);\n#elif defined(SINH)\nresult = sinh(a);\n#elif defined(TAN)\nresult = tan(a);\n#elif defined(TANH)\nresult = tanh(a);\n#elif defined(BITWISEAND)\nresult = a & b;\n#elif defined(BITWISEOR)\nresult = a | b;\n#elif defined(BITWISELEFTSHIFT)\nresult = a << b;\n#elif defined(BITWISERIGHTSHIFT)\nresult = a >> b;\n#elif defined(BITWISENOT)\nresult = ~a;\n#elif defined(BITWISEXOR)\nresult = a ^ b;\n#elif defined(BOOLEANAND)\nresult = float((a != 0.0) && (b != 0.0));\n#elif defined(BOOLEANNOT)\nresult = float(a == 0.0);\n#elif defined(BOOLEANOR)\nresult = float((a != 0.0) || (b != 0.0));\n#elif defined(BOOLEANXOR)\nresult = float((a != 0.0) ^^ (b != 0.0));\n#elif defined(GREATERTHAN)\nresult = float(a > b);\n#elif defined(GREATERTHANEQUAL)\nresult = float(a >= b);\n#elif defined(LESSTHAN)\nresult = float(a < b);\n#elif defined(LESSTHANEQUAL)\nresult = float(a <= b);\n#elif defined(EQUALTO)\nresult = float(a == b);\n#elif defined(NOTEQUAL)\nresult = float(a != b);\n#elif defined(ISNULL)\nresult = float(alpha == 0.0);\nalpha = 1.0;\n#elif defined(SETNULL)\nfloat maskValue = float(a == 0.0);\nresult = maskValue * b;\nalpha *= maskValue;\n#elif defined(CONDITIONAL)\nfloat weight = float(abs(sign(a)));\nresult = weight * b + (1.0 - weight) * c;\n#endif\nbool isInvalid = result < u_domainRange.s || result > u_domainRange.t;\nresult = isInvalid ? 0.0 : result;\nalpha *= float(!isInvalid);\n#ifdef ROUND_OUTPUT\nresult = floor(result + 0.5);\n#endif\ngl_FragColor = vec4(result, result, result, alpha);\n}"},mask:{"mask.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#define LEN_INCLUDED_RANGES 6\n#define LEN_NODATA_VALUES 6\nuniform highp float u_includedRanges[6];\nuniform highp float u_noDataValues[6];\nfloat maskFactor(float bandValue, float fromValue, float to) {\nfloat factor = 1.0;\nfor (int i = 0; i < LEN_NODATA_VALUES; i++) {\nfactor *= float(u_noDataValues[i] != bandValue);\n}\nfactor *= step(fromValue, bandValue) * step(bandValue, to);\nreturn factor;\n}\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nfloat redFactor = maskFactor(pv.r, u_includedRanges[0], u_includedRanges[1]);\n#ifdef MULTI_BAND\nfloat greenFactor = maskFactor(pv.g, u_includedRanges[2], u_includedRanges[3]);\nfloat blueFactor = maskFactor(pv.b, u_includedRanges[4], u_includedRanges[5]);\nfloat maskFactor = redFactor * greenFactor * blueFactor;\ngl_FragColor = pv * maskFactor;\n#else\ngl_FragColor = pv * redFactor;\n#endif\n}"},ndvi:{"ndvi.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform mediump mat3 u_bandIndexMat3;\n#include <raster/common/inverse.glsl>\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nvec3 pv2 = u_bandIndexMat3 * pv.rgb;\nfloat nir = pv2.r;\nfloat red = pv2.g;\nfloat index = (nir - red) * invertValue(nir + red);\n#ifdef SCALED\nindex = floor((index + 1.0) * 100.0 + 0.5);\n#endif\ngl_FragColor = vec4(index, index, index, pv.a);\n}"},remap:{"remap.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#define LEN_REMAP_RANGES 18\n#define LEN_NODATA_RANGES 12\nuniform highp float u_rangeMaps[18];\nuniform highp float u_noDataRanges[12];\nuniform highp float u_unmatchMask;\nuniform vec2 u_clampRange;\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nfloat factor = 1.0;\nfloat bandValue = pv.r;\nfor (int i = 0; i < LEN_NODATA_RANGES; i+=2) {\nfloat inside = 1.0 - step(u_noDataRanges[i], bandValue) * step(bandValue, u_noDataRanges[i+1]);\nfactor *= inside;\n}\nfloat mapValue = 0.0;\nfloat includeMask = 0.0;\nfor (int i = 0; i < LEN_REMAP_RANGES; i+=3) {\nfloat stepMask = step(u_rangeMaps[i], bandValue) * step(bandValue, u_rangeMaps[i+1]);\nincludeMask = (1.0 - stepMask) * includeMask + stepMask;\nmapValue = (1.0 - stepMask) * mapValue + stepMask * u_rangeMaps[i+2];\n}\nbandValue = factor * (mapValue + (1.0 - includeMask) * u_unmatchMask * pv.r);\nfloat bandMask = factor * max(u_unmatchMask, includeMask);\nbandValue = clamp(bandValue, u_clampRange.s, u_clampRange.t);\ngl_FragColor = vec4(bandValue, bandValue, bandValue, bandMask * pv.a);\n}"},slope:{"slope.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_cellSize;\nuniform float u_zFactor;\nuniform vec2 u_srcImageSize;\nuniform float u_pixelSizePower;\nuniform float u_pixelSizeFactor;\n#include <raster/common/getSurfaceValues.glsl>\nvoid main() {\nfloat pv[10];\ngetSurfaceValues(u_image, v_texcoord, u_srcImageSize, pv);\nfloat alpha = pv[9];\nfloat xf = (u_zFactor + pow(u_cellSize[0], u_pixelSizePower) * u_pixelSizeFactor) / (8.0 * u_cellSize[0]);\nfloat yf = (u_zFactor + pow(u_cellSize[1], u_pixelSizePower) * u_pixelSizeFactor) / (8.0 * u_cellSize[1]);\nfloat dzx = (pv[2] + 2.0 * pv[5] + pv[8] - pv[0] - 2.0 * pv[3] - pv[6]) * xf;\nfloat dzy = -(pv[6] + 2.0 * pv[7] + pv[8] - pv[0] - 2.0 * pv[1] - pv[2]) * yf;\nfloat rise2run = sqrt(dzx * dzx + dzy * dzy);\n#ifdef PERCENT_RISE\nfloat percentRise = rise2run * 100.0;\ngl_FragColor = vec4(percentRise, percentRise, percentRise, alpha);\n#else\nfloat degree = atan(rise2run) * 57.2957795;\ngl_FragColor = vec4(degree, degree, degree, alpha);\n#endif\n}"},stretch:{"stretch.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying highp vec2 v_texcoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput;\nuniform float u_maxOutput;\nuniform float u_factor[3];\nuniform float u_gamma[3];\nuniform float u_gammaCorrection[3];\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, float gamma, float gammaCorrection) {\nval = clamp(val, minCutOff, maxCutOff);\nfloat stretchedVal;\n#ifdef USE_GAMMA\nfloat tempf = 1.0;\nfloat outRange = maxOutput - minOutput;\nfloat relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);\ntempf -= step(1.0, gamma) * sign(gamma - 1.0) * pow(1.0 / outRange, relativeVal * gammaCorrection);\nstretchedVal = tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput;\nstretchedVal = clamp(stretchedVal, minOutput, maxOutput);\n#else\nstretchedVal = minOutput + (val - minCutOff) * factor;\n#endif\n#ifdef ROUND_OUTPUT\nstretchedVal = floor(stretchedVal + 0.5);\n#endif\nreturn stretchedVal;\n}\nvoid main() {\nvec4 currentPixel = texture2D(u_image, v_texcoord);\nfloat redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_gamma[0], u_gammaCorrection[0]);\n#ifdef MULTI_BAND\nfloat greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_gamma[1], u_gammaCorrection[1]);\nfloat blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_gamma[2], u_gammaCorrection[2]);\ngl_FragColor = vec4(redVal, greenVal, blueVal, currentPixel.a);\n#else\ngl_FragColor = vec4(redVal, redVal, redVal, currentPixel.a);\n#endif\n}"},vs:{"vs.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord = a_pos;\ngl_Position = vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"}},scalar:{"scalar.frag":"precision mediump float;\nuniform lowp float u_opacity;\nvarying vec2 v_pos;\nconst vec4 outlineColor = vec4(0.2, 0.2, 0.2, 1.0);\nconst float outlineSize = 0.02;\nconst float innerRadius = 0.25;\nconst float outerRadius = 0.42;\nconst float innerSquareLength = 0.15;\nvoid main() {\nmediump float dist = length(v_pos);\nmediump float fillalpha1 = smoothstep(outerRadius, outerRadius + outlineSize, dist);\nfillalpha1 *= (1.0-smoothstep(outerRadius + outlineSize, outerRadius + 0.1 + outlineSize, dist));\n#ifdef INNER_CIRCLE\nmediump float fillalpha2 = smoothstep(innerRadius, innerRadius + outlineSize, dist);\nfillalpha2 *= (1.0-smoothstep(innerRadius + outlineSize, innerRadius + 0.1 + outlineSize, dist));\n#else\nmediump float fillalpha2 = (abs(v_pos.x) < innerSquareLength ? 1.0 : 0.0) * (abs(v_pos.y) < innerSquareLength ? 1.0 : 0.0);\n#endif\ngl_FragColor = (fillalpha2 + fillalpha1) * outlineColor * u_opacity;\n}","scalar.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_vv;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform vec2 u_symbolSize;\nuniform vec2 u_symbolPercentRange;\nuniform vec2 u_dataRange;\nvarying vec2 v_pos;\nvoid main()\n{\n#ifdef DATA_RANGE\nfloat valuePercentage = clamp((a_vv.y - u_dataRange.x) / (u_dataRange.y - u_dataRange.x), 0.0, 1.0);\nfloat sizeRatio = u_symbolPercentRange.x + valuePercentage * (u_symbolPercentRange.y - u_symbolPercentRange.x);\nfloat sizePercentage = clamp(sizeRatio, u_symbolPercentRange.x, u_symbolPercentRange.y);\n#else\nfloat sizePercentage = (u_symbolPercentRange.x + u_symbolPercentRange.y) / 2.0;\n#endif\nvec2 size = u_symbolSize * sizePercentage;\nvec2 pos = a_pos + a_offset * size;\nv_pos = a_offset;\ngl_Position = vec4(u_dvsMat3 * vec3(pos * u_coordScale, 1.0), 1.0);\n}"},stretch:{"stretch.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include <raster/common/common.glsl>\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput;\nuniform float u_maxOutput;\nuniform float u_factor[3];\nuniform bool u_useGamma;\nuniform float u_gamma[3];\nuniform float u_gammaCorrection[3];\n#include <raster/lut/colorize.glsl>\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {\nif (val >= maxCutOff) {\nreturn maxOutput;\n} else if (val <= minCutOff) {\nreturn minOutput;\n}\nfloat stretchedVal;\nif (useGamma) {\nfloat tempf = 1.0;\nfloat outRange = maxOutput - minOutput;\nfloat relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);\nif (gamma > 1.0) {\ntempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);\n}\nstretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;\n} else {\nstretchedVal = minOutput + (val - minCutOff) * factor;\n}\nreturn stretchedVal;\n}\nvoid main() {\nvec2 pixelLocation = getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel = getPixel(pixelLocation);\n#ifdef NOOP\ngl_FragColor = vec4(currentPixel.rgb, 1.0) * currentPixel.a * u_opacity;\nreturn;\n#endif\nif (u_bandCount == 1) {\nfloat grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\n#ifdef APPLY_COLORMAP\nvec4 result = colorize(vec4(grayVal, grayVal, grayVal, 1.0), u_useGamma ? 255.0 : 1.0);\ngl_FragColor = vec4(result.xyz, 1.0) * result.a * currentPixel.a * u_opacity;\n#else\ngl_FragColor = vec4(grayVal, grayVal, grayVal, 1.0) * currentPixel.a * u_opacity;\n#endif\n} else {\nfloat redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\nfloat greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);\nfloat blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);\ngl_FragColor = vec4(redVal, greenVal, blueVal, 1.0) * currentPixel.a * u_opacity;\n}\n}"}},stencil:{"stencil.frag":"void main() {\ngl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n}","stencil.vert":"attribute vec2 a_pos;\nuniform mat3 u_worldExtent;\nvoid main() {\ngl_Position = vec4(u_worldExtent * vec3(a_pos, 1.0), 1.0);\n}"},test:{"TestShader.common.glsl":"#ifndef RETURN_RED\nvarying    vec4      v_color;\n#endif\nvarying    vec2      v_offset;","TestShader.frag":"precision highp float;\n#include <test/TestShader.common.glsl>\nvoid main() {\nif (v_offset.x > -.5 && v_offset.y > -.5 && v_offset.x < .5 && v_offset.y < .5) {\ndiscard;\n}\n#ifdef RETURN_RED\ngl_FragColor = vec4(1., 0., 0., 1.);\n#else\ngl_FragColor = v_color;\n#endif\n}","TestShader.vert":"const float POS_PRECISION_FACTOR = 10.;\nconst float OFFSET_PRECISION_FACTOR = 10.;\nconst float SIZE_PRECISION_FACTOR = 10.;\nattribute  vec2      a_pos_packed;\nattribute  vec2      a_offset_packed;\nattribute  float     a_size_packed;\n#ifdef DATA_DRIVEN_COLOR\nconst float u_dataDrivenColor_validValues[4] = float[4](0., 0., 1., 0.);\nuniform    vec4      u_dataDrivenColor_colorFallback;\nuniform    vec4      u_dataDrivenColor_color;\n#endif\nuniform    float     u_view_zoomLevel;\n#include <test/TestShader.common.glsl>\n#ifdef DATA_DRIVEN_COLOR\nvec4 getColor(float value) {\nint index = -1;\nfor (int i = 0; i < 4; i++) {\nif (u_dataDrivenColor_validValues[i] == value) {\nindex = i;\nbreak;\n}\n}\nif (index == -1) {\nreturn u_dataDrivenColor_colorFallback;\n}\nreturn u_dataDrivenColor_color;\n}\n#endif\nvoid main() {\nvec2  a_pos = a_pos_packed / POS_PRECISION_FACTOR;\nvec2  a_offset = a_offset_packed / OFFSET_PRECISION_FACTOR;\nfloat a_size = a_size_packed / SIZE_PRECISION_FACTOR;\nvec4 color = vec4(1., 0., 0., 1.);\n#ifdef DATA_DRIVEN_COLOR\ncolor = getColor(1.);\n#endif\nvec2 offsetScaled = a_offset * a_size;\nvec4 pos = vec4(a_pos.xy + offsetScaled, 0., 1.);\ngl_Position = pos;\n#ifndef RETURN_RED\nv_color = color;\n#endif\nv_offset = a_offset;\n}"},tileInfo:{"tileInfo.frag":"uniform mediump sampler2D u_texture;\nvarying mediump vec2 v_tex;\nvoid main(void) {\nlowp vec4 color = texture2D(u_texture, v_tex);\ncolor.rgb *= color.a;\ngl_FragColor = color;\n}","tileInfo.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_coord_ratio;\nuniform mediump vec2 u_delta;\nuniform mediump vec2 u_dimensions;\nvarying mediump vec2 v_tex;\nvoid main() {\nmediump vec2 offset = u_coord_ratio * vec2(u_delta + a_pos * u_dimensions);\nvec3 v_pos = u_dvsMat3 * vec3(offset, 1.0);\ngl_Position = vec4(v_pos.xy, 0.0, 1.0);\nv_tex = a_pos;\n}"},util:{"atan2.glsl":"float atan2(in float y, in float x) {\nfloat t0, t1, t2, t3, t4;\nt3 = abs(x);\nt1 = abs(y);\nt0 = max(t3, t1);\nt1 = min(t3, t1);\nt3 = 1.0 / t0;\nt3 = t1 * t3;\nt4 = t3 * t3;\nt0 =         - 0.013480470;\nt0 = t0 * t4 + 0.057477314;\nt0 = t0 * t4 - 0.121239071;\nt0 = t0 * t4 + 0.195635925;\nt0 = t0 * t4 - 0.332994597;\nt0 = t0 * t4 + 0.999995630;\nt3 = t0 * t3;\nt3 = (abs(y) > abs(x)) ? 1.570796327 - t3 : t3;\nt3 = x < 0.0 ?  3.141592654 - t3 : t3;\nt3 = y < 0.0 ? -t3 : t3;\nreturn t3;\n}","encoding.glsl":"const vec4 rgba2float_factors = vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}"}},function(t){let e=r;return t.split("/").forEach((t=>{e&&(e=e[t])})),e}));var r;function s(t){return n.resolveIncludes(t)}},24964:function(t,e,i){function n(t,e){if(null!==e){t.push(e.length);for(const i of e)i.serialize(t);return t}t.push(0)}function r(t,e,i){const n=t.readInt32(),r=new Array(n);for(let n=0;n<r.length;n++)r[n]=e.deserialize(t,i);return r}i.d(e,{_:function(){return r},j:function(){return n}})},6578:function(t,e,i){i.d(e,{Z:function(){return n}});class n{getObjectId(t){return t.getObjectId()}getAttributes(t){return t.readAttributes()}getAttribute(t,e){return t.readAttribute(e)}getAttributeAsTimestamp(t,e){return t.readAttributeAsTimestamp(e)}cloneWithGeometry(t,e){return t}getGeometry(t){return t.readGeometryWorldSpace()}getCentroid(t,e){return t.readCentroidForDisplay()}}n.Shared=new n},29739:function(t,e,i){i.d(e,{Jz:function(){return u},T9:function(){return a}});var n=i(50659),r=i(28230),s=i(51008),o=i(2746);function a(t,e){return{type:"simple",filters:e,capabilities:{maxTextureSize:(0,o.C)().maxTextureSize},bindings:c(t)}}function l(t){switch(t){case"opacity":return r.Gn.OPACITY;case"color":return r.Gn.COLOR;case"rotation":return r.Gn.ROTATION;case"size":return r.Gn.SIZE;default:return null}}function c(t){if(!t)return[];switch(t.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return u(t);case"dot-density":return function(t){const e=[];for(const i of t.attributes)e.push({binding:e.length,expression:i.valueExpression,field:i.field});return e}(t);case"pie-chart":return function(t){const e=u(t);let i=4;for(const n of t.attributes)e.push({binding:i++,expression:n.valueExpression,field:n.field});return e}(t);case"heatmap":return function({valueExpression:t,field:e}){return t||e?[{binding:0,expression:t,field:e}]:[]}(t)}}function u(t){return"visualVariables"in t&&t.visualVariables?.length?(0,s.R)(t.visualVariables).map((t=>function(t){switch(t.type){case"size":return function(t){return"$view.scale"===t.valueExpression?null:{binding:l(t.type),field:t.field,normalizationField:t.normalizationField,expression:t.valueExpression,valueRepresentation:t.valueRepresentation}}(t);case"color":case"opacity":return function(t){return{binding:l(t.type),field:t.field,normalizationField:t.normalizationField,expression:t.valueExpression}}(t);case"rotation":return function(t){return{binding:l(t.type),expression:t.valueExpression,field:t.field}}(t)}}(t))).filter(n.Ru):[]}},44327:function(t,e,i){i.d(e,{Dk:function(){return x},K4:function(){return S},j0:function(){return b}}),i(58941);var n=i(13520),r=i(62938),s=i(85031),o=i(39686),a=i(40846),l=i(29397),c=i(51008);const u=1.25,h=128,d=128;function f(t){if(!t.stops?.length)return null;const e=t.stops.sort(((t,e)=>t.value-e.value)),i=(0,l.r)(e,8),n=i.map((({value:t})=>t)),r=i.map((({color:t})=>(0,l.p)(t)));return{values:n,colors:r}}function _(t){if(!t.stops?.length)return null;const e=t.stops.sort(((t,e)=>t.value-e.value)),i=(0,l.r)(e,8);return{opacityValues:i.map((({value:t})=>t)),opacities:i.map((({opacity:t})=>t))}}function p(t){return{rotationType:"geographic"===t.rotationType?a.H_.Geographic:a.H_.Arithmatic}}function m(t){if(!t.stops?.length)return null;if(t.stops.some((t=>t.useMaxValue||t.useMinValue)))return(e,i)=>{const r=e.statisticsByLevel.get(i.key.level),s=t.stops.map((e=>({value:e.useMaxValue?r?.get(t.field)?.maxValue??0:e.useMinValue?r?.get(t.field)?.minValue??0:e.value,size:e.size?(0,n.Lz)(e.size):o.qM}))).sort(((t,e)=>t.value-e.value)),a=(0,l.r)(s,8);return{values:a.map((({value:t})=>t)),sizes:a.map((({size:t})=>t))}};const e=t.stops.sort(((t,e)=>t.value-e.value)),i=(0,l.r)(e,8);return{values:i.map((({value:t})=>t)),sizes:i.map((({size:t})=>(0,n.Lz)(t)))}}function g(t){return e=>{const{state:i}=e;return{unitValueToPixelsRatio:(0,r.GA)(i.spatialReference)/s.j[t.valueUnit??"meters"]/i.resolution}}}function y(t,e){const i=e.length;if(t<e[0].value||1===i)return e[0].size;for(let n=1;n<i;n++)if(t<e[n].value){const i=(t-e[n-1].value)/(e[n].value-e[n-1].value);return e[n-1].size+i*(e[n].size-e[n-1].size)}return e[i-1].size}function v(t){const{minDataValue:e,maxDataValue:i,minSize:r,maxSize:s}=t;if("object"==typeof r&&"object"==typeof s)return(t,o)=>{const a=t.state.scale,l=(0,n.Lz)(y(a,r.stops)),c=(0,n.Lz)(y(a,s.stops));return{minMaxValueAndSize:[e,i,l,c]}};if("object"==typeof r||"object"==typeof s)throw new Error("InternalError: Found a partial VisualVariableSizeMinMaxValue");return{minMaxValueAndSize:[e,i,(0,n.Lz)(r),(0,n.Lz)(s)]}}const x={visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:null,visualVariableSizeStops:null,visualVariableSizeScaleStops:null,visualVariableSizeOutlineScaleStops:null,visualVariableSizeUnitValue:null,visualVariableSizeMinMaxValue:null};function b(t,e=d,i=u){if(t.visualVariableSizeMinMaxValue)return t.visualVariableSizeMinMaxValue instanceof Function?h:Math.max(t.visualVariableSizeMinMaxValue.minMaxValueAndSize[3]*i,e);if(t.visualVariableSizeScaleStops){if(t.visualVariableSizeScaleStops instanceof Function)return h;const n=t.visualVariableSizeScaleStops.sizes;return Math.max(n[n.length-1]*i,e)}if(t.visualVariableSizeStops){if(t.visualVariableSizeStops instanceof Function)return h;const n=t.visualVariableSizeStops.sizes;return Math.max(n[n.length-1]*i,e)}return t.visualVariableSizeUnitValue?2*h:0}function S(t){const e={...x};if(!t||!("visualVariables"in t)||!t.visualVariables)return e;for(const i of(0,c.R)(t.visualVariables))switch(i.type){case"color":e.visualVariableColor=f(i);break;case"opacity":e.visualVariableOpacity=_(i);break;case"rotation":e.visualVariableRotation=p(i);break;case"size":switch(w(i)){case"field-stops":e.visualVariableSizeStops=m(i);break;case"scale-stops":"outline"===i.target?e.visualVariableSizeOutlineScaleStops=m(i):e.visualVariableSizeScaleStops=m(i);break;case"min-max":e.visualVariableSizeMinMaxValue=v(i);break;case"unit-value":e.visualVariableSizeUnitValue=g(i)}}return e}function w(t){return"number"==typeof t.minDataValue&&"number"==typeof t.maxDataValue&&null!=t.minSize&&null!=t.maxSize?"min-max":"$view.scale"===t?.valueExpression&&Array.isArray(t.stops)?"scale-stops":null==t.field&&"$view.scale"===t?.valueExpression||!(Array.isArray(t.stops)||"levels"in t&&t.levels)?null!=t.field||"$view.scale"!==t?.valueExpression?"unit-value":null:"field-stops"}},29397:function(t,e,i){function n(t,e){const i=t.slice(0,e),n=e-i.length;for(let t=0;t<n;t++){const t=i[i.length-1];i.push(t)}return i}function r(t){if(!t)return[0,0,0,0];const{r:e,g:i,b:n,a:r}=t;return[e*(r/255),i*(r/255),n*(r/255),r]}i.d(e,{p:function(){return r},r:function(){return n}})},81672:function(t,e,i){i.d(e,{EM:function(){return v},Gn:function(){return f},IQ:function(){return b},Jk:function(){return u},NZ:function(){return y},TY:function(){return l},Zi:function(){return d},oF:function(){return p}});var n=i(57176),r=i(38821),s=i(78119),o=i(44327),a=i(80958);function l(t){return t.minScale||t.maxScale?{minScale:t.minScale??0,maxScale:t.maxScale??0}:null}function c(t){if(null==t)return null;if(Array.isArray(t)){const[e,i,n,r]=t;return[e,i,n,255*r]}return"string"==typeof t?t:{...t,defaultValue:c(t?.defaultValue)}}async function u(t,e){const{cimResourceManager:i,cimAnalyzer:r,scaleExpression:s}=e.schemaOptions;await Promise.all(n.wp.fetchResources(t.symbol,i,[]));const o=r.analyzeSymbolReference(t,!1),a={scaleInfo:l(t),scaleExpression:s},c=[];for(const t of o)switch(t.type){case"marker":c.push(...h(t,e,a));break;case"fill":c.push(..._(t,e,a));break;case"line":c.push(...m(t,e,a));break;case"text":c.push(...x(t,e,a))}return c}function h(t,e,i){const{uniforms:n,schemaOptions:r}=e,{store:a}=r,l=t.isOutline?{...o.Dk,visualVariableSizeScaleStops:n.visualVariableSizeOutlineScaleStops}:{visualVariableColor:n.visualVariableColor,visualVariableOpacity:n.visualVariableOpacity,visualVariableSizeMinMaxValue:n.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:n.visualVariableSizeScaleStops,visualVariableSizeStops:n.visualVariableSizeStops,visualVariableSizeUnitValue:n.visualVariableSizeUnitValue,visualVariableRotation:n.visualVariableRotation};return d(a.ensureInstance(s.YS.marker,{uniforms:l,optionalAttributes:{zoomRange:!!i.scaleInfo}}),t,n,i)}function d(t,e,i,{scaleInfo:n,scaleExpression:s}){const l=(0,a.I)(i);return[t.createMeshInfo({size:e.size,scaleX:e.scaleX,anchorX:e.anchorPoint.x,anchorY:e.anchorPoint.y,angle:e.rotation,color:c(e.color)??[0,0,0,0],colorLocked:e.colorLocked,frameHeight:e.frameHeight,widthRatio:e.widthRatio,scaleInfo:n,offsetX:e.offsetX,offsetY:e.offsetY,outlineColor:c(e.outlineColor)??[0,0,0,0],outlineSize:e.outlineWidth,referenceSize:e.referenceSize||r.D.CIMVectorMarker.size,rotateClockwise:e.rotateClockwise,scaleFactor:s??1,sizeRatio:e.sizeRatio,alignment:e.alignment,isAbsoluteAnchorPoint:e.isAbsoluteAnchorPoint,scaleSymbolsProportionally:e.scaleSymbolsProportionally,sprite:e.spriteRasterizationParam,hasSizeVV:l,placement:e.markerPlacement,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null,transforms:e.transform,minPixelBuffer:(0,o.j0)(i)})]}function f(t,e,{scaleInfo:i}){return[t.createMeshInfo({color:c(e.color)??[0,0,0,0],scaleInfo:i,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null})]}function _(t,e,i){if(!t.spriteRasterizationParam)return function(t,e,i){const{uniforms:n,schemaOptions:r}=e,{store:o}=r;return f(o.ensureInstance(s.YS.fill,{uniforms:{visualVariableColor:t.colorLocked?null:n.visualVariableColor,visualVariableOpacity:n.visualVariableOpacity},optionalAttributes:{zoomRange:!!i.scaleInfo}}),t,i)}(t,e,i);const{uniforms:n,schemaOptions:r}=e,{store:o}=r;return p(o.ensureInstance(s.YS.complexFill,{uniforms:{visualVariableColor:t.colorLocked?null:n.visualVariableColor,visualVariableOpacity:n.visualVariableOpacity},optionalAttributes:{zoomRange:!!i.scaleInfo}}),t,null!=n.visualVariableColor,i)}function p(t,e,i,{scaleInfo:n}){if(!e.spriteRasterizationParam)throw new Error("InternalError: Sprite should always be defined");const r=!!e.hasUnresolvedReplacementColor&&(!i||e.colorLocked),s=e.sampleAlphaOnly&&!r,o=e.spriteRasterizationParam;return[t.createMeshInfo({color:c(e.color)??[0,0,0,0],height:e.height,aspectRatio:e.scaleX,offsetX:e.offsetX,offsetY:e.offsetY,scaleX:1,scaleY:1,angle:e.angle,applyRandomOffset:e.applyRandomOffset,sampleAlphaOnly:s,scaleProportionally:"CIMHatchFill"===o.resource.type,sprite:o,scaleInfo:n,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null})]}function m(t,e,i){const{uniforms:n,schemaOptions:r}=e,{store:a}=r,l=t.isOutline?{...o.Dk,visualVariableSizeScaleStops:n.visualVariableSizeOutlineScaleStops}:{visualVariableColor:t.colorLocked?null:n.visualVariableColor,visualVariableOpacity:n.visualVariableOpacity,visualVariableSizeMinMaxValue:n.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:n.visualVariableSizeScaleStops,visualVariableSizeStops:n.visualVariableSizeStops,visualVariableSizeUnitValue:n.visualVariableSizeUnitValue},c={uniforms:l,optionalAttributes:{zoomRange:!!i.scaleInfo}},u=!!(l.visualVariableSizeMinMaxValue||l.visualVariableSizeScaleStops||l.visualVariableSizeStops||l.visualVariableSizeUnitValue);return t.spriteRasterizationParam?v(a.ensureInstance(s.YS.texturedLine,c),t,u,i):y(a.ensureInstance(s.YS.line,c),t,u,i)}function g(t,e,{scaleInfo:i}){return{color:c(t.color)??[0,0,0,0],width:t.width,referenceWidth:t.referenceWidth,capType:t.cap,joinType:t.join,miterLimit:t.miterLimit,scaleInfo:i,hasSizeVV:e,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null}}function y(t,e,i,n){if(e.spriteRasterizationParam)throw new Error("InternalError: Sprite should not be defined");const r=g(e,i,n);return[t.createMeshInfo(r)]}function v(t,e,i,n){const{spriteRasterizationParam:r,scaleDash:s,sampleAlphaOnly:o}=e;if(!r)throw new Error("InternalError: Sprite should be defined");return[t.createMeshInfo({...g(e,i,n),shouldScaleDash:s??!1,shouldSampleAlphaOnly:o,isSDF:"CIMPictureStroke"!==r.resource.type,sprite:r})]}function x(t,e,i){const{uniforms:n,schemaOptions:r}=e,{store:o}=r;return b(o.ensureInstance(s.YS.text,{uniforms:{visualVariableColor:t.colorLocked?null:n.visualVariableColor,visualVariableOpacity:n.visualVariableOpacity,visualVariableRotation:n.visualVariableRotation,visualVariableSizeMinMaxValue:n.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:n.visualVariableSizeScaleStops,visualVariableSizeStops:n.visualVariableSizeStops,visualVariableSizeUnitValue:n.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!!i.scaleInfo,referenceSymbol:!1,clipAngle:!1}}),t,n,i)}function b(t,e,i,{scaleInfo:n,scaleExpression:r}){return[t.createMeshInfo({boxBackgroundColor:c(e.backgroundColor),boxBorderLineColor:c(e.borderLineColor),boxBorderLineSize:e.borderLineWidth??0,color:c(e.color)??[0,0,0,0],offsetX:e.offsetX,offsetY:e.offsetY,postAngle:e.angle,fontSize:e.size,referenceSize:e.referenceSize,decoration:e.decoration,haloColor:c(e.outlineColor)??[0,0,0,0],haloFontSize:e.outlineSize,lineWidth:e.lineWidth||512,lineHeightRatio:1,horizontalAlignment:e.horizontalAlignment??"center",verticalAlignment:e.verticalAlignment??"baseline",useCIMAngleBehavior:!1,glyphs:e.textRasterizationParam,scaleInfo:n,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null,placement:e.markerPlacement,transforms:e.transform,scaleFactor:r??1,minPixelBuffer:(0,o.j0)(i),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null,isLineLabel:!1})]}},80958:function(t,e,i){function n(t){return!!(t.visualVariableSizeMinMaxValue||t.visualVariableSizeScaleStops||t.visualVariableSizeStops||t.visualVariableSizeUnitValue||t.visualVariableSizeOutlineScaleStops)}function r(t){return!!t.visualVariableRotation}i.d(e,{I:function(){return n},N:function(){return r}})},7910:function(t,e,i){i.d(e,{L:function(){return n}});class n{destroy(){}}},12564:function(t,e,i){i.d(e,{K:function(){return x}});var n=i(39819),r=i(58941),s=i(40633),o=i(72952),a=i(67529),l=i(39686),c=i(7459),u=i(88413),h=i(40846);class d{constructor(t){this.data=t,this._referenceCount=0}increment(){this._referenceCount+=1}decrement(){this._referenceCount-=1}empty(){return 0===this._referenceCount}}class f{constructor(){this._freeIdsGenerationA=[],this._freeIdsGenerationB=[],this._idCounter=1,this._freeIds=this._freeIdsGenerationA,this._objectIdToDisplayId=new Map}createIdForObjectId(t){let e=this._objectIdToDisplayId.get(t);return e?e.increment():(e=new d((0,c.Ss)(this._getFreeId(),!1)),e.increment(),this._objectIdToDisplayId.set(t,e)),e.data}releaseIdForObjectId(t){const e=this._objectIdToDisplayId.get(t);e&&(e.decrement(),e.empty()&&(this._objectIdToDisplayId.delete(t),this._freeIds.push(e.data)))}releaseAll(){for(const t of this._objectIdToDisplayId.values())this._freeIds.push(t.data);this._objectIdToDisplayId.clear()}incrementGeneration(){this._freeIds=this._freeIds===this._freeIdsGenerationA?this._freeIdsGenerationB:this._freeIdsGenerationA}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}}var _=i(70132),p=i(85456);const m=()=>s.A.getLogger("esri.views.layers.2d.features.support.AttributeStore"),g=(m(),()=>null),y=(0,r.A)("esri-shared-array-buffer");(0,r.A)("esri-atomics");class v{constructor(t,e,i){this.size=0,this.texelSize=4,this.dirtyStart=0,this.dirtyEnd=0;const{pixelType:n,layout:r,textureOnly:s}=e;this.textureOnly=s||!1,this.pixelType=n,this.layout=r,this._resetRange(),this.size=t,this.isLocal=i,s||(this.data=this._initData(n,t))}get buffer(){return this.data?.buffer}unsetComponentAllTexels(t,e){const i=this.data;for(let n=0;n<this.size*this.size;n++)i[n*this.texelSize+t]&=~e;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(t,e){const i=this.data;for(let n=0;n<this.size*this.size;n++)i[n*this.texelSize+t]|=255&e;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponent(t,e,i){const n=this.data;for(const r of i)n[r*this.texelSize+t]|=e,this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,r)}setComponentTexel(t,e,i){this.data[i*this.texelSize+t]|=e,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)}unsetComponentTexel(t,e,i){this.data[i*this.texelSize+t]&=~e,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)}getData(t,e){const i=(0,c.Q4)(t);return this.data[i*this.texelSize+e]}setData(t,e,i){const n=(0,c.Q4)(t),r=1<<e;this.layout&r?null!=this.data&&(this.data[n*this.texelSize+e]=i,this.dirtyStart=Math.min(this.dirtyStart,n),this.dirtyEnd=Math.max(this.dirtyEnd,n)):m().error("mapview-attributes-store","Tried to set a value for a texel's readonly component")}expand(t){if(this.size=t,!this.textureOnly){const e=this._initData(this.pixelType,t),i=this.data;e.set(i),this.data=e}}toMessage(){const t=this.dirtyStart,e=this.dirtyEnd,i=this.texelSize;if(t>e)return null;this._resetRange();const n=!this.isLocal,r=this.pixelType,s=this.layout,o=this.data;return{start:t,end:e,data:n&&o.slice(t*i,(e+1)*i)||null,pixelType:r,layout:s}}_initData(t,e){const i=ArrayBuffer,n=(0,u.Qz)(t),r=new n(new i(e*e*4*n.BYTES_PER_ELEMENT));for(let t=0;t<r.length;t+=4)r[t+1]=255;return r}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}}class x{constructor(t){this._client=t,this._filters=[],this._blocks=new Array,this._attributeComputeInfo=null,this._abortController=new AbortController,this._size=l.TB,this._idsToHighlight=new Map,this._referencesScale=!1,this._referencesGeometry=!1,this._initialized=!1,this.version=0,this._idGenerator=new f,this._epoch=1}destroy(){this._abortController.abort()}_initialize(){if(null!=this._blockDescriptors)return;const t=p.ld.FLOAT;g(`Creating AttributeStore ${y?"with":"without"} shared memory`),this._blockDescriptors=[{pixelType:p.ld.UNSIGNED_BYTE,layout:1},{pixelType:p.ld.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:p.ld.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:t,layout:15},{pixelType:t,layout:15},{pixelType:t,layout:15},{pixelType:t,layout:15}],this._blocks=this._blockDescriptors.map((()=>null))}get referencesScale(){return this._referencesScale}get referencesGeometry(){return this._referencesGeometry}get hasHighlight(){return this._idsToHighlight.size>0}createDisplayIdForObjectId(t){return this._idGenerator.createIdForObjectId(t)}releaseDisplayIdForObjectId(t){return this._idGenerator.releaseIdForObjectId(t)}incrementDisplayIdGeneration(){this._idGenerator.incrementGeneration()}releaseAllIds(){this._idGenerator.releaseAll()}async update(t,e,i,n,s=0){const a=(0,o.Ui)(this._schema,t);if(this.version=s,a&&((0,r.A)("esri-2d-update-debug")&&console.debug(`Version[${s}] AttributeStore.update`,{changed:a}),this._schema=t,this._attributeComputeInfo=null,this._initialize(),null!=t))if(i&&(this._filters=await Promise.all(t.filters.map((t=>t?_.A.create({geometryType:i.geometryType,hasM:!1,hasZ:!1,timeInfo:i.timeInfo,fieldsIndex:i.fieldsIndex,spatialReference:n??i.spatialReference,filterJSON:t}):null)))),"subtype"!==t.type)this._attributeComputeInfo={isSubtype:!1,map:new Map},await Promise.all(t.bindings.map((async t=>{const i=await this._bind(e,t);this._referencesGeometry=this._referencesGeometry||(i?.referencesGeometry()??!1),this._referencesScale=this._referencesScale||(i?.referencesScale()??!1)})));else{this._attributeComputeInfo={isSubtype:!0,subtypeField:t.subtypeField,map:new Map},this._referencesScale=!1,this._referencesGeometry=!1;for(const i in t.bindings){const n=t.bindings[i];await Promise.all(n.map((async t=>{const n=await this._bind(e,t,parseInt(i,10));this._referencesGeometry=this._referencesGeometry||(n?.referencesGeometry()??!1),this._referencesScale=this._referencesScale||(n?.referencesScale()??!1)})))}}}setHighlight(t,e){const i=this._getBlock(0);i.unsetComponentAllTexels(0,(1<<a.M$.length)-1);for(const{displayId:e,highlightFlags:n}of t){if(null==e)continue;const t=(0,c.Q4)(e);i.setComponent(0,n,[t])}this._idsToHighlight.clear();for(const{objectId:e,highlightFlags:i}of t)this._idsToHighlight.set(e,i);for(const{objectId:t,highlightFlags:i}of e)this._idsToHighlight.set(t,i)}setData(t,e,i,n){const r=(0,c.Q4)(t);this._ensureSizeForTexel(r),this._getBlock(e).setData(t,i,n)}getData(t,e,i){return this._getBlock(e).getData(t,i)}getHighlightFlags(t){return this._idsToHighlight.get(t)||0}unsetAttributeData(t){const e=(0,c.Q4)(t);this._getBlock(0).setData(e,0,0)}setAttributeData(t,e,i){const n=(0,c.Q4)(t);this._ensureSizeForTexel(n),this._getBlock(0).setData(n,0,this.getFilterFlags(e));const r=this._attributeComputeInfo;let s=null;r&&(s=r.isSubtype?r.map.get(e.readAttribute(r.subtypeField)):r.map,s?.size&&s.forEach(((t,r)=>{const s=1*r%4,o=Math.floor(1*r/4),a=this._getBlock(o+l.dV.VV);let c=t.field?.read(e,i);t.valueRepresentation&&(c=function(t,e){if(!t||!e)return t;switch(e){case"radius":case"distance":return 2*t;case"diameter":case"width":return t;case"area":return Math.sqrt(t)}return t}(c,t.valueRepresentation)),(null===c||isNaN(c)||c===1/0||c===-1/0)&&(c=h.qM),a.setData(n,s,c)})))}get epoch(){return this._epoch}sendUpdates(){const t=this._blocks.map((t=>null!=t?t.toMessage():null)),e=this._getInitArgs();(0,r.A)("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.start"),this._client.update({initArgs:e,blockData:t,version:this.version,sendUpdateEpoch:this._epoch}),this._epoch+=1,(0,r.A)("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.end")}_ensureSizeForTexel(t){for(;t>=this._size*this._size;)if(this._expand())return}async _bind(t,e,i){const n=await t.createComputedField(e),{valueRepresentation:r}=e,s=this._attributeComputeInfo;if(s.isSubtype){const t=s.map.get(i)??new Map;t.set(e.binding,{field:n,valueRepresentation:r}),s.map.set(i,t)}else s.map.set(e.binding,{field:n,valueRepresentation:r});return n}_getInitArgs(){return this._initialized?null:(this._initialized=!0,this._getBlock(l.dV.Animation),this._getBlock(l.dV.GPGPU),{blockSize:this._size,blockDescriptors:this._blocks.map((t=>null!=t?{textureOnly:t.textureOnly,buffer:t.buffer,pixelType:t.pixelType}:null))})}_getBlock(t){const e=this._blocks[t];if(null!=e)return e;g(`Initializing AttributeBlock at index ${t}`);const i=new v(this._size,this._blockDescriptors[t],this._client.isLocal);return this._blocks[t]=i,this._initialized=!1,i}_expand(){if(this._size<this._schema.capabilities.maxTextureSize){const t=this._size<<=1;g("Expanding block size to",t,this._blocks);for(const e of this._blocks)e?.expand(t);return this._initialized=!1,this._size=t,0}return m().error(new n.A("mapview-limitations","Maximum number of onscreen features exceeded.")),-1}isVisible(t){return!!(this._getBlock(0).getData(t,0)&1<<a.M$.length)}getFilterFlags(t){let e=0;for(let i=0;i<this._filters.length;i++){const n=!!(1<<i),r=this._filters[i];e|=(!n||null==r||r.check(t)?1:0)<<i}let i=0;if(this._idsToHighlight.size){const e=t.getObjectId();i=this.getHighlightFlags(e)}return e<<a.M$.length|i}}},67057:function(t,e,i){i.d(e,{l:function(){return M}});var n=i(39819),r=i(40633),s=i(24761),o=i(7459),a=i(7910);class l extends a.L{constructor(t){super(),this._field=t}resize(t){throw new Error("Method not implemented.")}read(t,e){return t.readAttribute(this._field)}readWithDefault(t,e){return t.readAttribute(this._field)}referencesScale(){return!1}referencesGeometry(){return!1}}var c=i(50944),u=i(54547),h=i(89838);class d extends a.L{static async create(t,e){const i=await(0,u.Ad)(t,e.spatialReference,e.fields),n=(0,c.Wm)(t);return new d(i,n)}constructor(t,e){super(),this._compiled=t,this._cacheKey=e}resize(t){}read(t,e){return this.referencesScale()||"system"!==e.$view.timeZone?(0,h.V4)(this._compiled,t,e):this._readCached(t,e)}readWithDefault(t,e,i){return this.referencesScale()||"system"!==e.$view.timeZone?(0,h.OP)(this._compiled,t,e,i):this._readWithDefaultCached(t,e,i)}referencesScale(){return this._compiled?.referencesScale()??!1}referencesGeometry(){return this._compiled?.referencesGeometry()??!1}_readCached(t,e){if(t.setCache(this._cacheKey),t.hasCachedValue())return t.getCachedValue();const i=(0,h.V4)(this._compiled,t,e);return t.setCachedValue(i),i}_readWithDefaultCached(t,e,i){if(t.setCache(this._cacheKey),t.hasCachedValue())return t.getCachedValue();const n=(0,h.OP)(this._compiled,t,e,i);return t.setCachedValue(n),n}}var f=i(8289),_=i(2900),p=i(16645),m=i(53743),g=i(6361);class y extends a.L{static async create(t,e){const i=(0,g.lc)(t);return new y((t=>i.replaceAll(/{[^}]*}/g,(e=>{const i=e.slice(1,-1),n=t.metadata.fieldsIndex.get(i);if(null==n)return e;const r=t.readAttribute(i);return null==r?"":function(t,e){if(null==t)return"";const i=e.domain;if(i)if("codedValue"===i.type||"coded-value"===i.type){const e=t;for(const t of i.codedValues)if(t.code===e)return t.name}else if("range"===i.type){const{max:n,min:r}=(0,p.A5)(e),s=+t;if(null!=r&&null!=n&&r<=s&&s<=n)return i.name}let n=t;return(0,m.vE)(e)?n=(0,f.Yq)(n,(0,f.J2)("short-date")):(0,m.WA)(e)&&(n=(0,_.ZV)(+n)),n||""}(r,n)}))))}constructor(t){super(),this._evaluator=t}resize(t){}read(t,e){return this._evaluator(t)}readWithDefault(t,e,i){const n=this._evaluator(t);return(0,h.rZ)(n)?i:n}referencesScale(){return!1}referencesGeometry(){return!1}}class v extends a.L{constructor(t,e){super(),this._field=t,this._normalizationInfo=e}resize(t){throw new Error("Method not implemented.")}read(t,e){return this._readNormalized(t)}readWithDefault(t,e){return this._readNormalized(t)}referencesScale(){return!1}referencesGeometry(){return!1}_readNormalized(t){const e=t.readAttribute(this._field);if(null==e)return null;const{normalizationField:i,normalizationTotal:n,normalizationType:r}=this._normalizationInfo,s=t.readAttribute(i);switch(r??"esriNormalizeByField"){case"esriNormalizeByField":return s?s?e/s:void 0:null;case"esriNormalizeByLog":return Math.log(e)*Math.LOG10E;case"esriNormalizeByPercentOfTotal":return n?e/n*100:null}}}var x=i(45273),b=i(19886);const S=()=>r.A.getLogger("esri.views.2d.layers.features.support.ComputedAttributeStorage"),w=4294967295;function T(t,e,i){if(!(t.length>e))for(;t.length<=e;)t.push(i)}class M{constructor(t){this._numerics=[],this._strings=[],this._allocatedSize=256,this._bitsets=[],this._instanceIds=[],this._bounds=[],this._dirtyBitset=this.getBitset(this.createBitset()),this.compilationOptions=t}createBitset(){const t=this._bitsets.length;return this._bitsets.push(x.y.create(this._allocatedSize,o.KQ)),t+1}async createComputedField(t,e=!1){if(t.expression)try{if(!this.compilationOptions)throw new Error("InternalError: Compilation options not defined");return e?y.create(t.expression,this.compilationOptions):await d.create(t.expression,this.compilationOptions)}catch(e){const i=new n.A("featurelayer","Failed to compile arcade expression",{error:e,expression:t.expression});return S().error(i),null}if(t.normalizationType||t.normalizationField)return new v(t.field,t);if(t.field)return new l(t.field);const i=new n.A("featurelayer","Unable to create computed field. No expression or field found",{info:t});return S().error(i),null}async createWhereClause(t){return t?(0,b.$)(t,this.compilationOptions.fields):null}getBitset(t){return this._bitsets[t-1]}getComputedNumeric(t,e){return this.getComputedNumericAtIndex(t&o.KQ,0)}setComputedNumeric(t,e,i){return this.setComputedNumericAtIndex(t&o.KQ,i,0)}getComputedString(t,e){return this.getComputedStringAtIndex(t&o.KQ,0)}setComputedString(t,e,i){return this.setComputedStringAtIndex(t&o.KQ,0,i)}getComputedNumericAtIndex(t,e){const i=t&o.KQ;return this._ensureNumeric(e,i),this._numerics[e][i]}setComputedNumericAtIndex(t,e,i){const n=t&o.KQ;this._ensureNumeric(e,n),this._numerics[e][n]=i}getPackedChunkId(t){const e=t&o.KQ;return this._ensureInstanceId(e),this._instanceIds[e]}setPackedChunkId(t,e){const i=t&o.KQ;this._ensureInstanceId(i),this._instanceIds[i]=e}getComputedStringAtIndex(t,e){const i=t&o.KQ;return this._ensureString(e,i),this._strings[e][i]}setComputedStringAtIndex(t,e,i){const n=t&o.KQ;this._ensureString(e,n),this._strings[e][n]=i}getXMin(t){return this._bounds[4*(t&o.KQ)]}getYMin(t){return this._bounds[4*(t&o.KQ)+1]}getXMax(t){return this._bounds[4*(t&o.KQ)+2]}getYMax(t){return this._bounds[4*(t&o.KQ)+3]}setBounds(t,e,i=!1){const n=t&o.KQ;if(!i&&!this._dirtyBitset.has(t))return this._bounds[4*n]!==w;this._dirtyBitset.unset(t);const r=e.readGeometryWorldSpace();if(T(this._bounds,4*n+4,0),!r||!r.coords.length)return this._bounds[4*n]=w,this._bounds[4*n+1]=w,this._bounds[4*n+2]=w,this._bounds[4*n+3]=w,!1;let s=1/0,a=1/0,l=-1/0,c=-1/0;return r.forEachVertex(((t,e)=>{s=Math.min(s,t),a=Math.min(a,e),l=Math.max(l,t),c=Math.max(c,e)})),this._bounds[4*n]=s,this._bounds[4*n+1]=a,this._bounds[4*n+2]=l,this._bounds[4*n+3]=c,!0}getBounds(t,e){const i=this.getXMin(e),n=this.getYMin(e),r=this.getXMax(e),o=this.getYMax(e);return(0,s.BI)(t,i,n,r,o),i!==w}_ensureNumeric(t,e){this._numerics[t]||(this._numerics[t]=[]),T(this._numerics[t],e,0)}_ensureInstanceId(t){T(this._instanceIds,t,0)}_ensureString(t,e){this._strings[t]||(this._strings[t]=[]),T(this._strings[t],e,null)}}},37069:function(t,e,i){i.d(e,{G:function(){return r}});var n=i(7910);class r extends n.L{constructor(t){super(),this._value=t}resize(t){}read(t,e){return this._value}readWithDefault(t,e,i){return this._value}referencesScale(){return!1}referencesGeometry(){return!1}}},70132:function(t,e,i){i.d(e,{A:function(){return f}});var n=i(39819),r=i(40633),s=i(87416),o=i(35068),a=i(20932),l=i(62512),c=i(20973),u=i(7926),h=i(6578),d=i(19886);class f{constructor(t){this._geometryBounds=(0,s.vt)(),this._idToVisibility=new Map,this._serviceInfo=t}static async create(t){const e=new f(t);return await e.update(t.filterJSON,t.spatialReference),e}get hash(){return this._hash}check(t){return this._applyFilter(t)}clear(){const t=this._resetAllHiddenIds();return this.update(),{show:t,hide:[]}}invalidate(){this._idToVisibility.forEach(((t,e)=>{this._idToVisibility.set(e,0)}))}setKnownIds(t){for(const e of t)this._idToVisibility.set(e,1)}setTrue(t){const e=[],i=[],n=new Set(t);return this._idToVisibility.forEach(((t,r)=>{const s=!!(1&this._idToVisibility.get(r)),o=n.has(r);!s&&o?e.push(r):s&&!o&&i.push(r),this._idToVisibility.set(r,o?3:0)})),{show:e,hide:i}}createQuery(){const{geometry:t,spatialRel:e,where:i,timeExtent:n,objectIds:r}=this;return u.A.fromJSON({geometry:t,spatialRel:e,where:i,timeExtent:n,objectIds:r})}async update(t,e){this._hash=JSON.stringify(t);const i=await(0,a.T2)(t,null,e);await Promise.all([this._setGeometryFilter(i),this._setIdFilter(i),this._setAttributeFilter(i),this._setTimeFilter(i)])}async _setAttributeFilter(t){if(!t?.where)return this._clause=null,void(this.where=null);this._clause=await(0,d.$)(t.where,this._serviceInfo.fieldsIndex),this.where=t.where}_setIdFilter(t){this._idsToShow=t?.objectIds&&new Set(t.objectIds),this._idsToHide=t?.hiddenIds&&new Set(t.hiddenIds),this.objectIds=t?.objectIds}async _setGeometryFilter(t){if(!t?.geometry)return this._spatialQueryOperator=null,this.geometry=null,void(this.spatialRel=null);const e=t.geometry,i=t.spatialRel||"esriSpatialRelIntersects",n=await(0,l.xt)(i,e,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);(0,o.Rg)(this._geometryBounds,e),this._spatialQueryOperator=n,this.geometry=e,this.spatialRel=i}_setTimeFilter(t){if(this.timeExtent=this._timeOperator=null,t?.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=t.timeExtent,this._timeOperator=(0,c.I)(this._serviceInfo.timeInfo,t.timeExtent,h.Z.Shared);else{const e=new n.A("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",t.timeExtent);r.A.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter").error(e)}}_applyFilter(t){return this._filterByGeometry(t)&&this._filterById(t)&&this._filterByTime(t)&&this._filterByExpression(t)}_filterByExpression(t){return!this.where||this._clause(t)}_filterById(t){return(!this._idsToHide?.size||!this._idsToHide.has(t.getObjectId()))&&(!this._idsToShow?.size||this._idsToShow.has(t.getObjectId()))}_filterByGeometry(t){if(!this.geometry)return!0;const e=t.readGeometryWorldSpace();return!!e&&this._spatialQueryOperator(e)}_filterByTime(t){return null==this._timeOperator||this._timeOperator(t)}_resetAllHiddenIds(){const t=[];return this._idToVisibility.forEach(((e,i)=>{1&e||(this._idToVisibility.set(i,1),t.push(i))})),t}}},24231:function(t,e,i){i.d(e,{h:function(){return o},i:function(){return s}});var n=i(57165),r=i(7103);class s{static minimal(t,e,i=[]){return new s({geometryType:t,fields:i,objectIdField:e,subtypes:null,subtypeField:null,types:null,globalIdField:null,spatialReference:null,timeInfo:null,timeReferenceUnknownClient:null,typeIdField:null})}constructor(t){this._options=t,this._fieldsIndex="fieldsIndex"in t?r.A.fromJSON(t.fieldsIndex):new r.A(t.fields),t.spatialReference&&(this._spatialReference=n.A.fromJSON(t.spatialReference)),this._arcadeSchema={fields:this.fieldsIndex.fields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,objectIdField:this.objectIdField,globalIdField:this._options.globalIdField,spatialReference:this._spatialReference,timeInfo:this._options.timeInfo,typeIdField:this._options.typeIdField??void 0,types:this._options.types??void 0,subtypeField:this._options.subtypeField,subtypes:this._options.subtypes??void 0}}get fieldsIndex(){return this._fieldsIndex}get geometryType(){return this._options.geometryType}get subtypeField(){return this._options.subtypeField}get timeInfo(){return this._options.timeInfo}get objectIdField(){return this._options.objectIdField}get globalIdField(){return this._options.globalIdField}get arcadeSchema(){return this._arcadeSchema}get spatialReference(){return this._spatialReference}get timeReferenceUnknownClient(){return this._options.timeReferenceUnknownClient}}class o extends s{static create(t){return new o({fields:[],objectIdField:"uid",geometryType:null,spatialReference:t,globalIdField:null,subtypeField:null,subtypes:null,timeInfo:null,typeIdField:null,types:null,timeReferenceUnknownClient:null})}}},87036:function(t,e,i){i.d(e,{P:function(){return r}});var n=i(45273);class r{constructor(t){this._valid=n.y.create(t),this._data=new Array(t)}has(t){return this._valid.has(t)}set(t,e){this._valid.set(t),this._data[t]=e}get(t){return this._data[t]}}},63139:function(t,e,i){i.d(e,{Y:function(){return R}}),i(50917);var n=i(9688),r=i(58941),s=i(95929),o=i(42042),a=i(70891),l=i(33134),c=i(24761),u=i(30804),h=i(40302),d=i(58081),f=i(65215),_=i(76613),p=i(21168),m=i(87036),g=i(45273),y=i(74697);const v=(0,r.A)("featurelayer-simplify-thresholds")??[.5,.5,.5,.5],x=v[0],b=v[1],S=v[2],w=v[3],T=(0,r.A)("featurelayer-simplify-payload-size-factors")??[1,2,4],M=T[0],P=T[1],E=T[2],A=(0,r.A)("featurelayer-simplify-mobile-factor")??2,C=(0,r.A)("esri-mobile"),I=4294967295;class R{constructor(t){this.metadata=t,this.type="FeatureSetReader",this._deleted=null,this._joined=[],this._objectIdToIndex=null,this._boundsBuffer=[],this._caches=new Map,this.arcadeDeclaredClass="esri.arcade.Feature",this._contextTimeZone=null}get isEmpty(){return null!=this._deleted&&this._deleted.countSet()===this.getSize()}getAreaSimplificationThreshold(t,e){let i=1;const n=C?A:1;e>4e6?i=E*n:e>1e6?i=P*n:e>5e5?i=M*n:e>1e5&&(i=n);let r=0;return t>4e3?r=w*i:t>2e3?r=S*i:t>100?r=b:t>15&&(r=x),r}parseTimestampOffset(t){return t}getBounds(t){if(function(t,e,i){if(!(t.length>e))for(;t.length<=e;)t.push(0)}(this._boundsBuffer,4*this.getIndex()+4),this.getBoundsXMin()===I)return!1;if(0===this.getBoundsXMin()){const e=this.readGeometryWorldSpace();if(!e)return this.setBoundsXMin(I),!1;let i=1/0,n=1/0,r=-1/0,s=-1/0;return e.forEachVertex(((t,e)=>{i=Math.min(i,t),n=Math.min(n,e),r=Math.max(r,t),s=Math.max(s,e)})),this.setBoundsXMin(i),this.setBoundsYMin(n),this.setBoundsXMax(r),this.setBoundsYMax(s),(0,c.BI)(t,i,n,r,s),!0}const e=this.getBoundsXMin(),i=this.getBoundsYMin(),n=this.getBoundsXMax(),r=this.getBoundsYMax();return(0,c.BI)(t,e,i,n,r),!0}getBoundsXMin(){return this._boundsBuffer[4*this.getIndex()]}setBoundsXMin(t){this._boundsBuffer[4*this.getIndex()]=t}getBoundsYMin(){return this._boundsBuffer[4*this.getIndex()+1]}setBoundsYMin(t){this._boundsBuffer[4*this.getIndex()+1]=t}getBoundsXMax(){return this._boundsBuffer[4*this.getIndex()+2]}setBoundsXMax(t){this._boundsBuffer[4*this.getIndex()+2]=t}getBoundsYMax(){return this._boundsBuffer[4*this.getIndex()+3]}setBoundsYMax(t){this._boundsBuffer[4*this.getIndex()+3]=t}readAttributeAsTimestamp(t){const e=this.readAttribute(t);return"string"==typeof e?new Date(e).getTime():"number"==typeof e||null==e?e:null}readAttribute(t,e=!1){const i=this._readAttribute(t,e);if(void 0!==i)return i;for(const i of this._joined){i.setIndex(this.getIndex());const n=i._readAttribute(t,e);if(void 0!==n)return n}}readAttributes(){const t=this._readAttributes();for(const e of this._joined){e.setIndex(this.getIndex());const i=e._readAttributes();for(const e of Object.keys(i))t[e]=i[e]}return t}joinAttributes(t){this._joined.push(t)}removeIds(t){if(null==this._objectIdToIndex){const t=new Map,e=this.getCursor();for(;e.next();){const i=e.getObjectId();(0,s.Lw)(i),t.set(i,e.getIndex())}this._objectIdToIndex=t}const e=this._objectIdToIndex;for(const i of t.values())e.has(i)&&this._removeAtIndex(e.get(i))}readOptimizedFeatureWorldSpace(){const t=this.readGeometryWorldSpace(),e=this.readAttributes(),i=this.readCentroidWorldSpace(),n=new f.Om(t,e,i);return n.objectId=this.getObjectId(),n.displayId=this.getDisplayId(),n}readLegacyFeatureForDisplay(){const t=this.readCentroidForDisplay();return{attributes:this.readAttributes(),geometry:this.readLegacyGeometryForDisplay(),centroid:(t&&{x:t.coords[0],y:t.coords[1]})??null}}readLegacyFeatureWorldSpace(){const t=this.readCentroidWorldSpace();return{attributes:this.readAttributes(),geometry:this._readLegacyGeometryWorldSpace(),centroid:(t&&{x:t.coords[0],y:t.coords[1]})??null}}readLegacyGeometryForDisplay(){const t=this.readGeometryForDisplay();return(0,d.zv)(t,this.geometryType,!1,!1)}readXForDisplay(){return this._readX()}readYForDisplay(){return this._readY()}readXWorldSpace(){const t=this._readX(),e=this.getInTransform();return null==e?t:t*e.scale[0]+e.translate[0]}readYWorldSpace(){const t=this._readY(),e=this.getInTransform();return null==e?t:e.translate[1]-t*e.scale[1]}readGeometryForDisplay(){const t=this._readGeometryDeltaDecoded(!0);if(!t){const t=this._createGeometryFromServerCentroid();return t?t.deltaDecode():null}return t}readGeometryWorldSpace(){let t=this._readGeometry();if(t||(t=this._createGeometryFromServerCentroid()),!t)return null;const e=t.clone(),i=this.getInTransform();return null!=i&&(0,d.Ch)(e,e,this.hasZ,this.hasM,i),e}readCentroidForDisplay(){const t=this.readGeometryForDisplay();return t?this._computeDisplayCentroid(t):this._readServerCentroid()}readCentroidWorldSpace(){const t=this.readGeometryForDisplay(),e=t?this._computeDisplayCentroid(t):this._readServerCentroid();if(!e)return null;const i=e.clone(),n=this.getInTransform();return null!=n&&(0,d.Ch)(i,i,this.hasZ,this.hasM,n),i}setCache(t){let e=this._caches.get(t);null==e&&(e=new m.P(this.getSize()),this._caches.set(t,e)),this._activeCache=e}setCachedValue(t){this._activeCache.set(this.getIndex(),t)}hasCachedValue(){return this._activeCache.has(this.getIndex())}getCachedValue(){return this._activeCache.get(this.getIndex())}_readGeometryDeltaDecoded(t){const e=this._readGeometry(t);return"esriGeometryPoint"!==this.geometryType&&e&&this.getInTransform()?e.deltaDecode():e}get contextTimeZone(){return this._contextTimeZone}set contextTimeZone(t){this._contextTimeZone=t}readArcadeFeature(){return this}hasField(t){return this.fields.has(t)||this._joined.some((e=>e.hasField(t)))}geometry(){const t=this.readGeometryWorldSpace(),e=(0,d.zv)(t,this.geometryType,this.hasZ,this.hasM),i=(0,y.rS)(e);if(i){if(!this.metadata.spatialReference)throw new Error("InternalError: Expected spatial reference to be defined");i.spatialReference=this.metadata.spatialReference}return i}autocastArcadeDate(t,e){return e&&e instanceof Date?this.isUnknownDateTimeField(t)?n.lY.unknownDateJSToArcadeDate(e):n.lY.dateJSAndZoneToArcadeDate(e,this.contextTimeZone??p.qU):e}isUnknownDateTimeField(t){return this.metadata.fieldsIndex.getTimeZone(t)===p.L5}field(t){let e=this.fields.get(t);if(e)switch(e.type){case"date-only":case"esriFieldTypeDateOnly":return o.n.fromReader(this.readAttribute(t,!1));case"time-only":case"esriFieldTypeTimeOnly":return a.k.fromReader(this.readAttribute(t,!1));case"esriFieldTypeTimestampOffset":case"timestamp-offset":return n.lY.fromReaderAsTimeStampOffset(this.readAttribute(t,!1));case"date":case"esriFieldTypeDate":return this.autocastArcadeDate(t,this.readAttribute(t,!0));default:return this.readAttribute(t,!1)}for(const i of this._joined)if(i.setIndex(this.getIndex()),e=i.fields.get(t),e)switch(e.type){case"date-only":case"esriFieldTypeDateOnly":return o.n.fromReader(i._readAttribute(t,!1));case"time-only":case"esriFieldTypeTimeOnly":return a.k.fromReader(i._readAttribute(t,!1));case"esriFieldTypeTimestampOffset":case"timestamp-offset":return n.lY.fromReaderAsTimeStampOffset(i._readAttribute(t,!1));case"date":case"esriFieldTypeDate":return this.autocastArcadeDate(t,i._readAttribute(t,!0));default:return this.readAttribute(t,!1)}throw new Error(`Field ${t} does not exist`)}setField(t,e){throw new Error("Unable to update feature attribute values, feature is readonly")}keys(){return this.fields.fields.map((t=>t.name))}castToText(t=!1){if(!t)return JSON.stringify(this.readLegacyFeatureForDisplay());const e=this.readLegacyFeatureForDisplay();if(!e)return JSON.stringify(null);const i={geometry:e.geometry,attributes:{...e.attributes??{}}};for(const t in i.attributes){const e=i.attributes[t];e instanceof Date&&(i.attributes[t]=e.getTime())}return JSON.stringify(i)}gdbVersion(){return null}fullSchema(){return this.metadata.arcadeSchema}castAsJson(t=null){return{attributes:this._readAttributes(),geometry:!0===t?.keepGeometryType?this.geometry():this.geometry()?.toJSON()??null}}castAsJsonAsync(t=null,e=null){return Promise.resolve(this.castAsJson(e))}_getExists(){return null==this._deleted||!this._deleted.has(this.getIndex())}_computeDisplayCentroid(t){if(null==this.getInTransform())return(0,h.Q)(new _.A,t,this.hasM,this.hasZ);const e=l.z.fromOptimized(t,this.geometryType);e.yFactor*=-1;const i=(0,u.d)(e);return i?(i[1]*=-1,new _.A([],i)):null}copyInto(t){t._joined=this._joined,t._deleted=this._deleted,t._objectIdToIndex=this._objectIdToIndex,t._boundsBuffer=this._boundsBuffer,t._activeCache=this._activeCache,t._caches=this._caches,t._contextTimeZone=this._contextTimeZone}_readLegacyGeometryWorldSpace(){const t=this.readGeometryWorldSpace();return(0,d.zv)(t,this.geometryType,!1,!1)}_createGeometryFromServerCentroid(){const t=this._readServerCentroid();if(!t)return null;const[e,i]=t.coords;return this._createQuantizedExtrudedGeometry(e,i)}_createQuantizedExtrudedGeometry(t,e){return"esriGeometryPolyline"===this.geometryType?this._createQuantizedExtrudedLine(t,e):this._createQuantizedExtrudedQuad(t,e)}_createQuantizedExtrudedQuad(t,e){return new _.A([5],[t-1,e,1,-1,1,1,-1,1,-1,-1])}_createQuantizedExtrudedLine(t,e){return new _.A([2],[t-1,e+1,1,-1])}_removeAtIndex(t){null==this._deleted&&(this._deleted=g.y.create(this.getSize())),this._deleted.set(t)}}},45273:function(t,e,i){i.d(e,{y:function(){return n}});class n{static fromBuffer(t,e){return new n(t,e)}static create(t,e=4294967295){const i=new Uint32Array(Math.ceil(t/32));return new n(i,e)}constructor(t,e){this._mask=0,this._buf=t,this._mask=e}_getIndex(t){return Math.floor(t/32)}has(t){const e=this._mask&t;return!!(this._buf[this._getIndex(e)]&1<<e%32)}hasRange(t,e){let i=t,n=e;for(;i%32&&i!==n;){if(this.has(i))return!0;i++}for(;n%32&&i!==n;){if(this.has(i))return!0;n--}if(i===n)return!1;for(let t=i/32;t!==n/32;t++)if(this._buf[t])return!0;return!1}set(t){const e=this._mask&t,i=this._getIndex(e),n=1<<e%32;this._buf[i]|=n}setRange(t,e){let i=t,n=e;for(;i%32&&i!==n;)this.set(i++);for(;n%32&&i!==n;)this.set(n--);if(i!==n)for(let t=i/32;t!==n/32;t++)this._buf[t]=4294967295}unset(t){const e=this._mask&t,i=this._getIndex(e),n=1<<e%32;this._buf[i]&=4294967295^n}resize(t){const e=this._buf,i=new Uint32Array(Math.ceil(t/32));i.set(e),this._buf=i}or(t){for(let e=0;e<this._buf.length;e++)this._buf[e]|=t._buf[e];return this}and(t){for(let e=0;e<this._buf.length;e++)this._buf[e]&=t._buf[e];return this}xor(t){for(let e=0;e<this._buf.length;e++)this._buf[e]^=t._buf[e];return this}ior(t){for(let e=0;e<this._buf.length;e++)this._buf[e]|=~t._buf[e];return this}iand(t){for(let e=0;e<this._buf.length;e++)this._buf[e]&=~t._buf[e];return this}ixor(t){for(let e=0;e<this._buf.length;e++)this._buf[e]^=~t._buf[e];return this}any(){for(let t=0;t<this._buf.length;t++)if(this._buf[t])return!0;return!1}copy(t){for(let e=0;e<this._buf.length;e++)this._buf[e]=t._buf[e];return this}clone(){return new n(this._buf.slice(),this._mask)}clear(){for(let t=0;t<this._buf.length;t++)this._buf[t]=0;return this}forEachSet(t){for(let e=0;e<this._buf.length;e++){let i=this._buf[e],n=32*e;if(i)for(;i;)1&i&&t(n),i>>>=1,n++}}countSet(){let t=0;return this.forEachSet((e=>{t++})),t}}},51008:function(t,e,i){i.d(e,{R:function(){return u},e:function(){return d}});var n=i(39819),r=i(40633),s=i(13520),o=i(2746);const a=8,l=a-2,c=()=>r.A.getLogger("esri.views.2d.layers.features.support.rendererUtils");function u(t){return t.map((t=>function(t){return("size"===t.type||"color"===t.type||"opacity"===t.type)&&null!=t.stops}(t)?function(t){return t.stops=function(t,e){return e.length<=a?e:(c().warn(`Found ${e.length} Visual Variable stops, but MapView only supports ${a}. Displayed stops will be simplified.`),e.length>2*a?function(t,e){const[i,...n]=e,r=n.pop(),o=n[0].value,a=n[n.length-1].value,c=(a-o)/l,u=[];for(let i=o;i<a;i+=c){let r=0;for(;i>=n[r].value;)r++;const o=n[r],a=e[r-1],l=i-a.value,c=o.value===a.value?1:l/(o.value-a.value);if("color"===t){const t=n[r],s=e[r-1],o=t.color.clone();o.r=h(s.color.r,o.r,c),o.g=h(s.color.g,o.g,c),o.b=h(s.color.b,o.b,c),o.a=h(s.color.a,o.a,c),u.push({value:i,color:o,label:t.label})}else if("size"===t){const t=n[r],o=e[r-1],a=(0,s.cr)(t.size),l=h((0,s.cr)(o.size),a,c);u.push({value:i,size:l,label:t.label})}else{const t=n[r],s=h(e[r-1].opacity,t.opacity,c);u.push({value:i,opacity:s,label:t.label})}}return[i,...u,r]}(t,e):function(t){const[e,...i]=t,n=i.pop();for(;i.length>l;){let t=0,e=0;for(let n=1;n<i.length;n++){const r=i[n-1],s=i[n],o=Math.abs(s.value-r.value);o>e&&(e=o,t=n)}i.splice(t,1)}return[e,...i,n]}(e))}(t.type,t.stops??[]),t}(t.clone()):t))}function h(t,e,i){return(1-i)*t+i*e}function d(t){if(!t)return!0;switch(t.type){case"dot-density":break;case"heatmap":if(!function(){const{supportsColorBufferFloat:t,supportsColorBufferFloatBlend:e,supportsColorBufferHalfFloat:i}=(0,o.C)();return t&&e||i}()){const t=(0,o.C)(),e=["supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter((e=>!t[e])).join(", ");return c().errorOnce(new n.A("webgl-missing-extension",`Missing WebGL2 requirements for Heatmap: ${e}`)),!1}}return!0}},19886:function(t,e,i){i.d(e,{$:function(){return l}});var n=i(39819),r=i(40633),s=i(98737);const o=()=>r.A.getLogger("esri.views.2d.layers.features.support.whereUtils"),a={getAttribute:(t,e)=>t.readAttribute(e)};async function l(t,e){try{const i=await(0,s.G)(t,e);if(!i.isStandardized){const t=new n.A("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",i);o().error(t)}return e=>{const n=e.readArcadeFeature();try{return i.testFeature(n,a)}catch(e){return o().warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",t),!0}}}catch(e){return o().warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",t),t=>!0}}},64853:function(t,e,i){i.d(e,{f:function(){return P}});var n=i(95929),r=i(53838),s=i(28230),o=i(92543),a=i(78119),l=i(86329);let c=0;function u(t,e){return new o.c((0,l.U)(c++),t,e)}const h={visualVariableColor:null,visualVariableOpacity:null,visualVariableSizeMinMaxValue:null,visualVariableSizeScaleStops:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null,visualVariableRotation:null,visualVariableSizeOutlineScaleStops:null};class d{constructor(){this.instances={fill:u(a.YS.fill,{uniforms:h,optionalAttributes:{zoomRange:!0}}),marker:u(a.YS.marker,{uniforms:h,optionalAttributes:{zoomRange:!0}}),line:u(a.YS.line,{uniforms:h,optionalAttributes:{zoomRange:!0}}),text:u(a.YS.text,{uniforms:h,optionalAttributes:{zoomRange:!0,referenceSymbol:!1,clipAngle:!1}}),complexFill:u(a.YS.complexFill,{uniforms:h,optionalAttributes:{zoomRange:!0}}),texturedLine:u(a.YS.texturedLine,{uniforms:h,optionalAttributes:{zoomRange:!0}})},this._instancesById=Object.values(this.instances).reduce(((t,e)=>(t.set(e.instanceId,e),t)),new Map)}getInstance(t){return this._instancesById.get(t)}}var f=i(44705),_=i(25090),p=i(14583),m=i(43274),g=i(65298),y=i(77515),v=i(88413),x=i(86305),b=i(85456),S=i(81438);const w=Math.PI/180;class T extends y.q{constructor(t){super(),this._program=null,this._vao=null,this._vertexBuffer=null,this._indexBuffer=null,this._dvsMat3=(0,_.vt)(),this._localOrigin={x:0,y:0},this._getBounds=t}destroy(){this._vao&&(this._vao.dispose(),this._vao=null,this._vertexBuffer=null,this._indexBuffer=null),this._program=(0,n.WD)(this._program)}doRender(t){const{context:e}=t,i=this._getBounds();if(i.length<1)return;this._createShaderProgram(e),this._updateMatricesAndLocalOrigin(t),this._updateBufferData(e,i),e.setBlendingEnabled(!0),e.setDepthTestEnabled(!1),e.setStencilWriteMask(0),e.setStencilTestEnabled(!1),e.setBlendFunction(b.dn.ONE,b.dn.ONE_MINUS_SRC_ALPHA),e.setColorMask(!0,!0,!0,!0);const n=this._program;e.bindVAO(this._vao),e.useProgram(n),n.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),e.gl.lineWidth(1),e.drawElements(b.WR.LINES,8*i.length,b.pe.UNSIGNED_INT,0),e.bindVAO()}_createTransforms(){return{displayViewScreenMat3:(0,_.vt)()}}_createShaderProgram(t){this._program||(this._program=t.programCache.acquire("precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos = u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position = vec4(pos.xy, 0.0, 1.0);\n        }","precision mediump float;\n      void main() {\n        gl_FragColor = vec4(0.75, 0.0, 0.0, 0.75);\n      }",M().attributes))}_updateMatricesAndLocalOrigin(t){const{state:e}=t,{displayMat3:i,size:n,resolution:r,pixelRatio:s,rotation:o,viewpoint:a}=e,l=w*o,{x:c,y:u}=a.targetGeometry,h=(0,g.mT)(c,e.spatialReference);this._localOrigin.x=h,this._localOrigin.y=u;const d=s*n[0],_=s*n[1],y=r*d,v=r*_,x=(0,f.D_)(this._dvsMat3);(0,f.lw)(x,x,i),(0,f.Tl)(x,x,(0,p.fA)(d/2,_/2)),(0,f.hs)(x,x,(0,m.fA)(n[0]/y,-_/v,1)),(0,f.e$)(x,x,-l)}_updateBufferData(t,e){const{x:i,y:n}=this._localOrigin,r=8*e.length,s=new Float32Array(r),o=new Uint32Array(8*e.length);let a=0,l=0;for(const t of e)t&&(s[2*a]=t[0]-i,s[2*a+1]=t[1]-n,s[2*a+2]=t[0]-i,s[2*a+3]=t[3]-n,s[2*a+4]=t[2]-i,s[2*a+5]=t[3]-n,s[2*a+6]=t[2]-i,s[2*a+7]=t[1]-n,o[l]=a+0,o[l+1]=a+3,o[l+2]=a+3,o[l+3]=a+2,o[l+4]=a+2,o[l+5]=a+1,o[l+6]=a+1,o[l+7]=a+0,a+=4,l+=8);if(this._vertexBuffer?this._vertexBuffer.setData(s.buffer):this._vertexBuffer=x.g.createVertex(t,b._U.DYNAMIC_DRAW,s.buffer),this._indexBuffer?this._indexBuffer.setData(o):this._indexBuffer=x.g.createIndex(t,b._U.DYNAMIC_DRAW,o),!this._vao){const e=M();this._vao=new S.Z(t,e.attributes,e.bufferLayouts,{geometry:this._vertexBuffer},this._indexBuffer)}}}const M=()=>(0,v.ES)("bounds",{geometry:[{location:0,name:"a_position",count:2,type:b.pe.FLOAT}]});class P extends r.j{constructor(t){super(t),this._instanceStore=new d,this.checkHighlight=()=>!0}destroy(){super.destroy(),this._boundsRenderer=(0,n.pR)(this._boundsRenderer)}get instanceStore(){return this._instanceStore}enableRenderingBounds(t){this._boundsRenderer=new T(t),this.requestRender()}get hasHighlight(){return this.checkHighlight()}onTileData(t,e){t.onMessage(e),this.contains(t)||this.addChild(t),this.requestRender()}_renderChildren(t,e){t.selection=e;for(const e of this.children){if(!e.visible)continue;const i=e.getDisplayList(this._instanceStore,s.ch.STRICT_ORDER);i?.render(t)}}}},17215:function(t,e,i){i.d(e,{A:function(){return o}});var n=i(28230),r=i(64853),s=i(30488);class o extends r.f{renderChildren(t){for(const e of this.children)e.setTransform(t.state);if(super.renderChildren(t),this.attributeView.update(),this.children.some((t=>t.hasData))){switch(t.drawPhase){case n.S5.MAP:this._renderChildren(t,n.RI.All);break;case n.S5.HIGHLIGHT:this.hasHighlight&&this._renderHighlight(t)}this._boundsRenderer&&this._boundsRenderer.doRender(t)}}_renderHighlight(t){(0,s.lB)(t,!1,(t=>{this._renderChildren(t,n.RI.Highlight)}))}}},56625:function(t,e,i){i.d(e,{A:function(){return J}});var n=i(53804),r=i(83525),s=i(50659),o=i(58941),a=i(88781),l=i(95929),c=i(60539),u=i(28181),h=i(23502),d=(i(40633),i(65953)),f=i(87416),_=i(74697),p=i(7103),m=i(57176),g=i(67895),y=i(74661),v=i(39686),x=i(27657),b=i(80308),S=i(93561),w=i(44327),T=i(81672),M=i(29739),P=i(12564),E=i(67057),A=i(24231),C=i(72228),I=i(58081),R=i(76613),O=i(63139);class F extends O.Y{static from(t,e,i){return new F(t,e,i)}constructor(t,e,i){super(i),this._items=t,this._tile=e,this._index=-1,this._cachedGeometry=null;const n=e.lod;n.wrap&&(this._wrappingInfo={worldSizeX:n.worldSize[0]})}get _current(){return this._items[this._index]}getItem(){return this._current}getZOrder(){return this._current.zOrder}getMeshWriters(){return this._current.symbolResource?.symbolInfo.meshWriters??[]}hasField(t){return null!=this._current.attributes[t]}field(t){return this.readAttribute(t)}get geometryType(){const t=(0,_.$B)(this._current.geometry);return"esriGeometryPoint"===t?"esriGeometryMultipoint":t}getCursor(){return this.copy()}copy(){const t=new F(this._items,this._tile,this.metadata);return this.copyInto(t),t}copyInto(t){super.copyInto(t),t._cachedGeometry=this._cachedGeometry,t._index=this._index}get fields(){throw new Error("Fields reading not supported to graphics.")}get hasFeatures(){return!!this._items.length}get hasNext(){return this._index+1<this._items.length}get exceededTransferLimit(){throw new Error("InternalError: exceededTransferLimit not implemented for graphics.")}get hasZ(){return!1}get hasM(){return!1}getInTransform(){return this._tile.transform}getSize(){return this._items.length}getAttributeHash(){let t="";for(const e in this._current.attributes)t+=this._current.attributes[e];return t}getObjectId(){return this._items[this._index].objectId}getDisplayId(){return this._current.displayId}setDisplayId(t){throw new Error("InternalError: Setting displayId not supported for graphics.")}setIndex(t){this._index=t}getIndex(){return this._index}next(){for(this._cachedGeometry=null;++this._index<this._items.length&&!this._getExists(););return this._index<this._items.length}readGeometryArea(){throw new Error("InternalError: readGeometryArea not supported for graphics.")}_readGeometry(){if(!this._cachedGeometry){let t=(0,I.Ux)(this._current.projectedGeometry,this.hasZ,this.hasM);if("esriGeometryPolyline"===this.geometryType&&(t=(0,I.kz)(new R.A,t,this.hasZ,this.hasM,this.geometryType,this._tile.transform.scale[0])),this._cachedGeometry=(0,I.Nl)(new R.A,t,this.hasZ,this.hasM,this.geometryType,this._tile.transform),!this._cachedGeometry)return null;this._wrapGeometry(this._cachedGeometry)}return this._cachedGeometry}_wrapGeometry(t){if(!this._wrappingInfo)return;const{worldSizeX:e}=this._wrappingInfo;if(t.isPoint)return 1===e?(t.coords.push(v.CQ,0),t.coords.push(2*-v.CQ,0),void t.lengths.push(3)):2===e?(t.coords.push(2*v.CQ,0),t.coords.push(4*-v.CQ,0),void t.lengths.push(3)):void this._wrapVertex(t.coords,0,2,e);if("esriGeometryMultipoint"!==this.geometryType);else{if(1===e){const e=t.coords.slice();e[0]-=512;const i=t.coords.slice();i[0]+=512,t.coords.push(...e,...i);const n=t.lengths[0];return void t.lengths.push(n,n)}this._wrapVertex(t.coords,0,2,e)}}_wrapVertex(t,e,i,n){const r=e*i,s=t[r];s<-v.CQ*(n-2)?t[r]=s+v.CQ*n:s>v.CQ*(n-1)&&(t[r]=s-v.CQ*n)}_readX(){const t=this._readGeometry();return null!=t?t.coords[0]:0}_readY(){const t=this._readGeometry();return null!=t?t.coords[1]:0}_readServerCentroid(){switch(this.geometryType){case"esriGeometryPolygon":{const t=(0,C.l8)(this._current.projectedGeometry),e=new R.A([],t);return(0,I.Nl)(new R.A,e,this.hasZ,this.hasM,this.geometryType,this._tile.transform)}case"esriGeometryPolyline":{const t=this._current.projectedGeometry,e=(0,C.S8)(t.paths,this.hasZ),i=new R.A([],e);return(0,I.Nl)(new R.A,i,this.hasZ,this.hasM,this.geometryType,this._tile.transform)}}return null}_readAttribute(t,e){const i=this._current.attributes[t];if(void 0!==i)return i;const n=t.toLowerCase();for(const t in this._current.attributes)if(t.toLowerCase()===n)return this._current.attributes[t]}_readAttributes(){return this._current.attributes}}var z=i(13520),D=i(78952),L=i(35068),N=i(65298),B=i(57652),k=i(14817),V=i(38441),U=i(80207),G=i(74841),H=i(96700);class Y{static fromGraphic(t,e,i,n){return new Y(t.geometry,e,{...t.attributes},t.visible,t.uid,i,n)}constructor(t,e,i,n,r,s,o){this.geometry=t,this.symbol=e,this.attributes=i,this.visible=n,this.objectId=r,this.zOrder=s,this.displayId=o,this.bounds=(0,f.vt)(),this.prevBounds=(0,f.vt)(),this.size=[0,0,0,0]}get linearCIM(){return this.symbolResource?.symbolInfo.linearCIM}update(t,e,i){return(this.geometry!==t.geometry||JSON.stringify(this.attributes)!==JSON.stringify(t.attributes)||this.symbol!==e||this.zOrder!==i||this.visible!==t.visible)&&(this.prevBounds=this.bounds,this.bounds=(0,f.vt)(),this.zOrder=i,this.geometry=t.geometry,this.attributes={...t.attributes},this.symbol=e,this.visible=t.visible,this.symbolResource=null,this.projectedGeometry=null,!0)}async projectAndNormalize(t){let e=this.geometry;if(!e||!e.spatialReference||"mesh"===e.type)return;"extent"===e.type&&(e=(0,H.DF)(e)),await(0,G.Nk)(e.spatialReference,t);const i=(0,U.b3)(e);if(!i)return;const n=(0,G.Cv)(i,e.spatialReference,t);n&&(0,V.uC)(n),this.projectedGeometry=(0,_.ZC)(n)?(0,H.DF)(n):n}}class W{constructor(t,e,i){this.added=t,this.updated=e,this.removed=i}hasAnyUpdate(){return!!(this.added.length||this.updated.length||this.removed.length)}}const Z=1e-5;function q(t,e){return e.zOrder-t.zOrder}class X{constructor(t,e,i,n,r){this._items=new Map,this._boundsDirty=!1,this._outSpatialReference=t,this._cimResourceManager=e,this._hittestDrawHelper=new k.CK(e),this._tileInfoView=i,this._store=r;const s=i.getClosestInfoForScale(n);this._resolution=this._tileInfoView.getTileResolution(s.level)}items(){return this._items.values()}getItem(t){return this._items.get(t)}async update(t,e,i){const n=[],r=[],s=[],o=new Set,a=[];let l=0;for(const s of t.items){l++;const t=s.uid,c=this._items.get(t),u=e(s);if(o.add(t),c){c.update(s,u,l)&&(r.push(c),a.push(this._updateItem(c,i)));continue}const h=this._store.createDisplayIdForObjectId(t),d=Y.fromGraphic(s,u,l,h);a.push(this._updateItem(d,i)),this._items.set(d.objectId,d),n.push(d)}for(const[t,e]of this._items.entries())o.has(t)||(this._store.releaseDisplayIdForObjectId(t),this._items.delete(t),s.push(e));return await Promise.all(a),this._index=null,new W(n,r,s)}updateLevel(t){this._resolution!==t&&(this._index=null,this._boundsDirty=!0,this._resolution=t)}hitTest(t,e,i,n,r){const s=(0,o.A)("esri-mobile"),a=s?v.fy:v.V3,l=a+(s?0:v._M);t=(0,N.mT)(t,this._tileInfoView.spatialReference);const c=n*window.devicePixelRatio*l,u=(0,f.vt)();u[0]=t-c,u[1]=e-c,u[2]=t+c,u[3]=e+c;const h=n*window.devicePixelRatio*a,d=(0,f.vt)();d[0]=t-h,d[1]=e-h,d[2]=t+h,d[3]=e+h;const _=.5*n*(l+H.RA),p=this._searchIndex(t-_,e-_,t+_,e+_);if(!p||0===p.length)return[];const m=[],g=(0,f.vt)(),y=(0,f.vt)();for(const t of p){if(!t.visible)continue;const{projectedGeometry:e,symbolResource:i}=t;this._getSymbolBounds(g,i,e,y,r),y[3]=y[2]=y[1]=y[0]=0,(0,f.HY)(g,u)&&m.push(t)}if(0===m.length)return[];const x=this._hittestDrawHelper,b=[];for(const t of m){const{projectedGeometry:e,symbolResource:i}=t;if(!i)continue;const{textInfo:s,symbolInfo:o}=i,a=o.cimSymbol;x.hitTest(d,a.symbol,e,s,r,n)&&b.push(t)}return b.sort(q),b.map((t=>t.objectId))}queryItems(t){return 0===this._items.size?[]:this._searchForItems(t)}clear(){this._items.clear(),this._index=null}async _updateItem(t,e){await t.projectAndNormalize(this._outSpatialReference),await e(t);const{size:i}=t;i[0]=i[1]=i[2]=i[3]=0,this._getSymbolBounds(t.bounds,t.symbolResource,t.projectedGeometry,t.size,0)}_searchIndex(t,e,i,n){return this._boundsDirty&&(this._items.forEach((t=>this._getSymbolBounds(t.bounds,t.symbolResource,t.projectedGeometry,t.size,0))),this._boundsDirty=!1),this._index||(this._index=(0,D.r)(9,(t=>({minX:t.bounds[0],minY:t.bounds[1],maxX:t.bounds[2],maxY:t.bounds[3]}))),this._index.load(Array.from(this._items.values()))),this._index.search({minX:t,minY:e,maxX:i,maxY:n})}_searchForItems(t){const e=this._tileInfoView.spatialReference,i=t.bounds,n=(0,B.Vp)(e);if(n&&e.isWrappable){const[e,r]=n.valid,s=Math.abs(i[2]-r)<Z,o=Math.abs(i[0]-e)<Z;if((!s||!o)&&(s||o)){const n=t.resolution;let o;o=(0,f.vt)(s?[e,i[1],e+n*H.RA,i[3]]:[r-n*H.RA,i[1],r,i[3]]);const a=this._searchIndex(i[0],i[1],i[2],i[3]),l=this._searchIndex(o[0],o[1],o[2],o[3]);return[...new Set([...a,...l])]}}return this._searchIndex(i[0],i[1],i[2],i[3])}_getSymbolBounds(t,e,i,n,r){if(!e||!e.symbolInfo.linearCIM||!i)return null;if(t||(t=(0,f.vt)()),(0,L.Rg)(t,i),!n||0===n[0]&&0===n[1]&&0===n[2]&&0===n[3]){const{textInfo:t,symbolInfo:i}=e,s=i.cimSymbol;n||(n=[0,0,0,0]);const o=m.Sc.getSymbolInflateSize(n,s.symbol,this._cimResourceManager,r,t);n[0]=(0,z.Lz)(o[0]),n[1]=(0,z.Lz)(o[1]),n[2]=(0,z.Lz)(o[2]),n[3]=(0,z.Lz)(o[3])}const s=this._resolution,o=m.Sc.safeSize(n);return t[0]-=o*s,t[1]-=o*s,t[2]+=o*s,t[3]+=o*s,t}}var $=i(21884),j=i(60478);class K{static getOrCreate(t,e,i){let n=e.get(t.id);return n||(n=new K(t,i),e.set(t.id,n)),n}static fromItems(t,e,i){const n=new K(t,i);return n.addedOrModified.push(...e),n}constructor(t,e){this.tile=t,this.metadata=e,this.addedOrModified=[],this.removed=[]}get reader(){return this._reader||(this._reader=F.from(this.addedOrModified,this.tile,this.metadata)),this._reader}}let Q=class extends((0,a.sA)(r.A)){constructor(t){super(t),this._attached=!1,this._tiles=new Map,this._controller=new AbortController,this._hashToSymbolInfo=new Map,this._lastCleanup=performance.now(),this._cleanupRequired=!0,this.lastUpdateId=-1,this.renderer=null,this._updateTracking=new j.F({debugName:"GraphicsView2D"}),this.updateRequested=!1,this.defaultPointSymbolEnabled=!0,this._commandQueue=new $.A({process:t=>{if("update"===t.type)return this._update();throw new Error("InternalError: Unsupported command")}}),this.graphicUpdateHandler=this.graphicUpdateHandler.bind(this)}destroy(){this.container.destroy(),this.view=null,this.renderer=null,this._set("graphics",null),this._controller.abort(),this._graphicStore.clear(),this._attributeStore=null,this._hashToSymbolInfo.clear(),this._updateTracking.destroy(),this._commandQueue.destroy()}_initAttributeStore(){this._storage=new E.l({spatialReference:this.view.spatialReference,fields:new p.A}),this._attributeStore=new P.K({isLocal:!0,update:t=>{(0,o.A)("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView2D.AttributeStoreView.updateStart`,{message:t}),this.container.attributeView.requestUpdate(t),this.container.requestRender(),(0,o.A)("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView2D.AttributeStoreView.updateEnd`,{message:t})}});const t=(0,M.T9)(null,[]);this._attributeStore.update(t,this._storage,null),this.container.checkHighlight=()=>this._attributeStore.hasHighlight}initialize(){this._initAttributeStore(),this._metadata=A.h.create(this.view.spatialReference),this._resourceProxy=new S.J({fetch:t=>Promise.all(t.map((t=>this.view.stage.textureManager.rasterizeItem(t)))),fetchDictionary:t=>{throw new Error("InternalError: Graphics do not support Dictionary requests")}}),this.addHandles([(0,u.watch)((()=>this._effectiveRenderer),(()=>this._pushUpdate())),this.view.graphicsTileStore.on("update",this._onTileUpdate.bind(this)),this.container.on("attach",(()=>{this.addHandles([this.graphics.on("change",(()=>this._pushUpdate()))]),this._graphicStore=new X(this.view.spatialReference,this._cimResourceManager,this.view.featuresTilingScheme,this.view.state.scale,this._attributeStore),this._attached=!0,this.requestUpdate(),this._pushUpdate()}))]),this._updateTracking.addUpdateTracking("CommandQueue",this._commandQueue.updateTracking);const t=this.view.graphicsTileStore.tiles;this._onTileUpdate({added:t,removed:[]})}get _effectiveRenderer(){return"function"==typeof this.renderer?this.renderer():this.renderer}get _cimResourceManager(){return this.view.stage.textureManager.resourceManager}get updating(){const t=!this._attached||this._updateTracking.updating;return(0,o.A)("esri-2d-log-updating")&&console.log(`Updating GraphicsView2D: ${t}\n  -> attaching ${!this._attached}\n  -> updateTracking ${this._updateTracking.updating}`),t}hitTest(t){if(!this.view||this.view.suspended)return[];const{resolution:e,rotation:i}=this.view.state,n=this._graphicStore.hitTest(t.x,t.y,2,e,i),r=new Set(n),o=this.graphics.items.reduce(((t,e)=>(r.has(e.uid)&&t.set(e.uid,e),t)),new Map);return n.map((t=>o.get(t))).filter(s.Ru)}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.requestUpdateCallback()),this.notifyChange("updating")}processUpdate(t){this.updateRequested&&(this.updateRequested=!1,this.update(t))}viewChange(){this.requestUpdate()}setHighlight(t){const e=[];for(const{objectId:i,highlightFlags:n}of t){const t=this._graphicStore.getItem(i)?.displayId;e.push({objectId:i,highlightFlags:n,displayId:t})}this._attributeStore.setHighlight(e,t),this._pushUpdate()}graphicUpdateHandler(t){this._pushUpdate()}update(t){this.updateRequested=!1,this._attached&&this._graphicStore.updateLevel(t.state.resolution)}pushUpdate(){this._pushUpdate()}_pushUpdate(){(0,c.QZ)(this._commandQueue.push({type:"update"}))}async _update(){try{(0,o.A)("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView._update start`);const t=await this._graphicStore.update(this.graphics,(t=>this._getSymbolForGraphic(t)),(t=>this._ensureSymbolResource(t)));if(!t.hasAnyUpdate())return void this._attributeStore.sendUpdates();t.removed.length&&(this._cleanupRequired=!0),(0,o.A)("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView updateMessage`,t);const e=this._createTileMessages(t);await this._fetchResources(e),this._write(e);for(const e of t.added)this._setFilterState(e);for(const e of t.updated)this._setFilterState(e);(0,o.A)("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView sendUpdate`,t),this._attributeStore.sendUpdates(),(0,o.A)("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView sendUpdate.await`,t)}catch(t){}this._cleanupSharedResources()}_createTileMessages(t){const e=new Map;for(const i of t.added){const t=this.view.graphicsTileStore.getIntersectingTiles(i.bounds);for(const n of t)K.getOrCreate(n,e,this._metadata).addedOrModified.push(i)}for(const i of t.updated){const t=this.view.graphicsTileStore.getIntersectingTiles(i.prevBounds),n=this.view.graphicsTileStore.getIntersectingTiles(i.bounds);for(const n of t)K.getOrCreate(n,e,this._metadata).removed.push(i.displayId);for(const t of n)K.getOrCreate(t,e,this._metadata).addedOrModified.push(i)}for(const i of t.removed){const t=this.view.graphicsTileStore.getIntersectingTiles(i.bounds);for(const n of t)K.getOrCreate(n,e,this._metadata).removed.push(i.displayId)}return Array.from(e.values())}async _fetchResources(t){for(const{tile:e,reader:i}of t){(0,o.A)("esri-2d-update-debug")&&console.debug(`Id[${this.layerId}] Tile[${e.id}] GraphicsView fetchResources`,t);const n=i.getCursor();for(;n.next();)for(const t of n.getMeshWriters())t.enqueueRequest(this._resourceProxy,n,e.createArcadeEvaluationOptions(this.view.timeZone))}await this._resourceProxy.fetchEnqueuedResources()}_write(t){for(const e of t){(0,o.A)("esri-2d-update-debug")&&console.debug(`Id[${this.layerId}] Tile[${e.tile.id}] GraphicsView write`,e);const t=this._writeMeshes(e);let i=this._tiles.get(e.tile.key);i||(i=this._createFeatureTile(e.tile.key)),(0,o.A)("esri-2d-update-debug")&&console.debug(`Id[${this.layerId}] Tile[${e.tile.id}] GraphicsView onTileData`,e),this.container.onTileData(i,{type:"update",modify:t,remove:e.removed,end:!1,attributeEpoch:this._attributeStore.epoch}),this.container.requestRender()}}_writeMeshes(t){const e=new b.U(t.tile.id),i=t.reader.getCursor();for(;i.next();){e.entityStart(i.getDisplayId(),i.getZOrder());for(const n of i.getMeshWriters())n.write(e,this._resourceProxy,i,t.tile.createArcadeEvaluationOptions(this.view.timeZone),t.tile.level);e.entityEnd()}return{...e.serialize().message,tileId:t.tile.id}}_setFilterState(t){const e=t.displayId,i=this._attributeStore.getHighlightFlags(t.objectId);this._attributeStore.setData(e,0,0,i|(t.visible?v.LY:0))}_getSymbolForGraphic(t){return null!=t.symbol?t.symbol:null!=this._effectiveRenderer?this._effectiveRenderer.getSymbol(t):this._getNullSymbol(t)}async _ensureSymbolResource(t){if(!t.symbol)return;const e=await this._getSymbolInfo(t.symbol);if(!e)return;const i=e.linearCIM.filter((t=>"text"===t.type));if(i.length>0){const n=await this._getTextResources(t,i);t.symbolResource={symbolInfo:e,textInfo:n}}else t.symbolResource={symbolInfo:e}}_getSymbolInfo(t){const e=t.hash();return this._hashToSymbolInfo.has(e)||this._hashToSymbolInfo.set(e,this._createSymbolInfo(e,t).catch((t=>null))),this._hashToSymbolInfo.get(e)}async _createSymbolInfo(t,e){const i=await this._convertToCIMSymbol(e),n=await this._createLinearCIM(i);return{hash:t,cimSymbol:i,linearCIM:n,meshWriters:await this._createMeshWriters(i,n)}}async _convertToCIMSymbol(t){const e=(0,m.Vb)(t);return"web-style"===e.type?(await e.fetchCIMSymbol()).data:e}async _createLinearCIM(t){return await Promise.all(m.wp.fetchResources(t.symbol,this._cimResourceManager,[])),this.view.stage.cimAnalyzer.analyzeSymbolReference(t,!1)}async _createMeshWriters(t,e){(0,c.Te)(this._controller.signal);const i=this.container.instanceStore,n=this.view.stage.meshWriterRegistry,r=await async function(t,e,i){const n=[],r={scaleInfo:(0,T.TY)(t),scaleExpression:null};for(const t of e)switch(t.type){case"marker":n.push(...(0,T.Zi)(i.instances.marker,t,w.Dk,r));break;case"fill":null==t.spriteRasterizationParam?n.push(...(0,T.Gn)(i.instances.fill,t,r)):n.push(...(0,T.oF)(i.instances.complexFill,t,!1,r));break;case"line":t.spriteRasterizationParam?n.push(...(0,T.EM)(i.instances.texturedLine,t,!1,r)):n.push(...(0,T.NZ)(i.instances.line,t,!1,r));break;case"text":n.push(...(0,T.IQ)(i.instances.text,t,w.Dk,r))}return n}(t,e,i);return Promise.all(r.map((t=>n.createMeshWriter(this._storage,this._resourceProxy,{tileInfo:this.view.featuresTilingScheme.tileInfo},t))))}_onTileUpdate(t){if(t.added&&t.added.length>0)for(const e of t.added)this._updateTracking.addPromise(this._addTile(e));if(t.removed&&t.removed.length>0)for(const e of t.removed)this._removeTile(e.key)}_createFeatureTile(t){const e=this.view.featuresTilingScheme.getTileBounds((0,f.vt)(),t),i=this.view.featuresTilingScheme.getTileResolution(t.level),n=new x.R(t,i,e[0],e[3]);return this._tiles.set(t,n),this.container.addChild(n),n}async _addTile(t){if(!this._attached)return;const e=this._graphicStore.queryItems(t);if(!e.length)return;const i=this._createFeatureTile(t.key),n=K.fromItems(t,e,this._metadata);await this._fetchResources([n]);const r=this._writeMeshes(n);i.onMessage({type:"append",append:r,clear:!1,end:!0,attributeEpoch:this._attributeStore.epoch})}_removeTile(t){if(!this._tiles.has(t))return;const e=this._tiles.get(t);this.container.removeChild(e),e.destroy(),this._tiles.delete(t)}_getNullSymbol(t){const e=t.geometry;return(0,_.Rg)(e)?y.x3:(0,_.Bi)(e)||(0,_.ZC)(e)?y.JJ:this.defaultPointSymbolEnabled?y.jM:null}async _getTextResources(t,e){const i=new Array,n=new Array;for(let r=0;r<e.length;r++){const s=e[r],{resource:o,overrides:a}=s.textRasterizationParam;if(a?.length>0){const e=g.$.resolveSymbolOverrides({type:"CIMSymbolReference",primitiveOverrides:a,symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,size:o.symbol.height,anchorPointUnits:"Relative",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:o.symbol,textString:o.textString}],scaleSymbolsProportionally:!0,respectFrame:!0}]}},t,this.view.spatialReference,null,(0,_.$B)(t.projectedGeometry),null,null);e.then((t=>{const e=t.symbolLayers[0],{textString:i}=e.markerGraphics[0];n.push({type:"cim-rasterization-info",resource:{type:"text",textString:i||"",font:o.font}}),s.text=o.textString=i||""})),i.push(e)}else n.push({type:"cim-rasterization-info",resource:o})}i.length>0&&await Promise.all(i);const r=n.map((t=>this.view.stage.textureManager.rasterizeItem(t))),s=await Promise.all(r);(0,l.Lw)(s);const o=new Map;for(let t=0;t<e.length;t++){const i=e[t];o.set(i.textRasterizationParam.resource.symbol,{text:i.text,glyphMosaicItems:s[t]})}return o}_cleanupSharedResources(){if(!this._cleanupRequired)return;const t=performance.now();if(t-this._lastCleanup<5e3)return;this._cleanupRequired=!1,this._lastCleanup=t;const e=new Set;for(const t of this._graphicStore.items()){const i=t.symbolResource?.symbolInfo.hash;e.add(i)}const i=new Set(this._hashToSymbolInfo.keys());for(const t of i.values())e.has(t)||this._hashToSymbolInfo.delete(t)}};(0,n._)([(0,h.MZ)()],Q.prototype,"_effectiveRenderer",null),(0,n._)([(0,h.MZ)({constructOnly:!0})],Q.prototype,"layerId",void 0),(0,n._)([(0,h.MZ)({constructOnly:!0})],Q.prototype,"requestUpdateCallback",void 0),(0,n._)([(0,h.MZ)()],Q.prototype,"container",void 0),(0,n._)([(0,h.MZ)({constructOnly:!0})],Q.prototype,"graphics",void 0),(0,n._)([(0,h.MZ)()],Q.prototype,"renderer",void 0),(0,n._)([(0,h.MZ)()],Q.prototype,"_updateTracking",void 0),(0,n._)([(0,h.MZ)()],Q.prototype,"updating",null),(0,n._)([(0,h.MZ)()],Q.prototype,"view",void 0),(0,n._)([(0,h.MZ)()],Q.prototype,"updateRequested",void 0),(0,n._)([(0,h.MZ)()],Q.prototype,"defaultPointSymbolEnabled",void 0),Q=(0,n._)([(0,d.$)("esri.views.2d.layers.graphics.GraphicsView2D")],Q);const J=Q},96700:function(t,e,i){i.d(e,{DF:function(){return a},Lu:function(){return c},RA:function(){return o},hV:function(){return l}});var n=i(13520),r=i(44740),s=(i(87416),i(57652),i(39686));const o=50;function a(t){if(!t)return null;const{xmin:e,ymin:i,xmax:n,ymax:s,spatialReference:o}=t;return new r.A({rings:[[[e,i],[e,s],[n,s],[n,i],[e,i]]],spatialReference:o})}function l(t){return(0,n.PN)(Math.round((0,n.Lz)(t)))}function c(t){const e=(0,n.PN)(s.GR),i=(0,n.PN)(s.cp);return Math.max(e,Math.min(t||i,i))}},21884:function(t,e,i){i.d(e,{A:function(){return o}});var n=i(60539),r=i(60478),s=i(46863);class o{constructor(t){this.updateTracking=new r.F({debugName:"FeatureCommandQueue"}),this._queueProcessor=new s.e({concurrency:1,process:t.process})}destroy(){this.updateTracking.destroy(),this._queueProcessor.destroy(),this.clear()}clear(){this._queueProcessor.clear()}async push(t){return(0,n.QZ)(this.updateTracking.addPromise(this._doPush(t)))}async _doPush(t){const e=this._queueProcessor,i=e.last();switch(t.type){case"update":case"highlight":if(i?.type===t.type)return;return e.push(t);case"edit-by-id":case"edit-by-feature":return e.push(t)}}}},60478:function(t,e,i){i.d(e,{F:function(){return h}});var n=i(53804),r=i(83525),s=i(58941),o=i(62790),a=i(28181),l=i(23502),c=(i(40633),i(13798),i(65953)),u=i(20248);let h=class extends r.A{constructor(t){super(t),this.debugName="",this._updatingHandles=new u.U,this._idToUpdatingState=new o.A}get updating(){const t=this._updatingHandles.updating||Array.from(this._idToUpdatingState.values()).some((t=>t));if((0,s.A)("esri-2d-log-updating")){const e=Array.from(this._idToUpdatingState.entries()).map((([t,e])=>`-> ${t}: ${e}`)).join("\n");console.log(`${this.debugName}: Updating: ${t}\n-> Handles: ${this._updatingHandles.updating}\n${e}`)}return t}addUpdateTracking(t,e){const i=(0,a.watch)((()=>e.updating),(e=>this._idToUpdatingState.set(t,e)),{sync:!0});this.addHandles(i)}addPromise(t){return this._updatingHandles.addPromise(t)}};(0,n._)([(0,l.MZ)({constructOnly:!0})],h.prototype,"debugName",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],h.prototype,"updating",null),h=(0,n._)([(0,c.$)("esri.views.2d.layers.support.UpdateTracking2D")],h)},30488:function(t,e,i){i.d(e,{H_:function(){return y},u4:function(){return v},lB:function(){return x},eh:function(){return g}});var n=i(73037),r=i(40633),s=i(67529),o=i(39686),a=i(39232),l=i(85456),c=i(78541),u=i(10956);const h=()=>r.A.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient"),d=[0,0,0,0];class f{constructor(){this.type="single",this._convertedHighlightOptions={fillColor:[.2*.75,.6*.75,.675,.75],outlineColor:[.2*.9,.54,.81,.9],outlinePosition:a.No.outlinePosition,outlineWidth:a.No.outlineWidth,innerHaloWidth:a.No.innerHaloWidth,outerHaloWidth:a.No.outerHaloWidth},this._shadeTexChanged=!0,this._texelData=new Uint8Array(4*a.Ci),this._minMaxDistance=[0,0]}setHighlightOptions(t){const e=this._convertedHighlightOptions;!function(t,e){e.fillColor[0]=t.color.r/255,e.fillColor[1]=t.color.g/255,e.fillColor[2]=t.color.b/255,e.fillColor[3]=t.color.a,t.haloColor?(e.outlineColor[0]=t.haloColor.r/255,e.outlineColor[1]=t.haloColor.g/255,e.outlineColor[2]=t.haloColor.b/255,e.outlineColor[3]=t.haloColor.a):(e.outlineColor[0]=e.fillColor[0],e.outlineColor[1]=e.fillColor[1],e.outlineColor[2]=e.fillColor[2],e.outlineColor[3]=e.fillColor[3]),e.fillColor[3]*=t.fillOpacity,e.outlineColor[3]*=t.haloOpacity,e.fillColor[0]*=e.fillColor[3],e.fillColor[1]*=e.fillColor[3],e.fillColor[2]*=e.fillColor[3],e.outlineColor[0]*=e.outlineColor[3],e.outlineColor[1]*=e.outlineColor[3],e.outlineColor[2]*=e.outlineColor[3],e.outlineWidth=a.No.outlineWidth,e.outerHaloWidth=a.No.outerHaloWidth,e.innerHaloWidth=a.No.innerHaloWidth,e.outlinePosition=a.No.outlinePosition}(t,e);const i=e.outlinePosition-e.outlineWidth/2-e.outerHaloWidth,n=e.outlinePosition-e.outlineWidth/2,r=e.outlinePosition+e.outlineWidth/2,s=e.outlinePosition+e.outlineWidth/2+e.innerHaloWidth,o=Math.sqrt(Math.PI/2)*a.aY,l=Math.abs(i)>o?Math.round(10*(Math.abs(i)-o))/10:0,c=Math.abs(s)>o?Math.round(10*(Math.abs(s)-o))/10:0;let u;l&&!c?h().error("The outer rim of the highlight is "+l+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!l&&c?h().error("The inner rim of the highlight is "+c+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):l&&c&&h().error("The highlight is "+Math.max(l,c)+"px away from the edge of the feature; consider reducing some width values.");const f=[void 0,void 0,void 0,void 0];function _(t,e,i){f[0]=(1-i)*t[0]+i*e[0],f[1]=(1-i)*t[1]+i*e[1],f[2]=(1-i)*t[2]+i*e[2],f[3]=(1-i)*t[3]+i*e[3]}const{_texelData:p}=this;for(let t=0;t<a.Ci;++t)u=i+t/(a.Ci-1)*(s-i),u<i?(f[0]=0,f[1]=0,f[2]=0,f[3]=0):u<n?_(d,e.outlineColor,(u-i)/(n-i)):u<r?[f[0],f[1],f[2],f[3]]=e.outlineColor:u<s?_(e.outlineColor,e.fillColor,(u-r)/(s-r)):[f[0],f[1],f[2],f[3]]=e.fillColor,p[4*t]=255*f[0],p[4*t+1]=255*f[1],p[4*t+2]=255*f[2],p[4*t+3]=255*f[3];this._minMaxDistance[0]=i,this._minMaxDistance[1]=s,this._shadeTexChanged=!0}applyHighlightOptions(t,e){if(!this._shadeTex){const e=new u.R;e.wrapMode=l.pF.CLAMP_TO_EDGE,e.width=a.Ci,e.height=1,this._shadeTex=new c.g(t,e)}this._shadeTexChanged&&(this._shadeTex.updateData(0,0,0,a.Ci,1,this._texelData),this._shadeTexChanged=!1),t.bindTexture(this._shadeTex,o.CR),e.setUniform2fv("u_minMaxDistance",this._minMaxDistance)}destroy(){this._shadeTex?.dispose(),this._shadeTex=null}getReasonsWithGradients(){return[{activeReasons:(1<<s.M$.length)-1,activeGradient:this}]}}class _{constructor(){this.type="multi";const t={};for(const e in s.mF)t[e]=new f;this.gradients=t}setHighlightOptions(t){for(const e in s.mF){const i=s.mF[e](t);this.gradients[e].setHighlightOptions(i)}}applyHighlightOptions(t,e,i){this.gradients[i].applyHighlightOptions(t,e)}destroy(){for(const t in s.mF)this.gradients[t].destroy()}getReasonsWithGradients(){let t=1;const e=[];for(const i in this.gradients){const n=this.gradients[i];e.push({activeReasons:t,activeGradient:n}),t<<=1}return e}}var p=i(86847);const m=new n.J({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function g(t){return m.toJSON(t)}function y(t){const{bandCount:e,attributeTable:i,colormap:n,pixelType:r}=t.raster.rasterInfo;return 1===e&&(null!=i||null!=n||"u8"===r||"s8"===r)}function v(t,e){return"single"===t?.type&&e.multiHighlightEnabled&&(t.destroy(),t=null),"multi"!==t?.type||e.multiHighlightEnabled||(t.destroy(),t=null),t||(t=e.multiHighlightEnabled?new _:new f),t.setHighlightOptions(e),t}function x(t,e,i){const{painter:n,highlightGradient:r}=t,{highlight:s}=n.effects;if(!r)return;const o=t.passOptions,a=r.getReasonsWithGradients();for(let r=0;r<a.length;r++){const o={...t,passOptions:{type:"highlight",activeGradient:a[r].activeGradient,activeReasons:a[r].activeReasons,stepType:"burn",highlightAll:e}};if(s.bind(o),i(o),r<a.length-1){let n=0;for(let t=r+1;t<a.length;t++)n|=a[t].activeReasons;i({...t,passOptions:{type:"highlight",activeGradient:a[r].activeGradient,activeReasons:n,stepType:"clear",highlightAll:e}})}const l={...t,passOptions:{type:"highlight",activeGradient:a[r].activeGradient,activeReasons:a[r].activeReasons,stepType:"draw",highlightAll:e}};n.setPipelineState((0,p.Qu)(t)),n.updatePipelineState(t.context),s.draw(l),s.unbind()}t.passOptions=o}},49530:function(t,e,i){i.r(e),i.d(e,{GraphicContainer:function(){return si.A},GraphicsView2D:function(){return ri.A},LabelManager:function(){return ni.C},MagnifierView2D:function(){return pi},MapViewNavigation:function(){return oi.A},Stage:function(){return ii}});var n=i(39819),r=i(58941),s=i(95929),o=i(74087),a=i(85445),l=i(25090),c=i(75505),u=i(80683),h=i(21609),d=i(40633),f=i(13520),_=i(50944),p=i(57176),m=i(38821),g=i(33389),y=i(67895),v=i(44508),x=i(7590),b=i(47072),S=i(39686);function w(t){const e=t.markerPlacement;return e&&e.angleToLine?g.C1.MAP:g.C1.SCREEN}class T{constructor(t){this._cimLayers=[],this._poMap={},this._primitiveOverrides=[],t&&(this._resourceManager=t)}analyzeSymbolReference(t,e,i){if(this._cimLayers=i??[],!t)return this._cimLayers;if(this._reset(),t.primitiveOverrides){this._primitiveOverrides=t.primitiveOverrides;for(const t of this._primitiveOverrides){const e=t.valueExpressionInfo;if(e)this._setPoMap(t.primitiveName,t.propertyName,e);else if(null!=t.value){let e=t.value;t.propertyName.includes("Color")&&((0,c.IB)(e)&&(e=(0,x.G9)(e)),e=(0,x.e6)(e)),this._setPoMap(t.primitiveName,t.propertyName,e)}}}return this._analyzeSymbol(t.symbol,e),this._cimLayers}_reset(){this._cimLayers=[],this._poMap={},this._primitiveOverrides=[]}_analyzeSymbol(t,e){switch(t?.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this._analyzeMultiLayerSymbol(t,e)}}_analyzeMultiLayerSymbol(t,e){const i=t?.symbolLayers;if(!i)return;const n=t.effects;let r=g.C1.SCREEN;const s=(0,x.YC)(t)??0;"CIMPointSymbol"===t.type&&"Map"===t.angleAlignment&&(r=g.C1.MAP);const o="CIMPolygonSymbol"===t.type;let a=i.length;for(;a--;){const l=i[a];if(!l||!1===l.enable)continue;let c;n?.length&&(c=[...n]);const u=l.effects;u?.length&&(n?c.push(...u):c=[...u]);let h=null;if(c){h=[];for(const t of c){const e=y.$.findEffectOverrides(t,this._primitiveOverrides);e&&h.push(e)}}const f=[];switch(y.$.findApplicableOverrides(l,this._primitiveOverrides,f),l.type){case"CIMSolidFill":this._analyzeSolidFill(l,h);break;case"CIMPictureFill":this._analyzePictureFill(l,h);break;case"CIMHatchFill":this._analyzeHatchFill(l,h);break;case"CIMGradientFill":this._analyzeGradientFill(l,h);break;case"CIMSolidStroke":this._analyzeSolidStroke(l,h,o,s);break;case"CIMPictureStroke":this._analyzePictureStroke(l,h,o,s);break;case"CIMGradientStroke":this._analyzeGradientStroke(l,h,o,s);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":{"CIMLineSymbol"!==t.type&&"CIMPolygonSymbol"!==t.type||(r=w(l));const i=[],n=l.primitiveName;n&&i.push(n);const a=o&&(0,x.zr)(l.markerPlacement);this._analyzeMarker(l,h,null,i,r,s,e,[],!1,a);break}default:d.A.getLogger("esri.symbols.cim.cimAnalyzer").error("Cannot analyze CIM layer",l.type)}}}_analyzeSolidFill(t,e){const{primitiveName:i,type:n}=t,r=(0,x.e6)(t.color);this._cimLayers.push({type:"fill",spriteRasterizationParam:null,colorLocked:!!t.colorLocked,color:this._getValueOrOverrideExpression(n,i,"Color",r),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:e,applyRandomOffset:!1,sampleAlphaOnly:!0,hasUnresolvedReplacementColor:!1})}_analyzePictureFill(t,e){const{primitiveName:i,type:n}=t,r=(0,x.Ny)(t),s=(0,x.$w)(t.height,m.D.CIMPictureFill.height);let o=(0,x.$w)(t.scaleX,1);if("width"in t&&"number"==typeof t.width){const e=t.width;let i=1;const n=this._resourceManager.getResource(t.url);null!=n&&(i=n.width/n.height),o/=i*(s/e)}const a={type:"sprite-rasterization-param",resource:t,overrides:this._getPrimitiveMaterialOverrides(i,n)};this._cimLayers.push({type:"fill",spriteRasterizationParam:a,colorLocked:!!t.colorLocked,effects:e,color:this._getValueOrOverrideExpression(n,i,"TintColor",r),height:this._getValueOrOverrideExpression(n,i,"Height",s),scaleX:this._getValueOrOverrideExpression(n,i,"ScaleX",o),angle:this._getValueOrOverrideExpression(n,i,"Rotation",(0,x.$w)(t.rotation)),offsetX:this._getValueOrOverrideExpression(n,i,"OffsetX",(0,x.$w)(t.offsetX)),offsetY:this._getValueOrOverrideExpression(n,i,"OffsetY",(0,x.$w)(t.offsetY)),applyRandomOffset:!1,sampleAlphaOnly:!1,hasUnresolvedReplacementColor:!1})}_analyzeHatchFill(t,e){const{primitiveName:i,type:n}=t,r=this._analyzeMaterialOverrides(i,["Rotation","OffsetX","OffsetY"]),s=(0,x.pk)(r);let o=[255,255,255,1],a=!1;if(t.lineSymbol?.symbolLayers)for(const e of t.lineSymbol.symbolLayers){if("CIMSolidStroke"!==e.type)continue;const t=e.primitiveName??i;a||!t||e.colorLocked||null==this._poMap[t]?.Color&&null==this._poMap[t]?.StrokeColor||(o=(0,x.e6)(e.color),o=this._maybeGetValueOrOverrideExpression(t,"StrokeColor")??this._getValueOrOverrideExpression(n,t,"Color",o),a=!0);const r=this._maybeGetValueOrOverrideExpression(t,"StrokeWidth");if(r){let e=null,i=null;"number"==typeof r?e=r:i=r.valueExpressionInfo;let o=s.find((t=>"strokeWidth"===t.propertyName));o?o.propertyName="width":(o={type:"CIMPrimitiveOverride",primitiveName:t,propertyName:"width",valueExpressionInfo:i,value:e,defaultValue:(0,x.iA)(n,"width")},s.push(o))}}const l={type:"sprite-rasterization-param",resource:t,overrides:s};this._cimLayers.push({type:"fill",spriteRasterizationParam:l,colorLocked:!!t.colorLocked,effects:e,color:o,height:this._getValueOrOverrideExpression(n,i,"Separation",(0,x.$w)(t.separation,m.D.CIMHatchFill.separation)),scaleX:1,angle:this._getValueOrOverrideExpression(n,i,"Rotation",(0,x.$w)(t.rotation)),offsetX:this._getValueOrOverrideExpression(n,i,"OffsetX",(0,x.$w)(t.offsetX)),offsetY:this._getValueOrOverrideExpression(n,i,"OffsetY",(0,x.$w)(t.offsetY)),applyRandomOffset:!1,sampleAlphaOnly:!0,hasUnresolvedReplacementColor:!a})}_analyzeGradientFill(t,e){this._cimLayers.push({type:"fill",spriteRasterizationParam:null,colorLocked:!!t.colorLocked,effects:e,color:[128,128,128,1],height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,applyRandomOffset:!1,sampleAlphaOnly:!1,hasUnresolvedReplacementColor:!1})}_analyzeSolidStroke(t,e,i,n){const{primitiveName:r,type:s}=t,o=(0,x.e6)(t.color),a=(0,x.$w)(t.width,m.D.CIMSolidStroke.width),l=(0,x.GV)(t.capStyle,m.D.CIMSolidStroke.capstyle),c=(0,x.GV)(t.joinStyle,m.D.CIMSolidStroke.joinstyle),u=t.miterLimit;let h,d,f=[];if(this._analyzePrimitiveOverrides(r,e,null,null)&&(f=this._getPrimitiveMaterialOverrides(r,s)),e&&Array.isArray(e)&&e.length>0){const t=e[e.length-1].effect;t&&"CIMGeometricEffectDashes"===t.type&&"NoConstraint"===t.lineDashEnding&&null===t.offsetAlongLine&&(h=t.dashTemplate,d=t.scaleDash,(e=[...e]).pop())}const _=void 0!==h?{type:"sprite-rasterization-param",resource:{type:"dash",dashTemplate:h,capStyle:l},overrides:f}:null;this._cimLayers.push({type:"line",spriteRasterizationParam:_,isOutline:i,colorLocked:!!t.colorLocked,effects:e,color:this._getValueOrOverrideExpression(s,r,"Color",o),width:this._getValueOrOverrideExpression(s,r,"Width",a),cap:this._getValueOrOverrideExpression(s,r,"CapStyle",l),join:this._getValueOrOverrideExpression(s,r,"JoinStyle",c),miterLimit:u&&this._getValueOrOverrideExpression(s,r,"MiterLimit",u),referenceWidth:n,zOrder:M(t.name),dashTemplate:h,scaleDash:d,sampleAlphaOnly:!0})}_analyzePictureStroke(t,e,i,n){const{primitiveName:r,type:s}=t,o=(0,x.Ny)(t),a=(0,x.$w)(t.width,m.D.CIMPictureStroke.width),l=(0,x.GV)(t.capStyle,m.D.CIMPictureStroke.capstyle),c=(0,x.GV)(t.joinStyle,m.D.CIMPictureStroke.joinstyle),u=t.miterLimit,h={type:"sprite-rasterization-param",resource:t,overrides:this._getPrimitiveMaterialOverrides(r,s)};this._cimLayers.push({type:"line",spriteRasterizationParam:h,isOutline:i,colorLocked:!!t.colorLocked,effects:e,color:this._getValueOrOverrideExpression(s,r,"TintColor",o),width:this._getValueOrOverrideExpression(s,r,"Width",a),cap:this._getValueOrOverrideExpression(s,r,"CapStyle",l),join:this._getValueOrOverrideExpression(s,r,"JoinStyle",c),miterLimit:u&&this._getValueOrOverrideExpression(s,r,"MiterLimit",u),referenceWidth:n,zOrder:M(t.name),dashTemplate:null,scaleDash:!1,sampleAlphaOnly:!1})}_analyzeGradientStroke(t,e,i,n){const{primitiveName:r,type:s}=t,o=(0,x.$w)(t.width,m.D.CIMSolidStroke.width),a=(0,x.GV)(t.capStyle,m.D.CIMGradientStroke.capstyle),l=(0,x.GV)(t.joinStyle,m.D.CIMGradientStroke.joinstyle),c=t.miterLimit;this._cimLayers.push({type:"line",spriteRasterizationParam:null,isOutline:i,colorLocked:!!t.colorLocked,effects:e,color:[128,128,128,1],width:this._getValueOrOverrideExpression(s,r,"Width",o),cap:this._getValueOrOverrideExpression(s,r,"CapStyle",a),join:this._getValueOrOverrideExpression(s,r,"JoinStyle",l),miterLimit:c&&this._getValueOrOverrideExpression(s,r,"MiterLimit",c),referenceWidth:n,zOrder:M(t.name),dashTemplate:null,scaleDash:!1,sampleAlphaOnly:!1})}_analyzeMarker(t,e,i,n,r,s,o,a,l=!1,c=!1){if(l||=!!t.colorLocked,this._analyzeMarkerInsidePolygon(t,e,l))return;const u=(0,x.$w)(t.size,m.D.CIMVectorMarker.size),h=(0,x.$w)(t.rotation),d=(0,x.$w)(t.offsetX),f=(0,x.$w)(t.offsetY),{primitiveName:_,type:p}=t,g=this._getValueOrOverrideExpression(p,_,"Size",u),y=this._getValueOrOverrideExpression(p,_,"Rotation",h),v=this._getValueOrOverrideExpression(p,_,"OffsetX",d),b=this._getValueOrOverrideExpression(p,_,"OffsetY",f);switch(t.type){case"CIMPictureMarker":this._analyzePictureMarker(t,e,i,n,r,s,g,y,v,b,a,l,c);break;case"CIMVectorMarker":this._analyzeVectorMarker(t,e,i,n,r,s,g,y,v,b,a,o,l,c)}}_analyzeMarkerInsidePolygon(t,e,i){const{markerPlacement:n,type:r}=t;if(!n||"CIMMarkerPlacementInsidePolygon"!==n.type)return!1;if("CIMVectorMarker"===r||"CIMPictureMarker"===r){const i=t.primitiveName;if(i&&this._analyzePrimitiveOverrides([i],e,null,null))return!1;const s=n.primitiveName;if(s&&this._analyzePrimitiveOverrides([s],e,null,null))return!1;if("CIMVectorMarker"===r){const{markerGraphics:e}=t;if(e)for(const t of e){const{symbol:e}=t;if("CIMPolygonSymbol"===e?.type&&e.symbolLayers){const{symbolLayers:t}=e;for(const e of t)if("CIMSolidStroke"===e.type)return!1}}}else{const{animatedSymbolProperties:e}=t;if(e)return!1}}const s=Math.abs(n.stepX),o=Math.abs(n.stepY);if(0===s||0===o)return!0;let a,l;if("Random"===n.gridType){const t=(0,f.PN)(S.yv),e=Math.max(Math.floor(t/s),1);a=o*Math.max(Math.floor(t/o),1),l=e*s/a}else n.shiftOddRows?(a=2*o,l=s/o*.5):(a=o,l=s/o);const c=(0,x.Ny)(t),u="CIMCharacterMarker"===t.type?null:{type:"sprite-rasterization-param",resource:t,overrides:[]};return this._cimLayers.push({type:"fill",spriteRasterizationParam:u,colorLocked:i,effects:e,color:c,height:a,scaleX:l,angle:n.gridAngle,offsetX:(0,x.$w)(n.offsetX),offsetY:(0,x.$w)(n.offsetY),applyRandomOffset:"Random"===n.gridType,sampleAlphaOnly:"CIMPictureMarker"!==t.type,hasUnresolvedReplacementColor:!0}),!0}_analyzePictureMarker(t,e,i,n,r,s,o,a,l,c,u,d,f){const{animatedSymbolProperties:p,primitiveName:m,type:g}=t;let y=(0,x.$w)(t.scaleX,1);const v=(0,x.Ny)(t);i||(i=this._createMarkerPlacementOverrideExpression(t.markerPlacement));const b=this._createGIFAnimatedSymbolPropertiesOverrideExpression(p),S=t.anchorPoint??{x:0,y:0};if("width"in t&&"number"==typeof t.width){const e=t.width;let i=1;const n=this._resourceManager.getResource(t.url);null!=n&&(i=n.width/n.height),y/=i*((0,x.$w)(t.size)/e)}const w=[...n];let T;t.primitiveName&&w.push(t.primitiveName),p||b?T={type:"animated",url:t.url,urlHash:"H"+(0,_.Wm)(t.url),playAnimation:t.animatedSymbolProperties?.playAnimation,reverseAnimation:t.animatedSymbolProperties?.reverseAnimation,randomizeStartTime:t.animatedSymbolProperties?.randomizeStartTime,randomizeStartSeed:t.animatedSymbolProperties?.randomizeStartSeed,startTimeOffset:t.animatedSymbolProperties?.startTimeOffset,duration:t.animatedSymbolProperties?.duration,repeatType:t.animatedSymbolProperties?.repeatType,repeatDelay:t.animatedSymbolProperties?.repeatDelay}:(T=(0,h.o8)(t),T.markerPlacement=null);const M={type:"sprite-rasterization-param",resource:T,overrides:this._getMaterialOverrides(w,g)};b&&M.overrides.push(...b.overrides),this._cimLayers.push({type:"marker",spriteRasterizationParam:M,colorLocked:d,effects:e,scaleSymbolsProportionally:!1,alignment:r,size:o,scaleX:this._getValueOrOverrideExpression(g,m,"ScaleX",y),rotation:a,offsetX:l,offsetY:c,transform:{type:"cim-marker-transform-param",params:u},color:this._getValueOrOverrideExpression(g,m,"TintColor",v),anchorPoint:{x:S.x,y:S.y},isAbsoluteAnchorPoint:"Relative"!==t.anchorPointUnits,outlineColor:[0,0,0,0],outlineWidth:0,frameHeight:0,widthRatio:1,rotateClockwise:!!t.rotateClockwise,referenceSize:s,sizeRatio:1,isOutline:f,markerPlacement:i})}_analyzeVectorMarker(t,e,i,n,r,s,o,a,l,c,u,h,d,f){const _=t.markerGraphics;if(!_)return;const p=t.frame;let m=0;if(m=p?p.ymax-p.ymin:s,m){const e={offsetX:l,offsetY:c,rotation:a,size:o,frameHeight:m,rotateClockWise:!!t.rotateClockwise};u=[...u,e]}i||(i=this._createMarkerPlacementOverrideExpression(t.markerPlacement));for(const o of _)if(o){const a=o.symbol;if(!a)continue;const l=o.primitiveName;let c;if(l&&n.push(l),("CIMPointSymbol"===a.type||"CIMTextSymbol"===a.type)&&p){let e=0,i=0;const n=o.geometry;"x"in n&&"y"in n&&(e+=n.x-.5*(p.xmin+p.xmax),i+=n.y-.5*(p.ymin+p.ymax));const r=t.anchorPoint;r&&("Absolute"===t.anchorPointUnits?(e-=r.x,i-=r.y):p&&(e-=(p.xmax-p.xmin)*r.x,i-=(p.ymax-p.ymin)*r.y));const s={offsetX:e,offsetY:i,rotation:0,size:0,frameHeight:0,rotateClockWise:!1};c=[...u,s]}switch(a.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":h||E(a)?this._analyzeMultiLayerGraphicNonSDF(t,e,i,o,n,r,s,c??u,m,d,f):this._analyzeMultiLayerGraphic(t,e,i,o,n,r,s,c??u,m,d,f);break;case"CIMTextSymbol":this._analyzeTextGraphic(e,i,o,n,r,s,c??u,d)}l&&n.pop()}}_analyzeMultiLayerGraphic(t,e,i,n,r,s,o,a,l,c,u){const h=n.symbol,d=h.symbolLayers;if(!d)return;let f=d.length;if(P(d))return void this._analyzeCompositeMarkerGraphic(t,e,i,n,d,s,o,a,l,c,u);const _=this._resourceManager.geometryEngine,p=b.V.applyEffects(h.effects,n.geometry,_);if(p)for(;f--;){const h=d[f];if(!h||!1===h.enable)continue;const m=h.primitiveName;switch(m&&r.push(m),h.type){case"CIMSolidFill":case"CIMSolidStroke":{const r=b.V.applyEffects(h.effects,p,_),d=(0,v.Z7)(r);if(!d)continue;const f="Relative"!==t.anchorPointUnits,[g,y,S,w]=(0,v.Fj)(d,t.frame,t.size,t.anchorPoint,f),T="CIMSolidFill"===h.type,M={type:"sdf",geom:r,asFill:T},{path:P}=h,E=T?(0,x.e6)((0,x.pM)(h)):null==P?(0,x.e6)((0,x._1)(h)):[0,0,0,0],A=T?[0,0,0,0]:(0,x.e6)((0,x._1)(h)),C=(0,x.xo)(h)??0;if(!T&&!C)break;const I=n.primitiveName;let R=null;T&&!h.colorLocked&&(R=this._maybeGetValueOrOverrideExpression(I,"FillColor"));let O=null;T||h.colorLocked||(O=this._maybeGetValueOrOverrideExpression(I,"StrokeColor"));const F=R??this._getValueOrOverrideExpression(h.type,m,"Color",E),z=O??this._getValueOrOverrideExpression(h.type,m,"Color",A),D=this._maybeGetValueOrOverrideExpression(I,"StrokeWidth")??this._getValueOrOverrideExpression(h.type,m,"Width",C),L=P?{type:"sprite-rasterization-param",resource:{type:"path",path:P,asFill:T},overrides:[]}:{type:"sprite-rasterization-param",resource:M,overrides:[]};this._cimLayers.push({type:"marker",spriteRasterizationParam:L,colorLocked:!!h.colorLocked||!!c,effects:e,scaleSymbolsProportionally:!!t.scaleSymbolsProportionally,alignment:s,anchorPoint:{x:y,y:S},isAbsoluteAnchorPoint:f,size:l,rotation:0,offsetX:0,offsetY:0,scaleX:1,transform:{type:"cim-marker-transform-param",params:a},frameHeight:l,widthRatio:w,rotateClockwise:!1,referenceSize:o,sizeRatio:g,color:F,outlineColor:z,outlineWidth:D,isOutline:u,markerPlacement:i});break}case"CIMPictureMarker":case"CIMVectorMarker":h.markerPlacement?this._analyzeMultiLayerGraphicNonSDF(t,e,i,n,r,s,o,a,l,!!h.colorLocked||!!c,u):this._analyzeMarker(h,e,i,r,s,o,!1,a,c,u);break;default:this._analyzeMultiLayerGraphicNonSDF(t,e,i,n,r,s,o,a,l,!!h.colorLocked||!!c,u)}m&&r.pop()}}_analyzeTextGraphic(t,e,i,n,r,s,o,a){y.$.findApplicableOverrides(i,this._primitiveOverrides,[]);const l=i.geometry;if(!("x"in l)||!("y"in l))return;const c=i.symbol,h=(0,x.DW)(c),d=(0,x._d)(c.fontStyleName),f=(0,u.af)(c.fontFamilyName);c.font={family:f,decoration:h,...d};const _=(0,x.$w)(c.height,m.D.CIMTextSymbol.height),p=(0,x.$w)(c.angle),g=(0,x.$w)(c.offsetX),v=(0,x.$w)(c.offsetY),b=(0,x.e6)((0,x.pM)(c));let S=(0,x.e6)((0,x._1)(c)),w=(0,x.xo)(c)??0;w||(S=(0,x.e6)((0,x.pM)(c.haloSymbol)),w=(0,x.$w)(c.haloSize));let T=!1;if(c.symbol?.symbolLayers)for(const t of c.symbol.symbolLayers)null!=(0,x.e6)((0,x.pM)(t))&&(T=!!t.colorLocked);const M=i.primitiveName;let P=null;T||(P=this._maybeGetValueOrOverrideExpression(M,"FillColor"));const E=this._maybeGetValueOrOverrideExpression(M,"TextSize"),A=this._maybeGetValueOrOverrideExpression(M,"TextAngle"),C=this._maybeGetValueOrOverrideExpression(M,"TextOffsetX"),I=this._maybeGetValueOrOverrideExpression(M,"TextOffsetY");let R=null,O=null,F=0;if(c.callout&&"CIMBackgroundCallout"===c.callout.type){const t=c.callout;if(t.backgroundSymbol){const e=t.backgroundSymbol.symbolLayers;if(e)for(const t of e)"CIMSolidFill"===t.type?R=(0,x.e6)(t.color):"CIMSolidStroke"===t.type&&(O=(0,x.e6)(t.color),F=(0,x.$w)(t.width,m.D.CIMSolidStroke.width))}}const z=this._getValueOrOverrideExpression(c.type,i.primitiveName,"TextString",i.textString??"");if(null==z)return;const{fontStyleName:D}=c,L=f+(D?"-"+D.toLowerCase():"-regular"),N=this._getMaterialOverrides(n,c.type);N.push(...this._getPrimitiveMaterialOverrides(i.primitiveName,c.type));const B={type:"text-rasterization-param",resource:{type:"text",textString:i.textString??"",font:c.font,symbol:c,primitiveName:i.primitiveName},overrides:N};this._cimLayers.push({type:"text",lineWidth:c.lineWidth,textRasterizationParam:B,colorLocked:!!a||!!T,effects:t,alignment:r,anchorPoint:{x:0,y:0},isAbsoluteAnchorPoint:!1,fontName:L,decoration:h,weight:d.weight,style:d.style,size:E??_,angle:A??p,offsetX:C??g,offsetY:I??v,transform:{type:"cim-marker-transform-param",params:o},horizontalAlignment:(0,x.Bu)(c.horizontalAlignment),verticalAlignment:(0,x.Nl)(c.verticalAlignment),text:z,color:P??this._getValueOrOverrideExpression(c.type,i.primitiveName,"Color",b),outlineColor:S,outlineSize:w,backgroundColor:R,borderLineColor:O,borderLineWidth:F,referenceSize:s,sizeRatio:1,markerPlacement:e})}_analyzeMultiLayerGraphicNonSDF(t,e,i,n,r,s,o,a,l,c,u){const h=function(t,e){return{type:t.type,enable:!0,name:t.name,colorLocked:t.colorLocked,primitiveName:t.primitiveName,anchorPoint:t.anchorPoint,anchorPointUnits:t.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:t.rotateClockwise,rotation:0,size:t.size,billboardMode3D:t.billboardMode3D,depth3D:t.depth3D,frame:t.frame,markerGraphics:[e],scaleSymbolsProportionally:t.scaleSymbolsProportionally,respectFrame:t.respectFrame,clippingPath:t.clippingPath}}(t,n),d=t.primitiveName,_=this._analyzeMaterialOverrides(d,["Rotation","OffsetX","OffsetY"]),m=(0,x.pk)(_),[g,y,v]=p.wp.getTextureAnchor(h,this._resourceManager),b=this._getMaterialOverrides(r,t.type);b.push(...m);const S={type:"sprite-rasterization-param",resource:{...h,avoidSDFRasterization:!0},overrides:b};this._cimLayers.push({type:"marker",spriteRasterizationParam:S,colorLocked:c,effects:e,scaleSymbolsProportionally:!!t.scaleSymbolsProportionally,alignment:s,anchorPoint:{x:g,y:y},isAbsoluteAnchorPoint:!1,size:l,rotation:0,offsetX:0,offsetY:0,transform:{type:"cim-marker-transform-param",params:a},color:[255,255,255,1],outlineColor:[0,0,0,0],outlineWidth:0,scaleX:1,frameHeight:l,widthRatio:1,rotateClockwise:!!t.rotateClockwise,referenceSize:o,sizeRatio:v/(0,f.Lz)(t.size),isOutline:u,markerPlacement:i})}_createMarkerPlacementOverrideExpression(t){if(!t)return null;const e=[];return y.$.findApplicableOverrides(t,this._primitiveOverrides,e),{type:"cim-marker-placement-param",placement:t,overrides:A(e)}}_createGIFAnimatedSymbolPropertiesOverrideExpression(t){if(!t)return null;const e=[];return y.$.findApplicableOverrides(t,this._primitiveOverrides,e),{type:"cim-gif-animation-params",animation:t,overrides:A(e)}}_analyzeCompositeMarkerGraphic(t,e,i,n,r,s,o,a,l,c,u){const h=n.geometry,d=r[0],f=r[1],_=(0,v.Z7)(h);if(!_)return;const p="Relative"!==t.anchorPointUnits,[g,y,b,S]=(0,v.Fj)(_,t.frame,t.size,t.anchorPoint,p),{path:w}=f,T=f.primitiveName,M=d.primitiveName,P=n.primitiveName;let E=null;f.colorLocked||c||(E=this._maybeGetValueOrOverrideExpression(P,"FillColor"));const A=E??this._getValueOrOverrideExpression(f.type,T,"Color",(0,x.e6)(f.color));let C=null;d.colorLocked||c||(C=this._maybeGetValueOrOverrideExpression(P,"StrokeColor"));const I=C??this._getValueOrOverrideExpression(d.type,M,"Color",(0,x.e6)(d.color)),R=this._maybeGetValueOrOverrideExpression(P,"StrokeWidth")??this._getValueOrOverrideExpression(d.type,M,"Width",(0,x.$w)(d.width,m.D.CIMSolidStroke.width)),O={type:"sprite-rasterization-param",resource:w?{type:"path",path:w,asFill:!0}:{type:"sdf",geom:h,asFill:!0},overrides:[]};this._cimLayers.push({type:"marker",spriteRasterizationParam:O,colorLocked:c,effects:e,scaleSymbolsProportionally:!!t.scaleSymbolsProportionally,alignment:s,anchorPoint:{x:y,y:b},isAbsoluteAnchorPoint:p,size:l,rotation:0,offsetX:0,offsetY:0,scaleX:1,transform:{type:"cim-marker-transform-param",params:a},frameHeight:l,widthRatio:S,rotateClockwise:!1,referenceSize:o,sizeRatio:g,color:A,outlineColor:I,outlineWidth:R,isOutline:u,markerPlacement:i})}_setPoMap(t,e,i){let n;this._poMap[t]?n=this._poMap[t]:(n={},this._poMap[t]=n),n[e]=i}_maybeGetValueOrOverrideExpression(t,e,i){return this._getValueOrOverrideExpression("",t,e,i,!1)}_getValueOrOverrideExpression(t,e,i,n,r=!0){if(r&&!(0,x.ZO)(n)&&(n=(0,x.iA)(t,i.toLowerCase())),null==e)return n;const s=this._poMap[e];if(null==s)return n;const o=s[i];return"string"==typeof o||"number"==typeof o||Array.isArray(o)?o:o?{valueExpressionInfo:o,defaultValue:n}:n}_analyzePrimitiveOverrides(t,e,i,n){if(null==t)return!1;"string"==typeof t&&(t=[t]);for(const e of this._primitiveOverrides)if(t.includes(e.primitiveName)&&e.valueExpressionInfo)return!0;if(null!=e)for(const t of e)if(t?.overrides.length>0)return!0;if(null!=i)for(const t of i)if(t?.overrides.length>0)return!0;if(null!=n)for(const t of n)if(t?.overrides.length>0)return!0;return!1}_getMaterialOverrides(t,e){if(!t)return[];const i=[];for(const n of t)i.push(...this._getPrimitiveMaterialOverrides(n,e));return i}_getPrimitiveMaterialOverrides(t,e){if(!t)return[];const i=(0,x.pk)(this._primitiveOverrides.filter((e=>e.primitiveName===t)));return i.forEach((t=>t.defaultValue=(0,x.iA)(e,t.propertyName.toLowerCase()))),i}_analyzeMaterialOverrides(t,e){return this._primitiveOverrides.filter((i=>i.primitiveName!==t||!e.includes(i.propertyName)))}}function M(t){if(t&&0===t.indexOf("Level_")){const e=parseInt(t.substr(6),10);if(!isNaN(e))return e}return 0}const P=t=>t&&2===t.length&&t[0].enable&&t[1].enable&&"CIMSolidStroke"===t[0].type&&"CIMSolidFill"===t[1].type&&null==t[0].path&&null==t[1].path&&!t[0].effects&&!t[1].effects;function E(t){const e=t.symbolLayers;if(!e||2!==e.length)return!1;const i=e.find((t=>t.effects?.find((t=>"CIMGeometricEffectDashes"===t.type&&null!=t.dashTemplate)))),n=e.find((t=>t.effects?.find((t=>"CIMGeometricEffectAddControlPoints"===t.type))));return!!i||!!n}function A(t){return(0,h.o8)(t).map((t=>({...t,propertyName:(0,x.YF)(t.propertyName)})))}var C=i(7965),I=i(48996),R=i(40212),O=i(61226),F=i(15774),z=i(67348),D=i(12978),L=i(6764);class N{constructor(t){this.events=new I.A,this._hasMajorPerformanceCaveat=!1,this._lastRenderFrameCounter=0,this._canvas=document.createElement("canvas"),this._canvas.setAttribute("style","width: 100%; height:100%; display:block; willChange:transform");const e={failIfMajorPerformanceCaveat:!0,alpha:!0,antialias:!1,depth:!0,stencil:!0};t.appendChild(this._canvas);let i=(0,L.q)(this._canvas,e);i||(i=(0,L.q)(this._canvas,{...e,failIfMajorPerformanceCaveat:!1}),this._hasMajorPerformanceCaveat=!0),this._gl=i,this._handles=(0,O.vE)([(0,R.on)(this._canvas,"webglcontextlost",(t=>this.events.emit("webgl-context-lost",t)))])}destroy(){this._canvas.parentNode?.removeChild(this._canvas),this._canvas=null,this._handles.remove(),this._gl=null}get gl(){return this._gl}render(t,e){if(this._hasMajorPerformanceCaveat||(0,r.A)("esri-force-performance-mode")){if(++this._lastRenderFrameCounter>=(0,r.A)("esri-performance-mode-frames-between-render")&&(e(),this._lastRenderViewState=t.state.clone(),this._lastRenderFrameCounter=0),this._lastRenderViewState){const[e,i,n,r,s,o]=this._computeViewTransform(this._lastRenderViewState,t.state);this._canvas.style.transform=`matrix(${e}, ${i}, ${n}, ${r}, ${s}, ${o})`}}else e()}resize(t){const e=this._canvas,i=e.style,{state:{size:n},pixelRatio:r}=t,s=n[0],o=n[1],a=Math.round(s*r),l=Math.round(o*r);e.width===a&&e.height===l||(e.width=a,e.height=l),i.width=s+"px",i.height=o+"px"}_computeViewTransform(t,e){const[i,n]=t.center,[r,s]=e.center,[o,a]=t.toScreen([0,0],r,s),[l,c]=t.toScreen([0,0],i,n),u=l-o,h=c-a,d=t.scale/e.scale,f=e.rotation-t.rotation,_=(0,D.vt)();return(0,z.D_)(_),(0,z.hs)(_,_,[d,d]),(0,z.e$)(_,_,(0,F.kU)(f)),(0,z.Tl)(_,_,[u,h]),_}}var B=i(28230),k=i(20152),V=i(42111);const U={background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform lowp sampler2D u_texture;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\nvoid main() {\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = u_opacity * color;\n#else\ngl_FragColor = u_color;\n#endif\n}","background.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\nuniform mediump vec4 u_tlbr;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\n#endif\nvoid main() {\ngl_Position = vec4((u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0)).xy, u_depth, 1.0);\n#ifdef PATTERN\nv_tileTextureCoord = (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\nv_tlbr             = u_tlbr / u_mosaicSize.xyxy;\n#endif\n}"},circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\nvoid main()\n{\nmediump float dist = length(v_offset);\nmediump float alpha = smoothstep(0.0, -v_blur, dist - 1.0);\nlowp float color_mix_ratio = v_stroke_width < 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\ngl_FragColor = alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n}","circle.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_circleTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_stroke_color = stroke_color * stroke_opacity;\nv_stroke_width = stroke_width;\nv_radius = radius;\nv_blur = max(blur, u_antialiasingWidth / (radius + stroke_width));\nmediump vec2 offset = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\nv_offset = offset;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos * 0.5, 1.0) + u_displayMat3 * vec3((v_radius + v_stroke_width) * offset + u_circleTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = fract(v_tileTextureCoord);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = v_color[3] * color;\n#else\ngl_FragColor = v_color;\n#endif\n}","fill.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_fillTranslation;\n#ifdef PATTERN\n#include <util/util.glsl>\nuniform mediump vec2 u_mosaicSize;\nuniform mediump float u_patternFactor;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\nvarying lowp vec4 v_color;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\n#ifdef PATTERN\nfloat patternWidth = nextPOT(tlbr.z - tlbr.x);\nfloat patternHeight = nextPOT(tlbr.w - tlbr.y);\nfloat scaleX = 1.0 / (patternWidth * u_patternFactor);\nfloat scaleY = 1.0 / (patternHeight * u_patternFactor);\nmat3 patterMat = mat3(scaleX, 0.0,    0.0,\n0.0,    -scaleY, 0.0,\n0.0,    0.0,    1.0);\nv_tileTextureCoord = (patterMat * vec3(a_pos, 1.0)).xy;\nv_tlbr             = tlbr / u_mosaicSize.xyxy;\n#endif\nvec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump flaot v_halo_width;\n#endif\n#include <util/encoding.glsl>\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\nlowp vec4 fillPixelColor = v_color;\nfloat d = rgba2float(texture2D(u_texture, v_tex)) - 0.5;\nconst float softEdgeRatio = 0.248062016;\nfloat size = max(v_size.x, v_size.y);\nfloat dist = d * softEdgeRatio * size;\nfillPixelColor *= clamp(0.5 - dist, 0.0, 1.0);\nif (v_halo_width > 0.25) {\nlowp vec4 outlinePixelColor = u_outlineColor;\nconst float outlineLimitRatio = (16.0 / 86.0);\nfloat clampedOutlineSize = softEdgeRatio * min(v_halo_width, outlineLimitRatio * max(v_size.x, v_size.y));\noutlinePixelColor *= clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\ngl_FragColor = v_opacity * mixColors(fillPixelColor, outlinePixelColor);\n}\nelse {\ngl_FragColor = v_opacity * fillPixelColor;\n}\n#else\nlowp vec4 texColor = texture2D(u_texture, v_tex);\ngl_FragColor = v_opacity * texColor;\n#endif\n}","icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump float v_halo_width;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_iconTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION = 1.0 / 8.0;\nconst float C_256_TO_RAD = 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD = 3.14159265359 / 180.0;\nconst float tileCoordRatio = 1.0 / 8.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nv_color = color;\nv_opacity = opacity;\n#ifdef SDF\nv_halo_width = halo_width;\n#endif\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_opacity *= interpolatedOpacity;\nmediump float a_angle         = a_levelInfo[1];\nmediump float a_minLevel      = a_levelInfo[2];\nmediump float a_maxLevel      = a_levelInfo[3];\nmediump vec2 a_tex            = a_texAngleRange.xy;\nmediump float delta_z = 0.0;\nmediump float rotated = mod(a_angle + u_mapRotation, 256.0);\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_opacity, 0.0);\nvec2 offset = C_OFFSET_PRECISION * a_vertexOffset;\nv_size = abs(offset);\n#ifdef SDF\noffset = (120.0 / 86.0) * offset;\n#endif\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayViewMat3 * vec3(size * offset, 0.0) + u_displayMat3 * vec3(u_iconTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\nv_tex = a_tex.xy / u_mosaicSize;\n}"},line:{"line.frag":"precision lowp float;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#if defined (PATTERN) || defined(SDF)\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\nuniform sampler2D u_texture;\nuniform mediump float u_antialiasing;\n#endif\n#ifdef SDF\n#include <util/encoding.glsl>\n#endif\nvoid main()\n{\nmediump float fragDist = length(v_normal) * v_lineHalfWidth;\nlowp float alpha = clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\nmediump float relativeTexX = fract(v_accumulatedDistance / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY = 0.5 + v_normal.y * v_lineHalfWidth / (v_patternSize.y * v_widthRatio);\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color = texture2D(u_texture, texCoord);\ngl_FragColor = alpha * v_color[3] * color;\n#elif defined(SDF)\nmediump float relativeTexX = fract((v_accumulatedDistance * 0.5) / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY =  0.5 + 0.25 * v_normal.y;\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d = rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist = d * (v_lineHalfWidth + u_antialiasing / 2.0);\ngl_FragColor = alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n#else\ngl_FragColor = alpha * v_color;\n#endif\n}","line.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_extrude_offset;\nattribute vec4 a_dir_normal;\nattribute vec2 a_accumulatedDistance;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump float u_zoomFactor;\nuniform mediump vec2 u_lineTranslation;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale = 1.0 / 31.0;\nconst mediump float tileCoordRatio = 8.0;\n#if defined (SDF)\nconst mediump float sdfPatternHalfWidth = 15.5;\n#endif\n#if defined (PATTERN) || defined(SDF)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_blur = blur + u_antialiasing;\nv_normal = a_dir_normal.zw * scale;\n#if defined (PATTERN) || defined(SDF)\nv_tlbr          = tlbr / u_mosaicSize.xyxy;\nv_patternSize   = vec2(tlbr.z - tlbr.x, tlbr.y - tlbr.w);\n#if defined (PATTERN)\nv_widthRatio = width / v_patternSize.y;\n#else\nv_widthRatio = width / sdfPatternHalfWidth / 2.0;\n#endif\n#endif\nv_lineHalfWidth = (width + u_antialiasing) * 0.5;\nmediump vec2 dir = a_dir_normal.xy * scale;\nmediump vec2 offset_ = a_extrude_offset.zw * scale * offset;\nmediump vec2 dist = v_lineHalfWidth * scale * a_extrude_offset.xy;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos + offset_ * tileCoordRatio / u_zoomFactor, 1.0) + u_displayViewMat3 * vec3(dist, 0.0) + u_displayMat3 * vec3(u_lineTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n#if defined (PATTERN) || defined(SDF)\nv_accumulatedDistance = a_accumulatedDistance.x * u_zoomFactor / tileCoordRatio + dot(dir, dist + offset_);\n#endif\n}"},outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\nvoid main()\n{\nlowp float dist = abs(v_normal.y);\nlowp float alpha = smoothstep(1.0, 0.0, dist);\ngl_FragColor = alpha * v_color;\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#pragma header\nvarying lowp vec4 v_color;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_fillTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale = 1.0 / 15.0;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_normal = a_xnormal;\nmediump vec2 dist = u_outline_width * scale * a_offset;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(dist + u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},text:{"text.frag":"uniform lowp sampler2D u_texture;\nvarying lowp vec2 v_tex;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\nvoid main()\n{\nlowp float dist = texture2D(u_texture, v_tex).a;\nmediump float alpha = smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist);\ngl_FragColor = alpha * v_color;\n}","text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_textTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying lowp vec2 v_tex;\nconst float offsetPrecision = 1.0 / 8.0;\nconst mediump float edgePos = 0.75;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nconst float sdfFontScale = 1.0 / 24.0;\nconst float sdfPixel = 3.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nif (u_halo > 0.5)\n{\nv_color = halo_color * opacity;\nhalo_width *= sdfPixel;\nhalo_blur *= sdfPixel;\n}\nelse\n{\nv_color = color * opacity;\nhalo_width = 0.0;\nhalo_blur = 0.0;\n}\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_color *= interpolatedOpacity;\nmediump float a_angle       = a_levelInfo[1];\nmediump float a_minLevel    = a_levelInfo[2];\nmediump float a_maxLevel    = a_levelInfo[3];\nmediump vec2 a_tex          = a_texAngleRange.xy;\nmediump float a_visMinAngle    = a_texAngleRange.z;\nmediump float a_visMaxAngle    = a_texAngleRange.w;\nmediump float delta_z = 0.0;\nmediump float angle = mod(a_angle + u_mapRotation, 256.0);\nif (a_visMinAngle < a_visMaxAngle)\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) + (1.0 - step(a_visMinAngle, angle)));\n}\nelse\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) * (1.0 - step(a_visMinAngle, angle)));\n}\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_color[3], 0.0);\nv_tex = a_tex.xy / u_mosaicSize;\nv_edgeDistance = edgePos - halo_width / size;\nv_edgeWidth = (u_antialiasingWidth + halo_blur) / size;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + sdfFontScale * u_displayViewMat3 * vec3(offsetPrecision * size * a_vertexOffset, 0.0) + u_displayMat3 * vec3(u_textTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n}"},util:{"encoding.glsl":"const vec4 rgba2float_factors = vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}","util.glsl":"float nextPOT(in float x) {\nreturn pow(2.0, ceil(log2(abs(x))));\n}"}},G=new(i(65644).Z)((function(t){let e=U;return t.split("/").forEach((t=>{e&&(e=e[t])})),e}));function H(t){return G.resolveIncludes(t)}var Y=i(72785);const W=t=>(0,Y.I)({PATTERN:t.pattern}),Z={shaders:t=>({vertexShader:W(t)+H("background/background.vert"),fragmentShader:W(t)+H("background/background.frag")})},q={shaders:t=>({vertexShader:H("circle/circle.vert"),fragmentShader:H("circle/circle.frag")})},X=t=>(0,Y.I)({PATTERN:t.pattern}),$={shaders:t=>({vertexShader:X(t)+H("fill/fill.vert"),fragmentShader:X(t)+H("fill/fill.frag")})},j={shaders:t=>({vertexShader:H("outline/outline.vert"),fragmentShader:H("outline/outline.frag")})},K=t=>(0,Y.I)({SDF:t.sdf}),Q={shaders:t=>({vertexShader:K(t)+H("icon/icon.vert"),fragmentShader:K(t)+H("icon/icon.frag")})},J=t=>(0,Y.I)({PATTERN:t.pattern,SDF:t.sdf}),tt={shaders:t=>({vertexShader:J(t)+H("line/line.vert"),fragmentShader:J(t)+H("line/line.frag")})},et={shaders:t=>({vertexShader:H("text/text.vert"),fragmentShader:H("text/text.frag")})};class it{constructor(){this._programByKey=new Map}dispose(){this._programByKey.forEach((t=>t.dispose())),this._programByKey.clear()}getMaterialProgram(t,e,i){const n=e.key<<3|this._getMaterialOptionsValue(e.type,i);if(this._programByKey.has(n))return this._programByKey.get(n);const r=this._getProgramTemplate(e.type),{shaders:s}=r,{vertexShader:o,fragmentShader:a}=s(i),l=e.getShaderHeader(),c=e.getShaderMain(),u=o.replace("#pragma header",l).replace("#pragma main",c),h=t.programCache.acquire(u,a,e.getAttributeLocations());return this._programByKey.set(n,h),h}_getMaterialOptionsValue(t,e){switch(t){case V.kh.BACKGROUND:case V.kh.FILL:return(e.pattern?1:0)<<1;case V.kh.OUTLINE:return 0;case V.kh.LINE:{const t=e;return(t.sdf?1:0)<<2|(t.pattern?1:0)<<1}case V.kh.ICON:return(e.sdf?1:0)<<1;case V.kh.CIRCLE:case V.kh.TEXT:default:return 0}}_getProgramTemplate(t){switch(t){case V.kh.BACKGROUND:return Z;case V.kh.CIRCLE:return q;case V.kh.FILL:return $;case V.kh.ICON:return Q;case V.kh.LINE:return tt;case V.kh.OUTLINE:return j;case V.kh.TEXT:return et;default:return null}}}var nt=i(94860),rt=i(52432),st=i(86305),ot=i(85456),at=i(10904),lt=i(81438);class ct{constructor(){this._initialized=!1}dispose(){this._program=(0,s.WD)(this._program),this._vertexArrayObject=(0,s.WD)(this._vertexArrayObject)}render(t,e,i,n){t&&(this._initialized||this._initialize(t),t.setBlendFunctionSeparate(ot.dn.ONE,ot.dn.ONE_MINUS_SRC_ALPHA,ot.dn.ONE,ot.dn.ONE_MINUS_SRC_ALPHA),t.bindVAO(this._vertexArrayObject),t.useProgram(this._program),e.setSamplingMode(i),t.bindTexture(e,0),this._program.setUniform1i("u_tex",0),this._program.setUniform1f("u_opacity",n),t.drawArrays(ot.WR.TRIANGLE_STRIP,0,4),t.bindTexture(null,0),t.bindVAO())}_initialize(t){if(this._initialized)return!0;const e=(0,at.r)(t,rt.J);if(!e)return!1;const i=new Int8Array(16);i[0]=-1,i[1]=-1,i[2]=0,i[3]=0,i[4]=1,i[5]=-1,i[6]=1,i[7]=0,i[8]=-1,i[9]=1,i[10]=0,i[11]=1,i[12]=1,i[13]=1,i[14]=1,i[15]=1;const n=rt.J.attributes,r=new lt.Z(t,n,nt.oI,{geometry:st.g.createVertex(t,ot._U.STATIC_DRAW,i)});return this._program=e,this._vertexArrayObject=r,this._initialized=!0,!0}}var ut=i(50437);class ht{constructor(t){this._rctx=t,this._programByKey=new Map}dispose(){this._programByKey.forEach((t=>t.dispose())),this._programByKey.clear()}getProgram(t,e=[]){const i=t.vsPath+"."+t.fsPath+JSON.stringify(e);if(this._programByKey.has(i))return this._programByKey.get(i);const n={...e.map((t=>"string"==typeof t?{name:t,value:!0}:t)).reduce(((t,e)=>({...t,[e.name]:e.value})),{})},{vsPath:r,fsPath:s,attributes:o}=t,a=(0,ut.p)(r,s,o,n),l=this._rctx.programCache.acquire(a.shaders.vertexShader,a.shaders.fragmentShader,a.attributes);if(!l)throw new Error("Unable to get program for key: ${key}");return this._programByKey.set(i,l),l}}var dt=i(25591),ft=i(93040),_t=i(90152),pt=i(60539),mt=i(66981),gt=i(84728),yt=i(82497);class vt{constructor(t){this._resourceManager=t,this._cachedRasterizationCanvas=null}dispose(){this._cachedRasterizationCanvas=null}get _canvas(){return this._cachedRasterizationCanvas||(this._cachedRasterizationCanvas=document.createElement("canvas")),this._cachedRasterizationCanvas}rasterizeJSONResource(t){switch(t.type){case"dash":{const e=t.dashTemplate,i=t.capStyle,[n,r,s]=(0,gt.k)(e,i);return{size:[r,s],image:new Uint32Array(n.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}case"fill-style":{const[e,i,n,r]=(0,gt.c)(this._canvas,t,S.nW);return{size:[i,n],image:new Uint32Array(e.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0,rasterizationScale:r}}case"sdf":return xt(t);case"CIMHatchFill":case"CIMVectorMarker":case"CIMPictureMarker":return this._rasterizeCIMJSONResource(t)}}_rasterizeCIMJSONResource(t){switch(t.type){case"CIMHatchFill":{const e=p.wp.fromCIMHatchFill(t,S.nW);return this._rasterizeCIMVectorMarker(e)}case"CIMPictureMarker":{const e=p.wp.fromCIMInsidePolygon(t);return this._rasterizeCIMVectorMarker(e)}case"CIMVectorMarker":{if("CIMMarkerPlacementInsidePolygon"===t.markerPlacement?.type){const e=p.wp.fromCIMInsidePolygon(t);return this._rasterizeCIMVectorMarker(e)}const e=(0,v.eR)(t);return e&&!t.avoidSDFRasterization?xt(e):this._rasterizeCIMVectorMarker(t,!1)}}}_rasterizeCIMVectorMarker(t,e=!0){const i=e?yt.A.fromExtent(t.frame):null,[n,r,s,o,a]=p.wp.rasterize(this._canvas,t,i,this._resourceManager);return n?{size:[r,s],image:new Uint32Array(n.buffer),sdf:!1,simplePattern:!1,anchorX:o,anchorY:a}:null}rasterizeImageResource(t,e,i,n){this._canvas.width=t,this._canvas.height=e;const r=this._canvas.getContext("2d",{willReadFrequently:!0});i instanceof ImageData?r.putImageData(i,0,0):(i.setAttribute("width",`${t}px`),i.setAttribute("height",`${e}px`),r.drawImage(i,0,0,t,e));const s=r.getImageData(0,0,t,e),o=new Uint8Array(s.data);if(n)for(const t of n)if(t&&t.oldColor&&4===t.oldColor.length&&t.newColor&&4===t.newColor.length){const[e,i,n,r]=t.oldColor,[s,a,l,c]=t.newColor;if(e===s&&i===a&&n===l&&r===c)continue;for(let t=0;t<o.length;t+=4)e===o[t]&&i===o[t+1]&&n===o[t+2]&&r===o[t+3]&&(o[t]=s,o[t+1]=a,o[t+2]=l,o[t+3]=c)}let a;for(let t=0;t<o.length;t+=4)a=o[t+3]/255,o[t]=o[t]*a,o[t+1]=o[t+1]*a,o[t+2]=o[t+2]*a;let l=o,c=t,u=e;const h=512;if(c>=h||u>=h){const i=c/u;i>1?(c=h,u=Math.round(h/i)):(u=h,c=Math.round(h*i)),l=new Uint8Array(4*c*u);const n=new Uint8ClampedArray(l.buffer);(0,x.Go)(o,t,e,n,c,u,!1)}return{size:[c,u],image:new Uint32Array(l.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}function xt(t){if(!t)return null;const[e,i,n]=(0,v.ce)(t);return e?{size:[i,n],image:new Uint32Array(e.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}:null}var bt=i(54904);class St{constructor(t,e){this._width=0,this._height=0,this._free=[],this._width=t,this._height=e,this._free.push(new bt.A(0,0,t,e))}get width(){return this._width}get height(){return this._height}allocate(t,e){if(t>this._width||e>this._height)return new bt.A;let i=null,n=-1;for(let r=0;r<this._free.length;++r){const s=this._free[r];t<=s.width&&e<=s.height&&(null===i||s.y<=i.y&&s.x<=i.x)&&(i=s,n=r)}return null===i?new bt.A:(this._free.splice(n,1),i.width<i.height?(i.width>t&&this._free.push(new bt.A(i.x+t,i.y,i.width-t,e)),i.height>e&&this._free.push(new bt.A(i.x,i.y+e,i.width,i.height-e))):(i.width>t&&this._free.push(new bt.A(i.x+t,i.y,i.width-t,i.height)),i.height>e&&this._free.push(new bt.A(i.x,i.y+e,t,i.height-e))),new bt.A(i.x,i.y,t,e))}release(t){for(let e=0;e<this._free.length;++e){const i=this._free[e];if(i.y===t.y&&i.height===t.height&&i.x+i.width===t.x)i.width+=t.width;else if(i.x===t.x&&i.width===t.width&&i.y+i.height===t.y)i.height+=t.height;else if(t.y===i.y&&t.height===i.height&&t.x+t.width===i.x)i.x=t.x,i.width+=t.width;else{if(t.x!==i.x||t.width!==i.width||t.y+t.height!==i.y)continue;i.y=t.y,i.height+=t.height}this._free.splice(e,1),this.release(t)}this._free.push(t)}}var wt=i(78541),Tt=i(10956);const Mt=t=>Math.floor(t/256);class Pt{constructor(t,e,i){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphCache={},this._textures=[],this._rangePromises=new Map,this._preloadCache={},this.width=t,this.height=e,this._glyphSource=i,this._binPack=new St(t-4,e-4),this._glyphData.push(new Uint8Array(t*e)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyphs()}dispose(){this._binPack=null;for(const t of this._textures)t&&t.dispose();this._textures.length=0,this._glyphData.length=0}_initDecorationGlyphs(){const t=[117,149,181,207,207,181,149,117],e=[],i=[];for(let n=0;n<t.length;n++){const r=t[n];for(let t=0;t<11;t++){const s=n>=3&&n<5&&t>=3&&t<8?255:0;e.push(r),i.push(s)}}const n={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(e)},r={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(i)};this._recordGlyph(n),this._recordGlyph(r)}getTexture(t,e){if(!this._textures[e]){const i=new Tt.R;i.pixelFormat=ot.Ab.ALPHA,i.wrapMode=ot.pF.CLAMP_TO_EDGE,i.width=this.width,i.height=this.height,this._textures[e]=new wt.g(t,i,new Uint8Array(this.width*this.height))}return this._dirties[e]&&(this._textures[e].setData(this._glyphData[e]),this._dirties[e]=!1),this._textures[e]}async getGlyphItems(t,e,i){const n=this._getGlyphCache(t);return await this._fetchRanges(t,e,i),e.map((e=>this._getMosaicItem(n,t,e)))}bind(t,e,i,n){const r=this.getTexture(t,i);r.setSamplingMode(e),t.bindTexture(r,n)}preloadASCIIGlyphCache(t){const e=this._preloadCache[t];if(null!=e)return e;const i=this._glyphSource.preloadASCIIRange(t).then((()=>{const e=this._getGlyphCache(t);for(let i=0;i<256;i++)this._getMosaicItem(e,t,i)}));return this._preloadCache[t]=i,i}_getGlyphCache(t){return this._glyphCache[t]||(this._glyphCache[t]={}),this._glyphCache[t]}_invalidate(){this._dirties[this._currentPage]=!0}async _fetchRanges(t,e,i){const n=function(t){const e=new Set;for(const i of t)e.add(Mt(i));return e}(e),r=[];n.forEach((e=>{r.push(this._fetchRange(t,e,i))})),await Promise.all(r)}async _fetchRange(t,e,i){if(e>256)return;const n=t+e;return function(t,e,i){return t.has(e)||t.set(e,i().then((()=>{t.delete(e)})).catch((i=>{t.delete(e),(0,pt.jH)(i)}))),t.get(e)}(this._rangePromises,n,(()=>this._glyphSource.getRange(t,e,i)))}_getMosaicItem(t,e,i){if(!t[i]){const n=this._glyphSource.getGlyph(e,i);if(!n?.metrics)return(t=>({rect:new bt.A(0,0,0,0),page:0,metrics:{left:0,width:0,height:0,advance:0,top:0},code:t,sdf:!0}))(i);const r=this._recordGlyph(n),s=this._currentPage,o=n.metrics;t[i]={rect:r,page:s,metrics:o,code:i,sdf:!0},this._invalidate()}return t[i]}_recordGlyph(t){const e=t.metrics;let i;if(0===e.width)i=new bt.A(0,0,0,0);else{const n=3,s=e.width+2*n,o=e.height+2*n;i=this._binPack.allocate(s,o),i.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyphs(),this._binPack=new St(this.width-4,this.height-4),i=this._binPack.allocate(s,o));const a=this._glyphData[this._currentPage],l=t.bitmap;let c,u;if(l)for(let t=0;t<o;t++){c=s*t,u=this.width*(i.y+t)+i.x;for(let t=0;t<s;t++)a[u+t]=l[c+t]}(0,r.A)("esri-glyph-debug")&&this._showDebugPage(a)}return i}_showDebugPage(t){const e=document.createElement("canvas"),i=e.getContext("2d"),n=new ImageData(this.width,this.height),r=n.data;e.width=this.width,e.height=this.height,e.style.border="1px solid black";for(let e=0;e<t.length;++e)r[4*e]=t[e],r[4*e+1]=0,r[4*e+2]=0,r[4*e+3]=255;i.putImageData(n,0,0),document.body.appendChild(e)}}var Et=i(68225);class At{constructor(t){for(this._metrics=[],this._bitmaps=[];t.next();)switch(t.tag()){case 1:{const e=t.getMessage();for(;e.next();)switch(e.tag()){case 3:{const t=e.getMessage();let i,n,r,s,o,a,l;for(;t.next();)switch(t.tag()){case 1:i=t.getUInt32();break;case 2:n=t.getBytes();break;case 3:r=t.getUInt32();break;case 4:s=t.getUInt32();break;case 5:o=t.getSInt32();break;case 6:a=t.getSInt32();break;case 7:l=t.getUInt32();break;default:t.skip()}t.release(),i&&(this._metrics[i]={width:r,height:s,left:o,top:a,advance:l},this._bitmaps[i]=n);break}default:e.skip()}e.release();break}default:t.skip()}}getMetrics(t){return this._metrics[t]}getBitmap(t){return this._bitmaps[t]}}class Ct{constructor(){this._ranges=[]}getRange(t){return this._ranges[t]}addRange(t,e){this._ranges[t]=e}}class It{constructor(t){this._glyphInfo={},this._baseURL=t}getRange(t,e,i){const n=this._getFontStack(t);if(n.getRange(e))return Promise.resolve();const r=256*e,s=r+255,o=this._baseURL.replace("{fontstack}",t).replace("{range}",r+"-"+s);return(0,ft.A)(o,{responseType:"array-buffer",...i}).then((t=>{n.addRange(e,new At(new Et.A(new Uint8Array(t.data),new DataView(t.data))))}))}async preloadASCIIRange(t){const e=this._getFontStack(t),i=this._baseURL.replace("{fontstack}",t).replace("{range}","0-255"),n=await(0,ft.A)(i,{responseType:"array-buffer"}),r=new At(new Et.A(new Uint8Array(n.data),new DataView(n.data)));for(let t=0;t<=255;t++)e.getRange(t)||e.addRange(t,r)}getGlyph(t,e){const i=this._getFontStack(t);if(!i)return;const n=Math.floor(e/256),r=i.getRange(n);return r?{metrics:r.getMetrics(e),bitmap:r.getBitmap(e)}:void 0}_getFontStack(t){let e=this._glyphInfo[t];return e||(e=this._glyphInfo[t]=new Ct),e}}var Rt=i(5161);const Ot=1e20;class Ft{constructor(t,e=2){this._textureSize=t,this._rasterizationScale=e,this._canvasSize=this._textureSize*this._rasterizationScale,this._svg=null;const{_canvasSize:i}=this,n=document.createElement("canvas");n.width=n.height=i,this._context=n.getContext("2d",{willReadFrequently:!1}),this._gridOuter=new Float64Array(i*i),this._gridInner=new Float64Array(i*i),this._f=new Float64Array(i),this._d=new Float64Array(i),this._z=new Float64Array(i+1),this._v=new Int16Array(i)}dispose(){this._context=this._gridOuter=this._gridInner=this._f=this._d=this._z=this._v=null,this._svg&&(document.body.removeChild(this._svg),this._svg=null)}draw(t,e,i){const{_canvasSize:n,_textureSize:r,_rasterizationScale:s}=this,o=r/4;this._initSVG();const a=this.createSVGString(t,e);return new Promise(((t,e)=>{const l=new Image;l.src="data:image/svg+xml; charset=utf8, "+encodeURIComponent(a),l.onload=()=>{l.onload=null,this._context.clearRect(0,0,n,n),this._context.drawImage(l,0,0,n,n);const e=this._context.getImageData(0,0,n,n),i=new Uint8Array(r*r*4);for(let t=0;t<n*n;t++){const i=e.data[4*t+3]/255;this._gridOuter[t]=1===i?0:0===i?Ot:Math.max(0,.5-i)**2,this._gridInner[t]=1===i?Ot:0===i?0:Math.max(0,i-.5)**2}this._edt(this._gridOuter,n,n),this._edt(this._gridInner,n,n);for(let t=0;t<r*r;t++){let e=0;for(let i=0;i<s;i++){const o=Math.floor(t/r)*s+i;for(let i=0;i<s;i++){const a=o*n+(t%r*s+i);e+=this._gridOuter[a]-this._gridInner[a]}}e/=s*s,e/=s,(0,Rt.U)(.5-e/(2*o),i,4*t)}t(i)};const c=i?.signal;c&&(0,pt.u7)(c,(()=>e((0,pt.NK)())))}))}_initSVG(){if(!this._svg){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("style","position: absolute;"),t.setAttribute("width","0"),t.setAttribute("height","0"),t.setAttribute("aria-hidden","true"),t.setAttribute("role","presentation"),document.body.appendChild(t),this._svg=t}return this._svg}createSVGString(t,e){const i=this._initSVG(),n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d",t),i.appendChild(n);const r=n.getBBox(),s=r.width/r.height,o=this._canvasSize/2;let a,l,c;if(s>1){a=o/r.width;const t=o*(1/s);l=this._canvasSize/4,c=o-t/2}else a=o/r.height,l=o-o*s/2,c=this._canvasSize/4;const u=-r.x*a+l,h=-r.y*a+c;n.setAttribute("style",`transform: matrix(${a}, 0, 0, ${a}, ${u}, ${h})`),n.setAttribute("stroke-width",""+.5/a);const d=`<svg style="fill:${e?"red":"none"}; stroke:${e?"none":"red"}" height="${this._canvasSize}" width="${this._canvasSize}" xmlns="http://www.w3.org/2000/svg">${i.innerHTML}</svg>`;return i.removeChild(n),d}_edt(t,e,i){const n=this._f,r=this._d,s=this._v,o=this._z;for(let a=0;a<e;a++){for(let r=0;r<i;r++)n[r]=t[r*e+a];this._edt1d(n,r,s,o,i);for(let n=0;n<i;n++)t[n*e+a]=r[n]}for(let a=0;a<i;a++){for(let i=0;i<e;i++)n[i]=t[a*e+i];this._edt1d(n,r,s,o,e);for(let i=0;i<e;i++)t[a*e+i]=Math.sqrt(r[i])}}_edt1d(t,e,i,n,r){i[0]=0,n[0]=-Ot,n[1]=+Ot;for(let e=1,s=0;e<r;e++){let r=(t[e]+e*e-(t[i[s]]+i[s]*i[s]))/(2*e-2*i[s]);for(;r<=n[s];)s--,r=(t[e]+e*e-(t[i[s]]+i[s]*i[s]))/(2*e-2*i[s]);s++,i[s]=e,n[s]=r,n[s+1]=+Ot}for(let s=0,o=0;s<r;s++){for(;n[o+1]<s;)o++;e[s]=(s-i[o])*(s-i[o])+t[i[o]]}}}var zt=i(36753);function Dt(t){return t&&"static"===t.type}class Lt{constructor(t,e,i=0){this._mosaicPages=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects=new Map,this._spriteCopyQueue=[],this.pixelRatio=1,this._pageWidth=t,this._pageHeight=e,i>0&&(this._maxItemSize=i),this.pixelRatio=window.devicePixelRatio||1,this._binPack=new St(this._pageWidth,this._pageHeight);const n=Math.floor(this._pageWidth),r=Math.floor(this._pageHeight);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(n*r)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0})}getWidth(t){return t>=this._mosaicPages.length?-1:this._mosaicPages[t].size[0]}getHeight(t){return t>=this._mosaicPages.length?-1:this._mosaicPages[t].size[1]}getPageTexture(t){return t<this._mosaicPages.length?this._mosaicPages[t].texture:null}has(t){return this._mosaicRects.has(t)}get itemCount(){return this._mosaicRects.size}getSpriteItem(t){return this._mosaicRects.get(t)}addSpriteItem(t,e,i,n,s,o,a=1){if(this._mosaicRects.has(t))return this._mosaicRects.get(t);let l,c,u;if(Dt(i))[l,c,u]=this._allocateImage(e[0],e[1]);else{l=new bt.A(0,0,e[0],e[1]),c=this._mosaicPages.length;const t=void 0;this._mosaicPages.push({mosaicsData:i,size:[e[0]+2*S.hM,e[1]+2*S.hM],dirty:!0,texture:t})}if(l.width<=0||l.height<=0)return null;const h={type:"sprite",rect:l,width:e[0],height:e[1],sdf:s,simplePattern:o,rasterizationScale:a,page:c};return this._mosaicRects.set(t,h),Dt(i)&&((0,r.A)("esri-mosaic-debug")&&this._showDebugSprite(e,i.data),this._copy({rect:l,spriteSize:e,spriteData:i.data,page:c,pageSize:u,repeat:n,sdf:s})),h}hasItemsToProcess(){return 0!==this._spriteCopyQueue.length}processNextItem(){const t=this._spriteCopyQueue.pop();t&&this._copy(t)}getMosaicItemPosition(t){const e=this.getSpriteItem(t),i=e?.rect;if(!i)return null;i.width=e.width,i.height=e.height;const n=e.width,r=e.height,s=S.hM,o=this._mosaicPages[e.page].size;return{size:[e.width,e.height],tl:[(i.x+s)/o[0],(i.y+s)/o[1]],br:[(i.x+s+n)/o[0],(i.y+s+r)/o[1]],page:e.page}}bind(t,e,i=0,n=0){const s=this._mosaicPages[i],o=s.mosaicsData;let a=s.texture;a||(a=Bt(t,s.size),s.texture=a),a.setSamplingMode(e),Dt(o)?(t.bindTexture(a,n),s.dirty&&(a.setData(new Uint8Array(o.data.buffer)),a.generateMipmap(),(0,r.A)("esri-mosaic-debug")&&this._showDebugPage(i))):(o.data.loadFrame(a),t.bindTexture(a,n),a.generateMipmap()),s.dirty=!1}getTexture(t,e=0){const i=this._mosaicPages[e],n=i.mosaicsData;let s=i.texture;return s||(s=Bt(t,i.size),i.texture=s),Dt(n)?i.dirty&&(s.setData(new Uint8Array(n.data.buffer)),s.generateMipmap(),(0,r.A)("esri-mosaic-debug")&&this._showDebugPage(e)):(n.data.loadFrame(s),s.generateMipmap()),i.dirty=!1,s}dispose(){this._binPack=null;for(const t of this._mosaicPages){const e=t.texture;e&&e.dispose();const i=t.mosaicsData;Dt(i)||i.data.destroy()}this._mosaicPages=null,this._mosaicRects.clear()}static _copyBits(t,e,i,n,r,s,o,a,l,c,u){let h=n*e+i,d=a*s+o;if(u){d-=s;for(let o=-1;o<=c;o++,h=((o+c)%c+n)*e+i,d+=s)for(let e=-1;e<=l;e++)r[d+e]=t[h+(e+l)%l]}else for(let i=0;i<c;i++){for(let e=0;e<l;e++)r[d+e]=t[h+e];h+=e,d+=s}}_copy(t){if(t.page>=this._mosaicPages.length)return;const e=this._mosaicPages[t.page],i=e.mosaicsData;if(!Dt(e.mosaicsData))throw new n.A("mapview-invalid-resource","unsuitable data type!");const r=t.spriteData,s=i.data;Lt._copyBits(r,t.spriteSize[0],0,0,s,t.pageSize[0],t.rect.x+S.hM,t.rect.y+S.hM,t.spriteSize[0],t.spriteSize[1],t.repeat),e.dirty=!0}_allocateImage(t,e){t+=2*S.hM,e+=2*S.hM;const i=Math.max(t,e);if(this._maxItemSize&&this._maxItemSize<i){const i=2**Math.ceil((0,zt.p6)(t)),n=2**Math.ceil((0,zt.p6)(e)),r=new bt.A(0,0,t,e);return this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(i*n)},size:[i,n],dirty:!0,texture:void 0}),[r,this._mosaicPages.length-1,[i,n]]}const n=this._binPack.allocate(t,e);if(n.width<=0){const i=this._mosaicPages[this._currentPage];return!i.dirty&&Dt(i.mosaicsData)&&(i.mosaicsData.data=null),this._currentPage=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(this._pageWidth*this._pageHeight)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0}),this._binPack=new St(this._pageWidth,this._pageHeight),this._allocateImage(t,e)}return[n,this._currentPage,[this._pageWidth,this._pageHeight]]}_showDebugSprite([t,e],i){const n=document.createElement("canvas");n.width=t,n.height=e,n.setAttribute("style",`position: absolute; top: ${4+204*Nt++}px; right: 208px; width: 200px; height: 200px; border: 1px solid black;`);const r=n.getContext("2d"),s=new ImageData(t,e);s.data.set(new Uint8Array(i.buffer)),r.putImageData(s,0,0),document.body.appendChild(n)}_showDebugPage(t){const e=this._mosaicPages[t],{size:[i,n],mosaicsData:r}=e;if(!Dt(r))return;const s=`mosaicDebugPage${t}`,o=document.getElementById(s)??document.createElement("canvas");o.id=s,o.width=i,o.height=n,o.setAttribute("style",`position: absolute; top: ${4+204*t}px; right: 4px; width: 200px; height: 200px; border: 1px solid black;`);const a=o.getContext("2d"),l=new ImageData(i,n);l.data.set(new Uint8Array(r.data.buffer)),a.putImageData(l,0,0),document.body.appendChild(o)}}let Nt=0;function Bt(t,e){const i=new Tt.R;return i.width=e[0],i.height=e[1],i.wrapMode=ot.pF.CLAMP_TO_EDGE,new wt.g(t,i,null)}var kt=i(88413),Vt=i(93937);class Ut{constructor(t,e,i,n){this._animation=t,this._frameData=null,this.frameCount=this._animation.frameDurations.length,this.width=this._animation.width,this.height=this._animation.height,this._playHandle=(0,Vt.ZH)(this._animation,i,n,(t=>{this._frameData=t,e.requestRender()}))}destroy(){this._playHandle.remove()}loadFrame(t){const e=this._frameData;if(null==e)return;const i="width"in e?e.width:e.codedWidth,n="height"in e?e.height:e.codedHeight;t.updateData(0,S.hM,S.hM,i,n,e),this._frameData=null}}var Gt=i(46863);const Ht="arial-unicode-ms-regular",Yt=(t,e,i)=>d.A.getLogger("esri.views.2d.engine.webgl.TextureManager").error(new n.A(t,e,i));class Wt{static fromMosaic(t,e){return new Wt(t,e.page,e.sdf)}constructor(t,e,i){this.mosaicType=t,this.page=e,this.sdf=i}}class Zt{constructor(t){this._requestRender=t,this._resourceManager=new mt.A,this._invalidFontsMap=new Map,this._sdfConverter=new Ft(S.yA),this._bindingInfos=new Array,this._hashToBindingIndex=new Map,this._ongoingRasterizations=new Map,this._imageRequestQueue=new Gt.e({concurrency:10,process:async(t,e)=>{(0,pt.Te)(e);try{return await(0,ft.A)(t,{responseType:"image",signal:e})}catch(e){if(!(0,pt.zf)(e))throw new n.A("mapview-invalid-resource",`Could not fetch requested resource at ${t}`,e);throw e}}}),this._spriteMosaic=new Lt(2048,2048,500),this._glyphSource=new It(`${dt.default.fontsUrl}/{fontstack}/{range}.pbf`),this._glyphMosaic=new Pt(1024,1024,this._glyphSource),this._rasterizer=new vt(this.resourceManager)}dispose(){this._spriteMosaic.dispose(),this._glyphMosaic.dispose(),this._rasterizer.dispose(),this._sdfConverter.dispose(),this._spriteMosaic=null,this._glyphMosaic=null,this._sdfConverter=null,this._hashToBindingIndex.clear(),this._hashToBindingIndex=null,this._bindingInfos=null,this._ongoingRasterizations.clear(),this._ongoingRasterizations=null,this._imageRequestQueue.clear(),this._imageRequestQueue=null,this._resourceManager.destroy()}get sprites(){return this._spriteMosaic}get glyphs(){return this._glyphMosaic}get resourceManager(){return this._resourceManager}async rasterizeItem(t,e){if(null==t)return Yt("mapview-null-resource","Unable to rasterize null resource"),null;if("cim-rasterization-info"!==t.type)return Yt("mapview-unexpected-resource","Unable to rasterize resource"),null;const{resource:i}=t;if("text"===i.type){const t=await this._rasterizeText(i,e);for(const e of t.glyphs)this._setTextureBinding(B.Be.GLYPH,e);return t}const n=await this._rasterizeSprite(i,e);return n&&this._setTextureBinding(B.Be.SPRITE,n),n}getMosaicInfo(t,e,i=!1){const n=this._getTextureBindingInfo(t,e,i);return n?{size:n.size,texture:{texture:n.texture,unit:"sprite"===n.type?S.Pq:S.ue}}:(Yt("mapview-invalid-resource",`Unable to find resource for ${e}`),{size:[0,0],texture:{texture:null,unit:0}})}_getTextureBindingInfo(t,e,i){const n=this._bindingInfos[e-1],r=n.page,s=i?ot.Cj.LINEAR_MIPMAP_LINEAR:ot.Cj.LINEAR;switch(n.mosaicType){case B.Be.SPRITE:{const e=[this.sprites.getWidth(r),this.sprites.getHeight(r)],i=this._spriteMosaic.getTexture(t,r);return i.setSamplingMode(s),{type:"sprite",texture:i,size:e}}case B.Be.GLYPH:{const e=[this.glyphs.width,this.glyphs.height],i=this._glyphMosaic.getTexture(t,r);return this._glyphMosaic.bind(t,s,r,S.ue),i.setSamplingMode(s),{type:"glyph",texture:i,size:e}}default:return Yt("mapview-texture-manager",`Cannot handle unknown type ${n.mosaicType}`),null}}_hashMosaic(t,e){return 1|t<<1|(e.sdf?1:0)<<2|e.page<<3}_setTextureBinding(t,e){const i=this._hashMosaic(t,e);if(!this._hashToBindingIndex.has(i)){const n=Wt.fromMosaic(t,e),r=this._bindingInfos.length+1;this._hashToBindingIndex.set(i,r),this._bindingInfos.push(n)}e.textureBinding=this._hashToBindingIndex.get(i)}async _rasterizeText(t,e){const{font:i,textString:n}=t,s=(0,u.rK)(i),o=this._invalidFontsMap.has(s),[a,l]=(0,_t.y)(n),c=(0,kt.bX)(a);try{const t=o?Ht:s;return(0,r.A)("esri-2d-stabilize-glyphs")&&await this._glyphMosaic.preloadASCIIGlyphCache(t),{type:"glyphs",glyphs:await this._glyphMosaic.getGlyphItems(t,c,e),isRightToLeft:l}}catch(t){return Yt("mapview-invalid-resource",`Couldn't find font ${s}. Falling back to Arial Unicode MS Regular`),this._invalidFontsMap.set(s,!0),{type:"glyphs",glyphs:await this._glyphMosaic.getGlyphItems(Ht,c,e),isRightToLeft:l}}}_hashSpriteResource(t){switch(t.type){case"path":return`path:${t.path}.${t.asFill?1:0}`;case"CIMPictureMarker":return`${t.type}:${t.url}:${t.size}`;case"CIMPictureFill":return`${t.type}:${t.url}:${t.height}`;case"CIMPictureStroke":return`${t.type}:${t.url}:${t.width}`;case"dash":return`dash:${t.capStyle}.${t.dashTemplate.join("")}`;case"sdf":return`sdf:${JSON.stringify(t.geom)}.${t.asFill?1:0}`;case"fill-style":return`fill_style:${t.style}`;case"animated":return JSON.stringify((0,kt.IF)(t));case"CIMHatchFill":case"CIMVectorMarker":return JSON.stringify(t)}}async _rasterizeSprite(t,e){if(!t)return null;const i=(0,_.Wm)(this._hashSpriteResource(t));if(this._spriteMosaic.has(i))return this._spriteMosaic.getSpriteItem(i);if("url"in t&&t.url||"CIMPictureFill"===t.type||"CIMPictureStroke"===t.type||"CIMPictureMarker"===t.type||"CIMVectorMarker"===t.type){const e=[];p.wp.fetchResources({type:"CIMPointSymbol",symbolLayers:[t]},this._resourceManager,e),e.length>0&&await Promise.all(e)}switch(t.type){case"CIMPictureMarker":return"CIMMarkerPlacementInsidePolygon"===t.markerPlacement?.type?this._rasterizeJSONResource(i,t):this._handleAsyncResource(i,t,e);case"animated":case"CIMPictureFill":case"CIMPictureStroke":case"path":return this._handleAsyncResource(i,t,e);case"sdf":case"dash":case"fill-style":case"CIMVectorMarker":case"CIMHatchFill":return this._rasterizeJSONResource(i,t)}}_rasterizeJSONResource(t,e){const i=this._rasterizer.rasterizeJSONResource(e);if(i){const{size:n,image:r,sdf:s,simplePattern:o,rasterizationScale:a}=i;return this._addItemToMosaic(t,n,{type:"static",data:r},qt(e),s,o,a)}return null}async _handleAsyncResource(t,e,i){if(this._ongoingRasterizations.has(t))return this._ongoingRasterizations.get(t);let n;return n="path"===e.type?this._handleSVG(e,t,i):this._handleImage(e,t,i),this._ongoingRasterizations.set(t,n),n.finally((()=>this._ongoingRasterizations.delete(t))),n}async _handleSVG(t,e,i){const n=[S.yA,S.yA],{asFill:r}=t,s=await this._sdfConverter.draw(t.path,r,i);return this._addItemToMosaic(e,n,{type:"static",data:new Uint32Array(s.buffer)},!1,!0,!0)}async _handleGIFOrPNG(t,e,i){const n=t.url,r=this.resourceManager.getResource(n);if(null==r)return null;const{width:s,height:o}=r;if(r instanceof HTMLImageElement){if("animated"===t.type)return Yt("mapview-unexpected-resource","Attempt to configure animations for a non-animated image."),null;const i="colorSubstitutions"in t?t.colorSubstitutions:void 0,{size:n,sdf:a,image:l}=this._rasterizer.rasterizeImageResource(s,o,r,i);return this._addItemToMosaic(e,n,{type:"static",data:l},qt(t),a,!1)}let a,l,c;"animated"===t.type?(a=!1,l={playAnimation:t.playAnimation,reverseAnimation:t.reverseAnimation,randomizeStartTime:t.randomizeStartTime,randomizeStartSeed:t.randomizeStartSeed,startTimeOffset:t.startTimeOffset,duration:t.duration,repeatType:t.repeatType,repeatDelay:t.repeatDelay},c=t.startGroup||0):(a=qt(t),l={},c=0);const u=new Ut(r,this._requestRender,l,c);return this._addItemToMosaic(e,[u.width,u.height],{type:"animated",data:u},a,!1,!1)}async _handleImage(t,e,i){const r=t.url;if(Xt(r)||$t(r))return this._handleGIFOrPNG(t,e,i);if("animated"===t.type)return Yt("mapview-unexpected-resource","Attempt to configure animations for a non-animated image."),null;try{let n;const s=this.resourceManager.getResource(r);if(null!=s&&s instanceof HTMLImageElement)n=s;else{const{data:t}=await this._imageRequestQueue.push(r,{...i});n=t}if((0,kt.UE)(r))if("width"in t&&"height"in t)n.width=(0,f.Lz)(t.width),n.height=(0,f.Lz)(t.height);else if("cim"in t){const e=t;n.width=(0,f.Lz)(e.width??e.scaleX*e.size),n.height=(0,f.Lz)(e.size)}if(!n.width||!n.height)return null;const o=n.width,a=n.height,l="colorSubstitutions"in t?t.colorSubstitutions:void 0,{size:c,sdf:u,image:h}=this._rasterizer.rasterizeImageResource(o,a,n,l);return this._addItemToMosaic(e,c,{type:"static",data:h},qt(t),u,!1)}catch(t){if(!(0,pt.zf)(t))throw new n.A("mapview-invalid-resource",`Could not fetch requested resource at ${r}. ${t.message}`);throw t}}_addItemToMosaic(t,e,i,n,r,s,o){return this._spriteMosaic.addSpriteItem(t,e,i,n,r,s,o)}}function qt(t){switch(t.type){case"CIMVectorMarker":case"CIMPictureMarker":return jt(t);default:return!0}}const Xt=t=>t&&(t.includes(".gif")||(t=>null!=t&&t.startsWith("data:image/gif"))(t)),$t=t=>t&&(t.includes(".png")||(t=>null!=t&&t.startsWith("data:image/png"))(t)),jt=t=>t&&"markerPlacement"in t&&t.markerPlacement&&"CIMMarkerPlacementInsidePolygon"===t.markerPlacement.type;class Kt{constructor(t){this._queue=[],this._refreshable=t}destroy(){this._queue=[]}enqueueTextureUpdate(t,e){const i=(0,pt.Tw)(),n=t,r=S.Qb,s=Math.ceil(n.height/r);(0,pt.Te)(e);for(let o=0;o<s;o++){const a=o*r,l=o===s-1,c=l?n.height-r*o:r;this._queue.push({type:"chunk",request:t,resolver:i,chunk:o,chunkOffset:a,destHeight:c,chunkIsLast:l,options:e})}return(0,pt.NY)(e,(t=>i.reject(t))),i.promise}upload(){let t=0;for(;this._queue.length;){const e=performance.now(),i=this._queue.shift();if(i){if(null!=i.options.signal&&i.options.signal.aborted)continue;switch(i.type){case"chunk":this._uploadChunk(i);break;case"no-chunk":this._uploadNoChunk(i)}const n=performance.now()-e;if(t+=n,t+n>=S.r1)break}}this._queue.length&&this._refreshable.requestRender()}_uploadChunk(t){const{request:e,resolver:i,chunkOffset:n,chunkIsLast:r,destHeight:s}=t,{data:o,texture:a,width:l}=e;null!=o&&(a.updateData(0,0,n,l,s,o,n),r&&i.resolve())}_uploadNoChunk(t){const{request:e,resolver:i}=t,{data:n,texture:r}=e;r.setData(n),i.resolve()}}var Qt=i(77416),Jt=i(8527),te=i(44705),ee=i(1932),ie=i(20551),ne=i(32501),re=i(21024);const se=(0,ee.fA)(-.5,-.5);class oe{constructor(){this._centerNdc=(0,ne.vt)(),this._pxToNdc=(0,ne.vt)(),this._worldDimensionsPx=(0,ne.vt)(),this._mat3=(0,l.vt)(),this._initialized=!1}dispose(){this._program=(0,s.WD)(this._program),this._quad=(0,s.WD)(this._quad)}render(t,e,i){const{context:n}=t,r=this._updateGeometry(t,i);if(null!=e){const{r:t,g:i,b:r,a:s}=e;n.setClearColor(s*t/255,s*i/255,s*r/255,s)}else n.setClearColor(0,0,0,0);if(n.setStencilFunction(ot.MT.ALWAYS,0,255),n.setStencilWriteMask(255),!r)return n.setClearStencil(1),void n.clear(n.gl.STENCIL_BUFFER_BIT|n.gl.COLOR_BUFFER_BIT);n.setClearStencil(0),n.clear(n.gl.STENCIL_BUFFER_BIT|n.gl.COLOR_BUFFER_BIT),this._initialized||this._initialize(n),n.setDepthWriteEnabled(!1),n.setDepthTestEnabled(!1),n.setColorMask(!1,!1,!1,!1),n.setBlendingEnabled(!1),n.setStencilOp(ot.eA.KEEP,ot.eA.KEEP,ot.eA.REPLACE),n.setStencilFunction(ot.MT.ALWAYS,1,255),n.setStencilTestEnabled(!0),n.useProgram(this._program),this._program.setUniformMatrix3fv("u_worldExtent",this._mat3),this._quad.draw(),this._quad.unbind()}_initialize(t){if(this._initialized)return;const e=(0,at.r)(t,re.P);e&&(this._program=e,this._quad=new Qt.A(t,[0,0,1,0,0,1,1,1]),this._initialized=!0)}_updateGeometry(t,e){const{state:i,pixelRatio:n}=t,{size:r,rotation:s}=i,o=Math.round(r[0]*n),a=Math.round(r[1]*n);if(!i.spatialReference.isWrappable)return!1;const l=(0,Jt.DF)(s),c=Math.abs(Math.cos(l)),u=Math.abs(Math.sin(l)),h=Math.round(o*c+a*u),d=Math.round(n*i.worldScreenWidth);if(h<=d)return!1;const f=o*u+a*c,_=(e.left-e.right)*n/o,p=(e.bottom-e.top)*n/a;(0,ie.s)(this._worldDimensionsPx,d,f,1),(0,ie.s)(this._pxToNdc,2/o,-2/a,1),(0,ie.s)(this._centerNdc,_,p,1);const m=this._mat3;return(0,te.kN)(m,this._centerNdc),(0,te.hs)(m,m,this._pxToNdc),0!==s&&(0,te.e$)(m,m,l),(0,te.hs)(m,m,this._worldDimensionsPx),(0,te.Tl)(m,m,se),!0}}class ae{constructor(){this.name=this.constructor.name}createOptions(t,e){return null}}class le extends ae{constructor(){super(...arguments),this.defines=[],this._desc={vsPath:"fx/integrate",fsPath:"fx/integrate",attributes:new Map([["a_position",0]])}}dispose(){this._quad&&this._quad.dispose()}bind(){}unbind(){}draw(t,e){if(!e?.size)return;const{context:i,renderingOptions:n}=t;this._quad||(this._quad=new Qt.A(i,[0,0,1,0,0,1,1,1]));const s=i.getBoundFramebufferObject(),{x:o,y:a,width:l,height:c}=i.getViewport(),u=e.getBlock(S.dV.Animation);if(null==u)return;const h=e.getUniforms(i);i.setViewport(0,0,e.size,e.size);const d=h.filterFlags,f=h.animation,_=(0,r.A)("featurelayer-animation-enabled")?n.labelsAnimationTime:1,p=u.getFBO(i,1);i.unbindTexture(p.colorTexture),this._computeDelta(t,p,f,d,_);const m=u.getFBO(i);i.unbindTexture(m.colorTexture),this._updateAnimationState(t,p,m),i.bindFramebuffer(s),i.setViewport(o,a,l,c)}_computeDelta(t,e,i,n,r){const{context:s,painter:o,displayLevel:a}=t,l=o.materialManager.getProgram(this._desc,["delta"]);if(s.bindFramebuffer(e),s.setColorMask(!0,!0,!0,!0),s.setClearColor(0,0,0,0),s.clear(s.gl.COLOR_BUFFER_BIT),s.useProgram(l),!("type"in n.texture)||!("type"in i.texture))throw new Error("InternalError: Expected to find texture");s.bindTexture(n.texture,n.unit),s.bindTexture(i.texture,i.unit),l.setUniform1i("u_maskTexture",n.unit),l.setUniform1i("u_sourceTexture",i.unit),l.setUniform1f("u_timeDelta",t.deltaTime),l.setUniform1f("u_animationTime",r),l.setUniform1f("u_zoomLevel",Math.round(10*a)),this._quad.draw()}_updateAnimationState(t,e,i){const{context:n,painter:r}=t,s=r.materialManager.getProgram(this._desc,["update"]);n.bindTexture(e.colorTexture,1),n.useProgram(s),s.setUniform1i("u_sourceTexture",1),n.bindFramebuffer(i),n.setColorMask(!0,!0,!0,!0),n.setClearColor(0,0,0,0),n.clear(n.gl.COLOR_BUFFER_BIT),this._quad.draw()}}var ce=i(44723);const ue=t=>`#define ${(t=>t.replace("-","_").toUpperCase())(t)}\n`;function he(t){return{attributes:new Map([["a_pos",0],["a_tex",1]]),shaders:{vertexShader:ue(t)+(0,ce.Q)("blend/blend.vert"),fragmentShader:ue(t)+(0,ce.Q)("blend/blend.frag")}}}const de=()=>d.A.getLogger("esri.views.2d.engine.webgl.effects.blendEffects.BlendEffect");class fe{constructor(){this._size=[0,0]}dispose(t){this._backBufferTexture=(0,s.WD)(this._backBufferTexture),this._quad=(0,s.WD)(this._quad)}draw(t,e,i,r,s){const{context:o,drawPhase:a}=t;if(this._setupShader(o),r&&"normal"!==r&&a!==B.S5.LABEL)return void this._drawBlended(t,e,i,r,s);const l=he("normal"),c=o.programCache.acquire(l.shaders.vertexShader,l.shaders.fragmentShader,l.attributes);if(!c)return void de().error(new n.A("mapview-BlendEffect",'Error creating shader program for blend mode "normal"'));o.useProgram(c),e.setSamplingMode(i),o.bindTexture(e,0),c.setUniform1i("u_layerTexture",0),c.setUniform1f("u_opacity",s),o.setBlendingEnabled(!0),o.setBlendFunction(ot.dn.ONE,ot.dn.ONE_MINUS_SRC_ALPHA);const u=this._quad;u.draw(),u.unbind(),c.dispose()}_drawBlended(t,e,i,r,s){const{context:o,state:a,pixelRatio:l,inFadeTransition:c}=t,{size:u}=a,h=o.getBoundFramebufferObject();let d,f;null!=h?(d=h.width,f=h.height):(d=Math.round(l*u[0]),f=Math.round(l*u[1])),this._createOrResizeTexture(t,d,f);const _=this._backBufferTexture;h.copyToTexture(0,0,d,f,0,0,_),o.setStencilTestEnabled(!1),o.setStencilWriteMask(0),o.setBlendingEnabled(!0),o.setDepthTestEnabled(!1),o.setDepthWriteEnabled(!1);const p=he(r),m=o.programCache.acquire(p.shaders.vertexShader,p.shaders.fragmentShader,p.attributes);if(!m)return void de().error(new n.A("mapview-BlendEffect",`Error creating shader program for blend mode ${r}`));o.useProgram(m),_.setSamplingMode(i),o.bindTexture(_,0),m.setUniform1i("u_backbufferTexture",0),e.setSamplingMode(i),o.bindTexture(e,1),m.setUniform1i("u_layerTexture",1),m.setUniform1f("u_opacity",s),m.setUniform1f("u_inFadeOpacity",c?1:0),o.setBlendFunction(ot.dn.ONE,ot.dn.ZERO);const g=this._quad;g.draw(),g.unbind(),m.dispose(),o.setBlendFunction(ot.dn.ONE,ot.dn.ONE_MINUS_SRC_ALPHA)}_setupShader(t){this._quad||(this._quad=new Qt.A(t,[-1,-1,1,-1,-1,1,1,1]))}_createOrResizeTexture(t,e,i){const{context:n}=t;if(null===this._backBufferTexture||e!==this._size[0]||i!==this._size[1]){if(this._backBufferTexture)this._backBufferTexture.resize(e,i);else{const t=new Tt.R;t.internalFormat=ot.Ab.RGBA,t.wrapMode=ot.pF.CLAMP_TO_EDGE,t.width=e,t.height=i,this._backBufferTexture=new wt.g(n,t)}this._size[0]=e,this._size[1]=i}}}class _e extends ae{constructor(t){super(),this.name=this.constructor.name,this.defines=[t]}dispose(){}bind({context:t,painter:e}){this._prev=t.getBoundFramebufferObject();const i=e.getFbos().effect0;t.bindFramebuffer(i),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT)}unbind(){}draw(t,e){const{context:i,painter:n}=t,r=n.getPostProcessingEffects(e),s=i.getBoundFramebufferObject();for(const{postProcessingEffect:e,effect:i}of r)e.draw(t,s,i);i.bindFramebuffer(this._prev),i.setStencilTestEnabled(!1),n.blitTexture(i,s.colorTexture,ot.Cj.NEAREST),i.setStencilTestEnabled(!0)}}var pe=i(39232),me=i(17040),ge=i(3817);class ye{constructor(){this._width=void 0,this._height=void 0,this._resources=null}dispose(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources=null)}preBlur(t,e){t.bindTexture(e,S.vd),t.useProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[1,0,1/this._width,0]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",pe.HQ),t.bindVAO(this._resources.quadVAO),t.drawArrays(ot.WR.TRIANGLE_STRIP,0,4),t.bindVAO()}finalBlur(t,e){t.bindTexture(e,S.vd),t.useProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",pe.XK),t.bindVAO(this._resources.quadVAO),t.drawArrays(ot.WR.TRIANGLE_STRIP,0,4),t.bindVAO()}renderHighlight(t,e,i){t.bindTexture(e,S.vd),t.useProgram(this._resources.highlightProgram),i.applyHighlightOptions(t,this._resources.highlightProgram),t.bindVAO(this._resources.quadVAO),t.setBlendingEnabled(!0),t.setBlendFunction(ot.dn.ONE,ot.dn.ONE_MINUS_SRC_ALPHA),t.drawArrays(ot.WR.TRIANGLE_STRIP,0,4),t.bindVAO()}_initialize(t,e,i){this._width=e,this._height=i;const n=st.g.createVertex(t,ot._U.STATIC_DRAW,new Int8Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]).buffer),r=new lt.Z(t,new Map([["a_position",0],["a_texcoord",1]]),{geometry:[new ge._("a_position",2,ot.pe.BYTE,0,4),new ge._("a_texcoord",2,ot.pe.UNSIGNED_BYTE,2,4)]},{geometry:n}),s=(0,at.r)(t,me.Z),o=(0,at.r)(t,me.G);t.useProgram(s),s.setUniform1i("u_texture",S.vd),s.setUniform1i("u_shade",S.CR),s.setUniform1f("u_sigma",pe.aY),t.useProgram(o),o.setUniform1i("u_texture",S.vd),o.setUniform1f("u_sigma",pe.aY),this._resources={quadGeometry:n,quadVAO:r,highlightProgram:s,blurProgram:o}}setup(t,e,i){this._resources?(this._width=e,this._height=i):this._initialize(t,e,i)}}var ve=i(96402),xe=i(15167);function be(t,e,i){const n=new Tt.R(e,i);return n.wrapMode=ot.pF.CLAMP_TO_EDGE,new ve.H(t,n,new xe.q(ot.yQ.STENCIL_INDEX8,e,i))}class Se{constructor(){this._width=void 0,this._height=void 0,this._resources=null}dispose(){this._resources&&(this._resources.sharedBlur1Fbo.dispose(),this._resources.sharedBlur2Fbo.dispose(),this._resources=null)}_initialize(t,e,i){this._width=e,this._height=i;const n=be(t,e,i),r=be(t,e,i);this._resources={sharedBlur1Fbo:n,sharedBlur2Fbo:r}}setup(t,e,i){!this._resources||this._width===e&&this._height===i||this.dispose(),this._resources||this._initialize(t,e,i)}get sharedBlur1Tex(){return this._resources.sharedBlur1Fbo.colorTexture}get sharedBlur1Fbo(){return this._resources.sharedBlur1Fbo}get sharedBlur2Tex(){return this._resources.sharedBlur2Fbo.colorTexture}get sharedBlur2Fbo(){return this._resources.sharedBlur2Fbo}}class we extends ae{constructor(){super(...arguments),this.defines=["highlight"],this._hlRenderer=new ye,this._width=void 0,this._height=void 0,this._boundFBO=null,this._hlSurfaces=new Se,this._adjustedWidth=void 0,this._adjustedHeight=void 0,this._blitRenderer=new ct}dispose(){this._hlSurfaces?.dispose(),this._hlRenderer?.dispose(),this._boundFBO=null}bind(t){const{context:e,painter:i}=t,{width:n,height:r}=e.getViewport(),s=i.getFbos().effect0;this.setup(t,n,r),e.bindFramebuffer(s),e.setColorMask(!0,!0,!0,!0),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT)}unbind(){}setup({context:t},e,i){this._width=e,this._height=i;const n=e%4,r=i%4;e+=n<2?-n:4-n,i+=r<2?-r:4-r,this._adjustedWidth=e,this._adjustedHeight=i,this._boundFBO=t.getBoundFramebufferObject();const s=Math.round(1*e),o=Math.round(1*i);this._hlRenderer.setup(t,s,o),this._hlSurfaces.setup(t,s,o)}draw(t){const{context:e,passOptions:i}=t,n=i.activeGradient,r=e.getBoundFramebufferObject();e.setViewport(0,0,1*this._adjustedWidth,1*this._adjustedHeight),e.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),e.setStencilTestEnabled(!1),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT),this._blitRenderer.render(e,r.colorTexture,ot.Cj.NEAREST,1),e.setStencilTestEnabled(!1),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!0),e.bindFramebuffer(this._hlSurfaces.sharedBlur2Fbo),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT),this._hlRenderer.preBlur(e,this._hlSurfaces.sharedBlur1Tex),e.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT),this._hlRenderer.finalBlur(e,this._hlSurfaces.sharedBlur2Tex),e.bindFramebuffer(this._boundFBO),e.setBlendingEnabled(!0),e.setColorMask(!0,!0,!0,!0),e.setViewport(0,0,this._width,this._height),this._hlRenderer.renderHighlight(e,this._hlSurfaces.sharedBlur1Tex,n),this._boundFBO=null}}class Te extends ae{constructor(){super(...arguments),this.name=this.constructor.name,this.defines=["hittest"]}dispose(){null!=this._fbo&&this._fbo.dispose()}createOptions({pixelRatio:t},e){if(!e.length)return null;const i=e.shift(),n=i.x,s=i.y;this._outstanding=i;const o=(0,r.A)("esri-mobile");return{type:"hittest",distance:(o?S.fy:S.V3)*t,smallSymbolDistance:(o?S.fy:S._M)*t,smallSymbolSizeThreshold:S.ie,position:[n,s]}}bind(t){const{context:e,attributeView:i}=t;if(!i.size)return;const n=i.getBlock(S.dV.GPGPU);if(null==n)return;const r=n.getFBO(e);e.setViewport(0,0,i.size,i.size),e.bindFramebuffer(r),e.setColorMask(!0,!0,!0,!0),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT|e.gl.DEPTH_BUFFER_BIT)}unbind(){}draw(t){if(null==this._outstanding)return;const e=this._outstanding;this._outstanding=null,this._resolve(t,e.resolvers)}async _resolve(t,e){const{context:i,attributeView:n}=t,r=n.getBlock(S.dV.GPGPU);if(null==r)return void e.forEach((t=>t.resolve([])));const s=r.getFBO(i),o=new Uint8Array(s.width*s.height*4);try{await s.readPixelsAsync(0,0,s.width,s.height,ot.Ab.RGBA,ot.ld.UNSIGNED_BYTE,o)}catch(t){return void e.forEach((t=>t.resolve([])))}const a=[];for(let t=0;t<o.length;t+=4){const e=t/4;o[t]&&a.push(e)}e.forEach((t=>t.resolve(a)))}}const Me=[1,0],Pe=[0,1],Ee=[1,.8,.6,.4,.2],Ae=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];class Ce{constructor(){this._intensityFBO=null,this._compositeFBO=null,this._mipsFBOs=new Array(5),this._nMips=5,this._kernelSizeArray=[3,5,7,9,11],this._size=[0,0],this._programDesc={luminosityHighPass:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/luminosityHighPass",attributes:new Map([["a_position",0]])},gaussianBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/gaussianBlur",attributes:new Map([["a_position",0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/composite",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}dispose(){if(this._quad=(0,s.WD)(this._quad),this._intensityFBO=(0,s.WD)(this._intensityFBO),this._compositeFBO=(0,s.WD)(this._compositeFBO),this._mipsFBOs){for(let t=0;t<this._nMips;t++)this._mipsFBOs[t]&&(this._mipsFBOs[t].horizontal.dispose(),this._mipsFBOs[t].vertical.dispose());this._mipsFBOs=null}}draw(t,e,i){const{width:n,height:r}=e,{context:s,painter:o}=t,{materialManager:a}=o,l=s.gl,c=this._programDesc,{strength:u,radius:h,threshold:d}=i;this._quad||(this._quad=new Qt.A(s,[-1,-1,1,-1,-1,1,1,1])),this._createOrResizeResources(t,n,r),s.setStencilTestEnabled(!1),s.setBlendingEnabled(!0),s.setBlendFunction(ot.dn.ONE,ot.dn.ONE_MINUS_SRC_ALPHA),s.setStencilWriteMask(0);const f=this._quad;f.bind(),s.bindFramebuffer(this._intensityFBO);const _=a.getProgram(c.luminosityHighPass);s.useProgram(_),s.bindTexture(e.colorTexture,0),_.setUniform1i("u_texture",0),_.setUniform3fv("u_defaultColor",[0,0,0]),_.setUniform1f("u_defaultOpacity",0),_.setUniform1f("u_luminosityThreshold",d),_.setUniform1f("u_smoothWidth",.01);const p=[Math.round(n/2),Math.round(r/2)];s.setViewport(0,0,p[0],p[1]),s.setClearColor(0,0,0,0),s.clear(l.COLOR_BUFFER_BIT),f.draw(),s.setBlendingEnabled(!1);let m=this._intensityFBO.colorTexture;for(let t=0;t<this._nMips;t++){const e=a.getProgram(c.gaussianBlur,[{name:"radius",value:this._kernelSizeArray[t]}]);s.useProgram(e),s.bindTexture(m,t+1),e.setUniform1i("u_colorTexture",t+1),e.setUniform2fv("u_texSize",p),e.setUniform2fv("u_direction",Me),s.setViewport(0,0,p[0],p[1]);const i=this._mipsFBOs[t];s.bindFramebuffer(i.horizontal),f.draw(),m=i.horizontal.colorTexture,s.bindFramebuffer(i.vertical),s.bindTexture(m,t+1),e.setUniform2fv("u_direction",Pe),f.draw(),m=i.vertical.colorTexture,p[0]=Math.round(p[0]/2),p[1]=Math.round(p[1]/2)}s.setViewport(0,0,n,r);const g=a.getProgram(c.composite,[{name:"nummips",value:5}]);s.bindFramebuffer(this._compositeFBO),s.useProgram(g),g.setUniform1f("u_bloomStrength",u),g.setUniform1f("u_bloomRadius",h),g.setUniform1fv("u_bloomFactors",Ee),g.setUniform3fv("u_bloomTintColors",Ae),s.bindTexture(this._mipsFBOs[0].vertical.colorTexture,1),g.setUniform1i("u_blurTexture1",1),s.bindTexture(this._mipsFBOs[1].vertical.colorTexture,2),g.setUniform1i("u_blurTexture2",2),s.bindTexture(this._mipsFBOs[2].vertical.colorTexture,3),g.setUniform1i("u_blurTexture3",3),s.bindTexture(this._mipsFBOs[3].vertical.colorTexture,4),g.setUniform1i("u_blurTexture4",4),s.bindTexture(this._mipsFBOs[4].vertical.colorTexture,5),g.setUniform1i("u_blurTexture5",5),f.draw(),s.bindFramebuffer(e),s.setBlendingEnabled(!0);const y=a.getProgram(c.blit);s.useProgram(y),s.bindTexture(this._compositeFBO.colorTexture,6),y.setUniform1i("u_texture",6),s.setBlendFunction(ot.dn.ONE,ot.dn.ONE),f.draw(),f.unbind(),s.setBlendFunction(ot.dn.ONE,ot.dn.ONE_MINUS_SRC_ALPHA),s.setStencilTestEnabled(!0)}_createOrResizeResources(t,e,i){const{context:n}=t;if(this._compositeFBO&&this._size[0]===e&&this._size[1]===i)return;this._size[0]=e,this._size[1]=i;const r=[Math.round(e/2),Math.round(i/2)];if(this._compositeFBO)this._compositeFBO.resize(e,i);else{const t=new Tt.R(e,i);t.internalFormat=ot.Ab.RGBA,t.wrapMode=ot.pF.CLAMP_TO_EDGE,this._compositeFBO=new ve.H(n,t)}if(this._intensityFBO)this._intensityFBO.resize(r[0],r[1]);else{const t=new Tt.R(r[0],r[1]);t.internalFormat=ot.Ab.RGBA,t.wrapMode=ot.pF.CLAMP_TO_EDGE,this._intensityFBO=new ve.H(n,t)}for(let t=0;t<this._nMips;t++){if(this._mipsFBOs[t])this._mipsFBOs[t].horizontal.resize(r[0],r[1]),this._mipsFBOs[t].vertical.resize(r[0],r[1]);else{const e=new Tt.R(r[0],r[1]);e.internalFormat=ot.Ab.RGBA,e.wrapMode=ot.pF.CLAMP_TO_EDGE,this._mipsFBOs[t]={horizontal:new ve.H(n,e),vertical:new ve.H(n,e)}}r[0]=Math.round(r[0]/2),r[1]=Math.round(r[1]/2)}}}const Ie=[1,0],Re=[0,1];class Oe{constructor(){this._blurFBO=null,this._size=[0,0],this._programDesc={gaussianBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/gaussianBlur",attributes:new Map([["a_position",0]])},radialBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/radial-blur",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}dispose(){this._blurFBO&&(this._blurFBO.dispose(),this._blurFBO=null)}draw(t,e,i){const{context:n}=t,{type:r,radius:s}=i;if(0===s)return;this._createOrResizeResources(t),this._quad||(this._quad=new Qt.A(n,[-1,-1,1,-1,-1,1,1,1]));const o=this._quad;o.bind(),"blur"===r?this._gaussianBlur(t,e,s):this._radialBlur(t,e),o.unbind()}_gaussianBlur(t,e,i){const{context:n,state:r,painter:s,pixelRatio:o}=t,{size:a}=r,{materialManager:l}=s,c=this._programDesc,u=this._quad,h=[Math.round(o*a[0]),Math.round(o*a[1])],d=this._blurFBO,f=l.getProgram(c.gaussianBlur,[{name:"radius",value:Math.ceil(i)}]);n.useProgram(f),n.setBlendingEnabled(!1),n.bindFramebuffer(d),n.bindTexture(e.colorTexture,4),f.setUniform1i("u_colorTexture",4),f.setUniform2fv("u_texSize",h),f.setUniform2fv("u_direction",Ie),f.setUniform1f("u_sigma",i),u.draw(),n.bindFramebuffer(e),n.setStencilWriteMask(0),n.setStencilTestEnabled(!1),n.setDepthWriteEnabled(!1),n.setDepthTestEnabled(!1),n.bindTexture(d?.colorTexture,5),f.setUniform1i("u_colorTexture",5),f.setUniform2fv("u_direction",Re),u.draw(),n.setBlendingEnabled(!0),n.setBlendFunction(ot.dn.ONE,ot.dn.ONE_MINUS_SRC_ALPHA),n.setStencilTestEnabled(!0)}_radialBlur(t,e){const{context:i,painter:n}=t,{materialManager:r}=n,s=this._programDesc,o=this._quad,a=this._blurFBO;i.bindFramebuffer(a);const l=r.getProgram(s.radialBlur);i.useProgram(l),i.setBlendingEnabled(!1),i.bindTexture(e.colorTexture,4),l.setUniform1i("u_colorTexture",4),o.draw(),i.bindFramebuffer(e),i.setStencilWriteMask(0),i.setStencilTestEnabled(!1),i.setDepthWriteEnabled(!1),i.setDepthTestEnabled(!1),i.setBlendingEnabled(!0);const c=r.getProgram(s.blit);i.useProgram(c),i.bindTexture(a?.colorTexture,5),c.setUniform1i("u_texture",5),i.setBlendFunction(ot.dn.ONE,ot.dn.ONE_MINUS_SRC_ALPHA),o.draw()}_createOrResizeResources(t){const{context:e,state:i,pixelRatio:n}=t,{size:r}=i,s=Math.round(n*r[0]),o=Math.round(n*r[1]);if(!this._blurFBO||this._size[0]!==s||this._size[1]!==o)if(this._size[0]=s,this._size[1]=o,this._blurFBO)this._blurFBO.resize(s,o);else{const t=new Tt.R(s,o);t.internalFormat=ot.Ab.RGBA,t.wrapMode=ot.pF.CLAMP_TO_EDGE,this._blurFBO=new ve.H(e,t)}}}class Fe{constructor(){this._layerFBOTexture=null,this._size=[0,0],this._programDesc={vsPath:"post-processing/pp",fsPath:"post-processing/filterEffect",attributes:new Map([["a_position",0]])}}dispose(){this._layerFBOTexture=(0,s.WD)(this._layerFBOTexture)}draw(t,e,i){const{width:n,height:r}=e;this._createOrResizeResources(t,n,r);const{context:s,painter:o}=t,{materialManager:a}=o,l=this._programDesc,c=this._quad,u=i.colorMatrix;c.bind();const h=this._layerFBOTexture;s.bindFramebuffer(e),e.copyToTexture(0,0,n,r,0,0,h),s.setBlendingEnabled(!1),s.setStencilTestEnabled(!1);const d=a.getProgram(l);s.useProgram(d),s.bindTexture(h,2),d.setUniformMatrix4fv("u_coefficients",u),d.setUniform1i("u_colorTexture",2),c.draw(),s.setBlendingEnabled(!0),s.setBlendFunction(ot.dn.ONE,ot.dn.ONE_MINUS_SRC_ALPHA),s.setStencilTestEnabled(!0),c.unbind()}_createOrResizeResources(t,e,i){const{context:n}=t;if(!this._layerFBOTexture||this._size[0]!==e||this._size[1]!==i){if(this._size[0]=e,this._size[1]=i,this._layerFBOTexture)this._layerFBOTexture.resize(e,i);else{const t=new Tt.R;t.internalFormat=ot.Ab.RGBA,t.wrapMode=ot.pF.CLAMP_TO_EDGE,t.width=e,t.height=i,this._layerFBOTexture=new wt.g(n,t)}this._quad||(this._quad=new Qt.A(n,[-1,-1,1,-1,-1,1,1,1]))}}}const ze=[1,0],De=[0,1];class Le{constructor(){this._layerFBOTexture=null,this._horizontalBlurFBO=null,this._verticalBlurFBO=null,this._size=[0,0],this._quad=null,this._programDesc={blur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/gaussianBlur",attributes:new Map([["a_position",0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/drop-shadow/composite",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}dispose(){this._layerFBOTexture=(0,s.WD)(this._layerFBOTexture),this._horizontalBlurFBO=(0,s.WD)(this._horizontalBlurFBO),this._verticalBlurFBO=(0,s.WD)(this._verticalBlurFBO)}draw(t,e,i){const{context:n,state:r,painter:s}=t,{materialManager:o}=s,a=this._programDesc,l=e.width,c=e.height,u=[Math.round(l),Math.round(c)],{blurRadius:h,offsetX:d,offsetY:_,color:p}=i,m=[(0,f.Lz)(d),(0,f.Lz)(_)];this._createOrResizeResources(t,l,c,u);const g=this._horizontalBlurFBO,y=this._verticalBlurFBO;n.setStencilWriteMask(0),n.setStencilTestEnabled(!1),n.setDepthWriteEnabled(!1),n.setDepthTestEnabled(!1);const v=this._layerFBOTexture;e.copyToTexture(0,0,l,c,0,0,v),this._quad||(this._quad=new Qt.A(n,[-1,-1,1,-1,-1,1,1,1])),n.setViewport(0,0,u[0],u[1]);const x=this._quad;x.bind(),n.setBlendingEnabled(!1);const b=o.getProgram(a.blur,[{name:"radius",value:Math.ceil(h)}]);n.useProgram(b),n.bindFramebuffer(g),n.bindTexture(e.colorTexture,4),b.setUniform1i("u_colorTexture",4),b.setUniform2fv("u_texSize",u),b.setUniform2fv("u_direction",ze),b.setUniform1f("u_sigma",h),x.draw(),n.bindFramebuffer(y),n.bindTexture(g?.colorTexture,5),b.setUniform1i("u_colorTexture",5),b.setUniform2fv("u_direction",De),x.draw(),n.bindFramebuffer(e),n.setViewport(0,0,l,c);const S=o.getProgram(a.composite);n.useProgram(S),n.bindTexture(y?.colorTexture,2),S.setUniform1i("u_blurTexture",2),n.bindTexture(v,3),S.setUniform1i("u_layerFBOTexture",3),S.setUniform4fv("u_shadowColor",[p[3]*(p[0]/255),p[3]*(p[1]/255),p[3]*(p[2]/255),p[3]]),S.setUniformMatrix3fv("u_displayViewMat3",r.displayMat3),S.setUniform2fv("u_shadowOffset",m),x.draw(),n.setBlendingEnabled(!0),n.setStencilTestEnabled(!0),n.setBlendFunction(ot.dn.ONE,ot.dn.ONE_MINUS_SRC_ALPHA),x.unbind()}_createOrResizeResources(t,e,i,n){const{context:r}=t;if(!this._horizontalBlurFBO||this._size[0]!==e||this._size[1]!==i){if(this._size[0]=e,this._size[1]=i,this._horizontalBlurFBO)this._horizontalBlurFBO.resize(n[0],n[1]);else{const t=new Tt.R(n[0],n[1]);t.internalFormat=ot.Ab.RGBA,t.wrapMode=ot.pF.CLAMP_TO_EDGE,this._horizontalBlurFBO=new ve.H(r,t)}if(this._verticalBlurFBO)this._verticalBlurFBO.resize(n[0],n[1]);else{const t=new Tt.R(n[0],n[1]);t.internalFormat=ot.Ab.RGBA,t.wrapMode=ot.pF.CLAMP_TO_EDGE,this._verticalBlurFBO=new ve.H(r,t)}if(this._layerFBOTexture)this._layerFBOTexture.resize(e,i);else{const t=new Tt.R;t.internalFormat=ot.Ab.RGBA,t.wrapMode=ot.pF.CLAMP_TO_EDGE,t.width=e,t.height=i,this._layerFBOTexture=new wt.g(r,t)}}}}class Ne{constructor(){this._size=[0,0],this._layerFBOTexture=null}dispose(){this._layerFBOTexture=(0,s.WD)(this._layerFBOTexture)}draw(t,e,i){const{width:n,height:r}=e;this._createOrResizeResources(t,n,r);const{context:s,painter:o}=t,{amount:a}=i,l=s.gl,c=this._layerFBOTexture;s.bindFramebuffer(e),e.copyToTexture(0,0,n,r,0,0,c),s.setBlendingEnabled(!0),s.setStencilTestEnabled(!1),s.setDepthTestEnabled(!1),s.setClearColor(0,0,0,0),s.clear(l.COLOR_BUFFER_BIT),o.blitTexture(s,c,ot.Cj.NEAREST,a)}_createOrResizeResources(t,e,i){const{context:n}=t;if(!this._layerFBOTexture||this._size[0]!==e||this._size[1]!==i)if(this._size[0]=e,this._size[1]=i,this._layerFBOTexture)this._layerFBOTexture.resize(e,i);else{const t=new Tt.R;t.internalFormat=ot.Ab.RGBA,t.wrapMode=ot.pF.CLAMP_TO_EDGE,t.samplingMode=ot.Cj.NEAREST,t.width=e,t.height=i,this._layerFBOTexture=new wt.g(n,t)}}}function Be(t){switch(t){case"bloom":case"blur":case"opacity":case"drop-shadow":return t;default:return"colorize"}}const ke={colorize:()=>new Fe,blur:()=>new Oe,bloom:()=>new Ce,opacity:()=>new Ne,"drop-shadow":()=>new Le};class Ve{constructor(){this._effectMap=new Map}dispose(){this._effectMap.forEach((t=>t.dispose())),this._effectMap.clear()}getPostProcessingEffects(t){if(!t||0===t.length)return[];const e=[];for(const i of t){const t=Be(i.type);let n=this._effectMap.get(t);n||(n=ke[t](),this._effectMap.set(t,n)),e.push({postProcessingEffect:n,effect:i})}return e}}var Ue=i(50659);class Ge{constructor(t,e){this.brushes=t,this.name=e.name,this.drawPhase=e.drawPhase||B.S5.MAP,this._targetFn=e.target,this.effects=e.effects||[],this.enableDefaultDraw=e.enableDefaultDraw??(()=>!0),this.forceDrawByDisplayOrder=!!e.forceDrawByDisplayOrder}render(t){const{context:e,profiler:i}=t,n=this._targetFn(),r=this.drawPhase&t.drawPhase;if(i.recordPassStart(this.name),r){this.enableDefaultDraw()&&this._doRender(t,n),i.recordPassEnd();for(const i of this.effects){if(!i.enable())continue;const r=i.apply,s=i.args?.(),o=e.getViewport(),a=e.getBoundFramebufferObject(),l=t.passOptions;this._bindEffect(t,r,s),this._doRender(t,n,r.defines),this._drawAndUnbindEffect(t,r,o,a,l,s)}}}_doRender(t,e,i){if(null==e)return;const{profiler:n,context:r}=t;for(const s of this.brushes){if(n.recordBrushStart(s.name),null!=s.brushEffect){const n=r.getViewport(),o=r.getBoundFramebufferObject(),a=t.passOptions;this._bindEffect(t,s.brushEffect),this._drawWithBrush(s,t,e,i),this._drawAndUnbindEffect(t,s.brushEffect,n,o,a)}else this._drawWithBrush(s,t,e,i);n.recordBrushEnd()}}_drawWithBrush(t,e,i,n){(0,Ue.Xj)(i)?(t.prepareState(e,n),t.drawMany(e,i,n)):i.visible&&(t.prepareState(e,n),t.draw(e,i,n))}_bindEffect(t,e,i){const{profiler:n}=t;n.recordPassStart(this.name+"."+e.name),e.bind(t,i);const r=e.createOptions(t,i);t.passOptions=r}_drawAndUnbindEffect(t,e,i,n,r,s){const{profiler:o,context:a}=t;t.passOptions=r,o.recordBrushStart(e.name),e.draw(t,s),e.unbind(t,s),a.bindFramebuffer(n);const{x:l,y:c,width:u,height:h}=i;a.setViewport(l,c,u,h),o.recordBrushEnd(),o.recordPassEnd()}}class He{constructor(){this._programCache=new Map}destroy(){for(const t of this._programCache.values())t.destroy();this._programCache.clear()}getProgram(t,e,i,n,r){const s=t.getShaderKey(e,i,n,r);let o=this._programCache.get(s);return o||(o=t.getProgram(e,i,n,r),this._programCache.set(s,o)),o}}var Ye=i(49414);class We{constructor(t,e){this.context=t,this._currentPipelineStateNeedsUpdate=!1,this._blitRenderer=new ct,this._worldExtentRenderer=new oe,this._brushCache=new Map,this._lastWidth=null,this._lastHeight=null,this._vtlMaterialManager=new it,this._blendEffect=new fe,this._stencilBuf=null,this._prevBeforeLayerFBOStack=[],this._fboPool=[],this.effects={highlight:new we,hittest:new Te,integrate:new le,insideEffect:new _e("inside"),outsideEffect:new _e("outside")},this._programCache=new He,this._shaderState={shader:null,uniforms:null,defines:null,optionalAttributes:null,useComputeBuffer:!1},this.materialManager=new ht(t),this.textureManager=new Zt(e),this.textureUploadManager=new Kt(e),this._effectsManager=new Ve,this._quadMesh=new Qt.A(t,[0,0,1,0,0,1,1,1])}dispose(){if(this._programCache.destroy(),this.materialManager.dispose(),this.textureManager.dispose(),this.textureUploadManager.destroy(),this._blitRenderer=(0,s.WD)(this._blitRenderer),this._worldExtentRenderer=(0,s.WD)(this._worldExtentRenderer),this._quadMesh.dispose(),this._brushCache&&(this._brushCache.forEach((t=>t.dispose())),this._brushCache.clear(),this._brushCache=null),this._fbos){let t;for(t in this._fbos)this._fbos[t]&&this._fbos[t].dispose()}for(const t of this._fboPool)t.dispose();if(this._fboPool.length=0,this.effects){let t;for(t in this.effects)this.effects[t]&&this.effects[t].dispose()}this._effectsManager.dispose(),this._blendEffect.dispose(this.context),this._vtlMaterialManager=(0,s.WD)(this._vtlMaterialManager)}clearShaderCache(){this._programCache.destroy(),this._programCache=new He}get blitRenderer(){return this._blitRenderer}get vectorTilesMaterialManager(){return this._vtlMaterialManager}getFbos(){if(!this._fbos)throw new Error("InternalError: Painter FBOs not initialized");return this._fbos}acquireFbo(t,e){let i;if(this._fboPool.length>0)i=this._fboPool.pop();else{const n=new Tt.R(t,e);n.samplingMode=ot.Cj.NEAREST,n.wrapMode=ot.pF.CLAMP_TO_EDGE,i=new ve.H(this.context,n,this._stencilBuf)}return i.width===t&&i.height===e||i.resize(t,e),i}releaseFbo(t){this._fboPool.push(t)}getSharedStencilBuffer(){return this._stencilBuf}beforeRenderPhases(t,e,i){const{context:n}=t;this._worldExtentRenderer.render(t,e,i);const{width:r,height:s}=n.getViewport();if(this.updateFBOs(r,s),this._prevFBO=n.getBoundFramebufferObject(),n.bindFramebuffer(this.getFbos().output),n.setColorMask(!0,!0,!0,!0),null!=e){const{r:t,g:i,b:r,a:s}=e;n.setClearColor(s*t/255,s*i/255,s*r/255,s)}else n.setClearColor(0,0,0,0);n.setDepthWriteEnabled(!0),n.setClearDepth(1),n.clear(n.gl.COLOR_BUFFER_BIT|n.gl.DEPTH_BUFFER_BIT),n.setDepthWriteEnabled(!1)}afterRenderPhases(t){const{context:e}=t;e.bindFramebuffer(this._prevFBO),e.setStencilFunction(ot.MT.EQUAL,1,255),e.setStencilTestEnabled(!0),e.setDepthTestEnabled(!1),this.blitTexture(e,this.getFbos().output.colorTexture,ot.Cj.NEAREST)}beforeRenderLayer(t,e,i){const{context:n,blendMode:r,effects:s,drawPhase:o,requireFBO:a}=t;if(a||Ze(o,r,s,i)){const t=n.getBoundFramebufferObject();this._prevBeforeLayerFBOStack.push(t);const{width:e,height:i}=n.getViewport(),r=this.acquireFbo(e,i);n.bindFramebuffer(r),n.setColorMask(!0,!0,!0,!0),n.setClearColor(0,0,0,0),n.setDepthWriteEnabled(!0),n.setClearDepth(1),n.clear(n.gl.COLOR_BUFFER_BIT|n.gl.DEPTH_BUFFER_BIT),n.setDepthWriteEnabled(!1)}n.setDepthWriteEnabled(!1),n.setDepthTestEnabled(!1),n.setStencilTestEnabled(!0),n.setClearStencil(e),n.setStencilWriteMask(255),n.clear(n.gl.STENCIL_BUFFER_BIT)}afterRenderLayer(t,e){const{context:i,blendMode:n,effects:r,requireFBO:s,drawPhase:o}=t;if(s||Ze(o,n,r,e)){const s=i.getBoundFramebufferObject();null!=r&&r.length>0&&o===B.S5.MAP&&(i.setColorMask(!0,!0,!0,!0),this._applyEffects(t,r,s)),i.bindFramebuffer(this._prevBeforeLayerFBOStack.pop()),i.setStencilTestEnabled(!1),i.setStencilWriteMask(0),i.setBlendingEnabled(!0),i.setBlendFunctionSeparate(ot.dn.ONE,ot.dn.ONE_MINUS_SRC_ALPHA,ot.dn.ONE,ot.dn.ONE_MINUS_SRC_ALPHA),i.setColorMask(!0,!0,!0,!0);const a=null==n||o===B.S5.HIGHLIGHT?"normal":n;this._blendEffect.draw(t,s.colorTexture,ot.Cj.NEAREST,a,e),this.releaseFbo(s)}}renderObject(t,e,i,n){const r=k.d[i];if(!r)return;let s=this._brushCache.get(r);void 0===s&&(s=new r,this._brushCache.set(r,s)),s.prepareState(t),s.draw(t,e,n)}renderObjects(t,e,i,n){const r=k.d[i];if(!r)return;let s=this._brushCache.get(r);void 0===s&&(s=new r,this._brushCache.set(r,s)),s.drawMany(t,e,n)}registerRenderPass(t){const e=t.brushes.map((t=>(this._brushCache.has(t)||this._brushCache.set(t,new t),this._brushCache.get(t))));return new Ge(e,t)}blitTexture(t,e,i,n=1){t.setBlendingEnabled(!0),t.setBlendFunctionSeparate(ot.dn.ONE,ot.dn.ONE_MINUS_SRC_ALPHA,ot.dn.ONE,ot.dn.ONE_MINUS_SRC_ALPHA),t.setColorMask(!0,!0,!0,!0),this._blitRenderer.render(t,e,i,n),this._currentPipelineStateNeedsUpdate=!0}getPostProcessingEffects(t){return this._effectsManager.getPostProcessingEffects(t)}updateFBOs(t,e){if(t!==this._lastWidth||e!==this._lastHeight){if(this._lastWidth=t,this._lastHeight=e,this._fbos){let i;for(i in this._fbos)this._fbos[i].resize(t,e);return}const i=new Tt.R(t,e);i.samplingMode=ot.Cj.NEAREST,i.wrapMode=ot.pF.CLAMP_TO_EDGE;const n=new xe.q(ot.yQ.DEPTH_STENCIL,t,e);this._stencilBuf=new Ye.l(this.context,n),this._fbos={output:new ve.H(this.context,i,this._stencilBuf),effect0:new ve.H(this.context,i,this._stencilBuf)}}}_applyEffects(t,e,i){const{context:n}=t,r=this._effectsManager.getPostProcessingEffects(e);for(const{postProcessingEffect:e,effect:s}of r)n.bindFramebuffer(i),e.draw(t,i,s);this._currentPipelineStateNeedsUpdate=!0}setShader(t){this._shaderState.shader=t.shader,this._shaderState.uniforms=t.uniforms,this._shaderState.defines=t.defines,this._shaderState.optionalAttributes=t.optionalAttributes,this._shaderState.useComputeBuffer=t.useComputeBuffer??!1}setPipelineState(t){t!==this._currentPipelineState&&(this._currentPipelineState=t,this._currentPipelineStateNeedsUpdate=!0)}submitDraw(t,e){const{shader:i,uniforms:n,defines:r,optionalAttributes:s}=this._shaderState,o=t.context,a=e.getAttributePrecisionPackFactors(),l=this._programCache.getProgram(i,a,n,r??{},s??{});return l.setUniforms(n),l.bind(o),this.updatePipelineState(o),this.setStencilRef(o,e),e.draw(t,i.locationInfo),l.cleanupTemporaryTextures(),{vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}}submitDrawQuad(t){const{shader:e,uniforms:i,defines:n,optionalAttributes:r}=this._shaderState,s=this._programCache.getProgram(e,{},i,n??{},r??{});s.setUniforms(i),s.bind(t),this.updatePipelineState(t),this._quadMesh.draw(),t.bindVAO(null),s.cleanupTemporaryTextures()}submitDrawMesh(t,e,i){const{shader:n,uniforms:r,defines:s,optionalAttributes:o}=this._shaderState,a=this._programCache.getProgram(n,{},r,s??{},o??{});if(a.setUniforms(r),a.bind(t),this.updatePipelineState(t),i)for(const n of i)e.bind(t,n),e.draw(t);else for(let i=0;i<e.parts.length;i++)e.bind(t,i),e.draw(t);e.unbind(t),a.cleanupTemporaryTextures()}updatePipelineState(t){this._currentPipelineStateNeedsUpdate&&(this._currentPipelineStateNeedsUpdate=!1,this._updatePipelineState(t))}_updatePipelineState(t){if(null==this._currentPipelineState)throw new Error("Pipeline state not defined. Call setPipelineState before calling submitDraw ");const{color:e,depth:i,stencil:n}=this._currentPipelineState;if(e){const{blendMode:i,write:n}=e;switch(t.setColorMask(...n),t.setBlendingEnabled(!0),t.setBlendEquation(ot.Tb.ADD),i){case"composite":t.setBlendFunctionSeparate(ot.dn.ONE,ot.dn.ONE_MINUS_SRC_ALPHA,ot.dn.ONE,ot.dn.ONE_MINUS_SRC_ALPHA);break;case"additive":t.setBlendFunctionSeparate(ot.dn.ONE,ot.dn.ONE,ot.dn.ONE,ot.dn.ONE);break;case"custom":{const{blendParameters:i}=e,{dstAlpha:n,dstRGB:r,srcAlpha:s,srcRGB:o}=i;t.setBlendFunctionSeparate(o,r,s,n);break}case"delete":t.setBlendEquation(ot.Tb.REVERSE_SUBTRACT),t.setBlendFunctionSeparate(ot.dn.ONE,ot.dn.ONE_MINUS_SRC_ALPHA,ot.dn.ONE,ot.dn.ONE_MINUS_SRC_ALPHA)}}if(i){const{test:e,write:n}=i;n?(t.setDepthWriteEnabled(!0),t.setDepthRange(n.zNear,n.zFar)):t.setDepthWriteEnabled(!1),e?(t.setDepthTestEnabled(!0),t.setDepthFunction(e)):t.setDepthTestEnabled(!1)}else t.setDepthTestEnabled(!1),t.setDepthWriteEnabled(!1);if(n){const{test:e,write:i}=n;if(e){const{compare:i,mask:n,op:r,ref:s}=e;t.setStencilTestEnabled(!0),"function"!=typeof s&&t.setStencilFunctionSeparate(ot.Y7.FRONT_AND_BACK,i,s,n),t.setStencilOpSeparate(ot.Y7.FRONT_AND_BACK,r.fail,r.zFail,r.zPass)}else t.setStencilTestEnabled(!1);if(i){const{mask:e}=i;t.setStencilWriteMask(e)}else t.setStencilWriteMask(0)}else t.setStencilTestEnabled(!1),t.setStencilWriteMask(0)}setStencilRef(t,e){if(null==this._currentPipelineState)throw new Error("Pipeline state not defined. Call setPipelineState before calling submitDraw ");const{stencil:i}=this._currentPipelineState;if(i){const{test:n}=i;if(n){const{compare:i,mask:r,ref:s}=n;if("function"==typeof s){const n=e.getStencilReference();if(null===n)throw new Error("InternalError: Stencil reference expected for target but not defined");t.setStencilFunctionSeparate(ot.Y7.FRONT_AND_BACK,i,n,r)}}}}}function Ze(t,e,i,n){return t!==B.S5.LABEL_ALPHA&&t!==B.S5.LABEL&&t!==B.S5.HIGHLIGHT&&(1!==n||null!=e&&"normal"!==e||null!=i&&i.length>0)}var qe=i(28055),Xe=i(58975);class $e{constructor(){this._candidateTiles=[]}schedule(t){this._candidateTiles.includes(t)||this._candidateTiles.push(t)}reshuffle(t){const e=[];for(const i of this._candidateTiles)t>0?(i.reshuffle(),t--):e.push(i);this._candidateTiles=e}}var je=i(78119),Ke=i(23702),Qe=i(25568),Je=i(94385),ti=i(74427),ei=i(87847);class ii extends C.m{constructor(t,e){super(),this.meshWriterRegistry=new Ke.o,this._trash=new Set,this._renderRemainingTime=0,this._lastFrameRenderTime=0,this._renderRequested=(0,a.v)(!1),this.stage=this,this._stationary=!0,this._reshuffleManager=new $e,this._canvas=new N(t),this.context=new ti.e(this._canvas.gl,e.contextOptions??{}),this.painter=new We(this.context,this),this._cimAnalyzer=new T(this.painter.textureManager.resourceManager),(0,r.A)("esri-2d-profiler")&&(this._debugOutput=document.createElement("div"),this._debugOutput.setAttribute("style","margin: 24px 64px; position: absolute; color: red;"),t.appendChild(this._debugOutput));const i=()=>this._highlightGradient;this._renderParameters={drawPhase:0,state:this.state,pixelRatio:window.devicePixelRatio,stationary:!1,globalOpacity:1,blendMode:null,deltaTime:-1,time:0,inFadeTransition:!1,effects:null,context:this.context,painter:this.painter,timeline:e.timeline||new Qe.K,renderingOptions:e.renderingOptions,requestRender:()=>this.requestRender(),allowDelayedRender:!1,requireFBO:!1,profiler:new Xe.U(this.context,this._debugOutput),dataUploadCounter:0,get highlightGradient(){return i()},reshuffleManager:this._reshuffleManager,backgroundColor:e.backgroundColor},this._taskHandle=(0,o.mg)({render:t=>this.renderFrame(t)}),this._taskHandle.pause(),this._lostWebGLContextHandle=this._canvas.events.on("webgl-context-lost",(t=>this.emit("webgl-error",{error:new n.A("webgl-context-lost",t.statusMessage)}))),this._bufferPool=new qe.o,(0,je.Wn)()}destroy(){(0,je.n_)(this.context),this.removeAllChildren(),this._emptyTrash(),this._taskHandle=(0,s.xt)(this._taskHandle),this._lostWebGLContextHandle=(0,s.xt)(this._lostWebGLContextHandle),this._canvas.destroy(),this._debugOutput?.parentNode?.removeChild(this._debugOutput),this._bufferPool.destroy(),this.painter.dispose(),this.context.dispose(),this._canvas=null}get textureManager(){return this.painter.textureManager}get backgroundColor(){return this._renderParameters.backgroundColor}set backgroundColor(t){this._renderParameters.backgroundColor=t,this.requestRender()}get bufferPool(){return this._bufferPool}get cimAnalyzer(){return this._cimAnalyzer}get renderingOptions(){return this._renderingOptions}set renderingOptions(t){this._renderingOptions=t,this.requestRender()}get renderRequested(){return this._renderRequested.value}get state(){return this._state}set state(t){this._state=t,this.requestRender()}get stationary(){return this._stationary}set stationary(t){this._stationary!==t&&(this._stationary=t,this.requestRender())}trashDisplayObject(t){this._trash.add(t),this.requestRender()}untrashDisplayObject(t){return this._trash.delete(t)}requestRender(){this._renderRemainingTime=2e3,this.renderRequested||(this._renderRequested.value=!0,this._taskHandle.resume())}renderFrame(t){const e=this._lastFrameRenderTime?t.time-this._lastFrameRenderTime:0;this._renderRemainingTime-=e,this._renderRemainingTime<=0&&this._taskHandle.pause(),this._lastFrameRenderTime=t.time,this._renderRequested.value=!1,this._renderParameters.state=this._state,this._renderParameters.stationary=this.stationary,this._renderParameters.pixelRatio=window.devicePixelRatio,this._renderParameters.globalOpacity=1,this._renderParameters.time=t.time,this._renderParameters.deltaTime=t.deltaTime,this._renderParameters.effects=null,this.processRender(this._renderParameters),this._emptyTrash()}_createTransforms(){return{displayViewScreenMat3:(0,l.vt)()}}renderChildren(t){for(const e of this.children)e.beforeRender(t);this._reshuffleManager.reshuffle(S.O5),this._canvas.render(t,(()=>this._renderChildren(this.children,t)));for(const e of this.children)e.afterRender(t)}_renderChildren(t,e){const i=this.context;this.painter.textureUploadManager.upload(),i.resetInfo(),e.profiler.recordStart("drawLayers"),e.dataUploadCounter=0,this.painter.beforeRenderPhases(e,e.backgroundColor,this.state.padding),e.drawPhase=B.S5.MAP;for(const i of t)i.processRender(e);if(this.children.some((t=>t.hasHighlight))){e.drawPhase=B.S5.HIGHLIGHT;for(const i of t)i.processRender(e)}if(this.children.some((t=>t.hasLabels))){e.drawPhase=B.S5.LABEL;for(const i of t)i.processRender(e)}if((0,r.A)("esri-tiles-debug")){e.drawPhase=B.S5.DEBUG;for(const i of t)i.processRender(e)}this.painter.afterRenderPhases(e),e.profiler.recordEnd("drawLayers"),i.logInfo()}doRender(t){const e=this.context,{state:i,pixelRatio:n}=t;this._canvas.resize(t),e.setViewport(0,0,n*i.size[0],n*i.size[1]),e.setDepthWriteEnabled(!0),e.setStencilWriteMask(255),this.renderChildren(t)}async takeScreenshot(t,e,i,n){const r=Math.round(this.state.size[0]*t.resolutionScale),s=Math.round(this.state.size[1]*t.resolutionScale),o=t.resolutionScale,a=this.context,l=this._state.clone();if(null!=n){const t=l.viewpoint;l.viewpoint.rotation=n,l.viewpoint=t}const c={...this._renderParameters,drawPhase:null,globalOpacity:1,stationary:!0,state:l,pixelRatio:o,time:performance.now(),deltaTime:0,blendMode:null,effects:null,inFadeTransition:!1,backgroundColor:i},u=new Tt.R(r,s);u.wrapMode=ot.pF.CLAMP_TO_EDGE,u.internalFormat=ot.H0.RGBA8,u.isImmutable=!0;const h=new ve.H(a,u,new xe.q(ot.yQ.DEPTH_STENCIL,r,s)),d=a.getBoundFramebufferObject(),f=a.getViewport();a.bindFramebuffer(h),a.setViewport(0,0,r,s),this._renderChildren(e??this.children,c);const _=this._readbackScreenshot(h,{...t.cropArea,y:s-(t.cropArea.y+t.cropArea.height)});a.bindFramebuffer(d),a.setViewport(f.x,f.y,f.width,f.height),this.requestRender();const p=await _;let m;return 1===t.outputScale?m=p:(m=new ImageData(Math.round(p.width*t.outputScale),Math.round(p.height*t.outputScale)),(0,Je.Go)(p,m,!0)),h.dispose(),m}async _readbackScreenshot(t,e){const i=(0,ei.xR)(e.width,e.height,document.createElement("canvas"));return await t.readPixelsAsync(e.x,e.y,e.width,e.height,ot.Ab.RGBA,ot.ld.UNSIGNED_BYTE,new Uint8Array(i.data.buffer)),i}_emptyTrash(){for(;this._trash.size>0;){const t=Array.from(this._trash);this._trash.clear();for(const e of t)e.processDetach()}}}var ni=i(79083),ri=i(56625),si=i(17215),oi=i(13237),ai=i(77472),li=i(14606),ci=i(28181),ui=i(90683),hi=i(20248),di=i(77515),fi=i(95680),_i=i(9030);class pi extends di.q{constructor(){super(),this._handles=new li.A,this._resourcePixelRatio=1,this.updatingHandles=new hi.U,this.visible=!1}destroy(){this._handles=(0,s.pR)(this._handles),this._disposeRenderResources(),this._resourcesTask=(0,s.DC)(this._resourcesTask)}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){this._backgroundColor=t,this.requestRender()}get magnifier(){return this._magnifier}set magnifier(t){this._magnifier=t,this._handles.removeAll(),this._handles.add([(0,ci.watch)((()=>t.version),(()=>{this.visible=t.visible&&null!=t.position&&t.size>0,this.requestRender()}),ci.Vh),(0,ci.watch)((()=>[t.maskUrl,t.overlayUrl]),(()=>this._reloadResources())),(0,ci.watch)((()=>t.size),(()=>{this._disposeRenderResources(),this.requestRender()}))])}_createTransforms(){return{displayViewScreenMat3:(0,l.vt)()}}doRender(t){const e=t.context;if(!this._resourcesTask)return void this._reloadResources();if(t.drawPhase!==B.S5.MAP||!this._canRender())return;this._updateResources(t);const i=this._magnifier;if(null==i.position)return;const n=t.pixelRatio,r=i.size*n,s=1/i.factor,o=Math.ceil(s*r);this._readbackTexture.resize(o,o);const{size:a}=t.state,l=n*a[0],c=n*a[1],u=.5*o,h=.5*o,d=(0,F.qE)(n*i.position.x,u,l-u-1),f=(0,F.qE)(c-n*i.position.y,h,c-h-1);e.setBlendingEnabled(!0);const _=d-u,p=f-h,m=this._readbackTexture;e.bindTexture(m,0),e.gl.copyTexImage2D(m.descriptor.target,0,m.descriptor.pixelFormat,_,p,o,o,0);const g=this.backgroundColor,y=g?[g.a*g.r/255,g.a*g.g/255,g.a*g.b/255,g.a]:[1,1,1,1],v=(d+i.offset.x*n)/l*2-1,x=(f-i.offset.y*n)/c*2-1,b=r/l*2,S=r/c*2,w=this._program;e.bindVAO(this._vertexArrayObject),e.bindTexture(this._overlayTexture,6),e.bindTexture(this._maskTexture,7),e.useProgram(w),w.setUniform4fv("u_background",y),w.setUniform1i("u_readbackTexture",0),w.setUniform1i("u_overlayTexture",6),w.setUniform1i("u_maskTexture",7),w.setUniform4f("u_drawPos",v,x,b,S),w.setUniform1i("u_maskEnabled",i.maskEnabled?1:0),w.setUniform1i("u_overlayEnabled",i.overlayEnabled?1:0),e.setStencilTestEnabled(!1),e.setColorMask(!0,!0,!0,!0),e.drawArrays(ot.WR.TRIANGLE_STRIP,0,4),e.bindVAO()}_canRender(){return this._mask&&this._overlay&&null!=this._magnifier}_reloadResources(){this._resourcesTask&&this._resourcesTask.abort();const t=null!=this._magnifier?this._magnifier.maskUrl:null,e=null!=this._magnifier?this._magnifier.overlayUrl:null;this._resourcesTask=(0,ai.UT)((async n=>{const r=null==t||null==e?async function(t){const e=i.e(4550).then(i.bind(i,31972)),n=i.e(9552).then(i.bind(i,33836)),r=(0,_i.D)((await e).default,{signal:t}),s=(0,_i.D)((await n).default,{signal:t}),o={mask:await r,overlay:await s};return(0,pt.Te)(t),o}(n):null,s=null!=t?(0,ft.A)(t,{responseType:"image",signal:n}).then((t=>t.data)):r.then((t=>t.mask)),o=null!=e?(0,ft.A)(e,{responseType:"image",signal:n}).then((t=>t.data)):r.then((t=>t.overlay)),[a,l]=await Promise.all([s,o]);this._mask=a,this._overlay=l,this._disposeRenderResources(),this.requestRender()})),this.updatingHandles.addPromise(this._resourcesTask.promise)}_disposeRenderResources(){this._readbackTexture=(0,s.WD)(this._readbackTexture),this._overlayTexture=(0,s.WD)(this._overlayTexture),this._maskTexture=(0,s.WD)(this._maskTexture),this._vertexArrayObject=(0,s.WD)(this._vertexArrayObject),this._program=(0,s.WD)(this._program)}_updateResources(t){if(t.pixelRatio!==this._resourcePixelRatio&&this._disposeRenderResources(),this._readbackTexture)return;const e=t.context;this._resourcePixelRatio=t.pixelRatio;const i=Math.ceil(this._magnifier.size*t.pixelRatio);this._program=(0,fi.h)(e);const n=new Uint16Array([0,1,0,0,1,1,1,0]),r=fi.j.attributes;this._vertexArrayObject=new lt.Z(e,r,nt.VS,{geometry:st.g.createVertex(e,ot._U.STATIC_DRAW,n)}),this._overlay.width=i,this._overlay.height=i;const s=new Tt.R;s.internalFormat=ot.Ab.RGBA,s.wrapMode=ot.pF.CLAMP_TO_EDGE,s.samplingMode=ot.Cj.NEAREST,s.flipped=!0,s.preMultiplyAlpha=!(0,ui.XJ)(this._overlay.src)||!t.context.driverTest.svgPremultipliesAlpha.result,this._overlayTexture=new wt.g(e,s,this._overlay),this._mask.width=i,this._mask.height=i,s.pixelFormat=s.internalFormat=ot.Ab.ALPHA,this._maskTexture=new wt.g(e,s,this._mask);const o=1/this._magnifier.factor;s.pixelFormat=s.internalFormat=ot.Ab.RGBA,s.width=s.height=Math.ceil(o*i),s.samplingMode=ot.Cj.LINEAR,s.flipped=!1,this._readbackTexture=new wt.g(e,s)}}},13237:function(t,e,i){i.d(e,{A:function(){return W}});var n=i(53804),r=i(20510),s=i(83525),o=i(58941),a=i(95929),l=i(38504),c=i(23502),u=(i(40633),i(13798),i(65953)),h=i(45532),d=i(97849),f=i(13520),_=i(87922);const p="esri-zoom-box",m={container:`${p}__container`,overlay:`${p}__overlay`,background:`${p}__overlay-background`,box:`${p}__outline`},g="Shift";let y=class extends s.A{constructor(t){super(t),this._container=null,this._overlay=null,this._backgroundShape=null,this._boxShape=null,this._box={x:0,y:0,width:0,height:0},this._rafId=null,this._redraw=this._redraw.bind(this)}destroy(){this.view=null}set view(t){this.removeAllHandles(),this._destroyOverlay(),this._set("view",t),t&&this.addHandles([t.on("drag",[g],(t=>this._handleDrag(t,1)),_.o.INTERNAL),t.on("drag",[g,"Control"],(t=>this._handleDrag(t,-1)),_.o.INTERNAL)])}_start(){this._createContainer(),this._createOverlay(),this.navigation.begin()}_update(t,e,i,n){this._box.x=t,this._box.y=e,this._box.width=i,this._box.height=n,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}_end(t,e,i,n,r){const s=this.view,a=s.toMap((0,f.tc)(t+.5*i,e+.5*n));let c=Math.max(i/s.width,n/s.height);-1===r&&(c=1/c),this._destroyOverlay(),this.navigation.end(),s.goTo({center:a,scale:s.scale*c},{animationMode:"always",duration:(0,l.l5)((0,o.A)("mapview-essential-goto-duration"))})}_updateBox(t,e,i,n){const r=this._boxShape;r.setAttributeNS(null,"x",""+t),r.setAttributeNS(null,"y",""+e),r.setAttributeNS(null,"width",""+i),r.setAttributeNS(null,"height",""+n),r.setAttributeNS(null,"class",m.box)}_updateBackground(t,e,i,n){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(t,e,i,n,this.view.width,this.view.height))}_createContainer(){const t=document.createElement("div");t.className=m.container,this.view.root.appendChild(t),this._container=t}_createOverlay(){const t=this.view.width,e=this.view.height,i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttributeNS(null,"d","M 0 0 L "+t+" 0 L "+t+" "+e+" L 0 "+e+" Z"),i.setAttributeNS(null,"class",m.background);const n=document.createElementNS("http://www.w3.org/2000/svg","rect"),r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),r.setAttributeNS(null,"class",m.overlay),r.appendChild(i),r.appendChild(n),this._container.appendChild(r),this._backgroundShape=i,this._boxShape=n,this._overlay=r}_destroyOverlay(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null}_toSVGPath(t,e,i,n,r,s){const o=t+i,a=e+n;return"M 0 0 L "+r+" 0 L "+r+" "+s+" L 0 "+s+" ZM "+t+" "+e+" L "+t+" "+a+" L "+o+" "+a+" L "+o+" "+e+" Z"}_handleDrag(t,e){const i=t.x,n=t.y,r=t.origin.x,s=t.origin.y;let o,a,l,c;switch(i>r?(o=r,l=i-r):(o=i,l=r-i),n>s?(a=s,c=n-s):(a=n,c=s-n),t.action){case"start":this._start();break;case"update":this._update(o,a,l,c);break;case"end":this._end(o,a,l,c,e)}t.stopPropagation()}_redraw(){if(!this._rafId)return;if(this._rafId=null,!this._overlay)return;const{x:t,y:e,width:i,height:n}=this._box;this._updateBox(t,e,i,n),this._updateBackground(t,e,i,n),this._rafId=requestAnimationFrame(this._redraw)}};(0,n._)([(0,c.MZ)()],y.prototype,"navigation",void 0),(0,n._)([(0,c.MZ)()],y.prototype,"view",null),y=(0,n._)([(0,u.$)("esri.views.2d.navigation.ZoomBox")],y);const v=y;i(50917);var x=i(28181),b=i(20551),S=i(32501);class w{constructor(t){this._gain=t,this.lastValue=void 0,this.filteredDelta=void 0}update(t){if(this.hasLastValue()){const e=this.computeDelta(t);this._updateDelta(e)}this.lastValue=t}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return void 0!==this.lastValue}hasFilteredDelta(){return void 0!==this.filteredDelta}computeDelta(t){return void 0===this.lastValue?NaN:t-this.lastValue}_updateDelta(t){void 0!==this.filteredDelta?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*t:this.filteredDelta=t}}class T{constructor(t,e,i){this._initialVelocity=t,this._stopVelocity=e,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(t){return t>this.duration}get friction(){return this._friction}value(t){return this.valueFromInitialVelocity(this._initialVelocity,t)}valueDelta(t,e){const i=this.value(t);return this.value(t+e)-i}valueFromInitialVelocity(t,e){e=Math.min(e,this.duration);const i=1-this.friction;return t*(i**e-1)/Math.log(i)}}class M extends T{constructor(t,e,i,n,r){super(t,e,i),this._sceneVelocity=n,this.direction=r}value(t){return super.valueFromInitialVelocity(this._sceneVelocity,t)}}class P{constructor(t=300,e=12,i=.84){this._minimumInitialVelocity=t,this._stopVelocity=e,this._friction=i,this.enabled=!0,this._time=new w(.6),this._screen=[new w(.4),new w(.4)],this._scene=[new w(.6),new w(.6),new w(.6)],this._tmpDirection=(0,S.vt)()}add(t,e,i){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(i)<.015)return;this._screen[0].update(t[0]),this._screen[1].update(t[1]),this._scene[0].update(e[0]),this._scene[1].update(e[1]),this._scene[2].update(e[2]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const t=this._screen[0].filteredDelta,e=this._screen[1].filteredDelta,i=null==t||null==e?0:Math.sqrt(t*t+e*e),n=this._time.filteredDelta,r=null==n||null==i?0:i/n;return Math.abs(r)<this._minimumInitialVelocity?null:this.createMomentum(r,this._stopVelocity,this._friction)}createMomentum(t,e,i){(0,b.s)(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const n=(0,b.l)(this._tmpDirection);n>0&&(0,b.j)(this._tmpDirection,this._tmpDirection,1/n);const r=this._time.filteredDelta;return new M(t,e,i,null==r?0:n/r,this._tmpDirection)}}let E=class extends s.A{constructor(t){super(t),this.animationTime=0,this.momentumEstimator=new P(500,6,.92),this.momentum=null,this.tmpMomentum=(0,S.vt)(),this.momentumFinished=!1,this.viewpoint=new r.A({targetGeometry:new h.default,scale:0,rotation:0}),this._previousDrag=null,(0,x.when)((()=>this.momentumFinished),(()=>this.navigation.stop()))}begin(t,e){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(e),this._previousDrag=e}update(t,e){this.addToEstimator(e);let i=e.center.x,n=e.center.y;const r=this._previousDrag;i=r?r.center.x-i:-i,n=r?n-r.center.y:n,t.viewpoint=(0,d.aA)(this.viewpoint,t.viewpoint,[i||0,n||0]),this._previousDrag=e}end(t,e){this.addToEstimator(e);const i=t.navigation.effectiveMomentumEnabled;this.momentum=i?this.momentumEstimator.evaluateMomentum():null,this.animationTime=0,this.momentum&&this.onAnimationUpdate(t),this._previousDrag=null,this.navigation.end()}addToEstimator(t){const e=t.center.x,i=t.center.y,n=(0,f.gs)(-e,i),r=(0,S.fA)(-e,i,0);this.momentumEstimator.add(n,r,.001*t.timestamp)}onAnimationUpdate(t){this.navigation.animationManager?.animateContinuous(t.viewpoint,((e,i)=>{const{momentum:n,animationTime:r,tmpMomentum:s}=this,o=.001*i;if(!(this.momentumFinished=!n||n.isFinished(r))){const i=n.valueDelta(r,o);(0,b.j)(s,n.direction,i),(0,d.aA)(e,e,s),t.constraints.constrainByGeometry(e)}this.animationTime+=o}))}stopMomentumNavigation(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())}};(0,n._)([(0,c.MZ)()],E.prototype,"momentumFinished",void 0),(0,n._)([(0,c.MZ)()],E.prototype,"viewpoint",void 0),(0,n._)([(0,c.MZ)()],E.prototype,"navigation",void 0),E=(0,n._)([(0,u.$)("esri.views.2d.navigation.actions.Pan")],E);const A=E;var C=i(13786),I=i(1932),R=i(15774);class O{constructor(t=2.5,e=.01,i=.95,n=12){this._minimumInitialVelocity=t,this._stopVelocity=e,this._friction=i,this._maxVelocity=n,this.enabled=!0,this.value=new w(.8),this.time=new w(.3)}add(t,e){if(this.enabled&&null!=e){if(this.time.hasLastValue()){if(this.time.computeDelta(e)<.01)return;if(this.value.hasFilteredDelta()){const e=this.value.computeDelta(t);this.value.filteredDelta*e<0&&this.value.reset()}}this.time.update(e),this.value.update(t)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let t=this.value.filteredDelta/this.time.filteredDelta;return t=(0,R.qE)(t,-this._maxVelocity,this._maxVelocity),Math.abs(t)<this._minimumInitialVelocity?null:this.createMomentum(t,this._stopVelocity,this._friction)}createMomentum(t,e,i){return new T(t,e,i)}}class F extends O{constructor(t=3,e=.01,i=.95,n=12){super(t,e,i,n)}add(t,e){const i=this.value.lastValue;if(null!=i){let e=t-i;for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;t=i+e}super.add(t,e)}}class z extends T{constructor(t,e,i){super(t,e,i)}value(t){const e=super.value(t);return Math.exp(e)}valueDelta(t,e){const i=super.value(t),n=super.value(t+e)-i;return Math.exp(n)}}class D extends O{constructor(t=2.5,e=.01,i=.95,n=12){super(t,e,i,n)}add(t,e){super.add(Math.log(t),e)}createMomentum(t,e,i){return new z(t,e,i)}}let L=class extends s.A{constructor(t){super(t),this._animationTime=0,this._momentumFinished=!1,this._previousAngle=0,this._previousRadius=0,this._previousCenter=null,this._rotationMomentumEstimator=new F(.6,.15,.95),this._rotationDirection=1,this._startAngle=0,this._startRadius=0,this._updateTimestamp=null,this._zoomDirection=1,this._zoomMomentumEstimator=new D,this._zoomOnly=null,this.viewpoint=new r.A({targetGeometry:new h.default,scale:0,rotation:0}),this.zoomMomentum=null,this.rotateMomentum=null,this.addHandles((0,x.when)((()=>this._momentumFinished),(()=>this.navigation.stop())))}begin(t,e){this.navigation.begin(),this._rotationMomentumEstimator.reset(),this._zoomMomentumEstimator.reset(),this._zoomOnly=null,this._previousAngle=this._startAngle=e.angle,this._previousRadius=this._startRadius=e.radius,this._previousCenter=e.center,this._updateTimestamp=null,t.constraints.rotationEnabled&&this.addToRotateEstimator(0,e.timestamp),this.addToZoomEstimator(e,1)}update(t,e){null===this._updateTimestamp&&(this._updateTimestamp=e.timestamp);const i=e.angle,n=e.radius,r=e.center,s=Math.abs(180*(i-this._startAngle)/Math.PI),o=Math.abs(n-this._startRadius),a=this._startRadius/n;if(this._previousRadius&&this._previousCenter){const l=n/this._previousRadius;let c=180*(i-this._previousAngle)/Math.PI;this._rotationDirection=c>=0?1:-1,this._zoomDirection=l>=1?1:-1,t.constraints.rotationEnabled?(null===this._zoomOnly&&e.timestamp-this._updateTimestamp>200&&(this._zoomOnly=o-s>0),null===this._zoomOnly||this._zoomOnly?c=0:this.addToRotateEstimator(i-this._startAngle,e.timestamp)):c=0,this.addToZoomEstimator(e,a),this.navigation.setViewpoint([r.x,r.y],1/l,c,[this._previousCenter.x-r.x,r.y-this._previousCenter.y])}this._previousAngle=i,this._previousRadius=n,this._previousCenter=r}end(t){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=0,(this.rotateMomentum||this.zoomMomentum)&&this.onAnimationUpdate(t),this.navigation.end()}addToRotateEstimator(t,e){this._rotationMomentumEstimator.add(t,.001*e)}addToZoomEstimator(t,e){this._zoomMomentumEstimator.add(e,.001*t.timestamp)}canZoomIn(t){const e=t.scale,i=t.constraints.effectiveMaxScale;return 0===i||e>i}canZoomOut(t){const e=t.scale,i=t.constraints.effectiveMinScale;return 0===i||e<i}onAnimationUpdate(t){this.navigation.animationManager?.animateContinuous(t.viewpoint,((e,i)=>{const n=!this.canZoomIn(t)&&this._zoomDirection>1||!this.canZoomOut(t)&&this._zoomDirection<1,r=!this.rotateMomentum||this.rotateMomentum.isFinished(this._animationTime),s=n||!this.zoomMomentum||this.zoomMomentum.isFinished(this._animationTime),o=.001*i;if(this._momentumFinished=r&&s,!this._momentumFinished){const i=this.rotateMomentum?Math.abs(this.rotateMomentum.valueDelta(this._animationTime,o))*this._rotationDirection*180/Math.PI:0;let n=this.zoomMomentum?Math.abs(this.zoomMomentum.valueDelta(this._animationTime,o)):1;const r=(0,I.vt)(),s=(0,I.vt)();if(this._previousCenter){(0,C.hZ)(r,this._previousCenter.x,this._previousCenter.y),(0,d.b8)(s,t.size,t.padding),(0,C.WQ)(r,r,s);const{constraints:o,scale:a}=t,l=a*n;n<1&&!o.canZoomInTo(l)?(n=a/o.effectiveMaxScale,this.zoomMomentum=null,this.rotateMomentum=null):n>1&&!o.canZoomOutTo(l)&&(n=a/o.effectiveMinScale,this.zoomMomentum=null,this.rotateMomentum=null),(0,d.WK)(e,t.viewpoint,n,i,r,t.size),t.constraints.constrainByGeometry(e)}}this._animationTime+=o}))}stopMomentumNavigation(){(this.rotateMomentum||this.zoomMomentum)&&(this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop())}};(0,n._)([(0,c.MZ)()],L.prototype,"_momentumFinished",void 0),(0,n._)([(0,c.MZ)()],L.prototype,"viewpoint",void 0),(0,n._)([(0,c.MZ)()],L.prototype,"navigation",void 0),L=(0,n._)([(0,u.$)("esri.views.2d.navigation.actions.Pinch")],L);const N=L,B=(0,I.vt)(),k=(0,I.vt)();let V=class extends s.A{constructor(t){super(t),this._previousCenter=(0,I.vt)(),this.viewpoint=new r.A({targetGeometry:new h.default,scale:0,rotation:0})}begin(t,e){this.navigation.begin(),(0,C.hZ)(this._previousCenter,e.center.x,e.center.y)}update(t,e){const{state:{size:i,padding:n}}=t;(0,C.hZ)(B,e.center.x,e.center.y),(0,d.iB)(k,i,n),t.viewpoint=(0,d.tj)(this.viewpoint,t.state.paddedViewState.viewpoint,(0,d.s5)(k,this._previousCenter,B)),(0,C.C)(this._previousCenter,B)}end(){this.navigation.end()}};(0,n._)([(0,c.MZ)()],V.prototype,"viewpoint",void 0),(0,n._)([(0,c.MZ)()],V.prototype,"navigation",void 0),V=(0,n._)([(0,u.$)("esri.views.2d.navigation.actions.Rotate")],V);const U=V,G=new r.A({targetGeometry:new h.default}),H=[0,0];let Y=class extends s.A{constructor(t){super(t),this._endTimer=null,this._lastEventTimestamp=null,this.animationManager=null,this.interacting=!1}initialize(){this.pan=new A({navigation:this}),this.rotate=new U({navigation:this}),this.pinch=new N({navigation:this}),this.zoomBox=new v({view:this.view,navigation:this})}destroy(){this.pan=(0,a.pR)(this.pan),this.rotate=(0,a.pR)(this.rotate),this.pinch=(0,a.pR)(this.pinch),this.zoomBox=(0,a.pR)(this.zoomBox),this.animationManager=null}begin(){this.stop(),this._set("interacting",!0)}end(){this._lastEventTimestamp=performance.now(),this._startTimer(250)}async zoom(t,e=this._getDefaultAnchor()){if(this.begin(),this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs)return t<1?this.zoomIn(e):this.zoomOut(e);this.setViewpoint(e,t,0,[0,0])}async zoomIn(t){const e=this.view,i=e.constraints.snapToNextScale(e.scale);return this._zoomToScale(i,t)}async zoomOut(t){const e=this.view,i=e.constraints.snapToPreviousScale(e.scale);return this._zoomToScale(i,t)}setViewpoint(t,e,i,n){this.begin(),this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,t,e,i,n),this.end()}setViewpointImmediate(t,e=0,i=[0,0],n=this._getDefaultAnchor()){this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,n,t,e,i)}continuousRotateClockwise(){const t=this.view.viewpoint;this.animationManager?.animateContinuous(t,(t=>{(0,d.tj)(t,t,-1)}))}continuousRotateCounterclockwise(){const t=this.view.viewpoint;this.animationManager?.animateContinuous(t,(t=>{(0,d.tj)(t,t,1)}))}resetRotation(){this.view.constraints.rotationEnabled&&(this.view.rotation=0)}continuousPanLeft(){this._continuousPan([-10,0])}continuousPanRight(){this._continuousPan([10,0])}continuousPanUp(){this._continuousPan([0,10])}continuousPanDown(){this._continuousPan([0,-10])}continuousPanVector({x:t,y:e}){this._continuousPan([10*t,10*e])}stop(){this.pan.stopMomentumNavigation(),this.animationManager?.stop(),this.end(),null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))}_continuousPan(t){const e=this.view.viewpoint;this.animationManager?.animateContinuous(e,(e=>{(0,d.aA)(e,e,t),this.view.constraints.constrainByGeometry(e)}))}_startTimer(t){return null!==this._endTimer||(this._endTimer=setTimeout((()=>{this._endTimer=null;const t=performance.now()-(this._lastEventTimestamp??0);t<250?this._endTimer=this._startTimer(t):this._set("interacting",!1)}),t)),this._endTimer}_getDefaultAnchor(){const{size:t,padding:{left:e,right:i,top:n,bottom:r}}=this.view;return H[0]=.5*(t[0]-i+e),H[1]=.5*(t[1]-r+n),H}async _zoomToScale(t,e=this._getDefaultAnchor()){const{view:i}=this,{constraints:n,scale:r,viewpoint:s,size:a,padding:c}=i,u=n.canZoomInTo(t),h=n.canZoomOutTo(t);if(!(t<r&&!u||t>r&&!h))return(0,d.qV)(G,s,t/r,0,e,a,c),n.constrainByGeometry(G),i.goTo(G,{animate:!0,animationMode:"always",duration:(0,l.l5)((0,o.A)("mapview-essential-goto-duration")),pickClosestTarget:!1})}_scaleRotateTranslateViewpoint(t,e,i,n,r){const{view:s}=this,{size:o,padding:a,constraints:l,scale:c,viewpoint:u}=s,h=c*i,f=l.canZoomInTo(h),_=l.canZoomOutTo(h);return(i<1&&!f||i>1&&!_)&&(i=1),(0,d.aA)(u,u,r),(0,d.qV)(t,u,i,n,e,o,a),l.constrainByGeometry(t)}};(0,n._)([(0,c.MZ)()],Y.prototype,"animationManager",void 0),(0,n._)([(0,c.MZ)({type:Boolean,readOnly:!0})],Y.prototype,"interacting",void 0),(0,n._)([(0,c.MZ)()],Y.prototype,"pan",void 0),(0,n._)([(0,c.MZ)()],Y.prototype,"pinch",void 0),(0,n._)([(0,c.MZ)()],Y.prototype,"rotate",void 0),(0,n._)([(0,c.MZ)()],Y.prototype,"view",void 0),(0,n._)([(0,c.MZ)()],Y.prototype,"zoomBox",void 0),Y=(0,n._)([(0,u.$)("esri.views.2d.navigation.MapViewNavigation")],Y);const W=Y},39506:function(t,e,i){i.d(e,{H:function(){return r},Y:function(){return n}});const n=class{};function r(t,...e){let i="";for(let n=0;n<e.length;n++)i+=t[n]+e[n];return i+=t[t.length-1],i}var s;(s=r||(r={})).int=function(t){return Math.round(t).toString()},s.float=function(t){return t.toPrecision(8)}},54516:function(t,e,i){var n;i.d(e,{c:function(){return n}}),function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"}(n||(n={}))},90553:function(t,e,i){i.d(e,{L:function(){return l},MX:function(){return o},M_:function(){return u},O_:function(){return a},kL:function(){return c},vA:function(){return s},zH:function(){return h}});var n=i(1932);i(33400),(0,i(41546).vt)();class r{constructor(t){this.message=t}toString(){return`AssertException: ${this.message}`}}function s(t,e){if(!t){e=e||"Assertion";const t=new Error(e).stack;throw new r(`${e} at ${t}`)}}function o(t,e){t||(e=e||"",console.warn("Verify failed: "+e+"\n"+new Error("verify").stack))}function a(t,e,i,n){let r,s=(i[0]-t[0])/e[0],o=(n[0]-t[0])/e[0];s>o&&(r=s,s=o,o=r);let a=(i[1]-t[1])/e[1],l=(n[1]-t[1])/e[1];if(a>l&&(r=a,a=l,l=r),s>l||a>o)return!1;a>s&&(s=a),l<o&&(o=l);let c=(i[2]-t[2])/e[2],u=(n[2]-t[2])/e[2];return c>u&&(r=c,c=u,u=r),!(s>u||c>o||(u<o&&(o=u),o<0))}function l(t,e,i,r,s,o=(0,n.vt)()){const a=(r[s]-i[s])*(e[0]-t[0])-(r[0]-i[0])*(e[s]-t[s]),l=(r[0]-i[0])*(t[s]-i[s])-(r[s]-i[s])*(t[0]-i[0]);if(0===a)return!1;const c=l/a;return o[0]=t[0]+c*(e[0]-t[0]),o[1]=t[s]+c*(e[s]-t[s]),!0}function c(t,e){return Math.log(t)/Math.log(e)}function u(t,e,i,n){t[12]=e,t[13]=i,t[14]=n}function h(t){return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&1===t[15]}},54407:function(t,e,i){var n,r,s,o,a,l,c,u,h;i.d(e,{Am:function(){return o},C7:function(){return s},ID:function(){return u},JS:function(){return h},Mg:function(){return l},dd:function(){return a},it:function(){return r},s2:function(){return n},sf:function(){return c}}),function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"}(n||(n={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(r||(r={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(s||(s={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(o||(o={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(a||(a={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}(l||(l={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(c||(c={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(u||(u={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(h||(h={}))},86305:function(t,e,i){i.d(e,{g:function(){return c}});var n=i(50659),r=(i(58941),i(40633)),s=i(24540),o=i(41835),a=i(85456);const l=()=>r.A.getLogger("esri.views.webgl.BufferObject");class c{static createIndex(t,e,i){return new c(t,a.NZ.ELEMENT_ARRAY_BUFFER,e,i)}static createVertex(t,e,i){return new c(t,a.NZ.ARRAY_BUFFER,e,i)}static createUniform(t,e,i){return new c(t,a.NZ.UNIFORM_BUFFER,e,i)}static createPixelPack(t,e=a._U.STREAM_READ,i){const n=new c(t,a.NZ.PIXEL_PACK_BUFFER,e);return i&&n.setSize(i),n}static createPixelUnpack(t,e=a._U.STREAM_DRAW,i){return new c(t,a.NZ.PIXEL_UNPACK_BUFFER,e,i)}static createTransformFeedback(t,e=a._U.STATIC_DRAW,i){const n=new c(t,a.NZ.TRANSFORM_FEEDBACK_BUFFER,e);return n.setSize(i),n}constructor(t,e,i,n){this._context=t,this.bufferType=e,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,t.instanceCounter.increment(a.vt.BufferObject,this),this._glName=this._context.gl.createBuffer(),(0,o.Y2)(this._context.gl),n&&this.setData(n)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){return this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER?this._indexType===a.pe.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER||this.bufferType===a.NZ.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(a.vt.BufferObject,this),this._context=null):this._glName&&l().warn("Leaked WebGL buffer object")}setSize(t,e=null){if(this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&null!=e)switch(this._indexType=e,e){case a.pe.UNSIGNED_SHORT:t*=2;break;case a.pe.UNSIGNED_INT:t*=4}this._setBufferData(t)}setData(t){if(!t)return;let e=t.byteLength;this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&((0,s.jq)(t)&&(e/=2,this._indexType=a.pe.UNSIGNED_SHORT),(0,s.XJ)(t)&&(e/=4,this._indexType=a.pe.UNSIGNED_INT)),this._setBufferData(e,t)}_setBufferData(t,e=null){this._size=t;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const n=this._context.gl;null!=e?n.bufferData(this.bufferType,e,this.usage):n.bufferData(this.bufferType,t,this.usage),(0,o.Y2)(n),this._isVAOAware&&this._context.bindVAO(i)}setSubData(t,e,i,n){if(!t)return;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:s}=this._context;s.bufferSubData(this.bufferType,e*t.BYTES_PER_ELEMENT,t,i,n-i),(0,o.Y2)(s),this._isVAOAware&&this._context.bindVAO(r)}getSubData(t,e=0,i,r){if(i<0||r<0)return;const s=function(t){return(0,n.Xj)(t)}(t)?t.BYTES_PER_ELEMENT:1;if(s*((i??0)+(r??0))>t.byteLength)return;e+s*(r??0)>this.usedMemory&&l().warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this.bufferType===a.NZ.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,a.NZ.TRANSFORM_FEEDBACK_BUFFER),o.getBufferSubData(a.NZ.TRANSFORM_FEEDBACK_BUFFER,e,t,i,r),this._context.unbindBuffer(a.NZ.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,a.NZ.COPY_READ_BUFFER),o.getBufferSubData(a.NZ.COPY_READ_BUFFER,e,t,i,r),this._context.unbindBuffer(a.NZ.COPY_READ_BUFFER))}async getSubDataAsync(t,e=0,i,n){await this._context.clientWaitAsync(),this.getSubData(t,e,i,n)}}},96402:function(t,e,i){i.d(e,{H:function(){return h}}),i(58941);var n=i(40633),r=i(95929),s=i(86305),o=i(41835),a=i(85456),l=i(69452),c=i(49414),u=i(78541);class h{constructor(t,e,i=null){this._context=t,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,t.instanceCounter.increment(a.vt.FramebufferObject,this);const n=d(e)?e:new u.g(this._context,e);if(this._colorAttachments.set(a.Nm.COLOR_ATTACHMENT0,n),this._validateTextureDescriptor(n.descriptor),this._validateColorAttachmentPoint(a.Nm.COLOR_ATTACHMENT0),null!=i)if(function(t){return d(t)||null!=t&&"pixelFormat"in t}(i))this._depthStencilTexture=d(i)?i:new u.g(this._context,i),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const t=function(t){return null!=t&&"type"in t&&t.type===l.p.RenderBuffer}(i)?i:new c.l(this._context,i);this._depthStencilBuffer=t,this._validateRenderBufferDescriptor(t.descriptor)}}dispose(){if(0===this._colorAttachments.size&&!this._glName)return;const t=this._context.getBoundFramebufferObject();this._colorAttachments.forEach(((t,e)=>this.detachColorTexture(e)?.dispose())),this.detachDepthStencilBuffer()?.dispose(),this.detachDepthStencilTexture()?.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(t),this._context.instanceCounter.decrement(a.vt.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(a.Nm.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){const t=this._colorAttachments.get(a.Nm.COLOR_ATTACHMENT0);return t?.descriptor?.width??0}get height(){const t=this._colorAttachments.get(a.Nm.COLOR_ATTACHMENT0);return t?.descriptor?.height??0}get usedMemory(){return[...this._colorAttachments].reduce(((t,[e,i])=>t+i.usedMemory),this.depthStencil?.usedMemory??0)}getColorTexture(t){const e=this._colorAttachments.get(t);return e&&d(e)?e:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(t,e=a.Nm.COLOR_ATTACHMENT0){if(!t)return;this._validateColorAttachmentPoint(e);const i=t.descriptor;this._validateTextureDescriptor(i),this.detachColorTexture(e)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,e)),this._colorAttachments.set(e,t)}detachColorTexture(t=a.Nm.COLOR_ATTACHMENT0){const e=this._colorAttachments.get(t);if(e){if(this._initialized){const e=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t),this._context.bindFramebuffer(e)}return this._colorAttachments.delete(t),e}}setColorTextureTarget(t,e=a.Nm.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(e);i&&this._framebufferTexture2D(i.glName,e,t)}attachDepthStencil(t){if(t)switch(t.type){case l.p.Texture:return this._attachDepthStencilTexture(t);case l.p.RenderBuffer:return this._attachDepthStencilBuffer(t)}}_attachDepthStencilTexture(t){if(null==t)return;const e=t.descriptor;e.pixelFormat!==a.Ab.DEPTH_STENCIL&&e.pixelFormat!==a.Ab.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),e.dataType!==a.ld.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._validateTextureDescriptor(e),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,a.nI)),this._depthStencilTexture?.dispose(),this._depthStencilTexture=t}detachDepthStencilTexture(){const t=this._depthStencilTexture;if(t&&this._initialized){const t=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,a.nI),this._context.bindFramebuffer(t)}return this._depthStencilTexture=null,t}_attachDepthStencilBuffer(t){if(null==t)return;const e=t.descriptor;if(this._validateRenderBufferDescriptor(e),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const i=this._context.gl,n=this._getGLAttachmentPoint(e);i.framebufferRenderbuffer(a.R.FRAMEBUFFER,n,i.RENDERBUFFER,t.glName)}this._depthStencilBuffer=t}detachDepthStencilBuffer(){const t=this._depthStencilBuffer;if(t&&this._initialized){const e=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);const i=this._context.gl,n=this._getGLAttachmentPoint(t.descriptor);i.framebufferRenderbuffer(a.R.FRAMEBUFFER,n,i.RENDERBUFFER,null),this._context.bindFramebuffer(e)}return this._depthStencilBuffer=null,t}copyToTexture(t,e,i,n,r,s,o){(t<0||e<0||r<0||s<0)&&console.error("Offsets cannot be negative!"),(i<=0||n<=0)&&console.error("Copy width and height must be greater than zero!");const l=o.descriptor;o.descriptor.target!==a.Ap.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(null==l?.width||null==l?.height||t+i>this.width||e+n>this.height||r+i>l.width||s+n>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,h=c.bindTexture(o,u.g.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(u.g.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(a.Ap.TEXTURE_2D,0,r,s,t,e,i,n),c.bindTexture(h,u.g.TEXTURE_UNIT_FOR_UPDATES)}readPixels(t,e,i,n,r,s,o){(i<=0||n<=0)&&console.error("Copy width and height must be greater than zero!"),o||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(t,e,i,n,r,s,o)}async readPixelsAsync(t,e,i,n,r,o,l){const{gl:c}=this._context,u=s.g.createPixelPack(this._context,a._U.STREAM_READ,l.byteLength);this._context.bindBuffer(u),this._context.bindFramebuffer(this),c.readPixels(t,e,i,n,r,o,0),this._context.unbindBuffer(a.NZ.PIXEL_PACK_BUFFER),await u.getSubDataAsync(l),u.dispose()}resize(t,e){if(this.width===t&&this.height===e)return;const i={width:t,height:e};f(i,this._context.parameters.maxTextureSize),this._colorAttachments.forEach((t=>t.resize(i.width,i.height))),this._depthStencilTexture?.resize(i.width,i.height),this._initialized&&(f(i,this._context.parameters.maxRenderbufferSize),this._depthStencilBuffer?.resize(i.width,i.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(t=a.R.FRAMEBUFFER){const e=this._context.gl;if(this._initialized)return void e.bindFramebuffer(t,this.glName);this._glName&&e.deleteFramebuffer(this._glName);const i=e.createFramebuffer();if(e.bindFramebuffer(t,i),this._colorAttachments.forEach(((e,i)=>this._framebufferTexture2D(e.glName,i,_(e),t))),this._depthStencilBuffer){const i=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(t,i,e.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,e.DEPTH_STENCIL_ATTACHMENT,_(this._depthStencilTexture),t);(0,o.en)()&&e.checkFramebufferStatus(t)!==e.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=i,this._initialized=!0}_framebufferTexture2D(t,e=a.Nm.COLOR_ATTACHMENT0,i=a.Ap.TEXTURE_2D,n=a.R.FRAMEBUFFER,r=0){this._context.gl.framebufferTexture2D(n,e,i,t,r)}_disposeDepthStencilAttachments(){const t=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const e=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);t.framebufferRenderbuffer(a.R.FRAMEBUFFER,e,t.RENDERBUFFER,null)}this._depthStencilBuffer=(0,r.WD)(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=(0,r.WD)(this._depthStencilTexture))}_validateTextureDescriptor(t){t.target!==a.Ap.TEXTURE_2D&&t.target!==a.Ap.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),f(t,this._context.parameters.maxTextureSize),this._validateBufferDimensions(t)}_validateRenderBufferDescriptor(t){f(t,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(t)}_validateBufferDimensions(t){t.width<=0&&(t.width=this.width),t.height<=0&&(t.height=this.height),this.width>0&&this.height>0&&(this.width===t.width&&this.height===t.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(t){switch(t.internalFormat){case a.yQ.DEPTH_COMPONENT16:case a.yQ.DEPTH_COMPONENT24:case a.yQ.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case a.yQ.DEPTH24_STENCIL8:case a.yQ.DEPTH32F_STENCIL8:case a.yQ.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case a.yQ.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(t){if(-1===h._MAX_COLOR_ATTACHMENTS){const{gl:t}=this._context;h._MAX_COLOR_ATTACHMENTS=t.getParameter(t.MAX_COLOR_ATTACHMENTS)}const e=t-a.Nm.COLOR_ATTACHMENT0;e+1>h._MAX_COLOR_ATTACHMENTS&&n.A.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${e+1}. Implementation supports up to ${h._MAX_COLOR_ATTACHMENTS} color attachments`)}}function d(t){return null!=t&&"type"in t&&t.type===l.p.Texture}function f(t,e){const i=Math.max(t.width,t.height);if(i>e){n.A.getLogger("esri.views.webgl.FramebufferObject").warn(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const r=e/i;return t.width=Math.round(t.width*r),t.height=Math.round(t.height*r),!1}return!0}function _(t){return t.descriptor.target===a.Ap.TEXTURE_CUBE_MAP?a.Ap.TEXTURE_CUBE_MAP_POSITIVE_X:a.Ap.TEXTURE_2D}h._MAX_COLOR_ATTACHMENTS=-1},69452:function(t,e,i){var n;i.d(e,{p:function(){return n}}),function(t){t[t.Texture=0]="Texture",t[t.RenderBuffer=1]="RenderBuffer"}(n||(n={}))},95904:function(t,e,i){i.d(e,{B:function(){return F}}),i(58941);var n=i(41835),r=i(85456);const s=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"],o=!1;var a=i(80562),l=999,c=9999,u=0,h=1,d=2,f=3,_=4,p=5,m=6,g=7,y=8,v=9,x=10,b=11,S=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function w(t){return function(t){var e=function(){var t,e,i,n=0,r=0,s=l,o=[],w=[],T=1,M=0,P=0,E=!1,A=!1,C="";return function(t){return w=[],null!==t?R(t.replace?t.replace(/\r\n/g,"\n"):t):(o.length&&I(o.join("")),s=x,I("(eof)"),w)};function I(t){t.length&&w.push({type:S[s],data:t,position:P,line:T,column:M})}function R(e){var o;for(n=0,i=(C+=e).length;t=C[n],n<i;){switch(o=n,s){case u:n=D();break;case h:case d:n=z();break;case f:n=L();break;case _:n=k();break;case b:n=B();break;case p:n=V();break;case c:n=U();break;case v:n=F();break;case l:n=O()}o!==n&&("\n"===C[o]?(M=0,++T):++M)}return r+=n,C=C.slice(n),w}function O(){return o=o.length?[]:o,"/"===e&&"*"===t?(P=r+n-1,s=u,e=t,n+1):"/"===e&&"/"===t?(P=r+n-1,s=h,e=t,n+1):"#"===t?(s=d,P=r+n,n):/\s/.test(t)?(s=v,P=r+n,n):(E=/\d/.test(t),A=/[^\w_]/.test(t),P=r+n,s=E?_:A?f:c,n)}function F(){return/[^\s]/g.test(t)?(I(o.join("")),s=l,n):(o.push(t),e=t,n+1)}function z(){return"\r"!==t&&"\n"!==t||"\\"===e?(o.push(t),e=t,n+1):(I(o.join("")),s=l,n)}function D(){return"/"===t&&"*"===e?(o.push(t),I(o.join("")),s=l,n+1):(o.push(t),e=t,n+1)}function L(){if("."===e&&/\d/.test(t))return s=p,n;if("/"===e&&"*"===t)return s=u,n;if("/"===e&&"/"===t)return s=h,n;if("."===t&&o.length){for(;N(o););return s=p,n}if(";"===t||")"===t||"("===t){if(o.length)for(;N(o););return I(t),s=l,n+1}var i=2===o.length&&"="!==t;if(/[\w_\d\s]/.test(t)||i){for(;N(o););return s=l,n}return o.push(t),e=t,n+1}function N(t){for(var e,i,n=0;;){if(e=a.o.indexOf(t.slice(0,t.length+n).join("")),i=a.o[e],-1===e){if(n--+t.length>0)continue;i=t.slice(0,1).join("")}return I(i),P+=i.length,(o=o.slice(i.length)).length}}function B(){return/[^a-fA-F0-9]/.test(t)?(I(o.join("")),s=l,n):(o.push(t),e=t,n+1)}function k(){return"."===t||/[eE]/.test(t)?(o.push(t),s=p,e=t,n+1):"x"===t&&1===o.length&&"0"===o[0]?(s=b,o.push(t),e=t,n+1):/[^\d]/.test(t)?(I(o.join("")),s=l,n):(o.push(t),e=t,n+1)}function V(){return"f"===t&&(o.push(t),e=t,n+=1),/[eE]/.test(t)||"-"===t&&/[eE]/.test(e)?(o.push(t),e=t,n+1):/[^\d]/.test(t)?(I(o.join("")),s=l,n):(o.push(t),e=t,n+1)}function U(){if(/[^\d\w_]/.test(t)){var i=o.join("");return s=a.l.indexOf(i)>-1?y:a.b.indexOf(i)>-1?g:m,I(o.join("")),s=l,n}return o.push(t),e=t,n+1}}(),i=[];return(i=i.concat(e(t))).concat(e(null))}(t)}const T=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]);function M(t,e){for(let i=e-1;i>=0;i--){const e=t[i];if("whitespace"!==e.type&&"block-comment"!==e.type){if("keyword"!==e.type)break;if("attribute"===e.data||"in"===e.data)return!0}}return!1}function P(t,e,i,n){n=n||i;for(const r of t)if("ident"===r.type&&r.data===i)return n in e?e[n]++:e[n]=0,P(t,e,n+"_"+e[n],n);return i}function E(t,e,i="afterVersion"){function n(t,e){for(let i=e;i<t.length;i++){const e=t[i];if("operator"===e.type&&";"===e.data)return i}return null}const r={data:"\n",type:"whitespace"},s=e=>e<t.length&&/[^\r\n]$/.test(t[e].data);let o=function(t){let e=-1,r=0,s=-1;for(let o=0;o<t.length;o++){const a=t[o];if("preprocessor"===a.type&&(/#(if|ifdef|ifndef)\s+.+/.test(a.data)?++r:/#endif\s*.*/.test(a.data)&&--r),"afterVersion"!==i&&"afterPrecision"!==i||"preprocessor"===a.type&&a.data.startsWith("#version")&&(s=Math.max(s,o)),"afterPrecision"===i&&"keyword"===a.type&&"precision"===a.data){const e=n(t,o);if(null===e)throw new Error("precision statement not followed by any semicolons!");s=Math.max(s,e)}e<s&&0===r&&(e=o)}return e+1}(t);s(o-1)&&t.splice(o++,0,r);for(const i of e)t.splice(o++,0,i);s(o-1)&&s(o)&&t.splice(o,0,r)}function A(t,e,i,n="lowp"){E(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:n},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function C(t,e,i,n,r="lowp"){E(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:n.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function I(t,e){let i,n,r=-1;for(let s=e;s<t.length;s++){const e=t[s];if("operator"===e.type&&("["===e.data&&(i=s),"]"===e.data)){n=s;break}"integer"===e.type&&(r=parseInt(e.data,10))}return i&&n&&t.splice(i,n-i+1),r}function R(t,e){if(t.startsWith("#version 300"))return t;const i=(n=t,o?O.get(n):null);var n;if(null!=i)return i;const a=w(t);if("300 es"===function(t,e="100",i="300 es"){const n=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const r of t)if("preprocessor"===r.type){const t=n.exec(r.data);if(t){const n=t[1].replaceAll(/\s{2,}/g," ");if(n===i)return n;if(n===e)return r.data="#version "+i,e;throw new Error("unknown glsl version: "+n)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:"\n"}),null}(a,"100","300 es"))return t;let l=null,c=null;const u={},h={};for(let t=0;t<a.length;++t){const i=a[t];switch(i.type){case"keyword":e===r.Co.VERTEX_SHADER&&"attribute"===i.data?i.data="in":"varying"===i.data&&(i.data=e===r.Co.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(i.data.trim())&&(i.data=i.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===r.Co.FRAGMENT_SHADER&&"gl_FragColor"===i.data&&(l||(l=P(a,u,"fragColor"),A(a,l,"vec4")),i.data=l),e===r.Co.FRAGMENT_SHADER&&"gl_FragData"===i.data){const e=I(a,t+1),n=P(a,u,"fragData");C(a,n,"vec4",e,"mediump"),i.data=n}else e===r.Co.FRAGMENT_SHADER&&"gl_FragDepthEXT"===i.data&&(c||(c=P(a,u,"gl_FragDepth")),i.data=c);break;case"ident":if(s.includes(i.data)){if(e===r.Co.VERTEX_SHADER&&M(a,t))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");i.data in h||(h[i.data]=P(a,u,i.data)),i.data=h[i.data]}}}for(let t=a.length-1;t>=0;--t){const e=a[t];if("preprocessor"===e.type){const i=e.data.match(/#extension\s+(.*):/);if(i?.[1]&&T.has(i[1].trim())){const e=a[t+1];a.splice(t,e&&"whitespace"===e.type?2:1)}const n=e.data.match(/#ifdef\s+(.*)/);n?.[1]&&T.has(n[1].trim())&&(e.data="#if 1");const r=e.data.match(/#ifndef\s+(.*)/);r?.[1]&&T.has(r[1].trim())&&(e.data="#if 0")}}return function(t,e){return o&&O.set(t,e),e}(t,function(t){return t.map((t=>"eof"!==t.type?t.data:"")).join("")}(a))}const O=new Map;class F{constructor(t,e,i,s,o=new Map,a=[]){this._context=t,this._locations=s,this._uniformBlockBindings=o,this._transformFeedbackVaryings=a,this._refCount=1,this._compiled=!1,this._linesOfCode=0,this._nameToUniformLocation=new Map,this._nameToUniform1=new Map,this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,t||console.error("RenderingContext isn't initialized!"),0===e.length&&console.error("Shaders source should not be empty!"),e=R(e,r.Co.VERTEX_SHADER),i=R(i,r.Co.FRAGMENT_SHADER),this._vShader=z(this._context,r.Co.VERTEX_SHADER,e),this._fShader=z(this._context,r.Co.FRAGMENT_SHADER,i),L.enabled&&(this._linesOfCode=e.match(/\n/g).length+i.match(/\n/g).length+2,this._context.instanceCounter.increment(r.vt.LinesOfCode,this._vShader,this._linesOfCode)),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(r.vt.Shader,this),(0,n.Xc)()&&(this.vertexShader=e,this.fragmentShader=i),this.usedMemory=e.length+i.length;const l=this._context.gl,c=l.createProgram();l.attachShader(c,this._vShader),l.attachShader(c,this._fShader),this._locations.forEach(((t,e)=>l.bindAttribLocation(c,t,e))),this._transformFeedbackVaryings?.length&&l.transformFeedbackVaryings(c,this._transformFeedbackVaryings,l.SEPARATE_ATTRIBS),l.linkProgram(c),(0,n.Xc)()&&!l.getProgramParameter(c,l.LINK_STATUS)&&console.error(`Could not link shader\nvalidated: ${l.getProgramParameter(c,l.VALIDATE_STATUS)}, gl error ${l.getError()}, vertex: ${l.getShaderParameter(this._vShader,l.COMPILE_STATUS)}, fragment: ${l.getShaderParameter(this._fShader,l.COMPILE_STATUS)}, info log: ${l.getProgramInfoLog(c)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`);for(const[t,e]of this._uniformBlockBindings){const i=l.getUniformBlockIndex(c,t);i<4294967295&&l.uniformBlockBinding(c,i,e)}this._glName=c,this._context.instanceCounter.increment(r.vt.Program,this)}get glName(){return this._glName}get hasGLName(){return null!=this._glName}get hasTransformFeedbackVaryings(){return!!this._transformFeedbackVaryings?.length}get compiled(){if(this._compiled)return!0;const t=this._context.gl.getExtension("KHR_parallel_shader_compile");return null==t||null==this.glName?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,t.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const t=this._context.gl,e=this._context.instanceCounter;this._nameToUniformLocation.forEach((t=>t&&e.decrement(r.vt.Uniform,t))),this._nameToUniformLocation.clear(),this._vShader&&(this._linesOfCode>0&&(e.decrement(r.vt.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),t.deleteShader(this._vShader),this._vShader=null,e.decrement(r.vt.Shader,this)),this._fShader&&(t.deleteShader(this._fShader),this._fShader=null),this._glName&&(t.deleteProgram(this._glName),this._glName=null,e.decrement(r.vt.Program,this))}ref(){++this._refCount}_getUniformLocation(t){const e=this._nameToUniformLocation.get(t);if(void 0!==e)return e;if(this.glName){const e=this._context.gl.getUniformLocation(this.glName,t);return this._nameToUniformLocation.set(t,e),e&&this._context.instanceCounter.increment(r.vt.Uniform,e),e}return null}hasUniform(t){return null!=this._getUniformLocation(t)}setUniform1i(t,e){const i=this._nameToUniform1.get(t);void 0!==i&&e===i||(this._context.gl.uniform1i(this._getUniformLocation(t),e),this._nameToUniform1.set(t,e))}setUniform1iv(t,e){D(this._nameToUniform1v,t,e)&&this._context.gl.uniform1iv(this._getUniformLocation(t),e)}setUniform2iv(t,e){D(this._nameToUniform2,t,e)&&this._context.gl.uniform2iv(this._getUniformLocation(t),e)}setUniform3iv(t,e){D(this._nameToUniform3,t,e)&&this._context.gl.uniform3iv(this._getUniformLocation(t),e)}setUniform4iv(t,e){D(this._nameToUniform4,t,e)&&this._context.gl.uniform4iv(this._getUniformLocation(t),e)}setUniform1f(t,e){const i=this._nameToUniform1.get(t);void 0!==i&&e===i||(this._context.gl.uniform1f(this._getUniformLocation(t),e),this._nameToUniform1.set(t,e))}setUniform1fv(t,e){D(this._nameToUniform1v,t,e)&&this._context.gl.uniform1fv(this._getUniformLocation(t),e)}setUniform2f(t,e,i){const n=this._nameToUniform2.get(t);void 0===n?(this._context.gl.uniform2f(this._getUniformLocation(t),e,i),this._nameToUniform2.set(t,[e,i])):e===n[0]&&i===n[1]||(this._context.gl.uniform2f(this._getUniformLocation(t),e,i),n[0]=e,n[1]=i)}setUniform2fv(t,e){D(this._nameToUniform2,t,e)&&this._context.gl.uniform2fv(this._getUniformLocation(t),e)}setUniform3f(t,e,i,n){const r=this._nameToUniform3.get(t);void 0===r?(this._context.gl.uniform3f(this._getUniformLocation(t),e,i,n),this._nameToUniform3.set(t,[e,i,n])):e===r[0]&&i===r[1]&&n===r[2]||(this._context.gl.uniform3f(this._getUniformLocation(t),e,i,n),r[0]=e,r[1]=i,r[2]=n)}setUniform3fv(t,e){const i=this._getUniformLocation(t);null!=i&&D(this._nameToUniform3,t,e)&&this._context.gl.uniform3fv(i,e)}setUniform4f(t,e,i,n,r){const s=this._nameToUniform4.get(t);void 0===s?(this._context.gl.uniform4f(this._getUniformLocation(t),e,i,n,r),this._nameToUniform4.set(t,[e,i,n,r])):void 0!==s&&e===s[0]&&i===s[1]&&n===s[2]&&r===s[3]||(this._context.gl.uniform4f(this._getUniformLocation(t),e,i,n,r),s[0]=e,s[1]=i,s[2]=n,s[3]=r)}setUniform4fv(t,e){const i=this._getUniformLocation(t);null!=i&&D(this._nameToUniform4,t,e)&&this._context.gl.uniform4fv(i,e)}setUniformMatrix3fv(t,e,i=!1){const n=this._getUniformLocation(t);null!=n&&D(this._nameToUniformMatrix3,t,e)&&this._context.gl.uniformMatrix3fv(n,i,e)}setUniformMatrix4fv(t,e,i=!1){const n=this._getUniformLocation(t);null!=n&&D(this._nameToUniformMatrix4,t,e)&&this._context.gl.uniformMatrix4fv(n,i,e)}stop(){}}function z(t,e,i){const s=t.gl,o=s.createShader(e);return s.shaderSource(o,i),s.compileShader(o),(0,n.Xc)()&&!s.getShaderParameter(o,s.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===r.Co.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(s.getShaderInfoLog(o)),console.error(function(t){let e=2;return t.replaceAll("\n",(()=>"\n"+function(t){return t>=1e3?t.toString():("  "+t).slice(-3)}(e++)+":"))}(i))),o}function D(t,e,i){const n=t.get(e);if(!n)return t.set(e,Array.from(i)),!0;const r=i.length;if(n.length!==r)return t.set(e,Array.from(i)),!0;for(let t=0;t<r;++t){const e=i[t];if(n[t]!==e){for(n[t]=e;t<r;++t)n[t]=i[t];return!0}}return!1}const L={enabled:!1}},3934:function(t,e,i){i.d(e,{J:function(){return s}}),i(58941);var n=i(7970),r=i(95904);class s{constructor(t){this._rctx=t,this._store=new n.O}dispose(){this._store.forEach((t=>t.forEach((t=>t.dispose())))),this._store.clear()}acquire(t,e,i,n){const s=this._store.get(t,e);if(null!=s)return s.ref(),s;const o=new r.B(this._rctx,t,e,i,n);return o.ref(),this._store.set(t,e,o),o}get test(){}}},10904:function(t,e,i){i.d(e,{r:function(){return r}});var n=i(95904);function r(t,e,i=""){return new n.B(t,i+e.shaders.vertexShader,i+e.shaders.fragmentShader,e.attributes)}},49414:function(t,e,i){i.d(e,{l:function(){return o}});var n=i(85456),r=i(69452),s=i(15167);class o{constructor(t,e){this._context=t,this._descriptor=e,this.type=r.p.RenderBuffer,this._context.instanceCounter.increment(n.vt.Renderbuffer,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:o,internalFormat:a,multisampled:l}=e;l?i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,a,s,o):i.renderbufferStorage(i.RENDERBUFFER,a,s,o),this._context.bindRenderbuffer(null)}get descriptor(){return this._descriptor}get samples(){const t=this._descriptor.samples,e=this._context.parameters.maxSamples;return t?Math.min(t,e):e}get usedMemory(){return(0,s.e)(this._descriptor)}resize(t,e){const i=this._descriptor;if(i.width===t&&i.height===e)return;i.width=t,i.height=e;const n=this._context.gl;this._context.bindRenderbuffer(this),i.multisampled?n.renderbufferStorageMultisample(n.RENDERBUFFER,this.samples,i.internalFormat,i.width,i.height):n.renderbufferStorage(n.RENDERBUFFER,i.internalFormat,i.width,i.height),this._context.bindRenderbuffer(null)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(n.vt.Renderbuffer,this),this._context=null)}}},15167:function(t,e,i){i.d(e,{e:function(){return s},q:function(){return r}});var n=i(93380);class r{constructor(t,e,i=e){this.internalFormat=t,this.width=e,this.height=i,this.multisampled=!1,this.samples=1}}function s(t){return t.width<=0||t.height<=0||null==t.internalFormat?0:t.width*t.height*(0,n.IB)(t.internalFormat)}},74427:function(t,e,i){i.d(e,{e:function(){return D}});var n=i(95929),r=i(60539),s=i(38504),o=i(41835),a=i(85456);class l{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:a.dn.ONE,dstRGB:a.dn.ZERO,srcAlpha:a.dn.ONE,dstAlpha:a.dn.ZERO},this.blendEquation={mode:a.Tb.ADD,modeAlpha:a.Tb.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=a.Y7.BACK,this.frontFace=a.Ac.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=a.MT.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:a.Y7.FRONT_AND_BACK,func:a.MT.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:a.Y7.FRONT_AND_BACK,fail:a.eA.KEEP,zFail:a.eA.KEEP,zPass:a.eA.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.transformFeedbackBuffer=null,this.uniformBufferBindingPoints=new Array,this.transformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.drawBuffers={defaultFramebuffer:[a.Hr.BACK],fbos:new WeakMap},this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}}class c{constructor(){for(this._current=new Array,this._allocations=null;this._current.length<a.vt.COUNT;)this._current.push(0)}increment(t,e,i=1){this._current[t]+=i,this._allocations?.add(e)}decrement(t,e,i=1){this._current[t]-=i,this._allocations?.remove(e)}get current(){return this._current}get total(){return this.current.reduce(((t,e,i)=>t+(i<a.vt.UNCOUNTED?e:0)),0)}get resourceInformation(){let t="";if(this.total>0){t+="Live objects:\n";for(let e=0;e<a.vt.COUNT;++e){const i=this._current[e];i>0&&(t+=`${a.vt[e]}: ${i}\n`)}}return t+=this._allocations?.resetLog(),t}}class u{constructor(t,e,i){const n=e.textureFilterAnisotropic,r=i.maxAnisotropy??1/0;this.versionString=t.getParameter(t.VERSION),this.maxVertexTextureImageUnits=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=t.getParameter(t.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=n?Math.min(t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY),r):1,this.maxTextureImageUnits=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=t.getParameter(t.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=t.getParameter(t.MAX_VIEWPORT_DIMS),this.maxUniformBufferBindings=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=t.getParameter(t.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=t.getParameter(t.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=t.getParameter(t.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=t.getParameter(t.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=t.getParameter(t.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=t.getParameter(t.MAX_SAMPLES),this.maxDrawBuffers=t.getParameter(t.MAX_DRAW_BUFFERS)}}var h=i(3934),d=i(57087),f=i(78541),_=i(93380),p=i(58941),m=i(39506),g=i(86305);class y{constructor(t){this._rctx=t,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:"#version 300 es\n    precision highp float;\n\n    void main(void) {\n      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);\n    }",fragment:"#version 300 es\n    precision highp float;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor = vec4(0.0, 0.0, 0.0, 1.0);\n    }"}}_createHelperProgram(){const t=y.getShaderSources();return this._rctx.programCache.acquire(t.vertex,t.fragment,new Map([]))}_createIndexbuffer(){return g.g.createIndex(this._rctx,a._U.STATIC_DRAW,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,a.NZ.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(a.WR.POINTS,1,a.pe.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}get test(){}}var v=i(96402),x=i(10956),b=i(10106);class S extends b._{constructor(t){super(),this._rctx=t,this._helperProgram=null,(0,p.A)("mac")&&(0,p.A)("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){super.dispose(),this._helperProgram?.dispose(),this._helperProgram=null}_test(t){const e=this._rctx,i=e.getBoundFramebufferObject(),{x:n,y:r,width:s,height:o}=e.getViewport();e.resetState();const l=new x.R(1);l.wrapMode=a.pF.CLAMP_TO_EDGE,l.samplingMode=a.Cj.NEAREST;const c=new v.H(e,l),u=g.g.createIndex(this._rctx,a._U.STATIC_DRAW,new Uint8Array([0]));e.bindFramebuffer(c),e.setViewport(0,0,1,1),e.useProgram(this._helperProgram),e.bindBuffer(u,a.NZ.ELEMENT_ARRAY_BUFFER),e.drawElements(a.WR.POINTS,1,a.pe.UNSIGNED_BYTE,0),e.useProgram(t),e.bindVAO(null),e.drawArrays(a.WR.TRIANGLES,0,258);const h=new Uint8Array(4);return c.readPixels(0,0,1,1,a.Ab.RGBA,a.ld.UNSIGNED_BYTE,h),e.setViewport(n,r,s,o),e.bindFramebuffer(i),c.dispose(),u.dispose(),255===h[0]}_prepareProgram(){const t=`#version 300 es\n    precision highp float;\n\n    out float triangleId;\n\n    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));\n\n    void main(void) {\n      triangleId = floor(float(gl_VertexID)/3.0);\n\n      vec3 position = triangleVertices[gl_VertexID % 3];\n      float offset = triangleId / ${m.H.float(85)};\n      position.z = 0.5 - offset;\n\n      gl_Position = vec4(position, 1.0);\n    }\n    `,e=`#version 300 es\n    precision highp float;\n\n    in float triangleId;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor = triangleId == ${m.H.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);\n    }\n    `;return this._rctx.programCache.acquire(t,e,new Map([]))}_prepareHelperProgram(){const t=y.getShaderSources();return this._rctx.programCache.acquire(t.vertex,t.fragment,new Map([]))}}var w=i(5161),T=i(32501),M=i(44476),P=i(81438),E=i(3817);class A extends b._{constructor(t){super(),this._rctx=t,this._program=C(this._rctx,!1),this._obfuscated=C(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=(0,n.WD)(this._obfuscated)}_test(t){if((0,p.A)("force-double-precision-obfuscation"))return!0;if(null==this._obfuscated)return!1;const e=this._rctx,i=e.getBoundFramebufferObject(),{x:n,y:r,width:s,height:o}=e.getViewport(),a=this._runProgram(t),l=this._runProgram(this._obfuscated);return e.setViewport(n,r,s,o),e.bindFramebuffer(i),0!==a&&(0===l||a/l>5)}_runProgram(t){const e=this._rctx;e.resetState();const i=new x.R(1);i.wrapMode=a.pF.CLAMP_TO_EDGE,i.samplingMode=a.Cj.NEAREST;const n=new v.H(e,i),r=g.g.createVertex(e,a._U.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new P.Z(e,new Map([["position",0]]),{geometry:[new E._("position",2,a.pe.UNSIGNED_SHORT,0,4)]},{geometry:r}),o=(0,T.fA)(5633261.287538229,2626832.878767164,1434988.0495278358),l=(0,T.fA)(5633271.46742708,2626873.6381334523,1434963.231608387),c=new Float32Array(6);(0,M.jS)(o,c,3);const u=new Float32Array(6);(0,M.jS)(l,u,3),e.useProgram(t),t.setUniform3f("u_highA",c[0],c[2],c[4]),t.setUniform3f("u_lowA",c[1],c[3],c[5]),t.setUniform3f("u_highB",u[0],u[2],u[4]),t.setUniform3f("u_lowB",u[1],u[3],u[5]),e.bindFramebuffer(n),e.setViewport(0,0,1,1),e.bindVAO(s),e.drawArrays(a.WR.TRIANGLE_STRIP,0,4);const h=new Uint8Array(4);n.readPixels(0,0,1,1,a.Ab.RGBA,a.ld.UNSIGNED_BYTE,h),s.dispose(),n.dispose();const d=(o[2]-l[2])/25,f=(0,w.T)(h);return Math.abs(d-f)}}function C(t,e){const i=`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `;return t.programCache.acquire(i,"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor = v_color;\n  }\n  ",new Map([["position",0]]))}class I extends b._{constructor(t){super(),this._rctx=t,t.gl&&t.capabilities.colorBufferFloat?.textureFloat&&t.capabilities.colorBufferFloat?.floatBlend&&(this._program=t.programCache.acquire("\n    precision highp float;\n    attribute vec2 a_pos;\n\n    void main() {\n      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n     precision highp float;\n\n     void main() {\n      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);\n     }\n    ",new Map([["a_pos",0]])))}_test(t){const e=this._rctx,i=new x.R(1);i.wrapMode=a.pF.CLAMP_TO_EDGE,i.dataType=a.ld.FLOAT,i.internalFormat=a.H0.RGBA32F,i.samplingMode=a.Cj.NEAREST;const n=new v.H(e,i),r=g.g.createVertex(e,a._U.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new P.Z(e,new Map([["a_pos",0]]),{geometry:[new E._("a_pos",2,a.pe.UNSIGNED_SHORT,0,4)]},{geometry:r});e.gl.getError(),e.useProgram(t);const o=e.getBoundFramebufferObject(),{x:l,y:c,width:u,height:h}=e.getViewport();e.bindFramebuffer(n),e.setViewport(0,0,1,1),e.bindVAO(s),e.drawArrays(a.WR.TRIANGLE_STRIP,0,4);const f=(0,d.Ey)({blending:(0,d.ox)(a.dn.ZERO,a.dn.ONE_MINUS_SRC_ALPHA)});e.setPipelineState(f),e.drawArrays(a.WR.TRIANGLE_STRIP,0,4);const _=e.gl.getError();return e.setViewport(l,c,u,h),e.bindFramebuffer(o),s.dispose(),n.dispose(),_!==e.gl.INVALID_OPERATION||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}}var R=i(38680);class O{constructor(t){this.rctx=t,this.floatBufferBlend=new I(t),this.svgPremultipliesAlpha=new R.H(t),this.doublePrecisionRequiresObfuscation=new A(t),this.drawArraysRequiresIndicesTypeReset=new S(t)}dispose(){this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}}var F=i(58250);class z{constructor(t,e){this._gl=t,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._colorBufferFloat=null,this._loseContext=null,this._textureNorm16=null,this._textureFloatLinear=null,this._disabledExtensions=e.disabledExtensions||{},this._debugWebGLExtensions=e.debugWebGLExtensions||{}}get compressedTextureETC(){return this._compressedTextureETC??=function(t,e){if(e.compressedTextureETC)return null;const i=t.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}(this._gl,this._disabledExtensions),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC??=function(t,e){if(e.compressedTextureS3TC)return null;const i=t.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}(this._gl,this._disabledExtensions),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic??=function(t,e){if(e.textureFilterAnisotropic)return null;const i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}(this._gl,this._disabledExtensions),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery??=(0,F._R)(this._gl,this._disabledExtensions),this._disjointTimerQuery}get colorBufferFloat(){return this._colorBufferFloat??=function(t,e){const i=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),n=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),r=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return i||n||r?{textureFloat:!!n,textureHalfFloat:!!i,floatBlend:!!r,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}(this._gl,this._disabledExtensions),this._colorBufferFloat}get loseContext(){return this._loseContext??=function(t,e){const i=e.loseContext&&t.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}(this._gl,this._debugWebGLExtensions),this._loseContext}get textureNorm16(){return this._textureNorm16??=function(t,e){if(e.textureNorm16)return null;const i=t.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}(this._gl,this._disabledExtensions),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear??=function(t,e,i,n,r){if(e.textureFloatLinear)return!1;for(const e of["OES_texture_float_linear"])if(t.getExtension(e))return!0;return!1}(this._gl,this._disabledExtensions),this._textureFloatLinear}enable(t){return this[t]}}let D=class{constructor(t,e){this.gl=t,this.instanceCounter=new c,this.programCache=new h.J(this),this._transformFeedbackRequestInfo=null,this._state=new l,this._numOfDrawCalls=0,this._numOfTriangles=0,this._loadExtensions(),this.configure(e)}configure(t){this._capabilities=new z(this.gl,t),this._parameters=new u(this.gl,this._capabilities,t),f.g.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const e=this.gl.getParameter(this.gl.VIEWPORT);this._state=new l,this._state.viewport={x:e[0],y:e[1],width:e[2],height:e[3]},this._stateTracker=new d.Ms({setBlending:t=>{if(t){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(t.opRgb,t.opAlpha),this.setBlendFunctionSeparate(t.srcRgb,t.dstRgb,t.srcAlpha,t.dstAlpha);const e=t.color;this.setBlendColor(e.r,e.g,e.b,e.a)}else this.setBlendingEnabled(!1)},setCulling:t=>{t?(this.setFaceCullingEnabled(!0),this.setCullFace(t.face),this.setFrontFace(t.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:t=>{t?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(t.factor,t.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:t=>{t?(this.setDepthTestEnabled(!0),this.setDepthFunction(t.func)):this.setDepthTestEnabled(!1)},setStencilTest:t=>{if(t){this.setStencilTestEnabled(!0);const e=t.function;this.setStencilFunction(e.func,e.ref,e.mask);const i=t.operation;this.setStencilOp(i.fail,i.zFail,i.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:t=>{t?(this.setDepthWriteEnabled(!0),this.setDepthRange(t.zNear,t.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:t=>{t?this.setColorMask(t.r,t.g,t.b,t.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:t=>{t?this.setStencilWriteMask(t.mask):this.setStencilWriteMask(0)},setDrawBuffers:t=>{if(t)this.setDrawBuffers(t.buffers);else{const{drawFramebuffer:t}=this._state;null===t?this.setDrawBuffers([a.Hr.BACK]):0===t.colorAttachments.length?this.setDrawBuffers([a.Hr.NONE]):this.setDrawBuffers([a.Nm.COLOR_ATTACHMENT0])}}}),this.enforceState(),(0,n.WD)(this._driverTest),this._driverTest=new O(this)}dispose(){(0,n.WD)(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(a.NZ.ARRAY_BUFFER),this.unbindBuffer(a.NZ.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(a.NZ.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(a.NZ.PIXEL_PACK_BUFFER),this.unbindBuffer(a.NZ.PIXEL_UNPACK_BUFFER),this.unbindBuffer(a.NZ.COPY_READ_BUFFER),this.unbindBuffer(a.NZ.COPY_WRITE_BUFFER),this._state.textureUnitMap.length=0,(0,o.en)()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(t){this._stateTracker.setPipeline(t)}setBlendingEnabled(t){this._state.blend!==t&&(!0===t?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=t,this._stateTracker.invalidateBlending())}externalProgramUpdate(){this._state.program?.stop(),this._state.program=null}externalTextureUnitUpdate(t,e){for(let e=0;e<t.length;++e)this._state.textureUnitMap[t[e]]=null;e>=0&&(this._state.activeTexture=e)}externalVertexArrayObjectUpdate(){this.gl.bindVertexArray(null),this._state.vertexArrayObject=null,this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(t,e,i,n){t===this._state.blendColor.r&&e===this._state.blendColor.g&&i===this._state.blendColor.b&&n===this._state.blendColor.a||(this.gl.blendColor(t,e,i,n),this._state.blendColor.r=t,this._state.blendColor.g=e,this._state.blendColor.b=i,this._state.blendColor.a=n,this._stateTracker.invalidateBlending())}setBlendFunction(t,e){t===this._state.blendFunction.srcRGB&&e===this._state.blendFunction.dstRGB||(this.gl.blendFunc(t,e),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=t,this._state.blendFunction.dstRGB=e,this._state.blendFunction.dstAlpha=e,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(t,e,i,n){this._state.blendFunction.srcRGB===t&&this._state.blendFunction.srcAlpha===i&&this._state.blendFunction.dstRGB===e&&this._state.blendFunction.dstAlpha===n||(this.gl.blendFuncSeparate(t,e,i,n),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=i,this._state.blendFunction.dstRGB=e,this._state.blendFunction.dstAlpha=n,this._stateTracker.invalidateBlending())}setBlendEquation(t){this._state.blendEquation.mode!==t&&(this.gl.blendEquation(t),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=t,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(t,e){this._state.blendEquation.mode===t&&this._state.blendEquation.modeAlpha===e||(this.gl.blendEquationSeparate(t,e),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setColorMask(t,e,i,n){this._state.colorMask.r===t&&this._state.colorMask.g===e&&this._state.colorMask.b===i&&this._state.colorMask.a===n||(this.gl.colorMask(t,e,i,n),this._state.colorMask.r=t,this._state.colorMask.g=e,this._state.colorMask.b=i,this._state.colorMask.a=n,this._stateTracker.invalidateColorWrite())}setClearColor(t,e,i,n){this._state.clearColor.r===t&&this._state.clearColor.g===e&&this._state.clearColor.b===i&&this._state.clearColor.a===n||(this.gl.clearColor(t,e,i,n),this._state.clearColor.r=t,this._state.clearColor.g=e,this._state.clearColor.b=i,this._state.clearColor.a=n)}setFaceCullingEnabled(t){this._state.faceCulling!==t&&(!0===t?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=t,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(t){this._state.polygonOffsetFill!==t&&(!0===t?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=t,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(t,e){this._state.polygonOffset[0]===t&&this._state.polygonOffset[1]===e||(this._state.polygonOffset[0]=t,this._state.polygonOffset[1]=e,this.gl.polygonOffset(t,e),this._stateTracker.invalidatePolygonOffset())}setCullFace(t){this._state.cullFace!==t&&(this.gl.cullFace(t),this._state.cullFace=t,this._stateTracker.invalidateCulling())}setFrontFace(t){this._state.frontFace!==t&&(this.gl.frontFace(t),this._state.frontFace=t,this._stateTracker.invalidateCulling())}setScissorTestEnabled(t){this._state.scissorTest!==t&&(!0===t?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=t)}setScissorRect(t,e,i,n){this._state.scissorRect.x===t&&this._state.scissorRect.y===e&&this._state.scissorRect.width===i&&this._state.scissorRect.height===n||(this.gl.scissor(t,e,i,n),this._state.scissorRect.x=t,this._state.scissorRect.y=e,this._state.scissorRect.width=i,this._state.scissorRect.height=n)}setDepthTestEnabled(t){this._state.depthTest!==t&&(!0===t?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=t,this._stateTracker.invalidateDepthTest())}setClearDepth(t){this._state.clearDepth!==t&&(this.gl.clearDepth(t),this._state.clearDepth=t)}setDepthFunction(t){this._state.depthFunction!==t&&(this.gl.depthFunc(t),this._state.depthFunction=t,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(t){this._state.depthWrite!==t&&(this.gl.depthMask(t),this._state.depthWrite=t,this._stateTracker.invalidateDepthWrite())}setDepthRange(t,e){this._state.depthRange.zNear===t&&this._state.depthRange.zFar===e||(this.gl.depthRange(t,e),this._state.depthRange.zNear=t,this._state.depthRange.zFar=e,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(t){this._state.stencilTest!==t&&(!0===t?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=t,this._stateTracker.invalidateStencilTest())}setClearStencil(t){t!==this._state.clearStencil&&(this.gl.clearStencil(t),this._state.clearStencil=t)}setStencilFunction(t,e,i){this._state.stencilFunction.func===t&&this._state.stencilFunction.ref===e&&this._state.stencilFunction.mask===i||(this.gl.stencilFunc(t,e,i),this._state.stencilFunction.face=a.Y7.FRONT_AND_BACK,this._state.stencilFunction.func=t,this._state.stencilFunction.ref=e,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(t,e,i,n){this._state.stencilFunction.face===t&&this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===n||(this.gl.stencilFuncSeparate(t,e,i,n),this._state.stencilFunction.face=t,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=n,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(t){this._state.stencilWriteMask!==t&&(this.gl.stencilMask(t),this._state.stencilWriteMask=t,this._stateTracker.invalidateStencilWrite())}setStencilOp(t,e,i){this._state.stencilOperation.face===a.Y7.FRONT_AND_BACK&&this._state.stencilOperation.fail===t&&this._state.stencilOperation.zFail===e&&this._state.stencilOperation.zPass===i||(this.gl.stencilOp(t,e,i),this._state.stencilOperation.face=a.Y7.FRONT_AND_BACK,this._state.stencilOperation.fail=t,this._state.stencilOperation.zFail=e,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(t,e,i,n){this._state.stencilOperation.face===t&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===n||(this.gl.stencilOpSeparate(t,e,i,n),this._state.stencilOperation.face=t,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=n,this._stateTracker.invalidateStencilTest())}setActiveTexture(t,e=!1){const i=this._state.activeTexture;return t>=0&&(e||t!==this._state.activeTexture)&&(this.gl.activeTexture(a.xM+t),this._state.activeTexture=t),i}setDrawBuffers(t){const{drawFramebuffer:e}=this._state,i=null===e,n=i?this._state.drawBuffers.defaultFramebuffer:this._state.drawBuffers.fbos.get(e);if(n?.length!==t.length||!n.every(((e,i)=>e===t[i])))if(t.length>this.parameters.maxDrawBuffers)console.error("Setting more active draw buffers than GL.MAX_DRAW_BUFFERS allows.");else{if(i){if(t.length>1)return void console.error("The default framebuffer can only have one active draw buffer.");if(t[0]!==a.Hr.BACK&&t[0]!==a.Hr.NONE)return void console.error("The default framebuffer can only use the constants GL.BACK or GL.NONE as draw buffers.")}i||!t.includes(a.Hr.BACK)?(this.gl.drawBuffers(t),i?this._state.drawBuffers.defaultFramebuffer=t:this._state.drawBuffers.fbos.set(e,t),this._stateTracker.invalidateDrawBuffers()):console.error("A framebuffer object can only use the constants GL.COLOR_ATTACHMENTi or GL.NONE as draw buffers.")}}clear(t,e=255){if(t){if(t&a.hn.COLOR_BUFFER_BIT){const t=this._state.drawFramebuffer?.colorAttachments;t&&this.setDrawBuffers(t),this.setColorMask(!0,!0,!0,!0)}t&a.hn.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),t&a.hn.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(e),this.gl.clear(t)}}clearFramebuffer(t,e=!1,i=!1){let n=0;if(t){const e=1e-13,i=Math.max(e,t[3]);this.setClearColor(t[0],t[1],t[2],i),n|=a.hn.COLOR_BUFFER_BIT}e&&(n|=a.hn.DEPTH_BUFFER_BIT),!1===i?i=0:(!0===i&&(i=255),n|=a.hn.STENCIL_BUFFER_BIT),n&&this.clear(n,i)}drawArrays(t,e,i){if(this._transformFeedbackRequestInfo){if(t!==this._transformFeedbackRequestInfo.primitiveType)throw new Error("DrawArrays called during transform feedback, but primitiveType does not match that of the current transform feedback request");if(null==this._state.program?.hasTransformFeedbackVaryings)throw new Error("DrawArrays called during transform feedback, but the shader program was not linked with a transform feedback varying")}if((0,o.en)()){this._numOfDrawCalls++,this._numOfTriangles+=N(t,i);const e=this._state.textureUnitMap;for(let t=0;t<e.length;t++){const i=e[t];if(null!=i&&i===this._state.drawFramebuffer?.colorTexture)throw new Error(`Detected readWrite. Texture already bound at index ${t}`)}}this.gl.drawArrays(t,e,i),(0,o.Y2)(this.gl)}drawArraysInstanced(t,e,i,n){this.gl.drawArraysInstanced(t,e,i,n),(0,o.Y2)(this.gl)}drawElements(t,e,i,n){if(this._transformFeedbackRequestInfo)throw new Error("Cannot called drawElements during a transform feedback request");if((0,o.en)()&&(this._numOfDrawCalls++,this._numOfTriangles+=N(t,e)),this.gl.drawElements(t,e,i,n),(0,o.en)()){const r=(0,_.WH)(this);if(r){const s=this.getBoundVAO(),o=s?.indexBuffer,a=s?.vertexBuffers,l={indexBuffer:o,vertexBuffers:a},c={mode:t,count:e,type:i,offset:n},u=o?.size??0,h=n+e,d=u<h?`. Buffer is too small. Attempted to draw index ${h} of ${u}`:"";console.error(`drawElements: ${r}${d}`,{args:c,vao:l})}}}logInfo(){(0,o.en)()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){(0,o.en)()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(t,e,i,n){i=Math.max(Math.round(i),1),n=Math.max(Math.round(n),1);const r=this._state.viewport;r.x===t&&r.y===e&&r.width===i&&r.height===n||(r.x=t,r.y=e,r.width=i,r.height=n,this.gl.viewport(t,e,i,n))}setViewport4fv(t){this.setViewport(t[0],t[1],t[2],t[3])}restoreViewport({x:t,y:e,width:i,height:n}){this.setViewport(t,e,i,n)}getViewport(){const t=this._state.viewport;return{x:t.x,y:t.y,width:t.width,height:t.height}}useProgram(t){this._state.program!==t&&(this._state.program?.stop(),this._state.program=t,this.gl.useProgram(t?.glName??null))}bindTexture(t,e,i=!1){(e>=this.parameters.maxTextureImageUnits||e<0)&&console.error("Input texture unit is out of range of available units!");const n=this._state.textureUnitMap[e];return null==t?.glName?(null!=n&&(this.setActiveTexture(e,i),this.gl.bindTexture(n.descriptor.target,null)),this._state.textureUnitMap[e]=null,n):i||n!==t?(this.setActiveTexture(e,i),this.gl.bindTexture(t.descriptor.target,t.glName),t.applyChanges(),this._state.textureUnitMap[e]=t,n):(t.isDirty&&(this.setActiveTexture(e,i),t.applyChanges()),n)}unbindTexture(t){if(null!=t)for(let e=0;e<this.parameters.maxTextureImageUnits;e++)this._state.textureUnitMap[e]===t&&(this.bindTexture(null,e),this._state.textureUnitMap[e]=null)}bindFramebuffer(t,e=!1){if(e||this._state.readFramebuffer!==t||this._state.drawFramebuffer!==t){if(this._stateTracker.invalidateDrawBuffers(),null==t)return this.gl.bindFramebuffer(a.R.FRAMEBUFFER,null),void(this._state.readFramebuffer=this._state.drawFramebuffer=null);t.initializeAndBind(a.R.FRAMEBUFFER),this._state.readFramebuffer=t,this._state.drawFramebuffer=t}}bindFramebufferSeparate(t,e,i=!1){const n=e===a.R.READ_FRAMEBUFFER,r=n?this._state.readFramebuffer:this._state.drawFramebuffer;(i||r!==t)&&(null==t?this.gl.bindFramebuffer(e,null):t.initializeAndBind(e),n?this._state.readFramebuffer=t??null:(this._stateTracker.invalidateDrawBuffers(),this._state.drawFramebuffer=t??null))}blitFramebuffer(t,e,i=0,n=0,r=t.width,s=t.height,o=0,l=0,c=e.width,u=e.height,h=a.hn.COLOR_BUFFER_BIT,d=a.Cj.NEAREST){this.bindFramebufferSeparate(t,a.R.READ_FRAMEBUFFER),this.bindFramebufferSeparate(e,a.R.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(i,n,r,s,o,l,c,u,h,d)}bindBuffer(t,e){if(t)switch(e??=t.bufferType,e){case a.NZ.ARRAY_BUFFER:this._state.vertexBuffer=L(this.gl,t,e,this._state.vertexBuffer);break;case a.NZ.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=L(this.gl,t,e,this._state.indexBuffer);break;case a.NZ.UNIFORM_BUFFER:this._state.uniformBuffer=L(this.gl,t,e,this._state.uniformBuffer);break;case a.NZ.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=L(this.gl,t,e,this._state.pixelPackBuffer);break;case a.NZ.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=L(this.gl,t,e,this._state.pixelUnpackBuffer);break;case a.NZ.COPY_READ_BUFFER:this._state.copyReadBuffer=L(this.gl,t,e,this._state.copyReadBuffer);break;case a.NZ.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=L(this.gl,t,e,this._state.copyWriteBuffer);break;case a.NZ.TRANSFORM_FEEDBACK_BUFFER:this._state.transformFeedbackBuffer=L(this.gl,t,e,this._state.transformFeedbackBuffer)}}bindRenderbuffer(t){const e=this.gl;t||(e.bindRenderbuffer(e.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==t&&(e.bindRenderbuffer(e.RENDERBUFFER,t.glName),this._state.renderbuffer=t)}_getBufferBinding(t,e){if(e>=this.parameters.maxUniformBufferBindings||e<0)return console.error("Uniform buffer binding point is out of range!"),null;const i=t===a.NZ.UNIFORM_BUFFER?this._state.uniformBufferBindingPoints:this._state.transformBufferBindingPoints;let n=i[e];return null==n&&(n={buffer:null,offset:0,size:0},i[e]=n),n}bindBufferBase(t,e,i){const n=this._getBufferBinding(t,e);null!=n&&(n.buffer===i&&0===n.offset&&0===n.size||(this.gl.bindBufferBase(t,e,i?i.glName:null),n.buffer=i,n.offset=0,n.size=0))}bindBufferRange(t,e,i,n,r){const s=this._getBufferBinding(t,e);null!=s&&(s.buffer===i&&s.offset===n&&s.size===r||(n%this._parameters.uniformBufferOffsetAlignment==0?(this.gl.bindBufferRange(t,e,i.glName,n,r),s.buffer=i,s.offset=n,s.size=r):console.error("Uniform buffer binding offset is not a multiple of the context offset alignment")))}bindUBO(t,e,i,n){null!=e?((0,o.en)()&&(n??e.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),e.initialize(),void 0!==i&&void 0!==n?this.bindBufferRange(a.NZ.UNIFORM_BUFFER,t,e.buffer,i,n):this.bindBufferBase(a.NZ.UNIFORM_BUFFER,t,e.buffer)):this.bindBufferBase(a.NZ.UNIFORM_BUFFER,t,null)}unbindUBO(t){for(let e=0,i=this._state.uniformBufferBindingPoints.length;e<i;e++){const i=this._state.uniformBufferBindingPoints[e];null!=i&&i.buffer===t.buffer&&this.bindBufferBase(a.NZ.UNIFORM_BUFFER,e,null)}}unbindBuffer(t){switch(t){case a.NZ.ARRAY_BUFFER:this._state.vertexBuffer=L(this.gl,null,t,this._state.vertexBuffer);break;case a.NZ.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=L(this.gl,null,t,this._state.indexBuffer);break;case a.NZ.UNIFORM_BUFFER:this._state.uniformBuffer=L(this.gl,null,t,this._state.uniformBuffer);break;case a.NZ.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=L(this.gl,null,t,this._state.pixelPackBuffer);break;case a.NZ.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=L(this.gl,null,t,this._state.pixelUnpackBuffer);break;case a.NZ.COPY_READ_BUFFER:this._state.copyReadBuffer=L(this.gl,null,t,this._state.copyReadBuffer);break;case a.NZ.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=L(this.gl,null,t,this._state.copyWriteBuffer)}}bindVAO(t=null){null!=t?this._state.vertexArrayObject!==t&&(t.bind(),this._state.vertexArrayObject=t):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}bindTransformFeedback(t){const{gl:e}=this;e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,t.glName)}beginTransformFeedback(t,e){if(this._transformFeedbackRequestInfo)throw new Error("Already in a transform feedback request");const{gl:i}=this;i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,t.glName),i.beginTransformFeedback(e),this._transformFeedbackRequestInfo={primitiveType:e}}endTransformFeedback(){if(!this._transformFeedbackRequestInfo)throw new Error("Not in a transform feedback request");const{gl:t}=this;t.endTransformFeedback(),t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null),this._transformFeedbackRequestInfo=null}async clientWaitAsync(t=(0,s.l5)(10)){const{gl:e}=this,i=e.fenceSync(a.tx.SYNC_GPU_COMMANDS_COMPLETE,0);if(!i)throw new Error("Client wait failed, could not create sync object");let n;this.instanceCounter.increment(a.vt.Sync,i),e.flush();do{await(0,r.Pl)(t),n=e.clientWaitSync(i,0,0)}while(n===a.sS.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(a.vt.Sync,i),e.deleteSync(i),n===a.sS.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(t=a.R.FRAMEBUFFER){return t===a.R.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(a.NZ.ARRAY_BUFFER),this.unbindBuffer(a.NZ.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(a.NZ.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(a.NZ.PIXEL_PACK_BUFFER),this.unbindBuffer(a.NZ.PIXEL_UNPACK_BUFFER),this.unbindBuffer(a.NZ.COPY_READ_BUFFER),this.unbindBuffer(a.NZ.COPY_WRITE_BUFFER);for(let t=0;t<this.parameters.maxTextureImageUnits;++t)this.bindTexture(null,t);this.setBlendingEnabled(!1),this.setBlendFunction(a.dn.ONE,a.dn.ZERO),this.setBlendEquation(a.Tb.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(a.Y7.BACK),this.setFrontFace(a.Ac.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(a.MT.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(a.MT.ALWAYS,0,0),this.setStencilOp(a.eA.KEEP,a.eA.KEEP,a.eA.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setDrawBuffers([a.Hr.BACK]),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){const{gl:t}=this;t.bindVertexArray(null);for(let e=0;e<this.parameters.maxVertexAttributes;e++)t.disableVertexAttribArray(e);this._state.vertexBuffer?t.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):t.bindBuffer(a.NZ.ARRAY_BUFFER,null),this._state.indexBuffer?t.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):t.bindBuffer(a.NZ.ELEMENT_ARRAY_BUFFER,null),this._state.uniformBuffer?t.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):t.bindBuffer(a.NZ.UNIFORM_BUFFER,null);for(let e=0;e<this._parameters.maxUniformBufferBindings;e++){const i=this._state.uniformBufferBindingPoints[e];if(null!=i){const{buffer:n,offset:r,size:s}=i;null!==n?0===r&&0===s?t.bindBufferBase(a.NZ.UNIFORM_BUFFER,e,n.glName):t.bindBufferRange(a.NZ.UNIFORM_BUFFER,e,n.glName,r,s):t.bindBufferBase(a.NZ.UNIFORM_BUFFER,e,null)}}if(this._state.pixelPackBuffer?t.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):t.bindBuffer(a.NZ.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?t.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):t.bindBuffer(a.NZ.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?t.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):t.bindBuffer(a.NZ.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?t.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):t.bindBuffer(a.NZ.COPY_WRITE_BUFFER,null),t.bindFramebuffer(a.R.READ_FRAMEBUFFER,null),t.readBuffer(t.BACK),this._state.readFramebuffer&&(t.bindFramebuffer(a.R.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),t.readBuffer(a.Nm.COLOR_ATTACHMENT0)),t.bindFramebuffer(a.R.DRAW_FRAMEBUFFER,this._state.drawFramebuffer?.glName??null),null===this._state.drawFramebuffer){const e=this._state.drawBuffers.defaultFramebuffer;t.drawBuffers(e??[a.Hr.BACK])}else{const e=this._state.drawBuffers.fbos.get(this._state.drawFramebuffer);t.drawBuffers(e??[a.Nm.COLOR_ATTACHMENT0])}if(this._state.vertexArrayObject){const t=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(t)}t.useProgram(this._state.program?.glName??null),t.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),t.bindRenderbuffer(t.RENDERBUFFER,this._state.renderbuffer?.glName??null),!0===this._state.blend?t.enable(this.gl.BLEND):t.disable(this.gl.BLEND),t.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),t.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),t.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),t.clearDepth(this._state.clearDepth),t.clearStencil(this._state.clearStencil),t.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),t.cullFace(this._state.cullFace),t.depthFunc(this._state.depthFunction),t.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),!0===this._state.depthTest?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),t.depthMask(this._state.depthWrite),t.frontFace(this._state.frontFace),t.lineWidth(1),!0===this._state.faceCulling?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),t.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),!0===this._state.polygonOffsetFill?t.enable(t.POLYGON_OFFSET_FILL):t.disable(t.POLYGON_OFFSET_FILL),t.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),!0===this._state.scissorTest?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),t.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),t.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),!0===this._state.stencilTest?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),t.stencilMask(this._state.stencilWriteMask);for(let e=0;e<this.parameters.maxTextureImageUnits;e++){t.activeTexture(a.xM+e),t.bindTexture(a.Ap.TEXTURE_2D,null),t.bindTexture(a.Ap.TEXTURE_CUBE_MAP,null),t.bindTexture(a.Ap.TEXTURE_3D,null),t.bindTexture(a.Ap.TEXTURE_2D_ARRAY,null);const i=this._state.textureUnitMap[e];null!=i&&t.bindTexture(i.descriptor.target,i.glName)}t.activeTexture(a.xM+this._state.activeTexture);const e=this._state.viewport;t.viewport(e.x,e.y,e.width,e.height),this.resetInfo()}_loadExtensions(){this.gl.getExtension("KHR_parallel_shader_compile")}};function L(t,e,i,n){return e?n!==e&&t.bindBuffer(i,e.glName):t.bindBuffer(i,null),e}function N(t,e){switch(t){case a.WR.POINTS:return 2*e;case a.WR.TRIANGLES:return e/3;case a.WR.TRIANGLE_STRIP:case a.WR.TRIANGLE_FAN:return e-2;default:return 0}}},65644:function(t,e,i){i.d(e,{Z:function(){return n}});class n{constructor(t){this._readFile=t}resolveIncludes(t){return this._resolve(t)}_resolve(t,e=new Map){if(e.has(t))return e.get(t);const i=this._read(t);if(!i)throw new Error(`cannot find shader file ${t}`);const n=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm;let r=n.exec(i);const s=[];for(;null!=r;)s.push({path:r[1],start:r.index,length:r[0].length}),r=n.exec(i);let o=0,a="";return s.forEach((t=>{a+=i.slice(o,t.start),a+=e.has(t.path)?"":this._resolve(t.path,e),o=t.start+t.length})),a+=i.slice(o),e.set(t,a),a}_read(t){return this._readFile(t)}}},78541:function(t,e,i){i.d(e,{g:function(){return c}});var n=i(39819),r=(i(58941),i(41835)),s=i(85456),o=i(69452),a=i(10956);class l extends a.R{constructor(t,e){switch(super(),this.context=t,Object.assign(this,e),this.internalFormat){case s.H0.R16F:case s.H0.R16I:case s.H0.R16UI:case s.H0.R32F:case s.H0.R32I:case s.H0.R32UI:case s.H0.R8_SNORM:case s.H0.R8:case s.H0.R8I:case s.H0.R8UI:this.pixelFormat=s.Ab.RED}}static validate(t,e){return new l(t,e)}}let c=class t{constructor(t,e=null,i=null){if(this.type=o.p.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in t)this._descriptor=t,i=e;else{const i=l.validate(t,e);if(!i)throw new n.A("Texture descriptor invalid");this._descriptor=i}this._descriptor.target===s.Ap.TEXTURE_CUBE_MAP?this._setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return(0,a.e)(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._glName&&this._descriptor.context.instanceCounter.decrement(s.vt.Texture,this),this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(t,e){const i=this._descriptor;if(i.width!==t||i.height!==e){if(this._wasImmutablyAllocated)throw new n.A("Immutable textures can't be resized!");i.width=t,i.height=e,this._descriptor.target===s.Ap.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(t=null){for(let e=s.Ap.TEXTURE_CUBE_MAP_POSITIVE_X;e<=s.Ap.TEXTURE_CUBE_MAP_NEGATIVE_Z;e++)this._setData(t,e)}setData(t){this._setData(t)}_setData(e,i){if(!this._descriptor.context?.gl)return;const o=this._descriptor.context.gl;(0,r.Y2)(o),this._glName||(this._glName=o.createTexture(),this._glName&&this._descriptor.context.instanceCounter.increment(s.vt.Texture,this)),void 0===e&&(e=null);const a=this._descriptor,l=i??a.target,c=p(l);null===e&&(a.width=a.width||4,a.height=a.height||4,c&&(a.depth=a.depth??1));const g=this._descriptor.context.bindTexture(this,t.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(t.TEXTURE_UNIT_FOR_UPDATES),u(a),this._configurePixelStorage(),(0,r.Y2)(o);const y=this._deriveInternalFormat();if(_(e)){let t="width"in e?e.width:e.codedWidth,i="height"in e?e.height:e.codedHeight;const n=1;e instanceof HTMLVideoElement&&(t=e.videoWidth,i=e.videoHeight),a.width&&a.height,c&&a.depth,a.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(l,y,a.hasMipmap,t,i,n),this._texImage(l,0,y,t,i,n,e),(0,r.Y2)(o),a.hasMipmap&&this.generateMipmap(),a.width||(a.width=t),a.height||(a.height=i),c&&!a.depth&&(a.depth=n)}else{const{width:t,height:i,depth:u}=a;if(null==t||null==i)throw new n.A("Width and height must be specified!");if(c&&null==u)throw new n.A("Depth must be specified!");if(a.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(l,y,a.hasMipmap,t,i,u),f(e)){const r=e.levels,c=m(l,t,i,u),h=Math.min(c-1,r.length-1);o.texParameteri(a.target,this._descriptor.context.gl.TEXTURE_MAX_LEVEL,h);const d=y;if(!(d in s.CQ))throw new n.A("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel(((t,e,i,n)=>{const s=r[Math.min(t,r.length-1)];this._compressedTexImage(l,t,d,e,i,n,s)}),h)}else this._texImage(l,0,y,t,i,u,e),(0,r.Y2)(o),a.hasMipmap&&this.generateMipmap()}h(o,this._descriptor),d(o,this._descriptor),function(t,e){const i=t.capabilities.textureFilterAnisotropic;i&&t.gl.texParameterf(e.target,i.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}(this._descriptor.context,this._descriptor),(0,r.Y2)(o),this._descriptor.context.bindTexture(g,t.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,i,r,s,o,a,l=0){a||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._descriptor,u=this._deriveInternalFormat(),{context:h,pixelFormat:d,dataType:p,target:m,isImmutable:g}=c;if(g&&!this._wasImmutablyAllocated)throw new n.A("Cannot update immutable texture before allocation!");const y=h.bindTexture(this,t.TEXTURE_UNIT_FOR_UPDATES,!0);(i<0||r<0||i+s>c.width||r+o>c.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:v}=h;l&&v.pixelStorei(v.UNPACK_SKIP_ROWS,l),_(a)?v.texSubImage2D(m,e,i,r,s,o,d,p,a):f(a)?v.compressedTexSubImage2D(m,e,i,r,s,o,u,a.levels[e]):v.texSubImage2D(m,e,i,r,s,o,d,p,a),l&&v.pixelStorei(v.UNPACK_SKIP_ROWS,0),h.bindTexture(y,t.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,i,r,s,o,a,l,c){c||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const u=this._descriptor,h=this._deriveInternalFormat(),{context:d,pixelFormat:_,dataType:m,isImmutable:g,target:y}=u;if(g&&!this._wasImmutablyAllocated)throw new n.A("Cannot update immutable texture before allocation!");p(y)||console.warn("Attempting to set 3D texture data on a non-3D texture");const v=d.bindTexture(this,t.TEXTURE_UNIT_FOR_UPDATES);d.setActiveTexture(t.TEXTURE_UNIT_FOR_UPDATES),(i<0||r<0||s<0||i+o>u.width||r+a>u.height||s+l>u.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:x}=d;if(f(c))c=c.levels[e],x.compressedTexSubImage3D(y,e,i,r,s,o,a,l,h,c);else{const t=c;x.texSubImage3D(y,e,i,r,s,o,a,l,_,m,t)}d.bindTexture(v,t.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new n.A("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,u(e)}e.samplingMode===s.Cj.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=s.Cj.LINEAR_MIPMAP_NEAREST):e.samplingMode===s.Cj.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=s.Cj.NEAREST_MIPMAP_NEAREST);const i=this._descriptor.context.bindTexture(this,t.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(t.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(i,t.TEXTURE_UNIT_FOR_UPDATES)}clearMipmap(){const t=this._descriptor;if(t.hasMipmap){if(this._wasImmutablyAllocated)throw new n.A("Cannot delete mipmaps to immutable texture after allocation");t.hasMipmap=!1,this._samplingModeDirty=!0,u(t)}t.samplingMode===s.Cj.LINEAR_MIPMAP_NEAREST?(this._samplingModeDirty=!0,t.samplingMode=s.Cj.LINEAR):t.samplingMode===s.Cj.NEAREST_MIPMAP_NEAREST&&(this._samplingModeDirty=!0,t.samplingMode=s.Cj.NEAREST)}setSamplingMode(t){t!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=t,this._samplingModeDirty=!0)}setWrapMode(t){t!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=t,u(this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const t=this._descriptor,e=t.context.gl;this._samplingModeDirty&&(h(e,t),this._samplingModeDirty=!1),this._wrapModeDirty&&(d(e,t),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(null!=this._descriptor.internalFormat)return this._descriptor.internalFormat===s.Ab.DEPTH_STENCIL&&(this._descriptor.internalFormat=s.Ab.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case s.ld.FLOAT:switch(this._descriptor.pixelFormat){case s.Ab.RGBA:return this._descriptor.internalFormat=s.H0.RGBA32F;case s.Ab.RGB:return this._descriptor.internalFormat=s.H0.RGB32F;default:throw new n.A("Unable to derive format")}case s.ld.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case s.Ab.RGBA:return this._descriptor.internalFormat=s.H0.RGBA8;case s.Ab.RGB:return this._descriptor.internalFormat=s.H0.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===s.Ab.DEPTH_STENCIL?s.Ab.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const t=this._descriptor.context.gl,{unpackAlignment:e,flipped:i,preMultiplyAlpha:n}=this._descriptor;t.pixelStorei(t.UNPACK_ALIGNMENT,e),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,i?1:0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n?1:0)}_texStorage(t,e,i,r,o,a){const{gl:l}=this._descriptor.context;if(!(e in s.H0))throw new n.A("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const c=i?m(t,r,o,a):1;if(p(t)){if(null==a)throw new n.A("Missing depth dimension for 3D texture upload");l.texStorage3D(t,c,e,r,o,a)}else l.texStorage2D(t,c,e,r,o);this._wasImmutablyAllocated=!0}_texImage(t,e,i,r,s,o,a){const l=this._descriptor.context.gl,c=p(t),{isImmutable:u,pixelFormat:h,dataType:d}=this._descriptor;if(u){if(null!=a){const i=a;if(c){if(null==o)throw new n.A("Missing depth dimension for 3D texture upload");l.texSubImage3D(t,e,0,0,0,r,s,o,h,d,i)}else l.texSubImage2D(t,e,0,0,r,s,h,d,i)}}else{const u=a;if(c){if(null==o)throw new n.A("Missing depth dimension for 3D texture upload");l.texImage3D(t,e,i,r,s,o,0,h,d,u)}else l.texImage2D(t,e,i,r,s,0,h,d,u)}}_compressedTexImage(t,e,i,r,s,o,a){const l=this._descriptor.context.gl,c=p(t);if(this._descriptor.isImmutable){if(null!=a)if(c){if(null==o)throw new n.A("Missing depth dimension for 3D texture upload");l.compressedTexSubImage3D(t,e,0,0,0,r,s,o,i,a)}else l.compressedTexSubImage2D(t,e,0,0,r,s,i,a)}else if(c){if(null==o)throw new n.A("Missing depth dimension for 3D texture upload");l.compressedTexImage3D(t,e,i,r,s,o,0,a)}else l.compressedTexImage2D(t,e,i,r,s,0,a)}_forEachMipmapLevel(t,e=1/0){let{width:i,height:r,depth:o,hasMipmap:a,target:l}=this._descriptor;const c=l===s.Ap.TEXTURE_3D;if(null==i||null==r||c&&null==o)throw new n.A("Missing texture dimensions for mipmap calculation");for(let n=0;t(n,i,r,o),a&&(1!==i||1!==r||c&&1!==o)&&!(n>=e);++n)i=Math.max(1,i>>1),r=Math.max(1,r>>1),c&&(o=Math.max(1,o>>1))}};function u(t){(null!=t.width&&t.width<0||null!=t.height&&t.height<0||null!=t.depth&&t.depth<0)&&console.error("Negative dimension parameters are not allowed!")}function h(t,e){let i=e.samplingMode,n=e.samplingMode;i===s.Cj.LINEAR_MIPMAP_NEAREST||i===s.Cj.LINEAR_MIPMAP_LINEAR?(i=s.Cj.LINEAR,e.hasMipmap||(n=s.Cj.LINEAR)):i!==s.Cj.NEAREST_MIPMAP_NEAREST&&i!==s.Cj.NEAREST_MIPMAP_LINEAR||(i=s.Cj.NEAREST,e.hasMipmap||(n=s.Cj.NEAREST)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,i),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,n)}function d(t,e){"number"==typeof e.wrapMode?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}function f(t){return null!=t&&"type"in t&&"compressed"===t.type}function _(t){return null!=t&&!f(t)&&!function(t){return null!=t&&"byteLength"in t}(t)}function p(t){return t===s.Ap.TEXTURE_3D||t===s.Ap.TEXTURE_2D_ARRAY}function m(t,e,i,n=1){let r=Math.max(e,i);return t===s.Ap.TEXTURE_3D&&(r=Math.max(r,n)),Math.round(Math.log(r)/Math.LN2)+1}c.TEXTURE_UNIT_FOR_UPDATES=0},10956:function(t,e,i){i.d(e,{R:function(){return s},e:function(){return o}});var n=i(85456),r=i(93380);class s{constructor(t=0,e=t){this.width=t,this.height=e,this.target=n.Ap.TEXTURE_2D,this.pixelFormat=n.Ab.RGBA,this.dataType=n.ld.UNSIGNED_BYTE,this.samplingMode=n.Cj.LINEAR,this.wrapMode=n.pF.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}}function o(t){return t.width<=0||t.height<=0?0:Math.round(t.width*t.height*(t.hasMipmap?4/3:1)*(null==t.internalFormat?4:(0,r.IB)(t.internalFormat)))}},93380:function(t,e,i){i.d(e,{Hi:function(){return l},IB:function(){return c},WH:function(){return o},yu:function(){return a}}),i(58941);var n=i(41835),r=i(85456),s=i(48347);function o(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function a(t,e,i,r,a=0){const l=t.gl;t.bindBuffer(i);for(const i of r){const r=e.get(i.name);if(void 0===r){console.warn(`There is no location for vertex attribute '${i.name}' defined.`);continue}const c=a*i.stride;if(i.count<=4)l.vertexAttribPointer(r,i.count,i.type,i.normalized,i.stride,i.offset+c),l.enableVertexAttribArray(r),i.divisor>0&&t.gl.vertexAttribDivisor(r,i.divisor);else if(9===i.count)for(let e=0;e<3;e++)l.vertexAttribPointer(r+e,3,i.type,i.normalized,i.stride,i.offset+12*e+c),l.enableVertexAttribArray(r+e),i.divisor>0&&t.gl.vertexAttribDivisor(r+e,i.divisor);else if(16===i.count)for(let e=0;e<4;e++)l.vertexAttribPointer(r+e,4,i.type,i.normalized,i.stride,i.offset+16*e+c),l.enableVertexAttribArray(r+e),i.divisor>0&&t.gl?.vertexAttribDivisor(r+e,i.divisor);else console.error("Unsupported vertex attribute element count: "+i.count);if((0,n.en)()){const e=o(t),n=(0,s._)(i.type),r=i.offset,a=Math.round(n/r)!==n/r?`. Offset not a multiple of stride. DataType requires ${n} bytes, but descriptor has an offset of ${r}`:"";e&&console.error(`Unable to bind vertex attribute "${i.name}" with baseInstanceOffset ${c}${a}:`,e,i)}}}function l(t,e,i,n){const s=t.gl;t.bindBuffer(i);for(const i of n){const n=e.get(i.name);if(i.count<=4)s.disableVertexAttribArray(n),i.divisor&&i.divisor>0&&t.gl?.vertexAttribDivisor(n,0);else if(9===i.count)for(let e=0;e<3;e++)s.disableVertexAttribArray(n+e),i.divisor&&i.divisor>0&&t.gl?.vertexAttribDivisor(n+e,0);else if(16===i.count)for(let e=0;e<4;e++)s.disableVertexAttribArray(n+e),i.divisor&&i.divisor>0&&t.gl?.vertexAttribDivisor(n+e,0);else console.error("Unsupported vertex attribute element count: "+i.count)}t.unbindBuffer(r.NZ.ARRAY_BUFFER)}function c(t){switch(t){case r.Ab.ALPHA:case r.Ab.LUMINANCE:case r.Ab.RED:case r.Ab.RED_INTEGER:case r.H0.R8:case r.H0.R8I:case r.H0.R8UI:case r.H0.R8_SNORM:case r.yQ.STENCIL_INDEX8:return 1;case r.Ab.LUMINANCE_ALPHA:case r.Ab.RG:case r.Ab.RG_INTEGER:case r.H0.RGBA4:case r.H0.R16F:case r.H0.R16I:case r.H0.R16UI:case r.H0.RG8:case r.H0.RG8I:case r.H0.RG8UI:case r.H0.RG8_SNORM:case r.H0.RGB565:case r.H0.RGB5_A1:case r.yQ.DEPTH_COMPONENT16:return 2;case r.Ab.DEPTH_COMPONENT:case r.Ab.RGB:case r.Ab.RGB_INTEGER:case r.H0.RGB8:case r.H0.RGB8I:case r.H0.RGB8UI:case r.H0.RGB8_SNORM:case r.H0.SRGB8:case r.yQ.DEPTH_COMPONENT24:return 3;case r.Ab.DEPTH_STENCIL:case r.Ab.DEPTH24_STENCIL8:case r.Ab.RGBA:case r.Ab.RGBA_INTEGER:case r.H0.RGBA8:case r.H0.R32F:case r.H0.R11F_G11F_B10F:case r.H0.RG16F:case r.H0.R32I:case r.H0.R32UI:case r.H0.RG16I:case r.H0.RG16UI:case r.H0.RGBA8I:case r.H0.RGBA8UI:case r.H0.RGBA8_SNORM:case r.H0.SRGB8_ALPHA8:case r.H0.RGB9_E5:case r.H0.RGB10_A2UI:case r.H0.RGB10_A2:case r.yQ.DEPTH_STENCIL:case r.yQ.DEPTH_COMPONENT32F:case r.yQ.DEPTH24_STENCIL8:return 4;case r.yQ.DEPTH32F_STENCIL8:return 5;case r.H0.RGB16F:case r.H0.RGB16I:case r.H0.RGB16UI:return 6;case r.H0.RG32F:case r.H0.RG32I:case r.H0.RG32UI:case r.H0.RGBA16F:case r.H0.RGBA16I:case r.H0.RGBA16UI:return 8;case r.H0.RGB32F:case r.H0.RGB32I:case r.H0.RGB32UI:return 12;case r.H0.RGBA32F:case r.H0.RGBA32I:case r.H0.RGBA32UI:return 16;case r.CQ.COMPRESSED_RGB_S3TC_DXT1_EXT:case r.CQ.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case r.CQ.COMPRESSED_RGBA_S3TC_DXT3_EXT:case r.CQ.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case r.CQ.COMPRESSED_R11_EAC:case r.CQ.COMPRESSED_SIGNED_R11_EAC:case r.CQ.COMPRESSED_RGB8_ETC2:case r.CQ.COMPRESSED_SRGB8_ETC2:case r.CQ.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case r.CQ.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;case r.CQ.COMPRESSED_RG11_EAC:case r.CQ.COMPRESSED_SIGNED_RG11_EAC:case r.CQ.COMPRESSED_RGBA8_ETC2_EAC:case r.CQ.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}},81438:function(t,e,i){i.d(e,{Z:function(){return c}});var n=i(40633),r=i(95929),s=i(24540),o=i(85456),a=i(93380);const l=()=>n.A.getLogger("esri.views.webgl.VertexArrayObject");let c=class{constructor(t,e,i,n,r=null){this._context=t,this._locations=e,this._layout=i,this._buffers=n,this._indexBuffer=r,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce(((t,e)=>t+this._buffers[e].usedMemory),null!=this._indexBuffer?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*s.zQ}dispose(){if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const t in this._buffers)this._buffers[t]?.dispose(),delete this._buffers[t];this._indexBuffer=(0,r.WD)(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&l().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(o.vt.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:t}=this._context,e=t.createVertexArray();t.bindVertexArray(e),this._bindLayout(),t.bindVertexArray(null),this._glName=e,this._context.instanceCounter.increment(o.vt.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:t,_layout:e,_indexBuffer:i}=this;t||l().error("Vertex buffer dictionary is empty!");const n=this._context.gl;for(const i in t){const n=t[i];n||l().error("Vertex buffer is uninitialized!");const r=e[i];r||l().error("Vertex element descriptor is empty!"),(0,a.yu)(this._context,this._locations,n,r)}null!=i&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}}},10106:function(t,e,i){i.d(e,{_:function(){return r}});var n=i(95929);class r{constructor(){this._result=!1}dispose(){this._program=(0,n.WD)(this._program)}get result(){return null!=this._program&&(this._result=this._test(this._program),this.dispose()),this._result}}},58250:function(t,e,i){i.d(e,{_R:function(){return s}});class n{constructor(t,e,i,n,r,s,o,a,l){this.createQuery=t,this.deleteQuery=e,this.resultAvailable=i,this.getResult=n,this.disjoint=r,this.beginTimeElapsed=s,this.endTimeElapsed=o,this.createTimestamp=a,this.timestampBits=l}}let r=!1;function s(t,e){if(e.disjointTimerQuery)return null;let i=t.getExtension("EXT_disjoint_timer_query_webgl2");return i?new n((()=>t.createQuery()),(e=>{t.deleteQuery(e),r=!1}),(e=>t.getQueryParameter(e,t.QUERY_RESULT_AVAILABLE)),(e=>t.getQueryParameter(e,t.QUERY_RESULT)),(()=>t.getParameter(i.GPU_DISJOINT_EXT)),(e=>{r||(r=!0,t.beginQuery(i.TIME_ELAPSED_EXT,e))}),(()=>{t.endQuery(i.TIME_ELAPSED_EXT),r=!1}),(t=>i.queryCounterEXT(t,i.TIMESTAMP_EXT)),(()=>t.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT))):(i=t.getExtension("EXT_disjoint_timer_query"),i?new n((()=>i.createQueryEXT()),(t=>{i.deleteQueryEXT(t),r=!1}),(t=>i.getQueryObjectEXT(t,i.QUERY_RESULT_AVAILABLE_EXT)),(t=>i.getQueryObjectEXT(t,i.QUERY_RESULT_EXT)),(()=>t.getParameter(i.GPU_DISJOINT_EXT)),(t=>{r||(r=!0,i.beginQueryEXT(i.TIME_ELAPSED_EXT,t))}),(()=>{i.endQueryEXT(i.TIME_ELAPSED_EXT),r=!1}),(t=>i.queryCounterEXT(t,i.TIMESTAMP_EXT)),(()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT))):null)}},41835:function(t,e,i){i.d(e,{Xc:function(){return c},Y2:function(){return u},en:function(){return l}});var n=i(39819),r=i(58941),s=i(40633);const o=()=>s.A.getLogger("esri.views.webgl.checkWebGLError"),a=!!(0,r.A)("enable-feature:webgl-debug");function l(){return a}function c(){return a}function u(t){if(l()){const e=t.getError();if(e){const i=function(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}(t,e),r=(new Error).stack;o().error(new n.A("webgl-error","WebGL error occurred",{message:i,stack:r}))}}}},44476:function(t,e,i){function n(t,e,i){for(let n=0;n<i;++n)e[2*n]=t[n],e[2*n+1]=t[n]-e[2*n]}function r(t,e){const i=t.length;for(let n=0;n<i;++n)o[0]=t[n],e[n]=o[0];return e}function s(t,e){const i=t.length;for(let n=0;n<i;++n)o[0]=t[n],o[1]=t[n]-o[0],e[n]=o[1];return e}i.d(e,{Zo:function(){return r},jA:function(){return s},jS:function(){return n}});const o=new Float32Array(2)},48347:function(t,e,i){i.d(e,{_:function(){return r}});var n=i(85456);function r(t){switch(t){case n.pe.BYTE:case n.pe.UNSIGNED_BYTE:return 1;case n.pe.SHORT:case n.pe.UNSIGNED_SHORT:case n.pe.HALF_FLOAT:return 2;case n.pe.FLOAT:case n.pe.INT:case n.pe.UNSIGNED_INT:return 4}}},72785:function(t,e,i){function n(t){const{options:e,value:i}=t;return"number"==typeof e[i]}function r(t){let e="";for(const i in t){const r=t[i];if("boolean"==typeof r)r&&(e+=`#define ${i}\n`);else if("number"==typeof r)e+=`#define ${i} ${r.toFixed()}\n`;else if("object"==typeof r)if(n(r)){const{value:t,options:n,namespace:s}=r,o=s?`${s}_`:"";for(const t in n)e+=`#define ${o}${t} ${n[t].toFixed()}\n`;e+=`#define ${i} ${o}${t}\n`}else{const t=r.options;let n=0;for(const i in t)e+=`#define ${t[i]} ${(n++).toFixed()}\n`;e+=`#define ${i} ${t[r.value]}\n`}}return e}i.d(e,{I:function(){return r}})},57087:function(t,e,i){i.d(e,{Ey:function(){return b},Ms:function(){return H},Xt:function(){return c},hG:function(){return l},kn:function(){return u},ox:function(){return s},p3:function(){return o},wE:function(){return h}});var n=i(54407),r=i(85456);function s(t,e,i=r.Tb.ADD,n=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:i,opAlpha:i,color:{r:n[0],g:n[1],b:n[2],a:n[3]}}}function o(t,e,i,n,s=r.Tb.ADD,o=r.Tb.ADD,a=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:i,dstAlpha:n,opRgb:s,opAlpha:o,color:{r:a[0],g:a[1],b:a[2],a:a[3]}}}const a={face:r.Y7.BACK,mode:r.Ac.CCW},l={face:r.Y7.FRONT,mode:r.Ac.CCW},c=t=>t===n.s2.Back?a:t===n.s2.Front?l:null,u={zNear:0,zFar:1},h={r:!0,g:!0,b:!0,a:!0};function d(t){return T.intern(t)}function f(t){return P.intern(t)}function _(t){return A.intern(t)}function p(t){return I.intern(t)}function m(t){return O.intern(t)}function g(t){return z.intern(t)}function y(t){return L.intern(t)}function v(t){return B.intern(t)}function x(t){return V.intern(t)}function b(t){return G.intern(t)}class S{constructor(t,e){this._makeKey=t,this._makeRef=e,this._interns=new Map}intern(t){if(!t)return null;const e=this._makeKey(t),i=this._interns;return i.has(e)||i.set(e,this._makeRef(t)),i.get(e)??null}}function w(t){return"["+t.join(",")+"]"}const T=new S(M,(t=>({__tag:"Blending",...t})));function M(t){return t?w([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const P=new S(E,(t=>({__tag:"Culling",...t})));function E(t){return t?w([t.face,t.mode]):null}const A=new S(C,(t=>({__tag:"PolygonOffset",...t})));function C(t){return t?w([t.factor,t.units]):null}const I=new S(R,(t=>({__tag:"DepthTest",...t})));function R(t){return t?w([t.func]):null}const O=new S(F,(t=>({__tag:"StencilTest",...t})));function F(t){return t?w([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const z=new S(D,(t=>({__tag:"DepthWrite",...t})));function D(t){return t?w([t.zNear,t.zFar]):null}const L=new S(N,(t=>({__tag:"ColorWrite",...t})));function N(t){return t?w([t.r,t.g,t.b,t.a]):null}const B=new S(k,(t=>({__tag:"StencilWrite",...t})));function k(t){return t?w([t.mask]):null}const V=new S(U,(t=>({__tag:"DrawBuffers",...t})));function U(t){return t?w(t.buffers):null}const G=new S((function(t){return t?w([M(t.blending),E(t.culling),C(t.polygonOffset),R(t.depthTest),F(t.stencilTest),D(t.depthWrite),N(t.colorWrite),k(t.stencilWrite),U(t.drawBuffers)]):null}),(t=>({blending:d(t.blending),culling:f(t.culling),polygonOffset:_(t.polygonOffset),depthTest:p(t.depthTest),stencilTest:m(t.stencilTest),depthWrite:g(t.depthWrite),colorWrite:y(t.colorWrite),stencilWrite:v(t.stencilWrite),drawBuffers:x(t.drawBuffers)})));class H{constructor(t){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=t}setPipeline(t){(this._pipelineInvalid||t!==this._pipeline)&&(this._setBlending(t.blending),this._setCulling(t.culling),this._setPolygonOffset(t.polygonOffset),this._setDepthTest(t.depthTest),this._setStencilTest(t.stencilTest),this._setDepthWrite(t.depthWrite),this._setColorWrite(t.colorWrite),this._setStencilWrite(t.stencilWrite),this._setDrawBuffers(t.drawBuffers),this._pipeline=t),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(t){this._blending=this._setSubState(t,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(t){this._culling=this._setSubState(t,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(t){this._polygonOffset=this._setSubState(t,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(t){this._depthTest=this._setSubState(t,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(t){this._stencilTest=this._setSubState(t,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(t){this._depthWrite=this._setSubState(t,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(t){this._colorWrite=this._setSubState(t,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(t){this._stencilWrite=this._setSubState(t,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(t){this._drawBuffers=this._setSubState(t,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(t,e,i,n){return(i||t!==e)&&(n(t),this._pipelineInvalid=!0),t}}},38680:function(t,e,i){i.d(e,{H:function(){return h}});var n=i(94860),r=i(86305),s=i(85456),o=i(96402),a=i(78541),l=i(10956),c=i(81438),u=i(10106);class h extends u._{constructor(t){super(),this._rctx=t,this._program=t.programCache.acquire("\n    precision highp float;\n\n    attribute vec2 a_pos;\n    varying vec2 v_uv;\n\n    void main() {\n      v_uv = a_pos;\n      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n    precision highp float;\n\n    varying vec2 v_uv;\n\n    uniform sampler2D u_texture;\n\n    void main() {\n      gl_FragColor = texture2D(u_texture, v_uv);\n    }\n    ",new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(t){const e=this._rctx;if(!e.gl)return t.dispose(),!0;const i=new l.R(1);i.wrapMode=s.pF.CLAMP_TO_EDGE,i.samplingMode=s.Cj.NEAREST;const u=new o.H(e,i),h=r.g.createVertex(e,s._U.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),f=new c.Z(e,new Map([["a_pos",0]]),n.VS,{geometry:h}),_=new l.R;_.samplingMode=s.Cj.LINEAR,_.wrapMode=s.pF.CLAMP_TO_EDGE;const p=new a.g(e,_,d);e.useProgram(t),e.bindTexture(p,0),t.setUniform1i("u_texture",0);const m=e.getBoundFramebufferObject(),{x:g,y:y,width:v,height:x}=e.getViewport();e.bindFramebuffer(u),e.setViewport(0,0,1,1),e.setClearColor(0,0,0,0),e.setBlendingEnabled(!1),e.clear(s.hn.COLOR_BUFFER_BIT),e.bindVAO(f),e.drawArrays(s.WR.TRIANGLE_STRIP,0,4);const b=new Uint8Array(4);return u.readPixels(0,0,1,1,s.Ab.RGBA,s.ld.UNSIGNED_BYTE,b),f.dispose(),u.dispose(),p.dispose(),e.setViewport(g,y,v,x),e.bindFramebuffer(m),255!==b[0]}}const d=new Image;d.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",d.width=5,d.height=5,d.decode()}}]);
//# sourceMappingURL=mapViewDeps.js.map