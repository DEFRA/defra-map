"use strict";(self.webpackChunk_defra_flood_map=self.webpackChunk_defra_flood_map||[]).push([[5497],{"./node_modules/@arcgis/core/layers/support/ExportImageParameters.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{g:()=>y});var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_core_Accessor_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js"),_core_sql_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/core/sql.js"),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_6__=(__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),__webpack_require__("./node_modules/@arcgis/core/core/RandomLCG.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),_geometry_support_scaleUtils_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/scaleUtils.js"),_floorFilterUtils_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/layers/support/floorFilterUtils.js"),_sublayerUtils_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/layers/support/sublayerUtils.js");const n={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};let y=class extends _core_Accessor_js__WEBPACK_IMPORTED_MODULE_1__.A{constructor(e){super(e),this.floors=null,this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>{const r=(0,_floorFilterUtils_js__WEBPACK_IMPORTED_MODULE_9__.f)(this.floors,e);return e.toExportImageJSON(r)}));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&(0,_sublayerUtils_js__WEBPACK_IMPORTED_MODULE_8__.Sk)(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.removeHandles("layer"),e&&this.addHandles([e.allSublayers.on("change",(()=>this.notifyChange("visibleSublayers"))),e.on("sublayer-update",(e=>this.notifyChange(n[e.propertyName])))],"layer"))}get layers(){const e=this.visibleSublayers;return e?e.length?"show:"+e.map((e=>e.id)).join(","):"show:-1":null}get layerDefs(){const e=!!this.floors?.length,r=this.visibleSublayers.filter((r=>null!=r.definitionExpression||e&&null!=r.floorInfo));return r.length?JSON.stringify(r.reduce(((e,r)=>{const t=(0,_floorFilterUtils_js__WEBPACK_IMPORTED_MODULE_9__.f)(this.floors,r),i=(0,_core_sql_js__WEBPACK_IMPORTED_MODULE_10__.mA)(t,r.definitionExpression);return null!=i&&(e[r.id]=i),e}),{})):null}get version(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers");const e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const r=this.layer.sublayers,s=this.scale,t=r=>{r.visible&&(0===s||(0,_geometry_support_scaleUtils_js__WEBPACK_IMPORTED_MODULE_7__.zx)(s,r.minScale,r.maxScale))&&(r.sublayers?r.sublayers.forEach(t):e.unshift(r))};r&&r.forEach(t);const i=this._get("visibleSublayers");return!i||i.length!==e.length||i.some(((r,s)=>e[s]!==r))?e:i}toJSON(){const e=this.layer;let r={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?r.dynamicLayers=this.dynamicLayers:r={...r,layers:this.layers,layerDefs:this.layerDefs},r}};(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.MZ)({readOnly:!0})],y.prototype,"dynamicLayers",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.MZ)()],y.prototype,"floors",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.MZ)({readOnly:!0})],y.prototype,"hasDynamicLayers",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.MZ)()],y.prototype,"layer",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.MZ)({readOnly:!0})],y.prototype,"layers",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.MZ)({readOnly:!0})],y.prototype,"layerDefs",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.MZ)({type:Number})],y.prototype,"scale",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.MZ)({readOnly:!0})],y.prototype,"version",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.MZ)({readOnly:!0})],y.prototype,"visibleSublayers",null),y=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_6__.$)("esri.layers.support.ExportImageParameters")],y)},"./node_modules/@arcgis/core/layers/support/timeSupport.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{F:()=>timeSupport_i});__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/lang.js");var timeUtils=__webpack_require__("./node_modules/@arcgis/core/core/timeUtils.js"),TimeExtent=__webpack_require__("./node_modules/@arcgis/core/time/TimeExtent.js");__webpack_require__("./node_modules/@arcgis/core/webmap/utils.js"),__webpack_require__("./node_modules/@arcgis/core/support/tagSymbols.js");function timeSupport_i(i,n,s){if(null==i?.timeInfo)return null;const{datesInUnknownTimezone:l=!1,timeOffset:o,useViewTime:m}=i;let u=i.timeExtent;l&&(u=function p(t){if(!t)return t;const{start:e,end:r}=t;return new TimeExtent.A({start:null!=e?(0,timeUtils.S1)(e,e.getTimezoneOffset(),"minutes"):e,end:null!=r?(0,timeUtils.S1)(r,r.getTimezoneOffset(),"minutes"):r})}(u));let r=m?n&&u?n.intersection(u):n||u:u;return!r||r.isEmpty||r.isAllTime?r:(o&&(r=r.offset(-o.value,o.unit)),l&&(r=function d(t){if(!t)return t;const{start:e,end:r}=t;return new TimeExtent.A({start:null!=e?(0,timeUtils.S1)(e,-e.getTimezoneOffset(),"minutes"):e,end:null!=r?(0,timeUtils.S1)(r,-r.getTimezoneOffset(),"minutes"):r})}(r)),r.equals(s)?s:r)}},"./node_modules/@arcgis/core/support/tagSymbols.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{X:()=>e});const e=Symbol("WebScene")},"./node_modules/@arcgis/core/views/2d/engine/BitmapContainer.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{l:()=>r});var _webgl_enums_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/enums.js"),_webgl_WGLContainer_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/WGLContainer.js"),_webgl_shaderGraph_techniques_bitmap_BitmapTechnique_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/bitmap/BitmapTechnique.js");class r extends _webgl_WGLContainer_js__WEBPACK_IMPORTED_MODULE_1__.A{constructor(){super(...arguments),this._hasCrossfade=!1,this._bitmapTechnique=null}get requiresDedicatedFBO(){return super.requiresDedicatedFBO||this._hasCrossfade}beforeRender(e){super.beforeRender(e),this._manageFade()}onAttach(){super.onAttach(),this._bitmapTechnique=new _webgl_shaderGraph_techniques_bitmap_BitmapTechnique_js__WEBPACK_IMPORTED_MODULE_2__.C}onDetach(){super.onDetach(),this._bitmapTechnique?.shutdown(),this._bitmapTechnique=null}renderChildren(i){super.renderChildren(i),this.visible&&i.drawPhase===_webgl_enums_js__WEBPACK_IMPORTED_MODULE_0__.S5.MAP&&null!=this._bitmapTechnique&&this._bitmapTechnique.render(i,{bitmaps:this.children})}_manageFade(){this.children.reduce(((e,i)=>e+(i.inFadeTransition?1:0)),0)>=2?(this.children.forEach((e=>e.blendFunction="additive")),this._hasCrossfade=!0):(this.children.forEach((e=>e.blendFunction="standard")),this._hasCrossfade=!1)}}},"./node_modules/@arcgis/core/views/2d/layers/MapImageLayerView2D.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>j});var tslib_es6=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),handleUtils=__webpack_require__("./node_modules/@arcgis/core/core/handleUtils.js"),Logger=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),promiseUtils=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),reactiveUtils=__webpack_require__("./node_modules/@arcgis/core/core/reactiveUtils.js"),property=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),subclass=(__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/RandomLCG.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),GraphicsCollection=__webpack_require__("./node_modules/@arcgis/core/support/GraphicsCollection.js"),BitmapContainer=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/BitmapContainer.js"),LayerView2D=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/LayerView2D.js"),GraphicsView2D=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/graphics/GraphicsView2D.js"),HighlightGraphicContainer=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/graphics/HighlightGraphicContainer.js"),ExportStrategy=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/support/ExportStrategy.js"),util=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/support/util.js"),LayerView=__webpack_require__("./node_modules/@arcgis/core/views/layers/LayerView.js"),ExportImageParameters=__webpack_require__("./node_modules/@arcgis/core/layers/support/ExportImageParameters.js"),timeSupport=__webpack_require__("./node_modules/@arcgis/core/layers/support/timeSupport.js");const i=i=>{let p=class extends i{initialize(){this.exportImageParameters=new ExportImageParameters.g({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get floors(){return this.view?.floors??null}get exportImageVersion(){return this.exportImageParameters?.commitProperty("version"),this.commitProperty("timeExtent"),this.commitProperty("floors"),(this._get("exportImageVersion")||0)+1}get timeExtent(){return(0,timeSupport.F)(this.layer,this.view?.timeExtent,this._get("timeExtent"))}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return(0,tslib_es6._)([(0,property.MZ)()],p.prototype,"exportImageParameters",void 0),(0,tslib_es6._)([(0,property.MZ)({readOnly:!0})],p.prototype,"floors",null),(0,tslib_es6._)([(0,property.MZ)({readOnly:!0})],p.prototype,"exportImageVersion",null),(0,tslib_es6._)([(0,property.MZ)()],p.prototype,"layer",void 0),(0,tslib_es6._)([(0,property.MZ)()],p.prototype,"suspended",void 0),(0,tslib_es6._)([(0,property.MZ)({readOnly:!0})],p.prototype,"timeExtent",null),p=(0,tslib_es6._)([(0,subclass.$)("esri.views.layers.MapImageLayerView")],p),p};var RefreshableLayerView=__webpack_require__("./node_modules/@arcgis/core/views/layers/RefreshableLayerView.js"),MapServiceLayerViewHelper=__webpack_require__("./node_modules/@arcgis/core/views/layers/support/MapServiceLayerViewHelper.js"),drapedUtils=__webpack_require__("./node_modules/@arcgis/core/views/support/drapedUtils.js"),HighlightDefaults=__webpack_require__("./node_modules/@arcgis/core/views/support/HighlightDefaults.js");let w=class extends(i((0,RefreshableLayerView.A)((0,LayerView2D.e)(LayerView.A)))){constructor(){super(...arguments),this._highlightGraphics=new GraphicsCollection.Y,this._updateHash=""}fetchPopupFeaturesAtLocation(t,i){return this._popupHighlightHelper.fetchPopupFeaturesAtLocation(t,i)}update(t){const i=`${this.exportImageVersion}/${t.state.id}/${t.pixelRatio}/${t.stationary}`;this._updateHash!==i&&(this._updateHash=i,this.strategy.update(t).catch((t=>{(0,promiseUtils.zf)(t)||Logger.A.getLogger(this).error(t)})),t.stationary&&this._popupHighlightHelper.updateHighlightedFeatures(t.state.resolution)),this._highlightView.processUpdate(t)}attach(){const{imageMaxWidth:t,imageMaxHeight:i,version:e}=this.layer,r=e>=10.3,h=e>=10;this._bitmapContainer=new BitmapContainer.l,this.container.addChild(this._bitmapContainer),this._highlightView=new GraphicsView2D.A({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new HighlightGraphicContainer.A(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1}),this.container.addChild(this._highlightView.container),this._popupHighlightHelper=new MapServiceLayerViewHelper.Uh({createFetchPopupFeaturesQueryGeometry:(t,i)=>(0,drapedUtils.V)(t,i,this.view),highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:(t,i)=>{this._highlightView.graphicUpdateHandler({graphic:t,property:i})},layerView:this,updatingHandles:this._updatingHandles}),this.strategy=new ExportStrategy.A({container:this._bitmapContainer,fetchSource:this.fetchImageBitmap.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:t,imageMaxHeight:i,imageRotationSupported:r,imageNormalizationSupported:h,hidpi:!0}),this.addAttachHandles((0,reactiveUtils.watch)((()=>this.exportImageVersion),(()=>this.requestUpdate()))),this.requestUpdate()}detach(){this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren(),this._highlightView.destroy(),this._popupHighlightHelper.destroy()}viewChange(){}moveEnd(){this.requestUpdate()}supportsSpatialReference(t){return this.layer.serviceSupportsSpatialReference(t)}async doRefresh(){this._updateHash="",this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(t,i,e,r){return this.layer.fetchImage(t,i,e,{timeExtent:this.timeExtent,floors:this.floors,...r})}fetchImageBitmap(t,i,e,r){return this.layer.fetchImageBitmap(t,i,e,{timeExtent:this.timeExtent,floors:this.floors,...r})}highlight(t,e){const r=(0,util.Oq)(t);if(0===r.length)return(0,handleUtils.hA)();const s=e?.name??HighlightDefaults.Tv;return this._addHighlightGraphics(r,s),(0,handleUtils.hA)((()=>!this.destroyed&&this._removeHighlightGraphics(r,s)))}_processHighlight(){const t=this._getHighlights();this._highlightView?.setHighlight(t)}_addHighlightGraphics(t,i){this._highlightGraphics.addMany(t),this._addHighlights(t.map((t=>t.uid)),i)}_removeHighlightGraphics(t,i){this._highlightGraphics.removeMany(t),this._removeHighlights(t.map((t=>t.uid)),i)}};(0,tslib_es6._)([(0,property.MZ)()],w.prototype,"strategy",void 0),(0,tslib_es6._)([(0,property.MZ)()],w.prototype,"updating",void 0),w=(0,tslib_es6._)([(0,subclass.$)("esri.views.2d.layers.MapImageLayerView2D")],w);const j=w},"./node_modules/@arcgis/core/views/2d/layers/support/ExportStrategy.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>_});var tslib_es6=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),Accessor=__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js"),promiseUtils=(__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js")),property=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),subclass=(__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),__webpack_require__("./node_modules/@arcgis/core/core/RandomLCG.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),aaBoundingRect=__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingRect.js"),spatialReferenceUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/spatialReferenceUtils.js"),TileInfo=__webpack_require__("./node_modules/@arcgis/core/layers/support/TileInfo.js");const t=Math.PI/180;function n(n){return n*t}function o(t,o){const a=n(o.rotation),r=Math.abs(Math.cos(a)),s=Math.abs(Math.sin(a)),[u,c]=o.size;return t[0]=Math.round(c*s+u*r),t[1]=Math.round(c*r+u*s),t}var Bitmap=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/Bitmap.js"),TileInfoView=__webpack_require__("./node_modules/@arcgis/core/views/2d/tiling/TileInfoView.js"),TileKey=__webpack_require__("./node_modules/@arcgis/core/views/2d/tiling/TileKey.js");const y=(0,aaBoundingRect.vt)(),x=[0,0],S=new TileKey.A(0,0,0,0),w_imageMaxWidth=2048,w_imageMaxHeight=2048,w_imageRotationSupported=!1,w_imageNormalizationSupported=!1,w_hidpi=!1;let M=class extends Accessor.A{constructor(t){super(t),this._imagePromise=null,this.bitmaps=[],this.hidpi=w_hidpi,this.imageMaxWidth=w_imageMaxWidth,this.imageMaxHeight=w_imageMaxHeight,this.imageRotationSupported=w_imageRotationSupported,this.imageNormalizationSupported=w_imageNormalizationSupported,this.update=(0,promiseUtils.sg)((async(t,e)=>{if((0,promiseUtils.Te)(e),!t.stationary||this.destroyed)return;const i=t.state,s=(0,spatialReferenceUtils.Vp)(i.spatialReference),a=this.hidpi?t.pixelRatio:1,n=i.worldScreenWidth>0,p=n&&this.imageNormalizationSupported&&i.worldScreenWidth<i.size[0],m=Math.round((this.imageMaxWidth??0)/a),l=Math.round((this.imageMaxHeight??0)/a);p?(x[0]=i.worldScreenWidth,x[1]=i.size[1]):this.imageRotationSupported?(x[0]=i.size[0],x[1]=i.size[1]):o(x,i);const c=Math.floor(x[0])>m||Math.floor(x[1])>l,u=s&&(i.extent.xmin<s.valid[0]||i.extent.xmax>s.valid[1]),g=!this.imageNormalizationSupported&&u,f=!c&&!g,y=this.imageRotationSupported?i.rotation:0,S=this.container.children.slice();if(f){const t=p?i.paddedViewState.center:i.center;this._imagePromise=this._singleExport(i,x,t,i.resolution,y,a,e)}else{let t=Math.min(m,l);n&&(t=Math.min(i.worldScreenWidth,t),t=Math.round(i.worldScreenWidth/Math.ceil(i.worldScreenWidth/t))),this._imagePromise=this._tiledExport(i,t,a,e)}try{const t=await this._imagePromise??[];(0,promiseUtils.Te)(e);const i=[];if(this._imagePromise=null,this.destroyed)return;this.bitmaps=t;for(const e of S)t.includes(e)||i.push(e.fadeOut().then((()=>{e.remove(),e.destroy()})));for(const e of t)i.push(e.fadeIn());await Promise.all(i)}catch(w){this._imagePromise=null,(0,promiseUtils.QP)(w)}}),5e3),this.updateExports=(0,promiseUtils.sg)((async t=>{const e=[];for(const i of this.container.children){if(!i.visible||!i.stage)return;e.push(t(i).then((()=>{i.invalidateTexture(),i.requestRender()})))}this._imagePromise=(0,promiseUtils.Lx)(e).then((()=>this._imagePromise=null)),await this._imagePromise}))}destroy(){this.bitmaps.forEach((t=>t.destroy())),this.bitmaps=[]}get updating(){return!this.destroyed&&null!==this._imagePromise}async _export(t,e,i,r,s,a){const n=await this.fetchSource(t,Math.floor(e*s),Math.floor(i*s),{rotation:r,pixelRatio:s,signal:a});(0,promiseUtils.Te)(a);const p=new Bitmap.mb(null,!0);return p.x=t.xmin,p.y=t.ymax,p.resolution=t.width/e,p.rotation=r,p.pixelRatio=s,p.opacity=0,this.container.addChild(p),await p.setSourceAsync(n,a),(0,promiseUtils.Te)(a),p}async _singleExport(t,e,i,o,r,s,a){!function viewStateUtils_a(t,n,o,a){const[r,s]=n,[u,c]=a,h=.5*o;return t[0]=r-h*u,t[1]=s-h*c,t[2]=r+h*u,t[3]=s+h*c,t}(y,i,o,e);const n=(0,aaBoundingRect.w1)(y,t.spatialReference);return[await this._export(n,e[0],e[1],r,s,a)]}_tiledExport(t,e,i,o){const r=TileInfo.default.create({size:e,spatialReference:t.spatialReference,scales:[t.scale]}),s=new TileInfoView.A(r),a=s.getTileCoverage(t);if(!a)return null;const n=[];return a.forEach(((r,a,p,h)=>{S.set(r,a,p,0),s.getTileBounds(y,S);const l=(0,aaBoundingRect.w1)(y,t.spatialReference);n.push(this._export(l,e,e,0,i,o).then((t=>(0!==h&&(S.set(r,a,p,h),s.getTileBounds(y,S),t.x=y[0],t.y=y[3]),t))))})),Promise.all(n)}};(0,tslib_es6._)([(0,property.MZ)()],M.prototype,"_imagePromise",void 0),(0,tslib_es6._)([(0,property.MZ)()],M.prototype,"bitmaps",void 0),(0,tslib_es6._)([(0,property.MZ)()],M.prototype,"container",void 0),(0,tslib_es6._)([(0,property.MZ)()],M.prototype,"fetchSource",void 0),(0,tslib_es6._)([(0,property.MZ)()],M.prototype,"hidpi",void 0),(0,tslib_es6._)([(0,property.MZ)()],M.prototype,"imageMaxWidth",void 0),(0,tslib_es6._)([(0,property.MZ)()],M.prototype,"imageMaxHeight",void 0),(0,tslib_es6._)([(0,property.MZ)()],M.prototype,"imageRotationSupported",void 0),(0,tslib_es6._)([(0,property.MZ)()],M.prototype,"imageNormalizationSupported",void 0),(0,tslib_es6._)([(0,property.MZ)()],M.prototype,"requestUpdate",void 0),(0,tslib_es6._)([(0,property.MZ)()],M.prototype,"updating",null),M=(0,tslib_es6._)([(0,subclass.$)("esri.views.2d.layers.support.ExportStrategy")],M);const _=M}}]);