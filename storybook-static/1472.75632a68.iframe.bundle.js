"use strict";(self.webpackChunk_defra_flood_map=self.webpackChunk_defra_flood_map||[]).push([[1472],{"./node_modules/@arcgis/core/layers/ViewshedLayer.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>ViewshedLayer_u});var tslib_es6=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),featureReferenceUtils=__webpack_require__("./node_modules/@arcgis/core/analysis/featureReferenceUtils.js"),Clonable=__webpack_require__("./node_modules/@arcgis/core/core/Clonable.js"),Cyclical=__webpack_require__("./node_modules/@arcgis/core/core/Cyclical.js"),JSONSupport=__webpack_require__("./node_modules/@arcgis/core/core/JSONSupport.js"),maybe=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),property=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),cast=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/cast.js"),subclass=(__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/RandomLCG.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),ensureType=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),Point=__webpack_require__("./node_modules/@arcgis/core/geometry/Point.js");let u=class extends(JSONSupport.A.JSONSupportMixin(Clonable.A)){constructor(e){super(e),this.observer=null,this.farDistance=1e3,this.heading=0,this.tilt=90,this.horizontalFieldOfView=45,this.verticalFieldOfView=45,this.feature=null}isValid(){return null!=this.observer&&this.farDistance>0}equals(e){return(0,maybe.CM)(this.observer,e.observer)&&this.farDistance===e.farDistance&&this.heading===e.heading&&this.tilt===e.tilt&&this.horizontalFieldOfView===e.horizontalFieldOfView&&this.verticalFieldOfView===e.verticalFieldOfView&&(0,featureReferenceUtils.xH)(this.feature,e.feature)}};(0,tslib_es6._)([(0,property.MZ)({type:Point.default,json:{write:{isRequired:!0}}})],u.prototype,"observer",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Number,nonNullable:!0,range:{min:0},json:{write:{isRequired:!0}}})],u.prototype,"farDistance",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,cast.w)((e=>Cyclical.ie.normalize((0,ensureType.GB)(e),void 0,!0)))],u.prototype,"heading",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Number,nonNullable:!0,range:{min:0,max:180},json:{write:{isRequired:!0}}})],u.prototype,"tilt",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Number,nonNullable:!0,range:{min:0,max:360},json:{write:{isRequired:!0}}})],u.prototype,"horizontalFieldOfView",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Number,nonNullable:!0,range:{min:0,max:180},json:{write:{isRequired:!0}}})],u.prototype,"verticalFieldOfView",void 0),(0,tslib_es6._)([(0,property.MZ)(featureReferenceUtils.N1)],u.prototype,"feature",void 0),(0,tslib_es6._)([(0,property.MZ)({json:{read:!1}})],u.prototype,"isValid",null),u=(0,tslib_es6._)([(0,subclass.$)("esri.analysis.Viewshed")],u);const d=u;var Analysis=__webpack_require__("./node_modules/@arcgis/core/analysis/Analysis.js"),Collection=__webpack_require__("./node_modules/@arcgis/core/core/Collection.js"),collectionUtils=__webpack_require__("./node_modules/@arcgis/core/core/collectionUtils.js"),mathUtils=__webpack_require__("./node_modules/@arcgis/core/core/mathUtils.js"),reactiveUtils=__webpack_require__("./node_modules/@arcgis/core/core/reactiveUtils.js"),Extent=(__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/Extent.js")),projection=__webpack_require__("./node_modules/@arcgis/core/geometry/projection.js");const f=Collection.A.ofType(d);let x=class extends Analysis.A{constructor(e){super(e),this.type="viewshed",this._extent=null}initialize(){this.addHandles((0,reactiveUtils.watch)((()=>this._computeExtent()),(e=>{null==e.pending&&(this._extent=e.extent)}),reactiveUtils.pc))}get viewsheds(){return this._get("viewsheds")||new f}set viewsheds(e){this._set("viewsheds",(0,collectionUtils.V)(e,this.viewsheds,f))}get spatialReference(){for(const e of this.viewsheds)if(null!=e.observer)return e.observer.spatialReference;return null}get extent(){return this._extent}get requiredPropertiesForEditing(){return this.viewsheds.items.map((({observer:e})=>e))}async waitComputeExtent(){const e=this._computeExtent();null!=e.pending&&await e.pending}_computeExtent(){const{spatialReference:e}=this;if(null==e)return{pending:null,extent:null};const t=this.viewsheds.filter((e=>null!=e.observer)),r=t.map((e=>e.observer)).toArray(),n=(0,projection.projectOrLoadMany)(r,e);return null!=n.pending?{pending:n.pending,extent:null}:{pending:null,extent:n.geometries.map(((e,r)=>{const n=t.at(r);return null!=e&&null!=n?this._computeViewshedExtent(this.viewsheds.at(r),e):null})).filter((e=>null!=e)).reduce(((e,t)=>function y(e,t){return null==e?t:null==t?e:e.union(t)}(e,t)),null)}}_computeViewshedExtent(e,t){const{farDistance:r,heading:n,tilt:s,horizontalFieldOfView:i,verticalFieldOfView:p}=e,{spatialReference:c}=t,u=i/2,m=p/2,h=r/c.metersPerUnit,f=[Cyclical.ie.normalize(n-u),n,Cyclical.ie.normalize(n+u)],x=Extent.default.fromPoint(t),y=e=>{const t=f.map((t=>Cyclical.ie.normalize(t-e)));if(t[0]>t[2]||360===i)return h;const r=t.map((e=>Math.abs(e>180?360-e:e))).reduce(((e,t)=>e>t?t:e));return r>90?0:h*Math.cos((0,mathUtils.kU)(r))};x.xmax+=y(90),x.xmin-=y(-90),x.ymax+=y(0),x.ymin-=y(180);const w=t.z;if(null!=w){let e=w,t=w;const n=s-90,i=(0,mathUtils.qE)(n+m,-90,90),o=(0,mathUtils.qE)(n-m,-90,90),l=c?.isGeographic?r:h;e+=l*g(i),t+=l*g(o);const p=v(m)*l,d=g(n)*p*(1-v(u));s<90&&(e-=d),s>90&&(t-=d),x.zmax=Math.max(e,w),x.zmin=Math.min(t,w)}return x}clear(){this.viewsheds.removeAll()}};function v(e){return Math.cos((0,mathUtils.kU)(e))}function g(e){return Math.sin((0,mathUtils.kU)(e))}(0,tslib_es6._)([(0,property.MZ)({type:["viewshed"]})],x.prototype,"type",void 0),(0,tslib_es6._)([(0,property.MZ)({cast:collectionUtils.H,type:f,nonNullable:!0})],x.prototype,"viewsheds",null),(0,tslib_es6._)([(0,property.MZ)({readOnly:!0})],x.prototype,"spatialReference",null),(0,tslib_es6._)([(0,property.MZ)()],x.prototype,"_extent",void 0),(0,tslib_es6._)([(0,property.MZ)({readOnly:!0})],x.prototype,"extent",null),(0,tslib_es6._)([(0,property.MZ)({readOnly:!0})],x.prototype,"requiredPropertiesForEditing",null),x=(0,tslib_es6._)([(0,subclass.$)("esri.analysis.ViewshedAnalysis")],x);const w=x;var MultiOriginJSONSupport=__webpack_require__("./node_modules/@arcgis/core/core/MultiOriginJSONSupport.js"),writer=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/writer.js"),Layer=__webpack_require__("./node_modules/@arcgis/core/layers/Layer.js"),OperationalLayer=__webpack_require__("./node_modules/@arcgis/core/layers/mixins/OperationalLayer.js");let ViewshedLayer_y=class extends((0,OperationalLayer.q)((0,MultiOriginJSONSupport.P)(Layer.A))){constructor(e){super(e),this.type="viewshed",this.operationalLayerType="ViewshedLayer",this.source=new w,this.opacity=1}initialize(){this.addHandles((0,reactiveUtils.watch)((()=>this.source),((e,r)=>{null!=r&&r.parent===this&&(r.parent=null),null!=e&&(e.parent=this)}),reactiveUtils.pc))}async load(){return this.addResolvingPromise(this.source.waitComputeExtent()),this}get spatialReference(){return this.source.spatialReference}get fullExtent(){return this.source.extent}releaseAnalysis(e){this.source===e&&(this.source=new w)}get analysis(){return this.source}set analysis(e){this.source=e}get viewsheds(){return this.source.viewsheds}set viewsheds(e){this.source.viewsheds=e}writeViewsheds(e,r,s,t){r.viewsheds=e.filter((e=>e.isValid())).map((e=>e.toJSON(t))).toJSON()}};(0,tslib_es6._)([(0,property.MZ)({json:{read:!1},readOnly:!0})],ViewshedLayer_y.prototype,"type",void 0),(0,tslib_es6._)([(0,property.MZ)({type:["ViewshedLayer"]})],ViewshedLayer_y.prototype,"operationalLayerType",void 0),(0,tslib_es6._)([(0,property.MZ)({type:w,nonNullable:!0})],ViewshedLayer_y.prototype,"source",void 0),(0,tslib_es6._)([(0,property.MZ)({readOnly:!0})],ViewshedLayer_y.prototype,"spatialReference",null),(0,tslib_es6._)([(0,property.MZ)({readOnly:!0})],ViewshedLayer_y.prototype,"fullExtent",null),(0,tslib_es6._)([(0,property.MZ)({readOnly:!0,json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],ViewshedLayer_y.prototype,"opacity",void 0),(0,tslib_es6._)([(0,property.MZ)({type:["show","hide"]})],ViewshedLayer_y.prototype,"listMode",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Collection.A.ofType(d),json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{ignoreOrigin:!0}}}}})],ViewshedLayer_y.prototype,"viewsheds",null),(0,tslib_es6._)([(0,writer.K)("web-scene","viewsheds")],ViewshedLayer_y.prototype,"writeViewsheds",null),ViewshedLayer_y=(0,tslib_es6._)([(0,subclass.$)("esri.layers.ViewshedLayer")],ViewshedLayer_y);const ViewshedLayer_u=ViewshedLayer_y}}]);