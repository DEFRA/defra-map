"use strict";(self.webpackChunkdefraMap=self.webpackChunkdefraMap||[]).push([[5461],{66981:function(e,t,i){i.d(t,{A:function(){return n}});var s=i(80683),r=i(87847);class n{constructor(){this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null,this.geometryEnginePromise=null}destroy(){this._inFlightResourceMap.clear(),this._resourceMap.clear()}getResource(e){return this._resourceMap.get(e)??null}async fetchResource(e,t){const i=this._resourceMap.get(e);if(i)return{width:i.width,height:i.height};let s=this._inFlightResourceMap.get(e);return s?s.then((e=>({width:e.width,height:e.height}))):(s=(0,r.M5)(e,t),this._inFlightResourceMap.set(e,s),s.then((t=>(this._inFlightResourceMap.delete(e),this._resourceMap.set(e,t),{width:t.width,height:t.height})),(()=>({width:0,height:0}))))}deleteResource(e){this._inFlightResourceMap.delete(e),this._resourceMap.delete(e)}loadFont(e){return(0,s.Al)(e)}}},74185:function(e,t,i){i.r(t),i.d(t,{CIMSymbolRasterizer:function(){return c}});var s=i(66981),r=i(14817),n=i(57176),a=i(67895),h=i(7590);class c{constructor(e){this._spatialReference=e,this._imageDataCanvas=null,this._cimResourceManager=new s.A}get _canvas(){return this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas")),this._imageDataCanvas}get resourceManager(){return this._cimResourceManager}async rasterizeCIMSymbolAsync(e,t,i,s,r,c,l,u,g){if(!e)return null;const{data:d}=e;if(!d||"CIMSymbolReference"!==d.type||!d.symbol)return null;const{symbol:y}=d;c||(c=(0,h.n5)(y));const w=await a.$.resolveSymbolOverrides(d,t,this._spatialReference,r,c,l,u),m=this._cimResourceManager,p=[];n.wp.fetchResources(w,m,p),n.wp.fetchFonts(w,m,p),p.length>0&&await Promise.all(p);const{width:M,height:R}=i,_=o(c,M,R,s),f=n.wp.getEnvelope(w,_,m);if(!f)return null;let b=1,C=0,v=0;switch(y.type){case"CIMPointSymbol":case"CIMTextSymbol":{let e=1;f.width>M&&(e=M/f.width);let t=1;f.height>R&&(t=R/f.height),"preview"===s&&(f.width<M&&(e=M/f.width),f.height<R&&(t=R/f.height)),b=Math.min(e,t),C=f.x+f.width/2,v=f.y+f.height/2}break;case"CIMLineSymbol":{(g||f.height>R)&&(b=R/f.height),v=f.y+f.height/2;const e=f.x*b+M/2,t=(f.x+f.width)*b+M/2,{paths:i}=_;i[0][0][0]-=e/b,i[0][2][0]-=(t-M)/b}break;case"CIMPolygonSymbol":{C=f.x+f.width/2,v=f.y+f.height/2;const e=f.x*b+M/2,t=(f.x+f.width)*b+M/2,i=f.y*b+R/2,s=(f.y+f.height)*b+R/2,{rings:r}=_;e<0&&(r[0][0][0]-=e,r[0][3][0]-=e,r[0][4][0]-=e),i<0&&(r[0][0][1]+=i,r[0][1][1]+=i,r[0][4][1]+=i),t>M&&(r[0][1][0]-=t-M,r[0][2][0]-=t-M),s>R&&(r[0][2][1]+=s-R,r[0][3][1]+=s-R)}}const I={type:"cim",data:{type:"CIMSymbolReference",symbol:w}};return this.rasterize(I,M,R,C,v,b,c,1,_)}rasterize(e,t,i,s,n,a,c,l=0,u=null){const{data:g}=e;if(!g||"CIMSymbolReference"!==g.type||!g.symbol)return null;const{symbol:d}=g,y=this._canvas,w=1.3333333333333333*(window.devicePixelRatio||1);y.width=t*w,y.height=i*w,c||(c=(0,h.n5)(d)),u||(u=o(c,t,i,"legend")),y.width+=2*l,y.height+=2*l;const m=y.getContext("2d",{willReadFrequently:!0}),p=r.IT.createIdentity();return p.translate(-s,-n),p.scale(a*w,-a*w),p.translate(t*w/2+l,i*w/2+l),m.clearRect(0,0,y.width,y.height),new r.Rj(m,this._cimResourceManager,p,!0).drawSymbol(d,u),m.getImageData(0,0,y.width,y.height)}}function o(e,t,i,s){const r=-t/2+1,n=t/2-1,a=i/2-1,h=-i/2+1;switch(e){case"esriGeometryPoint":return{x:0,y:0};case"esriGeometryPolyline":return{paths:[[[r,0],[0,0],[n,0]]]};default:return"legend"===s?{rings:[[[r,a],[n,0],[n,h],[r,h],[r,a]]]}:{rings:[[[r,a],[n,a],[n,h],[r,h],[r,a]]]}}}}}]);
//# sourceMappingURL=symbols-cim-CIMSymbolRasterizer.js.map