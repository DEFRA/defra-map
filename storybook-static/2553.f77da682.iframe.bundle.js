"use strict";(self.webpackChunk_defra_flood_map=self.webpackChunk_defra_flood_map||[]).push([[2553],{"./node_modules/@arcgis/core/views/2d/layers/BitmapTileLayerView2D.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Y:()=>r});var tslib_es6=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),subclass=(__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/RandomLCG.js"),__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),aaBoundingRect=__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingRect.js"),mat3f32=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/mat3f32.js"),Bitmap=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/Bitmap.js"),TiledDisplayObject=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/TiledDisplayObject.js");class BitmapTile_r extends TiledDisplayObject.Y{constructor(e,s,r,i,a,n,o=null){super(e,s,r,i,a,n),this.bitmap=new Bitmap.mb(o),this.bitmap.coordScale=[a,n],this.bitmap.once("isReady",(()=>this.ready()))}destroy(){super.destroy(),this.bitmap.destroy()}beforeRender(e){this.bitmap.beforeRender(e),super.beforeRender(e)}afterRender(e){this.bitmap.afterRender(e),super.afterRender(e)}set stencilRef(e){this.bitmap.stencilRef=e}get stencilRef(){return this.bitmap.stencilRef}_createTransforms(){return{displayViewScreenMat3:(0,mat3f32.vt)(),tileMat3:(0,mat3f32.vt)()}}setTransform(e){super.setTransform(e),this.bitmap.transforms.displayViewScreenMat3=this.transforms.displayViewScreenMat3}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap&&(this.bitmap.stage=null)}}var enums=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/enums.js"),TileContainer=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/TileContainer.js"),BitmapTechnique=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/bitmap/BitmapTechnique.js");class BitmapTileContainer_s extends TileContainer.A{constructor(){super(...arguments),this._bitmapTechnique=null}get requiresDedicatedFBO(){return this.children.some((e=>"additive"===e.bitmap.blendFunction))}createTile(t){const n=this.tileInfoView.getTileBounds((0,aaBoundingRect.vt)(),t),r=this.tileInfoView.getTileResolution(t.level),[s,o]=this.tileInfoView.tileInfo.size;return new BitmapTile_r(t,r,n[0],n[3],s,o)}onAttach(){super.onAttach(),this._bitmapTechnique=new BitmapTechnique.C}onDetach(){super.onDetach(),this._bitmapTechnique?.shutdown(),this._bitmapTechnique=null}renderChildren(e){if(super.renderChildren(e),!this.visible||e.drawPhase!==enums.S5.MAP||null==this._bitmapTechnique)return;const i=this.children.map((e=>e.bitmap));this._bitmapTechnique.render(e,{bitmaps:i})}}const r=r=>{let s=class extends r{attach(){this.view.timeline.record(`${this.layer.title} (BitmapTileLayer) Attach`),this._bitmapView=new BitmapTileContainer_s(this._tileInfoView),this.container.addChild(this._bitmapView)}detach(){this.container.removeChild(this._bitmapView),this._bitmapView?.removeAllChildren(),this._bitmapView=null}};return s=(0,tslib_es6._)([(0,subclass.$)("esri.views.2d.layers.BitmapTileLayerView2D")],s),s}},"./node_modules/@arcgis/core/views/2d/layers/TileLayerView2D.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>H});var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_core_handleUtils_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/handleUtils.js"),_core_Logger_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_7__=(__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/RandomLCG.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),_geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/spatialReferenceUtils.js"),_support_GraphicsCollection_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/support/GraphicsCollection.js"),_graphics_GraphicsView2D_js__WEBPACK_IMPORTED_MODULE_112__=(__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),__webpack_require__("./node_modules/@arcgis/core/core/scheduling.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/tracking/Flags.js"),__webpack_require__("./node_modules/@arcgis/core/core/colorUtils.js"),__webpack_require__("./node_modules/@arcgis/core/config.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/defaultCIMValues.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/enums.js"),__webpack_require__("./node_modules/@arcgis/core/core/floatRGBA.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/Extent.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/Geometry.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/Multipoint.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/Point.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/Polygon.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/Polyline.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/definitions.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/animations/instructions.js"),__webpack_require__("./node_modules/@arcgis/core/core/mathUtils.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/Font.js"),__webpack_require__("./node_modules/@arcgis/core/core/ObjectPool.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/support/Axis.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/support/TileClipper.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/effects/EffectAddControlPoints.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/effects/EffectArrow.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/effects/EffectBuffer.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/effects/EffectControlMeasureLine.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/effects/EffectCut.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/effects/EffectDashes.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/effects/EffectDonut.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/effects/EffectJog.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/effects/EffectMove.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/effects/EffectOffset.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/effects/EffectReverse.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/effects/EffectRotate.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/effects/EffectScale.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/effects/EffectWave.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/placements/PlacementAlongLineSameSize.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/placements/PlacementAtExtremities.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/placements/PlacementAtRatioPositions.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/placements/PlacementInsidePolygon.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/placements/PlacementOnLine.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/placements/PlacementOnVertices.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/placements/PlacementPolygonCenter.js"),__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/vec2f32.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/alignmentUtils.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/support/defaults.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/OverrideHelper.js"),__webpack_require__("./node_modules/@arcgis/core/layers/effects/EffectView.js"),__webpack_require__("./node_modules/@arcgis/core/core/Evented.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/transitions/FadeTransition.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/enums.js"),__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/vec4f32.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/enums.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/BackgroundPrograms.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/checkWebGLError.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/DefaultVertexAttributeLayouts.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/AFeatureTile.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/DisplayEntity.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/featureTechniqueUtils.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/number.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/PooledUint32Array.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/TileInfoPrograms.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/Texture.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/vectorTiles/style/StyleDefinition.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/vectorTiles/enums.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/BitBlitPrograms.js"),__webpack_require__("./node_modules/@arcgis/core/request.js"),__webpack_require__("./node_modules/@arcgis/core/core/urlUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/pbf.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/StencilPrograms.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/TechniqueType.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/shaders/BlendShader.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/shaders/OpacityShader.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/HighlightPrograms.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/FramebufferObject.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/meshing/SimpleMesh.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/GLObjectType.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/Profiler.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/TechniqueRegistry.js"),__webpack_require__("./node_modules/@arcgis/core/Color.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/shaders/constants.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/dotDensity/DotDensityMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/fill/ComplexFillMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/fill/ComplexOutlineFillMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/fill/FillMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/fill/GradientFillMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/fill/OutlineFillMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/fill/PatternFillMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/fill/PatternOutlineFillMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/heatmap/HeatmapMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingBox.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/text/TextMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/line/GradientStrokeMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/line/LineMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/line/TexturedLineMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/markers/MarkerMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/arcade/ArcadeDate.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/SpatialReference.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/pieChart/PieChartMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/renderState.js"),__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/glsl.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/testSVGPremultipliedAlpha.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/LabelManager.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/graphics/GraphicsView2D.js")),_support_util_js__WEBPACK_IMPORTED_MODULE_122__=(__webpack_require__("./node_modules/@arcgis/core/core/asyncUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/Collection.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/watch.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/tracking/SimpleTrackingTarget.js"),__webpack_require__("./node_modules/@arcgis/core/chunks/earcut.js"),__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/vec3f32.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/support/normalizeUtilsCommon.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/support/Ellipsoid.js"),__webpack_require__("./node_modules/@arcgis/core/kernel.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/support/util.js")),_BitmapTileLayerView2D_js__WEBPACK_IMPORTED_MODULE_132__=(__webpack_require__("./node_modules/@arcgis/core/views/2d/navigation/MapViewNavigation.js"),__webpack_require__("./node_modules/@arcgis/core/core/support/UpdatingHandles.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/shaders/MagnifierShader.js"),__webpack_require__("./node_modules/@arcgis/core/core/unitUtils.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/ellipsoidUtils.js"),__webpack_require__("./node_modules/@arcgis/core/chunks/pe.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/projection/projectors.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/shaders/GridShader.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/support/geodesicConstants.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/BitmapTileLayerView2D.js")),_LayerView2D_js__WEBPACK_IMPORTED_MODULE_133__=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/LayerView2D.js"),_graphics_HighlightGraphicContainer_js__WEBPACK_IMPORTED_MODULE_134__=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/graphics/HighlightGraphicContainer.js"),_support_imageUtils_js__WEBPACK_IMPORTED_MODULE_145__=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/support/imageUtils.js"),_tiling_TileInfoView_js__WEBPACK_IMPORTED_MODULE_135__=__webpack_require__("./node_modules/@arcgis/core/views/2d/tiling/TileInfoView.js"),_tiling_TileKey_js__WEBPACK_IMPORTED_MODULE_136__=__webpack_require__("./node_modules/@arcgis/core/views/2d/tiling/TileKey.js"),_tiling_TileQueue_js__WEBPACK_IMPORTED_MODULE_137__=__webpack_require__("./node_modules/@arcgis/core/views/2d/tiling/TileQueue.js"),_tiling_TileStrategy_js__WEBPACK_IMPORTED_MODULE_138__=__webpack_require__("./node_modules/@arcgis/core/views/2d/tiling/TileStrategy.js"),_layers_LayerView_js__WEBPACK_IMPORTED_MODULE_139__=__webpack_require__("./node_modules/@arcgis/core/views/layers/LayerView.js"),_layers_RefreshableLayerView_js__WEBPACK_IMPORTED_MODULE_140__=__webpack_require__("./node_modules/@arcgis/core/views/layers/RefreshableLayerView.js"),_layers_support_MapServiceLayerViewHelper_js__WEBPACK_IMPORTED_MODULE_141__=__webpack_require__("./node_modules/@arcgis/core/views/layers/support/MapServiceLayerViewHelper.js"),_support_drapedUtils_js__WEBPACK_IMPORTED_MODULE_142__=__webpack_require__("./node_modules/@arcgis/core/views/support/drapedUtils.js"),_support_HighlightDefaults_js__WEBPACK_IMPORTED_MODULE_143__=__webpack_require__("./node_modules/@arcgis/core/views/support/HighlightDefaults.js"),_support_Scheduler_js__WEBPACK_IMPORTED_MODULE_144__=__webpack_require__("./node_modules/@arcgis/core/views/support/Scheduler.js");const I=[0,0];let C=class extends((0,_layers_RefreshableLayerView_js__WEBPACK_IMPORTED_MODULE_140__.A)((0,_BitmapTileLayerView2D_js__WEBPACK_IMPORTED_MODULE_132__.Y)((0,_LayerView2D_js__WEBPACK_IMPORTED_MODULE_133__.e)(_layers_LayerView_js__WEBPACK_IMPORTED_MODULE_139__.A)))){constructor(){super(...arguments),this._fetchQueue=null,this._highlightGraphics=new _support_GraphicsCollection_js__WEBPACK_IMPORTED_MODULE_9__.Y,this._highlightView=null,this._popupHighlightHelper=null,this._tileStrategy=null,this.layer=null}get resampling(){return!("resampling"in this.layer)||!1!==this.layer.resampling}get tilemapCache(){return"tilemapCache"in this.layer?this.layer.tilemapCache:null}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume(),this._highlightView?.processUpdate(e)}attach(){const e="tileServers"in this.layer?this.layer.tileServers:null,i=this.tilemapCache;if(this._tileInfoView=new _tiling_TileInfoView_js__WEBPACK_IMPORTED_MODULE_135__.A(this.layer.tileInfo,this.layer.fullExtent,i?.effectiveMinLOD,i?.effectiveMaxLOD),this._fetchQueue=new _tiling_TileQueue_js__WEBPACK_IMPORTED_MODULE_137__.A({tileInfoView:this._tileInfoView,concurrency:e&&10*e.length||10,process:(e,i)=>this.fetchTile(e,i),scheduler:this.scheduler,priority:_support_Scheduler_js__WEBPACK_IMPORTED_MODULE_144__.W6.MAPVIEW_FETCH_QUEUE}),this._tileStrategy=new _tiling_TileStrategy_js__WEBPACK_IMPORTED_MODULE_138__.A({cachePolicy:"keep",resampling:this.resampling,acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),tileInfoView:this._tileInfoView}),(0,_layers_support_MapServiceLayerViewHelper_js__WEBPACK_IMPORTED_MODULE_141__.ox)(this,this.layer)){const e=this._highlightView=new _graphics_GraphicsView2D_js__WEBPACK_IMPORTED_MODULE_112__.A({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new _graphics_HighlightGraphicContainer_js__WEBPACK_IMPORTED_MODULE_134__.A(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1});this.container.addChild(this._highlightView.container),this._popupHighlightHelper=new _layers_support_MapServiceLayerViewHelper_js__WEBPACK_IMPORTED_MODULE_141__.Uh({createFetchPopupFeaturesQueryGeometry:(e,i)=>(0,_support_drapedUtils_js__WEBPACK_IMPORTED_MODULE_142__.V)(e,i,this.view),highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:(i,t)=>{e.graphicUpdateHandler({graphic:i,property:t})},layerView:this,updatingHandles:this._updatingHandles})}this.requestUpdate(),this.addAttachHandles(this._updatingHandles.add((()=>this.resampling),(()=>{this.doRefresh()}))),super.attach()}detach(){super.detach(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._popupHighlightHelper?.destroy(),this._highlightView?.destroy(),this._fetchQueue=this._tileStrategy=this._tileInfoView=this._popupHighlightHelper=null}async fetchPopupFeaturesAtLocation(e,i){return this._popupHighlightHelper?this._popupHighlightHelper.fetchPopupFeaturesAtLocation(e,i):[]}highlight(e,t){const s=(0,_support_util_js__WEBPACK_IMPORTED_MODULE_122__.Oq)(e);if(0===s.length)return(0,_core_handleUtils_js__WEBPACK_IMPORTED_MODULE_1__.hA)();const r=t?.name??_support_HighlightDefaults_js__WEBPACK_IMPORTED_MODULE_143__.Tv;return this._addHighlightGraphics(s,r),(0,_core_handleUtils_js__WEBPACK_IMPORTED_MODULE_1__.hA)((()=>!this.destroyed&&this._removeHighlightGraphics(s,r)))}_processHighlight(){const e=this._getHighlights();this._highlightView?.setHighlight(e)}_addHighlightGraphics(e,i){this._highlightGraphics.addMany(e),this._addHighlights(e.map((e=>e.uid)),i)}_removeHighlightGraphics(e,i){this._highlightGraphics.removeMany(e),this._removeHighlights(e.map((e=>e.uid)),i)}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}supportsSpatialReference(e){return(0,_geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_8__.aI)(this.layer.tileInfo?.spatialReference,e)}async doRefresh(){if(this.attached){if(this.suspended)return this._tileStrategy.clear(),void this.requestUpdate();this._fetchQueue.reset(),this._tileStrategy.refresh((e=>this._updatingHandles.addPromise(this._enqueueTileFetch(e))))}}acquireTile(e){const i=this._bitmapView.createTile(e),t=i.bitmap;return[t.x,t.y]=this._tileInfoView.getTileCoords(I,i.key),t.resolution=this._tileInfoView.getTileResolution(i.key),[t.width,t.height]=this._tileInfoView.tileInfo.size,this._updatingHandles.addPromise(this._enqueueTileFetch(i)),this._bitmapView.addChild(i),this.requestUpdate(),i}releaseTile(e){this._fetchQueue.abort(e.key.id),this._bitmapView.removeChild(e),e.once("detach",(()=>e.destroy())),this.requestUpdate()}async fetchTile(e,i={}){return this.tilemapCache?this._fetchTileWithTilemapCache(e,i):this._fetchTileWithoutTilemapCache(e,i)}async _fetchTileWithoutTilemapCache(e,i={}){const{signal:t,resamplingLevel:r=0}=i;try{return await this._fetchImage(e,t)}catch(o){if((0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_3__.zf)(o))throw o;if(!this.resampling)return(0,_support_imageUtils_js__WEBPACK_IMPORTED_MODULE_145__.G)(this._tileInfoView.tileInfo.size);if(r<3){const t=this._tileInfoView.getTileParentId(e.id);if(t){const s=new _tiling_TileKey_js__WEBPACK_IMPORTED_MODULE_136__.A(t),o=await this._fetchTileWithoutTilemapCache(s,{...i,resamplingLevel:r+1});return(0,_support_imageUtils_js__WEBPACK_IMPORTED_MODULE_145__.t)(this._tileInfoView,o,s,e)}}return(0,_support_imageUtils_js__WEBPACK_IMPORTED_MODULE_145__.G)(this._tileInfoView.tileInfo.size)}}async _fetchTileWithTilemapCache(e,i={}){const t=this.tilemapCache,{signal:o,resamplingLevel:l=0}=i,h=new _tiling_TileKey_js__WEBPACK_IMPORTED_MODULE_136__.A(0,0,0,0);let a,n=null;try{if(n=await t.fetchAvailabilityUpsample(e.level,e.row,e.col,h,{signal:o}),!this.resampling&&h.level!==e.level)return await(0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_3__.NO)(i),(0,_support_imageUtils_js__WEBPACK_IMPORTED_MODULE_145__.G)(this._tileInfoView.tileInfo.size);a=await this._fetchImage(h,o)}catch(p){if((0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_3__.zf)(p))throw p;if(this.resampling&&"unknown"===n&&l<3){const t=this._tileInfoView.getTileParentId(e.id);if(t){h.set(t);try{a=await this._fetchTileWithTilemapCache(h,{...i,resamplingLevel:l+1})}catch{}}}}return a?this.resampling?(0,_support_imageUtils_js__WEBPACK_IMPORTED_MODULE_145__.t)(this._tileInfoView,a,h,e):a:(0,_support_imageUtils_js__WEBPACK_IMPORTED_MODULE_145__.G)(this._tileInfoView.tileInfo.size)}async _enqueueTileFetch(e){if(!this._fetchQueue.has(e.key.id)){try{const i=await this._fetchQueue.push(e.key);e.bitmap.source=i,e.bitmap.width=this._tileInfoView.tileInfo.size[0],e.bitmap.height=this._tileInfoView.tileInfo.size[1],e.once("attach",(()=>this.requestUpdate()))}catch(i){(0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_3__.zf)(i)||_core_Logger_js__WEBPACK_IMPORTED_MODULE_2__.A.getLogger(this).error(i)}this.requestUpdate()}}async _fetchImage(e,i){return this.layer.fetchImageBitmapTile(e.level,e.row,e.col,{signal:i})}};(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.MZ)()],C.prototype,"resampling",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.MZ)()],C.prototype,"tilemapCache",null),C=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_7__.$)("esri.views.2d.layers.TileLayerView2D")],C);const H=C},"./node_modules/@arcgis/core/views/2d/layers/support/imageUtils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function n(n,l,r,u){if(r.level===u.level)return l;const i=n.tileInfo.size,a=n.getTileResolution(r.level),c=n.getTileResolution(u.level);let g=n.getLODInfoAt(u.level);const h=g.getXForColumn(u.col),d=g.getYForRow(u.row);g=n.getLODInfoAt(r.level);const f=g.getXForColumn(r.col),s=g.getYForRow(r.row),m=function e(e){return e instanceof HTMLImageElement?e.naturalWidth:e.width}(l)/i[0],v=function t(e){return e instanceof HTMLImageElement?e.naturalHeight:e.height}(l)/i[1],w=Math.round(m*((h-f)/a)),I=Math.round(v*(-(d-s)/a)),M=Math.round(m*i[0]*(c/a)),F=Math.round(v*i[1]*(c/a)),L=o(i);return L.getContext("2d").drawImage(l,w,I,M,F,0,0,i[0],i[1]),L}function o(e){const t=document.createElement("canvas");return[t.width,t.height]=e,t}__webpack_require__.d(__webpack_exports__,{G:()=>o,t:()=>n})}}]);