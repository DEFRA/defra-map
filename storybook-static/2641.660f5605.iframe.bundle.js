"use strict";(self.webpackChunk_defra_flood_map=self.webpackChunk_defra_flood_map||[]).push([[2641,4518],{"./node_modules/@arcgis/core/chunks/FocusAreaColor.glsl.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{F:()=>t,a:()=>u,b:()=>c});var _views_3d_webgl_engine_core_shaderLibrary_ScreenSpacePass_glsl_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl.js"),_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/glsl.js"),_views_3d_webgl_engine_core_shaderModules_IntegerPassUniform_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/IntegerPassUniform.js"),_views_3d_webgl_engine_core_shaderModules_Texture2DPassUniform_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform.js"),_views_webgl_NoParameters_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/views/webgl/NoParameters.js"),_views_webgl_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/views/webgl/ShaderBuilder.js");class t extends _views_webgl_NoParameters_js__WEBPACK_IMPORTED_MODULE_4__.Y{}function c(){const a=new _views_webgl_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_5__.N5;return a.include(_views_3d_webgl_engine_core_shaderLibrary_ScreenSpacePass_glsl_js__WEBPACK_IMPORTED_MODULE_0__.c),a.outputs.add("fragColor","vec4",0),a.fragment.uniforms.add(new _views_3d_webgl_engine_core_shaderModules_Texture2DPassUniform_js__WEBPACK_IMPORTED_MODULE_3__.N("colorTexture",(e=>e.color)),new _views_3d_webgl_engine_core_shaderModules_Texture2DPassUniform_js__WEBPACK_IMPORTED_MODULE_3__.N("focusArea",(e=>e.focusArea)),new _views_3d_webgl_engine_core_shaderModules_IntegerPassUniform_js__WEBPACK_IMPORTED_MODULE_2__.c("focusAreaEffectMode",(e=>e.effect??1))).main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_1__.H`float mask = texture( focusArea, uv, 0.0 ).r;
vec4 color = texture( colorTexture, uv, 0.0 );
vec4 colorDeSaturate = vec4(color.r * 0.25 + color.g * 0.5 + color.b * 0.25);
if (focusAreaEffectMode == 1) {
fragColor = mask > 0.0 ? color : 0.55 * colorDeSaturate + 0.45;
} else {
fragColor = mask > 0.0 ? color : 0.33 * mix(color, colorDeSaturate, 0.);
}`),a}const u=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaColorPassParameters:t,build:c},Symbol.toStringTag,{value:"Module"}))},"./node_modules/@arcgis/core/chunks/FocusAreaMask.glsl.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{F:()=>l,a:()=>f,b:()=>d});var _core_libs_gl_matrix_2_math_mat4_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/math/mat4.js"),_core_libs_gl_matrix_2_factories_mat4f64_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/mat4f64.js"),_core_libs_gl_matrix_2_factories_vec3f64_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/vec3f64.js"),_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/glsl.js"),_views_3d_webgl_engine_core_shaderModules_Matrix4BindUniform_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Matrix4BindUniform.js"),_views_3d_webgl_engine_core_shaderModules_Matrix4DrawUniform_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform.js"),_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/VertexAttribute.js"),_views_webgl_NoParameters_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/views/webgl/NoParameters.js"),_views_webgl_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/views/webgl/ShaderBuilder.js");class l extends _views_webgl_NoParameters_js__WEBPACK_IMPORTED_MODULE_7__.Y{constructor(){super(...arguments),this.origin=_core_libs_gl_matrix_2_factories_vec3f64_js__WEBPACK_IMPORTED_MODULE_2__.uY}}function d(){const r=new _views_webgl_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_8__.N5;return r.attributes.add(_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_6__.r.POSITION,"vec3"),r.outputs.add("fragColor","vec4",0),r.vertex.uniforms.add(new _views_3d_webgl_engine_core_shaderModules_Matrix4BindUniform_js__WEBPACK_IMPORTED_MODULE_4__.F("proj",(e=>e.camera.projectionMatrix)),new _views_3d_webgl_engine_core_shaderModules_Matrix4DrawUniform_js__WEBPACK_IMPORTED_MODULE_5__.S("view",((r,o)=>(0,_core_libs_gl_matrix_2_math_mat4_js__WEBPACK_IMPORTED_MODULE_0__.Tl)(c,o.camera.viewMatrix,r.origin)))).main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_3__.H`gl_Position = proj * view * vec4(position, 1.0);`),r.fragment.main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_3__.H`fragColor = vec4(1., 0., 0., 1.);`),r}const c=(0,_core_libs_gl_matrix_2_factories_mat4f64_js__WEBPACK_IMPORTED_MODULE_1__.vt)(),f=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaMaskDrawParameters:l,build:d},Symbol.toStringTag,{value:"Module"}))},"./node_modules/@arcgis/core/chunks/LineMarker.glsl.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{L:()=>k,b:()=>L});var _views_3d_support_engineContent_marker_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/engineContent/marker.js"),_views_3d_webgl_engine_core_shaderLibrary_Slice_glsl_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_attributes_RibbonVertexPosition_glsl_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_output_OutputHighlight_glsl_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_shading_MarkerSizing_glsl_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/MarkerSizing.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_shading_TerrainDepthTest_glsl_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/TerrainDepthTest.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_util_ColorConversion_glsl_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_util_RgbaFloatEncoding_glsl_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_util_View_glsl_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl.js"),_views_3d_webgl_engine_core_shaderModules_Float2BindUniform_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Float2BindUniform.js"),_views_3d_webgl_engine_core_shaderModules_Float4BindUniform_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Float4BindUniform.js"),_views_3d_webgl_engine_core_shaderModules_Float4PassUniform_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Float4PassUniform.js"),_views_3d_webgl_engine_core_shaderModules_FloatBindUniform_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/FloatBindUniform.js"),_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/glsl.js"),_views_3d_webgl_engine_core_shaderModules_Matrix4BindUniform_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Matrix4BindUniform.js"),_views_3d_webgl_engine_core_shaderModules_Texture2DPassUniform_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform.js"),_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/VertexAttribute.js"),_views_3d_webgl_engine_shaders_LineMarkerTechniqueConfiguration_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration.js"),_views_3d_webgl_engine_shaders_OutputColorHighlightOID_glsl_js__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/shaders/OutputColorHighlightOID.glsl.js"),_views_webgl_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("./node_modules/@arcgis/core/views/webgl/ShaderBuilder.js");function L(L){const k=new _views_webgl_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_19__.N5,{space:M,anchor:C,hasTip:D}=L,O=M===_views_3d_webgl_engine_shaders_LineMarkerTechniqueConfiguration_js__WEBPACK_IMPORTED_MODULE_17__.lM.World;k.include(_views_3d_webgl_engine_core_shaderLibrary_attributes_RibbonVertexPosition_glsl_js__WEBPACK_IMPORTED_MODULE_2__.s,L),k.include(_views_3d_webgl_engine_core_shaderLibrary_shading_MarkerSizing_glsl_js__WEBPACK_IMPORTED_MODULE_4__.r,L),k.include(_views_3d_webgl_engine_core_shaderLibrary_shading_TerrainDepthTest_glsl_js__WEBPACK_IMPORTED_MODULE_5__.Z,L);const{vertex:$,fragment:T}=k;T.include(_views_3d_webgl_engine_core_shaderLibrary_util_RgbaFloatEncoding_glsl_js__WEBPACK_IMPORTED_MODULE_7__.W),(0,_views_3d_webgl_engine_core_shaderLibrary_util_View_glsl_js__WEBPACK_IMPORTED_MODULE_8__.NB)($,L),k.attributes.add(_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_16__.r.POSITION,"vec3"),k.attributes.add(_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_16__.r.PREVPOSITION,"vec3"),k.attributes.add(_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_16__.r.UV0,"vec2"),k.varyings.add("vColor","vec4"),k.varyings.add("vpos","vec3"),k.varyings.add("vUV","vec2"),k.varyings.add("vSize","float"),D&&k.varyings.add("vLineWidth","float"),$.uniforms.add(new _views_3d_webgl_engine_core_shaderModules_Float2BindUniform_js__WEBPACK_IMPORTED_MODULE_9__.E("nearFar",(({camera:e})=>e.nearFar)),new _views_3d_webgl_engine_core_shaderModules_Float4BindUniform_js__WEBPACK_IMPORTED_MODULE_10__.I("viewport",(({camera:e})=>e.fullViewport))),$.code.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_13__.H`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),$.code.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_13__.H`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),O?(k.attributes.add(_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_16__.r.NORMAL,"vec3"),(0,_views_3d_webgl_engine_core_shaderLibrary_util_View_glsl_js__WEBPACK_IMPORTED_MODULE_8__.S7)($),$.constants.add("tiltThreshold","float",.7),$.code.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_13__.H`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):$.code.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_13__.H`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`);const W=O?"vec3":"vec2";return $.code.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_13__.H`
      ${W} normalizedSegment(${W} pos, ${W} prev) {
        ${W} segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${O?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      ${W} displace(${W} pos, ${W} prev, float displacementLen) {
        ${W} segment = normalizedSegment(pos, prev);

        ${W} displacementDirU = perpendicular(segment);
        ${W} displacementDirV = segment;

        ${C===_views_3d_webgl_engine_shaders_LineMarkerTechniqueConfiguration_js__WEBPACK_IMPORTED_MODULE_17__.kJ.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),M===_views_3d_webgl_engine_shaders_LineMarkerTechniqueConfiguration_js__WEBPACK_IMPORTED_MODULE_17__.lM.Screen&&($.uniforms.add(new _views_3d_webgl_engine_core_shaderModules_Matrix4BindUniform_js__WEBPACK_IMPORTED_MODULE_14__.F("inverseProjectionMatrix",(({camera:e})=>e.inverseProjectionMatrix))),$.code.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_13__.H`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),$.code.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_13__.H`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),$.uniforms.add(new _views_3d_webgl_engine_core_shaderModules_FloatBindUniform_js__WEBPACK_IMPORTED_MODULE_12__.U("perScreenPixelRatio",(({camera:e})=>e.perScreenPixelRatio))),$.code.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_13__.H`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${(0,_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_13__.If)(L.hasCap,"if(prev.z > posLeft.z) {\n                vec2 diff = posLeft.xy - posRight.xy;\n                planeOrigin.xy += perpendicular(diff) / 2.0;\n             }")};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),(0,_views_3d_webgl_engine_core_shaderLibrary_util_View_glsl_js__WEBPACK_IMPORTED_MODULE_8__.Nz)($),$.main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_13__.H`
    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      float lineWidth = getLineWidth();
      float screenMarkerSize = getScreenMarkerSize();

      vec4 pos  = view * vec4(position, 1.0);
      vec4 prev = view * vec4(prevPosition, 1.0);
      clip(pos, prev);

      ${O?_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_13__.H`${(0,_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_13__.If)(L.hideOnShortSegments,_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_13__.H`
                if (areWorldMarkersHidden(pos, prev)) {
                  // Project out of clip space
                  gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
                  return;
                }`)}
            pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
            vec4 displacedPosScreen = projectAndScale(pos);`:_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_13__.H`
            vec4 posScreen = projectAndScale(pos);
            vec4 prevScreen = projectAndScale(prev);
            vec4 displacedPosScreen = posScreen;

            displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);
            ${(0,_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_13__.If)(M===_views_3d_webgl_engine_shaders_LineMarkerTechniqueConfiguration_js__WEBPACK_IMPORTED_MODULE_17__.lM.Screen,_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_13__.H`
                vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));

                // We need three points of the ribbon line in camera space to calculate the plane it lies in
                // Note that we approximate the third point, since we have no information about the join around prev
                vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
                vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);

                pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
                displacedPosScreen = projectAndScale(pos);`)}`}
      forwardViewPosDepth(pos.xyz);
      // Convert back into NDC
      displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

      // Convert texture coordinate into [0,1]
      vUV = (uv0 + 1.0) / 2.0;
      ${(0,_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_13__.If)(!O,"vUV *= displacedPosScreen.w;")}
      ${(0,_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_13__.If)(D,"vLineWidth = lineWidth;")}

      vSize = screenMarkerSize;
      vColor = getColor();

      // Use camera space for slicing
      vpos = pos.xyz;

      gl_Position = displacedPosScreen;
    }`),k.fragment.include(_views_3d_webgl_engine_core_shaderLibrary_Slice_glsl_js__WEBPACK_IMPORTED_MODULE_1__.HQ,L),k.include(_views_3d_webgl_engine_shaders_OutputColorHighlightOID_glsl_js__WEBPACK_IMPORTED_MODULE_18__.z,L),T.uniforms.add(new _views_3d_webgl_engine_core_shaderModules_Float4PassUniform_js__WEBPACK_IMPORTED_MODULE_11__.E("intrinsicColor",(e=>e.color)),new _views_3d_webgl_engine_core_shaderModules_Texture2DPassUniform_js__WEBPACK_IMPORTED_MODULE_15__.N("tex",(e=>e.markerTexture))),T.include(_views_3d_webgl_engine_core_shaderLibrary_util_ColorConversion_glsl_js__WEBPACK_IMPORTED_MODULE_6__.a),T.constants.add("texelSize","float",1/_views_3d_support_engineContent_marker_js__WEBPACK_IMPORTED_MODULE_0__.vO),T.code.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_13__.H`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgbaTofloat(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),D&&T.constants.add("relativeMarkerSize","float",_views_3d_support_engineContent_marker_js__WEBPACK_IMPORTED_MODULE_0__.Cz/_views_3d_support_engineContent_marker_js__WEBPACK_IMPORTED_MODULE_0__.vO).constants.add("relativeTipLineWidth","float",_views_3d_support_engineContent_marker_js__WEBPACK_IMPORTED_MODULE_0__.DZ).code.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_13__.H`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${(0,_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_13__.If)(O,"halfTipLineWidth *= fwidth(samplePos.y);")}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `),k.include(_views_3d_webgl_engine_core_shaderLibrary_output_OutputHighlight_glsl_js__WEBPACK_IMPORTED_MODULE_3__.Q,L),T.main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_13__.H`
    discardBySlice(vpos);
    discardByTerrainDepth();

    vec4 finalColor = intrinsicColor * vColor;

    // Cancel out perspective correct interpolation if in screen space or draped
    vec2 samplePos = vUV ${(0,_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_13__.If)(!O,"* gl_FragCoord.w")};
    finalColor.a *= ${D?"max(markerAlpha(samplePos), tipAlpha(samplePos))":"markerAlpha(samplePos)"};
    outputColorHighlightOID(finalColor, vpos);`),k}const k=Object.freeze(Object.defineProperty({__proto__:null,build:L},Symbol.toStringTag,{value:"Module"}))},"./node_modules/@arcgis/core/chunks/NativeLine.glsl.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{N:()=>p,b:()=>u});var _views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/ShaderOutput.js"),_views_3d_webgl_engine_core_shaderLibrary_Slice_glsl_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_Transform_glsl_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_attributes_VertexColor_glsl_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_output_OutputHighlight_glsl_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_util_View_glsl_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl.js"),_views_3d_webgl_engine_core_shaderModules_Float4PassUniform_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Float4PassUniform.js"),_views_3d_webgl_engine_core_shaderModules_FloatPassUniform_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/FloatPassUniform.js"),_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/glsl.js"),_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/VertexAttribute.js"),_views_webgl_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/views/webgl/ShaderBuilder.js"),_webscene_support_AlphaCutoff_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/@arcgis/core/webscene/support/AlphaCutoff.js");function u(u){const p=new _views_webgl_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_10__.N5,{vertex:w,fragment:f}=p;return p.include(_views_3d_webgl_engine_core_shaderLibrary_Transform_glsl_js__WEBPACK_IMPORTED_MODULE_2__.d,u),p.include(_views_3d_webgl_engine_core_shaderLibrary_attributes_VertexColor_glsl_js__WEBPACK_IMPORTED_MODULE_3__.c,u),(0,_views_3d_webgl_engine_core_shaderLibrary_util_View_glsl_js__WEBPACK_IMPORTED_MODULE_5__.NB)(w,u),p.attributes.add(_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_9__.r.POSITION,"vec3"),p.varyings.add("vpos","vec3"),w.main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_8__.H`vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),p.include(_views_3d_webgl_engine_core_shaderLibrary_output_OutputHighlight_glsl_js__WEBPACK_IMPORTED_MODULE_4__.Q,u),p.fragment.include(_views_3d_webgl_engine_core_shaderLibrary_Slice_glsl_js__WEBPACK_IMPORTED_MODULE_1__.HQ,u),f.uniforms.add(new _views_3d_webgl_engine_core_shaderModules_FloatPassUniform_js__WEBPACK_IMPORTED_MODULE_7__.m("alphaCoverage",((e,r)=>Math.min(1,e.width*r.camera.pixelRatio)))),u.hasVertexColors||f.uniforms.add(new _views_3d_webgl_engine_core_shaderModules_Float4PassUniform_js__WEBPACK_IMPORTED_MODULE_6__.E("constantColor",(e=>e.color))),f.main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_8__.H`
    discardBySlice(vpos);

    vec4 color = ${u.hasVertexColors?"vColor":"constantColor"};

    ${u.output===_views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_0__.V.ObjectAndLayerIdColor?"color.a = 1.0;":""}

    if (color.a < ${_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_8__.H.float(_webscene_support_AlphaCutoff_js__WEBPACK_IMPORTED_MODULE_11__.Q)}) {
      discard;
    }

    ${(0,_views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_0__.RN)(u.output)?_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_8__.H`fragColor = applySlice(color, vpos);`:""}
    calculateOcclusionAndOutputHighlight();
  `),p}const p=Object.freeze(Object.defineProperty({__proto__:null,build:u},Symbol.toStringTag,{value:"Module"}))},"./node_modules/@arcgis/core/chunks/Path.glsl.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{P:()=>V,b:()=>F});var _views_3d_webgl_engine_core_shaderLibrary_ForwardLinearDepth_glsl_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/ShaderOutput.js"),_views_3d_webgl_engine_core_shaderLibrary_Slice_glsl_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_Transform_glsl_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_attributes_ObjectAndLayerIdColor_glsl_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_attributes_PathVertexPosition_glsl_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_output_OutputDepth_glsl_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_output_OutputHighlight_glsl_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_shading_EvaluateAmbientOcclusion_glsl_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_shading_EvaluateSceneLighting_glsl_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_shading_MainLighting_glsl_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_shading_Normals_glsl_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_shading_NormalUtils_glsl_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_shading_PhysicallyBasedRenderingParameters_glsl_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_shading_ReadShadowMap_glsl_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_shading_TerrainDepthTest_glsl_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/TerrainDepthTest.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_util_ColorConversion_glsl_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_util_View_glsl_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl.js"),_views_3d_webgl_engine_core_shaderModules_Float3PassUniform_js__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Float3PassUniform.js"),_views_3d_webgl_engine_core_shaderModules_FloatPassUniform_js__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/FloatPassUniform.js"),_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/glsl.js"),_views_3d_webgl_engine_shaders_OutputColorHighlightOID_glsl_js__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/shaders/OutputColorHighlightOID.glsl.js"),_views_webgl_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("./node_modules/@arcgis/core/views/webgl/ShaderBuilder.js");function F(F){const V=new _views_webgl_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_22__.N5,{vertex:_,fragment:x}=V;(0,_views_3d_webgl_engine_core_shaderLibrary_util_View_glsl_js__WEBPACK_IMPORTED_MODULE_17__.NB)(_,F),V.varyings.add("vpos","vec3"),V.include(_views_3d_webgl_engine_core_shaderLibrary_attributes_PathVertexPosition_glsl_js__WEBPACK_IMPORTED_MODULE_5__.H,F);const{output:z,spherical:M,pbrMode:H,receiveShadows:N}=F,k=(0,_views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_1__.RN)(z);switch((k||z===_views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_1__.V.ObjectAndLayerIdColor)&&(V.include(_views_3d_webgl_engine_core_shaderLibrary_Transform_glsl_js__WEBPACK_IMPORTED_MODULE_3__.d,F),V.include(_views_3d_webgl_engine_core_shaderLibrary_shading_ReadShadowMap_glsl_js__WEBPACK_IMPORTED_MODULE_14__.Bz,F),V.include(_views_3d_webgl_engine_core_shaderLibrary_ForwardLinearDepth_glsl_js__WEBPACK_IMPORTED_MODULE_0__.oD,F),V.include(_views_3d_webgl_engine_core_shaderLibrary_attributes_ObjectAndLayerIdColor_glsl_js__WEBPACK_IMPORTED_MODULE_4__.g,F),V.include(_views_3d_webgl_engine_core_shaderLibrary_shading_TerrainDepthTest_glsl_js__WEBPACK_IMPORTED_MODULE_15__.Z,F),V.varyings.add("vnormal","vec3"),V.varyings.add("vcolor","vec4"),_.main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_20__.H`
      vpos = calculateVPos();
      vnormal = normalize(localNormal());
      forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);

      gl_Position = transformPosition(proj, view, vpos);

      ${k?"forwardLinearDepth();":""}
      forwardObjectAndLayerIdColor();

      vcolor = getColor();`)),z){case _views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_1__.V.ColorEmission:case _views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_1__.V.Color:V.include(_views_3d_webgl_engine_core_shaderLibrary_shading_PhysicallyBasedRenderingParameters_glsl_js__WEBPACK_IMPORTED_MODULE_13__._Z,F),V.include(_views_3d_webgl_engine_core_shaderLibrary_shading_EvaluateSceneLighting_glsl_js__WEBPACK_IMPORTED_MODULE_9__.kA,F),V.include(_views_3d_webgl_engine_core_shaderLibrary_shading_EvaluateAmbientOcclusion_glsl_js__WEBPACK_IMPORTED_MODULE_8__.n,F),V.include(_views_3d_webgl_engine_core_shaderLibrary_shading_ReadShadowMap_glsl_js__WEBPACK_IMPORTED_MODULE_14__.Bz,F),V.include(_views_3d_webgl_engine_core_shaderLibrary_shading_Normals_glsl_js__WEBPACK_IMPORTED_MODULE_11__.r,F),V.fragment.include(_views_3d_webgl_engine_core_shaderLibrary_Slice_glsl_js__WEBPACK_IMPORTED_MODULE_2__.HQ,F),V.include(_views_3d_webgl_engine_shaders_OutputColorHighlightOID_glsl_js__WEBPACK_IMPORTED_MODULE_21__.z,F),(0,_views_3d_webgl_engine_core_shaderLibrary_util_View_glsl_js__WEBPACK_IMPORTED_MODULE_17__.yu)(x,F),(0,_views_3d_webgl_engine_core_shaderLibrary_shading_EvaluateSceneLighting_glsl_js__WEBPACK_IMPORTED_MODULE_9__.a8)(x),(0,_views_3d_webgl_engine_core_shaderLibrary_shading_EvaluateSceneLighting_glsl_js__WEBPACK_IMPORTED_MODULE_9__.eU)(x),x.uniforms.add(_.uniforms.get("localOrigin"),new _views_3d_webgl_engine_core_shaderModules_Float3PassUniform_js__WEBPACK_IMPORTED_MODULE_18__.t("ambient",(e=>e.ambient)),new _views_3d_webgl_engine_core_shaderModules_Float3PassUniform_js__WEBPACK_IMPORTED_MODULE_18__.t("diffuse",(e=>e.diffuse)),new _views_3d_webgl_engine_core_shaderModules_Float3PassUniform_js__WEBPACK_IMPORTED_MODULE_18__.t("specular",(e=>e.specular)),new _views_3d_webgl_engine_core_shaderModules_FloatPassUniform_js__WEBPACK_IMPORTED_MODULE_19__.m("opacity",(e=>e.opacity))),x.include(_views_3d_webgl_engine_core_shaderLibrary_util_ColorConversion_glsl_js__WEBPACK_IMPORTED_MODULE_16__.a),(0,_views_3d_webgl_engine_core_shaderLibrary_shading_MainLighting_glsl_js__WEBPACK_IMPORTED_MODULE_10__.O4)(x),x.main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_20__.H`
        discardBySlice(vpos);
        discardByTerrainDepth();

        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        shadingParams.normalView = vnormal;
        vec3 normal = shadingNormal(shadingParams);
        float ssao = evaluateAmbientOcclusionInverse();

        vec3 posWorld = vpos + localOrigin;
        vec3 normalGround = ${M?"normalize(posWorld);":"vec3(0.0, 0.0, 1.0);"}

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        float shadow = ${N?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), readShadowMap(vpos, linearDepth));":M?"lightingGlobalFactor * (1.0 - additionalAmbientScale);":"0.0;"}
        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
        float combinedOpacity = vcolor.a * opacity;
        albedo += 0.25 * specular; // don't completely ignore specular for now

        ${(0,_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_20__.If)(H===_views_3d_webgl_engine_core_shaderLibrary_shading_PhysicallyBasedRenderingParameters_glsl_js__WEBPACK_IMPORTED_MODULE_13__.A9.Schematic,"float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];\n           vec4 emission = getEmissions();")}

        vec3 shadedColor = ${H===_views_3d_webgl_engine_core_shaderLibrary_shading_PhysicallyBasedRenderingParameters_glsl_js__WEBPACK_IMPORTED_MODULE_13__.A9.Schematic?"evaluateSceneLightingPBR(normal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);":"evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);"}
        vec4 finalColor = vec4(shadedColor, combinedOpacity);
        outputColorHighlightOID(finalColor, vpos);`);break;case _views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_1__.V.Depth:V.include(_views_3d_webgl_engine_core_shaderLibrary_Transform_glsl_js__WEBPACK_IMPORTED_MODULE_3__.d,F),_.main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_20__.H`vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);`),V.fragment.include(_views_3d_webgl_engine_core_shaderLibrary_Slice_glsl_js__WEBPACK_IMPORTED_MODULE_2__.HQ,F),x.main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_20__.H`discardBySlice(vpos);`);break;case _views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_1__.V.Shadow:case _views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_1__.V.ShadowHighlight:case _views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_1__.V.ShadowExcludeHighlight:case _views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_1__.V.ViewshedShadow:V.include(_views_3d_webgl_engine_core_shaderLibrary_Transform_glsl_js__WEBPACK_IMPORTED_MODULE_3__.d,F),(0,_views_3d_webgl_engine_core_shaderLibrary_ForwardLinearDepth_glsl_js__WEBPACK_IMPORTED_MODULE_0__.xJ)(V),V.varyings.add("depth","float"),_.main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_20__.H`vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);`),V.fragment.include(_views_3d_webgl_engine_core_shaderLibrary_Slice_glsl_js__WEBPACK_IMPORTED_MODULE_2__.HQ,F),V.include(_views_3d_webgl_engine_core_shaderLibrary_output_OutputDepth_glsl_js__WEBPACK_IMPORTED_MODULE_6__.L,F),x.main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_20__.H`discardBySlice(vpos);
outputDepth(depth);`);break;case _views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_1__.V.ObjectAndLayerIdColor:V.fragment.include(_views_3d_webgl_engine_core_shaderLibrary_Slice_glsl_js__WEBPACK_IMPORTED_MODULE_2__.HQ,F),x.main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_20__.H`discardBySlice(vpos);
outputObjectAndLayerIdColor();`);break;case _views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_1__.V.Normal:V.include(_views_3d_webgl_engine_core_shaderLibrary_Transform_glsl_js__WEBPACK_IMPORTED_MODULE_3__.d,F),V.include(_views_3d_webgl_engine_core_shaderLibrary_shading_NormalUtils_glsl_js__WEBPACK_IMPORTED_MODULE_12__.n,F),(0,_views_3d_webgl_engine_core_shaderLibrary_util_View_glsl_js__WEBPACK_IMPORTED_MODULE_17__.S7)(_),V.varyings.add("vnormal","vec3"),_.main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_20__.H`vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);`),V.fragment.include(_views_3d_webgl_engine_core_shaderLibrary_Slice_glsl_js__WEBPACK_IMPORTED_MODULE_2__.HQ,F),x.main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_20__.H`discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);`);break;case _views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_1__.V.Highlight:V.include(_views_3d_webgl_engine_core_shaderLibrary_Transform_glsl_js__WEBPACK_IMPORTED_MODULE_3__.d,F),V.include(_views_3d_webgl_engine_core_shaderLibrary_shading_NormalUtils_glsl_js__WEBPACK_IMPORTED_MODULE_12__.n,F),V.varyings.add("vnormal","vec3"),_.main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_20__.H`vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);`),V.fragment.include(_views_3d_webgl_engine_core_shaderLibrary_Slice_glsl_js__WEBPACK_IMPORTED_MODULE_2__.HQ,F),V.include(_views_3d_webgl_engine_core_shaderLibrary_output_OutputHighlight_glsl_js__WEBPACK_IMPORTED_MODULE_7__.Q,F),x.main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_20__.H`discardBySlice(vpos);
calculateOcclusionAndOutputHighlight();`)}return V}const V=Object.freeze(Object.defineProperty({__proto__:null,build:F},Symbol.toStringTag,{value:"Module"}))},"./node_modules/@arcgis/core/chunks/Pattern.glsl.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{P:()=>C,b:()=>j});var _views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/ShaderOutput.js"),_views_3d_webgl_engine_core_shaderLibrary_Slice_glsl_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_Transform_glsl_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_attributes_ObjectAndLayerIdColor_glsl_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_attributes_VertexColor_glsl_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_shading_TerrainDepthTest_glsl_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/TerrainDepthTest.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_shading_VisualVariables_glsl_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_util_ColorConversion_glsl_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_util_View_glsl_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl.js"),_views_3d_webgl_engine_core_shaderModules_Float4PassUniform_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Float4PassUniform.js"),_views_3d_webgl_engine_core_shaderModules_FloatBindUniform_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/FloatBindUniform.js"),_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/glsl.js"),_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/VertexAttribute.js"),_views_3d_webgl_engine_materials_PatternStyle_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/materials/PatternStyle.js"),_views_3d_webgl_engine_shaders_OutputColorHighlightOID_glsl_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/shaders/OutputColorHighlightOID.glsl.js"),_views_webgl_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("./node_modules/@arcgis/core/views/webgl/ShaderBuilder.js");const w=.70710678118,b=w,h=.08715574274,y=10,S=1;function j(j){const C=new _views_webgl_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_15__.N5,{vertex:T,fragment:P,attributes:R,varyings:V}=C,D=j.output===_views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_0__.V.Highlight;(0,_views_3d_webgl_engine_core_shaderLibrary_util_View_glsl_js__WEBPACK_IMPORTED_MODULE_8__.NB)(T,j),C.include(_views_3d_webgl_engine_core_shaderLibrary_Transform_glsl_js__WEBPACK_IMPORTED_MODULE_2__.d,j),C.include(_views_3d_webgl_engine_core_shaderLibrary_attributes_VertexColor_glsl_js__WEBPACK_IMPORTED_MODULE_4__.c,j),C.include(_views_3d_webgl_engine_core_shaderLibrary_shading_VisualVariables_glsl_js__WEBPACK_IMPORTED_MODULE_6__.A,j),C.include(_views_3d_webgl_engine_core_shaderLibrary_attributes_ObjectAndLayerIdColor_glsl_js__WEBPACK_IMPORTED_MODULE_3__.g,j),C.fragment.include(_views_3d_webgl_engine_core_shaderLibrary_Slice_glsl_js__WEBPACK_IMPORTED_MODULE_1__.HQ,j),C.include(_views_3d_webgl_engine_shaders_OutputColorHighlightOID_glsl_js__WEBPACK_IMPORTED_MODULE_14__.z,j),C.include(_views_3d_webgl_engine_core_shaderLibrary_shading_TerrainDepthTest_glsl_js__WEBPACK_IMPORTED_MODULE_5__.Z,j),j.draped?T.uniforms.add(new _views_3d_webgl_engine_core_shaderModules_FloatBindUniform_js__WEBPACK_IMPORTED_MODULE_10__.U("worldToScreenRatio",(e=>1/e.screenToPCSRatio))):R.add(_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_12__.r.BOUNDINGRECT,"mat3"),R.add(_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_12__.r.POSITION,"vec3"),R.add(_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_12__.r.UVMAPSPACE,"vec4"),j.vvColor&&R.add(_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_12__.r.COLORFEATUREATTRIBUTE,"float"),j.hasVertexColors||V.add("vColor","vec4"),V.add("vpos","vec3"),V.add("vuv","vec2"),T.uniforms.add(new _views_3d_webgl_engine_core_shaderModules_Float4PassUniform_js__WEBPACK_IMPORTED_MODULE_9__.E("uColor",(e=>e.color)));const O=j.style===_views_3d_webgl_engine_materials_PatternStyle_js__WEBPACK_IMPORTED_MODULE_13__.O.ForwardDiagonal||j.style===_views_3d_webgl_engine_materials_PatternStyle_js__WEBPACK_IMPORTED_MODULE_13__.O.BackwardDiagonal||j.style===_views_3d_webgl_engine_materials_PatternStyle_js__WEBPACK_IMPORTED_MODULE_13__.O.DiagonalCross;return O&&T.code.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_11__.H`
      const mat2 rotate45 = mat2(${_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_11__.H.float(w)}, ${_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_11__.H.float(-.70710678118)},
                                 ${_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_11__.H.float(b)}, ${_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_11__.H.float(w)});
    `),j.draped||((0,_views_3d_webgl_engine_core_shaderLibrary_util_View_glsl_js__WEBPACK_IMPORTED_MODULE_8__.yu)(T,j),T.uniforms.add(new _views_3d_webgl_engine_core_shaderModules_FloatBindUniform_js__WEBPACK_IMPORTED_MODULE_10__.U("worldToScreenPerDistanceRatio",(e=>1/e.camera.perScreenPixelRatio))),T.code.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_11__.H`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),T.code.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_11__.H`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),T.code.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_11__.H`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_11__.H.float(h)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),T.code.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_11__.H`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${O?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${O?" * rotate45":""};

      ${j.draped?"":_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_11__.H`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_11__.H.float(y)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `),T.main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_11__.H`
    vuv = scaledUV();
    vpos = position;
    forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
    forwardNormalizedVertexColor();
    forwardObjectAndLayerIdColor();
    ${j.hasVertexColors?"vColor *= uColor;":j.vvColor?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
    gl_Position = transformPosition(proj, view, vpos);
  `),P.include(_views_3d_webgl_engine_core_shaderLibrary_util_ColorConversion_glsl_js__WEBPACK_IMPORTED_MODULE_7__.a),j.draped&&P.uniforms.add(new _views_3d_webgl_engine_core_shaderModules_FloatBindUniform_js__WEBPACK_IMPORTED_MODULE_10__.U("texelSize",(e=>1/e.camera.pixelRatio))),D||(P.code.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_11__.H`
      const float lineWidth = ${_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_11__.H.float(S)};
      const float spacing = ${_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_11__.H.float(y)};
      const float spacingINV = ${_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_11__.H.float(1/y)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),j.draped||P.code.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_11__.H`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),P.main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_11__.H`
    discardBySlice(vpos);
    discardByTerrainDepth();
    vec4 color = vColor;
    ${D?"":_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_11__.H`color.a *= ${function x(e){function o(o){return e.draped?_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_11__.H`coverage(vuv.${o}, texelSize)`:_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_11__.H`sampleAA(vuv.${o})`}switch(e.style){case _views_3d_webgl_engine_materials_PatternStyle_js__WEBPACK_IMPORTED_MODULE_13__.O.ForwardDiagonal:case _views_3d_webgl_engine_materials_PatternStyle_js__WEBPACK_IMPORTED_MODULE_13__.O.Horizontal:return o("y");case _views_3d_webgl_engine_materials_PatternStyle_js__WEBPACK_IMPORTED_MODULE_13__.O.BackwardDiagonal:case _views_3d_webgl_engine_materials_PatternStyle_js__WEBPACK_IMPORTED_MODULE_13__.O.Vertical:return o("x");case _views_3d_webgl_engine_materials_PatternStyle_js__WEBPACK_IMPORTED_MODULE_13__.O.DiagonalCross:case _views_3d_webgl_engine_materials_PatternStyle_js__WEBPACK_IMPORTED_MODULE_13__.O.Cross:return _views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_11__.H`1.0 - (1.0 - ${o("x")}) * (1.0 - ${o("y")})`;default:return"0.0"}}(j)};`}
    outputColorHighlightOID(color, vpos);
  `),C}const C=Object.freeze(Object.defineProperty({__proto__:null,build:j},Symbol.toStringTag,{value:"Module"}))},"./node_modules/@arcgis/core/chunks/WaterSurface.glsl.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{W:()=>S,b:()=>O});var _views_3d_webgl_engine_core_shaderLibrary_ForwardLinearDepth_glsl_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/ShaderOutput.js"),_views_3d_webgl_engine_core_shaderLibrary_Slice_glsl_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_Transform_glsl_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_attributes_ObjectAndLayerIdColor_glsl_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_output_OutputHighlight_glsl_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_shading_EvaluateAmbientLighting_glsl_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_shading_MainLighting_glsl_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_shading_NormalUtils_glsl_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_shading_PhysicallyBasedRenderingParameters_glsl_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_shading_ReadShadowMap_glsl_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_shading_TerrainDepthTest_glsl_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/TerrainDepthTest.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_shading_Water_glsl_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_shading_WaterDistortion_glsl_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_util_ColorConversion_glsl_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_util_View_glsl_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl.js"),_views_3d_webgl_engine_core_shaderModules_Float4PassUniform_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Float4PassUniform.js"),_views_3d_webgl_engine_core_shaderModules_FloatPassUniform_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/FloatPassUniform.js"),_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/glsl.js"),_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/VertexAttribute.js"),_views_3d_webgl_engine_shaders_OutputColorHighlightOID_glsl_js__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/shaders/OutputColorHighlightOID.glsl.js"),_views_webgl_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("./node_modules/@arcgis/core/views/webgl/ShaderBuilder.js"),_webscene_support_AlphaCutoff_js__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("./node_modules/@arcgis/core/webscene/support/AlphaCutoff.js");function O(O){const S=new _views_webgl_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_21__.N5,{vertex:D,fragment:N}=S,{output:_,draped:F,receiveShadows:M}=O;(0,_views_3d_webgl_engine_core_shaderLibrary_util_View_glsl_js__WEBPACK_IMPORTED_MODULE_15__.NB)(D,O),S.include(_views_3d_webgl_engine_core_shaderLibrary_Transform_glsl_js__WEBPACK_IMPORTED_MODULE_3__.d,O),S.attributes.add(_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_19__.r.POSITION,"vec3"),S.attributes.add(_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_19__.r.UV0,"vec2");const z=new _views_3d_webgl_engine_core_shaderModules_Float4PassUniform_js__WEBPACK_IMPORTED_MODULE_16__.E("waterColor",(e=>e.color));if((0,_views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_1__.RN)(_)&&F)return S.varyings.add("vpos","vec3"),D.uniforms.add(z),D.main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_18__.H`
      if (waterColor.a < ${_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_18__.H.float(_webscene_support_AlphaCutoff_js__WEBPACK_IMPORTED_MODULE_22__.Q)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      vpos = position;
      gl_Position = transformPosition(proj, view, vpos);`),N.uniforms.add(z),N.main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_18__.H`fragColor = waterColor;`),S;switch((0,_views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_1__.RN)(_)&&(S.include(_views_3d_webgl_engine_core_shaderLibrary_shading_NormalUtils_glsl_js__WEBPACK_IMPORTED_MODULE_8__.n,O),S.include(_views_3d_webgl_engine_core_shaderLibrary_ForwardLinearDepth_glsl_js__WEBPACK_IMPORTED_MODULE_0__.oD,O),S.varyings.add("vuv","vec2"),S.varyings.add("vpos","vec3"),S.varyings.add("vnormal","vec3"),S.varyings.add("vtbnMatrix","mat3"),D.uniforms.add(z),D.main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_18__.H`
      if (waterColor.a < ${_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_18__.H.float(_webscene_support_AlphaCutoff_js__WEBPACK_IMPORTED_MODULE_22__.Q)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      vuv = uv0;
      vpos = position;

      vnormal = getLocalUp(vpos, localOrigin);
      vtbnMatrix = getTBNMatrix(vnormal);
      forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);

      gl_Position = transformPosition(proj, view, vpos);
      forwardLinearDepth();`)),S.include(_views_3d_webgl_engine_core_shaderLibrary_shading_TerrainDepthTest_glsl_js__WEBPACK_IMPORTED_MODULE_11__.Z,O),O.output){case _views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_1__.V.Color:case _views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_1__.V.ColorEmission:S.include(_views_3d_webgl_engine_core_shaderLibrary_shading_EvaluateAmbientLighting_glsl_js__WEBPACK_IMPORTED_MODULE_6__.W,{pbrMode:_views_3d_webgl_engine_core_shaderLibrary_shading_PhysicallyBasedRenderingParameters_glsl_js__WEBPACK_IMPORTED_MODULE_9__.A9.Disabled,lightingSphericalHarmonicsOrder:2}),S.include(_views_3d_webgl_engine_core_shaderLibrary_shading_WaterDistortion_glsl_js__WEBPACK_IMPORTED_MODULE_13__.V),S.include(_views_3d_webgl_engine_core_shaderLibrary_shading_ReadShadowMap_glsl_js__WEBPACK_IMPORTED_MODULE_10__.Bz,O),S.include(_views_3d_webgl_engine_core_shaderLibrary_shading_Water_glsl_js__WEBPACK_IMPORTED_MODULE_12__.E,O),S.fragment.include(_views_3d_webgl_engine_core_shaderLibrary_Slice_glsl_js__WEBPACK_IMPORTED_MODULE_2__.HQ,O),S.include(_views_3d_webgl_engine_shaders_OutputColorHighlightOID_glsl_js__WEBPACK_IMPORTED_MODULE_20__.z,O),N.include(_views_3d_webgl_engine_core_shaderLibrary_util_ColorConversion_glsl_js__WEBPACK_IMPORTED_MODULE_14__.a),(0,_views_3d_webgl_engine_core_shaderLibrary_util_View_glsl_js__WEBPACK_IMPORTED_MODULE_15__.yu)(N,O),(0,_views_3d_webgl_engine_core_shaderLibrary_shading_MainLighting_glsl_js__WEBPACK_IMPORTED_MODULE_7__.Gc)(N),(0,_views_3d_webgl_engine_core_shaderLibrary_shading_MainLighting_glsl_js__WEBPACK_IMPORTED_MODULE_7__.O4)(N),N.uniforms.add(z,new _views_3d_webgl_engine_core_shaderModules_FloatPassUniform_js__WEBPACK_IMPORTED_MODULE_17__.m("timeElapsed",(({timeElapsed:e})=>e)),D.uniforms.get("view"),D.uniforms.get("localOrigin")).main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_18__.H`
        discardBySlice(vpos);
        discardByTerrainDepth();
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${M?_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_18__.H`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        outputColorHighlightOID(fragColor, vpos);`);break;case _views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_1__.V.Normal:S.include(_views_3d_webgl_engine_core_shaderLibrary_shading_NormalUtils_glsl_js__WEBPACK_IMPORTED_MODULE_8__.n,O),S.include(_views_3d_webgl_engine_core_shaderLibrary_shading_WaterDistortion_glsl_js__WEBPACK_IMPORTED_MODULE_13__.V,O),S.fragment.include(_views_3d_webgl_engine_core_shaderLibrary_Slice_glsl_js__WEBPACK_IMPORTED_MODULE_2__.HQ,O),S.varyings.add("vpos","vec3"),S.varyings.add("vuv","vec2"),D.uniforms.add(z),D.main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_18__.H`
        if (waterColor.a < ${_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_18__.H.float(_webscene_support_AlphaCutoff_js__WEBPACK_IMPORTED_MODULE_22__.Q)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        gl_Position = transformPosition(proj, view, vpos);`),N.uniforms.add(new _views_3d_webgl_engine_core_shaderModules_FloatPassUniform_js__WEBPACK_IMPORTED_MODULE_17__.m("timeElapsed",(({timeElapsed:e})=>e))).main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_18__.H`discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);`);break;case _views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_1__.V.Highlight:S.include(_views_3d_webgl_engine_core_shaderLibrary_output_OutputHighlight_glsl_js__WEBPACK_IMPORTED_MODULE_5__.Q,O),S.varyings.add("vpos","vec3"),D.uniforms.add(z),D.main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_18__.H`
        if (waterColor.a < ${_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_18__.H.float(_webscene_support_AlphaCutoff_js__WEBPACK_IMPORTED_MODULE_22__.Q)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);`),S.fragment.include(_views_3d_webgl_engine_core_shaderLibrary_Slice_glsl_js__WEBPACK_IMPORTED_MODULE_2__.HQ,O),N.main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_18__.H`discardBySlice(vpos);
calculateOcclusionAndOutputHighlight();`);break;case _views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_1__.V.ObjectAndLayerIdColor:S.include(_views_3d_webgl_engine_core_shaderLibrary_attributes_ObjectAndLayerIdColor_glsl_js__WEBPACK_IMPORTED_MODULE_4__.g,O),S.varyings.add("vpos","vec3"),D.uniforms.add(z),D.main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_18__.H`
        if (waterColor.a < ${_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_18__.H.float(_webscene_support_AlphaCutoff_js__WEBPACK_IMPORTED_MODULE_22__.Q)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();`),S.fragment.include(_views_3d_webgl_engine_core_shaderLibrary_Slice_glsl_js__WEBPACK_IMPORTED_MODULE_2__.HQ,O),N.main.add(_views_3d_webgl_engine_core_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_18__.H`discardBySlice(vpos);
outputObjectAndLayerIdColor();`)}return S}const S=Object.freeze(Object.defineProperty({__proto__:null,build:O},Symbol.toStringTag,{value:"Module"}))},"./node_modules/@arcgis/core/core/imageUtils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{M5:()=>p,eV:()=>c,xR:()=>s});var _request_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/request.js"),_Error_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),_promiseUtils_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),_urlUtils_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/core/urlUtils.js"),_support_base64Utils_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/support/base64Utils.js");let i=null,o=!0;function s(t,e,r){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(o)try{return new ImageData(t,e)}catch(a){o=!1}return m(t,e,r)}function c(t,e,r,a){if(!e||!r)throw new Error("Cannot construct image data without dimensions");if(o)try{return new ImageData(t,e,r)}catch(i){o=!1}const n=m(e,r,a);return n.data.set(t,0),n}function m(t,e,r){return r||(r=function f(){return i||(i=document.createElement("canvas"),i.width=1,i.height=1),i}()),r.getContext("2d").createImageData(t,e)}async function p(t,e){const{arrayBuffer:r,mediaType:a}=await async function d(e,r){const i=(0,_urlUtils_js__WEBPACK_IMPORTED_MODULE_3__.r$)(e);if(i?.isBase64)return{arrayBuffer:(0,_support_base64Utils_js__WEBPACK_IMPORTED_MODULE_4__.M)(i.data),mediaType:i.mediaType};const o=await(0,_request_js__WEBPACK_IMPORTED_MODULE_0__.A)(e,{responseType:"array-buffer",...r});return{arrayBuffer:o.data,mediaType:o.getHeader?.("Content-Type")??""}}(t,e),n="image/png"===a;if("image/gif"===a){const{isAnimatedGIF:t,parseGif:a}=await __webpack_require__.e(4578).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/core/image/gif.js"));if(t(r))return a(r,e)}if(n){const{isAnimatedPNG:t,parseApng:a}=await __webpack_require__.e(1680).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/core/image/apng.js"));if(t(r))return a(r,e)}return async function u(a,n){const i=window.URL.createObjectURL(a);try{const{data:e}=await(0,_request_js__WEBPACK_IMPORTED_MODULE_0__.A)(i,{...n,responseType:"image"});return e}catch(o){if(!(0,_promiseUtils_js__WEBPACK_IMPORTED_MODULE_2__.zf)(o))throw new _Error_js__WEBPACK_IMPORTED_MODULE_1__.A("invalid-image",`Could not fetch requested image at ${i}`);throw o}finally{window.URL.revokeObjectURL(i)}}(new Blob([r],{type:a}),e)}},"./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/mat2df32.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function n(){const n=new Float32Array(6);return n[0]=1,n[3]=1,n}function o(n,t,r,e){const o=t[e],a=t[e+1];n[e]=r[0]*o+r[2]*a+r[4],n[e+1]=r[1]*o+r[3]*a+r[5]}function a(n,t,r,e=0,a=0,c=2){const u=a||t.length/c;for(let l=e;l<u;l++)o(n,t,r,l*c)}__webpack_require__.d(__webpack_exports__,{gb:()=>a,vt:()=>n});Object.freeze(Object.defineProperty({__proto__:null,clone:function t(n){const t=new Float32Array(6);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t},create:n,createView:function e(n,t){return new Float32Array(n,t,6)},fromValues:function r(n,t,r,e,o,a){const c=new Float32Array(6);return c[0]=n,c[1]=t,c[2]=r,c[3]=e,c[4]=o,c[5]=a,c},transform:o,transformMany:a},Symbol.toStringTag,{value:"Module"}))},"./node_modules/@arcgis/core/core/libs/gl-matrix-2/math/mat2d.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$0:()=>M,B8:()=>u,CV:()=>h,D_:()=>a,Tl:()=>i,e$:()=>s,hZ:()=>r,hs:()=>c,kN:()=>f,lw:()=>e});var _common_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/math/common.js");function a(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function r(t,n,a,r,u,o,e){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t[4]=o,t[5]=e,t}function u(t,n){const a=n[0],r=n[1],u=n[2],o=n[3],e=n[4],s=n[5];let c=a*o-r*u;return c?(c=1/c,t[0]=o*c,t[1]=-r*c,t[2]=-u*c,t[3]=a*c,t[4]=(u*s-o*e)*c,t[5]=(r*e-a*s)*c,t):null}function e(t,n,a){const r=n[0],u=n[1],o=n[2],e=n[3],s=n[4],c=n[5],i=a[0],M=a[1],h=a[2],f=a[3],b=a[4],l=a[5];return t[0]=r*i+o*M,t[1]=u*i+e*M,t[2]=r*h+o*f,t[3]=u*h+e*f,t[4]=r*b+o*l+s,t[5]=u*b+e*l+c,t}function s(t,n,a){const r=n[0],u=n[1],o=n[2],e=n[3],s=n[4],c=n[5],i=Math.sin(a),M=Math.cos(a);return t[0]=r*M+o*i,t[1]=u*M+e*i,t[2]=r*-i+o*M,t[3]=u*-i+e*M,t[4]=s,t[5]=c,t}function c(t,n,a){const r=n[0],u=n[1],o=n[2],e=n[3],s=n[4],c=n[5],i=a[0],M=a[1];return t[0]=r*i,t[1]=u*i,t[2]=o*M,t[3]=e*M,t[4]=s,t[5]=c,t}function i(t,n,a){const r=n[0],u=n[1],o=n[2],e=n[3],s=n[4],c=n[5],i=a[0],M=a[1];return t[0]=r,t[1]=u,t[2]=o,t[3]=e,t[4]=r*i+o*M+s,t[5]=u*i+e*M+c,t}function M(t,n){const a=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=a,t[2]=-a,t[3]=r,t[4]=0,t[5]=0,t}function h(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=n[1],t[4]=0,t[5]=0,t}function f(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=n[0],t[5]=n[1],t}function d(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t[3]=n[3]-a[3],t[4]=n[4]-a[4],t[5]=n[5]-a[5],t}const _=e,g=d;Object.freeze(Object.defineProperty({__proto__:null,add:function m(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t[4]=n[4]+a[4],t[5]=n[5]+a[5],t},copy:function n(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t},determinant:function o(t){return t[0]*t[3]-t[1]*t[2]},equals:function S(n,a){const r=n[0],u=n[1],o=n[2],e=n[3],s=n[4],c=n[5],i=a[0],M=a[1],h=a[2],f=a[3],b=a[4],l=a[5],m=(0,_common_js__WEBPACK_IMPORTED_MODULE_0__.FD)();return Math.abs(r-i)<=m*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(u-M)<=m*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(o-h)<=m*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(e-f)<=m*Math.max(1,Math.abs(e),Math.abs(f))&&Math.abs(s-b)<=m*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(c-l)<=m*Math.max(1,Math.abs(c),Math.abs(l))},exactEquals:function y(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]},frob:function l(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)},fromRotation:M,fromScaling:h,fromTranslation:f,identity:a,invert:u,mul:_,multiply:e,multiplyScalar:function p(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t[4]=n[4]*a,t[5]=n[5]*a,t},multiplyScalarAndAdd:function x(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t[3]=n[3]+a[3]*r,t[4]=n[4]+a[4]*r,t[5]=n[5]+a[5]*r,t},rotate:s,scale:c,set:r,str:function b(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},sub:g,subtract:d,translate:i},Symbol.toStringTag,{value:"Module"}))},"./node_modules/@arcgis/core/geometry/support/TileClipper.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{O3:()=>e,Ox:()=>_,bR:()=>h,dC:()=>i});var i,s;!function(t){t[t.Unknown=0]="Unknown",t[t.Point=1]="Point",t[t.LineString=2]="LineString",t[t.Polygon=3]="Polygon"}(i||(i={}));class h{constructor(t,i){this.x=t,this.y=i}clone(){return new h(this.x,this.y)}equals(t,i){return t===this.x&&i===this.y}isEqual(t){return t.x===this.x&&t.y===this.y}setCoords(t,i){return this.x=t,this.y=i,this}normalize(){const t=this.x,i=this.y,s=Math.sqrt(t*t+i*i);return this.x/=s,this.y/=s,this}rightPerpendicular(){const t=this.x;return this.x=this.y,this.y=-t,this}leftPerpendicular(){const t=this.x;return this.x=-this.y,this.y=t,this}move(t,i){return this.x+=t,this.y+=i,this}assign(t){return this.x=t.x,this.y=t.y,this}assignAdd(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this}assignSub(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this}rotate(t,i){const s=this.x,h=this.y;return this.x=s*t-h*i,this.y=s*i+h*t,this}scale(t){return this.x*=t,this.y*=t,this}length(){const t=this.x,i=this.y;return Math.sqrt(t*t+i*i)}sub(t){return this.x-=t.x,this.y-=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}static distance(t,i){const s=i.x-t.x,h=i.y-t.y;return Math.sqrt(s*s+h*h)}static add(t,i){return new h(t.x+i.x,t.y+i.y)}static sub(t,i){return new h(t.x-i.x,t.y-i.y)}}class n{constructor(t,i,s){this.ratio=t,this.x=i,this.y=s}}class e{constructor(i,s,h,n=8,e=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=n,this._pixelMargin=e,this._tileSize=512*n,this._dz=i,this._yPos=s,this._xPos=h}setPixelMargin(t){t!==this._pixelMargin&&(this._pixelMargin=t,this.setExtent(this._extent))}setExtent(t){this._extent=t,this._finalRatio=this._tileSize/t*(1<<this._dz);let i=this._pixelRatio*this._pixelMargin;i/=this._finalRatio;const s=t>>this._dz;i>s&&(i=s),this._margin=i,this._xmin=s*this._xPos-i,this._ymin=s*this._yPos-i,this._xmax=this._xmin+s+2*i,this._ymax=this._ymin+s+2*i}reset(t){this._type=t,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(t,i){this._pushLine(),this._prevIsIn=this._isIn(t,i),this._moveTo(t,i,this._prevIsIn),this._prevPt=new h(t,i),this._firstPt=new h(t,i),this._dist=0}lineTo(t,i){const s=this._isIn(t,i),e=new h(t,i),_=h.distance(this._prevPt,e);let x,l,y,a,r,o,u,m;if(s)this._prevIsIn?this._lineTo(t,i,!0):(x=this._prevPt,l=e,y=this._intersect(l,x),this._start=this._dist+_*(1-this._r),this._lineTo(y.x,y.y,!0),this._lineTo(l.x,l.y,!0));else if(this._prevIsIn)l=this._prevPt,x=e,y=this._intersect(l,x),this._lineTo(y.x,y.y,!0),this._lineTo(x.x,x.y,!1);else{const t=this._prevPt,i=e;if(t.x<=this._xmin&&i.x<=this._xmin||t.x>=this._xmax&&i.x>=this._xmax||t.y<=this._ymin&&i.y<=this._ymin||t.y>=this._ymax&&i.y>=this._ymax)this._lineTo(i.x,i.y,!1);else{const s=[];if((t.x<this._xmin&&i.x>this._xmin||t.x>this._xmin&&i.x<this._xmin)&&(a=(this._xmin-t.x)/(i.x-t.x),m=t.y+a*(i.y-t.y),m<=this._ymin?o=!1:m>=this._ymax?o=!0:s.push(new n(a,this._xmin,m))),(t.x<this._xmax&&i.x>this._xmax||t.x>this._xmax&&i.x<this._xmax)&&(a=(this._xmax-t.x)/(i.x-t.x),m=t.y+a*(i.y-t.y),m<=this._ymin?o=!1:m>=this._ymax?o=!0:s.push(new n(a,this._xmax,m))),(t.y<this._ymin&&i.y>this._ymin||t.y>this._ymin&&i.y<this._ymin)&&(a=(this._ymin-t.y)/(i.y-t.y),u=t.x+a*(i.x-t.x),u<=this._xmin?r=!1:u>=this._xmax?r=!0:s.push(new n(a,u,this._ymin))),(t.y<this._ymax&&i.y>this._ymax||t.y>this._ymax&&i.y<this._ymax)&&(a=(this._ymax-t.y)/(i.y-t.y),u=t.x+a*(i.x-t.x),u<=this._xmin?r=!1:u>=this._xmax?r=!0:s.push(new n(a,u,this._ymax))),0===s.length)r?o?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):o?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(s.length>1&&s[0].ratio>s[1].ratio)this._start=this._dist+_*s[1].ratio,this._lineTo(s[1].x,s[1].y,!0),this._lineTo(s[0].x,s[0].y,!0);else{this._start=this._dist+_*s[0].ratio;for(let t=0;t<s.length;t++)this._lineTo(s[t].x,s[t].y,!0)}this._lineTo(i.x,i.y,!1)}}this._dist+=_,this._prevIsIn=s,this._prevPt=e}close(){if(this._line.length>2){const t=this._firstPt,i=this._prevPt;t.x===i.x&&t.y===i.y||this.lineTo(t.x,t.y);const s=this._line;let h=s.length;for(;h>=4&&(s[0].x===s[1].x&&s[0].x===s[h-2].x||s[0].y===s[1].y&&s[0].y===s[h-2].y);)s.pop(),s[0].x=s[h-2].x,s[0].y=s[h-2].y,--h}}result(t=!0){return this._pushLine(),0===this._lines.length?null:(this._type===i.Polygon&&t&&x.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(this._type!==i.LineString)throw new Error("Only valid for lines");this._pushLine();const t=this._lines,s=t.length;if(0===s)return null;const h=[];for(let i=0;i<s;i++)h.push({line:t[i],start:this._starts[i]||0});return h}_isIn(t,i){return t>=this._xmin&&t<=this._xmax&&i>=this._ymin&&i<=this._ymax}_intersect(t,i){let s,n,e;if(i.x>=this._xmin&&i.x<=this._xmax)n=i.y<=this._ymin?this._ymin:this._ymax,e=(n-t.y)/(i.y-t.y),s=t.x+e*(i.x-t.x);else if(i.y>=this._ymin&&i.y<=this._ymax)s=i.x<=this._xmin?this._xmin:this._xmax,e=(s-t.x)/(i.x-t.x),n=t.y+e*(i.y-t.y);else{n=i.y<=this._ymin?this._ymin:this._ymax,s=i.x<=this._xmin?this._xmin:this._xmax;const h=(s-t.x)/(i.x-t.x),_=(n-t.y)/(i.y-t.y);h<_?(e=h,n=t.y+h*(i.y-t.y)):(e=_,s=t.x+_*(i.x-t.x))}return this._r=e,new h(s,n)}_pushLine(){this._line&&(this._type===i.Point?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===i.LineString?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===i.Polygon&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(t,s,n){this._type!==i.Polygon?n&&(t=Math.round((t-(this._xmin+this._margin))*this._finalRatio),s=Math.round((s-(this._ymin+this._margin))*this._finalRatio),this._line.push(new h(t,s))):(n||(t<this._xmin&&(t=this._xmin),t>this._xmax&&(t=this._xmax),s<this._ymin&&(s=this._ymin),s>this._ymax&&(s=this._ymax)),t=Math.round((t-(this._xmin+this._margin))*this._finalRatio),s=Math.round((s-(this._ymin+this._margin))*this._finalRatio),this._line.push(new h(t,s)),this._isH=!1,this._isV=!1)}_lineTo(t,s,n){let e,_;if(this._type!==i.Polygon)if(n){if(t=Math.round((t-(this._xmin+this._margin))*this._finalRatio),s=Math.round((s-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(e=this._line[this._line.length-1],e.equals(t,s)))return;this._line.push(new h(t,s))}else this._line&&this._line.length>0&&this._pushLine();else if(n||(t<this._xmin&&(t=this._xmin),t>this._xmax&&(t=this._xmax),s<this._ymin&&(s=this._ymin),s>this._ymax&&(s=this._ymax)),t=Math.round((t-(this._xmin+this._margin))*this._finalRatio),s=Math.round((s-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){e=this._line[this._line.length-1];const i=e.x===t,n=e.y===s;if(i&&n)return;this._isH&&i||this._isV&&n?(e.x=t,e.y=s,_=this._line[this._line.length-2],_.x===t&&_.y===s?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(_=this._line[this._line.length-2],this._isH=_.x===t,this._isV=_.y===s)):(this._isH=_.x===t,this._isV=_.y===s)):(this._line.push(new h(t,s)),this._isH=i,this._isV=n)}else this._line.push(new h(t,s))}}class _{setExtent(t){this._ratio=4096===t?1:4096/t}get validateTessellation(){return this._ratio<1}reset(t){this._lines=[],this._line=null}moveTo(t,i){this._line&&this._lines.push(this._line),this._line=[];const s=this._ratio;this._line.push(new h(t*s,i*s))}lineTo(t,i){const s=this._ratio;this._line.push(new h(t*s,i*s))}close(){const t=this._line;t&&!t[0].isEqual(t[t.length-1])&&t.push(t[0])}result(){return this._line&&this._lines.push(this._line),0===this._lines.length?null:this._lines}}!function(t){t[t.sideLeft=0]="sideLeft",t[t.sideRight=1]="sideRight",t[t.sideTop=2]="sideTop",t[t.sideBottom=3]="sideBottom"}(s||(s={}));class x{static simplify(t,i,h){if(!h)return;const n=-i,e=t+i,_=-i,l=t+i,y=[],a=[],r=h.length;for(let x=0;x<r;++x){const t=h[x];if(!t||t.length<2)continue;let i,r=t[0];const o=t.length;for(let h=1;h<o;++h)i=t[h],r.x===i.x&&(r.x<=n&&(r.y>i.y?(y.push(x),y.push(h),y.push(s.sideLeft),y.push(-1)):(a.push(x),a.push(h),a.push(s.sideLeft),a.push(-1))),r.x>=e&&(r.y<i.y?(y.push(x),y.push(h),y.push(s.sideRight),y.push(-1)):(a.push(x),a.push(h),a.push(s.sideRight),a.push(-1)))),r.y===i.y&&(r.y<=_&&(r.x<i.x?(y.push(x),y.push(h),y.push(s.sideTop),y.push(-1)):(a.push(x),a.push(h),a.push(s.sideTop),a.push(-1))),r.y>=l&&(r.x>i.x?(y.push(x),y.push(h),y.push(s.sideBottom),y.push(-1)):(a.push(x),a.push(h),a.push(s.sideBottom),a.push(-1)))),r=i}if(0===y.length||0===a.length)return;x.fillParent(h,a,y),x.fillParent(h,y,a);const o=[];x.calcDeltas(o,a,y),x.calcDeltas(o,y,a),x.addDeltas(o,h)}static fillParent(t,i,h){const n=h.length,e=i.length;for(let _=0;_<e;_+=4){const e=i[_],x=i[_+1],y=i[_+2],a=t[e][x-1],r=t[e][x];let o=8092,u=-1;for(let i=0;i<n;i+=4){if(h[i+2]!==y)continue;const n=h[i],e=h[i+1],_=t[n][e-1],x=t[n][e];switch(y){case s.sideLeft:case s.sideRight:if(l(a.y,_.y,x.y)&&l(r.y,_.y,x.y)){const t=Math.abs(x.y-_.y);t<o&&(o=t,u=i)}break;case s.sideTop:case s.sideBottom:if(l(a.x,_.x,x.x)&&l(r.x,_.x,x.x)){const t=Math.abs(x.x-_.x);t<o&&(o=t,u=i)}}}i[_+3]=u}}static calcDeltas(t,i,s){const h=i.length;for(let n=0;n<h;n+=4){const h=[],e=x.calcDelta(n,i,s,h);t.push(i[n]),t.push(i[n+1]),t.push(i[n+2]),t.push(e)}}static calcDelta(t,i,s,h){const n=i[t+3];if(-1===n)return 0;const e=h.length;return e>1&&h[e-2]===n?0:(h.push(n),x.calcDelta(n,s,i,h)+1)}static addDeltas(t,i){const h=t.length;let n=0;for(let s=0;s<h;s+=4){const i=t[s+3];i>n&&(n=i)}for(let e=0;e<h;e+=4){const h=i[t[e]],_=t[e+1],x=n-t[e+3];switch(t[e+2]){case s.sideLeft:h[_-1].x-=x,h[_].x-=x,1===_&&(h[h.length-1].x-=x),_===h.length-1&&(h[0].x-=x);break;case s.sideRight:h[_-1].x+=x,h[_].x+=x,1===_&&(h[h.length-1].x+=x),_===h.length-1&&(h[0].x+=x);break;case s.sideTop:h[_-1].y-=x,h[_].y-=x,1===_&&(h[h.length-1].y-=x),_===h.length-1&&(h[0].y-=x);break;case s.sideBottom:h[_-1].y+=x,h[_].y+=x,1===_&&(h[h.length-1].y+=x),_===h.length-1&&(h[0].y+=x)}}}}const l=(t,i,s)=>t>=i&&t<=s||t>=s&&t<=i},"./node_modules/@arcgis/core/geometry/support/axisAngleDegrees.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$I:()=>z,AU:()=>d,Cr:()=>v,g7:()=>y,i4:()=>q,ui:()=>k,up:()=>B,vt:()=>j,yo:()=>w});var _core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/mathUtils.js"),_core_libs_gl_matrix_2_math_mat4_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/math/mat4.js"),_core_libs_gl_matrix_2_math_quat_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/math/quat.js"),_core_libs_gl_matrix_2_factories_quatf64_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/quatf64.js"),_chunks_vec32_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec32.js"),_core_libs_gl_matrix_2_factories_vec3f64_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/vec3f64.js");function j(r=B){return[r[0],r[1],r[2],r[3]]}function q(r,t,n=j()){return(0,_chunks_vec32_js__WEBPACK_IMPORTED_MODULE_4__.c)(n,r),n[3]=t,n}function v(r,t,n){return(0,_chunks_vec32_js__WEBPACK_IMPORTED_MODULE_4__.e)(n,r,t),(0,_chunks_vec32_js__WEBPACK_IMPORTED_MODULE_4__.n)(n,n),n[3]=-(0,_chunks_vec32_js__WEBPACK_IMPORTED_MODULE_4__.r)(r,t),n}function k(t,i=j()){const u=(0,_core_libs_gl_matrix_2_math_mat4_js__WEBPACK_IMPORTED_MODULE_1__.l)(C,t);return A(i,(0,_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__.KJ)((0,_core_libs_gl_matrix_2_math_quat_js__WEBPACK_IMPORTED_MODULE_2__.Xd)(i,u))),i}function U(t,n,c=j()){return(0,_core_libs_gl_matrix_2_math_quat_js__WEBPACK_IMPORTED_MODULE_2__.x8)(C,t,z(t)),(0,_core_libs_gl_matrix_2_math_quat_js__WEBPACK_IMPORTED_MODULE_2__.x8)(D,n,z(n)),(0,_core_libs_gl_matrix_2_math_quat_js__WEBPACK_IMPORTED_MODULE_2__.lw)(C,D,C),A(c,(0,_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__.KJ)((0,_core_libs_gl_matrix_2_math_quat_js__WEBPACK_IMPORTED_MODULE_2__.Xd)(c,C)))}function d(r,t,n,o=j()){return q(_core_libs_gl_matrix_2_factories_vec3f64_js__WEBPACK_IMPORTED_MODULE_5__.Cw,r,F),q(_core_libs_gl_matrix_2_factories_vec3f64_js__WEBPACK_IMPORTED_MODULE_5__.JP,t,G),q(_core_libs_gl_matrix_2_factories_vec3f64_js__WEBPACK_IMPORTED_MODULE_5__.Cb,n,H),U(F,G,F),U(F,H,o),o}function w(r){return r}function y(r){return r[3]}function z(r){return(0,_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__.kU)(r[3])}function A(r,t){return r[3]=t,r}const B=[0,0,1,0],C=(0,_core_libs_gl_matrix_2_factories_quatf64_js__WEBPACK_IMPORTED_MODULE_3__.vt)(),D=(0,_core_libs_gl_matrix_2_factories_quatf64_js__WEBPACK_IMPORTED_MODULE_3__.vt)(),F=(j(),j()),G=j(),H=j()},"./node_modules/@arcgis/core/geometry/support/meshUtils/projectMeshVertexPositions.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{projectMeshVertexPositions:()=>n});var _projection_projectBuffer_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/geometry/projection/projectBuffer.js"),_MeshGeoreferencedVertexSpace_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/MeshGeoreferencedVertexSpace.js"),_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/spatialReferenceUtils.js"),_vertexSpaceConversion_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/meshUtils/vertexSpaceConversion.js");function n(n,i){const p=(0,_vertexSpaceConversion_js__WEBPACK_IMPORTED_MODULE_3__.UR)(n,_MeshGeoreferencedVertexSpace_js__WEBPACK_IMPORTED_MODULE_1__.A.absolute);if(!p)return null;let s=p.position;return(0,_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_2__.aI)(n.spatialReference,i)||(s=new Float64Array(p.position.length),(0,_projection_projectBuffer_js__WEBPACK_IMPORTED_MODULE_0__.projectBuffer)(p.position,n.spatialReference,0,s,i,0))?s:null}},"./node_modules/@arcgis/core/layers/graphics/data/SnappingCandidate.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function t(t,e,r){return{objectId:t,target:e,distance:r,type:"vertex"}}function e(t,e,r,n,d,a=!1){return{objectId:t,target:e,distance:r,type:"edge",start:n,end:d,draped:a}}__webpack_require__.d(__webpack_exports__,{P:()=>e,k:()=>t})},"./node_modules/@arcgis/core/symbols/support/cimSymbolUtils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Fe:()=>I,Km:()=>l,Nk:()=>C});var _Color_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/Color.js"),_cim_utils_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/symbols/cim/utils.js");function l(e,t,o,r){if(e)if("CIMTextSymbol"!==e.type){if(o&&e.effects)for(const o of e.effects)y(o,t);if(e.symbolLayers)for(const o of e.symbolLayers){switch(o.type){case"CIMPictureMarker":case"CIMVectorMarker":m(o,t,r);break;case"CIMPictureStroke":case"CIMSolidStroke":case"CIMGradientStroke":!r?.preserveOutlineWidth&&o.width&&(o.width*=t);break;case"CIMPictureFill":o.height&&(o.height*=t),o.offsetX&&(o.offsetX*=t),o.offsetY&&(o.offsetY*=t);break;case"CIMHatchFill":l(o.lineSymbol,t,!0,{...r,preserveOutlineWidth:!1}),o.offsetX&&(o.offsetX*=t),o.offsetY&&(o.offsetY*=t),o.separation&&(o.separation*=t)}if(o.effects)for(const e of o.effects)y(e,t)}}else null!=e.height&&(e.height*=t)}function m(e,t,o){if(e&&(e.markerPlacement&&function M(e,t){switch((0,_cim_utils_js__WEBPACK_IMPORTED_MODULE_1__.zr)(e)&&e.offset&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.placementTemplate&&e.placementTemplate.length){const o=e.placementTemplate.map((e=>e*t));e.placementTemplate=o}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset&&(e.maxRandomOffset*=t),e.placementTemplate&&e.placementTemplate.length){const o=e.placementTemplate.map((e=>e*t));e.placementTemplate=o}break;case"CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=t);break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=t);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=t),e.endPosition&&(e.endPosition*=t);break;case"CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.stepX&&(e.stepX*=t),e.stepY&&(e.stepY*=t)}}(e.markerPlacement,t),e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.anchorPoint&&"Absolute"===e.anchorPointUnits&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size=null!=e.size?e.size*t:0,"CIMVectorMarker"===e.type&&e.markerGraphics))for(const r of e.markerGraphics)e.scaleSymbolsProportionally||l(r.symbol,t,!0,o)}function y(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width&&(e.width*=t);break;case"CIMGeometricEffectBuffer":e.size&&(e.size*=t);break;case"CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=t),e.endCut&&(e.endCut*=t),e.middleCut&&(e.middleCut*=t);break;case"CIMGeometricEffectDashes":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.dashTemplate&&e.dashTemplate.length){const o=e.dashTemplate.map((e=>e*t));e.dashTemplate=o}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length&&(e.length*=t);break;case"CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=t);break;case"CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=t);break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=t),e.length&&(e.length*=t),e.toWidth&&(e.toWidth*=t);break;case"CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=t),e.period&&(e.period*=t)}}function C(o){const r=[];return u((0,_cim_utils_js__WEBPACK_IMPORTED_MODULE_1__.lW)(o),r),r.length?new _Color_js__WEBPACK_IMPORTED_MODULE_0__.A((0,_cim_utils_js__WEBPACK_IMPORTED_MODULE_1__.e6)(r[0])):null}function u(e,t){if(!e)return;let s;s="CIMTextSymbol"===e.type?e.symbol:e;const a="CIMPolygonSymbol"===e.type;if(s?.symbolLayers)for(const i of s.symbolLayers)if(!(i.colorLocked||a&&((0,_cim_utils_js__WEBPACK_IMPORTED_MODULE_1__.mA)(i)||(0,_cim_utils_js__WEBPACK_IMPORTED_MODULE_1__.MM)(i)&&i.markerPlacement&&(0,_cim_utils_js__WEBPACK_IMPORTED_MODULE_1__.zr)(i.markerPlacement))))switch(i.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":i.tintColor&&b(t,i.tintColor);break;case"CIMVectorMarker":i.markerGraphics?.forEach((e=>{u(e.symbol,t)}));break;case"CIMSolidStroke":case"CIMSolidFill":b(t,i.color);break;case"CIMHatchFill":u(i.lineSymbol,t)}}function b(e,t){for(const o of e)if(o.join(".")===t.join("."))return;e.push(t)}function I(o,r,s){r instanceof _Color_js__WEBPACK_IMPORTED_MODULE_0__.A||(r=new _Color_js__WEBPACK_IMPORTED_MODULE_0__.A(r));const n=(0,_cim_utils_js__WEBPACK_IMPORTED_MODULE_1__.lW)(o);n&&k(n,r,s)}function k(e,t,a){if(!e)return;let i;i="CIMTextSymbol"===e.type?e.symbol:e;const c="CIMPolygonSymbol"===i?.type;if(i?.symbolLayers)for(const f of i.symbolLayers){if(f.colorLocked)continue;if(c)if(a){const{layersToColor:e}=a;if(((0,_cim_utils_js__WEBPACK_IMPORTED_MODULE_1__.mA)(f)||(0,_cim_utils_js__WEBPACK_IMPORTED_MODULE_1__.MM)(f)&&f.markerPlacement&&(0,_cim_utils_js__WEBPACK_IMPORTED_MODULE_1__.zr)(f.markerPlacement))&&"fill"===e||(0,_cim_utils_js__WEBPACK_IMPORTED_MODULE_1__.jn)(f)&&"outline"===e)continue}else if((0,_cim_utils_js__WEBPACK_IMPORTED_MODULE_1__.mA)(f)||(0,_cim_utils_js__WEBPACK_IMPORTED_MODULE_1__.MM)(f)&&f.markerPlacement&&(0,_cim_utils_js__WEBPACK_IMPORTED_MODULE_1__.zr)(f.markerPlacement))continue;const e=t.toArray();switch(f.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":f.tintColor=e;break;case"CIMVectorMarker":f.markerGraphics?.forEach((e=>{k(e.symbol,t,a)}));break;case"CIMSolidStroke":case"CIMSolidFill":f.color=e;break;case"CIMHatchFill":k(f.lineSymbol,t,a)}}}},"./node_modules/@arcgis/core/symbols/support/webStyleSymbolUtils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{I:()=>j,p:()=>g,resolveWebStyleSymbol:()=>h});var _core_devEnvironmentUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/devEnvironmentUtils.js"),_core_Error_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/urlUtils.js"),_portal_Portal_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/portal/Portal.js"),_chunks_persistableUrlUtils_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/chunks/persistableUrlUtils.js"),_jsonUtils_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/symbols/support/jsonUtils.js"),_StyleOrigin_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/symbols/support/StyleOrigin.js"),_styleUtils_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/symbols/support/styleUtils.js"),_Thumbnail_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/symbols/support/Thumbnail.js"),_typeUtils_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/symbols/support/typeUtils.js"),_webStyleAcceptedFormats_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/symbols/support/webStyleAcceptedFormats.js");function h(t,e,o){const l=t.name;return null==l?Promise.reject(new _core_Error_js__WEBPACK_IMPORTED_MODULE_1__.A("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):"Esri2DPointSymbolsStyle"===t.styleName?function U(t,e,r){const s=_styleUtils_js__WEBPACK_IMPORTED_MODULE_7__.jg.replaceAll(/\{SymbolName\}/gi,t),a=null!=e.portal?e.portal:_portal_Portal_js__WEBPACK_IMPORTED_MODULE_3__.A.getDefault();return(0,_styleUtils_js__WEBPACK_IMPORTED_MODULE_7__.yA)(s,r).then((t=>{const e=(0,_styleUtils_js__WEBPACK_IMPORTED_MODULE_7__.bo)(t.data);return(0,_jsonUtils_js__WEBPACK_IMPORTED_MODULE_5__.rS)(e,{portal:a,url:(0,_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_2__.An)((0,_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_2__.nM)(s)),origin:"portal-item"})}))}(l,e,o):(0,_styleUtils_js__WEBPACK_IMPORTED_MODULE_7__.cF)(t,e,o).then((t=>j(t,l,e,_styleUtils_js__WEBPACK_IMPORTED_MODULE_7__.o5,o)))}function g(t,e){return e.items.find((e=>e.name===t))}async function j(i,c,f,h,j){const U=null!=f?.portal?f.portal:_portal_Portal_js__WEBPACK_IMPORTED_MODULE_3__.A.getDefault(),w={portal:U,url:(0,_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_2__.An)(i.baseUrl),origin:"portal-item"},N=g(c,i.data);if(!N)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_1__.A("symbolstyleutils:symbol-name-not-found",`The symbol name '${c}' could not be found`,{symbolName:c});const S=j?.acceptedFormats??_webStyleAcceptedFormats_js__WEBPACK_IMPORTED_MODULE_10__.t,D=h(N,S);if(!D)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_1__.A("symbolstyleutils:symbol-reference-no-accepted-format",`The symbol name '${c}' does not have an accepted format (one of ${S})`,{symbolName:c});const{url:O,format:$}=D;let v=(0,_chunks_persistableUrlUtils_js__WEBPACK_IMPORTED_MODULE_4__.f)(O,w),E=N.thumbnail?.href??null;const P=N.thumbnail?.imageData;(0,_core_devEnvironmentUtils_js__WEBPACK_IMPORTED_MODULE_0__.b5)()&&(v=(0,_core_devEnvironmentUtils_js__WEBPACK_IMPORTED_MODULE_0__.EM)(v)??"",E=(0,_core_devEnvironmentUtils_js__WEBPACK_IMPORTED_MODULE_0__.EM)(E));const T={portal:U,url:(0,_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_2__.An)((0,_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_2__.nM)(v)),origin:"portal-item"};return(0,_styleUtils_js__WEBPACK_IMPORTED_MODULE_7__.yA)(v,j).then((t=>{const e="cim"===$?(0,_styleUtils_js__WEBPACK_IMPORTED_MODULE_7__.bo)(t.data):t.data,r=(0,_jsonUtils_js__WEBPACK_IMPORTED_MODULE_5__.rS)(e,T);if(r&&(0,_typeUtils_js__WEBPACK_IMPORTED_MODULE_9__.wk)(r)){if(E){const t=(0,_chunks_persistableUrlUtils_js__WEBPACK_IMPORTED_MODULE_4__.f)(E,w);r.thumbnail=new _Thumbnail_js__WEBPACK_IMPORTED_MODULE_8__.V({url:t})}else P&&(r.thumbnail=new _Thumbnail_js__WEBPACK_IMPORTED_MODULE_8__.V({url:`data:image/png;base64,${P}`}));i.styleUrl?r.styleOrigin=new _StyleOrigin_js__WEBPACK_IMPORTED_MODULE_6__.A({portal:f.portal,styleUrl:i.styleUrl,name:c}):i.styleName&&(r.styleOrigin=new _StyleOrigin_js__WEBPACK_IMPORTED_MODULE_6__.A({portal:f.portal,styleName:i.styleName,name:c}))}return r}))}},"./node_modules/@arcgis/core/views/2d/engine/vectorTiles/GeometryUtils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{GW:()=>p,IU:()=>d,Jo:()=>o,MG:()=>r,Wh:()=>a,cP:()=>P,os:()=>s,p6:()=>h,pJ:()=>e,ru:()=>N,s3:()=>I,w4:()=>w,wV:()=>l,yM:()=>b,z0:()=>f});var _geometry_support_coordsUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/coordsUtils.js"),_geometry_support_TileClipper_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/TileClipper.js");const r=Number.POSITIVE_INFINITY,o=Math.PI,e=2*o,i=128/o,u=256/360,s=o/180,c=1/Math.LN2;function a(t,n){return(t%=n)>=0?t:t+n}function f(t){return a(t*i,256)}function l(t){return a(t*u,256)}function h(t){return Math.log(t)*c}function p(t,n,r){return t*(1-r)+n*r}const x=8,y=14,M=16;function d(t){return x+Math.max((t-y)*M,0)}function I(t,n,r){let o,e,i,u=0;for(const s of r){o=s.length;for(let r=1;r<o;++r)e=s[r-1],i=s[r],e.y>n!=i.y>n&&((i.x-e.x)*(n-e.y)-(i.y-e.y)*(t-e.x)>0?u++:u--)}return 0!==u}function N(n,r,o,e){let i,u,s,c;const a=e*e;for(const f of o){const o=f.length;if(!(o<2)){i=f[0].x,u=f[0].y;for(let e=1;e<o;++e){if(s=f[e].x,c=f[e].y,(0,_geometry_support_coordsUtils_js__WEBPACK_IMPORTED_MODULE_0__.Ng)(n,r,i,u,s,c)<a)return!0;i=s,u=c}}}return!1}function w(t,n,r,o,e,i,u){const s=Math.max(o,Math.min(n,i))-n,c=Math.max(e,Math.min(r,u))-r;return s*s+c*c<=t*t}function P(t,r){if(0===r||Number.isNaN(r))return t;const o=[],e=new _geometry_support_TileClipper_js__WEBPACK_IMPORTED_MODULE_1__.bR(0,0),i=new _geometry_support_TileClipper_js__WEBPACK_IMPORTED_MODULE_1__.bR(0,0),u=new _geometry_support_TileClipper_js__WEBPACK_IMPORTED_MODULE_1__.bR(0,0);for(let s=0;s<t.length;s++){const c=t[s],a=[];for(let t=0;t<c.length;t++){const o=c[t-1],s=c[t],f=c[t+1];0===t?e.setCoords(0,0):e.assignSub(s,o).normalize().rightPerpendicular(),t===c.length-1?i.setCoords(0,0):i.assignSub(f,s).normalize().rightPerpendicular(),u.assignAdd(e,i).normalize();const l=u.x*i.x+u.y*i.y;0!==l&&u.scale(1/l),a.push(_geometry_support_TileClipper_js__WEBPACK_IMPORTED_MODULE_1__.bR.add(s,u.scale(r)))}o.push(a)}return o}function b(t,r,o,e){const i=new _geometry_support_TileClipper_js__WEBPACK_IMPORTED_MODULE_1__.bR(t[0],t[1]);if(i.scale(e),"viewport"===r){const t=-o*(Math.PI/180),n=Math.cos(t),r=Math.sin(t);i.rotate(n,r)}return i}},"./node_modules/@arcgis/core/views/2d/engine/webgl/collisions/BoundingBox.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>i});var _core_libs_gl_matrix_2_factories_vec2f32_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/vec2f32.js");class i{constructor(i,e,s,r){this.transformedX=0,this.transformedY=0,this.center=(0,_core_libs_gl_matrix_2_factories_vec2f32_js__WEBPACK_IMPORTED_MODULE_0__.fA)(i,e),this.centerT=(0,_core_libs_gl_matrix_2_factories_vec2f32_js__WEBPACK_IMPORTED_MODULE_0__.vt)(),this.halfWidth=s/2,this.halfHeight=r/2,this.width=s,this.height=r}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+this.halfHeight}get trX(){return this.center[0]-this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+this.halfWidth}get ymin(){return this.y-this.halfHeight}get ymax(){return this.y+this.halfHeight}set x(t){this.center[0]=t}set y(t){this.center[1]=t}clone(){return new i(this.x,this.y,this.width,this.height)}serialize(t){return t.writeF32(this.center[0]),t.writeF32(this.center[1]),t.push(this.width),t.push(this.height),t}findCollisionDelta(t,h=4){const i=Math.abs(t.centerT[0]-this.centerT[0]),e=Math.abs(t.centerT[1]-this.centerT[1]),s=(t.halfWidth+this.halfWidth+h)/i,r=(t.halfHeight+this.halfHeight+h)/e,n=Math.min(s,r);return Math.log2(n)}extend(t){const h=Math.min(this.xmin,t.xmin),i=Math.min(this.ymin,t.ymin),e=Math.max(this.xmax,t.xmax)-h,s=Math.max(this.ymax,t.ymax)-i,r=h+e/2,n=i+s/2;this.width=e,this.height=s,this.halfWidth=e/2,this.halfHeight=s/2,this.x=r,this.y=n}static deserialize(t){const h=t.readF32(),e=t.readF32(),s=t.readInt32(),r=t.readInt32();return new i(h,e,s,r)}}},"./node_modules/@arcgis/core/views/2d/engine/webgl/definitions.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$U:()=>Z,C2:()=>L,CQ:()=>a,CR:()=>E,C_:()=>_,Cp:()=>H,DY:()=>G,GR:()=>zi,Gh:()=>R,LY:()=>M,MZ:()=>ci,O5:()=>wi,Pq:()=>U,Qb:()=>Ui,Qs:()=>Ci,Sr:()=>z,TB:()=>yi,U5:()=>K,V3:()=>W,Vl:()=>ki,Xh:()=>ji,YS:()=>w,YV:()=>r,_M:()=>X,_x:()=>xi,cp:()=>Bi,dV:()=>J,eG:()=>A,eI:()=>bi,fq:()=>si,fy:()=>S,g0:()=>N,hM:()=>ti,ie:()=>Y,ju:()=>s,lL:()=>k,mg:()=>$,n9:()=>y,nM:()=>j,nW:()=>ai,oj:()=>oi,p:()=>Di,qM:()=>D,r1:()=>ui,sn:()=>q,tP:()=>Ei,uM:()=>x,ue:()=>u,vN:()=>I,vd:()=>C,yA:()=>ei,yv:()=>Fi,z2:()=>b,zt:()=>B});const D=1e-30,a=512,r=16777216,s=8,G=29,A=24,L=4,U=0,u=0,w=0,x=1,b=2,j=3,k=4,q=5,y=6,z=12,B=13,C=5,E=6,H=5,I=6;var J;!function(i){i[i.FilterFlags=0]="FilterFlags",i[i.Animation=1]="Animation",i[i.GPGPU=2]="GPGPU",i[i.VV=3]="VV",i[i.DD0=4]="DD0",i[i.DD1=5]="DD1",i[i.DD2=6]="DD2",i[i.LocalTimeOrigin=7]="LocalTimeOrigin"}(J||(J={}));const K=6,M=1<<K,N=M<<1,R=1.05,S=3,W=1,X=3,Y=3,Z=5,$=6,_=1.15,ti=4,Di=128,ei=256-2*ti,ai=2,oi=128,ci=1,si=10,Fi=1024,Ui=128,ui=4,wi=1,xi=1<<20,bi=.75,ji=10,ki=.75,yi=256,zi=32,Bi=512,Ci=0,Ei=1},"./node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DSymbolLayerFactory.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{make:()=>Graphics3DSymbolLayerFactory_c});var Logger=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),has=__webpack_require__("./node_modules/@arcgis/core/core/has.js"),core_Error=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),lang=__webpack_require__("./node_modules/@arcgis/core/core/lang.js"),unitUtils=__webpack_require__("./node_modules/@arcgis/core/core/unitUtils.js"),earcut=__webpack_require__("./node_modules/@arcgis/core/chunks/earcut.js"),mat3=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/math/mat3.js"),mat3f64=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/mat3f64.js"),mat4=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/math/mat4.js"),mat4f64=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/mat4f64.js"),vec32=__webpack_require__("./node_modules/@arcgis/core/chunks/vec32.js"),vec3f64=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/vec3f64.js"),computeTranslationToOriginAndRotation=__webpack_require__("./node_modules/@arcgis/core/geometry/projection/computeTranslationToOriginAndRotation.js"),aaBoundingBox=__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingBox.js"),DoubleArray=__webpack_require__("./node_modules/@arcgis/core/geometry/support/DoubleArray.js"),Indices=__webpack_require__("./node_modules/@arcgis/core/geometry/support/Indices.js"),vec3=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3.js"),SnappingCandidate=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/data/SnappingCandidate.js"),renderingInfoUtils=__webpack_require__("./node_modules/@arcgis/core/renderers/support/renderingInfoUtils.js"),ViewingMode=__webpack_require__("./node_modules/@arcgis/core/views/ViewingMode.js"),elevationAlignmentUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/elevationAlignmentUtils.js"),Graphics3DObject3DGraphicLayer=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer.js"),Graphics3DSymbolLayer=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DSymbolLayer.js"),graphicUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/graphicUtils.js"),interfaces=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/interfaces.js"),Extent=__webpack_require__("./node_modules/@arcgis/core/geometry/Extent.js"),Polygon=__webpack_require__("./node_modules/@arcgis/core/geometry/Polygon.js"),Axis=__webpack_require__("./node_modules/@arcgis/core/geometry/support/Axis.js"),polygonUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/polygonUtils.js"),Attribute=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/Attribute.js"),ContentObjectType=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/ContentObjectType.js"),Geometry=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/Geometry.js"),VertexAttribute=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/VertexAttribute.js");function polygonUtils_p(e,r,o){const a=(r.length>0?r[0]:e.length/3)-1,s=(0,polygonUtils.S)(e,a,o);if(s!==Axis._.Z){e=e.slice();for(let t=0;t<e.length;t+=3)e[t+s]=e[t+2]}return(0,earcut.e)(e,r,3)}function polygonUtils_l(t){const e=[[VertexAttribute.r.POSITION,new Attribute.n(t.attributeData.position,t.indices,3,!0)]],r=(0,Indices.EH)(t.indices.length);return null!=t.attributeData.colorFeature?e.push([VertexAttribute.r.COLORFEATUREATTRIBUTE,new Attribute.n([t.attributeData.colorFeature],r,1,!0)]):t.attributeData.color&&e.push([VertexAttribute.r.COLOR,new Attribute.n(t.attributeData.color,r,4,!0)]),t.attributeData.uvMapSpace&&e.push([VertexAttribute.r.UVMAPSPACE,new Attribute.n(t.attributeData.uvMapSpace,t.indices,4,!0)]),t.attributeData.boundingRect&&e.push([VertexAttribute.r.BOUNDINGRECT,new Attribute.n(t.attributeData.boundingRect,t.indices,9,!0)]),new Geometry.V(t.material,e,t.mapPositions,ContentObjectType.X.Mesh,t.attributeData.objectAndLayerIdColor)}function polygonUtils_m(t,e=null){const r=[[VertexAttribute.r.POSITION,new Attribute.n(t.attributeData.position,t.indices,3,!0)],[VertexAttribute.r.UV0,new Attribute.n(t.attributeData.uv0,t.indices,2,!0)]];return new Geometry.V(t.material,r,t.mapPositions,ContentObjectType.X.Mesh,e)}function polygonUtils_b(t){switch(t.type){case"extent":if(t instanceof Extent.default)return Polygon.A.fromExtent(t);break;case"polygon":return t}return null}class g{constructor(t,e,r){this.renderData=t,this.layerUid=e,this.graphicUid=r,this.outGeometries=new Array}}var edgeUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/support/edgeUtils.js"),debugFlags=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/debugFlags.js"),ElevationProvider=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/ElevationProvider.js"),projectBuffer=__webpack_require__("./node_modules/@arcgis/core/geometry/projection/projectBuffer.js"),triangulationUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/triangulationUtils.js"),OverlayRenderer=__webpack_require__("./node_modules/@arcgis/core/views/3d/terrain/OverlayRenderer.js");function polygon_p(o,n,r,p){const c=(0,triangulationUtils.oR)(o.rings,!!o.hasZ&&"on-the-ground"!==p.mode,triangulationUtils.Wq.CCW_IS_HOLE,o.spatialReference),a=(0,DoubleArray.jh)(c.position.length),h=(0,elevationAlignmentUtils.au)(c.position,o.spatialReference,0,a,0,c.position,0,c.position.length/3,n,r,p),m=null!=h;return new polygon_g(c.position,a,u(c.polygons,c.position,a),l(c.outlines,c.position,a),m,h)}function c(t,n){const e=(0,triangulationUtils.oR)(t.rings,!1,triangulationUtils.Wq.CCW_IS_HOLE),p=(0,projectBuffer.projectBuffer)(e.position,t.spatialReference,0,e.position,n,0);for(let o=2;o<e.position.length;o+=3)e.position[o]=OverlayRenderer.bi;return{position:e.position,polygons:u(e.polygons,e.position),outlines:l(e.outlines,e.position),projectionSuccess:p}}function l(o,t,s=null){return o.filter((({count:o})=>o>1)).map((({index:o,count:i})=>{const e=3*o,r=3*i;return null!=s?new h(o,i,(0,DoubleArray.l5)(t,e,r),(0,DoubleArray.l5)(s,e,r)):new a(o,i,(0,DoubleArray.l5)(t,e,r))}))}function u(o,t,s=null){const i=new Array;for(const{index:e,count:r,holeIndices:p,pathLengths:c}of o){if(r<=1)continue;const o=3*e,l=3*r,u=p.map((o=>o-e)),a=null!=s?new m(e,r,(0,DoubleArray.l5)(t,3*e,3*r),(0,DoubleArray.l5)(s,o,l),u,c):new f(e,r,(0,DoubleArray.l5)(t,3*e,3*r),u,c);i.push(a)}return i}class a{constructor(o,t,n){this.index=o,this.count=t,this.position=n}}class h extends a{constructor(o,t,n,s){super(o,t,n),this.mapPositions=s}}class m extends h{constructor(o,t,n,s,i,e){super(o,t,n,s),this.holeIndices=i,this.pathLengths=e}}class f extends a{constructor(o,t,n,s,i){super(o,t,n),this.holeIndices=s,this.pathLengths=i}}class polygon_g{constructor(o,t,n,s,i,e){this.position=o,this.mapPositions=t,this.polygons=n,this.outlines=s,this.projectionSuccess=i,this.sampledElevation=e}}var NormalAttribute_glsl=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl.js"),basicInterfaces=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/basicInterfaces.js"),GeometryWithMapPositions=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/GeometryWithMapPositions.js"),Normals=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/Normals.js"),Object3D=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/Object3D.js"),DefaultMaterial=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/materials/DefaultMaterial.js");const st=["polygon","extent"];class ot extends Graphics3DSymbolLayer.U{constructor(t,e,r,s){super(t,e,r,s),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=(0,graphicUtils.Hj)(this._getSymbolSize());if(e)throw new core_Error.A("graphics3dextrudesymbollayer:invalid-size",e)}const e=this.symbolLayer?.material?.color,r=this._getCombinedOpacityAndColor(e),s=(0,vec3f64.ci)(r),o=r[3],i=o<1||this.needsDrivenTransparentPass,n=this.symbolLayer?.material?.emissiveFactor,a=n?(0,vec32.F)((0,vec3f64.o8)(n)):vec3f64.uY,l={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:s,ambient:s,opacity:o,transparent:i,cullFace:i?basicInterfaces.s2.None:basicInterfaces.s2.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,emissiveFactor:a,offsetTransparentBackfaces:!0,normalType:NormalAttribute_glsl.W.Compressed};this._materials[It.Main]=new DefaultMaterial.$U(l,this._context),this._materials[It.Bottom]=new DefaultMaterial.$U({...l,cullFace:basicInterfaces.s2.Back},this._context),this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(t){const e=t.graphic;if(!this._validateGeometry(e.geometry,st,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(t.renderingInfo,255),s=this.setGraphicElevationContext(e);return this._createAs3DShape(e,t.renderingInfo,r,s,e.uid)}layerOpacityChanged(t,e){const r=this.symbolLayer?.material?.color,s=this._getCombinedOpacity(r),o=s<1||this.needsDrivenTransparentPass;this._materials[It.Main]?.setParameters({opacity:s,transparent:o}),this._materials[It.Bottom]?.setParameters({opacity:s,transparent:o});const i=this._getLayerOpacity();t.forEach((t=>e(t)?.layerOpacityChanged(i,this._context.isAsync)))}layerElevationInfoChanged(t,e){return this.updateGraphics3DGraphicElevationInfo(t,e,elevationAlignmentUtils.Kf)}slicePlaneEnabledChanged(t,e){return this._materials[It.Main]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[It.Bottom]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),t.forEach((t=>{const r=e(t);null!=r&&r.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)})),!0}physicalBasedRenderingChanged(){const t={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0};return this._materials[It.Main]?.setParameters(t),this._materials[It.Bottom]?.setParameters(t),!0}_getExtrusionSize(t){let e;return e=t.size&&this._drivenProperties.size?(0,renderingInfoUtils.kg)(t.size,2)??0:this._getSymbolSize(),e/=this._context.renderCoordsHelper.unitInMeters,e}applyRendererDiff(t,e){return this._drivenPropertiesChanged(e)?interfaces.w.RecreateSymbol:interfaces.w.RecreateGraphics}async queryForSnapping(t,s,o,i){const n=this._getExtrusionSize(o)*this._context.renderCoordsHelper.unitInMeters/(0,unitUtils.G9)(s),{objectId:a,target:l}=t,c=(0,lang.o8)(l);switch(c.z=(c.z??0)+n,t.type){case"edge":{const{start:r,end:s}=t,o=(0,lang.o8)(r),i=(0,lang.o8)(s);return o.z=(o.z??0)+n,i.z=(i.z??0)+n,[(0,SnappingCandidate.P)(a,c,1/0,o,i)]}case"vertex":return[(0,SnappingCandidate.k)(a,c,1/0),(0,SnappingCandidate.P)(a,l,1/0,l,c)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(t,e,r,a,c){const m=polygonUtils_b(t.geometry);if(null==m)return null;if(0===m.rings.length||!m.rings.some((t=>t.length>0)))return this._logGeometryValidationWarnings(m.rings,"rings","ExtrudeSymbol3DLayer"),null;const p=polygon_p(m,this._context.elevationProvider,this._context.renderCoordsHelper,a);this._logGeometryCreationWarnings(p,m.rings,"rings","ExtrudeSymbol3DLayer");const h=(0,graphicUtils.W$)(m);if(null==h)return null;const g=new Array,d=new Array,u=(0,aaBoundingBox.vt)(),f=(0,mat4f64.vt)(),y=(0,vec3f64.vt)(),b=this._context.renderCoordsHelper.viewingMode===ViewingMode.RT.Global;b||this._context.renderCoordsHelper.worldUpAtPosition(null,y),(0,computeTranslationToOriginAndRotation.l)(m.spatialReference,[h.x,h.y,0],f,this._context.renderCoordsHelper.spatialReference);const _=(0,mat4f64.vt)();(0,mat4.B8)(_,f);const v=(0,mat3f64.vt)();(0,mat3.Ge)(v,_);const{polygons:M,mapPositions:I,position:A}=p,B=new Map,T=this._materials[It.Main];for(const o of M){const t=o.count;if(this._context.clippingExtent&&((0,aaBoundingBox.vY)(o.mapPositions,u),!(0,aaBoundingBox.KG)(u,this._context.clippingExtent)))continue;const i=(0,earcut.e)(o.mapPositions,o.holeIndices,3);if(0===i.length)continue;const n=i.length,a=6*t,l=(0,Indices.my)(a+n),m=(0,Indices.my)(n),p=(0,DoubleArray.jh)(3*a),h=(0,DoubleArray.jh)(3*a),x=(0,DoubleArray.jh)(3*a),S=(0,DoubleArray.jh)(a);nt(A,I,i,o,p,x,h,S,l,m,this._getExtrusionSize(e),y,b),(0,vec3.t)(p,p,_);const j=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:c,layerUid:this._context.layer.uid}),v=new At(p,x,(0,Normals.fA)(h),S),M=it(T,l,l.length-m.length,v,r,j),L=t,z=t,D=2*o.count,R=new Lt(L,z,D,n/3);_t(M,R,f),B.set(M,R),g.push(M,it(this._materials[It.Bottom],m,0,v,r,j)),d.push(v.heights)}if(0===g.length)return null;const U=new Object3D.B({geometries:g,layerUid:this._context.layer.uid,graphicUid:c,isElevationSource:!0});U.transformation=f;const N=(0,edgeUtils.Cc)(this.symbolLayer,{opacity:this._getLayerOpacity()}),k=N?new Graphics3DObject3DGraphicLayer.H(this._materials[It.Main],N,this._context.slicePlaneEnabled):null,H=new Graphics3DObject3DGraphicLayer.Y(this,U,g,null,null,((t,e,r,s,o)=>function bt(t,e,r,s,o,i,n){const c=t.stageObject,m=c.geometries,p=m.length,g="absolute-height"!==e.mode;let d=0;const f=c.transformation,y=(0,mat4.Qw)((0,mat4f64.vt)(),f);for(let a=0;a<p;a+=2){const t=m[a];if(!(0,GeometryWithMapPositions.p)(t))continue;const e=t.getMutableAttribute(VertexAttribute.r.POSITION).data,l=i[a/2],p=new ElevationProvider.aY(t.mapPositions),b=e.length/3;let _=!1,x=0;{let t=0;for(let i=0;i<b;i++){yt[0]=e[t],yt[1]=e[t+1],yt[2]=e[t+2],s(p,jt),g&&(x+=jt.sampledElevation),debugFlags.b.TESTS_DISABLE_OPTIMIZATIONS?((0,vec32.i)(xt,p.array[p.offset],p.array[p.offset+1],jt.z+l[t/3]),null!=r&&o.toRenderCoords(xt,r,xt),(0,vec32.t)(xt,xt,y)):((0,vec32.i)(xt,e[t],e[t+1],e[t+2]),(0,vec32.t)(xt,xt,f),o.setAltitude(xt,jt.z+l[t/3]),(0,vec32.t)(xt,xt,y)),e[t]=xt[0],e[t+1]=xt[1],e[t+2]=xt[2];const i=wt/o.unitInMeters;(Math.abs(yt[0]-e[t])>=i||Math.abs(yt[1]-e[t+1])>=i||Math.abs(yt[2]-e[t+2])>=i)&&(_=!0),p.offset+=3,t+=3}}if(_){const e=n.get(t);e&&_t(t,e,f),c.geometryVertexAttributeUpdated(m[a],VertexAttribute.r.NORMALCOMPRESSED),t.invalidateBoundingInfo(),c.geometryVertexAttributeUpdated(m[a],VertexAttribute.r.POSITION),m[a+1].invalidateBoundingInfo(),c.geometryVertexAttributeUpdated(m[a+1],VertexAttribute.r.POSITION)}d+=x/b}return d/p}(t,e,r,s,o,d,B)),a,k);return H.alignedSampledElevation=p.sampledElevation,H.needsElevationUpdates=(0,elevationAlignmentUtils.Kf)(a.mode),H}}function it(t,e,r,s,o,i){const n=(0,Indices.EH)(e.length),a=[[VertexAttribute.r.POSITION,new Attribute.n(s.positions,e,3,!0)],[VertexAttribute.r.NORMALCOMPRESSED,new Attribute.n(s.normals,e,2,!0)],[VertexAttribute.r.COLOR,new Attribute.n(o,n,4,!0)]];return new Geometry.V(t,a,s.elevation,ContentObjectType.X.Mesh,i,r)}function nt(t,e,r,s,o,i,n,a,l,c,m,p,h){{const g=r.length/3,d=2*s.count;!function at(t,e,r,s,o,i,n,a,l,c,h,g,d,u,f,y,b){(0,vec32.c)(St,y);{const o=f>0?1:-1;let i=3*r,n=0,m=3*n,g=s,d=3*g;for(let r=0;r<s;++r){const r=t[i],s=t[i+1],u=t[i+2];b&&(St[0]=r,St[1]=s,St[2]=u,(0,vec32.n)(St,St)),a[m+0]=r,a[m+1]=s,a[m+2]=u;const y=e[i+0],_=e[i+1],x=e[i+2];l[m+0]=y,l[m+1]=_,l[m+2]=x,c[m+0]=-o*St[0],c[m+1]=-o*St[1],c[m+2]=-o*St[2],h[n]=0,a[d+0]=r+f*St[0],a[d+1]=s+f*St[1],a[d+2]=u+f*St[2],l[d+0]=y,l[d+1]=_,l[d+2]=x,h[g]=f,m+=3,d+=3,i+=3,n+=1,g+=1}}{let t=3*i,e=0,r=3*u;const a=f<0?Et:Pt,l=f<0?Pt:Et;for(let i=0;i<n;++i)d[e]=o[t+a[0]],d[e+1]=o[t+a[1]],d[e+2]=o[t+a[2]],g[r]=o[t+l[0]]+s,g[r+1]=o[t+l[1]]+s,g[r+2]=o[t+l[2]]+s,e+=3,r+=3,t+=3}}(t,e,s.index,s.count,r,0,g,o,i,n,a,l,c,d,m,p,h)}{let t=0,e=2*s.count,r=0;const c=s.pathLengths[0];mt(o,i,a,n,t,c,s.count,e,l,r,m),e+=4*c,r+=2*c,t+=c;for(let p=1;p<s.pathLengths.length;++p){const c=s.pathLengths[p];mt(o,i,a,n,t,c,s.count,e,l,r,m),e+=4*c,r+=2*c,t+=c}}}function lt(t,e,r,s,o,i,n){s[i]=s[n],n*=3,t[i*=3]=t[n],t[i+1]=t[n+1],t[i+2]=t[n+2],e[i]=e[n],e[i+1]=e[n+1],e[i+2]=e[n+2],r[i]=o[0],r[i+1]=o[1],r[i+2]=o[2]}const ct=(0,vec3f64.vt)();function mt(t,e,r,s,o,i,n,a,l,c,m){let p=o,h=o+1,g=o+n,d=o+n+1,u=a,f=a+1,y=a+2*i,b=a+2*i+1;m<0&&(p=o+n+1,d=o);let _=3*c;for(let x=0;x<i;++x)x===i-1&&(h=o,m>0?d=o+n:p=o+n),ft(t,p,h,g,ct),lt(t,e,s,r,ct,u,p),lt(t,e,s,r,ct,f,h),lt(t,e,s,r,ct,y,g),lt(t,e,s,r,ct,b,d),l[_]=u,l[_+1]=y,l[_+2]=b,l[_+3]=u,l[_+4]=b,l[_+5]=f,_+=6,p++,h++,g++,d++,u+=2,f+=2,y+=2,b+=2}const pt=(0,vec3f64.vt)(),ht=(0,vec3f64.vt)(),gt=(0,vec3f64.vt)(),dt=(0,vec3f64.vt)(),ut=(0,vec3f64.vt)();function ft(t,e,r,s,o){e*=3,r*=3,s*=3,(0,vec32.i)(pt,t[e++],t[e++],t[e++]),(0,vec32.i)(ht,t[r++],t[r++],t[r++]),(0,vec32.i)(gt,t[s++],t[s++],t[s++]),(0,vec32.d)(dt,ht,pt),(0,vec32.d)(ut,gt,pt),(0,vec32.e)(o,ut,dt),(0,vec32.n)(o,o)}const yt=(0,vec3f64.vt)();function _t(t,e,r){const s=t.getMutableAttribute(VertexAttribute.r.POSITION),o=t.getMutableAttribute(VertexAttribute.r.NORMALCOMPRESSED).data,{topVertexStart:i,topVertexCount:n,topFaceStart:a,topFaceCount:l}=e,c=s.data,m=n,g=t.attributes.get(VertexAttribute.r.POSITION).indices,y=a+l,b=i+n,_=(0,DoubleArray.jh)(3*m);for(let p=0;p<m;++p){const t=3*p;_[t+0]=0,_[t+1]=0,_[t+2]=0}const x=Ot,S=vt,j=Ct,P=Mt,E=St;for(let w=a;w<y;++w){const t=3*w;for(let e=0;e<3;++e){const s=g[t+e];P[e]=s;const o=3*s;(0,vec32.i)(xt,c[o+0],c[o+1],c[o+2]),(0,vec32.t)(x[e],xt,r)}(0,vec32.a)(S,x[1],x[0]),(0,vec32.a)(j,x[2],x[0]),(0,vec32.e)(E,S,j),(0,vec32.n)(E,E);for(let e=0;e<3;++e){const t=3*(P[e]-i);_[t+0]+=E[0],_[t+1]+=E[1],_[t+2]+=E[2]}}for(let p=i;p<b;++p){const t=3*(p-i),e=_[t+0],r=_[t+1],s=_[t+2],n=Math.sqrt(e*e+r*r+s*s);(0,Normals.aT)(o,p,e/n,r/n,s/n)}}const xt=(0,vec3f64.vt)(),St=(0,vec3f64.vt)(),jt=new elevationAlignmentUtils.Uk,Pt=[0,2,1],Et=[0,1,2],wt=.01,Ot=[(0,vec3f64.vt)(),(0,vec3f64.vt)(),(0,vec3f64.vt)()],vt=(0,vec3f64.vt)(),Ct=(0,vec3f64.vt)(),Mt=[0,0,0];var It;!function(t){t[t.Main=0]="Main",t[t.Bottom=1]="Bottom"}(It||(It={}));class At{constructor(t,e,r,s){this.positions=t,this.elevation=e,this.normals=r,this.heights=s}}class Lt{constructor(t,e,r,s){this.topVertexStart=t,this.topVertexCount=e,this.topFaceStart=r,this.topFaceCount=s}}var Color=__webpack_require__("./node_modules/@arcgis/core/Color.js"),asyncUtils=__webpack_require__("./node_modules/@arcgis/core/core/asyncUtils.js"),maybe=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),promiseUtils=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),screenUtils=__webpack_require__("./node_modules/@arcgis/core/core/screenUtils.js"),string=__webpack_require__("./node_modules/@arcgis/core/core/string.js"),urlUtils=__webpack_require__("./node_modules/@arcgis/core/core/urlUtils.js"),vec2f64=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/vec2f64.js"),vec4f64=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/vec4f64.js"),projectPointToVector=__webpack_require__("./node_modules/@arcgis/core/geometry/projection/projectPointToVector.js"),arcadeOnDemand=__webpack_require__("./node_modules/@arcgis/core/support/arcadeOnDemand.js"),CIMSymbolHelper=__webpack_require__("./node_modules/@arcgis/core/symbols/cim/CIMSymbolHelper.js"),utils=__webpack_require__("./node_modules/@arcgis/core/symbols/cim/utils.js"),cimSymbolUtils=__webpack_require__("./node_modules/@arcgis/core/symbols/support/cimSymbolUtils.js"),IconSymbol3DLayerResource=__webpack_require__("./node_modules/@arcgis/core/symbols/support/IconSymbol3DLayerResource.js"),Symbol3DAnchorPosition2D=__webpack_require__("./node_modules/@arcgis/core/symbols/support/Symbol3DAnchorPosition2D.js"),support_utils=__webpack_require__("./node_modules/@arcgis/core/symbols/support/utils.js"),tslib_es6=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),Accessor=__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js"),Collection=__webpack_require__("./node_modules/@arcgis/core/core/Collection.js"),reactiveUtils=__webpack_require__("./node_modules/@arcgis/core/core/reactiveUtils.js"),property=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),subclass=(__webpack_require__("./node_modules/@arcgis/core/core/RandomLCG.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),Point=__webpack_require__("./node_modules/@arcgis/core/geometry/Point.js"),ElevationContext=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/ElevationContext.js"),webgl=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl.js"),RenderNode=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl/RenderNode.js"),ReloadableShaderModule=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule.js"),ShaderTechnique=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique.js"),FocusAreaColor_glsl=__webpack_require__("./node_modules/@arcgis/core/chunks/FocusAreaColor.glsl.js"),renderState=__webpack_require__("./node_modules/@arcgis/core/views/webgl/renderState.js");class FocusAreaColorTechnique_a extends ShaderTechnique.w{constructor(r,s){super(r,s,new ReloadableShaderModule.$(FocusAreaColor_glsl.a,(()=>__webpack_require__.e(6511).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/views/3d/webgl-engine/shaders/FocusAreaColor.glsl.js")))))}initializePipeline(){return(0,renderState.Ey)({colorWrite:renderState.kn})}}let n=class extends RenderNode.A{constructor(e){super({...e,view:e.focusAreas.view}),this.consumes={required:[webgl.hM.COMPOSITE,webgl.OG.FOCUSAREA]},this.produces=webgl.hM.COMPOSITE,this._passParameters=new FocusAreaColor_glsl.F}precompile(){this.techniques.precompile(FocusAreaColorTechnique_a)}render(e){const r=this.techniques.get(FocusAreaColorTechnique_a),s=e.find((({name:e})=>e===webgl.hM.COMPOSITE));if(!r.compiled)return this.requestRender(),s;const i=this.bindParameters,a=i.camera,n=a.fullViewport[2],p=a.fullViewport[3],m=e.find((({name:e})=>e===webgl.OG.FOCUSAREA)),h=this.fboCache.acquire(n,p,this.produces),d=this.renderingContext;return d.gl.clear(d.gl.STENCIL_BUFFER_BIT),d.bindFramebuffer(h.fbo),this._passParameters.color=s.getTexture(),this._passParameters.focusArea=m.getTexture(),this._passParameters.effect=FocusAreaColorNode_u[this.focusAreas.style],d.bindTechnique(r,i,this._passParameters),d.screen.draw(),h.attachDepth(s.getAttachment(this.gl.DEPTH_STENCIL_ATTACHMENT)),h}};var p;(0,tslib_es6._)([(0,property.MZ)()],n.prototype,"consumes",void 0),(0,tslib_es6._)([(0,property.MZ)()],n.prototype,"produces",void 0),(0,tslib_es6._)([(0,property.MZ)({constructOnly:!0})],n.prototype,"focusAreas",void 0),n=(0,tslib_es6._)([(0,subclass.$)("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaColorNode")],n),function(e){e[e.NONE=0]="NONE",e[e.BRIGHT=1]="BRIGHT",e[e.DARK=2]="DARK"}(p||(p={}));const FocusAreaColorNode_u={none:p.NONE,bright:p.BRIGHT,dark:p.DARK};var formats=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl/formats.js"),FocusAreaMask_glsl=__webpack_require__("./node_modules/@arcgis/core/chunks/FocusAreaMask.glsl.js"),enums=__webpack_require__("./node_modules/@arcgis/core/views/webgl/enums.js");class i extends ShaderTechnique.w{constructor(r,o){super(r,o,new ReloadableShaderModule.$(FocusAreaMask_glsl.a,(()=>__webpack_require__.e(1428).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/views/3d/webgl-engine/shaders/FocusAreaMask.glsl.js")))))}initializePipeline(){return(0,renderState.Ey)({colorWrite:renderState.kn,depthTest:{func:enums.MT.LEQUAL}})}}var DefaultVertexAttributeLocations=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations.js"),DefaultVertexBufferLayouts=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts.js"),VertexArrayObject=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/VertexArrayObject.js"),BufferObject=__webpack_require__("./node_modules/@arcgis/core/views/webgl/BufferObject.js"),NoParameters=__webpack_require__("./node_modules/@arcgis/core/views/webgl/NoParameters.js");let b=class extends RenderNode.A{constructor(e){super({...e,view:e.focusAreas.view}),this.consumes={required:[webgl.OG.FOCUSAREA,webgl.hM.TRANSPARENT]},this.produces=webgl.OG.FOCUSAREA,this._vaos=new Array,this._counts=new Array,this._origins=new Array,this._maskParameters=new FocusAreaMask_glsl.F}initialize(){this.updateGeometries()}destroy(){this._vaos.forEach((e=>e.dispose())),this._vaos.length=this._counts.length=this._origins.length=0}precompile(){this.techniques.precompile(i)}render(e){const t=this.techniques.get(i),s=this.bindParameters,n=s.camera,c=n.fullViewport[2],h=n.fullViewport[3],p=this.fboCache.acquire(c,h,webgl.OG.FOCUSAREA,formats.N.RGBA);if(!t.compiled||!this._vaos)return this.requestRender(),p;const l=e.find((({name:e})=>e===webgl.hM.TRANSPARENT)),u=this.renderingContext;p.attachDepth(l.getAttachment(this.gl.DEPTH_STENCIL_ATTACHMENT)),u.bindFramebuffer(p.fbo),u.clear(enums.NV.COLOR|enums.NV.STENCIL),u.setViewport(0,0,c,h),u.gl.clearStencil(0),u.gl.clear(u.gl.STENCIL_BUFFER_BIT),u.setClearStencil(0);const E=u.bindTechnique(t,s);u.setFaceCullingEnabled(!1),u.setStencilTestEnabled(!0),u.setStencilOpSeparate(enums.Y7.FRONT,enums.eA.KEEP,enums.eA.INCR_WRAP,enums.eA.KEEP),u.setStencilOpSeparate(enums.Y7.BACK,enums.eA.KEEP,enums.eA.DECR_WRAP,enums.eA.KEEP),u.setDepthWriteEnabled(!1);for(let r=0;r<this._vaos.length;r++){const e=this._vaos[r],t=this._counts[r];this._maskParameters.origin=this._origins[r],E.bindDraw(s,NoParameters.m,this._maskParameters),u.bindVAO(e),u.setStencilWriteMask(255),u.setStencilFunction(enums.MT.ALWAYS,0,255),u.setColorMask(!1,!1,!1,!1),u.drawArrays(enums.WR.TRIANGLES,0,t),u.setStencilWriteMask(0),u.setStencilFunction(enums.MT.NOTEQUAL,0,255),u.setColorMask(!0,!0,!0,!0),u.drawArrays(enums.WR.TRIANGLES,0,t)}return p}updateGeometries(){if(!this.view._stage)return;this._vaos.forEach((e=>e.dispose())),this._vaos.length=this._counts.length=this._origins.length=0;const e=this.focusAreas.geometries;for(const t of e){const e=new Array,s=t.indicesBottom;for(let n=0;n<s.length;n++)e.push(t.positions[3*(s[n]-1)]),e.push(t.positions[3*(s[n]-1)+1]),e.push(t.positions[3*(s[n]-1)+2]);const r=t.indicesExtruded;for(let n=0;n<r.length;n++)e.push(t.positions[3*r[n]]),e.push(t.positions[3*r[n]+1]),e.push(t.positions[3*r[n]+2]);const o=new Float32Array(e),i=new VertexArrayObject.Z(this.renderingContext,DefaultVertexAttributeLocations.D,new Map([["geometry",DefaultVertexBufferLayouts.SL]]),new Map([["geometry",BufferObject.g.createVertex(this.renderingContext,enums._U.STATIC_DRAW,o)]]));this._vaos.push(i),this._counts.push(s.length+r.length),this._origins.push(t.origin)}this.requestRender()}};(0,tslib_es6._)([(0,property.MZ)()],b.prototype,"consumes",void 0),(0,tslib_es6._)([(0,property.MZ)()],b.prototype,"produces",void 0),(0,tslib_es6._)([(0,property.MZ)({constructOnly:!0})],b.prototype,"focusAreas",void 0),b=(0,tslib_es6._)([(0,subclass.$)("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaMaskNode")],b);class FocusAreaMaskNode_w{constructor(e,t,s,r,o,i){this.positions=e,this.indicesBottom=t,this.indicesExtruded=s,this.height=r,this.origin=o,this.color=i}}var R;!function(e){e[e.NONE=0]="NONE",e[e.BRIGHT=1]="BRIGHT",e[e.DARK=2]="DARK"}(R||(R={}));const k=.42,x=.32;function C(e,o){if(e){if("bright"===o){const o=(e[0]+e[1]+e[2])/3;return[o*x+(1-x),o*x+(1-x),o*x+(1-x),e[3]*x]}return"dark"===o?[e[0]*k,e[1]*k,e[2]*k,e[3]*k]:e}}let F=class extends Accessor.A{constructor(e){super(e),this.style="dark",this.geometries=new Array,this._areas=new Collection.A,this._elevationContext=new ElevationContext.F}initialize(){this.addHandles([(0,reactiveUtils.watch)((()=>this.style),(()=>this._updateRenderNodes()),reactiveUtils.pc)]),this.addHandles([(0,reactiveUtils.watch)((()=>this.activePolygons),(()=>this._updateFocusAreaGeometries()),reactiveUtils.pc)])}get activePolygons(){const e=new Collection.A;for(const o of this.areas)if(o.enabled)for(const s of o.geometries)e.push(s);return e}add(e){this.areas.add(e),this._updateFocusAreaGeometries()}addMany(e){this.areas.addMany(e),this._updateFocusAreaGeometries()}remove(e){this.areas.remove(e),this._updateFocusAreaGeometries()}removeMany(e){this.areas.removeMany(e),this._updateFocusAreaGeometries()}removeAll(){this.areas.removeAll(),this._updateFocusAreaGeometries()}containsGeometry(e){let o=!0;const s=new Point.default(e);return o=this.areas.some((e=>!!e.enabled&&!!e?.geometries.length&&e.geometries.some((e=>e.contains(s))))),o}get areas(){return this._areas}_updateFocusAreaGeometries(){this._extrudePolygons(),this._updateRenderNodes()}_extrudePolygons(){if(!this.view.renderCoordsHelper)return;this.geometries.length=0;const e=5e6,o=(0,vec3f64.vt)(),s=this.view.renderCoordsHelper.viewingMode===ViewingMode.RT.Global,r=(0,mat4f64.vt)(),t=(0,mat4f64.vt)();s||this.view.renderCoordsHelper.worldUpAtPosition([0,0,0],o);for(const i of this.areas)if(i.enabled)for(const a of i.geometries){const n=(0,graphicUtils.W$)(a);if(null==n)continue;(0,computeTranslationToOriginAndRotation.l)(a.spatialReference,[n.x,n.y,0],r,this.view.renderCoordsHelper.spatialReference);const m=(0,vec32.n)(P,[r[12]-0*o[0],r[13]-0*o[1],r[14]-0*o[2]]);t[12]=-r[12],t[13]=-r[13],t[14]=-r[14];const p=polygon_p(a,this.view.elevationProvider,this.view.renderCoordsHelper,this._elevationContext),{polygons:l,mapPositions:y,position:v}=p;for(const a of l){const n=a.count,d=(0,earcut.e)(a.mapPositions,a.holeIndices,3);if(0===d.length)continue;const p=d.length,l=6*n,h=(0,Indices.my)(l+p),_=(0,Indices.my)(p),w=(0,DoubleArray.jh)(3*l),A=(0,DoubleArray.jh)(3*l);nt(v,y,d,a,w,(0,DoubleArray.jh)(3*l),A,(0,DoubleArray.jh)(l),h,_,e,o,s),(0,vec3.t)(w,w,t);const k=new FocusAreaMaskNode_w(w,_,h,e,[r[12]+0*m[0],r[13]+0*m[1],r[14]+0*m[2]],i.outline?.color);this.geometries.push(k)}}this._maskRenderNode?.updateGeometries()}_updateRenderNodes(){this.view._stage&&("none"===this.style||0===this.geometries.length?(this._maskRenderNode=(0,maybe.pR)(this._maskRenderNode),this._colorRenderNode=(0,maybe.pR)(this._colorRenderNode)):(this._maskRenderNode??=new b({focusAreas:this}),this._colorRenderNode??=new n({focusAreas:this})))}};(0,tslib_es6._)([(0,property.MZ)()],F.prototype,"activePolygons",null),(0,tslib_es6._)([(0,property.MZ)()],F.prototype,"style",void 0),(0,tslib_es6._)([(0,property.MZ)()],F.prototype,"geometries",void 0),(0,tslib_es6._)([(0,property.MZ)({constructOnly:!0})],F.prototype,"view",void 0),(0,tslib_es6._)([(0,property.MZ)()],F.prototype,"_areas",void 0),F=(0,tslib_es6._)([(0,subclass.$)("esri.views.FocusAreas")],F);const P=(0,vec3f64.vt)();var constants=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/constants.js"),ElevationAligners=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/ElevationAligners.js"),aaBoundingRect=__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingRect.js"),ModelDirtyTypes=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/ModelDirtyTypes.js");class Graphics3DDrapedGraphicLayer_l{constructor(e,t,i,r){this.graphics3DSymbolLayer=e,this.renderGeometries=t,this.boundingBox=i,this._drapeSourceRenderer=r,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e.stage}setVisibility(e){if(null!=this.stage&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,ModelDirtyTypes.q.ADD);if(e||this._addedToStage){for(const e of this.renderGeometries)e.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,ModelDirtyTypes.k.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,ModelDirtyTypes.q.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(i=(0,vec3f64.vt)()){return(0,vec32.i)(i,0,0,0)}getBoundingBoxObjectSpace(e=(0,aaBoundingBox.vt)()){return(0,aaBoundingBox.Ie)(e)}addObjectState(e){e.stateType===basicInterfaces.Mg.Highlight&&(this.renderGeometries.forEach((t=>{const i=t.geometry.allocateIdAndHighlight(e.highlightName);e.addRenderGeometry(t,i,this)})),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,ModelDirtyTypes.k.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach((t=>e.removeByObject(t)))}updateHighlights(e){}removeRenderGeometryObjectState(e,t){t.channel===basicInterfaces.Mg.Highlight&&(e.geometry.removeHighlight(t),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries([e],ModelDirtyTypes.k.HIGHLIGHT))}computeAttachmentOrigin(e){for(const t of this.renderGeometries)t.geometry.computeAttachmentOrigin(Graphics3DDrapedGraphicLayer_f)&&(e.draped.origin[0]+=Graphics3DDrapedGraphicLayer_f[0],e.draped.origin[1]+=Graphics3DDrapedGraphicLayer_f[1],e.draped.num++)}async getProjectedBoundingBox(e,t,i,d,n){(0,aaBoundingBox.Ie)(n);for(let r=0;r<this.renderGeometries.length;r++){const t=this.renderGeometries[r];this._getRenderGeometryProjectedBoundingRect(t,e,Graphics3DDrapedGraphicLayer_u,i),(0,aaBoundingBox.DC)(n,Graphics3DDrapedGraphicLayer_u)}if(t){let e;(0,aaBoundingBox.gX)(n,Graphics3DDrapedGraphicLayer_f);const i=(0,graphicUtils.vY)(n,t.service.spatialReference,t);try{e=await t.service.queryElevation(Graphics3DDrapedGraphicLayer_f[0],Graphics3DDrapedGraphicLayer_f[1],d,i,"ground")}catch(a){}null!=e&&(n[2]=Math.min(n[2],e),n[5]=Math.max(n[5],e))}return n}_getRenderGeometryProjectedBoundingRect(e,t,i,r){if(this.boundingBox)(0,aaBoundingBox.hZ)(Graphics3DDrapedGraphicLayer_p,this.boundingBox);else{const t=e.boundingSphere,i=t[3];Graphics3DDrapedGraphicLayer_p[0]=t[0]-i,Graphics3DDrapedGraphicLayer_p[1]=t[1]-i,Graphics3DDrapedGraphicLayer_p[2]=t[2]-i,Graphics3DDrapedGraphicLayer_p[3]=t[0]+i,Graphics3DDrapedGraphicLayer_p[4]=t[1]+i,Graphics3DDrapedGraphicLayer_p[5]=t[2]+i}return t(Graphics3DDrapedGraphicLayer_p,0,2),this.calculateRelativeScreenBounds&&r.push({location:(0,aaBoundingBox.gX)(Graphics3DDrapedGraphicLayer_p),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),(0,aaBoundingBox.ES)(Graphics3DDrapedGraphicLayer_p,i)}}const Graphics3DDrapedGraphicLayer_u=(0,aaBoundingRect.vt)(),Graphics3DDrapedGraphicLayer_p=(0,aaBoundingBox.vt)(),Graphics3DDrapedGraphicLayer_f=(0,vec3f64.vt)();var placementUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/placementUtils.js"),pointUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/pointUtils.js"),FastSymbolUpdates=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/support/FastSymbolUpdates.js"),sdfPrimitives=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/engineContent/sdfPrimitives.js"),GeometryUtil=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/GeometryUtil.js"),RenderGeometry=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/RenderGeometry.js"),Texture=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/Texture.js"),HUDMaterial=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/materials/HUDMaterial.js");const se=(0,vec3f64.fA)(0,0,1),ne=[sdfPrimitives.Q_*sdfPrimitives.CN,sdfPrimitives.Q_*sdfPrimitives.CN];class le extends Graphics3DSymbolLayer.U{getCachedSize(){return{size:this._getIconSize()}}constructor(e,t,r,i){super(e,t,r,i),this._cimData=null,this._overrideHelperClass=null,this._arcadeInfo=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._textureHandle=null,this._patchTask=null,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const t=this._prepareMaterialParameters(),r=this._getPrimitive();if(null!=r)this._prepareResourcesPrimitive(t,r);else{const r=(0,support_utils.N7)(this.symbolLayer),i=ue(r);null!=i?await this._prepareResourcesCIM(t,JSON.parse(i),e):await this._prepareResourcesHref(t,r,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=(0,graphicUtils.Hj)(this._getIconSize());if(e)throw new core_Error.A("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,t=Math.round(null!=e.size?(0,screenUtils.Lz)(e.size):16);return this._drivenProperties.size?Math.max(t,64):t}_generateTextureCIM(e){const t=this._overrideHelperClass;let r=this._cimData;if(t&&r&&r.symbol||this.logger.error("Can't create texture, CIM data is undefined"),r.primitiveOverrides){r=(0,lang.o8)(r);const i=r.primitiveOverrides;t.evaluateOverrides(i,e,this._arcadeInfo.geometryType,null,null),t.applyOverrides(r.symbol,i)}const i=(0,string.Wm)(JSON.stringify(r));let o=this._cimSymbolTextures.get(i);if(o)return o;const a=this._context.sharedResources.cimSymbolRasterizer,n=this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null;n&&t.applyDictionaryTextOverrides(r.symbol,e,n,null);const l=null!=this._cimScaleFactorOrFunction?(0,utils.s4)(this._cimScaleFactorOrFunction,e):1;1!==l&&r.symbol&&(0,cimSymbolUtils.Km)(r.symbol,l,!0);const c=CIMSymbolHelper.wp.getEnvelope(r,null,a.resourceManager);if(c?.width&&c.height){const e=c.x+c.width/2,t=c.y+c.height/2,i=a.rasterize({type:"cim",data:r},c.width,c.height,e,t,1,"esriGeometryPoint",0,null,this._context.graphicsCoreOwner.view.state.rasterPixelRatio),s=new Symbol3DAnchorPosition2D.Q({x:-c.x/c.width-.5,y:(c.height+c.y)/c.height-.5});this._cimMaterialParametersInfo.anchorPosition=me("relative",s),o=new Texture.g(i,{width:i?.width??1,height:i?.height??1,reloadable:!0})}else o=new Texture.g(new ImageData(1,1),{width:1,height:1,reloadable:!0});return this._cimSymbolTextures.set(i,o),this._context.stage.add(o),o}_prepareMaterialParameters(){const e={anchorPosition:me(this.symbolLayer.anchor,this.symbolLayer.anchorPosition),rotation:this.symbolLayer.angle},t=this.symbol;if(function ce(e){return e&&"point-3d"===e.type&&e.hasVisibleVerticalOffset()}(t)){const{screenLength:r,minWorldLength:i,maxWorldLength:s}=t.verticalOffset;e.verticalOffset={screenLength:(0,screenUtils.Lz)(r),minWorldLength:i||0,maxWorldLength:null!=s?s:1/0}}this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),(0!==e.rotation||this._drivenProperties.rotation)&&(e.hasRotation=!0);const r=!!(0,has.A)("enable-feature:non-occluded-hud");return e.occlusionTest=!r,e.occludedFragmentFade=r,e.horizonCullingEnabled=r&&this._context.spherical,e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,t){const r=this._getOutlineSize();if(he(t)&&0===r)throw new Error("Nothing to render");if(this._outlineSize=r,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,null!=this._context.sharedResources.textures){const r=this._context.sharedResources.textures.fromData(`${t}-icon`,(()=>(0,sdfPrimitives.sZ)(t)));this._textureHandle=r,e.textureId=r.texture.id}e.textureIsSignedDistanceField=!0,e.sampleSignedDistanceFieldTexelCenter=(0,sdfPrimitives.ny)(t),e.distanceFieldBoundingBox=sdfPrimitives.PY;const i=this._getIconSize();this._size=[i,i],this._symbolTextureRatio=1/sdfPrimitives.CN,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,r,s){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const o=this._getIconSize(),a=o*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(null!=this._context.sharedResources.textures){const l=await(0,asyncUtils.Ke)(this._context.sharedResources.textures.fromUrl(r,a,{signal:s}));if(!1===l.ok)throw(0,promiseUtils.QP)(l.error),new core_Error.A("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${r})`);this._textureHandle=l.value;const c=l.value.texture;this._size=de(c,o),e.textureId=c.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,t,r){const{OverrideHelper:i}=await __webpack_require__.e(7731).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/symbols/cim/OverrideHelper.js"));if(this._overrideHelperClass=i,this._cimData=t,!this._context.sharedResources.cimSymbolRasterizer){const e=(await __webpack_require__.e(8284).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/symbols/cim/CIMSymbolRasterizer.js"))).CIMSymbolRasterizer;(0,promiseUtils.Te)(r),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new e(this._context.renderCoordsHelper.spatialReference))}const s=this._context.sharedResources.cimSymbolRasterizer,o=[],a=t,n=a?.symbol;CIMSymbolHelper.wp.fetchResources(n,s.resourceManager,o,r),CIMSymbolHelper.wp.fetchFonts(n,s.resourceManager,o);const c=this._context.layer.fields?this._context.layer.fields.map((e=>e.toJSON())):[],h=this._context.renderCoordsHelper.spatialReference;if(this._arcadeInfo={spatialReference:h,fields:c,geometryType:"esriGeometryPoint"},a?.primitiveOverrides&&o.push(i.createRenderExpressions(a.primitiveOverrides,this._arcadeInfo)),o.length>0&&(await Promise.all(o),(0,promiseUtils.Te)(r)),this._context.renderer&&"dictionary"===this._context.renderer.type&&this._context.renderer.scaleExpression){const e=this._context.renderer;if(e.scaleExpression){const t=e.scaleExpression,r=await(0,arcadeOnDemand.Ad)(t,this._context.layer.spatialReference,c),{default:i}=await __webpack_require__.e(6081).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/views/2d/arcade/callExpressionWithFeature.js"));this._cimScaleFactorOrFunction=(e,t,s)=>{const o=i(r,e,{$view:s},"esriGeometryPoint",t);return null!==o?o:1}}}(0,promiseUtils.Te)(r),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource?.href?null:this.symbolLayer.resource?.primitive??IconSymbol3DLayerResource.r}_getOutlineSize(){let e=0;const t=this.symbolLayer;return null!=t.outline?.size?Math.max((0,screenUtils.Lz)(t.outline.size),0):(e=he(this._getPrimitive())?1.5:0,Math.max(e,0))}_getOutlineColor(){const t=this._getLayerOpacity(),r=this.symbolLayer,i=r?.outline?.color;if(null!=i){const r=Color.A.toUnitRGB(i),s=i.a*t;return[r[0],r[1],r[2],s]}return[0,0,0,0]}_getFillColor(){if(he(this._getPrimitive()))return constants.r4;const e=null==this._getPrimitive(),t=this.symbolLayer?.material?.color;return this._getCombinedOpacityAndColor(t,{hasIntrinsicColor:e})}_createMaterialAndAddToStage(e,t){const r=this._context.spherical;if(this._cimData){this._fastUpdates=null;let i=e.textureId?this._cimSymbolMaterials.get(e.textureId):null;return i||(i=new HUDMaterial.R(e,r),this._cimSymbolMaterials.set(e.textureId??0,i),t.add(i)),i}if(this._fastUpdates=(0,FastSymbolUpdates.s_)(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates&&(e={...e,...this._fastUpdates.materialParameters}),this._materials[0]=new HUDMaterial.R(e,r),t.add(this._materials[0]),this._context.graphicsCoreOwner.view.focusAreas.activePolygons.length>0){e.isFocused=!1;const i=this._context.stage.view.focusAreas.style;e.color=C(e.color,i),e.outlineColor=C(e.outlineColor,i),this._materials[1]=new HUDMaterial.R(e,r),t.add(this._materials[1])}return this._materials[0]}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial((e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,draped:this.draped})})),this.layerOpacityChanged())}destroy(){super.destroy(),this._patchTask=(0,maybe.DC)(this._patchTask),this._forEachMaterial((e=>this._context.stage.remove(e))),this._materials.length=0,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach((e=>this._context.stage.remove(e))),this._cimSymbolTextures.clear(),this._textureHandle=(0,maybe.Gz)(this._textureHandle)}_getScaleFactor(e,t){if(this._drivenProperties.size&&e.size){const r=Array.from(e.size);for(let e=0;e<3;e++){const t=r[e];t&&"symbol-value"!==t&&"proportional"!==t&&(r[e]=(0,screenUtils.Lz)(t))}if("symbol-value"===r[0])return 1;if(isFinite(+r[0]))return+r[0]/t;if(isFinite(+r[2]))return+r[2]/t}return 1}_getDrivenRotation(e){return this._drivenProperties.rotation?e.heading??0:0}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry))return null;let r,i=[0,0];const s=(0,pointUtils.ZX)(t.geometry);if(null==s)return this.logger.warn(`unsupported geometry type for text symbol: ${t.geometry.type}`),null;const o=this._context.stage.view.focusAreas.containsGeometry(s);if(this._cimData){if(!this._cimData.symbol)return null;const e=this._generateTextureCIM(t),s={textureId:e.id,isFocused:o,...this._cimMaterialParametersInfo};r=this._createMaterialAndAddToStage(s,this._context.stage);const a=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;i=[e.parameters.width/a,e.parameters.height/a]}else i=this._size,r=o||1===this._materials.length?this._materials[0]:this._materials[1];if(null==s)return this.logger.warn(`unsupported geometry type for icon symbol: ${t.geometry.type}`),null;const a=e.renderingInfo,n=this._getVertexOpacityAndColor(a),l=this._getDrivenRotation(a);let c=1;if(!this._fastUpdates?.visualVariables.size){const e=i[0]>i[1]?i[0]:i[1];c=this._getScaleFactor(a,e)}c*=this._symbolTextureRatio;const h=(0,vec2f64.fA)(i[0]*c,i[1]*c),u=this.setGraphicElevationContext(t);return this.ensureDrapedStatus("on-the-ground"===u.mode)&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(t,s,r,n,l,h,e.layer.uid):this._createAs3DShape(t,s,r,n,l,h,u,t.uid)}layerOpacityChanged(){const e=this._getFillColor(),t=this._getOutlineColor();this._forEachMaterial((r=>{r.setParameters({color:e}),r.setParameters({outlineColor:t})}))}updateGeometry(e,t){if(this.draped||!this._validateGeometry(t))return!1;const{elevationContext:r,stageObject:i}=e;if(r.mode!==this.getGeometryElevationMode(t))return!1;const s=(0,pointUtils.ZX)(t);if(!s)return!1;const o=(0,pointUtils.hS)(i,this._context,s,r);if(null==o)return!1;const a=(0,pointUtils.R$)(this._context,s);return i.geometries[0].localOrigin===a&&(e.alignedSampledElevation=o,(0,pointUtils.d2)(e,s,this._context.elevationProvider),!0)}layerElevationInfoChanged(e,t,r){const i=this._elevationContext.mode,s=(0,elevationAlignmentUtils.I2)(le.elevationModeChangeTypes,r,i);if(s!==elevationAlignmentUtils.uw.UPDATE)return s;const o=(0,elevationAlignmentUtils.nu)(i)||"absolute-height"===i;return this.updateGraphics3DGraphicElevationInfo(e,t,(()=>o))}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial((e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})})),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return null!=this._getPrimitive()}applyRendererDiff(e,t){for(const r in e.diff){if("visualVariables"!==r)return interfaces.w.RecreateSymbol;if(!(0,FastSymbolUpdates.J_)(this._fastUpdates,t,this._fastVisualVariableConvertOptions()))return interfaces.w.RecreateSymbol;this._materials[0]?.setParameters(this._fastUpdates.materialParameters)}return interfaces.w.FastUpdate}updateFocus(e,t){t.forEach((t=>{const r=this._context.stage.view.focusAreas.containsGeometry(t.graphic.geometry);t.layers.forEach((i=>{i?.graphics3DSymbolLayer===this&&i.stageObject.geometries.some((e=>e.material.parameters.isFocused!==r))&&e(t)}))}))}prepareSymbolLayerPatch(e){if(this._patchTask?.abort(),"partial"!==e.diff.type)return;const t=e.diff.diff;this._preparePatchResource(e,t),this._preparePatchRotation(e,t)}_preparePatchResource(e,s){if(!s.resource||"partial"!==s.resource.type)return;const c=s.resource.diff;if("complete"!==c?.href?.type)return;const h=c.href.newValue,{textures:u}=this._context.sharedResources;if(null==h||null==u||null!=ue(h))return;const m=this._getIconSize(),d=m*this._context.graphicsCoreOwner.view.state.pixelRatio;e.symbolLayerStatePatches.push((()=>{this._patchTask=(0,maybe.DC)(this._patchTask),this._patchTask=(0,asyncUtils.UT)((e=>this._context.schedule((async(e,r)=>{const s=await(0,asyncUtils.Ke)(u.fromUrl(h,d,{signal:r}));(0,promiseUtils.Te)(r);const o=!s.ok;if(o&&(0,promiseUtils.QP)(s.error),this._textureHandle=(0,maybe.Gz)(this._textureHandle),this._patchTask=null,o){this._forEachMaterial((e=>{e.visible=!1,e.setParameters({textureId:null})}));const e=`Failed to load (Request for icon resource failed: ${h})`;return void this.logger.error(new core_Error.A("graphics3diconsymbollayer:request-failed",e))}this._textureHandle=s.value;const c=s.value.texture;this._size=de(c,m),this._forEachMaterial((e=>{e.setParameters({textureId:c.id}),e.visible=!0}))}),e)))})),delete c.href}_preparePatchRotation(e,t){if(!t.angle||"complete"!==t.angle.type)return;const r=t.angle.newValue??0,i=0!==r||this._drivenProperties.rotation;e.symbolLayerStatePatches.push((()=>{this._forEachMaterial((e=>e.setParameters({rotation:r,hasRotation:i})))})),delete t.angle}_defaultElevationInfoNoZ(){return pe}_createAs3DShape(e,t,r,i,s,o,a,n){const l=this.getFastUpdateAttrValues(e),c=this._context.layer.uid,h=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:c}),u=(0,GeometryUtil.DJ)(r,{normal:se,color:i,rotation:s,size:o,centerOffsetAndDistance:_e,featureAttribute:l,objectAndLayerIdColor:h}),m=(0,pointUtils.SZ)(this._context,t,u,a,n);if(null==m)return null;const d=new Graphics3DObject3DGraphicLayer.Y(this,m.object,[u],null,null,ElevationAligners.G8,a);return d.alignedSampledElevation=m.sampledElevation,d.needsElevationUpdates=(0,elevationAlignmentUtils.nu)(a.mode)||"absolute-height"===a.mode,d.getScreenSize=this._createScreenSizeGetter(o,l),d.calculateRelativeScreenBounds=e=>r.calculateRelativeScreenBounds(d.getScreenSize(),1,e),(0,pointUtils.d2)(d,t,this._context.elevationProvider),d}_createAsOverlay(e,t,r,i,s,o,a){r.renderPriority=this._renderPriority;const n=(0,vec3f64.vt)();(0,projectPointToVector.g)(t,n,this._context.overlaySR),n[2]=OverlayRenderer.bi;const l=this._context.clippingExtent;if(null!=l&&!(0,aaBoundingBox.Uc)(l,n))return null;const c=this.getFastUpdateAttrValues(e),h=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),u=(0,GeometryUtil.DJ)(r,{normal:se,position:n,color:i,rotation:s,size:o,featureAttribute:c,objectAndLayerIdColor:h}),m=new RenderGeometry.$(u,{layerUid:a,graphicUid:e.uid}),d=new Graphics3DDrapedGraphicLayer_l(this,[m],null,this._context.drapeSourceRenderer);return d.getScreenSize=this._createScreenSizeGetter(o,c),d.calculateRelativeScreenBounds=e=>r.calculateRelativeScreenBounds(d.getScreenSize(),1,e),d}_createScreenSizeGetter(e,t){const r=this._outlineSize+2;if(this._fastUpdates&&t){const i=e[0]/this._symbolTextureRatio,s=e[1]/this._symbolTextureRatio;return(e=(0,vec2f64.vt)())=>{const[o,a]=(0,FastSymbolUpdates.VC)(fe,this._fastUpdates.materialParameters,t);return e[0]=o*i+r,e[1]=a*s+r,e}}const i=e[0]/this._symbolTextureRatio+r,s=e[1]/this._symbolTextureRatio+r;return(e=(0,vec2f64.vt)())=>(e[0]=i,e[1]=s,e)}_fastVisualVariableConvertOptions(){const e=Math.max(this._size[0],this._size[1]),t=(0,vec3f64.fA)(e,e,e),r=(0,screenUtils.PN)(1),i=e*r,s=(0,vec3f64.fA)(i,i,i);return new FastSymbolUpdates.wI({size:!0,color:!0,rotation:!0,opacity:!1},t,s,r)}_forEachMaterial(e){this._materials.forEach(e),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._materials[0]}}}function he(e){return null!=e&&("cross"===e||"x"===e)}function ue(e){const t=(0,urlUtils.r$)(e);return"application/json"===t?.mediaType?t.data:void 0}function me(e,t){return"relative"===e?(0,vec2f64.fA)((t.x||0)+.5,.5-(t.y||0)):e in placementUtils.Zd?placementUtils.Zd[e]:placementUtils.Zd.center}function de({parameters:e},t){const r=(e.width??1)/(e.height??1);return r>1?[t,Math.round(t/r)]:[Math.round(t*r),t]}le.PRIMITIVE_SIZE=ne,le.elevationModeChangeTypes={definedChanged:elevationAlignmentUtils.uw.UPDATE,staysOnTheGround:elevationAlignmentUtils.uw.NONE,onTheGroundChanged:elevationAlignmentUtils.uw.RECREATE};const pe={mode:"relative-to-ground",offset:0},_e=(0,vec4f64.fA)(0,0,0,1),fe=(0,vec3f64.vt)();var RibbonLineTechniqueConfiguration=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/shaders/RibbonLineTechniqueConfiguration.js");function lineUtils_n(n){switch(n){case"butt":return RibbonLineTechniqueConfiguration.x.BUTT;case"square":return RibbonLineTechniqueConfiguration.x.SQUARE;case"round":return RibbonLineTechniqueConfiguration.x.ROUND;default:return null}}function lineUtils_r(e){return"diamond"===e?"kite":e}var line=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/engineContent/line.js"),renderInfoUtils_line=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/renderInfoUtils/line.js"),InterleavedLayout=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/buffer/InterleavedLayout.js"),ShaderOutput=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/ShaderOutput.js"),GLTextureMaterial=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/GLTextureMaterial.js"),Material=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/Material.js"),RenderSlot=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/RenderSlot.js"),VisualVariablePassParameters=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/materials/VisualVariablePassParameters.js"),OrderIndependentTransparency=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/OrderIndependentTransparency.js"),StencilUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/StencilUtils.js"),LineMarker_glsl=__webpack_require__("./node_modules/@arcgis/core/chunks/LineMarker.glsl.js"),LineMarkerTechniqueConfiguration=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration.js");class W extends ShaderTechnique.w{constructor(e,i){super(e,i,new ReloadableShaderModule.$(LineMarker_glsl.L,(()=>__webpack_require__.e(2311).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/views/3d/webgl-engine/shaders/LineMarker.glsl.js")))),LineMarkerTechnique_b)}_makePipelineState(t,r){const{output:p,oitPass:d,space:T,hasOccludees:h}=t;return(0,renderState.Ey)({blending:(0,ShaderOutput.RN)(p)?(0,OrderIndependentTransparency.Yf)(d):null,depthTest:T===LineMarkerTechniqueConfiguration.lM.Draped?null:{func:(0,OrderIndependentTransparency.K_)(d)},depthWrite:(0,OrderIndependentTransparency.z5)(t),drawBuffers:p===ShaderOutput.V.Depth?{buffers:[enums.Hr.NONE]}:(0,OrderIndependentTransparency.m6)(d,p),colorWrite:renderState.kn,stencilWrite:h?StencilUtils.v0:null,stencilTest:h?r?StencilUtils.a9:StencilUtils.qh:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(e){return e.occluder?(this._occluderPipelineTransparent=(0,renderState.Ey)({blending:renderState.Ky,depthTest:StencilUtils.sf,depthWrite:null,colorWrite:renderState.kn,stencilWrite:null,stencilTest:StencilUtils.mK}),this._occluderPipelineOpaque=(0,renderState.Ey)({blending:renderState.Ky,depthTest:StencilUtils.sf,depthWrite:null,colorWrite:renderState.kn,stencilWrite:StencilUtils.r8,stencilTest:StencilUtils.I$}),this._occluderPipelineMaskWrite=(0,renderState.Ey)({blending:null,depthTest:StencilUtils.m,depthWrite:null,colorWrite:null,stencilWrite:StencilUtils.v0,stencilTest:StencilUtils.a9})):this._occluderPipelineTransparent=this._occluderPipelineOpaque=this._occluderPipelineMaskWrite=null,this._occludeePipelineState=this._makePipelineState(e,!0),this._makePipelineState(e,!1)}getPipeline(e,i){return e?this._occludeePipelineState:i===RenderSlot.N.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent??super.getPipeline():i===RenderSlot.N.OCCLUDER_MATERIAL?this._occluderPipelineOpaque??super.getPipeline():this._occluderPipelineMaskWrite??super.getPipeline()}}const LineMarkerTechnique_b=new Map([[VertexAttribute.r.POSITION,0],[VertexAttribute.r.PREVPOSITION,1],[VertexAttribute.r.UV0,2],[VertexAttribute.r.NORMAL,3],[VertexAttribute.r.COLOR,4],[VertexAttribute.r.COLORFEATUREATTRIBUTE,4],[VertexAttribute.r.SIZE,5],[VertexAttribute.r.SIZEFEATUREATTRIBUTE,5],[VertexAttribute.r.OPACITYFEATUREATTRIBUTE,6]]);var AlphaCutoff=__webpack_require__("./node_modules/@arcgis/core/webscene/support/AlphaCutoff.js");class S extends Material.im{constructor(e){super(e,I),this._configuration=new LineMarkerTechniqueConfiguration.Dt,this.vertexAttributeLocations=LineMarkerTechnique_b,this.produces=new Map([[RenderSlot.N.OPAQUE_MATERIAL,e=>e===ShaderOutput.V.Highlight||(0,ShaderOutput._o)(e)&&this.parameters.renderOccluded===Material.m$.OccludeAndTransparentStencil],[RenderSlot.N.OPAQUE_MATERIAL_WITHOUT_NORMALS,e=>(0,ShaderOutput.eh)(e)],[RenderSlot.N.OCCLUDER_MATERIAL,e=>(0,ShaderOutput.aD)(e)&&this.parameters.renderOccluded===Material.m$.OccludeAndTransparentStencil],[RenderSlot.N.TRANSPARENT_OCCLUDER_MATERIAL,e=>(0,ShaderOutput.aD)(e)&&this.parameters.renderOccluded===Material.m$.OccludeAndTransparentStencil],[RenderSlot.N.TRANSPARENT_MATERIAL,e=>(0,ShaderOutput._o)(e)&&this.parameters.writeDepth],[RenderSlot.N.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>(0,ShaderOutput._o)(e)&&!this.parameters.writeDepth],[RenderSlot.N.DRAPED_MATERIAL,e=>(0,ShaderOutput.RN)(e)||e===ShaderOutput.V.Highlight]]),this._layout=this.createLayout()}getConfiguration(e,t){return this._configuration.output=e,this._configuration.space=t.slot===RenderSlot.N.DRAPED_MATERIAL?LineMarkerTechniqueConfiguration.lM.Draped:this.parameters.worldSpace?LineMarkerTechniqueConfiguration.lM.World:LineMarkerTechniqueConfiguration.lM.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==RibbonLineTechniqueConfiguration.x.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=t.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===Material.m$.OccludeAndTransparentStencil,this._configuration.oitPass=t.oitPass,this._configuration.terrainDepthTest=t.terrainDepthTest&&(0,ShaderOutput.RN)(e),this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration}get visible(){return this.parameters.color[3]>=AlphaCutoff.Q}intersect(){}createLayout(){const e=(0,InterleavedLayout.BP)().vec3f(VertexAttribute.r.POSITION).vec3f(VertexAttribute.r.PREVPOSITION).vec2f(VertexAttribute.r.UV0);return this.parameters.worldSpace&&e.vec3f(VertexAttribute.r.NORMAL),this.parameters.vvSize?e.f32(VertexAttribute.r.SIZEFEATUREATTRIBUTE):e.f32(VertexAttribute.r.SIZE),this.parameters.vvColor?e.f32(VertexAttribute.r.COLORFEATUREATTRIBUTE):e.vec4f(VertexAttribute.r.COLOR),this.parameters.vvOpacity&&e.f32(VertexAttribute.r.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new LineMarkerMaterial_P(this._layout,this.parameters)}createGLMaterial(e){return new LineMarkerMaterial_R(e)}}class LineMarkerMaterial_R extends GLTextureMaterial.m8{constructor(){super(...arguments),this._markerPrimitive=null}dispose(){super.dispose(),this._markerTextures.release(this._markerPrimitive),this._markerPrimitive=null}beginSlot(e){const t=this._material.parameters.markerPrimitive;return t!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextures.swap(t,this._markerPrimitive)}),this._markerPrimitive=t),this._material.setParameters(this.textureBindParameters),this.getTechnique(W,e)}}class I extends VisualVariablePassParameters.S{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.markerPrimitive="arrow",this.placement="end",this.cap=RibbonLineTechniqueConfiguration.x.BUTT,this.anchor=LineMarkerTechniqueConfiguration.kJ.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.markerTexture=null}}class LineMarkerMaterial_P{constructor(e,t){this.vertexBufferLayout=e,this._parameters=t}elementCount(){return"begin-end"===this._parameters.placement?12:6}write(i,a,s,n,o,h){const c=s.get(VertexAttribute.r.POSITION).data,p=c.length/3;let m=[1,0,0];const l=s.get(VertexAttribute.r.NORMAL);this._parameters.worldSpace&&null!=l&&(m=l.data);let u=1,d=0;this._parameters.vvSize?d=s.get(VertexAttribute.r.SIZEFEATUREATTRIBUTE).data[0]:s.has(VertexAttribute.r.SIZE)&&(u=s.get(VertexAttribute.r.SIZE).data[0]);let f=[1,1,1,1],A=0;this._parameters.vvColor?A=s.get(VertexAttribute.r.COLORFEATUREATTRIBUTE).data[0]:s.has(VertexAttribute.r.COLOR)&&(f=s.get(VertexAttribute.r.COLOR).data);let _=0;this._parameters.vvOpacity&&(_=s.get(VertexAttribute.r.OPACITYFEATUREATTRIBUTE).data[0]);const v=new Float32Array(o.buffer);let E=h*(this.vertexBufferLayout.stride/4);const g=(e,t,r,i)=>{if(v[E++]=e[0],v[E++]=e[1],v[E++]=e[2],v[E++]=t[0],v[E++]=t[1],v[E++]=t[2],v[E++]=r[0],v[E++]=r[1],this._parameters.worldSpace&&(v[E++]=m[0],v[E++]=m[1],v[E++]=m[2]),this._parameters.vvSize?v[E++]=d:v[E++]=u,this._parameters.vvColor)v[E++]=A;else{const e=Math.min(4*i,f.length-4);v[E++]=f[e],v[E++]=f[e+1],v[E++]=f[e+2],v[E++]=f[e+3]}this._parameters.vvOpacity&&(v[E++]=_)};let O;!function(e){e[e.ASCENDING=1]="ASCENDING",e[e.DESCENDING=-1]="DESCENDING"}(O||(O={}));const S=(a,s)=>{const n=(0,vec32.i)(L,c[3*a],c[3*a+1],c[3*a+2]),o=LineMarkerMaterial_C;let h=a+s;do{(0,vec32.i)(o,c[3*h],c[3*h+1],c[3*h+2]),h+=s}while((0,vec32.I)(n,o)&&h>=0&&h<p);i&&((0,vec32.t)(n,n,i),(0,vec32.t)(o,o,i)),g(n,o,[-1,-1],a),g(n,o,[1,-1],a),g(n,o,[1,1],a),g(n,o,[-1,-1],a),g(n,o,[1,1],a),g(n,o,[-1,1],a)},R=this._parameters.placement;"begin"!==R&&"begin-end"!==R||S(0,O.ASCENDING),"end"!==R&&"begin-end"!==R||S(p-1,O.DESCENDING)}}const L=(0,vec3f64.vt)(),LineMarkerMaterial_C=(0,vec3f64.vt)();var lineStippleUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/materials/lineStippleUtils.js"),RibbonLineMaterial=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/materials/RibbonLineMaterial.js");const Graphics3DLineSymbolLayer_G=["polyline","polygon","extent"],O=new FastSymbolUpdates.wI({size:!0,color:!0,rotation:!1,opacity:!0});class V extends Graphics3DSymbolLayer.U{constructor(e,t,r,i){super(e,t,r,i)}async doLoad(){if(this._fastUpdates=(0,FastSymbolUpdates.s_)(this._context.renderer,O),!this._drivenProperties.size&&(null!=this.symbolLayer.size?this.symbolLayer.size:(0,screenUtils.PN)(1))<0)throw new core_Error.A("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values")}_getMaterialParameters(e,t=!1){const r=this._getCombinedOpacityAndColor(t&&this._markerColor||this._materialColor);this._patternHidesLine&&!t&&(r[3]=0);const i={width:this._computeMaterialWidth(this.symbolLayer?.size),color:r,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:lineUtils_n(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:(0,lineStippleUtils.Xq)(this.symbolLayer.pattern)};return this._fastUpdates?.visualVariables?{...i,...this._fastUpdates.materialParameters}:i}get _materialColor(){return this.symbolLayer.material?.color}get _markerColor(){return this.symbolLayer.marker?.color}get _lineMaterial(){return null==this._materials[H.Line]&&(this._materials[H.Line]=new RibbonLineMaterial.W(this._getMaterialParameters(!1)),this._context.stage.add(this._materials[H.Line])),this._materials[H.Line]}get _ringMaterial(){return null==this._materials[H.Ring]&&(this._materials[H.Ring]=new RibbonLineMaterial.W(this._getMaterialParameters(!0)),this._context.stage.add(this._materials[H.Ring])),this._materials[H.Ring]}get _wireframeLineMaterial(){return null==this._materials[H.LineWireframe]&&(this._materials[H.LineWireframe]=new RibbonLineMaterial.W({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._materials[H.LineWireframe])),this._materials[H.LineWireframe]}get _wireframeRingMaterial(){return null==this._materials[H.RingWireframe]&&(this._materials[H.RingWireframe]=new RibbonLineMaterial.W({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._materials[H.RingWireframe])),this._materials[H.RingWireframe]}get _markerMaterial(){return null==this._materials[H.Marker]&&null!=this.symbolLayer.marker&&(this._materials[H.Marker]=new S({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:lineUtils_r(this.symbolLayer.marker.style)}),this._context.stage.add(this._materials[H.Marker])),this._materials[H.Marker]}destroy(){super.destroy(),this._forEachMaterial((e=>this._context.stage.remove(e))),this._materials.length=0}_getDrivenSize(e){return this._drivenProperties.size&&e.size?(0,screenUtils.Lz)((0,renderingInfoUtils.or)(e.size)):1}_getDrivenColor(e){const t=(0,vec4f64.fA)(1,1,1,1);return this._drivenProperties.color&&e.color&&(t[0]=e.color[0],t[1]=e.color[1],t[2]=e.color[2],e.color.length>0&&(t[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(t[3]=e.opacity),t}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,Graphics3DLineSymbolLayer_G,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(t);return this.ensureDrapedStatus("on-the-ground"===r.mode),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,r,t.uid)}applyRendererDiff(e,t){for(const r in e.diff){if("visualVariables"!==r)return interfaces.w.RecreateSymbol;{const e=this._fastUpdates;if(!(0,FastSymbolUpdates.J_)(e,t,O))return interfaces.w.RecreateSymbol;this._forEachMaterial((t=>t?.setParameters(e.materialParameters)))}}return interfaces.w.FastUpdate}prepareSymbolLayerPatch(e){if("partial"!==e.diff.type)return;const t=e.diff.diff,r={};"complete"===t.size?.type&&(r.width=this._computeMaterialWidth(t.size.newValue),delete t.size),"complete"===t.cap?.type&&(r.cap=lineUtils_n(t.cap.newValue??"butt"),delete t.cap);const i=this._prepareMarkerPatch(e,t);this._prepareMaterialPatch(e,t,i),e.symbolLayerStatePatches.push((()=>this._forEachMaterial((e=>e?.setParameters(r)))))}layerOpacityChanged(){this._forEachMaterial(((e,t)=>this._updateMaterialLayerOpacity(e,t===H.Marker)))}_forEachMaterial(e){this._materials.forEach(e)}_updateMaterialLayerOpacity(e,t=!1){if(null==e)return;const r=e.parameters.color,a=this.symbolLayer?.material?.color,s=this._patternHidesLine&&!t?0:this._getCombinedOpacity(a),n=(0,vec4f64.fA)(r[0],r[1],r[2],s);e.setParameters({color:n})}layerElevationInfoChanged(e,t,r){const i=this._elevationContext.mode,a=(0,elevationAlignmentUtils.I2)(V.elevationModeChangeTypes,r,i);if(a!==elevationAlignmentUtils.uw.UPDATE)return a;const s=(0,elevationAlignmentUtils.nu)(i);return this.updateGraphics3DGraphicElevationInfo(e,t,(()=>s))}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial((t=>t?.setParameters(e))),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,t,r){const i=Graphics3DLineSymbolLayer_I(e.graphic.geometry),a="polygon"===i.type?i.rings:i.paths,s=new Array,n=(0,aaBoundingBox.vt)(),m=(0,renderInfoUtils_line.C)(i,this._context.elevationProvider,this._context.renderCoordsHelper,t),p="polygon"===i.type?"rings":"paths";this._logGeometryCreationWarnings(m,a,p,"LineSymbol3DLayer");for(let o=0;o<m.lines.length;o++){const t=m.lines[o],a=t.position,p=t.mapPositions;if(null!=this._context.clippingExtent&&((0,aaBoundingBox.vY)(p,n),!(0,aaBoundingBox.KG)(n,this._context.clippingExtent)))continue;const c=this._createGeometry("polygon"===i.type?this._ringMaterial:this._lineMaterial,e,a,p,i.type,Graphics3DLineSymbolLayer_F.ELEVATED,r);s.push(c),debugFlags.b.LINE_WIREFRAMES&&s.push(c.instantiate({material:"polygon"===i.type?this._wireframeRingMaterial:this._wireframeLineMaterial})),null!=this._markerMaterial&&s.push(c.instantiate({material:this._markerMaterial}))}if(0===s.length)return null;const c=new Object3D.B({geometries:s,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:r}),d=new Graphics3DObject3DGraphicLayer.Y(this,c,s,null,null,ElevationAligners.Zd,t);return d.alignedSampledElevation=m.sampledElevation,d.needsElevationUpdates=(0,elevationAlignmentUtils.nu)(t.mode),d}_createGeometry(e,t,r,i,a,s,n){const o=s===Graphics3DLineSymbolLayer_F.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,l="polygon"===a,h=this._fastUpdates?.visualVariables.color,m=this._fastUpdates?.visualVariables.size,p=this._fastUpdates?.visualVariables.opacity,c=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),d={position:r,size:m?null:this._getDrivenSize(t.renderingInfo),color:h?null:this._getDrivenColor(t.renderingInfo),sizeFeature:m?(0,FastSymbolUpdates.ul)(m.field,t.graphic):null,colorFeature:h?(0,FastSymbolUpdates.ul)(h.field,t.graphic):null,opacityFeature:p?(0,FastSymbolUpdates.ul)(p.field,t.graphic):null};return(0,line.t)(e,{overlayInfo:o,removeDuplicateStartEnd:l,mapPositions:i,attributeData:d},c)}_createAsOverlay(e,t){const r=e.graphic,i=Graphics3DLineSymbolLayer_I(r.geometry),a="polygon"===i.type?i.rings:i.paths,s="polygon"===i.type?this._ringMaterial:this._lineMaterial;s.renderPriority=this._renderPriority;const n=debugFlags.b.LINE_WIREFRAMES?"polygon"===i.type?this._wireframeRingMaterial:this._wireframeLineMaterial:null,d=this._markerMaterial;null!=n&&(n.renderPriority=this._renderPriority-.001),null!=d&&(d.renderPriority=this._renderPriority-.002);const y=new Array,u=(0,aaBoundingBox.vt)(),_=(0,aaBoundingBox.Ie)(),g=(0,renderInfoUtils_line.A)(i,this._context.overlaySR),b="polygon"===i.type?"rings":"paths";this._logGeometryCreationWarnings(g,a,b,"LineSymbol3DLayer");for(const o of g.lines){if((0,aaBoundingBox.vY)(o.position,u),!(0,aaBoundingBox.KG)(u,this._context.clippingExtent))continue;(0,aaBoundingBox.RF)(_,u);const a=a=>{const s=this._createGeometry(a,e,o.position,void 0,i.type,Graphics3DLineSymbolLayer_F.DRAPED,r.uid),n=new RenderGeometry.$(s,{layerUid:t,graphicUid:r.uid});y.push(n)};if(null!=d){a(d);const e=this.symbolLayer.marker.placement;"begin"!==e&&"begin-end"!==e||(0,aaBoundingBox.Hq)(u,o.position,0,1),"end"!==e&&"begin-end"!==e||(0,aaBoundingBox.Hq)(u,o.position,o.position.length-3,1)}a(s),debugFlags.b.LINE_WIREFRAMES&&a(n)}return new Graphics3DDrapedGraphicLayer_l(this,y,_,this._context.drapeSourceRenderer)}get _patternHidesLine(){const e=this.symbolLayer.pattern;return null!=e&&"style"===e.type&&"none"===e.style}_computeMaterialWidth(e){return e=e??(0,screenUtils.PN)(1),this._drivenProperties.size?this._fastUpdates?.visualVariables.size?(0,screenUtils.Lz)(1):1:(0,screenUtils.Lz)(e)}_prepareMaterialPatch(e,t,r){const i=t.material;if(null==i)return void(r.changed&&r.useMaterialColor&&T(this._getCombinedOpacityAndColor(this._materialColor),this._materials[H.Marker],e));if("collection"===i.type)return;const s="complete"===i.type?i.newValue?.color:"complete"===i.diff.color?.type?i.diff.color.newValue:null,n=this._getCombinedOpacityAndColor(s);r.useMaterialColor&&T((0,vec4f64.o8)(n),this._materials[H.Marker],e),this._patternHidesLine&&(n[3]=0),T(n,this._materials[H.Line],e),delete t.material}_prepareMarkerPatch(e,t){const r=t.marker,i=this._markerMaterial;if(null==r||"partial"!==r.type||null==r.diff||null!=r.diff.placement||null!=r.diff.style&&"complete"!==r.diff.style.type||null!=r.diff.color&&"complete"!==r.diff.color.type||null==i)return{changed:!1,useMaterialColor:null==this._markerColor};const a=r.diff.color,s=null!=a,n=s?a.newValue:null,o=null==n&&null==this._markerColor;n&&T(this._getCombinedOpacityAndColor(n),i,e);const l=r.diff.style?.newValue;return l&&e.symbolLayerStatePatches.push((()=>i.setParameters({markerPrimitive:lineUtils_r(l)}))),delete t.marker,{changed:s,useMaterialColor:o}}}function Graphics3DLineSymbolLayer_I(e){switch(e.type){case"extent":if(e instanceof Extent.default)return Polygon.A.fromExtent(e);break;case"polygon":case"polyline":return e}return null}function T(e,t,r){null!=t&&r.symbolLayerStatePatches.push((()=>t.setParameters({color:e})))}var Graphics3DLineSymbolLayer_F,H;V.elevationModeChangeTypes={definedChanged:elevationAlignmentUtils.uw.RECREATE,staysOnTheGround:elevationAlignmentUtils.uw.NONE,onTheGroundChanged:elevationAlignmentUtils.uw.RECREATE},function(e){e[e.DRAPED=0]="DRAPED",e[e.ELEVATED=1]="ELEVATED"}(Graphics3DLineSymbolLayer_F||(Graphics3DLineSymbolLayer_F={})),function(e){e[e.Line=0]="Line",e[e.Ring=1]="Ring",e[e.LineWireframe=2]="LineWireframe",e[e.RingWireframe=3]="RingWireframe",e[e.Marker=4]="Marker"}(H||(H={}));var mathUtils=__webpack_require__("./node_modules/@arcgis/core/core/mathUtils.js"),projection=__webpack_require__("./node_modules/@arcgis/core/geometry/projection.js"),projectVectorToPoint=__webpack_require__("./node_modules/@arcgis/core/geometry/projection/projectVectorToPoint.js"),FloatArray=__webpack_require__("./node_modules/@arcgis/core/geometry/support/FloatArray.js"),MeshComponent=__webpack_require__("./node_modules/@arcgis/core/geometry/support/MeshComponent.js"),MeshMaterialMetallicRoughness=__webpack_require__("./node_modules/@arcgis/core/geometry/support/MeshMaterialMetallicRoughness.js"),MeshTextureTransform=__webpack_require__("./node_modules/@arcgis/core/geometry/support/MeshTextureTransform.js"),meshVertexSpaceUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/meshVertexSpaceUtils.js"),spatialReferenceUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/spatialReferenceUtils.js"),meshUtils_projection=__webpack_require__("./node_modules/@arcgis/core/geometry/support/meshUtils/projection.js"),projectMeshVertexPositions=__webpack_require__("./node_modules/@arcgis/core/geometry/support/meshUtils/projectMeshVertexPositions.js"),dehydratedPoint=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/dehydratedPoint.js"),sources_interfaces=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/sources/interfaces.js"),resourceUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/glTF/internal/resourceUtils.js"),TextureTransformUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/glTF/internal/TextureTransformUtils.js"),featureExpressionInfoUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/featureExpressionInfoUtils.js");const meshAutoFastUpdateConstants_e_disableDelayMs=2e3;class Graphics3DMeshObject3DGraphicLayer_p extends Graphics3DObject3DGraphicLayer.Y{constructor(){super(...arguments),this.fastTransformUpdatesAllowed=!1,this._originalGeometries=[],this._fastTransformUpdatesEnabled=!1,this._autoDisableFastUpdatesTimeoutId=0}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}destroy(){super.destroy(),this._cancelAutoDisableFastUpdates()}enableFastTransformUpdates(e,a){if(!this.fastTransformUpdatesAllowed||this._fastTransformUpdatesEnabled)return;this._cancelAutoDisableFastUpdates(),this._fastTransformUpdatesEnabled=!0;const{stageObject:s}=this,r=s.geometries.slice();s.removeAllGeometries();const i=(0,mat4.sC)(Graphics3DMeshObject3DGraphicLayer_g,s.transformation),o=a.getOrigin(i);for(const t of r){const a=e(t.material),r=t.instantiate({material:a});r.localOrigin=o,s.addGeometry(r)}this._originalGeometries=r}autoDisableFastTransformUpdates(t){this._cancelAutoDisableFastUpdates(),this._autoDisableFastUpdatesTimeoutId=setTimeout((()=>{this._autoDisableFastUpdatesTimeoutId=0,t()}),meshAutoFastUpdateConstants_e_disableDelayMs)}updateAutoDisableFastTransformUpdates(t){this._autoDisableFastUpdatesTimeoutId&&this.autoDisableFastTransformUpdates(t)}_cancelAutoDisableFastUpdates(){clearTimeout(this._autoDisableFastUpdatesTimeoutId),this._autoDisableFastUpdatesTimeoutId=0}disableFastTransformUpdates(t){if(!this._fastTransformUpdatesEnabled)return;this._cancelAutoDisableFastUpdates(),this._fastTransformUpdatesEnabled=!1;const{stageObject:e}=this,a=e.geometries.map((e=>t(e.material)));e.removeAllGeometries();for(let s=0;s<this._originalGeometries.length;s++){const t=this._originalGeometries[s],r=a[s];r.setParameters({modelTransformation:null}),r===t.material?e.addGeometry(t):e.addGeometry(t.instantiate({material:r}))}this._originalGeometries.length=0}updateFastLocalOrigin(e,a,s){if(!this._fastTransformUpdatesEnabled)return;const{stageObject:r}=this;if(0===r.geometries.length)return;const o=r.geometries[0].localOrigin,n=(0,mat4.sC)(Graphics3DMeshObject3DGraphicLayer_g,e),m=s.getOrigin(n);if(m===o)return;const l=a?.localMatrix??mat4f64.zK;r.shaderTransformation=null,r.transformation=e,r.geometries.forEach((t=>{t.transformation=l,t.localOrigin=m}))}updateTransform(t,s,r){const{stageObject:o}=this,n=s?.localMatrix??mat4f64.zK;if(!this._fastTransformUpdatesEnabled)return o.shaderTransformation=null,o.transformation=t,o.geometries.forEach((t=>t.transformation=n)),void this._updateEdgeTransform(r);const m=o.transformation,l=o.geometries[0].transformation,f=t,d=n,c=(0,mat4.lw)(Graphics3DMeshObject3DGraphicLayer_u,m,l),h=(0,mat4.lw)(Graphics3DMeshObject3DGraphicLayer_T,f,d),p=(0,mat4.lw)(_,h,(0,mat4.B8)(_,l));o.shaderTransformation=p,this._setFastMaterialTransformation({matA:c,matB:h}),this._updateEdgeTransform(r)}alignWithElevation(t,a,r,i){if(!this._fastTransformUpdatesEnabled)return void super.alignWithElevation(t,a,r,i);null!=r&&(0,featureExpressionInfoUtils.gf)(this.elevationContext.featureExpressionInfoContext,r);const{stageObject:n}=this;if(!n.geometries[0].material.parameters.modelTransformation)return;const m=n.transformation,c=n.geometries[0].transformation,h=(0,mat4.lw)(Graphics3DMeshObject3DGraphicLayer_u,m,c),p=n.effectiveTransformation,g=(0,mat4.C)(Graphics3DMeshObject3DGraphicLayer_b,p);this.alignedSampledElevation=(0,ElevationAligners.G8)(this,this.elevationContext,t.spatialReference,((e,s)=>(0,elevationAlignmentUtils.sE)(e,t,this.elevationContext,a,s)),a,g),n.shaderTransformation=g;const _=n.geometries[0].transformation,U=(0,mat4.lw)(Graphics3DMeshObject3DGraphicLayer_T,g,_);this._setFastMaterialTransformation({matA:h,matB:U}),this._updateEdgeTransform(i)}_setFastMaterialTransformation({matA:t,matB:s}){const{stageObject:i}=this;if(0===i.geometries.length)return;const o=i.geometries[0].localOrigin,m=(0,mat4.kN)(Graphics3DMeshObject3DGraphicLayer_F,(0,vec32.h)(Graphics3DMeshObject3DGraphicLayer_g,o.vec3,-1)),l=(0,mat4.lw)(U,m,t),f=(0,mat4.lw)(E,m,s),d=(0,mat4.B8)(U,l),c=(0,mat4.lw)(E,f,d);for(const e of i.geometries)e.material.setParameters({modelTransformation:c})}_updateEdgeTransform(t){const{stageObject:e,_stageLayer:a}=this;a.stage.renderer.withEdgeView((a=>{a.fastUpdateObject3DEdgesTransform(e)||this.resetEdgeObject(t)}))}}const Graphics3DMeshObject3DGraphicLayer_g=(0,vec3f64.vt)(),Graphics3DMeshObject3DGraphicLayer_u=(0,mat4f64.vt)(),Graphics3DMeshObject3DGraphicLayer_T=(0,mat4f64.vt)(),Graphics3DMeshObject3DGraphicLayer_b=(0,mat4f64.vt)(),_=(0,mat4f64.vt)(),U=(0,mat4f64.vt)(),E=(0,mat4f64.vt)(),Graphics3DMeshObject3DGraphicLayer_F=(0,mat4f64.vt)();class MeshFastUpdateProcessor_r{constructor(){this._fastTransformOriginalMaterials=new Map,this._fastTransformClonedMaterials=new Map,this._graphicReferenceCount=0}enable(r,t,e){r.enableFastTransformUpdates((r=>{if(this._graphicReferenceCount<=1){if(this._fastTransformOriginalMaterials.has(r))return r;const a=t.byMaterial(r);return this._fastTransformOriginalMaterials.set(r,a),t.delete(r),r}const s=new DefaultMaterial.$U(r.parameters,e);return e.stage.add(s),this._fastTransformClonedMaterials.set(s,r),s}),e.localOriginFactory)}disable(a,r,t){const e=new Set,s=new Set;a.disableFastTransformUpdates((a=>{if(!this._fastTransformClonedMaterials.has(a)){const t=a,i=this._fastTransformOriginalMaterials.get(t);return r.has(i.uid)?(e.add(t),r.byUid(i.uid).material):(s.add(t),i.material)}const i=a,n=this._fastTransformClonedMaterials.get(i);return this._fastTransformClonedMaterials.delete(i),t.stage.remove(i),n}));for(const i of e)this._fastTransformOriginalMaterials.delete(i),t.stage.remove(i);for(const i of s){const a=this._fastTransformOriginalMaterials.get(i);this._fastTransformOriginalMaterials.delete(i),r.set(a.uid,a)}}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(a,r,t){this._graphicReferenceCount--,this.disable(a,r,t)}forEachMaterialInfo(a){this._fastTransformOriginalMaterials.forEach(a)}forEachClonedMaterial(a){this._fastTransformClonedMaterials.forEach(a)}destroy(a){a.removeMany(Array.from(this._fastTransformClonedMaterials.keys())),a.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),(({material:a})=>a))),this._fastTransformClonedMaterials.clear(),this._fastTransformOriginalMaterials.clear()}}class MeshFastUpdateProcessor_t{constructor(){this._byUid=new Map,this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),(a=>a.material))}byUid(a){return this._byUid.get(a)}byMaterial(a){return this._byMaterial.get(a)}set(a,r){this._byUid.set(a,r),this._byMaterial.set(r.material,r)}delete(a){const r=this._byMaterial.get(a)?.uid;r&&(this._byUid.delete(r),this._byMaterial.delete(a))}has(a){return this._byUid.has(a)}forEachMaterialInfo(a){this._byUid.forEach(a)}clear(){this._byUid.clear(),this._byMaterial.clear()}}var symbolColorUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/support/symbolColorUtils.js"),vec2=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/math/vec2.js"),frustum=__webpack_require__("./node_modules/@arcgis/core/geometry/support/frustum.js"),lineSegment=__webpack_require__("./node_modules/@arcgis/core/geometry/support/lineSegment.js"),plane=__webpack_require__("./node_modules/@arcgis/core/geometry/support/plane.js"),GLMaterial=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/GLMaterial.js"),Util=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/Util.js"),DefaultBufferWriter=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/materials/DefaultBufferWriter.js"),DefaultLayouts=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/materials/DefaultLayouts.js"),NativeLine_glsl=__webpack_require__("./node_modules/@arcgis/core/chunks/NativeLine.glsl.js");class d extends ShaderTechnique.w{constructor(e,r){super(e,r,new ReloadableShaderModule.$(NativeLine_glsl.N,(()=>__webpack_require__.e(916).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/views/3d/webgl-engine/shaders/NativeLine.glsl.js"))))),this.primitiveType=enums.WR.LINES}initializePipeline(i){const{hasOccludees:r,output:o,transparent:u}=i,d=(e,i=null,o=null)=>(0,renderState.Ey)({blending:i,depthTest:StencilUtils.m,depthWrite:o,colorWrite:renderState.kn,stencilWrite:r?StencilUtils.v0:null,stencilTest:r?e?StencilUtils.a9:StencilUtils.qh:null});return(0,ShaderOutput.RN)(o)?(this._occludeePipeline=d(!0,u?renderState.Ky:null,renderState.Uy),d(!1,u?renderState.Ky:null,renderState.Uy)):d(!1)}getPipeline(e){return e?this._occludeePipeline:super.getPipeline()}}var ShaderTechniqueConfiguration=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration.js"),DefaultTechniqueConfiguration=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/materials/DefaultTechniqueConfiguration.js");class s extends DefaultTechniqueConfiguration.E{constructor(){super(...arguments),this.hasVertexColors=!1,this.transparent=!1,this.hasOccludees=!1}}(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],s.prototype,"hasVertexColors",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],s.prototype,"transparent",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],s.prototype,"hasOccludees",void 0);class NativeLineMaterial_U extends Material.im{constructor(e){super(e,q),this._configuration=new s,this.produces=new Map([[RenderSlot.N.OPAQUE_MATERIAL,e=>(0,ShaderOutput.dX)(e)]])}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.hasOccludees=r.hasOccludees,this._configuration}get visible(){return this.parameters.color[3]>=AlphaCutoff.Q}intersect(r,t,u,p,g,A){if(!u.options.selectionMode||!r.visible)return;if(!(0,Util.zH)(t))return void Logger.A.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const y=r.attributes.get(VertexAttribute.r.POSITION).data,N=u.camera,R=NativeLineMaterial_H;(0,vec2.C)(R,u.point);(0,vec32.i)(J[0],R[0]-2,R[1]+2,0),(0,vec32.i)(J[1],R[0]+2,R[1]+2,0),(0,vec32.i)(J[2],R[0]+2,R[1]-2,0),(0,vec32.i)(J[3],R[0]-2,R[1]-2,0);for(let e=0;e<4;e++)if(!N.unprojectFromRenderScreen(J[e],K[e]))return;(0,plane.Cr)(N.eye,K[0],K[1],Y),(0,plane.Cr)(N.eye,K[1],K[2],$),(0,plane.Cr)(N.eye,K[2],K[3],ee),(0,plane.Cr)(N.eye,K[3],K[0],re);let E=Number.MAX_VALUE,_=0;for(let e=0;e<y.length-5;e+=3){if(B[0]=y[e]+t[12],B[1]=y[e+1]+t[13],B[2]=y[e+2]+t[14],D[0]=y[e+3]+t[12],D[1]=y[e+4]+t[13],D[2]=y[e+5]+t[14],(0,plane.mN)(Y,B)<0&&(0,plane.mN)(Y,D)<0||(0,plane.mN)($,B)<0&&(0,plane.mN)($,D)<0||(0,plane.mN)(ee,B)<0&&(0,plane.mN)(ee,D)<0||(0,plane.mN)(re,B)<0&&(0,plane.mN)(re,D)<0)continue;if(N.projectToRenderScreen(B,NativeLineMaterial_G),N.projectToRenderScreen(D,NativeLineMaterial_k),NativeLineMaterial_G[2]<0&&NativeLineMaterial_k[2]>0){(0,vec32.d)(NativeLineMaterial_W,B,D);const e=N.frustum,r=-(0,plane.mN)(e[frustum.FB.NEAR],B)/(0,vec32.f)(NativeLineMaterial_W,(0,plane.Qj)(e[frustum.FB.NEAR]));(0,vec32.h)(NativeLineMaterial_W,NativeLineMaterial_W,r),(0,vec32.g)(B,B,NativeLineMaterial_W),N.projectToRenderScreen(B,NativeLineMaterial_G)}else if(NativeLineMaterial_G[2]>0&&NativeLineMaterial_k[2]<0){(0,vec32.d)(NativeLineMaterial_W,D,B);const e=N.frustum,r=-(0,plane.mN)(e[frustum.FB.NEAR],D)/(0,vec32.f)(NativeLineMaterial_W,(0,plane.Qj)(e[frustum.FB.NEAR]));(0,vec32.h)(NativeLineMaterial_W,NativeLineMaterial_W,r),(0,vec32.g)(D,D,NativeLineMaterial_W),N.projectToRenderScreen(D,NativeLineMaterial_k)}else if(NativeLineMaterial_G[2]<0&&NativeLineMaterial_k[2]<0)continue;NativeLineMaterial_G[2]=0,NativeLineMaterial_k[2]=0;const r=(0,lineSegment.kb)((0,lineSegment.Cr)(NativeLineMaterial_G,NativeLineMaterial_k,Z),R);r<E&&(E=r,(0,vec32.c)(NativeLineMaterial_F,B),(0,vec32.c)(Q,D),_=e/3)}const w=u.rayBegin,O=u.rayEnd;if(E<4){let e=Number.MAX_VALUE;if((0,lineSegment.ld)((0,lineSegment.Cr)(NativeLineMaterial_F,Q,Z),(0,lineSegment.Cr)(w,O,z),X)){(0,vec32.d)(X,X,w);const r=(0,vec32.l)(X);(0,vec32.h)(X,X,1/r),e=r/(0,vec32.j)(w,O)}A(e,X,_,!1)}}intersectDraped(e,t,o,s,i,a){if(!o.options.selectionMode)return;const n=e.attributes.get(VertexAttribute.r.POSITION).data,c=e.attributes.get(VertexAttribute.r.SIZE),m=c?c.data[0]:0,l=s[0],f=s[1],u=((m+1)/2+4)*e.screenToWorldRatio;let p=Number.MAX_VALUE,h=0;for(let g=0;g<n.length-5;g+=3){const e=n[g],t=n[g+1],o=l-e,s=f-t,i=n[g+3]-e,a=n[g+4]-t,c=(0,mathUtils.qE)((i*o+a*s)/(i*i+a*a),0,1),m=i*c-o,u=a*c-s,d=m*m+u*u;d<p&&(p=d,h=g/3)}p<u*u&&i(a.dist,a.normal,h,!1)}createGLMaterial(e){return new NativeLineMaterial_I(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?DefaultLayouts.dB:DefaultLayouts.Ci;return new DefaultBufferWriter.Z(e)}}class NativeLineMaterial_I extends GLMaterial.A{beginSlot(e){return this.getTechnique(d,e)}}class q extends Material.qA{constructor(){super(...arguments),this.color=vec4f64.Un,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1}}const B=(0,vec3f64.vt)(),D=(0,vec3f64.vt)(),NativeLineMaterial_W=(0,vec3f64.vt)(),X=(0,vec3f64.vt)(),NativeLineMaterial_G=(0,screenUtils.r_)(),NativeLineMaterial_k=(0,screenUtils.r_)(),NativeLineMaterial_F=(0,vec3f64.vt)(),Q=(0,vec3f64.vt)(),Z=(0,lineSegment.vt)(),z=(0,lineSegment.vt)(),NativeLineMaterial_H=(0,vec3f64.vt)(),J=[(0,screenUtils.r_)(),(0,screenUtils.r_)(),(0,screenUtils.r_)(),(0,screenUtils.r_)()],K=[(0,vec3f64.vt)(),(0,vec3f64.vt)(),(0,vec3f64.vt)(),(0,vec3f64.vt)()],Y=(0,plane.vt)(),$=(0,plane.vt)(),ee=(0,plane.vt)(),re=(0,plane.vt)();var pbrUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/materials/pbrUtils.js");const Ne=["mesh"];class Ie extends Graphics3DSymbolLayer.U{constructor(e,t,r,o){super(e,t,r,o),this._materialInfoCache=new MeshFastUpdateProcessor_t,this._fastUpdateProcessor=new MeshFastUpdateProcessor_r,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){debugFlags.b.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new NativeLineMaterial_U({color:[1,0,1,1]}),this._debugTangentNormalMaterial=new NativeLineMaterial_U({color:[1,.5,0,1]}),this._debugFaceNormalMaterial=new NativeLineMaterial_U({color:[0,1,1,1]}))}destroy(){super.destroy(),this._textures.forEach((e=>e.unload())),this._context.stage.removeMany(this._materialInfoCache.materials),this._context.stage.removeMany(Array.from(this._textures.values())),this._materialInfoCache.clear(),this._textures.clear(),this._fastUpdateProcessor.destroy(this._context.stage)}get materials(){return this._materialInfoCache.materials}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,Ne,"fill on mesh-3d"))return null;const r=this.setGraphicElevationContext(t),o=e.renderingInfo;return this._createAs3DShape(t,o,r,t.uid)}onRemoveGraphic(e){this._fastUpdateProcessor.onRemoveGraphic(e,this._materialInfoCache,this._context)}layerOpacityChanged(e,t){const r=this._getLayerOpacity();this._updateMaterialParameters((e=>{e.material.setParameters({layerOpacity:r});const t=e.material.parameters;this._setMaterialTransparentParameter(t,e),e.material.setParameters({transparent:t.transparent})})),e.forEach((e=>t(e)?.layerOpacityChanged(r,this._context.isAsync)))}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,elevationAlignmentUtils.Kf)}slicePlaneEnabledChanged(e,t){return this._updateMaterialParameters((({material:e})=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})})),e.forEach((e=>t(e)?.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync))),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._updateMaterialParameters((({material:t})=>t.setParameters({usePBR:e}))),!0}updateTransform(e,t,r,o){if(!e.fastTransformUpdatesAllowed)return!1;const a=e.fastTransformUpdatesEnabled;switch(o){case sources_interfaces.$.EnableFastUpdates:if(a)return!0;break;case sources_interfaces.$.DisableFastUpdates:if(!a)return!0;break;default:if(!a)return!!this.updateTransform(e,t,r,sources_interfaces.$.EnableFastUpdates)&&(e.autoDisableFastTransformUpdates((()=>this.updateTransform(e,t,r,sources_interfaces.$.DisableFastUpdates))),!0)}const n=this._context.renderCoordsHelper.spatialReference,s=Graphics3DMeshFillSymbolLayer_at,{origin:i,transform:l}=r;if(!(0,computeTranslationToOriginAndRotation.l)(t,(0,vec32.i)(Ze,i.x,i.y,i.z??0),s,n))return!1;switch(o){case sources_interfaces.$.EnableFastUpdates:this._fastUpdateProcessor.enable(e,this._materialInfoCache,this._context);break;case sources_interfaces.$.DisableFastUpdates:this._fastUpdateProcessor.disable(e,this._materialInfoCache,this._context);break;case sources_interfaces.$.UpdateFastLocalOrigin:e.updateFastLocalOrigin(s,l,this._context.localOriginFactory)}const{elevationContext:c}=e;c.centerPointInElevationSR=this._getCenterPointInElevationSR(s);const{elevationProvider:u,renderCoordsHelper:m}=this._context;return e.alignedSampledElevation=(0,ElevationAligners.G8)(e,c,u.spatialReference,((e,t)=>(0,elevationAlignmentUtils.sE)(e,u,c,m,t)),m,s),e.updateTransform(s,l,this._context.isAsync),e.updateAutoDisableFastTransformUpdates((()=>this.updateTransform(e,t,r,sources_interfaces.$.DisableFastUpdates))),!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_materialPropertiesDefault(e,t){const r=this._requiresSymbolVertexColors(),o=!!e.vertexAttributes.color,a=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:o,hasVertexTangents:a,uid:`vc:${o},vt:${a},vct${t},svc:${r}`}}_materialProperties(e,t,r){const o=this._materialPropertiesDefault(e,r);if(!t.material)return o;const{color:a,colorTexture:n,colorTextureTransform:s,normalTexture:i,normalTextureTransform:l,doubleSided:c,alphaCutoff:u,alphaMode:m}=t.material,f=Ye(a),p=Ye(n),h=Je(s),d=Ye(i),g=Je(l);if(o.color=a,o.colorTexture=n,o.normalTexture=i,o.uid=`${o.uid},cmuid:${f},ctmuid:${p},cttuid:${h},ntmuid:${d},nttuid:${g},ds:${c},ac:${u},am:${m}`,t.material instanceof MeshMaterialMetallicRoughness.A){const{metallic:e,roughness:r,metallicRoughnessTexture:a,metallicRoughnessTextureTransform:n,emissiveColor:i,emissiveTexture:c,emissiveTextureTransform:u,occlusionTexture:m,occlusionTextureTransform:f}=t.material,p=Ye(a),h=Je(n),d=Ye(i),g=Ye(c),x=Je(u),_=Ye(m),T=Je(f);o.metallic=e,o.roughness=r,o.metallicRoughnessTexture=a,o.emissiveColor=i,o.emissiveTexture=c,o.occlusionTexture=m,o.colorTextureTransform=$e(s),o.normalTextureTransform=$e(l),o.emissiveTextureTransform=$e(u),o.occlusionTextureTransform=$e(f),o.metallicRoughnessTextureTransform=$e(n),o.uid=`${o.uid},mrm:${e},mrr:${r},mrt:${p},mrtt:${h},emuid:${d},etmuid:${g},ett:${x},otmuid:${_},ott:${T}`}return o}_getInternalTexture(e,t=basicInterfaces.sf.Opaque){const a=function We(e){return e.data??e.url}(e);if(!a)return null;const n=`${e.contentHash}/${t}`;let s=this._textures.get(n);if(s){const e=this._context.stage.renderView.textures;let t=null;const a=e.acquire(s.id);return null==a||(0,promiseUtils.$X)(a)||(s.events.on("unloaded",(()=>t=(0,maybe.Gz)(t))),t=a),s}let i=null;const l=this._context.stage.renderView.renderingContext.parameters.maxMaxAnisotropy,c={wrap:He(e.wrap),noUnpackFlip:!0,maxAnisotropy:l,mipmap:l>1};return(0,resourceUtils.x3)(a)?(i=a.data,c.preMultiplyAlpha=!1,c.encoding=a.encoding):(i=a,c.preMultiplyAlpha=t!==basicInterfaces.sf.Opaque,c.downsampleUncompressed=this._context.graphicsCoreOwner.view.qualitySettings.graphics3D.uncompressedTextureDownsamplingEnabled),s=new Texture.g(i,c),this._textures.set(n,s),s.load(this._context.stage.renderView.renderingContext),this._context.stage.add(s),s.events.on("unloaded",(()=>{this._textures.delete(n)})),s}_setInternalMaterialTextureParameters(t,r){if(null!=t.colorTexture){const e=this._getInternalTexture(t.colorTexture,r.textureAlphaMode);e?(r.textureId=e.id,r.textureAlphaPremultiplied=!!e.parameters.preMultiplyAlpha):r.textureId=void 0}t.normalTexture&&(r.normalTextureId=this._getInternalTexture(t.normalTexture)?.id),t.emissiveColor&&(r.emissiveFactor=Color.A.toUnitRGB(t.emissiveColor)),t.emissiveTexture&&(r.emissiveTextureId=this._getInternalTexture(t.emissiveTexture)?.id),t.occlusionTexture&&(r.occlusionTextureId=this._getInternalTexture(t.occlusionTexture)?.id),t.metallicRoughnessTexture&&(r.metallicRoughnessTextureId=this._getInternalTexture(t.metallicRoughnessTexture)?.id)}_setInternalMaterialParameters(e,t){null!=e.color&&function ze(t,r){r.diffuse=Color.A.toUnitRGB(t),r.opacity=t.a}(e.color,t),this._setInternalMaterialTextureParameters(e,t),t.colorTextureTransformMatrix=(0,TextureTransformUtils.G)(e.colorTextureTransform),t.normalTextureTransformMatrix=(0,TextureTransformUtils.G)(e.normalTextureTransform);const r=null!=e.normalTextureTransform?.scale?e.normalTextureTransform?.scale:vec2f64.Un;t.scale=[r[0],r[1]],t.occlusionTextureTransformMatrix=(0,TextureTransformUtils.G)(e.occlusionTextureTransform),t.emissiveTextureTransformMatrix=(0,TextureTransformUtils.G)(e.emissiveTextureTransform),t.metallicRoughnessTextureTransformMatrix=(0,TextureTransformUtils.G)(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(t,r=this.symbolLayer?.material?.color){const o=this._drivenProperties.color;let a=this.symbolLayer.material?.colorMixMode??null;if(o)t.externalColor=vec4f64.Un;else{const o=r??null;o?t.externalColor=Color.A.toUnitRGBA(o):(a=null,t.externalColor=vec4f64.Un)}a&&(t.colorMixMode=a),t.castShadows=!!this.symbolLayer.castShadows}_getOrCreateMaterial(t,r){const o=r.material?.color,a=r.material?.colorTexture,n=r.material?.alphaMode,s="blend"===n,i=!("opaque"===n)&&(function ke(e){const t=e.vertexAttributes.color;if(null==t)return!1;for(let r=3;r<t.length;r+=4)if(255!==t[r])return!0;return!1}(t)||null!=o&&o.a<1||a?.transparent||s),l=this._materialProperties(t,r,i),c=this._materialInfoCache.byUid(l.uid);if(c)return this._setInternalMaterialTextureParameters(l,c.material.parameters),c.material;const u={uid:l.uid,material:null,isComponentTransparent:i,alphaMode:r.material?r.material.alphaMode:"opaque"},m=(0,pbrUtils.Jr)({normalTexture:l.normalTexture,metallicRoughnessTexture:l.metallicRoughnessTexture,metallicFactor:l.metallic,roughnessFactor:l.roughness,emissiveTexture:l.emissiveTexture,emissiveFactor:Color.A.toUnitRGB(l.emissiveColor),occlusionTexture:l.occlusionTexture}),f={usePBR:this._usePBR(),isSchematic:m,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:vec3f64.uY,diffuse:vec3f64.Un,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:basicInterfaces.s2.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled};f.mrrFactors=m?pbrUtils.Bt:[l.metallic,l.roughness,pbrUtils.mb[2]],r.material&&(f.doubleSided=r.material.doubleSided,f.cullFace=r.material.doubleSided?basicInterfaces.s2.None:basicInterfaces.s2.Back,f.textureAlphaCutoff=r.material.alphaCutoff),this._setExternalMaterialParameters(f),this._setMaterialTransparentParameter(f,u),this._setInternalMaterialParameters(l,f);const p=new DefaultMaterial.$U(f,this._context);return u.material=p,this._materialInfoCache.set(l.uid,u),this._context.stage.add(p),p}prepareSymbolLayerPatch(e){if("partial"!==e.diff.type)return;const t=e.diff.diff;this._preparePatchColor(e,t)}_preparePatchColor(e,t){if(!t.material||"partial"!==t.material.type)return;const r=t.material.diff;if(!r.color||"complete"!==r.color.type||null==r.color.newValue||null==r.color.oldValue)return;const o=r.color.newValue;delete r.color,e.symbolLayerStatePatches.push((()=>{this._updateMaterialParameters((e=>{const t=e.material.parameters;this._setExternalMaterialParameters(t,o),this._setMaterialTransparentParameter(t,e),e.material.setParameters({externalColor:t.externalColor,transparent:t.transparent})}))}))}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,t){e.transparent=this.needsDrivenTransparentPass||t.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,"auto"===t.alphaMode?e.textureAlphaMode=e.transparent?basicInterfaces.sf.MaskBlend:basicInterfaces.sf.Opaque:e.textureAlphaMode="opaque"===t.alphaMode?basicInterfaces.sf.Opaque:"mask"===t.alphaMode?basicInterfaces.sf.Mask:basicInterfaces.sf.Blend}_createFaceDebugNormals(e,t){const r=t.length,o=e.spatialReference.isGeographic?20015077/180:1,n=.1*Math.max(e.extent.width*o,e.extent.height*o,e.extent.zmax-e.extent.zmin),i=[],l=[],c=t[0].transformation,u=(0,mat3.Ge)((0,mat3f64.vt)(),c);for(let a=0;a<r;a++){const e=t[a].attributes.get(VertexAttribute.r.POSITION);if(!e)continue;const r=e.data,o=e.indices;for(let t=0;t<o.length;t+=3)Le(r,o,t,rt),Ve(r,o,t,Ze,et,tt),(0,vec32.g)(Ze,Ze,et),(0,vec32.g)(Ze,Ze,tt),(0,vec32.h)(Ze,Ze,1/3),(0,vec32.t)(Ze,Ze,c),i.push(...Ze),(0,vec32.q)(rt,rt,u),(0,vec32.n)(rt,rt),(0,vec32.b)(Ze,Ze,rt,n),i.push(...Ze),l.push(l.length),l.push(l.length)}return i.length?new Geometry.V(this._debugFaceNormalMaterial,[[VertexAttribute.r.POSITION,new Attribute.n(i,l,3,!0)]],null,ContentObjectType.X.Line):null}_createPerVertexDebugVectors(e,t,r,o,i){const l=t.length,c=e.spatialReference.isGeographic?20015077/180:1,u=.1*i*Math.max(e.extent.width*c,e.extent.height*c,e.extent.zmax-e.extent.zmin),m=[],f=[],p=t[0].transformation,h=(0,mat3.Ge)((0,mat3f64.vt)(),p);r===VertexAttribute.r.TANGENT&&(0,mat3.z0)(h,p);for(let a=0;a<l;a++){const e=t[a],o=e.attributes.get(VertexAttribute.r.POSITION),n=e.attributes.get(r);if(!o||!n)continue;const s=o.data,i=o.indices,l=n.data,c=n.indices;for(let t=0;t<i.length;t++){const e=3*i[t],r=c[t]*n.stride;(0,vec32.i)(Ze,s[e+0],s[e+1],s[e+2]),(0,vec32.t)(Ze,Ze,p),m.push(...Ze),(0,vec32.i)(et,l[r+0],l[r+1],l[r+2]),(0,vec32.q)(et,et,h),(0,vec32.n)(et,et),(0,vec32.b)(Ze,Ze,et,u),m.push(...Ze),f.push(f.length),f.push(f.length)}}return m.length?new Geometry.V(o,[[VertexAttribute.r.POSITION,new Attribute.n(m,f,3,!0)]],null,ContentObjectType.X.Line):null}_createAs3DShape(e,t,r,o){const a=e.geometry;if("mesh"!==a.type)return null;const n=this._createGeometryInfo(a,t,o);if(null==n)return null;const{geometries:s,objectTransformation:i}=n;if(debugFlags.b.DRAW_MESH_GEOMETRY_NORMALS){const e=this._createPerVertexDebugVectors(a,s,VertexAttribute.r.NORMAL,this._debugVertexNormalMaterial,1),t=this._createPerVertexDebugVectors(a,s,VertexAttribute.r.TANGENT,this._debugTangentNormalMaterial,.5),r=this._createFaceDebugNormals(a,s);e&&s.push(e),t&&s.push(t),r&&s.push(r)}const l=new Object3D.B({geometries:s,layerUid:this._context.layer.uid,graphicUid:o,isElevationSource:!0});l.transformation=i;const c=(0,edgeUtils.Cc)(this.symbolLayer,{opacity:this._getLayerOpacity()}),u=c?new Graphics3DObject3DGraphicLayer.H(s[0].material,c,this._context.slicePlaneEnabled):null,m=new Graphics3DMeshObject3DGraphicLayer_p(this,l,s,null,null,ElevationAligners.G8,r,u);this._fastUpdateProcessor.onAddGraphic(),m.needsElevationUpdates=(0,elevationAlignmentUtils.Kf)(r.mode),m.useObjectOriginAsAttachmentOrigin=!0,m.fastTransformUpdatesAllowed=this._fastTransformUpdatesAllowed(a),r.centerPointInElevationSR=this._getCenterPointInElevationSR(l.transformation);const{elevationProvider:f,renderCoordsHelper:p}=this._context;return m.alignedSampledElevation=(0,ElevationAligners.G8)(m,r,f.spatialReference,((e,t)=>(0,elevationAlignmentUtils.sE)(e,f,r,p,t)),p),m}_fastTransformUpdatesAllowed(e){const{vertexSpace:t,spatialReference:r}=e;if(!(0,meshVertexSpaceUtils.Hq)(t))return!1;const{type:o}=t,{view:a}=this._context.graphicsCoreOwner,{viewingMode:n}=a.state,s=a.spatialReference;return n===ViewingMode.RT.Global&&"local"===o||n===ViewingMode.RT.Local&&(0,spatialReferenceUtils.aI)(s,r)&&"georeferenced"===o&&!r.isGeographic}_getCenterPointInElevationSR(e){const t=(0,dehydratedPoint.T)(0,0,0,this._context.elevationProvider.spatialReference??null);return(0,projectVectorToPoint.E)([e[12],e[13],e[14]],this._context.renderCoordsHelper.spatialReference,t),t}_passthroughReprojectionInfo(e){return e.reprojection===Graphics3DMeshFillSymbolLayer_it.NONE&&!!e.objectTransformation}_createPositionBuffer(e,t){const r=e.vertexAttributes.position;let o,a=r;if(t.reprojection===Graphics3DMeshFillSymbolLayer_it.NONE)return{position:a,georeferencedPositionBuffer:o};const n=t.reprojection===Graphics3DMeshFillSymbolLayer_it.RENDER?t.transformBeforeProject:null;n&&(a=(0,vec3.t)(new Float64Array(a.length),a,n));const{normal:s,tangent:i}=e.vertexAttributes;this._passthroughReprojectionInfo(t)||!s&&!i||(o=a);const l=a===r||a===o?new Float64Array(a.length):a;return(0,projectBuffer.projectBuffer)(a,e.spatialReference,0,l,this._context.renderCoordsHelper.spatialReference,0),{position:l,georeferencedPositionBuffer:o}}_createNormalBuffer(e,t,r,o){const a=e.vertexAttributes.normal;if(null==a)return null;let n=a;const s=o.reprojection===Graphics3DMeshFillSymbolLayer_it.RENDER?o.transformBeforeProject:null;s&&(n=(0,meshUtils_projection.qs)(n,new Float32Array(n.length),s));const i=this._context.graphicsCoreOwner.view.viewingMode;if(o.reprojection===Graphics3DMeshFillSymbolLayer_it.NONE)return n;if("local"===i){if(!(0,spatialReferenceUtils.r1)(this._context.renderCoordsHelper.spatialReference))return n;if(null==r)return null;if(e.spatialReference.isGeographic){const e=n===a?new Float32Array(n.length):n;return(0,meshUtils_projection.gZ)(n,meshUtils_projection.OD.NORMAL,r,e)}if(e.spatialReference.isWebMercator){const e=n===a?new Float32Array(n.length):n;return(0,meshUtils_projection.GN)(n,meshUtils_projection.OD.NORMAL,r,e)}return n}if(null==r)return null;const l=n===a?new Float32Array(n.length):n,c=this._context.renderCoordsHelper.spatialReference;return(0,meshUtils_projection.X4)(n,r,e.spatialReference,t,c,l)}_createTangentBuffer(e,t,r,o){const a=e.vertexAttributes.tangent;if(null==a)return null;let n=a;const s=o.reprojection===Graphics3DMeshFillSymbolLayer_it.RENDER?o.transformBeforeProject:null;s&&(n=(0,meshUtils_projection.KM)(n,new Float32Array(n.length),s));const i=this._context.graphicsCoreOwner.view.viewingMode;if(o.reprojection===Graphics3DMeshFillSymbolLayer_it.NONE)return n;if("local"===i){if(!(0,spatialReferenceUtils.r1)(this._context.renderCoordsHelper.spatialReference))return n;if(null==r)return null;if(e.spatialReference.isGeographic){const e=n===a?new Float32Array(n.length):n;return(0,meshUtils_projection.gZ)(n,meshUtils_projection.OD.TANGENT,r,e)}if(e.spatialReference.isWebMercator){const e=n===a?new Float32Array(n.length):n;return(0,meshUtils_projection.GN)(n,meshUtils_projection.OD.TANGENT,r,e)}return n}if(null==r)return null;const l=n===a?new Float32Array(n.length):n,c=this._context.renderCoordsHelper.spatialReference;return(0,meshUtils_projection.xA)(n,r,e.spatialReference,t,c,l)}_createSymbolColorBuffer(e){if(this._requiresSymbolVertexColors()){const t=this._getVertexOpacityAndColor(e),r=(0,symbolColorUtils.Eb)(this.symbolLayer?.material?.colorMixMode),o=new Uint8Array(4);return(0,symbolColorUtils._j)(t,r,o),o}return null}_createBuffers(e,t){const r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const o=e.vertexAttributes.normal,a=e.vertexAttributes.uv,n=e.vertexAttributes.tangent;if(o&&o.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(n&&n.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(a&&a.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const s=this._computeReprojectionInfo(e),{position:i,georeferencedPositionBuffer:l}=this._createPositionBuffer(e,s),c=function Ke(e){return e.vertexAttributes.color}(e),u=this._createSymbolColorBuffer(t),f=this._createNormalBuffer(e,i,l,s),p=this._createTangentBuffer(e,i,l,s),h=a,{transformation:d,position:g,normal:x,tangent:_}=this._passthroughReprojectionInfo(s)?{transformation:s.objectTransformation,position:i,normal:f,tangent:p}:this._transformOriginLocal(e,i,f,p);return{positionBuffer:g,normalBuffer:x,tangentBuffer:_,uvBuffer:h,colorBuffer:c,symbolColorBuffer:u,objectTransformation:d,geometryTransformation:s.reprojection===Graphics3DMeshFillSymbolLayer_it.NONE&&s.geometryTransformation?s.geometryTransformation:(0,mat4f64.vt)()}}_computeReprojectionInfo(e){const{vertexSpace:t}=e,r="georeferenced"===t.type?(0,spatialReferenceUtils.aI)(this._context.renderCoordsHelper.spatialReference,e.spatialReference)?Graphics3DMeshFillSymbolLayer_it.NONE:Graphics3DMeshFillSymbolLayer_it.RENDER:Graphics3DMeshFillSymbolLayer_it.NONE;if((0,meshVertexSpaceUtils.E9)(t))return{reprojection:r};const o=t.origin,a=(0,mat4f64.vt)(),n=e.transform?.localMatrix??mat4f64.zK;if(r===Graphics3DMeshFillSymbolLayer_it.NONE)return(0,computeTranslationToOriginAndRotation.l)(e.spatialReference,o,a,this._context.renderCoordsHelper.spatialReference),{reprojection:r,objectTransformation:a,geometryTransformation:(0,mat4f64.o8)(n)};const s=(0,mat4.kN)((0,mat4f64.vt)(),o);return(0,mat4.lw)(s,s,n),{reprojection:r,transformBeforeProject:s}}_transformOriginLocal(e,t,r,o){const a=this._context.renderCoordsHelper.spatialReference,n=e.origin;Xe[0]=n.x,Xe[1]=n.y,Xe[2]=n.z??0;const s=(0,mat4f64.vt)();(0,computeTranslationToOriginAndRotation.l)(e.spatialReference,Xe,s,a),(0,mat4.B8)(Graphics3DMeshFillSymbolLayer_ot,s);const{position:i,normal:l,tangent:u}=e.vertexAttributes,f=t===i?new Float64Array(t.length):t;(0,vec3.t)(f,t,Graphics3DMeshFillSymbolLayer_ot);const p=r?r===l?new Float32Array(r.length):r:null,h=o?o===u?new Float32Array(o.length):o:null;return r&&p&&(0,meshUtils_projection.qs)(r,p,Graphics3DMeshFillSymbolLayer_ot),o&&h&&(0,meshUtils_projection.KM)(o,h,Graphics3DMeshFillSymbolLayer_ot),{transformation:s,position:f,normal:p,tangent:h}}_validateFaces(e,t){const r=e.vertexAttributes.position.length/3,o=t.faces;if(o){let e=-1;for(let t=0;t<o.length;t++){const r=o[t];r>e&&(e=r)}if(r<=e)return this.logger.warn(`Vertex index ${e} is out of bounds of the mesh position buffer`),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const t=e.vertexAttributes?.position;if(!t)return!1;const r=this._context.elevationProvider.spatialReference,o=(0,projectMeshVertexPositions.projectMeshVertexPositions)(e,r??e.spatialReference);return!!o&&((0,aaBoundingBox.vY)(o,Graphics3DMeshFillSymbolLayer_nt),!(0,aaBoundingBox.KG)(Graphics3DMeshFillSymbolLayer_nt,this._context.clippingExtent))}_createGeometryInfo(e,t,r){if(!(0,projection.canProjectWithoutEngine)(e.spatialReference,this._context.renderCoordsHelper.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(!this._validateVertexSpace(e))return null;if(this._isOutsideClippingArea(e))return null;const o=this._createBuffers(e,t);if(null==o)return null;const{positionBuffer:a,uvBuffer:n,colorBuffer:s,symbolColorBuffer:i,normalBuffer:l,tangentBuffer:c,objectTransformation:m,geometryTransformation:f}=o,p=e.components??Graphics3DMeshFillSymbolLayer_st,h=new Array;let d=!1;const g=(0,mat4.sC)(Ze,m),x=this._context.localOriginFactory.getOrigin(g);for(const u of p){if(!this._validateFaces(e,u))return null;const t=Ue(e,u);if(0===t.length)continue;const o=Be(a,l,u,t);o.didFlipNormals&&(d=!0);const m=[[VertexAttribute.r.POSITION,new Attribute.n(a,t,3,!0)],[VertexAttribute.r.NORMAL,new Attribute.n(o.normals,o.indices,3,!0)]];s&&m.push([VertexAttribute.r.COLOR,new Attribute.n(s,t,4,!0)]),i&&m.push([VertexAttribute.r.SYMBOLCOLOR,new Attribute.n(i,(0,Indices.EH)(t.length),4,!0)]),n&&m.push([VertexAttribute.r.UV0,new Attribute.n(n,t,2,!0)]),c&&m.push([VertexAttribute.r.TANGENT,new Attribute.n(c,t,4,!0)]);const p=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:r,layerUid:this._context.layer.uid}),g=this._getOrCreateMaterial(e,u),_=new Geometry.V(g,m,null,ContentObjectType.X.Mesh,p);_.transformation=f,_.localOrigin=x,h.push(_)}return d&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:h,objectTransformation:m}}_updateMaterialParameters(e){this._materialInfoCache.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachClonedMaterial(((e,t)=>{t.setParameters(e.parameters)}))}_validateVertexSpace(e){const{_context:{graphicsCoreOwner:{view:{state:{viewingMode:t}}}}}=this,{vertexSpace:r}=e;return t!==ViewingMode.RT.Local||"local"!==r.type||(this.logger.warn("Displaying a mesh with a local vertex space in a view in local viewing mode is not supported."),!1)}test(){return{...super.test(),materials:this._materialInfoCache.materials}}}class Se{constructor(e,t,r){this.normals=e,this.indices=t,this.didFlipNormals=r}}function Ue(e,t){return t.faces??(0,Indices.tM)(e.vertexAttributes.position.length/3)}function Be(e,t,r,o){switch(r.shading||"flat"){default:case"source":return function De(e,t,r,o){if(null==t)return Fe(e,o);let a=!1;if(!r.trustSourceNormals)for(let n=0;n<o.length;n+=3){Le(e,o,n,rt);for(let e=0;e<3;e++){const r=3*o[n+e];Ze[0]=t[r],Ze[1]=t[r+1],Ze[2]=t[r+2],(0,vec32.f)(rt,Ze)<0&&(t[r]=-t[r],t[r+1]=-t[r+1],t[r+2]=-t[r+2],a=!0)}}return new Se(t,o,a)}(e,t,r,o);case"flat":return Fe(e,o);case"smooth":return function Ge(e,t){const r={};for(let n=0;n<t.length;n+=3){const o=Le(e,t,n,rt);for(let e=0;e<3;e++){const a=t[n+e];let s=r[a];s||(s={normal:(0,vec3f64.vt)(),count:0},r[a]=s),(0,vec32.g)(s.normal,s.normal,o),s.count++}}const o=(0,FloatArray.oe)(3*t.length),a=new Array(3*t.length);for(let n=0;n<t.length;n++){const e=r[t[n]];1!==e.count&&((0,vec32.n)(e.normal,e.normal),e.count=1);for(let t=0;t<3;t++)o[3*n+t]=e.normal[t];a[n]=n}return new Se(o,a,!1)}(e,o)}}function Fe(e,t){const r=(0,FloatArray.oe)(t.length),o=new Array(3*t.length);for(let a=0;a<t.length;a+=3){const n=Le(e,t,a,rt);for(let e=0;e<3;e++)r[a+e]=n[e],o[a+e]=a/3}return new Se(r,o,!1)}function Ve(e,t,r,o,a,n){const s=3*t[r],i=3*t[r+1],l=3*t[r+2];o[0]=e[s],o[1]=e[s+1],o[2]=e[s+2],a[0]=e[i],a[1]=e[i+1],a[2]=e[i+2],n[0]=e[l],n[1]=e[l+1],n[2]=e[l+2]}function Le(e,t,r,o){return Ve(e,t,r,Ze,et,tt),(0,vec32.d)(et,et,Ze),(0,vec32.d)(tt,tt,Ze),(0,vec32.e)(Ze,et,tt),(0,vec32.n)(o,Ze),o}function $e(e){if(!e)return null;const{scale:r,offset:o,rotation:a}=e;return{scale:r,offset:o,rotation:(0,mathUtils.kU)(a)}}function He(e="repeat"){if("string"==typeof e){const t=qe(e);return{s:t,t}}return{s:qe(e.horizontal),t:qe(e.vertical)}}function qe(e){switch(e){case"clamp":return enums.pF.CLAMP_TO_EDGE;case"mirror":return enums.pF.MIRRORED_REPEAT;default:return enums.pF.REPEAT}}function Ye(t){return null==t?"-":t instanceof Color.A?t.toHex():t.contentHash}function Je(e){const{offset:t,scale:r,rotation:o}=e??Qe;return`${t[0]},${t[1]},${o},${r[0]},${r[1]}`}const Qe=new MeshTextureTransform.A,Xe=(0,vec3f64.vt)(),Ze=(0,vec3f64.vt)(),et=(0,vec3f64.vt)(),tt=(0,vec3f64.vt)(),rt=(0,vec3f64.vt)(),Graphics3DMeshFillSymbolLayer_ot=(0,mat4f64.vt)(),Graphics3DMeshFillSymbolLayer_at=(0,mat4f64.vt)(),Graphics3DMeshFillSymbolLayer_nt=(0,aaBoundingBox.vt)(),Graphics3DMeshFillSymbolLayer_st=[new MeshComponent.A];var Graphics3DMeshFillSymbolLayer_it;!function(e){e[e.NONE=0]="NONE",e[e.RENDER=1]="RENDER"}(Graphics3DMeshFillSymbolLayer_it||(Graphics3DMeshFillSymbolLayer_it={}));var ObjectSymbol3DLayerResource=__webpack_require__("./node_modules/@arcgis/core/symbols/support/ObjectSymbol3DLayerResource.js"),symbolLayerUtils3D=__webpack_require__("./node_modules/@arcgis/core/symbols/support/symbolLayerUtils3D.js"),defaultSymbolComplexity=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/defaultSymbolComplexity.js"),Object3DStateID=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/Object3DStateID.js");class Graphics3DLodInstanceGraphicLayer_u{constructor(t,e,i,n,s){this.graphics3DSymbolLayer=t,this.instanceIndex=e,this.elevationAligner=i,this.elevationContext=n,this._highlightOrderMap=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1,this._highlightName=null}initialize(){}setVisibility(t){const{instanceData:e}=this;t!==e.getVisible(this.instanceIndex)&&e.setVisible(this.instanceIndex,t)}destroy(){null!=this.instanceIndex&&(this.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(t,e,i){if(this.elevationAligner){(0,featureExpressionInfoUtils.gf)(this.elevationContext.featureExpressionInfoContext,i);const n=(i,n)=>(0,elevationAlignmentUtils.sE)(i,t,this.elevationContext,e,n),s=this.elevationAligner(this,this.elevationContext,t.spatialReference,n,e);null!=s&&(this.alignedSampledElevation=s)}}getCenterObjectSpace(t=(0,vec3f64.vt)()){return this.instanceData.getCombinedLocalTransform(this.instanceIndex,Graphics3DLodInstanceGraphicLayer_),(0,vec32.t)(t,this._lodRenderer.baseBoundingSphere.center,Graphics3DLodInstanceGraphicLayer_)}getBoundingBoxObjectSpace(t=(0,aaBoundingBox.vt)()){this.instanceData.getCombinedLocalTransform(this.instanceIndex,Graphics3DLodInstanceGraphicLayer_);const n=this._lodRenderer.baseBoundingBox;(0,aaBoundingBox.Ie)(t);for(let s=0;s<8;++s)(0,vec32.i)(Graphics3DLodInstanceGraphicLayer_b,1&s?n[3]:n[0],2&s?n[4]:n[1],4&s?n[5]:n[2]),(0,vec32.t)(Graphics3DLodInstanceGraphicLayer_b,Graphics3DLodInstanceGraphicLayer_b,Graphics3DLodInstanceGraphicLayer_),(0,aaBoundingBox.iT)(t,Graphics3DLodInstanceGraphicLayer_b);return t}computeAttachmentOrigin(t){this.instanceData.getGlobalTransform(this.instanceIndex,Graphics3DLodInstanceGraphicLayer_),t.render.origin[0]+=Graphics3DLodInstanceGraphicLayer_[12],t.render.origin[1]+=Graphics3DLodInstanceGraphicLayer_[13],t.render.origin[2]+=Graphics3DLodInstanceGraphicLayer_[14],t.render.num++}async getProjectedBoundingBox(t,i,n,a,h){const g=this.getBoundingBoxObjectSpace(h),c=Graphics3DLodInstanceGraphicLayer_x,m=(0,aaBoundingBox.fT)(g)?1:c.length;this.instanceData.getGlobalTransform(this.instanceIndex,Graphics3DLodInstanceGraphicLayer_);for(let s=0;s<m;s++){const t=c[s];Graphics3DLodInstanceGraphicLayer_b[0]=g[t[0]],Graphics3DLodInstanceGraphicLayer_b[1]=g[t[1]],Graphics3DLodInstanceGraphicLayer_b[2]=g[t[2]],(0,vec32.t)(Graphics3DLodInstanceGraphicLayer_b,Graphics3DLodInstanceGraphicLayer_b,Graphics3DLodInstanceGraphicLayer_),Graphics3DLodInstanceGraphicLayer_f[3*s]=Graphics3DLodInstanceGraphicLayer_b[0],Graphics3DLodInstanceGraphicLayer_f[3*s+1]=Graphics3DLodInstanceGraphicLayer_b[1],Graphics3DLodInstanceGraphicLayer_f[3*s+2]=Graphics3DLodInstanceGraphicLayer_b[2]}if(!t(Graphics3DLodInstanceGraphicLayer_f,0,m))return null;(0,aaBoundingBox.Ie)(g);let p=null;this.calculateRelativeScreenBounds&&(p=this.calculateRelativeScreenBounds());for(let e=0;e<3*m;e+=3){for(let t=0;t<3;t++)g[t]=Math.min(g[t],Graphics3DLodInstanceGraphicLayer_f[e+t]),g[t+3]=Math.max(g[t+3],Graphics3DLodInstanceGraphicLayer_f[e+t]);p&&n.push({location:Graphics3DLodInstanceGraphicLayer_f.slice(e,e+3),screenSpaceBoundingRect:p})}if(i&&((0,aaBoundingBox.gX)(g,v),"absolute-height"!==this.elevationContext.mode)){let t;const e=(0,graphicUtils.vY)(g,i.service.spatialReference,i);try{t=await i.service.queryElevation(v[0],v[1],a,e,"ground")}catch(u){}null!=t&&(0,aaBoundingBox.cY)(g,0,0,-this.alignedSampledElevation+t)}return g}addObjectState(t){t.stateType===basicInterfaces.Mg.Highlight&&this.addObjectHighlightState(t)}addObjectHighlightState(t){const e=new Object3DStateID.h(t.highlightName);this._addHighlightId(e),t.addExternal((t=>{this._removeHighlightId(t)}),e)}removeObjectState(t){this._highlights.forEach((e=>t.remove(e)))}updateHighlights(t){this._highlightOrderMap=t,this._updateHighlightOptions()}_calculateHighlightOptions(){let t=-1,e=null;return this._highlights.forEach((({highlightName:i})=>{const n=this._highlightOrderMap.get(i);void 0!==n&&n>t&&(t=n,e=i)})),e}_addHighlightId(t){this._highlights.add(t),this._updateHighlightOptions()}_removeHighlightId(t){this._highlights.delete(t),this._updateHighlightOptions()}_updateHighlightOptions(){const t=this._calculateHighlightOptions();t!==this._highlightName&&(this._highlightName=t,this.instanceData.setHighlight(this.instanceIndex,t))}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}get instanceData(){return this._lodRenderer.instanceData}}const Graphics3DLodInstanceGraphicLayer_f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Graphics3DLodInstanceGraphicLayer_b=(0,vec3f64.vt)(),v=(0,vec3f64.vt)(),Graphics3DLodInstanceGraphicLayer_x=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],Graphics3DLodInstanceGraphicLayer_=(0,mat4f64.vt)();var Loadable=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/Loadable.js"),LodResources=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/lodRendering/LodResources.js");function t(e,t){const s=e.stageResources.geometries.map((r=>new LodResources.iC(new LodResources.dI(r),e.stageResources.textures))),l=null==e.lodThreshold||0===e.lodThreshold&&t>0?function lodResourceUtils_u(e){const n=e.reduce(((e,n)=>e+n.numTriangles),0);return Math.sqrt(n*lodResourceUtils_l/Math.PI)}(s):e.lodThreshold;return new LodResources.hr(s,l,e.pivotOffset)}function lodResourceUtils_s(n){return new LodResources.Fe(n.map(((e,n)=>t(e,n))))}const lodResourceUtils_l=20;var objectResourceUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/objectResourceUtils.js"),primitiveObjectSymbolUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/primitiveObjectSymbolUtils.js"),SymbolComplexity=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/SymbolComplexity.js"),styleUtils=__webpack_require__("./node_modules/@arcgis/core/symbols/support/styleUtils.js"),webStyleSymbolUtils=__webpack_require__("./node_modules/@arcgis/core/symbols/support/webStyleSymbolUtils.js");var olidUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/effects/geometry/olidUtils.js"),LodRenderer=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/lodRendering/LodRenderer.js");class Graphics3DObjectSymbolLayer_de{constructor(e,t,s,r,i,a,o,n,l,c,h,d){this.lodResources=e,this.lodRenderer=t,this.stageResources=s,this.originalMaterialParameters=r,this.resourceSize=i,this.isEsriSymbolResource=a,this.isWosr=o,this.resourceBoundingBox=n,this.symbolSize=l,this.extentPadding=c,this.physicalBasedRenderingEnabled=h,this.pivotOffset=d}}class Graphics3DObjectSymbolLayer_me extends Graphics3DSymbolLayer.U{getCachedSize(){const[e,t,s]=null!=this._resources?this._resources.symbolSize:[1,1,1];return{width:e,depth:t,height:s}}constructor(e,t,s,r){super(e,t,s,r),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.skipHighSymbolLodsChanged=!1,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=s.physicalBasedRenderingEnabled}async doLoad(e){if(!this._drivenProperties.size){const e=(0,graphicUtils.Hj)(this.symbolLayer);if(e)throw new Error(e)}if(this._isPrimitive){const t=this.symbolLayer.resource,s=t&&(0,primitiveObjectSymbolUtils.k)(t?.primitive)?t.primitive:ObjectSymbol3DLayerResource.r;this._resources=await this._createResourcesForPrimitive(s,e)}else{const t=await async function r(r){if(null==r||null==r.styleName&&null==r.styleUrl)return null;const o=r.name;if(null==o)throw new core_Error.A("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const u={portal:r.portal},i=await(0,styleUtils.cF)(r,u).catch((()=>null));if(null===i)return null;const m=(0,webStyleSymbolUtils.p)(o,i.data);if(m&&!m.formatInfos?.some((l=>"gltf_basisu"===l.type)))return null;const a=await(0,webStyleSymbolUtils.I)(i,o,u,styleUtils.o5,{acceptedFormats:["web-gltf-basisu","web-gltf","web"]}).catch((()=>null));if(null===a||"point-3d"!==a.type)return null;const y=a.symbolLayers.items[0];return"object"===y.type?y.resource:null}(this.symbol.styleOrigin),s=t?.href??this.symbolLayer.resource?.href;this._resources=await this._createResourcesForUrl(s,e)}this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return null!=this._resources?this._resources.extentPadding:0}get _isPrimitive(){return!this.symbolLayer.resource?.href}get lodRenderer(){return this._resources?.lodRenderer}get materials(){return this._resources?.stageResources.materials??[]}_setMaterialTransparencyParameters(e,t=this.symbolLayer?.material?.color){const s=this._getCombinedOpacity(t),r=s<1||this.needsDrivenTransparentPass;return e.transparent=r,e.opacity=s,e.cullFace=r?basicInterfaces.s2.None:basicInterfaces.s2.Back,e}async _createResourcesForPrimitive(t,r){const i=this.symbolLayer,a=(0,aaBoundingBox.vt)((0,symbolLayerUtils3D.Fq)(t)),o=(0,vec3f64.ci)((0,aaBoundingBox.Ej)(a)),n=(0,vec3f64.ci)((0,symbolLayerUtils3D.Bb)(o,i)),h=(0,vec32.l)(n),p=this.symbolLayer?.material?.emissiveFactor,u=p?(0,vec32.F)((0,vec3f64.o8)(p)):vec3f64.uY,b={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:pbrUtils.Bt,ambient:vec3f64.Un,diffuse:vec3f64.Un,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,emissiveFactor:u,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},P=!!b.usePBR;this._setMaterialTransparencyParameters(b);const x=this.symbol;if("point-3d"===x.type&&x.verticalOffset){const{screenLength:e,minWorldLength:t,maxWorldLength:r}=x.verticalOffset;b.verticalOffset={screenLength:(0,screenUtils.Lz)(e),minWorldLength:t||0,maxWorldLength:null!=r?r:1/0},b.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(b.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)b.externalColor=vec4f64.Un;else{const t=null!=i.material?i.material.color:null,s=null!=t?Color.A.toUnitRGBA(t):vec4f64.Un;b.externalColor=s}this._fastUpdates=(0,FastSymbolUpdates.s_)(this._context.renderer,this._fastVisualVariableConvertOptions(a,n,o,null)),b.isInstanced=!0,this._fastUpdates?(Object.assign(b,this._fastUpdates.materialParameters),this._optionalFields.push(VertexAttribute.r.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(b.hasInstancedColor=!0,this._optionalFields.push(VertexAttribute.r.COLOR)),(0,olidUtils.E)()&&this._optionalFields.push(VertexAttribute.r.OBJECTANDLAYERIDCOLOR);const v=new DefaultMaterial.$U(b,this._context),L=(0,primitiveObjectSymbolUtils._)(t,v);if(!L)throw new Error(`Unknown object symbol primitive: ${t}`);const w=L.getMaterials().map((e=>({opacity:1,transparent:e.parameters.transparent}))),E=await this._createStageResources(L,P,r),j=await this._createLodRenderer(L,r);return new Graphics3DObjectSymbolLayer_de(L,j,E,w,o,!1,!1,a,n,h,P,null)}async _createResourcesForUrl(e,t){const r={isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},i={spherical:this._context.spherical,doublePrecisionRequiresObfuscation:this._context.doublePrecisionRequiresObfuscation,materialParameters:r,streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=(0,FastSymbolUpdates.s_)(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)),this._fastUpdates?(Object.assign(i.materialParameters,this._fastUpdates.materialParameters),this._optionalFields.push(VertexAttribute.r.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(i.materialParameters.hasInstancedColor=!0,this._optionalFields.push(VertexAttribute.r.COLOR)),(0,olidUtils.E)()&&this._optionalFields.push(VertexAttribute.r.OBJECTANDLAYERIDCOLOR);const a=this.symbol;if("point-3d"===a.type&&a.verticalOffset){const{screenLength:e,minWorldLength:t,maxWorldLength:r}=a.verticalOffset;i.materialParameters.verticalOffset={screenLength:(0,screenUtils.Lz)(e),minWorldLength:t||0,maxWorldLength:null!=r?r:1/0},i.materialParameters.castShadows=!1}const o=this._context.physicalBasedRenderingEnabled;i.signal=t,i.usePBR=o,i.skipHighLods=this._context.skipHighSymbolLods;const n=await(0,objectResourceUtils.fetch)(e,i),c=n.isEsriSymbolResource,h=n.isWosr,d=lodResourceUtils_s(n.lods),m=this._context,p=this.symbolLayer.material,u=this._getExternalColorParameters(p),f=this.symbolLayer?.material?.color,_=this._getCombinedOpacity(f,{hasIntrinsicColor:!0}),g=this.needsDrivenTransparentPass,b=d.getMaterials(),P=d.getMaterials().map((e=>({opacity:e.parameters.opacity||1,transparent:e.parameters.transparent})));b.forEach((e=>{const t=e.parameters;e.setParameters(u);const s=t.opacity*_,r=s<1||g||t.transparent;e.setParameters({opacity:s,transparent:r}),m.screenSizePerspectiveEnabled&&e.setParameters({screenSizePerspective:m.sharedResources.screenSizePerspectiveSettings})}));const R=n.referenceBoundingBox,x=(0,vec3f64.ci)((0,aaBoundingBox.Ej)(R)),v=(0,vec3f64.ci)(d.levels[0].pivotOffset),L=(0,vec3f64.ci)((0,symbolLayerUtils3D.Bb)(x,this.symbolLayer)),C=(0,vec32.l)(L),w=this._fastUpdates;(0,FastSymbolUpdates.J_)(w,this._context.renderer,this._fastVisualVariableConvertOptions(R,L,x,v))&&b.forEach((e=>e.setParameters(w.materialParameters)));const E=await this._createStageResources(d,o,t),j=await this._createLodRenderer(d,t);return new Graphics3DObjectSymbolLayer_de(d,j,E,P,x,c,h,R,L,C,o,v)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,s,r){const i=this._context.stage,a=e.getMaterials();s!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),i.addMany(a),this._addDisposeResource((()=>i.removeMany(a)));const o=e.getTextures();i.addMany(o),this._addDisposeResource((()=>{o.forEach((e=>e.unload())),i.removeMany(o)})),await Promise.all(o.map((e=>this._context.stage.schedule((()=>e.load(i.renderView.renderingContext)),r)))),(0,promiseUtils.Te)(r);const n=e.getEngineGeometries();return i.addMany(n),this._addDisposeResource((()=>i.removeMany(n))),{materials:a,textures:o,geometries:n}}async _createLodRenderer(e,t){const s=this._context.stage,r={layerUid:this._context.layer.uid,graphicUid:e=>this._instanceIndexToGraphicUid.get(e),notifyGraphicGeometryChanged:e=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(e)),notifyGraphicVisibilityChanged:e=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(e))},i=this._fastUpdates,a=i?{applyTransform:(e,t,s)=>{e.getFeatureAttribute(t,ge),(0,mat4.C)(s,(0,FastSymbolUpdates.b3)(i.materialParameters,ge,s))},scaleFactor:(e,t,s)=>{t.getFeatureAttribute(s,ge),(0,FastSymbolUpdates.VC)(e,i.materialParameters,ge)}}:null,n=new LodRenderer.L({symbol:e,optionalFields:this._optionalFields,metadata:r,shaderTransformation:a},this._context.scheduler);return n.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource((()=>{s.removeRenderPlugin(n),n.destroy()})),await s.addRenderPlugin(n,t),n}_getExternalColorParameters(t){const s={};return this._drivenProperties.color?s.externalColor=vec4f64.Un:null!=t?.color?s.externalColor=Color.A.toUnitRGBA(t.color):(s.externalColor=vec4f64.Un,s.colorMixMode="ignore"),s}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach((e=>e())),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry))return null;const s=(0,pointUtils.ZX)(t.geometry);if(null==s)return this.logger.warn(`unsupported geometry type for object symbol: ${t.geometry.type}`),null;const r=this.setGraphicElevationContext(t),i=e.renderingInfo;return this._createAs3DShape(t,s,i,r,t.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(null==this._resources)return;const e=this._drivenProperties.opacity,t=!this._isPrimitive,s=this._resources.stageResources.materials,r=this._resources.originalMaterialParameters;for(let i=0;i<s.length;i++){const a=s[i],o=this.symbolLayer?.material?.color,n=r[i],l=this._getCombinedOpacity(o,{hasIntrinsicColor:t})*n.opacity,c=l<1||e||n.transparent;a.setParameters({opacity:l,transparent:c}),this._isPrimitive&&a.setParameters({cullFace:c?basicInterfaces.s2.None:basicInterfaces.s2.Back})}}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,elevationAlignmentUtils.Kf)}slicePlaneEnabledChanged(){if(null==this._resources)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(null==this._resources)return!0;const{stageResources:e,isWosr:t}=this._resources;for(const s of e.materials)this._isPrimitive?s.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):t||s.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return!1!==this._hasLoadedPBRTextures||!0!==this._context.physicalBasedRenderingEnabled||(this._hasLoadedPBRTextures=!0,!1)}applyRendererDiff(e,t){if(null==this._resources)return interfaces.w.RecreateSymbol;const{stageResources:{materials:s},lodRenderer:r,resourceBoundingBox:i,symbolSize:a,resourceSize:o,pivotOffset:n}=this._resources;for(const l in e.diff){if("visualVariables"!==l)return interfaces.w.RecreateSymbol;if(!(0,FastSymbolUpdates.J_)(this._fastUpdates,t,this._fastVisualVariableConvertOptions(i,a,o,n)))return interfaces.w.RecreateSymbol;for(const e of s)e.setParameters(this._fastUpdates.materialParameters);r.notifyShaderTransformationChanged()}return interfaces.w.FastUpdate}computeComplexity(){if(null==this._resources)return super.computeComplexity();const e=this._resources.lodResources,t=(0,defaultSymbolComplexity.pg)(e.levels),s=e.computeUsedMemory(),r={...(0,defaultSymbolComplexity.GI)(this.symbol,this.symbolLayer),resourceBytes:s};return new SymbolComplexity.rz({verticesPerFeature:t,memory:r})}_hasLodRenderer(){return null!=this._resources}_createAs3DShape(e,t,s,r,i,a){if(!this._hasLodRenderer()||null==this._resources)return null;const o=this.getFastUpdateAttrValues(e),n=this._context.clippingExtent;if((0,projectPointToVector.g)(t,ye,this._context.elevationProvider.spatialReference),null!=n&&!(0,aaBoundingBox.Uc)(n,ye))return null;const l=Graphics3DObjectSymbolLayer_ue(r),c=this._computeGlobalTransform(t,r,Graphics3DObjectSymbolLayer_e,be),h=this._computeLocalTransform(this._resources,this.symbolLayer,s,Graphics3DObjectSymbolLayer_fe),d=this._resources.lodRenderer.instanceData,m=d.addInstance();this._instanceIndexToGraphicUid.set(m,i),d.setLocalTransform(m,h,!1),d.setGlobalTransform(m,c),o&&d.setFeatureAttribute(m,o),null==this._fastUpdates&&this._hasPerInstanceColor()&&d.setColor(m,(0,graphicUtils.$C)(s.color,s.opacity,255));const p=this._context.stage.renderView.olidRenderHelper;p&&d.setObjectAndLayerIdColor(m,p.getObjectAndLayerIdColor({graphicUid:i,layerUid:a}));const u=new Graphics3DLodInstanceGraphicLayer_u(this,m,ElevationAligners.Jf,r,this._context.stage.view.state.highlightOrderMap);return l&&(u.alignedSampledElevation=be.sampledElevation),u.needsElevationUpdates=(0,elevationAlignmentUtils.Kf)(r.mode),(0,pointUtils.d2)(u,t,this._context.elevationProvider),u}_computeGlobalTransform(e,t,s,r){return(0,elevationAlignmentUtils.sE)(e,this._context.elevationProvider,t,this._context.renderCoordsHelper,r),ye[0]=e.x,ye[1]=e.y,ye[2]=r.z,(0,computeTranslationToOriginAndRotation.l)(e.spatialReference,ye,s,this._context.renderCoordsHelper.spatialReference),s}_computeLocalTransform(e,t,s,i){return(0,mat4.D_)(i),this._applyObjectRotation(s,!1,i),this._applyObjectRotation(t,!0,i),this._applyObjectScale(e,s,i),this._applyAnchor(e,t,i),i}_applyObjectScale(e,t,s){if(this._fastUpdates?.requiresShaderTransformation)return;const r=this._drivenProperties.size&&t.size?t.size:e.symbolSize,a=(0,graphicUtils.pW)(r,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);1===a[0]&&1===a[1]&&1===a[2]||(0,mat4.hs)(s,s,a)}prepareSymbolLayerPatch(e){if("partial"!==e.diff.type)return;const t=e.diff.diff;this._preparePatchTransform(e,t),this._preparePatchColor(e,t)}updateGeometry(e,t){if(null==this._resources)return!0;const s=t&&(0,pointUtils.ZX)(t);if(null==s)return!1;const r=this.getGeometryElevationMode(t);return e.elevationContext.mode===r&&(this._computeGlobalTransform(s,e.elevationContext,Graphics3DObjectSymbolLayer_e,be),Graphics3DObjectSymbolLayer_ue(e.elevationContext)&&(e.alignedSampledElevation=be.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,Graphics3DObjectSymbolLayer_e,!0),(0,pointUtils.d2)(e,s,this._context.elevationProvider),!0)}_preparePatchTransform(e,t){if(!(t.heading||t.tilt||t.roll||t.width||t.height||t.depth||t.anchor||t.anchorPosition))return;if(null==this._resources)return;const s=(e,t,s)=>(null!=e&&"complete"===e.type?e.newValue:t)??s,r=s(t.heading,this.symbolLayer.heading,0),i=s(t.tilt,this.symbolLayer.tilt,0),a=s(t.roll,this.symbolLayer.roll,0),o=s(t.width,this.symbolLayer.width,void 0),n=s(t.height,this.symbolLayer.height,void 0),l=s(t.depth,this.symbolLayer.depth,void 0),c=s(t.anchor,this.symbolLayer.anchor,void 0),h=s(t.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete t.heading,delete t.tilt,delete t.roll,delete t.width,delete t.height,delete t.depth,delete t.anchor,delete t.anchorPosition;const d={heading:r,tilt:i,roll:a,anchor:c,anchorPosition:h},m=this._resources;this.loadStatus===Loadable.P.LOADED&&e.symbolLayerStatePatches.push((()=>{m.symbolSize=(0,vec3f64.ci)((0,symbolLayerUtils3D.Bb)(m.resourceSize,{width:o,height:n,depth:l,isPrimitive:this.symbolLayer.isPrimitive}))})),e.graphics3DGraphicPatches.push((({instanceIndex:e},t)=>{const s=this._computeLocalTransform(m,d,t,Graphics3DObjectSymbolLayer_fe);m.lodRenderer.instanceData.setLocalTransform(e,s,!0)}))}_preparePatchColor(t,s){if(!s.material||"partial"!==s.material.type)return;const r=s.material.diff;if(!r.color||"complete"!==r.color.type||null==r.color.newValue||null==r.color.oldValue)return;const i=r.color.newValue,a=null!=i?Color.A.toUnitRGBA(i):vec4f64.Un;delete r.color;const o=this._resources;null!=o&&t.graphics3DGraphicPatches.push((({instanceIndex:e})=>{let t;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(e,a),t=this._setMaterialTransparencyParameters({},i)):t=this._setMaterialTransparencyParameters({externalColor:a},i);for(const s of o.stageResources.materials)s.setParameters(t)}))}_applyObjectRotation(e,t,s){if(!this._fastUpdates?.requiresShaderTransformation||!t)return(0,graphicUtils.$2)(e.heading,e.tilt,e.roll,s)}_applyAnchor(e,t,s){if(this._fastUpdates?.requiresShaderTransformation)return;const r=Graphics3DObjectSymbolLayer_pe(e.resourceBoundingBox,e.pivotOffset,t);r&&(0,mat4.Tl)(s,s,r)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,t,s,r){const i=null!=e?(0,vec3f64.ci)((0,aaBoundingBox.Ej)(e)):vec3f64.Un,a=null!=e?Graphics3DObjectSymbolLayer_pe(e,r,this.symbolLayer):vec3f64.uY,o=this._context.renderCoordsHelper.unitInMeters,n=(0,graphicUtils.pW)(null!=t?t:void 0,t,s,o),l=(0,vec3f64.fA)(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new FastSymbolUpdates.wI({size:!0,color:!0,rotation:!0,opacity:!1},i,t??vec3f64.Un,o,a,n,l)}}function Graphics3DObjectSymbolLayer_pe(e,t,s){const r=(0,vec3f64.vt)();switch(s.anchor){case"center":(0,vec32.c)(r,(0,aaBoundingBox.gX)(e)),(0,vec32.v)(r,r);break;case"top":{const t=(0,aaBoundingBox.gX)(e);(0,vec32.i)(r,-t[0],-t[1],-e[5]);break}case"bottom":{const t=(0,aaBoundingBox.gX)(e);(0,vec32.i)(r,-t[0],-t[1],-e[2]);break}case"relative":{const t=(0,aaBoundingBox.gX)(e),i=(0,aaBoundingBox.Ej)(e),a=s.anchorPosition,o=a?(0,vec3f64.fA)(a.x,a.y,a.z):vec3f64.uY;(0,vec32.C)(r,i,o),(0,vec32.g)(r,r,t),(0,vec32.v)(r,r);break}default:null!=t?(0,vec32.v)(r,t):(0,vec32.c)(r,vec3f64.uY)}return r}function Graphics3DObjectSymbolLayer_ue(e){return"absolute-height"!==e.mode}const ye=(0,vec3f64.vt)(),Graphics3DObjectSymbolLayer_fe=(0,mat4f64.vt)(),Graphics3DObjectSymbolLayer_e=(0,mat4f64.vt)(),ge=(0,vec4f64.vt)(),be=new elevationAlignmentUtils.Uk;var Graphics3DPathSymbolLayerConstants=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DPathSymbolLayerConstants.js"),memoryEstimations=__webpack_require__("./node_modules/@arcgis/core/core/memoryEstimations.js");class Path_n{constructor(t,i,s,o){this.vertices=t,this.positionsES=i,this.offset=o;const n=t.length,r=Math.floor(n/2),g=this.offset+3*r,v=s[g],f=s[g+1],c=s[g+2];this.origin=(0,vec3f64.fA)(v,f,c),this.positions=(0,FloatArray.oe)(3*n);const a=this.offset+3*n;for(let e=this.offset;e<a;e+=3)this.positions[e]=s[e]-v,this.positions[e+1]=s[e+1]-f,this.positions[e+2]=s[e+2]-c;this.updatePathVertexInformation()}get usedMemory(){return(0,memoryEstimations.Qf)(this.positions)}updatePathVertexInformation(){const t=this.vertices.length,e=this.vertices[0];let h=this.offset;const n=this.positions;e.vRight[0]=n[h+3]-n[h],e.vRight[1]=n[h+4]-n[h+1],e.vRight[2]=n[h+5]-n[h+2],h+=3;let r=(0,vec32.l)(e.vRight);e.vMinSiblingLength=r,(0,vec32.n)(e.vRight,e.vRight);let g=e;for(let v=1;v<t;++v){const e=this.vertices[v];if(e.vLeft=g.vRight,v<t-1){e.vRight[0]=n[h+3]-n[h],e.vRight[1]=n[h+4]-n[h+1],e.vRight[2]=n[h+5]-n[h+2];const t=(0,vec32.l)(e.vRight);e.vMinSiblingLength=Math.min(r,t),r=t,(0,vec32.n)(e.vRight,e.vRight)}else(0,vec32.c)(e.vRight,e.vLeft),e.vMinSiblingLength=r;g=e,h+=3}}}class PathBuilder_o{constructor(t,r,o,h,p,n={}){this.path=t,this.profile=r,this.extruder=o,this.startCap=h,this.endCap=p,this.options=n,this._extrusionVertexCount=0;const l=this.path.vertices.length-2;this.numExtrusionProfiles=o.numProfilesPerJoin()*l+2,this.numVerticesTotal=r.vertices.length*this.numExtrusionProfiles,this.startCap.vertexBufferStart=this.numVerticesTotal;const a=this.startCap.numVertices;this.numVerticesTotal+=a,this.endCap.vertexBufferStart=this.numVerticesTotal;const u=this.endCap.numVertices;this.numVerticesTotal+=u,this.pathVertexData=(0,Indices.JH)(1*this.numVerticesTotal),this.profileRightAxes=(0,FloatArray.oe)(4*this.numVerticesTotal),this.profileUpAxes=(0,FloatArray.oe)(4*this.numVerticesTotal),this.profileVertexAndNormals=(0,FloatArray.oe)(4*this.numVerticesTotal),this.positions=(0,FloatArray.AK)(t.positions,t.offset,3*t.vertices.length),this._rebuildGeometry(),this.buildTopology()}get usedMemory(){return(0,memoryEstimations.Qf)(this.pathVertexData,this.profileRightAxes,this.profileUpAxes,this.profileVertexAndNormals)+this.path.usedMemory+this.profile.usedMemory}emitVertex(t,e,i,s,r){const o=4*this._extrusionVertexCount;if(this.profileRightAxes[o]=e.right[0],this.profileRightAxes[o+1]=e.right[1],this.profileRightAxes[o+2]=e.right[2],this.profileUpAxes[o]=e.up[0],this.profileUpAxes[o+1]=e.up[1],this.profileUpAxes[o+2]=e.up[2],this.profileVertexAndNormals[o]=i[0],this.profileVertexAndNormals[o+1]=i[1],this.profileVertexAndNormals[o+2]=s[0],this.profileVertexAndNormals[o+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,r){const e=this.path.vertices[t],i=e.maxStretchDistance;this.profileRightAxes[o+3]=e.rotationRight[0]*i,this.profileUpAxes[o+3]=e.rotationRight[1]*i}else this.profileRightAxes[o+3]=0,this.profileUpAxes[o+3]=0;++this._extrusionVertexCount}emitCapVertex(t,e,i,s,r,o){const h=4*this._extrusionVertexCount;this.profileRightAxes[h]=e.right[0],this.profileRightAxes[h+1]=e.right[1],this.profileRightAxes[h+2]=e.right[2],this.profileRightAxes[h+3]=r,this.profileUpAxes[h]=e.up[0],this.profileUpAxes[h+1]=e.up[1],this.profileUpAxes[h+2]=e.up[2],this.profileUpAxes[h+3]=o,this.profileVertexAndNormals[h]=i[0],this.profileVertexAndNormals[h+1]=i[1],this.profileVertexAndNormals[h+2]=s[0],this.profileVertexAndNormals[h+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const{positions:t,offset:e,vertices:s}=this.path;this.positions=(0,FloatArray.AK)(t,e,3*s.length);let r=0;const o=(t,e,i,s,o)=>this.emitCapVertex(r,t,e,i,s,o),h=(t,e,i,s)=>this.emitVertex(r,t,e,i,s);for(this.startCap.rebuildConnectingProfileGeometry(s[r],this.profile,o),r=1;r<s.length-1;++r)this.extruder.extrude(s[r],this.profile,h);this.endCap.rebuildConnectingProfileGeometry(s[r],this.profile,o),r=0,this.startCap.rebuildCapGeometry(s[r],o),r=s.length-1,this.endCap.rebuildCapGeometry(s[r],o)}buildTopology(){const t=this.profile.vertices.length,e=this.profile.numSegments,i=this.numExtrusionProfiles-1;let s=e*i*2*3;this.startCap.indexBufferStart=s,this.startCap.firstProfileVertexIndex=0,s+=this.startCap.numIndices,this.endCap.indexBufferStart=s,this.endCap.firstProfileVertexIndex=t*(this.numExtrusionProfiles-1);const o=new Array,h=new Array,p=new Array,n=(t,e,i)=>{o.push(t),o.push(e),o.push(i),h.push(t),h.push(e),h.push(i),p.push(this.pathVertexData[t]),p.push(this.pathVertexData[e]),p.push(this.pathVertexData[i])};for(let r=0;r<e;++r){const e=this.profile.indices[2*r],s=this.profile.indices[2*r+1];for(let r=0;r<i;++r){const i=r*t+e,o=(r+1)*t+s,h=r*t+s;n(i,(r+1)*t+e,o),n(i,o,h)}}this.startCap.buildTopology(this.path.vertices[0],n),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],n),this.vertexIndices=(0,Indices.Dg)(o),this.normalIndices=(0,Indices.Dg)(h),this.pathVertexIndices=(0,Indices.Dg)(p)}onPathChanged(){this._rebuildGeometry()}}class o{rebuildConnectingProfileGeometry(e,t,s){for(let i=0;i<t.vertices.length;++i)s(e.frame,t.vertices[i],t.normals[i],0,0)}}class PathCapBuilder_l extends o{constructor(){super(),this.numVertices=0,this.numIndices=0}rebuildCapGeometry(){}buildTopology(){}}class PathCapBuilder_f extends o{constructor(e,t=0,s=!1){super(),this.profile=e,this.profilePlaneOffset=t,this.flip=s}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,t,s){const i=this.profilePlaneOffset;for(let r=0;r<t.vertices.length;++r)s(e.frame,t.vertices[r],t.normals[r],i,0)}rebuildCapGeometry(t,s){const i=this.profile,r=this.flip?1:-1,n=this.profilePlaneOffset,o=PathCapBuilder_m;(0,vec2.hZ)(o,0,0);for(let e=0;e<i.vertices.length;++e)s(t.frame,i.vertices[e],o,n,r)}buildTopology(e,t){const s=this.profile,i=this.vertexBufferStart+s.indices[0];for(let r=1;r<s.numSegments;++r){const e=s.indices[2*r],n=s.indices[2*r+1],o=this.vertexBufferStart+e,l=this.vertexBufferStart+n;this.flip?t(l,o,i):t(i,o,l)}}}class PathCapBuilder_h extends o{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}get numVertices(){let e=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;return this.breakNormals&&(e+=this.profile.vertices.length),e}get numIndices(){let e=0;const t=this.profile;e+=2*t.numSegments*(this.numSegments-1);for(let s=0;s<t.numSegments;++s){const i=t.indices[2*s],r=t.indices[2*s+1];t.poleIndices[i]===t.poleIndices[r]?e+=1:e+=2}return 3*e}rebuildCapGeometry(n,o){const l=this.profile,f=n.frame,h=.5*this.sign,p=PathCapBuilder_c,a=PathCapBuilder_m;(0,vec2.hZ)(a,0,0);for(const e of l.poles)e.normal?o(f,e.position,e.normal,h,0):o(f,e.position,a,h,this.sign);if(this.breakNormals)for(let e=0;e<l.vertices.length;++e)o(f,l.vertices[e],l.normals[e],0,0);for(let e=0;e<this.numSegments-1;++e){const n=(1-(e+1)/this.numSegments)*Math.PI*.5,c=Math.sin(n),m=Math.cos(n);for(let e=0;e<l.vertices.length;++e){const n=l.poles[l.poleIndices[e]];(0,vec2.Re)(p,l.vertices[e],n.position),(0,vec2.hs)(p,p,c),n.normal?((0,vec2.WQ)(p,p,n.position),o(f,p,n.normal,h*m,0)):((0,vec2.S8)(a,p),(0,vec2.hs)(a,a,c),(0,vec2.WQ)(p,p,n.position),o(f,p,a,h*m,this.sign*m))}}}buildTopology(e,t){const s=this.profile,i=this.breakNormals?this.vertexBufferStart+s.poles.length:this.firstProfileVertexIndex,r=this.breakNormals?this.vertexBufferStart+s.poles.length+s.vertices.length:this.vertexBufferStart+s.poles.length;for(let n=0;n<s.numSegments;++n){const e=s.indices[2*n],o=s.indices[2*n+1],l=this.vertexBufferStart+s.poleIndices[e],f=this.vertexBufferStart+s.poleIndices[o];let h=i+e,c=i+o;for(let i=0;i<this.numSegments-1;++i){const n=r+i*s.vertices.length+e,l=r+i*s.vertices.length+o;this.flip?(t(n,c,h),t(c,n,l)):(t(h,c,n),t(l,n,c)),h=n,c=l}this.flip?(t(l,c,h),l!==f&&t(l,f,c)):(t(h,c,l),l!==f&&t(c,f,l))}}}const PathCapBuilder_c=(0,vec2f64.vt)(),PathCapBuilder_m=(0,vec2f64.vt)();class PathExtruder_c{numProfilesPerJoin(){return 1}extrude(t,e,r){for(let s=0;s<e.vertices.length;++s)r(t.frame,e.vertices[s],e.normals[s],!1)}}class PathExtruder_a{constructor(t,e){this.cutoffAngle=t,this.numBendSubdivisions=e}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,s,i){const o=PathExtruder_h,{rotationAngle:n,rotationRight:c,frame:a}=e;if(Math.abs(n)>=this.cutoffAngle){const l=e.rotationFrameUp;for(let h=0;h<this.numBendSubdivisions+1;++h){(0,mat4.$0)(PathExtruder_u,.5*-n+h*n/this.numBendSubdivisions,l),PathExtruder_m(o,a,PathExtruder_u);for(let t=0;t<s.vertices.length;++t)(0,vec2.Om)(s.vertices[t],c)*n>=0?i(o,s.vertices[t],s.normals[t],!1):i(a,e.applyMiterStretch(PathExtruder_f,s.vertices[t]),s.normals[t],!0)}}else for(let t=0;t<this.numBendSubdivisions+1;++t)for(let o=0;o<s.vertices.length;++o){const t=(0,vec2.Om)(s.vertices[o],c)*n>=0;i(a,e.applyMiterStretch(PathExtruder_f,s.vertices[o]),s.normals[o],!t)}}}class PathExtruder_l{constructor(){this.up=(0,vec3f64.vt)(),this.right=(0,vec3f64.vt)()}}function PathExtruder_m(t,e,r){(0,vec32.t)(t.up,e.up,r),(0,vec32.t)(t.right,e.right,r)}const PathExtruder_f=(0,vec2f64.vt)(),PathExtruder_u=(0,mat4f64.vt)(),PathExtruder_h=new PathExtruder_l;class PathGeometry_e extends Geometry.V{constructor(r,e,o,n,s,i){super(r,e,null,ContentObjectType.X.Mesh,i),this.path=o,this.geometrySR=n,this.stencilWidth=s}}var PathGeometry_o;function PathGeometry_n(t){return"path"in t}!function(t){t[t.World=0]="World",t[t.Path=1]="Path"}(PathGeometry_o||(PathGeometry_o={}));var RayIntersections=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/RayIntersections.js");class PathGeometryData_d{constructor(t){this.builder=t}onPathChanged(t){this.builder.onPathChanged()}}class PathGeometryData_f extends PathGeometryData_d{constructor(t){super(t),this.vertexAttributeColor=(0,vec4f64.fA)(255,255,255,255),this.size=new Array,this.vertexAttributePosition=(0,FloatArray.oe)(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(t){this.vertexAttributeColor[0]=255*t[0],this.vertexAttributeColor[1]=255*t[1],this.vertexAttributeColor[2]=255*t[2],this.vertexAttributeColor[3]=255*(t.length>3?t[3]:1)}bake(a){this.size=a;const{numVerticesTotal:l,pathVertexData:c,path:u,positions:b,profileRightAxes:v,profileUpAxes:m,profileVertexAndNormals:x}=this.builder;for(let A=0;A<l;++A){let l=c[A];const d=0===l||l===u.vertices.length-1;l*=3;const f=PathGeometryData_V;let g=0,D=0;const N=4*A,j=(0,vec32.i)(PathGeometryData_R,v[N],v[N+1],v[N+2]),E=(0,vec32.i)(w,m[N],m[N+1],m[N+2]),y=(0,vec2.hZ)(PathGeometryData_P,x[N]*a[0],x[N+1]*a[1]);if(d)(0,vec32.e)(f,E,j),g=v[N+3]*a[0],D=m[N+3];else{const a=PathGeometryData_I,h=PathGeometryData_C;(0,vec2.hZ)(a,v[N+3],m[N+3]);const l=(0,vec2.Bw)(a);(0,vec2.S8)(a,a);const c=(0,vec2.Om)(y,a);if(Math.abs(c)>l){(0,vec2.hZ)(h,-a[1],a[0]);const e=(0,vec2.Om)(y,h);(0,vec2.hs)(a,a,l*Math.sign(c)),(0,vec2.hs)(h,h,e),(0,vec2.WQ)(y,a,h)}(0,vec32.i)(f,0,0,0)}const T=(0,vec32.i)(PathGeometryData_O,j[0]*y[0]+E[0]*y[1],j[1]*y[0]+E[1]*y[1],j[2]*y[0]+E[2]*y[1]),L=3*A;this.vertexAttributePosition[L]=b[l]+T[0]+f[0]*g,this.vertexAttributePosition[L+1]=b[l+1]+T[1]+f[1]*g,this.vertexAttributePosition[L+2]=b[l+2]+T[2]+f[2]*g;const M=(0,vec2.hZ)(PathGeometryData_P,x[N+2],x[N+3]);(0,Normals.aT)(this.vertexAttributeNormal,A,j[0]*M[0]+E[0]*M[1]+f[0]*D,j[1]*M[0]+E[1]*M[1]+f[1]*D,j[2]*M[0]+E[2]*M[1]+f[2]*D)}}createGeometryData(){const t=this.builder.vertexIndices.length,{normalIndices:e,vertexIndices:r}=this.builder;return[[VertexAttribute.r.POSITION,new Attribute.n(this.vertexAttributePosition,r,3,!0)],[VertexAttribute.r.NORMALCOMPRESSED,new Attribute.n(this.vertexAttributeNormal,e,2,!0)],[VertexAttribute.r.COLOR,new Attribute.n(this.vertexAttributeColor,(0,Indices.EH)(t),4)]]}onPathChanged(t){super.onPathChanged(t),this.bake(this.size)}intersect(t,e,r,i){const s=this.builder.vertexIndices,o=new Attribute.K(this.vertexAttributePosition,3),a=s.length/3;(0,RayIntersections.Z$)(t,e,0,a,s,o,void 0,r,((t,e,r)=>i(t,r,e,!1)))}}class PathGeometryData_g extends PathGeometryData_d{constructor(t,e,r,i){super(t),this.sizeAttributeValue=e,this.colorAttributeValue=r,this.opacityAttributeValue=i,this.vvData=null,this.baked=new PathGeometryData_f(t),this.vvData=(0,FloatArray.oe)(4*this.builder.path.vertices.length);for(let s=0;s<this.builder.path.vertices.length;++s){this.vvData[4*s]=e,this.vvData[4*s+1]=r,this.vvData[4*s+2]=i;const t=0===s||s===this.builder.path.vertices.length-1;this.vvData[4*s+3]=t?1:0}}createGeometryData(){const{positions:t,profileRightAxes:e,profileUpAxes:r,profileVertexAndNormals:i,pathVertexIndices:s,vertexIndices:o}=this.builder;return[[VertexAttribute.r.POSITION,new Attribute.n(t,s,3,!0)],[VertexAttribute.r.PROFILERIGHT,new Attribute.n(e,o,4,!0)],[VertexAttribute.r.PROFILEUP,new Attribute.n(r,o,4,!0)],[VertexAttribute.r.PROFILEVERTEXANDNORMAL,new Attribute.n(i,o,4,!0)],[VertexAttribute.r.FEATUREVALUE,new Attribute.n(this.vvData,s,4,!0)]]}onPathChanged(t){super.onPathChanged(t);const e=t.getMutableAttribute(VertexAttribute.r.POSITION);e&&(e.data=this.builder.positions)}}const PathGeometryData_P=(0,vec2f64.vt)(),PathGeometryData_I=(0,vec2f64.vt)(),PathGeometryData_C=(0,vec2f64.vt)(),PathGeometryData_O=(0,vec3f64.vt)(),PathGeometryData_V=(0,vec3f64.vt)(),PathGeometryData_R=(0,vec3f64.vt)(),w=(0,vec3f64.vt)();var ray=__webpack_require__("./node_modules/@arcgis/core/geometry/support/ray.js");const pathGeometryUtils_n=(0,vec3f64.vt)();class PathProfile_r{constructor(){this.vertices=new Array,this.normals=new Array,this.indices=new Array,this.poles=new Array,this.poleIndices=new Array}addVertex(t,e){return this.vertices.push((0,vec2f64.o8)(t)),this.normals.push((0,vec2f64.o8)(e)),this.vertices.length-1}addPole(t,e=null){return this.poles.push({position:(0,vec2f64.o8)(t),normal:e?(0,vec2f64.o8)(e):null}),this.poles.length-1}addSegment(t,e=null){this.indices.push(t.v0),this.indices.push(t.v1),e&&(this.poleIndices.push(e.v0),this.poleIndices.push(e.v1))}get numSegments(){return this.indices.length/2}translate(t,e){for(const s of this.vertices)s[0]+=t,s[1]+=e;for(const s of this.poles)s.position[0]+=t,s.position[1]+=e}get usedMemory(){return this.vertices.length*(0,memoryEstimations.Qf)(this.vertices[0])*2+(0,memoryEstimations.Qf)(this.indices)}}const PathProfile_n={top:[0,-.5],bottom:[0,.5]};function PathProfile_i(t){const i=Graphics3DPathSymbolLayerConstants.ZC,d=new PathProfile_r,a={v0:0,v1:0};d.addPole((0,vec2f64.fA)(0,0));for(let o=0;o<i;++o){const t=2*o*Math.PI/i,r=Math.cos(t),n=Math.sin(t),a=(0,vec2f64.fA)(.5*r,.5*n),c=(0,vec2f64.fA)(r,n);d.addVertex(a,c)}for(let e=0;e<i-1;++e){const t={v0:e,v1:e+1};d.addSegment(t,a)}const c={v0:i-1,v1:0};if(d.addSegment(c,a),"center"!==t){const e=PathProfile_n[t];d.translate(e[0],e[1])}return d}const PathProfile_d={center:PathProfile_i("center"),top:PathProfile_i("top"),bottom:PathProfile_i("bottom")},PathProfile_a={center:PathProfile_c("center"),top:PathProfile_c("top"),bottom:PathProfile_c("bottom")};function PathProfile_c(t){const i=new PathProfile_r,d=(0,vec2f64.fA)(-.5,-.5),a=(0,vec2f64.fA)(.5,-.5),c=(0,vec2f64.fA)(.5,.5),h=(0,vec2f64.fA)(-.5,.5),l=(0,vec2f64.fA)(0,-1),v=(0,vec2f64.fA)(1,0),m=(0,vec2f64.fA)(0,1),p=(0,vec2f64.fA)(-1,0);if(i.addPole((0,vec2f64.fA)(0,.5),m),i.addPole((0,vec2f64.fA)(0,.5)),i.addPole((0,vec2f64.fA)(0,-.5)),i.addPole((0,vec2f64.fA)(0,-.5),l),i.addVertex(d,l),i.addVertex(a,l),i.addSegment({v0:0,v1:1},{v0:3,v1:3}),i.addVertex(a,v),i.addVertex(c,v),i.addSegment({v0:2,v1:3},{v0:2,v1:1}),i.addVertex(c,m),i.addVertex(h,m),i.addSegment({v0:4,v1:5},{v0:0,v1:0}),i.addVertex(h,p),i.addVertex(d,p),i.addSegment({v0:6,v1:7},{v0:1,v1:2}),"center"!==t){const e=PathProfile_n[t];i.translate(e[0],e[1])}return i}var common=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/math/common.js");function mat2_a(t,n,r,a,u){return t[0]=n,t[1]=r,t[2]=a,t[3]=u,t}function mat2_s(t,n,r){const a=n[0],u=n[1],o=n[2],e=n[3],c=r[0],s=r[1],i=r[2],f=r[3];return t[0]=a*c+o*s,t[1]=u*c+e*s,t[2]=a*i+o*f,t[3]=u*i+e*f,t}function mat2_p(t,n,r){return t[0]=n[0]-r[0],t[1]=n[1]-r[1],t[2]=n[2]-r[2],t[3]=n[3]-r[3],t}const mat2_=mat2_s,mat2_g=mat2_p;Object.freeze(Object.defineProperty({__proto__:null,LDU:function mat2_m(t,n,r,a){return t[2]=a[2]/a[0],r[0]=a[0],r[1]=a[1],r[3]=a[3]-t[2]*r[1],[t,n,r]},add:function mat2_d(t,n,r){return t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t[3]=n[3]+r[3],t},adjoint:function mat2_e(t,n){const r=n[0];return t[0]=n[3],t[1]=-n[1],t[2]=-n[2],t[3]=r,t},copy:function mat2_n(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t},determinant:function mat2_c(t){return t[0]*t[3]-t[2]*t[1]},equals:function mat2_x(n,r){const a=n[0],u=n[1],o=n[2],e=n[3],c=r[0],s=r[1],i=r[2],f=r[3],l=(0,common.FD)();return Math.abs(a-c)<=l*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(u-s)<=l*Math.max(1,Math.abs(u),Math.abs(s))&&Math.abs(o-i)<=l*Math.max(1,Math.abs(o),Math.abs(i))&&Math.abs(e-f)<=l*Math.max(1,Math.abs(e),Math.abs(f))},exactEquals:function y(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]},frob:function mat2_b(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)},fromRotation:function mat2_l(t,n){const r=Math.sin(n),a=Math.cos(n);return t[0]=a,t[1]=r,t[2]=-r,t[3]=a,t},fromScaling:function M(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=n[1],t},identity:function mat2_r(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},invert:function mat2_o(t,n){const r=n[0],a=n[1],u=n[2],o=n[3];let e=r*o-u*a;return e?(e=1/e,t[0]=o*e,t[1]=-a*e,t[2]=-u*e,t[3]=r*e,t):null},mul:mat2_,multiply:mat2_s,multiplyScalar:function mat2_S(t,n,r){return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=n[3]*r,t},multiplyScalarAndAdd:function j(t,n,r,a){return t[0]=n[0]+r[0]*a,t[1]=n[1]+r[1]*a,t[2]=n[2]+r[2]*a,t[3]=n[3]+r[3]*a,t},rotate:function mat2_i(t,n,r){const a=n[0],u=n[1],o=n[2],e=n[3],c=Math.sin(r),s=Math.cos(r);return t[0]=a*s+o*c,t[1]=u*s+e*c,t[2]=a*-c+o*s,t[3]=u*-c+e*s,t},scale:function mat2_f(t,n,r){const a=n[0],u=n[1],o=n[2],e=n[3],c=r[0],s=r[1];return t[0]=a*c,t[1]=u*c,t[2]=o*s,t[3]=e*s,t},set:mat2_a,str:function mat2_h(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},sub:mat2_g,subtract:mat2_p,transpose:function mat2_u(t,n){if(t===n){const r=n[1];t[1]=n[2],t[2]=r}else t[0]=n[0],t[1]=n[2],t[2]=n[1],t[3]=n[3];return t}},Symbol.toStringTag,{value:"Module"}));function mat2f64_e(){return[1,0,0,1]}Object.freeze(Object.defineProperty({__proto__:null,clone:function mat2f64_r(e){return[e[0],e[1],e[2],e[3]]},create:mat2f64_e,createView:function mat2f64_n(e,r){return new Float64Array(e,r,4)},fromValues:function mat2f64_t(e,r,t,n){return[e,r,t,n]}},Symbol.toStringTag,{value:"Module"}));class PathVertex_R{constructor(){this.vLeft=(0,vec3f64.vt)(),this.vRight=(0,vec3f64.vt)(),this.vMinSiblingLength=0,this.frame=new PathExtruder_l}setFrameFromUpVector(t){(0,vec32.c)(this.frame.up,t),(0,vec32.g)(PathVertex_D,this.vLeft,this.vRight),(0,vec32.n)(PathVertex_D,PathVertex_D),(0,vec32.h)(PathVertex_I,this.frame.up,(0,vec32.f)(PathVertex_D,this.frame.up)),(0,vec32.d)(PathVertex_k,PathVertex_D,PathVertex_I),(0,vec32.n)(PathVertex_k,PathVertex_k),(0,vec32.e)(this.frame.right,PathVertex_k,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}}class PathVertex_x extends PathVertex_R{get rotationFrameUp(){return this.frame.up}get rotationRight(){return vec2f64.Cw}get rotationAngle(){return(0,vec32.h)(PathVertex_w,this.frame.up,(0,vec32.f)(this.frame.up,this.vLeft)),(0,vec32.d)(PathVertex_w,this.vLeft,PathVertex_w),(0,vec32.v)(PathVertex_w,PathVertex_w),(0,vec32.n)(PathVertex_w,PathVertex_w),(0,vec32.h)(PathVertex_y,this.frame.up,(0,vec32.f)(this.frame.up,this.vRight)),(0,vec32.d)(PathVertex_y,this.vRight,PathVertex_y),(0,vec32.n)(PathVertex_y,PathVertex_y),(0,vec32.e)(PathVertex_U,this.rotationFrameUp,this.vLeft),Math.sign((0,vec32.f)(PathVertex_U,this.vRight))*(Math.PI-(0,mathUtils.XM)((0,vec32.f)(PathVertex_w,PathVertex_y)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(t,r){const s=this.rotationAngle;if(Math.abs(s)<=0)return r;const a=(0,mathUtils.J_)(Math.cos(.5*s));return(0,vec2.hZ)(t,(a-1+1)*r[0],r[1])}}class PathVertex_L extends PathVertex_R{get rotationFrameUp(){const t=Math.sign((0,vec32.f)(this.frame.right,this.vRight));return(0,vec32.e)(A,this.vRight,this.vLeft),(0,vec32.h)(A,A,t),(0,vec32.n)(A,A)}get rotationRight(){const t=this.rotationFrameUp,i=(0,vec32.f)(t,this.frame.up),r=(0,vec32.f)(t,this.frame.right);return(0,vec32.h)(PathVertex_F,this.frame.up,-r),(0,vec32.h)(PathVertex_P,this.frame.right,i),(0,vec32.g)(PathVertex_F,PathVertex_F,PathVertex_P),(0,vec32.n)(PathVertex_F,PathVertex_F),function PathVertex_j(t,i,r){(0,vec2.hZ)(t,(0,vec32.f)(r,i.right),(0,vec32.f)(r,i.up))}(PathVertex_S,this.frame,PathVertex_F),PathVertex_S}get rotationAngle(){const i=Math.sign((0,vec32.f)(this.frame.right,this.vRight));return(0,vec32.v)(PathVertex_U,this.vLeft),-i*(Math.PI-(0,mathUtils.XM)((0,vec32.f)(PathVertex_U,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*(0,mathUtils.J_)(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(t,s){const e=this.rotationAngle;if(0===Math.abs(e))return s;const h=(0,mathUtils.J_)(Math.cos(.5*e)),o=this.rotationRight,n=mat2_a(PathVertex_E,1+(h-1)*o[0]*o[0],(h-1)*o[0]*o[1],(h-1)*o[0]*o[1],1+(h-1)*o[1]*o[1]);return(0,vec2.ZF)(t,s,n)}}function PathVertex_d(t){switch(t){case PathGeometry_o.World:return new PathVertex_x;case PathGeometry_o.Path:return new PathVertex_L}}const A=(0,vec3f64.vt)(),PathVertex_S=(0,vec2f64.vt)(),PathVertex_F=(0,vec3f64.vt)(),PathVertex_P=(0,vec3f64.vt)(),PathVertex_U=(0,vec3f64.vt)(),PathVertex_w=(0,vec3f64.vt)(),PathVertex_y=(0,vec3f64.vt)(),PathVertex_I=(0,vec3f64.vt)(),PathVertex_D=(0,vec3f64.vt)(),PathVertex_k=(0,vec3f64.vt)(),PathVertex_E=[1,0,0,1];var Emissions_glsl=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/output/Emissions.glsl.js"),Normals_glsl=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl.js"),PhysicallyBasedRenderingParameters_glsl=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl.js"),PathVertexPosition_glsl=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl.js"),OITPass=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/OITPass.js"),Path_glsl=__webpack_require__("./node_modules/@arcgis/core/chunks/Path.glsl.js");class PathTechnique_N extends PathVertexPosition_glsl.W{constructor(){super(...arguments),this.ambient=(0,vec3f64.CN)(.2,.2,.2),this.diffuse=(0,vec3f64.CN)(.8,.8,.8),this.specular=(0,vec3f64.CN)(0,0,0),this.opacity=1,this.origin=(0,vec3f64.vt)(),this.modelTransformation=null,this.mrrFactors=pbrUtils.mb,this.emissiveFactor=vec3f64.uY,this.texture=null,this.textureNormal=null,this.textureEmissive=null,this.textureOcclusion=null,this.textureMetallicRoughness=null}}class PathTechnique_R extends ShaderTechnique.w{constructor(e,r){super(e,r,new ReloadableShaderModule.$(Path_glsl.P,(()=>__webpack_require__.e(7610).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/views/3d/webgl-engine/shaders/Path.glsl.js")))),PathTechnique_L)}initializePipeline(e){const{output:r,transparent:t,hasSlicePlane:l,doubleSidedMode:n,hasOccludees:a,oitPass:b}=e,O=b===OITPass.Y.NONE,j=b===OITPass.Y.FrontFace;return(0,renderState.Ey)({blending:(0,ShaderOutput.RN)(r)&&t?(0,OrderIndependentTransparency.Yf)(b):null,culling:l&&!t&&n!==Normals_glsl.W.None?renderState.hG:null,depthTest:{func:(0,OrderIndependentTransparency.K_)(b)},depthWrite:O||j?renderState.Uy:null,drawBuffers:r===ShaderOutput.V.Depth?{buffers:[enums.Hr.NONE]}:(0,OrderIndependentTransparency.m6)(b,r),colorWrite:renderState.kn,stencilWrite:a?StencilUtils.v0:null,stencilTest:a?StencilUtils.qh:null,polygonOffset:O||j?null:OrderIndependentTransparency.SE})}}const PathTechnique_L=new Map([[VertexAttribute.r.POSITION,0],[VertexAttribute.r.PROFILERIGHT,1],[VertexAttribute.r.PROFILEUP,2],[VertexAttribute.r.PROFILEVERTEXANDNORMAL,3],[VertexAttribute.r.FEATUREVALUE,4],[VertexAttribute.r.OBJECTANDLAYERIDCOLOR,5]]);var TextureCoordinateAttribute_glsl=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl.js");class PathTechniqueConfiguration_n extends DefaultTechniqueConfiguration.E{constructor(e,s){super(),this.spherical=e,this.doublePrecisionRequiresObfuscation=s,this.pbrMode=PhysicallyBasedRenderingParameters_glsl.A9.Disabled,this.doubleSidedMode=Normals_glsl.W.None,this.emissionSource=Emissions_glsl.ZX.None,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.transparent=!1,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.textureCoordinateType=TextureCoordinateAttribute_glsl.I.None,this.occlusionPass=!1,this.hasVvInstancing=!0,this.useCustomDTRExponentForWater=!1,this.useFillLights=!1,this.hasColorTexture=!1,this.objectAndLayerIdColorInstanced=!1,this.hasMetallicRoughnessTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1}get discardInvisibleFragments(){return this.transparent}}(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)({count:PhysicallyBasedRenderingParameters_glsl.A9.COUNT})],PathTechniqueConfiguration_n.prototype,"pbrMode",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)({count:Normals_glsl.W.COUNT})],PathTechniqueConfiguration_n.prototype,"doubleSidedMode",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)({count:Emissions_glsl.ZX.COUNT})],PathTechniqueConfiguration_n.prototype,"emissionSource",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],PathTechniqueConfiguration_n.prototype,"receiveShadows",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],PathTechniqueConfiguration_n.prototype,"receiveAmbientOcclusion",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],PathTechniqueConfiguration_n.prototype,"vvSize",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],PathTechniqueConfiguration_n.prototype,"vvColor",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],PathTechniqueConfiguration_n.prototype,"vvOpacity",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],PathTechniqueConfiguration_n.prototype,"transparent",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],PathTechniqueConfiguration_n.prototype,"hasOccludees",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],PathTechniqueConfiguration_n.prototype,"terrainDepthTest",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],PathTechniqueConfiguration_n.prototype,"cullAboveTerrain",void 0);class PathMaterial_y extends Material.im{constructor(e,t){super(e,PathMaterial_E),this._vertexBufferLayout=function PathMaterial_L(){const e=(0,InterleavedLayout.BP)().vec3f(VertexAttribute.r.POSITION).vec4f(VertexAttribute.r.PROFILERIGHT).vec4f(VertexAttribute.r.PROFILEUP).vec4f(VertexAttribute.r.PROFILEVERTEXANDNORMAL).vec4f(VertexAttribute.r.FEATUREVALUE);return(0,olidUtils.E)()&&e.vec4u8(VertexAttribute.r.OBJECTANDLAYERIDCOLOR),e}(),this.vertexAttributeLocations=PathTechnique_L,this.supportsEdges=!0,this.produces=new Map([[RenderSlot.N.OPAQUE_MATERIAL,e=>(this.parameters.castShadows&&(0,ShaderOutput.PJ)(e)||(0,ShaderOutput.iq)(e))&&!this.parameters.transparent],[RenderSlot.N.TRANSPARENT_MATERIAL,e=>(this.parameters.castShadows&&(0,ShaderOutput.PJ)(e)||(0,ShaderOutput.iq)(e))&&this.parameters.transparent]]),this._configuration=new PathTechniqueConfiguration_n(t.spherical,t.doublePrecisionRequiresObfuscation)}get hasEmissions(){return!(0,vec32.p)(this.parameters.emissiveFactor,vec3f64.uY)}getConfiguration(e,t){return this._configuration.output=e,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=t.hasOccludees,(0,ShaderOutput.RN)(e)?(this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?Normals_glsl.W.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?Normals_glsl.W.WindingOrder:Normals_glsl.W.None,this._configuration.receiveShadows=t.shadowMap.enabled,this._configuration.receiveAmbientOcclusion=null!=t.ssao):this._configuration.receiveShadows=this._configuration.receiveAmbientOcclusion=!1,this._configuration.pbrMode=this.parameters.usePBR?PhysicallyBasedRenderingParameters_glsl.A9.Schematic:PhysicallyBasedRenderingParameters_glsl.A9.Disabled,this._configuration.emissionSource=this.parameters.usePBR?Emissions_glsl.ZX.Value:Emissions_glsl.ZX.None,this._configuration.oitPass=t.oitPass,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration}isVisibleForOutput(e){return e!==ShaderOutput.V.Shadow&&e!==ShaderOutput.V.ShadowExcludeHighlight&&e!==ShaderOutput.V.ShadowHighlight||this.parameters.castShadows}get visible(){return this.parameters.opacity>=AlphaCutoff.Q}intersect(t,i,s,a,o,n){const c=t;if(!PathGeometry_n(c))return;const h=c.path,u=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const{offset:t,factor:i,minSize:r,maxSize:s}=this.parameters.vvSize,a=h.sizeAttributeValue;u[0]*=(0,mathUtils.qE)(t[0]+a*i[0],r[0],s[0]),u[1]*=(0,mathUtils.qE)(t[2]+a*i[2],r[2],s[2])}const m=new RayIntersections.JG(!1,s.options.normalRequired),p=Math.max(u[0],u[1]),f=t.boundingInfo;if(null==f)return void PathMaterial_w(h,u,a,o,m,n);const l=(0,aaBoundingBox.fA)(f.bbMin[0]-p,f.bbMin[1]-p,f.bbMin[2]-p,f.bbMax[0]+p,f.bbMax[1]+p,f.bbMax[2]+p),v=[o[0]-a[0],o[1]-a[1],o[2]-a[2]],S=Math.sqrt(v[0]*v[0]+v[1]*v[1]+v[2]*v[2]),_=[S/v[0],S/v[1],S/v[2]];(0,RayIntersections.Wb)(l,a,_,s.tolerance)&&PathMaterial_w(h,u,a,o,m,n)}createBufferWriter(){return new DefaultBufferWriter.Z(this._vertexBufferLayout)}createGLMaterial(e){return new PathMaterial_T(e)}}class PathMaterial_T extends GLMaterial.A{beginSlot(e){return this.getTechnique(PathTechnique_R,e)}}function PathMaterial_w(e,t,i,r,s,a){e.baked.size&&e.baked.size[0]===t[0]&&e.baked.size[1]===t[1]||e.baked.bake(t),e.baked.intersect(i,r,s,a)}class PathMaterial_E extends PathTechnique_N{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.usePBR=!1}}const ie=["polyline"];class Graphics3DPathSymbolLayer_re extends Graphics3DSymbolLayer.U{get usedMemory(){return this._usedMemory+super.usedMemory}constructor(e,t,i,r){super(e,t,i,r),this._intrinsicSize=(0,vec2f64.fA)(1,1),this._upVectorAlignment=PathGeometry_o.Path,this._stencilWidth=.1,this._usedMemory=0,this.ensureDrapedStatus(!1)}async doLoad(){const t=null!=this.symbolLayer.width?this.symbolLayer.width:this.symbolLayer.height,i=null!=this.symbolLayer.height?this.symbolLayer.height:t;this._vvConvertOptions=new FastSymbolUpdates.wI({size:!0,color:!0,rotation:!1,opacity:!0},[1,1,1],[t,1,i],this._context.renderCoordsHelper.unitInMeters);const r=this._context.renderer?.visualVariables;this._fastUpdates=r?.length?(0,FastSymbolUpdates.s_)(this._context.renderer,this._vvConvertOptions):null;const o=this.symbolLayer.anchor||"center";this._upVectorAlignment="heading"===this.symbolLayer.profileRotation?PathGeometry_o.World:PathGeometry_o.Path;const h=this.symbolLayer.profile||"circle";switch(h){default:case"circle":this._profile=PathProfile_d[o];break;case"quad":this._profile=PathProfile_a[o]}switch(this.symbolLayer.join){case"round":this._extruder=new PathExtruder_a(0,Graphics3DPathSymbolLayerConstants.kf);break;case"bevel":this._extruder=new PathExtruder_a(0,1);break;case"miter":this._extruder=new PathExtruder_a(.8*Math.PI,1);break;default:this._extruder=new PathExtruder_c}const d=this.symbolLayer.cap||"butt";switch(d){case"none":this._startCap=new PathCapBuilder_l,this._endCap=new PathCapBuilder_l;break;case"butt":default:this._startCap=new PathCapBuilder_f(this._profile,0),this._endCap=new PathCapBuilder_f(this._profile,0,!0);break;case"square":this._startCap=new PathCapBuilder_f(this._profile,-.5),this._endCap=new PathCapBuilder_f(this._profile,.5,!0);break;case"round":{const e="quad"===h;this._startCap=new PathCapBuilder_h({profile:this._profile,flip:!1,breakNormals:e,subdivisions:Graphics3DPathSymbolLayerConstants.RL}),this._endCap=new PathCapBuilder_h({profile:this._profile,flip:!0,breakNormals:e,subdivisions:Graphics3DPathSymbolLayerConstants.RL});break}}const f=this.symbolLayer?.material?.emissiveFactor,u=f?(0,vec32.F)((0,vec3f64.o8)(f)):vec3f64.uY,y=this.symbolLayer?.material?.color,b=this._getCombinedOpacityAndColor(y),g=(0,vec3f64.ci)(b),_=b[3],v=_<1||this.needsDrivenTransparentPass,x={diffuse:g,ambient:g,emissiveFactor:u,opacity:_,transparent:v,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:v||"none"===d?basicInterfaces.s2.None:basicInterfaces.s2.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&((0,vec2.hZ)(this._intrinsicSize,t,i),!(0,graphicUtils.Mh)(this._intrinsicSize[0])||!(0,graphicUtils.Mh)(this._intrinsicSize[1])))throw new core_Error.A("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates?.visualVariables.size||(0,vec2.hs)(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates){const e={...x,...this._fastUpdates.materialParameters,size:(0,vec2f64.ci)(this._intrinsicSize)};this._materials[0]=new PathMaterial_y(e,this._context)}else x.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,x.normalType=NormalAttribute_glsl.W.Compressed,this._materials[0]=new DefaultMaterial.$U(x,this._context);this._materials[0].setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,ie,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(t),r=e.renderingInfo;return this._createAs3DShape(t,r,i,t.uid)}layerOpacityChanged(){const e=this.symbolLayer?.material?.color,t=this._getCombinedOpacity(e),i=t<1||this.needsDrivenTransparentPass;this._materials[0]?.setParameters({opacity:t,transparent:i})}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,elevationAlignmentUtils.Kf)}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._materials[0]?.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}applyRendererDiff(e,t){for(const i in e.diff){if("visualVariables"!==i)return interfaces.w.RecreateSymbol;if(!(0,FastSymbolUpdates.J_)(this._fastUpdates,t,this._vvConvertOptions))return interfaces.w.RecreateSymbol;this._materials[0]?.setParameters(this._fastUpdates.materialParameters)}return interfaces.w.FastUpdate}_getVertexData(e){let t=0;const i=e.paths,r=[],s=e.spatialReference,a=this._context.elevationProvider.spatialReference,o=this._context.renderCoordsHelper.spatialReference;for(const c of i)t+=c.length;const n=(0,DoubleArray.jh)(3*t);let l,h=0;for(const c of i){r.push({offset:h,numVertices:c.length});for(const t of c)n[h++]=t[0],n[h++]=t[1],n[h++]=e.hasZ?t[2]:0}return null==a||s.equals(a)||(0,projectBuffer.projectBuffer)(n,s,0,n,a,0,t)?(null==a||a.equals(o)?l=(0,DoubleArray.xm)(n):(l=(0,DoubleArray.jh)(3*t),(0,projectBuffer.projectBuffer)(n,a,0,l,o,0,t)),{pathVertexDataInfos:r,vertexDataES:n,vertexDataRS:l}):null}_createAs3DShape(e,s,a,o){this._usedMemory=0;const n=e.geometry,l=this._getVertexData(n);if(null==l)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(0===l.pathVertexDataInfos.length)return 0!==n.paths.length&&n.paths.some((e=>e.length>0))||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;const c=new Array,m=n.spatialReference,p=(0,aaBoundingBox.vt)(),d=this._context.renderCoordsHelper,f=new ElevationProvider.aY(l.vertexDataES);for(const u of l.pathVertexDataInfos){const n=u.numVertices;if(n<2)continue;const g=u.offset;if(null!=this._context.clippingExtent&&((0,aaBoundingBox.Rz)(l.vertexDataES,g,n,p),!(0,aaBoundingBox.KG)(p,this._context.clippingExtent)))continue;const _=new Array,v=g+3*n;for(let e=g;e<v;e+=3){f.offset=e;const t=(0,elevationAlignmentUtils.nG)(f,this._context.elevationProvider,a,d);(0,vec32.i)(Graphics3DPathSymbolLayer_le,l.vertexDataRS[e],l.vertexDataRS[e+1],l.vertexDataRS[e+2]),d.setAltitude(Graphics3DPathSymbolLayer_le,t),l.vertexDataRS[e]=Graphics3DPathSymbolLayer_le[0],l.vertexDataRS[e+1]=Graphics3DPathSymbolLayer_le[1],l.vertexDataRS[e+2]=Graphics3DPathSymbolLayer_le[2],_.push(PathVertex_d(this._upVectorAlignment))}const w=new Path_n(_,l.vertexDataES,l.vertexDataRS,g);Graphics3DPathSymbolLayer_se(w,this._upVectorAlignment,this._context.renderCoordsHelper);const P=new PathBuilder_o(w,this._profile,this._extruder,this._startCap,this._endCap);let j=null;if(this._fastUpdates){const t=this._fastUpdates.visualVariables,i=(0,FastSymbolUpdates.ul)(t.size?.field,e)??0,r=(0,FastSymbolUpdates.ul)(t.color?.field,e)??0,s=(0,FastSymbolUpdates.ul)(t.opacity?.field,e)??0;j=new PathGeometryData_g(P,i,r,s)}else{const e=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const t=s.size;e[0]*=Graphics3DPathSymbolLayer_ae(t[0],"symbol-value"===t[2]?this.symbolLayer.height||0:t[2],this.symbolLayer.width||0),e[1]*=Graphics3DPathSymbolLayer_ae(t[2],"symbol-value"===t[0]?this.symbolLayer.width||0:t[0],this.symbolLayer.height||0)}let t;this._drivenProperties.color&&(t=s.color),this._drivenProperties.opacity&&null!=s.opacity&&(t=t?[t[0],t[1],t[2],s.opacity]:[1,1,1,s.opacity]);const i=new PathGeometryData_f(P);i.bake(e),t&&i.bakeVertexColors(t),j=i}const S=j.createGeometryData(),D=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:o,layerUid:this._context.layer.uid}),C=new PathGeometry_e(this._materials[0],S,j,m,this._stencilWidth,D);C.transformation=(0,mat4.Tl)((0,mat4f64.vt)(),mat4f64.zK,P.path.origin),c.push(C),this._usedMemory+=P.usedMemory}if(0===c.length)return null;const g=new Object3D.B({geometries:c,layerUid:this._context.layer.uid,graphicUid:o}),_=new Graphics3DObject3DGraphicLayer.Y(this,g,c,null,null,((e,t,i,r,s)=>function Graphics3DPathSymbolLayer_ne(e,t,i,r,s){const a=e.stageObject,o=a.geometries;let n=0;for(const l of o){if(!PathGeometry_n(l))continue;const e=l.path,o=e.builder.path;n+=Graphics3DPathSymbolLayer_oe(o,t,i,r),s!==PathGeometry_o.World&&Graphics3DPathSymbolLayer_se(o,s,r),e.onPathChanged(l),l.invalidateBoundingInfo(),a.geometryVertexAttributeUpdated(l,VertexAttribute.r.POSITION)}return n/o.length}(e,t,r,s,this._upVectorAlignment)),a);return _.alignedSampledElevation=0,_.needsElevationUpdates=(0,elevationAlignmentUtils.Kf)(a.mode),_}}function Graphics3DPathSymbolLayer_se(e,t,i){const{origin:r,positions:s}=e;let a=e.offset;switch(t){default:case PathGeometry_o.World:for(const t of e.vertices)Graphics3DPathSymbolLayer_le[0]=s[a++]+r[0],Graphics3DPathSymbolLayer_le[1]=s[a++]+r[1],Graphics3DPathSymbolLayer_le[2]=s[a++]+r[2],i.worldUpAtPosition(Graphics3DPathSymbolLayer_le,Graphics3DPathSymbolLayer_le),t.setFrameFromUpVector(Graphics3DPathSymbolLayer_le);break;case PathGeometry_o.Path:Graphics3DPathSymbolLayer_le[0]=s[a]+r[0],Graphics3DPathSymbolLayer_le[1]=s[a+1]+r[1],Graphics3DPathSymbolLayer_le[2]=s[a+2]+r[2],i.worldUpAtPosition(Graphics3DPathSymbolLayer_le,Graphics3DPathSymbolLayer_le),function pathGeometryUtils_l(l,v){let h=null;const u=l.vertices.length,j=.99619469809,R=(0,vec3f64.vt)(),y=(0,vec3f64.vt)(),x=(0,vec3f64.vt)(),L=(0,vec3f64.vt)(),b=(0,vec3f64.vt)(),k=(0,vec3f64.vt)(),q=(0,plane.vt)();let G=l.vertices[0];(0,vec32.c)(y,v),(0,vec32.i)(R,0,1,0),(0,GeometryUtil.Xl)(G.vRight,y,R,R,x,y,j),(0,vec32.c)(G.frame.up,y),(0,vec32.c)(G.frame.right,x);const M=l.positions;let U=l.offset;h=G;for(let m=1;m<u;++m){G=l.vertices[m],(0,vec32.g)(b,G.vLeft,G.vRight);let a=(0,vec32.l)(b);a>0?(a=1/Math.sqrt(a),b[0]=b[0]*a,b[1]=b[1]*a,b[2]=b[2]*a):(b[0]=G.vRight[0],b[1]=G.vRight[1],b[2]=G.vRight[2]),k[0]=M[U]+h.frame.up[0],k[1]=M[U+1]+h.frame.up[1],k[2]=M[U+2]+h.frame.up[2],U+=3;const v=(0,vec32.i)(pathGeometryUtils_n,M[U],M[U+1],M[U+2]);(0,plane.O_)(v,b,q),(0,plane.Ui)(q,(0,ray.LV)(k,G.vLeft),L)?(L[0]-=M[U],L[1]-=M[U+1],L[2]-=M[U+2],(0,vec32.n)(y,L),(0,vec32.e)(x,b,y),(0,vec32.n)(x,x)):(0,GeometryUtil.Xl)(b,h.frame.up,h.frame.right,R,x,y,j),(0,vec32.c)(G.frame.up,y),(0,vec32.c)(G.frame.right,x),h=G}}(e,Graphics3DPathSymbolLayer_le)}}function Graphics3DPathSymbolLayer_ae(e,t,i){switch(e){case"symbol-value":return i;case"proportional":return t;default:return e}}function Graphics3DPathSymbolLayer_oe(e,t,i,r){let s=0;const{origin:a,vertices:o,positions:n,positionsES:l}=e,c=e.offset+3*o.length;for(let m=e.offset;m<c;m+=3)(0,vec32.i)(Graphics3DPathSymbolLayer_le,l[m],l[m+1],l[m+2]),i(Graphics3DPathSymbolLayer_le,Graphics3DPathSymbolLayer_he),s+=Graphics3DPathSymbolLayer_he.sampledElevation,Graphics3DPathSymbolLayer_le[0]=n[m]+a[0],Graphics3DPathSymbolLayer_le[1]=n[m+1]+a[1],Graphics3DPathSymbolLayer_le[2]=n[m+2]+a[2],r.setAltitude(Graphics3DPathSymbolLayer_le,Graphics3DPathSymbolLayer_he.z),n[m]=Graphics3DPathSymbolLayer_le[0]-a[0],n[m+1]=Graphics3DPathSymbolLayer_le[1]-a[1],n[m+2]=Graphics3DPathSymbolLayer_le[2]-a[2];return e.updatePathVertexInformation(),s/o.length}const Graphics3DPathSymbolLayer_le=(0,vec3f64.vt)(),Graphics3DPathSymbolLayer_he=new elevationAlignmentUtils.Uk;var ellipsoidUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/ellipsoidUtils.js"),projectors=__webpack_require__("./node_modules/@arcgis/core/geometry/projection/projectors.js");function uvUtils_M(t,r,n,c,l=1){(0,vec32.i)(uvUtils_F,1,0,0),(0,vec32.i)(uvUtils_Y,0,1,0),(0,vec32.i)(uvUtils_,0,0,1),function uvUtils_D(t,o){(0,vec32.i)(uvUtils_U,0,0,0);for(let r=0;r<o.length-3;r+=3)uvUtils_U[0]+=o[r],uvUtils_U[1]+=o[r+1],uvUtils_U[2]+=o[r+2];(0,vec32.h)(t,uvUtils_U,1/(o.length/3-1))}(uvUtils_x,n),(0,plane.ci)(uvUtils_V,n)&&function uvUtils_O(t,o,r,i,m,I){null!=m?(m.basisMatrixAtPosition(I,uvUtils_S),(0,vec32.i)(uvUtils_d,uvUtils_S[0],uvUtils_S[1],uvUtils_S[2]),(0,vec32.i)(uvUtils_k,uvUtils_S[4],uvUtils_S[5],uvUtils_S[6]),(0,vec32.i)(uvUtils_w,uvUtils_S[8],uvUtils_S[9],uvUtils_S[10])):((0,vec32.i)(uvUtils_d,1,0,0),(0,vec32.i)(uvUtils_k,0,1,0),(0,vec32.i)(uvUtils_w,0,0,1));const h=(0,plane.Qj)(t);(0,vec32.f)(h,uvUtils_w)<0&&(0,vec32.h)(h,h,-1),(0,vec32.c)(i,h);const p=(0,vec32.f)(h,uvUtils_k),N=(0,vec32.f)(h,uvUtils_d);Math.abs(p)>Math.abs(N)?((0,vec32.b)(o,uvUtils_d,h,-N),(0,vec32.n)(o,o),(0,vec32.e)(r,o,h),(0,vec32.n)(r,r),(0,vec32.h)(r,r,-1)):((0,vec32.b)(r,uvUtils_k,h,-p),(0,vec32.n)(r,r),(0,vec32.e)(o,r,h),(0,vec32.n)(o,o))}(uvUtils_V,uvUtils_F,uvUtils_Y,uvUtils_,c,uvUtils_x),(0,vec2.hZ)(uvUtils_y,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),(0,vec2.hZ)(uvUtils_P,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let o=0;o<n.length;o+=3){(0,vec32.i)(uvUtils_E,n[o],n[o+1],n[o+2]);const t=(0,vec32.f)(uvUtils_F,uvUtils_E),r=(0,vec32.f)(uvUtils_Y,uvUtils_E);uvUtils_y[0]=Math.min(uvUtils_y[0],t),uvUtils_y[1]=Math.min(uvUtils_y[1],r),uvUtils_P[0]=Math.max(uvUtils_P[0],t),uvUtils_P[1]=Math.max(uvUtils_P[1],r)}const f=(0,vec32.f)(uvUtils_,uvUtils_x);uvUtils_q(uvUtils_v,uvUtils_y[0],uvUtils_y[1],f,uvUtils_F,uvUtils_Y,uvUtils_),uvUtils_q(uvUtils_A,uvUtils_P[0],uvUtils_y[1],f,uvUtils_F,uvUtils_Y,uvUtils_),uvUtils_q(uvUtils_G,uvUtils_y[0],uvUtils_P[1],f,uvUtils_F,uvUtils_Y,uvUtils_),(0,vec32.d)(uvUtils_A,uvUtils_A,uvUtils_v),(0,vec32.h)(uvUtils_A,uvUtils_A,.5),(0,vec32.d)(uvUtils_G,uvUtils_G,uvUtils_v),(0,vec32.h)(uvUtils_G,uvUtils_G,.5),(0,vec32.g)(uvUtils_v,uvUtils_v,uvUtils_A),(0,vec32.g)(uvUtils_v,uvUtils_v,uvUtils_G);const I=uvUtils_y[0]%l,h=uvUtils_y[1]%l,p=uvUtils_y[0]-I,N=uvUtils_y[1]-h;for(let o=0;o<n.length;o+=3){(0,vec32.i)(uvUtils_E,n[o],n[o+1],n[o+2]);const i=o/3,a=4*i;t[a]=((0,vec32.f)(uvUtils_F,uvUtils_E)-p)/l,t[a+1]=((0,vec32.f)(uvUtils_Y,uvUtils_E)-N)/l,t[a+2]=p/l,t[a+3]=N/l;const m=9*i;for(let t=0;t<3;t++)r[m+t]=uvUtils_v[t],r[m+t+3]=uvUtils_A[t],r[m+t+6]=uvUtils_G[t]}}const uvUtils_x=(0,vec3f64.vt)(),uvUtils_E=(0,vec3f64.vt)(),uvUtils_V=(0,plane.vt)(),uvUtils_F=(0,vec3f64.vt)(),uvUtils_Y=(0,vec3f64.vt)(),uvUtils_=(0,vec3f64.vt)(),uvUtils_y=(0,vec2f64.vt)(),uvUtils_P=(0,vec2f64.vt)(),uvUtils_v=(0,vec3f64.vt)(),uvUtils_A=(0,vec3f64.vt)(),uvUtils_G=(0,vec3f64.vt)();const uvUtils_S=(0,mat4f64.vt)(),uvUtils_d=(0,vec3f64.vt)(),uvUtils_k=(0,vec3f64.vt)(),uvUtils_w=(0,vec3f64.vt)();const uvUtils_U=(0,vec3f64.vt)();function uvUtils_q(t,o,r,s,i,a,m){(0,vec32.i)(t,o*i[0]+r*a[0]+s*m[0],o*i[1]+r*a[1]+s*m[1],o*i[2]+r*a[2]+s*m[2])}var ColorMaterial=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/materials/ColorMaterial.js"),BufferView=__webpack_require__("./node_modules/@arcgis/core/geometry/support/buffer/BufferView.js"),PatternStyle=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/materials/PatternStyle.js"),TriangleMaterial=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/materials/TriangleMaterial.js"),bufferWriterUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/materials/internal/bufferWriterUtils.js"),Pattern_glsl=__webpack_require__("./node_modules/@arcgis/core/chunks/Pattern.glsl.js");class PatternTechnique_S extends ShaderTechnique.w{constructor(e,t){super(e,t,new ReloadableShaderModule.$(Pattern_glsl.P,(()=>__webpack_require__.e(713).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/views/3d/webgl-engine/shaders/Pattern.glsl.js")))),(0,olidUtils.E)()?PatternTechnique_j:PatternTechnique_b)}_setPipelineState(r,i){const{oitPass:s,output:m,cullFace:d,draped:S,hasOccludees:b,polygonOffset:j,enableOffset:g}=r,A=s===OITPass.Y.NONE,I=s===OITPass.Y.FrontFace;return(0,renderState.Ey)({blending:(0,ShaderOutput.RN)(m)?(0,OrderIndependentTransparency.Yf)(s):null,culling:(0,renderState.Xt)(d),depthTest:S?null:{func:(0,OrderIndependentTransparency.K_)(s)},depthWrite:(0,OrderIndependentTransparency.z5)(r),drawBuffers:m===ShaderOutput.V.Depth?{buffers:[enums.Hr.NONE]}:(0,OrderIndependentTransparency.m6)(s,m),colorWrite:renderState.kn,stencilWrite:b?StencilUtils.v0:null,stencilTest:b?i?StencilUtils.a9:StencilUtils.qh:null,polygonOffset:A||I?j?PatternTechnique_R:null:(0,OrderIndependentTransparency.aB)(g)})}initializePipeline(e){return this._occludeePipelineState=this._setPipelineState(e,!0),this._setPipelineState(e,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}const PatternTechnique_R={factor:1,units:1},PatternTechnique_b=new Map([[VertexAttribute.r.POSITION,0],[VertexAttribute.r.COLOR,3],[VertexAttribute.r.UVMAPSPACE,4],[VertexAttribute.r.COLORFEATUREATTRIBUTE,5],[VertexAttribute.r.BOUNDINGRECT,6]]),PatternTechnique_j=new Map([[VertexAttribute.r.POSITION,0],[VertexAttribute.r.COLOR,3],[VertexAttribute.r.UVMAPSPACE,4],[VertexAttribute.r.COLORFEATUREATTRIBUTE,5],[VertexAttribute.r.BOUNDINGRECT,6],[VertexAttribute.r.OBJECTANDLAYERIDCOLOR,9]]);class PatternTechniqueConfiguration_n extends DefaultTechniqueConfiguration.E{constructor(){super(...arguments),this.cullFace=basicInterfaces.s2.None,this.style=PatternStyle.O.Horizontal,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasOccludees=!1,this.enableOffset=!0,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.vvColor=!1,this.draped=!1,this.textureCoordinateType=TextureCoordinateAttribute_glsl.I.None,this.emissionSource=Emissions_glsl.ZX.None,this.discardInvisibleFragments=!0,this.writeDepth=!0,this.occlusionPass=!1,this.hasVvInstancing=!1,this.vvSize=!1,this.vvOpacity=!1,this.objectAndLayerIdColorInstanced=!1}}(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)({count:basicInterfaces.s2.COUNT})],PatternTechniqueConfiguration_n.prototype,"cullFace",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)({count:PatternStyle.O.COUNT})],PatternTechniqueConfiguration_n.prototype,"style",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],PatternTechniqueConfiguration_n.prototype,"hasVertexColors",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],PatternTechniqueConfiguration_n.prototype,"polygonOffset",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],PatternTechniqueConfiguration_n.prototype,"hasOccludees",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],PatternTechniqueConfiguration_n.prototype,"enableOffset",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],PatternTechniqueConfiguration_n.prototype,"terrainDepthTest",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],PatternTechniqueConfiguration_n.prototype,"cullAboveTerrain",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],PatternTechniqueConfiguration_n.prototype,"vvColor",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],PatternTechniqueConfiguration_n.prototype,"draped",void 0);class PatternMaterial_P extends TriangleMaterial.W{constructor(e){super(e,PatternMaterial_I),this._configuration=new PatternTechniqueConfiguration_n,this.vertexAttributeLocations=(0,olidUtils.E)()?PatternTechnique_j:PatternTechnique_b,this.supportsEdges=!0,this.produces=new Map([[RenderSlot.N.OPAQUE_MATERIAL,e=>(0,ShaderOutput.CL)(e)],[RenderSlot.N.TRANSPARENT_MATERIAL,e=>(0,ShaderOutput.RN)(e)],[RenderSlot.N.TRANSPARENT_MATERIAL_WITHOUT_NORMALS,e=>(0,ShaderOutput.eh)(e)],[RenderSlot.N.DRAPED_MATERIAL,e=>this.parameters.draped&&(0,ShaderOutput.Mb)(e)]])}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.style=this.parameters.style,this._configuration.draped=this.parameters.draped,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<OrderIndependentTransparency.xt,this._configuration.terrainDepthTest=t.terrainDepthTest&&(0,ShaderOutput.RN)(e),this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}get visible(){return this.parameters.color[3]>=AlphaCutoff.Q}createGLMaterial(e){return new PatternMaterial_R(e)}createBufferWriter(){const e=(0,InterleavedLayout.BP)().vec3f(VertexAttribute.r.POSITION).vec4f(VertexAttribute.r.UVMAPSPACE);return this.parameters.draped||e.mat3f(VertexAttribute.r.BOUNDINGRECT),this.parameters.vvColor?e.f32(VertexAttribute.r.COLORFEATUREATTRIBUTE):e.vec4u8(VertexAttribute.r.COLOR),(0,olidUtils.E)()&&e.vec4u8(VertexAttribute.r.OBJECTANDLAYERIDCOLOR),new PatternMaterial_y(e)}}class PatternMaterial_R extends GLMaterial.A{beginSlot(e){return this.getTechnique(PatternTechnique_S,e)}}class PatternMaterial_y extends DefaultBufferWriter.Z{write(e,s,i,o,a,n){(0,bufferWriterUtils.SA)(i,o,this.vertexBufferLayout,e,s,a,n);for(const f of this.vertexBufferLayout.fields.keys()){const s=i.get(f),o=s?.indices;if(s&&o)switch(f){case VertexAttribute.r.UVMAPSPACE:{(0,Util.vA)(4===s.size);const e=a.getField(f,BufferView.Eq);e&&(0,bufferWriterUtils.Ut)(s,e,n);break}case VertexAttribute.r.BOUNDINGRECT:{(0,Util.vA)(9===s.size);const r=a.getField(f,BufferView.jZ);r&&PatternMaterial_L(s,e,r,n);break}}}}}function PatternMaterial_L(e,t,r,s){const{data:i,indices:o}=e,a=t,n=r.typedBuffer,f=r.typedBufferStride,c=o.length;s*=f;for(let l=0;l<c;++l){const e=9*o[l],t=i[e],r=i[e+1],c=i[e+2];n[s]=a[0]*t+a[4]*r+a[8]*c+a[12],n[s+1]=a[1]*t+a[5]*r+a[9]*c+a[13],n[s+2]=a[2]*t+a[6]*r+a[10]*c+a[14];for(let o=3;o<9;++o)n[s+o]=i[e+o];s+=f}}class PatternMaterial_I extends VisualVariablePassParameters.S{constructor(){super(...arguments),this.color=(0,vec4f64.fA)(1,1,1,1),this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=basicInterfaces.s2.None,this.hasOccludees=!1,this.style=PatternStyle.O.Cross,this.draped=!0}}function patternUtils_s(e,r){const a=e?.pattern;return null==a?new ColorMaterial.v(r):"none"===a.style||"solid"===a.style?("none"===a.style&&(r.color=(0,vec4f64.fA)(0,0,0,0),r.forceTransparentMode=!0),new ColorMaterial.v(r)):(r.style=function patternUtils_l(t){switch(t){case"horizontal":return PatternStyle.O.Horizontal;case"vertical":return PatternStyle.O.Vertical;case"cross":return PatternStyle.O.Cross;case"forward-diagonal":return PatternStyle.O.ForwardDiagonal;case"backward-diagonal":return PatternStyle.O.BackwardDiagonal;case"diagonal-cross":return PatternStyle.O.DiagonalCross;default:return}}(a.style),new PatternMaterial_P(r))}function patternUtils_u(t,e){if(function patternUtils_c(t){return t.material instanceof PatternMaterial_P&&!t.material.parameters.draped}(t)){const o=t.attributes.get(VertexAttribute.r.POSITION).data;uvUtils_M(t.getMutableAttribute(VertexAttribute.r.UVMAPSPACE).data,t.getMutableAttribute(VertexAttribute.r.BOUNDINGRECT).data,o,e)}}function patternUtils_m(t,r,a,o,n){const i=(0,ElevationAligners.B6)(t,r,a,o,n),s=t.stageObject.geometries;for(const e of s)patternUtils_u(e,n);return i}const Graphics3DPolygonFillSymbolLayer_z=["polyline","polygon","extent"],Graphics3DPolygonFillSymbolLayer_H=new FastSymbolUpdates.wI({size:!1,color:!0,rotation:!1,opacity:!1});class Graphics3DPolygonFillSymbolLayer_N extends Graphics3DSymbolLayer.U{constructor(e,t,i,r){super(e,t,i,r),this._needsUV=!1}async doLoad(){this._fastUpdates=(0,FastSymbolUpdates.s_)(this._context.renderer,Graphics3DPolygonFillSymbolLayer_H)}_createMaterials(){if(this._materials.length>0)return;const e=this.symbolLayer?.material?.color,i=this._getCombinedOpacityAndColor(e);this._materials[Graphics3DPolygonFillSymbolLayer_J.Fill]=patternUtils_s(this.symbolLayer,{color:i,forceTransparentMode:this.needsDrivenTransparentPass,discardInvisibleFragments:!0,polygonOffset:!1,hasVertexColors:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...this._fastUpdates?.materialParameters}),this._needsUV=this._materials[Graphics3DPolygonFillSymbolLayer_J.Fill]instanceof PatternMaterial_P;const r=this.symbolLayer.outline;if(function Graphics3DPolygonFillSymbolLayer_K(e){return null!=e?.size&&e.size>0&&null!=e.color&&(null==e.pattern||"style"!==e.pattern.type||"none"!==e.pattern.style)}(r)){const e=(0,lineStippleUtils.Xq)(r.pattern);this._materials[Graphics3DPolygonFillSymbolLayer_J.Outline]=new RibbonLineMaterial.W({width:(0,screenUtils.Lz)(r.size),color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:e,cap:lineUtils_n(r.patternCap||"butt")})}this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,Graphics3DPolygonFillSymbolLayer_z,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),r=this.setGraphicElevationContext(t);return this.ensureDrapedStatus("on-the-ground"===r.mode),this._createMaterials(),this.draped?this._createAsOverlay(t,i):this._createAs3DShape(t,i,r)}applyRendererDiff(e,t){for(const i in e.diff){if("visualVariables"!==i)return interfaces.w.RecreateSymbol;if(!(0,FastSymbolUpdates.J_)(this._fastUpdates,t,Graphics3DPolygonFillSymbolLayer_H))return interfaces.w.RecreateSymbol;this._materials[Graphics3DPolygonFillSymbolLayer_J.Fill]?.setParameters(this._fastUpdates.materialParameters)}return interfaces.w.FastUpdate}layerOpacityChanged(){if(null!=this._materials[Graphics3DPolygonFillSymbolLayer_J.Fill]){const e=this._materials[Graphics3DPolygonFillSymbolLayer_J.Fill].parameters.color,t=this.symbolLayer?.material?.color,i=this._getCombinedOpacity(t);this._materials[Graphics3DPolygonFillSymbolLayer_J.Fill].setParameters({color:[e[0],e[1],e[2],i],forceTransparentMode:this.needsDrivenTransparentPass})}if(null!=this._materials[Graphics3DPolygonFillSymbolLayer_J.Outline]){const e=this._materials[Graphics3DPolygonFillSymbolLayer_J.Outline].parameters.color;this._materials[Graphics3DPolygonFillSymbolLayer_J.Outline].setParameters({color:[e[0],e[1],e[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,t,i){const r=this._elevationContext.mode,s=(0,elevationAlignmentUtils.I2)(Graphics3DPolygonFillSymbolLayer_N.elevationModeChangeTypes,i,r);if(s!==elevationAlignmentUtils.uw.UPDATE)return s;const o=(0,elevationAlignmentUtils.nu)(r);return this.updateGraphics3DGraphicElevationInfo(e,t,(()=>o))}slicePlaneEnabledChanged(){if(this._materials[Graphics3DPolygonFillSymbolLayer_J.Fill]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[Graphics3DPolygonFillSymbolLayer_J.Outline]){const e={hasSlicePlane:this._context.slicePlaneEnabled};this._materials[Graphics3DPolygonFillSymbolLayer_J.Outline].setParameters(e)}return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,t,i){const r=polygonUtils_b(e.geometry);if(!r)return null;const s=polygon_p(r,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=new Graphics3DPolygonFillSymbolLayer_k(s,t,this._context.layer.uid,e.uid),n=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=(0,FloatArray.oe)(4*n,!0),o.boundingRect=(0,DoubleArray.jh)(9*n,!0),uvUtils_M(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(e,o),this._materials[Graphics3DPolygonFillSymbolLayer_J.Outline]&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,r.rings,"rings","FillSymbol3DLayer"),0===o.outGeometries.length)return null;const a=new Object3D.B({geometries:o.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:e.uid}),c=new Graphics3DObject3DGraphicLayer.Y(this,a,o.outGeometries,null,null,patternUtils_m,i);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=(0,elevationAlignmentUtils.nu)(i.mode),c}_createAs3DShapeFill(e,t){const i=t.renderData.polygons;for(const{position:r,mapPositions:n,holeIndices:a,index:l,count:p}of i){if(null!=this._context.clippingExtent&&((0,aaBoundingBox.vY)(n,Graphics3DPolygonFillSymbolLayer_W),!(0,aaBoundingBox.KG)(Graphics3DPolygonFillSymbolLayer_W,this._context.clippingExtent)))continue;const i=polygonUtils_p(n,a,this._context.elevationProvider.spatialReference);if(0===i.length)continue;const u=this._fastUpdates?.visualVariables.color,d=polygonUtils_l({material:this._materials[Graphics3DPolygonFillSymbolLayer_J.Fill],indices:i,mapPositions:n,attributeData:{position:r,color:u?null:t.color,colorFeature:u?(0,FastSymbolUpdates.ul)(u.field,e):null,uvMapSpace:this._needsUV?(0,FloatArray.AK)(t.uvMapSpace,4*l,4*p):null,boundingRect:this._needsUV?(0,DoubleArray.l5)(t.boundingRect,9*l,9*p):null,objectAndLayerIdColor:t.objectAndLayerIdColor}});t.outGeometries.push(d)}}_createAs3DShapeOutline(e){if(null==this._materials[Graphics3DPolygonFillSymbolLayer_J.Outline])return;const t=e.renderData.outlines;for(const{mapPositions:i,position:r}of t){if(null!=this._context.clippingExtent&&((0,aaBoundingBox.vY)(i,Graphics3DPolygonFillSymbolLayer_W),!(0,aaBoundingBox.KG)(Graphics3DPolygonFillSymbolLayer_W,this._context.clippingExtent)))continue;const t=(0,line.t)(this._materials[Graphics3DPolygonFillSymbolLayer_J.Outline],{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:i,attributeData:{position:r}},e.objectAndLayerIdColor);e.outGeometries.push(t)}}_createAsOverlay(e,t){const i=polygonUtils_b(e.geometry);if(null==i)return null;this._materials[Graphics3DPolygonFillSymbolLayer_J.Fill].renderPriority=this._renderPriority+this._renderPriorityStep/2,null!=this._materials[Graphics3DPolygonFillSymbolLayer_J.Outline]&&(this._materials[Graphics3DPolygonFillSymbolLayer_J.Outline].renderPriority=this._renderPriority);const r=c(i,this._context.overlaySR),s=new Graphics3DPolygonFillSymbolLayer_q(r,t,this._context.layer.uid,e.uid),o=s.renderData.position.length/3;return this._needsUV&&(s.uvMapSpace=(0,FloatArray.oe)(4*o,!0),function uvUtils_T(t,r,e,s,i=1){if(e.isGeographic&&s===ViewingMode.RT.Global){const t=(0,DoubleArray.jh)(r.length),o=r.length,s=(0,ellipsoidUtils.tO)(e);for(let e=0;e<o;e+=3)(0,projectors.RC)(r,e,t,e,s);r=t}(0,vec2.hZ)(uvUtils_y,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let o=0;o<r.length;o+=3)uvUtils_y[0]=Math.min(uvUtils_y[0],r[o]),uvUtils_y[1]=Math.min(uvUtils_y[1],r[o+1]);const a=uvUtils_y[0]%i,m=uvUtils_y[1]%i,n=uvUtils_y[0]-a,c=uvUtils_y[1]-m;for(let o=0;o<r.length;o+=3){const e=o/3*4;t[e]=(r[o]-n)/i,t[e+1]=(r[o+1]-c)/i,t[e+2]=n/i,t[e+3]=c/i}}(s.uvMapSpace,s.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),s.outBoundingBox=(0,aaBoundingBox.Ie)(),s.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(s),this._createAsOverlayFill(e,s),this._materials[Graphics3DPolygonFillSymbolLayer_J.Outline]&&this._createAsOverlayOutline(s),this._logGeometryCreationWarnings(s.renderData,i.rings,"rings","FillSymbol3DLayer"),0===s.outGeometries.length?null:new Graphics3DDrapedGraphicLayer_l(this,s.outGeometries,s.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e,t){const r=t.renderData.polygons;for(const{position:n,holeIndices:l,index:c,count:p}of r){const r=(0,aaBoundingBox.vY)(n,Graphics3DPolygonFillSymbolLayer_W);if(!(0,aaBoundingBox.KG)(r,this._context.clippingExtent))continue;const u=(0,earcut.e)(n,l,3);if(0===u.length)continue;(0,aaBoundingBox.RF)(t.outBoundingBox,r);const d=this._fastUpdates?.visualVariables.color,m=polygonUtils_l({material:this._materials[Graphics3DPolygonFillSymbolLayer_J.Fill],indices:u,attributeData:{position:n,color:d?null:t.color,colorFeature:d?(0,FastSymbolUpdates.ul)(d.field,e):null,uvMapSpace:this._needsUV?(0,FloatArray.AK)(t.uvMapSpace,4*c,4*p):null,objectAndLayerIdColor:t.objectAndLayerIdColor}});t.outGeometries.push(new RenderGeometry.$(m,t))}}_createAsOverlayOutline(e){if(null==this._materials[Graphics3DPolygonFillSymbolLayer_J.Outline])return;const t=e.renderData.outlines;for(let i=0;i<t.length;++i){const{position:r}=t[i];if((0,aaBoundingBox.vY)(r,Graphics3DPolygonFillSymbolLayer_W),!(0,aaBoundingBox.KG)(Graphics3DPolygonFillSymbolLayer_W,this._context.clippingExtent))continue;(0,aaBoundingBox.RF)(e.outBoundingBox,Graphics3DPolygonFillSymbolLayer_W);const n=(0,line.t)(this._materials[Graphics3DPolygonFillSymbolLayer_J.Outline],{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:r}},e.objectAndLayerIdColor);e.outGeometries.push(new RenderGeometry.$(n,e))}}_getOutlineOpacity(){const e=this.symbolLayer?.outline?.color;return(this.draped?1:this._getLayerOpacity())*(null!=e?e.a:0)}_getOutlineColor(){const t=this.symbolLayer?.outline?.color,i=this._getOutlineOpacity();return(0,graphicUtils.$C)(null!=t?Color.A.toUnitRGB(t):null,i)}test(){return{...super.test(),createAsOverlay:(e,t)=>this._createAsOverlay(e,t),createAs3DShape:(e,t,i)=>this._createAs3DShape(e,t,i)}}}Graphics3DPolygonFillSymbolLayer_N.elevationModeChangeTypes={definedChanged:elevationAlignmentUtils.uw.RECREATE,staysOnTheGround:elevationAlignmentUtils.uw.NONE,onTheGroundChanged:elevationAlignmentUtils.uw.RECREATE};const Graphics3DPolygonFillSymbolLayer_W=(0,aaBoundingBox.vt)();class Graphics3DPolygonFillSymbolLayer_k extends g{constructor(e,t,i,r){super(e,i,r),this.color=t}}class Graphics3DPolygonFillSymbolLayer_q extends g{constructor(e,t,i,r){super(e,i,r),this.color=t}}var Graphics3DPolygonFillSymbolLayer_J;!function(e){e[e.Fill=0]="Fill",e[e.Outline=1]="Outline"}(Graphics3DPolygonFillSymbolLayer_J||(Graphics3DPolygonFillSymbolLayer_J={}));var calloutUtils=__webpack_require__("./node_modules/@arcgis/core/symbols/callouts/calloutUtils.js"),Graphics3DObjectMetadata=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DObjectMetadata.js");class LabelParameters_i{constructor(i,r="center",c=!1,a=(0,vec2f64.vt)(),o=(0,vec4f64.fA)(0,0,0,-1),l="world",f=(0,vec3f64.vt)(),n=0){this.verticalOffset=i,this.anchor=r,this.hasLabelVerticalOffset=c,this.screenOffset=a,this.centerOffset=o,this.centerOffsetUnits=l,this.translation=f,this.elevationOffset=n}}class LabelParameters_r{constructor(e,s="center",i="center",r=null,c=(0,vec2f64.vt)(),a=!0){this.placement=e,this.horizontalPlacement=s,this.verticalPlacement=i,this.text=r,this.displaySize=c,this.isFocused=a}}var FontMetrics=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/FontMetrics.js"),fontUtils=__webpack_require__("./node_modules/@arcgis/core/core/fontUtils.js");class TextRenderParameters_s{constructor(o){this.definition=o,this.key=JSON.stringify(o),this.haloSize=Math.round(o.halo.size),this.textStyle=TextRenderParameters_a(o.color),this.haloStyle=function TextRenderParameters_l(o){return`rgb(${o.slice(0,3).map((o=>Math.floor(255*o))).toString()})`}(o.halo.color),this.backgroundStyle=0!==o.background.color[3]?TextRenderParameters_a(o.background.color):null}fontString(o){const t=this.definition.font;return`${t.style} ${t.weight} ${o}px ${t.family}, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji`}setFontProperties(o,t){o.font=this.fontString(t),o.textAlign="left",o.textBaseline="alphabetic"}static async fromSymbol(l,a){const f=l?.material?.color,m=Color.A.toUnitRGBA(f)??vec4f64.uY,g=null!=l.size?(0,screenUtils.Lz)(l.size):12,u=l.lineHeight,d=null!=l.background?Color.A.toUnitRGBA(l.background.color):vec4f64.uY,h={family:l.font?.family??"sans-serif",decoration:l.font?.decoration??"none",weight:l.font?.weight??"normal",style:l.font?.style??"normal"},y=l.halo,b=null!=y?.color&&y.size>0?{size:(0,screenUtils.Lz)(y.size),color:Color.A.toUnitRGBA(y.color)}:{size:0,color:vec4f64.uY},p=new TextRenderParameters_s({color:m,size:g,background:{color:d,padding:null!=l.background?[.65*g,.5*g]:[0,0],borderRadius:null!=l.background?g*(6/16):0},lineSpacingFactor:u,font:h,halo:b,pixelRatio:a});if(l.font){let o=!1;const r=p.fontString(g);try{o=(await document.fonts.load(r)).some((o=>!(0,fontUtils.NZ)(o)))}catch(S){Logger.A.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${r}'. Some text symbology may be rendered using the default browser font.`)}if(!o&&!TextRenderParameters_c.has(l.font.family))try{await(0,fontUtils.Al)(l.font)}catch(S){}}return p}}function TextRenderParameters_a(o){return`rgba(${o.slice(0,3).map((o=>Math.floor(255*o))).toString()},${o[3]})`}const TextRenderParameters_c=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]);var TextHelperCanvas=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/TextHelperCanvas.js"),TextRenderer=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/TextRenderer.js"),Evented=__webpack_require__("./node_modules/@arcgis/core/core/Evented.js"),uid=__webpack_require__("./node_modules/@arcgis/core/core/uid.js"),vec42=__webpack_require__("./node_modules/@arcgis/core/chunks/vec42.js"),testUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/testUtils.js"),textureUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/textureUtils.js"),Scheduler=__webpack_require__("./node_modules/@arcgis/core/views/support/Scheduler.js"),Yield=__webpack_require__("./node_modules/@arcgis/core/views/support/Yield.js"),webgl_Texture=__webpack_require__("./node_modules/@arcgis/core/views/webgl/Texture.js"),TextureDescriptor=__webpack_require__("./node_modules/@arcgis/core/views/webgl/TextureDescriptor.js");let TextTextureAtlas_k=class extends Accessor.A{constructor(e){super(e),this.type=ContentObjectType.X.Texture,this.id=(0,uid.c)(),this.events=new Evented.A,this._glTexture=null,this._atlas=new TextTextureAtlas_A(256,256),this._needsRepack=!1,this._canRepack=!0,this._elementsToRender=new Map,this._elements=new Map,this._uvCallbacks=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._updateCanvasElementSize(this._atlas),this._reset()}unload(){this._glTexture=(0,maybe.WD)(this._glTexture),this._frameWorker=(0,maybe.xt)(this._frameWorker),this.updating=!1,this.events.emit("unloaded")}get glTexture(){return this._glTexture}static get maxSize(){return TextTextureAtlas_j=testUtils.G.stableRendering?TextTextureAtlas_R:0,[4096-TextTextureAtlas_R-TextTextureAtlas_j,4096-TextTextureAtlas_R-TextTextureAtlas_j-TextTextureAtlas_y]}load(e){if(this._glTexture)return this._glTexture;const t=new TextureDescriptor.R;return t.wrapMode=enums.pF.CLAMP_TO_EDGE,t.samplingMode=enums.Cj.LINEAR_MIPMAP_LINEAR,t.hasMipmap=!0,t.preMultiplyAlpha=!0,t.maxAnisotropy=e.parameters.maxMaxAnisotropy,this._glTexture=new webgl_Texture.g(e,t,this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(Scheduler.W6.TEXT_TEXTURE_ATLAS,this),this.setDirty(),this._glTexture}dispose(){this._elements.clear(),this._elementsToRender.clear(),this._frameWorker=(0,maybe.xt)(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=(0,maybe.WD)(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.width=e.width,this._canvas.height=e.height}_resizeAtlas(e,t){const{width:s,height:i}=this._atlas;s===e&&i===t||(this._atlas.width=e,this._atlas.height=t,this._glTexture?.resize(e,t),this._glTexture?.updateData(0,0,0,s,i,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach((e=>this._uvCallbacks.get(e.textRenderer.key)?.forEach((t=>t(e.uv))))),this._reset())}_reset(){this._elementsToRender.clear(),this._atlas.reset(),this._needsRepack=!0,this.setDirty()}_addAtlasElement(e,t,s,i){const r=this._atlas;if(r.width<s||r.height<i)return!1;let h=r.cursors.get(i);if(!h){if(r.height<r.nextY+i)return!1;h=[new TextTextureAtlas_C(r.nextY)],r.cursors.set(i,h),r.nextY+=i}let n=h.find((e=>r.width>=e.x+s));if(null==n){if(r.height<r.nextY+i)return!1;n=new TextTextureAtlas_C(r.nextY),r.nextY+=i,h.push(n)}return e.setNewPosition(n),this._elements.set(t,e),this._elementsToRender.set(t,e),n.x+=s,!0}_ensureCallbacks(e){const t=this._uvCallbacks.get(e);if(t)return t;const s=new Set;return this._uvCallbacks.set(e,s),s}_addCallback(e,t){this._ensureCallbacks(e).add(t)}_removeCallback(e,t){const s=this._uvCallbacks.get(e);return!(!s?.delete(t)||0!==s.size||(this._uvCallbacks.delete(e),0))}_processAddition(e){const t=e.textRenderer.key;if(this._needsRepack)return void this._elements.set(t,e);const s=this._atlas,i=e.textRenderer.renderedWidth,r=e.textRenderer.renderedHeight,h=i+TextTextureAtlas_R,n=r+TextTextureAtlas_R+TextTextureAtlas_y;if(!this._addAtlasElement(e,t,h,n)){if(this._canRepack)this._reset();else if(s.width<h){const e=Math.min((0,textureUtils.Mv)(Math.max(h,1.5*s.width)),4096);this._resizeAtlas(e,s.height)}else{const e=s.nextY+n,t=Math.min((0,textureUtils.Mv)(Math.max(e,1.5*s.height)),4096);if(t>s.height)this._resizeAtlas(s.width,t);else if(s.width<4096){const e=Math.min((0,textureUtils.Mv)(1.5*s.width),4096);this._resizeAtlas(e,s.height)}}this._elements.set(t,e)}}_renderElement(e){const t=e.commitNewPosition(),s=e.textRenderer;this._ctx.clearRect(t[0]-TextTextureAtlas_R,t[1]-TextTextureAtlas_R,s.renderedWidth+2*TextTextureAtlas_R,s.renderedHeight+2*TextTextureAtlas_R),s.render(this._ctx,t[0],t[1]),this._uvCallbacks.get(s.key)?.forEach((t=>t(e.uv)))}get running(){return this.updating}runTask(e){if(null==this._glTexture)return Yield.G;for(;this._needsRepack&&(this._canRepack||this._atlas.height<4096&&this._atlas.height<4096);){this._canRepack=this._needsRepack=!1;const t=this._elements;this._elements=new Map,t.forEach((e=>this._processAddition(e))),e.madeProgress()}if(this._elementsToRender.size>0){for(const[t,s]of this._elementsToRender){if(e.done)break;this._renderElement(s),this._elementsToRender.delete(t),e.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=this._elementsToRender.size>0}addText(e,t){const s=e.key;this._addCallback(s,t);let i=this._elements.get(s);return i?(0,vec42.a)(i.uv,vec4f64.uY)||t(i.uv):(i=new TextTextureAtlas_b(this._atlas,e),this._processAddition(i),this.setDirty()),{remove:()=>this._removeText(e,t)}}_removeText(e,t){const s=e.key;this._elements.get(s)&&this._removeCallback(s,t)&&(this._elements.delete(s),this._elementsToRender.delete(s),this._canRepack=!0)}setDirty(){this._glTexture&&(this.updating=!0)}get test(){}};(0,tslib_es6._)([(0,property.MZ)({constructOnly:!0})],TextTextureAtlas_k.prototype,"view",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Boolean})],TextTextureAtlas_k.prototype,"updating",void 0),TextTextureAtlas_k=(0,tslib_es6._)([(0,subclass.$)("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],TextTextureAtlas_k);const TextTextureAtlas_R=2,TextTextureAtlas_y=2;class TextTextureAtlas_b{constructor(e,t){this._atlas=e,this.textRenderer=t,this._uv=(0,vec4f64.vt)(),this._newPosition=[0,0]}get uv(){if(null==this._xOffset||null==this._yOffset)return vec4f64.uY;const{renderedWidth:e,renderedHeight:t}=this.textRenderer;return(0,vec42.s)(this._uv,this._xOffset/this._atlas.width,(this._yOffset+t)/this._atlas.height,(this._xOffset+e)/this._atlas.width,this._yOffset/this._atlas.height)}setNewPosition(e){this._newPosition[0]=e.x,this._newPosition[1]=e.y}commitNewPosition(){return this._xOffset=this._newPosition[0],this._yOffset=this._newPosition[1],this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}}class TextTextureAtlas_A{constructor(e,t){this.width=e,this.height=t,this.cursors=new Map,this.nextY=0}reset(){this.cursors.clear(),this.nextY=TextTextureAtlas_j}}class TextTextureAtlas_C{constructor(e){this.y=e,this.x=TextTextureAtlas_j}}let TextTextureAtlas_j=0;class TextTextureFactory_i{constructor(e,n,s){this._renderer=new TextRenderer.Js(e,n,s,TextTextureAtlas_k.maxSize)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const r=(0,TextHelperCanvas.y)(TextTextureFactory_d,this._renderer.renderedWidth,this._renderer.renderedHeight),t=r.getContext("2d");return t.save(),this._renderer.render(t,0,0),t.restore(),new Texture.g(r,{wrap:{s:enums.pF.CLAMP_TO_EDGE,t:enums.pF.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}}const TextTextureFactory_d={canvas:null},Graphics3DTextSymbolLayer_H=(0,vec3f64.CN)(0,0,1);class Graphics3DTextSymbolLayer_W extends Graphics3DSymbolLayer.U{constructor(e,t,s,r){super(e,t,s,r),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const t=(0,graphicUtils.Hj)(this.symbolLayer.size);if(t)throw new core_Error.A("graphics3dtextsymbollayer:invalid-size",t)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await TextRenderParameters_s.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const t=e.graphic,s=(0,pointUtils.ZX)(t.geometry);if(null==s)return this.logger.warn(`unsupported geometry type for text symbol: ${t.geometry.type}`),null;const r=this._context.stage.view.focusAreas.containsGeometry(s),o=this.symbolLayer.text;if(null==o||""===o)return null;const n=(0,calloutUtils.YX)(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(null!=n&&!(0,calloutUtils.Ie)(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const{verticalAlignment:i}=this.symbolLayer,a=new LabelParameters_i(n);(0,placementUtils.xU)(i,a.screenOffset);const l=new LabelParameters_r(a,this.symbolLayer.horizontalAlignment,(0,placementUtils.RH)(i));return l.isFocused=r??l.isFocused,this._createAs3DShape(t,s,o,l)}updateFocus(e,t){t.forEach((t=>{const s=this._context.stage.view.focusAreas.containsGeometry(t.graphic.geometry);t.layers.forEach((r=>{r?.graphics3DSymbolLayer===this&&r.stageObject.geometries.some((e=>e.material.parameters.isFocused!==s))&&e(t)}))}))}createLabel(e,t,s,r,o){const n=e.graphic,i=(0,pointUtils.ZX)(n.geometry);if(null==i)return this.logger.warn(`unsupported geometry type for label: ${n.geometry.type}`),null;const a=this._context.stage.view.focusAreas.containsGeometry(i),l=t.text;return!l||/^\s+$/.test(l)?null:(t.isFocused=a??t.isFocused,this._createAs3DShape(n,i,l,t,s,r,o))}setGraphicElevationContext(e,t=new ElevationContext.F,s=0){return super.setGraphicElevationContext(e,t),t.addOffsetRenderUnits(s),t}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,t){return Graphics3DTextSymbolLayer_I(e,t,((e,t)=>{this.updateGraphicElevationContext(t,e)})),elevationAlignmentUtils.uw.UPDATE}slicePlaneEnabledChanged(e,t){return Graphics3DTextSymbolLayer_I(e,t,(e=>{for(const t of e.stageObject.geometries)t.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})})),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(e,t){const{elevationContext:s,metadata:r}=t;this.setGraphicElevationContext(e,s,r?.elevationOffset??0),t.needsElevationUpdates=(0,elevationAlignmentUtils.nu)(s.mode)||"absolute-height"===s.mode}updateGeometry(e,t){if(this.draped||!this._validateGeometry(t))return!1;const{elevationContext:s,stageObject:r}=e;if(s.mode!==this.getGeometryElevationMode(t))return!1;const o=(0,pointUtils.ZX)(t);if(!o)return!1;const n=(0,pointUtils.hS)(r,this._context,o,s);if(null==n)return!1;const i=(0,pointUtils.R$)(this._context,o);return r.geometries[0].localOrigin===i&&(e.alignedSampledElevation=n,(0,pointUtils.d2)(e,o,this._context.elevationProvider),!0)}_defaultElevationInfoNoZ(){return Graphics3DTextSymbolLayer_V}_createAs3DShape(e,a,c,m,u=null,x=null,v=()=>m.placement.elevationOffset){const b=this.setGraphicElevationContext(e,new ElevationContext.F,m.placement.elevationOffset),O="polyline"===e.geometry?.type,P=e.uid;let w=null,j=null;if(null==x){const e=(0,placementUtils.QE)(m.horizontalPlacement);w=new TextTextureFactory_i(c,e,this._textRenderParameters);let r=null;if(null!=this._context.sharedResources.textures){j=this._context.sharedResources.textures.fromData(w.key,(()=>w.create())),j.texture.events.on("unloaded",(()=>r=(0,maybe.Gz)(r)));const e=this._context.stage.renderView.textures.acquire(j.texture.id);if(null==e||(0,promiseUtils.$X)(e))return j.release(),null;r=e}}const E=!!(0,has.A)("enable-feature:non-occluded-hud"),S=function Graphics3DTextSymbolLayer_M(e,t){if("baseline"===t.verticalPlacement){const s=placementUtils.cN[t.horizontalPlacement],r=null!=e?e.baselineAnchorY:0;return(0,vec2f64.fA)(s,r)}const s=(0,placementUtils.Ir)(t.horizontalPlacement,t.verticalPlacement);return placementUtils.Zd[s]}(w,m),L={occlusionTest:!E,occludedFragmentFade:E,horizonCullingEnabled:E&&this._context.spherical,screenOffset:m.placement.screenOffset,anchorPosition:S,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:m.placement.centerOffsetUnits,depthEnabled:!1,drawAsLabel:!0,isLabel:!0,isFocused:m.isFocused};if(O&&(L.shaderPolygonOffset=1e-4),x?L.textureId=x.id:j&&(L.textureId=j.texture.id),null!=m.placement.verticalOffset){const{screenLength:e,minWorldLength:t,maxWorldLength:s}=m.placement.verticalOffset;L.verticalOffset={screenLength:(0,screenUtils.Lz)(e),minWorldLength:t||0,maxWorldLength:null!=s?s:1/0}}const G=this._context.graphicsCoreOwner.view.focusAreas.activePolygons.length,A={screenOffset:L.screenOffset,anchorPosition:S,centerOffsetUnits:L.centerOffsetUnits,verticalOffset:L.verticalOffset,shaderPolygonOffset:L.shaderPolygonOffset,occlusionTest:L.occlusionTest,isFocused:m.isFocused,focusEffect:this._context.stage.view.focusAreas?.style};if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:e,screenSizePerspectiveSettingsLabels:t}=this._context.sharedResources,s=(0,FontMetrics.z)(this._textRenderParameters);L.screenSizePerspective=t.overrideFontHeight(s.maxHeight),L.screenSizePerspectiveAlignment=e,A.fontHeight=s.maxHeight}L.hasSlicePlane=this._context.slicePlaneEnabled;const D=this._context.spherical,W=u?JSON.stringify(A):"";let I=u?.get(W);if(null==I){if(!m.isFocused&&G>0){const e=this._context.stage.view.focusAreas?.style;L.color=C(L.color,e),L.outlineColor=C(L.outlineColor,e)}I=new HUDMaterial.R(L,D),u?.add(W,I)}const V=m.placement.translation,$=w?(0,vec2f64.fA)(w.displayWidth,w.displayHeight):vec2f64.uY,k=m.placement.centerOffset,N=Graphics3DTextSymbolLayer_H,q=x?(0,vec4f64.fA)(0,0,0,0):null,B=(0,GeometryUtil.DJ)(I,{normal:N,position:V,size:$,centerOffsetAndDistance:k,uvs:q}),J=(0,pointUtils.SZ)(this._context,a,B,b,P);if(null==J)return null;const Z=new Graphics3DObject3DGraphicLayer.Y(this,J.object,[B],null==u?[I]:null,j,((t,s,r,o,n,i)=>{const a=v()||m.placement.elevationOffset,l=this.setGraphicElevationContext(e,s,a);return(0,ElevationAligners.G8)(t,l,r,o,n,i)}),b);Z.alignedSampledElevation=J.sampledElevation,Z.needsElevationUpdates=(0,elevationAlignmentUtils.nu)(b.mode)||"absolute-height"===b.mode,Z.getScreenSize=(e=(0,vec2f64.vt)())=>(e[0]=w?w.displayWidth:m.displaySize[0],e[1]=w?w.displayHeight:m.displaySize[1],e);const K=new Graphics3DObjectMetadata.Z(m.placement.elevationOffset,c);return Z.metadata=K,(0,pointUtils.d2)(Z,a,this._context.elevationProvider),Z}}function Graphics3DTextSymbolLayer_I(e,t,s){e?.forEach((e=>{const r=t(e);null!=r&&s(r,e.graphic)}))}const Graphics3DTextSymbolLayer_V={mode:"relative-to-ground",offset:0};var time=__webpack_require__("./node_modules/@arcgis/core/core/time.js"),WaterSurface_glsl=(__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl.js"),__webpack_require__("./node_modules/@arcgis/core/chunks/WaterSurface.glsl.js"));class WaterTechnique_f extends ShaderTechnique.w{constructor(r,e){super(r,e,new ReloadableShaderModule.$(WaterSurface_glsl.W,(()=>__webpack_require__.e(9069).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/views/3d/webgl-engine/shaders/WaterSurface.glsl.js")))))}initializePipeline(e){const{oitPass:t,output:s,transparent:p,draped:m,enableOffset:f}=e,h=t===OITPass.Y.NONE,j=t===OITPass.Y.FrontFace;return(0,renderState.Ey)({blending:s!==ShaderOutput.V.Normal&&s!==ShaderOutput.V.Highlight&&s!==ShaderOutput.V.ObjectAndLayerIdColor&&p?(0,OrderIndependentTransparency.Yf)(t):null,depthTest:m?null:{func:(0,OrderIndependentTransparency.K_)(t)},depthWrite:(0,OrderIndependentTransparency.z5)(e),drawBuffers:(0,OrderIndependentTransparency.m6)(t,s),colorWrite:renderState.kn,polygonOffset:h||j?null:(0,OrderIndependentTransparency.aB)(f)})}}class WaterGLMaterial_r extends GLMaterial.A{ensureResources(e){return this._techniques.context.waterTextures.ensureResources(e)}beginSlot(e){const r=this._techniques.context.waterTextures.passParameters;return this._material.setParameters({wavePerturbation:r.wavePerturbation,waveNormal:r.waveNormal}),this.getTechnique(WaterTechnique_f,e)}}class WaterTechniqueConfiguration_n extends DefaultTechniqueConfiguration.E{constructor(e,i){super(),this.spherical=e,this.doublePrecisionRequiresObfuscation=i,this.receiveShadows=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.screenSpaceReflections=!1,this.cloudReflections=!1,this.objectAndLayerIdColorInstanced=!1,this.draped=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.textureCoordinateType=TextureCoordinateAttribute_glsl.I.None,this.emissionSource=Emissions_glsl.ZX.None,this.pbrMode=PhysicallyBasedRenderingParameters_glsl.A9.Water,this.occlusionPass=!1,this.useCustomDTRExponentForWater=!0,this.highStepCount=!0,this.useFillLights=!1}get discardInvisibleFragments(){return this.transparent&&this.writeDepth}}(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],WaterTechniqueConfiguration_n.prototype,"receiveShadows",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],WaterTechniqueConfiguration_n.prototype,"transparent",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],WaterTechniqueConfiguration_n.prototype,"enableOffset",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],WaterTechniqueConfiguration_n.prototype,"writeDepth",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],WaterTechniqueConfiguration_n.prototype,"screenSpaceReflections",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],WaterTechniqueConfiguration_n.prototype,"cloudReflections",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],WaterTechniqueConfiguration_n.prototype,"objectAndLayerIdColorInstanced",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],WaterTechniqueConfiguration_n.prototype,"draped",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],WaterTechniqueConfiguration_n.prototype,"terrainDepthTest",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.W)()],WaterTechniqueConfiguration_n.prototype,"cullAboveTerrain",void 0);class WaterMaterial_ extends TriangleMaterial.W{constructor(t,e){super(t,WaterMaterial_v),this.produces=new Map([[RenderSlot.N.OPAQUE_MATERIAL,t=>(0,ShaderOutput.RN)(t)&&!this.parameters.transparent||(0,ShaderOutput.CL)(t)],[RenderSlot.N.TRANSPARENT_MATERIAL,t=>(0,ShaderOutput.RN)(t)&&this.parameters.transparent||(0,ShaderOutput.CL)(t)],[RenderSlot.N.DRAPED_MATERIAL,t=>this.parameters.draped&&(0,ShaderOutput.RN)(t)||(0,ShaderOutput.CL)(t)],[RenderSlot.N.DRAPED_WATER,t=>t===ShaderOutput.V.Normal]]),this._configuration=new WaterTechniqueConfiguration_n(e.spherical,e.doublePrecisionRequiresObfuscation)}getConfiguration(t,e){return this._configuration.output=t,this._configuration.writeDepth=!0,this._configuration.receiveShadows=e.shadowMap.enabled,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.screenSpaceReflections=null!=e.ssr.lastFrameColor,this._configuration.cloudReflections=null!=e.clouds.data,this._configuration.draped=this.parameters.draped,this._configuration.oitPass=e.oitPass,this._configuration.enableOffset=e.camera.relativeElevation<OrderIndependentTransparency.xt,this._configuration.terrainDepthTest=e.terrainDepthTest&&(0,ShaderOutput.RN)(t),this._configuration.cullAboveTerrain=e.cullAboveTerrain,this._configuration}get visible(){return!0}update(e){return this.setParameters({timeElapsed:(0,time.y)(e.time)*this.parameters.animationSpeed},!1),this._animationEnabled(e.camera)&&e.dt>0}_animationEnabled(t){const e=Math.min(t.relativeElevation,t.distance);return Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*e<WaterMaterial_b}createGLMaterial(t){return new WaterGLMaterial_r(t)}createBufferWriter(){return new DefaultBufferWriter.Z((0,olidUtils.E)()?DefaultLayouts.Dq:DefaultLayouts.zK)}get test(){}}class WaterMaterial_v extends Material.qA{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=(0,vec2f64.fA)(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=(0,vec4f64.fA)(0,0,0,0),this.transparent=!0,this.hasSlicePlane=!1,this.draped=!1,this.origin=(0,vec3f64.vt)(),this.modelTransformation=null}}const WaterMaterial_b=35e3,waterMaterialUtils_e={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},Graphics3DWaterSymbolLayer_I=["polyline","polygon","extent"];class Graphics3DWaterSymbolLayer_B extends Graphics3DSymbolLayer.U{constructor(e,t,r,o){super(e,t,r,o)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,Graphics3DWaterSymbolLayer_I,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(t);return this.ensureDrapedStatus("on-the-ground"===r.mode),this.ensureMaterial(),this.draped?this._createAsOverlay(t):this._createAs3DShape(t,r,t.uid)}ensureMaterial(){if(this._materials[0])return;const t=new WaterMaterial_v,r=this.symbolLayer.color;null!=r&&(t.color=Color.A.toUnitRGBA(r));const o=this._getCombinedOpacity(r,{hasIntrinsicColor:!0});t.color=[t.color[0],t.color[1],t.color[2],o],t.transparent=o<1||this.needsDrivenTransparentPass,t.waveDirection=null!=this.symbolLayer.waveDirection?function Graphics3DWaterSymbolLayer_U(e){const t=(0,vec2f64.vt)(),r=(0,common.DF)(e);return t[0]=Math.sin(r),t[1]=Math.cos(r),t}(this.symbolLayer.waveDirection):(0,vec2f64.fA)(0,0);const n=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,s=waterMaterialUtils_e[n];t.waveStrength=s.waveStrength,t.waveTextureRepeat=s.textureRepeat,t.waveVelocity=s.waveVelocity,t.flowStrength=s.perturbationStrength,t.hasSlicePlane=this._context.slicePlaneEnabled,t.draped=this.draped,this._materials[0]=new WaterMaterial_(t,this._context),this._context.stage.add(this._materials[0])}layerOpacityChanged(){if(null==this._materials[0])return;const e=this._materials[0].parameters.color,t=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=t<1||this.needsDrivenTransparentPass;this._materials[0].setParameters({color:[e[0],e[1],e[2],t],transparent:r})}layerElevationInfoChanged(e,t,r){const o=this._elevationContext.mode,i=(0,elevationAlignmentUtils.I2)(Graphics3DWaterSymbolLayer_B.elevationModeChangeTypes,r,o);if(i!==elevationAlignmentUtils.uw.UPDATE)return i;const n=(0,elevationAlignmentUtils.nu)(o);return this.updateGraphics3DGraphicElevationInfo(e,t,(()=>n))}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,t,r){const o=polygonUtils_b(e.geometry);if(null==o)return null;const i=polygon_p(o,this._context.elevationProvider,this._context.renderCoordsHelper,t),n=i.position.length/3,s=(0,DoubleArray.jh)(2*n);Graphics3DWaterSymbolLayer_M(s,i.mapPositions,n,this._context.elevationProvider.spatialReference);const a=new Graphics3DWaterSymbolLayer_N(i,s,this._context.layer.uid,e.uid);if(a.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(a),this._create3DShapeGeometries(a),this._logGeometryCreationWarnings(a.renderData,o.rings,"rings","WaterSymbol3DLayer"),0===a.outGeometries.length)return null;const l=new Object3D.B({geometries:a.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:r}),c=new Graphics3DObject3DGraphicLayer.Y(this,l,a.outGeometries,null,null,ElevationAligners.B6,t);return c.alignedSampledElevation=a.renderData.sampledElevation,c.needsElevationUpdates=(0,elevationAlignmentUtils.nu)(t.mode),c}_create3DShapeGeometries(e){const t=e.renderData.polygons,o=e.uvCoords;for(const{count:i,index:n,position:s,mapPositions:a,holeIndices:l}of t){if(null!=this._context.clippingExtent&&((0,aaBoundingBox.vY)(a,Graphics3DWaterSymbolLayer_k),!(0,aaBoundingBox.KG)(Graphics3DWaterSymbolLayer_k,this._context.clippingExtent)))continue;const t=(0,earcut.e)(a,l,3);if(0===t.length)continue;const m=(0,DoubleArray.l5)(o,2*n,2*i),u=polygonUtils_m({material:this._materials[0],indices:t,mapPositions:a,attributeData:{position:s,uv0:m}},e.objectAndLayerIdColor);e.outGeometries.push(u)}}_createAsOverlay(e){const t=polygonUtils_b(e.geometry);if(null==t)return null;this._materials[0].renderPriority=this._renderPriority;const r=c(t,this._context.overlaySR),o=r.position.length/3,i=(0,DoubleArray.jh)(2*o);Graphics3DWaterSymbolLayer_M(i,r.position,o,this._context.overlaySR);const n=new Graphics3DWaterSymbolLayer_H(r,i,this._context.layer.uid,e.uid);return n.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(n),n.outBoundingBox=(0,aaBoundingBox.Ie)(),this._createAsOverlayWater(n),this._logGeometryCreationWarnings(n.renderData,t.rings,"rings","WaterSymbol3DLayer"),0===n.outGeometries.length?null:new Graphics3DDrapedGraphicLayer_l(this,n.outGeometries,n.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const t=e.uvCoords,o=e.renderData.polygons;for(const{position:i,holeIndices:n,index:s,count:a}of o){if((0,aaBoundingBox.vY)(i,Graphics3DWaterSymbolLayer_k),!(0,aaBoundingBox.KG)(Graphics3DWaterSymbolLayer_k,this._context.clippingExtent))continue;(0,aaBoundingBox.RF)(e.outBoundingBox,Graphics3DWaterSymbolLayer_k);const o=(0,earcut.e)(i,n,3);if(0===o.length)continue;const l=(0,DoubleArray.l5)(t,2*s,2*a),m=polygonUtils_m({material:this._materials[0],indices:o,attributeData:{position:i,uv0:l}},e.objectAndLayerIdColor);e.outGeometries.push(new RenderGeometry.$(m,e))}}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}}function Graphics3DWaterSymbolLayer_M(e,r,i,n){const a=(0,unitUtils.GA)(n);(0,aaBoundingRect.Ie)(Graphics3DWaterSymbolLayer_z);for(let t=0;t<i;t++)(0,vec2.hZ)(Graphics3DWaterSymbolLayer_V,r[3*t],r[3*t+1]),(0,aaBoundingRect.tK)(Graphics3DWaterSymbolLayer_z,Graphics3DWaterSymbolLayer_V);(0,vec42.b)(Graphics3DWaterSymbolLayer_z,Graphics3DWaterSymbolLayer_z,a);const l=Graphics3DWaterSymbolLayer_z[0]%Graphics3DWaterSymbolLayer_B.unitSizeOfTexture,c=Graphics3DWaterSymbolLayer_z[1]%Graphics3DWaterSymbolLayer_B.unitSizeOfTexture;Graphics3DWaterSymbolLayer_W[0]=Graphics3DWaterSymbolLayer_z[0]-l,Graphics3DWaterSymbolLayer_W[1]=Graphics3DWaterSymbolLayer_z[1]-c;for(let t=0;t<i;t++)e[2*t]=(r[3*t]*a-Graphics3DWaterSymbolLayer_W[0])/Graphics3DWaterSymbolLayer_B.unitSizeOfTexture,e[2*t+1]=(r[3*t+1]*a-Graphics3DWaterSymbolLayer_W[1])/Graphics3DWaterSymbolLayer_B.unitSizeOfTexture}Graphics3DWaterSymbolLayer_B.unitSizeOfTexture=100,Graphics3DWaterSymbolLayer_B.elevationModeChangeTypes={definedChanged:elevationAlignmentUtils.uw.RECREATE,staysOnTheGround:elevationAlignmentUtils.uw.NONE,onTheGroundChanged:elevationAlignmentUtils.uw.RECREATE};const Graphics3DWaterSymbolLayer_W=(0,vec2f64.vt)(),Graphics3DWaterSymbolLayer_z=(0,aaBoundingRect.vt)(),Graphics3DWaterSymbolLayer_V=(0,vec2f64.vt)(),Graphics3DWaterSymbolLayer_k=(0,aaBoundingBox.vt)();class Graphics3DWaterSymbolLayer_N extends g{constructor(e,t,r,o){super(e,r,o),this.uvCoords=t}}class Graphics3DWaterSymbolLayer_H extends g{constructor(e,t,r,o){super(e,r,o),this.uvCoords=t}}function Graphics3DSymbolLayerFactory_c(o,e,t,i){const m=Graphics3DSymbolLayerFactory_h[o.type]?.[e.type]||Graphics3DSymbolLayerFactory_l[e.type];return m?new m(o,e,t,i):(Logger.A.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const Graphics3DSymbolLayerFactory_l={icon:le,object:Graphics3DObjectSymbolLayer_me,line:V,path:Graphics3DPathSymbolLayer_re,fill:Graphics3DPolygonFillSymbolLayer_N,extrude:ot,text:Graphics3DTextSymbolLayer_W,water:Graphics3DWaterSymbolLayer_B};const Graphics3DSymbolLayerFactory_h={"mesh-3d":{fill:Ie}}},"./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{H:()=>f,W:()=>n});var _core_libs_gl_matrix_2_factories_vec2f64_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/vec2f64.js"),_PositionAttribute_glsl_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl.js"),_shaderModules_Float2PassUniform_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Float2PassUniform.js"),_shaderModules_Float3PassUniform_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Float3PassUniform.js"),_shaderModules_Float4sPassUniform_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Float4sPassUniform.js"),_shaderModules_FloatsPassUniform_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/FloatsPassUniform.js"),_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/glsl.js"),_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/VertexAttribute.js"),_materials_VisualVariablePassParameters_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/materials/VisualVariablePassParameters.js");const p=8;function f(e,c){const f=_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_7__.r.FEATUREVALUE;e.attributes.add(f,"vec4");const n=e.vertex;n.code.add(_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_6__.H`
  bool isCapVertex() {
    return ${f}.w == 1.0;
  }
  `),n.uniforms.add(new _shaderModules_Float2PassUniform_js__WEBPACK_IMPORTED_MODULE_2__.G("size",(e=>e.size))),c.vvSize?(n.uniforms.add(new _shaderModules_Float3PassUniform_js__WEBPACK_IMPORTED_MODULE_3__.t("vvSizeMinSize",(e=>e.vvSize.minSize)),new _shaderModules_Float3PassUniform_js__WEBPACK_IMPORTED_MODULE_3__.t("vvSizeMaxSize",(e=>e.vvSize.maxSize)),new _shaderModules_Float3PassUniform_js__WEBPACK_IMPORTED_MODULE_3__.t("vvSizeOffset",(e=>e.vvSize.offset)),new _shaderModules_Float3PassUniform_js__WEBPACK_IMPORTED_MODULE_3__.t("vvSizeFactor",(e=>e.vvSize.factor))),n.code.add(_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_6__.H`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${f}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):n.code.add(_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_6__.H`vec2 getSize(){
return size;
}`),c.vvOpacity?(n.constants.add("vvOpacityNumber","int",p),n.uniforms.add(new _shaderModules_FloatsPassUniform_js__WEBPACK_IMPORTED_MODULE_5__.x("vvOpacityValues",(e=>e.vvOpacity.values),p),new _shaderModules_FloatsPassUniform_js__WEBPACK_IMPORTED_MODULE_5__.x("vvOpacityOpacities",(e=>e.vvOpacity.opacityValues),p)),n.code.add(_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_6__.H`
    vec4 applyOpacity(vec4 color) {
      float value = ${f}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):n.code.add(_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_6__.H`vec4 applyOpacity(vec4 color){
return color;
}`),c.vvColor?(n.constants.add("vvColorNumber","int",_materials_VisualVariablePassParameters_js__WEBPACK_IMPORTED_MODULE_8__.p),n.uniforms.add(new _shaderModules_FloatsPassUniform_js__WEBPACK_IMPORTED_MODULE_5__.x("vvColorValues",(e=>e.vvColor.values),_materials_VisualVariablePassParameters_js__WEBPACK_IMPORTED_MODULE_8__.p),new _shaderModules_Float4sPassUniform_js__WEBPACK_IMPORTED_MODULE_4__.F("vvColorColors",(e=>e.vvColor.colors),_materials_VisualVariablePassParameters_js__WEBPACK_IMPORTED_MODULE_8__.p)),n.code.add(_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_6__.H`
    vec4 getColor() {
      float value = ${f}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):n.code.add(_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_6__.H`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),e.include(_PositionAttribute_glsl_js__WEBPACK_IMPORTED_MODULE_1__.I),e.attributes.add(_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_7__.r.PROFILERIGHT,"vec4"),e.attributes.add(_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_7__.r.PROFILEUP,"vec4"),e.attributes.add(_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_7__.r.PROFILEVERTEXANDNORMAL,"vec4"),n.code.add(_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_6__.H`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),n.code.add(_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_6__.H`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),n.code.add(_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_6__.H`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),n.code.add(_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_6__.H`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}class n extends _materials_VisualVariablePassParameters_js__WEBPACK_IMPORTED_MODULE_8__.S{constructor(){super(...arguments),this.size=(0,_core_libs_gl_matrix_2_factories_vec2f64_js__WEBPACK_IMPORTED_MODULE_0__.fA)(1,1)}}},"./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{n:()=>r});var _shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/glsl.js");function r(r,c){c.spherical?r.vertex.code.add(_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_0__.H`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):r.vertex.code.add(_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_0__.H`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),c.spherical?r.vertex.code.add(_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_0__.H`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):r.vertex.code.add(_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_0__.H`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}},"./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{V:()=>u});var _core_libs_gl_matrix_2_math_vec2_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/math/vec2.js"),_core_libs_gl_matrix_2_factories_vec2f64_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/vec2f64.js"),_chunks_vec42_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec42.js"),_core_libs_gl_matrix_2_factories_vec4f64_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/vec4f64.js"),_FoamRendering_glsl_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/FoamRendering.glsl.js"),_shaderModules_Float2PassUniform_js__WEBPACK_IMPORTED_MODULE_6__=(__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl.js"),__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Float2PassUniform.js")),_shaderModules_Float4PassUniform_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Float4PassUniform.js"),_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/glsl.js"),_shaderModules_Texture2DPassUniform_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform.js");function u(t){t.fragment.uniforms.add(new _shaderModules_Texture2DPassUniform_js__WEBPACK_IMPORTED_MODULE_9__.N("texWaveNormal",(e=>e.waveNormal)),new _shaderModules_Texture2DPassUniform_js__WEBPACK_IMPORTED_MODULE_9__.N("texWavePerturbation",(e=>e.wavePerturbation)),new _shaderModules_Float4PassUniform_js__WEBPACK_IMPORTED_MODULE_7__.E("waveParams",(e=>(0,_chunks_vec42_js__WEBPACK_IMPORTED_MODULE_2__.s)(c,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset))),new _shaderModules_Float2PassUniform_js__WEBPACK_IMPORTED_MODULE_6__.G("waveDirection",(t=>(0,_core_libs_gl_matrix_2_math_vec2_js__WEBPACK_IMPORTED_MODULE_0__.hZ)(n,t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity)))),t.include(_FoamRendering_glsl_js__WEBPACK_IMPORTED_MODULE_4__.z),t.fragment.code.add(_shaderModules_glsl_js__WEBPACK_IMPORTED_MODULE_8__.H`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const c=(0,_core_libs_gl_matrix_2_factories_vec4f64_js__WEBPACK_IMPORTED_MODULE_3__.vt)(),n=(0,_core_libs_gl_matrix_2_factories_vec2f64_js__WEBPACK_IMPORTED_MODULE_1__.vt)()},"./node_modules/@arcgis/core/views/3d/webgl-engine/lib/Normals.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{aT:()=>s,fA:()=>e});var _core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/mathUtils.js");__webpack_require__("./node_modules/@arcgis/core/chunks/vec32.js"),__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/vec3f64.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/support/FloatArray.js");function s(t,n,r,o,a,s=2){const e=1/(Math.abs(r)+Math.abs(o)+Math.abs(a)),c=r*e,f=o*e,h=a<=0?(c>=0?1:-1)*(1-Math.abs(f)):c,u=a<=0?(f>=0?1:-1)*(1-Math.abs(c)):f,l=n*s;t[l]=i(h),t[l+1]=i(u)}function e(t){const n=t.length/3,r=new Int16Array(2*n);let o=0;for(let a=0;a<n;++a)s(r,a,t[o++],t[o++],t[o++]);return r}function i(n){return(0,_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__.qE)(Math.round(32767*n),-32767,32767)}},"./node_modules/@arcgis/core/views/3d/webgl-engine/materials/PatternStyle.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{var a;__webpack_require__.d(__webpack_exports__,{O:()=>a}),function(a){a[a.Horizontal=0]="Horizontal",a[a.Vertical=1]="Vertical",a[a.Cross=2]="Cross",a[a.ForwardDiagonal=3]="ForwardDiagonal",a[a.BackwardDiagonal=4]="BackwardDiagonal",a[a.DiagonalCross=5]="DiagonalCross",a[a.COUNT=6]="COUNT"}(a||(a={}))}}]);
//# sourceMappingURL=2641.660f5605.iframe.bundle.js.map