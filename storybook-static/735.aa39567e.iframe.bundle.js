"use strict";(self.webpackChunk_defra_flood_map=self.webpackChunk_defra_flood_map||[]).push([[735],{"./node_modules/@arcgis/core/chunks/vec2.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{a:()=>n,f:()=>l,n:()=>o});var _core_typedArrayUtil_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/typedArrayUtil.js");function o(e,t){n(e.typedBuffer,t.typedBuffer,e.typedBufferStride,t.typedBufferStride)}function n(o,n,l=2,u=l){const i=n.length/2;let a=0,d=0;if(!(0,_core_typedArrayUtil_js__WEBPACK_IMPORTED_MODULE_0__.iu)(n)||(0,_core_typedArrayUtil_js__WEBPACK_IMPORTED_MODULE_0__.dk)(n)){for(let e=0;e<i;++e)o[a]=n[d],o[a+1]=n[d+1],a+=l,d+=u;return}const c=(0,_core_typedArrayUtil_js__WEBPACK_IMPORTED_MODULE_0__.a3)(n);if((0,_core_typedArrayUtil_js__WEBPACK_IMPORTED_MODULE_0__.JI)(n))for(let e=0;e<i;++e)o[a]=Math.max(n[d]/c,-1),o[a+1]=Math.max(n[d+1]/c,-1),a+=l,d+=u;else for(let e=0;e<i;++e)o[a]=n[d]/c,o[a+1]=n[d+1]/c,a+=l,d+=u}function l(e,t,r,f){const o=e.typedBuffer,n=e.typedBufferStride,l=f?.count??e.count;let u=(f?.dstIndex??0)*n;for(let i=0;i<l;++i)o[u]=t,o[u+1]=r,u+=n}Object.freeze(Object.defineProperty({__proto__:null,fill:l,normalizeIntegerBuffer:n,normalizeIntegerBufferView:o},Symbol.toStringTag,{value:"Module"}))},"./node_modules/@arcgis/core/core/devEnvironmentUtils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function c(c){return c=c||globalThis.location.hostname,i.some((a=>null!=c?.match(a)))}function a(c,a){return c?(a=a||globalThis.location.hostname)?null!=a.match(t)||null!=a.match(s)?c.replace("static.arcgis.com","staticdev.arcgis.com"):null!=a.match(o)||null!=a.match(l)?c.replace("static.arcgis.com","staticqa.arcgis.com"):c:c:null}__webpack_require__.d(__webpack_exports__,{EM:()=>a,b5:()=>c});const t=/^devext\.arcgis\.com$/,o=/^qaext\.arcgis\.com$/,s=/^[\w-]*\.mapsdevext\.arcgis\.com$/,l=/^[\w-]*\.mapsqa\.arcgis\.com$/,i=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local\.esri\.com$/,t,o,/^jsapps\.esri\.com$/,s,l]},"./node_modules/@arcgis/core/views/3d/glTF/DefaultLoadingContext.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{R:()=>n});var _request_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/request.js"),_core_asyncUtils_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/asyncUtils.js"),_core_Error_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/core/urlUtils.js");class n{constructor(r){this._streamDataRequester=r}async loadJSON(r,e){return this._load("json",r,e)}async loadBinary(r,e){return(0,_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_4__.DB)(r)?((0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_3__.Te)(e),(0,_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_4__.lJ)(r)):this._load("binary",r,e)}async loadImage(r,e){return this._load("image",r,e)}async _load(a,s,i){if(null==this._streamDataRequester)return(await(0,_request_js__WEBPACK_IMPORTED_MODULE_0__.A)(s,{responseType:m[a]})).data;const n=await(0,_core_asyncUtils_js__WEBPACK_IMPORTED_MODULE_1__.Ke)(this._streamDataRequester.request(s,a,i));if(!0===n.ok)return n.value;throw(0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_3__.QP)(n.error),new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.A("glt-loader-request-error",`Request for resource failed: ${n.error}`)}}const m={image:"image",binary:"array-buffer",json:"json","image+type":void 0}},"./node_modules/@arcgis/core/views/3d/glTF/internal/TextureTransformUtils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{G:()=>s});var _core_libs_gl_matrix_2_factories_mat3f64_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/mat3f64.js"),_core_libs_gl_matrix_2_factories_vec2f32_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/vec2f32.js"),_core_libs_gl_matrix_2_math_mat3_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/math/mat3.js");function s(s){if(null==s)return null;const a=null!=s.offset?s.offset:_core_libs_gl_matrix_2_factories_vec2f32_js__WEBPACK_IMPORTED_MODULE_1__.uY,n=null!=s.rotation?s.rotation:0,e=null!=s.scale?s.scale:_core_libs_gl_matrix_2_factories_vec2f32_js__WEBPACK_IMPORTED_MODULE_1__.Un,f=(0,_core_libs_gl_matrix_2_factories_mat3f64_js__WEBPACK_IMPORTED_MODULE_0__.fA)(1,0,0,0,1,0,a[0],a[1],1),c=(0,_core_libs_gl_matrix_2_factories_mat3f64_js__WEBPACK_IMPORTED_MODULE_0__.fA)(Math.cos(n),-Math.sin(n),0,Math.sin(n),Math.cos(n),0,0,0,1),m=(0,_core_libs_gl_matrix_2_factories_mat3f64_js__WEBPACK_IMPORTED_MODULE_0__.fA)(e[0],0,0,0,e[1],0,0,0,1),u=(0,_core_libs_gl_matrix_2_factories_mat3f64_js__WEBPACK_IMPORTED_MODULE_0__.vt)();return(0,_core_libs_gl_matrix_2_math_mat3_js__WEBPACK_IMPORTED_MODULE_2__.lw)(u,c,m),(0,_core_libs_gl_matrix_2_math_mat3_js__WEBPACK_IMPORTED_MODULE_2__.lw)(u,f,u),u}},"./node_modules/@arcgis/core/views/3d/glTF/internal/indexUtils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{x:()=>o});var _core_typedArrayUtil_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/typedArrayUtil.js"),_geometry_support_Indices_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/Indices.js"),_webgl_enums_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/views/webgl/enums.js");function o(r,t){switch(t){case _webgl_enums_js__WEBPACK_IMPORTED_MODULE_2__.WR.TRIANGLES:return function f(e){return"number"==typeof e?(0,_geometry_support_Indices_js__WEBPACK_IMPORTED_MODULE_1__.tM)(e):(0,_core_typedArrayUtil_js__WEBPACK_IMPORTED_MODULE_0__.mg)(e)?new Uint16Array(e):e}(r);case _webgl_enums_js__WEBPACK_IMPORTED_MODULE_2__.WR.TRIANGLE_STRIP:return function u(r){const t="number"==typeof r?r:r.length;if(t<3)return[];const n=t-2,o=(0,_geometry_support_Indices_js__WEBPACK_IMPORTED_MODULE_1__.my)(3*n);if("number"==typeof r){let r=0;for(let t=0;t<n;t+=1)t%2==0?(o[r++]=t,o[r++]=t+1,o[r++]=t+2):(o[r++]=t+1,o[r++]=t,o[r++]=t+2)}else{let t=0;for(let e=0;e<n;e+=1)e%2==0?(o[t++]=r[e],o[t++]=r[e+1],o[t++]=r[e+2]):(o[t++]=r[e+1],o[t++]=r[e],o[t++]=r[e+2])}return o}(r);case _webgl_enums_js__WEBPACK_IMPORTED_MODULE_2__.WR.TRIANGLE_FAN:return function i(r){const t="number"==typeof r?r:r.length;if(t<3)return new Uint16Array(0);const e=t-2,n=e<=65536?new Uint16Array(3*e):new Uint32Array(3*e);if("number"==typeof r){let r=0;for(let t=0;t<e;++t)n[r++]=0,n[r++]=t+1,n[r++]=t+2;return n}const o=r[0];let f=r[1],u=0;for(let i=0;i<e;++i){const t=r[i+2];n[u++]=o,n[u++]=f,n[u++]=t,f=t}return n}(r)}}},"./node_modules/@arcgis/core/views/3d/glTF/internal/resourceUtils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{KB:()=>r,Xi:()=>t,pn:()=>o,x3:()=>n});var _core_has_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/has.js"),_webgl_engine_lib_basicInterfaces_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/basicInterfaces.js");class t{constructor(t){this.data=t,this.type="encoded-mesh-texture",this.encoding=_webgl_engine_lib_basicInterfaces_js__WEBPACK_IMPORTED_MODULE_1__.JS.KTX2_ENCODING}}function n(e){return"encoded-mesh-texture"===e?.type}async function r(e){const t=new Blob([e]),n=await t.text();return JSON.parse(n)}async function o(n,r){if(r===_webgl_engine_lib_basicInterfaces_js__WEBPACK_IMPORTED_MODULE_1__.JS.KTX2_ENCODING)return new t(n);const o=new Blob([n],{type:r});let c=URL.createObjectURL(o);switch(r){case"image/jpeg":c+="#.jpg";break;case"image/png":c+="#.png"}const s=new Image;if((0,_core_has_js__WEBPACK_IMPORTED_MODULE_0__.A)("esri-iPhone"))return new Promise(((e,t)=>{const n=()=>{o(),e(s)},r=e=>{o(),t(e)},o=()=>{URL.revokeObjectURL(c),s.removeEventListener("load",n),s.removeEventListener("error",r)};s.addEventListener("load",n),s.addEventListener("error",r),s.src=c}));try{s.src=c,await s.decode()}catch(a){console.warn("Failed decoding HTMLImageElement")}return URL.revokeObjectURL(c),s}},"./node_modules/@arcgis/core/views/3d/layers/graphics/objectResourceUtils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{fetch:()=>Y});var colorUtils=__webpack_require__("./node_modules/@arcgis/core/colorUtils.js"),devEnvironmentUtils=__webpack_require__("./node_modules/@arcgis/core/core/devEnvironmentUtils.js"),mathUtils=__webpack_require__("./node_modules/@arcgis/core/core/mathUtils.js"),mat3=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/math/mat3.js"),mat3f64=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/mat3f64.js"),mat4=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/math/mat4.js"),mat4f64=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/mat4f64.js"),vec2f64=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/vec2f64.js"),vec32=__webpack_require__("./node_modules/@arcgis/core/chunks/vec32.js"),vec3f64=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/vec3f64.js"),aaBoundingBox=__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingBox.js"),FloatArray=__webpack_require__("./node_modules/@arcgis/core/geometry/support/FloatArray.js"),BufferView=__webpack_require__("./node_modules/@arcgis/core/geometry/support/buffer/BufferView.js"),vec3=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3.js"),vec4=__webpack_require__("./node_modules/@arcgis/core/chunks/vec4.js"),vec2=__webpack_require__("./node_modules/@arcgis/core/chunks/vec2.js"),DefaultLoadingContext=__webpack_require__("./node_modules/@arcgis/core/views/3d/glTF/DefaultLoadingContext.js"),indexUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/glTF/internal/indexUtils.js"),resourceUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/glTF/internal/resourceUtils.js"),TextureTransformUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/glTF/internal/TextureTransformUtils.js");class s{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}}class ProcessedObjectResource_t{constructor(t,e,r){this.name=t,this.lodThreshold=e,this.pivotOffset=r,this.stageResources=new s,this.numberOfVertices=0}}var request=__webpack_require__("./node_modules/@arcgis/core/request.js"),asyncUtils=__webpack_require__("./node_modules/@arcgis/core/core/asyncUtils.js"),Error=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),Logger=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),memoryEstimations=__webpack_require__("./node_modules/@arcgis/core/core/memoryEstimations.js"),NestedMap=__webpack_require__("./node_modules/@arcgis/core/core/NestedMap.js"),promiseUtils=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),Version=__webpack_require__("./node_modules/@arcgis/core/core/Version.js"),Indices=__webpack_require__("./node_modules/@arcgis/core/geometry/support/Indices.js"),requestImageUtils=__webpack_require__("./node_modules/@arcgis/core/support/requestImageUtils.js"),Attribute=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/Attribute.js"),basicInterfaces=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/basicInterfaces.js"),Geometry=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/Geometry.js"),Texture=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/Texture.js"),VertexAttribute=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/VertexAttribute.js"),DefaultMaterial=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/materials/DefaultMaterial.js"),enums=__webpack_require__("./node_modules/@arcgis/core/views/webgl/enums.js");const v=()=>Logger.A.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");class A{constructor(e,t,r){this.resource=e,this.textures=t,this.cachedMemory=r}}async function j(e,t){const r=await async function I(r,n){const s=n?.streamDataRequester;if(s)return async function P(e,r,n){const s=await(0,asyncUtils.Ke)(r.request(e,"json",n));if(!0===s.ok)return s.value;(0,promiseUtils.QP)(s.error),M(s.error.details.url)}(r,s,n);const o=await(0,asyncUtils.Ke)((0,request.A)(r,n));if(!0===o.ok)return o.value.data;(0,promiseUtils.QP)(o.error),M(o.error)}(e,t),n=await async function T(e,t){const r=new Array;for(const o in e){const n=e[o],s=n.images[0].data;if(!s){v().warn("Externally referenced texture data is not yet supported");continue}const a=n.encoding+";base64,"+s,i="/textureDefinitions/"+o,l="rgba"===n.channels?n.alphaChannelUsage||"transparency":"none",u={noUnpackFlip:!0,wrap:{s:enums.pF.REPEAT,t:enums.pF.REPEAT},preMultiplyAlpha:k(l)!==basicInterfaces.sf.Opaque},c=t?.disableTextures?Promise.resolve(null):(0,requestImageUtils.D)(a,t);r.push(c.then((e=>({refId:i,image:e,parameters:u,alphaChannelUsage:l}))))}const n=await Promise.all(r),s={};for(const o of n)s[o.refId]=o;return s}(r.textureDefinitions??{},t);let o=0;for(const s in n)if(n.hasOwnProperty(s)){const e=n[s];o+=e?.image?e.image.width*e.image.height*4:0}return new A(r,n,o+(0,memoryEstimations.Qh)(r))}function M(e){throw new Error.A("",`Request for object resource failed: ${e}`)}function U(e){const t=e.params,r=t.topology;let n=!0;switch(t.vertexAttributes||(v().warn("Geometry must specify vertex attributes"),n=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const e=t.faces;if(e){if(t.vertexAttributes)for(const r in t.vertexAttributes){const t=e[r];t?.values?(null!=t.valueType&&"UInt32"!==t.valueType&&(v().warn(`Unsupported indexed geometry indices type '${t.valueType}', only UInt32 is currently supported`),n=!1),null!=t.valuesPerElement&&1!==t.valuesPerElement&&(v().warn(`Unsupported indexed geometry values per element '${t.valuesPerElement}', only 1 is currently supported`),n=!1)):(v().warn(`Indexed geometry does not specify face indices for '${r}' attribute`),n=!1)}}else v().warn("Indexed geometries must specify faces"),n=!1;break}default:v().warn(`Unsupported topology '${r}'`),n=!1}e.params.material||(v().warn("Geometry requires material"),n=!1);const s=e.params.vertexAttributes;for(const o in s)s[o].values||(v().warn("Geometries with externally defined attributes are not yet supported"),n=!1);return n}function O(e){const t=(0,aaBoundingBox.Ie)();return e.forEach((e=>{const r=e.boundingInfo;null!=r&&((0,aaBoundingBox.iT)(t,r.bbMin),(0,aaBoundingBox.iT)(t,r.bbMax))})),t}function k(e){switch(e){case"mask":return basicInterfaces.sf.Mask;case"maskAndTransparency":return basicInterfaces.sf.MaskBlend;case"none":return basicInterfaces.sf.Opaque;default:return basicInterfaces.sf.Blend}}function q(e){const t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}const R=new Version.R(1,2,"wosr");var NormalAttribute_glsl=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl.js"),pbrUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/materials/pbrUtils.js");async function Y(e,t){const o=function Z(e){const r=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return r?{fileType:"gltf",url:r[1],specifiedLodIndex:null!=r[4]?Number(r[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}((0,devEnvironmentUtils.EM)(e));if("wosr"===o.fileType){const e=await(t.cache?t.cache.loadWOSR(o.url,t):j(o.url,t)),{engineResources:r,referenceBoundingBox:s}=function E(e,t){const r=new Array,n=new Array,s=new Array,a=new NestedMap.O,u=e.resource,c=Version.R.parse(u.version||"1.0","wosr");R.validate(c);const p=u.model.name,g=u.model.geometries,x=u.materialDefinitions??{},v=e.textures;let A=0;const j=new Map;for(let o=0;o<g.length;o++){const e=g[o];if(!U(e))continue;const i=q(e),u=e.params.vertexAttributes,c=[],p=t=>{if("PerAttributeArray"===e.params.topology)return null;const r=e.params.faces;for(const e in r)if(e===t)return r[e].values;return null},I=u[VertexAttribute.r.POSITION],P=I.values.length/I.valuesPerElement;for(const t in u){const e=u[t],r=e.values,n=p(t)??(0,Indices.tM)(P);c.push([t,new Attribute.n(r,n,e.valuesPerElement,!0)])}const M=i.texture,E=v&&v[M];if(E&&!j.has(M)){const{image:e,parameters:t}=E,r=new Texture.g(e,t);n.push(r),j.set(M,r)}const O=j.get(M),T=O?O.id:void 0,R=i.material;let B=a.get(R,M);if(null==B){const e=x[R.slice(R.lastIndexOf("/")+1)].params;1===e.transparency&&(e.transparency=0);const r=E&&E.alphaChannelUsage,n=e.transparency>0||"transparency"===r||"maskAndTransparency"===r,s=E?k(E.alphaChannelUsage):void 0,o={ambient:(0,vec3f64.ci)(e.diffuse),diffuse:(0,vec3f64.ci)(e.diffuse),opacity:1-(e.transparency||0),transparent:n,textureAlphaMode:s,textureAlphaCutoff:.33,textureId:T,doubleSided:!0,cullFace:basicInterfaces.s2.None,colorMixMode:e.externalColorMixMode||"tint",textureAlphaPremultiplied:E?.parameters.preMultiplyAlpha??!1};t?.materialParameters&&Object.assign(o,t.materialParameters),B=new DefaultMaterial.$U(o,t),a.set(R,M,B)}s.push(B);const C=new Geometry.V(B,c);A+=c.find((e=>e[0]===VertexAttribute.r.POSITION))?.[1]?.indices.length??0,r.push(C)}return{engineResources:[{name:p,stageResources:{textures:n,materials:s,geometries:r},pivotOffset:u.model.pivotOffset,numberOfVertices:A,lodThreshold:null}],referenceBoundingBox:O(r)}}(e,t);return{lods:r,referenceBoundingBox:s,isEsriSymbolResource:!1,isWosr:!0}}let s;if(t.cache)s=await t.cache.loadGLTF(o.url,t,!!t.usePBR);else{const{loadGLTF:e}=await __webpack_require__.e(6562).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/views/3d/glTF/loader.js"));s=await e(new DefaultLoadingContext.R(t.streamDataRequester),o.url,t,t.usePBR)}const i=s.model.meta?.ESRI_proxyEllipsoid,n=s.meta.isEsriSymbolResource&&null!=i&&"EsriRealisticTreesStyle"===s.meta.ESRI_webstyle;n&&!s.customMeta.esriTreeRendering&&(s.customMeta.esriTreeRendering=!0,function ie(r,t){for(let o=0;o<r.model.lods.length;++o){const s=r.model.lods[o];for(const i of s.parts){const s=i.attributes.normal;if(null==s)return;const a=i.attributes.position,x=a.count,T=(0,vec3f64.vt)(),b=(0,vec3f64.vt)(),y=(0,vec3f64.vt)(),w=new Float32Array(4*x),v=new Float32Array(3*x),j=(0,mat4.B8)((0,mat4f64.vt)(),i.transform);let B=0,S=0;for(let n=0;n<x;n++){a.getVec(n,b),s.getVec(n,T),(0,vec32.t)(b,b,i.transform),(0,vec32.d)(y,b,t.center),(0,vec32.E)(y,y,t.radius);const l=y[2],g=(0,vec32.l)(y),x=Math.min(.45+.55*g*g,1)**colorUtils.Tf;(0,vec32.E)(y,y,t.radius),null!==j&&(0,vec32.t)(y,y,j),(0,vec32.n)(y,y),o+1!==r.model.lods.length&&r.model.lods.length>1&&(0,vec32.m)(y,y,T,l>-1?.2:Math.min(-4*l-3.8,1)),v[B]=y[0],v[B+1]=y[1],v[B+2]=y[2],B+=3,w[S]=x,w[S+1]=x,w[S+2]=x,w[S+3]=1,S+=4}i.attributes.normal=new BufferView.xs(v),i.attributes.color=new BufferView.Eq(w)}}}(s,i));const l=!!t.usePBR,a=s.meta.isEsriSymbolResource?{usePBR:l,isSchematic:!1,treeRendering:n,mrrFactors:pbrUtils.SY}:{usePBR:l,isSchematic:!1,treeRendering:!1,mrrFactors:pbrUtils.mb},u={...t.materialParameters,treeRendering:n},{engineResources:c,referenceBoundingBox:m}=function ee(e,r,t,o,s){const i=e.model,n=new Array,l=new Map,a=new Map,u=i.lods.length,c=(0,aaBoundingBox.Ie)();return i.lods.forEach(((e,m)=>{const f=!0===o.skipHighLods&&(u>1&&0===m||u>3&&1===m)||!1===o.skipHighLods&&null!=s&&m!==s;if(f&&0!==m)return;const d=new ProcessedObjectResource_t(e.name,e.lodThreshold,[0,0,0]);e.parts.forEach((e=>{const s=f?new DefaultMaterial.$U({},o):function re(r,t,o,s,i,n,l,u){const c=r.materials.get(t.material);if(null==c)return null;const{normal:m,color:f,texCoord0:d,tangent:p}=t.attributes,g=t.material+(m?"_normal":"")+(f?"_color":"")+(d?"_texCoord0":"")+(p?"_tangent":""),x=null!=t.attributes.texCoord0,T=null!=t.attributes.normal,b=function se(e){switch(e){case"BLEND":return basicInterfaces.sf.Blend;case"MASK":return basicInterfaces.sf.Mask;case"OPAQUE":case null:case void 0:return basicInterfaces.sf.Opaque}}(c.alphaMode);if(!n.has(g)){if(x){const e=(e,t=!1)=>{if(null!=e&&!l.has(e)){const o=r.textures.get(e);if(o){const r=o.data;l.set(e,new Texture.g((0,resourceUtils.x3)(r)?r.data:r,{...o.parameters,preMultiplyAlpha:!(0,resourceUtils.x3)(r)&&t,encoding:(0,resourceUtils.x3)(r)?r.encoding:void 0}))}}};e(c.colorTexture,b!==basicInterfaces.sf.Opaque),e(c.normalTexture),e(c.occlusionTexture),e(c.emissiveTexture),e(c.metallicRoughnessTexture)}const o=1/colorUtils.Tf,m=c.color[0]**o,f=c.color[1]**o,d=c.color[2]**o,p=c.emissiveFactor[0]**o,h=c.emissiveFactor[1]**o,y=c.emissiveFactor[2]**o,w=null!=c.colorTexture&&x?l.get(c.colorTexture):null,R=(0,pbrUtils.Jr)(c),v=null!=c.normalTextureTransform?.scale?c.normalTextureTransform?.scale:vec2f64.Un;n.set(g,new DefaultMaterial.$U({...s,transparent:b===basicInterfaces.sf.Blend,customDepthTest:basicInterfaces.it.Lequal,textureAlphaMode:b,textureAlphaCutoff:c.alphaCutoff,diffuse:[m,f,d],ambient:[m,f,d],opacity:c.opacity,doubleSided:c.doubleSided,doubleSidedType:"winding-order",cullFace:c.doubleSided?basicInterfaces.s2.None:basicInterfaces.s2.Back,hasVertexColors:!!t.attributes.color,hasVertexTangents:!!t.attributes.tangent,normalType:T?NormalAttribute_glsl.W.Attribute:NormalAttribute_glsl.W.ScreenDerivative,castShadows:!0,receiveShadows:c.receiveShadows,receiveAmbientOcclusion:c.receiveAmbientOcclustion,textureId:null!=w?w.id:void 0,colorMixMode:c.colorMixMode,normalTextureId:null!=c.normalTexture&&x?l.get(c.normalTexture).id:void 0,textureAlphaPremultiplied:null!=w&&!!w.parameters.preMultiplyAlpha,occlusionTextureId:null!=c.occlusionTexture&&x?l.get(c.occlusionTexture).id:void 0,emissiveTextureId:null!=c.emissiveTexture&&x?l.get(c.emissiveTexture).id:void 0,metallicRoughnessTextureId:null!=c.metallicRoughnessTexture&&x?l.get(c.metallicRoughnessTexture).id:void 0,emissiveFactor:[p,h,y],mrrFactors:R?pbrUtils.Bt:[c.metallicFactor,c.roughnessFactor,s.mrrFactors[2]],isSchematic:R,colorTextureTransformMatrix:(0,TextureTransformUtils.G)(c.colorTextureTransform),normalTextureTransformMatrix:(0,TextureTransformUtils.G)(c.normalTextureTransform),scale:[v[0],v[1]],occlusionTextureTransformMatrix:(0,TextureTransformUtils.G)(c.occlusionTextureTransform),emissiveTextureTransformMatrix:(0,TextureTransformUtils.G)(c.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:(0,TextureTransformUtils.G)(c.metallicRoughnessTextureTransform),...i},u))}const h=n.get(g);if(o.stageResources.materials.push(h),x){const e=e=>{null!=e&&o.stageResources.textures.push(l.get(e))};e(c.colorTexture),e(c.normalTexture),e(c.occlusionTexture),e(c.emissiveTexture),e(c.metallicRoughnessTexture)}return h}(i,e,d,r,t,l,a,o),{geometry:n,vertexCount:u}=function te(e,r){const i=e.attributes.position.count,n=(0,indexUtils.x)(e.indices||i,e.primitiveType),l=(0,FloatArray.oe)(3*i),{typedBuffer:a,typedBufferStride:u}=e.attributes.position;(0,vec3.t)(l,a,e.transform,3,u);const c=[[VertexAttribute.r.POSITION,new Attribute.n(l,n,3,!0)]];if(null!=e.attributes.normal){const r=(0,FloatArray.oe)(3*i),{typedBuffer:s,typedBufferStride:l}=e.attributes.normal;(0,mat3.Ge)(oe,e.transform),(0,vec3.b)(r,s,oe,3,l),(0,mathUtils.or)(oe)&&(0,vec3.n)(r,r),c.push([VertexAttribute.r.NORMAL,new Attribute.n(r,n,3,!0)])}if(null!=e.attributes.tangent){const r=(0,FloatArray.oe)(4*i),{typedBuffer:o,typedBufferStride:l}=e.attributes.tangent;(0,mat3.z0)(oe,e.transform),(0,vec4.t)(r,o,oe,4,l),(0,mathUtils.or)(oe)&&(0,vec3.n)(r,r,4),c.push([VertexAttribute.r.TANGENT,new Attribute.n(r,n,4,!0)])}if(null!=e.attributes.texCoord0){const r=(0,FloatArray.oe)(2*i),{typedBuffer:t,typedBufferStride:o}=e.attributes.texCoord0;(0,vec2.a)(r,t,2,o),c.push([VertexAttribute.r.UV0,new Attribute.n(r,n,2,!0)])}const m=e.attributes.color;if(null!=m){const r=new Uint8Array(4*i);4===m.elementCount?m instanceof BufferView.Eq?(0,vec4.b)(r,m,1,255):(m instanceof BufferView.XP||m instanceof BufferView.Uz)&&(0,vec4.b)(r,m,1/255,255):(r.fill(255),m instanceof BufferView.xs?(0,vec3.f)(r,m.typedBuffer,1,255,4,m.typedBufferStride):(e.attributes.color instanceof BufferView.eI||e.attributes.color instanceof BufferView.nS)&&(0,vec3.f)(r,m.typedBuffer,1/255,255,4,e.attributes.color.typedBufferStride)),c.push([VertexAttribute.r.COLOR,new Attribute.n(r,n,4,!0)])}return{geometry:new Geometry.V(r,c),vertexCount:i}}(e,s??new DefaultMaterial.$U({},o)),p=n.boundingInfo;null!=p&&0===m&&((0,aaBoundingBox.iT)(c,p.bbMin),(0,aaBoundingBox.iT)(c,p.bbMax)),null!=s&&(d.stageResources.geometries.push(n),d.numberOfVertices+=u)})),f||n.push(d)})),{engineResources:n,referenceBoundingBox:c}}(s,a,u,t,o.specifiedLodIndex);return{lods:c,referenceBoundingBox:m,isEsriSymbolResource:s.meta.isEsriSymbolResource,isWosr:!1}}const oe=(0,mat3f64.vt)()}}]);