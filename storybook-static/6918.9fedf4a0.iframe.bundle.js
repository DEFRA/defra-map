"use strict";(self.webpackChunk_defra_flood_map=self.webpackChunk_defra_flood_map||[]).push([[6918],{"./node_modules/@arcgis/core/geometry/support/quantizationUtils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$X:()=>D,B2:()=>a,Gy:()=>j,IE:()=>i,P5:()=>H,Q1:()=>u,QE:()=>k,SW:()=>B,Tr:()=>C,VV:()=>s,wp:()=>U});__webpack_require__("./node_modules/@arcgis/core/geometry/support/jsonUtils.js");function s(n){return n?{originPosition:"upper-left"===n.originPosition?"upperLeft":"lower-left"===n.originPosition?"lowerLeft":n.originPosition,scale:n.tolerance?[n.tolerance,n.tolerance,1,1]:[1,1,1,1],translate:null!=n.extent?[n.extent.xmin,n.extent.ymax,n.extent.zmin??0,n.extent.mmin??0]:[0,0,0,0]}:null}function u(n){if(function l(n){return"lowerLeft"===n.originPosition&&4===n.scale.length&&4===n.translate.length}(n))return n;const{originPosition:t,scale:e,translate:r}=n,o=e[0]??1,s=e[1]??1;return{originPosition:"lowerLeft",scale:[o,"lowerLeft"===t?s:-s,e[2]??1,e[3]??1],translate:[r[0]??0,r[1]??0,r[2]??0,r[3]??0]}}function i({scale:n,translate:t},e){return Math.round((e-t[0])/n[0])}function a({scale:n,translate:t},e){return Math.round((e-t[1])/n[1])}function c({scale:n,translate:t},e){return Math.round(((e??0)-t[2])/n[2])}function h({scale:n,translate:t},e){return e?Math.round((e-t[3])/n[3]):0}function f(n,t){return n&&t?M:n&&!t?g:!n&&t?x:m}const m=(n,t)=>{const e=[];if(!t.length)return null;const r=t[0];let o=i(n,r[0]),s=a(n,r[1]);e.push([o,s]);for(let l=1;l<t.length;l++){const[r,u]=t[l],c=i(n,r),h=a(n,u);c===o&&h===s||e.push([c-o,h-s]),o=c,s=h}return e},g=(n,t)=>{const e=[];if(!t.length)return null;const r=t[0];let o=i(n,r[0]),s=a(n,r[1]),l=c(n,r[2]);e.push([o,s,l]);for(let u=1;u<t.length;u++){const[r,h,f]=t[u],m=i(n,r),g=a(n,h),x=c(n,f);m===o&&g===s&&x===l||e.push([m-o,g-s,x]),o=m,s=g,l=x}return e},x=(n,t)=>{const e=[];if(!t.length)return null;const r=t[0];let o=i(n,r[0]),s=a(n,r[1]),l=h(n,r[2]);e.push([o,s,l]);for(let u=1;u<t.length;u++){const[r,c,f]=t[u],m=i(n,r),g=a(n,c),x=h(n,f);m===o&&g===s&&x===l||e.push([m-o,g-s,x]),o=m,s=g,l=x}return e},M=(n,t)=>{const e=[];if(!t.length)return null;const r=t[0];let o=i(n,r[0]),s=a(n,r[1]),l=c(n,r[2]),u=h(n,r[3]);e.push([o,s,l,u]);for(let f=1;f<t.length;f++){const[r,m,g,x]=t[f],M=i(n,r),I=a(n,m),p=c(n,g),N=h(n,x);M===o&&I===s&&p===l&&N===u||e.push([M-o,I-s,p,N]),o=M,s=I,l=p,u=N}return e};function Z({scale:n,translate:t},e){return e*n[0]+t[0]}function y({scale:n,translate:t},e){return e*n[1]+t[1]}function z({scale:n,translate:t},e){return(e??0)*n[2]+t[2]}function w({scale:n,translate:t},e){return e?e*n[3]+t[3]:0}function P(n,t){return n&&t?A:n&&!t?E:!n&&t?L:T}const T=(n,t)=>{const e=new Array(t.length);if(!t.length)return e;const r=t[0];let o=Z(n,r[0]),s=y(n,r[1]);e[0]=[o,s];const{scale:l,originPosition:u}=n,i=l[0],a="lowerLeft"===u?l[1]:-l[1];for(let c=1;c<t.length;c++){const[n,r]=t[c];o+=i*n,s+=a*r,e[c]=[o,s]}return e},E=(n,t)=>{const e=new Array(t.length);if(!t.length)return e;const r=t[0];let o=Z(n,r[0]),s=y(n,r[1]);e[0]=[o,s,z(n,r[2])];const{scale:l,originPosition:u}=n,i=l[0],a="lowerLeft"===u?l[1]:-l[1];for(let c=1;c<t.length;c++){const[r,l,u]=t[c];o+=i*r,s+=a*l,e[c]=[o,s,z(n,u)]}return e},L=(n,t)=>{const e=new Array(t.length);if(!t.length)return e;const r=t[0];let o=Z(n,r[0]),s=y(n,r[1]);e[0]=[o,s,w(n,r[2])];const{scale:l,originPosition:u}=n,i=l[0],a="lowerLeft"===u?l[1]:-l[1];for(let c=1;c<t.length;c++){const[r,l,u]=t[c];o+=i*r,s+=a*l,e[c]=[o,s,w(n,u)]}return e},A=(n,t)=>{const e=new Array(t.length);if(!t.length)return e;const r=t[0];let o=Z(n,r[0]),s=y(n,r[1]);e[0]=[o,s,z(n,r[2]),w(n,r[3])];const{scale:l,originPosition:u}=n,i=l[0],a="lowerLeft"===u?l[1]:-l[1];for(let c=1;c<t.length;c++){const[r,l,u,h]=t[c];o+=i*r,s+=a*l,e[c]=[o,s,z(n,u),w(n,h)]}return e};function b(n,t,e){const r=new Array(e.length);for(let o=0;o<e.length;o++)r[o]=t(n,e[o]);return r}function j(n,t,e){const r=u(n);return t.x=i(r,e.x),t.y=a(r,e.y),null!=e.z&&(t.z=c(r,e.z)),null!=e.m&&(t.m=h(r,e.m)),t}function U(n,t,e){const r=function p(n,t,e,r){const o=[],s=f(e,r);for(let l=0;l<t.length;l++){const e=s(n,t[l]);e&&e.length>=3&&o.push(e)}return o.length?o:null}(u(n),e.rings,e.hasZ,e.hasM);return r?(t.rings=r,t.hasZ=e.hasZ??!1,t.hasM=e.hasM??!1,t):null}function k(n,t,e){const r=function N(n,t,e,r){const o=[],s=f(e,r);for(let l=0;l<t.length;l++){const e=s(n,t[l]);e&&e.length>=2&&o.push(e)}return o.length?o:null}(u(n),e.paths,e.hasZ,e.hasM);return r?(t.paths=r,t.hasZ=e.hasZ??!1,t.hasM=e.hasM??!1,t):null}function B(n,t,e,r=e?.hasZ??!1,o=e?.hasM??!1){if(null!=e){const s=u(n);t.points=P(r,o)(s,e.points),t.hasZ=r,t.hasM=o}return t}function C(n,t,e,r=null!=e?.z,o=null!=e?.m){if(null==e)return t;const s=u(n);return t.x=Z(s,e.x),t.y=y(s,e.y),r&&(t.z=z(s,e.z)),o&&(t.m=w(s,e.m)),t}function D(n,t,e,r=e?.hasZ??!1,o=e?.hasM??!1){if(null!=e){const s=u(n);t.rings=b(s,P(r,o),e.rings),t.hasZ=r,t.hasM=o}return t}function H(n,t,e,r=e?.hasZ??!1,o=e?.hasM??!1){if(null!=e){const s=u(n);t.paths=b(s,P(r,o),e.paths),t.hasZ=r,t.hasM=o}return t}},"./node_modules/@arcgis/core/layers/graphics/featureConversionUtils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{B2:()=>N,BW:()=>C,Ch:()=>Mt,DF:()=>j,Di:()=>nt,E2:()=>ot,IE:()=>w,Nl:()=>dt,Q4:()=>bt,Rk:()=>Gt,Ux:()=>st,Ye:()=>W,ZF:()=>it,eU:()=>X,eY:()=>at,hK:()=>Ft,jH:()=>ht,jQ:()=>pt,kz:()=>mt,oN:()=>rt,q3:()=>ft,qK:()=>R,qN:()=>U,z5:()=>K,zv:()=>ut});var _core_Error_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),_core_Logger_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),_core_maybe_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingBox.js"),_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingRect.js"),_geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/jsonUtils.js"),_OptimizedFeature_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/OptimizedFeature.js"),_OptimizedFeatureSet_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/OptimizedFeatureSet.js"),_OptimizedGeometry_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/OptimizedGeometry.js");function d(t,e){return t?e?4:3:e?3:2}const m=()=>_core_Logger_js__WEBPACK_IMPORTED_MODULE_1__.A.getLogger("esri.layers.graphics.featureConversionUtils"),g={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryMultiPatch:3,esriGeometryEnvelope:0},y=(t,e,o,n,r,s)=>{t[o]=r,t[o+1]=s},p=(t,e,o,n,r,s)=>{t[o]=r,t[o+1]=s,t[o+2]=e[n+2]},I=(t,e,o,n,r,s)=>{t[o]=r,t[o+1]=s,t[o+2]=e[n+3]},M=(t,e,o,n,r,s)=>{t[o]=r,t[o+1]=s,t[o+2]=e[n+2],t[o+3]=e[n+3]};function b(t,e,o,n){if(t){if(o)return e&&n?M:p;if(e&&n)return I}else if(e&&n)return p;return y}function w({scale:t,translate:e},o){return Math.round((o-e[0])/t[0])}function N({scale:t,translate:e},o){return Math.round((e[1]-o)/t[1])}function G({scale:t,translate:e},o){return Math.round((o-e[0])/t[0])}function T({scale:t,translate:e},o){return Math.round((o-e[1])/t[1])}function x({scale:t,translate:e},o,n){return o*t[n]+e[n]}function j(t,e,o){return t?e?o?Y(t):v(t):o?k(t):Z(t):null}function Z(t){const e=t.coords;return{x:e[0],y:e[1]}}function E(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function v(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function z(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function k(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function V(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function Y(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function _(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function O(t,e){return t&&e?_:t?z:e?V:E}function U(t,e,o=O(null!=e.z,null!=e.m)){return o(t,e)}function R(t,e,o){if(null==t)return null;const n=d(e,o),r=[];for(let s=0;s<t.coords.length;s+=n){const e=[];for(let o=0;o<n;o++)e.push(t.coords[s+o]);r.push(e)}return e?o?{points:r,hasZ:e,hasM:o}:{points:r,hasZ:e}:o?{points:r,hasM:o}:{points:r}}function $(t,e,o=d(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const n=t.coords;let r=0;for(const s of e.points)for(let t=0;t<o;t++)n[r++]=s[t];return t}function C(t,e,o){if(!t)return null;const n=d(e,o),{coords:r,lengths:s}=t,u=[];let l=0;for(const c of s){const t=[];for(let e=0;e<c;e++){const e=[];for(let t=0;t<n;t++)e.push(r[l++]);t.push(e)}u.push(t)}return e?o?{paths:u,hasZ:e,hasM:o}:{paths:u,hasZ:e}:o?{paths:u,hasM:o}:{paths:u}}function H(t,e,o=d(e.hasZ,e.hasM)){const{lengths:n,coords:r}=t;let s=0;for(const u of e.paths){for(const t of u)for(let e=0;e<o;e++)r[s++]=t[e];n.push(u.length)}return t}function K(t,e,o){if(!t)return null;const n=d(e,o),{coords:r,lengths:s}=t,u=[];let l=0;for(const c of s){const t=[];for(let e=0;e<c;e++){const e=[];for(let t=0;t<n;t++)e.push(r[l++]);t.push(e)}u.push(t)}return e?o?{rings:u,hasZ:e,hasM:o}:{rings:u,hasZ:e}:o?{rings:u,hasM:o}:{rings:u}}function W(t,e,o=e.hasZ,n=e.hasM){return X(t,e.rings,o,n)}function X(t,e,o,n){const r=d(o,n),{lengths:s,coords:u}=t;let l=0;Pt(t);for(const c of e){for(const t of c)for(let e=0;e<r;e++)u[l++]=t[e];s.push(c.length)}return t}const tt=[],et=[];function ot(t,e,o,n,r){tt[0]=t;const[s]=nt(et,tt,e,o,n,r);return xt(tt),xt(et),s}function nt(e,o,n,r,s,u){if(xt(e),!n){for(const t of o){const o=u?t.attributes[u]:void 0;e.push(new _OptimizedFeature_js__WEBPACK_IMPORTED_MODULE_5__.Om(null,t.attributes,null,o))}return e}switch(n){case"esriGeometryPoint":return function S(t,e,o,n,r){const s=O(o,n);for(const{geometry:u,attributes:l}of e){const e=null!=u?s(new _OptimizedGeometry_js__WEBPACK_IMPORTED_MODULE_6__.A,u):null;t.push(new _OptimizedFeature_js__WEBPACK_IMPORTED_MODULE_5__.Om(e,l,null,r?l[r]:void 0))}return t}(e,o,r,s,u);case"esriGeometryMultipoint":return function A(t,e,o,n,r){const s=d(o,n);for(const{geometry:u,attributes:l}of e){const e=null!=u?$(new _OptimizedGeometry_js__WEBPACK_IMPORTED_MODULE_6__.A,u,s):null;t.push(new _OptimizedFeature_js__WEBPACK_IMPORTED_MODULE_5__.Om(e,l,null,r?l[r]:void 0))}return t}(e,o,r,s,u);case"esriGeometryPolyline":return function D(t,e,o,n,r){const s=d(o,n);for(const{geometry:u,attributes:l,centroid:c}of e){const e=null!=u?H(new _OptimizedGeometry_js__WEBPACK_IMPORTED_MODULE_6__.A,u,s):null,o=null!=c?U(new _OptimizedGeometry_js__WEBPACK_IMPORTED_MODULE_6__.A,c):null;t.push(new _OptimizedFeature_js__WEBPACK_IMPORTED_MODULE_5__.Om(e,l,o,r?l[r]:void 0))}return t}(e,o,r,s,u);case"esriGeometryPolygon":case"esriGeometryMultiPatch":return function Q(t,e,o,n,r){for(const{geometry:s,centroid:u,attributes:l}of e){const e=null!=s?W(new _OptimizedGeometry_js__WEBPACK_IMPORTED_MODULE_6__.A,s,o,n):null,c=r?l[r]:void 0;null!=u?t.push(new _OptimizedFeature_js__WEBPACK_IMPORTED_MODULE_5__.Om(e,l,E(new _OptimizedGeometry_js__WEBPACK_IMPORTED_MODULE_6__.A,u),c)):t.push(new _OptimizedFeature_js__WEBPACK_IMPORTED_MODULE_5__.Om(e,l,null,c))}return t}(e,o,r,s,u);default:m().error("convertToFeatureSet:unknown-geometry",new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.A(`Unable to parse unknown geometry type '${n}'`)),xt(e)}return e}function rt(t,e,o,n){et[0]=t,ct(tt,et,e,o,n);const r=tt[0];return xt(tt),xt(et),r}function st(e,o,n){if(null==e)return null;const r=new _OptimizedGeometry_js__WEBPACK_IMPORTED_MODULE_6__.A;return"hasZ"in e&&null==o&&(o=e.hasZ),"hasM"in e&&null==n&&(n=e.hasM),(0,_geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_4__.fT)(e)?O(null!=o?o:null!=e.z,null!=n?n:null!=e.m)(r,e):(0,_geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_4__.Bi)(e)?W(r,e,o,n):(0,_geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_4__.Rg)(e)?H(r,e,d(o,n)):(0,_geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_4__.U9)(e)?$(r,e,d(o,n)):void m().error("convertFromGeometry:unknown-geometry",new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.A(`Unable to parse unknown geometry type '${e}'`))}function ut(e,o,n,r){const s=e&&("coords"in e?e:e.geometry);if(null==s)return null;switch(o){case"esriGeometryPoint":{let t=Z;return n&&r?t=Y:n?t=v:r&&(t=k),t(s)}case"esriGeometryMultipoint":return R(s,n,r);case"esriGeometryPolyline":return C(s,n,r);case"esriGeometryPolygon":return K(s,n,r);default:return m().error("convertToGeometry:unknown-geometry",new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.A(`Unable to parse unknown geometry type '${o}'`)),null}}function ct(e,o,n,r,s){if(xt(e),null==n)return function lt(t,e){for(const o of e)t.push({attributes:o.attributes});return t}(e,o);switch(n){case"esriGeometryPoint":return function L(t,e,o,n){let r=Z;o&&n?r=Y:o?r=v:n&&(r=k);for(const s of e){const{geometry:e,attributes:o}=s,n=null!=e?r(e):null;t.push({attributes:o,geometry:n})}return t}(e,o,r,s);case"esriGeometryMultipoint":return function q(t,e,o,n){for(const{geometry:r,attributes:s}of e)t.push({attributes:s,geometry:null!=r?R(r,o,n):null});return t}(e,o,r,s);case"esriGeometryPolyline":return function B(t,e,o,n){for(const{geometry:r,attributes:s}of e)t.push({attributes:s,geometry:null!=r?C(r,o,n):null});return t}(e,o,r,s);case"esriGeometryPolygon":return function J(t,e,o,n){for(const{geometry:r,attributes:s,centroid:u}of e){const e=null!=r?K(r,o,n):null;if(null!=u){const o=Z(u);t.push({attributes:s,centroid:o,geometry:e})}else t.push({attributes:s,geometry:e})}return t}(e,o,r,s);default:m().error("convertToFeatureSet:unknown-geometry",new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.A(`Unable to parse unknown geometry type '${n}'`))}return e}function it(t){const{objectIdFieldName:e,spatialReference:o,transform:n,fields:r,hasM:s,hasZ:u,features:l,geometryType:c,exceededTransferLimit:i,uniqueIdField:f,queryGeometry:a,queryGeometryType:h}=t,d={features:ct([],l,c,u,s),fields:r,geometryType:c,objectIdFieldName:e,spatialReference:o,uniqueIdField:f,queryGeometry:ut(a,h,!1,!1)};return n&&(d.transform=n),i&&(d.exceededTransferLimit=i),s&&(d.hasM=s),u&&(d.hasZ=u),d}function ft(e,o){const n=new _OptimizedFeatureSet_js__WEBPACK_IMPORTED_MODULE_7__.A,{hasM:r,hasZ:s,features:u,objectIdFieldName:l,spatialReference:c,geometryType:i,exceededTransferLimit:f,transform:h,fields:d}=e;return d&&(n.fields=d),n.geometryType=i??null,n.objectIdFieldName=l??o??null,n.spatialReference=c??null,n.objectIdFieldName?(u&&nt(n.features,u,i,s,r,n.objectIdFieldName),f&&(n.exceededTransferLimit=f),r&&(n.hasM=r),s&&(n.hasZ=s),h&&(n.transform=h),n):(m().error(new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.A("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),n)}function at(t){const{transform:e,features:o,hasM:n,hasZ:r}=t;if(!e)return t;for(const s of o)null!=s.geometry&&Mt(s.geometry,s.geometry,n,r,e),null!=s.centroid&&Mt(s.centroid,s.centroid,n,r,e);return t.transform=null,t}function ht(t,e){const{geometryType:o,features:n,hasM:r,hasZ:s}=e;if(!t)return e;for(let u=0;u<n.length;u++){const e=n[u],l=e.weakClone();l.geometry=new _OptimizedGeometry_js__WEBPACK_IMPORTED_MODULE_6__.A,dt(l.geometry,e.geometry,r,s,o,t),e.centroid&&(l.centroid=new _OptimizedGeometry_js__WEBPACK_IMPORTED_MODULE_6__.A,dt(l.centroid,e.centroid,r,s,"esriGeometryPoint",t)),n[u]=l}return e.transform=t,e}function dt(t,e,o,n,r,s,u=o,l=n){if(Pt(t),!e?.coords.length)return null;const c=g[r],{coords:i,lengths:f}=e,a=d(o,n),h=d(o&&u,n&&l),m=b(o,n,u,l);if(!f.length)return m(t.coords,i,0,0,w(s,i[0]),N(s,i[1])),Pt(t,a,0),t;let y,p,I,M,G=0,T=0,F=T;for(const d of f){if(d<c)continue;let e=0;T=F,I=y=w(s,i[G]),M=p=N(s,i[G+1]),m(t.coords,i,T,G,I,M),e++,G+=a,T+=h;for(let o=1;o<d;o++,G+=a)I=w(s,i[G]),M=N(s,i[G+1]),I===y&&M===p||(m(t.coords,i,T,G,I-y,M-p),T+=h,e++,y=I,p=M);e>=c&&(t.lengths.push(e),F=T)}return xt(t.coords,F),t.coords.length?t:null}function mt(t,e,o,n,r,s,u=o,l=n){if(Pt(t),!e?.coords.length)return null;const c=g[r],{coords:i,lengths:f}=e,a=d(o,n),h=d(o&&u,n&&l),m=b(o,n,u,l);if(!f.length)return m(t.coords,i,0,0,i[0],i[1]),Pt(t,a,0),t;let y=0;const p=s*s;for(const d of f){if(d<c){y+=d*a;continue}const e=t.coords.length/h,o=y,n=y+(d-1)*a;m(t.coords,i,t.coords.length,o,i[o],i[o+1]),yt(t.coords,i,a,p,m,o,n),m(t.coords,i,t.coords.length,n,i[n],i[n+1]);const r=t.coords.length/h-e;r>=c?t.lengths.push(r):xt(t.coords,e*h),y+=d*a}return t.coords.length?t:null}function gt(t,e,o,n){const r=t[e],s=t[e+1],u=t[o],l=t[o+1],c=t[n],i=t[n+1];let f=u,a=l,h=c-f,d=i-a;if(0!==h||0!==d){const t=((r-f)*h+(s-a)*d)/(h*h+d*d);t>1?(f=c,a=i):t>0&&(f+=h*t,a+=d*t)}return h=r-f,d=s-a,h*h+d*d}function yt(t,e,o,n,r,s,u){let l,c=n,i=0;for(let f=s+o;f<u;f+=o)l=gt(e,f,s,u),l>c&&(i=f,c=l);c>n&&(i-s>o&&yt(t,e,o,n,r,s,i),r(t,e,t.length,i,e[i],e[i+1]),u-i>o&&yt(t,e,o,n,r,i,u))}function pt(t,e,o,u){if(!e?.coords?.length)return null;const l=d(o,u);let c=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,a=Number.NEGATIVE_INFINITY;if(e&&e.coords){const t=e.coords;for(let e=0;e<t.length;e+=l){const o=t[e],n=t[e+1];c=Math.min(c,o),f=Math.max(f,o),i=Math.min(i,n),a=Math.max(a,n)}}return(0,_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_2__.is)(t)?(0,_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_2__.BI)(t,c,i,f,a):(0,_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_3__.fA)(c,i,f,a,t),t}function Mt(t,e,n,r,s){const{coords:u,lengths:l}=e,c=d(n,r);if(!u.length)return t!==e&&Pt(t),t;(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_8__.Lw)(s);const{originPosition:i,scale:f,translate:a}=s,h=jt;h.originPosition=i;const m=h.scale;m[0]=f[0]??1,m[1]=-(f[1]??1),m[2]=f[2]??1,m[3]=f[3]??1;const g=h.translate;if(g[0]=a[0]??0,g[1]=a[1]??0,g[2]=a[2]??0,g[3]=a[3]??0,!l.length){for(let e=0;e<c;++e)t.coords[e]=x(h,u[e],e);return t!==e&&Pt(t,c,0),t}let y=0;for(let o=0;o<l.length;o++){const e=l[o];t.lengths[o]=e;for(let o=0;o<c;++o)t.coords[y+o]=x(h,u[y+o],o);let n=t.coords[y],r=t.coords[y+1];y+=c;for(let o=1;o<e;o++,y+=c){n+=u[y]*m[0],r+=u[y+1]*m[1],t.coords[y]=n,t.coords[y+1]=r;for(let e=2;e<c;++e)t.coords[y+e]=x(h,u[y+e],e)}}return t!==e&&Pt(t,u.length,l.length),t}function bt(t,e,o,n,r,s){if(Pt(t),t.lengths.push(...e.lengths),o===r&&n===s)for(let u=0;u<e.coords.length;u++)t.coords.push(e.coords[u]);else{const u=d(o,n),l=b(o,n,r,s),c=e.coords;for(let e=0;e<c.length;e+=u)l(t.coords,c,t.coords.length,e,c[e],c[e+1])}return t}function Nt(t,e,o,n){let r=0,s=t[n*e],u=t[n*(e+1)];for(let l=1;l<o;l++){const o=s+t[n*(e+l)],c=u+t[n*(e+l)+1],i=(o-s)*(c+u);s=o,u=c,r+=i}return.5*r}function Gt(t,e){const{coords:o,lengths:n}=t;let r=0,s=0;for(let u=0;u<n.length;u++){const t=n[u];s+=Nt(o,r,t,e),r+=t}return Math.abs(s)}function Tt(t,e,o,n){return 0==t*n-o*e&&t*o+e*n>0}function Ft(t,e,o,n,r){const s=d(n,r);if(!t.lengths.length){if(t.coords.length<2)return null;const[o,n]=t.coords,r=G(e,o),s=T(e,n);return new _OptimizedGeometry_js__WEBPACK_IMPORTED_MODULE_6__.A([],[r,s])}const u=new _OptimizedGeometry_js__WEBPACK_IMPORTED_MODULE_6__.A([],[0,0]),l=g[o],c="esriGeometryPolygon"===o||"esriGeometryPolyline"===o;let i=0,f=0;for(let a=0;a<t.lengths.length;a++){const o=t.lengths[a],n=f;let r=G(e,t.coords[s*i]),h=T(e,t.coords[s*i+1]);u.coords[f++]=r,u.coords[f++]=h;let d=0,m=0,g=1;for(let l=1;l<o;l++){const o=G(e,t.coords[s*(l+i)]),n=T(e,t.coords[s*(l+i)+1]);if(o!==r||n!==h){const t=o-r,e=n-h;c&&Tt(d,m,t,e)?(u.coords[f-2]+=t,u.coords[f-1]+=e,r+=t,h+=e):(u.coords[f++]=o,u.coords[f++]=n,r=o,h=n,d=t,m=e,g+=1)}}g<l?f=n:u.lengths.push(g),i+=o}return 0===u.lengths.length?null:u}function Pt(t,e=0,o=0){xt(t.lengths,o),xt(t.coords,e)}function xt(t,e=0){t.length!==e&&(t.length=e)}const jt={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]}},"./node_modules/@arcgis/core/rest/query/executeQueryPBF.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{S:()=>executeQueryPBF_n});var utils=__webpack_require__("./node_modules/@arcgis/core/rest/utils.js"),maybe=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),zscale=__webpack_require__("./node_modules/@arcgis/core/geometry/support/zscale.js"),featureConversionUtils=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/featureConversionUtils.js");function pbfJSONFeatureSet_o(e,t){return t}function i(e,t,r,s){switch(r){case 0:return u(e,t+s,0);case 1:return"lowerLeft"===e.originPosition?u(e,t+s,1):function l({translate:e,scale:t},r,s){return e[s]-r*t[s]}(e,t+s,1)}}function n(e,t,r,s){return 2===r?u(e,t,2):i(e,t,r,s)}function pbfJSONFeatureSet_a(e,t,r,s){return 2===r?0===t?0:u(e,t,3):i(e,t,r,s)}function h(e,t,r,s){return 3===r?0===t?0:u(e,t,3):n(e,t,r,s)}function u({translate:e,scale:t},r,s){return e[s]+r*t[s]}class d{constructor(e){this._options=e,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this._previousCoordinate=[0,0],this._transform=null,this._applyTransform=pbfJSONFeatureSet_o,this._lengths=[],this._currentLengthIndex=0,this._toAddInCurrentPath=0,this._vertexDimension=0,this._mValueOffset=null,this._coordinateBuffer=null,this._coordinateBufferPtr=0,this._attributesConstructor=class{}}createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(e){if(this._options.applyTransform&&(e.transform=null),this._attributesConstructor=class{},this._coordinateBuffer=null,this._lengths.length=0,!e.hasZ)return;const r=(0,zscale.N)(e.geometryType,this._options.sourceSpatialReference,e.spatialReference);if(null!=r)for(const t of e.features)r(t.geometry)}createSpatialReference(){return{}}addField(t,r){const s=t.fields;(0,maybe.Lw)(s),s.push(r);const o=s.map((e=>e.name));this._attributesConstructor=function(){for(const e of o)this[e]=null}}addFeature(e,t){e.features.push(t)}prepareFeatures(e){switch(this._transform=e.transform,this._options.applyTransform&&e.transform&&(this._applyTransform=this._deriveApplyTransform(e)),this._mValueOffset=null,this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&(this._mValueOffset=this._vertexDimension,this._vertexDimension++),e.geometryType){case"esriGeometryPoint":this.addCoordinate=(e,t,r)=>this.addCoordinatePoint(e,t,r),this.createGeometry=e=>this.createPointGeometry(e);break;case"esriGeometryPolygon":this.addCoordinate=(e,t,r)=>this._addCoordinatePolygon(e,t,r),this.createGeometry=e=>this._createPolygonGeometry(e);break;case"esriGeometryPolyline":this.addCoordinate=(e,t,r)=>this._addCoordinatePolyline(e,t,r),this.createGeometry=e=>this._createPolylineGeometry(e);break;case"esriGeometryMultipoint":this.addCoordinate=(e,t,r)=>this._addCoordinateMultipoint(e,t,r),this.createGeometry=e=>this._createMultipointGeometry(e)}}createFeature(){return this._lengths.length=0,this._currentLengthIndex=0,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0,this._coordinateBuffer=null,this._coordinateBufferPtr=0,{attributes:new this._attributesConstructor}}allocateCoordinates(){}addLength(e,t,r){0===this._lengths.length&&(this._toAddInCurrentPath=t),this._lengths.push(t)}addQueryGeometry(e,t){const{queryGeometry:o,queryGeometryType:i}=t,n=this._transform?(0,featureConversionUtils.Ch)(o.clone(),o,!1,!1,this._transform):o.clone(),a=(0,featureConversionUtils.zv)(n,i,!1,!1);e.queryGeometryType=i,e.queryGeometry={...a}}createPointGeometry(e){const t={x:0,y:0,spatialReference:e.spatialReference};return e.hasZ&&(t.z=0),e.hasM&&(t.m=0),t}addCoordinatePoint(e,t,r){const s=this._transform;switch(t=this._applyTransform(s,t,r,0),r){case 0:e.x=t;break;case 1:e.y=t;break;case 2:"z"in e?e.z=t:e.m=t;break;case 3:e.m=t}}_transformPathLikeValue(e,t){let r=0;t<=1&&(r=this._previousCoordinate[t],this._previousCoordinate[t]+=e);const s=this._transform;return null!==this._mValueOffset&&0===e&&t>0&&!(t%this._mValueOffset)?0:this._applyTransform(s,e,t,r)}_addCoordinatePolyline(e,t,r){this._dehydratedAddPointsCoordinate(e.paths,t,r)}_addCoordinatePolygon(e,t,r){this._dehydratedAddPointsCoordinate(e.rings,t,r)}_addCoordinateMultipoint(e,t,r){0===r&&e.points.push([]);const s=this._transformPathLikeValue(t,r);e.points[e.points.length-1].push(s)}_createPolygonGeometry(e){return{rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_createPolylineGeometry(e){return{paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_createMultipointGeometry(e){return{points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_dehydratedAddPointsCoordinate(e,t,r){0===r&&0==this._toAddInCurrentPath--&&(e.push([]),this._toAddInCurrentPath=this._lengths[++this._currentLengthIndex]-1,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0);const s=this._transformPathLikeValue(t,r),o=e[e.length-1];0===r&&(this._coordinateBufferPtr=0,this._coordinateBuffer=new Array(this._vertexDimension),o.push(this._coordinateBuffer)),this._coordinateBuffer[this._coordinateBufferPtr++]=s}_deriveApplyTransform(e){const{hasZ:t,hasM:r}=e;return t&&r?h:t?n:r?pbfJSONFeatureSet_a:i}}var query=__webpack_require__("./node_modules/@arcgis/core/rest/query/operations/query.js"),Query=(__webpack_require__("./node_modules/@arcgis/core/rest/support/FeatureSet.js"),__webpack_require__("./node_modules/@arcgis/core/rest/support/Query.js"));async function executeQueryPBF_n(o,s,n){const p=(0,utils.Dl)(o),i={...n},u=Query.A.from(s),m=!u.quantizationParameters,{data:f}=await(0,query.IJ)(p,u,new d({sourceSpatialReference:u.sourceSpatialReference,applyTransform:m}),i);return f}},"./node_modules/@arcgis/core/smartMapping/statistics/support/statsWorker.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{classBreaks:()=>c,heatmapStatistics:()=>z,histogram:()=>v,summaryStatistics:()=>d,uniqueValues:()=>p});var _utils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/smartMapping/statistics/support/utils.js"),_statistics_utils_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/statistics/utils.js");async function d(a){const{attribute:e,features:s}=a,{normalizationType:r,normalizationField:m,minValue:u,maxValue:f,fieldType:d,outStatisticTypes:p}=e,c=await(0,_utils_js__WEBPACK_IMPORTED_MODULE_0__.Jc)({field:e.field,valueExpression:e.valueExpression,normalizationType:r,normalizationField:m,normalizationTotal:e.normalizationTotal,viewInfoParams:e.viewInfoParams,timeZone:e.timeZone,fieldInfos:e.fieldInfos},s),v=(0,_statistics_utils_js__WEBPACK_IMPORTED_MODULE_1__.Vb)({normalizationType:r,normalizationField:m,minValue:u,maxValue:f}),z={value:.5,fieldType:d},T="esriFieldTypeString"===d?(0,_statistics_utils_js__WEBPACK_IMPORTED_MODULE_1__.z9)({values:c,supportsNullCount:v,percentileParams:z,outStatisticTypes:p}):(0,_statistics_utils_js__WEBPACK_IMPORTED_MODULE_1__.G_)({values:c,minValue:u,maxValue:f,useSampleStdDev:!r,supportsNullCount:v,percentileParams:z,outStatisticTypes:p});return(0,_statistics_utils_js__WEBPACK_IMPORTED_MODULE_1__.oZ)(T,p,"esriFieldTypeDate"===d)}async function p(a){const{attribute:e,features:n}=a,t=await(0,_utils_js__WEBPACK_IMPORTED_MODULE_0__.Jc)({field:e.field,field2:e.field2,field3:e.field3,fieldDelimiter:e.fieldDelimiter,valueExpression:e.valueExpression,viewInfoParams:e.viewInfoParams,timeZone:e.timeZone,fieldInfos:e.fieldInfos},n,!1),o=(0,_statistics_utils_js__WEBPACK_IMPORTED_MODULE_1__.b3)(t);return(0,_statistics_utils_js__WEBPACK_IMPORTED_MODULE_1__.lv)(o,e.domains,e.returnAllCodedValues,e.fieldDelimiter)}async function c(a){const{attribute:e,features:n}=a,{field:t,normalizationType:o,normalizationField:l,normalizationTotal:s,classificationMethod:r}=e,f=await(0,_utils_js__WEBPACK_IMPORTED_MODULE_0__.Jc)({field:t,valueExpression:e.valueExpression,normalizationType:o,normalizationField:l,normalizationTotal:s,viewInfoParams:e.viewInfoParams,timeZone:e.timeZone,fieldInfos:e.fieldInfos},n),d=(0,_statistics_utils_js__WEBPACK_IMPORTED_MODULE_1__.Rw)(f,{field:t,normalizationType:o,normalizationField:l,normalizationTotal:s,classificationMethod:r,standardDeviationInterval:e.standardDeviationInterval,numClasses:e.numClasses,minValue:e.minValue,maxValue:e.maxValue});return(0,_statistics_utils_js__WEBPACK_IMPORTED_MODULE_1__.jM)(d,r)}async function v(a){const{attribute:e,features:n}=a,{field:t,normalizationType:o,normalizationField:l,normalizationTotal:s,classificationMethod:r}=e,m=await(0,_utils_js__WEBPACK_IMPORTED_MODULE_0__.Jc)({field:t,valueExpression:e.valueExpression,normalizationType:o,normalizationField:l,normalizationTotal:s,viewInfoParams:e.viewInfoParams,timeZone:e.timeZone,fieldInfos:e.fieldInfos},n);return(0,_statistics_utils_js__WEBPACK_IMPORTED_MODULE_1__.$y)(m,{field:t,normalizationType:o,normalizationField:l,normalizationTotal:s,classificationMethod:r,standardDeviationInterval:e.standardDeviationInterval,numBins:e.numBins,minValue:e.minValue,maxValue:e.maxValue})}async function z(i){const{attribute:n,features:t}=i,{field:o,radius:l,transform:s,spatialReference:r}=n,m=n.size??[0,0],u=(0,_utils_js__WEBPACK_IMPORTED_MODULE_0__.$r)(t??[],s,r,m);return(0,_utils_js__WEBPACK_IMPORTED_MODULE_0__.gV)(u,l??void 0,o,m[0],m[1])}},"./node_modules/@arcgis/core/smartMapping/statistics/uniqueValues.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{default:()=>uniqueValues_p});var core_Error=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),utils=__webpack_require__("./node_modules/@arcgis/core/smartMapping/statistics/support/utils.js");var support_utils=__webpack_require__("./node_modules/@arcgis/core/smartMapping/support/utils.js"),tslib_es6=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),property=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),has=__webpack_require__("./node_modules/@arcgis/core/core/has.js"),Logger=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),subclass=(__webpack_require__("./node_modules/@arcgis/core/core/RandomLCG.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),generateRendererUtils=__webpack_require__("./node_modules/@arcgis/core/rest/support/generateRendererUtils.js"),workers=__webpack_require__("./node_modules/@arcgis/core/core/workers/workers.js");class n{constructor(){this.connection=null}async open(t){this.connection=await(0,workers.ho)("statsWorker",{strategy:"distributed",signal:t})}destroy(){this.connection?.close()}static getInstance(){return n.instance||(n.instance=new n),n.instance}async summaryStatistics(e,n){if(!this.connection)throw new core_Error.A("worker-client:summary-statistics","connection is required");return this.connection.invoke("summaryStatistics",{attribute:e,features:n})}async uniqueValues(e,n){if(!this.connection)throw new core_Error.A("worker-client:unique-values","connection is required");return this.connection.invoke("uniqueValues",{attribute:e,features:n})}async classBreaks(e,n){if(!this.connection)throw new core_Error.A("worker-client:class-breaks","connection is required");return this.connection.invoke("classBreaks",{attribute:e,features:n})}async histogram(e,n){if(!this.connection)throw new core_Error.A("worker-client:histogram","connection is required");return this.connection.invoke("histogram",{attribute:e,features:n})}async heatmapStatistics(e,n){if(!this.connection)throw new core_Error.A("worker-client:heatmap-statistics","connection is required");return this.connection.invoke("heatmapStatistics",{attribute:e,features:n})}}var Graphic=__webpack_require__("./node_modules/@arcgis/core/Graphic.js"),arrayUtils=__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),promiseUtils=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),arcgisLayerUrl=__webpack_require__("./node_modules/@arcgis/core/layers/support/arcgisLayerUrl.js"),fieldUtils=__webpack_require__("./node_modules/@arcgis/core/layers/support/fieldUtils.js"),request=__webpack_require__("./node_modules/@arcgis/core/request.js"),jsonUtils=__webpack_require__("./node_modules/@arcgis/core/renderers/support/jsonUtils.js"),rest_utils=__webpack_require__("./node_modules/@arcgis/core/rest/utils.js"),infoFor3D=__webpack_require__("./node_modules/@arcgis/core/layers/support/infoFor3D.js"),DataLayerSource=__webpack_require__("./node_modules/@arcgis/core/layers/support/source/DataLayerSource.js"),executeQueryJSON=__webpack_require__("./node_modules/@arcgis/core/rest/query/executeQueryJSON.js"),executeQueryPBF=__webpack_require__("./node_modules/@arcgis/core/rest/query/executeQueryPBF.js"),FeatureSet=__webpack_require__("./node_modules/@arcgis/core/rest/support/FeatureSet.js"),Query=__webpack_require__("./node_modules/@arcgis/core/rest/support/Query.js");async function executeQuery_f(t,o,r,e){return async function m(t,r,e,n){const s=e?.infoFor3D;if(!d(t,s)||null==s||!r.assetMaps||!r.features?.length)return FeatureSet.A.fromJSON(r);const{meshFeatureSetFromJSON:a}=await(0,promiseUtils.qr)(Promise.all([__webpack_require__.e(4718),__webpack_require__.e(7900),__webpack_require__.e(3348),__webpack_require__.e(3414)]).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/rest/support/meshFeatureSet.js")),n);return a(t,s,r)}(o,await async function c(t,o,r,e){const n={...e},i=function p(o,s){let a=Query.A.from(o);a.sourceSpatialReference=a.sourceSpatialReference??s?.sourceSpatialReference??null,(s?.gdbVersion||s?.dynamicDataSource)&&(a=a===o?a.clone():a,a.gdbVersion=o.gdbVersion||s.gdbVersion,a.dynamicDataSource=o.dynamicDataSource?DataLayerSource.L.from(o.dynamicDataSource):s.dynamicDataSource);const i=s?.infoFor3D;if(null!=i&&d(o,i)){a=a===o?a.clone():a,a.formatOf3DObjects=null;const n=(0,infoFor3D.U9)(i),s=(0,infoFor3D.CW)(i);for(const t of i.queryFormats){if(t===n){a.formatOf3DObjects=t;break}t!==s||a.formatOf3DObjects||(a.formatOf3DObjects=t)}if(!a.formatOf3DObjects)throw new core_Error.A("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(null==a.outFields||!a.outFields.includes("*")){a=a===o?a.clone():a,null==a.outFields&&(a.outFields=[]);const{originX:t,originY:r,originZ:e,translationX:n,translationY:s,translationZ:u,scaleX:f,scaleY:c,scaleZ:l,rotationX:m,rotationY:p,rotationZ:d,rotationDeg:y}=i.transformFieldRoles;a.outFields.push(t,r,e,n,s,u,f,c,l,m,p,d,y)}}return a}(o,r),u=null!=o.outStatistics?.[0],f=(0,has.A)("featurelayer-pbf-statistics"),c=!u||f;let m;if("pbf"===r?.format&&c)try{m=await(0,executeQueryPBF.S)(t,i,n)}catch(d){if("query:parsing-pbf"!==d.name)throw d;r.format="json"}return"json"!==r?.format&&c||(m=await(0,executeQueryJSON.e)(t,i,n)),function l(t,o){if(null!=t&&null!=o)for(const r of o){const o=t.get(r.name);o&&Object.assign(r,o.toJSON())}}(r?.fieldsIndex,m.fields),m}(t,o,r,e),r,e)}function d(t,o){return null!=o&&!0===t.returnGeometry&&"xyFootprint"!==t.multipatchOption&&!t.outStatistics}var StatisticDefinition=__webpack_require__("./node_modules/@arcgis/core/rest/support/StatisticDefinition.js");function o(e,t){const{field:n,checkValueRange:l,url:o}=e,u=t?.data;if(!u)return;if(!l){const e=r(u);return Promise.resolve(e)}const c=new StatisticDefinition.A({statisticType:"min",onStatisticField:n}),f=new StatisticDefinition.A({statisticType:"max",onStatisticField:n});return executeQuery_f(o,new Query.A({outStatistics:[c,f]})).then((e=>{const t=e.features[0].attributes;let n=null,i=null;for(const a in t)0===a.toLowerCase().indexOf("min")?n=t[a]:i=t[a];return r(u,n,i)}))}function r(e,n,i){if("classBreaks"===e.type){const a=(0,jsonUtils.r)(e);return{classBreaks:a.classBreakInfos.map(((e,t)=>(0===t&&null!=n&&(e.minValue=n),t===a.classBreakInfos.length-1&&null!=i&&(e.maxValue=i),{minValue:e.minValue,maxValue:e.maxValue,label:e.label}))),normalizationTotal:a.normalizationTotal}}const{uniqueValueInfos:a}=e;return{uniqueValues:a?.map(((e,t)=>(0===t&&null!=n&&(e.value=n),t===a.length-1&&null!=i&&(e.value=i),{count:e.count,value:e.value,label:e.label})))??[]}}var JSONSupport=__webpack_require__("./node_modules/@arcgis/core/core/JSONSupport.js");let t=class extends JSONSupport.A{constructor(r){super(r),this.classificationDefinition=null,this.where=null}};(0,tslib_es6._)([(0,property.MZ)({json:{name:"classificationDef",write:!0}})],t.prototype,"classificationDefinition",void 0),(0,tslib_es6._)([(0,property.MZ)({type:String,json:{write:!0}})],t.prototype,"where",void 0),t=(0,tslib_es6._)([(0,subclass.$)("esri.rest.support.GenerateRendererParameters")],t);const GenerateRendererParameters_i=t;var enumeration=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/enumeration.js");let s=class extends JSONSupport.A{constructor(t){super(t),this.type="unique-value-definition",this.attributeField=null,this.attributeField2=null,this.attributeField3=null,this.fieldDelimiter=null}get uniqueValueFields(){const t=[];return this.attributeField&&t.push(this.attributeField),this.attributeField2&&t.push(this.attributeField2),this.attributeField3&&t.push(this.attributeField3),t}};(0,tslib_es6._)([(0,enumeration.e)({uniqueValueDef:"unique-value-definition"})],s.prototype,"type",void 0),(0,tslib_es6._)([(0,property.MZ)()],s.prototype,"attributeField",void 0),(0,tslib_es6._)([(0,property.MZ)()],s.prototype,"attributeField2",void 0),(0,tslib_es6._)([(0,property.MZ)()],s.prototype,"attributeField3",void 0),(0,tslib_es6._)([(0,property.MZ)({json:{write:!0}})],s.prototype,"fieldDelimiter",void 0),(0,tslib_es6._)([(0,property.MZ)({json:{write:!0}})],s.prototype,"uniqueValueFields",null),s=(0,tslib_es6._)([(0,subclass.$)("esri.rest.support.UniqueValueDefinition")],s);const u=s;function predominanceUtils_r(e,l){const{returnFieldName:u,defaultValue:r,layer:t}=l,i=[];if(u&&r){const n=e.map((n=>`${n} <= 0`)).join(" AND ");i.push(`WHEN ${n} THEN ${r}`)}for(const o of e){const l=e.reduce(((n,a)=>(o!==a&&n.push(`${o} > ${a}`),n)),[]).join(" AND "),r=t&&(0,support_utils.R3)(t,o),s=u&&`'${o}'`?`'${o}'`:r?(0,support_utils.Ll)(o):o;i.push(`WHEN ${l} THEN ${s}`)}return`CASE ${i.join(" ")} ELSE ${r||"0"} END`}function predominanceUtils_i(n){return n&&n.map((n=>`$feature["${n}"];`)).join("\n")+"\n"||""}function predominanceUtils_o(n,a=!1){const e=n.map((n=>`"${n}"`));return`\n  var fieldNames = [ ${e.join(", ")} ];\n  var numFields = ${e.length};\n  var maxValueField = null;\n  var maxValue = -Infinity;\n  var value, i, totalValue = null;\n\n  for(i = 0; i < numFields; i++) {\n    value = $feature[fieldNames[i]];\n\n    if(value > 0) {\n      if(value > maxValue) {\n        maxValue = value;\n        maxValueField = fieldNames[i];\n      }\n      else if (value == maxValue) {\n        maxValueField = null;\n      }\n    }\n    ${a?"\n  if(value != null && value >= 0) {\n    if (totalValue == null) { totalValue = 0; }\n    totalValue = totalValue + value;\n  }\n  ":""}\n  }\n  `}function predominanceUtils_s(n){const a=predominanceUtils_o(n);return`\n  ${predominanceUtils_i(n)}\n  ${a}\n  return maxValueField;\n  `}var maybe=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),reactiveUtils=__webpack_require__("./node_modules/@arcgis/core/core/reactiveUtils.js"),quantizationUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/quantizationUtils.js"),fieldType=__webpack_require__("./node_modules/@arcgis/core/layers/support/fieldType.js"),QuantizationParameters=__webpack_require__("./node_modules/@arcgis/core/rest/support/QuantizationParameters.js"),statsWorker=__webpack_require__("./node_modules/@arcgis/core/smartMapping/statistics/support/statsWorker.js"),Loadable=__webpack_require__("./node_modules/@arcgis/core/core/Loadable.js");let LayerAdapter_p=class extends Loadable.A{constructor(o){super(o),this.adapterName="layer-adapter"}};(0,tslib_es6._)([(0,property.MZ)({readOnly:!0})],LayerAdapter_p.prototype,"adapterName",void 0),(0,tslib_es6._)([(0,property.MZ)({constructOnly:!0})],LayerAdapter_p.prototype,"layer",void 0),(0,tslib_es6._)([(0,property.MZ)()],LayerAdapter_p.prototype,"geometryType",void 0),(0,tslib_es6._)([(0,property.MZ)()],LayerAdapter_p.prototype,"objectIdField",void 0),(0,tslib_es6._)([(0,property.MZ)()],LayerAdapter_p.prototype,"supportsSQLExpression",void 0),(0,tslib_es6._)([(0,property.MZ)()],LayerAdapter_p.prototype,"hasQueryEngine",void 0),(0,tslib_es6._)([(0,property.MZ)()],LayerAdapter_p.prototype,"minScale",void 0),(0,tslib_es6._)([(0,property.MZ)()],LayerAdapter_p.prototype,"maxScale",void 0),(0,tslib_es6._)([(0,property.MZ)()],LayerAdapter_p.prototype,"fullExtent",void 0),LayerAdapter_p=(0,tslib_es6._)([(0,subclass.$)("esri.smartMapping.support.adapters.LayerAdapter")],LayerAdapter_p);const LayerAdapter_s=LayerAdapter_p;var date=__webpack_require__("./node_modules/@arcgis/core/intl/date.js"),AttributeBinsQuery=__webpack_require__("./node_modules/@arcgis/core/rest/support/AttributeBinsQuery.js"),AutoIntervalBinParameters=__webpack_require__("./node_modules/@arcgis/core/rest/support/AutoIntervalBinParameters.js"),DateBinParameters=__webpack_require__("./node_modules/@arcgis/core/rest/support/DateBinParameters.js"),FixedBoundariesBinParameters=__webpack_require__("./node_modules/@arcgis/core/rest/support/FixedBoundariesBinParameters.js"),FixedIntervalBinParameters=__webpack_require__("./node_modules/@arcgis/core/rest/support/FixedIntervalBinParameters.js"),CodedValue=__webpack_require__("./node_modules/@arcgis/core/layers/support/CodedValue.js"),CodedValueDomain=__webpack_require__("./node_modules/@arcgis/core/layers/support/CodedValueDomain.js"),Field=(__webpack_require__("./node_modules/@arcgis/core/layers/support/Domain.js"),__webpack_require__("./node_modules/@arcgis/core/layers/support/InheritedDomain.js"),__webpack_require__("./node_modules/@arcgis/core/layers/support/RangeDomain.js"),__webpack_require__("./node_modules/@arcgis/core/layers/support/Field.js")),statistics_utils=__webpack_require__("./node_modules/@arcgis/core/statistics/utils.js");const F=/_value$/i,w=Math.LOG10E,E={SECOND:1e3,MINUTE:6e4,HOUR:36e5};function T(e){return e.map((e=>e.toJSON()))}function utils_V(e,t){const n=[],l=e.layer,i="featureReduction"in l?l.featureReduction:null,o="binning"===i?.type,a=null!=i&&"fields"in i?i.fields?.map((e=>e.name?.toLowerCase())).filter(Boolean):[];if(!o||!t)return n;for(const r of t)a.includes(r.toLowerCase())||n.push(r);return n}function z(e,t,n){const l=[];if(t)for(const i of t){const t=e.getField(i);t&&n&&"availableFields"in n&&!n.availableFields?.includes(t.name)&&l.push(t.name)}return l}function utils_$(e,t){const n=e&&e.features;if(0===n?.length)return{avg:null,count:0,max:null,median:null,min:null,nullcount:0,stddev:null,sum:null,variance:null};const l=n?.[0]?.attributes,i={};for(const o in l)i[o.replace(F,"").toLowerCase()]=l[o];return null!=i.totalcount&&i.totalcount>=i.count&&(i.nullcount=i.totalcount-i.count),delete i.totalcount,i.min===i.max&&null!=i.min&&null==i.stddev&&(i.stddev=i.variance=0),t&&(["min","max","avg","stddev","sum","variance"].forEach((e=>{null!=i[e]&&(i[e]=Math.ceil(i[e]))})),i.min===i.max&&null!=i.min&&(i.avg=i.min,i.stddev=i.variance=0)),i}function j(e){const{field:t,normalizationType:n,normalizationField:l,normalizationTotal:i,layer:o}=e,a=(0,support_utils.R3)(o,t);let r=t;return"percent-of-total"===n?r=`((${a?(0,support_utils.Ll)(t):t} / ${i}) * 100)`:"log"===n?r=`(log(${t}) * ${w})`:"field"===n?r=`(${a?(0,support_utils.Ll)(t):t} / ${l})`:"natural-log"===n?r=`(log(${a?(0,support_utils.Ll)(t):t}))`:"square-root"===n&&(r=`(power(${a?(0,support_utils.Ll)(t):t}, 0.5))`),r}function q(e,t){let n;if(t=t.toLowerCase(),e)for(const l in e)if(l.toLowerCase()!==t){n=e[l];break}return n}function b(e,t){let n;if(t=t.toLowerCase(),e)for(const l in e)if(l.toLowerCase()===t){n=e[l];break}return n}function O(e,t,n,l,i){const o={},a="countOFExpr";e&&e.features&&e.features.forEach((e=>{const t=e.attributes,n=q(t,a),l=b(t,a);null!=n&&null!=l&&0!==n&&(o[n]=l)}));const r=[];return(0,statistics_utils.OR)(t,n,l).forEach(((e,t)=>{const n=(t+1).toString();r.push({minValue:e[0],maxValue:e[1],count:o.hasOwnProperty(n)?o[n]:0})})),{bins:r,minValue:t,maxValue:n,normalizationTotal:i}}async function L(e,n){const l=e&&e.features,{field:i,field2:o,field3:a,fieldDelimiter:r,layer:s,view:u,signal:c,labels:m}=n,f=`countOF${i&&o?"Expr":i||"Expr"}`,p={};let d=!1;for(const t of l){const e=t.attributes,n=b(e,f);let l=i?b(e,i):q(e,f),s=o?b(e,o):null,u=a?b(e,a):null;null===l&&0===n&&(d=!0),(null==l||"string"==typeof l&&""===l.trim())&&(l=null),o&&(null==s||"string"==typeof s&&""===s.trim())&&(s=null),a&&(null==u||"string"==typeof u&&""===u.trim())&&(u=null);let c=l;o&&(c=`${(0,statistics_utils.gJ)(c)}${r}${(0,statistics_utils.gJ)(s)}`,a&&(c=`${c}${r}${(0,statistics_utils.gJ)(u)}`)),null==p[c]?p[c]={count:n,data:c}:p[c].count=p[c].count+n}if(i&&d){const e=i+" is NULL";try{const t=await s.queryFeatureCount({whereClause:e,view:u,signal:c});return p.null.count=p.null.count+t,R(p,m)}catch{return(0,promiseUtils.Te)(c),R(p,m)}}return R(p,m)}function R(e,t){if(t)for(const n in e)e[n].label=t[n];return{count:e}}async function D(e,t,i){const o=e?i.getField(e):null,a=o?i.getFieldDomain(o.name):null;if(a)return a;const{uniqueValueInfos:r}=await i.uniqueValues({field:e,sqlWhere:t.sqlWhere,features:t.features,useFeaturesInView:t.useFeaturesInView,view:t.view,signal:t.signal}),s=r.map((e=>new CodedValue.H({code:e.value})));return new CodedValueDomain.A({codedValues:s})}async function I(e,t){if(!e.returnAllCodedValues)return[];const{field:n,field2:l,field3:i}=e;if(n&&!l){const e=n?t.getField(n):null,l=e?t.getFieldDomain(e.name):null;return l?[l]:[]}const o=[];return n&&(o.push(D(n,e,t)),l&&(o.push(D(l,e,t)),i&&o.push(D(i,e,t)))),Promise.all(o)}function M(e){return e?(0,support_utils.Ll)(["HOUR","MINUTE","SECOND"].map((t=>`(${function U(e,t){return`EXTRACT(${t} FROM ${e}) * ${E[t]}`}(e,t)})`)).join(" + ")):null}function B(e){return{viewingMode:"2d"===e.type?"map":e.viewingMode,scale:e.scale,spatialReference:e.spatialReference?.toJSON()}}function Q(e,t){const n=new Set(e.map((e=>e.value))),l=t.filter((e=>!n.has(e)));for(const i of l)e.push({value:i,count:0});e.sort(((e,n)=>t.indexOf(e.value)-t.indexOf(n.value)));for(const i of e)"no_dominant_category"===i.value&&(i.value=null);return{predominantCategoryInfos:e}}function P(t){const n="featureReduction"in t?t.featureReduction:null;return((null!=n&&"fields"in n?n.fields:null)??[]).map((e=>{const n=function W(e,t){switch(e.statisticType){case"avg":case"avg_angle":return"double";case"count":return"integer";case"min":case"max":case"sum":return e.onStatisticField?t.get(e.onStatisticField)?.type??null:e.onStatisticExpression?"string"===e.onStatisticExpression.returnType?null:"double":null;case"mode":return e.onStatisticField?t.get(e.onStatisticField)?.type??null:e.onStatisticExpression?"string"===e.onStatisticExpression.returnType?"string":"double":null;default:return null}}(e,t.fieldsIndex);return n?new Field.A({type:n,name:e.name,alias:e.alias}):null})).filter(arrayUtils.Ru)}function _(e,t){return(0,support_utils.fs)(t)?function N(e,t){return(0,support_utils.aM)(e,new Date(0),t,"milliseconds").sqlExpression}(e,t?.name):(0,fieldUtils.OH)(t)?M(t?.name):null}function k(e,t,n){const{field:l,normalizationType:i,normalizationField:o,normalizationTotal:s,minValue:f,maxValue:p,filter:d}=t,y=e.supportsSQLExpression?_(e,n)||t.sqlExpression:null,g=j({field:l,normalizationType:i,normalizationField:o,normalizationTotal:s,layer:e}),h=y||g,F=h?(0,utils.lX)(h,f,p):null,w=(0,utils.Lc)({field:l,normalizationField:o,normalizationType:i}),E=(0,utils.sf)(t.sqlWhere,w),S=(0,utils.sf)(E,F),T=(0,statistics_utils.Vb)({normalizationField:o,normalizationType:i,sqlExpression:y,supportsSQLExpression:e.supportsSQLExpression,minValue:f,maxValue:p}),V=(0,fieldUtils.yM)(e.getField(l??void 0)),{include:z,exclude:$}=t.outStatisticTypes||{},C=statistics_utils.wy.filter((e=>(!z||z.includes(e))&&(!$||!$.includes(e))&&("nullcount"===e?T:!V||"count"===e))),q=e.createQuery();return q.where=(0,utils.sf)(q.where,S),q.sqlFormat=y?"standard":null,q.outStatistics=C.map((t=>{const n=new StatisticDefinition.A;let l=null,i=null,o=`${t}_value`;if("variance"===t)l="var",i=h;else if("nullcount"===t){const t=e.objectIdField;l="count",i=t&&e.getField(t)?t:"1",o="totalcount_value"}else"median"===t?(l="percentile-continuous",i=h,n.statisticParameters={value:.5}):(l=t,i=h);return n.statisticType=l,n.onStatisticField=i,n.outStatisticFieldName=o,n})),A(q,d),q}function A(e,t){t&&(e.geometry=t.geometry,e.spatialRelationship=t.spatialRelationship)}function H(e,t){const{field:n,field2:l,field3:i,sqlExpression:o}=t,a=!(!n||!l),r=e.createQuery();return r.where=(0,utils.sf)(r.where,t.sqlWhere),r.sqlFormat=o?"standard":null,r.outStatistics=[J(a?null:n,a?"1":o)].filter(Boolean),r.groupByFieldsForStatistics=[n||o,l,i].filter(Boolean),A(r,t.filter),r}function J(e,t){const n="countOF"+(e||"Expr"),l=new StatisticDefinition.A;return l.statisticType="count",l.onStatisticField=t?"1":e,l.outStatisticFieldName=n,l}function Z(e,t,n,l=10,i,o,a){const{min:r,max:s,normTotal:u,excludeZerosExpr:c}=t,m=t.intervals||(0,statistics_utils.OR)(r,s,l),f=t.sqlExpr||n;return function G(e,t,n,l,i,o,a){const r=[],s=t.length;for(let u=0;u<s;u++){const e=(0,utils.sf)(l,(0,utils.sf)(n+" >= "+t[u][0],null!==t[u][1]?n+(u===s-1?" <= ":" < ")+t[u][1]:""));r.push(e)}return Promise.allSettled(r.map((t=>e.queryFeatureCount({whereClause:t,view:i,filter:o,signal:a}))))}(e,m,f,c,i,o,a).then((e=>({bins:e.map(((e,t)=>({minValue:m[t][0],maxValue:m[t][1],count:"fulfilled"===e.status?e.value:0}))),minValue:r,maxValue:s,normalizationTotal:u})))}function histogramUtils_I(i,e,t){const a=i.valueExpression||i.sqlExpression,r=i.signal;if(!a){const{field:a,normalizationType:o,normalizationField:l}=i,s=a?e.getField(a):null,u=(0,support_utils.fs)(s)||(0,fieldUtils.OH)(s),m={field:a,normalizationType:o,normalizationField:l,normalizationTotal:t,layer:e};return{sqlExpression:u?_(e,s):j(m),sqlWhere:u?null:i.sqlWhere||(0,utils.Lc)({field:a,normalizationType:o,normalizationField:l}),filter:i.filter,signal:r}}return{valueExpression:i.valueExpression,sqlExpression:i.sqlExpression,sqlWhere:i.sqlWhere,filter:i.filter,signal:r}}async function histogramUtils_M(i,e,n){const{field:t,normalizationType:a,normalizationField:r,signal:o}=i,l=(0,utils.Lc)({field:t,normalizationType:a,normalizationField:r}),s=new GenerateRendererParameters_i({classificationDefinition:(0,statistics_utils.al)({field:t,normalizationType:a,normalizationField:r,classificationMethod:i.classificationMethod,standardDeviationInterval:i.standardDeviationInterval,definedInterval:i.definedInterval,breakCount:i.numBins||10}),where:(0,utils.sf)(l,n)});return e.generateRenderer(s,o).then((i=>{const{normalizationTotal:n,classBreaks:o}=i;return function C(e){const t=[],n=e.classBreaks,l=n[0].minValue,i=n[n.length-1].maxValue;n.forEach((e=>{t.push([e.minValue,e.maxValue])}));const o={field:e.field,normalizationType:e.normalizationType,normalizationField:e.normalizationField,normalizationTotal:e.normalizationTotal,layer:e.layer};return{min:l,max:i,intervals:t,sqlExpr:j(o),excludeZerosExpr:e.where,normTotal:e.normalizationTotal}}({field:t,normalizationType:a,normalizationField:r,normalizationTotal:n,classBreaks:o,where:l,layer:e})}))}async function g(e,t,a,o,d){const{field:p,sqlExpression:f,normalizationField:c,classificationMethod:z,normalizationType:v}=e,T=p?t.getField(p):null,h=(0,fieldUtils.OH)(T),F=(0,fieldUtils.zD)(T)||h,B=e.numBins||10;if(F){if(v||z)throw new core_Error.A(`${t.adapterName}:not-supported`,"NormalizationType and classificationMethod are not supported for date-only and time-only fields");const e=(o-a)/B/1e3,n=e/86400;return new DateBinParameters.A({field:p,expression:f,interval:{unit:h?"seconds":"days",value:Math.ceil(h?e:n)},start:a,end:o})}if("defined-interval"===z)return new FixedIntervalBinParameters.A({field:p,expression:f,normalizationField:c,normalizationTotal:d,normalizationType:v,interval:e.definedInterval??Math.ceil((o-a)/B),start:v?null:a,end:v?null:o,normalizationMinValue:v?a:null,normalizationMaxValue:v?o:null});if("manual"===z)throw new core_Error.A(`${t.adapterName}:not-supported`,"Layer does not support manual classificationMethod");if("natural-breaks"===z||"quantile"===z||"standard-deviation"===z){const n=j({field:p,normalizationField:c,normalizationTotal:d,normalizationType:v,layer:t}),r=null!==e.minValue&&null!==e.maxValue?(0,utils.lX)(n,e.minValue,e.maxValue):void 0,o=await histogramUtils_M(e,t,r);if(!o.intervals)throw new core_Error.A(`${t.adapterName}:invalid`,"Invalid intervals returned from generate renderer");const l=[a,...o.intervals.map((i=>i[1]))];return new FixedBoundariesBinParameters.A({field:v?null:p,expression:v?n:f,boundaries:l})}return new AutoIntervalBinParameters.A({field:p,normalizationField:c,normalizationTotal:d,normalizationType:v,expression:f,numBins:B,start:v?null:a,end:v?null:o,normalizationMinValue:v?a:null,normalizationMaxValue:v?o:null})}function histogramUtils_E(i,e,n,t){return null!=n&&null!=t?Promise.resolve({min:n,max:t}):e.summaryStatistics({...i,outStatisticTypes:{include:["min","max"]}}).then((i=>({min:i.min,max:i.max})))}async function histogramUtils_b(i,n,r,l){const{field:s,minValue:u,maxValue:m,filter:d,view:f}=i,y=s?n.getField(s):null,z=(0,fieldUtils.vE)(y)||(0,fieldUtils.Ah)(y),v=histogramUtils_I(i,n,r),{min:x,max:w}=await histogramUtils_E(v,n,u,m);if(null==x||null==w)return{query:null,min:x,max:w};const T=new StatisticDefinition.A({statisticType:"count",outStatisticFieldName:"countOFExpr",onStatisticField:"1"}),F=(0,utils.sf)(l,v.sqlWhere),q=new AttributeBinsQuery.default({binParameters:await g(i,n,x,w,r),outStatistics:[T],binOrder:i.sortOrder,where:F,lowerBoundaryAlias:"lowerBoundary",upperBoundaryAlias:"upperBoundary",outTimeZone:f?.timeZone&&z?(0,date.wj)(f.timeZone):null});return A(q,d),{query:q,min:x,max:w}}function histogramUtils_D(i,e=!1){return"string"!=typeof i?i:(e?new Date(`1970-01-01T${i}Z`):new Date(i)).getTime()}function histogramUtils_P(i,e,t){const a=(0,fieldUtils.OH)(e);return{...t,bins:i.features.map((i=>({minValue:histogramUtils_D(i.attributes.lowerBoundary,a),maxValue:histogramUtils_D(i.attributes.upperBoundary,a),count:i.attributes.countOFExpr})))}}function histogramUtils_S(i,e,n){const{valueExpression:t,view:a}=i,{featuresJSON:r,graphics:o,fieldInfos:l}=e,s={field:i.field,valueExpression:t,normalizationType:i.normalizationType,normalizationField:i.normalizationField,normalizationTotal:n,minValue:i.minValue,maxValue:i.maxValue,standardDeviationInterval:i.standardDeviationInterval,classificationMethod:i.classificationMethod,numBins:i.numBins};return t&&a&&(r||o)&&(s.viewInfoParams=B(a),s.timeZone=a.timeZone,s.fieldInfos=l),s}var arcadeOnDemand=__webpack_require__("./node_modules/@arcgis/core/support/arcadeOnDemand.js");let InMemoryLayerAdapter_G=null,InMemoryLayerAdapter_R=class extends LayerAdapter_s{constructor(){super(...arguments),this._hasLocalSource=!1,this.adapterName="in-memory-layer-adapter"}destroy(){this.workerClient?.destroy()}async _waitForLayerViewUpdate(e){if(!e)throw new core_Error.A(`${this.adapterName}:insufficient-data", "layerView is required to fetch the features`);const t=new AbortController,i=(0,reactiveUtils.C_)((()=>!e.updating),t.signal);await(0,promiseUtils.wR)(i,5e3,t).catch((e=>{throw Logger.A.getLogger(this).warn("LayerView is taking too long to update. Aborting fetch from layerView."),e}))}async _fetchFeatureSetFromMemory(e,t,a){const i=this.layer;if(this._hasLocalSource&&"queryFeatures"in i)return i.queryFeatures(e);if(!t)throw new core_Error.A(`${this.adapterName}:insufficient-data`,"view is required to fetch the features from layerView");const s=await t.whenLayerView(this.layer);return await this._waitForLayerViewUpdate(s),s.queryFeatures(e,{signal:a})}async _fetchFeaturesFromMemory(e,t,a,i){const s=this.layer,o="json"===i;if(this._hasLocalSource&&"queryFeatures"in s){const e=await s.queryFeatures(t);return o?T(e.features):e.features}if(await this._waitForLayerViewUpdate(e),o&&"queryFeaturesJSON"in e&&e.queryFeaturesJSON){const{features:r}=await e.queryFeaturesJSON(t,{signal:a});return r}if(!("queryFeatures"in e))throw new core_Error.A(`${this.adapterName}:not-supported`,"'queryFeatures' is not supported on the layerView");const n=await e.queryFeatures(t,{signal:a});return o?T(n.features):n.features}_fetchFeaturesForStats(e,t){return(0,support_utils.EG)({field:e.field,field2:e.field2,field3:e.field3,normalizationField:e.normalizationField,valueExpression:e.valueExpression}).then((r=>this.getSampleFeatures({sampleSize:-1,view:e.view,returnGeometry:e.returnGeometry,filter:e.filter,requiredFields:r,signal:e.signal},t)))}async _summaryStatsFromClientQuery(e,t){const{view:r,signal:a}=e,i=k(this,e,t),o=utils_$(await this._fetchFeatureSetFromMemory(i,r,a),(0,support_utils.fs)(t)||(0,fieldUtils.OH)(t));return(0,statistics_utils.oZ)(o,e.outStatisticTypes)}async _getNormalizationTotalFromMemory(e,t,a){const{featuresJSON:i,graphics:s,layerView:o,query:n}=t,l={include:["sum"]},u=(!i&&!s&&o&&"querySummaryStatistics"in o?await o.querySummaryStatistics(n,{field:e},{signal:a}):i?await this.workerClient.summaryStatistics({field:e,outStatisticTypes:l},i):await(0,statsWorker.summaryStatistics)({attribute:{field:e,outStatisticTypes:l},features:s??[]})).sum;if(null==u)throw new core_Error.A(`${this.adapterName}:invalid`,"invalid normalizationTotal");return u}async _summaryStatsFromMemory(e,t){const{view:r,field:a,valueExpression:i,normalizationType:s,signal:o}=e,n={field:a,valueExpression:i,normalizationType:s,normalizationField:e.normalizationField,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue,outStatisticTypes:e.outStatisticTypes},{featuresJSON:l,graphics:u,layerView:m,query:y,fieldInfos:c}=await this._processStatsFromMemoryParams({...e,layerViewFunc:"querySummaryStatistics"});return i&&r&&(l||u)&&(n.fieldType=t?.type?fieldType.m.toJSON(t.type):null,n.viewInfoParams=B(r),n.timeZone=r.timeZone,n.fieldInfos=c),"percent-of-total"===s&&null==e.normalizationTotal&&(n.normalizationTotal=await this._getNormalizationTotalFromMemory(a,{featuresJSON:l,graphics:u,layerView:m,query:y},o)),!l&&!u&&m&&"querySummaryStatistics"in m?m.querySummaryStatistics(y,n,{signal:o}):l?this.workerClient.summaryStatistics(n,l):(0,statsWorker.summaryStatistics)({attribute:n,features:u})}async _getFilteredFeatures(e,t){let r=[];if("intersects"===t?.spatialRelationship){const{intersect:a}=await __webpack_require__.e(4055).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/geometry/geometryEngineAsync.js")),i=null!=t.geometry?t.geometry:null;for(const t of e){const e=null!=t.geometry?t.geometry:null;e&&i&&await a(e,i)&&r.push(t)}}else r=e;return e.length&&"declaredClass"in e[0]&&"esri.Graphic"===e[0].declaredClass?{graphics:r}:{featuresJSON:r}}async _processStatsFromMemoryParams(e){const{features:t,filter:r}=e;if(t?.length)return this._getFilteredFeatures(t,r);const{view:a,field:i,field2:s,field3:o,normalizationField:n,valueExpression:l,layerViewFunc:u,signal:m}=e;let p=e.returnGeometry;if(null==p&&l){if(!InMemoryLayerAdapter_G){const{arcadeUtils:e}=await(0,arcadeOnDemand.lw)();InMemoryLayerAdapter_G=e}const e=InMemoryLayerAdapter_G.hasGeometryOperations(l);e&&await InMemoryLayerAdapter_G.enableGeometryOperations(),p=e}let y=null,c=null,f=null,d=null,h=null;if(a)try{const e="subtype-sublayer"===this.layer.type?this.layer.parent:this.layer;y=await a.whenLayerView(e),c=null!=u&&u in y&&"function"==typeof y[u]}catch{c=!1}if(c)try{await this._waitForLayerViewUpdate(y);const e=await(0,support_utils.EG)({field:i,field2:s,field3:o,normalizationField:n,valueExpression:l});z(this,e,y).length?c=!1:(f=this.layer.createQuery(),f.outFields=e,f.returnGeometry=!1,A(f,r)),y.suspended&&(c=!1)}catch{c=!1}return c||(d=await this._fetchFeaturesForStats({field:i,field2:s,field3:o,valueExpression:l,normalizationField:n,returnGeometry:p,filter:r,view:a,signal:m},"json"),h=(await(0,support_utils.EG)({valueExpression:l})).map((e=>this.getField(e)?.toJSON())).filter(Boolean)),{layerView:y,query:f,featuresJSON:d,fieldInfos:h}}async _uvFromClientQuery(e,t){const{view:r,signal:a}=e,i=H(this,e),s=await this._fetchFeatureSetFromMemory(i,r,a),o=await L(s,{layer:this,field:e.field,field2:e.field2,field3:e.field3,fieldDelimiter:support_utils.UH,view:e.view,signal:e.signal});return(0,statistics_utils.lv)(o,t,e.returnAllCodedValues,support_utils.UH)}async _uvFromMemory(e,t){const{view:r,field:a,valueExpression:i,returnAllCodedValues:s,signal:o}=e,{featuresJSON:n,graphics:l,layerView:u,query:m,fieldInfos:p}=await this._processStatsFromMemoryParams({...e,layerViewFunc:"queryUniqueValues"}),y={field:a,field2:e.field2,field3:e.field3,fieldDelimiter:support_utils.UH,valueExpression:i,domains:t,returnAllCodedValues:s};return i&&r&&(n||l)&&(y.viewInfoParams=B(r),y.timeZone=r.timeZone,y.fieldInfos=p),!n&&!l&&u&&"queryUniqueValues"in u?u.queryUniqueValues(m,y,{signal:o}):n?this.workerClient.uniqueValues(y,n):(0,statsWorker.uniqueValues)({attribute:y,features:l})}_histogramForField(e){let t=null;return t=null!=e.minValue&&null!=e.maxValue?Promise.resolve({min:e.minValue,max:e.maxValue}):this.summaryStatistics({...e,outStatisticTypes:{include:["min","max","count"]}}).then((e=>{if(!e.count)throw new core_Error.A(`${this.adapterName}:insufficient-data`,"Either the layer has no features or none of the features have data for the field");return{min:e.min,max:e.max}})),t.then((t=>Z(this,{min:t.min,max:t.max},e.field,e.numBins??void 0,e.view,e.filter,e.signal)))}async _histogramFromQueryAttributeBinsFromMemory(e){const{field:t,normalizationType:r,signal:a}=e,i=await this._processStatsFromMemoryParams({...e,layerViewFunc:"queryAttributeBins"}),{featuresJSON:s,graphics:o,layerView:n,query:l}=i,u="percent-of-total"===r?e.normalizationTotal??await this._getNormalizationTotalFromMemory(t,i,a):void 0;if(!n||!("queryAttributeBins"in n)||s||o){const t=histogramUtils_S(e,i,u);return s?this.workerClient.histogram(t,s):(0,statsWorker.histogram)({attribute:t,features:o})}const{query:m,min:p,max:y}=await histogramUtils_b(e,this,u,l?.where);if(!m)return{bins:[],minValue:p,maxValue:y,normalizationTotal:u};return histogramUtils_P(await n.queryAttributeBins(m,{signal:a}),t?this.getField(t):null,{minValue:p,maxValue:y,normalizationTotal:u})}async _histogramFromMemory(e){const{field:t,signal:r}=e,a=await this._processStatsFromMemoryParams({...e,layerViewFunc:"queryHistogram"}),{featuresJSON:i,graphics:s,layerView:o,query:n}=a,u=histogramUtils_S(e,a,"percent-of-total"===e.normalizationType?e.normalizationTotal??await this._getNormalizationTotalFromMemory(t,a,r):void 0);return!i&&!s&&o&&"queryHistogram"in o?o.queryHistogram(n,u,{signal:r}):i?this.workerClient.histogram(u,i):(0,statsWorker.histogram)({attribute:u,features:s})}_classBreaksFromInterpolation(e){const{minValue:t,maxValue:r}=e,a=e.numClasses||5,i=[],s=(r-t)/a;for(let l=0;l<a;l++){const e=t+l*s;i.push({minValue:e,maxValue:e+s})}i[a-1].maxValue=r;const o={classBreaks:i,normalizationTotal:e.normalizationTotal},n=(0,statistics_utils.jM)(o,e.classificationMethod);return Promise.resolve(n)}async _classBreaksFromMemory(e){const{view:t,field:r,valueExpression:a,signal:i}=e,{featuresJSON:s,graphics:o,layerView:n,query:l,fieldInfos:u}=await this._processStatsFromMemoryParams({...e,layerViewFunc:"queryClassBreaks"}),m={field:r,valueExpression:a,normalizationType:e.normalizationType,normalizationField:e.normalizationField,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue,standardDeviationInterval:e.standardDeviationInterval,classificationMethod:e.classificationMethod,numClasses:e.numClasses};return a&&t&&(s||o)&&(m.viewInfoParams=B(t),m.timeZone=t.timeZone,m.fieldInfos=u),"percent-of-total"===e.normalizationType&&null==e.normalizationTotal&&(m.normalizationTotal=await this._getNormalizationTotalFromMemory(r,{featuresJSON:s,graphics:o,layerView:n,query:l},i)),!s&&!o&&n&&"queryClassBreaks"in n?n.queryClassBreaks(l,m,{signal:i}):s?this.workerClient.classBreaks(m,s):(0,statsWorker.classBreaks)({attribute:m,features:o})}async _heatmapStatsFromMemory(e){const{view:t,field:r,radius:a,signal:s}=e;(0,maybe.Lw)(t,"InMemoryLayerAdapter: must have a view");try{const r=await t.whenLayerView(this.layer);if("queryHeatmapStatistics"in r&&!r.updating&&!e.filter)return await r.queryHeatmapStatistics({field:e.field,radius:e.radius})}catch{(0,promiseUtils.Te)(s)}const{featuresJSON:n,graphics:l}=await this._processStatsFromMemoryParams({...e,returnGeometry:!0}),u=new QuantizationParameters.A({extent:t.extent,tolerance:"2d"===t.type?t.state.resolution:t.pixelSizeAt?.(t.center)}),p={field:r,radius:a,transform:(0,quantizationUtils.VV)(u),spatialReference:t.spatialReference?.toJSON(),size:t.size};return n?.length||l?.length?n?this.workerClient.heatmapStatistics(p,n):(0,statsWorker.heatmapStatistics)({attribute:p,features:l}):{min:null,max:null}}getField(e=""){return this.layer.getField(e)}getFieldUsageInfo(e){return this.getField(e)?{supportsLabelingInfo:!0,supportsRenderer:!0,supportsPopupTemplate:!0,supportsLayerQuery:!0,supportsStatistics:!0}:null}getFieldDomain(e,t){return this.layer.getFieldDomain(e,t)}createQuery(){return this.layer.createQuery()}async summaryStatistics(e){const{field:t,valueExpression:a,sqlExpression:i,features:s,view:o}=e,n=t?this.getField(t):null,l=!!a,u="3d"===o?.type;if(!a&&i&&!this.supportsSQLExpression)throw new core_Error.A(`${this.adapterName}:not-supported`,"Layer does not support standardized SQL expression for queries");return l||s||u?this._summaryStatsFromMemory(e,n):this._summaryStatsFromClientQuery(e,n)}async uniqueValues(e){const{valueExpression:t,sqlExpression:a,features:i,view:s}=e,o=await I(e,this),n=!!t,l="3d"===s?.type;if(!t&&a&&!this.supportsSQLExpression)throw new core_Error.A(`${this.adapterName}:not-supported`,"Layer does not support standardized SQL expression for queries");return n||i||l?this._uvFromMemory(e,o):this._uvFromClientQuery(e,o)}async histogram(e){const{features:t,valueExpression:a,normalizationType:i,sqlExpression:s}=e,o=t||!!a;if(!a&&s&&!this.supportsSQLExpression)throw new core_Error.A(`${this.adapterName}:not-supported`,"Layer does not support standardized SQL expression for queries");return o||i?this._histogramFromMemory(e):this._histogramForField(e)}async classBreaks(e){return!1!==e.analyzeData?this._classBreaksFromMemory(e):this._classBreaksFromInterpolation(e)}async queryFeatureCount(e){const{whereClause:t,view:a,signal:i}=e;if(!a)throw new core_Error.A(`${this.adapterName}:insufficient-data`,"view is required to fetch the features from layerView");const s=this.layer.createQuery();s.where=(0,utils.sf)(s.where,t);const o=await a.whenLayerView(this.layer);return await(0,reactiveUtils.C_)((()=>!o.updating),i),o.queryFeatureCount(s,{signal:i})}async generateRenderer(e,t){throw new core_Error.A(`${this.adapterName}:not-supported`,"Layer does not support generateRenderer operation")}async predominantCategories(e){const{fields:t,view:r,signal:a,filter:i}=e,s=predominanceUtils_s(t);return Q((await this._uvFromMemory({valueExpression:s,view:r,signal:a,filter:i})).uniqueValueInfos,t)}async heatmapStatistics(e){return this._heatmapStatsFromMemory(e)}async getSampleFeatures(e,a){const{view:i,sampleSize:s,requiredFields:o,returnGeometry:n,filter:l,signal:u}=e,m=this.layer.createQuery();if(m.outSpatialReference=i?.spatialReference,m.returnGeometry=!!n,m.outFields=o,A(m,l),!i)throw new core_Error.A(`${this.adapterName}:not-supported`,"view is required to get sample features for Layer");const y=await i.whenLayerView(this.layer);if(z(this,o,y).length)throw new core_Error.A(`${this.adapterName}:not-supported`,"Required fields need to be passed in the outFields for Layer");const c=await this._fetchFeaturesFromMemory(y,m,u,a),f=null!=s&&s>0&&s<=c.length?s:c.length;return(0,arrayUtils.BB)(c,f,1)}load(e){const t=this.layer.load(e).then((async t=>{this.geometryType=t.geometryType,this.objectIdField=t.objectIdField,this.supportsSQLExpression="stream"===t.type||!!t.capabilities?.query?.supportsSqlExpression,this.minScale=t.minScale,this.maxScale=t.maxScale,this.fullExtent="fullExtent"in t?t.fullExtent:t.parent?.fullExtent,this._hasLocalSource=!1,this.hasQueryEngine=!0,this.workerClient=n.getInstance(),await this.workerClient.open(e.signal)}));return this.addResolvingPromise(t),Promise.resolve(this)}};(0,tslib_es6._)([(0,property.MZ)({readOnly:!0})],InMemoryLayerAdapter_R.prototype,"adapterName",void 0),(0,tslib_es6._)([(0,property.MZ)({constructOnly:!0})],InMemoryLayerAdapter_R.prototype,"layer",void 0),InMemoryLayerAdapter_R=(0,tslib_es6._)([(0,subclass.$)("esri.smartMapping.support.adapters.InMemoryLayerAdapter")],InMemoryLayerAdapter_R);const InMemoryLayerAdapter_D=InMemoryLayerAdapter_R;var viewpointUtils=__webpack_require__("./node_modules/@arcgis/core/views/2d/viewpointUtils.js");let FeatureLayerAdapter_Z=class extends InMemoryLayerAdapter_D{constructor(){super(...arguments),this.adapterName="feature-layer-adapter"}_isStatsSupportedOnService(){const e=this.layer;if(!e.capabilities?.query?.supportsStatistics||"multipatch"===this.geometryType&&!(0,arcgisLayerUrl.Wo)(e.url)&&e.version<10.5)throw new core_Error.A(`${this.adapterName}:not-supported`,"Layer does not support statistics query");return Promise.resolve()}_fetchFeaturesFromService(e,t){return this.layer.queryFeatures(e,{signal:t}).then((e=>e.features))}_fetchFeaturesJSONFromService(e,t){return this._fetchFeaturesFromService(e,t).then(T)}_summaryStatsFromGenRend(e){const t=e.normalizationType,r=e.normalizationField;return this.classBreaks({field:e.field,numClasses:5,classificationMethod:"standard-deviation",standardDeviationInterval:.25,normalizationType:t,normalizationField:"field"===t?r:void 0,minValue:e.minValue,maxValue:e.maxValue,filter:e.filter,signal:e.signal}).then((t=>{let r,i,s;if(t.classBreakInfos?.some((e=>(e.hasAvg&&(r=e),!!r))),r){const e=r.maxValue-r.minValue;i=r.minValue+e/2,s=4*e}const a={min:t.minValue,max:t.maxValue,avg:i,stddev:s};return(0,statistics_utils.oZ)(a,e.outStatisticTypes)}))}async _summaryStatsFromServiceQuery(e,t){await this._isStatsSupportedOnService(),"percent-of-total"===e.normalizationType&&(e.normalizationTotal=await this._getNormalizationTotal(e.field,e.normalizationType,e.filter));const r=(0,support_utils.fs)(t)||(0,fieldUtils.OH)(t),i=k(this,e,t),a=utils_$(await this.layer.queryFeatures(i,{signal:e.signal}),r);return(0,statistics_utils.oZ)(a,e.outStatisticTypes)}_uvFromGenRenderer(e,t){const r=e.field??void 0,i=new u({attributeField:r}),s=new GenerateRendererParameters_i({classificationDefinition:i});return this.generateRenderer(s,e.signal).then((e=>{const t={},i=this.getField(r);return e.uniqueValues.forEach((e=>{let r=e.value;null!=r&&""!==r&&("string"!=typeof r||""!==r.trim()&&"<null>"!==r.toLowerCase())||(r=null),null==t[r]?t[r]={count:e.count,data:(0,fieldUtils.WA)(i)&&r?Number(r):r}:t[r].count=t[r].count+e.count})),{count:t}})).then((r=>(0,statistics_utils.lv)(r,[t],e.returnAllCodedValues)))}async _uvFromServiceQuery(e,t){return this._isStatsSupportedOnService().then((()=>this.layer.queryFeatures(H(this,e),{signal:e.signal}))).then((t=>L(t,{layer:this,field:e.field,field2:e.field2,field3:e.field3,fieldDelimiter:support_utils.UH,view:e.view,signal:e.signal}))).then((r=>(0,statistics_utils.lv)(r,t,e.returnAllCodedValues,support_utils.UH)))}_getNormalizationTotal(e,t,r,i){return e&&"percent-of-total"===t?this.summaryStatistics({field:e,outStatisticTypes:{include:["sum"]},filter:r,signal:i}).then((e=>e.sum)):Promise.resolve(null)}_histogramForExpr(e){return this._getNormalizationTotal(e.field,e.normalizationType,e.filter,e.signal).then((t=>{const r=histogramUtils_I(e,this,t);return histogramUtils_E(r,this,e.minValue,e.maxValue).then((i=>{const s=i.min,a=i.max;if(null==s||null==a)return{bins:[],minValue:s,maxValue:a,normalizationTotal:t};const o=e.numBins||10,n=(0,statistics_utils.OR)(s,a,o),l=function K(e,t,r){const i=[],s=t.length;return t.forEach(((t,a)=>{const[o,n]=t;let l=null;l=0!==a||r?a!==s-1||r?(0,utils.sf)(`${e} >= ${o}`,`${e} ${a===s-1?" <= ":" < "} ${n}`):`${e} >= ${o}`:`${e} < ${n}`,i.push("WHEN ("+l+") THEN "+(a+1))})),["CASE",i.join(" "),"ELSE 0","END"].join(" ")}(r.sqlExpression,n,null!=e.minValue&&null!=e.maxValue),u=new StatisticDefinition.A({statisticType:"count",outStatisticFieldName:"countOFExpr",onStatisticField:"1"}),m=this.layer.createQuery();return m.where=(0,utils.sf)(m.where,r.sqlWhere),m.sqlFormat="standard",m.outStatistics=[u],m.groupByFieldsForStatistics=[l],m.orderByFields=[l],A(m,e.filter),this._isStatsSupportedOnService().then((()=>this.layer.queryFeatures(m,{signal:r.signal}))).then((e=>O(e,s,a,o,t)))}))}))}async _histogramFromQueryAttributeBins(e){const{field:t,normalizationType:r,filter:i,signal:s}=e,a=await this._getNormalizationTotal(t,r,i,s),o=this.layer.createQuery(),{query:n,min:l,max:u}=await histogramUtils_b(e,this,a,o?.where);if(!n)return{bins:[],minValue:l,maxValue:u,normalizationTotal:a};return histogramUtils_P(await this.layer.queryAttributeBins(n,{signal:s}),t?this.getField(t):null,{minValue:l,maxValue:u,normalizationTotal:a})}_classBreaksFromGenRend(e){const{field:t,normalizationType:r,normalizationField:i,normalizationTotal:s,signal:a}=e,o=(0,utils.Lc)({field:t,normalizationType:r,normalizationField:i}),n=j({field:t,normalizationType:r,normalizationField:i,normalizationTotal:s,layer:this}),l=(0,utils.lX)(n,e.minValue,e.maxValue),u=(0,statistics_utils.al)({field:t,normalizationType:r,normalizationField:i,classificationMethod:e.classificationMethod,standardDeviationInterval:e.standardDeviationInterval,breakCount:e.numClasses||5}),m=new GenerateRendererParameters_i({classificationDefinition:u});return m.where=(0,utils.sf)(o,l),this.generateRenderer(m,a).then((t=>(0,statistics_utils.jM)(t,e.classificationMethod)))}async summaryStatistics(e){const{field:t,normalizationType:r,valueExpression:a,sqlExpression:o,view:n,features:u,useFeaturesInView:m}=e,c=t?this.getField(t):null,h=(0,support_utils.fs)(c)||(0,fieldUtils.OH)(c),p=a&&!(o&&this.supportsSQLExpression),d=this._hasLocalSource||u||m,f=n&&"3d"===n.type;if(d||p)return p||u||m||f?this._summaryStatsFromMemory(e,c):this._summaryStatsFromClientQuery(e,c);if(!this.supportsSQLExpression&&(h||o||"natural-log"===r||"square-root"===r))throw new core_Error.A(`${this.adapterName}:not-supported`,"Layer does not support standardized SQL expression for queries");return(r&&!this.supportsSQLExpression?this._summaryStatsFromGenRend(e):this._summaryStatsFromServiceQuery(e,c)).catch((()=>((0,promiseUtils.Te)(e.signal),this._summaryStatsFromMemory(e,c))))}async uniqueValues(e){const{valueExpression:t,sqlExpression:r,features:i,useFeaturesInView:a,signal:o}=e,n=t&&!(r&&this.supportsSQLExpression),l=this._hasLocalSource||i||a||n,u=e.view,m=u&&"3d"===u.type,c=await I(e,this);return l?n||i||a||m?this._uvFromMemory(e,c):this._uvFromClientQuery(e,c):this._uvFromServiceQuery(e,c).catch((t=>((0,promiseUtils.Te)(o),!e.field||e.field2||e.field3||e.filter?t:this._uvFromGenRenderer(e,c[0])))).catch((()=>((0,promiseUtils.Te)(o),m?this._uvFromMemory(e,c):this._uvFromClientQuery(e,c))))}async histogram(e){const{field:t,normalizationType:r,normalizationField:a,classificationMethod:o,view:n,filter:u,signal:m}=e,c=t?this.getField(t):null,h=(0,support_utils.fs)(c)||(0,fieldUtils.OH)(c),p=e.valueExpression||e.sqlExpression,d=e.valueExpression&&!(e.sqlExpression&&this.supportsSQLExpression),f=this._hasLocalSource||e.features||e.useFeaturesInView||d,y=this.supportsSQLExpression,F=!o||"equal-interval"===o,g=e.minValue,v=e.maxValue,x=null!=g&&null!=v,_=e.numBins||10;if(f)return this._histogramFromMemory(e);if(this.layer.capabilities?.operations?.supportsQueryBins&&e.useQueryAttributeBins)try{return await this._histogramFromQueryAttributeBins(e)}catch{return(0,promiseUtils.Te)(m),this._histogramFromQueryAttributeBinsFromMemory(e)}if((p||y)&&F){if(!y&&(p||"natural-log"===r||"square-root"===r))throw new core_Error.A(`${this.adapterName}:not-supported`,"Layer does not support standardized SQL expression for queries");return this._histogramForExpr(e)}if(h&&F)throw new core_Error.A(`${this.adapterName}:not-supported`,"Normalization and date field are not allowed when layer does not support standardized SQL expression for queries");return r||!F?histogramUtils_M(e,this).then((s=>{if(!x)return Z(this,s,t,_,n,u,m);if(g>s.max||v<s.min)throw new core_Error.A(`${this.adapterName}:insufficient-data`,"Range defined by 'minValue' and 'maxValue' does not intersect available data range of the field");if(F)return Z(this,{min:g,max:v,sqlExpr:s.sqlExpr,excludeZerosExpr:s.excludeZerosExpr},t,_,n,u,m);{const o=j({field:t,normalizationType:r,normalizationField:a,normalizationTotal:s.normTotal,layer:this}),l=(0,utils.lX)(o,g,v);return histogramUtils_M(e,this,l).then((e=>Z(this,e,t,_,n,u,m)))}})):this._histogramForField(e)}async classBreaks(e){const t=!1!==e.analyzeData,r=this._hasLocalSource||e.features||e.useFeaturesInView||e.valueExpression||e.filter;return t&&r?this._classBreaksFromMemory(e):(t?this._classBreaksFromGenRend(e):this._classBreaksFromInterpolation(e)).catch((()=>((0,promiseUtils.Te)(e.signal),this._classBreaksFromMemory(e))))}async queryFeatureCount(e){if(this._hasLocalSource)throw new core_Error.A(`${this.adapterName}:not-supported`,"Layer does not support count query");const t=this.layer,r=t.createQuery();return r.where=(0,utils.sf)(r.where,e.whereClause),A(r,e.filter),t.queryFeatureCount(r,{signal:e.signal})}async generateRenderer(e,t){const r=this.layer;if(this._hasLocalSource||r.version<10.1)throw new core_Error.A(`${this.adapterName}:not-supported`,"Layer does not support generateRenderer operation (requires ArcGIS Server version 10.1+)");const s=r.createQuery();return e.where=(0,utils.sf)(e.where,s.where),async function generateRenderer_l(t,i,a,s){const l=(0,rest_utils.Dl)(t),{source:r,checkValueRange:u}=i,{classificationDefinition:c}=a,f={...a.toJSON(),f:"json"};let m=null;if(m="class-breaks-definition"===c?.type?c.classificationField:c?.attributeField,r){const e={source:r?.toJSON()};f.layer=JSON.stringify(e)}f.classificationDef&&(f.classificationDef=JSON.stringify(f.classificationDef));let p={query:f};s&&(p={...s,...p});const y={url:l.path,field:m,checkValueRange:u},d=l.path+"/generateRenderer";return(0,request.A)(d,p).then((e=>o(y,e)))}(r.parsedUrl?.path??"",{source:r.dynamicDataSource??void 0,gdbVersion:r.gdbVersion??void 0},e,{signal:t})}async predominantCategories(e){if(!this._hasLocalSource&&!this.supportsSQLExpression)throw new core_Error.A(`${this.adapterName}:not-supported`,"Layer does not support advanced SQL expressions and standardized queries");const{fields:t,view:r,signal:s,filter:a}=e,o=predominanceUtils_s(t),n=function predominanceUtils_u(n){return{expression:predominanceUtils_r(n,{returnFieldName:!0,defaultValue:"'no_dominant_category'"})}}(t);return Q((r&&this._hasLocalSource?await this._uvFromMemory({valueExpression:o,view:r,signal:s,filter:a}):await this._uvFromServiceQuery({sqlExpression:n.expression,valueExpression:o,signal:s,filter:a})).uniqueValueInfos,t)}async getSampleFeatures(e,i){const{view:a,requiredFields:o,returnGeometry:n,filter:l,signal:u}=e,m=e.sampleSize;if(null==m||0===m)return[];const c=this.layer.createQuery(),p="json"===i;c.outSpatialReference=a?.spatialReference,c.returnGeometry=!!n,c.outFields=o,A(c,l);let d=[],f=!1;if(a)try{const s=await a.whenLayerView(this.layer);if(f=!z(this,o,s).length,f){if(m>=1&&!e.filter&&"getSampleFeatures"in s){await this._waitForLayerViewUpdate(s);const e=await s.getSampleFeatures({minFeatureCount:m,sampleSize:m});if(null!=e)return p?e:e.map((e=>Graphic.default.fromJSON(e)))}if(d=await this._fetchFeaturesFromMemory(s,c,u,i),d.length>=m&&m>0)return(0,arrayUtils.BB)(d,m,1)}}catch(y){(0,promiseUtils.Te)(u)}try{if(this._hasLocalSource)return f?d:p?await this._fetchFeaturesJSONFromService(c,u):await this._fetchFeaturesFromService(c,u);const t=await this.queryFeatureCount({view:a,filter:l,signal:u}),i=this.layer.capabilities.query.maxRecordCount;let s=-1===m?t:m;if(s=i&&s>i?i:s,t<=d.length||d.length>=i)return d;if(c.maxAllowableOffset=e.resolution||4e5*(a?a.extent.width/a.width/a.scale:(0,viewpointUtils.ri)(this.layer.spatialReference)),t<=s)return p?await this._fetchFeaturesJSONFromService(c,u):await this._fetchFeaturesFromService(c,u);if(t<=2e4){A(this.layer.createQuery(),l);const t=await this.layer.queryObjectIds();return c.objectIds=(0,arrayUtils.BB)(t,s,1),p?await this._fetchFeaturesJSONFromService(c,u):await this._fetchFeaturesFromService(c,u)}return this.layer.capabilities?.query?.supportsPagination&&(c.num=Math.min(s,2e4)),p?await this._fetchFeaturesJSONFromService(c,u):await this._fetchFeaturesFromService(c,u)}catch(y){return(0,promiseUtils.Te)(u),d}}load(e){const t=this.layer.load(e).then((async t=>{this.geometryType=t.geometryType,this.objectIdField=t.objectIdField,this.supportsSQLExpression=t.capabilities?.query?.supportsSqlExpression,this._hasLocalSource=!t.url&&!!t.source,this.hasQueryEngine=this._hasLocalSource,this.minScale=t.minScale,this.maxScale=t.maxScale,this.fullExtent=t.fullExtent,this.workerClient=n.getInstance(),await this.workerClient.open(e.signal)}));return this.addResolvingPromise(t),Promise.resolve(this)}};(0,tslib_es6._)([(0,property.MZ)({readOnly:!0})],FeatureLayerAdapter_Z.prototype,"adapterName",void 0),(0,tslib_es6._)([(0,property.MZ)({constructOnly:!0})],FeatureLayerAdapter_Z.prototype,"layer",void 0),FeatureLayerAdapter_Z=(0,tslib_es6._)([(0,subclass.$)("esri.smartMapping.support.adapters.FeatureLayerAdapter")],FeatureLayerAdapter_Z);const X=FeatureLayerAdapter_Z;let CSVLayerAdapter_m=class extends X{constructor(){super(...arguments),this.adapterName="csv-layer-adapter"}async _createGenerateRendererResult(e,r,i,n,l){const p=e?.features,c=p?.length;if(!c)throw new core_Error.A("csv-layer-adapter:insufficient-data","No features are available to calculate statistics");const m=T(p);let d=null;if("percent-of-total"===n&&(d=(await this.workerClient.summaryStatistics({field:r},m)).sum,null==d))throw new core_Error.A("csv-layer-adapter:invalid","invalid normalizationTotal");if("class-breaks-definition"===l?.type){const e=(await(0,utils.Jc)({field:r,normalizationType:n,normalizationField:i,normalizationTotal:d},m)).filter((e=>Number.isFinite(e)));return(0,generateRendererUtils.t)({definition:l,values:e,normalizationTotal:d})}const f=(await(0,utils.Jc)({field:r},m)).filter((e=>null!=e&&"string"==typeof e&&""!==e.trim()));return(0,generateRendererUtils._)(f)}generateRenderer(e,t){const r=e.classificationDefinition;let i=null,s=null,o=null;"class-breaks-definition"===r?.type?(i=r.classificationField,s=r.normalizationField,o=r.normalizationType):i=r?.attributeField;const a=this.layer;return(0,support_utils.EG)({field:i,normalizationField:s}).then((l=>{const p=a.createQuery();return p.returnGeometry=!1,p.outFields=l,p.where=(0,utils.sf)(p.where,e.where),a.queryFeatures(p,{signal:t}).then((e=>this._createGenerateRendererResult(e,i,s,o,r)))}))}load(e){const t=this.layer.load(e).then((async t=>{this.geometryType=t.geometryType,this.objectIdField=t.objectIdField,this.supportsSQLExpression=!0,this._hasLocalSource=!1,this.hasQueryEngine=!0,this.workerClient=n.getInstance(),await this.workerClient.open(e.signal)}));return this.addResolvingPromise(t),Promise.resolve(this)}};(0,tslib_es6._)([(0,property.MZ)({readOnly:!0})],CSVLayerAdapter_m.prototype,"adapterName",void 0),CSVLayerAdapter_m=(0,tslib_es6._)([(0,subclass.$)("esri.smartMapping.support.adapters.CSVLayerAdapter")],CSVLayerAdapter_m);const CSVLayerAdapter_d=CSVLayerAdapter_m;let FeatureLayerBinningAdapter_N=class extends X{constructor(){super(...arguments),this.adapterName="feature-layer-binning-adapter"}async _getNormalizationTotalFromMemory(e,t,r){const{featuresJSON:i,graphics:s,layerView:o,query:n}=t,l={include:["sum"]},m=(!i&&!s&&o&&"queryAggregateSummaryStatistics"in o?await o.queryAggregateSummaryStatistics(n,{field:e,outStatisticTypes:l},{signal:r}):i?await this.workerClient.summaryStatistics({field:e},i):await(0,statsWorker.summaryStatistics)({attribute:{field:e,outStatisticTypes:l},features:s})).sum;if(null==m)throw new core_Error.A(`${this.adapterName}:invalid`,"invalid normalizationTotal");return m}async _processStatsFromMemoryParams(e){const{features:t,filter:r}=e;if(t?.length)return this._getFilteredFeatures(t,r);const{view:i,field:s,field2:o,field3:n,normalizationField:l,valueExpression:u,returnGeometry:m,layerViewFunc:p,signal:g}=e;let d=null,y=null,f=null,h=null,w=null;if(i)try{if(d=await i.whenLayerView(this.layer),y=null!=p&&p in d&&"function"==typeof d[p],y){await this._waitForLayerViewUpdate(d);const e=await(0,support_utils.EG)({field:s,field2:o,field3:n,normalizationField:l,valueExpression:u});utils_V(this,e).length?y=!1:(f="createAggregateQuery"in d?d.createAggregateQuery():null,f?(f.outFields=e,f.returnGeometry=!1,A(f,r)):y=!1),d.suspended&&(y=!1)}}catch{y=!1}if(!y&&(w=P(this.layer).map((e=>e.toJSON())),h=await this._fetchFeaturesForStats({field:s,field2:o,field3:n,valueExpression:u,normalizationField:l,returnGeometry:m,filter:r,view:i,signal:g},"json"),!h?.length))throw new core_Error.A(`${this.adapterName}:insufficient-data`,"No features are available to calculate statistics");return{layerView:d,query:f,featuresJSON:h,fieldInfos:w}}async _summaryStatsFromMemory(e,t){const{view:a,field:r,valueExpression:i,normalizationType:s,signal:n}=e,l={field:r,valueExpression:i,normalizationType:s,normalizationField:e.normalizationField,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue,outStatisticTypes:e.outStatisticTypes},{featuresJSON:m,graphics:p,layerView:g,query:d,fieldInfos:y}=await this._processStatsFromMemoryParams({...e,layerViewFunc:"queryAggregateSummaryStatistics"});return i&&a&&(m||p)&&(l.fieldType=t?.type?fieldType.m.toJSON(t.type):null,l.viewInfoParams=B(a),l.timeZone=a.timeZone,l.fieldInfos=y),"percent-of-total"===s&&null==e.normalizationTotal&&(l.normalizationTotal=await this._getNormalizationTotalFromMemory(r,{featuresJSON:m,graphics:p,layerView:g,query:d},n)),!m&&!p&&g&&"queryAggregateSummaryStatistics"in g?g.queryAggregateSummaryStatistics(d,l,{signal:n}):m?this.workerClient.summaryStatistics(l,m):(0,statsWorker.summaryStatistics)({attribute:l,features:p})}async _uvFromMemory(e,t){const{view:a,field:r,valueExpression:i,returnAllCodedValues:s,signal:o}=e,{featuresJSON:n,graphics:l,layerView:u,query:p,fieldInfos:g}=await this._processStatsFromMemoryParams({...e,layerViewFunc:"queryAggregateUniqueValues"}),d={field:r,field2:e.field2,field3:e.field3,fieldDelimiter:support_utils.UH,valueExpression:i,domains:t,returnAllCodedValues:s};return i&&a&&(n||l)&&(d.viewInfoParams=B(a),d.timeZone=a.timeZone,d.fieldInfos=g),!n&&!l&&u&&"queryAggregateUniqueValues"in u?u.queryAggregateUniqueValues(p,d,{signal:o}):n?this.workerClient.uniqueValues(d,n):(0,statsWorker.uniqueValues)({attribute:d,features:l})}async _histogramFromMemory(e){const{view:t,field:a,valueExpression:r,signal:i}=e,{featuresJSON:s,graphics:o,layerView:n,query:l,fieldInfos:u}=await this._processStatsFromMemoryParams({...e,layerViewFunc:"queryAggregateHistogram"}),m={field:a,valueExpression:r,normalizationType:e.normalizationType,normalizationField:e.normalizationField,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue,standardDeviationInterval:e.standardDeviationInterval,classificationMethod:e.classificationMethod,numBins:e.numBins};return r&&t&&(s||o)&&(m.viewInfoParams=B(t),m.timeZone=t.timeZone,m.fieldInfos=u),"percent-of-total"===e.normalizationType&&null==e.normalizationTotal&&(m.normalizationTotal=await this._getNormalizationTotalFromMemory(a,{featuresJSON:s,graphics:o,layerView:n,query:l},i)),!s&&!o&&n&&"queryAggregateHistogram"in n?n.queryAggregateHistogram(l,m,{signal:i}):s?this.workerClient.histogram(m,s):(0,statsWorker.histogram)({attribute:m,features:o})}async _classBreaksFromMemory(e){const{view:t,field:a,valueExpression:r,signal:i}=e,{featuresJSON:s,graphics:o,layerView:n,query:l,fieldInfos:u}=await this._processStatsFromMemoryParams({...e,layerViewFunc:"queryAggregateClassBreaks"}),m={field:a,valueExpression:r,normalizationType:e.normalizationType,normalizationField:e.normalizationField,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue,standardDeviationInterval:e.standardDeviationInterval,classificationMethod:e.classificationMethod,numClasses:e.numClasses};return r&&t&&(s||o)&&(m.viewInfoParams=B(t),m.timeZone=t.timeZone,m.fieldInfos=u),"percent-of-total"===e.normalizationType&&null==e.normalizationTotal&&(m.normalizationTotal=await this._getNormalizationTotalFromMemory(a,{featuresJSON:s,graphics:o,layerView:n,query:l},i)),!s&&!o&&n&&"queryAggregateClassBreaks"in n?n.queryAggregateClassBreaks(l,m,{signal:i}):s?this.workerClient.classBreaks(m,s):(0,statsWorker.classBreaks)({attribute:m,features:o})}getField(e=""){const t=P(this.layer);return t?.find((t=>t.name.toLowerCase()===e?.toLowerCase()))}getFieldUsageInfo(e){return this.getField(e)?{supportsLabelingInfo:!0,supportsRenderer:!0,supportsPopupTemplate:!0,supportsLayerQuery:!1,supportsStatistics:!0}:null}getFieldDomain(e,t){return null}async summaryStatistics(e){const{field:t}=e,r=t?this.getField(t):null,i=(0,support_utils.fs)(r)||(0,fieldUtils.OH)(r),s=e.sqlExpression&&!e.valueExpression&&!t;if(i||s)throw new core_Error.A(`${this.adapterName}:not-supported`,"Date field and sqlExpression are not supported");return this._summaryStatsFromMemory(e,r)}async uniqueValues(e){const t=await I(e,this);return this._uvFromMemory(e,t)}async histogram(e){const{field:t}=e,r=t?this.getField(t):null,i=(0,support_utils.fs)(r)||(0,fieldUtils.OH)(r),s=e.sqlExpression&&!e.valueExpression&&!t;if(i||s)throw new core_Error.A(`${this.adapterName}:not-supported`,"Date field and sqlExpression are not supported");return this._histogramFromMemory(e)}async classBreaks(e){return(!1!==e.analyzeData?this._classBreaksFromMemory(e):this._classBreaksFromInterpolation(e)).catch((()=>((0,promiseUtils.Te)(e.signal),this._classBreaksFromMemory(e))))}async queryFeatureCount(e){const t=await(e.view?.whenLayerView(this.layer));if(!t||!("queryAggregateCount"in t)||!t.queryAggregateCount)throw new core_Error.A(`${this.adapterName}:not-supported`,"LayerView is not supported.");await this._waitForLayerViewUpdate(t);const r=t.createAggregateQuery();return r.where=(0,utils.sf)(r.where,e.whereClause),A(r,e.filter),t.queryAggregateCount(r,{signal:e.signal})}generateRenderer(e,t){throw new core_Error.A(`${this.adapterName}:not-supported`,"'generateRenderer' is not supported.")}heatmapStatistics(e){throw new core_Error.A(`${this.adapterName}:not-supported`,"'heatmapStatistics' is not supported.")}async predominantCategories(e){const{fields:t,view:a,signal:r}=e,i=predominanceUtils_s(t);return Q((await this._uvFromMemory({valueExpression:i,view:a,signal:r})).uniqueValueInfos,t)}async getSampleFeatures(e,r){const{view:i,sampleSize:s,requiredFields:o,returnGeometry:n,filter:l,signal:u}=e;if(!i)throw new core_Error.A(`${this.adapterName}:not-supported`,"'view' is required to get sample features for binning.");if("3d"===i.type)throw new core_Error.A(`${this.adapterName}:not-supported`,"3d 'view' is not supported to get sample features for binning.");const m=await i.whenLayerView(this.layer);if(!("queryAggregateJSON"in m&&m.queryAggregateJSON&&"queryAggregates"in m&&m.queryAggregates))throw new core_Error.A(`${this.adapterName}:not-supported`,"LayerView is not supported.");if(await this._waitForLayerViewUpdate(m),utils_V(this,o).length)throw new core_Error.A(`${this.adapterName}:insufficient-data`,"Layer does not have required fields");const g="json"===r,d=m.createAggregateQuery();d.outSpatialReference=i?.spatialReference,d.returnGeometry=!!n,d.outFields=o,A(d,l);const{features:y}=g?await m.queryAggregateJSON(d,{signal:u}):await m.queryAggregates(d,{signal:u});return y.length&&null!=s&&s>0&&s<=y.length?(0,arrayUtils.BB)(y,s,1):y}load(e){const t=this.layer.load(e).then((async t=>{this.geometryType="polygon",this.objectIdField=null,this.supportsSQLExpression=!1,this._hasLocalSource=!1,this.hasQueryEngine=!0,this.minScale=t.minScale,this.maxScale=t.maxScale,this.fullExtent=t.fullExtent;const r="featureReduction"in t?t.featureReduction:null;if("binning"!==r?.type&&"cluster"!==r?.type)throw new core_Error.A(`${this.adapterName}:invalid-parameters`,`Feature reduction type ${r?.type} is not supported`);this.workerClient=n.getInstance(),await this.workerClient.open(e.signal)}));return this.addResolvingPromise(t),Promise.resolve(this)}};(0,tslib_es6._)([(0,property.MZ)({readOnly:!0})],FeatureLayerBinningAdapter_N.prototype,"adapterName",void 0),FeatureLayerBinningAdapter_N=(0,tslib_es6._)([(0,subclass.$)("esri.smartMapping.support.adapters.FeatureLayerBinningAdapter")],FeatureLayerBinningAdapter_N);const FeatureLayerBinningAdapter_T=FeatureLayerBinningAdapter_N;let SceneLayerAdapter_A=class extends LayerAdapter_s{constructor(e){super(e),this._featureLayerAdapter=null,this.workerClient=null,this.adapterName="scene-layer-adapter"}destroy(){this.workerClient?.destroy()}_hasCachedStatistics(e){return this.layer.hasCachedStatistics(e)}_updateQuery(e,t=[],r=[]){if(!e||!r.length)return e;const a=this.layer.objectIdField,s=e.clone(),i=t.filter((e=>{const t=this.layer.getField(e);return!r.includes(t.name)})),o=i.some((e=>this.layer.getField(e).name===a));return s.outFields=o?i:[...i,a],s}async _fetchFeaturesFromMemory(e,t,r){if(!e)throw new core_Error.A("scene-layer-adapter:insufficient-data","view is required to fetch the features from layerView");const n=await e.whenLayerView(this.layer),l=new AbortController,u=l.signal,p=(0,reactiveUtils.C_)((()=>!n.updating),u);await(0,promiseUtils.wR)(p,5e3,l);const m=z(this,r,n);(0,promiseUtils.Te)(u);const c=this._updateQuery(t,r??[],m),d=await n.queryFeatures(c,{signal:u});(0,promiseUtils.Te)(u);const h=d.features;return m.length?n.whenGraphicAttributes(h,m):h}async _fetchFeaturesJSONFromMemory(e,t,r){return this._fetchFeaturesFromMemory(e,t,r).then(T)}_fetchFeaturesForStats(e,t){return(0,support_utils.EG)({field:e.field,normalizationField:e.normalizationField,valueExpression:e.valueExpression}).then((r=>this.getSampleFeatures({sampleSize:-1,view:e.view,returnGeometry:e.returnGeometry,requiredFields:r,signal:e.signal},t)))}async _processStatsFromMemoryParams(e){const t=e.features;if(t?.length)return t.length&&"declaredClass"in t[0]&&"esri.Graphic"===t[0].declaredClass?{graphics:t}:{featuresJSON:t};const{view:r,field:s,normalizationField:i,valueExpression:o,signal:n}=e,l=await this._fetchFeaturesForStats({field:s,valueExpression:o,normalizationField:i,view:r,signal:n},null);if(!l?.length)throw new core_Error.A("scene-layer-adapter:insufficient-data","No features are available to calculate statistics");return{graphics:l}}_getCachedStatistics(e,t){const r=this.layer;return e.valueExpression||e.sqlExpression||e.sqlWhere||e.minValue||e.maxValue?Promise.reject(new core_Error.A("scene-layer-adapter:not-supported","This Layer does not support calculating statistics when 'valueExpression', 'sqlExpression', 'sqlWhere', 'minValue' or 'maxValue' is specified")):r.queryCachedStatistics(t?.name,{signal:e.signal}).then((e=>{const t=e.stats,{min:r,max:a,totalValuesCount:s}=t;let{avg:i,stddev:o,sum:n,variance:l,count:u}=t;return 0===r&&0===a||(i=0===i?null:i,n=0===n?null:n,o=0===o?null:o,l=0===l?null:l,u=0===u?null:u),null==u&&(null!=n&&null!=i?u=Math.round(n/i):null!=s&&(u=s)),{avg:i,count:u,max:a,min:r,stddev:o,sum:n,variance:l}}))}async _getNormalizationTotal(e,t,r){const s={include:["sum"]},i=(t?await this.workerClient.summaryStatistics({field:e,outStatisticTypes:s},t):await(0,statsWorker.summaryStatistics)({attribute:{field:e,outStatisticTypes:s},features:r})).sum;if(null==i)throw new core_Error.A("scene-layer-adapter:invalid","invalid normalizationTotal");return i}async _getSummaryStatisticsFromMemory(e,t){const{view:r,field:a,normalizationField:s,valueExpression:i}=e,{featuresJSON:o,graphics:n}=await this._processStatsFromMemoryParams(e),l={field:a,valueExpression:i,normalizationType:e.normalizationType,normalizationField:s,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue,outStatisticTypes:e.outStatisticTypes};return e.valueExpression&&r&&o&&(l.fieldType=t?.type?fieldType.m.toJSON(t.type):null,l.viewInfoParams=B(r),l.timeZone=r.timeZone),"percent-of-total"===e.normalizationType&&null==e.normalizationTotal&&(l.normalizationTotal=await this._getNormalizationTotal(a,o,n)),o?this.workerClient.summaryStatistics(l,o):(0,statsWorker.summaryStatistics)({attribute:l,features:n})}_getCachedStatisticsForUniqueValues(e,r){const s=this.layer,i=r?.name,o=r&&e.field?this.getFieldDomain(e.field):null;return e.valueExpression||e.sqlExpression||e.sqlWhere?Promise.reject(new core_Error.A("scene-layer-adapter:not-supported","This Layer does not support calculating statistics when 'valueExpression', 'sqlExpression' or 'sqlWhere' is specified")):s.queryCachedStatistics(i,{signal:e.signal}).then((a=>{const o=a.stats;if(!o.mostFrequentValues)throw new Error;const n=a.labels?.labels,l={},u=[],c="countOF"+i;o.mostFrequentValues.forEach((e=>{const a=new Graphic.default({attributes:{}});a.attributes[i]=r&&r.name!==s.objectIdField&&((0,fieldUtils.WA)(r)||(0,support_utils.fs)(r))?Number(e.value):e.value,a.attributes[c]=e.count,u.push(a)})),n&&n.forEach((e=>{l[e.value]=e.label}));return L(new FeatureSet.A({features:u}),{layer:this,field:e.field,labels:l,view:e.view,signal:e.signal})})).then((t=>(0,statistics_utils.lv)(t,[o],e.returnAllCodedValues)))}async _getUniqueValuesFromMemory(e,t){const{view:r,field:a,field2:s,field3:i,valueExpression:o,returnAllCodedValues:n}=e,l={field:a,field2:s,field3:i,fieldDelimiter:support_utils.UH,valueExpression:o,domains:t,returnAllCodedValues:n},{featuresJSON:u,graphics:p}=await this._processStatsFromMemoryParams(e);return e.valueExpression&&r&&u&&(l.viewInfoParams=B(r),l.timeZone=r.timeZone),u?this.workerClient.uniqueValues(l,u):(0,statsWorker.uniqueValues)({attribute:l,features:p})}_getCachedStatisticsForHistogram(e,t){const r=this.layer;return e.valueExpression||e.sqlExpression||e.sqlWhere||e.normalizationType?Promise.reject(new core_Error.A("scene-layer-adapter:not-supported","This Layer does not support calculating statistics when 'valueExpression' or 'sqlExpression' or 'sqlWhere' or 'normalizationType' is specified")):r.queryCachedStatistics(t&&t.name,{signal:e.signal}).then((t=>{const r=t.stats,{minValue:a,maxValue:s}=e,i=null!=a?a:r.min,o=null!=s?s:r.max,n=e.numBins||10,l=function SceneLayerAdapter_j(e,r=e.minimum,a=e.maximum,s){const i=[];for(let t=0;t<s;t++)i[t]=0;const o=e.counts.length,n=e.minimum,l=e.maximum;for(let t=0;t<o;t++){const u=(t+.5)/o,p=((1-u)*n+u*l-r)/(a-r)*s;p>=0&&p<=s&&(i[p===s?s-1:Math.floor(p)]+=e.counts[t])}const u=[];return i.forEach(((e,r)=>{const a=new Graphic.default({attributes:{}});a.attributes.EXPR_1=r+1,a.attributes.countOFExpr=e,u.push(a)})),new FeatureSet.A({features:u})}(r.histogram,i,o,n);return O(l,i,o,n)}))}async _getClassBreaksFromMemory(e){const{view:t,field:r,normalizationField:a,valueExpression:s}=e,{featuresJSON:i,graphics:o}=await this._processStatsFromMemoryParams(e),n={field:r,valueExpression:s,normalizationType:e.normalizationType,normalizationField:a,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue,standardDeviationInterval:e.standardDeviationInterval,classificationMethod:e.classificationMethod,numClasses:e.numClasses};return e.valueExpression&&t&&i&&(n.viewInfoParams=B(t),n.timeZone=t.timeZone),"percent-of-total"===e.normalizationType&&null==e.normalizationTotal&&(n.normalizationTotal=await this._getNormalizationTotal(r,i,o)),i?this.workerClient.classBreaks(n,i):(0,statsWorker.classBreaks)({attribute:n,features:o})}async _getHistogramFromMemory(e){const{view:t,field:r}=e,{featuresJSON:a,graphics:s}=await this._processStatsFromMemoryParams(e),i={field:r,valueExpression:e.valueExpression,normalizationType:e.normalizationType,normalizationField:e.normalizationField,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue,standardDeviationInterval:e.standardDeviationInterval,classificationMethod:e.classificationMethod,numBins:e.numBins};return e.valueExpression&&t&&a&&(i.viewInfoParams=B(t),i.timeZone=t.timeZone),"percent-of-total"===e.normalizationType&&null==e.normalizationTotal&&(i.normalizationTotal=await this._getNormalizationTotal(r,a,s)),a?this.workerClient.histogram(i,a):(0,statsWorker.histogram)({attribute:i,features:s})}getField(e){return this.layer.getField(e??"")}getFieldUsageInfo(e){const t=this.getField(e);if(!t)return null;const r=this.layer.getFieldUsageInfo(t.name);return{supportsLabelingInfo:r.supportsLabelingInfo,supportsPopupTemplate:r.supportsPopupTemplate,supportsRenderer:r.supportsRenderer,supportsLayerQuery:r.supportsLayerQuery,supportsStatistics:!0}}getFieldDomain(e,t){return this._featureLayerAdapter?this._featureLayerAdapter.getFieldDomain(e,t):null}createQuery(){return this.layer.createQuery()}summaryStatistics(e){const t=this.getField(e.field);if(this._featureLayerAdapter)return this._featureLayerAdapter.summaryStatistics(e);if(e.filter)throw new core_Error.A("scene-layer-adapter:not-supported","filter is not supported");return this._hasCachedStatistics(t?.name)?this._getCachedStatistics(e,t).catch((()=>((0,promiseUtils.Te)(e.signal),this._getSummaryStatisticsFromMemory(e,t)))):this._getSummaryStatisticsFromMemory(e,t)}async uniqueValues(e){if(this._featureLayerAdapter)return this._featureLayerAdapter.uniqueValues(e);if(e.filter)throw new core_Error.A("scene-layer-adapter:not-supported","filter is not supported");const t=await I(e,this),{field:r,field2:s}=e,o=r&&s,n=this.getField(r);return!o&&n&&this._hasCachedStatistics(n.name)?this._getCachedStatisticsForUniqueValues(e,n).catch((()=>((0,promiseUtils.Te)(e.signal),this._getUniqueValuesFromMemory(e,t)))):this._getUniqueValuesFromMemory(e,t)}histogram(e){const t=this.getField(e.field);if(this._featureLayerAdapter)return this._featureLayerAdapter.histogram(e);if(e.filter)throw new core_Error.A("scene-layer-adapter:not-supported","filter is not supported");return t&&this._hasCachedStatistics(t.name)?this._getCachedStatisticsForHistogram(e,t).catch((()=>((0,promiseUtils.Te)(e.signal),this._getHistogramFromMemory(e)))):this._getHistogramFromMemory(e)}classBreaks(e){const t=this.getField(e.field);if(this._featureLayerAdapter)return this._featureLayerAdapter.classBreaks(e);if(e.filter)throw new core_Error.A("scene-layer-adapter:not-supported","filter is not supported");return this._hasCachedStatistics(t?.name)?Promise.reject(new core_Error.A("scene-layer-adapter:not-supported","Cached stats not supported")):this._getClassBreaksFromMemory(e)}queryFeatureCount(e){return this._featureLayerAdapter?this._featureLayerAdapter.queryFeatureCount(e):Promise.reject(new core_Error.A("scene-layer-adapter:not-supported","SceneLayer without associated FeatureLayer does not support count query"))}generateRenderer(e,t){return this._featureLayerAdapter?this._featureLayerAdapter.generateRenderer(e,t):Promise.reject(new core_Error.A("scene-layer-adapter:not-supported","SceneLayer without associated FeatureLayer does not support generateRenderer operation"))}heatmapStatistics(e){return this._featureLayerAdapter?this._featureLayerAdapter.heatmapStatistics(e):Promise.reject(new core_Error.A("scene-layer-adapter:not-supported","SceneLayer without associated FeatureLayer does not support heatmapStatistics operation"))}async predominantCategories(e){if(this._featureLayerAdapter)return this._featureLayerAdapter.predominantCategories(e);throw new core_Error.A("scene-layer-adapter:not-supported","SceneLayer without associated FeatureLayer does not support predominantCategories")}async getSampleFeatures(e,t){if(e.filter)throw new core_Error.A("scene-layer-adapter:not-supported","filter is not supported");const{view:s,sampleSize:o,requiredFields:n,returnGeometry:l,signal:u}=e,m="json"===t,c=this.createQuery();c.outFields=n,c.returnGeometry=!!l,c.where=null,c.num=o;let d=[];try{if(d=m?await this._fetchFeaturesJSONFromMemory(s,c,n):await this._fetchFeaturesFromMemory(s,c,n),d.length&&null!=o&&o>0&&o<=d.length)return(0,arrayUtils.BB)(d,o,1)}catch(y){(0,promiseUtils.Te)(u)}let h=null;if(this._featureLayerAdapter){const r={...e};delete r.view,h=await this._featureLayerAdapter.getSampleFeatures(r,t)}return h?.length?h:(0,arrayUtils.BB)(d,d.length,1)}load(e){const t=this.layer.load(e).then((async t=>{this.workerClient=n.getInstance(),await this.workerClient.open(e.signal);const r=t.associatedLayer;if(this.geometryType=t.geometryType,null!=r)return this._featureLayerAdapter=new X({layer:r}),this._featureLayerAdapter.load(e).then((()=>{this.objectIdField=this._featureLayerAdapter.objectIdField,this.supportsSQLExpression=this._featureLayerAdapter.supportsSQLExpression,this.minScale=this._featureLayerAdapter.minScale,this.maxScale=this._featureLayerAdapter.maxScale,this.fullExtent=this._featureLayerAdapter.fullExtent}));this.objectIdField=t.objectIdField,this.supportsSQLExpression=!1,this.hasQueryEngine=!1,this.fullExtent=t.fullExtent}));return this.addResolvingPromise(t),Promise.resolve(this)}};(0,tslib_es6._)([(0,property.MZ)({readOnly:!0})],SceneLayerAdapter_A.prototype,"adapterName",void 0),(0,tslib_es6._)([(0,property.MZ)({constructOnly:!0})],SceneLayerAdapter_A.prototype,"layer",void 0),SceneLayerAdapter_A=(0,tslib_es6._)([(0,subclass.$)("esri.smartMapping.support.adapters.SceneLayerAdapter")],SceneLayerAdapter_A);const SceneLayerAdapter_V=SceneLayerAdapter_A;let PointCloudLayerAdapter_o=class extends SceneLayerAdapter_V{constructor(e){super(e),this.adapterName="point-cloud-layer-adapter"}getField(e){return this.layer.fieldsIndex.get(e??"")}getFieldUsageInfo(e){const r=this.getField(e);if(!r)return null;const t=this._hasCachedStatistics(r.name);return{supportsLabelingInfo:t,supportsPopupTemplate:t,supportsRenderer:t,supportsLayerQuery:!1,supportsStatistics:t}}getFieldDomain(){return null}load(e){const r=this.layer.load(e).then((()=>{this.geometryType="point",this.objectIdField=null,this.supportsSQLExpression=!1,this.hasQueryEngine=!1}));return this.addResolvingPromise(r),Promise.resolve(this)}};(0,tslib_es6._)([(0,property.MZ)({readOnly:!0})],PointCloudLayerAdapter_o.prototype,"adapterName",void 0),PointCloudLayerAdapter_o=(0,tslib_es6._)([(0,subclass.$)("esri.smartMapping.support.adapters.PointCloudLayerAdapter")],PointCloudLayerAdapter_o);const PointCloudLayerAdapter_p=PointCloudLayerAdapter_o;let StreamLayerAdapter_c=class extends InMemoryLayerAdapter_D{constructor(){super(...arguments),this.adapterName="stream-layer-adapter"}async _summaryStatsFromClientQuery(t,r){const{signal:s,view:a}=t,c=k(this,t,r);c.outStatistics=c.outStatistics?.filter((t=>"totalcount_value"!==t.outStatisticFieldName));const l=utils_$(await this._fetchFeatureSetFromMemory(c,a,s),(0,support_utils.fs)(r)||(0,fieldUtils.OH)(r));return(0,statistics_utils.oZ)(l,t.outStatisticTypes)}};(0,tslib_es6._)([(0,property.MZ)({readOnly:!0})],StreamLayerAdapter_c.prototype,"adapterName",void 0),StreamLayerAdapter_c=(0,tslib_es6._)([(0,subclass.$)("esri.smartMapping.support.adapters.StreamLayerAdapter")],StreamLayerAdapter_c);const StreamLayerAdapter_u=StreamLayerAdapter_c;var layerUtils_l;!function(e){e[e.CatalogLayer=0]="CatalogLayer",e[e.CatalogFootprintLayer=1]="CatalogFootprintLayer",e[e.CSVLayer=2]="CSVLayer",e[e.FeatureLayer=3]="FeatureLayer",e[e.GeoJSONLayer=4]="GeoJSONLayer",e[e.KnowledgeGraphSublayer=5]="KnowledgeGraphSublayer",e[e.OGCFeatureLayer=6]="OGCFeatureLayer",e[e.OrientedImageryLayer=7]="OrientedImageryLayer",e[e.ParquetLayer=8]="ParquetLayer",e[e.PointCloudLayer=9]="PointCloudLayer",e[e.SceneLayer=10]="SceneLayer",e[e.StreamLayer=11]="StreamLayer",e[e.SubtypeGroupLayer=12]="SubtypeGroupLayer",e[e.SubtypeSublayer=13]="SubtypeSublayer",e[e.WFSLayer=14]="WFSLayer"}(layerUtils_l||(layerUtils_l={}));const layerUtils_u={[layerUtils_l.CatalogLayer]:{adapter:X,type:"catalog",label:"CatalogLayer"},[layerUtils_l.CatalogFootprintLayer]:{adapter:X,type:"catalog-footprint",label:"CatalogFootprintLayer"},[layerUtils_l.CSVLayer]:{adapter:CSVLayerAdapter_d,type:"csv",label:"CSVLayer"},[layerUtils_l.FeatureLayer]:{adapter:X,type:"feature",label:"FeatureLayer"},[layerUtils_l.GeoJSONLayer]:{adapter:X,type:"geojson",label:"GeoJSONLayer"},[layerUtils_l.KnowledgeGraphSublayer]:{adapter:X,type:"knowledge-graph-sublayer",label:"KnowledgeGraphSublayer"},[layerUtils_l.OGCFeatureLayer]:{adapter:InMemoryLayerAdapter_D,type:"ogc-feature",label:"OGCFeatureLayer"},[layerUtils_l.OrientedImageryLayer]:{adapter:X,type:"oriented-imagery",label:"OrientedImageryLayer"},[layerUtils_l.ParquetLayer]:{adapter:X,type:"parquet",label:"ParquetLayer"},[layerUtils_l.PointCloudLayer]:{adapter:PointCloudLayerAdapter_p,type:"point-cloud",label:"PointCloudLayer"},[layerUtils_l.SceneLayer]:{adapter:SceneLayerAdapter_V,type:"scene",label:"SceneLayer"},[layerUtils_l.StreamLayer]:{adapter:StreamLayerAdapter_u,type:"stream",label:"StreamLayer"},[layerUtils_l.SubtypeGroupLayer]:{adapter:X,type:"subtype-group",label:"SubtypeGroupLayer"},[layerUtils_l.SubtypeSublayer]:{adapter:X,type:"subtype-sublayer",label:"SubtypeSublayer"},[layerUtils_l.WFSLayer]:{adapter:X,type:"wfs",label:"WFSLayer"}},layerUtils_n=[layerUtils_l.CatalogLayer,layerUtils_l.CatalogFootprintLayer,layerUtils_l.CSVLayer,layerUtils_l.FeatureLayer,layerUtils_l.GeoJSONLayer,layerUtils_l.KnowledgeGraphSublayer,layerUtils_l.OGCFeatureLayer,layerUtils_l.OrientedImageryLayer,layerUtils_l.ParquetLayer,layerUtils_l.PointCloudLayer,layerUtils_l.SceneLayer,layerUtils_l.StreamLayer,layerUtils_l.SubtypeGroupLayer,layerUtils_l.SubtypeSublayer,layerUtils_l.WFSLayer],layerUtils_d=(layerUtils_l.CatalogFootprintLayer,layerUtils_l.CSVLayer,layerUtils_l.FeatureLayer,layerUtils_l.GeoJSONLayer,layerUtils_l.KnowledgeGraphSublayer,layerUtils_l.OGCFeatureLayer,layerUtils_l.OrientedImageryLayer,layerUtils_l.ParquetLayer,layerUtils_l.SceneLayer,layerUtils_l.StreamLayer,layerUtils_l.SubtypeGroupLayer,layerUtils_l.SubtypeSublayer,layerUtils_l.WFSLayer,[layerUtils_l.CSVLayer,layerUtils_l.FeatureLayer,layerUtils_l.GeoJSONLayer,layerUtils_l.OGCFeatureLayer,layerUtils_l.KnowledgeGraphSublayer,layerUtils_l.OrientedImageryLayer,layerUtils_l.ParquetLayer,layerUtils_l.StreamLayer,layerUtils_l.WFSLayer]);function layerUtils_m(e,a=layerUtils_n,t){if(e instanceof LayerAdapter_s)return e;const o=function layerUtils_g(e,a=layerUtils_n){let r=null;return a.some((a=>{const t=e.type===layerUtils_u[a].type;return t&&(r=layerUtils_u[a].adapter),t})),r}(e,a);return o?t?new FeatureLayerBinningAdapter_T({layer:e}):new o({layer:e}):null}async function uniqueValues_u(u){if(!u?.layer||!u.field&&!u.valueExpression)throw new core_Error.A("unique-values:missing-parameters","'layer' and 'field' or 'valueExpression' parameters are required");const p=u.valueExpression||u.sqlExpression,f=p&&!u.sqlExpression;if(p)if(f){if(!u.view)throw new core_Error.A("unique-values:missing-parameters","View is required when 'valueExpression' is specified")}else if(!u.valueExpression)throw new core_Error.A("unique-values:missing-parameters","'valueExpression' parameters are required");u.forBinning&&function i(e,i){if(!e.view)throw new core_Error.A(`${i}:missing-parameters`,"'view' parameter is required for binning");if(e.sqlExpression)throw new core_Error.A(`${i}:invalid-parameters`,"'sqlExpression' parameter is not supported for binning");if("3d"===e.view.type)throw new core_Error.A(`${i}:invalid-parameters`,"3d view is not supported for binning")}(u,"unique-values");const{layer:m,...d}=u,v=u.forBinning?layerUtils_d:layerUtils_n,w=layerUtils_m(m,v,u.forBinning);if(!w)throw new core_Error.A("unique-values:invalid-parameters","'layer' must be one of these types: "+function layerUtils_b(e){return e.map((e=>layerUtils_u[e].label))}(v).join(", "));const c={layerAdapter:w,...d},q=null!=c.signal?{signal:c.signal}:null;await w.load(q);const x=await(0,support_utils.EG)({field:c.field,field2:c.field2,field3:c.field3,valueExpression:c.valueExpression}),y=(0,utils.MH)(w,x,"unique-values:invalid-parameters");if(y)throw y;c.filter&&!c.filter.spatialRelationship&&(c.filter.spatialRelationship="intersects");const E=(0,utils.Wk)(c.filter,"summary-statistics:invalid-parameters");if(E)throw E;return c}async function uniqueValues_p(e){const{layerAdapter:i,...s}=await uniqueValues_u(e);return i.uniqueValues(s)}}}]);