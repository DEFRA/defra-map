"use strict";(self.webpackChunk_defra_flood_map=self.webpackChunk_defra_flood_map||[]).push([[396],{"./node_modules/@arcgis/core/core/perspectiveUtils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{O:()=>j,W:()=>p});var _libs_gl_matrix_2_math_mat3_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/math/mat3.js"),_libs_gl_matrix_2_factories_mat3f64_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/mat3f64.js"),_libs_gl_matrix_2_math_vec2_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/math/vec2.js"),_chunks_vec32_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec32.js");const f=(0,__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/vec3f64.js").vt)(),n=(0,_libs_gl_matrix_2_factories_mat3f64_js__WEBPACK_IMPORTED_MODULE_1__.vt)(),l=(0,_libs_gl_matrix_2_factories_mat3f64_js__WEBPACK_IMPORTED_MODULE_1__.vt)(),u=(0,_libs_gl_matrix_2_factories_mat3f64_js__WEBPACK_IMPORTED_MODULE_1__.vt)();function p(r,s,i){return(0,_chunks_vec32_js__WEBPACK_IMPORTED_MODULE_3__.i)(f,s[0],s[1],1),(0,_chunks_vec32_js__WEBPACK_IMPORTED_MODULE_3__.q)(f,f,(0,_libs_gl_matrix_2_math_mat3_js__WEBPACK_IMPORTED_MODULE_0__.mg)(n,i)),0===f[2]?(0,_libs_gl_matrix_2_math_vec2_js__WEBPACK_IMPORTED_MODULE_2__.hZ)(r,f[0],f[1]):(0,_libs_gl_matrix_2_math_vec2_js__WEBPACK_IMPORTED_MODULE_2__.hZ)(r,f[0]/f[2],f[1]/f[2])}function j(t,i,m){return x(l,i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7]),x(u,m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7]),(0,_libs_gl_matrix_2_math_mat3_js__WEBPACK_IMPORTED_MODULE_0__.lw)(t,(0,_libs_gl_matrix_2_math_mat3_js__WEBPACK_IMPORTED_MODULE_0__.KC)(l,l),u),0!==t[8]&&(t[0]/=t[8],t[1]/=t[8],t[2]/=t[8],t[3]/=t[8],t[4]/=t[8],t[5]/=t[8],t[6]/=t[8],t[7]/=t[8],t[8]/=t[8]),t}function x(m,o,c,l,u,p,j,x,b){(0,_libs_gl_matrix_2_math_mat3_js__WEBPACK_IMPORTED_MODULE_0__.hZ)(m,o,l,p,c,u,j,1,1,1),(0,_chunks_vec32_js__WEBPACK_IMPORTED_MODULE_3__.i)(f,x,b,1),(0,_libs_gl_matrix_2_math_mat3_js__WEBPACK_IMPORTED_MODULE_0__.KC)(n,m);const[g,h,v]=(0,_chunks_vec32_js__WEBPACK_IMPORTED_MODULE_3__.q)(f,f,(0,_libs_gl_matrix_2_math_mat3_js__WEBPACK_IMPORTED_MODULE_0__.mg)(n,n));return(0,_libs_gl_matrix_2_math_mat3_js__WEBPACK_IMPORTED_MODULE_0__.hZ)(n,g,0,0,0,h,0,0,0,v),(0,_libs_gl_matrix_2_math_mat3_js__WEBPACK_IMPORTED_MODULE_0__.lw)(m,n,m)}},"./node_modules/@arcgis/core/layers/support/MediaElementView.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{_:()=>m});var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_core_Accessor_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js"),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_6__=(__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),__webpack_require__("./node_modules/@arcgis/core/core/RandomLCG.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),_geometry_Polygon_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/geometry/Polygon.js"),_geometry_projection_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/geometry/projection.js"),_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingRect.js"),_geometry_support_normalizeUtilsSync_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/normalizeUtilsSync.js");let m=class extends _core_Accessor_js__WEBPACK_IMPORTED_MODULE_1__.A{constructor(o){super(o)}get bounds(){const o=this.coords;return null==o?.extent?null:(0,_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_9__.VY)(o.extent)}get coords(){const o=this.element.georeference?.coords;return(0,_geometry_projection_js__WEBPACK_IMPORTED_MODULE_8__.projectOrLoad)(o,this.spatialReference).geometry}get normalizedCoords(){return _geometry_Polygon_js__WEBPACK_IMPORTED_MODULE_7__.A.fromJSON((0,_geometry_support_normalizeUtilsSync_js__WEBPACK_IMPORTED_MODULE_10__.jZ)(this.coords))}get normalizedBounds(){const o=null!=this.normalizedCoords?this.normalizedCoords.extent:null;return null!=o?(0,_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_9__.VY)(o):null}};(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.MZ)()],m.prototype,"spatialReference",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.MZ)()],m.prototype,"element",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.MZ)()],m.prototype,"bounds",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.MZ)()],m.prototype,"coords",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.MZ)()],m.prototype,"normalizedCoords",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.MZ)()],m.prototype,"normalizedBounds",null),m=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_6__.$)("esri.layers.support.MediaElementView")],m)},"./node_modules/@arcgis/core/support/mediaLayerUtils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Of:()=>n,UR:()=>e,Ws:()=>o,bv:()=>c});const n=Symbol("ImageElementInstance"),e=Symbol("VideoElementInstance");function t(e){return null!=e&&"object"==typeof e&&n in e}function o(n){return null!=n&&"object"==typeof n&&e in n}function c(n){return t(n)||o(n)}},"./node_modules/@arcgis/core/views/2d/engine/webgl/OverlayContainer.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>u});var common=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/math/common.js"),mat3=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/math/mat3.js"),mat3f32=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/mat3f32.js"),vec2f32=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/vec2f32.js"),vec3f32=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/vec3f32.js"),normalizeUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/normalizeUtils.js"),spatialReferenceUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/spatialReferenceUtils.js"),viewpointUtils=__webpack_require__("./node_modules/@arcgis/core/views/2d/viewpointUtils.js"),enums=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/enums.js"),WGLContainer=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/WGLContainer.js"),maybe=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),Mesh=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/meshing/Mesh.js"),utils=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/utils.js"),Technique=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/Technique.js"),TechniqueType=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/TechniqueType.js"),tslib_es6=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),GraphShaderModule=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/GraphShaderModule.js"),glsl=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/graph/glsl.js");class x extends GraphShaderModule.ZA{}(0,tslib_es6._)([(0,GraphShaderModule.C5)(0,glsl.ZY)],x.prototype,"pos",void 0),(0,tslib_es6._)([(0,GraphShaderModule.C5)(1,glsl.ZY)],x.prototype,"uv",void 0);class g extends GraphShaderModule.HS{}class w extends GraphShaderModule.k2{}(0,tslib_es6._)([(0,GraphShaderModule.Pi)(glsl.U)],w.prototype,"dvs",void 0);class S extends GraphShaderModule.k2{}(0,tslib_es6._)([(0,GraphShaderModule.Pi)(glsl.ZY)],S.prototype,"perspective",void 0),(0,tslib_es6._)([(0,GraphShaderModule.Pi)(glsl.ZY)],S.prototype,"texSize",void 0),(0,tslib_es6._)([(0,GraphShaderModule.Pi)(glsl.nt)],S.prototype,"wrapAroundShift",void 0),(0,tslib_es6._)([(0,GraphShaderModule.Pi)(glsl.nt)],S.prototype,"opacity",void 0),(0,tslib_es6._)([(0,GraphShaderModule.Pi)(glsl.z7)],S.prototype,"texture",void 0);class j extends GraphShaderModule.A{constructor(){super(...arguments),this.type="OverlayShader"}vertex(t){const o=t.uv.divide(this.config.texSize),e=new glsl.nt(1).add((0,glsl.Om)(o,this.config.perspective)),r=new glsl.eB(t.pos.add(new glsl.ZY(this.config.wrapAroundShift,0)),1),p=this.transform.dvs.multiply(r);return{uv:o,glPosition:new glsl.Zb(p.xy.multiply(e),0,e)}}fragment(t){const o=(0,glsl.US)(this.config.texture,t.uv).multiply(this.config.opacity),e=new GraphShaderModule.mm;return e.fragColor=o,e}}(0,tslib_es6._)([(0,GraphShaderModule.Pi)(w)],j.prototype,"transform",void 0),(0,tslib_es6._)([(0,GraphShaderModule.Pi)(S)],j.prototype,"config",void 0),(0,tslib_es6._)([(0,tslib_es6.a)(0,(0,GraphShaderModule.hF)(x))],j.prototype,"vertex",null),(0,tslib_es6._)([(0,tslib_es6.a)(0,(0,GraphShaderModule.hF)(g))],j.prototype,"fragment",null);var webgl_enums=__webpack_require__("./node_modules/@arcgis/core/views/webgl/enums.js"),VertexElementDescriptor=__webpack_require__("./node_modules/@arcgis/core/views/webgl/VertexElementDescriptor.js");class m extends Technique.j{constructor(){super(...arguments),this.type=TechniqueType.N.Overlay,this._mesh=null,this.shaders={overlay:new j}}render(e,t){const{context:r,painter:i}=e,o=this._getMesh(e,t);i.setPipelineState(utils.i);const{isWrapAround:h,wrapAroundShift:p}=t.config,u={...t.config,wrapAroundShift:0},m={shader:this.shaders.overlay,uniforms:{transform:t.transform,config:u},defines:null,optionalAttributes:null,useComputeBuffer:!1};i.setPipelineState({...utils.i,stencil:{write:!1,test:{compare:webgl_enums.MT.EQUAL,op:{fail:webgl_enums.eA.KEEP,zFail:webgl_enums.eA.KEEP,zPass:webgl_enums.eA.REPLACE},ref:0,mask:255}}}),i.submitDrawMeshUntyped(r,m,o),h&&(u.wrapAroundShift=p,i.submitDrawMeshUntyped(r,m,o))}shutdown(){(0,maybe.pR)(this._mesh)}_getMesh(e,s){const{context:r}=e;if(this._mesh){const e=this._mesh.vertexBuffers.get("positions");if(!e)throw new Error("Buffer not found");e.buffer.setData(s.position)}else{const e=null!=s.index?s.index.length:s.position.length/2;this._mesh=new Mesh.e(r,{vertex:{positions:{data:s.position,attributes:[new VertexElementDescriptor._("pos",2,webgl_enums.pe.FLOAT,0,8)]},uvs:{data:s.tex,attributes:[new VertexElementDescriptor._("uv",2,webgl_enums.pe.UNSIGNED_SHORT,0,4)]}},index:null!=s.index?{index:{data:s.index}}:void 0,groups:[{index:null!=s.index?"index":void 0,primitive:webgl_enums.WR.TRIANGLE_STRIP}],parts:[{group:0,start:0,count:e}]})}return this._mesh}}class u extends WGLContainer.A{constructor(){super(...arguments),this._viewStateId=-1,this._dvsMat3=(0,mat3f32.vt)(),this._overlayTechnique=new m}get dvsMat3(){return this._dvsMat3}beforeRender(t){this._updateMatrices(t),this._updateOverlays(t,this.children);for(const e of this.children)e.beforeRender(t)}doRender(t){if(t.drawPhase!==enums.S5.MAP||!this.visible)return;super.doRender(t);const e=this._overlayTechnique;for(const r of this.children)r.draw(t,e)}onDetach(){this._overlayTechnique.shutdown()}_updateMatrices(a){const{state:h}=a,{id:m,size:d,pixelRatio:p,resolution:f,rotation:u,viewpoint:v,displayMat3:_}=h;if(this._viewStateId===m)return;const M=(0,common.DF)(u),g=p*d[0],y=p*d[1];this._localOrigin=v.targetGeometry.clone();const{x:w,y:x}=this._localOrigin,b=(0,normalizeUtils.mT)(w,h.spatialReference);this._localOrigin.x=b,this._localOrigin.y=x;const j=f*g,O=f*y,R=(0,mat3.D_)(this._dvsMat3);(0,mat3.lw)(R,R,_),(0,mat3.Tl)(R,R,(0,vec2f32.fA)(g/2,y/2)),(0,mat3.hs)(R,R,(0,vec3f32.fA)(g/j,-y/O,1)),(0,mat3.e$)(R,R,-M),this._viewStateId=m}_updateOverlays(e,r){const{state:o}=e,{rotation:i,spatialReference:s,worldScreenWidth:a,size:n,viewpoint:l}=o,c=this._localOrigin;let d,p=0;const f=(0,spatialReferenceUtils.Vp)(s);if(f&&s.isWrappable){const e=n[0],r=n[1],c=(0,common.DF)(i),h=Math.abs(Math.cos(c)),u=Math.abs(Math.sin(c)),v=Math.round(e*h+r*u),[_,M]=f.valid,g=(0,viewpointUtils.FT)(s),{x:y,y:w}=l.targetGeometry,x=[y,w],b=[0,0];o.toScreen(b,x);const j=[0,0];let O;O=v>a?.5*a:.5*v;const R=Math.floor((y+.5*g)/g),q=_+R*g,S=M+R*g,G=[b[0]+O,0];o.toMap(j,G),j[0]>S&&(p=g),G[0]=b[0]-O,o.toMap(j,G),j[0]<q&&(p=-g),d={worldWidth:g,xBounds:[_,M]}}for(const t of r)t.updateDrawCoords(c,p,s,d)}}},"./node_modules/@arcgis/core/views/2d/engine/webgl/animatedFormats/utils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{ZH:()=>c});var _core_handleUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/handleUtils.js"),_core_time_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/core/time.js"),_symbols_cim_enums_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/symbols/cim/enums.js"),_grouping_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/grouping.js");function m(t,r){const{width:i,height:a,getFrame:n}=t,o=t.frameDurations.slice(),s=o.pop();return o.push((0,_core_time_js__WEBPACK_IMPORTED_MODULE_3__.l5)(s+r)),{frameCount:t.frameCount,duration:t.duration+r,frameDurations:o,getFrame:n,width:i,height:a}}class u{constructor(t,e,r,i){this._animation=t,this._repeatType=r,this._onFrameData=i,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];let a=0;for(;e>a;)a+=this.timeToFrame,this.nextFrame();const n=this._animation.getFrame(this._currentFrame);this._onFrameData(n)}nextFrame(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case _symbols_cim_enums_js__WEBPACK_IMPORTED_MODULE_1__.fu.None:this._currentFrame-=this._direction;break;case _symbols_cim_enums_js__WEBPACK_IMPORTED_MODULE_1__.fu.Loop:this._currentFrame=0;break;case _symbols_cim_enums_js__WEBPACK_IMPORTED_MODULE_1__.fu.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case _symbols_cim_enums_js__WEBPACK_IMPORTED_MODULE_1__.fu.None:this._currentFrame-=this._direction;break;case _symbols_cim_enums_js__WEBPACK_IMPORTED_MODULE_1__.fu.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case _symbols_cim_enums_js__WEBPACK_IMPORTED_MODULE_1__.fu.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];const t=this._animation.getFrame(this._currentFrame);this._onFrameData(t)}}function h(t,h,c,f){let l,{repeatType:d}=h;if(null==d&&(d=_symbols_cim_enums_js__WEBPACK_IMPORTED_MODULE_1__.fu.Loop),!0===h.reverseAnimation&&(t=function n(t){const{width:e,height:r}=t,i=t.frameDurations.reverse();return{frameCount:t.frameCount,duration:t.duration,frameDurations:i,getFrame:e=>{const r=t.frameDurations.length-1-e;return t.getFrame(r)},width:e,height:r}}(t)),null!=h.duration&&(t=function o(t,r){const{width:i,height:a,getFrame:n}=t,o=r/t.duration,s=t.frameDurations.map((t=>(0,_core_time_js__WEBPACK_IMPORTED_MODULE_3__.l5)(t*o)));return{frameCount:t.frameCount,duration:t.duration,frameDurations:s,getFrame:n,width:i,height:a}}(t,(0,_core_time_js__WEBPACK_IMPORTED_MODULE_3__.l5)(1e3*h.duration))),null!=h.repeatDelay){const i=1e3*h.repeatDelay;d===_symbols_cim_enums_js__WEBPACK_IMPORTED_MODULE_1__.fu.Loop?t=m(t,(0,_core_time_js__WEBPACK_IMPORTED_MODULE_3__.l5)(i)):d===_symbols_cim_enums_js__WEBPACK_IMPORTED_MODULE_1__.fu.Oscillate&&(t=function s(t,r){const{width:i,height:a,getFrame:n}=t,o=t.frameDurations.slice(),s=o.shift();return o.unshift((0,_core_time_js__WEBPACK_IMPORTED_MODULE_3__.l5)(s+r)),{frameCount:t.frameCount,duration:t.duration+r,frameDurations:o,getFrame:n,width:i,height:a}}(m(t,(0,_core_time_js__WEBPACK_IMPORTED_MODULE_3__.l5)(i/2)),(0,_core_time_js__WEBPACK_IMPORTED_MODULE_3__.l5)(i/2)))}if(null!=h.startTimeOffset)l=(0,_core_time_js__WEBPACK_IMPORTED_MODULE_3__.l5)(1e3*h.startTimeOffset);else if(null!=h.randomizeStartTime){const r=82749913,n=null!=h.randomizeStartSeed?h.randomizeStartSeed:r,o=(0,_grouping_js__WEBPACK_IMPORTED_MODULE_2__.J)(c,n);l=(0,_core_time_js__WEBPACK_IMPORTED_MODULE_3__.l5)(o*function a(t){return(0,_core_time_js__WEBPACK_IMPORTED_MODULE_3__.l5)(t.frameDurations.reduce(((t,e)=>t+e),0))}(t))}else l=(0,_core_time_js__WEBPACK_IMPORTED_MODULE_3__.l5)(0);return new u(t,l,d,f)}function c(e,r,i,a){const n=null==r.playAnimation||r.playAnimation,o=h(e,r,i,a);let s,m=o.timeToFrame;return function u(){s=n?setTimeout((()=>{o.nextFrame(),m=o.timeToFrame,u()}),m):void 0}(),(0,_core_handleUtils_js__WEBPACK_IMPORTED_MODULE_0__.hA)((()=>n&&clearTimeout(s)))}},"./node_modules/@arcgis/core/views/2d/engine/webgl/grouping.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>o,J:()=>e});var _core_string_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/string.js");function e(e,o){let r;if("string"==typeof e)r=(0,_core_string_js__WEBPACK_IMPORTED_MODULE_0__.Wm)(e+`-seed(${o})`);else{let t=12;r=e^o;do{r=107*(r>>8^r)+t|0}while(0!=--t)}return(1+r/(1<<31))/2}function o(t){return Math.floor(e(t,r)*n)}const r=53290320,n=10},"./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/utils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{i:()=>t});const t={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}},"./node_modules/@arcgis/core/views/2d/layers/MediaLayerView2D.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>M});var tslib_es6=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),Collection=(__webpack_require__("./node_modules/@arcgis/core/Graphic.js"),__webpack_require__("./node_modules/@arcgis/core/core/Collection.js")),core_Error=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),Logger=(__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/Logger.js")),MapUtils=__webpack_require__("./node_modules/@arcgis/core/core/MapUtils.js"),promiseUtils=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),reactiveUtils=__webpack_require__("./node_modules/@arcgis/core/core/reactiveUtils.js"),property=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),subclass=(__webpack_require__("./node_modules/@arcgis/core/core/RandomLCG.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),Extent=__webpack_require__("./node_modules/@arcgis/core/geometry/Extent.js"),aaBoundingRect=__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingRect.js"),contains=__webpack_require__("./node_modules/@arcgis/core/geometry/support/contains.js"),intersectsBase=__webpack_require__("./node_modules/@arcgis/core/geometry/support/intersectsBase.js"),MediaElementView=__webpack_require__("./node_modules/@arcgis/core/layers/support/MediaElementView.js"),enums=(__webpack_require__("./node_modules/@arcgis/core/renderers/SimpleRenderer.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/SimpleFillSymbol.js"),__webpack_require__("./node_modules/@arcgis/core/core/scheduling.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/tracking/Flags.js"),__webpack_require__("./node_modules/@arcgis/core/core/colorUtils.js"),__webpack_require__("./node_modules/@arcgis/core/config.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/defaultCIMValues.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/enums.js")),views_webgl_enums=(__webpack_require__("./node_modules/@arcgis/core/core/floatRGBA.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/Geometry.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/Multipoint.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/Point.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/Polygon.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/Polyline.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/definitions.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/animations/instructions.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/Font.js"),__webpack_require__("./node_modules/@arcgis/core/core/mathUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/ObjectPool.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/support/Axis.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/support/spatialReferenceUtils.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/support/TileClipper.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/effects/EffectAddControlPoints.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/effects/EffectArrow.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/effects/EffectBuffer.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/effects/EffectControlMeasureLine.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/effects/EffectCut.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/effects/EffectDashes.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/effects/EffectDonut.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/effects/EffectJog.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/effects/EffectMove.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/effects/EffectOffset.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/effects/EffectReverse.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/effects/EffectRotate.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/effects/EffectScale.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/effects/EffectWave.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/placements/PlacementAlongLineSameSize.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/placements/PlacementAtExtremities.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/placements/PlacementAtRatioPositions.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/placements/PlacementInsidePolygon.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/placements/PlacementOnLine.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/placements/PlacementOnVertices.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/placements/PlacementPolygonCenter.js"),__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/vec2f32.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/alignmentUtils.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/support/defaults.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/cim/OverrideHelper.js"),__webpack_require__("./node_modules/@arcgis/core/layers/effects/EffectView.js"),__webpack_require__("./node_modules/@arcgis/core/core/Evented.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/transitions/FadeTransition.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/enums.js"),__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/vec4f32.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/enums.js")),Texture=(__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/BackgroundPrograms.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/checkWebGLError.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/DefaultVertexAttributeLayouts.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/AFeatureTile.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/DisplayEntity.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/featureTechniqueUtils.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/number.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/PooledUint32Array.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/TileInfoPrograms.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/Texture.js")),TileQueue=(__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/vectorTiles/style/StyleDefinition.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/vectorTiles/enums.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/BitBlitPrograms.js"),__webpack_require__("./node_modules/@arcgis/core/request.js"),__webpack_require__("./node_modules/@arcgis/core/core/urlUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/pbf.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/StencilPrograms.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/TechniqueType.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/shaders/BlendShader.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/shaders/OpacityShader.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/HighlightPrograms.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/FramebufferObject.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/meshing/SimpleMesh.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/GLObjectType.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/Profiler.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/TechniqueRegistry.js"),__webpack_require__("./node_modules/@arcgis/core/Color.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/shaders/constants.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/dotDensity/DotDensityMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/fill/ComplexFillMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/fill/ComplexOutlineFillMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/fill/FillMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/fill/GradientFillMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/fill/OutlineFillMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/fill/PatternFillMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/fill/PatternOutlineFillMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/heatmap/HeatmapMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingBox.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/text/TextMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/line/GradientStrokeMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/line/LineMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/line/TexturedLineMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/markers/MarkerMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/arcade/ArcadeDate.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/SpatialReference.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/pieChart/PieChartMeshWriter.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/renderState.js"),__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/glsl.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/testSVGPremultipliedAlpha.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/LabelManager.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/graphics/GraphicsView2D.js"),__webpack_require__("./node_modules/@arcgis/core/chunks/earcut.js"),__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/vec3f32.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/support/normalizeUtilsCommon.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/support/Ellipsoid.js"),__webpack_require__("./node_modules/@arcgis/core/kernel.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/support/util.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/navigation/MapViewNavigation.js"),__webpack_require__("./node_modules/@arcgis/core/core/asyncUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/support/UpdatingHandles.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/shaders/MagnifierShader.js"),__webpack_require__("./node_modules/@arcgis/core/core/unitUtils.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/ellipsoidUtils.js"),__webpack_require__("./node_modules/@arcgis/core/chunks/pe.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/projection/projectors.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/shaders/GridShader.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/support/geodesicConstants.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/tiling/TileInfoView.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/tiling/TileKey.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/tiling/TileQueue.js")),TileStrategy=__webpack_require__("./node_modules/@arcgis/core/views/2d/tiling/TileStrategy.js"),events=__webpack_require__("./node_modules/@arcgis/core/core/events.js"),Handles=__webpack_require__("./node_modules/@arcgis/core/core/Handles.js"),maybe=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),perspectiveUtils=__webpack_require__("./node_modules/@arcgis/core/core/perspectiveUtils.js"),mat3f64=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/mat3f64.js"),vec2=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/math/vec2.js"),vec2f64=__webpack_require__("./node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/vec2f64.js"),mediaLayerUtils=__webpack_require__("./node_modules/@arcgis/core/support/mediaLayerUtils.js"),DisplayObject=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/DisplayObject.js"),utils=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/animatedFormats/utils.js"),TextureDescriptor=__webpack_require__("./node_modules/@arcgis/core/views/webgl/TextureDescriptor.js");const g=[1,1],v=(0,mat3f64.vt)(),b={none:enums.fu.None,loop:enums.fu.Loop,oscillate:enums.fu.Oscillate};class V extends DisplayObject.q{constructor(n){super(),this.elementView=n,this.isWrapAround=!1,this.wrapAroundShift=0,this.perspectiveTransform=(0,vec2f64.vt)(),this._handles=new Handles.A,this._vertices=new Float32Array(8),this._indices=new Uint16Array([0,0,0,1,1,0,1,1,1,1,0,0,0,0,0,1,1,0,1,1]),this._handles.add([(0,reactiveUtils.watch)((()=>this.elementView.element.opacity),(e=>this.opacity=e),reactiveUtils.Vh),(0,reactiveUtils.watch)((()=>[this.elementView.coords]),(()=>{this.requestRender()}),reactiveUtils.Vh),(0,reactiveUtils.watch)((()=>["animationOptions"in this.elementView.element&&this.elementView.element.animationOptions]),(()=>{this._handles.remove("play"),this.texture=(0,maybe.WD)(this.texture),this.requestRender()}),reactiveUtils.Vh),(0,reactiveUtils.when)((()=>this.elementView.element.loaded),(()=>{const e=this.elementView.element;this.ready(),(0,mediaLayerUtils.Ws)(e)&&null!=e.content&&(this._handles.add([(0,events.on)(e.content,"play",(()=>this.requestRender())),(0,events.on)(e.content,"loadeddata",(()=>this.requestRender())),(0,events.on)(e.content,"loaded",(()=>this.requestRender()))]),"requestVideoFrameCallback"in e.content?e.content.requestVideoFrameCallback((()=>this.requestRender())):this._handles.add([(0,events.on)(e.content,"seeked",(()=>this.requestRender()))]),this.requestRender())}),reactiveUtils.Vh)]),n.element.load().catch((t=>{Logger.A.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new core_Error.A("element-load-error","Element cannot be displayed",{element:n,error:t}))}))}getMesh(e){throw new Error("Method not implemented.")}destroy(){this._handles.destroy(),this.texture=(0,maybe.WD)(this.texture)}get textureSize(){return g}get dvsMat3(){return this.parent.dvsMat3}beforeRender(e){const{context:t}=e,r=this.elementView.element.content;if(null!=r){const e=r instanceof HTMLImageElement,i=r instanceof HTMLVideoElement,s=e?r.naturalWidth:i?r.videoWidth:r.width,n=e?r.naturalHeight:i?r.videoHeight:r.height;if(this._updatePerspectiveTransform(s,n),this.texture)i&&(this.texture.setData(r),this.texture.generateMipmap(),"requestVideoFrameCallback"in r?r.requestVideoFrameCallback((()=>this.requestRender())):r.paused||this.requestRender());else{const e=new TextureDescriptor.R;if(e.wrapMode=views_webgl_enums.pF.CLAMP_TO_EDGE,e.preMultiplyAlpha=!0,e.width=s,e.height=n,"getFrame"in r){const i=r=>{this.texture?this.texture.setData(r):this.texture=new Texture.g(t,e,r),this.requestRender()};"animationOptions"in this.elementView.element&&this._handles.add((0,utils.ZH)(r,function q(e){return e?{type:"CIMAnimatedSymbolProperties",...e,playAnimation:e.playing,repeatType:e.repeatType?b[e.repeatType]:void 0}:{type:"CIMAnimatedSymbolProperties"}}(this.elementView.element.animationOptions),null,i),"play")}else this.texture=new Texture.g(t,e,r);this.texture.generateMipmap(),i&&("requestVideoFrameCallback"in r?r.requestVideoFrameCallback((()=>this.requestRender())):r.paused||this.requestRender())}}super.beforeRender(e)}_createTransforms(){return null}draw(e,t){this.isReady&&null!=this.texture?t.render(e,{transform:{dvs:this.dvsMat3},config:{perspective:this.perspectiveTransform,texSize:g,wrapAroundShift:this.wrapAroundShift,isWrapAround:this.isWrapAround,opacity:this.opacity,texture:{texture:this.texture,unit:0}},position:this._vertices,tex:this._indices}):this.requestRender()}updateDrawCoords(e,t,r,i){const{coords:s,bounds:n}=this.elementView;if(null==s||null==n)return;const[o,a,l,d]=s.rings[0],m=this._vertices,{x:h,y:p}=e;m.set([a[0]-h,a[1]-p,o[0]-h,o[1]-p,l[0]-h,l[1]-p,d[0]-h,d[1]-p]);let u=t;if(i){const[e,,t]=n,{worldWidth:r,xBounds:s}=i,[o,a]=s;e<o&&t>o?u=r:t>a&&e<a&&(u=-r)}this.wrapAroundShift=u,this.isWrapAround=0!==u}_updatePerspectiveTransform(e,t){const r=this._vertices;(0,perspectiveUtils.O)(v,[0,0,e,0,0,t,e,t],[r[0],r[1],r[4],r[5],r[2],r[3],r[6],r[7]]),(0,vec2.hZ)(this.perspectiveTransform,v[6]/v[8]*e,v[7]/v[8]*t)}}var OverlayContainer=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/OverlayContainer.js"),LayerView2D=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/LayerView2D.js"),LayerView=__webpack_require__("./node_modules/@arcgis/core/views/layers/LayerView.js"),Accessor=__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js");let t=class extends Accessor.A{constructor(o){super(o),this.editSourcePoints=!1}};(0,tslib_es6._)([(0,property.MZ)()],t.prototype,"editSourcePoints",void 0),t=(0,tslib_es6._)([(0,subclass.$)("esri.views.3d.layers.support.MediaLayerInteractionOptions.ReshapeOptions")],t);let p=class extends Accessor.A{constructor(o){super(o),this.tool="transform",this.reshapeOptions=new t}};(0,tslib_es6._)([(0,property.MZ)()],p.prototype,"tool",void 0),(0,tslib_es6._)([(0,property.MZ)({type:t})],p.prototype,"reshapeOptions",void 0),p=(0,tslib_es6._)([(0,subclass.$)("esri.views.3d.layers.support.MediaLayerInteractionOptions")],p);const s=s=>{let i=class extends s{constructor(...e){super(...e),this.layer=null,this.interactive=!1,this.interactionOptions=new p,this.selectedElement=null}highlight(e,t){throw new Error("missing implementation")}};return(0,tslib_es6._)([(0,property.MZ)()],i.prototype,"layer",void 0),(0,tslib_es6._)([(0,property.MZ)()],i.prototype,"interactive",void 0),(0,tslib_es6._)([(0,property.MZ)({type:p})],i.prototype,"interactionOptions",void 0),(0,tslib_es6._)([(0,property.MZ)()],i.prototype,"selectedElement",void 0),i=(0,tslib_es6._)([(0,subclass.$)("esri.views.layers.MediaLayerView")],i),i};var Scheduler=__webpack_require__("./node_modules/@arcgis/core/views/support/Scheduler.js");let G=class extends((0,LayerView2D.e)(s(LayerView.A))){constructor(){super(...arguments),this._overlayContainer=null,this._fetchQueue=null,this._tileStrategy=null,this._elementReferences=new Map,this._debugGraphicsView=null,this._interaction=null,this.layer=null,this.elements=new Collection.A}initialize(){this.addHandles([(0,reactiveUtils.watch)((()=>[this.interactive,this.suspended]),(async()=>{if(this.interactive&&!this._interaction){const{MediaLayerInteraction:e}=await __webpack_require__.e(3280).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/views/2d/layers/support/MediaLayerInteraction.js"));this._interaction=new e({view:this.view,layer:this.layer}),this.selectedElement!==this._interaction.selectedElement&&(this._interaction.selectedElement=this.selectedElement),this.interactionOptions!==this._interaction.options&&(this._interaction.options=this.interactionOptions)}this._interaction&&(this._interaction.enabled=!this.suspended&&this.interactive)}),reactiveUtils.pc),(0,reactiveUtils.watch)((()=>this.interactionOptions),(e=>{this._interaction&&(this._interaction.options=e)}),reactiveUtils.pc),(0,reactiveUtils.watch)((()=>this.selectedElement),(e=>{this._interaction&&(this._interaction.selectedElement=e)}),reactiveUtils.pc)])}attach(){this.addAttachHandles([(0,reactiveUtils.on)((()=>this.layer.effectiveSource),"refresh",(()=>{this._tileStrategy.refresh((e=>this._updateTile(e))),this.requestUpdate()})),(0,reactiveUtils.on)((()=>this.layer.effectiveSource),"change",(({element:e})=>this._elementUpdateHandler(e)))]),this._overlayContainer=new OverlayContainer.A,this.container.addChild(this._overlayContainer),this._fetchQueue=new TileQueue.A({tileInfoView:this.view.featuresTilingScheme,concurrency:10,process:(e,t)=>this._queryElements(e,t),scheduler:this.scheduler,priority:Scheduler.W6.MAPVIEW_FETCH_QUEUE}),this._tileStrategy=new TileStrategy.A({cachePolicy:"purge",resampling:!0,acquireTile:e=>this._acquireTile(e),releaseTile:e=>this._releaseTile(e),tileInfoView:this.view.featuresTilingScheme}),this.requestUpdate()}detach(){this.elements.removeAll(),this._tileStrategy.destroy(),this._fetchQueue.destroy(),this._overlayContainer.removeAllChildren(),this.container.removeAllChildren(),this._elementReferences.clear(),this._debugGraphicsView?.destroy()}supportsSpatialReference(e){return!0}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}update(e){this._tileStrategy.update(e),this._debugGraphicsView?.update(e)}async hitTest(e,t){const i=[],s=e.normalize(),r=[s.x,s.y];for(const{elementView:{normalizedCoords:o,element:n}}of this._elementReferences.values())null!=o&&(0,contains.t1)(o.rings,r)&&i.push({type:"media",element:n,layer:this.layer,mapPoint:e,sourcePoint:n.toSource(e)});return i.reverse()}canResume(){return null!=this.layer.source&&super.canResume()}async doRefresh(){this._fetchQueue.reset(),this._tileStrategy.refresh((e=>this._updateTile(e)))}_acquireTile(e){const t=new C(e.clone());return this._updateTile(t),t}_updateTile(e){this._updatingHandles.addPromise(this._fetchQueue.push(e.key).then((t=>{const[i,s]=e.setElements(t);this._referenceElements(e,i),this._dereferenceElements(e,s),this.requestUpdate()}),(e=>{(0,promiseUtils.zf)(e)||Logger.A.getLogger(this).error(e)})))}_releaseTile(e){this._fetchQueue.abort(e.key.id),e.elements&&this._dereferenceElements(e,e.elements),this.requestUpdate()}async _queryElements(e,t){const i=this.layer.effectiveSource;if(null==i)return[];this.view.featuresTilingScheme.getTileBounds(S,e,!0);const s=new Extent.default({xmin:S[0],ymin:S[1],xmax:S[2],ymax:S[3],spatialReference:this.view.spatialReference});return i.queryElements(s,t)}_referenceElements(e,t){if(null!=this.layer.source)for(const i of t)this._referenceElement(e,i)}_referenceElement(e,t){(0,MapUtils.tE)(this._elementReferences,t.uid,(()=>{const e=new MediaElementView._({element:t,spatialReference:this.view.spatialReference}),r=new V(e);return this._overlayContainer.addChild(r),this.elements.add(t),this._updatingHandles.addPromise(t.load().catch((e=>{Logger.A.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new core_Error.A("element-load-error","Element cannot be displayed",{element:t,error:e}))}))),{debugGraphic:null,elementView:e,overlay:r,tiles:new Set}})).tiles.add(e)}_dereferenceElements(e,t){for(const i of t)this._dereferenceElement(e,i)}_dereferenceElement(e,t){const i=this._elementReferences.get(t.uid);i.tiles.delete(e),i.tiles.size||(this._overlayContainer.removeChild(i.overlay),i.overlay.destroy(),i.elementView.destroy(),this._elementReferences.delete(t.uid),this.elements.remove(t),this._debugGraphicsView?.graphics.remove(i.debugGraphic))}_elementUpdateHandler(e){let t=this._elementReferences.get(e.uid);if(t){const i=t.elementView.normalizedCoords;if(null==i)return this._overlayContainer.removeChild(t.overlay),t.overlay.destroy(),t.elementView.destroy(),this._elementReferences.delete(e.uid),this.elements.remove(e),void this._debugGraphicsView?.graphics.remove(t.debugGraphic);const s=[],r=[];for(const e of this._tileStrategy.tiles){const o=T(this.view.featuresTilingScheme,e,i);t.tiles.has(e)?o||r.push(e):o&&s.push(e)}for(const t of s)this._referenceElement(t,e);for(const t of r)this._dereferenceElement(t,e);return t=this._elementReferences.get(e.uid),void(t?.debugGraphic&&(t.debugGraphic.geometry=t.elementView.normalizedCoords,this._debugGraphicsView.graphicUpdateHandler({graphic:t.debugGraphic,property:"geometry"})))}const i=new MediaElementView._({element:e,spatialReference:this.view.spatialReference}).normalizedCoords;if(null!=i)for(const s of this._tileStrategy.tiles)T(this.view.featuresTilingScheme,s,i)&&this._referenceElement(s,e)}};(0,tslib_es6._)([(0,property.MZ)()],G.prototype,"layer",void 0),(0,tslib_es6._)([(0,property.MZ)({readOnly:!0})],G.prototype,"elements",void 0),G=(0,tslib_es6._)([(0,subclass.$)("esri.views.2d.layers.MediaLayerView2D")],G);const S=(0,aaBoundingRect.vt)(),MediaLayerView2D_q={xmin:0,ymin:0,xmax:0,ymax:0};function T(e,t,i){return e.getTileBounds(S,t.key,!0),MediaLayerView2D_q.xmin=S[0],MediaLayerView2D_q.ymin=S[1],MediaLayerView2D_q.xmax=S[2],MediaLayerView2D_q.ymax=S[3],(0,intersectsBase.fA)(MediaLayerView2D_q,i)}class C{constructor(e){this.key=e,this.elements=null,this.isReady=!1,this.visible=!0}setElements(e){const t=[],i=new Set(this.elements);this.elements=e;for(const s of e)i.has(s)?i.delete(s):t.push(s);return this.isReady=!0,[t,Array.from(i)]}destroy(){}}const M=G}}]);