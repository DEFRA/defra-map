/*! For license information please see views-3d-interactive-editingTools.js.LICENSE.txt */
(self.webpackChunkdefraMap=self.webpackChunkdefraMap||[]).push([[4602],{3199:function(e){function t(e){return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}t.keys=function(){return[]},t.resolve=t,t.id=3199,e.exports=t},17858:function(e,t,n){"use strict";n.d(t,{L2:function(){return o},FK:function(){return Qe},wt:function(){return _t},xr:function(){return O},lh:function(){return F},$x:function(){return Ae},OX:function(){return a},h:function(){return A},w$:function(){return Ke},gv:function(){return Pt},Qu:function(){return l}});var i={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,formAssociated:!1,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0,experimentalSlotFixes:!1},r="app",s=Object.defineProperty,o={isDev:!!i.isDev,isBrowser:!0,isServer:!1,isTesting:!!i.isTesting},a=e=>{const t=new URL(e,vt.$resourcesUrl$);return t.origin!==mt.location.origin?t.href:t.pathname},l=e=>vt.$resourcesUrl$=e,c={},u=e=>"object"==(e=typeof e)||"function"===e;((e,t)=>{for(var n in t)s(e,n,{get:t[n],enumerable:!0})})({},{err:()=>d,map:()=>p,ok:()=>h,unwrap:()=>_,unwrapErr:()=>v});var h=e=>({isOk:!0,isErr:!1,value:e}),d=e=>({isOk:!1,isErr:!0,value:e});function p(e,t){if(e.isOk){const n=t(e.value);return n instanceof Promise?n.then((e=>h(e))):h(n)}if(e.isErr){const t=e.value;return d(t)}throw"should never get here"}var f,m,g,_=e=>{if(e.isOk)return e.value;throw e.value},v=e=>{if(e.isErr)return e.value;throw e.value},y=0,b=(e,t="")=>{if(i.profile&&performance.mark){const n=`st:${e}:${t}:${y++}`;return performance.mark(n),()=>performance.measure(`[Stencil] ${e}() <${t}>`,n)}return()=>{}},T="s-id",E="sty-id",x="c-id",S="http://www.w3.org/1999/xlink",w=["formAssociatedCallback","formResetCallback","formDisabledCallback","formStateRestoreCallback"],A=(e,t,...n)=>{let r=null,s=null,o=null,a=!1,l=!1;const c=[],h=t=>{for(let n=0;n<t.length;n++)r=t[n],Array.isArray(r)?h(r):null!=r&&"boolean"!=typeof r&&((a="function"!=typeof e&&!u(r))?r=String(r):i.isDev&&"function"!=typeof e&&void 0===r.$flags$&&ct("vNode passed as children has unexpected type.\nMake sure it's using the correct h() function.\nEmpty objects can also be the cause, look for JSX comments that became objects."),a&&l?c[c.length-1].$text$+=r:c.push(a?M(null,r):r),l=a)};if(h(n),t&&(i.isDev&&"input"===e&&D(t),i.vdomKey&&t.key&&(s=t.key),i.slotRelocation&&t.name&&(o=t.name),i.vdomClass)){const e=t.className||t.class;e&&(t.class="object"!=typeof e?e:Object.keys(e).filter((t=>e[t])).join(" "))}if(i.isDev&&c.some(R)&&ct("The <Host> must be the single root component. Make sure:\n- You are NOT using hostData() and <Host> in the same component.\n- <Host> is used once, and it's the single root component of the render() function."),i.vdomFunctional&&"function"==typeof e)return e(null===t?{}:t,c,C);const d=M(e,null);return d.$attrs$=t,c.length>0&&(d.$children$=c),i.vdomKey&&(d.$key$=s),i.slotRelocation&&(d.$name$=o),d},M=(e,t)=>{const n={$flags$:0,$tag$:e,$text$:t,$elm$:null,$children$:null};return i.vdomAttribute&&(n.$attrs$=null),i.vdomKey&&(n.$key$=null),i.slotRelocation&&(n.$name$=null),n},O={},R=e=>e&&e.$tag$===O,C={forEach:(e,t)=>e.map(I).forEach(t),map:(e,t)=>e.map(I).map(t).map(P)},I=e=>({vattrs:e.$attrs$,vchildren:e.$children$,vkey:e.$key$,vname:e.$name$,vtag:e.$tag$,vtext:e.$text$}),P=e=>{if("function"==typeof e.vtag){const t={...e.vattrs};return e.vkey&&(t.key=e.vkey),e.vname&&(t.name=e.vname),A(e.vtag,t,...e.vchildren||[])}const t=M(e.vtag,e.vtext);return t.$attrs$=e.vattrs,t.$children$=e.vchildren,t.$key$=e.vkey,t.$name$=e.vname,t},D=e=>{const t=Object.keys(e),n=t.indexOf("value");if(-1===n)return;const i=t.indexOf("type"),r=t.indexOf("min"),s=t.indexOf("max"),o=t.indexOf("step");(n<i||n<r||n<s||n<o)&&ut('The "value" prop of <input> should be set after "min", "max", "type" and "step"')},L=(e,t,n,r,s,o,a)=>{let l,c,u,h;if(1===o.nodeType){for(l=o.getAttribute(x),l&&(c=l.split("."),c[0]!==a&&"0"!==c[0]||(u={$flags$:0,$hostId$:c[0],$nodeId$:c[1],$depth$:c[2],$index$:c[3],$tag$:o.tagName.toLowerCase(),$elm$:o,$attrs$:null,$children$:null,$key$:null,$name$:null,$text$:null},t.push(u),o.removeAttribute(x),e.$children$||(e.$children$=[]),e.$children$[u.$index$]=u,e=u,r&&"0"===u.$depth$&&(r[u.$index$]=u.$elm$))),h=o.childNodes.length-1;h>=0;h--)L(e,t,n,r,s,o.childNodes[h],a);if(o.shadowRoot)for(h=o.shadowRoot.childNodes.length-1;h>=0;h--)L(e,t,n,r,s,o.shadowRoot.childNodes[h],a)}else if(8===o.nodeType)c=o.nodeValue.split("."),c[1]!==a&&"0"!==c[1]||(l=c[0],u={$flags$:0,$hostId$:c[1],$nodeId$:c[2],$depth$:c[3],$index$:c[4],$elm$:o,$attrs$:null,$children$:null,$key$:null,$name$:null,$tag$:null,$text$:null},"t"===l?(u.$elm$=o.nextSibling,u.$elm$&&3===u.$elm$.nodeType&&(u.$text$=u.$elm$.textContent,t.push(u),o.remove(),e.$children$||(e.$children$=[]),e.$children$[u.$index$]=u,r&&"0"===u.$depth$&&(r[u.$index$]=u.$elm$))):u.$hostId$===a&&("s"===l?(u.$tag$="slot",c[5]?o["s-sn"]=u.$name$=c[5]:o["s-sn"]="",o["s-sr"]=!0,i.shadowDom&&r&&(u.$elm$=gt.createElement(u.$tag$),u.$name$&&u.$elm$.setAttribute("name",u.$name$),o.parentNode.insertBefore(u.$elm$,o),o.remove(),"0"===u.$depth$&&(r[u.$index$]=u.$elm$)),n.push(u),e.$children$||(e.$children$=[]),e.$children$[u.$index$]=u):"r"===l&&(i.shadowDom&&r?o.remove():i.slotRelocation&&(s["s-cr"]=o,o["s-cn"]=!0))));else if(e&&"style"===e.$tag$){const t=M(null,o.textContent);t.$elm$=o,t.$index$="0",e.$children$=[t]}},N=(e,t)=>{if(1===e.nodeType){let n=0;for(;n<e.childNodes.length;n++)N(e.childNodes[n],t);if(e.shadowRoot)for(n=0;n<e.shadowRoot.childNodes.length;n++)N(e.shadowRoot.childNodes[n],t)}else if(8===e.nodeType){const n=e.nodeValue.split(".");"o"===n[0]&&(t.set(n[1]+"."+n[2],e),e.nodeValue="",e["s-en"]=n[3])}},F=(e,t,n)=>{const r=(e=>i.lazyLoad?rt(e).$hostElement$:e)(e);return{emit:e=>(i.isDev&&!r.isConnected&&ut(`The "${t}" event was emitted, but the dispatcher node is no longer connected to the dom.`),z(r,t,{bubbles:!!(4&n),composed:!!(2&n),cancelable:!!(1&n),detail:e}))}},z=(e,t,n)=>{const i=vt.ce(t,n);return e.dispatchEvent(i),i},V=new WeakMap,H=(e,t,n)=>{var r;const s=U(t,n),o=pt.get(s);if(!i.attachStyles)return s;if(e=11===e.nodeType?e:gt,o)if("string"==typeof o){e=e.head||e;let n,a=V.get(e);if(a||V.set(e,a=new Set),!a.has(s)){if(i.hydrateClientSide&&e.host&&(n=e.querySelector(`[${E}="${s}"]`)))n.innerHTML=o;else{n=gt.createElement("style"),n.innerHTML=o;const t=null!=(r=vt.$nonce$)?r:function(e){var t,n,i;return null!=(i=null==(n=null==(t=e.head)?void 0:t.querySelector('meta[name="csp-nonce"]'))?void 0:n.getAttribute("content"))?i:void 0}(gt);null!=t&&n.setAttribute("nonce",t),(i.hydrateServerSide||i.hotModuleReplacement)&&n.setAttribute(E,s),e.insertBefore(n,e.querySelector("link"))}4&t.$flags$&&(n.innerHTML+="slot-fb{display:contents}slot-fb[hidden]{display:none}"),a&&a.add(s)}}else i.constructableCSS&&!e.adoptedStyleSheets.includes(o)&&(e.adoptedStyleSheets=[...e.adoptedStyleSheets,o]);return s},U=(e,t)=>"sc-"+(i.mode&&t&&32&e.$flags$?e.$tagName$+"-"+t:e.$tagName$),k=(e,t,n,r,s,o)=>{if(n!==r){let a=ot(e,t),l=t.toLowerCase();if(i.vdomClass&&"class"===t){const t=e.classList,i=G(n),s=G(r);t.remove(...i.filter((e=>e&&!s.includes(e)))),t.add(...s.filter((e=>e&&!i.includes(e))))}else if(i.vdomStyle&&"style"===t){if(i.updatable)for(const t in n)r&&null!=r[t]||(!i.hydrateServerSide&&t.includes("-")?e.style.removeProperty(t):e.style[t]="");for(const t in r)n&&r[t]===n[t]||(!i.hydrateServerSide&&t.includes("-")?e.style.setProperty(t,r[t]):e.style[t]=r[t])}else if(i.vdomKey&&"key"===t);else if(i.vdomRef&&"ref"===t)r&&r(e);else if(!i.vdomListener||(i.lazyLoad?a:e.__lookupSetter__(t))||"o"!==t[0]||"n"!==t[1]){if(i.vdomPropOrAttr){const c=u(r);if((a||c&&null!==r)&&!s)try{if(e.tagName.includes("-"))e[t]=r;else{const i=null==r?"":r;"list"===t?a=!1:null!=n&&e[t]==i||(e[t]=i)}}catch(e){}let h=!1;i.vdomXlink&&l!==(l=l.replace(/^xlink\:?/,""))&&(t=l,h=!0),null==r||!1===r?!1===r&&""!==e.getAttribute(t)||(i.vdomXlink&&h?e.removeAttributeNS(S,t):e.removeAttribute(t)):(!a||4&o||s)&&!c&&(r=!0===r?"":r,i.vdomXlink&&h?e.setAttributeNS(S,t,r):e.setAttribute(t,r))}}else if(t="-"===t[2]?t.slice(3):ot(mt,l)?l.slice(2):l[2]+t.slice(3),n||r){const i=t.endsWith(B);t=t.replace($,""),n&&vt.rel(e,t,n,i),r&&vt.ael(e,t,r,i)}}},j=/\s/,G=e=>e?e.split(j):[],B="Capture",$=new RegExp(B+"$"),Z=(e,t,n)=>{const r=11===t.$elm$.nodeType&&t.$elm$.host?t.$elm$.host:t.$elm$,s=e&&e.$attrs$||c,o=t.$attrs$||c;if(i.updatable)for(const e of W(Object.keys(s)))e in o||k(r,e,s[e],void 0,n,t.$flags$);for(const e of W(Object.keys(o)))k(r,e,s[e],o[e],n,t.$flags$)};function W(e){return e.includes("ref")?[...e.filter((e=>"ref"!==e)),"ref"]:e}var q=!1,X=!1,Y=!1,K=!1,Q=(e,t,n,r)=>{var s;const o=t.$children$[n];let a,l,c,u=0;if(i.slotRelocation&&!q&&(Y=!0,"slot"===o.$tag$&&(f&&r.classList.add(f+"-s"),o.$flags$|=o.$children$?2:1)),i.isDev&&o.$elm$&&ct(`The JSX ${null!==o.$text$?`"${o.$text$}" text`:`"${o.$tag$}" element`} node should not be shared within the same renderer. The renderer caches element lookups in order to improve performance. However, a side effect from this is that the exact same JSX node should not be reused. For more information please see https://stenciljs.com/docs/templating-jsx#avoid-shared-jsx-nodes`),i.vdomText&&null!==o.$text$)a=o.$elm$=gt.createTextNode(o.$text$);else if(i.slotRelocation&&1&o.$flags$)a=o.$elm$=i.isDebug||i.hydrateServerSide?ge(o):gt.createTextNode("");else{if(i.svg&&!K&&(K="svg"===o.$tag$),a=o.$elm$=i.svg?gt.createElementNS(K?"http://www.w3.org/2000/svg":"http://www.w3.org/1999/xhtml",i.slotRelocation&&2&o.$flags$?"slot-fb":o.$tag$):gt.createElement(i.slotRelocation&&2&o.$flags$?"slot-fb":o.$tag$),i.svg&&K&&"foreignObject"===o.$tag$&&(K=!1),i.vdomAttribute&&Z(null,o,K),(i.shadowDom||i.scoped)&&null!=f&&a["s-si"]!==f&&a.classList.add(a["s-si"]=f),o.$children$)for(u=0;u<o.$children$.length;++u)l=Q(e,o,u,a),l&&a.appendChild(l);i.svg&&("svg"===o.$tag$?K=!1:"foreignObject"===a.tagName&&(K=!0))}return a["s-hn"]=g,i.slotRelocation&&3&o.$flags$&&(a["s-sr"]=!0,a["s-cr"]=m,a["s-sn"]=o.$name$||"",a["s-rf"]=null==(s=o.$attrs$)?void 0:s.ref,c=e&&e.$children$&&e.$children$[n],c&&c.$tag$===o.$tag$&&e.$elm$&&(i.experimentalSlotFixes?J(e.$elm$):ee(e.$elm$,!1))),a},J=e=>{vt.$flags$|=1;const t=e.closest(g.toLowerCase());if(null!=t){const n=Array.from(t.childNodes).find((e=>e["s-cr"])),i=Array.from(e.childNodes);for(const e of n?i.reverse():i)null!=e["s-sh"]&&(de(t,e,null!=n?n:null),e["s-sh"]=void 0,Y=!0)}vt.$flags$&=-2},ee=(e,t)=>{vt.$flags$|=1;const n=Array.from(e.childNodes);if(e["s-sr"]&&i.experimentalSlotFixes){let t=e;for(;t=t.nextSibling;)t&&t["s-sn"]===e["s-sn"]&&t["s-sh"]===g&&n.push(t)}for(let e=n.length-1;e>=0;e--){const i=n[e];i["s-hn"]!==g&&i["s-ol"]&&(de(se(i),i,re(i)),i["s-ol"].remove(),i["s-ol"]=void 0,i["s-sh"]=void 0,Y=!0),t&&ee(i,t)}vt.$flags$&=-2},te=(e,t,n,r,s,o)=>{let a,l=i.slotRelocation&&e["s-cr"]&&e["s-cr"].parentNode||e;for(i.shadowDom&&l.shadowRoot&&l.tagName===g&&(l=l.shadowRoot);s<=o;++s)r[s]&&(a=Q(null,n,s,e),a&&(r[s].$elm$=a,de(l,a,i.slotRelocation?re(t):t)))},ne=(e,t,n)=>{for(let r=t;r<=n;++r){const t=e[r];if(t){const e=t.$elm$;he(t),e&&(i.slotRelocation&&(X=!0,e["s-ol"]?e["s-ol"].remove():ee(e,!0)),e.remove())}}},ie=(e,t,n=!1)=>e.$tag$===t.$tag$&&(i.slotRelocation&&"slot"===e.$tag$?e.$name$===t.$name$:!(i.vdomKey&&!n)||e.$key$===t.$key$),re=e=>e&&e["s-ol"]||e,se=e=>(e["s-ol"]?e["s-ol"]:e).parentNode,oe=(e,t,n=!1)=>{const r=t.$elm$=e.$elm$,s=e.$children$,o=t.$children$,a=t.$tag$,l=t.$text$;let c;i.vdomText&&null!==l?i.vdomText&&i.slotRelocation&&(c=r["s-cr"])?c.parentNode.textContent=l:i.vdomText&&e.$text$!==l&&(r.data=l):(i.svg&&(K="svg"===a||"foreignObject"!==a&&K),(i.vdomAttribute||i.reflect)&&(i.slot&&"slot"===a&&!q?i.experimentalSlotFixes&&e.$name$!==t.$name$&&(t.$elm$["s-sn"]=t.$name$||"",J(t.$elm$.parentElement)):Z(e,t,K)),i.updatable&&null!==s&&null!==o?((e,t,n,r,s=!1)=>{let o,a,l=0,c=0,u=0,h=0,d=t.length-1,p=t[0],f=t[d],m=r.length-1,g=r[0],_=r[m];for(;l<=d&&c<=m;)if(null==p)p=t[++l];else if(null==f)f=t[--d];else if(null==g)g=r[++c];else if(null==_)_=r[--m];else if(ie(p,g,s))oe(p,g,s),p=t[++l],g=r[++c];else if(ie(f,_,s))oe(f,_,s),f=t[--d],_=r[--m];else if(ie(p,_,s))!i.slotRelocation||"slot"!==p.$tag$&&"slot"!==_.$tag$||ee(p.$elm$.parentNode,!1),oe(p,_,s),de(e,p.$elm$,f.$elm$.nextSibling),p=t[++l],_=r[--m];else if(ie(f,g,s))!i.slotRelocation||"slot"!==p.$tag$&&"slot"!==_.$tag$||ee(f.$elm$.parentNode,!1),oe(f,g,s),de(e,f.$elm$,p.$elm$),f=t[--d],g=r[++c];else{if(u=-1,i.vdomKey)for(h=l;h<=d;++h)if(t[h]&&null!==t[h].$key$&&t[h].$key$===g.$key$){u=h;break}i.vdomKey&&u>=0?(a=t[u],a.$tag$!==g.$tag$?o=Q(t&&t[c],n,u,e):(oe(a,g,s),t[u]=void 0,o=a.$elm$),g=r[++c]):(o=Q(t&&t[c],n,c,e),g=r[++c]),o&&(i.slotRelocation?de(se(p.$elm$),o,re(p.$elm$)):de(p.$elm$.parentNode,o,p.$elm$))}l>d?te(e,null==r[m+1]?null:r[m+1].$elm$,n,r,c,m):i.updatable&&c>m&&ne(t,l,d)})(r,s,t,o,n):null!==o?(i.updatable&&i.vdomText&&null!==e.$text$&&(r.textContent=""),te(r,null,t,o,0,o.length-1)):i.updatable&&null!==s&&ne(s,0,s.length-1),i.svg&&K&&"svg"===a&&(K=!1))},ae=e=>{const t=e.childNodes;for(const e of t)if(1===e.nodeType){if(e["s-sr"]){const n=e["s-sn"];e.hidden=!1;for(const i of t)if(i!==e)if(i["s-hn"]!==e["s-hn"]||""!==n){if(1===i.nodeType&&(n===i.getAttribute("slot")||n===i["s-sn"])||3===i.nodeType&&n===i["s-sn"]){e.hidden=!0;break}}else if(1===i.nodeType||3===i.nodeType&&""!==i.textContent.trim()){e.hidden=!0;break}}ae(e)}},le=[],ce=e=>{let t,n,r;for(const s of e.childNodes){if(s["s-sr"]&&(t=s["s-cr"])&&t.parentNode){n=t.parentNode.childNodes;const e=s["s-sn"];for(r=n.length-1;r>=0;r--)if(t=n[r],!(t["s-cn"]||t["s-nr"]||t["s-hn"]===s["s-hn"]||i.experimentalSlotFixes&&t["s-sh"]&&t["s-sh"]===s["s-hn"]))if(ue(t,e)){let n=le.find((e=>e.$nodeToRelocate$===t));X=!0,t["s-sn"]=t["s-sn"]||e,n?(n.$nodeToRelocate$["s-sh"]=s["s-hn"],n.$slotRefNode$=s):(t["s-sh"]=s["s-hn"],le.push({$slotRefNode$:s,$nodeToRelocate$:t})),t["s-sr"]&&le.map((e=>{ue(e.$nodeToRelocate$,t["s-sn"])&&(n=le.find((e=>e.$nodeToRelocate$===t)),n&&!e.$slotRefNode$&&(e.$slotRefNode$=n.$slotRefNode$))}))}else le.some((e=>e.$nodeToRelocate$===t))||le.push({$nodeToRelocate$:t})}1===s.nodeType&&ce(s)}},ue=(e,t)=>1===e.nodeType?null===e.getAttribute("slot")&&""===t||e.getAttribute("slot")===t:e["s-sn"]===t||""===t,he=e=>{i.vdomRef&&(e.$attrs$&&e.$attrs$.ref&&e.$attrs$.ref(null),e.$children$&&e.$children$.map(he))},de=(e,t,n)=>{const r=null==e?void 0:e.insertBefore(t,n);return i.scoped&&fe(t,e),r},pe=e=>e?e["s-rsc"]||e["s-si"]||e["s-sc"]||pe(e.parentElement):void 0,fe=(e,t)=>{var n,i,r;if(e&&t){const s=e["s-rsc"],o=pe(t);s&&(null==(n=e.classList)?void 0:n.contains(s))&&e.classList.remove(s),o&&(e["s-rsc"]=o,!(null==(i=e.classList)?void 0:i.contains(o))&&(null==(r=e.classList)||r.add(o)))}},me=(e,t,n=!1)=>{var r,s,o,a,l;const c=e.$hostElement$,u=e.$cmpMeta$,h=e.$vnode$||M(null,null),d=R(t)?t:A(null,null,t);if(g=c.tagName,i.isDev&&Array.isArray(t)&&t.some(R))throw new Error(`The <Host> must be the single root component.\nLooks like the render() function of "${g.toLowerCase()}" is returning an array that contains the <Host>.\n\nThe render() function should look like this instead:\n\nrender() {\n  // Do not return an array\n  return (\n    <Host>{content}</Host>\n  );\n}\n  `);if(i.reflect&&u.$attrsToReflect$&&(d.$attrs$=d.$attrs$||{},u.$attrsToReflect$.map((([e,t])=>d.$attrs$[t]=c[e]))),n&&d.$attrs$)for(const e of Object.keys(d.$attrs$))c.hasAttribute(e)&&!["key","ref","style","class"].includes(e)&&(d.$attrs$[e]=c[e]);if(d.$tag$=null,d.$flags$|=4,e.$vnode$=d,d.$elm$=h.$elm$=i.shadowDom&&c.shadowRoot||c,(i.scoped||i.shadowDom)&&(f=c["s-sc"]),q=yt&&0!=(1&u.$flags$),i.slotRelocation&&(m=c["s-cr"],X=!1),oe(h,d,n),i.slotRelocation){if(vt.$flags$|=1,Y){ce(d.$elm$);for(const e of le){const t=e.$nodeToRelocate$;if(!t["s-ol"]){const e=i.isDebug||i.hydrateServerSide?_e(t):gt.createTextNode("");e["s-nr"]=t,de(t.parentNode,t["s-ol"]=e,t)}}for(const e of le){const t=e.$nodeToRelocate$,l=e.$slotRefNode$;if(l){const e=l.parentNode;let n=l.nextSibling;if(!i.experimentalSlotFixes||n&&1===n.nodeType){let i=null==(r=t["s-ol"])?void 0:r.previousSibling;for(;i;){let r=null!=(s=i["s-nr"])?s:null;if(r&&r["s-sn"]===t["s-sn"]&&e===r.parentNode){for(r=r.nextSibling;r===t||(null==r?void 0:r["s-sr"]);)r=null==r?void 0:r.nextSibling;if(!r||!r["s-nr"]){n=r;break}}i=i.previousSibling}}(!n&&e!==t.parentNode||t.nextSibling!==n)&&t!==n&&(i.experimentalSlotFixes||t["s-hn"]||!t["s-ol"]||(t["s-hn"]=t["s-ol"].parentNode.nodeName),de(e,t,n),1===t.nodeType&&(t.hidden=null!=(o=t["s-ih"])&&o)),t&&"function"==typeof l["s-rf"]&&l["s-rf"](t)}else 1===t.nodeType&&(n&&(t["s-ih"]=null!=(a=t.hidden)&&a),t.hidden=!0)}}X&&ae(d.$elm$),vt.$flags$&=-2,le.length=0}if(i.experimentalScopedSlotChanges&&2&u.$flags$)for(const e of d.$elm$.childNodes)e["s-hn"]===g||e["s-sh"]||(n&&null==e["s-ih"]&&(e["s-ih"]=null!=(l=e.hidden)&&l),e.hidden=!0);m=void 0},ge=e=>gt.createComment(`<slot${e.$name$?' name="'+e.$name$+'"':""}> (host=${g.toLowerCase()})`),_e=e=>gt.createComment("org-location for "+(e.localName?`<${e.localName}> (host=${e["s-hn"]})`:`[${e.textContent}]`)),ve=(e,t)=>{i.asyncLoading&&t&&!e.$onRenderResolve$&&t["s-p"]&&t["s-p"].push(new Promise((t=>e.$onRenderResolve$=t)))},ye=(e,t)=>{if(i.taskQueue&&i.updatable&&(e.$flags$|=16),i.asyncLoading&&4&e.$flags$)return void(e.$flags$|=512);ve(e,e.$ancestorComponent$);const n=()=>be(e,t);return i.taskQueue?Dt(n):n()},be=(e,t)=>{const n=e.$hostElement$,r=b("scheduleUpdate",e.$cmpMeta$.$tagName$),s=i.lazyLoad?e.$lazyInstance$:n;if(!s)throw new Error(`Can't render component <${n.tagName.toLowerCase()} /> with invalid Stencil runtime! Make sure this imported component is compiled with a \`externalRuntime: true\` flag. For more information, please refer to https://stenciljs.com/docs/custom-elements#externalruntime`);let o;return t?(i.lazyLoad&&i.hostListener&&(e.$flags$|=256,e.$queuedListeners$&&(e.$queuedListeners$.map((([e,t])=>Oe(s,e,t))),e.$queuedListeners$=void 0)),Re(n,"componentWillLoad"),i.cmpWillLoad&&(o=Oe(s,"componentWillLoad"))):(Re(n,"componentWillUpdate"),i.cmpWillUpdate&&(o=Oe(s,"componentWillUpdate"))),Re(n,"componentWillRender"),i.cmpWillRender&&(o=Te(o,(()=>Oe(s,"componentWillRender")))),r(),Te(o,(()=>xe(e,s,t)))},Te=(e,t)=>Ee(e)?e.then(t):t(),Ee=e=>e instanceof Promise||e&&e.then&&"function"==typeof e.then,xe=async(e,t,n)=>{var r;const s=e.$hostElement$,o=b("update",e.$cmpMeta$.$tagName$),a=s["s-rc"];i.style&&n&&(e=>{const t=e.$cmpMeta$,n=e.$hostElement$,r=t.$flags$,s=b("attachStyles",t.$tagName$),o=H(i.shadowDom&&yt&&n.shadowRoot?n.shadowRoot:n.getRootNode(),t,e.$modeName$);(i.shadowDom||i.scoped)&&i.cssAnnotations&&10&r&&(n["s-sc"]=o,n.classList.add(o+"-h"),i.scoped&&2&r&&n.classList.add(o+"-s")),s()})(e);const l=b("render",e.$cmpMeta$.$tagName$);if(i.isDev&&(e.$flags$|=1024),i.hydrateServerSide?await Se(e,t,s,n):Se(e,t,s,n),i.isDev&&(e.$renderCount$=void 0===e.$renderCount$?1:e.$renderCount$+1,e.$flags$&=-1025),i.hydrateServerSide)try{Ie(s),n&&(1&e.$cmpMeta$.$flags$?s["s-en"]="":2&e.$cmpMeta$.$flags$&&(s["s-en"]="c"))}catch(e){at(e,s)}if(i.asyncLoading&&a&&(a.map((e=>e())),s["s-rc"]=void 0),l(),o(),i.asyncLoading){const t=null!=(r=s["s-p"])?r:[],n=()=>we(e);0===t.length?n():(Promise.all(t).then(n),e.$flags$|=4,t.length=0)}else we(e)},Se=(e,t,n,r)=>{const s=!!i.allRenderFn,o=!!i.lazyLoad,a=!!i.taskQueue,l=!!i.updatable;try{if(t=(s||t.render)&&t.render(),l&&a&&(e.$flags$&=-17),(l||o)&&(e.$flags$|=2),i.hasRenderFn||i.reflect)if(i.vdomRender||i.reflect){if(i.hydrateServerSide)return Promise.resolve(t).then((t=>me(e,t,r)));me(e,t,r)}else{const i=n.shadowRoot;1&e.$cmpMeta$.$flags$?i.textContent=t:n.textContent=t}}catch(t){at(t,e.$hostElement$)}return null},we=e=>{const t=e.$cmpMeta$.$tagName$,n=e.$hostElement$,r=b("postUpdate",t),s=i.lazyLoad?e.$lazyInstance$:n,o=e.$ancestorComponent$;i.cmpDidRender&&(i.isDev&&(e.$flags$|=1024),Oe(s,"componentDidRender"),i.isDev&&(e.$flags$&=-1025)),Re(n,"componentDidRender"),64&e.$flags$?(i.cmpDidUpdate&&(i.isDev&&(e.$flags$|=1024),Oe(s,"componentDidUpdate"),i.isDev&&(e.$flags$&=-1025)),Re(n,"componentDidUpdate"),r()):(e.$flags$|=64,i.asyncLoading&&i.cssAnnotations&&Ce(n),i.cmpDidLoad&&(i.isDev&&(e.$flags$|=2048),Oe(s,"componentDidLoad"),i.isDev&&(e.$flags$&=-2049)),Re(n,"componentDidLoad"),r(),i.asyncLoading&&(e.$onReadyResolve$(n),o||Me(t))),i.method&&i.lazyLoad&&e.$onInstanceResolve$(n),i.asyncLoading&&(e.$onRenderResolve$&&(e.$onRenderResolve$(),e.$onRenderResolve$=void 0),512&e.$flags$&&It((()=>ye(e,!1))),e.$flags$&=-517)},Ae=e=>{if(i.updatable&&(o.isBrowser||o.isTesting)){const t=rt(e),n=t.$hostElement$.isConnected;return n&&2==(18&t.$flags$)&&ye(t,!1),n}return!1},Me=e=>{i.cssAnnotations&&Ce(gt.documentElement),i.asyncQueue&&(vt.$flags$|=2),It((()=>z(mt,"appload",{detail:{namespace:r}}))),i.profile&&performance.measure&&performance.measure(`[Stencil] ${r} initial load (by ${e})`,"st:app:start")},Oe=(e,t,n)=>{if(e&&e[t])try{return e[t](n)}catch(e){at(e)}},Re=(e,t)=>{i.lifecycleDOMEvents&&z(e,"stencil_"+t,{bubbles:!0,composed:!0,detail:{namespace:r}})},Ce=e=>{var t,n;return i.hydratedClass?e.classList.add(null!=(t=i.hydratedSelectorName)?t:"hydrated"):i.hydratedAttribute?e.setAttribute(null!=(n=i.hydratedSelectorName)?n:"hydrated",""):void 0},Ie=e=>{const t=e.children;if(null!=t)for(let e=0,n=t.length;e<n;e++){const n=t[e];"function"==typeof n.connectedCallback&&n.connectedCallback(),Ie(n)}},Pe=(e,t,n)=>{var r;const s=e.prototype;if(i.formAssociated&&64&t.$flags$&&1&n&&w.forEach((e=>Object.defineProperty(s,e,{value(...t){const n=rt(this),r=i.lazyLoad?n.$hostElement$:this,s=i.lazyLoad?n.$lazyInstance$:r;if(s){const n=s[e];"function"==typeof n&&n.call(s,...t)}else n.$onReadyPromise$.then((n=>{const i=n[e];"function"==typeof i&&i.call(n,...t)}))}}))),i.member&&t.$members$){i.watchCallback&&e.watchers&&(t.$watchers$=e.watchers);const o=Object.entries(t.$members$);if(o.map((([e,[r]])=>{(i.prop||i.state)&&(31&r||(!i.lazyLoad||2&n)&&32&r)?Object.defineProperty(s,e,{get(){return t=e,rt(this).$instanceValues$.get(t);var t},set(s){if(i.isDev){const i=rt(this);0==(1&n)&&0===(i&&8&i.$flags$)&&0!=(31&r)&&0==(1024&r)&&ut(`@Prop() "${e}" on <${t.$tagName$}> is immutable but was modified from within the component.\nMore information: https://stenciljs.com/docs/properties#prop-mutability`)}((e,t,n,r)=>{const s=rt(e);if(i.lazyLoad&&!s)throw new Error(`Couldn't find host element for "${r.$tagName$}" as it is unknown to this Stencil runtime. This usually happens when integrating a 3rd party Stencil component with another Stencil component or application. Please reach out to the maintainers of the 3rd party Stencil component or report this on the Stencil Discord server (https://chat.stenciljs.com) or comment on this similar [GitHub issue](https://github.com/ionic-team/stencil/issues/5457).`);const o=i.lazyLoad?s.$hostElement$:e,a=s.$instanceValues$.get(t),l=s.$flags$,c=i.lazyLoad?s.$lazyInstance$:o;var h,d;h=n,d=r.$members$[t][0],n=null==h||u(h)?h:i.propBoolean&&4&d?"false"!==h&&(""===h||!!h):i.propNumber&&2&d?parseFloat(h):i.propString&&1&d?String(h):h;const p=Number.isNaN(a)&&Number.isNaN(n);if((!i.lazyLoad||!(8&l)||void 0===a)&&n!==a&&!p&&(s.$instanceValues$.set(t,n),i.isDev&&(1024&s.$flags$?ut(`The state/prop "${t}" changed during rendering. This can potentially lead to infinite-loops and other bugs.`,"\nElement",o,"\nNew value",n,"\nOld value",a):2048&s.$flags$&&ut(`The state/prop "${t}" changed during "componentDidLoad()", this triggers extra re-renders, try to setup on "componentWillLoad()"`,"\nElement",o,"\nNew value",n,"\nOld value",a)),!i.lazyLoad||c)){if(i.watchCallback&&r.$watchers$&&128&l){const e=r.$watchers$[t];e&&e.map((e=>{try{c[e](n,a,t)}catch(e){at(e,o)}}))}if(i.updatable&&2==(18&l)){if(i.cmpShouldUpdate&&c.componentShouldUpdate&&!1===c.componentShouldUpdate(n,a,t))return;ye(s,!1)}}})(this,e,s,t)},configurable:!0,enumerable:!0}):i.lazyLoad&&i.method&&1&n&&64&r&&Object.defineProperty(s,e,{value(...t){var n;const i=rt(this);return null==(n=null==i?void 0:i.$onInstancePromise$)?void 0:n.then((()=>{var n;return null==(n=i.$lazyInstance$)?void 0:n[e](...t)}))}})})),i.observeAttribute&&(!i.lazyLoad||1&n)){const n=new Map;s.attributeChangedCallback=function(e,r,o){vt.jmp((()=>{var a;const l=n.get(e);if(this.hasOwnProperty(l))o=this[l],delete this[l];else{if(s.hasOwnProperty(l)&&"number"==typeof this[l]&&this[l]==o)return;if(null==l){const n=rt(this),s=null==n?void 0:n.$flags$;if(s&&!(8&s)&&128&s&&o!==r){const s=i.lazyLoad?n.$hostElement$:this,l=i.lazyLoad?n.$lazyInstance$:s,c=null==(a=t.$watchers$)?void 0:a[e];null==c||c.forEach((t=>{null!=l[t]&&l[t].call(l,o,r,e)}))}return}}this[l]=(null!==o||"boolean"!=typeof this[l])&&o}))},e.observedAttributes=Array.from(new Set([...Object.keys(null!=(r=t.$watchers$)?r:{}),...o.filter((([e,t])=>15&t[0])).map((([e,r])=>{var s;const o=r[1]||e;return n.set(o,e),i.reflect&&512&r[0]&&(null==(s=t.$attrsToReflect$)||s.push([e,o])),o}))]))}}return e},De=async(e,t,r,s)=>{let o;if(0==(32&t.$flags$)){t.$flags$|=32;const c=r.$lazyBundleId$;if((i.lazyLoad||i.hydrateClientSide)&&c){const e=dt(r,t,s);if(e&&"then"in e){const n=(a=`st:load:${r.$tagName$}:${t.$modeName$}`,l=`[Stencil] Load module for <${r.$tagName$}>`,i.profile&&performance.mark?(0===performance.getEntriesByName(a,"mark").length&&performance.mark(a),()=>{0===performance.getEntriesByName(l,"measure").length&&performance.measure(l,a)}):()=>{});o=await e,n()}else o=e;if(!o)throw new Error(`Constructor for "${r.$tagName$}#${t.$modeName$}" was not found`);i.member&&!o.isProxied&&(i.watchCallback&&(r.$watchers$=o.watchers),Pe(o,r,2),o.isProxied=!0);const n=b("createInstance",r.$tagName$);i.member&&(t.$flags$|=8);try{new o(t)}catch(e){at(e)}i.member&&(t.$flags$&=-9),i.watchCallback&&(t.$flags$|=128),n(),Le(t.$lazyInstance$)}else{o=e.constructor;const n=e.localName;customElements.whenDefined(n).then((()=>t.$flags$|=128))}if(i.style&&o&&o.style){let s=o.style;i.mode&&"string"!=typeof s&&(t.$modeName$=(e=>ft.map((t=>t(e))).find((e=>!!e)))(e),t.$modeName$&&(s=s[t.$modeName$]),i.hydrateServerSide&&t.$modeName$&&e.setAttribute("s-mode",t.$modeName$));const a=U(r,t.$modeName$);if(!pt.has(a)){const e=b("registerStyles",r.$tagName$);!i.hydrateServerSide&&i.shadowDom&&i.shadowDomShim&&8&r.$flags$&&(s=await n.e(8473).then(n.bind(n,3545)).then((e=>e.scopeCss(s,a,!1)))),((e,t,n)=>{let i=pt.get(e);Tt&&n?(i=i||new CSSStyleSheet,"string"==typeof i?i=t:i.replaceSync(t)):i=t,pt.set(e,i)})(a,s,!!(1&r.$flags$)),e()}}}var a,l;const c=t.$ancestorComponent$,u=()=>ye(t,!0);i.asyncLoading&&c&&c["s-rc"]?c["s-rc"].push(u):u()},Le=e=>{i.lazyLoad&&i.connectedCallback&&Oe(e,"connectedCallback")},Ne=e=>{const t=e["s-cr"]=gt.createComment(i.isDebug?`content-ref (host=${e.localName})`:"");t["s-cn"]=!0,de(e,t,e.firstChild)},Fe=e=>{i.lazyLoad&&i.disconnectedCallback&&Oe(e,"disconnectedCallback"),i.cmpDidUnload&&Oe(e,"componentDidUnload")},ze=e=>{const t=e.cloneNode;e.cloneNode=function(e){const n=this,r=!!i.shadowDom&&n.shadowRoot&&yt,s=t.call(n,!!r&&e);if(i.slot&&!r&&e){let e,t,r=0;const o=["s-id","s-cr","s-lr","s-rc","s-sc","s-p","s-cn","s-sr","s-sn","s-hn","s-ol","s-nr","s-si","s-rf","s-rsc"];for(;r<n.childNodes.length;r++)e=n.childNodes[r]["s-nr"],t=o.every((e=>!n.childNodes[r][e])),e&&(i.appendChildSlotFix&&s.__appendChild?s.__appendChild(e.cloneNode(!0)):s.appendChild(e.cloneNode(!0))),t&&s.appendChild(n.childNodes[r].cloneNode(!0))}return s}},Ve=e=>{e.__appendChild=e.appendChild,e.appendChild=function(e){const t=e["s-sn"]=qe(e),n=Xe(this.childNodes,t,this.tagName);if(n){const i=Ye(n,t),r=i[i.length-1],s=de(r.parentNode,e,r.nextSibling);return ae(this),s}return this.__appendChild(e)}},He=e=>{e.__removeChild=e.removeChild,e.removeChild=function(e){if(e&&void 0!==e["s-sn"]){const t=Xe(this.childNodes,e["s-sn"],this.tagName);if(t){const n=Ye(t,e["s-sn"]).find((t=>t===e));if(n)return n.remove(),void ae(this)}}return this.__removeChild(e)}},Ue=e=>{const t=e.prepend;e.prepend=function(...e){e.forEach((e=>{"string"==typeof e&&(e=this.ownerDocument.createTextNode(e));const n=e["s-sn"]=qe(e),i=Xe(this.childNodes,n,this.tagName);if(i){const t=document.createTextNode("");t["s-nr"]=e,i["s-cr"].parentNode.__appendChild(t),e["s-ol"]=t;const r=Ye(i,n)[0];return de(r.parentNode,e,r.nextSibling)}return 1===e.nodeType&&e.getAttribute("slot")&&(e.hidden=!0),t.call(this,e)}))}},ke=e=>{e.append=function(...e){e.forEach((e=>{"string"==typeof e&&(e=this.ownerDocument.createTextNode(e)),this.appendChild(e)}))}},je=e=>{const t=e.insertAdjacentHTML;e.insertAdjacentHTML=function(e,n){if("afterbegin"!==e&&"beforeend"!==e)return t.call(this,e,n);const i=this.ownerDocument.createElement("_");let r;if(i.innerHTML=n,"afterbegin"===e)for(;r=i.firstChild;)this.prepend(r);else if("beforeend"===e)for(;r=i.firstChild;)this.append(r)}},Ge=e=>{e.insertAdjacentText=function(e,t){this.insertAdjacentHTML(e,t)}},Be=e=>{const t=e.insertAdjacentElement;e.insertAdjacentElement=function(e,n){return"afterbegin"!==e&&"beforeend"!==e?t.call(this,e,n):"afterbegin"===e?(this.prepend(n),n):"beforeend"===e?(this.append(n),n):n}},$e=e=>{const t=Object.getOwnPropertyDescriptor(Node.prototype,"textContent");Object.defineProperty(e,"__textContent",t),i.experimentalScopedSlotChanges?Object.defineProperty(e,"textContent",{get(){return" "+We(this.childNodes).map((e=>{var t,n;const i=[];let r=e.nextSibling;for(;r&&r["s-sn"]===e["s-sn"];)3!==r.nodeType&&1!==r.nodeType||i.push(null!=(n=null==(t=r.textContent)?void 0:t.trim())?n:""),r=r.nextSibling;return i.filter((e=>""!==e)).join(" ")})).filter((e=>""!==e)).join(" ")+" "},set(e){We(this.childNodes).forEach((t=>{let n=t.nextSibling;for(;n&&n["s-sn"]===t["s-sn"];){const e=n;n=n.nextSibling,e.remove()}if(""===t["s-sn"]){const n=this.ownerDocument.createTextNode(e);n["s-sn"]="",de(t.parentElement,n,t.nextSibling)}else t.remove()}))}}):Object.defineProperty(e,"textContent",{get(){var e;const t=Xe(this.childNodes,"",this.tagName);return 3===(null==(e=null==t?void 0:t.nextSibling)?void 0:e.nodeType)?t.nextSibling.textContent:t?t.textContent:this.__textContent},set(e){var t;const n=Xe(this.childNodes,"",this.tagName);if(3===(null==(t=null==n?void 0:n.nextSibling)?void 0:t.nodeType))n.nextSibling.textContent=e;else if(n)n.textContent=e;else{this.__textContent=e;const t=this["s-cr"];t&&de(this,t,this.firstChild)}}})},Ze=(e,t)=>{class n extends Array{item(e){return this[e]}}if(8&t.$flags$){const t=e.__lookupGetter__("childNodes");Object.defineProperty(e,"children",{get(){return this.childNodes.map((e=>1===e.nodeType))}}),Object.defineProperty(e,"childElementCount",{get(){return e.children.length}}),Object.defineProperty(e,"childNodes",{get(){const e=t.call(this);if(0==(1&vt.$flags$)&&2&rt(this).$flags$){const t=new n;for(let n=0;n<e.length;n++){const i=e[n]["s-nr"];i&&t.push(i)}return t}return n.from(e)}})}},We=e=>{const t=[];for(const n of Array.from(e))n["s-sr"]&&t.push(n),t.push(...We(n.childNodes));return t},qe=e=>e["s-sn"]||1===e.nodeType&&e.getAttribute("slot")||"",Xe=(e,t,n)=>{let i,r=0;for(;r<e.length;r++){if(i=e[r],i["s-sr"]&&i["s-sn"]===t&&i["s-hn"]===n)return i;if(i=Xe(i.childNodes,t,n),i)return i}return null},Ye=(e,t)=>{const n=[e];for(;(e=e.nextSibling)&&e["s-sn"]===t;)n.push(e);return n},Ke=(e,t)=>{const n={$flags$:t[0],$tagName$:t[1]};var r,s;i.member&&(n.$members$=t[2]),i.hostListener&&(n.$listeners$=t[3]),i.watchCallback&&(n.$watchers$=e.$watchers$),i.reflect&&(n.$attrsToReflect$=[]),i.shadowDom&&!yt&&1&n.$flags$&&(n.$flags$|=8),i.experimentalSlotFixes?i.scoped&&2&n.$flags$&&(r=e.prototype,s=n,ze(r),Ve(r),ke(r),Ue(r),Be(r),je(r),Ge(r),$e(r),Ze(r,s),He(r)):(i.slotChildNodesFix&&Ze(e.prototype,n),i.cloneNodeFix&&ze(e.prototype),i.appendChildSlotFix&&Ve(e.prototype),i.scopedSlotTextContentFix&&2&n.$flags$&&$e(e.prototype));const o=e.prototype.connectedCallback,a=e.prototype.disconnectedCallback;return Object.assign(e.prototype,{__registerHost(){st(this,n)},connectedCallback(){(e=>{if(0==(1&vt.$flags$)){const t=rt(e),n=t.$cmpMeta$,r=b("connectedCallback",n.$tagName$);if(i.hostListenerTargetParent&&Je(e,t,n.$listeners$,!0),1&t.$flags$)Je(e,t,n.$listeners$,!1),(null==t?void 0:t.$lazyInstance$)?Le(t.$lazyInstance$):(null==t?void 0:t.$onReadyPromise$)&&t.$onReadyPromise$.then((()=>Le(t.$lazyInstance$)));else{let r;if(t.$flags$|=1,i.hydrateClientSide&&(r=e.getAttribute(T),r)){if(i.shadowDom&&yt&&1&n.$flags$){const t=i.mode?H(e.shadowRoot,n,e.getAttribute("s-mode")):H(e.shadowRoot,n);e.classList.remove(t+"-h",t+"-s")}((e,t,n,r)=>{const s=b("hydrateClient",t),o=e.shadowRoot,a=[],l=i.shadowDom&&o?[]:null,c=r.$vnode$=M(t,null);vt.$orgLocNodes$||N(gt.body,vt.$orgLocNodes$=new Map),e[T]=n,e.removeAttribute(T),L(c,a,[],l,e,e,n),a.map((e=>{const n=e.$hostId$+"."+e.$nodeId$,i=vt.$orgLocNodes$.get(n),r=e.$elm$;i&&yt&&""===i["s-en"]&&i.parentNode.insertBefore(r,i.nextSibling),o||(r["s-hn"]=t,i&&(r["s-ol"]=i,r["s-ol"]["s-nr"]=r)),vt.$orgLocNodes$.delete(n)})),i.shadowDom&&o&&l.map((e=>{e&&o.appendChild(e)})),s()})(e,n.$tagName$,r,t)}if(i.slotRelocation&&!r&&(i.hydrateServerSide||(i.slot||i.shadowDom)&&12&n.$flags$)&&Ne(e),i.asyncLoading){let n=e;for(;n=n.parentNode||n.host;)if(i.hydrateClientSide&&1===n.nodeType&&n.hasAttribute("s-id")&&n["s-p"]||n["s-p"]){ve(t,t.$ancestorComponent$=n);break}}i.prop&&!i.hydrateServerSide&&n.$members$&&Object.entries(n.$members$).map((([t,[n]])=>{if(31&n&&e.hasOwnProperty(t)){const n=e[t];delete e[t],e[t]=n}})),i.initializeNextTick?It((()=>De(e,t,n))):De(e,t,n)}r()}})(this),i.connectedCallback&&o&&o.call(this)},disconnectedCallback(){(async e=>{if(0==(1&vt.$flags$)){const t=rt(e);i.hostListener&&t.$rmListeners$&&(t.$rmListeners$.map((e=>e())),t.$rmListeners$=void 0),i.lazyLoad?(null==t?void 0:t.$lazyInstance$)?Fe(t.$lazyInstance$):(null==t?void 0:t.$onReadyPromise$)&&t.$onReadyPromise$.then((()=>Fe(t.$lazyInstance$))):Fe(e)}})(this),i.disconnectedCallback&&a&&a.call(this)},__attachShadow(){yt?i.shadowDelegatesFocus?this.attachShadow({mode:"open",delegatesFocus:!!(16&n.$flags$)}):this.attachShadow({mode:"open"}):this.shadowRoot=this}}),e.is=n.$tagName$,Pe(e,n,3)},Qe=(e,t)=>t,Je=(e,t,n,r)=>{i.hostListener&&n&&(i.hostListenerTargetParent&&(n=r?n.filter((([e])=>32&e)):n.filter((([e])=>!(32&e)))),n.map((([n,r,s])=>{const o=i.hostListenerTarget?tt(e,n):e,a=et(t,s),l=nt(n);vt.ael(o,r,a,l),(t.$rmListeners$=t.$rmListeners$||[]).push((()=>vt.rel(o,r,a,l)))})))},et=(e,t)=>n=>{try{i.lazyLoad?256&e.$flags$?e.$lazyInstance$[t](n):(e.$queuedListeners$=e.$queuedListeners$||[]).push([t,n]):e.$hostElement$[t](n)}catch(e){at(e)}},tt=(e,t)=>i.hostListenerTargetDocument&&4&t?gt:i.hostListenerTargetWindow&&8&t?mt:i.hostListenerTargetBody&&16&t?gt.body:i.hostListenerTargetParent&&32&t?e.parentElement:e,nt=e=>bt?{passive:0!=(1&e),capture:0!=(2&e)}:0!=(2&e),it=i.hotModuleReplacement?window.__STENCIL_HOSTREFS__||(window.__STENCIL_HOSTREFS__=new WeakMap):new WeakMap,rt=e=>it.get(e),st=(e,t)=>{const n={$flags$:0,$hostElement$:e,$cmpMeta$:t,$instanceValues$:new Map};return i.isDev&&(n.$renderCount$=0),i.method&&i.lazyLoad&&(n.$onInstancePromise$=new Promise((e=>n.$onInstanceResolve$=e))),i.asyncLoading&&(n.$onReadyPromise$=new Promise((e=>n.$onReadyResolve$=e)),e["s-p"]=[],e["s-rc"]=[]),Je(e,n,t.$listeners$,!1),it.set(e,n)},ot=(e,t)=>t in e,at=(e,t)=>(0,console.error)(e,t),lt=i.isTesting?["STENCIL:"]:["%cstencil","color: white;background:#4c47ff;font-weight: bold; font-size:10px; padding:2px 6px; border-radius: 5px"],ct=(...e)=>console.error(...lt,...e),ut=(...e)=>console.warn(...lt,...e),ht=new Map,dt=(e,t,r)=>{const s=e.$tagName$.replace(/-/g,"_"),o=e.$lazyBundleId$;if(i.isDev&&"string"!=typeof o)return void ct(`Trying to lazily load component <${e.$tagName$}> with style mode "${t.$modeName$}", but it does not exist.`);const a=!i.hotModuleReplacement&&ht.get(o);return a?a[s]:n(3199)(`./${o}.entry.js${i.hotModuleReplacement&&r?"?s-hmr="+r:""}`).then((e=>(i.hotModuleReplacement||ht.set(o,e),e[s])),at)},pt=new Map,ft=[],mt="undefined"!=typeof window?window:{},gt=mt.document||{head:{}},_t=mt.HTMLElement||class{},vt={$flags$:0,$resourcesUrl$:"",jmp:e=>e(),raf:e=>requestAnimationFrame(e),ael:(e,t,n,i)=>e.addEventListener(t,n,i),rel:(e,t,n,i)=>e.removeEventListener(t,n,i),ce:(e,t)=>new CustomEvent(e,t)},yt=!i.shadowDomShim||!i.shadowDom||(()=>(gt.head.attachShadow+"").indexOf("[native")>-1)(),bt=(()=>{let e=!1;try{gt.addEventListener("e",null,Object.defineProperty({},"passive",{get(){e=!0}}))}catch(e){}return e})(),Tt=!!i.constructableCSS&&(()=>{try{return new CSSStyleSheet,"function"==typeof(new CSSStyleSheet).replaceSync}catch(e){}return!1})(),Et=0,xt=!1,St=[],wt=[],At=[],Mt=(e,t)=>n=>{e.push(n),xt||(xt=!0,t&&4&vt.$flags$?It(Ct):vt.raf(Ct))},Ot=e=>{for(let t=0;t<e.length;t++)try{e[t](performance.now())}catch(e){at(e)}e.length=0},Rt=(e,t)=>{let n=0,i=0;for(;n<e.length&&(i=performance.now())<t;)try{e[n++](i)}catch(e){at(e)}n===e.length?e.length=0:0!==n&&e.splice(0,n)},Ct=()=>{if(i.asyncQueue&&Et++,Ot(St),i.asyncQueue){const e=2==(6&vt.$flags$)?performance.now()+14*Math.ceil(.1*Et):1/0;Rt(wt,e),Rt(At,e),wt.length>0&&(At.push(...wt),wt.length=0),(xt=St.length+wt.length+At.length>0)?vt.raf(Ct):Et=0}else Ot(wt),(xt=St.length>0)&&vt.raf(Ct)},It=e=>Promise.resolve(void 0).then(e),Pt=Mt(St,!1),Dt=Mt(wt,!0)},38474:function(e,t,n){"use strict";n.d(t,{C:function(){return b},b:function(){return y}});var i=n(27264),r=n(13668),s=n(34178),o=n(27271),a=n(85709),l=n(84435),c=n(78946),u=n(58766),h=n(28686),d=n(23864),p=n(20830),f=n(38917),m=n(39506),g=n(62988),_=n(55890),v=n(65839);function y(e){const t=new g.N5,{vertex:n,fragment:y,attributes:b,varyings:T}=t;(0,p.NB)(n,e),t.include(s.d,e),t.include(a.c,e),t.include(u.A,e),t.include(o.g,e),b.add(v.r.POSITION,"vec3"),e.vvColor&&b.add(v.r.COLORFEATUREATTRIBUTE,"float"),T.add("vColor","vec4"),T.add("vpos","vec3");const E=e.multipassEnabled&&e.output===i.V.Color;E&&T.add("depth","float"),n.uniforms.add(new f.E("eColor",(e=>e.color))),n.code.add(m.H`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${e.hasVertexColors?"vColor *= eColor;":e.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${E?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),t.include(r.HQ,e),E&&t.include(c.Q,e),y.include(d.a);const x=e.output===i.V.Highlight;return x&&t.include(l.Qh,e),e.transparencyPassType===_.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),y.code.add(m.H`
  void main() {
    discardBySlice(vpos);
    ${E?"terrainDepthTest(depth);":""}
    vec4 fColor = vColor;

    ${e.output===i.V.ObjectAndLayerIdColor?m.H`fColor.a = 1.0;`:""}

    if (fColor.a < ${m.H.float(h.y)}) {
      discard;
    }

    ${e.output===i.V.Color?m.H`fragColor = highlightSlice(fColor, vpos); ${e.transparencyPassType===_.y.ColorAlpha?m.H`
                  fragColor = premultiplyAlpha(fragColor);
                  fragAlpha = fragColor.a;`:""}`:""}
    ${x?m.H`outputHighlight();`:""};
    ${e.output===i.V.ObjectAndLayerIdColor?m.H`outputObjectAndLayerIdColor();`:""}
  }
  `),t}const b=Object.freeze(Object.defineProperty({__proto__:null,build:y},Symbol.toStringTag,{value:"Module"}))},88008:function(e,t,n){"use strict";n.d(t,{H:function(){return P},b:function(){return O},c:function(){return C}});var i=n(13786),r=n(1932),s=n(41546),o=n(27264),a=n(13668),l=n(27271),c=n(10155),u=n(1143),h=n(50399),d=n(80231),p=n(84435),f=n(58766),m=n(28686),g=n(23864),_=n(52766),v=n(19202),y=n(20830),b=n(11687),T=n(38917),E=n(14543),x=n(39506),S=n(62988),w=n(39838),A=n(55890),M=n(65839);function O(e){const t=new S.N5,n=e.signedDistanceFieldEnabled;if(t.include(u.Q,e),t.include(a.HQ,e),e.occlusionPass)return t.include(h.I,e),t;const{vertex:r,fragment:O}=t;t.include(v.Y6),O.include(_.W),O.include(g.a),t.include(f.A,e),t.include(l.g,e),t.include(d.y),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),t.varyings.add("voccluded","float"),r.uniforms.add(new T.E("viewport",((e,t)=>t.camera.fullViewport)),new b.G("screenOffset",((e,t)=>(0,i.hZ)(I,2*e.screenOffset[0]*t.camera.pixelRatio,2*e.screenOffset[1]*t.camera.pixelRatio))),new b.G("anchorPosition",(e=>C(e))),new T.E("materialColor",(e=>e.color))),(0,y.Nz)(r),n&&(r.uniforms.add(new T.E("outlineColor",(e=>e.outlineColor))),O.uniforms.add(new T.E("outlineColor",(e=>R(e)?e.outlineColor:s.uY)),new E.m("outlineSize",(e=>R(e)?e.outlineSize:0)))),e.pixelSnappingEnabled&&r.include(c.K),e.hasScreenSizePerspective&&((0,v.pM)(r),(0,v.OH)(r)),e.debugDrawLabelBorder&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(M.r.UV0,"vec2"),t.attributes.add(M.r.COLOR,"vec4"),t.attributes.add(M.r.SIZE,"vec2"),t.attributes.add(M.r.FEATUREATTRIBUTE,"vec4"),r.code.add(x.H`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.hasScreenSizePerspective?x.H`
            inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
            vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:x.H`
            inputSize = size;
            vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(featureAttribute).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);
      bool visible = testHUDVisibility(posProj);
      voccluded = visible ? 0.0 : 1.0;
    `);const P=x.H`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,D=e.pixelSnappingEnabled?n?x.H`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:x.H`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:x.H`posProj += quadOffset;`;r.code.add(x.H`
    ${e.occlusionTestEnabled?"if (visible) {":""}
    ${P}
    ${e.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${e.output===o.V.ObjectAndLayerIdColor?x.H`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${x.H.float(m.y)};
    ${n?`alphaDiscard = alphaDiscard && outlineColor.a < ${x.H.float(m.y)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${D}
      gl_Position = posProj;
    }

    vtc = uv;

    ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${e.occlusionTestEnabled?x.H`} else { vtc = vec2(0.0);
      ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),O.uniforms.add(new w.N("tex",(e=>e.texture)));const L=e.debugDrawLabelBorder?x.H`(isBorder > 0.0 ? 0.0 : ${x.H.float(m.H)})`:x.H.float(m.H),N=x.H`
    ${e.debugDrawLabelBorder?x.H`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${e.sampleSignedDistanceFieldTexelCenter?x.H`
      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;
      `:x.H`
      vec2 samplePos = vtc;
      `}

    ${n?x.H`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${L} ||
          fillPixelColor.a + outlinePixelColor.a < ${x.H.float(m.y)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${L}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:x.H`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${L}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${e.debugDrawLabelBorder?x.H`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;switch(e.output){case o.V.Color:e.transparencyPassType===A.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),O.code.add(x.H`
        void main() {
          ${N}
          ${e.transparencyPassType===A.y.FrontFace?"fragColor.rgb /= fragColor.a;":""}
          ${e.transparencyPassType===A.y.ColorAlpha?"fragAlpha = fragColor.a;":""}
        }`);break;case o.V.ObjectAndLayerIdColor:O.code.add(x.H`
        void main() {
          ${N}
          outputObjectAndLayerIdColor();
        }`);break;case o.V.Highlight:O.constants.add("occludedHighlightFlag","vec4",p.U),O.constants.add("unoccludedHighlightFlag","vec4",p.bO),O.code.add(x.H`
        void main() {
          ${N}
          if (voccluded == 1.0) {
            fragColor = occludedHighlightFlag;
          } else {
            fragColor = unoccludedHighlightFlag;
          }
        }`)}return t}function R(e){return e.outlineColor[3]>0&&e.outlineSize>0}function C(e,t=I){return e.textureIsSignedDistanceField?function(e,t,n){null!=t?(0,i.hZ)(n,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):(0,i.hZ)(n,0,0)}(e.anchorPosition,e.distanceFieldBoundingBox,t):(0,i.C)(t,e.anchorPosition),t}const I=(0,r.vt)(),P=Object.freeze(Object.defineProperty({__proto__:null,build:O,calculateAnchorPosForRendering:C},Symbol.toStringTag,{value:"Module"}))},72468:function(e,t,n){"use strict";n.d(t,{I:function(){return _},b:function(){return g}});var i=n(27264),r=n(13668),s=n(34178),o=n(78946),a=n(28686),l=n(23864),c=n(20830),u=n(14543),h=n(39506),d=n(62988),p=n(39838),f=n(55890),m=n(65839);function g(e){const t=new d.N5,{vertex:n,fragment:g}=t;return(0,c.NB)(n,e),t.include(s.d,e),t.attributes.add(m.r.POSITION,"vec3"),t.attributes.add(m.r.UV0,"vec2"),e.perspectiveInterpolation&&t.attributes.add(m.r.PERSPECTIVEDIVIDE,"float"),t.varyings.add("vpos","vec3"),e.multipassEnabled&&t.varyings.add("depth","float"),n.code.add(h.H`
    void main(void) {
      vpos = position;
      ${e.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      vTexCoord = uv0;
      gl_Position = transformPosition(proj, view, vpos);

      ${e.perspectiveInterpolation?"gl_Position *= perspectiveDivide;":""}
    }
  `),t.include(r.HQ,e),t.include(o.Q,e),g.uniforms.add(new p.N("tex",(e=>e.texture)),new u.m("opacity",(e=>e.opacity))),t.varyings.add("vTexCoord","vec2"),e.transparencyPassType===f.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),g.include(l.a),g.code.add(h.H`
    void main() {
      discardBySlice(vpos);
      ${e.multipassEnabled?"terrainDepthTest(depth);":""}
      fragColor = texture(tex, vTexCoord) * opacity;

      if (fragColor.a < ${h.H.float(a.H)}) {
        discard;
      }

      fragColor = highlightSlice(fragColor, vpos);
      ${e.transparencyPassType===f.y.ColorAlpha?h.H`
              fragColor = premultiplyAlpha(fragColor);
              fragAlpha = fragColor.a;`:""}
      ${e.output===i.V.ObjectAndLayerIdColor?h.H`
              fragColor = vec4(0,0,0,1);`:""}
    }
    `),t}const _=Object.freeze(Object.defineProperty({__proto__:null,build:g},Symbol.toStringTag,{value:"Module"}))},58054:function(e,t,n){"use strict";n.d(t,{L:function(){return _},b:function(){return f}});var i=n(73364),r=n(39714),s=n(13786),o=n(1932),a=n(68561),l=n(11687),c=n(14543),u=n(39506),h=n(70340),d=n(62988),p=n(65839);function f(e){const t=new d.N5;t.include(a.K,e);const{vertex:n,fragment:r}=t;return n.uniforms.add(new h.X("modelView",((e,{camera:t})=>(0,i.Tl)(g,t.viewMatrix,e.origin))),new h.X("proj",((e,{camera:t})=>t.projectionMatrix)),new c.m("glowWidth",((e,{camera:t})=>e.glowWidth*t.pixelRatio)),new l.G("pixelToNDC",((e,{camera:t})=>(0,s.hZ)(m,2/t.fullViewport[2],2/t.fullViewport[3])))),t.attributes.add(p.r.START,"vec3"),t.attributes.add(p.r.END,"vec3"),t.attributes.add(p.r.UP,"vec3"),t.attributes.add(p.r.EXTRUDE,"vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vViewStart","vec3"),t.varyings.add("vViewEnd","vec3"),t.varyings.add("vViewPlane","vec4"),n.code.add(u.H`void main() {
vec3 pos = mix(start, end, extrude.x);
vec4 viewPos = modelView * vec4(pos, 1);
vec4 projPos = proj * viewPos;
vec2 ndcPos = projPos.xy / projPos.w;
vec3 viewUp = (modelView * vec4(extrude.y * up, 0)).xyz;
vec4 projPosUp = proj * vec4(viewPos.xyz + viewUp, 1);
vec2 projExtrudeDir = normalize(projPosUp.xy / projPosUp.w - ndcPos);
vec2 lxy = abs(sign(projExtrudeDir) - ndcPos);
ndcPos += length(lxy) * projExtrudeDir;
vec3 worldPlaneNormal = normalize(cross(up, normalize(end - start)));
vec3 viewPlaneNormal = (modelView * vec4(worldPlaneNormal, 0)).xyz;
vViewStart = (modelView * vec4(start, 1)).xyz;
vViewEnd = (modelView * vec4(end, 1)).xyz;
vViewPlane = vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));
float xPaddingPixels = sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;
ndcPos.x += xPaddingPixels * pixelToNDC.x;
uv = ndcPos * 0.5 + 0.5;
gl_Position = vec4(ndcPos, 0, 1);
}`),r.uniforms.add(new c.m("perScreenPixelRatio",((e,t)=>t.camera.perScreenPixelRatio))),r.code.add(u.H`float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {
vec3 origin = mix(start, end, 0.5);
vec3 basis = end - origin;
vec3 posAtOrigin = pos - origin;
float x = dot(normalize(basis), posAtOrigin);
float y = dot(plane.xyz, posAtOrigin);
float dx = max(abs(x) - length(basis), 0.0);
float dy = y;
float dist = length(vec2(dx, dy));
float width = fwidth(y);
float maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;
float pixelDist = dist / min(width, maxPixelDistance);
return abs(pixelDist);
}
void main() {
vec3 dEndStart = vViewEnd - vViewStart;
if (dot(dEndStart, dEndStart) < 1e-5) {
discard;
}
vec3 pos;
vec3 normal;
float angleCutoffAdjust;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, angleCutoffAdjust, depthDiscontinuityAlpha)) {
discard;
}
float distance = planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);
vec4 color = laserlineProfile(distance);
float alpha = (1.0 - smoothstep(0.995 - angleCutoffAdjust, 0.999 - angleCutoffAdjust, abs(dot(normal, vViewPlane.xyz))));
fragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);
}`),t}const m=(0,o.vt)(),g=(0,r.vt)(),_=Object.freeze(Object.defineProperty({__proto__:null,build:f},Symbol.toStringTag,{value:"Module"}))},96500:function(e,t,n){"use strict";n.d(t,{L:function(){return D},b:function(){return E},d:function(){return T}});var i=n(15774),r=n(13786),s=n(1932),o=n(20551),a=n(32501),l=n(33400),c=n(41546),u=n(73313),h=n(5596),d=n(90599),p=n(68561),f=n(77423),m=n(11687),g=n(82598),_=n(38917),v=n(14543),y=n(39506),b=n(62988);const T=(0,i.kU)(6);function E(e){const t=new b.N5;t.include(f.c),t.include(p.K,e);const n=t.fragment;if(e.lineVerticalPlaneEnabled||e.heightManifoldEnabled)if(n.uniforms.add(new v.m("maxPixelDistance",((t,n)=>e.heightManifoldEnabled?2*n.camera.computeScreenPixelSizeAt(t.heightManifoldTarget):2*n.camera.computeScreenPixelSizeAt(t.lineVerticalPlaneSegment.origin)))),n.code.add(y.H`float planeDistancePixels(vec4 plane, vec3 pos) {
float dist = dot(plane.xyz, pos) + plane.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`),e.spherical){const e=(e,t,n)=>(0,o.h)(e,t.heightManifoldTarget,n.camera.viewMatrix),t=(e,t)=>(0,o.h)(e,[0,0,0],t.camera.viewMatrix);n.uniforms.add(new _.E("heightManifoldOrigin",((n,i)=>(e(A,n,i),t(R,i),(0,o.f)(R,R,A),(0,o.n)(M,R),M[3]=(0,o.l)(R),M))),new g.t("globalOrigin",((e,n)=>t(A,n))),new v.m("cosSphericalAngleThreshold",((e,t)=>1-Math.max(2,(0,o.p)(t.camera.eye,e.heightManifoldTarget)*t.camera.perRenderPixelRatio)/(0,o.l)(e.heightManifoldTarget)))),n.code.add(y.H`float globeDistancePixels(float posInGlobalOriginLength) {
float dist = abs(posInGlobalOriginLength - heightManifoldOrigin.w);
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}
float heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {
vec3 posInGlobalOriginNorm = normalize(globalOrigin - pos);
float cosAngle = dot(posInGlobalOriginNorm, heightManifoldOrigin.xyz);
vec3 posInGlobalOrigin = globalOrigin - pos;
float posInGlobalOriginLength = length(posInGlobalOrigin);
float sphericalDistance = globeDistancePixels(posInGlobalOriginLength);
float planarDistance = planeDistancePixels(heightPlane, pos);
return cosAngle < cosSphericalAngleThreshold ? sphericalDistance : planarDistance;
}`)}else n.code.add(y.H`float heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {
return planeDistancePixels(heightPlane, pos);
}`);if(e.pointDistanceEnabled&&(n.uniforms.add(new v.m("maxPixelDistance",((e,t)=>2*t.camera.computeScreenPixelSizeAt(e.pointDistanceTarget)))),n.code.add(y.H`float sphereDistancePixels(vec4 sphere, vec3 pos) {
float dist = distance(sphere.xyz, pos) - sphere.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`)),e.intersectsLineEnabled&&(n.uniforms.add(new v.m("perScreenPixelRatio",((e,t)=>t.camera.perScreenPixelRatio))),n.code.add(y.H`float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {
float dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);
return abs(dist) - radius;
}`)),(e.lineVerticalPlaneEnabled||e.intersectsLineEnabled)&&n.code.add(y.H`bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {
vec3 dir = end - start;
float t2 = dot(dir, pos - start);
float l2 = dot(dir, dir);
return t2 >= 0.0 && t2 <= l2;
}`),n.code.add(y.H`void main() {
vec3 pos;
vec3 normal;
float angleCutoffAdjust;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, angleCutoffAdjust, depthDiscontinuityAlpha)) {
discard;
}
vec4 color = vec4(0, 0, 0, 0);`),e.heightManifoldEnabled){n.uniforms.add(new m.G("angleCutoff",(e=>x(e))),new _.E("heightPlane",((e,t)=>S(e.heightManifoldTarget,e.renderCoordsHelper.worldUpAtPosition(e.heightManifoldTarget,A),t.camera.viewMatrix))));const t=e.spherical?y.H`normalize(globalOrigin - pos)`:y.H`heightPlane.xyz`;n.code.add(y.H`
    {
      vec2 angleCutoffAdjusted = angleCutoff - angleCutoffAdjust;

      // Fade out laserlines on flat surfaces
      float heightManifoldAlpha = 1.0 - smoothstep(angleCutoffAdjusted.x, angleCutoffAdjusted.y, abs(dot(normal, ${t})));

      vec4 heightManifoldColor = laserlineProfile(heightManifoldDistancePixels(heightPlane, pos));
      color = max(color, heightManifoldColor * heightManifoldAlpha);
    }
    `)}return e.pointDistanceEnabled&&(n.uniforms.add(new m.G("angleCutoff",(e=>x(e))),new _.E("pointDistanceSphere",((e,t)=>function(e,t){return(0,o.h)((0,d.g)(P),e.pointDistanceOrigin,t.camera.viewMatrix),P[3]=(0,o.p)(e.pointDistanceOrigin,e.pointDistanceTarget),P}(e,t)))),n.code.add(y.H`{
float pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);
vec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);
float pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));
color = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);
}`)),e.lineVerticalPlaneEnabled&&(n.uniforms.add(new m.G("angleCutoff",(e=>x(e))),new _.E("lineVerticalPlane",((e,t)=>function(e,t){const n=(0,u.sd)(e.lineVerticalPlaneSegment,.5,A),i=e.renderCoordsHelper.worldUpAtPosition(n,O),r=(0,o.n)(R,e.lineVerticalPlaneSegment.vector),s=(0,o.b)(A,i,r);return(0,o.n)(s,s),S(e.lineVerticalPlaneSegment.origin,s,t.camera.viewMatrix)}(e,t))),new g.t("lineVerticalStart",((e,t)=>function(e,t){const n=(0,o.c)(A,e.lineVerticalPlaneSegment.origin);return e.renderCoordsHelper.setAltitude(n,0),(0,o.h)(n,n,t.camera.viewMatrix)}(e,t))),new g.t("lineVerticalEnd",((e,t)=>function(e,t){const n=(0,o.g)(A,e.lineVerticalPlaneSegment.origin,e.lineVerticalPlaneSegment.vector);return e.renderCoordsHelper.setAltitude(n,0),(0,o.h)(n,n,t.camera.viewMatrix)}(e,t)))),n.code.add(y.H`{
if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {
float lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);
vec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);
float lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));
color = max(color, lineVerticalColor * lineVerticalAlpha);
}
}`)),e.intersectsLineEnabled&&(n.uniforms.add(new m.G("angleCutoff",(e=>x(e))),new g.t("intersectsLineStart",((e,t)=>(0,o.h)(A,e.lineStartWorld,t.camera.viewMatrix))),new g.t("intersectsLineEnd",((e,t)=>(0,o.h)(A,e.lineEndWorld,t.camera.viewMatrix))),new g.t("intersectsLineDirection",((e,t)=>((0,o.c)(M,e.intersectsLineSegment.vector),M[3]=0,(0,o.n)(A,(0,l.t)(M,M,t.camera.viewMatrix))))),new v.m("intersectsLineRadius",(e=>e.intersectsLineRadius))),n.code.add(y.H`{
if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {
float intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);
vec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);
float intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));
color = max(color, intersectsLineColor * intersectsLineAlpha);
}
}`)),n.code.add(y.H`fragColor = laserlineOutput(color * depthDiscontinuityAlpha);
}`),t}function x(e){return(0,r.hZ)(w,Math.cos(e.angleCutoff),Math.cos(Math.max(0,e.angleCutoff-(0,i.kU)(2))))}function S(e,t,n){return(0,o.h)(C,e,n),(0,o.c)(M,t),M[3]=0,(0,l.t)(M,M,n),(0,h.O_)(C,M,I)}const w=(0,s.vt)(),A=(0,a.vt)(),M=(0,c.vt)(),O=(0,a.vt)(),R=(0,a.vt)(),C=(0,a.vt)(),I=(0,h.vt)(),P=(0,d.c)(),D=Object.freeze(Object.defineProperty({__proto__:null,build:E,defaultAngleCutoff:T},Symbol.toStringTag,{value:"Module"}))},94010:function(e,t,n){"use strict";n.d(t,{O:function(){return u},a:function(){return d},b:function(){return h}});var i=n(86398),r=n(77423),s=n(14543),o=n(50295),a=n(39506),l=n(62988),c=n(39838);class u extends a.Y{constructor(){super(...arguments),this.overlayIndex=i.vr.INNER,this.opacity=1}}function h(){const e=new l.N5;return e.include(r.c),e.fragment.uniforms.add(new c.N("tex",(e=>e.texture))),e.fragment.uniforms.add(new o.c("overlayIdx",(e=>e.overlayIndex))),e.fragment.uniforms.add(new s.m("opacity",(e=>e.opacity))),e.fragment.code.add(a.H`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`),e}const d=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:u,build:h},Symbol.toStringTag,{value:"Module"}))},35904:function(e,t,n){"use strict";n.d(t,{R:function(){return A},b:function(){return w},r:function(){return S}});var i=n(27264),r=n(13668),s=n(27271),o=n(55123),a=n(31166),l=n(91981),c=n(78946),u=n(61629),h=n(28686),d=n(23864),p=n(20830),f=n(11687),m=n(38917),g=n(14543),_=n(39506),v=n(70340),y=n(62988),b=n(55890),T=n(65839),E=n(50678),x=n(95736);const S=1;function w(e){const t=new y.N5,{attributes:n,varyings:w,constants:A,vertex:M,fragment:O}=t;t.include(u.p),t.include(o.s,e),t.include(a.q,e);const R=e.applyMarkerOffset&&!e.draped;R&&(M.uniforms.add(new g.m("markerScale",(e=>e.markerScale))),t.include(l.r,{space:E.lM.World,draped:!1})),t.include(s.g,e),(0,p.NB)(M,e),M.uniforms.add(new v.X("inverseProjectionMatrix",((e,t)=>t.camera.inverseProjectionMatrix)),new f.G("nearFar",((e,t)=>t.camera.nearFar)),new g.m("miterLimit",(e=>"miter"!==e.join?0:e.miterLimit)),new m.E("viewport",((e,t)=>t.camera.fullViewport))),M.constants.add("LARGE_HALF_FLOAT","float",65500),n.add(T.r.POSITION,"vec3"),n.add(T.r.PREVPOSITION,"vec3"),n.add(T.r.NEXTPOSITION,"vec3"),n.add(T.r.SUBDIVISIONFACTOR,"float"),n.add(T.r.UV0,"vec2"),w.add("vColor","vec4"),w.add("vpos","vec3"),w.add("vLineDistance","float"),w.add("vLineWidth","float");const C=e.multipassEnabled&&e.output===i.V.Color;C&&w.add("depth","float");const I=e.stippleEnabled;I&&w.add("vLineSizeInv","float"),A.add("aaWidth","float",e.stippleEnabled?0:1);const P=e.capType===x.x.ROUND,D=e.stippleEnabled&&P,L=e.falloffEnabled||D;L&&w.add("vLineDistanceNorm","float"),P&&(w.add("vSegmentSDF","float"),w.add("vReverseSegmentSDF","float")),M.code.add(_.H`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),M.code.add(_.H`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),M.code.add(_.H`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${C?"depth = pos.z;":""}

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),(0,p.Nz)(M),M.code.add(_.H`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;
      float lineSize = getSize();

      if (lineSize < 1.0) {
        coverage = lineSize; // convert sub-pixel coverage to alpha
        lineSize = 1.0;
      }
      lineSize += aaWidth;

      float lineWidth = lineSize * pixelRatio;
      vLineWidth = lineWidth;
      ${I?_.H`vLineSizeInv = 1.0 / lineSize;`:""}

      vec4 pos  = view * vec4(position, 1.0);
      vec4 prev = view * vec4(prevPosition, 1.0);
      vec4 next = view * vec4(nextPosition, 1.0);
  `),R&&M.code.add(_.H`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),M.code.add(_.H`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(e.stippleEnabled||P)&&M.code.add(_.H`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${P?_.H`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),M.code.add(_.H`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),e.roundJoins?M.code.add(_.H`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${e.stippleEnabled?_.H`min(1.0, subdivisionFactor * ${_.H.float((S+2)/(S+1))})`:_.H`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):M.code.add(_.H`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const N=e.capType!==x.x.BUTT;return M.code.add(_.H`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${N?_.H`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),M.code.add(_.H`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;
    float lineDistNorm = sign(uv0.y) * pos.w;

    vLineDistance =  lineWidth * lineDistNorm;
    ${L?_.H`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),P&&M.code.add(_.H`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),e.stippleEnabled&&(e.draped?M.uniforms.add(new g.m("worldToScreenRatio",((e,t)=>1/t.screenToPCSRatio))):M.code.add(_.H`vec3 segmentCenter = mix((nextPosition + position) * 0.5, (position + prevPosition) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),M.code.add(_.H`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(nextPosition - position, position - prevPosition, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),e.draped?M.code.add(_.H`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):M.code.add(_.H`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),M.uniforms.add(new g.m("stipplePatternPixelSize",(e=>(0,a.h)(e)))),M.code.add(_.H`float patternLength = lineSize * stipplePatternPixelSize;
vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);
if (segmentLengthScreenDouble >= 0.001) {
vec2 stippleDisplacement = pos.xy - segmentOrigin;
float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);
vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
}
vStippleDistanceLimits *= pos.w;
vStippleDistance *= pos.w;
vStippleDistanceLimits = isJoin ?
vStippleDistanceLimits :
isStartVertex ?
vec2(-1e34, vStippleDistanceLimits.y) :
vec2(vStippleDistanceLimits.x, 1e34);`)),M.code.add(_.H`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),C&&t.include(c.Q,e),t.include(r.HQ,e),O.include(d.a),O.code.add(_.H`
  void main() {
    discardBySlice(vpos);
    ${C?"terrainDepthTest(depth);":""}
  `),e.wireframe?O.code.add(_.H`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(P&&O.code.add(_.H`
        float sdf = min(vSegmentSDF, vReverseSegmentSDF);
        vec2 fragmentPosition = vec2(
          min(sdf, 0.0),
          vLineDistance
        ) * gl_FragCoord.w;

        float fragmentRadius = length(fragmentPosition);
        float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
        float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

        if (capCoverage < ${_.H.float(h.y)}) {
          discard;
        }
      `),D?O.code.add(_.H`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${_.H.float(h.y)}, stippleCoverage);
      `):O.code.add(_.H`float stippleAlpha = getStippleAlpha();`),e.output!==i.V.ObjectAndLayerIdColor&&O.code.add(_.H`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),O.uniforms.add(new m.E("intrinsicColor",(e=>e.color))),O.code.add(_.H`vec4 color = intrinsicColor * vColor;`),e.innerColorEnabled&&(O.uniforms.add(new m.E("innerColor",(e=>e.innerColor??e.color)),new g.m("innerWidth",((e,t)=>e.innerWidth*t.camera.pixelRatio))),O.code.add(_.H`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),O.code.add(_.H`vec4 finalColor = blendStipple(color, stippleAlpha);`),e.falloffEnabled&&(O.uniforms.add(new g.m("falloff",(e=>e.falloff))),O.code.add(_.H`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)),e.stippleEnabled||O.code.add(_.H`float featherStartDistance = max(vLineWidth - 2.0, 0.0);
float value = abs(vLineDistance) * gl_FragCoord.w;
float feather = (value - featherStartDistance) / (vLineWidth - featherStartDistance);
finalColor.a *= 1.0 - clamp(feather, 0.0, 1.0);`)),e.transparencyPassType===b.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),O.code.add(_.H`
    ${e.output===i.V.ObjectAndLayerIdColor?_.H`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${_.H.float(h.y)}) {
      discard;
    }

    ${e.output===i.V.Color?_.H`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===i.V.Color&&e.transparencyPassType===b.y.ColorAlpha?_.H`
            fragColor = premultiplyAlpha(fragColor);
            fragAlpha = fragColor.a;`:""}
    ${e.output===i.V.Highlight?_.H`fragColor = vec4(1.0);`:""}
    ${e.output===i.V.ObjectAndLayerIdColor?_.H`outputObjectAndLayerIdColor();`:""}
  }
  `),t}const A=Object.freeze(Object.defineProperty({__proto__:null,build:w,ribbonlineNumRoundJoinSubdivisions:S},Symbol.toStringTag,{value:"Module"}))},60593:function(e,t,n){"use strict";n.d(t,{S:function(){return T},b:function(){return v}});var i=n(41546),r=n(88416),s=n(27264),o=n(13668),a=n(34178),l=n(78946),c=n(28686),u=n(23864),h=n(20830),d=n(82598),p=n(38917),f=n(39506),m=n(62988),g=n(55890),_=n(65839);function v(e){const t=new m.N5,n=e.multipassEnabled&&e.output===s.V.Color;t.include(a.d,e),t.include(r.L,e),t.include(o.HQ,e);const{vertex:i,fragment:v}=t;return v.include(u.a),(0,h.NB)(i,e),v.uniforms.add(new p.E("uColor",(e=>e.color))),t.attributes.add(_.r.POSITION,"vec3"),t.varyings.add("vWorldPosition","vec3"),n&&t.varyings.add("depth","float"),e.screenSizeEnabled&&t.attributes.add(_.r.OFFSET,"vec3"),e.shadingEnabled&&((0,h.S7)(i),t.attributes.add(_.r.NORMAL,"vec3"),t.varyings.add("vViewNormal","vec3")),i.code.add(f.H`
    void main(void) {
      vWorldPosition = ${e.screenSizeEnabled?"screenSizeScaling(offset, position)":"position"};
  `),e.shadingEnabled&&i.code.add(f.H`vec3 worldNormal = normal;
vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;`),i.code.add(f.H`
    ${n?"depth = (view * vec4(vWorldPosition, 1.0)).z;":""}
    gl_Position = transformPosition(proj, view, vWorldPosition);
  }
  `),n&&t.include(l.Q,e),v.code.add(f.H`
    void main() {
      discardBySlice(vWorldPosition);
      ${n?"terrainDepthTest(depth);":""}
    `),e.shadingEnabled?(v.uniforms.add(new d.t("shadingDirection",(e=>e.shadingDirection))),v.uniforms.add(new p.E("shadedColor",(e=>y(e.shadingTint,e.color)))),v.code.add(f.H`vec3 viewNormalNorm = normalize(vViewNormal);
float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
vec4 finalColor = mix(uColor, shadedColor, shadingFactor);`)):v.code.add(f.H`vec4 finalColor = uColor;`),e.transparencyPassType===g.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),v.code.add(f.H`
      ${e.output===s.V.ObjectAndLayerIdColor?f.H`finalColor.a = 1.0;`:""}
      if (finalColor.a < ${f.H.float(c.y)}) {
        discard;
      }

      ${e.output===s.V.Color?f.H`fragColor = highlightSlice(finalColor, vWorldPosition); ${e.transparencyPassType===g.y.ColorAlpha?f.H`
                    fragColor = premultiplyAlpha(fragColor);
                    fragAlpha = fragColor.a;`:""}`:""}
    }
    `),t}function y(e,t){const n=1-e[3],i=e[3]+t[3]*n;return 0===i?(b[3]=i,b):(b[0]=(e[0]*e[3]+t[0]*t[3]*n)/i,b[1]=(e[1]*e[3]+t[1]*t[3]*n)/i,b[2]=(e[2]*e[3]+t[2]*t[3]*n)/i,b[3]=t[3],b)}const b=(0,i.vt)(),T=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}))},29829:function(e,t,n){"use strict";n.d(t,{S:function(){return u},b:function(){return c}});var i=n(20830),r=n(38917),s=n(14543),o=n(39506),a=n(62988),l=n(65839);function c(e){const t=new a.N5,{vertex:n,fragment:c,attributes:u,varyings:h}=t;return(0,i.NB)(n,e),u.add(l.r.POSITION,"vec3"),u.add(l.r.UV0,"vec2"),h.add("vUV","vec2"),n.code.add(o.H`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),c.uniforms.add(new r.E("backgroundColor",(e=>e.backgroundColor)),new r.E("gridColor",(e=>e.gridColor)),new s.m("gridWidth",(e=>e.gridWidth))),c.code.add(o.H`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
fragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),t}const u=Object.freeze(Object.defineProperty({__proto__:null,build:c},Symbol.toStringTag,{value:"Module"}))},55747:function(e,t,n){"use strict";n.d(t,{T:function(){return c},a:function(){return h},b:function(){return u}});var i=n(32501),r=n(77423),s=n(82598),o=n(39506),a=n(62988),l=n(39838);class c extends o.Y{constructor(){super(...arguments),this.color=(0,i.fA)(1,1,1)}}function u(){const e=new a.N5;return e.include(r.c),e.fragment.uniforms.add(new l.N("tex",(e=>e.texture)),new s.t("uColor",(e=>e.color))),e.fragment.code.add(o.H`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);
}`),e}const h=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:c,build:u},Symbol.toStringTag,{value:"Module"}))},2075:function(e,t,n){"use strict";n.d(t,{a:function(){return _},c:function(){return v},g:function(){return E},h:function(){return R},u:function(){return b}}),n(58941);var i=n(40633),r=n(15774),s=n(89736),o=n(73364),a=n(39714),l=n(20551),c=n(32501),u=n(72485),h=n(73313),d=n(5596),p=n(79578),f=n(29531),m=n(50973);const g=()=>i.A.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");function _(e=F){return{plane:(0,d.vt)(e.plane),origin:(0,c.o8)(e.origin),basis1:(0,c.o8)(e.basis1),basis2:(0,c.o8)(e.basis2)}}function v(e,t=_()){return y(e.origin,e.basis1,e.basis2,t)}function y(e,t,n,i=_()){return(0,l.c)(i.origin,e),(0,l.c)(i.basis1,t),(0,l.c)(i.basis2,n),b(i),function(e,t){Math.abs((0,l.m)(e.basis1,e.basis2)/((0,l.l)(e.basis1)*(0,l.l)(e.basis2)))>1e-6&&g().warn(t,"Provided basis vectors are not perpendicular"),Math.abs((0,l.m)(e.basis1,I(e)))>1e-6&&g().warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-(0,l.m)(I(e),e.origin)-e.plane[3])>1e-6&&g().warn(t,"Plane offset is not consistent with plane origin")}(i,"fromValues()"),i}function b(e){(0,d.mR)(e.basis2,e.basis1,e.origin,e.plane)}function T(e,t,n){e!==n&&v(e,n);const i=(0,l.j)(m.rq.get(),I(e),t);return(0,l.g)(n.origin,n.origin,i),n.plane[3]-=t,n}function E(e,t=_()){const n=(e[2]-e[0])/2,i=(e[3]-e[1])/2;return(0,l.s)(t.origin,e[0]+n,e[1]+i,0),(0,l.s)(t.basis1,n,0,0),(0,l.s)(t.basis2,0,i,0),(0,d.fA)(0,0,1,0,t.plane),t}function x(e,t,n){return!!(0,d.Ui)(e.plane,t,n)&&P(e,n)}function S(e,t,n){const i=z.get();N(e,t,i,z.get());let s=Number.POSITIVE_INFINITY;for(const o of k){const a=L(e,o,V.get()),c=m.rq.get();if((0,d.T7)(i,a,c)){const e=(0,l.E)(m.rq.get(),t.origin,c),i=Math.abs((0,r.XM)((0,l.m)(t.direction,e)));i<s&&(s=i,(0,l.c)(n,c))}}return s===Number.POSITIVE_INFINITY?w(e,t,n):n}function w(e,t,n){if(x(e,t,n))return n;const i=z.get(),r=z.get();N(e,t,i,r);let s=Number.POSITIVE_INFINITY;for(const o of k){const a=L(e,o,V.get()),c=m.rq.get();if((0,d.gv)(i,a,c)){const e=(0,p.kb)(t,c);if(!(0,d.Tj)(r,c))continue;e<s&&(s=e,(0,l.c)(n,c))}}return O(e,t.origin)<s&&A(e,t.origin,n),n}function A(e,t,n){const i=(0,d._I)(e.plane,t,m.rq.get()),r=(0,h.H6)(D(e,e.basis1),i,-1,1,m.rq.get()),s=(0,h.H6)(D(e,e.basis2),i,-1,1,m.rq.get());return(0,l.f)(n,(0,l.g)(m.rq.get(),r,s),e.origin),n}function M(e,t,n){const{origin:i,basis1:r,basis2:s}=e,o=(0,l.f)(m.rq.get(),t,i),a=(0,f.gr)(r,o),c=(0,f.gr)(s,o),u=(0,f.gr)(I(e),o);return(0,l.s)(n,a,c,u)}function O(e,t){const n=M(e,t,m.rq.get()),{basis1:i,basis2:r}=e,s=(0,l.l)(i),o=(0,l.l)(r),a=Math.max(Math.abs(n[0])-s,0),c=Math.max(Math.abs(n[1])-o,0),u=n[2];return a*a+c*c+u*u}function R(e,t){return Math.sqrt(O(e,t))}function C(e,t){const n=-e.plane[3];return(0,f.gr)(I(e),t)-n}function I(e){return(0,d.Qj)(e.plane)}function P(e,t){const n=(0,l.f)(m.rq.get(),t,e.origin),i=(0,l.q)(e.basis1),r=(0,l.q)(e.basis2),s=(0,l.m)(e.basis1,n),o=(0,l.m)(e.basis2,n);return-s-i<0&&s-i<0&&-o-r<0&&o-r<0}function D(e,t){const n=V.get();return(0,l.c)(n.origin,e.origin),(0,l.c)(n.vector,t),n}function L(e,t,n){const{basis1:i,basis2:r,origin:s}=e,o=(0,l.j)(m.rq.get(),i,t.origin[0]),a=(0,l.j)(m.rq.get(),r,t.origin[1]);(0,l.g)(n.origin,o,a),(0,l.g)(n.origin,n.origin,s);const c=(0,l.j)(m.rq.get(),i,t.direction[0]),u=(0,l.j)(m.rq.get(),r,t.direction[1]);return(0,l.j)(n.vector,(0,l.g)(c,c,u),2),n}function N(e,t,n,i){const r=I(e);(0,d.mR)(r,t.direction,t.origin,n),(0,d.mR)((0,d.Qj)(n),r,t.origin,i)}const F={plane:(0,d.vt)(),origin:(0,c.fA)(0,0,0),basis1:(0,c.fA)(1,0,0),basis2:(0,c.fA)(0,1,0)},z=new s.I(d.vt),V=new s.I(h.vt),H=(0,c.vt)(),U=new s.I((()=>_())),k=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],j=(0,a.vt)(),G=(0,a.vt)();Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:class{constructor(){this.plane=(0,d.vt)(),this.origin=(0,c.vt)(),this.basis1=(0,c.vt)(),this.basis2=(0,c.vt)()}},altitudeAt:C,axisAt:function(e,t,n,i){return function(e,t,n){switch(t){case u._.X:(0,l.c)(n,e.basis1),(0,l.n)(n,n);break;case u._.Y:(0,l.c)(n,e.basis2),(0,l.n)(n,n);break;case u._.Z:(0,l.c)(n,I(e))}return n}(e,n,i)},closestPoint:w,closestPointOnSilhouette:S,copy:v,copyWithoutVerify:function(e,t){(0,l.c)(t.origin,e.origin),(0,l.c)(t.basis1,e.basis1),(0,l.c)(t.basis2,e.basis2),(0,d.C)(t.plane,e.plane)},create:_,distance:R,distance2:O,distanceToSilhouette:function(e,t){let n=Number.NEGATIVE_INFINITY;for(const i of k){const r=L(e,i,V.get()),s=(0,h.kb)(r,t);s>n&&(n=s)}return Math.sqrt(n)},elevate:T,equals:function(e,t){return(0,l.e)(e.basis1,t.basis1)&&(0,l.e)(e.basis2,t.basis2)&&(0,l.e)(e.origin,t.origin)},extrusionContainsPoint:function(e,t){return(0,d.Tj)(e.plane,t)&&P(e,t)},fromAABoundingRect:E,fromValues:y,intersectRay:x,intersectRayClosestSilhouette:function(e,t,n){if(x(e,t,n))return n;const i=S(e,t,m.rq.get());return(0,l.g)(n,t.origin,(0,l.j)(m.rq.get(),t.direction,(0,l.p)(t.origin,i)/(0,l.l)(t.direction))),n},normal:I,projectPoint:A,projectPointLocal:M,rotate:function(e,t,n,i){return e!==i&&v(e,i),(0,o.$0)(G,t,n),(0,l.h)(i.basis1,e.basis1,G),(0,l.h)(i.basis2,e.basis2,G),b(i),i},setAltitudeAt:function(e,t,n,i){const r=C(e,t),s=(0,l.j)(H,I(e),n-r);return(0,l.g)(i,t,s),i},setExtent:function(e,t,n){return E(t,n),T(n,C(e,e.origin),n),n},transform:function(e,t,n){return e!==n&&v(e,n),(0,o.B8)(j,t),(0,o.mg)(j,j),(0,l.h)(n.basis1,e.basis1,j),(0,l.h)(n.basis2,e.basis2,j),(0,l.h)((0,d.Qj)(n.plane),(0,d.Qj)(e.plane),j),(0,l.h)(n.origin,e.origin,t),(0,d.mP)(n.plane,n.plane,n.origin),n},up:F,updateUnboundedPlane:b,wrap:function(e,t,n){const i=U.get();return i.origin=e,i.basis1=t,i.basis2=n,i.plane=(0,d.LV)(0,0,0,0),b(i),i}},Symbol.toStringTag,{value:"Module"}))},59122:function(e,t,n){"use strict";n.d(t,{e:function(){return l}});var i,r,s,o=n(32150),a={exports:{}};i=a,r=function(){function e(e,n,r){r=r||2;var s,o,a,c,u,h,d,p=n&&n.length,f=p?n[0]*r:e.length,m=t(e,0,f,r,!0),g=[];if(!m||m.next===m.prev)return g;if(p&&(m=l(e,n,m,r)),e.length>80*r){s=a=e[0],o=c=e[1];for(var _=r;_<f;_+=r)(u=e[_])<s&&(s=u),(h=e[_+1])<o&&(o=h),u>a&&(a=u),h>c&&(c=h);d=0!==(d=Math.max(a-s,c-o))?1/d:0}return i(m,g,r,s,o,d),g}function t(e,t,n,i,r){var s,o;if(r===O(e,t,n,i)>0)for(s=t;s<n;s+=i)o=w(s,e[s],e[s+1],o);else for(s=n-i;s>=t;s-=i)o=w(s,e[s],e[s+1],o);if(o&&y(o,o.next)){var a=o.next;A(o),o=a}return o}function n(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!y(i,i.next)&&0!==v(i.prev,i,i.next))i=i.next;else{var r=i.prev;if(A(i),(i=t=r)===i.next)break;n=!0}}while(n||i!==t);return t}function i(e,t,l,c,u,h,d){if(e){!d&&h&&p(e,c,u,h);for(var f,m,g=e;e.prev!==e.next;)if(f=e.prev,m=e.next,h?s(e,c,u,h):r(e))t.push(f.i/l),t.push(e.i/l),t.push(m.i/l),A(e),e=m.next,g=m.next;else if((e=m)===g){d?1===d?i(e=o(n(e),t,l),t,l,c,u,h,2):2===d&&a(e,t,l,c,u,h):i(n(e),t,l,c,u,h,1);break}}}function r(e){var t=e.prev,n=e,i=e.next;if(v(t,n,i)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(g(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&v(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function s(e,t,n,i){var r=e.prev,s=e,o=e.next;if(v(r,s,o)>=0)return!1;for(var a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,c=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,u=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,h=f(a,l,t,n,i),d=f(c,u,t,n,i),p=e.prevZ,m=e.nextZ;p&&p.z>=h&&m&&m.z<=d;){if(p!==e.prev&&p!==e.next&&g(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&v(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,m!==e.prev&&m!==e.next&&g(r.x,r.y,s.x,s.y,o.x,o.y,m.x,m.y)&&v(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&g(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&v(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;m&&m.z<=d;){if(m!==e.prev&&m!==e.next&&g(r.x,r.y,s.x,s.y,o.x,o.y,m.x,m.y)&&v(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function o(e,t,i){var r=e;do{var s=r.prev,o=r.next.next;!y(s,o)&&b(s,r,r.next,o)&&x(s,o)&&x(o,s)&&(t.push(s.i/i),t.push(r.i/i),t.push(o.i/i),A(r),A(r.next),r=e=o),r=r.next}while(r!==e);return n(r)}function a(e,t,r,s,o,a){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&_(l,c)){var u=S(l,c);return l=n(l,l.next),u=n(u,u.next),i(l,t,r,s,o,a),void i(u,t,r,s,o,a)}c=c.next}l=l.next}while(l!==e)}function l(e,i,r,s){var o,a,l,u=[];for(o=0,a=i.length;o<a;o++)(l=t(e,i[o]*s,o<a-1?i[o+1]*s:e.length,s,!1))===l.next&&(l.steiner=!0),u.push(m(l));for(u.sort(c),o=0;o<u.length;o++)r=n(r=h(u[o],r),r.next);return r}function c(e,t){return e.x-t.x}function u(e){if(e.next.prev===e)return e;let t=e;for(;;){const n=t.next;if(n.prev===t||n===t||n===e)break;t=n}return t}function h(e,t){var i=function(e,t){var n,i=t,r=e.x,s=e.y,o=-1/0;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){var a=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&a>o){if(o=a,a===r){if(s===i.y)return i;if(s===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!n)return null;if(r===o)return n;var l,c=n,u=n.x,h=n.y,p=1/0;i=n;do{r>=i.x&&i.x>=u&&r!==i.x&&g(s<h?r:o,s,u,h,s<h?o:r,s,i.x,i.y)&&(l=Math.abs(s-i.y)/(r-i.x),x(i,e)&&(l<p||l===p&&(i.x>n.x||i.x===n.x&&d(n,i)))&&(n=i,p=l)),i=i.next}while(i!==c);return n}(e,t);if(!i)return t;var r=S(i,e),s=n(i,i.next);let o=u(r);return n(o,o.next),s=u(s),u(t===i?s:t)}function d(e,t){return v(e.prev,e,t.prev)<0&&v(t.next,e,e.next)<0}function p(e,t,n,i){var r=e;do{null===r.z&&(r.z=f(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,s,o,a,l,c=1;do{for(n=e,e=null,s=null,o=0;n;){for(o++,i=n,a=0,t=0;t<c&&(a++,i=i.nextZ);t++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:e=r,r.prevZ=s,s=r;n=i}s.nextZ=null,c*=2}while(o>1)}(r)}function f(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function m(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function g(e,t,n,i,r,s,o,a){return(r-o)*(t-a)-(e-o)*(s-a)>=0&&(e-o)*(i-a)-(n-o)*(t-a)>=0&&(n-o)*(s-a)-(r-o)*(i-a)>=0}function _(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&b(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(x(e,t)&&x(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,s=(e.y+t.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(v(e.prev,e,t.prev)||v(e,t.prev,t))||y(e,t)&&v(e.prev,e,e.next)>0&&v(t.prev,t,t.next)>0)}function v(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function y(e,t){return e.x===t.x&&e.y===t.y}function b(e,t,n,i){var r=E(v(e,t,n)),s=E(v(e,t,i)),o=E(v(n,i,e)),a=E(v(n,i,t));return r!==s&&o!==a||!(0!==r||!T(e,n,t))||!(0!==s||!T(e,i,t))||!(0!==o||!T(n,e,i))||!(0!==a||!T(n,t,i))}function T(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function E(e){return e>0?1:e<0?-1:0}function x(e,t){return v(e.prev,e,e.next)<0?v(e,t,e.next)>=0&&v(e,e.prev,t)>=0:v(e,t,e.prev)<0||v(e,e.next,t)<0}function S(e,t){var n=new M(e.i,e.x,e.y),i=new M(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function w(e,t,n,i){var r=new M(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function A(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function M(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O(e,t,n,i){for(var r=0,s=t,o=n-i;s<n;s+=i)r+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return r}return e.deviation=function(e,t,n,i){var r=t&&t.length,s=r?t[0]*n:e.length,o=Math.abs(O(e,0,s,n));if(r)for(var a=0,l=t.length;a<l;a++){var c=t[a]*n,u=a<l-1?t[a+1]*n:e.length;o-=Math.abs(O(e,c,u,n))}var h=0;for(a=0;a<i.length;a+=3){var d=i[a]*n,p=i[a+1]*n,f=i[a+2]*n;h+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},e.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,r=0;r<e.length;r++){for(var s=0;s<e[r].length;s++)for(var o=0;o<t;o++)n.vertices.push(e[r][s][o]);r>0&&(i+=e[r-1].length,n.holes.push(i))}return n},e},void 0!==(s=r())&&(i.exports=s);const l=(0,o.g)(a.exports)},69296:function(e,t,n){"use strict";var i;n.d(t,{u:function(){return i}}),function(e){e[e.KILOBYTES=1024]="KILOBYTES",e[e.MEGABYTES=1048576]="MEGABYTES",e[e.GIGABYTES=1073741824]="GIGABYTES"}(i||(i={}))},99680:function(e,t,n){"use strict";n.d(t,{q:function(){return r}});var i=n(85408);class r{constructor(e,t){this._storage=new i.F,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),t&&this._storage.registerRemoveFunc("",t)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,t,n=1){this._storage.put(this,e,t,n,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}}},92709:function(e,t,n){"use strict";n.d(t,{T:function(){return i},d:function(){return m}});const i={Base64:0,Hex:1,String:2,Raw:3},r=8,s=(1<<r)-1;function o(e,t){const n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function a(e){const t=[];for(let n=0,i=e.length*r;n<i;n+=r)t[n>>5]|=(e.charCodeAt(n/r)&s)<<n%32;return t}function l(e){const t=[];for(let n=0,i=32*e.length;n<i;n+=r)t.push(String.fromCharCode(e[n>>5]>>>n%32&s));return t.join("")}function c(e,t,n,i,r,s){return o(function(e,t){return e<<t|e>>>32-t}(o(o(t,e),o(i,s)),r),n)}function u(e,t,n,i,r,s,o){return c(t&n|~t&i,e,t,r,s,o)}function h(e,t,n,i,r,s,o){return c(t&i|n&~i,e,t,r,s,o)}function d(e,t,n,i,r,s,o){return c(t^n^i,e,t,r,s,o)}function p(e,t,n,i,r,s,o){return c(n^(t|~i),e,t,r,s,o)}function f(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;let n=1732584193,i=-271733879,r=-1732584194,s=271733878;for(let t=0;t<e.length;t+=16){const a=n,l=i,c=r,f=s;n=u(n,i,r,s,e[t],7,-680876936),s=u(s,n,i,r,e[t+1],12,-389564586),r=u(r,s,n,i,e[t+2],17,606105819),i=u(i,r,s,n,e[t+3],22,-1044525330),n=u(n,i,r,s,e[t+4],7,-176418897),s=u(s,n,i,r,e[t+5],12,1200080426),r=u(r,s,n,i,e[t+6],17,-1473231341),i=u(i,r,s,n,e[t+7],22,-45705983),n=u(n,i,r,s,e[t+8],7,1770035416),s=u(s,n,i,r,e[t+9],12,-1958414417),r=u(r,s,n,i,e[t+10],17,-42063),i=u(i,r,s,n,e[t+11],22,-1990404162),n=u(n,i,r,s,e[t+12],7,1804603682),s=u(s,n,i,r,e[t+13],12,-40341101),r=u(r,s,n,i,e[t+14],17,-1502002290),i=u(i,r,s,n,e[t+15],22,1236535329),n=h(n,i,r,s,e[t+1],5,-165796510),s=h(s,n,i,r,e[t+6],9,-1069501632),r=h(r,s,n,i,e[t+11],14,643717713),i=h(i,r,s,n,e[t],20,-373897302),n=h(n,i,r,s,e[t+5],5,-701558691),s=h(s,n,i,r,e[t+10],9,38016083),r=h(r,s,n,i,e[t+15],14,-660478335),i=h(i,r,s,n,e[t+4],20,-405537848),n=h(n,i,r,s,e[t+9],5,568446438),s=h(s,n,i,r,e[t+14],9,-1019803690),r=h(r,s,n,i,e[t+3],14,-187363961),i=h(i,r,s,n,e[t+8],20,1163531501),n=h(n,i,r,s,e[t+13],5,-1444681467),s=h(s,n,i,r,e[t+2],9,-51403784),r=h(r,s,n,i,e[t+7],14,1735328473),i=h(i,r,s,n,e[t+12],20,-1926607734),n=d(n,i,r,s,e[t+5],4,-378558),s=d(s,n,i,r,e[t+8],11,-2022574463),r=d(r,s,n,i,e[t+11],16,1839030562),i=d(i,r,s,n,e[t+14],23,-35309556),n=d(n,i,r,s,e[t+1],4,-1530992060),s=d(s,n,i,r,e[t+4],11,1272893353),r=d(r,s,n,i,e[t+7],16,-155497632),i=d(i,r,s,n,e[t+10],23,-1094730640),n=d(n,i,r,s,e[t+13],4,681279174),s=d(s,n,i,r,e[t],11,-358537222),r=d(r,s,n,i,e[t+3],16,-722521979),i=d(i,r,s,n,e[t+6],23,76029189),n=d(n,i,r,s,e[t+9],4,-640364487),s=d(s,n,i,r,e[t+12],11,-421815835),r=d(r,s,n,i,e[t+15],16,530742520),i=d(i,r,s,n,e[t+2],23,-995338651),n=p(n,i,r,s,e[t],6,-198630844),s=p(s,n,i,r,e[t+7],10,1126891415),r=p(r,s,n,i,e[t+14],15,-1416354905),i=p(i,r,s,n,e[t+5],21,-57434055),n=p(n,i,r,s,e[t+12],6,1700485571),s=p(s,n,i,r,e[t+3],10,-1894986606),r=p(r,s,n,i,e[t+10],15,-1051523),i=p(i,r,s,n,e[t+1],21,-2054922799),n=p(n,i,r,s,e[t+8],6,1873313359),s=p(s,n,i,r,e[t+15],10,-30611744),r=p(r,s,n,i,e[t+6],15,-1560198380),i=p(i,r,s,n,e[t+13],21,1309151649),n=p(n,i,r,s,e[t+4],6,-145523070),s=p(s,n,i,r,e[t+11],10,-1120210379),r=p(r,s,n,i,e[t+2],15,718787259),i=p(i,r,s,n,e[t+9],21,-343485551),n=o(n,a),i=o(i,l),r=o(r,c),s=o(s,f)}return[n,i,r,s]}function m(e,t=i.Hex){const n=t||i.Base64,s=f(a(e),e.length*r);switch(n){case i.Raw:return s;case i.Hex:return function(e){const t="0123456789abcdef",n=[];for(let i=0,r=4*e.length;i<r;i++)n.push(t.charAt(e[i>>2]>>i%4*8+4&15)+t.charAt(e[i>>2]>>i%4*8&15));return n.join("")}(s);case i.String:return l(s);case i.Base64:return function(e){const t=[];for(let n=0,i=4*e.length;n<i;n+=3){const i=(e[n>>2]>>n%4*8&255)<<16|(e[n+1>>2]>>(n+1)%4*8&255)<<8|e[n+2>>2]>>(n+2)%4*8&255;for(let r=0;r<4;r++)8*n+6*r>32*e.length?t.push("="):t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>6*(3-r)&63))}return t.join("")}(s)}}},85408:function(e,t,n){"use strict";n.d(t,{Cn:function(){return s},F:function(){return c},Mn:function(){return l},Ti:function(){return r},k2:function(){return o}});var i=n(7187);const r=-3,s=r-1;var o,a;(a=o||(o={}))[a.ALL=0]="ALL",a[a.SOME=1]="SOME";class l{constructor(e,t,n){this.name=e,this._storage=t,this.id=u+++":",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),n&&(this._storage.registerRemoveFunc(this.id,n),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(e){return this._storage.getSize(this,e)}resetHitRate(){this._hit=this._miss=0}put(e,t,n,i=0){this._storage.put(this,e,t,n,i)}pop(e){const t=this._storage.pop(this,e);return void 0===t?++this._miss:++this._hit,t}get(e){const t=this._storage.get(this,e);return void 0===t?++this._miss:++this._hit,t}peek(e){return this._storage.peek(this,e)}updateSize(e,t,n){this._storage.updateSize(this,e,t,n)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}class c{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new i.A,this._users=new i.A}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,t){this._removeFuncs.push([e,t])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace((t=>t[0]!==e))}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,t){const n=this._db.get(e.id+t);return n?.size??0}put(e,t,n,i,a){t=e.id+t;const l=this._db.get(t);if(l&&(this._size-=l.size,e.size-=l.size,this._db.delete(t),l.entry!==n&&this._notifyRemove(t,l.entry,l.size,o.ALL)),i>this._maxSize)return void this._notifyRemove(t,n,i,o.ALL);if(void 0===n)return void console.warn("Refusing to cache undefined entry ");if(!i||i<0)return console.warn(`Refusing to cache entry with size ${i} for key ${t}`),void this._notifyRemove(t,n,0,o.ALL);const c=1+Math.max(a,s)-r;this._db.set(t,new h(n,i,c)),this._size+=i,e.size+=i,this._checkSize()}updateSize(e,t,n,i){t=e.id+t;const r=this._db.get(t);if(r&&r.entry===n){for(this._size-=r.size,e.size-=r.size;i>this._maxSize;){const e=this._notifyRemove(t,n,i,o.SOME);if(!(null!=e&&e>0))return void this._db.delete(t);i=e}r.size=i,this._size+=i,e.size+=i,this._checkSize()}}pop(e,t){t=e.id+t;const n=this._db.get(t);if(n)return this._size-=n.size,e.size-=n.size,this._db.delete(t),++this._hit,n.entry;++this._miss}get(e,t){t=e.id+t;const n=this._db.get(t);if(void 0!==n)return this._db.delete(t),n.lives=n.lifetime,this._db.set(t,n),++this._hit,n.entry;++this._miss}peek(e,t){const n=this._db.get(e.id+t);return n?++this._hit:++this._miss,n?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},n=new Array;this._db.forEach(((e,i)=>{const r=e.lifetime;n[r]=(n[r]||0)+e.size,this._users.forAll((n=>{const{id:r,name:s}=n;if(i.startsWith(r)){const n=t[s]||0;t[s]=n+e.size}}))}));const i={};this._users.forAll((e=>{const n=e.name;if("hitRate"in e&&"number"==typeof e.hitRate&&!isNaN(e.hitRate)&&e.hitRate>0){const r=t[n]||0;t[n]=r,i[n]=Math.round(100*e.hitRate)+"%"}else i[n]="0%"}));const s=Object.keys(t);s.sort(((e,n)=>t[n]-t[e])),s.forEach((n=>e[n]=Math.round(t[n]/2**20)+"MB / "+i[n]));for(let t=n.length-1;t>=0;--t){const i=n[t];i&&(e["Priority "+(t+r-1)]=Math.round(i/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll((e=>e.resetHitRate()))}clear(e){const t=e.id;this._db.forEach(((e,n)=>{n.startsWith(t)&&(this._size-=e.size,this._db.delete(n),this._notifyRemove(n,e.entry,e.size,o.ALL))})),e.size=0}clearAll(){this._db.forEach(((e,t)=>this._notifyRemove(t,e.entry,e.size,o.ALL))),this._users.forAll((e=>e.size=0)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,t,n,i){let r;return this._removeFuncs.some((s=>{if(e.startsWith(s[0])){const e=s[1](t,i,n);return"number"==typeof e&&(r=e),!0}return!1})),r}_checkSize(){this._users.forAll((e=>this._checkSizeLimits(e))),this._checkSizeLimits()}_checkSizeLimits(e){const t=e??this;if(t.maxSize<0||t.size<=t.maxSize)return;const n=e?.id;let i=!0;for(;i;){i=!1;for(const[r,s]of this._db)if(0===s.lifetime&&(!n||r.startsWith(n))){if(this._purgeItem(r,s,e),t.size<=.9*t.maxSize)return;i||=this._db.has(r)}}for(const[i,r]of this._db)if((!n||i.startsWith(n))&&(this._purgeItem(i,r,e),t.size<=.9*t.maxSize))return}_purgeItem(e,t,n=this._users.find((t=>e.startsWith(t.id)))){if(this._db.delete(e),t.lives<=1){this._size-=t.size,n&&(n.size-=t.size);const i=this._notifyRemove(e,t.entry,t.size,o.SOME);null!=i&&i>0&&(this._size+=i,n&&(n.size+=i),t.lives=t.lifetime,t.size=i,this._db.set(e,t))}else--t.lives,this._db.set(e,t)}}let u=0;class h{constructor(e,t,n){this.entry=e,this.size=t,this.lifetime=n,this.lives=n}}},7970:function(e,t,n){"use strict";n.d(t,{O:function(){return i}});class i{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===this._outer.size}get(e,t){return this._outer.get(e)?.get(t)}set(e,t,n){const i=this._outer.get(e);i?i.set(t,n):this._outer.set(e,new Map([[t,n]]))}delete(e,t){const n=this._outer.get(e);n&&(n.delete(t),0===n.size&&this._outer.delete(e))}forEach(e){this._outer.forEach(((t,n)=>e(t,n)))}}},85876:function(e,t,n){"use strict";n.d(t,{A:function(){return s}});var i=n(44567),r=n(87085);class s{constructor(e){this._observable=new r.I,this._set=new Set(e)}get size(){return(0,i.gc)(this._observable),this._set.size}add(e){const t=this._set.size;return this._set.add(e),this._set.size!==t&&this._observable.notify(),this}clear(){this._set.size>0&&(this._set.clear(),this._observable.notify())}delete(e){const t=this._set.delete(e);return t&&this._observable.notify(),t}entries(){return(0,i.gc)(this._observable),this._set.entries()}forEach(e,t){(0,i.gc)(this._observable),this._set.forEach(((n,i)=>e.call(t,n,i,this)),t)}has(e){return(0,i.gc)(this._observable),this._set.has(e)}keys(){return(0,i.gc)(this._observable),this._set.keys()}values(){return(0,i.gc)(this._observable),this._set.values()}[Symbol.iterator](){return(0,i.gc)(this._observable),this._set[Symbol.iterator]()}get[Symbol.toStringTag](){return this._set[Symbol.toStringTag]}}},84016:function(e,t,n){"use strict";n.d(t,{O:function(){return r}});var i=n(25591);const r=()=>i.default.respectPrefersReducedMotion&&window.matchMedia("(prefers-reduced-motion: reduce)").matches},18627:function(e,t,n){"use strict";n.d(t,{P:function(){return p}});var i=n(39819),r=n(92709),s=n(73888),o=n(90683),a=n(66110),l=n(75779),c=n(72977),u=n(23502),h=n(82465),d=n(60534);function p(e){const t=e?.origins??[void 0];return(n,i)=>{const r=function(e,t,n){if("resource"===e?.type)return function(e,t,n){const i=(0,l.z4)(t,n);return{type:String,read:(e,t,n)=>{const r=(0,d.r)(e,t,n);return i.type===String?r:"function"==typeof i.type?new i.type({url:r}):void 0},write:{writer(t,r,a,l){if(!l?.resources)return"string"==typeof t?void(r[a]=(0,d.t)(t,l)):void(r[a]=t.write({},l));const u=function(e){return null==e?null:"string"==typeof e?e:e.url}(t),p=(0,d.t)(u,{...l,verifyItemRelativeUrls:l?.verifyItemRelativeUrls?{writtenUrls:l.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},d.M.NO),_=i.type!==String&&(!(0,s.H)(this)||l?.origin&&this.originIdOf(n)>(0,c.aB)(l.origin)),v={object:this,propertyName:n,value:t,targetUrl:p,dest:r,targetPropertyName:a,context:l,params:e};l?.portalItem&&p&&!(0,o.oP)(p)?_&&e?.contentAddressed?f(v):_?function(e){const{context:t,targetUrl:n,params:i,value:r,dest:s,targetPropertyName:a}=e;if(!t.portalItem)return;const l=t.portalItem.resourceFromPath(n),c=g(r,n,t),u=(0,h.n)(c),d=(0,o.Zo)(l.path),p=i?.compress??!1;u===d?(t.resources&&m({...e,resource:l,content:c,compress:p,updates:t.resources.toUpdate}),s[a]=n):f(e)}(v):function({context:e,targetUrl:t,dest:n,targetPropertyName:i}){e.portalItem&&e.resources&&(e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(t),compress:!1}),n[i]=t)}(v):l?.portalItem&&(null==p||null!=(0,d.i)(p)||(0,o.w8)(p)||_)?f(v):r[a]=p}}}}(e,t,n);switch(e?.type??"other"){case"other":return{read:!0,write:!0};case"url":{const{read:e,write:t}=d.b;return{read:e,write:t}}}}(e,n,i);for(const e of t){const t=(0,u.rM)(n,e,i);for(const e in r)t[e]=r[e]}}}function f(e){const{targetUrl:t,params:n,value:s,context:l,dest:c,targetPropertyName:u}=e;if(!l.portalItem)return;const p=(0,d.p)(t),f=g(s,t,l);if(n?.contentAddressed&&"json"!==f.type)return void l.messages?.push(new i.A("persistable:contentAddressingUnsupported",`Property "${u}" is trying to serializing a resource with content of type ${f.type} with content addressing. Content addressing is only supported for json resources.`,{content:f}));const _=n?.contentAddressed&&"json"===f.type?(0,r.d)(f.jsonString):p?.filename??(0,a.lk)(),v=(0,o.fj)(n?.prefix??p?.prefix,_),y=`${v}.${(0,h.n)(f)}`;if(n?.contentAddressed&&l.resources&&"json"===f.type){const e=l.resources.toKeep.find((({resource:e})=>e.path===y))??l.resources.toAdd.find((({resource:e})=>e.path===y));if(e)return void(c[u]=e.resource.itemRelativeUrl)}const b=l.portalItem.resourceFromPath(y);(0,o.w8)(t)&&l.resources&&l.resources.pendingOperations.push((0,o.tk)(t).then((e=>{b.path=`${v}.${(0,h.n)({type:"blob",blob:e})}`,c[u]=b.itemRelativeUrl})).catch((()=>{})));const T=n?.compress??!1;l.resources&&m({...e,resource:b,content:f,compress:T,updates:l.resources.toAdd}),c[u]=b.itemRelativeUrl}function m({object:e,propertyName:t,updates:n,resource:i,content:r,compress:s}){n.push({resource:i,content:r,compress:s,finish:n=>{!function(e,t,n){"string"==typeof e[t]?e[t]=n.url:e[t].url=n.url}(e,t,n)}})}function g(e,t,n){return"string"==typeof e?{type:"url",url:t}:{type:"json",jsonString:JSON.stringify(e.toJSON(n))}}},72952:function(e,t,n){"use strict";n.d(t,{EB:function(){return p},Im:function(){return g},Mj:function(){return d},Ui:function(){return m},w2:function(){return f}});var i=n(83525),r=n(78879),s=n(63693);const o=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function a(e){return e instanceof i.A}function l(e){return e instanceof r.A?Object.keys(e.items):a(e)?(0,s.oY)(e).keys():e?Object.keys(e):[]}function c(e,t){return e instanceof r.A?e.items[t]:e[t]}function u(e){return e?e.declaredClass:null}function h(e,t){const n=e.diff;if(n&&"function"==typeof n)return n(e,t);const i=l(e),r=l(t);if(0===i.length&&0===r.length)return;if(!i.length||!r.length||function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}(e,t))return{type:"complete",oldValue:e,newValue:t};const s=r.filter((e=>!i.includes(e))),d=i.filter((e=>!r.includes(e))),p=i.filter((n=>r.includes(n)&&c(e,n)!==c(t,n))).concat(s,d).sort(),f=u(e);if(f&&o.has(f)&&p.length)return{type:"complete",oldValue:e,newValue:t};let m;const g=a(e)&&a(t);for(const i of p){const r=c(e,i),s=c(t,i);let o;if((g||"function"!=typeof r&&"function"!=typeof s)&&r!==s&&(null!=r||null!=s)){if(n&&n[i]&&"function"==typeof n[i])o=n[i]?.(r,s);else if(r instanceof Date&&s instanceof Date){if(r.getTime()===s.getTime())continue;o={type:"complete",oldValue:r,newValue:s}}else o="object"==typeof r&&"object"==typeof s&&u(r)===u(s)?h(r,s):{type:"complete",oldValue:r,newValue:s};null!=o&&(null!=m?m.diff[i]=o:m={type:"partial",diff:{[i]:o}})}}return m}function d(e,t){return p(e,t)}function p(e,t){if(null==e)return!1;const n=t.split(".");let i=e;for(const e of n){if("complete"===i.type)return!0;if("partial"!==i.type)return!1;{const t=i.diff[e];if(!t)return!1;i=t}}return!0}function f(e,t){if(!e)return!1;if("partial"===e.type){const n=Object.keys(e.diff);return 1===n.length&&n[0]===t}return!1}function m(e,t){if("function"!=typeof e&&"function"!=typeof t&&(null!=e||null!=t))return null==e||null==t||"object"==typeof e&&"object"==typeof t&&u(e)!==u(t)?{type:"complete",oldValue:e,newValue:t}:h(e,t)}function g(e){if(null==e)return!0;switch(e.type){case"complete":return!1;case"collection":{const t=e;for(const e of t.added)if(!g(e))return!1;for(const e of t.removed)if(!g(e))return!1;for(const e of t.changed)if(!g(e))return!1;return!0}case"partial":for(const t in e.diff)if(!g(e.diff[t]))return!1;return!0}}},75505:function(e,t,n){"use strict";n.d(t,{$:function(){return g},IB:function(){return s},N2:function(){return _},QP:function(){return M},RH:function(){return y},Vl:function(){return A},Ws:function(){return b},ZD:function(){return v},_L:function(){return w},bJ:function(){return x},e$:function(){return S},f6:function(){return R},pW:function(){return T},pf:function(){return O}});var i=n(52874),r=(n(33400),n(41546));function s(e){return"r"in e&&"g"in e&&"b"in e}function o(e){return"h"in e&&"s"in e&&"v"in e}function a(e){return"l"in e&&"a"in e&&"b"in e}function l(e){return"l"in e&&"c"in e&&"h"in e}const c=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],u=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function h(e,t){const n=[];let i,r;if(e[0].length!==t.length)throw new Error("dimensions do not match");const s=e.length,o=e[0].length;let a=0;for(i=0;i<s;i++){for(a=0,r=0;r<o;r++)a+=e[i][r]*t[r];n.push(a)}return n}function d(e){const t=[e.r/255,e.g/255,e.b/255].map((e=>e<=.04045?e/12.92:((e+.055)/1.055)**2.4)),n=h(c,t);return{x:100*n[0],y:100*n[1],z:100*n[2]}}function p(e){const t=h(u,[e.x/100,e.y/100,e.z/100]).map((e=>{const t=e<=.0031308?12.92*e:1.055*e**(1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function f(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map((e=>e>(6/29)**3?e**(1/3):1/3*(29/6)**2*e+4/29));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function m(e){const t=e.l,n=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((e=>e>6/29?e**3:3*(6/29)**2*(e-4/29)));return{x:95.047*n[0],y:100*n[1],z:108.883*n[2]}}function g(e){return s(e)?e:l(e)?function(e){return p(m(function(e){const t=e.l,n=e.c,i=e.h;return{l:t,a:n*Math.cos(i),b:n*Math.sin(i)}}(e)))}(e):a(e)?function(e){return p(m(e))}(e):function(e){return"x"in e&&"y"in e&&"z"in e}(e)?p(e):o(e)?function(e){const t=(e.h+360)%360/60,n=e.s/100,i=e.v/100*255,r=i*n,s=r*(1-Math.abs(t%2-1));let o;switch(Math.floor(t)){case 0:o={r:r,g:s,b:0};break;case 1:o={r:s,g:r,b:0};break;case 2:o={r:0,g:r,b:s};break;case 3:o={r:0,g:s,b:r};break;case 4:o={r:s,g:0,b:r};break;case 5:case 6:o={r:r,g:0,b:s};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+i-r),o.g=Math.round(o.g+i-r),o.b=Math.round(o.b+i-r),o}(e):e}function _(e){return o(e)?e:function(e){const t=e.r,n=e.g,i=e.b,r=Math.max(t,n,i),s=r-Math.min(t,n,i);let o=r,a=0===s?0:r===t?(n-i)/s%6:r===n?(i-t)/s+2:(t-n)/s+4,l=0===s?0:s/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}(g(e))}function v(e){return a(e)?e:function(e){return f(d(e))}(g(e))}function y(e){return l(e)?e:function(e){return function(e){const t=e.l,n=e.a,i=e.b,r=Math.sqrt(n*n+i*i);let s=Math.atan2(i,n);return s=s>0?s:s+2*Math.PI,{l:t,c:r,h:s}}(f(d(e)))}(g(e))}function b(e,t){const{r:n,g:r,b:s}=t?.ignoreAlpha?e:function(e){let{r:t,g:n,b:r,a:s}=e;return s<1&&(t=Math.round(s*t+255*(1-s)),n=Math.round(s*n+255*(1-s)),r=Math.round(s*r+255*(1-s))),new i.A({r:t,g:n,b:r})}(e);return.2126*n+.7152*r+.0722*s}var T,E;function x(e,t=T.High){return b(e,{ignoreAlpha:!0})>t?new i.A([0,0,0,e.a]):new i.A([255,255,255,e.a])}function S(e,t){const n=v(e);n.l*=1-t;const i=g(n),r=e.clone();return r.setColor(i),r.a=e.a,r}function w(e,t){const n=e.clone();return n.a*=t,n}function A(e,t){const n=_(e);n.s*=t;const i=g(n),r=e.clone();return r.setColor(i),r.a=e.a,r}function M(e){return i.A.toUnitRGBA(e)}function O(e){return(0,r.fA)(e[0],e[1],e[2],e.length>3?e[3]:1)}function R(e,t){const n=i.A.toUnitRGBA(e);return n[3]*=t,n}(E=T||(T={}))[E.Low=160]="Low",E[E.High=225]="High"},88264:function(e,t,n){"use strict";function i(e){return"string"==typeof e?document.getElementById(e):e??null}function r(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)}function s(e,t){const n=t.parentNode;n&&n.insertBefore(e,t)}function o(e,t){for(;;){const n=e.firstChild;if(!n)break;t.appendChild(n)}}n.d(t,{$H:function(){return i},Ie:function(){return r},nc:function(){return s},yC:function(){return o}}),Element.prototype.closest},5161:function(e,t,n){"use strict";n.d(t,{T:function(){return s},U:function(){return r}});var i=n(15774);function r(e,t,n=0){const r=(0,i.qE)(e,0,l);for(let e=0;e<4;e++)t[n+e]=Math.floor(256*c(r*o[e]))}function s(e,t=0){let n=0;for(let i=0;i<4;i++)n+=e[t+i]*a[i];return n}const o=[1,256,65536,16777216],a=[1/256,1/65536,1/16777216,1/4294967296],l=s(new Uint8ClampedArray([255,255,255,255]));function c(e){return e-Math.floor(e)}},12978:function(e,t,n){"use strict";function i(){return[1,0,0,1,0,0]}function r(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}n.d(t,{o8:function(){return r},vt:function(){return i}});Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:[1,0,0,1,0,0],clone:r,create:i,createView:function(e,t){return new Float64Array(e,t,6)},fromValues:function(e,t,n,i,r,s){return[e,t,n,i,r,s]}},Symbol.toStringTag,{value:"Module"}))},43274:function(e,t,n){"use strict";function i(){return new Float32Array(3)}function r(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function s(e,t,n){const i=new Float32Array(3);return i[0]=e,i[1]=t,i[2]=n,i}function o(){return i()}function a(){return s(1,1,1)}function l(){return s(1,0,0)}function c(){return s(0,1,0)}function u(){return s(0,0,1)}n.d(t,{fA:function(){return s},o8:function(){return r},vt:function(){return i}});const h=o(),d=a(),p=l(),f=c(),m=u();Object.freeze(Object.defineProperty({__proto__:null,ONES:d,UNIT_X:p,UNIT_Y:f,UNIT_Z:m,ZEROS:h,clone:r,create:i,createView:function(e,t){return new Float32Array(e,t,3)},fromValues:s,ones:a,unitX:l,unitY:c,unitZ:u,zeros:o},Symbol.toStringTag,{value:"Module"}))},43745:function(e,t,n){"use strict";function i(){return new Float32Array(4)}function r(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function s(e,t,n,i){const r=new Float32Array(4);return r[0]=e,r[1]=t,r[2]=n,r[3]=i,r}function o(){return i()}function a(){return s(1,1,1,1)}function l(){return s(1,0,0,0)}function c(){return s(0,1,0,0)}function u(){return s(0,0,1,0)}function h(){return s(0,0,0,1)}n.d(t,{fA:function(){return s},o8:function(){return r}});const d=o(),p=a(),f=l(),m=c(),g=u(),_=h();Object.freeze(Object.defineProperty({__proto__:null,ONES:p,UNIT_W:_,UNIT_X:f,UNIT_Y:m,UNIT_Z:g,ZEROS:d,clone:r,create:i,createView:function(e,t){return new Float32Array(e,t,4)},fromValues:s,ones:a,unitW:h,unitX:l,unitY:c,unitZ:u,zeros:o},Symbol.toStringTag,{value:"Module"}))},67348:function(e,t,n){"use strict";n.d(t,{$0:function(){return h},B8:function(){return o},CV:function(){return d},D_:function(){return r},Tl:function(){return u},e$:function(){return l},hZ:function(){return s},hs:function(){return c},kN:function(){return p},lw:function(){return a}});var i=n(8527);function r(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function s(e,t,n,i,r,s,o){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=s,e[5]=o,e}function o(e,t){const n=t[0],i=t[1],r=t[2],s=t[3],o=t[4],a=t[5];let l=n*s-i*r;return l?(l=1/l,e[0]=s*l,e[1]=-i*l,e[2]=-r*l,e[3]=n*l,e[4]=(r*a-s*o)*l,e[5]=(i*o-n*a)*l,e):null}function a(e,t,n){const i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=n[0],u=n[1],h=n[2],d=n[3],p=n[4],f=n[5];return e[0]=i*c+s*u,e[1]=r*c+o*u,e[2]=i*h+s*d,e[3]=r*h+o*d,e[4]=i*p+s*f+a,e[5]=r*p+o*f+l,e}function l(e,t,n){const i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=Math.sin(n),u=Math.cos(n);return e[0]=i*u+s*c,e[1]=r*u+o*c,e[2]=i*-c+s*u,e[3]=r*-c+o*u,e[4]=a,e[5]=l,e}function c(e,t,n){const i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=n[0],u=n[1];return e[0]=i*c,e[1]=r*c,e[2]=s*u,e[3]=o*u,e[4]=a,e[5]=l,e}function u(e,t,n){const i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=n[0],u=n[1];return e[0]=i,e[1]=r,e[2]=s,e[3]=o,e[4]=i*c+s*u+a,e[5]=r*c+o*u+l,e}function h(e,t){const n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=-n,e[3]=i,e[4]=0,e[5]=0,e}function d(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function p(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function f(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e}const m=a,g=f;Object.freeze(Object.defineProperty({__proto__:null,add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},determinant:function(e){return e[0]*e[3]-e[1]*e[2]},equals:function(e,t){const n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=t[0],u=t[1],h=t[2],d=t[3],p=t[4],f=t[5],m=(0,i.FD)();return Math.abs(n-c)<=m*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(r-u)<=m*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(s-h)<=m*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(o-d)<=m*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(a-p)<=m*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(l-f)<=m*Math.max(1,Math.abs(l),Math.abs(f))},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)},fromRotation:h,fromScaling:d,fromTranslation:p,identity:r,invert:o,mul:m,multiply:a,multiplyScalar:function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e},multiplyScalarAndAdd:function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e},rotate:l,scale:c,set:s,str:function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},sub:g,subtract:f,translate:u},Symbol.toStringTag,{value:"Module"}))},44705:function(e,t,n){"use strict";n.d(t,{B8:function(){return l},D_:function(){return o},Ge:function(){return v},I0:function(){return g},KC:function(){return c},Oe:function(){return f},Tl:function(){return h},dR:function(){return _},e$:function(){return d},hZ:function(){return s},hs:function(){return p},kN:function(){return m},lw:function(){return u},mg:function(){return a},z0:function(){return r}});var i=n(8527);function r(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function s(e,t,n,i,r,s,o,a,l,c){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=s,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e}function o(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function a(e,t){if(e===t){const n=t[1],i=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=i,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function l(e,t){const n=t[0],i=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=u*o-a*c,d=-u*s+a*l,p=c*s-o*l;let f=n*h+i*d+r*p;return f?(f=1/f,e[0]=h*f,e[1]=(-u*i+r*c)*f,e[2]=(a*i-r*o)*f,e[3]=d*f,e[4]=(u*n-r*l)*f,e[5]=(-a*n+r*s)*f,e[6]=p*f,e[7]=(-c*n+i*l)*f,e[8]=(o*n-i*s)*f,e):null}function c(e,t){const n=t[0],i=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return e[0]=o*u-a*c,e[1]=r*c-i*u,e[2]=i*a-r*o,e[3]=a*l-s*u,e[4]=n*u-r*l,e[5]=r*s-n*a,e[6]=s*c-o*l,e[7]=i*l-n*c,e[8]=n*o-i*s,e}function u(e,t,n){const i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=n[0],p=n[1],f=n[2],m=n[3],g=n[4],_=n[5],v=n[6],y=n[7],b=n[8];return e[0]=d*i+p*o+f*c,e[1]=d*r+p*a+f*u,e[2]=d*s+p*l+f*h,e[3]=m*i+g*o+_*c,e[4]=m*r+g*a+_*u,e[5]=m*s+g*l+_*h,e[6]=v*i+y*o+b*c,e[7]=v*r+y*a+b*u,e[8]=v*s+y*l+b*h,e}function h(e,t,n){const i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=n[0],p=n[1];return e[0]=i,e[1]=r,e[2]=s,e[3]=o,e[4]=a,e[5]=l,e[6]=d*i+p*o+c,e[7]=d*r+p*a+u,e[8]=d*s+p*l+h,e}function d(e,t,n){const i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=Math.sin(n),p=Math.cos(n);return e[0]=p*i+d*o,e[1]=p*r+d*a,e[2]=p*s+d*l,e[3]=p*o-d*i,e[4]=p*a-d*r,e[5]=p*l-d*s,e[6]=c,e[7]=u,e[8]=h,e}function p(e,t,n){const i=n[0],r=n[1],s=n[2];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=s*t[6],e[7]=s*t[7],e[8]=s*t[8],e}function f(e,t,n){const i=n[0],r=n[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e}function m(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function g(e,t){const n=t[0],i=t[1],r=t[2],s=t[3],o=n+n,a=i+i,l=r+r,c=n*o,u=i*o,h=i*a,d=r*o,p=r*a,f=r*l,m=s*o,g=s*a,_=s*l;return e[0]=1-h-f,e[3]=u-_,e[6]=d+g,e[1]=u+_,e[4]=1-c-f,e[7]=p-m,e[2]=d-g,e[5]=p+m,e[8]=1-c-h,e}function _(e,t){const n=t[0],i=t[1],r=t[2],s=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10],h=u*o-a*c,d=-u*s+a*l,p=c*s-o*l,f=n*h+i*d+r*p;if(!f)return null;const m=1/f;return e[0]=h*m,e[1]=(-u*i+r*c)*m,e[2]=(a*i-r*o)*m,e[3]=d*m,e[4]=(u*n-r*l)*m,e[5]=(-a*n+r*s)*m,e[6]=p*m,e[7]=(-c*n+i*l)*m,e[8]=(o*n-i*s)*m,e}function v(e,t){const n=t[0],i=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],_=t[15],v=n*a-i*o,y=n*l-r*o,b=n*c-s*o,T=i*l-r*a,E=i*c-s*a,x=r*c-s*l,S=u*m-h*f,w=u*g-d*f,A=u*_-p*f,M=h*g-d*m,O=h*_-p*m,R=d*_-p*g;let C=v*R-y*O+b*M+T*A-E*w+x*S;return C?(C=1/C,e[0]=(a*R-l*O+c*M)*C,e[1]=(l*A-o*R-c*w)*C,e[2]=(o*O-a*A+c*S)*C,e[3]=(r*O-i*R-s*M)*C,e[4]=(n*R-r*A+s*w)*C,e[5]=(i*A-n*O-s*S)*C,e[6]=(m*x-g*E+_*T)*C,e[7]=(g*b-f*x-_*y)*C,e[8]=(f*E-m*b+_*v)*C,e):null}function y(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}const b=u,T=y;Object.freeze(Object.defineProperty({__proto__:null,add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e},adjoint:c,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},determinant:function(e){const t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*(c*s-o*l)+n*(-c*r+o*a)+i*(l*r-s*a)},equals:function(e,t){const n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=t[0],p=t[1],f=t[2],m=t[3],g=t[4],_=t[5],v=t[6],y=t[7],b=t[8],T=(0,i.FD)();return Math.abs(n-d)<=T*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(r-p)<=T*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(s-f)<=T*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(o-m)<=T*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(a-g)<=T*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(l-_)<=T*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(c-v)<=T*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(u-y)<=T*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(h-b)<=T*Math.max(1,Math.abs(h),Math.abs(b))},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)},fromMat2d:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},fromMat4:r,fromQuat:g,fromRotation:function(e,t){const n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=-n,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromTranslation:m,identity:o,invert:l,isOrthoNormal:function(e){const t=(0,i.FD)(),n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8];return Math.abs(1-(n*n+o*o+c*c))<=t&&Math.abs(1-(r*r+a*a+u*u))<=t&&Math.abs(1-(s*s+l*l+h*h))<=t},mul:b,multiply:u,multiplyScalar:function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e},multiplyScalarAndAdd:function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e[6]=t[6]+n[6]*i,e[7]=t[7]+n[7]*i,e[8]=t[8]+n[8]*i,e},normalFromMat4:v,normalFromMat4Legacy:_,projection:function(e,t,n){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},rotate:d,scale:p,scaleByVec2:f,set:s,str:function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},sub:T,subtract:y,translate:h,transpose:a},Symbol.toStringTag,{value:"Module"}))},32237:function(e,t,n){"use strict";n.d(t,{A6:function(){return g},B8:function(){return p},Xd:function(){return u},Xr:function(){return f},Yc:function(){return I},hZ:function(){return v},lw:function(){return h},t2:function(){return R},x8:function(){return c}});var i=n(87725),r=n(61769),s=n(32501),o=n(8527),a=n(20551),l=n(33400);function c(e,t,n){n*=.5;const i=Math.sin(n);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(n),e}function u(e,t){const n=2*Math.acos(t[3]),i=Math.sin(n/2);return i>(0,o.FD)()?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),n}function h(e,t,n){const i=t[0],r=t[1],s=t[2],o=t[3],a=n[0],l=n[1],c=n[2],u=n[3];return e[0]=i*u+o*a+r*c-s*l,e[1]=r*u+o*l+s*a-i*c,e[2]=s*u+o*c+i*l-r*a,e[3]=o*u-i*a-r*l-s*c,e}function d(e,t,n,i){const r=t[0],s=t[1],a=t[2],l=t[3];let c,u,h,d,p,f=n[0],m=n[1],g=n[2],_=n[3];return u=r*f+s*m+a*g+l*_,u<0&&(u=-u,f=-f,m=-m,g=-g,_=-_),1-u>(0,o.FD)()?(c=Math.acos(u),h=Math.sin(c),d=Math.sin((1-i)*c)/h,p=Math.sin(i*c)/h):(d=1-i,p=i),e[0]=d*r+p*f,e[1]=d*s+p*m,e[2]=d*a+p*g,e[3]=d*l+p*_,e}function p(e,t){const n=t[0],i=t[1],r=t[2],s=t[3],o=n*n+i*i+r*r+s*s,a=o?1/o:0;return e[0]=-n*a,e[1]=-i*a,e[2]=-r*a,e[3]=s*a,e}function f(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function m(e,t){const n=t[0]+t[4]+t[8];let i;if(n>0)i=Math.sqrt(n+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{let n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);const r=(n+1)%3,s=(n+2)%3;i=Math.sqrt(t[3*n+n]-t[3*r+r]-t[3*s+s]+1),e[n]=.5*i,i=.5/i,e[3]=(t[3*r+s]-t[3*s+r])*i,e[r]=(t[3*r+n]+t[3*n+r])*i,e[s]=(t[3*s+n]+t[3*n+s])*i}return e}function g(e,t,n,i){const r=.5*Math.PI/180;t*=r,n*=r,i*=r;const s=Math.sin(t),o=Math.cos(t),a=Math.sin(n),l=Math.cos(n),c=Math.sin(i),u=Math.cos(i);return e[0]=s*l*u-o*a*c,e[1]=o*a*u+s*l*c,e[2]=o*l*c-s*a*u,e[3]=o*l*u+s*a*c,e}const _=l.c,v=l.s,y=l.f,b=h,T=l.b,E=l.g,x=l.l,S=l.i,w=S,A=l.j,M=A,O=l.n,R=l.a,C=l.e;function I(e,t,n){const i=(0,a.m)(t,n);return i<-.999999?((0,a.b)(P,D,t),(0,a.H)(P)<1e-6&&(0,a.b)(P,L,t),(0,a.n)(P,P),c(e,P,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):((0,a.b)(P,t,n),e[0]=P[0],e[1]=P[1],e[2]=P[2],e[3]=1+i,O(e,e))}const P=(0,s.vt)(),D=(0,s.fA)(1,0,0),L=(0,s.fA)(0,1,0),N=(0,r.vt)(),F=(0,r.vt)(),z=(0,i.vt)();Object.freeze(Object.defineProperty({__proto__:null,add:y,calculateW:function(e,t){const n=t[0],i=t[1],r=t[2];return e[0]=n,e[1]=i,e[2]=r,e[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r)),e},conjugate:f,copy:_,dot:E,equals:C,exactEquals:R,fromEuler:g,fromMat3:m,getAxisAngle:u,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},invert:p,len:w,length:S,lerp:x,mul:b,multiply:h,normalize:O,random:function(e){const t=o.Ov,n=t(),i=t(),r=t(),s=Math.sqrt(1-n),a=Math.sqrt(n);return e[0]=s*Math.sin(2*Math.PI*i),e[1]=s*Math.cos(2*Math.PI*i),e[2]=a*Math.sin(2*Math.PI*r),e[3]=a*Math.cos(2*Math.PI*r),e},rotateX:function(e,t,n){n*=.5;const i=t[0],r=t[1],s=t[2],o=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l+o*a,e[1]=r*l+s*a,e[2]=s*l-r*a,e[3]=o*l-i*a,e},rotateY:function(e,t,n){n*=.5;const i=t[0],r=t[1],s=t[2],o=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l-s*a,e[1]=r*l+o*a,e[2]=s*l+i*a,e[3]=o*l-r*a,e},rotateZ:function(e,t,n){n*=.5;const i=t[0],r=t[1],s=t[2],o=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l+r*a,e[1]=r*l-i*a,e[2]=s*l+o*a,e[3]=o*l-s*a,e},rotationTo:I,scale:T,set:v,setAxes:function(e,t,n,i){const r=z;return r[0]=n[0],r[3]=n[1],r[6]=n[2],r[1]=i[0],r[4]=i[1],r[7]=i[2],r[2]=-t[0],r[5]=-t[1],r[8]=-t[2],O(e,m(e,r))},setAxisAngle:c,slerp:d,sqlerp:function(e,t,n,i,r,s){return d(N,t,r,s),d(F,n,i,s),d(e,N,F,2*s*(1-s)),e},sqrLen:M,squaredLength:A,str:function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}},Symbol.toStringTag,{value:"Module"}))},7213:function(e,t,n){"use strict";function i(e){let t,n,i=[],r=!1;return function(...s){return r&&t===this&&function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(s,i)||(n=e.apply(this,s),t=this,i=s,r=!0),n}}n.d(t,{B:function(){return i}})},73888:function(e,t,n){"use strict";function i(e){return e&&"getAtOrigin"in e&&"originOf"in e}n.d(t,{H:function(){return i}})},88226:function(e,t,n){"use strict";n.d(t,{Jd:function(){return f},Nk:function(){return l},OM:function(){return p},Oo:function(){return d},ix:function(){return u},rJ:function(){return c},yh:function(){return h}});var i=n(16691),r=n(56275),s=n(15999);function o(e,t,n,i=2,o="abbr"){return(0,s.zJ)(e,(0,r.kM)(t,n).value,n,i,o)}function a(e,t,n,i=2,o="abbr"){return(0,s.nD)(e,(0,r.kM)(t,n).value,n,i,o)}function l(e,t,n,r=i.ie,o=!0){return(0,s.Me)(e.value,e.unit,e.rotationType,t,n,r,o)}function c(e,t,n){return(0,s.cs)(e.value,e.unit,e.rotationType,t,n)}function u(e,t,n,i,r="abbr"){switch(i=i??2,n){case"imperial":return function(e,t,n=2,i="abbr"){return(0,s.tr)(e,t.value,t.unit,n,i)}(e,t,i,r);case"metric":return function(e,t,n=2,i="abbr"){return(0,s.Ee)(e,t.value,t.unit,n,i)}(e,t,i,r);default:return o(e,t,n,i,r)}}function h(e,t,n,i=2,r="abbr"){switch(n){case"imperial":return function(e,t,n=2,i="abbr"){return(0,s.J1)(e,t.value,t.unit,n,i)}(e,t,i,r);case"metric":return function(e,t,n=2,i="abbr"){return(0,s.Mm)(e,t.value,t.unit,n,i)}(e,t,i,r);default:return a(e,t,n,i,r)}}function d(e,t,n,i=2,r="abbr"){switch(n){case"imperial":return function(e,t,n=2,i="abbr"){return(0,s.t_)(e,t.value,t.unit,n,i)}(e,t,i,r);case"metric":return function(e,t,n=2,i="abbr"){return(0,s.W4)(e,t.value,t.unit,n,i)}(e,t,i,r);default:return o(e,t,n,i,r)}}function p(e,t,n,i=2,r="abbr"){switch(n){case"imperial":return function(e,t,n=2,i="abbr"){return(0,s.LF)(e,t.value,t.unit,n,i)}(e,t,i,r);case"metric":return function(e,t,n=2,i="abbr"){return(0,s.e_)(e,t.value,t.unit,n,i)}(e,t,i,r);default:return a(e,t,n,i,r)}}function f(e,t,n,i=2,r="abbr"){switch(n){case"imperial":return function(e,t,n=2,i="abbr"){return(0,s.Sz)(e,t.value,t.unit,n,i)}(e,t,i,r);case"metric":return function(e,t,n=2,i="abbr"){return(0,s.zq)(e,t.value,t.unit,n,i)}(e,t,i,r);default:return o(e,t,n,i,r)}}},15999:function(e,t,n){"use strict";n.d(t,{Cq:function(){return u},Ee:function(){return p},J1:function(){return v},LF:function(){return b},Me:function(){return S},Mm:function(){return f},Sz:function(){return E},W4:function(){return m},cs:function(){return w},e_:function(){return g},nD:function(){return d},t_:function(){return y},tr:function(){return _},v7:function(){return R},zJ:function(){return h},zq:function(){return T}});var i=n(69296),r=n(16691),s=n(15774),o=n(56275),a=n(50944),l=n(62938),c=n(2900);function u(e,t,n){return e.units[t][n]}function h(e,t,n,i=2,r="abbr"){return`${(0,c.ZV)(t,{minimumFractionDigits:i,maximumFractionDigits:i,signDisplay:t>0?"never":"exceptZero"})} ${u(e,n,r)}`}function d(e,t,n,i=2,r="abbr"){return`${(0,c.ZV)(t,{minimumFractionDigits:i,maximumFractionDigits:i,signDisplay:"exceptZero"})} ${u(e,n,r)}`}function p(e,t,n,i=2,r="abbr"){const s=(0,l.x0)(t,n);return h(e,(0,l.oU)(t,n,s),s,i,r)}function f(e,t,n,i=2,r="abbr"){const s=(0,l.x0)(t,n);return d(e,(0,l.oU)(t,n,s),s,i,r)}function m(e,t,n,i=2,r="abbr"){const s=(0,l.x$)(t,n);return h(e,(0,l.oU)(t,n,s),s,i,r)}function g(e,t,n,i=2,r="abbr"){const s=(0,l.x$)(t,n);return d(e,(0,l.oU)(t,n,s),s,i,r)}function _(e,t,n,i=2,r="abbr"){const s=(0,l.OU)(t,n);return h(e,(0,l.oU)(t,n,s),s,i,r)}function v(e,t,n,i=2,r="abbr"){const s=(0,l.OU)(t,n);return d(e,(0,l.oU)(t,n,s),s,i,r)}function y(e,t,n,i=2,r="abbr"){const s=(0,l.y7)(t,n);return h(e,(0,l.oU)(t,n,s),s,i,r)}function b(e,t,n,i=2,r="abbr"){const s=(0,l.y7)(t,n);return d(e,(0,l.oU)(t,n,s),s,i,r)}function T(e,t,n,i=2,r="abbr"){const s=(0,l.wv)(t,n);return h(e,(0,l.oU)(t,n,s),s,i,r)}function E(e,t,n,i=2,r="abbr"){const s=(0,l.TL)(t,n);return h(e,(0,l.oU)(t,n,s),s,i,r)}const x=(e,t)=>({style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:t,minimumFractionDigits:t,signDisplay:e>0?"never":"exceptZero"});function S(e,t,n,i,s,a=r.ie,u=!0){let h=a.normalize((0,o.g2)((0,l.oU)(e,t,"degrees"),n,i),0,u);const d=x(h,s??2);return h=M(h,d),(0,c.ZV)(h,d)}function w(e,t,n,i,r){n!==i&&(e=-e);const s={style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:r=r??2,minimumFractionDigits:r,signDisplay:"exceptZero"};let o=(0,l.oU)(e,t,"degrees")%360;return o=M(o,s),(0,c.ZV)(o,s)}const A=new Map;function M(e,t){const n=JSON.stringify(t);let i=A.get(n);return i||(i=new Intl.NumberFormat("en-US",t),A.set(n,i)),/^[-+]?360\.?0*°?$/.test(i.format(e))?0:e}const O=["B","kB","MB","GB","TB"];function R(e,t){let n=0===(t=Math.round(t))?0:Math.floor(Math.log(t)/Math.log(i.u.KILOBYTES));n=(0,s.qE)(n,0,O.length-1);const r=(0,c.ZV)(t/i.u.KILOBYTES**n,{maximumFractionDigits:2});return(0,a.HC)(e.units.bytes[O[n]],{fileSize:r})}},66110:function(e,t,n){"use strict";n.d(t,{lk:function(){return r},vD:function(){return o},yS:function(){return s}});const i="randomUUID"in crypto;function r(){if(i)return crypto.randomUUID();const e=crypto.getRandomValues(new Uint16Array(8));e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;const t=t=>e[t].toString(16).padStart(4,"0");return t(0)+t(1)+"-"+t(2)+"-"+t(3)+"-"+t(4)+"-"+t(5)+t(6)+t(7)}function s(){return`{${r().toUpperCase()}}`}function o(){return`{${r()}}`}},6338:function(e,t,n){"use strict";n.d(t,{Hh:function(){return c},mT:function(){return h},o6:function(){return u},s1:function(){return l},ts:function(){return d}});var i=n(39819),r=n(38305),s=n(45532),o=n(57165),a=n(2900);function l(){return(0,r.i)()}function c(){return(0,r.l)()}function u(e,t){const n=[];e=(e=(e=e.replaceAll(/[\u00B0\u00BA]/g,"^")).replaceAll("′","'")).replaceAll("″",'"');const a=function(e){let t=null;if(e||(e=o.A.WGS84),e.wkid){if(t=r.P.geogcs(e.wkid),!t)throw new i.A("coordinate-formatter:invalid-spatial-reference","wkid is not valid")}else{if(!e.wkt2&&!e.wkt)throw new i.A("coordinate-formatter:invalid-spatial-reference","wkid and wkt are missing");if(t=r.P.fromString(r.a.PE_TYPE_GEOGCS,e.wkt2||e.wkt),!t)throw new i.A("coordinate-formatter:invalid-spatial-reference","wkt is not valid")}return t}(t);return r.c.dmsToGeog(a,1,[e],n)?new s.default(n[0][0],n[0][1],t||o.A.WGS84):null}function h(e){return e&&l()?(0,a.$J)(e)??u(`0° 0' 0" N | ${e}`)?.longitude??null:null}function d(e){return e&&l()?(0,a.$J)(e)??u(`${e} | 00° 00' 00" E`)?.latitude??null:null}},7456:function(e,t,n){"use strict";n.d(t,{l:function(){return c}});var i=n(15774),r=n(73364),s=n(32501),o=n(46098),a=n(61441),l=n(57652);function c(e,t,n,i){if(null==e||null==i)return!1;const s=(0,a.Qk)(e,a.Wv),c=(0,a.Qk)(i,a.zp);if(s===c&&!u(c)&&(s!==a.rz.UNKNOWN||(0,l.aI)(e,i)))return(0,r.kN)(n,t),!0;if(u(c)){const e=a.w5[s][a.rz.LON_LAT],i=a.w5[a.rz.LON_LAT][c];return null!=e&&null!=i&&(e(t,0,d,0),i(d,0,p,0),(0,o.y)(h*d[0],h*d[1],n),n[12]=p[0],n[13]=p[1],n[14]=p[2],!0)}if(!(c!==a.rz.WEB_MERCATOR&&c!==a.rz.PLATE_CARREE&&c!==a.rz.WGS84&&c!==a.rz.CGCS2000||s!==a.rz.WGS84&&s!==a.rz.SPHERICAL_ECEF&&s!==a.rz.WEB_MERCATOR&&s!==a.rz.CGCS2000)){const e=a.w5[s][a.rz.LON_LAT],i=a.w5[a.rz.LON_LAT][c];return null!=e&&null!=i&&(e(t,0,d,0),i(d,0,p,0),s===a.rz.SPHERICAL_ECEF?(0,o.C)(h*d[0],h*d[1],n):(0,r.D_)(n),n[12]=p[0],n[13]=p[1],n[14]=p[2],!0)}return!1}function u(e){return e===a.rz.SPHERICAL_ECEF||e===a.rz.SPHERICAL_MARS_PCPF||e===a.rz.SPHERICAL_MOON_PCPF}const h=(0,i.kU)(1),d=(0,s.vt)(),p=(0,s.vt)()},46098:function(e,t,n){"use strict";n.d(t,{C:function(){return s},y:function(){return r}});var i=n(73364);function r(e,t,n){const i=Math.sin(e),r=Math.cos(e),s=Math.sin(t),o=Math.cos(t),a=n;return a[0]=-i,a[4]=-s*r,a[8]=o*r,a[12]=0,a[1]=r,a[5]=-s*i,a[9]=o*i,a[13]=0,a[2]=0,a[6]=o,a[10]=s,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function s(e,t,n){return r(e,t,n),(0,i.mg)(n,n),n}},56919:function(e,t,n){"use strict";n.d(t,{E:function(){return s}});var i=n(32501),r=(n(46157),n(68734));function s(e,t,n){return!!(0,r.F)(e,t,o,n.spatialReference)&&(n.x=o[0],n.y=o[1],n.z=o[2],!0)}const o=(0,i.vt)()},96611:function(e,t,n){"use strict";n.d(t,{Y0:function(){return c},lO:function(){return u}});var i=n(61714),r=n(57165),s=n(57652);const o=new r.A(i.fv),a=new r.A(i.FY),l=new r.A(i.LJ),c=new r.A(i.Ro);function u(e){const t=h.get(e);if(t)return t;let n=o;if(e)if(e===a)n=a;else if(e===l)n=l;else{const t=e.wkid,i=e.latestWkid;if(null!=t||null!=i)(0,s.tl)(t)||(0,s.tl)(i)?n=a:((0,s.ZL)(t)||(0,s.ZL)(i))&&(n=l);else{const t=e.wkt2??e.wkt;if(t){const e=t.toUpperCase();e===d?n=a:e===p&&(n=l)}}}return h.set(e,n),n}const h=new Map,d=a.wkt.toUpperCase(),p=l.wkt.toUpperCase()},50240:function(e,t,n){"use strict";n.d(t,{Ns:function(){return l},jh:function(){return r},l5:function(){return o},s:function(){return a},xm:function(){return s}});var i=n(24540);function r(e,t=!1){return e<=i.y9?t?new Array(e).fill(0):new Array(e):new Float64Array(e)}function s(e){return((0,i.cy)(e)?e.length:e.byteLength/8)<=i.y9?Array.from(e):new Float64Array(e)}function o(e,t,n){return Array.isArray(e)?e.slice(t,t+n):e.subarray(t,t+n)}function a(e,t){for(let n=0;n<t.length;++n)e[n]=t[n];return e}function l(e){return Array.isArray(e)?new Float64Array(e):e}},5047:function(e,t,n){"use strict";n.d(t,{AK:function(){return o},Wz:function(){return s},oe:function(){return r}});var i=n(24540);function r(e,t=!1){return e<=i.y9?t?new Array(e).fill(0):new Array(e):new Float32Array(e)}function s(e){return((0,i.cy)(e)?e.length:e.byteLength/8)<=i.y9?Array.from(e):new Float32Array(e)}function o(e,t,n){return Array.isArray(e)?e.slice(t,t+n):e.subarray(t,t+n)}},37819:function(e,t,n){"use strict";n.d(t,{Dg:function(){return r},EH:function(){return d},JH:function(){return o},my:function(){return s},tM:function(){return u}});var i=n(24540);function r(e){if((0,i.cy)(e)){if(e.length<i.y9)return e}else if(e.length<i.y9)return Array.from(e);let t=!0,n=!0;return e.some(((e,i)=>(t=t&&0===e,n=n&&e===i,!t&&!n))),t?d(e.length):n?u(e.length):(0,i.cy)(e)||e.BYTES_PER_ELEMENT!==Uint16Array.BYTES_PER_ELEMENT?function(e){let t=!0;for(const n of e){if(n>=65536)return(0,i.cy)(e)?new Uint32Array(e):e;n>=256&&(t=!1)}return t?new Uint8Array(e):new Uint16Array(e)}(e):e}function s(e){return e<=i.y9?new Array(e):e<=65536?new Uint16Array(e):new Uint32Array(e)}function o(e){return e<=i.y9?new Array(e):new Uint32Array(e)}let a=(()=>{const e=new Uint32Array(131072);for(let t=0;t<e.length;++t)e[t]=t;return e})();const l=[0],c=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function u(e){if(1===e)return l;if(e<i.y9)return Array.from(new Uint16Array(c.buffer,0,e));if(e<c.length)return new Uint16Array(c.buffer,0,e);if(e>a.length){const t=Math.max(2*a.length,e);a=new Uint32Array(t);for(let e=0;e<a.length;e++)a[e]=e}return new Uint32Array(a.buffer,0,e)}let h=new Uint8Array(65536);function d(e){if(1===e)return l;if(e<i.y9)return new Array(e).fill(0);if(e>h.length){const t=Math.max(2*h.length,e);h=new Uint8Array(t)}return new Uint8Array(h.buffer,0,e)}},65907:function(e,t,n){"use strict";n.d(t,{A:function(){return u}});var i=n(53804),r=n(75743),s=n(30905),o=n(23502),a=(n(58941),n(40633),n(13798),n(74376)),l=n(65953);let c=class extends((0,r.O)(s.oY)){constructor(e){super(e),this.type="georeferenced",this.origin=null}};(0,i._)([(0,a.e)({georeferenced:"georeferenced"},{readOnly:!0})],c.prototype,"type",void 0),(0,i._)([(0,o.MZ)({type:[Number],nonNullable:!1,json:{write:!0}})],c.prototype,"origin",void 0),c=(0,i._)([(0,l.$)("esri.geometry.support.MeshGeoreferencedVertexSpace")],c);const u=c},20460:function(e,t,n){"use strict";n.d(t,{A:function(){return h}});var i=n(53804),r=n(75743),s=n(30905),o=n(23502),a=(n(58941),n(40633),n(13798),n(74376)),l=n(65953),c=n(32501);let u=class extends((0,r.O)(s.oY)){constructor(e){super(e),this.type="local",this.origin=(0,c.vt)()}};(0,i._)([(0,a.e)({local:"local"},{readOnly:!0})],u.prototype,"type",void 0),(0,i._)([(0,o.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],u.prototype,"origin",void 0),u=(0,i._)([(0,l.$)("esri.geometry.support.MeshLocalVertexSpace")],u);const h=u},36405:function(e,t,n){"use strict";n.d(t,{A:function(){return g}});var i,r=n(53804),s=n(30905),o=n(23502),a=(n(58941),n(40633),n(13798),n(65953)),l=n(73364),c=n(39714),u=n(32237),h=n(61769),d=n(32501),p=n(26133);let f=i=class extends s.oY{constructor(e){super(e),this.translation=(0,d.vt)(),this.rotationAxis=(0,d.ci)(p.up),this.rotationAngle=0,this.scale=(0,d.fA)(1,1,1)}get rotation(){return(0,p.i4)(this.rotationAxis,this.rotationAngle)}set rotation(e){this.rotationAxis=(0,d.o8)((0,p.yo)(e)),this.rotationAngle=(0,p.g7)(e)}get localMatrix(){const e=(0,c.vt)();return(0,u.x8)(m,(0,p.yo)(this.rotation),(0,p.$I)(this.rotation)),(0,l.o1)(e,m,this.translation,this.scale),e}get localMatrixInverse(){return(0,l.B8)((0,c.vt)(),this.localMatrix)}equals(e){return this===e||null!=e&&(0,l.t2)(this.localMatrix,e.localMatrix)}clone(){const e={translation:(0,d.o8)(this.translation),rotationAxis:(0,d.o8)(this.rotationAxis),rotationAngle:this.rotationAngle,scale:(0,d.o8)(this.scale)};return new i(e)}};(0,r._)([(0,o.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"translation",void 0),(0,r._)([(0,o.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"rotationAxis",void 0),(0,r._)([(0,o.MZ)({type:Number,nonNullable:!0,json:{write:!0}})],f.prototype,"rotationAngle",void 0),(0,r._)([(0,o.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"scale",void 0),(0,r._)([(0,o.MZ)()],f.prototype,"rotation",null),(0,r._)([(0,o.MZ)()],f.prototype,"localMatrix",null),(0,r._)([(0,o.MZ)()],f.prototype,"localMatrixInverse",null),f=i=(0,r._)([(0,a.$)("esri.geometry.support.MeshTransform")],f);const m=(0,h.vt)(),g=f},26133:function(e,t,n){"use strict";n.d(t,{$I:function(){return v},AU:function(){return m},Cr:function(){return d},g7:function(){return _},i4:function(){return h},ui:function(){return p},up:function(){return b},vt:function(){return u},yo:function(){return g}});var i=n(15774),r=n(73364),s=n(32237),o=n(61769),a=n(20551),l=n(32501),c=n(41546);function u(e=b){return[e[0],e[1],e[2],e[3]]}function h(e,t,n=u()){return(0,a.c)(n,e),n[3]=t,n}function d(e,t,n=(0,c.vt)()){return(0,a.b)(n,e,t),(0,a.n)(n,n),n[3]=-(0,a.d)(e,t),n}function p(e,t=u()){const n=(0,r.l)(T,e);return y(t,(0,i.KJ)((0,s.Xd)(t,n))),t}function f(e,t,n=u()){return(0,s.x8)(T,e,v(e)),(0,s.x8)(E,t,v(t)),(0,s.lw)(T,E,T),y(n,(0,i.KJ)((0,s.Xd)(n,T)))}function m(e,t,n,i=u()){return h(l.Cw,e,x),h(l.JP,t,S),h(l.Cb,n,w),f(x,S,x),f(x,w,i),i}function g(e){return e}function _(e){return e[3]}function v(e){return(0,i.kU)(e[3])}function y(e,t){return e[3]=t,e}const b=[0,0,1,0],T=(0,o.vt)(),E=(0,o.vt)(),x=(u(),u()),S=u(),w=u()},92754:function(e,t,n){"use strict";n.d(t,{Y$:function(){return d},qB:function(){return b},Qt:function(){return U},My:function(){return B},bf:function(){return F},jZ:function(){return g},j0:function(){return _},Sx:function(){return v},E$:function(){return y},h:function(){return O},P:function(){return P},SL:function(){return S},gH:function(){return p},si:function(){return T},mJ:function(){return k},UL:function(){return $},D6:function(){return z},Yi:function(){return R},An:function(){return D},LC:function(){return w},xs:function(){return f},Xm:function(){return E},Vp:function(){return j},zD:function(){return Z},m8:function(){return V},nS:function(){return C},H$:function(){return L},eI:function(){return A},Eq:function(){return m},Aj:function(){return x},E7:function(){return G},Y4:function(){return W},TX:function(){return H},Uz:function(){return I},ml:function(){return N},XP:function(){return M}});class i{constructor(e,t,n=0,i,r){this.TypedArrayConstructor=e,this.elementCount=9;const s=this.TypedArrayConstructor;void 0===i&&(i=9*s.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:n;this.typedBuffer=null==r?new s(t,o):new s(t,o,(r-n)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,n=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+n*this.stride)}getMat(e,t){let n=e*this.typedBufferStride;for(let e=0;e<9;e++)t[e]=this.typedBuffer[n++];return t}setMat(e,t){let n=e*this.typedBufferStride;for(let e=0;e<9;e++)this.typedBuffer[n++]=t[e]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,n){this.typedBuffer[e*this.typedBufferStride+t]=n}copyFrom(e,t,n){const i=this.typedBuffer,r=t.typedBuffer;let s=e*this.typedBufferStride,o=n*t.typedBufferStride;for(let e=0;e<9;++e)i[s++]=r[o++]}get buffer(){return this.typedBuffer.buffer}}i.ElementCount=9;class r{constructor(e,t,n=0,i,r){this.TypedArrayConstructor=e,this.elementCount=16;const s=this.TypedArrayConstructor;void 0===i&&(i=16*s.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:n;this.typedBuffer=null==r?new s(t,o):new s(t,o,(r-n)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,n=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+n*this.stride)}getMat(e,t){let n=e*this.typedBufferStride;for(let e=0;e<16;e++)t[e]=this.typedBuffer[n++];return t}setMat(e,t){let n=e*this.typedBufferStride;for(let e=0;e<16;e++)this.typedBuffer[n++]=t[e]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,n){this.typedBuffer[e*this.typedBufferStride+t]=n}copyFrom(e,t,n){const i=this.typedBuffer,r=t.typedBuffer;let s=e*this.typedBufferStride,o=n*t.typedBufferStride;for(let e=0;e<16;++e)i[s++]=r[o++]}get buffer(){return this.typedBuffer.buffer}}r.ElementCount=16;class s{constructor(e,t,n=0,i,r){this.TypedArrayConstructor=e,this.elementCount=1;const s=this.TypedArrayConstructor;void 0===i&&(i=s.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:n;this.typedBuffer=null==r?new s(t,o):new s(t,o,(r-n)/s.BYTES_PER_ELEMENT),this.stride=i,this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,t,n=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+n*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,t){this.typedBuffer[e*this.typedBufferStride]=t}get buffer(){return this.typedBuffer.buffer}}s.ElementCount=1;var o=n(13786);class a{constructor(e,t,n=0,i,r){this.TypedArrayConstructor=e,this.elementCount=2;const s=this.TypedArrayConstructor;void 0===i&&(i=2*s.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:n;this.typedBuffer=null==r?new s(t,o):new s(t,o,(r-n)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,n=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+n*this.stride)}getVec(e,t){return e*=this.typedBufferStride,(0,o.hZ)(t,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e]=t[1]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,n){this.typedBuffer[e*this.typedBufferStride+t]=n}setValues(e,t,n){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e]=n}copyFrom(e,t,n){const i=this.typedBuffer,r=t.typedBuffer;let s=e*this.typedBufferStride,o=n*t.typedBufferStride;i[s++]=r[o++],i[s]=r[o]}get buffer(){return this.typedBuffer.buffer}}a.ElementCount=2;var l=n(20551);class c{constructor(e,t,n=0,i,r){this.TypedArrayConstructor=e,this.elementCount=3;const s=this.TypedArrayConstructor;void 0===i&&(i=3*s.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:n;this.typedBuffer=null==r?new s(t,o):new s(t,o,(r-n)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,n=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+n*this.stride)}getVec(e,t){return e*=this.typedBufferStride,(0,l.s)(t,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e++]=t[1],this.typedBuffer[e]=t[2]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,n){this.typedBuffer[e*this.typedBufferStride+t]=n}setValues(e,t,n,i){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e++]=n,this.typedBuffer[e]=i}copyFrom(e,t,n){const i=this.typedBuffer,r=t.typedBuffer;let s=e*this.typedBufferStride,o=n*t.typedBufferStride;i[s++]=r[o++],i[s++]=r[o++],i[s]=r[o]}get buffer(){return this.typedBuffer.buffer}}c.ElementCount=3;var u=n(33400);class h{constructor(e,t,n=0,i,r){this.TypedArrayConstructor=e,this.start=n,this.elementCount=4;const s=this.TypedArrayConstructor;void 0===i&&(i=4*s.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:n;this.typedBuffer=null==r?new s(t,o):new s(t,o,(r-n)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,n=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+n*this.stride)}getVec(e,t){return e*=this.typedBufferStride,(0,u.s)(t,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e++]=t[1],this.typedBuffer[e++]=t[2],this.typedBuffer[e]=t[3]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,n){this.typedBuffer[e*this.typedBufferStride+t]=n}setValues(e,t,n,i,r){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e++]=n,this.typedBuffer[e++]=i,this.typedBuffer[e]=r}copyFrom(e,t,n){const i=this.typedBuffer,r=t.typedBuffer;let s=e*this.typedBufferStride,o=n*t.typedBufferStride;i[s++]=r[o++],i[s++]=r[o++],i[s++]=r[o++],i[s]=r[o]}get buffer(){return this.typedBuffer.buffer}}h.ElementCount=4;class d extends s{constructor(e,t=0,n,i){super(Float32Array,e,t,n,i),this.elementType="f32"}static fromTypedArray(e,t){return new d(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}d.ElementType="f32";class p extends a{constructor(e,t=0,n,i){super(Float32Array,e,t,n,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(p,e,t)}static fromTypedArray(e,t){return new p(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}p.ElementType="f32";class f extends c{constructor(e,t=0,n,i){super(Float32Array,e,t,n,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(f,e,t)}static fromTypedArray(e,t){return new f(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}f.ElementType="f32";class m extends h{constructor(e,t=0,n,i){super(Float32Array,e,t,n,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(m,e,t)}static fromTypedArray(e,t){return new m(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}m.ElementType="f32";class g extends i{constructor(e,t=0,n,i){super(Float32Array,e,t,n,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(g,e,t)}static fromTypedArray(e,t){return new g(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}g.ElementType="f32";class _ extends i{constructor(e,t=0,n,i){super(Float64Array,e,t,n,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(_,e,t)}static fromTypedArray(e,t){return new _(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}_.ElementType="f64";class v extends r{constructor(e,t=0,n,i){super(Float32Array,e,t,n,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(v,e,t)}static fromTypedArray(e,t){return new v(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}v.ElementType="f32";class y extends r{constructor(e,t=0,n,i){super(Float64Array,e,t,n,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(y,e,t)}static fromTypedArray(e,t){return new y(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}y.ElementType="f64";class b extends s{constructor(e,t=0,n,i){super(Float64Array,e,t,n,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(b,e,t)}static fromTypedArray(e,t){return new b(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}b.ElementType="f64";class T extends a{constructor(e,t=0,n,i){super(Float64Array,e,t,n,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(T,e,t)}static fromTypedArray(e,t){return new T(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}T.ElementType="f64";class E extends c{constructor(e,t=0,n,i){super(Float64Array,e,t,n,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(E,e,t)}static fromTypedArray(e,t){return new E(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}E.ElementType="f64";class x extends h{constructor(e,t=0,n,i){super(Float64Array,e,t,n,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(x,e,t)}static fromTypedArray(e,t){return new x(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}x.ElementType="f64";class S extends s{constructor(e,t=0,n,i){super(Uint8Array,e,t,n,i),this.elementType="u8"}slice(e,t){return this.sliceBuffer(S,e,t)}static fromTypedArray(e,t){return new S(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}S.ElementType="u8";class w extends a{constructor(e,t=0,n,i){super(Uint8Array,e,t,n,i),this.elementType="u8"}slice(e,t){return this.sliceBuffer(w,e,t)}static fromTypedArray(e,t){return new w(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}w.ElementType="u8";class A extends c{constructor(e,t=0,n,i){super(Uint8Array,e,t,n,i),this.elementType="u8"}slice(e,t){return this.sliceBuffer(A,e,t)}static fromTypedArray(e,t){return new A(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}A.ElementType="u8";class M extends h{constructor(e,t=0,n,i){super(Uint8Array,e,t,n,i),this.elementType="u8"}slice(e,t){return this.sliceBuffer(M,e,t)}static fromTypedArray(e,t){return new M(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}M.ElementType="u8";class O extends s{constructor(e,t=0,n,i){super(Uint16Array,e,t,n,i),this.elementType="u16"}slice(e,t){return this.sliceBuffer(O,e,t)}static fromTypedArray(e,t){return new O(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}O.ElementType="u16";class R extends a{constructor(e,t=0,n,i){super(Uint16Array,e,t,n,i),this.elementType="u16"}slice(e,t){return this.sliceBuffer(R,e,t)}static fromTypedArray(e,t){return new R(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}R.ElementType="u16";class C extends c{constructor(e,t=0,n,i){super(Uint16Array,e,t,n,i),this.elementType="u16"}slice(e,t){return this.sliceBuffer(C,e,t)}static fromTypedArray(e,t){return new C(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}C.ElementType="u16";class I extends h{constructor(e,t=0,n,i){super(Uint16Array,e,t,n,i),this.elementType="u16"}slice(e,t){return this.sliceBuffer(I,e,t)}static fromTypedArray(e,t){return new I(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}I.ElementType="u16";class P extends s{constructor(e,t=0,n,i){super(Uint32Array,e,t,n,i),this.elementType="u32"}slice(e,t){return this.sliceBuffer(P,e,t)}static fromTypedArray(e,t){return new P(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}P.ElementType="u32";class D extends a{constructor(e,t=0,n,i){super(Uint32Array,e,t,n,i),this.elementType="u32"}slice(e,t){return this.sliceBuffer(D,e,t)}static fromTypedArray(e,t){return new D(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}D.ElementType="u32";class L extends c{constructor(e,t=0,n,i){super(Uint32Array,e,t,n,i),this.elementType="u32"}slice(e,t){return this.sliceBuffer(L,e,t)}static fromTypedArray(e,t){return new L(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}L.ElementType="u32";class N extends h{constructor(e,t=0,n,i){super(Uint32Array,e,t,n,i),this.elementType="u32"}slice(e,t){return this.sliceBuffer(N,e,t)}static fromTypedArray(e,t){return new N(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}N.ElementType="u32";class F extends s{constructor(e,t=0,n,i){super(Int8Array,e,t,n,i),this.elementType="i8"}slice(e,t){return this.sliceBuffer(F,e,t)}static fromTypedArray(e,t){return new F(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}F.ElementType="i8";class z extends a{constructor(e,t=0,n,i){super(Int8Array,e,t,n,i),this.elementType="i8"}slice(e,t){return this.sliceBuffer(z,e,t)}static fromTypedArray(e,t){return new z(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}z.ElementType="i8";class V extends c{constructor(e,t=0,n,i){super(Int8Array,e,t,n,i),this.elementType="i8"}slice(e,t){return this.sliceBuffer(V,e,t)}static fromTypedArray(e,t){return new V(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}V.ElementType="i8";class H extends h{constructor(e,t=0,n,i){super(Int8Array,e,t,n,i),this.elementType="i8"}slice(e,t){return this.sliceBuffer(H,e,t)}static fromTypedArray(e,t){return new H(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}H.ElementType="i8";class U extends s{constructor(e,t=0,n,i){super(Int16Array,e,t,n,i),this.elementType="i16"}slice(e,t){return this.sliceBuffer(U,e,t)}static fromTypedArray(e,t){return new U(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}U.ElementType="i16";class k extends a{constructor(e,t=0,n,i){super(Int16Array,e,t,n,i),this.elementType="i16"}slice(e,t){return this.sliceBuffer(k,e,t)}static fromTypedArray(e,t){return new k(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}k.ElementType="i16";class j extends c{constructor(e,t=0,n,i){super(Int16Array,e,t,n,i),this.elementType="i16"}slice(e,t){return this.sliceBuffer(j,e,t)}static fromTypedArray(e,t){return new j(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}j.ElementType="i16";class G extends h{constructor(e,t=0,n,i){super(Int16Array,e,t,n,i),this.elementType="i16"}slice(e,t){return this.sliceBuffer(G,e,t)}static fromTypedArray(e,t){return new G(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}G.ElementType="i16";class B extends s{constructor(e,t=0,n,i){super(Int32Array,e,t,n,i),this.elementType="i32"}slice(e,t){return this.sliceBuffer(B,e,t)}static fromTypedArray(e,t){return new B(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}B.ElementType="i32";class $ extends a{constructor(e,t=0,n,i){super(Int32Array,e,t,n,i),this.elementType="i32"}slice(e,t){return this.sliceBuffer($,e,t)}static fromTypedArray(e,t){return new $(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}$.ElementType="i32";class Z extends c{constructor(e,t=0,n,i){super(Int32Array,e,t,n,i),this.elementType="i32"}slice(e,t){return this.sliceBuffer(Z,e,t)}static fromTypedArray(e,t){return new Z(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}Z.ElementType="i32";class W extends h{constructor(e,t=0,n,i){super(Int32Array,e,t,n,i),this.elementType="i32"}slice(e,t){return this.sliceBuffer(W,e,t)}static fromTypedArray(e,t){return new W(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}W.ElementType="i32"},28404:function(e,t,n){"use strict";function i(e){switch(e){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}n.d(t,{GJ:function(){return i}})},91912:function(e,t,n){"use strict";n.d(t,{$e:function(){return a},j1:function(){return l},mO:function(){return c},vt:function(){return o}});var i=n(89736),r=n(20551),s=n(79578);function o(e){return e?{ray:(0,s.vt)(e.ray),c0:e.c0,c1:e.c1}:{ray:(0,s.vt)(),c0:0,c1:Number.MAX_VALUE}}function a(e,t=o()){return(0,s.C)(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function l(e,t){return u(e,e.c0,t)}function c(e,t){return u(e,e.c1,t)}function u(e,t,n){return(0,r.g)(n,e.ray.origin,(0,r.j)(n,e.ray.direction,t))}new i.I((()=>o()))},69508:function(e,t,n){"use strict";n.d(t,{C:function(){return g},FB:function(){return i},ig:function(){return y},m7:function(){return v},ui:function(){return _},vt:function(){return m}});var i,r,s,o=n(89736),a=n(73364),l=n(20551),c=n(32501),u=n(33400),h=n(41546),d=n(91912),p=n(5596),f=n(50973);function m(e){return e?[(0,p.vt)(e[0]),(0,p.vt)(e[1]),(0,p.vt)(e[2]),(0,p.vt)(e[3]),(0,p.vt)(e[4]),(0,p.vt)(e[5])]:[(0,p.vt)(),(0,p.vt)(),(0,p.vt)(),(0,p.vt)(),(0,p.vt)(),(0,p.vt)()]}function g(e,t){for(let n=0;n<b;n++)(0,p.C)(e[n],t[n]);return e}function _(e,t,n,s=x){const o=(0,a.lw)(f.Rc.get(),t,e);(0,a.B8)(o,o);for(let e=0;e<T;++e){const t=(0,u.t)(f.Km.get(),E[e],o);(0,l.s)(s[e],t[0]/t[3],t[1]/t[3],t[2]/t[3])}!function(e,t){(0,p.Cr)(t[r.FAR_BOTTOM_LEFT],t[r.NEAR_BOTTOM_LEFT],t[r.NEAR_TOP_LEFT],e[i.LEFT]),(0,p.Cr)(t[r.NEAR_BOTTOM_RIGHT],t[r.FAR_BOTTOM_RIGHT],t[r.FAR_TOP_RIGHT],e[i.RIGHT]),(0,p.Cr)(t[r.FAR_BOTTOM_LEFT],t[r.FAR_BOTTOM_RIGHT],t[r.NEAR_BOTTOM_RIGHT],e[i.BOTTOM]),(0,p.Cr)(t[r.NEAR_TOP_LEFT],t[r.NEAR_TOP_RIGHT],t[r.FAR_TOP_RIGHT],e[i.TOP]),(0,p.Cr)(t[r.NEAR_BOTTOM_LEFT],t[r.NEAR_BOTTOM_RIGHT],t[r.NEAR_TOP_RIGHT],e[i.NEAR]),(0,p.Cr)(t[r.FAR_BOTTOM_RIGHT],t[r.FAR_BOTTOM_LEFT],t[r.FAR_TOP_LEFT],e[i.FAR])}(n,s)}function v(e,t){for(let n=0;n<b;n++){const i=e[n];if(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]>=t[3])return!1}return!0}function y(e,t){for(let n=0;n<b;n++){const i=e[n];if(!(0,p.b6)(i,t))return!1}return!0}(s=i||(i={}))[s.LEFT=0]="LEFT",s[s.RIGHT=1]="RIGHT",s[s.BOTTOM=2]="BOTTOM",s[s.TOP=3]="TOP",s[s.NEAR=4]="NEAR",s[s.FAR=5]="FAR",function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(r||(r={})),r.FAR_BOTTOM_RIGHT,r.NEAR_BOTTOM_RIGHT,r.NEAR_BOTTOM_LEFT,r.FAR_BOTTOM_LEFT,r.NEAR_BOTTOM_LEFT,r.NEAR_BOTTOM_RIGHT,r.NEAR_TOP_RIGHT,r.NEAR_TOP_LEFT,r.FAR_BOTTOM_RIGHT,r.FAR_BOTTOM_LEFT,r.FAR_TOP_LEFT,r.FAR_TOP_RIGHT,r.NEAR_BOTTOM_RIGHT,r.FAR_BOTTOM_RIGHT,r.FAR_TOP_RIGHT,r.NEAR_TOP_RIGHT,r.FAR_BOTTOM_LEFT,r.NEAR_BOTTOM_LEFT,r.NEAR_TOP_LEFT,r.FAR_TOP_LEFT,r.FAR_TOP_LEFT,r.NEAR_TOP_LEFT,r.NEAR_TOP_RIGHT,r.FAR_TOP_RIGHT;const b=6,T=8,E=[(0,h.fA)(-1,-1,-1,1),(0,h.fA)(1,-1,-1,1),(0,h.fA)(1,1,-1,1),(0,h.fA)(-1,1,-1,1),(0,h.fA)(-1,-1,1,1),(0,h.fA)(1,-1,1,1),(0,h.fA)(1,1,1,1),(0,h.fA)(-1,1,1,1)],x=(new o.I(d.vt),[(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)()])},73313:function(e,t,n){"use strict";n.d(t,{C:function(){return c},Cr:function(){return h},H6:function(){return m},_I:function(){return p},dz:function(){return g},fA:function(){return u},kb:function(){return d},ld:function(){return _},sd:function(){return f},vt:function(){return l}});var i=n(15774),r=n(89736),s=n(20551),o=n(32501),a=n(50973);function l(e){return e?{origin:(0,o.o8)(e.origin),vector:(0,o.o8)(e.vector)}:{origin:(0,o.vt)(),vector:(0,o.vt)()}}function c(e,t=l()){return u(e.origin,e.vector,t)}function u(e,t,n=l()){return(0,s.c)(n.origin,e),(0,s.c)(n.vector,t),n}function h(e,t,n=l()){return(0,s.c)(n.origin,e),(0,s.f)(n.vector,t,e),n}function d(e,t){const n=(0,s.f)(a.rq.get(),t,e.origin),r=(0,s.m)(e.vector,n),o=(0,s.m)(e.vector,e.vector),l=(0,i.qE)(r/o,0,1),c=(0,s.f)(a.rq.get(),(0,s.j)(a.rq.get(),e.vector,l),n);return(0,s.m)(c,c)}function p(e,t,n){return m(e,t,0,1,n)}function f(e,t,n){return(0,s.g)(n,e.origin,(0,s.j)(n,e.vector,t))}function m(e,t,n,r,o){const{vector:l,origin:c}=e,u=(0,s.f)(a.rq.get(),t,c),h=(0,s.m)(l,u)/(0,s.q)(l);return(0,s.j)(o,l,(0,i.qE)(h,n,r)),(0,s.g)(o,o,e.origin)}function g(e,t){if(v(e,function(e,t){const n=b.get();return n.origin=e,n.vector=t,n}(t.origin,t.direction),!1,y)){const{tA:t,pB:n,distance2:i}=y;if(t>=0&&t<=1)return i;if(t<0)return(0,s.a)(e.origin,n);if(t>1)return(0,s.a)((0,s.g)(a.rq.get(),e.origin,e.vector),n)}return null}function _(e,t,n){return!!v(e,t,!0,y)&&((0,s.c)(n,y.pA),!0)}function v(e,t,n,r){const o=1e-6,l=e.origin,c=(0,s.g)(a.rq.get(),l,e.vector),u=t.origin,h=(0,s.g)(a.rq.get(),u,t.vector),d=a.rq.get(),p=a.rq.get();if(d[0]=l[0]-u[0],d[1]=l[1]-u[1],d[2]=l[2]-u[2],p[0]=h[0]-u[0],p[1]=h[1]-u[1],p[2]=h[2]-u[2],Math.abs(p[0])<o&&Math.abs(p[1])<o&&Math.abs(p[2])<o)return!1;const f=a.rq.get();if(f[0]=c[0]-l[0],f[1]=c[1]-l[1],f[2]=c[2]-l[2],Math.abs(f[0])<o&&Math.abs(f[1])<o&&Math.abs(f[2])<o)return!1;const m=d[0]*p[0]+d[1]*p[1]+d[2]*p[2],g=p[0]*f[0]+p[1]*f[1]+p[2]*f[2],_=d[0]*f[0]+d[1]*f[1]+d[2]*f[2],v=p[0]*p[0]+p[1]*p[1]+p[2]*p[2],y=(f[0]*f[0]+f[1]*f[1]+f[2]*f[2])*v-g*g;if(Math.abs(y)<o)return!1;let b=(m*g-_*v)/y,T=(m+g*b)/v;n&&(b=(0,i.qE)(b,0,1),T=(0,i.qE)(T,0,1));const E=a.rq.get(),x=a.rq.get();return E[0]=l[0]+b*f[0],E[1]=l[1]+b*f[1],E[2]=l[2]+b*f[2],x[0]=u[0]+T*p[0],x[1]=u[1]+T*p[1],x[2]=u[2]+T*p[2],r.tA=b,r.tB=T,r.pA=E,r.pB=x,r.distance2=(0,s.a)(E,x),!0}const y={tA:0,tB:0,pA:(0,o.vt)(),pB:(0,o.vt)(),distance2:0},b=new r.I((()=>l()))},61003:function(e,t,n){"use strict";n.d(t,{b:function(){return s}});var i=n(15774),r=n(37819);function s(e,t,n){const s=Array.isArray(e),u=s?e.length/t:e.byteLength/(4*t),h=s?e:new Uint32Array(e,0,u*t),d=n?.minReduction??0,p=n?.originalIndices||null,f=p?p.length:0,m=n?.componentOffsets||null;let g=0;if(m)for(let e=0;e<m.length-1;e++){const t=m[e+1]-m[e];t>g&&(g=t)}else g=u;const _=Math.floor(1.1*g)+1;(null==c||c.length<2*_)&&(c=new Uint32Array((0,i.cU)(2*_)));for(let e=0;e<2*_;e++)c[e]=0;let v=0;const y=!!m&&!!p,b=y?f:u;let T=(0,r.my)(u);const E=new Uint32Array(f),x=1.96;let S=0!==d?Math.ceil(4*x*x/(d*d)*d*(1-d)):b,w=1,A=m?m[1]:b;for(let e=0;e<b;e++){if(e===S){const t=1-v/e;if(t+x*Math.sqrt(t*(1-t)/e)<d)return null;S*=2}if(e===A){for(let e=0;e<2*_;e++)c[e]=0;if(p)for(let e=m[w-1];e<m[w];e++)E[e]=T[p[e]];A=m[++w]}const n=y?p[e]:e,i=n*t,r=l(h,i,t);let s=r%_,a=v;for(;0!==c[2*s+1];){if(c[2*s]===r){const e=c[2*s+1]-1;if(o(h,i,e*t,t)){a=T[e];break}}s++,s>=_&&(s-=_)}a===v&&(c[2*s]=r,c[2*s+1]=n+1,v++),T[n]=a}if(0!==d&&1-v/u<d)return null;if(y){for(let e=m[w-1];e<E.length;e++)E[e]=T[p[e]];T=(0,r.Dg)(E)}const M=s?new Array(v):new Uint32Array(v*t);v=0;for(let e=0;e<b;e++)T[e]===v&&(a(h,(y?p[e]:e)*t,M,v*t,t),v++);if(p&&!y){const e=new Uint32Array(f);for(let t=0;t<e.length;t++)e[t]=T[p[t]];T=(0,r.Dg)(e)}return{buffer:Array.isArray(M)?M:M.buffer,indices:T,uniqueCount:v}}function o(e,t,n,i){for(let r=0;r<i;r++)if(e[t+r]!==e[n+r])return!1;return!0}function a(e,t,n,i,r){for(let s=0;s<r;s++)n[i+s]=e[t+s]}function l(e,t,n){let i=0;for(let r=0;r<n;r++)i=e[t+r]+i|0,i=i+(i<<11)+(i>>>2)|0;return i>>>0}let c=null},67376:function(e,t,n){"use strict";n.d(t,{CK:function(){return d},E9:function(){return u},Hq:function(){return h},MW:function(){return p},TE:function(){return f},yJ:function(){return m}});var i=n(88022),r=n(40633),s=n(20551),o=n(45532),a=n(65907),l=n(20460);function c(){return r.A.getLogger("esri.geometry.Mesh")}function u(e){return!h(e)}function h(e){return null!=e.origin}function d(e){return h(e.vertexSpace)}function p(e,t){if(!h(e))return null;const[n,i,r]=e.origin;return new o.default({x:n,y:i,z:r,spatialReference:t})}function f(e,t){const{x:n,y:r,z:s,spatialReference:o}=e,u=[n,r,s??0];return void 0!==t?.geographic&&((0,i.io)(c(),"option: geographic",{replacement:"Use the `vertexSpace` option instead.",version:"4.29",warnOnce:!0}),t.vertexSpace&&c().warn("Deprecated geographic flag ignored since vertexSpace option is provided.")),"local"===(t?.vertexSpace??(h=t?.geographic,null==h?void 0:h?"local":"georeferenced")??function(e){return e.isGeographic||e.isWebMercator?"local":"georeferenced"}(o))?new l.A({origin:u}):new a.A({origin:u});var h}function m(e,t){return e.type===t.type&&(e.origin===t.origin||null!=e.origin&&null!=t.origin&&(0,s.e)(e.origin,t.origin))}},6527:function(e,t,n){"use strict";n.d(t,{S:function(){return l}});var i=n(15774),r=n(62938),s=n(20551),o=n(72485),a=n(5596);function l(e,t,n){const l=function(e,t,n,i){const o=(e=>!Array.isArray(e[0]))(t)?(e,n)=>t[3*e+n]:(e,n)=>t[e][n],l=i?(0,r.GA)(i)/(0,r.G9)(i):1;return(0,a.lU)(e,((e,t)=>(0,s.s)(e,o(t,0)*l,o(t,1)*l,o(t,2))),n)}(c,e,t,n)?(0,a.Qj)(c):[0,0,1];return Math.abs(l[2])>Math.cos((0,i.kU)(80))?o._.Z:Math.abs(l[1])>Math.abs(l[0])?o._.Y:o._.X}const c=(0,a.vt)()},67496:function(e,t,n){"use strict";n.d(t,{Fm:function(){return a},Q7:function(){return l}});var i=n(89736),r=n(20551),s=n(32501),o=n(73313);function a(e,t,n){const i=t[0]-e[0],r=t[1]-e[1],s=n[0]-e[0],o=n[1]-e[1];return.5*Math.abs(i*o-r*s)}function l(e,t,n){return(0,r.f)(c,t,e),(0,r.f)(u,n,e),.5*(0,r.l)((0,r.b)(c,c,u))}n(50973),new i.I(o.vt),new i.I((()=>{return e?{p0:(0,s.o8)(e.p0),p1:(0,s.o8)(e.p1),p2:(0,s.o8)(e.p2)}:{p0:(0,s.vt)(),p1:(0,s.vt)(),p2:(0,s.vt)()};var e}));const c=(0,s.vt)(),u=(0,s.vt)()},82588:function(e,t,n){"use strict";n.d(t,{Wq:function(){return i},lO:function(){return d},oR:function(){return p}});var i,r,s=n(59122),o=n(72485),a=n(38441),l=n(50240),c=n(37819),u=n(6527),h=n(61003);function d(e){const t=p(e.rings,e.hasZ,i.CCW_IS_HOLE,e.spatialReference),n=new Array;let r=0,o=0;for(const e of t.polygons){const i=e.count,a=e.index,u=(0,l.l5)(t.position,3*a,3*i),h=e.holeIndices.map((e=>e-a)),d=(0,c.Dg)((0,s.e)(u,h,3));n.push({position:u,faces:d}),r+=u.length,o+=d.length}const a=function(e,t,n){if(1===e.length)return e[0];const i=(0,l.jh)(t),r=new Array(n);let s=0,o=0,a=0;for(const t of e){for(let e=0;e<t.position.length;e++)i[s++]=t.position[e];for(const e of t.faces)r[o++]=e+a;a=s/3}return{position:i,faces:(0,c.Dg)(r)}}(n,r,o),u=Array.isArray(a.position)?(0,h.b)(a.position,3,{originalIndices:a.faces}):(0,h.b)(a.position.buffer,6,{originalIndices:a.faces});return a.position=(0,l.xm)(new Float64Array(u.buffer)),a.faces=u.indices,a}function p(e,t,n,r){const s=e.length,o=new Array(s),a=new Array(s),c=new Array(s);let u=0;for(let t=0;t<s;++t)u+=e[t].length;let h=0,d=0,p=0;const g=(0,l.jh)(3*u);let _=0;for(let l=s-1;l>=0;l--){const u=e[l],v=n===i.CCW_IS_HOLE&&m(u,t,r);if(v&&1!==s)o[h++]=u;else{let e=u.length;for(let t=0;t<h;++t)e+=o[t].length;const n={index:_,pathLengths:new Array(h+1),count:e,holeIndices:new Array(h)};n.pathLengths[0]=u.length,u.length>0&&(c[p++]={index:_,count:u.length}),_=v?f(u,u.length-1,-1,g,_,u.length,t):f(u,0,1,g,_,u.length,t);for(let e=0;e<h;++e){const i=o[e];n.holeIndices[e]=_,n.pathLengths[e+1]=i.length,i.length>0&&(c[p++]={index:_,count:i.length}),_=f(i,0,1,g,_,i.length,t)}h=0,n.count>0&&(a[d++]=n)}}for(let e=0;e<h;++e){const n=o[e];n.length>0&&(c[p++]={index:_,count:n.length}),_=f(n,0,1,g,_,n.length,t)}return a.length=d,c.length=p,{position:g,polygons:a,outlines:c}}function f(e,t,n,i,r,s,o){r*=3;for(let a=0;a<s;++a){const s=e[t];i[r++]=s[0],i[r++]=s[1],i[r++]=o?s[2]:0,t+=n}return r/3}function m(e,t,n){if(!t)return!(0,a.$3)(e);const i=e.length-1;switch((0,u.S)(e,i,n)){case o._.X:return!(0,a.$3)(e,o._.Y,o._.Z);case o._.Y:return!(0,a.$3)(e,o._.X,o._.Z);case o._.Z:return!(0,a.$3)(e,o._.X,o._.Y)}}(r=i||(i={}))[r.NONE=0]="NONE",r[r.CCW_IS_HOLE=1]="CCW_IS_HOLE"},42413:function(e,t,n){"use strict";n.d(t,{CI:function(){return s},fk:function(){return o}}),n(58941);var i=n(15774),r=n(57652);function s(e,t){return e===t||null!=e&&null!=t&&(0,r.aI)(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function o(e,t,n){return e===t||null!=e&&null!=t&&(0,r.aI)(e.spatialReference,t.spatialReference)&&(0,i.Sp)(e.x,t.x,n)&&(0,i.Sp)(e.y,t.y,n)&&(0,i.Sp)(e.z??0,t.z??0,n)&&(0,i.Sp)(e.m??0,t.m??0,n)}},5915:function(e,t,n){"use strict";function i(e){return"point"===e.type}n.d(t,{v:function(){return i}})},45328:function(e,t,n){"use strict";n.d(t,{EL:function(){return g},RS:function(){return _},gr:function(){return c},wP:function(){return h},wZ:function(){return d}}),n(50917);var i=n(59469),r=(n(58941),n(21609)),s=n(24540),o=n(74697),a=n(46460),l=n(57165);function c(e){return"declaredClass"in e}function u(e){return"declaredClass"in e}function h(e,t){return e?"declaredClass"in e?e:new i.default({layer:t,sourceLayer:t,visible:e.visible,symbol:(0,r.o8)(e.symbol),attributes:(0,r.o8)(e.attributes),geometry:d(e.geometry)}):null}function d(e){return null==e?null:c(e)?e:(0,o.rS)(function(e){const{wkid:t,wkt:n,wkt2:i,latestWkid:r}=e.spatialReference,s={wkid:t,wkt:n,wkt2:i,latestWkid:r};switch(e.type){case"point":{const{x:t,y:n,z:i,m:r}=e;return{x:t,y:n,z:i,m:r,spatialReference:s}}case"polygon":{const{rings:t,hasZ:n,hasM:i}=e;return{rings:p(t),hasZ:n,hasM:i,spatialReference:s}}case"polyline":{const{paths:t,hasZ:n,hasM:i}=e;return{paths:p(t),hasZ:n,hasM:i,spatialReference:s}}case"extent":{const{xmin:t,xmax:n,ymin:i,ymax:r,zmin:o,zmax:a,mmin:l,mmax:c,hasZ:u,hasM:h}=e;return{xmin:t,xmax:n,ymin:i,ymax:r,zmin:o,zmax:a,mmin:l,mmax:c,hasZ:u,hasM:h,spatialReference:s}}case"multipoint":{const{points:t,hasZ:n,hasM:i}=e;return{points:m(t)?f(t):t,hasZ:n,hasM:i,spatialReference:s}}default:return}}(e))}function p(e){return function(e){for(const t of e)if(0!==t.length)return m(t);return!1}(e)?e.map((e=>f(e))):e}function f(e){return e.map((e=>Array.from(e)))}function m(e){return e.length>0&&((0,s.vZ)(e[0])||(0,s.aI)(e[0]))}function g(e,t){if(!e)return null;let n;if(u(e)){if(null==t)return e.clone();if(u(t))return t.copy(e)}return null!=t?(n=t,n.x=e.x,n.y=e.y,n.spatialReference=e.spatialReference,e.hasZ?(n.z=e.z,n.hasZ=e.hasZ):(n.z=void 0,n.hasZ=!1),e.hasM?(n.m=e.m,n.hasM=!0):(n.m=void 0,n.hasM=!1)):(n=(0,a.T)(e.x,e.y,e.z,e.spatialReference),e.hasM&&(n.m=e.m,n.hasM=!0)),n}function _(e){const{wkid:t,wkt:n,wkt2:i,latestWkid:r}=e,s={wkid:t,wkt:n,wkt2:i,latestWkid:r};return l.A.fromJSON(s)}},14921:function(e,t,n){"use strict";var i;n.d(t,{$:function(){return i}}),function(e){e[e.EnableFastUpdates=0]="EnableFastUpdates",e[e.DisableFastUpdates=1]="DisableFastUpdates",e[e.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"}(i||(i={}))},47558:function(e,t,n){"use strict";n.d(t,{T:function(){return o}});var i=n(60539),r=n(85445),s=n(55213);class o{constructor(){this._tasks=new Array,this._runningTasks=(0,r.v)(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(e){if(0===this.length)return s.G;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,n){return++this._runningTasks.value,new Promise(((i,r)=>this._tasks.push(new a(i,r,e,t,n)))).finally((()=>--this._runningTasks.value))}unshift(e,t,n){return++this._runningTasks.value,new Promise(((i,r)=>this._tasks.unshift(new a(i,r,e,t,n)))).finally((()=>--this._runningTasks.value))}_process(e){if(0===this._tasks.length)return!1;const t=this._tasks.shift();try{const n=(0,i.G4)(t.signal);if(n&&!t.abortCallback)t.reject((0,i.NK)());else{const r=n?t.abortCallback?.((0,i.NK)()):t.callback(e);(0,i.$X)(r)?r.then(t.resolve,t.reject):t.resolve(r)}}catch(e){t.reject(e)}return!0}cancelAll(){const e=(0,i.NK)();for(const t of this._tasks)if(t.abortCallback){const n=t.abortCallback(e);t.resolve(n)}else t.reject(e);this._tasks.length=0}}class a{constructor(e,t,n,i=void 0,r=void 0){this.resolve=e,this.reject=t,this.callback=n,this.signal=i,this.abortCallback=r}}},92781:function(e,t,n){"use strict";n.d(t,{R:function(){return s},t:function(){return o}});var i=n(77528);const r={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,n)=>{"-"===t.charAt(0)?e.style.setProperty(t,n):e.style[t]=n}};let s=e=>(0,i.X$)(r,e),o={create:(e,t)=>(t=s(t),(0,i.dj)(e,document.createElement("div"),void 0,t),(0,i.Av)(e,t)),append:(e,t,n)=>(n=s(n),(0,i.dj)(t,e,void 0,n),(0,i.Av)(t,n)),insertBefore:(e,t,n)=>(n=s(n),(0,i.dj)(t,e.parentNode,e,n),(0,i.Av)(t,n)),merge:(e,t,n)=>(n=s(n),t.domNode=e,(0,i.OM)(e,t,n),(0,i.Av)(t,n)),replace:(e,t,n)=>(n=s(n),(0,i.dj)(t,e.parentNode,e,n),e.parentNode.removeChild(e),(0,i.Av)(t,n))}},77528:function(e,t,n){"use strict";n.d(t,{Av:function(){return O},OM:function(){return x},X$:function(){return l},dj:function(){return S}});var i=n(20457);const r="http://www.w3.org/",s=`${r}2000/svg`,o=`${r}1999/xlink`;let a=[],l=(e,t)=>{let n={};return Object.keys(e).forEach((t=>{n[t]=e[t]})),t&&Object.keys(t).forEach((e=>{n[e]=t[e]})),n},c=(e,t)=>e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties),u=e=>{if("string"!=typeof e)throw new Error("Style values must be strings")},h=(e,t,n)=>{if(""!==t.vnodeSelector)for(let i=n;i<e.length;i++)if(c(e[i],t))return i;return-1},d=(e,t,n,i)=>{let r=e[t];if(""===r.vnodeSelector)return;let s=r.properties;if(!(s?void 0===s.key?s.bind:s.key:void 0))for(let s=0;s<e.length;s++)if(s!==t){let t=e[s];if(c(t,r))throw new Error(`${n.vnodeSelector} had a ${r.vnodeSelector} child ${"added"===i?i:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}},p=e=>{if(e.properties){let t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},f=[],m=!1,g=e=>{(e.children||[]).forEach(g),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},_=()=>{m=!1,f.forEach(g),f.length=0},v=e=>{f.push(e),m||(m=!0,"undefined"!=typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(_,{timeout:16}):setTimeout(_,16))},y=e=>{let t=e.domNode;if(e.properties){let n=e.properties.exitAnimation;if(n){t.style.pointerEvents="none";let i=()=>{t.parentNode&&(t.parentNode.removeChild(t),v(e))};return void n(t,i,e.properties)}}t.parentNode&&(t.parentNode.removeChild(t),v(e))},b=(e,t,n)=>{if(!t)return;let r=n.eventHandlerInterceptor,a=Object.keys(t),l=a.length;for(let c=0;c<l;c++){let l=a[c],h=t[l];if("className"===l)throw new Error('Property "className" is not supported, use "class".');if("class"===l)w(e,h,!0);else if("classes"===l){let t=Object.keys(h),n=t.length;for(let i=0;i<n;i++){let n=t[i];h[n]&&e.classList.add(n)}}else if("styles"===l){let t=Object.keys(h),i=t.length;for(let r=0;r<i;r++){let i=t[r],s=h[i];s&&(u(s),n.styleApplyer(e,i,s))}}else if("key"!==l&&null!=h){let a=typeof h;"function"===a?(0===l.lastIndexOf("on",0)&&(r&&(h=r(l,h,e,t)),"oninput"===l&&function(){let e=h;h=function(t){e.apply(this,[t]),t.target["oninput-value"]=t.target.value}}()),e[l]=h):n.namespace===s?"href"===l?e.setAttributeNS(o,l,h):e.setAttribute(l,h):"string"===a&&"value"!==l?"innerHTML"===l?e[l]=i.W5.sanitize(h):T(e)&&l in e?e[l]=h:e.setAttribute(l,h):e[l]=h}}};function T(e){if(!(e instanceof Element&&e.tagName.includes("-")))return!1;const t=window.customElements.get(e.tagName.toLowerCase());return!!t&&e instanceof t}let E,x=(e,t,n)=>{((e,t,n)=>{if(t)for(let i of t)S(i,e,void 0,n)})(e,t.children,n),t.text&&(e.textContent=t.text),b(e,t.properties,n),t.properties&&t.properties.afterCreate&&t.properties.afterCreate.apply(t.properties.bind||t.properties,[e,n,t.vnodeSelector,t.properties,t.children])},S=(e,t,n,i)=>{let r,o=0,a=e.vnodeSelector,c=t.ownerDocument;if(""===a)r=e.domNode=c.createTextNode(e.text),void 0!==n?t.insertBefore(r,n):t.appendChild(r);else{for(let u=0;u<=a.length;++u){let h=a.charAt(u);if(u===a.length||"."===h||"#"===h){let h=a.charAt(o-1),d=a.slice(o,u);"."===h?r.classList.add(d):"#"===h?r.id=d:("svg"===d&&(i=l(i,{namespace:s})),void 0!==i.namespace?r=e.domNode=c.createElementNS(i.namespace,d):(r=e.domNode=e.domNode||c.createElement(d),"input"===d&&e.properties&&void 0!==e.properties.type&&r.setAttribute("type",e.properties.type)),void 0!==n?t.insertBefore(r,n):r.parentNode!==t&&t.appendChild(r)),o=u+1}}x(r,e,i)}},w=(e,t,n)=>{t&&t.split(" ").forEach((t=>{t&&e.classList.toggle(t,n)}))},A=(e,t,n,r)=>{if(!n)return;let a=!1,l=Object.keys(n),c=l.length;for(let h=0;h<c;h++){let c=l[h],d=n[c],p=t[c];if("class"===c)p!==d&&(w(e,p,!1),w(e,d,!0));else if("classes"===c){let t=e.classList,n=Object.keys(d),i=n.length;for(let e=0;e<i;e++){let i=n[e],r=!!d[i];r!==!!p[i]&&(a=!0,r?t.add(i):t.remove(i))}}else if("styles"===c){let t=Object.keys(d),n=t.length;for(let i=0;i<n;i++){let n=t[i],s=d[n];s!==p[n]&&(a=!0,s?(u(s),r.styleApplyer(e,n,s)):r.styleApplyer(e,n,""))}}else if(d||"string"!=typeof p||(d=""),"value"!==c||T(e)){if(d!==p){let t=typeof d;"function"===t&&r.eventHandlerInterceptor||(r.namespace===s?"href"===c?e.setAttributeNS(o,c,d):e.setAttribute(c,d):"string"===t?"innerHTML"===c?e[c]=i.W5.sanitize(d):"role"===c&&""===d?e.removeAttribute(c):T(e)&&c in e?e[c]=d:e.setAttribute(c,d):e[c]!==d&&(e[c]=d),a=!0)}}else{let t=e[c];t!==d&&(e["oninput-value"]?t===e["oninput-value"]:d!==p)&&(e[c]=d,e["oninput-value"]=void 0),d!==p&&(a=!0)}}return a},M=(e,t,n,i,r)=>{if(n===i)return!1;i=i||a;let s,o=(n=n||a).length,l=i.length,u=0,f=0,m=!1;for(;f<l;){let a=u<o?n[u]:void 0,l=i[f];if(void 0!==a&&c(a,l))m=E(a,l,r)||m,u++;else{let a=h(n,l,u+1);if(a>=0){for(s=u;s<a;s++)y(n[s]),d(n,s,e,"removed");m=E(n[a],l,r)||m,u=a+1}else S(l,t,u<o?n[u].domNode:void 0,r),p(l),d(i,f,e,"added")}f++}if(o>u)for(s=u;s<o;s++)y(n[s]),d(n,s,e,"removed");return m};E=(e,t,n)=>{let i=e.domNode,r=!1;if(e===t)return!1;let o=!1;if(""===t.vnodeSelector){if(t.text!==e.text){let e=i.ownerDocument.createTextNode(t.text);return i.parentNode.replaceChild(e,i),t.domNode=e,r=!0,r}t.domNode=i}else 0===t.vnodeSelector.lastIndexOf("svg",0)&&(n=l(n,{namespace:s})),e.text!==t.text&&(o=!0,void 0===t.text?i.removeChild(i.firstChild):i.textContent=t.text),t.domNode=i,o=M(t,i,e.children,t.children,n)||o,o=A(i,e.properties,t.properties,n)||o,t.properties&&t.properties.afterUpdate&&t.properties.afterUpdate.apply(t.properties.bind||t.properties,[i,n,t.vnodeSelector,t.properties,t.children]);return o&&t.properties&&t.properties.updateAnimation&&t.properties.updateAnimation(i,t.properties,e.properties),r};let O=(e,t)=>({getLastRender:()=>e,update:n=>{if(e.vnodeSelector!==n.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let i=e;e=n,E(i,n,t)},domNode:e.domNode})},81401:function(e,t,n){"use strict";n.d(t,{F:function(){return a}});var i=n(92781);let r;r=Array.prototype.find?(e,t)=>e.find(t):(e,t)=>e.filter(t)[0];let s=(e,t)=>{let n=e;return t.forEach((e=>{n=n&&n.children?r(n.children,(t=>t.domNode===e)):void 0})),n},o=(e,t,n)=>{let i=function(i){n("domEvent",i);let r=t(),o=((e,t)=>{let n=[];for(;e&&e!==t;)n.push(e),e=e.parentNode;return n})(i.currentTarget,r.domNode);o.reverse();let a,l=s(r.getLastRender(),o);return e.scheduleRender(),l&&(a=l.properties[`on${i.type}`].apply(l.properties.bind||this,arguments)),n("domEventProcessed",i),a};return(e,t,n,r)=>i},a=e=>{let t,n,r=(0,i.R)(e),s=r.performanceLogger,a=!0,l=!1,c=[],u=[],h=(e,n,i)=>{let a;r.eventHandlerInterceptor=o(t,(()=>a),s),a=e(n,i(),r),c.push(a),u.push(i)},d=()=>{if(n=void 0,a){a=!1,s("renderStart",void 0);for(let e=0;e<c.length;e++){let t=u[e]();s("rendered",void 0),c[e].update(t),s("patched",void 0)}s("renderDone",void 0),a=!0}};return t={renderNow:d,scheduleRender:()=>{n||l||(n=requestAnimationFrame(d))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),l=!0},resume:()=>{l=!1,a=!0,t.scheduleRender()},append:(e,t)=>{h(i.t.append,e,t)},insertBefore:(e,t)=>{h(i.t.insertBefore,e,t)},merge:(e,t)=>{h(i.t.merge,e,t)},replace:(e,t)=>{h(i.t.replace,e,t)},detach:e=>{for(let t=0;t<u.length;t++)if(u[t]===e)return u.splice(t,1),c.splice(t,1)[0];throw new Error("renderFunction was not found")}},t}},82465:function(e,t,n){"use strict";n.d(t,{n:function(){return r}});var i=n(90683);function r(e){return s[function(e){return"json"===e.type?"application/json":"blob"===e.type?e.blob.type:function(e){const t=(0,i.Zo)(e);return l[t]||o}(e.url)}(e)]||a}const s={},o="text/plain",a=s[o],l={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const e in l)s[l[e]]=e},82418:function(e,t,n){"use strict";function i(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function r(e,t){return"number"==typeof e?e:e?.stops?.length?function(e){let t=0,n=0;for(let i=0;i<e.length;i++){const r=e[i].size;"number"==typeof r&&(t+=r,n++)}return t/n}(e.stops):t}function s(e,t){if(!t)return e;const n=t.filter((e=>"size"===e.type)).map((t=>{const{maxSize:n,minSize:i}=t;return(r(n,e)+r(i,e))/2}));let i=0;const s=n.length;if(0===s)return e;for(let e=0;e<s;e++)i+=n[e];const o=Math.floor(i/s);return Math.max(o,e)}function o(e){const t=e?.renderer,n=e?.pointerType,r="touch"===n?9:6;if(!t)return r;const o="visualVariables"in t?s(r,t.visualVariables):r;if("simple"===t.type)return i(o,t.symbol);if("unique-value"===t.type){let e=o;return t.uniqueValueInfos?.forEach((t=>{e=i(e,t.symbol)})),e}if("class-breaks"===t.type){let e=o;return t.classBreakInfos.forEach((t=>{e=i(e,t.symbol)})),e}return"dot-density"===t.type||t.type,o}n.d(t,{o:function(){return o}})},76722:function(e,t,n){"use strict";n.d(t,{c:function(){return s}});var i=n(62938),r=n(51432);function s(e){const t="metric";if(null==e)return t;const n=e.map,s=(n&&"portalItem"in n?n.portalItem?.portal:null)??r.A.getDefault();switch(s.user?.units??s.units){case t:return t;case"english":return"imperial"}return(0,i.jM)(e.spatialReference)??t}},9030:function(e,t,n){"use strict";n.d(t,{D:function(){return r}});var i=n(93040);async function r(e,t){const{data:n}=await(0,i.A)(e,{responseType:"image",...t});return n}},93839:function(e,t,n){"use strict";n.d(t,{fJ:function(){return s},g4:function(){return r},hY:function(){return o}});const i="calcite-mode-";function r(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"").startsWith("dark")}function s(){return`${i}${r()?"dark":"light"}`}function o(e){a(e),e.classList.add(s())}function a(e){Array.from(e.classList).forEach((t=>{t.startsWith(i)&&e.classList.remove(t)}))}},38821:function(e,t,n){"use strict";n.d(t,{D:function(){return r},K:function(){return i}});const i={color:[128,128,128,1],outlinecolor:[0,0,0,1],backgroundcolor:[128,128,128,1],borderlinecolor:[0,0,0,1],tintcolor:[255,255,255,1]},r={CIMVectorMarker:{scalesymbolsproportionally:!1,respectframe:!0,anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMPictureMarker:{scalex:1,texturefilter:"Draft",anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMTextSymbol:{angle:0,anglex:0,angley:0,halosize:1,height:10,horizontalalignment:"Left",kerning:!0,letterspacing:0,letterwidth:100,ligatures:!0,linegap:0,offsetx:0,offsety:0,strikethrough:!1,textcase:"Normal",textstring:"",underline:!1,verticalalignment:"Bottom",enable:!0,colorlocked:!1},CIMSolidStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMPictureStroke:{texturefilter:"Draft",capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMGradientStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMSolidFill:{enable:!0,colorlocked:!1},CIMPictureFill:{offsetx:0,offsety:0,rotation:0,scalex:1,height:10,texturefilter:"Draft",enable:!0,colorlocked:!1},CIMHatchFill:{offsetx:0,offsety:0,rotation:0,separation:4,enable:!0,colorlocked:!1},CIMGeometricEffectAddControlPoints:{angletolerance:120},CIMGeometricEffectArrow:{arrowtype:"OpenEnded",width:5},CIMGeometricEffectBuffer:{size:1},CIMGeometricEffectCut:{begincut:1,endcut:1,middlecut:0,invert:!1},CIMGeometricEffectDashes:{customendingoffset:0,linedashending:"NoConstraint",offsetalongline:0},CIMGeometricEffectDonut:{method:"Mitered",option:"Accurate",width:2},CIMGeometricEffectJog:{angle:225,length:20,position:50},CIMGeometricEffectControlMeasureLine:{rule:"FullGeometry"},CIMGeometricEffectMove:{offsetx:1,offsety:-1},CIMGeometricEffectOffset:{method:"Square",offset:1,option:"Fast"},CIMGeometricEffectRotate:{angle:15},CIMGeometricEffectScale:{xscalefactor:1.15,yscalefactor:1.15},CIMGeometricEffectWave:{amplitude:2,period:3,seed:1,waveform:"Sinus"},CIMMarkerPlacementAlongLine:{customendingoffset:0,endings:"WithHalfGap",offsetalongline:0,placeperpart:!0,angletoline:!0,offset:0},CIMMarkerPlacementAtExtremities:{extremityplacement:"Both",offsetalongline:0,angletoline:!0,offset:0},CIMMarkerPlacementAtRatioPositions:{beginposition:0,endposition:0,flipfirst:!0,angletoline:!0,offset:0},CIMMarkerPlacementInsidePolygon:{gridangle:0,gridtype:"Fixed",offsetx:0,offsety:0,randomness:100,seed:0,shiftoddrows:!1,stepx:16,stepy:16,clipping:"ClipAtBoundary"},CIMMarkerPlacementOnLine:{relativeto:"LineMiddle",startpointoffset:0,angletoline:!0,offset:0},CIMMarkerPlacementOnVertices:{placeperpart:!0,placeoncontrolpoints:!0,placeonendpoints:!0,placeonregularvertices:!0,angletoline:!0,offset:0},CIMMarkerPlacementPolygonCenter:{method:"OnPolygon",offsetx:0,offsety:0,clipatboundary:!1},CIMAnimatedSymbolProperties:{playanimation:!1,reverseanimation:!1,randomizestarttime:!1,randomizestartseed:0,starttimeoffset:0,duration:3,endingduration:3,useendingduration:!1,repeattype:"Loop",repeatdelay:0}}},7590:function(e,t,n){"use strict";n.d(t,{$w:function(){return _},Bu:function(){return R},DW:function(){return w},FM:function(){return c},G9:function(){return s},GV:function(){return v},Go:function(){return u},K3:function(){return V},Kn:function(){return x},MM:function(){return p},MO:function(){return k},Nl:function(){return C},Ny:function(){return y},O2:function(){return I},UE:function(){return P},YC:function(){return U},YF:function(){return L},ZO:function(){return F},_1:function(){return M},_H:function(){return T},_d:function(){return S},bs:function(){return H},e6:function(){return h},gQ:function(){return l},iA:function(){return z},jn:function(){return m},lW:function(){return d},mA:function(){return f},n5:function(){return D},pM:function(){return A},pV:function(){return E},pk:function(){return j},rB:function(){return G},s4:function(){return r},xo:function(){return O},yH:function(){return b},zb:function(){return N},zr:function(){return g}});var i=n(38821);function r(e,t,n,i){return function(e){return"function"==typeof e}(e)?e(t,n,i):e}function s(e){return[e.r,e.g,e.b,e.a]}const o=" /-,\n";function a(e){let t=e.length;for(;t--;)if(!o.includes(e.charAt(t)))return!1;return!0}function l(e,t){const n=[];let i=0,r=-1;do{if(r=e.indexOf("[",i),r>=i){if(r>i){const t=e.substr(i,r-i);n.push([t,null,a(t)])}if(i=r+1,r=e.indexOf("]",i),r>=i){if(r>i){const s=t[e.substr(i,r-i)];s&&n.push([null,s,!1])}i=r+1}}}while(-1!==r);if(i<e.length-1){const t=e.substr(i);n.push([t,null,a(t)])}return n}function c(e,t,n,i){let r="",s=null;for(const i of t){const[t,o,a]=i;if(t)a?s=t:(s&&(r+=s,s=null),r+=t);else{let t=o;null!=n&&(t=k(o,n));const i=e.attributes[t];i&&(s&&(r+=s,s=null),r+=i)}}return function(e,t){switch("string"!=typeof e&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}(r,i)}function u(e,t,n,i,r,s,o=!0){const a=t/r,l=n/s,c=Math.ceil(a/2),u=Math.ceil(l/2);for(let n=0;n<s;n++)for(let h=0;h<r;h++){const d=4*(h+(o?s-n-1:n)*r);let p=0,f=0,m=0,g=0,_=0,v=0,y=0;const b=(n+.5)*l;for(let i=Math.floor(n*l);i<(n+1)*l;i++){const n=Math.abs(b-(i+.5))/u,r=(h+.5)*a,s=n*n;for(let n=Math.floor(h*a);n<(h+1)*a;n++){let o=Math.abs(r-(n+.5))/c;const a=Math.sqrt(s+o*o);a>=-1&&a<=1&&(p=2*a*a*a-3*a*a+1,p>0&&(o=4*(n+i*t),y+=p*e[o+3],m+=p,e[o+3]<255&&(p=p*e[o+3]/250),g+=p*e[o],_+=p*e[o+1],v+=p*e[o+2],f+=p))}}i[d]=g/f,i[d+1]=_/f,i[d+2]=v/f,i[d+3]=y/m}}function h(e){return e?[e[0],e[1],e[2],e[3]/255]:[0,0,0,0]}function d(e){return e.data?.symbol??null}function p(e){return"CIMVectorMarker"===e.type||"CIMPictureMarker"===e.type||"CIMBarChartMarker"===e.type||"CIMCharacterMarker"===e.type||"CIMPieChartMarker"===e.type||"CIMStackedBarChartMarker"===e.type}function f(e){return"CIMGradientStroke"===e.type||"CIMPictureStroke"===e.type||"CIMSolidStroke"===e.type}function m(e){return null!=e&&("CIMGradientFill"===e.type||"CIMHatchFill"===e.type||"CIMPictureFill"===e.type||"CIMSolidFill"===e.type||"CIMWaterFill"===e.type)}function g(e){return null!=e&&("CIMMarkerPlacementAlongLineRandomSize"===e.type||"CIMMarkerPlacementAlongLineSameSize"===e.type||"CIMMarkerPlacementAlongLineVariableSize"===e.type||"CIMMarkerPlacementAtExtremities"===e.type||"CIMMarkerPlacementAtMeasuredUnits"===e.type||"CIMMarkerPlacementAtRatioPositions"===e.type||"CIMMarkerPlacementOnLine"===e.type||"CIMMarkerPlacementOnVertices"===e.type)}const _=(e,t=0)=>null==e||isNaN(e)?t:e,v=(e,t)=>e??t,y=e=>e.tintColor?h(e.tintColor):[255,255,255,1],b=e=>{if(!e)return!1;for(const t of e)switch(t.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function T(){return n.e(4696).then(n.bind(n,28356))}function E(e){if(!e)return"normal";switch(e.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function x(e){if(!e)return"normal";switch(e.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function S(e){let t="normal",n="normal";if(e){const i=e.toLowerCase();i.includes("italic")?t="italic":i.includes("oblique")&&(t="oblique"),i.includes("bold")?n="bold":i.includes("light")&&(n="lighter")}return{style:t,weight:n}}function w(e){return e.underline?"underline":e.strikethrough?"line-through":"none"}function A(e){if(!e)return null;switch(e.type){case"CIMPolygonSymbol":if(e.symbolLayers)for(const t of e.symbolLayers){const e=A(t);if(null!=e)return e}break;case"CIMTextSymbol":return A(e.symbol);case"CIMSolidFill":return e.color}return null}function M(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const t=e.symbolLayers;if(t)for(const e of t){const t=M(e);if(null!=t)return t}break}case"CIMTextSymbol":return M(e.symbol);case"CIMSolidStroke":return e.color}}function O(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(e.symbolLayers)for(const t of e.symbolLayers){const e=O(t);if(void 0!==e)return e}break;case"CIMTextSymbol":return O(e.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return e.width}}function R(e){switch(e){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function C(e){switch(e){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function I(e){return(e?Object.keys(e):[]).map((t=>({name:t,alias:t,type:"string"==typeof e[t]?"esriFieldTypeString":"esriFieldTypeDouble"})))}const P=e=>e.includes("data:image/svg+xml");function D(e){if(!e)return null;switch(e.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function L(e){return e?e.charAt(0).toLowerCase()+e.substring(1):e}function N(e,t,n,i,r,s){const{infos:o}=s;let a=1,l=0,c=0,u=0;for(const{offsetX:e,offsetY:t,rotation:n,size:i,frameHeight:r,rotateClockWise:s}of o)c=$(e,t,l,a,c),u=B(e,t,l,a,u),r&&(a*=i/r),l=Z(n,s,l);const h=$(i,r,l,a,c),d=B(i,r,l,a,u);return{size:e*a,rotation:Z(t,n,l),offsetX:h,offsetY:d}}function F(e){if(null==e)return!1;if(Array.isArray(e))return e.every((e=>F(e)));switch(typeof e){case"string":return!!e;case"number":return!isNaN(e)}}function z(e,t){if("color"===t||"outlinecolor"===t||"backgroundcolor"===t||"borderlinecolor"===t||"tintcolor"===t)return[...i.K[t]];const n=i.D[e];if(!n)throw new Error(`InternalError: default value for type ${e}.`);return n[t]}function V(e){return e?.dashTemplate&&"string"==typeof e.dashTemplate&&(e.dashTemplate=e.dashTemplate.split(" ").map(Number)),e}function H(e){if(null==e)return"Normal";switch(e.type){case"CIMTextSymbol":return e.textCase??"Normal";case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const t=e.symbolLayers;if(!t)return"Normal";for(const e of t)if("CIMVectorMarker"===e.type)return H(e)}break;case"CIMVectorMarker":{const t=e.markerGraphics;if(!t)return"Normal";for(const e of t)if(e.symbol)return H(e.symbol)}}return"Normal"}function U(e){if(e)switch(e.type){case"CIMTextSymbol":return e.height;case"CIMPointSymbol":{let t=0;if(e.symbolLayers)for(const n of e.symbolLayers)if(n)switch(n.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const e=n.size??i.D.CIMVectorMarker.size;e>t&&(t=e);break}}return t}case"CIMLineSymbol":case"CIMPolygonSymbol":{let t=0;if(e.symbolLayers)for(const n of e.symbolLayers)if(n)switch(n.type){case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const e=n.width;null!=e&&e>t&&(t=e);break}case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":if(n.markerPlacement&&g(n.markerPlacement)){const e=n.size??i.D.CIMVectorMarker.size;e>t&&(t=e)}break;case"CIMPictureFill":{const e=n.height;null!=e&&e>t&&(t=e)}}return t}}}function k(e,t){if(null!==t){const n=t.get(e);return n?n.name:e}return e}function j(e){return e.map((e=>({...e,propertyName:L(e.propertyName)})))}function G(e){const t={};for(const n in e){const i=e[n];t[L(n)]=i}return t}function B(e,t,n,i,r){const s=n*Math.PI/180;if(s){const n=Math.cos(s);return(Math.sin(s)*e+n*t)*i+r}return t*i+r}function $(e,t,n,i,r){const s=n*Math.PI/180;return s?(Math.cos(s)*e-Math.sin(s)*t)*i+r:e*i+r}function Z(e,t,n){return t?n-e:n+e}},77927:function(e,t,n){"use strict";n.d(t,{Fe:function(){return h},Km:function(){return s},Nk:function(){return l}});var i=n(52874),r=n(7590);function s(e,t,n,i){if(e)if("CIMTextSymbol"!==e.type){if(n&&e.effects)for(const n of e.effects)a(n,t);if(e.symbolLayers)for(const n of e.symbolLayers)switch(n.type){case"CIMPictureMarker":case"CIMVectorMarker":o(n,t,i);break;case"CIMPictureStroke":case"CIMSolidStroke":!i?.preserveOutlineWidth&&n.width&&(n.width*=t);break;case"CIMPictureFill":n.height&&(n.height*=t),n.offsetX&&(n.offsetX*=t),n.offsetY&&(n.offsetY*=t);break;case"CIMHatchFill":s(n.lineSymbol,t,!0,{...i,preserveOutlineWidth:!1}),n.offsetX&&(n.offsetX*=t),n.offsetY&&(n.offsetY*=t),n.separation&&(n.separation*=t)}}else null!=e.height&&(e.height*=t)}function o(e,t,n){if(e&&(e.markerPlacement&&function(e,t){switch((0,r.zr)(e)&&e.offset&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.placementTemplate&&e.placementTemplate.length){const n=e.placementTemplate.map((e=>e*t));e.placementTemplate=n}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset&&(e.maxRandomOffset*=t),e.placementTemplate&&e.placementTemplate.length){const n=e.placementTemplate.map((e=>e*t));e.placementTemplate=n}break;case"CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=t);break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=t);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=t),e.endPosition&&(e.endPosition*=t);break;case"CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.stepX&&(e.stepX*=t),e.stepY&&(e.stepY*=t)}}(e.markerPlacement,t),e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.anchorPoint&&"Absolute"===e.anchorPointUnits&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size=null!=e.size?e.size*t:0,"CIMVectorMarker"===e.type&&e.markerGraphics))for(const i of e.markerGraphics)e.scaleSymbolsProportionally||s(i.symbol,t,!0,n)}function a(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width&&(e.width*=t);break;case"CIMGeometricEffectBuffer":e.size&&(e.size*=t);break;case"CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=t),e.endCut&&(e.endCut*=t),e.middleCut&&(e.middleCut*=t);break;case"CIMGeometricEffectDashes":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.dashTemplate&&e.dashTemplate.length){const n=e.dashTemplate.map((e=>e*t));e.dashTemplate=n}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length&&(e.length*=t);break;case"CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=t);break;case"CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=t);break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=t),e.length&&(e.length*=t),e.toWidth&&(e.toWidth*=t);break;case"CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=t),e.period&&(e.period*=t)}}function l(e){const t=[];return c((0,r.lW)(e),t),t.length?new i.A((0,r.e6)(t[0])):null}function c(e,t){if(!e)return;let n;n="CIMTextSymbol"===e.type?e.symbol:e;const i="CIMPolygonSymbol"===e.type;if(n?.symbolLayers)for(const e of n.symbolLayers)if(!(e.colorLocked||i&&((0,r.mA)(e)||(0,r.MM)(e)&&e.markerPlacement&&(0,r.zr)(e.markerPlacement))))switch(e.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":e.tintColor&&u(t,e.tintColor);break;case"CIMVectorMarker":e.markerGraphics?.forEach((e=>{c(e.symbol,t)}));break;case"CIMSolidStroke":case"CIMSolidFill":u(t,e.color);break;case"CIMHatchFill":c(e.lineSymbol,t)}}function u(e,t){for(const n of e)if(n.join(".")===t.join("."))return;e.push(t)}function h(e,t,n){t instanceof i.A||(t=new i.A(t));const s=(0,r.lW)(e);s&&d(s,t,n)}function d(e,t,n){if(!e)return;let i;i="CIMTextSymbol"===e.type?e.symbol:e;const s="CIMPolygonSymbol"===i?.type;if(i?.symbolLayers)for(const e of i.symbolLayers){if(e.colorLocked)continue;if(s)if(n){const{layersToColor:t}=n;if(((0,r.mA)(e)||(0,r.MM)(e)&&e.markerPlacement&&(0,r.zr)(e.markerPlacement))&&"fill"===t||(0,r.jn)(e)&&"outline"===t)continue}else if((0,r.mA)(e)||(0,r.MM)(e)&&e.markerPlacement&&(0,r.zr)(e.markerPlacement))continue;const i=t.toArray();switch(e.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":e.tintColor=i;break;case"CIMVectorMarker":e.markerGraphics?.forEach((e=>{d(e.symbol,t,n)}));break;case"CIMSolidStroke":case"CIMSolidFill":e.color=i;break;case"CIMHatchFill":d(e.lineSymbol,t,n)}}}},74661:function(e,t,n){"use strict";n.d(t,{A7:function(){return c},Cx:function(){return u},Hk:function(){return h},JJ:function(){return m},SF:function(){return d},UK:function(){return l},jM:function(){return p},x3:function(){return f}}),n(58941);var i=n(8740),r=n(22198),s=n(90363),o=n(90972),a=n(6259);const l=s.A.fromJSON(a.Cb),c=r.A.fromJSON(a.yM),u=i.A.fromJSON(a.WR),h=o.A.fromJSON(a.JZ);function d(e){if(null==e)return null;switch(e.type){case"mesh":return null;case"point":case"multipoint":return l;case"polyline":return c;case"polygon":case"extent":return u}return null}const p=s.A.fromJSON(a.nC),f=r.A.fromJSON(a.HW),m=i.A.fromJSON(a.b6)},6259:function(e,t,n){"use strict";n.d(t,{Cb:function(){return s},HW:function(){return u},JR:function(){return r},JZ:function(){return l},WR:function(){return a},b6:function(){return h},fT:function(){return i},nC:function(){return c},yM:function(){return o}});const i=[252,146,31,255],r=[153,153,153,255],s={type:"esriSMS",style:"esriSMSCircle",size:6,color:i,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},o={type:"esriSLS",style:"esriSLSSolid",width:.75,color:i},a={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},l={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},c={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},u={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},h={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},31827:function(e,t,n){"use strict";n.d(t,{$4:function(){return y},O0:function(){return b},O1:function(){return T},Sw:function(){return E},eH:function(){return _},rc:function(){return v}});var i=n(53216),r=n(52874),s=n(93040),o=n(99680),a=n(13520),l=n(77927);const c="picture-fill",u="simple-fill",h="simple-line",d="simple-marker",p="text",f="cim",m=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),g=new o.q(1e3);function _(e){const t=e.style;let n=null;if(e)switch(e.type){case d:"cross"!==t&&"x"!==t&&(n=e.color);break;case u:t&&"solid"!==t?"none"!==t&&(n={type:"pattern",x:0,y:0,src:(0,i.s)(`esri/symbols/patterns/${t}.png`),width:5,height:5}):n=e.color;break;case c:n={type:"pattern",src:e.url,width:(0,a.Lz)(e.width)*e.xscale,height:(0,a.Lz)(e.height)*e.yscale,x:(0,a.Lz)(e.xoffset),y:(0,a.Lz)(e.yoffset)};break;case p:n=e.color;break;case f:n=(0,l.Nk)(e)}return n}function v(e,t){const n=e+"-"+t;return void 0!==g.get(n)?Promise.resolve(g.get(n)):(0,s.A)(e,{responseType:"image"}).then((e=>{const i=e.data,r=i.naturalWidth,s=i.naturalHeight,o=document.createElement("canvas");o.width=r,o.height=s;const a=o.getContext("2d");a.fillStyle=t,a.fillRect(0,0,r,s),a.globalCompositeOperation="destination-in",a.drawImage(i,0,0);const l=o.toDataURL();return g.put(n,l),l}))}function y(e){if(!e)return null;let t=null;switch(e.type){case u:case c:case d:t=y(e.outline);break;case h:{const n=(0,a.Lz)(e.width);null!=e.style&&"none"!==e.style&&0!==n&&(t={color:e.color,style:T(e.style),width:n,cap:e.cap,join:"miter"===e.join?(0,a.Lz)(e.miterLimit):e.join},t.dashArray=b(t).join(",")||"none");break}default:t=null}return t}function b(e){if(!e?.style)return[];const{dashArray:t,style:n,width:i}=e;if("string"==typeof t&&"none"!==t)return t.split(",").map((e=>Number(e)));const r=i??0,s=m.has(n)?m.get(n).map((e=>e*r)):[];if("butt"!==e.cap)for(const[e,t]of s.entries())s[e]=e%2==1?t+r:Math.max(t-r,1);return s}const T=(()=>{const e={};return t=>{if(e[t])return e[t];const n=t.replaceAll("-","");return e[t]=n,n}})(),E=new r.A([128,128,128])},89814:function(e,t,n){"use strict";n.d(t,{$d:function(){return f},GG:function(){return x},N7:function(){return m},Sx:function(){return g},UQ:function(){return E},di:function(){return S},dt:function(){return v},f3:function(){return w},k_:function(){return p},yG:function(){return A}});var i=n(52874),r=n(10748),s=n(77472),o=(n(58941),n(13520)),a=n(32501),l=n(60318),c=n(77927),u=n(31827),h=n(13109);const d=new i.A("white");function p(e){if(!e)return 0;if((0,r.wk)(e)){const t=function(e){const t=e.symbolLayers?.at(-1);if(t&&"outline"in t)return t?.outline?.size}(e);return null!=t?t:0}return(0,o.PN)((0,u.$4)(e)?.width)}function f(e){if(null==e||!("symbolLayers"in e)||null==e.symbolLayers)return!1;switch(e.type){case"point-3d":return e.symbolLayers.some((e=>"object"===e.type));case"line-3d":return e.symbolLayers.some((e=>"path"===e.type));case"polygon-3d":return e.symbolLayers.some((e=>"object"===e.type||"extrude"===e.type));default:return!1}}function m(e){return e.resource?.href??""}function g(e,t){if(!e)return null;let n=null;return(0,r.wk)(e)?n=function(e){const t=e.symbolLayers;if(!t)return null;let n=null;return t.forEach((e=>{"object"===e.type&&e.resource?.href||(n="water"===e.type?e.color:e.material?e.material.color:null)})),n?new i.A(n):null}(e):(0,r.$y)(e)&&(n="cim"===e.type?(0,c.Nk)(e):e.color?new i.A(e.color):null),n?_(n,t):null}function _(e,t){if(null==t||null==e)return e;const n=e.toRgba();return n[3]=n[3]*t,new i.A(n)}function v(e,t,n){var s,o,a;e&&(t||null!=n)&&(t&&(t=new i.A(t)),(0,r.wk)(e)?function(e,t,n){const i=e.symbolLayers;if(!i)return;const r=e=>_(t=t??e??(null!=n?d:null),n);i.forEach((e=>{if("object"!==e.type||!e.resource?.href||t)if("water"===e.type)e.color=r(e.color);else{const t=null!=e.material?e.material.color:null,i=r(t);null==e.material?e.material=new h.N({color:i}):e.material.color=i,null!=n&&"outline"in e&&null!=e.outline?.color&&(e.outline.color=_(e.outline.color,n))}}))}(e,t,n):(0,r.$y)(e)&&(s=e,a=n,(o=(o=t)??s.color)&&(s.color=_(o,a)),null!=a&&"outline"in s&&s.outline?.color&&(s.outline.color=_(s.outline.color,a))))}function y(e){for(const t of e)if("number"==typeof t)return t;return null}function b(e,t,n){for(let i=0;i<3;i++){const r=e[i];switch(r){case"symbol-value":{const e=n[i];return null!=e?e/t[i]:1}case"proportional":break;default:if(r&&t[i])return r/t[i]}}return 1}function T(e,t,n,i){switch(e){case"proportional":return n*i;case"symbol-value":return null!=t?t:n;default:return e}}async function E(e,t){if(e&&t)return(0,r.wk)(e)?async function(e,t){const i=e.symbolLayers;i&&await(0,s.jJ)(i,(async e=>async function(e,t){switch(e.type){case"extrude":!function(e,t){e.size="number"==typeof t[2]?t[2]:0}(e,t);break;case"icon":case"line":case"text":!function(e,t){const n=y(t);null!=n&&(e.size=n)}(e,t);break;case"path":!function(e,t){const n=b(t,a.Un,[e.width,void 0,e.height]);e.width=T(t[0],e.width,1,n),e.height=T(t[2],e.height,1,n)}(e,t);break;case"object":await async function(e,t){const{resourceSize:i,symbolSize:r}=await async function(e){const{computeObjectLayerResourceSize:t}=await n.e(7269).then(n.bind(n,9141)),i=await t(e,10),{width:r,height:s,depth:o}=e,a=[r,o,s];let l=1;for(let e=0;e<3;e++){const t=a[e];if(null!=t){l=t/i[e];break}}for(let e=0;e<3;e++)null==a[e]&&(a[e]=i[e]*l);return{resourceSize:i,symbolSize:a}}(e),s=b(t,i,r);e.width=T(t[0],r[0],i[0],s),e.depth=T(t[1],r[1],i[1],s),e.height=T(t[2],r[2],i[2],s)}(e,t)}}(e,t)))}(e,t):void((0,r.$y)(e)&&function(e,t){const n=y(t);if(null!=n)switch(e.type){case"simple-marker":e.size=n;break;case"picture-marker":{const t=e.width/e.height;t>1?(e.width=n,e.height=n*t):(e.width=n*t,e.height=n);break}case"simple-line":e.width=n;break;case"text":e.font.size=n}}(e,t))}function x(e,t,n){if(e&&null!=t)if((0,r.wk)(e)){const i=e.symbolLayers;i&&i.forEach((e=>{if(e&&"object"===e.type)switch(n){case"tilt":e.tilt=(e.tilt??0)+t;break;case"roll":e.roll=(e.roll??0)+t;break;default:e.heading=(e.heading??0)+t}}))}else(0,r.$y)(e)&&("simple-marker"!==e.type&&"picture-marker"!==e.type&&"text"!==e.type||(e.angle+=t))}function S(e){if(!e)return null;const t=e.effects.filter((e=>"bloom"!==e.type)).map((e=>e.toJSON()));return(0,l.zu)(t)}function w(e){return null!=e&&"polygon-3d"===e.type&&e.symbolLayers.some((e=>"extrude"===e.type))}async function A(e,t){return await e.fetchSymbol(t)||e.fetchCIMSymbol(t)}},47096:function(e,t,n){"use strict";var i,r;function s(e){return null!=e&&!e.running}n.d(t,{c:function(){return r},c2:function(){return i},pi:function(){return s}}),function(e){e[e.RENDERING=0]="RENDERING",e[e.FADING=1]="FADING",e[e.FINISHED=2]="FINISHED"}(i||(i={})),function(e){e[e.RG=0]="RG",e[e.BA=1]="BA"}(r||(r={}))},75256:function(e,t,n){"use strict";n.d(t,{OQ:function(){return i},ny:function(){return m}});var i,r,s=n(15774),o=n(73364),a=n(39714),l=n(20551),c=n(32501),u=n(26133),h=n(43587),d=n(47096),p=n(58192),f=n(81197);class m{constructor(){this.readChannels=d.c.RG,this.renderingStage=d.c2.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=(0,c.vt)(),this.parallax=new g,this.parallaxNew=new g,this.pointOnGround=(0,c.vt)(),this.fadeMode=i.HIDE,this.fadeFactor=0,this.opacity=0}updateParallax(e){const t=this.parallax,n=(0,l.l)(e.eye);if(t.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(n*n-h.$O.radius*h.$O.radius,0))/n,(0,u.Cr)(_,t.anchorPointClouds,v),(0,o.e$)(t.transform,a.zK,v[3],(0,u.yo)(v)),this.fadeMode===i.CROSS_FADE){const e=this.parallaxNew;(0,u.Cr)(_,e.anchorPointClouds,v),(0,o.e$)(e.transform,a.zK,v[3],(0,u.yo)(v))}}updateFading(e,t,n,i){this.isFading&&this._advanceFading(n,i),this._evaluateFading(e,t,n)}_evaluateFading(e,t,n){const r=e.relativeElevation,s=this._calculateDistanceToAnchorPoint(e);if((r>1.7*p.ni||r<-p.ni||s>x)&&this.opacity>0)this._setFade(i.HIDE,n);else if(!this.isFading)if((r>p.ni||r<-.35*p.ni||s>E)&&this.opacity>0)this._setFade(i.FADE_OUT,n);else if(r<=p.ni&&r>=-.35*p.ni&&t===f.M.IDLE&&(0,d.pi)(this.data)){if(0===this.opacity)return void this._setFade(i.FADE_IN,n);(s>T||this.renderingStage===d.c2.FADING)&&this._setFade(i.CROSS_FADE,n)}}_advanceFading(e,t){this._switchReadChannels(),this._updateAnchorPoint(),this._advanceFadingFactorAndOpacity(e,t)}_advanceFadingFactorAndOpacity(e,t){if(this.fadeFactor<1)return this.fadeFactor=t?(0,s.qE)((e-this.startTime)/(b*t),0,1):1,this.fadeMode===i.FADE_OUT&&(this.opacity=1-this.fadeFactor),this.fadeMode===i.FADE_IN&&(this.opacity=this.fadeFactor),void(this.fadeMode===i.CROSS_FADE&&(this.opacity=1));this.fadeFactor=0,this.fadeMode===i.FADE_OUT&&(this.opacity=0),this.fadeMode===i.FADE_IN&&(this.opacity=1),this.fadeMode===i.CROSS_FADE&&(this.opacity=1),this.fadeMode=i.NONE}_switchReadChannels(){const e=this.fadeMode===i.CROSS_FADE&&1===this.fadeFactor,t=this.fadeMode===i.FADE_IN&&0===this.fadeFactor;this.renderingStage===d.c2.FADING&&(e||t)&&(this.readChannels=1-this.readChannels,this.renderingStage=d.c2.FINISHED)}_calculateDistanceToAnchorPoint(e){return(0,l.n)(this.pointOnGround,e.eye),(0,l.j)(this.pointOnGround,this.pointOnGround,h.$O.radius),(0,l.l)((0,l.f)(y,this.parallax.anchorPointClouds,this.pointOnGround))}_updateAnchorPoint(){this.fadeMode===i.CROSS_FADE&&(0===this.fadeFactor&&(0,l.c)(this.parallaxNew.anchorPointClouds,this.pointOnGround),1===this.fadeFactor&&(0,l.c)(this.parallax.anchorPointClouds,this.parallaxNew.anchorPointClouds)),this.fadeMode===i.FADE_IN&&0===this.fadeFactor&&(0,l.c)(this.parallax.anchorPointClouds,this.pointOnGround)}_setFade(e,t){switch(e){case i.HIDE:this.opacity=0;break;case i.FADE_OUT:this.opacity=1;break;case i.FADE_IN:this.opacity=0;break;case i.CROSS_FADE:this.opacity=1}this.fadeMode=e,this.fadeFactor=0,this.startTime=t}get isFading(){return this.fadeMode===i.FADE_OUT||this.fadeMode===i.FADE_IN||this.fadeMode===i.CROSS_FADE}}(r=i||(i={}))[r.NONE=0]="NONE",r[r.HIDE=1]="HIDE",r[r.FADE_OUT=2]="FADE_OUT",r[r.FADE_IN=3]="FADE_IN",r[r.CROSS_FADE=4]="CROSS_FADE";class g{constructor(){this.anchorPointClouds=(0,c.vt)(),this.radiusCurvatureCorrectionFactor=0,this.transform=(0,a.vt)()}}const _=(0,c.fA)(0,0,1),v=(0,u.vt)(),y=(0,c.vt)(),b=1.25,T=34e3,E=64e3,x=2e5},58192:function(e,t,n){"use strict";n.d(t,{k9:function(){return S},ni:function(){return x}});var i,r=n(53804),s=n(30905),o=n(23502),a=(n(58941),n(40633),n(13798),n(74376)),l=n(65953);let c=i=class extends s.oY{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new i({cloudCover:this.cloudCover})}};(0,r._)([(0,a.e)({cloudy:"cloudy"})],c.prototype,"type",void 0),(0,r._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0),c=i=(0,r._)([(0,l.$)("esri.views.3d.environment.CloudyWeather")],c);const u=c;var h;let d=h=class extends s.oY{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new h({fogStrength:this.fogStrength})}};(0,r._)([(0,a.e)({foggy:"foggy"})],d.prototype,"type",void 0),(0,r._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d.prototype,"fogStrength",void 0),d=h=(0,r._)([(0,l.$)("esri.views.3d.environment.FoggyWeather")],d);const p=d;var f;let m=f=class extends s.oY{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new f({cloudCover:this.cloudCover,precipitation:this.precipitation})}};(0,r._)([(0,a.e)({rainy:"rainy"})],m.prototype,"type",void 0),(0,r._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],m.prototype,"cloudCover",void 0),(0,r._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],m.prototype,"precipitation",void 0),m=f=(0,r._)([(0,l.$)("esri.views.3d.environment.RainyWeather")],m);const g=m;var _;let v=_=class extends s.oY{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new _({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};(0,r._)([(0,a.e)({snowy:"snowy"})],v.prototype,"type",void 0),(0,r._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],v.prototype,"cloudCover",void 0),(0,r._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],v.prototype,"precipitation",void 0),(0,r._)([(0,o.MZ)({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],v.prototype,"snowCover",void 0),v=_=(0,r._)([(0,l.$)("esri.views.3d.environment.SnowyWeather")],v);const y=v;var b;let T=b=class extends s.oY{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new b({cloudCover:this.cloudCover})}};(0,r._)([(0,a.e)({sunny:"sunny"})],T.prototype,"type",void 0),(0,r._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],T.prototype,"cloudCover",void 0),T=b=(0,r._)([(0,l.$)("esri.views.3d.environment.SunnyWeather")],T);const E={key:"type",base:T,typeMap:{sunny:T,cloudy:u,rainy:g,snowy:y,foggy:p}};Object.keys(E.typeMap);const x=1e4,S=1e5},52409:function(e,t,n){"use strict";n.r(t),n.d(t,{DrawGraphicTool3D:function(){return ei},ExtentTransformTool:function(){return Da},ManipulatedObject3DGraphic:function(){return Va},MoveTool3D:function(){return _s},ReshapeTool3D:function(){return $s},TransformTool3D:function(){return go}});var i=n(53804),r=n(75505),s=n(61226),o=n(95929),a=n(28181),l=n(23502),c=n(58941),u=(n(40633),n(13798),n(65953)),h=n(20551),d=n(32501),p=n(68945),f=n(6422),m=n(13520),g=(n(39819),n(52874)),_=n(83525),v=n(77472),y=n(15774),b=n(60539),T=n(88226),E=n(62938),x=n(13786),S=n(1932),w=n(38441),A=n(50973),M=n(38225),O=n(76722);n(77528);let R=(e,t,n)=>{for(let i=0,r=t.length;i<r;i++){let r=t[i];Array.isArray(r)?R(e,r,n):null!=r&&!1!==r&&("string"==typeof r&&(r={vnodeSelector:"",properties:void 0,children:void 0,text:r.toString(),domNode:null}),n.push(r))}};n(81401);const C={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};let I=class extends _.A{get position(){return[this.x,this.y]}set position(e){this._set("x",e[0]),this._set("y",e[1])}get _textShadowColor(){const{textColor:e,backgroundColor:t}=this,n=t.clone();return n.a*=e.a,n}get _textShadow(){const e=this._textShadowColor.toCss(!0);return`0 0 ${this._textShadowSize}px ${e}`}get padding(){return.5*this.fontSize}get _borderRadius(){return this.padding}constructor(e){super(e),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this.isDecoration=!0,this.backgroundColor=new g.A([0,0,0,.6]),this.textColor=new g.A([255,255,255]),this._textShadowSize=1}render(){return function(e,t,n){if(Array.isArray(t))n=t,t=void 0;else if(t&&("string"==typeof t||t.hasOwnProperty("vnodeSelector"))||n&&("string"==typeof n||n.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let i,r;return n&&1===n.length&&"string"==typeof n[0]?i=n[0]:n&&(r=[],R("div",n,r),0===r.length&&(r=void 0)),{vnodeSelector:"div",properties:t,children:r,text:""===i?void 0:i,domNode:null}}(0,{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",lineHeight:this.fontSize+"px",backgroundColor:this.backgroundColor.toCss(!0),color:this.textColor.toCss(!0),padding:this.padding+"px",borderRadius:this._borderRadius+"px",textShadow:this._textShadow}},[this.text])}renderCanvas(e){if(!this.visible)return;const t=e.font.replace(/^(.*?)px/,"");e.font=`${this.fontSize}px ${t}`;const n=this.padding,i=this._borderRadius,r=e.measureText(this.text).width,s=this.fontSize,o=P[this.anchor];e.textAlign="center",e.textBaseline="middle";const a=r+2*n,l=s+2*n,c=this.x+o.x*a,u=this.y+o.y*l;this._roundedRect(e,c,u,a,l,i),e.fillStyle=this.backgroundColor.toCss(!0),e.fill();const h=this.x+(o.x+.5)*a,d=this.y+(o.y+.5)*l;this._renderTextShadow(e,this.text,h,d),e.fillStyle=this.textColor.toCss(!0),e.fillText(this.text,h,d)}_renderTextShadow(e,t,n,i){e.lineJoin="miter",e.fillStyle=`rgba(${this._textShadowColor.r}, ${this._textShadowColor.g}, ${this._textShadowColor.b}, ${1/D.length})`;const r=this._textShadowSize;for(const[s,o]of D)e.fillText(t,n+r*s,i+r*o)}_roundedRect(e,t,n,i,r,s){e.beginPath(),e.moveTo(t,n+s),e.arcTo(t,n,t+s,n,s),e.lineTo(t+i-s,n),e.arcTo(t+i,n,t+i,n+s,s),e.lineTo(t+i,n+r-s),e.arcTo(t+i,n+r,t+i-s,n+r,s),e.lineTo(t+s,n+r),e.arcTo(t,n+r,t,n+r-s,s),e.closePath()}_cssClasses(){const e={"esri-text-overlay-item":!0};let t;for(t in C)e[C[t]]=this.anchor===t;return e}};(0,i._)([(0,l.MZ)()],I.prototype,"x",void 0),(0,i._)([(0,l.MZ)()],I.prototype,"y",void 0),(0,i._)([(0,l.MZ)()],I.prototype,"position",null),(0,i._)([(0,l.MZ)()],I.prototype,"text",void 0),(0,i._)([(0,l.MZ)()],I.prototype,"fontSize",void 0),(0,i._)([(0,l.MZ)()],I.prototype,"anchor",void 0),(0,i._)([(0,l.MZ)()],I.prototype,"visible",void 0),(0,i._)([(0,l.MZ)()],I.prototype,"isDecoration",void 0),(0,i._)([(0,l.MZ)()],I.prototype,"backgroundColor",void 0),(0,i._)([(0,l.MZ)()],I.prototype,"textColor",void 0),(0,i._)([(0,l.MZ)()],I.prototype,"_textShadowSize",void 0),(0,i._)([(0,l.MZ)()],I.prototype,"_textShadowColor",null),(0,i._)([(0,l.MZ)()],I.prototype,"_textShadow",null),(0,i._)([(0,l.MZ)()],I.prototype,"padding",null),(0,i._)([(0,l.MZ)()],I.prototype,"_borderRadius",null),I=(0,i._)([(0,u.$)("esri.views.overlay.TextOverlayItem")],I);const P={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},D=[];{const e=16;for(let t=0;t<360;t+=360/e)D.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}const L=I;var N=n(9862);const F={default:15,far:25};let z=class extends _.A{constructor(e){super(e),this.context=null,this.stagedVertex=null,this.visible=!0,this.edgeDistance="default",this._messagesUnits=null,this._labelInfos=[],this._nextLabelIndex=0}initialize(){const e=(0,v.UT)((async e=>{const t=await(0,M.ud)("esri/core/t9n/Units");(0,b.Te)(e),this._messagesUnits=t}));this.addHandles([(0,a.watch)((()=>[null!=this.context&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits]),(()=>this._update())),...["vertex-add","vertex-update","vertex-remove"].map((e=>(0,a.on)((()=>this.context?.editGeometryOperations),e,(()=>this._update())))),(0,s.hA)((()=>e.abort())),(0,a.watch)((()=>this._colors),(e=>this._updateStyle(e)))])}destroy(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}get updating(){return null==this._messagesUnits}get test(){}get _edgeDistancePixels(){return F[this.edgeDistance]}get _colors(){const e=this.context?.view.effectiveTheme.textColor??g.A.fromArray([255,255,255]);return{textColor:e,backgroundColor:(0,r._L)((0,r.bJ)(e,r.pW.Low),.6)}}_update(){if(this.destroyed)return;this._nextLabelIndex=0;const{context:e,stagedVertex:t}=this;if(!e)return this._destroyUnusedLabels();const{editGeometryOperations:n}=e,{components:i,geometry:r,coordinateHelper:s}=n.data;if(!r)return this._destroyUnusedLabels();const o=i.length;for(let i=0;i<o;++i){const a=V(r,n,t,s,i);if(a.length<2||!H(a,e.view,e.elevationInfo,s.spatialReference))continue;const l=1===o&&!(0,w.$3)(a);let c=G,u=B;this.toScreenPointArray(e,a[0],c);for(let t=1;t<a.length;++t){const n=a[t-1],i=a[t];this.toScreenPointArray(e,i,u),this._addLabel(e,n,c,i,u,l),[c,u]=[u,c]}}this._destroyUnusedLabels()}_updateStyle({textColor:e,backgroundColor:t}){const n=this._nextLabelIndex,i=this._labelInfos;for(let r=0;r<n;++r){const{label:n}=i[r];n.textColor=e,n.backgroundColor=t}}_addLabel(e,t,n,i,r,s){const{label:o}=this._getOrCreateLabel(e);if(!this.visible||(0,x.hG)(n,r)<3025)return void(o.visible=!1);const{spatialReference:a}=e.editGeometryOperations.data,l=(0,N.Do)(t,i,a),c=this._messagesUnits,u=(0,O.c)(e.view);o.text=null!=c&&null!=l?(0,T.ix)(c,l,u):"",o.visible=!0;const h=r[0]-n[0],d=r[1]-n[1];s?(0,x.hZ)(k,-d,h):(0,x.hZ)(k,d,-h),(0,x.S8)(k,k),(0,x.hs)(k,k,this._edgeDistancePixels),(0,x.Cc)(j,n,r,.5),(0,x.WQ)(j,j,k),o.position=[j[0],j[1]],Math.abs(k[0])>Math.abs(k[1])?o.anchor=k[0]>0?"left":"right":o.anchor=-k[1]<0?"top":"bottom"}_getOrCreateLabel(e){const t=this._labelInfos.length>this._nextLabelIndex,{textColor:n,backgroundColor:i}=this._colors;if(t){const e=this._labelInfos[this._nextLabelIndex++],{label:t}=e;return t.textColor=n,t.backgroundColor=i,e}const r=new L({anchor:"center",fontSize:8,textColor:n,backgroundColor:i});e.view.overlay?.items.add(r);const s={label:r};return this._labelInfos.push(s),this._nextLabelIndex=this._labelInfos.length,s}_destroyUnusedLabels(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}_destroyLabel({label:e}){this.context?.view.overlay?.items.remove(e),e.destroy()}};function V(e,t,n,i,r){const s=[];if(t.data.components[r].iterateVertices((e=>{s.push(i.toXYZ(e.pos,A.rq.get()))})),0===r&&null!=n&&s.push(i.toXYZ(n,A.rq.get())),s.length<2)return s;const o=s[0],a=s[s.length-1];return"polygon"===e.type&&s.length>2&&!(0,h.G)(o,a)&&s.push(o),s}function H(e,t,n,i){if("2d"===t.type)return!0;const r=(0,E.Ao)(i)??1,s=(0,E.G9)(i),o=e=>(0,p.xS)(t,e,i,n,p.qt)??0;for(let t=1;t<e.length;++t){const n=e[t-1],i=e[t],a=(i[0]-n[0])*r,l=(i[1]-n[1])*r,c=(o(i)-o(n))*s;if(Math.abs(c)/Math.sqrt(a*a+l*l)>U)return!1}return!0}(0,i._)([(0,l.MZ)()],z.prototype,"context",void 0),(0,i._)([(0,l.MZ)()],z.prototype,"stagedVertex",void 0),(0,i._)([(0,l.MZ)()],z.prototype,"visible",void 0),(0,i._)([(0,l.MZ)()],z.prototype,"edgeDistance",void 0),(0,i._)([(0,l.MZ)()],z.prototype,"updating",null),(0,i._)([(0,l.MZ)()],z.prototype,"_messagesUnits",void 0),(0,i._)([(0,l.MZ)()],z.prototype,"_edgeDistancePixels",null),(0,i._)([(0,l.MZ)()],z.prototype,"_colors",null),z=(0,i._)([(0,u.$)("esri.views.interactive.SegmentLabels")],z);const U=(0,y.kU)(5),k=(0,S.vt)(),j=(0,S.vt)(),G=(0,m.gs)(),B=(0,m.gs)();var $=n(95749);let Z=class extends z{getCameraOrExtent({view:e}){return e.state.camera}toScreenPointArray({view:e,elevationInfo:t,editGeometryOperations:n},i,r=(0,m.gs)()){const{spatialReference:s}=n.data.coordinateHelper;return(0,$.XG)(i,s,t,e,W),e.state.camera.projectToScreen(W,r),r}};Z=(0,i._)([(0,u.$)("esri.views.3d.interactive.SegmentLabels3D")],Z);const W=(0,d.vt)();var q=n(68734),X=n(33400),Y=n(43745),K=n(91912),Q=n(69508),J=n(73313),ee=n(79578),te=n(88781),ne=n(46949),ie=n(96253),re=n(91998);class se{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=ne.O7.Outline}destroy(){this._destroyResources()}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){this._renderGroup=e;const t=this._resources?.layerView;t&&(t.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?null!=this._resources&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?null==this._resources&&this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory.createResources(),t=new oe({view:this._resourceFactory.view,renderGroup:this._renderGroup}),n=this._resourceFactory.view.basemapTerrain?.overlayManager;this._resources={layerView:new oe({view:this._resourceFactory.view,renderGroup:this._renderGroup}),external:e,geometriesAdded:!1},n&&(this._resources.drapeSourceRenderer=n.registerGeometryDrapeSource(t)),this._syncGeometriesToRenderer()}_destroyResources(){if(null==this._resources)return;this._ensureRenderGeometriesRemoved();const e=this._resourceFactory.view.basemapTerrain?.overlayManager;e&&e.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){null!=this._resources?.drapeSourceRenderer&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,ie.q.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){null!=this._resources?.drapeSourceRenderer&&(this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,ie.q.UPDATE),this._resources.geometriesAdded=!0))}}let oe=class extends((0,te.sA)(_.A)){constructor(e){super(e),this.drapeSourceType=ne.Om.Features,this.updatePolicy=re.q.SYNC,this.renderGroup=ne.O7.Outline}};(0,i._)([(0,l.MZ)({constructOnly:!0})],oe.prototype,"view",void 0),(0,i._)([(0,l.MZ)({readOnly:!0})],oe.prototype,"drapeSourceType",void 0),(0,i._)([(0,l.MZ)()],oe.prototype,"renderGroup",void 0),oe=(0,i._)([(0,u.$)("esri.views.3d.interactive.visualElements.DrapedVisualElementResources")],oe);class ae{get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e}constructor(e){this._isDecoration=!1,this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e.view,this._handle=(0,a.watch)((()=>e.view.ready),(e=>{this._resourcesCreated&&(e?this._createResources():this._destroyResources())}))}applyProperties(e){let t=!1;for(const n in e)n in this&&("attached"===n?t=e[n]:this[n]=e[n]);this.attached=t}destroy(){this.attached=!1,this._handle.remove()}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources(),this.onAttachedChange(e))}onAttachedChange(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.updateVisibility(this.visible)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}var le=n(40359),ce=n(10713),ue=n(1296);class he{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return null!=this._resources?this._resources.object:null}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view._stage;if(null==this._resources||!e)return;const t=this._resources.object;this._resources.external.forEach((t=>{t.type!==le.X.Mesh&&t.type!==le.X.Line&&t.type!==le.X.Point||e.remove(t)})),t.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer),this._resources.external.forEach((t=>{t.type!==le.X.Mesh&&t.type!==le.X.Line&&t.type!==le.X.Point||e.add(t)}))}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory,t=e.view,n=t._stage;if(!n)return;const i=new ue.x(n,{pickable:!1,updatePolicy:re.q.SYNC}),r=new ce.B({castShadow:!1}),s=e.createResources(r,i);s.forEach((e=>{n.add(e),e.type===le.X.Texture&&e.load(n.renderView.renderingContext)})),n.add(r),i.add(r);const o=e.cameraChanged,l=o?(0,a.watch)((()=>t.state.camera),(e=>o(e)),a.Vh):null;this._resources={layer:i,object:r,external:s,cameraHandle:l},this._syncVisible()}_destroyResources(){if(null==this._resources)return;const e=this._resourceFactory.view._stage;e&&(e.remove(this._resources.object),this._resources.layer.destroy(),this._resources.external.forEach((t=>{e.remove(t),t.type===le.X.Texture&&t.unload()}))),this._resources.object.dispose(),this._resources.cameraHandle?.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncVisible(){null!=this._resources&&(this._resources.object.visible=this._visible)}}class de extends ae{constructor(e){super(e),this._isDraped=!1,this.object3dResources=new he(this.createObject3DResourceFactory(e.view)),this.drapedResources=new se(this.createDrapedResourceFactory(e.view)),this.isDraped=e.isDraped??!1}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}}var pe=n(65420),fe=n(67521),me=n(50240),ge=n(69550),_e=n(65856),ve=n(34615),ye=n(22542),be=n(54101),Te=n(65839),Ee=n(58054),xe=n(85456),Se=n(57087);class we extends ye.w{initializeProgram(e){return new be.B(e.rctx,we.shader.get().build(this.configuration),Ae)}initializePipeline(){return(0,Se.Ey)({blending:(0,Se.ox)(xe.dn.ONE,xe.dn.ONE_MINUS_SRC_ALPHA),colorWrite:Se.wE})}}we.shader=new ve.$(Ee.L,(()=>n.e(2436).then(n.bind(n,28374))));const Ae=new Map([[Te.r.START,0],[Te.r.END,1],[Te.r.UP,2],[Te.r.EXTRUDE,3]]);var Me=n(69445),Oe=n(86305);class Re{constructor(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=(0,d.vt)(),this._dirty=!1,this._count=0,this._vao=null}set vertices(e){const t=(0,me.jh)(3*e.length);let n=0;for(const i of e)t[n++]=i[0],t[n++]=i[1],t[n++]=i[2];this.buffers=[t]}set buffers(e){if(this._buffers=e,this._buffers.length>0){const e=this._buffers[0],t=3*Math.floor(e.length/3/2);(0,h.s)(this._origin,e[t],e[t+1],e[t+2])}else(0,h.s)(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(e){const t=this._ensureVAO(e);null!=t&&(e.bindVAO(t),e.drawArrays(xe.WR.TRIANGLES,0,this._count))}dispose(){null!=this._vao&&this._vao.dispose()}_ensureVAO(e){return null==this._buffers?null:(null==this._vao&&(this._vao=this._createVAO(e,this._buffers)),this._ensureVertexData(this._vao,this._buffers),this._vao)}_createVAO(e,t){const n=this._createDataBuffer(t);return this._dirty=!1,new Me.Z(e,Ae,{data:(0,ge.U)(De)},{data:Oe.g.createVertex(e,xe._U.STATIC_DRAW,n)})}_ensureVertexData(e,t){if(!this._dirty)return;const n=this._createDataBuffer(t);e.vertexBuffers.data?.setData(n),this._dirty=!1}_createDataBuffer(e){const t=e.reduce(((e,t)=>e+Ce(t)),0);this._count=t;const n=De.createBuffer(t),i=this._origin;let r=0,s=0;for(const t of e){for(let e=0;e<t.length;e+=3){const o=(0,h.s)(Pe,t[e],t[e+1],t[e+2]);0===e?s=this._renderCoordsHelper.getAltitude(o):this._renderCoordsHelper.setAltitude(o,s);const a=this._renderCoordsHelper.worldUpAtPosition(o,Ie),l=r+2*e,c=(0,h.f)(Pe,o,i);if(e<t.length-3){n.up.setVec(l,a),n.up.setVec(l+3,a),n.up.setVec(l+5,a);for(let e=0;e<6;e++)n.start.setVec(l+e,c);n.extrude.setValues(l,0,-1),n.extrude.setValues(l+1,1,-1),n.extrude.setValues(l+2,1,1),n.extrude.setValues(l+3,0,-1),n.extrude.setValues(l+4,1,1),n.extrude.setValues(l+5,0,1)}if(e>0){n.up.setVec(l-2,a),n.up.setVec(l-4,a),n.up.setVec(l-5,a);for(let e=-6;e<0;e++)n.end.setVec(l+e,c)}}r+=Ce(t)}return n.buffer}}function Ce(e){return 2*(e.length/3-1)*3}const Ie=(0,d.vt)(),Pe=(0,d.vt)(),De=(0,_e.BP)().vec3f(Te.r.START).vec3f(Te.r.END).vec3f(Te.r.UP).vec2f(Te.r.EXTRUDE);var Le=n(8610);class Ne extends Le.K{constructor(){super(...arguments),this.contrastControlEnabled=!1}}(0,i._)([(0,Le.W)()],Ne.prototype,"contrastControlEnabled",void 0);var Fe=n(39506),ze=n(40502),Ve=n(96500);class He extends Fe.Y{constructor(){super(...arguments),this.innerColor=(0,d.fA)(1,1,1),this.innerWidth=1,this.glowColor=(0,d.fA)(1,.5,0),this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.75,this.globalAlphaContrastBoost=2,this.angleCutoff=(0,y.kU)(6),this.pointDistanceOrigin=(0,d.vt)(),this.pointDistanceTarget=(0,d.vt)(),this.lineVerticalPlaneSegment=(0,J.vt)(),this.intersectsLineSegment=(0,J.vt)(),this.intersectsLineRadius=3,this.heightManifoldTarget=(0,d.vt)(),this.lineStartWorld=(0,d.vt)(),this.lineEndWorld=(0,d.vt)()}}class Ue extends ye.w{initializeProgram(e){return new be.B(e.rctx,Ue.shader.get().build(this.configuration),ze.D)}initializePipeline(){return(0,Se.Ey)({blending:(0,Se.ox)(xe.dn.ONE,xe.dn.ONE_MINUS_SRC_ALPHA),colorWrite:Se.wE})}}Ue.shader=new ve.$(Ve.L,(()=>n.e(3824).then(n.bind(n,62372))));class ke extends Ne{constructor(){super(...arguments),this.heightManifoldEnabled=!1,this.pointDistanceEnabled=!1,this.lineVerticalPlaneEnabled=!1,this.intersectsLineEnabled=!1,this.spherical=!1}}(0,i._)([(0,Le.W)()],ke.prototype,"heightManifoldEnabled",void 0),(0,i._)([(0,Le.W)()],ke.prototype,"pointDistanceEnabled",void 0),(0,i._)([(0,Le.W)()],ke.prototype,"lineVerticalPlaneEnabled",void 0),(0,i._)([(0,Le.W)()],ke.prototype,"intersectsLineEnabled",void 0),(0,i._)([(0,Le.W)()],ke.prototype,"spherical",void 0);var je=n(29165),Ge=n(84887);let Be=class extends fe.Ot{constructor(e){super(e),this._technique=null,this._heightManifoldEnabled=!1,this._pointDistanceEnabled=!1,this._lineVerticalPlaneEnabled=!1,this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._pathVerticalPlaneEnabled=!1,this._pathVerticalPlaneData=null,this._pathTechnique=null,this._passParameters=new He,this.produces=new Map([[je.N.LASERLINES,()=>!this.contrastControlEnabled],[je.N.LASERLINES_CONTRAST_CONTROL,()=>this.contrastControlEnabled]])}initialize(){this._passParameters.renderCoordsHelper=this.renderCoordsHelper}consumes(){return fe.B7}get isDecoration(){return this._isDecoration}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(e){this._heightManifoldEnabled!==e&&(this._heightManifoldEnabled=e,this._requestRender())}get heightManifoldTarget(){return this._passParameters.heightManifoldTarget}set heightManifoldTarget(e){(0,h.c)(this._passParameters.heightManifoldTarget,e),this._requestRender()}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(e){e!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=e,this._requestRender())}get pointDistanceTarget(){return this._passParameters.pointDistanceTarget}set pointDistanceTarget(e){(0,h.c)(this._passParameters.pointDistanceTarget,e),this._requestRender()}get pointDistanceOrigin(){return this._passParameters.pointDistanceOrigin}set pointDistanceOrigin(e){(0,h.c)(this._passParameters.pointDistanceOrigin,e),this._requestRender()}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(e){e!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=e,this._requestRender())}get lineVerticalPlaneSegment(){return this._passParameters.lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){(0,J.C)(e,this._passParameters.lineVerticalPlaneSegment),this._requestRender()}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(e){e!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=e,this._requestRender())}get intersectsLineSegment(){return this._passParameters.intersectsLineSegment}set intersectsLineSegment(e){(0,J.C)(e,this._passParameters.intersectsLineSegment),this._requestRender()}get intersectsLineRadius(){return this._passParameters.intersectsLineRadius}set intersectsLineRadius(e){e!==this._passParameters.intersectsLineRadius&&(this._passParameters.intersectsLineRadius=e,this._requestRender())}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){e!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=e,this._requestRender())}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(e){e!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=e,null!=this._pathVerticalPlaneData&&this._requestRender())}set pathVerticalPlaneVertices(e){null==this._pathVerticalPlaneData&&(this._pathVerticalPlaneData=new Re(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.vertices=e,this.pathVerticalPlaneEnabled&&this._requestRender()}set pathVerticalPlaneBuffers(e){null==this._pathVerticalPlaneData&&(this._pathVerticalPlaneData=new Re(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.buffers=e,this.pathVerticalPlaneEnabled&&this._requestRender()}setParameters(e){(0,Ge.MB)(this._passParameters,e)&&this._requestRender()}initializeRenderContext(e){this._context=e,this._techniques=e.techniques,this._techniqueConfig=new ke;const t=new Ne;t.contrastControlEnabled=this.contrastControlEnabled,this._pathTechnique=this._techniques.acquire(we,t)}uninitializeRenderContext(){this._technique=(0,o.Gz)(this._technique),this._pathVerticalPlaneData=(0,o.WD)(this._pathVerticalPlaneData),this._pathTechnique=(0,o.Gz)(this._pathTechnique)}prepareTechnique(){return this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled?(this._techniqueConfig.heightManifoldEnabled=this.heightManifoldEnabled,this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled,this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled,this._techniqueConfig.contrastControlEnabled=this.contrastControlEnabled,this._techniqueConfig.spherical=this.viewingMode===pe.RT.Global,this._technique=this._techniques.releaseAndAcquire(Ue,this._techniqueConfig,this._technique),this._technique):this._pathTechnique}renderNode(e,t,n){const i=n?.get("normals")?.getTexture();i&&(this._passParameters.normals=i,(this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled)&&this._renderUnified(e,t),this.pathVerticalPlaneEnabled&&this._renderPath(e))}_renderUnified(e,t){const n=e.rctx;this._updatePassParameters(e),n.bindTechnique(t,e.bindParameters,this._passParameters),n.screen.draw()}_renderPath(e){if(null==this._pathVerticalPlaneData||null==this._pathTechnique)return;const t=e.rctx,n=this._pathTechnique;t.bindTechnique(n,e.bindParameters,{...this._passParameters,origin:this._pathVerticalPlaneData.origin}),this._pathVerticalPlaneData.draw(e.rctx)}_updatePassParameters(e){if(!this._intersectsLineEnabled)return;const t=e.bindParameters.camera;if(this._intersectsLineInfinite){if((0,K.$e)((0,ee.LV)(this._passParameters.intersectsLineSegment.origin,this._passParameters.intersectsLineSegment.vector),$e),$e.c0=-Number.MAX_VALUE,!(0,Q.ig)(t.frustum,$e))return;(0,K.j1)($e,this._passParameters.lineStartWorld),(0,K.mO)($e,this._passParameters.lineEndWorld)}else(0,h.c)(this._passParameters.lineStartWorld,this._passParameters.intersectsLineSegment.origin),(0,h.g)(this._passParameters.lineEndWorld,this._passParameters.intersectsLineSegment.origin,this._passParameters.intersectsLineSegment.vector)}_requestRender(){this._context&&this._context.requestRender()}get test(){}};(0,i._)([(0,l.MZ)({constructOnly:!0})],Be.prototype,"viewingMode",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],Be.prototype,"contrastControlEnabled",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],Be.prototype,"_isDecoration",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],Be.prototype,"renderCoordsHelper",void 0),Be=(0,i._)([(0,u.$)("esri.views.3d.webgl-engine.effects.laserlines.LaserLineRenderer")],Be);const $e=(0,K.vt)();class Ze extends ae{constructor(e){super(e),this._angleCutoff=Ve.d,this._style={},this._heightManifoldTarget=(0,d.vt)(),this._heightManifoldEnabled=!1,this._intersectsLine=(0,J.vt)(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProperties(e)}get testData(){}createResources(){this._ensureRenderer()}destroyResources(){this._disposeRenderer()}updateVisibility(){this._syncRenderer(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance()}get angleCutoff(){return this._angleCutoff}set angleCutoff(e){this._angleCutoff!==e&&(this._angleCutoff=e,this._syncAngleCutoff())}get style(){return this._style}set style(e){this._style=e,this._syncStyle()}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(e){null!=e?((0,h.c)(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this._syncRenderer(),this._syncHeightManifold()}set intersectsWorldUpAtLocation(e){if(null==e)return void(this.intersectsLine=null);const t=this.view.renderCoordsHelper.worldUpAtPosition(e,We);this.intersectsLine=(0,J.fA)(e,t),this.intersectsLineInfinite=!0}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(e){null!=e?((0,J.C)(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this._syncIntersectsLine(),this._syncRenderer()}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){this._intersectsLineInfinite=e,this._syncIntersectsLineInfinite()}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){this._lineVerticalPlaneSegment=null!=e?(0,J.C)(e):null,this._syncLineVerticalPlane(),this._syncRenderer()}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(e){this._pathVerticalPlaneBuffers=e,this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncRenderer()}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(e){this._pointDistanceLine=null!=e?{origin:(0,d.o8)(e.origin),target:e.target?(0,d.o8)(e.target):null}:null,this._syncPointDistance(),this._syncRenderer()}_syncRenderer(){this.attached&&this.visible&&(this._intersectsLineEnabled||this._heightManifoldEnabled||null!=this._pointDistanceLine||null!=this._pathVerticalPlaneBuffers)?this._ensureRenderer():this._disposeRenderer()}_ensureRenderer(){null==this._renderer&&(this._renderer=new Be({renderCoordsHelper:this.view.renderCoordsHelper,contrastControlEnabled:!0,_isDecoration:this.isDecoration,viewingMode:this.view.state.viewingMode}),this._syncStyle(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncIntersectsLineInfinite(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this._renderer))}_syncStyle(){null!=this._renderer&&(this._renderer.setParameters(this._style),null!=this._style.intersectsLineRadius&&(this._renderer.intersectsLineRadius=this._style.intersectsLineRadius))}_syncAngleCutoff(){null!=this._renderer&&this._renderer.setParameters({angleCutoff:this._angleCutoff})}_syncHeightManifold(){null!=this._renderer&&(this._renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this._renderer.heightManifoldTarget=this._heightManifoldTarget))}_syncIntersectsLine(){null!=this._renderer&&(this._renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this._renderer.intersectsLineSegment=this._intersectsLine))}_syncIntersectsLineInfinite(){null!=this._renderer&&(this._renderer.intersectsLineInfinite=this._intersectsLineInfinite)}_syncPathVerticalPlane(){null!=this._renderer&&(this._renderer.pathVerticalPlaneEnabled=null!=this._pathVerticalPlaneBuffers&&this.visible,null!=this._pathVerticalPlaneBuffers&&(this._renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}_syncLineVerticalPlane(){null!=this._renderer&&(this._renderer.lineVerticalPlaneEnabled=null!=this._lineVerticalPlaneSegment&&this.visible,null!=this._lineVerticalPlaneSegment&&(this._renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}_syncPointDistance(){if(null==this._renderer)return;const e=this._pointDistanceLine,t=null!=e;this._renderer.pointDistanceEnabled=t&&null!=e.target&&this.visible,t&&(this._renderer.pointDistanceOrigin=e.origin,null!=e.target&&(this._renderer.pointDistanceTarget=e.target))}_disposeRenderer(){null!=this._renderer&&this.view._stage&&(this.view._stage.removeRenderPlugin(this._renderer),this._renderer=null)}}const We=(0,d.vt)();var qe=n(45147),Xe=n(8470),Ye=n(24100),Ke=n(15389),Qe=n(65352);class Je extends de{constructor(e){super(e),this._ray=(0,ee.vt)(),this._isWorldDown=!1,this._start=(0,d.vt)(),this._end=(0,d.fA)(1,0,0),this._width=1,this._color=(0,Y.fA)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,Y.fA)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=st.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=Ye.m$.OccludeAndTransparent,this._fadedExtensions=lt,this._laserline=new Ze({view:this.view,isDecoration:e.isDecoration}),this.applyProperties(e)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:et,recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:et,recreateGeometry:e=>this._recreateDrapedGeometry(e)}}updateVisibility(e){super.updateVisibility(e),this._laserline.visible=e}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,(0,h.c)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,h.f)(this._end,e,this._end),(0,ee.Cr)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,(0,h.e)(this._start,e)||((0,h.c)(this._start,e),(0,ee.Cr)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,(0,h.e)(this._end,e)||((0,h.c)(this._end,e),(0,ee.Cr)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,X.a)(e,this._color)||((0,X.c)(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,X.a)(e,this._innerColor)||((0,X.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){null!=e&&null!=this._stippleOffColor&&(0,X.a)(e,this._stippleOffColor)||(this._stippleOffColor=null!=e?(0,Y.o8)(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&null!=this._laserlineStyle&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===Ye.m$.OccludeAndTransparentStencil?Ye.m$.OccludeAndTransparent:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=e??lt,this.recreateGeometry()}_updateMaterial(){const{materialParameters:e}=this;this.object3dResources.resources?.material.setParameters(e),this.drapedResources.resources?.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration,writeDepth:this._writeDepthEnabled}}_createObject3DResources(e){const t=new Qe.W(this.materialParameters),n=new Array;return this._createObject3DGeometry(t,e,n),{material:t,geometries:n,forEach:e=>{e(t),n.forEach(e)}}}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,n){const i=this._createGeometry(e);n.push(i),t.addGeometry(i),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new Qe.W(this.materialParameters);return{material:e,geometries:[this._createDrapedGeometry(e)]}}_recreateDrapedGeometry(e){e.geometries=[this._createDrapedGeometry(e.material)]}_createDrapedGeometry(e){const t=this._createGeometry(e);return this._updateVerticesDraped(t),new Ke.$(t)}_createGeometry(e){const t=this.extensionType===st.FADED,n=t?[(0,d.vt)(),(0,d.vt)(),(0,d.vt)(),(0,d.vt)()]:[(0,d.vt)(),(0,d.vt)()];return(0,Xe.Z8)(e,n,null,t?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this._lineSegment;this._updateVertexAttributesObject3D(e,t),this._laserline.intersectsLine=t}_updateVerticesDraped(e){this._updateVertexAttributesDraped(e,this._lineSegment)}get _lineSegment(){return this._extensionType===st.FADED?this._updateLineSegmentFinite(rt):this._updateLineSegmentInfinite(this._extensionType,rt)}_updateLineSegmentFinite(e){return(0,J.Cr)(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const n=this.view.state.camera;switch((0,K.$e)(this._ray,tt),e){case st.LINE:tt.c0=-Number.MAX_VALUE;break;case st.RAY:case st.GROUND_RAY:{const e=this._ray.origin,t=this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground")??0,n=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&n<t&&(0,h.k)(tt.ray.direction,tt.ray.direction),this._extensionType===st.GROUND_RAY&&null!=t&&(tt.c1=Math.abs(n-t));break}}if(!(0,Q.ig)(n.frustum,tt))return this._updateLineSegmentFinite(t);const i=(0,K.j1)(tt,nt),r=(0,K.mO)(tt,it);return(0,J.Cr)(i,r,t)}_updateVertexAttributesObject3D(e,t){const n=e.geometries[0].getMutableAttribute(Te.r.POSITION)?.data;if(!n)return;let i=0;for(const e of this._lineVertices(t))n[i++]=e[0],n[i++]=e[1],n[i++]=e[2];e.geometryVertexAttributeUpdated(e.geometries[0],Te.r.POSITION)}_updateVertexAttributesDraped(e,t){const n=e.getMutableAttribute(Te.r.POSITION)?.data;if(!n)return;let i=0;for(const e of this._lineVertices(t))n[i++]=e[0],n[i++]=e[1],n[i++]=qe.bi;e.invalidateBoundingInfo()}*_lineVertices(e){this.extensionType===st.FADED?(yield(0,J.sd)(e,-this.fadedExtensions.start,nt),yield(0,J.sd)(e,0,nt),yield(0,J.sd)(e,1,nt),yield(0,J.sd)(e,1+this.fadedExtensions.end,nt)):(yield(0,J.sd)(e,0,nt),yield(0,J.sd)(e,1,nt))}}function et(e){e.geometries=[]}const tt=(0,K.vt)(),nt=(0,d.vt)(),it=(0,d.vt)(),rt=(0,J.vt)();var st,ot;(ot=st||(st={}))[ot.LINE=0]="LINE",ot[ot.RAY=1]="RAY",ot[ot.GROUND_RAY=2]="GROUND_RAY",ot[ot.FADED=3]="FADED";const at=1/3,lt={start:at,end:at};var ct=n(46460);class ut extends de{constructor(e){super(e),this._location=(0,d.vt)(),this._direction=(0,d.fA)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,Y.fA)(1,0,1,1),this._renderOccluded=Ye.m$.OccludeAndTransparent,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:pt,recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:ft,recreateGeometry:e=>this._recreateDrapedGeometry(e)}}get location(){return this._location}set location(e){(0,h.e)(this._location,e)||((0,h.c)(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){(0,h.e)(this._direction,e)||((0,h.c)(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){(0,h.n)(this._direction,(0,h.f)(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){(0,X.a)(e,this._color)||((0,X.c)(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}_createObject3DResources(e){const t=new Qe.W(this.materialParameters),n=new Array;return this._createObject3DGeometry(t,e,n),{material:t,geometries:n,forEach:e=>{e(t),n.forEach(e)}}}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,n){const[i,r]=ht(e);t.addGeometry(i),t.addGeometry(r),n.push(i),n.push(r),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new Qe.W(this.materialParameters),t=(0,a.watch)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}));return{material:e,geometries:this._createDrapedGeometry(e),pixelRatioHandle:t}}_recreateDrapedGeometry(e){e.geometries=this._createDrapedGeometry(e.material)}_createDrapedGeometry(e){const t=ht(e);return this._updateVerticesDraped(t),t.map((e=>new Ke.$(e)))}_updateMaterial(){const{materialParameters:e}=this;this.object3dResources.resources?.material.setParameters(e),this.drapedResources.resources?.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this.view.state.camera;t.projectToScreen(this.location,yt),(0,h.g)(mt,this.location,this.direction),t.projectToScreen(mt,bt),(0,x.S8)(bt,(0,x.Re)(bt,bt,yt)),this._updateVertexAttributesObject3D(t,e,0,yt,bt,1),this._updateVertexAttributesObject3D(t,e,1,yt,bt,-1)}_updateVertexAttributesObject3D(e,t,n,i,r,s){const o=t.geometries[n],a=o.getMutableAttribute(Te.r.POSITION)?.data;if(!a)return;const{start:l,end:c}=dt(r,i,s,this.offset,this.width,this.length);e.unprojectFromScreen((0,m.PR)(l),mt),a[0]=mt[0],a[1]=mt[1],a[2]=mt[2],e.unprojectFromScreen((0,m.PR)(c),mt),a[3]=mt[0],a[4]=mt[1],a[5]=mt[2],t.geometryVertexAttributeUpdated(o,Te.r.POSITION)}_updateVerticesDraped(e){const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:n}}}=this,{location:i,width:r,length:s,offset:o}=this,a=Tt;a.spatialReference=t.renderer.spatialReference,a.x=i[0],a.y=i[1];const l=this.view.overlayPixelSizeInMapUnits(a)*n,c=r*l,u=s*l,h=o*l;this._updateVertexAttributesDraped(e[0],c,u,h,-1),this._updateVertexAttributesDraped(e[1],c,u,h,1)}_updateVertexAttributesDraped(e,t,n,i,r){const s=e.getMutableAttribute(Te.r.POSITION)?.data;if(!s)return;const{location:o,direction:a}=this,{start:l,end:c}=dt(a,o,r,i,t,n);s[0]=l[0],s[1]=l[1],s[2]=qe.bi,s[3]=c[0],s[4]=c[1],s[5]=qe.bi,e.invalidateBoundingInfo()}}function ht(e){return[(0,Xe.Z8)(e,[(0,d.vt)(),(0,d.vt)()]),(0,Xe.Z8)(e,[(0,d.vt)(),(0,d.vt)()])]}function dt(e,t,n,i,r,s){const o=(0,x.hs)(gt,(0,x.hZ)(gt,e[1]*n,e[0]*-n),i+r/2),a=(0,x.WQ)(_t,(0,x.WQ)(_t,(0,x.WQ)(_t,t,(0,x.hs)(_t,e,s/2)),o),o);return{start:a,end:(0,x.WQ)(vt,a,(0,x.hs)(vt,e,-s))}}function pt(e){e.geometries.length=0}function ft(e){e.pixelRatioHandle.remove(),e.geometries=[]}const mt=(0,d.vt)(),gt=(0,S.vt)(),_t=(0,S.vt)(),vt=(0,S.vt)(),yt=(0,m.gs)(),bt=(0,m.gs)(),Tt=(0,ct.T)(0,0,void 0,null);var Et=n(41546),xt=n(24761),St=n(73364),wt=n(39714);class At extends ae{constructor(e){super(e),this._resources=null,this._transform=(0,wt.vt)()}get object(){return null!=this._resources?this._resources.object:null}get transform(){return this._transform}set transform(e){(0,St.C)(this._transform,e),null!=this._resources&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(null==this._resources)return;const e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),e.visible=this.visible,t.addMany(e.geometries)}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const t=new ue.x(e,{pickable:!1,updatePolicy:re.q.SYNC}),n=new ce.B({castShadow:!1});n.transformation=this._transform,this.createExternalResources(),this.createGeometries(n),e.addMany(n.geometries),this.forEachExternalMaterial((t=>e.add(t))),e.add(n),t.add(n),n.visible=this.visible,this._resources={layer:t,object:n}}destroyResources(){const e=this.view._stage;null!=this._resources&&e&&(e.remove(this._resources.object),this._resources.layer.destroy(),this.forEachExternalMaterial((t=>{e.remove(t)})),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){null!=this._resources&&(this._resources.object.visible=e)}}var Mt=n(49618),Ot=n(76589),Rt=n(98323),Ct=n(6955);class It extends At{constructor(e){super(e),this._material=null,this._texture=null,this._geometry=null,this._size=3,this._color=(0,Et.fA)(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=(0,Et.fA)(1,1,1,1),this._elevationInfo=null,this.applyProperties(e)}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){const t=this._preferredTextureSize;this._size=e,t<this._preferredTextureSize?this.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(e){(0,X.a)(e,this._color)||((0,X.c)(this._color,e),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,this.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,X.a)(e,this._outlineColor)||((0,X.c)(this._outlineColor,e),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}_updateMaterial(){this._material&&this._material.setParameters(this._materialParameters)}_updateSizeAttribute(){const e=this.object;if(null==e)return;const t=e.geometries[0];if(null==t)return;const n=t.getMutableAttribute(Te.r.SIZE).data,i=this._geometrySize;n[0]=i,n[1]=i,e.geometryVertexAttributeUpdated(e.geometries[0],Te.r.SIZE)}get _materialParameters(){return{color:this._color,textureIsSignedDistanceField:!0,sampleSignedDistanceFieldTexelCenter:(0,Rt.ny)(this._primitive),distanceFieldBoundingBox:Dt,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:this._texture?.id,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled,isDecoration:this.isDecoration}}get _geometrySize(){return this._size/Pt}createExternalResources(){this._texture=(0,Rt.sZ)(this._primitive,this._preferredTextureSize),this._material=new Ct.R(this._materialParameters);const e=this.view._stage;this._texture.load(e.renderView.renderingContext),e.add(this._texture)}destroyExternalResources(){this._texture&&(this.view._stage.remove(this._texture),this._texture.dispose(),this._texture=null),this._material=null}createGeometries(e){const t=this._createRenderGeometry();null!=t&&e.addGeometry(t)}forEachExternalMaterial(e){this._material&&e(this._material)}get _preferredTextureSize(){return(0,y.qE)(2*this._geometrySize,16,128)}calculateMapBounds(e){const t=this.object?.geometries[0];if(!t)return!1;const n=t.attributes.get(Te.r.POSITION).data;return(0,q.F)(n,this.view.renderCoordsHelper.spatialReference,Lt,this.view.spatialReference),(0,xt.Hq)(e,Lt),!0}_createRenderGeometry(){const{geometry:e,_material:t}=this;if(null==e||null==t)return null;const{renderCoordsHelper:n,elevationProvider:i}=this.view,r=(0,Mt.nG)(e,i,Ot.F.fromElevationInfo(this.elevationInfo),n),s=(0,h.s)(A.rq.get(),e.x,e.y,r),o=A.rq.get();(0,q.F)(s,e.spatialReference,o,n.spatialReference);const a=this._geometrySize;return(0,Xe.DJ)(t,null,o,null,[a,a],[0,0,0,1])}}const Pt=Rt.CN,Dt=[Pt/2,Pt/2,1-Pt/2,1-Pt/2],Lt=(0,d.vt)();var Nt=n(14905),Ft=n(40321),zt=n(48042);class Vt extends de{constructor(e){super(e),this._maxSize=0,this._position=(0,d.vt)(),this._up=(0,d.vt)(),this._right=(0,d.vt)(),this._renderOccluded=Ye.m$.OccludeAndTransparent,this._color=(0,Et.fA)(1,0,0,1),this._outlineColor=(0,Et.fA)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=Ye.m$.Opaque,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:()=>{},cameraChanged:()=>this._updateTransformObject3D()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:Ht}}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,X.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,X.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:n}){this._maxSize=Math.min((0,h.p)(t,e),(0,h.p)(t,n))/3,(0,h.n)(this._up,(0,h.f)(this._up,e,t)),(0,h.n)(this._right,(0,h.f)(this._right,n,t)),(0,h.c)(this._position,t),this.recreateGeometry()}_createObject3DResources(e){const t=new zt.v(this._quadMaterialParameters),n=0===this._outlineSize?void 0:new Qe.W(this._outlineMaterialParameters);return this._createObject3DGeometries(e,t,n),{quadMaterial:t,outlineMaterial:n,forEach:e=>{e(t),n&&e(n)}}}_createObject3DGeometries(e,t,n){if((0,h.e)(this._up,d.uY)&&(0,h.e)(this._right,d.uY))return;const i=this._createGeometries(t,n);for(const t of i)e.addGeometry(t);this._updateTransformObject3D(e)}_createDrapedResources(){const e=new zt.v(this._quadMaterialParameters),t=0===this._outlineSize?void 0:new Qe.W(this._outlineMaterialParameters),n=this._createGeometries(e,t).map((e=>new Ke.$(e)));return this._setTransformDraped(n),{quadMaterial:e,outlineMaterial:t,geometries:n,pixelRatioHandle:(0,a.watch)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}))}}_createGeometries(e,t){const{up:n,right:i,corner:r}=this._getVertices(),s=function(e,t,n,i){return new Ft.V(i,[[Te.r.POSITION,new Nt.n([0,0,0,...t,...e,...n],[0,1,2,1,2,3],3,!0)]])}(n,i,r,e);return t?[s,(0,Xe.Z8)(t,[n,r,i])]:[s]}_getVertices(){let e=this._up,t=this._right;const n=(0,h.g)(A.rq.get(),e,t);return this.isDraped&&(e=(0,h.c)(A.rq.get(),e),t=(0,h.c)(A.rq.get(),t),e[2]=0,t[2]=0,n[2]=0),{up:e,right:t,corner:n}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(e=this.object3dResources.object){if(!e)return;const t=this.view.state.camera,n=this._size*t.computeScreenPixelSizeAt(this._position),i=Math.min(this._maxSize,n);(0,St.kN)(Ut,this._position),(0,St.hs)(Ut,Ut,[i,i,i]),e.transformation=Ut}_setTransformDraped(e){if(0===e.length)return;const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:n}}}=this,{_position:i,_size:r}=this,s=(0,h.c)(A.rq.get(),i);s[2]=qe.bi;const o=kt;o.spatialReference=t.renderer.spatialReference,o.x=s[0],o.y=s[1];const a=r*(this.view.overlayPixelSizeInMapUnits(o)*n),l=Math.min(this._maxSize,a);(0,St.kN)(Ut,s),(0,St.hs)(Ut,Ut,[l,l,1]);for(const t of e)t.transformation=Ut}get _quadMaterialParameters(){return{color:this._color,forceTransparentMode:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateQuadMaterial(){this.object3dResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters),this.drapedResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded,isDecoration:this.isDecoration}}_updateOutlineMaterial(){this.object3dResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters),this.drapedResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters)}}function Ht(e){e.pixelRatioHandle.remove(),e.geometries=[]}const Ut=(0,wt.vt)(),kt=(0,ct.T)(0,0,void 0,null);var jt=n(28397),Gt=n(21267),Bt=n(34618),$t=n(44425),Zt=n(21858),Wt=n(64330);class qt extends Zt.b{sortUniqueHints(e){return e.sort(((e,t)=>(t instanceof Wt.c?t.length:0)-(e instanceof Wt.c?e.length:0)))}visualizeIntersectionPoint(e,t){const{spatialReference:n,view:i}=t,r=Xt(t);return(0,s.DQ)(new It({view:i,primitive:"circle",geometry:(0,jt.io)(e.intersectionPoint,n),elevationInfo:e.isDraped?p.Tq:p.qt,size:20,outlineSize:2,color:r.intersectionPointColor,outlineColor:r.intersectionPointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizePoint(e,t){const{view:n,spatialReference:i}=t,r=Xt(t),o=Yt(e.point,e.domain,t);return(0,s.DQ)(new It({view:n,primitive:"circle",geometry:(0,jt.io)(o,i),elevationInfo:Kt(e),size:20,outlineSize:2,color:r.pointColor,outlineColor:r.pointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizeLine(e,t){const{view:n,spatialReference:i}=t,r=Xt(t),o=Yt(e.lineStart,e.domain,t),a=Yt(e.lineEnd,e.domain,t);return(0,s.DQ)(function(e,t,n,i,r,s,o,a=!1,l=!0,c=!0){const u=Qt(t,i,r,s,a),h=Qt(n,i,r,s,a),d=new Je({view:s,extensionType:st.FADED,start:u,end:h,isDraped:a,color:o.lineColor,renderOccluded:a?Ye.m$.OccludeAndTransparent:Ye.m$.Opaque,renderGroup:ne.O7.SnappingHint,isDecoration:!0});switch(e){case $t.H3.TARGET:d.width=Gt.N.lineHintWidthTarget,d.fadedExtensions={start:0,end:Gt.N.lineHintFadedExtensions};break;case $t.H3.REFERENCE_EXTENSION:d.width=Gt.N.lineHintWidthReference,d.fadedExtensions={start:0,end:0};break;case $t.H3.REFERENCE:d.width=Gt.N.lineHintWidthReference,d.fadedExtensions={start:l?Gt.N.lineHintFadedExtensions:0,end:c?Gt.N.lineHintFadedExtensions:0}}return d.attached=!0,d}(e.type,o,a,i,Kt(e),n,r,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{view:n,spatialReference:i}=t,r=Xt(t),{isDraped:o}=e,a=Kt(e),l=Yt(e.lineStart,e.domain,t),c=Yt(e.lineEnd,e.domain,t),u=Qt(l,i,a,n,o),d=Qt(c,i,a,n,o),p=(0,h.o)(d,u,d,.5),f=new ut({view:n,attached:!1,offset:Gt.N.parallelLineHintOffset,length:Gt.N.parallelLineHintLength,width:Gt.N.parallelLineHintWidth,color:r.parallelSignColor,location:p,renderOccluded:o?Ye.m$.OccludeAndTransparent:Ye.m$.Opaque,isDraped:o,renderGroup:ne.O7.SnappingHint,isDecoration:!0});return f.setDirectionFromPoints(u,p),f.attached=!0,(0,s.DQ)(f)}visualizeRightAngleQuad(e,t){const{view:n,spatialReference:i}=t,r=Xt(t),o=Kt(e),{isDraped:a}=e,l=Yt(e.previousVertex,e.domain,t),c=Yt(e.centerVertex,e.domain,t),u=Yt(e.nextVertex,e.domain,t),h=Qt(l,i,o,n,a),d=Qt(c,i,o,n,a),p=Qt(u,i,o,n,a);return(0,s.DQ)(new Vt({view:n,attached:!0,color:a?r.rightAngleColorDraped:r.rightAngleColor,renderOccluded:a?Ye.m$.OccludeAndTransparent:Ye.m$.Transparent,outlineRenderOccluded:a?Ye.m$.OccludeAndTransparent:Ye.m$.Opaque,outlineColor:r.rightAngleOutlineColor,outlineSize:Gt.N.rightAngleHintOutlineSize,size:Gt.N.rightAngleHintSize,isDraped:a,geometry:{previous:h,center:d,next:p},renderGroup:ne.O7.SnappingHint,isDecoration:!0}))}}function Xt(e){const{effectiveTheme:t}=e.view,n=g.A.toUnitRGBA(t.accentColor),i=[0,0,0,0];return{intersectionPointColor:i,intersectionPointOutlineColor:n,pointColor:i,pointOutlineColor:n,lineColor:n,lineOutlineColor:void 0,parallelSignColor:n,rightAngleColor:n,rightAngleColorDraped:g.A.toUnitRGBA((0,r._L)(t.accentColor,.5)),rightAngleOutlineColor:n}}function Yt(e,t,{selfSnappingZ:n,view:i,spatialReference:r}){return t&Bt.n.SELF&&(0,jt.Ex)(e)&&null!=n?(0,jt.FH)(e,n,i,r):e}function Kt(e){return e.isDraped?p.Tq:p.qt}function Qt(e,t,n,i,r){const s=(0,d.vt)();if(r){const n=i.basemapTerrain.overlayManager.renderer.spatialReference;(0,q.F)(e,t,s,n)}else(0,$.XG)(e,t,n,i,s);return s}var Jt=n(14921);function en(e){const t=e.graphic;return t?[(0,a.watch)((()=>"visible"in e?e.visible:e.displaying),(e=>{e&&t.notifyMeshTransformChanged({action:Jt.$.EnableFastUpdates})}),{...a.pc}),(0,s.hA)((()=>t.notifyMeshTransformChanged({action:Jt.$.DisableFastUpdates})))]:[]}var tn=n(20794);const nn=.3;function rn(e,t){t&&Object.assign(e,t)}class sn{constructor(e){this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=Ye.m$.Opaque,this.color=e.accent}}class on{constructor({colors:e,...t}){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=e.accent,this.outlineColor=e.outline,this.renderOccluded=Ye.m$.Opaque,this.hoverOutlineColor=e.selectedOutline,rn(this,t)}applyColor(e){this._apply(this.color,e)}applyOutline(e){this._apply(this.outlineColor,e)}applyHoverOutline(e){this._apply(this.hoverOutlineColor,e)}_apply(e,t){t.setParameters({color:(0,r.QP)(e),renderOccluded:this.renderOccluded})}}class an{constructor({colors:e,...t}){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.renderOccluded=Ye.m$.Transparent,this.minSquaredEdgeLength=900,this.color=(0,r._L)(e.accent,.5),this.hoverColor=e.accent,rn(this,t)}applyColor(e){this._apply(this.color,e)}applyHover(e){this._apply(this.hoverColor,e)}_apply(e,t){t.setParameters({color:(0,r.QP)(e),renderOccluded:this.renderOccluded})}}class ln{constructor(e){this.vertex=new on({colors:e,color:e.accent,outlineColor:e.outline}),this.edge=new on({colors:e,color:(0,r.Vl)((0,r._L)(e.accent,2/3),.5),outlineColor:(0,r._L)(e.outline,.5),size:8,collisionPadding:8}),this.selected=new on({colors:e,color:e.selected,outlineColor:e.outline}),this.edgeOffset=new an({colors:e})}}class cn{constructor({colors:e,...t}){this.width=1.5,this.stipplePattern=(0,tn.wk)(3.3),this.falloff=0,this.innerWidth=1.5,this.renderOccluded=Ye.m$.OccludeAndTransparent,this.color=e.selected,this.stippleOffColor=e.outline,this.innerColor=e.selected,rn(this,t)}apply(e){e.color=(0,r.QP)(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=(0,r.QP)(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=(0,r.QP)(this.innerColor),e.renderOccluded=this.renderOccluded}}class un{constructor({colors:e,...t}){this.size=4,this.outlineSize=1,this.shape="square",this.color=e.selected,this.outlineColor=e.outline,rn(this,t)}apply(e){e.color=(0,r.QP)(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=(0,r.QP)(this.outlineColor),e.primitive=this.shape}}class hn{constructor({colors:e,...t}){this.innerWidth=1,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=nn,this.globalAlphaContrastBoost=1.5,this.radius=3,this.innerColor=e.selected,this.glowColor=e.accent,this.heightFillColor=e.accent,rn(this,t)}apply(e,t=1){const n={glowColor:g.A.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:g.A.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t*this.glowColor.a,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=n:e.laserlineStyle=n}}class dn{constructor(e){this.outline=new cn({colors:e,color:e.stippleOff,renderOccluded:Ye.m$.OccludeAndTransparentStencil,stippleOffColor:e.stippleOn,innerWidth:0}),this.staged=new cn({colors:e,color:e.stippleOn,renderOccluded:Ye.m$.OccludeAndTransparentStencil,innerColor:e.stagedSolid,stippleOffColor:e.stippleOff}),this.shadowStyle=new hn({colors:e,globalAlpha:nn,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:1})}}class pn{constructor(e){this.outline=new un({colors:e,color:e.selected,outlineColor:e.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new hn({colors:e,globalAlpha:nn,glowColor:e.accent,glowFalloff:1.5,glowWidth:6,innerColor:e.selected,innerWidth:1,radius:2})}}class fn extends cn{constructor({colors:e,...t}){super({colors:e}),this.extensionType=st.GROUND_RAY,rn(this,t)}}class mn{constructor(e){this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,this.lineObjects=new dn(e),this.pointObjects=new pn(e),this.heightPlane=new hn({colors:e,globalAlpha:nn,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:1}),this.heightBox=new hn({colors:e,globalAlpha:nn,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:0,heightFillColor:e.accent}),this.zVerticalLine=new fn({colors:e,color:(0,r._L)(e.accent,.5),falloff:2,innerColor:(0,r._L)(e.selected,0),renderOccluded:Ye.m$.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:st.GROUND_RAY})}}let gn=class extends _.A{constructor(e){super(e)}get colors(){const e=this.getTheme().accentColor,t=e.a;return{accent:e,contrast:(0,r.bJ)(e),selected:g.A.fromArray([255,255,255,t]),selectedOutline:g.A.fromArray([255,255,255,t]),staged:g.A.fromArray([12,207,255,t]),stagedSolid:g.A.fromArray([12,207,255,1]),outline:g.A.fromArray([0,0,0,.5*t]),stippleOn:g.A.fromArray([255,255,255,1]),stippleOff:g.A.fromArray([0,0,0,.5])}}get visualElements(){return new mn(this.colors)}get manipulators(){return new ln(this.colors)}get zManipulator(){return new sn(this.colors)}};(0,i._)([(0,l.MZ)()],gn.prototype,"colors",null),(0,i._)([(0,l.MZ)()],gn.prototype,"visualElements",null),(0,i._)([(0,l.MZ)()],gn.prototype,"manipulators",null),(0,i._)([(0,l.MZ)()],gn.prototype,"zManipulator",null),(0,i._)([(0,l.MZ)()],gn.prototype,"getTheme",void 0),gn=(0,i._)([(0,u.$)("esri.views.3d.interactive.editingTools.settings")],gn);var _n=n(48996),vn=n(57617),yn=n(79366),bn=n(29800);class Tn extends de{constructor(e){super(e),this._attachmentOrigin=(0,ct.T)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new _n.A,this._geometry=null,this._width=1,this._color=(0,Y.fA)(1,0,1,1),this._innerWidth=0,this._innerColor=(0,Y.fA)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=Ye.m$.OccludeAndTransparentStencil,this._attachmentOrigin.spatialReference=e.view.spatialReference,this._laserline=new Ze({view:e.view,isDecoration:e.isDecoration}),this.applyProperties(e),this.attached=e.attached??!0}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:En,recreateGeometry:(e,t)=>{e.geometries.length=0,this._recreateGeometry(t,e.material,e.geometries)}}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:En,recreateGeometry:e=>{e.geometries=this._createRenderGeometriesDraped(e.material),this._attachmentOriginChanged()}}}get _laserlineAttached(){return this.attached&&this.visible&&null!=this._laserlineStyle&&!this.isDraped&&this.laserlineEnabled}onAttachedChange(e){this._laserline.attached=this._laserlineAttached,e&&this._attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,X.a)(e,this._color)||((0,X.c)(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,X.a)(e,this._innerColor)||((0,X.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&(0,X.a)(e,this._stippleOffColor)||(this._stippleOffColor=e?(0,Y.o8)(e):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const e=this.object3dResources.resources?.geometries;if(!e||0===e.length)return null;(0,h.s)(Sn,0,0,0);let t=0;for(const n of e)n.computeAttachmentOrigin(xn)&&((0,h.g)(Sn,Sn,xn),t++);return 0===t?null:((0,h.j)(Sn,Sn,1/t),this.view.renderCoordsHelper.fromRenderCoords(Sn,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){null!=this.object3dResources.resources&&this.object3dResources.resources.material.setParameters(this._materialParameters),null!=this.drapedResources.resources&&this.drapedResources.resources.material.setParameters(this._materialParameters)}get _isClosed(){return null!=this.geometry&&"polygon"===this.geometry.type}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration}}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===Ye.m$.OccludeAndTransparentStencil?Ye.m$.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(e,t,n){this._createRenderGeometries(t,n);for(const t of n)e.addGeometry(t);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_createObject3DResources(e){const t=new Qe.W(this._materialParameters),n=new Array;return this._recreateGeometry(e,t,n),{material:t,geometries:n,forEach:e=>{e(t),n.forEach(e)}}}_createDrapedResources(){const e=new Qe.W(this._materialParameters);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}_createRenderGeometriesDraped(e){const{geometry:t,view:n}=this,i=n.basemapTerrain.spatialReference;return null==t||null==i?[]:(0,bn.A)(t,i).lines.map((({position:t})=>{const r={overlayInfo:{spatialReference:i,renderCoordsHelper:n.renderCoordsHelper},attributeData:{position:t},removeDuplicateStartEnd:this._isClosed};return new Ke.$((0,yn.t)(e,r))}))}calculateMapBounds(e){if(null==this.object3dResources.resources)return!1;const t=this.view.renderCoordsHelper;for(const n of this.object3dResources.resources.geometries){const i=n.attributes.get(Te.r.POSITION),r=(0,me.jh)(i.data.length);(0,vn.projectBuffer)(i.data,t.spatialReference,0,r,this.view.spatialReference,0,i.data.length/3),(0,xt.Hq)(e,r)}return!0}_createRenderGeometries(e,t){const n=this.geometry;if(null==n)return;const i=(0,bn.C)(n,this.view.elevationProvider,this.view.renderCoordsHelper,Ot.F.fromElevationInfo(this.elevationInfo??new f.A({mode:(0,p.w7)(n,null)}))),r=new Array;for(const{position:n,mapPositions:s}of i.lines){const i={mapPositions:s,attributeData:{position:n},removeDuplicateStartEnd:this._isClosed};t.push((0,yn.t)(e,i)),r.push(n)}this._laserline.pathVerticalPlane=r}}function En(e){e.geometries=[]}const xn=(0,d.vt)(),Sn=(0,d.vt)();var wn=n(54407),An=n(92754),Mn=n(27264),On=n(4875),Rn=n(45079),Cn=n(90553),In=n(93678),Pn=n(46921),Dn=n(55890),Ln=n(46121),Nn=n(60593);class Fn extends ye.w{initializeProgram(e){return new be.B(e.rctx,Fn.shader.get().build(this.configuration),Vn)}_setPipelineState(e){const t=this.configuration,n=e===Dn.y.NONE,i=e===Dn.y.FrontFace;return(0,Se.Ey)({blending:t.output===Mn.V.Color&&t.transparent?n?Pn.V0:(0,Pn.ez)(e):null,culling:(0,Se.Xt)(t.cullFace),depthTest:{func:i?xe.MT.LESS:t.shadingEnabled?xe.MT.LEQUAL:xe.MT.LESS},depthWrite:n?t.writeDepth?Se.kn:null:(0,Pn.XO)(e),drawBuffers:(0,Pn.cl)(e),colorWrite:Se.wE,polygonOffset:n||i?null:Pn.SE})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}Fn.shader=new ve.$(Nn.S,(()=>n.e(9586).then(n.bind(n,52609))));class zn extends Ln.E{constructor(){super(...arguments),this.output=Mn.V.Color,this.cullFace=wn.s2.None,this.transparencyPassType=Dn.y.NONE,this.hasSlicePlane=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.multipassEnabled=!1,this.cullAboveGround=!1}}(0,i._)([(0,Le.W)({count:Mn.V.COUNT})],zn.prototype,"output",void 0),(0,i._)([(0,Le.W)({count:wn.s2.COUNT})],zn.prototype,"cullFace",void 0),(0,i._)([(0,Le.W)({count:Dn.y.COUNT})],zn.prototype,"transparencyPassType",void 0),(0,i._)([(0,Le.W)()],zn.prototype,"hasSlicePlane",void 0),(0,i._)([(0,Le.W)()],zn.prototype,"transparent",void 0),(0,i._)([(0,Le.W)()],zn.prototype,"writeDepth",void 0),(0,i._)([(0,Le.W)()],zn.prototype,"screenSizeEnabled",void 0),(0,i._)([(0,Le.W)()],zn.prototype,"shadingEnabled",void 0),(0,i._)([(0,Le.W)()],zn.prototype,"multipassEnabled",void 0),(0,i._)([(0,Le.W)()],zn.prototype,"cullAboveGround",void 0),(0,i._)([(0,Le.W)({constValue:!1})],zn.prototype,"occlusionPass",void 0);const Vn=new Map([[Te.r.POSITION,0],[Te.r.NORMAL,1],[Te.r.OFFSET,2]]);class Hn extends Ye.im{constructor(e){super(e,new kn),this.supportsEdges=!0,this.produces=new Map([[je.N.OPAQUE_MATERIAL,e=>e===Mn.V.Highlight||(0,Mn.zW)(e)&&!this._isTransparent],[je.N.TRANSPARENT_MATERIAL,e=>(0,Mn.zW)(e)&&this._isTransparent&&this.parameters.writeDepth],[je.N.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,e=>(0,Mn.zW)(e)&&this._isTransparent&&!this.parameters.writeDepth]]),this._configuration=new zn,this._vertexAttributeLocations=Vn}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.screenSizeEnabled=this.parameters.screenSizeEnabled,this._configuration.shadingEnabled=this.parameters.shadingEnabled,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,t,n,i,r,s){if(this.parameters.screenSizeEnabled){const t=e.attributes.get(Te.r.OFFSET),o={applyToVertex:(e,i,r,s)=>{const o=(0,h.s)(Gn,t.data[3*s],t.data[3*s+1],t.data[3*s+2]),a=(0,h.s)(Bn,e,i,r);return(0,h.j)(o,o,this.parameters.screenSizeScale*n.camera.computeScreenPixelSizeAt(o)),(0,h.g)(a,a,o),[a[0],a[1],a[2]]},applyToAabb:e=>{const t=(0,xt.gX)(e,Gn);return(0,xt.hs)(e,this.parameters.screenSizeScale*n.camera.computeScreenPixelSizeAt(t))}};(0,Rn.Uy)(e,n,i,r,o,s)}else(0,Rn.Uy)(e,n,i,r,void 0,s)}createGLMaterial(e){return new Un(e)}createBufferWriter(){return new jn(this.parameters.screenSizeEnabled)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}}class Un extends On.A{beginSlot(e){return this.ensureTechnique(Fn,e)}}class kn extends Ye.qA{constructor(){super(...arguments),this.color=(0,Et.fA)(1,1,1,1),this.shadingTint=(0,Et.fA)(0,0,0,.25),this.shadingDirection=(0,h.n)((0,d.vt)(),[.5,-.5,-.5]),this.screenSizeScale=14,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=wn.s2.None,this.screenSizeEnabled=!1,this.shadingEnabled=!0}}class jn{constructor(e){this.screenSizeEnabled=e;const t=(0,_e.BP)().vec3f(Te.r.POSITION).vec3f(Te.r.NORMAL);this.screenSizeEnabled&&t.vec3f(Te.r.OFFSET),this.vertexBufferLayout=t}elementCount(e){return e.attributes.get(Te.r.POSITION).indices.length}write(e,t,n,i,r){if((0,In.SA)(n,this.vertexBufferLayout,e,t,i,r),this.screenSizeEnabled){if(!n.attributes.has(Te.r.OFFSET))throw new Error(`${Te.r.OFFSET} vertex attribute required for screenSizeEnabled ShadedColorMaterial`);{const e=n.attributes.get(Te.r.OFFSET);(0,Cn.vA)(3===e.size);const s=i.getField(Te.r.OFFSET,An.xs);if(!s)throw new Error("unable to acquire view for "+Te.r.OFFSET);(0,In.Hk)(e,t,s,r)}}}}const Gn=(0,d.vt)(),Bn=(0,d.vt)();class $n extends At{constructor(e){super(e),this.view=null,this._renderOccluded=Ye.m$.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=(0,Et.ci)([1,127/255,0,1]),this._size=11,this._outlineColor=(0,Et.ci)([0,0,0,.5]),this._outlineSize=1,this._elevationInfo=null,this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){(0,X.a)(e,this._color)||((0,X.c)(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,X.a)(e,this._outlineColor)||((0,X.c)(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,screenSizeScale:this.size,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const e=this.vertices;if(null==e||0===e.length)return[];const t=function(e,t,n,i,r){const s=(0,me.jh)(3*e.length),o=(0,me.jh)(s.length);e.forEach(((e,t)=>{s[3*t]=e[0],s[3*t+1]=e[1],s[3*t+2]=e.length>2?e[2]:0}));const a=(0,Mt.au)(s,t,0,o,0,s,0,s.length/3,n,i,r),l=null!=a;return{numVertices:e.length,position:s,mapPositions:o,projectionSuccess:l,sampledElevation:a}}(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,Ot.F.fromElevationInfo(this.elevationInfo)),n=[],i=t.numVertices,r=t.position;for(let e=0;e<i;++e){const t=(0,h.s)(Zn,r[3*e],r[3*e+1],r[3*e+2]),i=Wn(this._vertexMaterial,.5,t),s=Wn(this._vertexOutlineMaterial,.5,t);n.push({vertexGeometry:i,vertexOutlineGeometry:s})}return n}createGeometries(e){const t=this._createRenderGeometries();for(const{vertexGeometry:n,vertexOutlineGeometry:i}of t)e.addGeometry(n),e.addGeometry(i)}createExternalResources(){this._vertexMaterial=new Hn({...this._vertexMaterialParameters,writeDepth:!0,cullFace:wn.s2.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new Hn({...this._vertexOutlineMaterialParameters,forceTransparentMode:!0,writeDepth:!0,cullFace:wn.s2.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}}const Zn=(0,d.vt)();function Wn(e,t,n){return(0,Xe.CM)(e,t,16,16,{offset:n})}let qn=class extends _n.A.EventedAccessor{constructor(e){super(e),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};(0,i._)([(0,l.MZ)({constructOnly:!0})],qn.prototype,"graphic",void 0),(0,i._)([(0,l.MZ)()],qn.prototype,"tracking",void 0),(0,i._)([(0,l.MZ)()],qn.prototype,"displaying",void 0),(0,i._)([(0,l.MZ)()],qn.prototype,"isDraped",void 0),qn=(0,i._)([(0,u.$)("esri.views.3d.layers.graphics.GraphicState")],qn);var Xn=n(93336),Yn=n(85499),Kn=n(99113),Qn=n(77664),Jn=n(25638);let ei=class extends Xn.N{constructor(e){super(e),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._verticalLineVisualElement=null,this._settings=new gn({getTheme:()=>this.view.effectiveTheme}),this.geometryType=null,this.type="draw-3d"}initialize(){const{mode:e,offset:t,unit:n}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new f.A({mode:e,offset:t,unit:n})}normalizeCtorArgs(e){if(!e.elevationInfo){const t=e.hasZ??!0;return{...e,elevationInfo:(0,p.bK)(t)}}return e}initializeGraphic(e){const{view:t}=this,n=this._createGraphicState=new qn({graphic:e});return(0,s.vE)([t.maskOccludee(e),t.trackGraphicState(n),(0,a.watch)((()=>({element:this._outlineVisualElement,isDraped:n.isDraped})),(({element:e,isDraped:t})=>{e&&(e.isDraped=t)}),a.pc),(0,Jn.fm)((()=>{(0,Qn.IA)(this.tooltipInfos.mesh,this.geometryToPlace)})),this._setupLoadingIndicator(n),...en(n)])}makeDrawOperation(){const{geometryType:e}=this,t="circle"!==e&&"rectangle"!==e;return new Yn.O0({view:this.view,manipulators:this.manipulators,geometryType:(0,Xn.l)(e),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new Kn.IX(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new Kn.rT(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new qt,segmentLabels:t?new Z:null,labelOptions:this.sketchOptions.labels,isDraped:this._createGraphicState?this._createGraphicState.isDraped:"on-the-ground"===(0,p.wF)(this.hasZ,this.elevationInfo),cursor:this.cursor,constraintsEnabled:!0})}onActiveVertexChanged(e){const{view:t}=this;if(this._activeVertexVisualElement)return this._activeVertexVisualElement.vertices=[e],this._activeVertexVisualElement.recreate(),this._updateVerticalLineVisualElement(e),(0,s.hA)();const n=this._settings,i=n.manipulators.vertex,l=new $n({view:t,spatialReference:t.spatialReference,vertices:[e],elevationInfo:this.internalGraphicsLayer.elevationInfo,size:i.size,outlineSize:i.outlineSize,renderOccluded:i.renderOccluded,attached:!1,isDecoration:!0});this._activeVertexVisualElement=l;const c=n.visualElements.zVerticalLine,u=new Je({view:t,extensionType:c.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:Ye.m$.OccludeAndTransparent,isDecoration:!0});this._verticalLineVisualElement=u;const h=(0,s.vE)([(0,a.watch)((()=>n.visualElements.zVerticalLine),(e=>e.apply(u)),a.Vh),(0,a.watch)((()=>({selectedColor:(0,r.QP)(n.colors.selected),outlineColor:(0,r.QP)(n.manipulators.vertex.outlineColor)})),(({selectedColor:e,outlineColor:t})=>{l.color=e,l.outlineColor=t}),a.Vh),(0,s.hA)((()=>{this._activeVertexVisualElement=(0,o.pR)(this._activeVertexVisualElement),this._verticalLineVisualElement=(0,o.pR)(this._verticalLineVisualElement)}))]);return l.attached=!0,this._updateVerticalLineVisualElement(e),h}_updateVerticalLineVisualElement(e){const t=this._verticalLineVisualElement;if(!t)return;const{renderCoordsHelper:n,elevationProvider:i}=this.view;(0,h.s)(ni,e[0],e[1],e[2]),ti.setFromElevationInfo(this.elevationInfo),ni[2]=(0,Mt.nG)(ni,i,ti,n),n.toRenderCoords(ni,this.view.spatialReference,ni)?(t.setStartEndFromWorldDownAtLocation(ni),t.attached=!0):t.attached=!1}onOutlineChanged(e){if(this._outlineVisualElement)return this._outlineVisualElement.geometry=e,(0,s.hA)();const t=this.internalGraphicsLayer.elevationInfo,{view:n}=this,i=this._settings,r=new Tn({view:n,geometry:e,elevationInfo:t,isDraped:this._createGraphicState?this._createGraphicState.isDraped:"on-the-ground"===(0,p.wF)(this.hasZ,t),attached:!1,isDecoration:!0});this._outlineVisualElement=r;const l=(0,s.vE)([(0,a.watch)((()=>i.visualElements.lineObjects.outline),(e=>e.apply(r)),a.Vh),(0,a.watch)((()=>i.visualElements.lineObjects.shadowStyle),(e=>e.apply(r)),a.Vh),(0,s.hA)((()=>{this._outlineVisualElement=(0,o.pR)(this._outlineVisualElement)}))]);return r.attached=!0,r.laserlineEnabled=!0,l}onRegularVerticesChanged(e){if(this._verticesVisualElement)return this._verticesVisualElement.vertices=e,(0,s.hA)();const{view:t}=this,n=this._settings,i=n.manipulators.vertex,l=new $n({view:t,spatialReference:t.spatialReference,vertices:e,elevationInfo:this.internalGraphicsLayer.elevationInfo,size:i.size,outlineSize:i.outlineSize,renderOccluded:i.renderOccluded,attached:!1,isDecoration:!0}),c=(0,s.vE)([(0,a.watch)((()=>({color:(0,r.QP)(n.manipulators.vertex.color),outlineColor:(0,r.QP)(n.manipulators.vertex.outlineColor)})),(({color:e,outlineColor:t})=>{l.color=e,l.outlineColor=t}),a.Vh),(0,s.hA)((()=>{this._verticesVisualElement=(0,o.pR)(this._verticesVisualElement)}))]);return l.attached=!0,this._verticesVisualElement=l,c}updateGraphicGeometry(e){if("mesh"!==this.geometryType||"point"!==e?.type)super.updateGraphicGeometry(e);else{const t=this.geometryToPlace;t?.centerAt(e),(0,Qn.IA)(this.tooltipInfos.mesh,t);const n=this._graphic;t&&n.geometry===t||(n.geometry=t)}}_setupLoadingIndicator(e){const{drawOperation:t}=this;if(!this.geometryToPlace)return t.loading=!1,null;t.loading=!0;const n=(0,s.hA)((()=>{t.loading=!1}));let i;const r=()=>i&&cancelAnimationFrame(i);return(0,s.vE)([(0,a.when)((()=>e.displaying),(()=>{r(),i=requestAnimationFrame((()=>n.remove()))}),{...a.pc,once:!0}),(0,s.hA)(r),n])}};(0,i._)([(0,l.MZ)({constructOnly:!0})],ei.prototype,"elevationInfo",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],ei.prototype,"geometryType",void 0),(0,i._)([(0,l.MZ)()],ei.prototype,"type",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],ei.prototype,"view",void 0),ei=(0,i._)([(0,u.$)("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],ei);const ti=new Ot.F,ni=(0,d.vt)();var ii=n(50659),ri=n(78879),si=n(56275),oi=n(20248),ai=n(8527);function li(e){if(null==e||"polyline"!==e.type&&"polygon"!==e.type)return 0;const t="polyline"===e.type?e.paths:e.rings,n=(0,ai.FD)();for(const e of t)for(let t=0;t<e.length-1;t++){const i=e[t],r=e[t+1],s=i[0]-r[0],o=i[1]-r[1];if(s*s+o*o>n)return Math.atan2(r[1]-i[1],r[0]-i[0])}return 0}var ci=n(71851);function ui(e){return e?.operations?.data.geometry}function hi(e,t){return function(e,t){return!!e&&"on-the-ground"!==t.mode&&!(0,p.v9)(t)}(e?.data.coordinateHelper.hasZ(),t)}var di=n(34358),pi=n(46517);function fi(e,t,n){function i(){const e=n(),t=e.sketchOptions.tooltips.effectiveEnabled?e.activeTooltipInfo:null;return{...e,activeTooltipInfo:t}}let r=!1;function o({activeTooltipInfo:n,sketchOptions:i}){r=!0,n&&(n.sketchOptions=i,gi(n,t)),e.info=n,r=!1}return(0,s.vE)([(0,a.watch)(i,o,a.pc),(0,a.watch)((()=>{const e=i(),{activeTooltipInfo:n}=e;if(n)return{context:e,activeTooltipInfo:n,key:n.key,geometry:ui(t)}}),((e,n)=>{e&&!r&&n&&n.key!==e.key&&function(e,t,{callbacks:n}){const i=ui(t);switch(i?.type){case"mesh":mi(e,i.origin,t,n),"orientation"in e&&"scale"in e&&(0,Qn.IA)(e,i,n);break;case"point":mi(e,i,t,n)}}(e.activeTooltipInfo,t,e.context)}),a.OH),t.on("committed",(()=>o(i()))),(0,Qn.sZ)(e)])}function mi(e,t,n,i){const{dx:r,dy:s,dz:o}=(0,Qn.mu)(e,t);0===r&&0===s&&0===o||(i.onMoveStart?.(),n.operations?.move(r,s,o,di.Y.NEW_STEP),i.onMove?.(r,s,o),i.onMoveStop?.())}function gi(e,t){const n=ui(t);if(!e||!n||"mesh"!==n.type&&"point"!==n.type)return;const i="mesh"===n.type,r=i?n.origin:n;e.setLocationFromPoint(r),_i(e,r,t),"transform-mesh"===e.type&&i&&(0,Qn.Ue)(e,n),e.clearInputValues()}function _i(e,t,n){e.elevation.actual=(0,pi.Of)(t),e.elevation.visible=!!n.operations?.data.coordinateHelper.hasZ(),e.elevation.readOnly=!1,e.elevation.showAsZ=!0}var vi=n(85445),yi=(n(50917),n(82547)),bi=n(44705),Ti=n(87725),Ei=n(61714),xi=n(46157),Si=n(46098),wi=n(61441),Ai=n(87416),Mi=n(5596),Oi=n(45328),Ri=n(60516);function Ci(e,t,n=(0,ee.vt)()){return Ii(e,(0,m.WA)(t),n),(0,h.n)(n.direction,n.direction),n}function Ii(e,t,n){return function(e,t,n){const i=(0,m.sc)((0,x.C)(A.rq.get(),t));if(i[2]=0,!e.unprojectFromRenderScreen(i,n.origin))return null;const r=(0,m.sc)((0,x.C)(A.rq.get(),t));r[2]=1;const s=e.unprojectFromRenderScreen(r,A.rq.get());return null==s?null:((0,h.f)(n.direction,s,n.origin),n)}(e,e.screenToRender(t,(0,m.sc)(A.rq.get())),n)}var Pi=n(65631),Di=n(53551),Li=n(45532);class Ni{constructor(e){this.metadata=void 0,this._camera=new Pi.A,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=new Array,this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=(0,wt.vt)(),this._worldFrame=null,this._renderLocation=(0,d.vt)(),this._renderLocationDirty=!0,this._location=new Li.default({x:0,y:0,z:0}),this._elevationAlignedLocation=new Li.default,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.consumesClicks=!0,this.cursor=null,this.grabCursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=Di.SJ.None,this._focused=!1,this.events=new _n.A.EventEmitter,this._screenLocation={screenPointArray:(0,m.gs)(),renderScreenPointArray:(0,m.r_)(),pixelSize:0},this._screenLocationDirty=!0,this._engineResourcesAddedToStage=!1,this._attached=!1,this._location.spatialReference=e.view.spatialReference,Object.assign(this,e);const t=this.view.state?.camera;t&&this._camera.copyFrom(t)}destroy(){this._applyObjectTransform=Ki,this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this._camera=null}get _stage(){return this.view?._stage}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),(0,s.hA)((()=>{this._noDisplayCount--,0===this._noDisplayCount&&this._updateEngineObject()}))}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){Fi(e)&&(this._screenLocationDirty=!0),(0,St.C)(this._modelTransform,e),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=(0,wt.vt)()),function(e,t,n){switch(e.viewingMode){case"local":return(0,St.D_)(n),!0;case"global":{const i=(0,Ei.tO)(e.renderCoordsHelper.spatialReference);(0,wi.n4)(t,0,Bi,0,i.radius),(0,Si.y)((0,y.kU)(Bi[0]),(0,y.kU)(Bi[1]),n)}}}(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(e){(0,Oi.EL)(e,this._location),this._notifyLocationChanged()}_notifyLocationChanged(){this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){(0,Oi.EL)(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){const e=null!=this._elevation.override?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y,this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=(0,Oi.RS)(this.location.spatialReference),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject())}updateStateEnabled(e,t){t?this.state|=e:this.state&=~e}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:!0===e?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this._ensureScreenLocation(),this._screenLocation}_ensureScreenLocation(){if(!this._screenLocationDirty)return;let e;if(this._screenLocation.pixelSize=this._camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,Fi(this._modelTransform)){const t=this._calculateModelTransformOffset(Xi);e=(0,h.g)(t,t,this.renderLocation)}else e=this.renderLocation;this._camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this._camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}get attached(){return this._attached}intersectionDistance(e,t){if(!this.available)return null;const n=(0,m.WA)(e,zi),i=this._getCollisionRadius(t),r=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if((0,x.hG)(this.screenLocation.screenPointArray,n)<i*i)return this.screenLocation.renderScreenPointArray[2]+r;break;case"line":{const e=this.collisionType.paths,t=this._getWorldToScreenObjectScale(),s=this._calculateObjectTransform(t,ji),o=i*this.screenLocation.pixelSize,a=Ii(this._camera,n,Hi);if(null==a)return null;for(const t of e){if(0===t.length)continue;const e=(0,h.h)(Bi,t[0],s);for(let n=1;n<t.length;n++){const i=(0,h.h)($i,t[n],s),l=(0,J.dz)((0,J.Cr)(e,i,Vi),a);if(null!=l&&l<o*o){const t=(0,h.g)(A.rq.get(),e,i);(0,h.j)(t,t,.5);const n=(0,m.rX)(A.rq.get());return this._camera.projectToRenderScreen(t,n),n[2]+r}(0,h.c)(e,i)}}break}case"disc":{const e=this.collisionType.direction,t=this.collisionType.offset??d.uY,s=this._getWorldToScreenObjectScale(),o=this._calculateObjectTransform(s,ji),a=i*this.screenLocation.pixelSize,l=Ii(this._camera,n,Hi);if(null==l)return null;const c=(0,bi.z0)(Ui,o),u=(0,h.t)(Wi,e,c),p=(0,h.h)(qi,t,o);(0,Mi.O_)(p,u,Gi);const f=Zi;if((0,Mi.Ui)(Gi,l,f)&&(0,h.a)(f,p)<a*a)return this.screenLocation.renderScreenPointArray[2]+r;break}case"ribbon":{const{paths:e,direction:t}=this.collisionType,s=this._getWorldToScreenObjectScale(),o=this._calculateObjectTransform(s,ji),a=i*this._camera.computeScreenPixelSizeAt(this.renderLocation),l=Ii(this._camera,n,Hi);if(null==l)return null;const c=(0,bi.z0)(Ui,o),u=(0,h.t)(Wi,t,c),d=this._calculateModelTransformPosition(qi);(0,Mi.O_)(d,u,Gi);const p=Zi;if(!(0,Mi.Ui)(Gi,l,p))break;for(const t of e){if(0===t.length)continue;const e=(0,h.h)(Bi,t[0],o);for(let n=1;n<t.length;n++){const i=(0,h.h)($i,t[n],o),s=(0,J.kb)((0,J.Cr)(e,i,Vi),p);if(null!=s&&s<a*a){const t=(0,h.g)(A.rq.get(),e,i);(0,h.j)(t,t,.5);const n=(0,m.rX)(A.rq.get());return this._camera.projectToRenderScreen(t,n),n[2]+r}(0,h.c)(e,i)}}break}default:(0,yi.Xb)(this.collisionType)}return null}attach(e={manipulator3D:{}}){const t=this._stage;if(!t)return;const n=e.manipulator3D;null==n.engineLayerId?(this._engineLayer=new ue.x(t,{pickable:!1,updatePolicy:re.q.SYNC}),n.engineLayerId=this._engineLayer.id):t?.getObject&&(this._engineLayer=t.getObject(n.engineLayerId)),n.engineLayerReferences=(n.engineLayerReferences||0)+1,this._materialIdReferences=n.materialIdReferences,null==this._materialIdReferences&&(this._materialIdReferences=new Map,n.materialIdReferences=this._materialIdReferences),this._camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),(0,xi.canProjectWithoutEngine)(this._location.spatialReference,this.view.spatialReference)||(this.location=new Li.default({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(e={manipulator3D:{}}){const t=e.manipulator3D;t.engineLayerReferences--;const n=0===t.engineLayerReferences;this._removeResourcesFromStage(),n&&(t.engineLayerId=null,(0,o.pR)(this._engineLayer)),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this._camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(e){(0,xi.projectPoint)(this.location,Yi,e.spatialReference)&&(0,Ai.vR)(e.extent,Yi)&&this._notifyLocationChanged()}_evaluateElevationAlignment(){if(null==this.elevationInfo)return;let e=null,t=0;const n=(0,p.Ze)(this.elevationInfo,this.location.spatialReference??this.view.elevationProvider.spatialReference);switch(this.elevationInfo.mode){case"on-the-ground":e=(0,Ri.R1)(this.view.elevationProvider,this.location,"ground")??0;break;case"relative-to-ground":t=((0,Ri.R1)(this.view.elevationProvider,this.location,"ground")??0)+n;break;case"relative-to-scene":t=((0,Ri.R1)(this.view.elevationProvider,this.location,"scene")??0)+n;break;case"absolute-height":t=n}return t!==this._elevation.offset||e!==this._elevation.override?(this._elevation.offset=t,void(this._elevation.override=e)):void 0}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const e=this._getWorldToScreenObjectScale(),t=ji;if(!0===this.autoScaleRenderObjects){const n=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(n,t)}else this._calculateObjectTransform(e,t);const{objectsByState:n}=this._ensureEngineResources(),i=(this.focused?Di.p7.Focused:Di.p7.Unfocused)|(this.selected?Di.p7.Selected:Di.p7.Unselected),r=this._noDisplayCount>0;for(const{stateMask:e,objects:s}of n){if(r){for(const e of s)e.visible=!1;continue}const n=(e&Di.p7.All)!==Di.p7.None,o=(e&Di.SJ.All)!==Di.SJ.None,a=!n||(i&e)==(e&Di.p7.All),l=!o||(this.state&e)==(e&Di.SJ.All);if(a&&l)for(const e of s)e.visible=!0,e.transformation=t;else for(const e of s)e.visible=!1}}_ensureEngineResources(){if(null==this._engineResources){const e=this._engineLayer,t=[],n=new Set;this.renderObjects.forEach((({geometry:{material:e}})=>{n.has(e)||(t.push(e),n.add(e))}));const i=new Map;this._renderObjects.forEach((e=>{const t=new ce.B({castShadow:!1,geometries:[e.geometry]}),n=i.get(e.stateMask)||[];n.push(t),i.set(e.stateMask,n)}));const r=[];i.forEach(((e,t)=>r.push({stateMask:t,objects:e}))),this._engineResources={objectsByState:r,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){const e=this._stage;if(this._engineResourcesAddedToStage||null==this._engineResources||!e)return;const{objectsByState:t,layer:n,materials:i}=this._engineResources;i.forEach((t=>{const n=this._materialIdReferences,i=n.get(t.id)||0;0===i&&e.add(t),n.set(t.id,i+1)})),t.forEach((({objects:t})=>{n.addMany(t),e.addMany(t)})),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(){const e=this._stage;if(!this._engineResourcesAddedToStage||null==this._engineResources||!e)return;const{objectsByState:t,layer:n,materials:i}=this._engineResources;t.forEach((({objects:t})=>{n.removeMany(t),e.removeMany(t)})),i.forEach((t=>{const n=this._materialIdReferences,i=n.get(t.id);1===i?(e.remove(t),n.delete(t.id)):n.set(t.id,i-1)})),this._engineResourcesAddedToStage=!1}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*("touch"===e?this.touchMultiplier:1)}_getFocusedSize(e,t){return e*(t?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){const t=this._getWorldToScreenObjectScale(),n=this._calculateObjectTransform(t,ki);return(0,h.s)(e,n[12],n[13],n[14])}_calculateModelTransformOffset(e){const t=this._calculateModelTransformPosition(e);return(0,h.f)(e,t,this.renderLocation)}_calculateObjectTransform(e,t){return(0,St.hZ)(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&(0,St.lw)(t,t,this._worldFrame),(0,St.lw)(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,null!=this._applyObjectTransform&&this._applyObjectTransform(t),t}get test(){}}function Fi(e){return 0!==e[12]||0!==e[13]||0!==e[14]}const zi=(0,m.gs)(),Vi=(0,J.vt)(),Hi=(0,ee.vt)(),Ui=(0,Ti.vt)(),ki=(0,wt.vt)(),ji=(0,wt.vt)(),Gi=(0,Mi.vt)(),Bi=(0,d.vt)(),$i=(0,d.vt)(),Zi=(0,d.vt)(),Wi=(0,d.vt)(),qi=(0,d.vt)(),Xi=(0,d.vt)(),Yi=new Li.default({x:0,y:0,z:0,spatialReference:null}),Ki=()=>{};var Qi,Ji,er,tr;(tr=Qi||(Qi={}))[tr.NONE=0]="NONE",tr[tr.ANY=1]="ANY",tr[tr.Z=2]="Z",tr[tr.XY=4]="XY",(er=Ji||(Ji={}))[er.TRANSLATE_Z=0]="TRANSLATE_Z",er[er.TRANSLATE_XY=1]="TRANSLATE_XY",er[er.SCALE=2]="SCALE",er[er.ROTATE=3]="ROTATE",er[er.SCALE_ROTATE=4]="SCALE_ROTATE";class nr{constructor(){this.grabbingState=Qi.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(e){this.grabbingState=Qi.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator(((e,t)=>{if(t===Ji.TRANSLATE_Z&&(this.zManipulator=e),e instanceof Ni&&(e.selected&&(0===this.numSelected&&(this.firstSelected=e),this.numSelected++),null==this.firstGrabbedXY&&e.grabbing&&t===Ji.TRANSLATE_XY&&(this.firstGrabbedXY=e)),e.grabbing)switch(this.grabbingState|=Qi.ANY,t){case Ji.TRANSLATE_Z:this.grabbingState|=Qi.Z;break;case Ji.TRANSLATE_XY:this.grabbingState|=Qi.XY}}))}}function ir(e,t){const{object:n,view:i}=e,r=[],o=n.elevationInfo,l="on-the-ground"===o.mode||!o.offset&&"absolute-height"!==o.mode,c=new nr,u=new gn({getTheme:()=>i.effectiveTheme}),d=u.visualElements,p=new Je({view:i,extensionType:d.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:Ye.m$.OccludeAndTransparent,isDecoration:!0}),f=(0,y.kU)(d.heightPlaneAngleCutoff),m=new Ze({view:i,attached:!1,angleCutoff:f,isDecoration:!0}),g=(0,vi.v)(1);r.push((0,a.watch)((()=>({lineShadowStyle:u.visualElements.lineObjects.shadowStyle,pointShadowStyle:u.visualElements.pointObjects.shadowStyle,alpha:g.value})),(({lineShadowStyle:e,pointShadowStyle:n,alpha:i})=>{e.apply(t,i),n.apply(p,i)}),a.Vh));const _=(0,vi.v)(1);r.push((0,a.watch)((()=>({heightPlane:u.visualElements.heightPlane,alpha:_.value})),(({heightPlane:e,alpha:t})=>e.apply(m,t)),a.Vh));const v=()=>{c.update(e);const i=ui(n);if(!n.visible||l&&(n.isDraped||!rr(i)||!i.hasZ))return t.laserlineEnabled=!1,p.attached=!1,void(m.attached=!1);t.laserlineEnabled=!0;const r=c.grabbingState&Qi.XY?d.laserlineAlphaMultiplier:1;g.value=r;const s=c.grabbingState&Qi.Z?d.laserlineAlphaMultiplier:1;_.value=s,function(e,t){const n=1===t.numSelected?t.firstSelected:t.numSelected>1&&null!=t.firstGrabbedXY?t.firstGrabbedXY:null;null!=n?(e.setStartEndFromWorldDownAtLocation(n.renderLocation),e.attached=!0):e.attached=!1}(p,c),function(e,t,n,i){if(i.numSelected>0){(0,h.s)(sr,0,0,0);let t=0;e.forEachManipulator(((e,n)=>{n===Ji.TRANSLATE_XY&&e.selected&&e instanceof Ni&&((0,h.g)(sr,sr,e.renderLocation),t++)})),t>0?(n.heightManifoldTarget=(0,h.j)(sr,sr,1/t),n.attached=!0):n.attached=!1}else{const i=t.attachmentOrigin;null!=i&&e.view.renderCoordsHelper.toRenderCoords(i,sr)?(n.heightManifoldTarget=sr,n.attached=!0):n.attached=!1}}(e,t,m,c)};r.push((0,a.watch)((()=>u.visualElements.zVerticalLine),(e=>e.apply(p)),a.Vh)),r.push(n.on("committed",v),(0,a.watch)((()=>n.visible),v),t.events.on("attachment-origin-changed",v),(0,s.DQ)(p),(0,s.DQ)(m));const b=[],T=()=>{(0,s.a0)(b),b.length=0,e.forEachManipulator((e=>b.push(e.events.on("grab-changed",v)))),e.forEachManipulator((e=>b.push(e.events.on("select-changed",v)))),v()};return T(),r.push(e.onManipulatorsChanged(T),(0,s.a2)((()=>(0,s.vE)(b)))),(0,s.vE)(r)}function rr(e){return null!=e&&("polygon"===e.type||"polyline"===e.type)}const sr=(0,d.vt)();var or=n(56763);function ar(e){const t=[],n=function(e,t){const{view:n,object:i}=e,r=new It({view:n,geometry:lr(ui(i)),elevationInfo:i.elevationInfo,isDecoration:!0});return function(e,t,n){const{view:i,object:r}=e,o=new gn({getTheme:()=>i.effectiveTheme});(function(e,t,n){const{view:i,object:r}=e;let o=null;const a=()=>{const e=lr(ui(r));null!=e&&(0,p.x)(r.elevationInfo)&&(e.z=0),(e=>{null!=o&&(o.remove(),o=null),r.isDraped&&null!=e&&(o=function(e,t,n){const i=e.elevationProvider.spatialReference;(0,or.g)(t,cr,i);const r=cr[0],s=cr[1];return e.elevationProvider.on("elevation-change",(e=>{(0,Ai.Rj)(e.extent,r,s)&&n()}))}(i,e,(()=>{t.geometry=e})))})(e),t.geometry=e};n.push(r.on("committed",a),(0,s.a2)((()=>o))),a()})(e,t,n),o.visualElements.pointObjects.outline.apply(t),n.push((0,a.watch)((()=>r.visible),(()=>{t.attached=r.visible}),a.Vh))}(e,r,t),t.push((0,s.DQ)(r)),r}(e,t);return function(e,t,n){const{view:i,object:r}=e,o=new gn({getTheme:()=>i.effectiveTheme}),l=new Je({view:i,extensionType:o.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:Ye.m$.OccludeAndTransparent,isDecoration:!0});t.push((0,a.watch)((()=>o.visualElements.zVerticalLine),(e=>e.apply(l)),a.Vh));const c=new Ze({view:i,intersectsLineInfinite:!0,attached:!1,isDecoration:!0}),u=(0,y.kU)(o.visualElements.heightPlaneAngleCutoff),d=new Ze({view:i,attached:!1,angleCutoff:u,isDecoration:!0}),f=r.elevationInfo,m=Ot.F.fromElevationInfo(f),g="on-the-ground"===f.mode||!f.offset&&"absolute-height"!==f.mode,_=new nr,v=(0,vi.v)(1);t.push((0,a.watch)((()=>({heightPlane:o.visualElements.heightPlane,alpha:v.value})),(({heightPlane:e,alpha:t})=>e.apply(d,t)),a.Vh));const b=(0,vi.v)(1);t.push((0,a.watch)((()=>({shadowStyle:o.visualElements.pointObjects.shadowStyle,alpha:b.value})),(({shadowStyle:e,alpha:t})=>e.apply(c,t)),a.Vh));const T=()=>{_.update(e);let t=lr(ui(r));const s=g&&(r.isDraped||null==t||!t.hasZ);let a=!0;if(s||null==t)a=!1;else{(0,p.x)(r.elevationInfo)&&(t=t.clone(),t.z=0);const e=(0,Mt.nG)(t,i.elevationProvider,m,i.renderCoordsHelper);(0,h.s)(cr,t.x,t.y,e),(0,q.F)(cr,t.spatialReference,cr,i.renderCoordsHelper.spatialReference),l.setStartEndFromWorldDownAtLocation(cr),c.intersectsWorldUpAtLocation=cr}const u=_.grabbingState&Qi.Z?o.visualElements.laserlineAlphaMultiplier:1;v.value=u;const f=(0,xt.Ie)(ur);!s&&r.visible&&n.calculateMapBounds(f)&&(0,q.F)((0,xt.pg)(f,cr),i.spatialReference,cr,i.renderCoordsHelper.spatialReference)?(d.heightManifoldTarget=cr,d.attached=!0):d.attached=!1;const y=_.grabbingState&Qi.XY?o.visualElements.laserlineAlphaMultiplier:1;b.value=y;const T=a&&r.visible&&!s;c.attached=T,l.attached=T};t.push((0,a.watch)((()=>[r.visible,r.isDraped]),T),r.on("committed",T)),e.forEachManipulator((e=>{t.push(e.events.on("grab-changed",T))})),t.push((0,s.DQ)(c)),t.push((0,s.DQ)(l)),t.push((0,s.DQ)(d)),T()}(e,t,n),{visualElement:n,remove:()=>(0,s.a0)(t)}}function lr(e){return null==e?null:"point"===e.type?e:"mesh"===e.type?e.anchor.clone():null}const cr=(0,d.vt)(),ur=(0,xt.vt)();function hr(e){switch(ui(e.object)?.type){case"point":case"mesh":return ar(e);case"polygon":case"polyline":return function(e){const{object:t}=e,n=function(e){const{view:t,object:n}=e,i=ui(n),r=new Tn({view:t,geometry:rr(i)?i:null,elevationInfo:n.elevationInfo,attached:!1,isDecoration:!0}),o=new gn({getTheme:()=>t.effectiveTheme}),l=()=>{r.attached=n.visible},c=(0,s.vE)([(0,a.watch)((()=>o.visualElements.lineObjects.outline),(e=>e.apply(r)),a.Vh),(0,a.watch)((()=>o.visualElements.lineObjects.shadowStyle),(e=>e.apply(r)),a.Vh),(0,a.watch)((()=>n.visible),l),(0,a.watch)((()=>n.isDraped),(e=>{r.isDraped=e}),a.Vh),n.on("committed",(()=>{const e=ui(n);r.geometry=rr(e)?e:null})),(0,s.DQ)(r)]);return l(),{visualElement:r,remove:()=>c.remove()}}(e),i=[n,ir(e,n.visualElement)];return t.maskOccludee&&i.push(t.maskOccludee()),{visualElement:n.visualElement,remove:()=>(0,s.a0)(i)}}(e);default:return null}}const dr=70,pr=Math.ceil(dr/3*2),fr=5*Math.PI/12,mr=1*Math.PI/3;var gr=n(14606);class _r{constructor(){this._available=!0}set location(e){this._forEachManipulator3D((t=>t.location=e))}set elevationAlignedLocation(e){this._forEachManipulator3D((t=>t.elevationAlignedLocation=e))}set elevationInfo(e){this._forEachManipulator3D((t=>t.elevationInfo=e))}get renderLocation(){let e;return this._forEachManipulator3D((t=>{e||(e=t.renderLocation)})),e}get available(){return this._available}set available(e){this._available=e,this._forEachManipulator3D((t=>t.available=e))}get hovering(){return this.someManipulator((e=>e.hovering))}get grabbing(){return this.someManipulator((e=>e.grabbing))}get dragging(){return this.someManipulator((e=>e.dragging))}get selected(){return this.someManipulator((e=>e.selected))}hasManipulator(e){return this.someManipulator((t=>t===e))}someManipulator(e){let t=!1;return this.forEachManipulator((n=>{!t&&e(n)&&(t=!0)})),t}_forEachManipulator3D(e){this.forEachManipulator(((t,n)=>{t instanceof Ni&&e(t,n)}))}}class vr{constructor(e,t=Di.p7.None){this.geometry=e,this.stateMask=t}}var yr,br=n(29531),Tr=(n(49845),n(38177),n(22323),n(2831));function Er(e,t){return xr(e,(()=>t))}function xr(e,t){const n=(0,d.vt)(),i=(0,d.vt)();let r=!1;return s=>{const o=t(s);if("start"===s.action){const t=(0,m.WA)(s.screenStart,(0,m.PR)(A.oG.get())),i=Ii(e.state.camera,t,Rr);null!=i&&(r=(0,Mi.Ui)(o,i,n))}if(!r)return null;const a=(0,m.WA)(s.screenEnd,(0,m.PR)(A.oG.get())),l=Ii(e.state.camera,a,Rr);return null==l?null:(0,Mi.Ui)(o,l,i)?{...s,renderStart:n,renderEnd:i,plane:o,ray:l}:null}}function Sr(e,t,n,i=null,r=null){return function(e,t,n=0,i=null,r=null){let s=null;return o=>{if("start"===o.action&&(s=e.sceneIntersectionHelper.intersectElevationFromScreen((0,m.gs)(o.screenStart.x,o.screenStart.y),t,n,r),null!=s&&null!=i&&!(0,xi.projectPoint)(s,s,i)))return null;if(null==s)return null;const a=e.sceneIntersectionHelper.intersectElevationFromScreen((0,m.gs)(o.screenEnd.x,o.screenEnd.y),t,n,r);return null==a||null!=i&&!(0,xi.projectPoint)(a,a,i)?null:{...o,mapStart:s,mapEnd:a}}}(e,n,(0,p.id)(t,e,n),i,r)}function wr(e,t,n){let i=null;const r=new Tr.rh;return r.next(Er(e,function(e,t){const n=Mr,i=Or,r=(0,Mi.vt)();e.renderCoordsHelper.worldUpAtPosition(t,n);const s=(0,h.b)((0,Mi.Qj)(r),n,(0,h.f)(i,t,e.state.camera.eye));return(0,h.b)(s,s,n),(0,Mi.O_)(t,s,r)}(e,t))).next(function(e,t){const n=(0,d.vt)(),i=(0,h.l)(t);e.renderCoordsHelper.worldUpAtPosition(t,n);const r=(0,d.vt)(),s=(0,d.vt)(),o=r=>((0,h.f)(r,r,t),(0,br._I)(n,r,r),"global"===e.viewingMode&&(0,h.l)(r)*Math.sign((0,h.m)(n,r))<.001-i&&(0,h.f)(r,(0,h.j)(r,n,.001),t),(0,h.g)(r,r,t),r);return e=>(e.renderStart=o((0,h.c)(r,e.renderStart)),e.renderEnd=o((0,h.c)(s,e.renderEnd)),e)}(e,t)).next(Ar(e,n)).next((e=>{e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,i=e})),e=>(i=null,r.execute(e),i)}function Ar(e,t){const n=e.renderCoordsHelper;return e=>{const i=n.fromRenderCoords(e.renderStart,new Li.default({spatialReference:t})),r=n.fromRenderCoords(e.renderEnd,new Li.default({spatialReference:t}));return null!=i&&null!=r?{...e,mapStart:i,mapEnd:r}:null}}!function(e){e[e.GROUND=0]="GROUND",e[e.OTHER=1]="OTHER"}(yr||(yr={}));const Mr=(0,d.vt)(),Or=(0,d.vt)(),Rr=(0,ee.vt)();function Cr(e,t,n){const i=(n,i)=>{t({action:n,object:e,dxScreen:i.screenDeltaX,dyScreen:i.screenDeltaY})};return n(((t,n,r)=>(n.next((e=>("start"===e.action&&i("start",e),e))).next((0,Tr.Wp)(e)).next((e=>{switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&i("update",e);break;case"end":i("end",e)}return e})),{steps:n,cancel:r=r.next((0,Tr.dp)(e)).next((e=>(i("end",{screenDeltaX:0,screenDeltaY:0}),e)))})))}function Ir(e){if(null==e?.axis)return 1;const{mapStart:t,mapEnd:n,axis:i}=e,r=[n.x-t.x,n.y-t.y];return r[0]*i[0]+r[1]*i[1]>0?1:-1}class Pr extends _r{constructor(e){super(),this._handles=new gr.A,this._arrowManipulatorInfos=new Array,this._angle=0,this._scale=1,this._radius=dr,this._updateAfterDrag=!1,this.events=new _n.A,this._tool=e.tool,this._view=e.view,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),null!=e.radius&&(this._radius=e.radius),this._createManipulators(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}set orthogonalAvailable(e){this._arrowManipulatorInfos.length>=3&&(this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e)}destroy(){this._handles=(0,o.pR)(this._handles),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(e){for(const{manipulator:t}of this._arrowManipulatorInfos)e(t,Ji.TRANSLATE_XY)}createManipulatedObjectDragPipeline(e,t,n){if(!t.operations)return(0,s.hA)();const i=t.operations.data.spatialReference,r=t.graphic;return Cr(t,n,(n=>this.createDragPipeline(((t,i,r,s,o)=>(({steps:i,cancel:r}=e(t,i,r,s,o)),n(t,i,r))),t.elevationInfo,i,r)))}createDragPipeline(e,t,n,i){return(0,s.vE)(this._arrowManipulatorInfos.map((({manipulator:r},s)=>(0,Tr.Xt)(r,((r,o,a,l,c)=>{const u=o.next((e=>({...e,manipulatorType:Ji.TRANSLATE_XY}))).next((0,Tr.Tp)(this._view,r.elevationAlignedLocation)).next(Sr(this._view,r.elevationAlignedLocation,t,n,i)).next((0,Tr.an)(r.location,this.angle+(s+1)*Math.PI*.5)).next((0,Tr.sO)());e(r,u,a,l,c)})))))}get angle(){return this._angle}set angle(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}_updateManipulators(){for(let e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:e,transform:t},n){const i=this._radius/dr,r=54*i,s=r*Math.sqrt(3)/2,o=(0,Xe._B)(this._opaqueMaterial,s,r/2,r/2,.02);(0,Xe.xh)(o,(0,St.kN)(A.Rc.get(),(0,h.s)(A.rq.get(),0,-s/3,0))),e.renderObjects=[new vr(o,Di.p7.Focused),new vr(o.instantiate({material:this._transparentMaterial}),Di.p7.Unfocused)],e.radius=s/3*2*1.2;const a=(0,St.N9)(A.Rc.get(),n*Math.PI/2),l=(0,St.kN)(A.Rc.get(),(0,h.s)(A.rq.get(),0,100*i,0));(0,St.lw)(t,a,l)}_createManipulators(){for(let e=0;e<4;e++){const t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const e=this.angle,t=(0,St.$0)(A.Rc.get(),e,(0,d.fA)(0,0,1));if(null==t)return;const n=(0,St.CV)(A.Rc.get(),(0,h.s)(A.rq.get(),this.displayScale,this.displayScale,this.displayScale)),i=(0,St.lw)(A.Rc.get(),n,t);for(const e of this._arrowManipulatorInfos){const t=(0,St.lw)(A.Rc.get(),i,e.transform);e.manipulator.modelTransform=t}}_createArrowManipulator(e){const t=new Ni({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,d.fA)(0,0,1)}}),n={manipulator:t,transform:(0,wt.vt)()};return this._updateArrowManipulator(n,e),this._handles.add(t.events.on("drag",(e=>{this._updateAfterDrag&&"end"===e.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)}))),n}_createMaterial(e=1){const t=new zt.v({cullFace:wn.s2.Back,renderOccluded:Ye.m$.Transparent,isDecoration:!0});return this._handles.add((0,a.watch)((()=>g.A.toUnitRGBA(this._view.effectiveTheme.accentColor)),(n=>{n[3]*=e,t.setParameters({color:n})}),a.Vh)),t}get test(){}}class Dr{constructor(){this._view=null,this._elevationInfo=null,this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&null!=this._lastDragEvent&&null!=this._next){const t=this._lastDragEvent.mapEnd,n=this._snap(this._lastDragEvent.screenEnd);if(null!=n){const i={action:"update",mapStart:this._lastDragEvent.mapStart,mapEnd:!0===e?n:t,screenStart:this._lastDragEvent.screenEnd,screenEnd:this._lastDragEvent.screenEnd};this._next.execute(i)}}this._enabled=e}_snap(e){const t=null!=this._view?this._view.toMap(e,{exclude:[]}):null;return null!=t&&null!=this._view&&(t.z=(0,p.id)(t,this._view,this._elevationInfo)),t}createDragEventPipelineStep(e,t){this._view=e,this._elevationInfo=t,this._lastDragEvent=null;const n=new Tr.rh;return this._next=n,[e=>{if(this._lastDragEvent="end"!==e.action?{...e}:null,this._enabled){const t=this._snap(e.screenEnd);return null!=t?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}},n]}}class Lr extends _r{constructor(e){super(),this._handles=new gr.A,this._snapToScene=new Dr,this._scale=1,this._radius=dr,this._view=e.view,this._tool=e.tool,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),null!=e.snapToScene&&(this.snapToScene=e.snapToScene),null!=e.radius&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles=(0,o.pR)(this._handles),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){e(this._manipulator,Ji.TRANSLATE_XY)}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(e){this._snapToScene.enabled=e}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}get discManipulator(){return this._manipulator}createManipulatedObjectDragPipeline(e,t,n){if(!t.operations)return(0,s.hA)();const i=t.graphic,r=t.elevationInfo,o=t.operations.data.spatialReference;return Cr(t,n,(t=>this.createDragPipeline(((n,i,r,s,o)=>(({steps:i,cancel:r}=e(n,i,r,s,o)),t(n,i,r))),r,o,i)))}createDragPipeline(e,t,n,i){const r=this._view;return(0,Tr.Xt)(this._manipulator,((s,o,a,l,c)=>{const u=o.next((0,Tr.Tp)(r,s.elevationAlignedLocation)).next(Sr(r,s.elevationAlignedLocation,t,n,i)).next(...this._snapToScene.createDragEventPipelineStep(r,t)).next((e=>({...e,manipulatorType:Ji.TRANSLATE_XY}))).next((0,Tr.sO)());e(s,u,a,l,c)}))}_updateManipulatorTransform(){const e=(0,St.CV)(A.Rc.get(),(0,h.s)(A.rq.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}_createManipulator(){const e=this._view;this._manipulator=new Ni({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,d.fA)(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const e=(0,Xe.nW)(this._discMaterial,.02,1,128,(0,d.fA)(0,0,1),(0,d.fA)(0,0,0));e.transformation=(0,St.CV)((0,wt.vt)(),(0,d.fA)(this._radius,this._radius,this._radius)),this._manipulator.renderObjects=[new vr(e,Di.p7.Focused),new vr(e.instantiate({material:this._discMaterialTransparent}),Di.p7.Unfocused)],this._manipulator.radius=this._radius/dr*80}_createMaterial(e=1){const t=new zt.v({cullFace:wn.s2.Back,renderOccluded:Ye.m$.Transparent,isDecoration:!0});return this._handles.add((0,a.watch)((()=>g.A.toUnitRGBA(this._view.effectiveTheme.accentColor)),(n=>{n[3]*=e,t.setParameters({color:n})}),a.Vh)),t}get test(){}}var Nr=n(75302);function Fr(e,t=Ye.m$.OccludeAndTransparent,n=!0){const i=(0,r.pf)(e),s=!(e[3]<1);return n?new Hn({color:i,writeDepth:s,cullFace:wn.s2.Back,renderOccluded:t,isDecoration:!0}):new zt.v({color:i,writeDepth:s,cullFace:wn.s2.Back,renderOccluded:t,isDecoration:!0})}function zr(e,t=Ye.m$.OccludeAndTransparent){const n=(0,r.pf)(e);return new zt.v({color:n,writeDepth:!0,cullFace:wn.s2.Front,renderOccluded:t,isDecoration:!0})}const Vr=Object.freeze({calloutLength:40,calloutWidth:1,discRadius:27,focusMultiplier:1.1}),Hr=Object.freeze({autoScaleRenderObjects:!1,worldSized:!0});function Ur(e,t,n,i){const r=(0,h.f)(A.rq.get(),e,n),s=kr(r,(0,h.b)(A.rq.get(),i,r),n,A.Rc.get());(0,St.B8)(s,s);const o=(0,h.h)(A.rq.get(),t,s);return Math.atan2(o[1],o[0])}function kr(e,t,n,i){const r=(0,h.n)(A.rq.get(),e),s=(0,h.n)(A.rq.get(),t),o=(0,h.b)(A.rq.get(),r,s);return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=0,i[4]=s[0],i[5]=s[1],i[6]=s[2],i[7]=0,i[8]=o[0],i[9]=o[1],i[10]=o[2],i[11]=0,i[12]=n[0],i[13]=n[1],i[14]=n[2],i[15]=1,i}function jr(e,t){const n=t.origin;null==n?function(e,t){if(null==t)return;const n="mesh"===t.type?t.anchor:(0,Nr.W$)(t);null!=n&&(e.location=(0,Oi.wZ)(n))}(e,ui(t)):e.elevationAlignedLocation=n}class Gr extends _r{constructor(e){super(),this._radius=dr,this.events=new _n.A,this._tool=e.tool,this._view=e.view;const t=new gn({getTheme:()=>this._view.effectiveTheme});this._settings=t,null!=e.radius&&(this._radius=e.radius);const n=this._view.effectiveTheme.accentColor;this._materials={materialUnfocused:Fr(Br(n,1,.25),Ye.m$.Occlude),materialFocused:Fr(Br(n,1,0),Ye.m$.Occlude),materialOccludedUnfocused:Fr(Br(n,.7,0),t.zManipulator.renderOccluded),materialOccludedFocused:Fr(Br(n,.85,0),t.zManipulator.renderOccluded)},this._themeHandle=(0,a.watch)((()=>this._view.effectiveTheme.accentColor),(e=>{const t=Br(e,1,.25),n=Br(e,1,0),i=Br(e,.7,0),r=Br(e,.85,0),{materialUnfocused:s,materialFocused:o,materialOccludedUnfocused:a,materialOccludedFocused:l}=this._materials;s.setParameters({color:t}),o.setParameters({color:n}),a.setParameters({color:i}),l.setParameters({color:r})})),this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._themeHandle=(0,o.xt)(this._themeHandle),this._manipulator.applyObjectTransform=qr,this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()}))}forEachManipulator(e){e(this._manipulator,Ji.TRANSLATE_Z)}createManipulatedObjectDragPipeline(e,t,n){if(!t.operations)return(0,s.hA)();const i=t.operations.data.spatialReference;return Cr(t,n,(t=>this.createDragPipeline(((n,i,r,s,o)=>(({steps:i,cancel:r}=e(n,i,r,s,o)),t(n,i,r))),i)))}createDragPipeline(e,t){const n=this._view;return(0,Tr.Xt)(this._manipulator,((i,r,s,o,a)=>{const l=r.next((e=>({...e,manipulatorType:Ji.TRANSLATE_Z}))).next(wr(n,i.renderLocation,t)).next((0,Tr.sO)());e(i,l,s,o,a)}))}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}_updateManipulator(){const e=this._settings,t=this._radius/dr,n=e.zManipulator.height*t,i=e.zManipulator.coneHeight*t,r=e.zManipulator.coneWidth*t,s=e.zManipulator.width*t,o=[(0,d.fA)(0,0,0),(0,d.fA)(0,0,n)],a=[(0,d.fA)(0,0,0),(0,d.fA)(0,0,n+i)],l=(e=>{const t=(0,wt.vt)();return(0,St.Tl)(t,t,[0,0,n]),(0,St.eL)(t,t,Math.PI/2),t})(),{materialUnfocused:c,materialFocused:u,materialOccludedUnfocused:h,materialOccludedFocused:p}=this._materials,f=(0,Xe.Nb)(c,o,s/2,16,!1),m=(0,Xe.EE)(c,i,r/2,16,!1);m.transformation=l,this._manipulator.renderObjects=[new vr(m,Di.p7.Unfocused),new vr(f,Di.p7.Unfocused),new vr(m.instantiate({material:u}),Di.p7.Focused),new vr(f.instantiate({material:u}),Di.p7.Focused),new vr(m.instantiate({material:h}),Di.p7.Unfocused),new vr(f.instantiate({material:h}),Di.p7.Unfocused),new vr(m.instantiate({material:p}),Di.p7.Focused),new vr(f.instantiate({material:p}),Di.p7.Focused)],this._manipulator.radius=s/2+2,this._manipulator.collisionType={type:"line",paths:[a]}}_createManipulator(){const e=this._view,t=new Ni({view:e,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=t=>{const n=e.state.camera,i=$r;e.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,i);const r=(0,h.F)(n.eye,i),s=n.computeRenderPixelSizeAtDist(r),o=(0,h.f)(Zr,i,n.eye);(0,h.n)(o,o);const a=Wr;e.renderCoordsHelper.worldUpAtPosition($r,a);const l=Math.abs((0,h.m)(o,a)),c=(0,h.b)(Zr,o,a),u=(0,h.b)(Zr,c,a),d=(0,y.qE)(l,.01,1),p=1-Math.sqrt(1-d*d)/d/n.fullWidth,f=this._settings,m=this._radius/dr,g=f.zManipulator.width*m;(0,h.j)(u,(0,h.n)(u,u),(1/p-1)*r+s*g),t[12]-=Zr[0],t[13]-=Zr[1],t[14]-=Zr[2]},this._manipulator=t,this._updateManipulator()}get test(){}}function Br(e,t,n){const i=(0,r.e$)(e,n);return i.a*=t,g.A.toUnitRGBA(i)}const $r=(0,d.vt)(),Zr=(0,d.vt)(),Wr=(0,d.vt)(),qr=()=>{};class Xr extends _r{constructor(e){super(),this._handles=new gr.A,this._interactive=!0;const{tool:t,view:n,snapToScene:i,radius:r}=e;this._view=n,this.xyManipulation=new Lr({tool:t,view:n,snapToScene:i,radius:r}),this.xyAxisManipulation=new Pr({tool:t,view:n,radius:r}),this.zManipulation=new Gr({tool:t,view:n,radius:r}),this.xyManipulation.available=e.xyAvailable,this.xyAxisManipulation.available=e.xyAxisAvailable,this.zManipulation.available=e.zAvailable,this._autoHideXYAxis(),this.forEachManipulator((e=>this._handles.add(e.events.on("grab-changed",(()=>this._updateManipulatorInteractivity())))))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createManipulatedObjectDragPipeline(e,t,n){return(0,s.vE)([this.xyManipulation.createManipulatedObjectDragPipeline(((t,n,i,r,s)=>e(Kr.XY,t,n,i,r,s)),t,n),this.xyAxisManipulation.createManipulatedObjectDragPipeline(((t,n,i,r,s)=>e(Kr.XY_AXIS,t,n,i,r,s)),t,n),this.zManipulation.createManipulatedObjectDragPipeline(((t,n,i,r,s)=>e(Kr.Z,t,n,i,r,s)),t,n)])}createDragPipeline(e,t,n,i){return(0,s.vE)([this.xyManipulation.createDragPipeline(((t,n,i,r,s)=>e(Kr.XY,t,n,i,r,s)),t,n,i),this.xyAxisManipulation.createDragPipeline(((t,n,i,r,s)=>e(Kr.XY_AXIS,t,n,i,r,s)),t,n,i),this.zManipulation.createDragPipeline(((t,n,i,r,s)=>e(Kr.Z,t,n,i,r,s)),n)])}set snapToScene(e){this.xyManipulation.snapToScene=e}set angle(e){this.xyAxisManipulation.angle=e}set interactive(e){this._interactive!==e&&(this._interactive=e,this._updateManipulatorInteractivity())}set radius(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}set displayScale(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}forEachManipulator(e){this.xyManipulation.forEachManipulator((t=>e(t,Ji.TRANSLATE_XY))),this.xyAxisManipulation.forEachManipulator((t=>e(t,Ji.TRANSLATE_XY))),this.zManipulation.forEachManipulator((t=>e(t,Ji.TRANSLATE_Z)))}get _xyAxisVisible(){const e=this.xyManipulation.someManipulator((e=>e.focused))||this.xyAxisManipulation.someManipulator((e=>e.focused));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e}_autoHideXYAxis(){const e=this.xyAxisManipulation,t=this.xyManipulation;if((0,c.A)("esri-mobile"))return;const n=[];t.forEachManipulator((e=>n.push(e))),e.forEachManipulator((e=>n.push(e)));const i=()=>{const t=[];this._xyAxisVisible||e.forEachManipulator((e=>t.push(e.disableDisplay()))),this._handles.remove(Yr),this._handles.add(t,Yr)};for(const e of n)this._handles.add(e.events.on("focus-changed",i));this._view.inputManager&&this._handles.add((0,a.when)((()=>this._view.inputManager?.latestPointerType),i)),i()}_updateManipulatorInteractivity(){const e=this.grabbing;this.forEachManipulator((t=>{t.interactive=!e&&this._interactive||t.grabbing}))}static radiusForSymbol(e){const t=null!=e&&"point-3d"===e.type&&e.symbolLayers;return t&&t.some((e=>"icon"===e.type))?pr:dr}}const Yr="disable-xy-axis-display";var Kr,Qr;(Qr=Kr||(Kr={}))[Qr.XY=0]="XY",Qr[Qr.XY_AXIS=1]="XY_AXIS",Qr[Qr.Z=2]="Z";class Jr extends _r{constructor(e){super(),this._view=e.view,this._tool=e.tool,this._object=e.object,this._manipulator=this._object.createManipulator?.({selectable:!0,cursor:"move"}),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){this._manipulator&&e(this._manipulator,Ji.TRANSLATE_XY)}createManipulatedObjectDragPipeline(e){return Cr(this._object,e,(e=>this.createDragPipeline(e)))}createDragPipeline(e){if(!this._manipulator)return(0,s.hA)();const t=this._view;return(0,Tr.Xt)(this._manipulator,((n,i,r,s,o)=>{const a=this._object.operations?.data.spatialReference,l=i.next((e=>a?e:null)).next(function(e,t,n,i){const r=n.toMap(e.screenStart);return null!=r?Sr(t,r,n.elevationInfo,i):null}(o,t,this._object,a)).next((0,Tr.EX)()).next((0,Tr.sO)());e(n,l,r,s,o)}))}}var es=n(87982),ts=n(83202),ns=n(7819),is=n(37102),rs=n(58144),ss=n(45908),os=n(30329),as=n(18945),ls=n(94492),cs=n(90858);let us=class extends cs.w{constructor(e){super(e),this.type="translate-xy",this.distance=si.r7}};(0,i._)([(0,l.MZ)()],us.prototype,"type",void 0),(0,i._)([(0,l.MZ)()],us.prototype,"distance",void 0),us=(0,i._)([(0,u.$)("esri.views.interactive.tooltip.infos.TranslateXYTooltipInfo")],us);let hs=class extends cs.w{constructor(e){super(e),this.type="translate-z",this.distance=si.r7}clear(){this.distance=si.r7}};(0,i._)([(0,l.MZ)()],hs.prototype,"type",void 0),(0,i._)([(0,l.MZ)()],hs.prototype,"distance",void 0),hs=(0,i._)([(0,u.$)("esri.views.interactive.tooltip.infos.TranslateZTooltipInfo")],hs);class ds{constructor(e){this.objects=e,this.type="move-start"}}class ps{constructor(e,t,n){this.dx=e,this.dy=t,this.objects=n,this.type="move"}}class fs{constructor(e){this.objects=e,this.type="move-stop"}}const ms=Symbol("manipulators"),gs=Symbol("tooltips");let _s=class extends ts.g{constructor(e){super(e),this._infos=new Map,this.events=new _n.A,this.objects=new ri.A,this.enableZ=!0,this.sketchOptions=new is.A,this.type="move-3d",this._latestTooltipInfo=null,this._translateTooltipInfo=null,this._translateXYTooltipInfo=null,this._translateZTooltipInfo=null,this._updatingHandles=new oi.U,this._moveManipulation=null}initialize(){const{view:e}=this;this.tooltip=new os.m({view:e}),this.addHandles([this.objects.on("change",(e=>{e.removed.forEach((e=>this.removeHandles(e))),this._updateObjectInfos(e),this._setupFastTransformUpdates(e.added),this._refreshManipulators()})),this.objects.on("change",(()=>this._connectTooltips()))]);const t=this.objects.toArray();this._updateObjectInfos({added:t,removed:[]}),this._setupFastTransformUpdates(t),this._refreshManipulators(),this._connectTooltips(),this.finishToolCreation()}destroy(){this.tooltip=(0,o.pR)(this.tooltip),this._moveManipulation=(0,o.pR)(this._moveManipulation),this._set("view",null),this._updatingHandles.destroy()}onInputEvent(e){if(!this.destroyed&&!(0,Qn.wG)(e,this.tooltip))return super.onInputEvent(e)}get updating(){return this._updatingHandles.updating}get _shouldShowMovePointTooltip(){const{objects:e}=this;if(1!==e.length)return!1;const t=ui(e.at(0))?.type;return"point"===t||"mesh"===t}get activeTooltipInfo(){return this._shouldShowMovePointTooltip?this._movePointTooltipInfo:this._latestTooltipInfo}reset(){}_updateObjectInfos({added:e,removed:t}){for(const t of e){if((0,es.Y)(t)!==ci.d.SUPPORTED)continue;const e=new vs(t);this._infos.set(t,e)}for(const e of t)this._infos.delete(e)}_setupFastTransformUpdates(e){for(const t of e){const e=this._infos.get(t);this.addHandles(en(e.object),t)}}_refreshManipulators(){if(this.removeHandles(ms),this._moveManipulation=(0,o.pR)(this._moveManipulation),this.manipulators.removeAll(),0===this._infos.size)return;const e=Array.from(this._infos.values());this._createManipulators(e),this._createVisualElements(e),this._updateMoveManipulation(e)}_createManipulators(e){for(const t of e){const n=t.object;t.manipulationXY=new Jr({tool:this,view:this.view,object:n}),t.manipulationXY.forEachManipulator((e=>{this.addHandles([e.events.on("immediate-click",(e=>{this.events.emit("immediate-click",{...e,object:n}),e.stopPropagation()})),e.events.on("grab-changed",(({action:e})=>{"start"===e?this._showTooltip(Kr.XY):this._hideTooltip()}))],ms)})),this.addHandles(t.manipulationXY.createDragPipeline(((t,n,i,r)=>this._buildDragEventPipeline(e,Kr.XY,t,n,i,r))),ms)}this._createMoveManipulation(e)}_createMoveManipulation(e){const t=new Xr({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?Xr.radiusForSymbol(e[0].object.graphic?.symbol):dr});this._moveManipulation=t,t.elevationInfo={mode:"absolute-height",offset:0},t.forEachManipulator((e=>{this.addHandles(e.events.on("immediate-click",(n=>{const i=this.objects.at(0);!t.zManipulation.hasManipulator(e)&&1===this.objects.length&&i&&this.events.emit("immediate-click",{...n,object:i}),n.stopPropagation()})),ms)}));const n=e=>t=>{this.addHandles([t.events.on("focus-changed",(({action:t})=>{"focus"===t?this._showTooltip(e):this._hideTooltip()})),t.events.on("grab-changed",(()=>{this._latestTooltipInfo&&(this._latestTooltipInfo.distance=si.r7)}))],ms)};this._moveManipulation.xyManipulation.forEachManipulator(n(Kr.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(n(Kr.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(n(Kr.Z));const i=()=>this._updateMoveManipulation(e);for(const t of e)this.addHandles([t.object.on("committed",i),(0,a.watch)((()=>t.object.visible),i)],ms);const r=e[e.length-1];this.addHandles(r.object.on("committed",(()=>this._updateMoveManipulationAngle(r))),ms);const{object:s}=r,{operations:o}=s;if(o){const n=s.graphic;this.addHandles(t.createDragPipeline(((t,n,i,r,s)=>this._buildDragEventPipeline(e,t,n,i,r,s)),s.elevationInfo,o.data.spatialReference,n),ms)}this._updateMoveManipulationAngle(r)}_createVisualElements(e){for(const t of e){const n=t.object,i=hr({view:this.view,object:n,forEachManipulator:e=>{t.manipulationXY?.forEachManipulator(e),this._moveManipulation?.forEachManipulator(e)},onManipulatorsChanged:()=>(0,s.hA)()});null!=i&&(t.geometryRepresentation=i.visualElement,t.geometryRepresentation instanceof Tn&&this.addHandles([t.geometryRepresentation.events.on("attachment-origin-changed",(()=>{t.object.isDraped||this._updateMoveManipulation(e)})),(0,a.watch)((()=>t.object.isDraped),(()=>this._updateMoveManipulation(e)))],ms),this.addHandles(i,ms))}}_updateMoveManipulationAngle(e){this._moveManipulation&&(this._moveManipulation.angle=li(ui(e.object)))}_updateMoveManipulation(e){const t=(0,ct.T)(0,0,0,this.view.spatialReference);let n=0,i=!1;const r=this._moveManipulation;if(r){for(const r of e){if(!r.object.visible)continue;this.enableZ&&hi(r.object.operations,r.object.elevationInfo)&&(i=!0);const e=r.geometryRepresentation instanceof Tn&&!r.object.isDraped?r.geometryRepresentation.attachmentOrigin:r.object.origin;if(null!=e){const{x:i,y:r,z:s}=e;t.x+=i,t.y+=r,s&&(t.z??=0,t.z+=s),n++}}n>0?(t.x/=n,t.y/=n,t.z??=0,t.z/=n,r.location=t,r.xyManipulation.available=!0,r.xyAxisManipulation.available=!0,r.zManipulation.available=i):r.available=!1}}_buildDragEventPipeline(e,t,n,i,r,s){const o=[],a=[];let l=null,c=null;const u=()=>{for(const e of o)e.dragging=!1;o.length=0,a.length=0,l=null,c=null,this._moveManipulation&&(this._moveManipulation.interactive=!0)};if(1===e.length&&t===Kr.XY){const t=e[0].object;({steps:i,cancel:r}=this._buildSnappingPipelineSteps(t,t.elevationInfo,i,r,s))}return r=r.next((e=>c?.(e))).next((()=>(a.length&&this.events.emit("move-stop",new fs(a)),this.destroyed||u(),null))),{steps:i=i.next((t=>{if("start"===t.action){o.length=0,a.length=0;for(const t of e)t.dragging||!t.manipulationXY?.hasManipulator(n)&&t.manipulationXY?.grabbing||(o.push(t),a.push(t.object),t.dragging=!0);if(0!==a.length&&(this._moveManipulation&&(this._moveManipulation.interactive=!1),l=(0,Tr.bl)(a),c=(0,Tr.mc)(a),this._emitRecordUndo(),this.events.emit("move-start",new ds(a)),this.destroyed))return null}return 0!==a.length?t:null})).next((e=>l?.(e))).next((e=>(this._updateMoveTooltip(t,e),e))).next((e=>{switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){const t=this.view.toScreen(e.mapStart),n=this.view.toScreen(e.mapEnd),i=n.x-t.x,r=n.y-t.y;if(this.events.emit("move",new ps(i,r,a)),this.destroyed)return null}break;case"end":if(this.events.emit("move-stop",new fs(a)),this.destroyed)return null;u()}return null})),cancel:r}}_connectTooltips(){let e;if(this.removeHandles(gs),this._shouldShowMovePointTooltip){const t=this.objects.at(0),{events:n}=this;this._movePointTooltipInfo??=new as.F({viewType:this.view.type,sketchOptions:this.sketchOptions});const i={onMoveStart:()=>{this._emitRecordUndo(),n.emit("move-start",new ds([t]))},onMove:()=>n.emit("move",new ps(0,0,[t])),onMoveStop:()=>n.emit("move-stop",new fs([t]))};e=fi(this.tooltip,t,(()=>({sketchOptions:this.sketchOptions,activeTooltipInfo:this._movePointTooltipInfo,callbacks:i})))}else e=(0,a.watch)((()=>this.sketchOptions.tooltips.effectiveEnabled?this._latestTooltipInfo:null),(e=>{this.tooltip.info=e}),a.pc);this.addHandles(e,gs)}_showTooltip(e){this._shouldShowMovePointTooltip||this._updateMoveTooltip(e)}_hideTooltip(){this._shouldShowMovePointTooltip||(this.tooltip?.clear(),this._latestTooltipInfo=null)}_updateMoveTooltip(e,t){if(this._shouldShowMovePointTooltip)return;const{sketchOptions:n}=this;switch(e){case Kr.XY:this._latestTooltipInfo=this._translateTooltipInfo??=new ls.M({sketchOptions:n}),ys(this._latestTooltipInfo,t,((e,t)=>(0,N.Kt)(e,t)));break;case Kr.XY_AXIS:this._latestTooltipInfo=this._translateXYTooltipInfo??=new us({sketchOptions:n}),ys(this._latestTooltipInfo,t,((e,n)=>(0,si.hs)((0,N.Kt)(e,n),Ir(t))));break;case Kr.Z:this._latestTooltipInfo=this._translateZTooltipInfo??=new hs({sketchOptions:n}),ys(this._latestTooltipInfo,t,pi.e5)}this._latestTooltipInfo.sketchOptions=n}_emitRecordUndo(){const e=this.objects.toArray().map((e=>e.createUndoRecord?.())).filter(ii.Ru);e.length>0&&this.events.emit("record-undo",{updates:e})}_buildSnappingPipelineSteps(e,t,n,i,r){const s=ui(e);if(null==s||"point"!==s.type&&"mesh"!==s.type)return{steps:n,cancel:i};const o=("point"===s.type?s:s.anchor).clone(),a=new rs.e({elevationInfo:t,pointer:r,editGeometryOperations:ns.p.fromGeometry(o,this.view.state.viewingMode),visualizer:new qt,excludeFeature:e.graphic}),l=this.snappingManager,{snappingStep:c,cancelSnapping:u}=(0,ss.L)({snappingContext:a,snappingManager:l,updatingHandles:this._updatingHandles});return i=i.next(u),{steps:n=n.next((t=>(o.z=(0,p.wS)(this.view,o,e.elevationInfo,{mode:"absolute-height",offset:0}),{...t,snapOrigin:a.coordinateHelper.pointToVector(o)}))).next(...c),cancel:i}}};(0,i._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],_s.prototype,"view",void 0),(0,i._)([(0,l.MZ)()],_s.prototype,"objects",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],_s.prototype,"enableZ",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0,type:is.A})],_s.prototype,"sketchOptions",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],_s.prototype,"snappingManager",void 0),(0,i._)([(0,l.MZ)()],_s.prototype,"type",void 0),(0,i._)([(0,l.MZ)()],_s.prototype,"updating",null),(0,i._)([(0,l.MZ)()],_s.prototype,"_latestTooltipInfo",void 0),(0,i._)([(0,l.MZ)()],_s.prototype,"_shouldShowMovePointTooltip",null),(0,i._)([(0,l.MZ)()],_s.prototype,"activeTooltipInfo",null),_s=(0,i._)([(0,u.$)("esri.views.3d.interactive.editingTools.move.MoveTool3D")],_s);class vs{constructor(e){this.object=e,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1}}function ys(e,t,n){if(null==t||"end"===t.action)return void(e.distance=si.r7);const{mapStart:i,mapEnd:r}=t,s=n(i,r);e.distance=null!=s?s:si.r7}var bs=n(91508),Ts=n(89814),Es=n(63447);function xs(e,t,n){const i="on-the-ground"===n.mode?Es.B.XY:Es.B.XYZ;return new Es.L(e,i,t,0)}function Ss(e,t,n){const i=(0,d.vt)();if(!e.renderCoordsHelper.toRenderCoords(t,i))return null;const r=ws(e,t,(0,Mi.Qj)(n.plane)),s=ws(e,t,n.edgeDirection);if(null==r||null==s)return null;const o=(0,h.b)((0,d.vt)(),r,s);return(0,Mi.O_)(i,o,(0,Mi.vt)())}function ws(e,t,n){const i=(0,ct.T)(t.x+n[0],t.y+n[1],t.z+n[2],t.spatialReference),r=(0,d.vt)(),s=(0,d.vt)();return e.renderCoordsHelper.toRenderCoords(t,r)&&e.renderCoordsHelper.toRenderCoords(i,s)?(0,h.E)(s,r,s):null}let As=class extends cs.w{constructor(e){super(e),this.type="reshape-edge-offset",this.distance=si.r7,this.area=null,this.totalLength=null}};(0,i._)([(0,l.MZ)()],As.prototype,"type",void 0),(0,i._)([(0,l.MZ)()],As.prototype,"distance",void 0),(0,i._)([(0,l.MZ)()],As.prototype,"area",void 0),(0,i._)([(0,l.MZ)()],As.prototype,"totalLength",void 0),As=(0,i._)([(0,u.$)("esri.views.interactive.tooltip.infos.ReshapeEdgeOffsetTooltipInfo")],As);var Ms=n(83931),Os=n(70474),Rs=n(1428);function Cs(e,t,n){function i(){const e=n(),t=e.sketchOptions.tooltips.effectiveEnabled?e.activeTooltipInfo:null;return{...e,activeTooltipInfo:t}}let r=!1;function o(n){r=!0,function(e,{activeTooltipInfo:t,selectedVertexManipulatorInfo:n,sketchOptions:i}){if(t)switch(t.sketchOptions=i,t?.type){case"move-point":gi(t,e);break;case"selected-vertex":!function(e,t,n){if(!e||"selected-vertex"!==e.type)return;const i=t?.manipulator.location;e.setLocationFromPoint(i),_i(e,i,n);const r=n.operations?.data.geometry;switch(r?.type){case"polygon":e.geometryType="polygon",e.totalLength.visible=!1,e.area.actual=(0,Os.n)(r);break;case"polyline":e.geometryType="polyline",e.totalLength.actual=(0,N.ob)(r),e.area.visible=!1}}(t,n,e)}}(t,n),e.info=n.activeTooltipInfo,r=!1}return(0,s.vE)([(0,a.watch)(i,o,a.pc),(0,a.watch)((()=>{const e=i(),{activeTooltipInfo:n}=e;if(n&&"key"in n)return{context:e,activeTooltipInfo:n,key:n.key,geometry:ui(t)}}),((e,n)=>{e&&!r&&n&&n.key!==e.key&&function(e,t,{selectedVertexManipulatorInfo:n,callbacks:i}){const r=ui(t);switch(r?.type){case"mesh":"move-point"===e.type&&mi(e,r.origin,t,i);break;case"point":"move-point"===e.type&&mi(e,r,t,i);break;case"polyline":case"polygon":"selected-vertex"===e.type&&function(e,t,n,i){if("vertex"!==t?.type)return;const{dx:r,dy:s,dz:o}=(0,Qn.mu)(e,t.manipulator.location);0===r&&0===s&&0===o||(i.onReshapeStart?.(),n.operations?.moveVertices([t.handle],r,s,o,di.Y.NEW_STEP),i.onReshape?.(),i.onReshapeStop?.())}(e,n,t,i)}}(e.activeTooltipInfo,t,e.context)}),a.OH),t.on("committed",(()=>o(i()))),(0,Qn.sZ)(e)])}function Is(e,t,n){if(null!=t&&"end"!==t.action){const{mapStart:i,mapEnd:r}=t,s=n(i,r);e.distance=null!=s?s:si.r7}else e.distance=si.r7}var Ps=n(71168),Ds=n(57165);const Ls=Symbol();let Ns=class extends _.A{get grabbingOrDragging(){return this._numGrabbing+this._numDragging>0}get _operations(){return this.object.operations}constructor(e){super(e),this._selectedIndex=0,this._manipulatorHandles=new gr.A,this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=js.NONE,this._updatingHandles=new oi.U,this._recreatingManipulators=!1,this._settings=new gn({getTheme:()=>this.view.effectiveTheme}),this.events=new _n.A,this.activeTooltipInfo=null,this._vertexLaserLineVisualElement=null}initialize(){const{view:e}=this,t=this._settings.manipulators,n=t.vertex;this.tooltipInfos=function(e,t){const n=t?.type;return{edgeOffset:new As({sketchOptions:e,viewType:n}),movePoint:new as.F({sketchOptions:e,viewType:n}),selectedVertex:new Ms.d({sketchOptions:e,viewType:n}),translate:new ls.M({sketchOptions:e,viewType:n}),translateXY:new us({sketchOptions:e,viewType:n}),translateZ:new hs({sketchOptions:e,viewType:n})}}(this._sketchOptions,e),this._vertexManipulatorMaterial=Fr((0,r.QP)(n.color),n.renderOccluded),this._vertexManipulatorOutlineMaterial=zr((0,r.QP)(n.outlineColor),n.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=zr((0,r.QP)(n.hoverOutlineColor),n.renderOccluded);const i=t.edge;this._edgeManipulatorMaterial=Fr((0,r.QP)(i.color),i.renderOccluded),this._edgeManipulatorOutlineMaterial=zr((0,r.QP)(i.outlineColor),i.renderOccluded);const s=t.edgeOffset;this._edgeOffsetManipulatorMaterial=Fr((0,r.QP)(s.color),s.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=Fr((0,r.QP)(s.hoverColor),s.renderOccluded,!1);const o=t.selected;this._selectedManipulatorMaterial=Fr((0,r.QP)(o.color),o.renderOccluded),this._selectedManipulatorOutlineMaterial=zr((0,r.QP)(o.outlineColor),o.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=zr((0,r.QP)(o.hoverOutlineColor),o.renderOccluded),this.tooltip=new os.m({view:e}),this.addHandles([(0,a.watch)((()=>{const e=this._settings.manipulators;return{vertexSettings:e.vertex,edgeSettings:e.edge,edgeOffsetSettings:e.edgeOffset,selectedSettings:e.selected}}),(({vertexSettings:e,edgeSettings:t,edgeOffsetSettings:n,selectedSettings:i})=>{e.applyColor(this._vertexManipulatorMaterial),e.applyOutline(this._vertexManipulatorOutlineMaterial),e.applyHoverOutline(this._vertexManipulatorHoverOutlineMaterial),t.applyColor(this._edgeManipulatorMaterial),t.applyOutline(this._edgeManipulatorOutlineMaterial),n.applyColor(this._edgeOffsetManipulatorMaterial),n.applyHover(this._edgeOffsetManipulatorHoverMaterial),i.applyColor(this._selectedManipulatorMaterial),i.applyOutline(this._selectedManipulatorOutlineMaterial),i.applyHoverOutline(this._selectedManipulatorHoverOutlineMaterial)})),(0,a.watch)((()=>this.object.visible),(e=>{for(const t of this._manipulatorInfos)t.manipulator.available=e,"edge"===t.type&&"edgeManipulator"in t&&(t.edgeManipulator.available=e)})),(0,a.watch)((()=>this._numGrabbing+this._numDragging===0),(e=>this._toggleAutoHideManipulators(e))),(0,a.watch)((()=>({labels:this._segmentLabels,enabled:this._sketchOptions.labels.enabled,edgeOffsetEnabled:this.enableEdgeOffset})),(({labels:e,enabled:t,edgeOffsetEnabled:n})=>{null!=e&&(e.visible=t,e.edgeDistance=n?"far":"default")}),a.Vh),Cs(this.tooltip,this.object,(()=>this._tooltipsContext)),(0,a.on)((()=>this._operations),"vertex-update",(e=>{this._updateManipulatorPositions(e.vertices)}),{onListenerAdd:()=>this._recreateManipulators()}),(0,a.on)((()=>this._operations?.data),"change",(e=>{"undo"!==e.operation&&"redo"!==e.operation||this._recreateManipulators()}))])}destroy(){this._segmentLabels=(0,o.pR)(this._segmentLabels),this.tooltip=(0,o.pR)(this.tooltip),this._removeManipulators(),this._updatingHandles.destroy()}get updating(){return this._updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get object(){return this.tool.object}get enableZShape(){return this.tool.enableZShape}get enableDeleteVertices(){return this.tool.enableDeleteVertices}get enableZVertex(){return this.tool.enableZVertex}get autoHideManipulators(){return this.tool.autoHideManipulators}get enableMoveObject(){return this.tool.enableMoveObject}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get _sketchOptions(){return this.tool.sketchOptions}get _accentColor(){return this.view.effectiveTheme.accentColor}removeSelectedVertices(){const e=this._manipulatorInfos.filter((e=>e.manipulator.selected&&"vertex"===e.type));return this._removeVertices(e),e.length}onManipulatorSelectionChanged(){this.events.emit("manipulators-changed")}_removeManipulators(){this._manipulatorHandles.removeAll(),this._moveManipulation=(0,o.pR)(this._moveManipulation),this._objectMoveManipulation=(0,o.pR)(this._objectMoveManipulation),this.manipulators.removeAll(),this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0}_createManipulators(e){if(null==this._operations)return;const t=this.object.elevationInfo;for(const n of this._operations.data.components){const i=e?.byComponentIndex.get(n.index);for(const e of n.vertices){const n=i?.has(e.index);this._createVertexOrEdgeManipulator(e,t,n)}for(const e of n.edges)this._createVertexOrEdgeManipulator(e,t)}this._createObjectMoveManipulation(),this._createMoveManipulation(t),this._createVisualElements()}get canRedo(){return null!=this._operations&&this._operations.canRedo}get canUndo(){return null!=this._operations&&this._operations.canUndo}redo(){return this._operations?.redo()}undo(){return this.events.emit("undo"),this._operations?.undo()}_recreateManipulators(){if(!this._recreatingManipulators){if(this._recreatingManipulators=!0,this._removeManipulators(),this._resetTooltip(),this._operations&&this._segmentLabels?.context?.editGeometryOperations===this._operations||(this._segmentLabels=(0,o.pR)(this._segmentLabels)),this._createManipulators(),!this._segmentLabels&&this._operations){const e=this._sketchOptions.labels;this._segmentLabels=new Z({context:{view:this.view,editGeometryOperations:this._operations,elevationInfo:this.object.elevationInfo,labelOptions:e},visible:e.enabled})}this._recreatingManipulators=!1}}_perObjectManipulatorDragAction(e,t){if("end"===t.action)return t;let n=0;const i=[],r=this._manipulatorInfos.some((e=>"vertex"===e.type&&e.manipulator.selected)),s=e===Gs.SELECTED_OR_ALL&&r;for(const e of this._manipulatorInfos)"vertex"===e.type&&(e.manipulator.grabbing||s&&!e.manipulator.selected||i.push(e),n++);if(this._moveVertices(i,t),i.length===n){if(this._updateEventState(js.MOVING),this.destroyed)return t;this.events.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,object:this.object})}else{if(this._updateEventState(js.RESHAPING),this.destroyed)return t;this.events.emit("reshape",{type:"reshape",object:this.object})}return t}_toggleAutoHideManipulators(e){this.autoHideManipulators&&(e?this.removeHandles(Ls):this.tool.manipulators.forEach((({manipulator:e})=>{const t=e.disableDisplay?.();t&&this.addHandles(t,Ls)})))}_isMultiVertexSelection(){return this._manipulatorInfos.reduce(((e,t)=>"vertex"===t.type&&t.manipulator.selected?e+1:e),0)>1}_perVertexManipulatorDragAction(e){if(this._updateEventState(js.RESHAPING),this.destroyed)return;const{mapDeltaX:t,mapDeltaY:n,mapDeltaZ:i}=e;if(!t&&!n&&!i)return;const r=[];for(const t of this._manipulatorInfos)"vertex"===t.type&&(t.manipulator.selected&&!t.manipulator.grabbing||t===e.info)&&r.push(t);this._moveVertices(r,e,di.Y.ACCUMULATE_STEPS),this.events.emit("reshape",{type:"reshape",object:this.object})}_updateEventState(e){if(e===this._reshapeEventState)return!1;switch(e){case js.NONE:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case js.MOVING:this.events.emit("move",{type:"move-stop",dx:0,dy:0,object:this.object});break;case js.RESHAPING:this.events.emit("reshape",{type:"reshape-stop",object:this.object})}break;case js.MOVING:switch(this._reshapeEventState){case js.NONE:this.events.emit("move",{type:"move-start",dx:0,dy:0,object:this.object});break;case js.RESHAPING:this.events.emit("reshape",{type:"reshape-stop",object:this.object}),this.destroyed||this.events.emit("move",{type:"move-start",dx:0,dy:0,object:this.object})}break;case js.RESHAPING:switch(this._reshapeEventState){case js.NONE:this.events.emit("reshape",{type:"reshape-start",object:this.object});break;case js.MOVING:this.events.emit("move",{type:"move-stop",dx:0,dy:0,object:this.object}),this.destroyed||this.events.emit("reshape",{type:"reshape-start",object:this.object})}}if(this.destroyed)return!1;const t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}_createObjectMoveManipulation(){const{tool:e,view:t,object:n,_operations:i}=this;if(i){if(this._objectMoveManipulation=new Jr({tool:e,view:t,object:n}),this.enableMoveObject){let e=null;this._manipulatorHandles.add(this._objectMoveManipulation.createDragPipeline(((t,n,r)=>{n.next((e=>this._trackNumDragging(e))).next((t=>("start"===t.action&&(e=i.createUndoGroup()),t))).next((e=>this._perObjectManipulatorDragAction(Gs.ALL,e))).next((e=>(this._updateTranslateObjectTooltip(Kr.XY,e),e))).next((t=>{"end"===t.action&&(this._resetTooltip(),e=(0,o.xt)(e))})),r.next((()=>this._onDragCancel(!0,(()=>e=(0,o.xt)(e)))))}))),this._objectMoveManipulation.forEachManipulator((e=>this._manipulatorHandles.add(this._watchAndUpdateGrabState(e,!1))))}else this._objectMoveManipulation.forEachManipulator((e=>{e.grabbable=!1,e.cursor=null}));this._objectMoveManipulation.forEachManipulator((e=>this._manipulatorHandles.add(e.events.on("immediate-click",(e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.events.emit("immediate-click",{...e,object:this.object}),e.stopPropagation()})))))}}_createMoveManipulation(e){const{object:t,tool:n,view:i,_operations:r}=this;if(!r)return;this._moveManipulation=new Xr({tool:n,view:i,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&hi(t.operations,t.elevationInfo),snapToScene:!1,radius:Xr.radiusForSymbol(t.graphic?.symbol)}),this._moveManipulation.forEachManipulator((e=>this.addHandles([e.events.on("immediate-click",(t=>{this._moveManipulation.zManipulation.hasManipulator(e)||this._manipulatorInfos.some((e=>e.manipulator.selected))||this.events.emit("immediate-click",{...t,object:this.object}),t.stopPropagation()})),this._watchAndUpdateGrabState(e,!1)])));const s=e=>t=>{this.addHandles(t.events.on("focus-changed",(({action:t})=>{"focus"===t?this._updateTranslateTooltip(e):this._resetTooltip()})))};this._moveManipulation.xyManipulation.forEachManipulator(s(Kr.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(s(Kr.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(s(Kr.Z)),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const o=r.data.spatialReference;this.addHandles([this._moveManipulation.createDragPipeline(((i,s,o,a,l)=>{const{snappingStep:c,cancelSnapping:u}=(0,ss.L)({predicate:e=>!!e.info,snappingManager:n.snappingManager,snappingContext:new rs.e({editGeometryOperations:r,elevationInfo:e,pointer:l,excludeFeature:t.graphic,visualizer:new qt}),updatingHandles:this._updatingHandles,useZ:!1});return a=a.next((e=>(this._onDragCancel(),e))).next(u),{steps:o=o.next((e=>this._trackNumDragging(e))).next((e=>{const t=this._manipulatorInfos.filter((e=>"vertex"===e.type&&e.manipulator.selected));return e.manipulatorType===Ji.TRANSLATE_XY&&1===t.length?{...e,info:t[0],snapOrigin:t[0].handle.pos}:e})).next((0,Tr.pg)(this.view,e,t.graphic??void 0)).next(...c).next((0,Tr.EX)()).next((e=>this._perObjectManipulatorDragAction(Gs.SELECTED_OR_ALL,e))).next((e=>(this._updateTranslateTooltip(i,e),e))),cancel:a}}),e,o,t.graphic),(0,a.watch)((()=>t.visible),(()=>this._updateMoveManipulationPosition()),a.Vh),t.on("committed",(()=>{this._recreatingManipulators||this._updateMoveManipulationPosition()})),(0,a.watch)((()=>t.isDraped),(e=>{this._updateMoveManipulationPosition();const t="align-move-manipulation";e?this.addHandles(this.view.elevationProvider.on("elevation-change",(()=>this._updateMoveManipulationPosition())),t):this.removeHandles(t)}),a.Vh)])}_createVisualElements(){const{object:e,view:t}=this,n=hr({view:t,object:e,forEachManipulator:e=>{if(!this.destroyed&&!this._recreatingManipulators){this._objectMoveManipulation.forEachManipulator(e),this._moveManipulation.forEachManipulator(e);for(const t of this._manipulatorInfos)e(t.manipulator,Ji.TRANSLATE_XY)}},onManipulatorsChanged:e=>this.events.on("manipulators-changed",e)});null!=n&&(this._outlineVisualElement=n.visualElement instanceof Tn?n.visualElement:null);const i=this._outlineVisualElement;if(null!=i){const t=()=>{e.isDraped||this._updateMoveManipulationPosition()};this._manipulatorHandles.add((0,a.on)((()=>i.events),"attachment-origin-changed",t,{onListenerAdd:t}))}this._manipulatorHandles.add(n)}_createEdgeOffsetManipulator(e,t=this.object.elevationInfo){const n=this._operations;if(e.component.vertices.length<=2||!n)return null;const i=this._settings.manipulators.edgeOffset,r=i.size/2,o=r+i.collisionPadding,a=r/o,l=a*Math.sqrt(3)/2;null==this._edgeOffsetManipulatorGeometryInside&&(this._edgeOffsetManipulatorGeometryInside=(0,Xe._B)(this._edgeOffsetManipulatorMaterial,l,a/2,a/2,i.height,i.offset)),null==this._edgeOffsetManipulatorGeometryOutside&&(this._edgeOffsetManipulatorGeometryOutside=(0,Xe._B)(this._edgeOffsetManipulatorMaterial,-l,a/2,a/2,i.height,-i.offset));const c=[new vr(this._edgeOffsetManipulatorGeometryInside.instantiate(),Di.p7.Unfocused),new vr(this._edgeOffsetManipulatorGeometryInside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),Di.p7.Focused),new vr(this._edgeOffsetManipulatorGeometryOutside.instantiate(),Di.p7.Unfocused),new vr(this._edgeOffsetManipulatorGeometryOutside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),Di.p7.Focused)],u=new Ni({view:this.view,renderObjects:c,elevationInfo:"on-the-ground"!==t.mode||(0,Ts.$d)(this.object.graphic?.symbol)?{mode:"absolute-height",offset:0}:t,worldOriented:!1,focusMultiplier:1,radius:o,available:this.object.visible,collisionType:{type:"disc",direction:(0,d.fA)(0,0,1)},collisionPriority:1,metadata:{deleting:!1}}),h=new Ni({view:this.view,worldSized:!0,worldOriented:!1,available:this.object.visible,collisionPriority:-10,cursor:this.enableMoveObject?"move":"default",metadata:{deleting:!1}}),p={manipulator:u,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:h,elevationInfo:t,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(p,i.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(p);const f=[];for(const t of[e.leftVertex,e.rightVertex]){const e=this._getManipulatorInfoFromHandle(t);null!=e&&f.push(e.manipulator.events.on("location-update",(()=>this._updateEdgeOffsetManipulator(p))))}p.locationUpdateHandle=(0,s.vE)(f),this._manipulatorHandles.add(p.locationUpdateHandle,u),this._manipulatorHandles.add([this._watchAndUpdateGrabState(u,!0),this._watchAndUpdateGrabState(h,!0)],u),this._manipulatorHandles.add((0,Tr.Xt)(u,this._createEdgeOffsetPipeline(p,t)),u),this._manipulatorHandles.add((0,Tr.Xt)(h,((e,i,r,s)=>{if("touch"===s)this._createEdgeOffsetPipeline(p,t)(e,i,r);else if(this.enableMoveObject){const s=this.object.graphic,o=n.data.spatialReference;i.next((e=>this._trackNumDragging(e))).next((0,Tr.Tp)(this.view,e.elevationAlignedLocation)).next(Sr(this.view,e.elevationAlignedLocation,t,o,s)).next((0,Tr.sO)()).next((0,Tr.EX)()).next((e=>this._perObjectManipulatorDragAction(Gs.ALL,e))).next((e=>(this._updateTranslateObjectTooltip(Kr.XY,e),e))).next((e=>{"end"===e.action&&this._resetTooltip()})),r.next((()=>this._onDragCancel(!e.metadata.deleting)))}})),u);const m=e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.events.emit("immediate-click",{...e,object:this.object}),e.stopPropagation()};return this._manipulatorHandles.add([u.events.on("immediate-click",m),h.events.on("immediate-click",m),u.events.on("focus-changed",(({action:e})=>{"focus"===e?this._updateEdgeOffsetTooltip(null):this._resetTooltip()}))],u),this._manipulatorInfos.push(p),this.manipulators.add(u),this.manipulators.add(h),this.events.emit("manipulators-changed"),p}_autoHideEdgeOffsetManipulator(e,t){const n=e.manipulator,i=e.edgeManipulator,r=()=>{e.visibilityHandle=(0,o.xt)(e.visibilityHandle);const r=this._getManipulatorInfoFromHandle(e.handle.leftVertex),a=this._getManipulatorInfoFromHandle(e.handle.rightVertex),l=null!=r&&null!=a&&function(e,t,n){const i=n.projectToRenderScreen(e,(0,m.r_)()),r=n.projectToRenderScreen(t,(0,m.r_)());return null!=i&&null!=r?(0,h.q)((0,h.f)(i,i,r)):0}(r.manipulator.renderLocation,a.manipulator.renderLocation,this.view.state.camera)<t;(!n.focused&&!i.focused||l)&&(n.grabbable=!l,i.grabbable=!l,e.visibilityHandle=(0,s.vE)([n.disableDisplay(),(0,s.hA)((()=>{n.grabbable=!0,i.grabbable=this.enableMoveObject}))]))};this._manipulatorHandles.add([n.events.on("focus-changed",r),i.events.on("focus-changed",r),(0,s.hA)((()=>{(0,o.xt)(e.visibilityHandle),i.metadata.deleting=!0,this.manipulators.remove(i)}))],n),r()}_updateEdgeOffsetManipulator(e){if(!this._operations)return;this._updateManipulatorPosition(e);const{coordinateHelper:t}=this._operations.data,n=Ss(this.view,e.manipulator.elevationAlignedLocation,xs(t,e.handle,e.manipulator.elevationInfo)),i=this._getManipulatorInfoFromHandle(e.handle.leftVertex),r=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if(null==i||null==r)return;const s=i.manipulator.renderLocation,o=r.manipulator.renderLocation,a=null!=n?function(e,t,n){const i=(0,Mi.Qj)(e),r=(0,h.E)((0,d.vt)(),t,n),s=(0,h.b)((0,d.vt)(),r,i),o=(0,h.b)((0,d.vt)(),r,s);return(0,wt.fA)(r[0],r[1],r[2],0,s[0],s[1],s[2],0,o[0],o[1],o[2],0,0,0,0,1)}(n,s,o):wt.zK;e.manipulator.modelTransform=a,e.edgeManipulator.elevationAlignedLocation=e.manipulator.elevationAlignedLocation,e.edgeManipulator.modelTransform=a;const l=(0,h.l)((0,h.f)(Hs,s,o))/2;e.edgeManipulator.collisionType={type:"line",paths:[[[-l,0,0],[l,0,0]]]}}_createEdgeOffsetPipeline(e,t){return(n,i,r)=>{const s=this._operations;if(!s)return;this._clearSelection();const{step:o,cleanup:a}=this._initializeEdgeOffset(e,t,s);i.next((e=>this._trackNumDragging(e))).next((0,Tr.Tp)(this.view,n.elevationAlignedLocation)).next(o).next(function(e){return xr(e,(e=>e.plane))}(this.view)).next(Ar(this.view,s.data.spatialReference)).next((0,Tr.EX)()).next((e=>{const{operation:t,mapEnd:n}=e;return null==t||null==n?e:("start"===e.action&&t.selectArrowFromStartPoint(n),{...e,signedDistance:t.signedDistanceToPoint(n)})})).next(this._applyEdgeOffsetStep(e)).next(this._showEdgeOffsetTooltip()).next((e=>{"end"===e.action&&a()})),r.next((()=>{n.metadata.deleting||(a(),this._onDragCancel())}))}}_initializeEdgeOffset(e,t,n){const{view:i}=this,l=xs(n.data.coordinateHelper,e.handle,t),c=n.createUndoGroup(),u=Ss(i,e.manipulator.elevationAlignedLocation,l);if(l.requiresSplitEdgeLeft){const t=this._getManipulatorInfoFromHandle(e.handle.leftVertex.leftEdge);null!=t&&this._splitEdgeManipulator(t,1)}if(l.requiresSplitEdgeRight){const t=this._getManipulatorInfoFromHandle(e.handle.rightVertex.rightEdge);null!=t&&this._splitEdgeManipulator(t,0)}const h=()=>new bs.A({paths:[[e.handle.leftVertex.pos,e.handle.rightVertex.pos]],spatialReference:n.data.spatialReference}),d=this._settings,p=new Tn({view:i,isDraped:this.object.isDraped,geometry:h(),elevationInfo:e.elevationInfo,width:d.visualElements.lineObjects.outline.width,attached:!1,isDecoration:!0});let f;const m=()=>{this._cleanEdgeOffsetCollapsedEdges(e),f=(0,o.xt)(f)},g=this.events.on("undo",m);return f=(0,s.vE)([(0,a.watch)((()=>(0,r.QP)(this._accentColor)),(e=>p.color=e),a.Vh),(0,s.DQ)(p),(0,a.watch)((()=>this.object.isDraped),(e=>p.isDraped=e)),this.object.on("committed",(()=>p.geometry=h())),c,g]),p.attached=!0,{step:e=>null==l||null==u?(m(),null):{...e,operation:l,plane:u},cleanup:m}}_applyEdgeOffsetStep(e){return t=>{if(this.destroyed||null==t.operation)return t;this._updateEventState(js.RESHAPING);const{mapDeltaX:n,mapDeltaY:i,mapDeltaZ:r}=t;return(n||i||r)&&(this._offsetEdge(e,t),this.events.emit("reshape",{type:"reshape",object:this.object})),t}}_showEdgeOffsetTooltip(){return e=>(null!=e.signedDistance&&this.object.operations?this._updateEdgeOffsetTooltip(e):this._resetTooltip(),e)}_cleanEdgeOffsetCollapsedEdges(e){if(!this._operations)return;const t=e.handle.leftVertex.leftEdge?.leftVertex,n=e.handle.leftVertex,i=e.handle.rightVertex.rightEdge?.rightVertex,r=e.handle.rightVertex,s=this._operations.data.coordinateHelper,o=[];if(t&&s.distance(t.pos,n.pos)<Us){const e=this._getManipulatorInfoFromHandle(n);null!=e&&o.push(e)}if(s.distance(n.pos,r.pos)<Us||i&&s.distance(i.pos,r.pos)<Us){const e=this._getManipulatorInfoFromHandle(r);null!=e&&o.push(e)}o.length&&this._removeVertices(o)}_createVertexOrEdgeManipulator(e,t=this.object.elevationInfo,n=!1){const{view:i,_operations:r}=this;if(!r)return null;const a=this._settings;if("edge"===e.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(e,t);if(!this.enableMidpoints)return null}if(null==this._vertexManipulatorGeometry||null==this._vertexManipulatorOutlineGeometry){const{size:e,outlineSize:t}=Fs(a.manipulators.vertex);this._vertexManipulatorGeometry=(0,Xe.CM)(this._vertexManipulatorMaterial,e,16,16),this._vertexManipulatorOutlineGeometry=(0,Xe.CM)(this._vertexManipulatorOutlineMaterial,t,16,16)}if(null==this._edgeManipulatorGeometry||null==this._edgeManipulatorOutlineGeometry){const{size:e,outlineSize:t}=Fs(a.manipulators.edge);this._edgeManipulatorGeometry=(0,Xe.CM)(this._edgeManipulatorMaterial,e,16,16),this._edgeManipulatorOutlineGeometry=(0,Xe.CM)(this._edgeManipulatorOutlineMaterial,t,16,16)}const l=this._operations?.data.type,c="point"===l||"mesh"===l?[]:[new vr(this._vertexManipulatorGeometry.instantiate(),ks.Vertex|Di.p7.Unselected),new vr(this._vertexManipulatorOutlineGeometry.instantiate(),ks.Vertex|Di.p7.Unfocused|Di.p7.Unselected),new vr(this._vertexManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),ks.Vertex|Di.p7.Focused|Di.p7.Unselected),new vr(this._vertexManipulatorGeometry.instantiate({material:this._selectedManipulatorMaterial}),Di.p7.Selected),new vr(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorOutlineMaterial}),Di.p7.Selected|Di.p7.Unfocused),new vr(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorHoverOutlineMaterial}),Di.p7.Selected|Di.p7.Focused)];this.enableMidpoints&&c.push(new vr(this._edgeManipulatorGeometry.instantiate({material:this._vertexManipulatorMaterial}),ks.Edge|Di.p7.Focused|Di.p7.Unselected),new vr(this._edgeManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),ks.Edge|Di.p7.Focused|Di.p7.Unselected),new vr(this._edgeManipulatorGeometry.instantiate(),ks.Edge|Di.p7.Unfocused|Di.p7.Unselected),new vr(this._edgeManipulatorOutlineGeometry.instantiate(),ks.Edge|Di.p7.Unfocused|Di.p7.Unselected));const u=new Ni({view:i,renderObjects:c,elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:this.object.visible,metadata:{deleting:!1}});u.selected=n,this._setTypeSpecificManipulatorSettings(u,e,t);const h="edge"===e.type?{manipulator:u,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:u,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(h),this.manipulators.add(u),this._updateManipulatorPosition(h),"edge"===h.type){const e=[];for(const t of[h.handle.leftVertex,h.handle.rightVertex]){const n=this._getManipulatorInfoFromHandle(t);null!=n&&e.push(n.manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(h))))}h.locationUpdateHandle=(0,s.vE)(e),this._manipulatorHandles.add(h.locationUpdateHandle,u)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(u,!0),u);const d=(0,Tr.Xt)(u,((e,n,i,s)=>{let a=null;const{snappingStep:l,cancelSnapping:c}=(0,ss.L)({predicate:()=>!this._isMultiVertexSelection(),snappingManager:this.tool.snappingManager,snappingContext:new rs.e({editGeometryOperations:r,elevationInfo:t,pointer:s,excludeFeature:this.object.graphic,visualizer:new qt}),updatingHandles:this._updatingHandles,useZ:!1});i=i.next((t=>(this._onDragCancel(!e.metadata.deleting,(()=>a=(0,o.xt)(a))),t))).next(c),n.next((e=>this._trackNumDragging(e))).next((e=>{if("start"===e.action&&this._operations&&(a=this._operations.createUndoGroup()),"edge"===h.type){const t=this._splitEdgeManipulator(h);return{...e,info:t,snapOrigin:t.handle.pos}}return{...e,info:h,snapOrigin:h.handle.pos}})).next((0,Tr.Tp)(this.view,e.elevationAlignedLocation)).next(Sr(this.view,e.elevationAlignedLocation,this.object.elevationInfo,e.location.spatialReference,this.object.graphic)).next((0,Tr.pg)(this.view,t,this.object.graphic??void 0)).next(...l).next((0,Tr.EX)()).next((e=>{this._perVertexManipulatorDragAction(e),"end"===e.action&&(a=(0,o.xt)(a)),this._resetTooltip()}))}));return this._manipulatorHandles.add([d,u.events.on("immediate-click",(e=>this._manipulatorClickCallback(e,h))),u.events.on("select-changed",(()=>{h.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition(),this._resetTooltip()})),u.events.on("focus-changed",(()=>{this._resetTooltip()}))],u),this.events.emit("manipulators-changed"),h}_trackNumDragging(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}_onDragCancel(e=!0,t){switch(this._numDragging--,e&&this.undo(),null!=this.tool.snappingManager&&this.tool.snappingManager.doneSnapping(),this._resetTooltip(),this._reshapeEventState){case js.NONE:break;case js.MOVING:this.events.emit("move",{type:"move",dx:0,dy:0,object:this.object});break;case js.RESHAPING:this.events.emit("reshape",{type:"reshape",object:this.object})}t&&t(),this.destroyed||this._updateEventState(js.NONE)}_setTypeSpecificManipulatorSettings(e,t,n){const i=this._settings;switch(t.type){case"vertex":{e.state=ks.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2;const{size:t,collisionPadding:r}=i.manipulators.vertex;e.radius=t/2+r,e.elevationInfo=n;const s=this._operations?.data.type;e.interactive=null!=s&&"point"!==s&&"mesh"!==s;break}case"edge":{e.state=ks.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1;const{size:t,collisionPadding:r}=i.manipulators.edge;e.radius=t/2+r,e.elevationInfo="on-the-ground"!==n.mode||(0,Ts.$d)(this.object.graphic?.symbol)?{mode:"absolute-height",offset:0}:n;break}}}_watchAndUpdateGrabState(e,t){return e.events.on("grab-changed",(n=>this._onGrabStateChanged(e,t,n.action,n.pointerType)))}_onGrabStateChanged(e,t,n,i="mouse"){if(!this._recreatingManipulators){if("start"===n)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(js.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,("touch"!==i||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach((e=>{const{manipulator:t}=e,n=this._operations?.data.type;t.interactive=t.grabbing||!this._numGrabbing&&null!=n&&"point"!==n&&"mesh"!==n,"edgeManipulator"in e&&(e.edgeManipulator.interactive=e.edgeManipulator.grabbing||!this._numGrabbing)})),this._objectMoveManipulation.forEachManipulator((e=>{e.interactive=e.grabbing||!this._numGrabbing})))}}_clearSelection(){for(const e of this._manipulatorInfos)e.manipulator.grabbing||(e.manipulator.selected=!1)}_updateSelection(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.events.emit("manipulators-changed"))}_removeManipulator(e){null!=e&&(e.manipulator.metadata.deleting=!0,this.manipulators.remove(e.manipulator),this._manipulatorHandles.remove(e.manipulator),(0,ii.Xy)(this._manipulatorInfos,e),this.events.emit("manipulators-changed"),this._resetTooltip())}_getManipulatorInfoFromHandle(e){if(e)for(const t of this._manipulatorInfos)if(e===t.handle)return t;return null}_updateManipulatorPositions(e){for(const t of e)this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(t))}_updateManipulatorPosition(e){const t=this._operations;if(null!=e&&t)if("vertex"===e.type)e.manipulator.location=t.data.coordinateHelper.vectorToDehydratedPoint(e.handle.pos,Vs),e.manipulator.grabbing&&null!=this._vertexLaserLineVisualElement&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.type){const n=this._getManipulatorInfoFromHandle(e.handle.leftVertex),i=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if(null==n||null==i)return;const r=n.manipulator,s=i.manipulator;if(null!=e.manipulator.elevationInfo&&"on-the-ground"===e.manipulator.elevationInfo.mode){const n=r.location,i=s.location,o=.5,a=n.x+o*(i.x-n.x),l=n.y+o*(i.y-n.y),c=n.hasZ&&i.hasZ?0:void 0;e.manipulator.location=(0,ct.T)(a,l,c,t.data.spatialReference)}else(0,h.o)(Hs,r.renderLocation,s.renderLocation,.5),e.manipulator.renderLocation=Hs}}_splitEdgeManipulator(e,t=.5){const n=this._operations,i=n.splitEdge(e.handle,t).createdVertex;e.locationUpdateHandle=(0,o.xt)(e.locationUpdateHandle);const r=this.object.elevationInfo;let s;this.enableEdgeOffset?(this._removeManipulator(e),s=this._createVertexOrEdgeManipulator(i)):(s=e,s.handle=i,s.type="vertex",this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,r)),i.leftEdge&&this._createVertexOrEdgeManipulator(i.leftEdge),i.rightEdge&&this._createVertexOrEdgeManipulator(i.rightEdge),this._updateManipulatorPosition(s),this.enableEdgeOffset||this._resetTooltip(),this._updateSelection(e.manipulator);const a=this._updateEventState(js.RESHAPING),l=n.data.coordinateHelper.vectorToArray(s.handle.pos),c=n.data.components.indexOf(i.component);return this.events.emit("vertex-add",{type:"vertex-add",object:this.object,vertices:[{coordinates:l,componentIndex:c,vertexIndex:i.index}],added:l}),a&&this._updateEventState(js.NONE),s}_updateMoveManipulationPosition(){const e=(0,h.s)(Hs,0,0,0);let t=0,n=!1,i=null,r=null;for(const s of this._manipulatorInfos)"vertex"===s.type&&(s.manipulator.selected?(t++,(0,h.g)(e,e,s.manipulator.renderLocation),null==i||s.selectedIndex>i.selectedIndex?(r=i,i=s):(null==r||s.selectedIndex>r.selectedIndex)&&(r=s)):n=!0);const s=this.object,o=this._operations?.data.geometry;if(0===t){const e=s.visible&&this.enableMoveObject;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e,this._moveManipulation.zManipulation.available=e&&this.enableZShape&&hi(this._operations,s.elevationInfo),this._moveManipulation.angle=li(o),this._moveManipulation.radius=Xr.radiusForSymbol(s.graphic?.symbol)}else{const e=s.visible;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.zManipulation.available=e&&this.enableZVertex&&hi(this._operations,this.object.elevationInfo),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e&&1!==t;let n=0;if(null!=i){const e=i.handle.pos,t=null!=r?r.handle.pos:i.handle.leftEdge?.leftVertex?i.handle.leftEdge.leftVertex.pos:null,s=null==r&&i.handle.rightEdge?.rightVertex?i.handle.rightEdge.rightVertex.pos:null;t&&s?this._moveManipulation.xyAxisManipulation.available=!1:t?n=zs(t,e):s&&(n=zs(e,s))}this._moveManipulation.angle=n,this._moveManipulation.radius=pr}0!==t&&n?((0,h.j)(e,e,1/t),Vs.spatialReference=this._operations.data.spatialReference,Vs.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(e,Vs),this._moveManipulation.elevationAlignedLocation=Vs):null==this._outlineVisualElement||this.object.isDraped||null==this._outlineVisualElement.attachmentOrigin?jr(this._moveManipulation,this.object):this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin}_removeVertices(e){const t=new Array,n=this._operations;if(n){for(const i of e){const e=i.handle.component;if("vertex"===i.type&&n.canRemoveVertex(e)){t.push(i.handle),this._removeManipulator(i),this._removeManipulator(this._getManipulatorInfoFromHandle(i.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(i.handle.rightEdge));const r=n.removeVertices([i.handle]),s=r.removedVertices?.[0].createdEdge;s?this._createVertexOrEdgeManipulator(s):this.enableEdgeOffset&&e.vertices.length<=2&&this._removeManipulator(this._getManipulatorInfoFromHandle(e.edges[0]))}}if(t.length>0){const e=t.map((e=>{const t=n.data.components.indexOf(e.component);return{coordinates:n.data.coordinateHelper.vectorToArray(e.pos),componentIndex:t,vertexIndex:e.index}})),i=this._updateEventState(js.RESHAPING);if(this.destroyed)return;if(this.events.emit("vertex-remove",{type:"vertex-remove",object:this.object,removed:e.map((e=>e.coordinates)),vertices:e}),this.destroyed)return;if(i&&(this._updateEventState(js.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}}_moveVertices(e,t,n=("start"===t.action?di.Y.NEW_STEP:di.Y.ACCUMULATE_STEPS)){const i=this._operations;if(i){e.length>0&&i.moveVertices(e.map((e=>e.handle)),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,n);for(const t of e)this._updateManipulatorPosition(t)}}_offsetEdge(e,t){if(null==t.operation||null==t.signedDistance)return;const n=this._operations;if(!n)return;const i=t.operation.clone();i.distance=t.signedDistance,n.updateVertices([e.handle.leftVertex,e.handle.rightVertex],i),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.rightVertex))}_manipulatorClickCallback(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.type&&(t.manipulator.selected=!t.manipulator.selected,this.enableDeleteVertices&&e.button===Ps.w.Right&&this._removeVertices([t])),"edge"===t.type&&e.button===Ps.w.Left&&this._splitEdgeManipulator(t),e.stopPropagation()}_updateTranslateTooltip(e,t){null!=this._defaultTooltipInfo?this._resetTooltip():this._updateTranslateObjectTooltip(e,t)}_updateTranslateObjectTooltip(e,t){this.activeTooltipInfo=function(e,t,{sketchOptions:n,tooltipInfos:i}){let r=null;switch(e){case Kr.XY:r=i.translate,Is(r,t,((e,t)=>(0,N.Kt)(e,t)));break;case Kr.XY_AXIS:r=i.translateXY,Is(r,t,((e,n)=>(0,si.hs)((0,N.Kt)(e,n),Ir(t))));break;case Kr.Z:r=i.translateZ,Is(r,t,pi.e5)}return r.sketchOptions=n,r}(e,t,this._tooltipsContext)}_updateEdgeOffsetTooltip(e){this.activeTooltipInfo=function(e,t,{sketchOptions:n,tooltipInfos:i}){const r=i.edgeOffset;if(r.distance=si.r7,null!=t&&"end"!==t.action){const n=e.operations,{mapEnd:i,signedDistance:s,operation:o}=t;if(null!=s&&null!=n){const t=n.data.coordinateHelper,a=s*o.selectedArrow;r.distance=function(e,t,n,i,r){if(e){const e=r.toXYZ(r.pointToVector(n)),s=(0,Mi._I)(i,e,A.rq.get()),o=(0,Rs.n3)(s,e,r.spatialReference);if(null!=o)return(0,si.d_)(o.value*Math.sign(t),o.unit)}return(0,si.d_)(t*(0,E.GA)(n.spatialReference),"meters")}(e.isDraped,a,i,o.plane,t)}}const s=e.operations?.data.geometry;return r.area="polygon"===s?.type?(0,Os.n)(s):null,r.totalLength="polyline"===s?.type?(0,N.ob)(s):null,r.sketchOptions=n,r}(this.object,e,this._tooltipsContext)}_resetTooltip(){this.activeTooltipInfo=this._defaultTooltipInfo}get _defaultTooltipInfo(){const e=this._operations?.data.type;switch(e){case"polyline":case"polygon":return this._selectedVertexManipulatorInfo?this.tooltipInfos.selectedVertex:null;case"point":case"mesh":return this.tooltipInfos.movePoint;default:return null}}get _selectedVertexManipulatorInfo(){const e=this._manipulatorInfos.filter((e=>"vertex"===e.type&&e.manipulator.selected));return 1===e.length?e[0]:null}get _tooltipsContext(){const{events:e}=this;return{sketchOptions:this._sketchOptions,tooltipInfos:this.tooltipInfos,activeTooltipInfo:this.activeTooltipInfo,selectedVertexManipulatorInfo:this._selectedVertexManipulatorInfo,callbacks:{onReshapeStart:()=>e.emit("reshape",{type:"reshape-start",object:this.object}),onReshape:()=>e.emit("reshape",{type:"reshape",object:this.object}),onReshapeStop:()=>e.emit("reshape",{type:"reshape-stop",object:this.object}),onMoveStart:()=>e.emit("move",{type:"move-start",object:this.object,dx:0,dy:0}),onMove:()=>e.emit("move",{type:"move",object:this.object,dx:0,dy:0}),onMoveStop:()=>e.emit("move",{type:"move-stop",object:this.object,dx:0,dy:0})}}}get test(){}};function Fs(e){const t=e.size/2,n=t+e.collisionPadding;return{size:t/n,outlineSize:(t+e.outlineSize)/n}}function zs(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}(0,i._)([(0,l.MZ)()],Ns.prototype,"_numGrabbing",void 0),(0,i._)([(0,l.MZ)()],Ns.prototype,"_numDragging",void 0),(0,i._)([(0,l.MZ)()],Ns.prototype,"grabbingOrDragging",null),(0,i._)([(0,l.MZ)()],Ns.prototype,"_operations",null),(0,i._)([(0,l.MZ)()],Ns.prototype,"_segmentLabels",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],Ns.prototype,"tool",void 0),(0,i._)([(0,l.MZ)()],Ns.prototype,"tooltip",void 0),(0,i._)([(0,l.MZ)()],Ns.prototype,"activeTooltipInfo",void 0),(0,i._)([(0,l.MZ)({readOnly:!0})],Ns.prototype,"updating",null),(0,i._)([(0,l.MZ)()],Ns.prototype,"manipulators",null),(0,i._)([(0,l.MZ)()],Ns.prototype,"view",null),(0,i._)([(0,l.MZ)()],Ns.prototype,"object",null),(0,i._)([(0,l.MZ)()],Ns.prototype,"enableZShape",null),(0,i._)([(0,l.MZ)()],Ns.prototype,"enableDeleteVertices",null),(0,i._)([(0,l.MZ)()],Ns.prototype,"enableZVertex",null),(0,i._)([(0,l.MZ)()],Ns.prototype,"autoHideManipulators",null),(0,i._)([(0,l.MZ)()],Ns.prototype,"enableMoveObject",null),(0,i._)([(0,l.MZ)()],Ns.prototype,"enableMidpoints",null),(0,i._)([(0,l.MZ)()],Ns.prototype,"enableEdgeOffset",null),(0,i._)([(0,l.MZ)()],Ns.prototype,"_sketchOptions",null),(0,i._)([(0,l.MZ)()],Ns.prototype,"_accentColor",null),(0,i._)([(0,l.MZ)()],Ns.prototype,"_tooltipsContext",null),Ns=(0,i._)([(0,u.$)("esri.views.3d.interactive.editingTools.reshape.ReshapeOperation")],Ns);const Vs=(0,ct.T)(0,0,void 0,Ds.A.WGS84),Hs=(0,d.vt)(),Us=1e-6;var ks,js,Gs;!function(e){e.Vertex=Di.SJ.Custom1,e.Edge=Di.SJ.Custom2}(ks||(ks={})),function(e){e[e.NONE=0]="NONE",e[e.MOVING=1]="MOVING",e[e.RESHAPING=2]="RESHAPING"}(js||(js={})),function(e){e[e.ALL=0]="ALL",e[e.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(Gs||(Gs={}));var Bs=n(37578);let $s=class extends ts.g{constructor(e){super(e),this.events=new _n.A,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveObject=!0,this.enableDeleteVertices=!0,this.autoHideManipulators=!1,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.sketchOptions=new is.A,this.snappingManager=null,this.automaticManipulatorSelection=!1}initialize(){const e=this._reshapeOperation=new Ns({tool:this});this.addHandles([e.events.on("reshape",(e=>this.events.emit("reshape",e))),e.events.on("move",(e=>this.events.emit("move",e))),e.events.on("vertex-add",(e=>this.events.emit("vertex-add",e))),e.events.on("vertex-remove",(e=>this.events.emit("vertex-remove",e))),e.events.on("immediate-click",(e=>this.events.emit("immediate-click",{...e,object:this.object}))),this.view.on("pointer-down",["Shift"],(e=>e.stopPropagation()))]),this.finishToolCreation()}destroy(){this._reshapeOperation=(0,o.pR)(this._reshapeOperation)}get updating(){return((this.object.updating??!1)||this._reshapeOperation?.updating)??!1}get activeTooltipInfo(){return this._reshapeOperation?.activeTooltipInfo??null}get tooltip(){return this._reshapeOperation?.tooltip??null}onManipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.onManipulatorSelectionChanged()}get canUndo(){return this._reshapeOperation.canUndo??!1}undo(){null!=this.snappingManager&&this.snappingManager.doneSnapping(),this._reshapeOperation.undo()}get canRedo(){return this._reshapeOperation.canRedo??!1}redo(){null!=this.snappingManager&&this.snappingManager.doneSnapping(),this._reshapeOperation.redo()}onInputEvent(e){const t=this._reshapeOperation;t&&!t.grabbingOrDragging&&(0,Qn.wG)(e,t.tooltip)||!this.enableDeleteVertices||"key-down"!==e.type||!Bs.NE.delete.includes(e.key)||this._reshapeOperation.removeSelectedVertices()>0&&e.stopPropagation()}reset(){}get test(){}};(0,i._)([(0,l.MZ)()],$s.prototype,"_reshapeOperation",void 0),(0,i._)([(0,l.MZ)()],$s.prototype,"view",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],$s.prototype,"object",void 0),(0,i._)([(0,l.MZ)()],$s.prototype,"enableZShape",void 0),(0,i._)([(0,l.MZ)()],$s.prototype,"enableZVertex",void 0),(0,i._)([(0,l.MZ)()],$s.prototype,"enableMoveObject",void 0),(0,i._)([(0,l.MZ)()],$s.prototype,"enableDeleteVertices",void 0),(0,i._)([(0,l.MZ)()],$s.prototype,"autoHideManipulators",void 0),(0,i._)([(0,l.MZ)()],$s.prototype,"enableMidpoints",void 0),(0,i._)([(0,l.MZ)()],$s.prototype,"enableEdgeOffset",void 0),(0,i._)([(0,l.MZ)()],$s.prototype,"type",void 0),(0,i._)([(0,l.MZ)({type:is.A})],$s.prototype,"sketchOptions",void 0),(0,i._)([(0,l.MZ)()],$s.prototype,"snappingManager",void 0),(0,i._)([(0,l.MZ)()],$s.prototype,"updating",null),(0,i._)([(0,l.MZ)()],$s.prototype,"activeTooltipInfo",null),(0,i._)([(0,l.MZ)()],$s.prototype,"tooltip",null),(0,i._)([(0,l.MZ)()],$s.prototype,"automaticManipulatorSelection",void 0),$s=(0,i._)([(0,u.$)("esri.views.3d.interactive.editingTools.reshape.ReshapeTool3D")],$s);var Zs=n(26133);let Ws=class extends _.A{constructor(e){super(e),this._interactionState=null}initialize(){this.addHandles([(0,a.when)((()=>{const e=this._interactionState;return e&&e.angle!==e.previousAngle?{interactionState:e,angle:e.state.angle}:null}),(({interactionState:e})=>{this._updateMeshRotation(e)}),a.OH),(0,a.when)((()=>{const e=this._interactionState;return e&&e.scale!==e.previousScale?{interactionState:e,scale:e.state.scale}:null}),(({interactionState:e})=>{this._updateMeshSize(e)}),a.OH)])}get initialAngle(){return this._interactionState?.initialAngle??0}get angle(){const e=this.geometry.transform;if(null==e)return this._interactionState?.angle??0;const t=(0,Zs.yo)(e.rotation)[2];return Math.abs(t)>.999999?(0,y.kU)((0,Zs.g7)(e.rotation))*Math.sign(t):0}get angleClockwise(){return-this.angle}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){return this._interactionState?.scale??1}startInteraction(){const e=new qs({angle:this.angle});this._interactionState=e;const t=()=>{this._interactionState=null};return{state:e,done:t,cancel:()=>{e.cancel(),t()}}}createUndoRecord(){return this.object.createUndoRecord()}_updateMeshRotation(e){const{angle:t,previousAngle:n}=e;e.previousAngle=t;const i=(0,y.KJ)(t-n);this.geometry.rotate(0,0,i,{origin:this.geometry.anchor})}_updateMeshSize(e){const{scale:t,previousScale:n}=e;e.previousScale=t;const i=t/n,r=this.geometry.anchor;this.geometry.scale(i,{origin:r})}};(0,i._)([(0,l.MZ)({constructOnly:!0})],Ws.prototype,"object",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],Ws.prototype,"geometry",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],Ws.prototype,"viewingMode",void 0),(0,i._)([(0,l.MZ)()],Ws.prototype,"initialAngle",null),(0,i._)([(0,l.MZ)()],Ws.prototype,"angle",null),(0,i._)([(0,l.MZ)()],Ws.prototype,"angleClockwise",null),(0,i._)([(0,l.MZ)()],Ws.prototype,"relativeAngle",null),(0,i._)([(0,l.MZ)()],Ws.prototype,"relativeAngleClockwise",null),(0,i._)([(0,l.MZ)()],Ws.prototype,"scale",null),(0,i._)([(0,l.MZ)()],Ws.prototype,"_interactionState",void 0),Ws=(0,i._)([(0,u.$)("esri.views.3d.interactive.editingTools.transform.ScaleRotateMeshAdapter")],Ws);let qs=class extends _.A{get state(){const{angle:e,scale:t}=this;return{angle:e,scale:t}}constructor(e){super(e),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=e.angle,this.previousAngle=e.angle}cancel(){this.angle=this.initialAngle,this.scale=1}};(0,i._)([(0,l.MZ)()],qs.prototype,"angle",void 0),(0,i._)([(0,l.MZ)()],qs.prototype,"initialAngle",void 0),(0,i._)([(0,l.MZ)()],qs.prototype,"previousAngle",void 0),(0,i._)([(0,l.MZ)()],qs.prototype,"previousScale",void 0),(0,i._)([(0,l.MZ)()],qs.prototype,"scale",void 0),(0,i._)([(0,l.MZ)()],qs.prototype,"state",null),qs=(0,i._)([(0,u.$)("esri.views.3d.interactive.editingTools.transform.ScaleRotateMeshAdapter.InteractionState")],qs);let Xs=class extends _.A{constructor(e){super(e),this.sizeAxis=null,this._interactionState=null}initialize(){this.addHandles((0,a.when)((()=>null!=this._interactionState?this._interactionState.state:null),(e=>{this._updateSymbol(e)}),a.OH))}get initialAngle(){return this._interactionState?.initialAngle??0}get angle(){return null!=this._interactionState?this._interactionState.angle:null!=this._orientationReferenceSymbolLayer?(e=this._orientationReferenceSymbolLayer.heading??0,-(0,y.kU)(e)):0;var e}get angleClockwise(){return-this.angle}get orientation(){return this.angle}get orientationClockwise(){return this.angleClockwise}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){return this._interactionState?.scale??1}get size(){const e=this._sizeReferenceSymbolLayer;if(null==e)return null;const t=this.findLayerView(),n=this._graphicSymbol;if(null==t||null==n||"point-3d"!==n.type)return null;const i=t.getSymbolLayerSize(n,e);if("size"in i&&null!=i.size)return i.size;const r=this.sizeAxis;return!("width"in i)||null==i.width||null!=r&&"width"!==r&&"all"!==r&&"width-and-depth"!==r?!("depth"in i)||null==e.depth||null!=r&&"depth"!==r&&"all"!==r&&"width-and-depth"!==r?!("height"in i)||null==e.height||null!=r&&"height"!==r&&"all"!==r?null:i.height:i.depth:i.width}get _sizeReferenceSymbolLayer(){const e=this._graphicSymbol;return null==e||0===e.symbolLayers.length?null:e.symbolLayers.find((e=>"object"===e.type))}get _orientationReferenceSymbolLayer(){const e=this._graphicSymbol;return null==e||0===e.symbolLayers.length?null:e.symbolLayers.find((e=>"object"===e.type&&null!=e.heading))}get _graphicSymbol(){return null!=this.graphic?.symbol&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:null}set _graphicSymbol(e){this.graphic.symbol=e}startInteraction(){const e=this._graphicSymbol,t=this.findLayerView();if(null!=this._interactionState||null==e||null==t)return Ys;const n=e.symbolLayers.map((n=>"object"===n.type?t.getSymbolLayerSize(e,n):null)).toArray(),i=e.clone(),r=this.angle,s=new Ks({originalSymbol:i,angle:r,initialSizes:n});this._interactionState=s;const o=()=>{this._interactionState=null};return{state:s,done:o,cancel:()=>{this._graphicSymbol=i,o()}}}createUndoRecord(){let e=this.graphic.symbol,t=null;return{undo:n=>{t=n.symbol,n.symbol=e},redo:n=>{e=n.symbol,n.symbol=t}}}_updateSymbol({scale:e,angle:t,originalSymbol:n,initialSizes:i}){const r=this._graphicSymbol;if(null==r||"point-3d"!==r.type)return;const s=r.clone(),o=-(0,y.KJ)(t-this.initialAngle);let a=!1;this._forEachObjectSymbolLayerPair(n,s,((t,n,r)=>{const s=(t.heading??0)+o;n.heading!==s&&(n.heading=s,a=!0);const l=i[r];if(null!=l&&"width"in l){l.width=this.sizeFilter(l.width),l.height=this.sizeFilter(l.height),l.depth=this.sizeFilter(l.depth);const t=l.width*e;n.width!==t&&(n.width=t,a=!0);const i=l.depth*e;n.depth!==i&&(n.depth=i,a=!0);const r=l.height*e;n.height!==r&&(n.height=r,a=!0)}})),a&&(this._graphicSymbol=s)}_forEachObjectSymbolLayerPair(e,t,n){e.symbolLayers.forEach(((e,i)=>{const r=t.symbolLayers.at(i);"object"===e.type&&"object"===r.type&&n(e,r,i)}))}};(0,i._)([(0,l.MZ)()],Xs.prototype,"initialAngle",null),(0,i._)([(0,l.MZ)()],Xs.prototype,"angle",null),(0,i._)([(0,l.MZ)()],Xs.prototype,"angleClockwise",null),(0,i._)([(0,l.MZ)()],Xs.prototype,"orientation",null),(0,i._)([(0,l.MZ)()],Xs.prototype,"orientationClockwise",null),(0,i._)([(0,l.MZ)()],Xs.prototype,"relativeAngle",null),(0,i._)([(0,l.MZ)()],Xs.prototype,"relativeAngleClockwise",null),(0,i._)([(0,l.MZ)()],Xs.prototype,"scale",null),(0,i._)([(0,l.MZ)()],Xs.prototype,"size",null),(0,i._)([(0,l.MZ)()],Xs.prototype,"sizeAxis",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],Xs.prototype,"graphic",void 0),(0,i._)([(0,l.MZ)()],Xs.prototype,"_interactionState",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],Xs.prototype,"findLayerView",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],Xs.prototype,"sizeFilter",void 0),(0,i._)([(0,l.MZ)()],Xs.prototype,"_sizeReferenceSymbolLayer",null),(0,i._)([(0,l.MZ)()],Xs.prototype,"_orientationReferenceSymbolLayer",null),(0,i._)([(0,l.MZ)()],Xs.prototype,"_graphicSymbol",null),Xs=(0,i._)([(0,u.$)("esri.views.3d.interactive.editingTools.transform.ScaleRotateObjectSymbol3DAdapter")],Xs);const Ys={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let Ks=class extends _.A{get state(){const{originalSymbol:e,angle:t,initialAngle:n,scale:i,initialSizes:r}=this;return{originalSymbol:e,angle:t,initialAngle:n,scale:i,initialSizes:r}}constructor(e){super(e),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=e.angle}};(0,i._)([(0,l.MZ)()],Ks.prototype,"originalSymbol",void 0),(0,i._)([(0,l.MZ)()],Ks.prototype,"angle",void 0),(0,i._)([(0,l.MZ)()],Ks.prototype,"initialAngle",void 0),(0,i._)([(0,l.MZ)()],Ks.prototype,"initialSizes",void 0),(0,i._)([(0,l.MZ)()],Ks.prototype,"scale",void 0),(0,i._)([(0,l.MZ)()],Ks.prototype,"state",null),Ks=(0,i._)([(0,u.$)("esri.views.3d.interactive.editingTools.transform.ScaleRotateObjectSymbol3DAdapter.InteractionState")],Ks);var Qs=n(16691),Js=n(74087);let eo=class extends cs.w{constructor(e){super(e),this.type="transform-absolute",this.orientation=null,this.orientationPrecision=null,this.rotationType="geographic",this.size=null,this.sizePrecision=null,this.sizeUnit=null}};(0,i._)([(0,l.MZ)()],eo.prototype,"type",void 0),(0,i._)([(0,l.MZ)()],eo.prototype,"orientation",void 0),(0,i._)([(0,l.MZ)()],eo.prototype,"orientationPrecision",void 0),(0,i._)([(0,l.MZ)()],eo.prototype,"rotationType",void 0),(0,i._)([(0,l.MZ)()],eo.prototype,"size",void 0),(0,i._)([(0,l.MZ)()],eo.prototype,"sizePrecision",void 0),(0,i._)([(0,l.MZ)()],eo.prototype,"sizeUnit",void 0),eo=(0,i._)([(0,u.$)("esri.views.interactive.tooltip.infos.TransformAbsoluteTooltipInfo")],eo);let to=class extends cs.w{constructor(e){super(e),this.type="transform-rotate",this.rotation=null,this.rotationPrecision=null,this.orientation=null,this.orientationPrecision=null,this.rotationType="geographic"}};(0,i._)([(0,l.MZ)()],to.prototype,"type",void 0),(0,i._)([(0,l.MZ)()],to.prototype,"rotation",void 0),(0,i._)([(0,l.MZ)()],to.prototype,"rotationPrecision",void 0),(0,i._)([(0,l.MZ)()],to.prototype,"orientation",void 0),(0,i._)([(0,l.MZ)()],to.prototype,"orientationPrecision",void 0),(0,i._)([(0,l.MZ)()],to.prototype,"rotationType",void 0),to=(0,i._)([(0,u.$)("esri.views.interactive.tooltip.infos.TransformRotateTooltipInfo")],to);let no=class extends cs.w{constructor(e){super(e),this.type="transform-scale",this.size=null,this.sizeUnit=null,this.sizePrecision=null}};var io,ro;(0,i._)([(0,l.MZ)()],no.prototype,"type",void 0),(0,i._)([(0,l.MZ)()],no.prototype,"scale",void 0),(0,i._)([(0,l.MZ)()],no.prototype,"size",void 0),(0,i._)([(0,l.MZ)()],no.prototype,"sizeUnit",void 0),(0,i._)([(0,l.MZ)()],no.prototype,"sizePrecision",void 0),no=(0,i._)([(0,u.$)("esri.views.interactive.tooltip.infos.TransformScaleTooltipInfo")],no),(ro=io||(io={})).ScaleIn=Di.SJ.Custom2,ro.ScaleOut=Di.SJ.Custom3,ro.RotateLeft=Di.SJ.Custom4,ro.RotateRight=Di.SJ.Custom5,ro.Unlocked=Di.SJ.Custom7,ro.DelayedFocused=Di.SJ.Custom8,ro.TouchInput=Di.SJ.Custom12;let so=class extends _.A{get angle(){return this.adapter.angle}get scale(){return this.adapter.scale}set location(e){this._ringManipulator.location=e}set elevationAlignedLocation(e){this._ringManipulator.elevationAlignedLocation=e}get grabbing(){return this._ringManipulator.grabbing}set interactive(e){this._ringManipulator.interactive=e}get updating(){return!!this._activeAnimation}get tooltipEffectiveEnabled(){return this.sketchOptions.tooltips.effectiveEnabled&&this.tooltipEnabled}constructor(e){super(e),this.mode=null,this.tooltipEnabled=!0,this._scaleRotateDragData=null,this._activeAnimation=null,this._ringIndicatorDelayMs=200,this._absoluteTooltipInfo=null,this._scaleTooltipInfo=null,this._rotateTooltipInfo=null,this.events=new _n.A,this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>"scale"===this._scaleRotateDragData?.mode?this.adapter.scale:1}initialize(){this.tooltip=new os.m({view:this.tool.view}),this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this.addHandles([(0,a.when)((()=>!this.tooltipEffectiveEnabled),(()=>this.tooltip.clear()),a.Vh),(0,a.watch)((()=>{const{adapter:e}=this,{info:t}=this.tooltip;return t===this._absoluteTooltipInfo&&this.getFocused()?[t,e.size,e.orientationClockwise]:[null]}),(([e])=>{e&&this._updateFocusTooltip()})),(0,a.watch)((()=>{const{adapter:e}=this;return[e.angle,e.scale]}),(()=>this._updateManipulatorTransform()))])}destroy(){this._activeAnimation?.frameTask.remove(),this._activeAnimation=null,this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null,this.tooltip=(0,o.pR)(this.tooltip)}startAnimation(e){this.cancelActiveAnimation(),e.start();const t=(0,Js.mg)({update:({deltaTime:t})=>{e.update(t)&&this.cancelActiveAnimation()}});this._activeAnimation={...e,frameTask:t}}cancelActiveAnimation(){this._activeAnimation?.frameTask.remove(),this._activeAnimation=(0,o.pR)(this._activeAnimation)}forEachManipulator(e){e(this._ringManipulator,Ji.SCALE_ROTATE)}_createManipulator(){const e=this._createRingManipulator();this._ringManipulator=e,this.tool.manipulators.add(e);const t=this.tool.object,n=(0,Tr.Xt)(e,((e,n,i)=>{this._scaleRotateDragData=null;const r=this.adapter.startInteraction(),s={mode:"none",origin:(0,d.o8)(e.renderLocation),initialAngle:this.adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=s,this._updateDragState();const o=A.rq.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(e.renderLocation,o),n.next(Er(this.tool.view,(0,Mi.O_)(e.renderLocation,o,(0,Mi.vt)()))).next((e=>{const n=(0,Mi.Qj)(e.plane),i=Ur(e.renderStart,e.renderEnd,s.origin,n),o=Qs.wf.shortestSignedDiff(s.angle,i);s.angleDir=(0,y.qE)(s.angleDir+o,-.3,.3),s.angle=i;const a=function(e,t){const n=(0,h.f)(A.rq.get(),t.renderStart,e.origin),i=(0,h.f)(A.rq.get(),t.renderEnd,e.origin),r=(0,h.l)(n),s=(0,h.l)(i);return 0===r?0:s/r}(s,e),l=a-this.adapter.scale;if(s.scaleDir=(0,y.qE)(s.scaleDir+l,-.2,.2),this._onScaleChanged(),"none"===s.mode){const n=this.mode||function(e,t,n,i){const{renderStart:r,renderEnd:s}=e,o=oo(r,i,A.rq.get()),a=oo(s,i,A.rq.get());if((0,h.a)(o,a)<100)return null;const l=(0,h.f)(A.rq.get(),r,n),c=(0,h.b)(A.rq.get(),l,(0,Mi.Qj)(t)),u=r,d=(0,h.g)(A.rq.get(),u,c),p=oo(n,i,A.rq.get()),f=o,m=oo(d,i,A.rq.get()),g=(0,h.f)(A.rq.get(),m,f),_=(0,h.f)(A.rq.get(),o,p),v=(0,ee.LV)(f,g),y=(0,ee.LV)(p,_);return(0,ee.kb)(v,a)<(0,ee.kb)(y,a)?"rotate":"scale"}(e,e.plane,s.origin,this.tool.view.state.camera);if(null!=n){switch(n){case"rotate":this.tool.events.emit("rotate-start",{object:t,angle:0}),this.tool.events.emit("record-undo",{updates:[this.adapter.createUndoRecord()]});break;case"scale":this.tool.events.emit("scale-start",{object:t,xScale:1,yScale:1}),this.tool.events.emit("record-undo",{updates:[this.adapter.createUndoRecord()]})}s.mode=n}}switch(s.mode){case"rotate":r.state.angle=s.initialAngle+i;break;case"scale":r.state.scale=a,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),e.action){case"start":case"update":switch(s.mode){case"rotate":this.tool.events.emit("rotate",{object:t,angle:(0,y.KJ)(s.angle)});break;case"scale":this.tool.events.emit("scale",{object:t,xScale:a,yScale:a})}break;case"end":switch(s.mode){case"rotate":this.tool.events.emit("rotate-stop",{object:t,angle:(0,y.KJ)(s.angle)});break;case"scale":this.tool.events.emit("scale-stop",{object:t,xScale:a,yScale:a})}}return"end"===e.action&&(this.startAnimation(lo(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState(),r.done()),e})).next(this._updateTooltipPipelineStep(s)),i.next((()=>{if(r.cancel(),null!=this._scaleRotateDragData){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.events.emit("rotate-stop",{object:t,angle:0});break;case"scale":this.tool.events.emit("scale-stop",{object:t,xScale:1,yScale:1})}this.startAnimation(lo(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState()}this._updateFocusTooltip()}))}));this.addHandles([n,e.events.on("focus-changed",(e=>{"focus"===e.action?this.startAnimation(function(e,t,n){let i=0,r=null;const s=()=>!1;return{start:()=>{r=e.getFocused,e.getFocused=s,i=0,t()},update:e=>(i+=e,!r?.()||i>=n.delayMs?ao.STOP:ao.CONTINUE),destroy:()=>{r&&(e.getFocused=r),t()}}}(this,(()=>this._updateDelayedFocusedState()),{delayMs:this._ringIndicatorDelayMs})):this._updateDelayedFocusedState()})),e.events.on("immediate-click",(e=>{e.stopPropagation()})),(0,a.watch)((()=>this.tool.object.visible),(e=>this._ringManipulator.available=e),a.Vh)])}_updateTooltipPipelineStep(e){return t=>{const{sketchOptions:n}=this,{visualVariables:i}=n.tooltips;if(!this.tooltipEffectiveEnabled)return t;if("end"===t.action)return this._updateFocusTooltip(),t;const{tooltip:r}=this;switch(e.mode){case"scale":{r.info=this._scaleTooltipInfo??=new no({sketchOptions:n});const{size:e,scale:t}=this.adapter,s=i?.size,o=r.info;o.sketchOptions=n,o.scale=(0,si.LF)(t),o.size=null!=e?(0,si.d_)(e,"meters"):void 0,o.sizePrecision=co(s?.valueType),o.sizeUnit=s?.unit;break}case"rotate":{r.info=this._rotateTooltipInfo??=new to({sketchOptions:n});const{orientationClockwise:e,relativeAngleClockwise:t}=this.adapter,s=i?.rotation,o=co(s?.valueType),a=r.info;a.sketchOptions=n,a.rotation=null!=t?(0,si.Wq)(t,"radians","geographic"):void 0,a.rotationPrecision=o,a.rotationType=s?.rotationType??"geographic",a.orientation=null!=e?(0,si.Wq)(e,"radians","geographic"):void 0,a.orientationPrecision=o;break}}return t}}_updateFocusTooltip(){const{sketchOptions:e,tooltip:t}=this,{visualVariables:n}=e.tooltips;if(this.tooltipEffectiveEnabled)if(this.getFocused()){const i=n?.rotation,r=n?.size,s=this.mode,{size:o,orientationClockwise:a}=this.adapter,l=null!=a&&(null==s||"rotate"===s),c=null!=o&&(null==s||"scale"===s);t.info=this._absoluteTooltipInfo??=new eo({sketchOptions:e});const u=t.info;u.sketchOptions=e,u.orientation=l?(0,si.Wq)(a,"radians","geographic"):void 0,u.orientationPrecision=co(i?.valueType),u.rotationType=i?.rotationType??"geographic",u.size=c?(0,si.d_)(o,"meters"):void 0,u.sizeUnit=r?.unit,u.sizePrecision=co(r?.valueType)}else t.clear()}_onScaleChanged(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled(io.DelayedFocused,this.getFocused()),this._updateFocusTooltip()}_updateDragState(){if(this._ringManipulator.updateStateEnabled(io.Unlocked,!(null!=this._scaleRotateDragData&&"none"!==this._scaleRotateDragData?.mode)),null!=this._scaleRotateDragData)switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(io.ScaleIn|io.ScaleOut,!1),this._ringManipulator.updateStateEnabled(io.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(io.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(io.RotateLeft|io.RotateRight,!1),this._ringManipulator.updateStateEnabled(io.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(io.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(io.ScaleIn|io.ScaleOut|io.RotateLeft|io.RotateRight,!1)}_updateManipulatorTransform(){const e=(0,St.$0)(A.Rc.get(),this.adapter.angle,(0,d.fA)(0,0,1));if(null==e)return;const t=this.getScale(),n=(0,St.CV)(A.Rc.get(),(0,h.s)(A.rq.get(),t,t,t));this._ringManipulator.modelTransform=(0,St.lw)(A.Rc.get(),n,e)}_createRingManipulator(){const e=(e,t,n)=>{const i=[],r=Math.ceil(128*(t-e)/(2*Math.PI));for(let s=0;s<r+1;s++){const o=e+s*(t-e)/r;i.push((0,d.fA)(n*Math.cos(o),n*Math.sin(o),0))}return i},t=t=>e(0,2*Math.PI,t),n=this._createMaterial(1),i=(e,t,i=n)=>(0,Xe.Nq)(i,(e=>[[-e/2,0],[e/2,0],[e/2,.25],[-e/2,.25]])(t),e,[],[],!1),r=t(160),s=i(r,24),o={left:new Array,right:new Array},a=[];for(let t=0;t<2;t++){const r=t*Math.PI-Math.PI/4,s=Math.PI/2-fr,l=r+s,c=r+Math.PI/2-s,u=e(l,c,190),h=i(u,9);a.push(u),a.push(e(l,c,201)),o.left.push(h),o.right.push(h.instantiate());for(let e=0;e<2;e++){const t=0===e,i=(0,wt.vt)();if(t){(0,St.hs)(i,i,[1,-1,1]),(0,St.e$)(i,i,-l,[0,0,1]);const e=Math.round(.2*(u.length-1));i[12]=u[e][0],i[13]=u[e][1],i[14]=u[e][2]}else{(0,St.e$)(i,i,c,[0,0,1]);const e=Math.round(.8*(u.length-1));i[12]=u[e][0],i[13]=u[e][1],i[14]=u[e][2]}const r=(0,Xe._B)(n,60,0,23,.5);(0,Xe.xh)(r,i),(t?o.left:o.right).push(r)}}const l=[];for(let t=0;t<2;t++){const n=t*Math.PI-Math.PI/4,r=Math.PI/2-mr,s=n+r,o=n+Math.PI/2-r,a=e(s,o,213);l.push(i(a,9))}const c=this._createMaterial(.66),u=this._createMaterial(.5),h=this._createMaterial(.33),p=t(190),f=t(213),m=i(p,9,c),g=i(f,9,h),_=t(130),v=t(107),y=i(_,9,c),b=i(v,9,h);let T=[new vr(s,io.DelayedFocused),new vr(s.instantiate({material:u}),Di.p7.None)];this.mode&&"scale"!==this.mode||(T=T.concat([...l.map((e=>new vr(e,io.DelayedFocused|io.Unlocked))),new vr(m,io.DelayedFocused|io.ScaleIn),new vr(g,io.DelayedFocused|io.ScaleIn),new vr(y,io.DelayedFocused|io.ScaleOut),new vr(b,io.DelayedFocused|io.ScaleOut)])),this.mode&&"rotate"!==this.mode||(T=T.concat([...o.right.map((e=>new vr(e.instantiate(),io.DelayedFocused|io.Unlocked))),...o.left.map((e=>new vr(e,io.DelayedFocused|io.RotateLeft))),...o.right.map((e=>new vr(e,io.DelayedFocused|io.RotateRight)))]));const E=[r,...a];return new Ni({view:this.tool.view,renderObjects:T,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:this.tool.object.elevationInfo,collisionType:{type:"ribbon",paths:E,direction:(0,d.fA)(0,0,1)}})}_createMaterial(e){const t=new zt.v({cullFace:wn.s2.Back,renderOccluded:Ye.m$.Transparent,isDecoration:!0});return this.addHandles((0,a.watch)((()=>({color:(0,r.f6)(this.tool.view.effectiveTheme.accentColor,e)})),(e=>t.setParameters(e)),a.Vh)),t}get test(){}};function oo(e,t,n){return t.projectToScreen(e,uo),(0,h.s)(n,uo[0],uo[1],0)}var ao;function lo(e,t){let n=null,i=1;const r=()=>i;return{start:()=>{i=e.getScale(),n=e.getScale,e.getScale=r,t()},update:e=>(i+=((i+1)/2-i)*Math.min(3*e,1),t(),Math.abs(i-1)<.01?ao.STOP:ao.CONTINUE),destroy:()=>{n&&(e.getScale=n),t()}}}function co(e){switch(e){case"integer":case"long":return 0;default:return null}}(0,i._)([(0,l.MZ)({constructOnly:!0})],so.prototype,"tool",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],so.prototype,"adapter",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],so.prototype,"sketchOptions",void 0),(0,i._)([(0,l.MZ)()],so.prototype,"mode",void 0),(0,i._)([(0,l.MZ)()],so.prototype,"tooltipEnabled",void 0),(0,i._)([(0,l.MZ)()],so.prototype,"_activeAnimation",void 0),(0,i._)([(0,l.MZ)()],so.prototype,"updating",null),(0,i._)([(0,l.MZ)()],so.prototype,"tooltipEffectiveEnabled",null),so=(0,i._)([(0,u.$)("esri.views.3d.interactive.editingTools.transform.ScaleRotateTransform")],so),function(e){e[e.CONTINUE=0]="CONTINUE",e[e.STOP=1]="STOP"}(ao||(ao={}));const uo=(0,m.gs)();var ho=n(18063),po=n(73919);let fo=class extends((0,po.B)(cs.w)){constructor(e){super(e),this.type="transform-mesh",this.orientation=(0,ho.LJ)({actual:null,lockable:!1}),this.scale=(0,ho.dy)({actual:null,lockable:!1}),this.allFields.forEach((e=>{e.lockable=!1,e.setActual(null)}))}get key(){return{longitude:this.longitude.actual,latitude:this.latitude.actual,x:this.x.actual,y:this.y.actual,elevation:this.elevation.actual,geographic:this.geographic,orientation:this.orientation.actual,scale:this.scale.actual}}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};(0,i._)([(0,l.MZ)()],fo.prototype,"key",null),(0,i._)([(0,l.MZ)()],fo.prototype,"allFields",null),fo=(0,i._)([(0,u.$)("esri.views.interactive.tooltip.infos.TransformMeshTooltipInfo")],fo);let mo=class extends((0,po.B)(cs.w)){constructor(e){super(e),this.type="transform-point",this.allFields.forEach((e=>{e.lockable=!1,e.setActual(null)}))}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};(0,i._)([(0,l.MZ)()],mo.prototype,"allFields",null),mo=(0,i._)([(0,u.$)("esri.views.interactive.tooltip.infos.TransformPointTooltipInfo")],mo);let go=class extends ts.g{constructor(e){super(e),this.events=new _n.A,this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.sketchOptions=new is.A,this.type="transform-3d",this._updatingHandles=new oi.U,this._scaleRotate=null}initialize(){const{events:e,object:t,view:n}=this;this.tooltip=new os.m({view:n}),this._moveManipulation=new Xr({tool:this,view:n,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&hi(t.operations,t.elevationInfo),radius:Xr.radiusForSymbol(t.graphic?.symbol)}),this._moveManipulation.forEachManipulator((t=>this.addHandles(t.events.on("immediate-click",(t=>{e.emit("immediate-click",{...t,object:this.object}),t.stopPropagation()})))));const i=t.elevationInfo;if(this._moveManipulation.elevationInfo=i,this.addHandles(en(t)),this._moveManipulation.createManipulatedObjectDragPipeline(((e,r,s,o,a)=>{if(e===Kr.XY){const{snappingStep:e,cancelSnapping:r}=(0,ss.L)({snappingContext:new rs.e({elevationInfo:i,pointer:a,editGeometryOperations:ns.p.fromGeometry(new Li.default({spatialReference:t.operations?.data.spatialReference}),n.state.viewingMode),visualizer:new qt,excludeFeature:t.graphic}),snappingManager:this.snappingManager,updatingHandles:this._updatingHandles,useZ:!1});o=o.next(r),s=s.next((0,Tr.RS)(this.view,i)).next(...e)}return{steps:s,cancel:o}}),t,(t=>{const{action:n,object:i,dxScreen:r,dyScreen:s}=t,o={object:i,dxScreen:r,dyScreen:s};switch(n){case"start":this._emitRecordUndo(),e.emit("translate-start",o);break;case"update":e.emit("translate",o);break;case"end":e.emit("translate-stop",o)}})),this._moveManipulation.angle=null!=this._scaleRotate?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.addHandles((0,a.watch)((()=>this._scaleRotateAdapter.angle),(()=>this._updateMoveAngle()))),this.enableScaling||this.enableRotation){const e=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this._scaleRotate=new so({tool:this,mode:e,adapter:this._scaleRotateAdapter,sketchOptions:this.sketchOptions,tooltipEnabled:"mesh"!==ui(t)?.type}),this.addHandles(this._scaleRotate.events.on("scale-changed",(()=>this._onScaleChanged())))}this.addHandles([hr({view:this.view,object:t,forEachManipulator:e=>this._forEachManipulator(e),onManipulatorsChanged:()=>(0,s.hA)()}),t.on("committed",(()=>this._onGeometryChanged())),this._hideManipulatorsForObjectState(),(0,a.watch)((()=>n.scale),(()=>this._updateMoveAngle()))].filter(ii.Ru)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator((e=>{e instanceof Ni&&this.addHandles(e.events.on("grab-changed",(()=>this._updateManipulatorsInteractive())))}));const r=n?.type,{sketchOptions:o}=this;this._meshTooltipInfo=new fo({viewType:r,sketchOptions:o}),this._pointTooltipInfo=new mo({viewType:r,sketchOptions:o});const l={object:t,dxScreen:0,dyScreen:0},c={onMoveStart:()=>{this._emitRecordUndo(),e.emit("translate-start",{...l})},onMove:()=>e.emit("translate",{...l}),onMoveStop:()=>e.emit("translate-stop",{...l}),onRotateStart:n=>{this._emitRecordUndo(),e.emit("rotate-start",{object:t,angle:n})},onRotate:n=>e.emit("rotate",{object:t,angle:n}),onRotateStop:n=>e.emit("rotate-stop",{object:t,angle:n}),onScaleStart:(n,i)=>{this._emitRecordUndo(),e.emit("scale-start",{object:t,xScale:n,yScale:i})},onScale:(n,i)=>e.emit("scale",{object:t,xScale:n,yScale:i}),onScaleStop:(n,i)=>e.emit("scale-stop",{object:t,xScale:n,yScale:i})};this.addHandles(fi(this.tooltip,this.object,(()=>({sketchOptions:this.sketchOptions,activeTooltipInfo:this.activeTooltipInfo,callbacks:c})))),this.finishToolCreation()}destroy(){this.tooltip.destroy(),this._moveManipulation.destroy(),this._scaleRotate=(0,o.pR)(this._scaleRotate),this._scaleRotateAdapter=(0,o.pR)(this._scaleRotateAdapter),this._updatingHandles.destroy(),this._set("view",null),this._set("object",null)}onInputEvent(e){if(!this.destroyed&&!(0,Qn.wG)(e,this.tooltip))return super.onInputEvent(e)}_updateManipulatorsInteractive(){null!=this._scaleRotate&&(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}_createScaleRotateAdapter(){const e=ui(this.object);return"mesh"===e?.type?new Ws({object:this.object,geometry:e,viewingMode:this.view.state.viewingMode}):new Xs({graphic:this.object.graphic,sizeFilter:e=>this._enforceNonZeroSize(e),findLayerView:()=>this.view.allLayerViews.find((e=>e.layer===this.object.graphic?.layer)),sizeAxis:this.sketchOptions?.tooltips?.visualVariables?.size?.axis??null})}_forEachManipulator(e){this._moveManipulation?.forEachManipulator(e),this._scaleRotate?.forEachManipulator(e)}_hideManipulatorsForObjectState(){return(0,a.watch)((()=>this.object.visible),(e=>{this._forEachManipulator((t=>t.available=e)),this._moveManipulation.zManipulation.available=e&&this.enableZ&&hi(this.object.operations,this.object.elevationInfo)}))}_emitRecordUndo(){this.events.emit("record-undo",{updates:[this.object.createUndoRecord()]})}set snapToScene(e){this._moveManipulation&&(this._moveManipulation.snapToScene=e),this._set("snapToScene",e)}get updating(){return this._updatingHandles.updating||!!this._scaleRotate?.updating}get activeTooltipInfo(){return null!=this._scaleRotate?.tooltip?.info?null:"mesh"===ui(this.object)?.type?this._meshTooltipInfo:this._pointTooltipInfo}set location(e){this._moveManipulation.location=e,this._scaleRotate&&(this._scaleRotate.location=e)}set elevationAlignedLocation(e){this._moveManipulation.elevationAlignedLocation=e,this._scaleRotate&&(this._scaleRotate.elevationAlignedLocation=e)}reset(){}onHide(){this._scaleRotate?.cancelActiveAnimation()}_onScaleChanged(){null!=this._scaleRotate&&(this._moveManipulation.displayScale=this._scaleRotate.getScale())}_updateMoveAngle(){const{view:e}=this,t=e.state.viewingMode===pe.RT.Local||e.scale<1e6;this._moveManipulation.angle=t?this._scaleRotateAdapter.angle:0}_onGeometryChanged(){jr(this,this.object)}_enforceNonZeroSize(e){return e||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}get test(){}};(0,i._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],go.prototype,"view",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],go.prototype,"object",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],go.prototype,"enableZ",void 0),(0,i._)([(0,l.MZ)()],go.prototype,"enableRotation",void 0),(0,i._)([(0,l.MZ)()],go.prototype,"enableScaling",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0,type:is.A})],go.prototype,"sketchOptions",void 0),(0,i._)([(0,l.MZ)({value:!1})],go.prototype,"snapToScene",null),(0,i._)([(0,l.MZ)({constructOnly:!0})],go.prototype,"snappingManager",void 0),(0,i._)([(0,l.MZ)({readOnly:!0})],go.prototype,"type",void 0),(0,i._)([(0,l.MZ)({readOnly:!0})],go.prototype,"updating",null),(0,i._)([(0,l.MZ)()],go.prototype,"activeTooltipInfo",null),go=(0,i._)([(0,u.$)("esri.views.3d.interactive.editingTools.transform.TransformTool3D")],go);var _o=n(75743),vo=n(30905),yo=n(77560),bo=n(67888),To=n(18627);let Eo=class extends((0,_o.O)(vo.oY)){constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&(0,o.CM)(this.position,e.position)&&this.width===e.width&&this.height===e.height}};(0,i._)([(0,l.MZ)({readOnly:!0,json:{read:!1,write:!0}})],Eo.prototype,"type",void 0),(0,i._)([(0,l.MZ)({type:Li.default}),(0,To.P)()],Eo.prototype,"position",void 0),(0,i._)([(0,l.MZ)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,To.P)(),(0,yo.w)((e=>Qs.ie.normalize((0,bo.GB)(e),0,!0)))],Eo.prototype,"heading",void 0),(0,i._)([(0,l.MZ)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,To.P)(),(0,yo.w)((e=>Qs.ie.normalize((0,bo.GB)(e),0,!0)))],Eo.prototype,"tilt",void 0),(0,i._)([(0,l.MZ)({type:Number,nonNullable:!0}),(0,To.P)()],Eo.prototype,"width",void 0),(0,i._)([(0,l.MZ)({type:Number,nonNullable:!0}),(0,To.P)()],Eo.prototype,"height",void 0),Eo=(0,i._)([(0,u.$)("esri.analysis.SlicePlane")],Eo),n(72485);var xo=n(2075);(0,Et.fA)(0,0,0,.04),(0,c.A)("mac");const So=1.15,wo=1.15,Ao=(Math.cos((0,y.kU)(45)),Math.cos((0,y.kU)(5)),3),Mo=11,Oo=22.5,Ro=.3;(0,wt.vt)();var Co,Io=n(84264),Po=n(73318),Do=n(27291),Lo=n(29829);Fe.Y;class No extends ye.w{initializeProgram(e){return new be.B(e.rctx,No.shader.get().build(this.configuration),ze.D)}initializePipeline(){return(0,Se.Ey)({blending:(0,Se.p3)(xe.dn.ONE,xe.dn.ONE,xe.dn.ONE_MINUS_SRC_ALPHA,xe.dn.ONE_MINUS_SRC_ALPHA),depthTest:{func:xe.MT.LESS},colorWrite:Se.wE})}}function Fo(e){const t=(0,h.l)(e.basis1),n=(0,h.l)(e.basis2);return Ro*Math.min(t,n)}function zo(e){return Fo(e)}function Vo(e){return 0!==e.direction[0]&&0!==e.direction[1]}No.shader=new ve.$(Lo.S,(()=>n.e(4758).then(n.bind(n,94133)))),Do.W,On.A,n(96611),n(56919),n(90599),(0,d.vt)(),(0,d.vt)(),n(91484),function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y"}(Co||(Co={}));const Ho=Di.SJ.Custom1;var Uo,ko;!function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"}(Uo||(Uo={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"}(ko||(ko={}));const jo=Di.SJ.Custom2,Go=((0,ee.vt)(),Math.PI/2),Bo=Di.SJ.Custom1,$o=Di.SJ.Custom2;var Zo,Wo=n(32237);!function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"}(Zo||(Zo={}));class qo extends Ni{constructor(e,t){const n=new Qe.W({width:1,renderOccluded:Ye.m$.OccludeAndTransparent,isDecoration:!0}),i=new zt.v({cullFace:wn.s2.Back,renderOccluded:Ye.m$.Opaque,isDecoration:!0}),s=new zt.v({cullFace:wn.s2.Back,renderOccluded:Ye.m$.Opaque,isDecoration:!0}),o=new zt.v({cullFace:wn.s2.Back,renderOccluded:Ye.m$.Opaque,isDecoration:!0}),l=new zt.v({writeDepth:!1,cullFace:wn.s2.Front,renderOccluded:Ye.m$.Transparent,isDecoration:!0});super({view:e,...Xo({offsetMode:t,tubeMaterial:i,tipMaterial:s,capMaterial:o,outlineMaterial:l,calloutMaterial:n})}),this._themeHandle=(0,a.watch)((()=>e.effectiveTheme.accentColor),(e=>{const t=(0,r.bJ)(e),a=g.A.toUnitRGBA(e),c=g.A.toUnitRGBA(t),u=g.A.toUnitRGBA(g.A.blendColors(t,e,.4)),h=g.A.toUnitRGBA(g.A.blendColors(t,e,.14));n.setParameters({color:a}),i.setParameters({color:h}),s.setParameters({color:c}),o.setParameters({color:u}),l.setParameters({color:a})}),a.Vh)}destroy(){this._themeHandle.remove(),super.destroy()}}function Xo({offsetMode:e,tubeMaterial:t,tipMaterial:n,capMaterial:i,outlineMaterial:r,calloutMaterial:s}){const o=e===Zo.CENTER_ON_CALLOUT?40:0,a=[(0,d.fA)(o,0,-24),(0,d.fA)(o,0,24)],l=function(e,t){const n=(0,h.f)((0,d.vt)(),e[e.length-1],e[e.length-2]);(0,h.n)(n,n),(0,h.j)(n,n,Oo),(0,h.g)(n,n,e[e.length-1]);{const t=(0,h.f)((0,d.vt)(),e[0],e[1]);return(0,h.n)(t,t),(0,h.j)(t,t,Oo),(0,h.g)(t,t,e[0]),[t,...e,n]}}(a),c=Yo({vertices:a,padding:0,materials:{tube:t,tip:n,cap:i}}),u=Yo({vertices:a,padding:2.25,materials:{tube:r,tip:r,cap:r}}),p=(0,Xe.Z8)(s,[[o,0,0],[o-40,0,0]]),f=(0,Xe.Z8)(s,[[o,0,0],[o-40,0,0]]);return{renderObjects:[...c.normal.map((e=>new vr(e,Di.p7.Unfocused|Ho))),...u.normal.map((e=>new vr(e,Di.p7.Unfocused|Ho))),new vr(p,Di.p7.Unfocused|Ho|jo),...c.focused.map((e=>new vr(e,Di.p7.Focused|Ho))),...u.focused.map((e=>new vr(e,Di.p7.Focused|Ho))),new vr(f,Di.p7.Focused|Ho|jo)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[l]},collisionPriority:1,radius:Mo,state:Ho}}function Yo({vertices:e,padding:t,materials:n}){const i=i=>{const r=e.slice(0),s=(0,h.f)(A.rq.get(),r[0],r[1]);(0,h.n)(s,s);const o=(0,h.f)(A.rq.get(),r[r.length-1],r[r.length-2]);if((0,h.n)(o,o),t>0){const e=(0,h.j)((0,d.vt)(),o,-t);r[r.length-1]=(0,h.g)(e,e,r[r.length-1]);const n=(0,h.j)((0,d.vt)(),s,-t);r[0]=(0,h.g)(n,n,r[0])}const a=i?wo:1,l=Oo*a,c=Mo*a,u=(0,St.D_)(A.Rc.get());if(t>0){const e=l/4,n=(0,h.s)(A.rq.get(),0,e,0),i=1+t/e;(0,St.Tl)(u,u,n),(0,St.hs)(u,u,(0,h.s)(A.rq.get(),i,i,i)),(0,St.Tl)(u,u,(0,h.j)(n,n,-1/i))}const p=(0,St.D_)((0,wt.vt)()),f=(0,d.fA)(0,1,0),m=(0,St.I0)((0,wt.vt)(),(0,Wo.Yc)(A.J8.get(),f,o));m[12]=r[r.length-1][0],m[13]=r[r.length-1][1],m[14]=r[r.length-1][2],(0,St.lw)(m,m,u);const g=n.tube,_=function(e,t,n){const i=[];for(let t=0;t<12;t++){const n=t/12*2*Math.PI;i.push([Math.cos(n)*e,Math.sin(n)*e])}return(0,Xe.Nq)(n,i,t,[],[],!1)}(Ao*(i?So:1)+t,r,g);_.transformation=p;const v=[_],y=n.tip,b=(0,Xe.EE)(y,l,c,24,!1,!1,!0);b.transformation=m,v.push(b);const T=n.cap,E=(0,Xe.EE)(T,l,c,24,!1,!0,!1);E.transformation=m,v.push(E);const x=(0,St.I0)((0,wt.vt)(),(0,Wo.Yc)(A.J8.get(),f,s));return x[12]=r[0][0],x[13]=r[0][1],x[14]=r[0][2],(0,St.lw)(x,x,u),v.push(b.instantiate({transformation:x})),v.push(E.instantiate({transformation:x})),v};return{normal:i(!1),focused:i(!0)}}class Ko{get _object(){return this._tool.object}get _operations(){return this._object.operations}constructor(e,t){this._tool=e,this._bounds=t,this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null;const n=this._tool,i=n.view;this.moveXYObjectManipulation=new Jr({view:i,tool:n,object:this._object}),n.addHandles(this._createMoveXYObjectDragPipeline()),this.moveZManipulator=new qo(i,Zo.CENTER_ON_CALLOUT),this.moveZManipulator.state|=jo,n.manipulators.add(this.moveZManipulator),n.addHandles([this._createMoveZDragPipeline()]),n.addHandles([n.events.on("translate-stop",(()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null}))])}destroy(){this.moveXYObjectManipulation.destroy(),this._tool.manipulators.remove(this.moveZManipulator),this.moveZManipulator.destroy()}forEachManipulator(e){this.moveXYObjectManipulation.forEachManipulator(e),e(this.moveZManipulator,Ji.TRANSLATE_Z)}updateManipulators(e,t){const n=this.moveZManipulator,i=(0,St.Qr)(A.Rc.get(),e,Math.PI);i[12]=0,i[13]=0,i[14]=0,n.modelTransform=i,n.renderLocation=(0,h.f)(A.rq.get(),t.origin,t.basis1)}getUpdatedTooltipInfo(){return this.moveXYObjectManipulation.grabbing||this.moveXYObjectManipulation.dragging?this._computeMoveXYTooltipInfo():this.moveZManipulator.focused?this._computeMoveZTooltipInfo():null}_computeMoveXYTooltipInfo(){const e=this._tool,t=this._moveXYTooltipInfo??=new ls.M({sketchOptions:e.sketchOptions});if(this.moveXYObjectManipulation.dragging){const n=this._bounds,i=n.mapBoundsStart.origin,r=n.mapBounds.origin,{renderSpatialReference:s}=e.view;if(!s)return null;const o=(0,N.Do)(i,r,s);if(null==o)return null;t.distance=o}else t.distance=si.r7;return t}_computeMoveZTooltipInfo(){const e=this._tool,t=this._moveZTooltipInfo??=new hs({sketchOptions:e.sketchOptions});if(this.moveZManipulator.dragging){const n=this._bounds,i=n.mapBoundsStart.origin,r=n.mapBounds.origin,{renderSpatialReference:s}=e.view;if(!s)return null;const o=(0,pi.cL)(i,r,s);if(null==o)return null;t.distance=o}else t.distance=si.r7;return t}_createMoveXYObjectDragPipeline(){return this.moveXYObjectManipulation.createDragPipeline(((e,t,n)=>this._applyObjectMoveSteps(t,n)))}_createMoveZDragPipeline(){if(!this._operations)return(0,s.hA)();const e=this._operations.data.spatialReference;return(0,Tr.Xt)(this.moveZManipulator,((t,n,i)=>{const r=(0,d.o8)(t.renderLocation),s=n.next(wr(this._tool.view,r,e)).next((0,Tr.sO)());this._applyObjectMoveSteps(s,i)}))}_applyObjectMoveSteps(e,t){const{_tool:n,_object:i}=this,r=e.next((e=>("start"===e.action&&(n.inputState={type:"move"},this._bounds.backupMapBounds(),n.events.emit("translate-start",{object:i,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY})),e))).next((0,Tr.EX)()).next(this._moveDragUpdateGeometry()).next((e=>{const t={object:i,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};switch(e.action){case"start":case"update":(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||(e.mapEnd.z??0)-(e.mapStart.z??0))&&n.events.emit("translate",t);break;case"end":n.inputState=null,n.events.emit("translate-stop",t)}return e}));return t.next((()=>{null!=n.inputState&&n.events.emit("translate-stop",{object:i,dxScreen:0,dyScreen:0}),n.cancel()})),r}_moveDragUpdateGeometry(){const e=this._tool;return t=>{if(null==e.inputState||"move"!==e.inputState.type)return t;const n="start"===t.action?di.Y.NEW_STEP:di.Y.ACCUMULATE_STEPS;if(this._operations){const e=this._operations.move(t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,n);this._bounds.updateMapBoundsFromOperation(e)}return t}}}var Qo=n(59552),Jo=n(36634),ea=n(6200),ta=n(72468);class na extends ye.w{initializeProgram(e){return new be.B(e.rctx,na.shader.get().build(this.configuration),sa)}_setPipelineState(e,t){const n=this.configuration,i=e===Dn.y.NONE,r=e===Dn.y.FrontFace;return(0,Se.Ey)({blending:n.output===Mn.V.Color&&n.transparent?i?ia:(0,Pn.ez)(e):null,culling:(0,Se.Xt)(n.cullFace),depthTest:{func:(0,Pn.K_)(e)},depthWrite:i?n.writeDepth?Se.kn:null:(0,Pn.XO)(e),drawBuffers:(0,Pn.cl)(e),colorWrite:Se.wE,stencilWrite:n.hasOccludees?ea.v0:null,stencilTest:n.hasOccludees?t?ea.a9:ea.qh:null,polygonOffset:i||r?null:(0,Pn.aB)(n.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}na.shader=new ve.$(ta.I,(()=>n.e(2205).then(n.bind(n,35108))));const ia=(0,Se.ox)(xe.dn.ONE,xe.dn.ONE_MINUS_SRC_ALPHA);class ra extends Ln.E{constructor(){super(...arguments),this.output=Mn.V.Color,this.cullFace=wn.s2.None,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=Dn.y.NONE,this.multipassEnabled=!1,this.cullAboveGround=!1,this.perspectiveInterpolation=!0}}(0,i._)([(0,Le.W)({count:Mn.V.COUNT})],ra.prototype,"output",void 0),(0,i._)([(0,Le.W)({count:wn.s2.COUNT})],ra.prototype,"cullFace",void 0),(0,i._)([(0,Le.W)()],ra.prototype,"hasSlicePlane",void 0),(0,i._)([(0,Le.W)()],ra.prototype,"transparent",void 0),(0,i._)([(0,Le.W)()],ra.prototype,"enableOffset",void 0),(0,i._)([(0,Le.W)()],ra.prototype,"writeDepth",void 0),(0,i._)([(0,Le.W)()],ra.prototype,"hasOccludees",void 0),(0,i._)([(0,Le.W)({count:Dn.y.COUNT})],ra.prototype,"transparencyPassType",void 0),(0,i._)([(0,Le.W)()],ra.prototype,"multipassEnabled",void 0),(0,i._)([(0,Le.W)()],ra.prototype,"cullAboveGround",void 0),(0,i._)([(0,Le.W)()],ra.prototype,"perspectiveInterpolation",void 0),(0,i._)([(0,Le.W)({constValue:!1})],ra.prototype,"occlusionPass",void 0);const sa=new Map([[Te.r.POSITION,0],[Te.r.UV0,2],[Te.r.PERSPECTIVEDIVIDE,3]]);class oa extends Do.W{constructor(e){super(e,new ca),this.supportsEdges=!0,this.produces=new Map([[je.N.OPAQUE_MATERIAL,e=>(0,Mn.u5)(e)||(0,Mn._o)(e)&&!this.parameters.transparent],[je.N.TRANSPARENT_MATERIAL,e=>(0,Mn._o)(e)&&this.parameters.transparent&&this.parameters.writeDepth],[je.N.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,e=>(0,Mn._o)(e)&&this.parameters.transparent&&!this.parameters.writeDepth],[je.N.DRAPED_MATERIAL,e=>(0,Mn._o)(e)||(0,Mn.u5)(e)]]),this._vertexAttributeLocations=sa,this._configuration=new ra}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<Pn.xt,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.perspectiveInterpolation=this.parameters.perspectiveInterpolation,this._configuration}createGLMaterial(e){return new aa(e)}createBufferWriter(){const e=Po.zK.clone();return this.parameters.perspectiveInterpolation&&e.f32(Te.r.PERSPECTIVEDIVIDE),new la(e)}}class aa extends Jo.m{constructor(e){super({...e,...e.material.parameters})}_updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(na,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:e.hasOccludees}),this._updateParameters(e))}beginSlot(e){return this._output===Mn.V.Color&&this._updateOccludeeState(e),this._updateParameters(e)}}class la extends Io.Z{write(e,t,n,i,r){for(const s of this.vertexBufferLayout.fields.keys()){const o=n.attributes.get(s);if(o)if(s===Te.r.PERSPECTIVEDIVIDE){(0,Cn.vA)(1===o.size);const e=i.getField(s,An.Y$);e&&(0,In.uO)(o,e,r)}else(0,In.zC)(s,o,e,t,i,r)}}}class ca extends Ye.qA{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=wn.s2.None,this.hasOccludees=!1,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0,this.perspectiveInterpolation=!1}}class ua extends Ni{constructor(e,t){const n=new oa({transparent:!0,writeDepth:!1,renderOccluded:Ye.m$.Opaque,isDecoration:!0}),i=Vr.calloutWidth,s=new Qe.W({width:i,renderOccluded:Ye.m$.OccludeAndTransparent,isDecoration:!0});super({view:e,...ha({imageMaterial:n,calloutMaterial:s})}),this._currentTexture=null,this._themeHandle=(0,a.watch)((()=>e.effectiveTheme.accentColor),(e=>{const i=(0,r._L)(e,.5),o=(0,r.bJ)(e),a=this._currentTexture,l=t(i,o);n.setParameters({textureId:l.texture.id}),s.setParameters({color:g.A.toUnitRGBA(e)}),this._currentTexture=l,a?.release()}),a.Vh)}destroy(){this._themeHandle.remove(),this._currentTexture?.release(),super.destroy()}}function ha({imageMaterial:e,calloutMaterial:t}){const{focusMultiplier:n,calloutLength:i,discRadius:r}=Vr,s=r*n,o=(e,t)=>{const n=[0,1,2,2,3,0];return new Ft.V(t,[[Te.r.POSITION,new Nt.n([i-e,-e,0,i+e,-e,0,i+e,e,0,i-e,e,0],n,3,!0)],[Te.r.UV0,new Nt.n([0,0,1,0,1,1,0,1],n,2,!0)]])},a=(0,Xe.Z8)(t,[[0,0,0],[i-r,0,0]]),l=(0,Xe.Z8)(t,[[0,0,0],[i-s,0,0]]),c=Ho;return{autoScaleRenderObjects:!1,collisionPriority:1,collisionType:{type:"disc",direction:[0,0,1],offset:[i,0,0]},focusMultiplier:n,radius:r,renderObjects:[new vr(o(r,e),Di.p7.Unfocused|c),new vr(a,Di.p7.Unfocused|c),new vr(o(s,e),Di.p7.Focused|c),new vr(l,Di.p7.Focused|c)],state:c}}var da=n(57665),pa=n(60403);class fa{get _object(){return this._tool.object}get _operations(){return this._object.operations}constructor(e,t,n){this._tool=e,this._bounds=t,this._snapRotation=n,this._rotateTooltipInfo=null,this._startAngle=0,this._endAngle=0;const i=this._tool,r=i.view,s=!r._stage?.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result;this.rotateManipulator=new ua(r,((e,t)=>function(e,t){const{accentColor:n,contrastColor:i,preMultiplyAlpha:r}=t;return e.fromData(`heading-rotate:[accent:${n},contrast:${i},size:64]`,(()=>new Qo.g(function(e,t){return function(e,t){const n=new Image(t,t);return n.src=e,n}(function(e){const t=(new XMLSerializer).serializeToString(e);return`data:image/svg+xml;base64,${btoa(t)}`}(function(e,{accentColor:t,contrastColor:n}){const i=t.toHex(),r=t.a,s=n.toHex(),o=n.a,a=e.getElementsByTagNameNS("http://www.w3.org/2000/svg","style").namedItem("theme-style");return a&&(a.innerHTML=`\n      .contrast-fill { fill: ${s}; fill-opacity: ${o}; }\n      .contrast-stroke { stroke: ${s}; stroke-opacity: ${o};  }\n      .accent-fill { fill: ${i}; fill-opacity: ${r}; }\n      .accent-stroke { stroke: ${i}; stroke-opacity:  ${r}; }`),e}(function(e){const t=e.split(",")[1],n=atob(t);return(new DOMParser).parseFromString(n,"image/svg+xml")}(e),t)),t.size)}("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSI1NiIgZmlsbD0ibm9uZSIgdmVyc2lvbj0iMi4wIj48c3R5bGUgaWQ9InRoZW1lLXN0eWxlIj4uY29udHJhc3QtZmlsbHtmaWxsOiNmZmZ9LmNvbnRyYXN0LXN0cm9rZXtzdHJva2U6I2ZmZn0uYWNjZW50LWZpbGx7ZmlsbDojZmY3ZjAwO2ZpbGwtb3BhY2l0eTouNX08L3N0eWxlPjxwYXRoIGQ9Ik0yOCAwYTI4IDI4IDAgMSAxIDAgNTYgMjggMjggMCAwIDEgMC01NiIgY2xhc3M9ImFjY2VudC1maWxsIi8+PHBhdGggc3Ryb2tlLXdpZHRoPSI0Ljk5IiBkPSJNMjAuMDUgNDAuODZhMTUuMDUgMTUuMDUgMCAwIDAgMTcuMTQtMS41IDE1LjA1IDE1LjA1IDAgMCAwIDQuNDctMTYuNjUgMTUuMDUgMTUuMDUgMCAwIDAtMjIuNzItNy4xNSAxNS4wNSAxNS4wNSAwIDAgMC01LjUgNy4xNSIgY2xhc3M9ImNvbnRyYXN0LXN0cm9rZSIvPjxwYXRoIGQ9Im0xMC45NyAzNS41NyA1LjM4IDEyLjA3IDcuNzktMTMuNDd6IiBjbGFzcz0iY29udHJhc3QtZmlsbCIvPjwvc3ZnPg==",{accentColor:n,contrastColor:i,size:64}),{mipmap:!0,reloadable:!0,preMultiplyAlpha:r})))}(r.textures,{accentColor:e,contrastColor:t,preMultiplyAlpha:s}))),i.addHandles([this.rotateManipulator.events.on("grab-changed",(e=>this._onRotateGrab(e))),this._createRotateDragPipeline(this.rotateManipulator)]),i.manipulators.add(this.rotateManipulator),i.addHandles([i.events.on("rotate-start",(e=>this._startAngle=e.angle)),i.events.on("rotate",(e=>this._endAngle=e.angle)),i.events.on("rotate-stop",(()=>{this._startAngle=0,this._endAngle=0}))])}destroy(){this._tool.manipulators.remove(this.rotateManipulator),this.rotateManipulator.destroy()}forEachManipulator(e){e(this.rotateManipulator,Ji.ROTATE)}updateManipulators(e,t){const n=this._bounds.mapBounds.plane[2]<0?Math.PI:0,i=(0,St.eL)(A.Rc.get(),e,n);i[12]=0,i[13]=0,i[14]=0,this.rotateManipulator.modelTransform=i,this.rotateManipulator.renderLocation=(0,h.g)(A.rq.get(),t.origin,t.basis1)}getUpdatedTooltipInfo(){return this.rotateManipulator.focused?this._computeRotateTooltipInfo():null}_computeRotateTooltipInfo(){const e=this._rotateTooltipInfo??=new pa.d({sketchOptions:this._tool.sketchOptions});return e.angle=this._startAngle-this._endAngle,e}_onRotateGrab({action:e,screenPoint:t}){const n=this._tool,i=this._bounds;if("start"!==e||!t)return;const r=function(e,t,n,i){const r=t.worldUpAtPosition(e.origin,A.rq.get()),s=A.rq.get();switch(n){case Uo.HEADING:(0,h.c)(s,r);break;case Uo.TILT:(0,h.c)(s,e.basis1)}return(0,Mi.O_)(e.origin,s,i)}(i.displayBounds,n.view.renderCoordsHelper,Uo.HEADING,(0,Mi.vt)()),s=Ci(n.view.state.camera,t);(0,Mi.Ui)(r,s,A.rq.get())&&(i.backupMapBounds(),n.inputState={type:"rotate",rotatePlane:r})}_createRotateDragPipeline(e){const{_tool:t,_object:n}=this;return(0,Tr.Xt)(e,((e,i,r)=>{const s=t.inputState;null!=s&&(i.next((e=>("start"===e.action&&t.events.emit("rotate-start",{object:n,angle:0}),e))).next(Er(t.view,s.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(s)).next(...this._snapRotation()).next(this._rotateDragUpdateGeometry()).next((e=>{const i={object:n,angle:(0,y.KJ)(e.rotateAngle)};switch(e.action){case"start":case"update":t.events.emit("rotate",i);break;case"end":t.inputState=null,t.events.emit("rotate-stop",i)}return e})),r.next((()=>{null!=t.inputState&&t.events.emit("rotate-stop",{object:n,angle:0}),t.cancel()})))}))}_rotateDragRenderPlaneToRotate(e){return t=>{const n=(0,Mi.Qj)(e.rotatePlane),i=Ur(t.renderStart,t.renderEnd,this._bounds.displayBounds.origin,n);return{...t,rotateAxis:n,rotateAngle:i}}}_rotateDragUpdateGeometry(){const e=this._bounds;return t=>{const n=(0,h.c)((0,d.vt)(),e.mapBoundsStart.origin),i="start"===t.action?di.Y.NEW_STEP:di.Y.ACCUMULATE_STEPS;if(this._operations){const r=this._operations.rotate(n,t.rotateAngle,i,da.K.REPLACE);(0,xo.c)(e.mapBoundsStart,e.mapBounds),e.updateMapBoundsFromOperation(r)}return t}}}class ma extends Ni{constructor(e,t){const n=Vo(t),i=n?4:1,r=2*i,s={renderOccluded:Ye.m$.OccludeAndTransparent,isDecoration:!0},o=new Qe.W({...s,width:i}),l=new Qe.W({...s,width:r}),c=new Qe.W({...s,width:1});super({view:e,...Hr,...ga({isCorner:n,unfocusedMaterial:o,focusedMaterial:l,outlineMaterial:c})}),this._themeHandle=(0,a.watch)((()=>e.effectiveTheme.accentColor),(e=>{const t=g.A.toUnitRGBA(e);o.setParameters({color:t}),l.setParameters({color:t}),c.setParameters({color:t})}),a.Vh)}destroy(){this._themeHandle.remove(),super.destroy()}}function ga({isCorner:e,unfocusedMaterial:t,focusedMaterial:n,outlineMaterial:i}){const r=e?[(0,d.fA)(1,0,0),(0,d.fA)(0,0,0),(0,d.fA)(0,1,0)]:[(0,d.fA)(1,0,0),(0,d.fA)(-1,0,0)];return{renderObjects:[new vr((0,Xe.Z8)(t,r),Di.p7.Unfocused|Bo),new vr((0,Xe.Z8)(n,r),Di.p7.Focused|Bo),new vr((0,Xe.Z8)(i,r),$o)],collisionType:{type:"line",paths:[r]},radius:e?6:4,state:Bo}}var _a=n(41857),va=n(16633);class ya{constructor(e,t){this._tool=e,this.mapBounds=(0,xo.a)(),this.mapBoundsStart=(0,xo.a)(),this.displayBounds=(0,xo.a)(),e.addHandles((0,a.on)((()=>e.object),"modified-externally",(()=>this._resetMapBounds()),{onListenerAdd:()=>this._resetMapBounds()})),this._onDisplayBoundsChanged=t}get displayBoundsMargin(){const{view:e,object:t}=this._tool,n=ui(t),i=e.pointsOfInterest?.centerOnSurfaceFrequent.location??n?.extent?.center;return i?ba*e.pixelSizeAt(i):0}backupMapBounds(){(0,xo.c)(this.mapBounds,this.mapBoundsStart)}updateDisplayBounds(){this._calculateDisplayBounds(),this._onDisplayBoundsChanged?.()}updateMapBoundsFromOperation(e){(0,_a.Bb)(e,this.mapBounds),this.updateDisplayBounds()}updateMapBoundsFromOperationInverse(e){(0,_a.fJ)(e,this.mapBounds),this.updateDisplayBounds()}_resetMapBounds(){this._calculateMapBounds(),this.updateDisplayBounds()}_calculateMapBounds(){const{view:e,attachmentOrigin:t,object:n}=this._tool,i=n.operations?.data;if(!i)return;const r=i.geometry;this.spatialReference=r.spatialReference;const s=function(e){const t=li(e);return(0,S.fA)(Math.cos(t),Math.sin(t))}(r);(0,x.hs)(s,s,-1);const o=e.spatialReference,a=r.spatialReference,l=t?e.pixelSizeAt(t)*(0,E.KX)(o)/(0,E.GA)(a):0;(0,_a.G3)(s,i,Ta*l,this.mapBounds)}_calculateDisplayBounds(){const{view:e,attachmentOrigin:t}=this._tool,n=t?.z??(0,Mt.nG)(this.mapBounds.origin,e.elevationProvider,Ot.F.fromElevationInfo(this._tool.object.elevationInfo),e.renderCoordsHelper),i=(0,xo.c)(this.mapBounds);i.origin[2]=n??0,function(e,t,n,i=0,r){r||(r=(0,xo.a)()),t.toRenderCoords(e.origin,n,r.origin);const s=A.rq.get();(0,h.g)(s,e.origin,e.basis1),(0,h.g)(s,s,e.basis2),t.toRenderCoords(s,n,s);const o=A.rq.get();(0,h.g)(o,e.origin,e.basis1),(0,h.f)(o,o,e.basis2),t.toRenderCoords(o,n,o);const a=A.rq.get();(0,h.f)(a,e.origin,e.basis1),(0,h.f)(a,a,e.basis2),t.toRenderCoords(a,n,a);const l=A.rq.get();(0,h.f)(l,e.origin,e.basis1),(0,h.g)(l,l,e.basis2),t.toRenderCoords(l,n,l);const c=(0,h.o)(A.rq.get(),s,o,.5);(0,h.f)(c,c,r.origin);const u=(0,h.o)(A.rq.get(),a,l,.5);(0,h.f)(u,r.origin,u),(0,h.o)(r.basis1,c,u,.5);const d=(0,h.o)(A.rq.get(),l,s,.5);(0,h.f)(d,d,r.origin);const p=(0,h.o)(A.rq.get(),o,a,.5);(0,h.f)(p,r.origin,p),(0,h.o)(r.basis2,d,p,.5);const f=(0,h.b)(A.rq.get(),r.basis1,r.basis2),m=(0,h.b)(f,f,r.basis1);(0,h.n)(m,m),(0,h.j)(r.basis2,m,(0,h.m)(r.basis2,m)),(0,h.j)(r.basis1,r.basis1,1+i/(0,h.l)(r.basis1)),(0,h.j)(r.basis2,r.basis2,1+i/(0,h.l)(r.basis2)),(0,xo.u)(r)}(i,e.renderCoordsHelper,this.spatialReference,this.displayBoundsMargin,this.displayBounds)}}const ba=10,Ta=80;function Ea(e,t,n){return(0,h.f)(Aa,(0,h.f)(Aa,e.origin,e.basis1),e.basis2),(0,h.r)(wa,Aa,e.basis1,2),(0,h.r)(Sa,wa,e.basis2,2),(0,h.r)(xa,Aa,e.basis2,2),Aa[2]=wa[2]=Sa[2]=xa[2]=t,(0,va.b)({topLeft:xa,topRight:Sa,bottomRight:wa,bottomLeft:Aa,spatialReference:n})}const xa=(0,d.vt)(),Sa=(0,d.vt)(),wa=(0,d.vt)(),Aa=(0,d.vt)();var Ma=n(96632);class Oa{get _object(){return this._tool.object}get _operations(){return this._object.operations}get zMax(){if(!this._zMaxDirty||!this._operations)return this._zMax;const e=this._operations.data;if(e.geometry.hasZ){const t=e.coordinateHelper;this._zMax=Number.NEGATIVE_INFINITY;for(const n of e.components)for(const e of n.vertices){const n=t.getZ(e.pos)??0;this._zMax=Math.max(n,this._zMax)}}else this._zMax=0;return this._zMaxDirty=!1,this._zMax}constructor(e,t,n){this._tool=e,this._bounds=t,this._preserveAspectRatioStep=n,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._scaleTooltipInfo=null,this._displayBoundsStart=(0,xo.a)(),this._displayBoundsMarginStart=0,this._startScale=(0,S.vt)(),this._endScale=(0,S.vt)(),this._sizeStart=null,this._zMax=0,this._zMaxDirty=!0;const i=this._tool,r=i.view;this.resizeManipulators=this._resizeHandles.map((e=>{const t=new ma(r,e);return i.addHandles([t.events.on("grab-changed",(e=>this._onResizeGrab(e))),this._createResizeDragPipeline(t,e)]),t})),i.manipulators.addMany(this.resizeManipulators),i.addHandles([i.events.on("scale-start",(e=>{(0,x.hZ)(this._startScale,e.xScale,e.yScale),(0,x.hZ)(this._endScale,e.xScale,e.yScale)})),i.events.on("scale",(e=>{(0,x.hZ)(this._endScale,e.xScale,e.yScale)})),i.events.on("scale-stop",(()=>{(0,x.hZ)(this._startScale,0,0),(0,x.hZ)(this._endScale,0,0)}))]),this._operations&&i.addHandles(this._operations.data.on("change",(()=>{"resize"!==i.inputState?.type&&(this._zMaxDirty=!0)})))}destroy(){this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()}))}forEachManipulator(e){this.resizeManipulators.forEach((t=>e(t,Ji.SCALE)))}updateManipulators(e,t){this.resizeManipulators.forEach(((n,i)=>{!function(e,t,n,i){const r=(0,h.l)(i.basis1),s=(0,h.l)(i.basis2),o=Fo(i),a=zo(i),l=(0,h.s)(A.rq.get(),0,0,0);(0,h.g)(l,(0,h.j)(A.rq.get(),i.basis1,t.direction[0]),(0,h.j)(A.rq.get(),i.basis2,t.direction[1])),(0,h.g)(l,i.origin,l);let c=0,u=1;if(Vo(t))1===t.direction[0]&&-1===t.direction[1]?c=Go:1===t.direction[0]&&1===t.direction[1]?c=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(c=3*Math.PI/2),u=a;else{const e=0!==t.direction[0]?1:2;c=1===e?Go:0,u=(1===e?s:r)-o}const d=(0,St.N9)(A.Rc.get(),c);(0,St.hs)(d,d,(0,h.s)(A.rq.get(),u,u,u)),(0,St.lw)(d,n,d),d[12]=0,d[13]=0,d[14]=0,e.modelTransform=d,e.renderLocation=l}(n,this._resizeHandles[i],e,t)}))}getUpdatedTooltipInfo(){return this.resizeManipulators.some((e=>e.focused))?this._computeScaleTooltipInfo():null}_computeScaleTooltipInfo(){const e=this._tool,t=this._scaleTooltipInfo??=new Ma.c({sketchOptions:e.sketchOptions}),n=Ea(this._bounds.mapBounds,this.zMax,this._bounds.spatialReference);return null==n?null:(t.xSize=n.xSize,t.ySize=n.ySize,null!=this._sizeStart&&this.resizeManipulators.some((e=>e.dragging))?(t.xScale=n.xSize.value/this._sizeStart.xSize.value,t.yScale=n.ySize.value/this._sizeStart.ySize.value):(t.xScale=1,t.yScale=1),t)}_onResizeGrab({action:e,screenPoint:t}){const n=this._tool,i=this._bounds;if("start"!==e||!t)return;const r=Ci(n.view.state.camera,t);(0,Mi.Ui)(i.displayBounds.plane,r,A.rq.get())&&(i.backupMapBounds(),(0,xo.c)(i.displayBounds,this._displayBoundsStart),this._displayBoundsMarginStart=i.displayBoundsMargin,this._sizeStart=Ea(i.mapBoundsStart,this.zMax,i.spatialReference),n.inputState={type:"resize"})}_createResizeDragPipeline(e,t){const{_tool:n,_object:i}=this;return(0,Tr.Xt)(e,((e,r,s)=>{null!=n.inputState&&(r.next((e=>("start"===e.action&&n.events.emit("scale-start",{object:i,xScale:1,yScale:1}),e))).next(Er(n.view,this._displayBoundsStart.plane)).next((e=>({...e,handle:t}))).next(this._resizeDragRenderPlaneToFactors()).next(...this._preserveAspectRatioStep()).next(this._resizeDragUpdateGeometry()).next((e=>{const t={object:i,xScale:e.factor1,yScale:e.factor2};switch(e.action){case"start":case"update":n.events.emit("scale",t);break;case"end":n.inputState=null,n.events.emit("scale-stop",t)}return e})),s.next((()=>{null!=n.inputState&&n.events.emit("scale-stop",{object:i,xScale:1,yScale:1}),n.cancel()})))}))}_resizeDragRenderPlaneToFactors(){const e=this._bounds;return t=>{const n=this._displayBoundsStart,i=t.handle.direction,r=e.displayBoundsMargin,s=this._displayBoundsMarginStart,o=(0,h.c)(A.rq.get(),n.origin);(0,h.r)(o,o,n.basis1,-i[0]),(0,h.r)(o,o,n.basis2,-i[1]);const a=(0,h.f)(A.rq.get(),t.renderEnd,o),l=(0,h.f)(A.rq.get(),t.renderStart,o),c=Vo(t.handle),u=zo(n),d=zo(e.displayBounds)/u,p=(e,t)=>{if(0===e)return 1;let n=(0,h.l)(t),i=.5*e*(0,h.m)(t,a)/n;const o=i<0?-1:1;c&&(i+=(n-.5*e*(0,h.m)(t,l)/n)*o*d);const u=n<1.5*s?1:Ra;return n=Math.max(n-s,Ra),o>0&&(i-=r),o*Math.max(o*(i/n),u)};return{...t,factor1:p(i[0],n.basis1),factor2:p(i[1],n.basis2)}}}_resizeDragUpdateGeometry(){const e=this._bounds;return t=>{const n=(0,h.c)((0,d.vt)(),e.mapBoundsStart.origin);(0,h.r)(n,n,e.mapBoundsStart.basis1,-t.handle.direction[0]),(0,h.r)(n,n,e.mapBoundsStart.basis2,-t.handle.direction[1]);const i=(0,x.hZ)((0,S.vt)(),e.mapBoundsStart.basis1[0],e.mapBoundsStart.basis1[1]);(0,x.S8)(i,i);const r="start"===t.action?di.Y.NEW_STEP:di.Y.ACCUMULATE_STEPS;if(this._operations){const s=this._operations.scale(n,i,t.factor1,t.factor2,r,da.K.REPLACE);(0,xo.c)(e.mapBoundsStart,e.mapBounds),e.updateMapBoundsFromOperation(s)}return t}}}const Ra=1e-6;class Ca{constructor(){this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&null!=this._lastDragEvent&&null!=this._next){const t={...this._lastDragEvent,action:"update"};e&&Ia(t),this._next.execute(t)}this._enabled=e}createDragEventPipelineStep(){this._lastDragEvent=null;const e=new Tr.rh;return this._next=e,[e=>(this._lastDragEvent="end"!==e.action?{...e}:null,this._enabled&&Ia(e),e),e]}get test(){}}function Ia(e){const t=Vo(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.handle.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}class Pa{constructor(){this._lastDragEvent=null,this._next=null,this.incrementRadians=(0,y.kU)(5),this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&null!=this._lastDragEvent&&null!=this._next){const t={...this._lastDragEvent,action:"update"};e&&this._adjustRotation(t),this._next.execute(t)}this._enabled=e}createDragEventPipelineStep(){this._lastDragEvent=null;const e=new Tr.rh;return this._next=e,[e=>(this._lastDragEvent="end"!==e.action?{...e}:null,this._enabled&&this._adjustRotation(e),e),e]}_adjustRotation(e){e.rotateAngle=Math.round(e.rotateAngle/this.incrementRadians)*this.incrementRadians}}let Da=class extends ts.g{get updating(){return!!this.object.updating}constructor(e){super(e),this.events=new _n.A,this.enableZ=!0,this.enableScaling=!0,this.enableRotation=!0,this.sketchOptions=new is.A,this._preserveAspectRatio=new Ca,this._snapRotation=new Pa,this.grabbing=!1,this.inputState=null,this._attachmentOrigin=null,this.type="transform-3d",this._outlineVisualElement=null}initialize(){const{view:e,object:t}=this,n=this._bounds=new ya(this,(()=>this._updateManipulators()));this._extentMove=new Ko(this,n),this._extentScale=new Oa(this,n,(()=>this._preserveAspectRatio.createDragEventPipelineStep())),this._extentRotate=new fa(this,n,(()=>this._snapRotation.createDragEventPipelineStep())),this.addHandles([(0,a.watch)((()=>this.enableZ),(()=>this._updateManipulatorAvailability(this._extentMove.moveZManipulator,Ji.TRANSLATE_Z))),(0,a.watch)((()=>this.enableScaling),(()=>this._extentScale.forEachManipulator((e=>this._updateManipulatorAvailability(e,Ji.SCALE))))),(0,a.watch)((()=>this.enableRotation),(()=>this._updateManipulatorAvailability(this._extentRotate.rotateManipulator,Ji.ROTATE)))]),this._updateManipulators(),this._updateAllManipulatorAvailability();const i=hr({view:e,object:t,forEachManipulator:e=>this._forEachManipulator(e),onManipulatorsChanged:()=>(0,s.hA)()});if(null!=i){const{visualElement:e}=i;e instanceof Tn&&(this._outlineVisualElement=e,this.addHandles(e.events.on("attachment-origin-changed",(()=>this._bounds.updateDisplayBounds())))),this.addHandles(i)}this.addHandles([t.on("committed",(()=>this._onGeometryChanged())),(0,a.watch)((()=>this.object.visible),(()=>this._updateAllManipulatorAvailability())),(0,a.watch)((()=>this.object.isDraped),(()=>this._graphicDrapedChanged()),a.Vh),(0,a.watch)((()=>e.pointsOfInterest?.centerOnSurfaceFrequent.location),(()=>n.updateDisplayBounds()))]),this._forEachManipulator((e=>{this.addHandles(e.events.on("grab-changed",(()=>{this.grabbing=e.grabbing,this._updateAllManipulatorAvailability()})))})),this._forEachManipulator(((e,n)=>{this.addHandles(e.events.on("immediate-click",(e=>{n===Ji.TRANSLATE_XY&&this.events.emit("immediate-click",{...e,object:t}),e.stopPropagation()})))})),this._initializeTooltip(),this.finishToolCreation()}destroy(){this._extentMove.destroy(),this._extentScale.destroy(),this._extentRotate.destroy(),this.tooltip.destroy(),this._set("view",null),this._set("object",null)}_initializeTooltip(){const{view:e}=this,t=this.tooltip=new os.m({view:e}),n=()=>{t.info=this._getUpdatedTooltipInfo()};this.addHandles([(0,a.watch)((()=>this.sketchOptions.tooltips.effectiveEnabled),n),this.events.on("translate-start",n),this.events.on("translate",n),this.events.on("translate-stop",(()=>this.tooltip.clear())),this.events.on("rotate-start",n),this.events.on("rotate",n),this.events.on("rotate-stop",n),this.events.on("scale-start",n),this.events.on("scale",n),this.events.on("scale-stop",n)]),this._forEachManipulator((e=>{this.addHandles([e.events.on("focus-changed",n),e.events.on("grab-changed",n),e.events.on("drag",(e=>{"cancel"===e.action?this.tooltip.clear():n()}))])}))}_getUpdatedTooltipInfo(){return this.sketchOptions.tooltips.effectiveEnabled?this._extentMove.getUpdatedTooltipInfo()??this._extentScale.getUpdatedTooltipInfo()??this._extentRotate.getUpdatedTooltipInfo():null}_onGeometryChanged(){this._bounds.updateDisplayBounds()}_graphicDrapedChanged(){this.removeHandles(La),this._bounds.updateDisplayBounds(),this.object.isDraped&&this.addHandles(this.view.elevationProvider.on("elevation-change",(e=>{null!=this._attachmentOrigin&&(0,Ai.Rj)(e.extent,this._attachmentOrigin.x,this._attachmentOrigin.y)&&this._bounds.updateDisplayBounds()})),La)}_updateManipulators(){if(!this.visible)return;const e=this._bounds.displayBounds,t=function(e,t){return kr(e.basis1,e.basis2,e.origin,t)}(e,A.Rc.get());this._extentMove.updateManipulators(t,e),this._extentScale.updateManipulators(t,e),this._extentRotate.updateManipulators(t,e)}_updateAllManipulatorAvailability(){this._forEachManipulator(((e,t)=>this._updateManipulatorAvailability(e,t)))}_updateManipulatorAvailability(e,t){const n=this.grabbing&&!e.grabbing;if(e.interactive=!n,e instanceof Ni){const i=this.object.visible,r=this.enableZ&&hi(this.object.operations,this.object.elevationInfo);switch(t){case Ji.ROTATE:e.available=i&&this.enableRotation;break;case Ji.SCALE:e.available=i&&(this.enableScaling||this.enableRotation||r),e.interactive=!n&&this.enableScaling,e.state=this.enableScaling?Bo:$o;break;case Ji.TRANSLATE_Z:e.available=i&&r;break;default:e.available=i}}}_forEachManipulator(e){this._extentMove.forEachManipulator(e),this._extentScale.forEachManipulator(e),this._extentRotate.forEachManipulator(e)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}get snapRotation(){return this._snapRotation.enabled}set snapRotation(e){this._snapRotation.enabled=e,this._set("snapRotation",e)}get attachmentOrigin(){const e=this.object.isDraped?null:this._outlineVisualElement?.attachmentOrigin;return this._attachmentOrigin=e??this.object.origin??ui(this.object)?.extent?.center,this._attachmentOrigin}reset(){}cancel(){if(this.canUndo){const e=this.object.operations?.undo();e&&this._bounds.updateMapBoundsFromOperationInverse(e)}this.inputState=null}get canUndo(){return!!this.object.operations?.canUndo}undo(){if(null!=this.inputState)this.view.activeTool=null;else if(this.canUndo){const e=this.object.operations?.undo();e&&this._bounds.updateMapBoundsFromOperationInverse(e)}}get canRedo(){return!!this.object.operations?.canRedo}redo(){if(this.canRedo){const e=this.object.operations?.redo();e&&this._bounds.updateMapBoundsFromOperation(e)}}get test(){}};(0,i._)([(0,l.MZ)()],Da.prototype,"updating",null),(0,i._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Da.prototype,"view",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Da.prototype,"object",void 0),(0,i._)([(0,l.MZ)()],Da.prototype,"enableZ",void 0),(0,i._)([(0,l.MZ)()],Da.prototype,"enableScaling",void 0),(0,i._)([(0,l.MZ)()],Da.prototype,"enableRotation",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0,type:is.A})],Da.prototype,"sketchOptions",void 0),(0,i._)([(0,l.MZ)()],Da.prototype,"preserveAspectRatio",null),(0,i._)([(0,l.MZ)()],Da.prototype,"snapRotation",null),(0,i._)([(0,l.MZ)()],Da.prototype,"grabbing",void 0),(0,i._)([(0,l.MZ)()],Da.prototype,"inputState",void 0),(0,i._)([(0,l.MZ)({readOnly:!0})],Da.prototype,"type",void 0),(0,i._)([(0,l.MZ)()],Da.prototype,"tooltip",void 0),Da=(0,i._)([(0,u.$)("esri.views.3d.interactive.editingTools.transform.ExtentTransformTool")],Da);const La="draped-elevation-changes";var Na=n(67376);var Fa=n(82067);const za=Symbol();let Va=class extends _n.A.EventedAccessor{get operations(){return this._operations}get updating(){return this._updatingHandles.updating}get elevationInfo(){return(0,p.bh)(this.graphic)}get visible(){return this._graphicState.displaying}get isDraped(){return this._graphicState.isDraped}get origin(){return function(e,t){const n=e.getViewForGraphic(t);return null!=n&&"computeAttachmentOrigin"in n?n.computeAttachmentOrigin(t,e.spatialReference):null}(this.view,this.graphic)}constructor(e){super(e),this._updatingHandles=new oi.U}destroy(){this._operations=(0,o.pR)(this._operations),this._updatingHandles.destroy()}initialize(){this._graphicState=new qn({graphic:this.graphic}),this._graphicState.on("changed",(()=>this.emit("committed"))),this.addHandles(this.view.trackGraphicState(this._graphicState)),this.addHandles(this._updatingHandles.add((()=>this.graphic.geometry),(e=>{const t=this._operations?.data.geometry;if(e!==t){if(!e||"multipoint"===e?.type||"extent"===e?.type)return(0,o.pR)(this._operations),this.removeHandles(za),void(this._operations=null);if(this._operations?.trySetGeometry(e))this.emit("modified-externally");else{(0,o.pR)(this._operations),this.removeHandles(za);const t=ns.p.fromGeometry(e,this.view.state.viewingMode);this._operations=t,this.addHandles(t.data.on("change",(()=>this.graphic.geometry=t.data.geometry)),za)}}}),a.Vh))}createManipulator(e){return new Fa.l({view:this.view,graphic:this.graphic,...e})}maskOccludee(){return this.view.maskOccludee(this.graphic)}endInteraction(){const e=this.graphic.geometry;"mesh"===e?.type&&this.graphic.notifyMeshTransformChanged({action:Jt.$.UpdateFastLocalOrigin})}toMap(e){return this.view.toMap(e,{include:[this.graphic]})}createUndoRecord(){const{graphic:{geometry:e}}=this;return function(e){return null!=e&&"mesh"===e.type?function(e){return(0,Na.Hq)(e.vertexSpace)?function(e,t,n){let i=t?.clone(),r=(0,d.o8)(n.origin),s=null,o=null;return{undo:()=>{s=e.transform?.clone(),o=(0,d.o8)(n.origin),e.transform=i,e.vertexSpace.origin=r},redo:()=>{i=e.transform?.clone(),r=(0,d.o8)(n.origin),e.transform=s,e.vertexSpace.origin=o}}}(e,e.transform,e.vertexSpace):function(e){let t,n=e.vertexAttributes.clonePositional();return{undo:()=>{t=e.vertexAttributes.clonePositional(),e.vertexAttributes=n},redo:()=>{n=e.vertexAttributes.clonePositional(),e.vertexAttributes=t}}}(e)}(e):function(e){let t=e,n=null;return{undo(e){n=e.geometry,e.geometry=t},redo(e){t=e.geometry,e.geometry=n}}}(e)}(e)}};(0,i._)([(0,l.MZ)({constructOnly:!0})],Va.prototype,"view",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],Va.prototype,"graphic",void 0),(0,i._)([(0,l.MZ)()],Va.prototype,"_operations",void 0),(0,i._)([(0,l.MZ)()],Va.prototype,"operations",null),(0,i._)([(0,l.MZ)()],Va.prototype,"updating",null),Va=(0,i._)([(0,u.$)("esri.views.3d.interactive.editingTools.ManipulatedObject3DGraphic")],Va)},76589:function(e,t,n){"use strict";n.d(t,{F:function(){return s}});var i=n(32e3),r=n(68546);class s{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=(0,i.Ao)(e)}get requiresSampledElevationInfo(){return"absolute-height"!==this.mode}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,t){const n=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?n:e+n}calculateOffsetRenderUnits(e){let t=this._meterUnitOffset;const n=this.featureExpressionInfoContext;return null!=n&&(t+=(0,r.g7)(n)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=(0,i.Tg)(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,t,n){if(null==e)return void(this._featureExpressionInfoContext=null);const i=e?.arcade;i&&null!=t&&null!=n?(this._featureExpressionInfoContext=(0,r.o8)(e),(0,r.gf)(this._featureExpressionInfoContext,(0,r.VG)(i.modules,t,n))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const t=new s;return null!=e&&t.setFromElevationInfo(e),t}}},49618:function(e,t,n){"use strict";n.d(t,{I2:function(){return g},Kf:function(){return v},Uk:function(){return T},ai:function(){return b},au:function(){return p},fe:function(){return y},nG:function(){return m},nu:function(){return _},sE:function(){return f},uw:function(){return i}});var i,r,s=n(73364),o=n(39714),a=n(32501),l=n(7456),c=n(57617),u=n(5915),h=n(60516),d=n(65839);function p(e,t,n,i,r,s,o,a,l,u,h){const d=E[h.mode];let p,f,m=0;if((0,c.projectBuffer)(e,t,n,i,l.spatialReference,r,a))return d.requiresAlignment(h)?(m=d.applyElevationAlignmentBuffer(i,r,s,o,a,l,u,h),p=s,f=o):(p=i,f=r),(0,c.projectBuffer)(p,l.spatialReference,f,s,u.spatialReference,o,a)?m:void 0}function f(e,t,n,i,r){const s=((0,u.v)(e)?e.z:(0,h.cN)(e)?e.array[e.offset+2]:e[2])||0;switch(n.mode){case"on-the-ground":{const n=(0,h.R1)(t,e,"ground")??0;return r.verticalDistanceToGround=0,r.sampledElevation=n,void(r.z=n)}case"relative-to-ground":{const o=(0,h.R1)(t,e,"ground")??0,a=n.geometryZWithOffset(s,i);return r.verticalDistanceToGround=a,r.sampledElevation=o,void(r.z=a+o)}case"relative-to-scene":{const o=(0,h.R1)(t,e,"scene")??0,a=n.geometryZWithOffset(s,i);return r.verticalDistanceToGround=a,r.sampledElevation=o,void(r.z=a+o)}case"absolute-height":{const o=n.geometryZWithOffset(s,i),a=(0,h.R1)(t,e,"ground")??0;return r.verticalDistanceToGround=o-a,r.sampledElevation=a,void(r.z=o)}default:return void(r.z=0)}}function m(e,t,n,i){return f(e,t,n,i,S),S.z}function g(e,t,n){return"on-the-ground"===t&&"on-the-ground"===n?e.staysOnTheGround:t===n||"on-the-ground"!==t&&"on-the-ground"!==n?null==t||null==n?e.definedChanged:i.UPDATE:e.onTheGroundChanged}function _(e){return"relative-to-ground"===e||"relative-to-scene"===e}function v(e){return"absolute-height"!==e}function y(e,t,n,i,r){f(t,n,r,i,S),b(e,S.verticalDistanceToGround);const o=S.sampledElevation,a=(0,s.C)(x,e.transformation);return w[0]=t.x,w[1]=t.y,w[2]=S.z,(0,l.l)(t.spatialReference,w,a,i.spatialReference)?e.transformation=a:console.warn("Could not locate symbol object properly, it might be misplaced"),o}function b(e,t){for(let n=0;n<e.geometries.length;++n){const i=e.geometries[n].getMutableAttribute(d.r.CENTEROFFSETANDDISTANCE);i&&i.data[3]!==t&&(i.data[3]=t,e.geometryVertexAttributeUpdated(e.geometries[n],d.r.CENTEROFFSETANDDISTANCE))}}class T{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}(r=i||(i={}))[r.NONE=0]="NONE",r[r.UPDATE=1]="UPDATE",r[r.RECREATE=2]="RECREATE";const E={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,n,i,r,s,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;t*=3,i*=3;for(let s=0;s<r;++s){const r=e[t],s=e[t+1],o=e[t+2];n[i]=r,n[i+1]=s,n[i+2]=null==c?o+l:l,t+=3,i+=3}return 0},requiresAlignment:function(e){const t=e.meterUnitOffset,n=e.featureExpressionInfoContext;return 0!==t||null!=n}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,n,i,r,s){let o=0;const a=s.spatialReference;t*=3,i*=3;for(let l=0;l<r;++l){const r=e[t],l=e[t+1],c=e[t+2],u=s.getElevation(r,l,c,a,"ground")??0;o+=u,n[i]=r,n[i+1]=l,n[i+2]=u,t+=3,i+=3}return o/r},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,n,i,r,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,h=s.spatialReference;t*=3,i*=3;for(let o=0;o<r;++o){const r=e[t],o=e[t+1],a=e[t+2],d=s.getElevation(r,o,a,h,"ground")??0;l+=d,n[i]=r,n[i+1]=o,n[i+2]=null==u?a+d+c:d+c,t+=3,i+=3}return l/r},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,n,i,r,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,h=s.spatialReference;t*=3,i*=3;for(let o=0;o<r;++o){const r=e[t],o=e[t+1],a=e[t+2],d=s.getElevation(r,o,a,h,"scene")??0;l+=d,n[i]=r,n[i+1]=o,n[i+2]=null==u?a+d+c:d+c,t+=3,i+=3}return l/r},requiresAlignment:()=>!0}},x=(0,o.vt)(),S=new T,w=(0,a.vt)()},68546:function(e,t,n){"use strict";n.d(t,{KF:function(){return f},MF:function(){return p},VG:function(){return u},g7:function(){return d},gf:function(){return h},o8:function(){return l},q6:function(){return c}});var i=n(40633),r=n(60539),s=n(45328),o=n(54547);const a=()=>i.A.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function l(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}async function c(e,t,n,i){const s=e?.expression;if("string"!=typeof s)return null;const a=function(e){return"0"===e?0:null}(s);if(null!=a)return{cachedResult:a};const l=await(0,o.lw)();(0,r.Te)(n);const c=l.arcadeUtils,u=c.createSyntaxTree(s);return c.dependsOnView(u)?(null!=i&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:c.createFunction(u),context:c.createExecContext(null,{sr:t}),modules:l}}}function u(e,t,n){return e.arcadeUtils.createFeature(t.attributes,t.geometry,n)}function h(e,t){if(null!=e&&!m(e)){if(!t||!e.arcade)return void a().errorOncePerTick("Arcade support required but not provided");const n=t;n._geometry&&(n._geometry=(0,s.wZ)(n._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function d(e){if(null!=e){if(m(e))return e.cachedResult;const t=e.arcade;let n=t?.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof n&&(e.cachedResult=0,n=0),n}return 0}function p(e,t=!1){let n=e?.featureExpressionInfo;const i=n?.expression;return t||"0"===i||(n=null),n??null}const f={cachedResult:0};function m(e){return null!=e.cachedResult}},75302:function(e,t,n){"use strict";n.d(t,{$2:function(){return S},$C:function(){return b},Hj:function(){return E},Mh:function(){return x},W$:function(){return g},pW:function(){return T},t8:function(){return y},vY:function(){return w}});var i=n(62938),r=n(73364),s=n(39714),o=n(32501),a=n(33400),l=n(41546),c=n(46157),u=n(24761),h=n(87416),d=n(72228),p=n(38441),f=n(46460),m=n(45328);function g(e,t){if("point"===e.type)return v(e,t,!1);if((0,m.gr)(e))switch(e.type){case"extent":return v(e.center,t,!1);case"polygon":return v(e.centroid,t,!1);case"polyline":return v(_(e),t,!0);case"mesh":return v(e.origin,t,!1)}else switch(e.type){case"extent":return v(function(e){return(0,f.T)(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),null!=e.zmin&&null!=e.zmax&&isFinite(e.zmin)&&isFinite(e.zmax)?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return v(function(e){const t=e.rings[0];if(!t||0===t.length)return null;const n=(0,d.S8)(e.rings,!!e.hasZ);return(0,f.T)(n[0],n[1],n[2],e.spatialReference)}(e),t,!0);case"polyline":return v(_(e),t,!0)}}function _(e){const t=e.paths[0];if(!t||0===t.length)return null;const n=(0,p.$H)(t,(0,p.Yl)(t)/2);return(0,f.T)(n[0],n[1],n[2],e.spatialReference)}function v(e,t,n){const i=n?e:(0,m.EL)(e);return t&&e?(0,c.projectPoint)(e,i,t)?i:null:i}function y(e,t,n,i=0){if(e){t||(t=(0,h.vt)());const r=e;let s=.5*r.width*(n-1),o=.5*r.height*(n-1);return r.width<1e-7*r.height?s+=o/20:r.height<1e-7*r.width&&(o+=s/20),(0,a.s)(t,r.xmin-s-i,r.ymin-o-i,r.xmax+s+i,r.ymax+o+i),t}return null}function b(e,t,n=null){const i=(0,l.o8)(l.Un);return null!=e&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),null!=t?i[3]=t:null!=e&&e.length>3&&(i[3]=e[3]),n&&(i[0]*=n,i[1]*=n,i[2]*=n,i[3]*=n),i}function T(e=o.Un,t,n,i=1){const r=new Array(3);if(null==t||null==n)r[0]=1,r[1]=1,r[2]=1;else{let i,s=0;for(let o=2;o>=0;o--){const a=e[o];let l;const c=null!=a,u=0===o&&!i&&!c,h=n[o];"symbol-value"===a||u?l=0!==h?t[o]/h:1:c&&"proportional"!==a&&isFinite(a)&&(l=0!==h?a/h:1),null!=l&&(r[o]=l,i=l,s=Math.max(s,Math.abs(l)))}for(let e=2;e>=0;e--)null==r[e]?r[e]=i:0===r[e]&&(r[e]=.001*s)}for(let e=2;e>=0;e--)r[e]/=i;return(0,o.ci)(r)}function E(e){return x(function(e){return null!=e.isPrimitive}(e)?[e.width,e.depth,e.height]:e)?null:"Symbol sizes may not be negative values"}function x(e){const t=e=>null==e||e>=0;return Array.isArray(e)?e.every(t):t(e)}function S(e,t,n,i=(0,s.vt)()){return e&&(0,r.Qr)(i,i,-e/180*Math.PI),t&&(0,r.eL)(i,i,t/180*Math.PI),n&&(0,r.Z8)(i,i,n/180*Math.PI),i}function w(e,t,n){if(null!=n.minDemResolution)return n.minDemResolution;const r=(0,i.GA)(t),s=(0,u.VL)(e)*r,o=(0,u.yr)(e)*r,a=(0,u.uJ)(e)*(t.isGeographic?1:r);return 0===s&&0===o&&0===a?n.minDemResolutionForPoints:.01*Math.max(s,o,a)}},46949:function(e,t,n){"use strict";var i,r,s;n.d(t,{O7:function(){return r},Om:function(){return i},sv:function(){return s}}),function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"}(i||(i={})),function(e){e[e.MapLayer=0]="MapLayer",e[e.ViewLayer=1]="ViewLayer",e[e.Outline=2]="Outline",e[e.SnappingHint=3]="SnappingHint"}(r||(r={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(s||(s={}))},24129:function(e,t,n){"use strict";n.d(t,{Gd:function(){return N},J_:function(){return D},VC:function(){return V},b3:function(){return z},s_:function(){return P},ul:function(){return H},wI:function(){return R}}),n(58941);var i,r,s,o=n(15774),a=n(44705),l=n(87725),c=n(73364),u=n(39714),h=n(20551),d=n(32501),p=n(85031),f=n(70974),m=n(39506);(s=i||(i={}))[s.Undefined=0]="Undefined",s[s.DefinedSize=1]="DefinedSize",s[s.DefinedScale=2]="DefinedScale",function(e){e[e.Undefined=0]="Undefined",e[e.DefinedAngle=1]="DefinedAngle"}(r||(r={}));class g{constructor(e){this.field=e}}class _ extends g{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[i.Undefined,i.Undefined,i.Undefined]}}class v extends g{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}}class y extends g{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}}class b{}function T(e){return null!=e}function E(e){return"number"==typeof e}function x(e){return"string"==typeof e}function S(e,t){e&&e.push(t)}function w(e,t,n,r,s){const o=e.minSize,a=e.maxSize;if(e.useSymbolValue){const e=r.symbolSize[n];return t.minSize[n]=e,t.maxSize[n]=e,t.offset[n]=t.minSize[n],t.factor[n]=0,t.type[n]=i.DefinedSize,!0}if(T(e.field))return T(e.stops)?2===e.stops.length&&E(e.stops[0].size)&&E(e.stops[1].size)?(A(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,n),t.type[n]=i.DefinedSize,!0):(S(s,"Could not convert size info: stops only supported with 2 elements"),!1):E(o)&&E(a)&&T(e.minDataValue)&&T(e.maxDataValue)?(A(o,a,e.minDataValue,e.maxDataValue,t,n),t.type[n]=i.DefinedSize,!0):"unknown"===e.valueUnit?(S(s,"Could not convert size info: proportional size not supported"),!1):null!=p.j[e.valueUnit]?(t.minSize[n]=-1/0,t.maxSize[n]=1/0,t.offset[n]=0,t.factor[n]=1/p.j[e.valueUnit],t.type[n]=i.DefinedSize,!0):(S(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!T(e.field)){if(e.stops?.[0]&&E(e.stops[0].size))return t.minSize[n]=e.stops[0].size,t.maxSize[n]=e.stops[0].size,t.offset[n]=t.minSize[n],t.factor[n]=0,t.type[n]=i.DefinedSize,!0;if(E(o))return t.minSize[n]=o,t.maxSize[n]=o,t.offset[n]=o,t.factor[n]=0,t.type[n]=i.DefinedSize,!0}return S(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function A(e,t,n,i,r,s){const o=Math.abs(i-n)>0?(t-e)/(i-n):0;r.minSize[s]=o>0?e:t,r.maxSize[s]=o>0?t:e,r.offset[s]=e-n*o,r.factor[s]=o}function M(e,t,n){e[4*t]=n.r/255,e[4*t+1]=n.g/255,e[4*t+2]=n.b/255,e[4*t+3]=n.a}function O(e,t,n){const i=2===n&&"arithmetic"===e.rotationType;t.offset[n]=i?90:0,t.factor[n]=i?-1:1,t.type[n]=1}class R{constructor(e,t=[1,1,1],n=[1,1,1],i=1,r=[0,0,0],s=[1,1,1],o=[0,0,0]){this.supports=e,this.modelSize=t,this.symbolSize=n,this.unitInMeters=i,this.anchor=r,this.scale=s,this.rotation=o}}function C(e,t,n){if(!e)return null;const r=e.reduce(((e,i)=>{if(!e)return e;if(i.valueExpression)return S(n,"Could not convert visual variables: arcade expressions not supported"),null;switch(i.type){case"size":return t.supports.size?function(e,t,n,i){if(e.normalizationField||e.valueRepresentation)return S(i,"Could not convert size info: unsupported property"),null;if(!function(e){return null==e||x(e)}(e.field))return S(i,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return S(i,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size=new _(e.field);let r;switch(e.axis){case"width":return r=w(e,t.size,0,n,i),r?t:null;case"height":return r=w(e,t.size,2,n,i),r?t:null;case"depth":return r=w(e,t.size,1,n,i),r?t:null;case"width-and-depth":return r=w(e,t.size,0,n,i),r&&w(e,t.size,1,n,i),r?t:null;case null:case void 0:case"all":return r=w(e,t.size,0,n,i),r=r&&w(e,t.size,1,n,i),r=r&&w(e,t.size,2,n,i),r?t:null;default:return S(i,`Could not convert size info: unknown axis "${e.axis}""`),null}}(i,e,t,n):e;case"color":return t.supports.color?function(e,t,n){if(e.normalizationField)return S(n,"Could not convert color info: unsupported property"),null;if(x(e.field)){if(!e.stops)return S(n,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return S(n,"Could not convert color info: too many color stops"),null;t.color=new v(e.field);const i=e.stops;for(let e=0;e<8;++e){const n=i[Math.min(e,i.length-1)];t.color.values[e]=n.value,M(t.color.colors,e,n.color)}}}else{if(!(e.stops&&e.stops.length>=0))return S(n,"Could not convert color info: no field and no colors/stops"),null;{const n=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.color.values[e]=1/0,M(t.color.colors,e,n)}}return t}(i,e,n):e;case"opacity":return t.supports.opacity?function(e,t,n){if(e.normalizationField)return S(n,"Could not convert opacity info: unsupported property"),null;if(x(e.field)){if(!e.stops)return S(n,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return S(n,"Could not convert opacity info: too many opacity stops"),null;t.opacity=new y(e.field);const i=e.stops;for(let e=0;e<8;++e){const n=i[Math.min(e,i.length-1)];t.opacity.values[e]=n.value,t.opacity.opacityValues[e]=n.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return S(n,"Could not convert opacity info: no field and no opacities/stops"),null;{const n=e.stops&&e.stops.length>=0?e.stops[0].opacity:0;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.opacity.values[e]=1/0,t.opacity.opacityValues[e]=n}}return t}(i,e,n):null;case"rotation":return t.supports.rotation?function(e,t,n){if(!x(e.field))return S(n,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return S(n,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return O(e,t.rotation,0),t;case"roll":return O(e,t.rotation,1),t;case null:case void 0:case"heading":return O(e,t.rotation,2),t;default:return S(n,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}(i,e,n):e;default:return null}}),new b);return!(e.length>0&&r)||r.size||r.color||r.opacity||r.rotation?r?.size&&!function(e,t,n){for(let n=0;n<3;++n){let r=t.unitInMeters;e.type[n]===i.DefinedSize&&(r*=t.modelSize[n],e.type[n]=i.DefinedScale),e.minSize[n]=e.minSize[n]/r,e.maxSize[n]=e.maxSize[n]/r,e.offset[n]=e.offset[n]/r,e.factor[n]=e.factor[n]/r}let r;if(e.type[0]!==i.Undefined)r=0;else if(e.type[1]!==i.Undefined)r=1;else{if(e.type[2]===i.Undefined)return S(n,"No size axis contains a valid size or scale"),!1;r=2}for(let t=0;t<3;++t)e.type[t]===i.Undefined&&(e.minSize[t]=e.minSize[r],e.maxSize[t]=e.maxSize[r],e.offset[t]=e.offset[r],e.factor[t]=e.factor[r],e.type[t]=e.type[r]);return!0}(r.size,t,n)?null:r:null}class I{constructor(e,t,n){this.visualVariables=e,this.materialParameters=t,this.requiresShaderTransformation=n}}function P(e,t){if(!e)return null;if(f.b.TESTS_DISABLE_FAST_UPDATES)return null;const n=C(e.visualVariables,t);return n?new I(n,F(n,t),!!n.size):null}function D(e,t,n){if(!t||!e)return!1;const i=e.visualVariables,r=C(t.visualVariables,n);return!!r&&!!(L(i.size,r.size,"size")&&L(i.color,r.color,"color")&&L(i.rotation,r.rotation,"rotation")&&L(i.opacity,r.opacity,"opacity"))&&(e.visualVariables=r,e.materialParameters=F(r,n),e.requiresShaderTransformation=!!r.size,!0)}function L(e,t,n){if(!!e!=!!t)return!1;if(e&&e.field!==t?.field)return!1;if(e&&"rotation"===n){const n=e,i=t;for(let e=0;e<3;e++)if(n.type[e]!==i.type[e]||n.offset[e]!==i.offset[e]||n.factor[e]!==i.factor[e])return!1}return!0}class N extends m.Y{constructor(e){super(),this.vvSize=e?.size??null,this.vvColor=e?.color??null,this.vvOpacity=e?.opacity??null}}function F(e,t){const n=new N(e);return n.vvSize&&(n.vvSymbolAnchor=t.anchor,(0,c.D_)(j),function(e,t,n,i=(0,u.vt)()){const r=e||0,s=t||0,o=n||0;0!==r&&(0,c.Qr)(i,i,-r/180*Math.PI),0!==s&&(0,c.eL)(i,i,s/180*Math.PI),0!==o&&(0,c.Z8)(i,i,o/180*Math.PI)}(t.rotation[2],t.rotation[0],t.rotation[1],j),n.vvSymbolRotationMatrix=n.vvSymbolRotationMatrix||(0,l.vt)(),(0,a.z0)(n.vvSymbolRotationMatrix,j)),n}function z(e,t,n){if(!e.vvSize)return n;(0,c.C)(U,n);const i=e.vvSymbolRotationMatrix;(0,c.hZ)(j,i[0],i[1],i[2],0,i[3],i[4],i[5],0,i[6],i[7],i[8],0,0,0,0,1),(0,c.lw)(U,U,j);for(let n=0;n<3;++n){const i=e.vvSize.offset[n]+t[0]*e.vvSize.factor[n];k[n]=(0,o.qE)(i,e.vvSize.minSize[n],e.vvSize.maxSize[n])}return(0,c.hs)(U,U,k),(0,c.Tl)(U,U,e.vvSymbolAnchor),U}function V(e,t,n){if(!t.vvSize)return(0,h.s)(e,1,1,1),e;for(let i=0;i<3;++i){const r=t.vvSize.offset[i]+n[0]*t.vvSize.factor[i];e[i]=(0,o.qE)(r,t.vvSize.minSize[i],t.vvSize.maxSize[i])}return e}function H(e,t){const n=null==e?0:t.attributes[e];return"number"==typeof n&&isFinite(n)?n:0}const U=(0,u.vt)(),k=(0,d.vt)(),j=(0,u.vt)()},60516:function(e,t,n){"use strict";n.d(t,{R1:function(){return o},aY:function(){return r},cN:function(){return s}});var i=n(5915);class r{constructor(e,t=null,n=0){this.array=e,this.spatialReference=t,this.offset=n}}function s(e){return"array"in e}function o(e,t,n="ground"){if((0,i.v)(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,n);if(s(t)){let i=t.offset;return e.getElevation(t.array[i++],t.array[i++],t.array[i]||0,t.spatialReference??e.spatialReference,n)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,n)}},65856:function(e,t,n){"use strict";n.d(t,{BP:function(){return l},l5:function(){return c},q3:function(){return a}});var i=n(92754),r=n(28404),s=n(90553);class o{constructor(e,t){this.layout=e,this.buffer="number"==typeof t?new ArrayBuffer(t*e.stride):t;for(const t of e.fields.keys()){const n=e.fields.get(t);this[t]=new n.constructor(this.buffer,n.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,t){const n=this[e];return n&&n.elementCount===t.ElementCount&&n.elementType===t.ElementType?n:null}slice(e,t){return new o(this.layout,this.buffer.slice(e*this.stride,t*this.stride))}copyFrom(e,t=0,n=0,i=e.count){const r=this.stride;if(r%4==0){const s=new Uint32Array(e.buffer,t*r,i*r/4);new Uint32Array(this.buffer,n*r,i*r/4).set(s)}else{const s=new Uint8Array(e.buffer,t*r,i*r);new Uint8Array(this.buffer,n*r,i*r).set(s)}return this}get usedMemory(){return this.byteLength}dispose(){}}class a{constructor(e=null){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach((e=>this._fields.set(e[0],{...e[1],constructor:d(e[1].constructor)}))))}freeze(){return this}vec2f(e,t){return this._appendField(e,i.gH,t),this}vec2f64(e,t){return this._appendField(e,i.si,t),this}vec3f(e,t){return this._appendField(e,i.xs,t),this}vec3f64(e,t){return this._appendField(e,i.Xm,t),this}vec4f(e,t){return this._appendField(e,i.Eq,t),this}vec4f64(e,t){return this._appendField(e,i.Aj,t),this}mat3f(e,t){return this._appendField(e,i.jZ,t),this}mat3f64(e,t){return this._appendField(e,i.j0,t),this}mat4f(e,t){return this._appendField(e,i.Sx,t),this}mat4f64(e,t){return this._appendField(e,i.E$,t),this}vec4u8(e,t){return this._appendField(e,i.XP,t),this}f32(e,t){return this._appendField(e,i.Y$,t),this}f64(e,t){return this._appendField(e,i.qB,t),this}u8(e,t){return this._appendField(e,i.SL,t),this}u16(e,t){return this._appendField(e,i.h,t),this}i8(e,t){return this._appendField(e,i.bf,t),this}vec2i8(e,t){return this._appendField(e,i.D6,t),this}vec2i16(e,t){return this._appendField(e,i.mJ,t),this}vec2u8(e,t){return this._appendField(e,i.LC,t),this}vec4u16(e,t){return this._appendField(e,i.Uz,t),this}u32(e,t){return this._appendField(e,i.P,t),this}_appendField(e,t,n){if(this._fields.has(e))return void(0,s.vA)(!1,`${e} already added to vertex buffer layout`);const i=t.ElementCount*(0,r.GJ)(t.ElementType),o=this._stride;this._stride+=i,this._fields.set(e,{size:i,constructor:t,offset:o,optional:n})}createBuffer(e){return new o(this,e)}createView(e){return new o(this,e)}clone(){const e=new a;return e._stride=this._stride,e._fields=new Map,this._fields.forEach(((t,n)=>e._fields.set(n,t))),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach((t=>e=Math.max(e,(0,r.GJ)(t.constructor.ElementType)))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}}function l(){return new a}class c{constructor(e){this.fields=new Array,e.fields.forEach(((e,t)=>{const n={...e,constructor:h(e.constructor)};this.fields.push([t,n])})),this.stride=e.stride}}const u=[i.Y$,i.gH,i.xs,i.Eq,i.jZ,i.Sx,i.qB,i.si,i.Xm,i.Aj,i.j0,i.E$,i.SL,i.LC,i.eI,i.XP,i.h,i.Yi,i.nS,i.Uz,i.P,i.An,i.H$,i.ml,i.bf,i.D6,i.m8,i.TX,i.Qt,i.mJ,i.Vp,i.E7,i.My,i.UL,i.zD,i.Y4];function h(e){return`${e.ElementType}_${e.ElementCount}`}function d(e){return p.get(e)}const p=new Map;u.forEach((e=>p.set(h(e),e)))},69550:function(e,t,n){"use strict";n.d(t,{U:function(){return s}});var i=n(85456),r=n(3817);function s(e,t=0){const n=e.stride;return Array.from(e.fields.keys()).map((i=>{const s=e.fields.get(i),a=s.constructor.ElementCount,l=o(s.constructor.ElementType),c=s.offset,u=s.optional?.glNormalized??!1;return new r._(i,a,l,c,n,u,t)}))}function o(e){const t=a[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const a={u8:i.pe.UNSIGNED_BYTE,u16:i.pe.UNSIGNED_SHORT,u32:i.pe.UNSIGNED_INT,i8:i.pe.BYTE,i16:i.pe.SHORT,i32:i.pe.INT,f32:i.pe.FLOAT}},70974:function(e,t,n){"use strict";n.d(t,{b:function(){return l}});var i=n(53804),r=n(83525),s=n(23502),o=(n(58941),n(40633),n(13798),n(65953));let a=class extends r.A{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};(0,i._)([(0,s.MZ)()],a.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"DECONFLICTOR_SHOW_GRID",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"LABELS_SHOW_BORDER",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"TEXT_SHOW_BASELINE",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"TEXT_SHOW_BORDER",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"OVERLAY_SHOW_CENTER",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"SHOW_POI",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"I3S_TREE_SHOW_TILES",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"I3S_SHOW_MODIFICATIONS",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"LINE_WIREFRAMES",void 0),a=(0,i._)([(0,o.$)("esri.views.3d.support.debugFlags")],a);const l=new a},79366:function(e,t,n){"use strict";n.d(t,{t:function(){return g},z:function(){return y}});var i=n(13786),r=n(1932),s=n(41546),o=n(61714),a=n(61441),l=n(50240),c=n(5047),u=n(37819),h=n(65420),d=n(14905),p=n(40359),f=n(40321),m=n(65839);function g(e,t,n=null){const r=[],g=t.mapPositions;!function(e,t){const{attributeData:{position:n},removeDuplicateStartEnd:i}=e,r=function(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}(n)&&i,s=n.length/3-(r?1:0),o=new Array(2*(s-1)),a=r?n.slice(0,-3):n;let l=0;for(let e=0;e<s-1;e++)o[l++]=e,o[l++]=e+1;t.push([m.r.POSITION,new d.n(a,o,3,r)])}(t,r);const y=r[0][1].data,b=r[0][1].indices.length,T=(0,u.EH)(b);return function(e,t,n){if(null!=e.attributeData.colorFeature)return;const i=e.attributeData.color;t.push([m.r.COLOR,new d.n(i??s.Un,n,4)])}(t,r,T),function(e,t,n){null==e.attributeData.sizeFeature&&t.push([m.r.SIZE,new d.n([e.attributeData.size??1],n,1,!0)])}(t,r,T),function(e,t,n){e.attributeData.normal&&t.push([m.r.NORMAL,new d.n(e.attributeData.normal,n,3)])}(t,r,T),function(e,t,n){null!=e.attributeData.colorFeature&&t.push([m.r.COLORFEATUREATTRIBUTE,new d.n([e.attributeData.colorFeature],n,1,!0)])}(t,r,T),function(e,t,n){null!=e.attributeData.sizeFeature&&t.push([m.r.SIZEFEATUREATTRIBUTE,new d.n([e.attributeData.sizeFeature],n,1,!0)])}(t,r,T),function(e,t,n){null!=e.attributeData.opacityFeature&&t.push([m.r.OPACITYFEATUREATTRIBUTE,new d.n([e.attributeData.opacityFeature],n,1,!0)])}(t,r,T),function(e,t,n){if(null==e.overlayInfo||e.overlayInfo.renderCoordsHelper.viewingMode!==h.RT.Global||!e.overlayInfo.spatialReference.isGeographic)return;const r=(0,l.jh)(n.length),s=(0,o.tO)(e.overlayInfo.spatialReference);for(let e=0;e<r.length;e+=3)(0,a.RC)(n,e,r,e,s);const u=n.length/3,p=(0,c.oe)(u+1);let f=_,g=v,y=0,b=0;(0,i.hZ)(f,r[b++],r[b++]),b++,p[0]=0;for(let e=1;e<u+1;++e)e===u&&(b=0),(0,i.hZ)(g,r[b++],r[b++]),b++,y+=(0,i.xg)(f,g),p[e]=y,[f,g]=[g,f];t.push([m.r.DISTANCETOSTART,new d.n(p,t[0][1].indices,1,!0)])}(t,r,y),new f.V(e,r,g,p.X.Line,n)}const _=(0,r.vt)(),v=(0,r.vt)();function y(e,t){if(null==e||0===e.length)return[];const n=[];return e.forEach((e=>{const i=e.length,r=(0,l.jh)(3*i);e.forEach(((e,t)=>{r[3*t]=e[0],r[3*t+1]=e[1],r[3*t+2]=e[2]}));const s={attributeData:{position:r,normal:t},removeDuplicateStartEnd:!1};n.push(s)})),n}},33710:function(e,t,n){"use strict";n.d(t,{Cz:function(){return r},DZ:function(){return o},PV:function(){return s},vO:function(){return i}}),n(98323),n(85456),n(78541),n(10956);const i=64,r=i/2,s=i/(r/5),o=.25},98323:function(e,t,n){"use strict";n.d(t,{CN:function(){return a},Q_:function(){return o},ny:function(){return l},sZ:function(){return c}}),n(58941);var i=n(5161),r=n(59552),s=n(85456);const o=128,a=.5;function l(e){return"cross"===e||"x"===e}function c(e,t=o,n=t*a,i=0){const l=function(e,t=o,n=t*a,i=0){switch(e){case"circle":default:return function(e,t){const n=e/2-.5;return f(e,d(n,n,t/2))}(t,n);case"square":return function(e,t){return u(e,t,!1)}(t,n);case"cross":return function(e,t,n=0){return h(e,t,!1,n)}(t,n,i);case"x":return function(e,t,n=0){return h(e,t,!0,n)}(t,n,i);case"kite":return function(e,t){return u(e,t,!0)}(t,n);case"triangle":return function(e,t){return f(e,p(e/2,t,t/2))}(t,n);case"arrow":return function(e,t){const n=t,i=t/2,r=e/2,s=.8*n,o=d(r,(e-t)/2-s,Math.sqrt(s*s+i*i)),a=p(r,n,i);return f(e,((e,t)=>Math.max(a(e,t),-o(e,t))))}(t,n)}}(e,t,n,i);return new r.g(l,{mipmap:!1,wrap:{s:s.pF.CLAMP_TO_EDGE,t:s.pF.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0,reloadable:!0})}function u(e,t,n){return n&&(t/=Math.SQRT2),f(e,((i,r)=>{let s=i-.5*e+.25,o=.5*e-r-.75;if(n){const e=(s+o)/Math.SQRT2;o=(o-s)/Math.SQRT2,s=e}return Math.max(Math.abs(s),Math.abs(o))-.5*t}))}function h(e,t,n,i=0){t-=i,n&&(t*=Math.SQRT2);const r=.5*t;return f(e,((t,s)=>{let o,a=t-.5*e,l=.5*e-s-1;if(n){const e=(a+l)/Math.SQRT2;l=(l-a)/Math.SQRT2,a=e}return a=Math.abs(a),l=Math.abs(l),o=a>l?a>r?Math.sqrt((a-r)*(a-r)+l*l):l:l>r?Math.sqrt(a*a+(l-r)*(l-r)):a,o-=i/2,o}))}function d(e,t,n){return(i,r)=>{const s=i-e,o=r-t;return Math.sqrt(s*s+o*o)-n}}function p(e,t,n){const i=Math.sqrt(t*t+n*n);return(r,s)=>{const o=Math.abs(r-e)-n,a=s-e+t/2+.75,l=(t*o+n*a)/i,c=-a;return Math.max(l,c)}}function f(e,t){const n=new Uint8Array(4*e*e);for(let r=0;r<e;r++)for(let s=0;s<e;s++){const o=s+e*r;let a=t(s,r);a=a/e+.5,(0,i.U)(a,n,4*o)}return n}},89765:function(e,t,n){"use strict";n.d(t,{ab:function(){return be},gm:function(){return Ce}});var i=n(44705),r=n(87725),s=n(39714),o=n(32237),a=n(61769),l=n(20551),c=n(32501),u=n(33400),h=n(41546),d=n(61714),p=n(96611),f=n(7456),m=n(57617),g=n(61441),_=n(5596),v=n(57652),y=n(50973),b=n(65420),T=n(1932),E=n(14905);const x=1e-6,S=(0,c.vt)(),w=(0,c.vt)();function A(e,t,n,i,r,s,o,a,l,c){return function(e,t,n){let i=ve(e.maxVert[0],e.minVert[0]),r=0;for(let t=1;t<7;++t){const n=ve(e.maxVert[t],e.minVert[t]);n>i&&(i=n,r=t)}fe(t,e.minVert[r]),fe(n,e.maxVert[r])}(e,i,r),ve(i,r)<x?1:(de(o,i,r),ge(o,o),function(e,t,n,i){const{data:r,size:s}=e;let o=Number.NEGATIVE_INFINITY,a=0;for(let e=0;e<r.length;e+=s){F[0]=r[e]-t[0],F[1]=r[e+1]-t[1],F[2]=r[e+2]-t[2];const i=n[0]*F[0]+n[1]*F[1]+n[2]*F[2],s=n[0]*n[0]+n[1]*n[1]+n[2]*n[2],l=F[0]*F[0]+F[1]*F[1]+F[2]*F[2]-i*i/s;l>o&&(o=l,a=e)}return fe(i,r,a),o}(t,i,o,s)<x?2:(de(a,r,s),ge(a,a),de(l,s,i),ge(l,l),me(n,a,o),ge(n,n),B(t,n,o,a,l,c),0))}const M=(0,c.vt)(),O=(0,c.vt)(),R=(0,c.vt)(),C=(0,c.vt)(),I=(0,c.vt)(),P=(0,c.vt)(),D=(0,c.vt)(),L=(0,c.vt)();function N(e,t,n,i,r,s,o,a,l){(function(e,t,n,i,r){!function(e,t,n,i,r){const{data:s,size:o}=e;fe(i,s),fe(r,i),n[0]=ye($,t),n[1]=n[0];for(let e=o;e<s.length;e+=o){const o=s[e]*t[0]+s[e+1]*t[1]+s[e+2]*t[2];o<n[0]&&(n[0]=o,fe(i,s,e)),o>n[1]&&(n[1]=o,fe(r,s,e))}}(e,t,z,r,i);const s=ye(n,t);z[1]-x<=s&&(i[0]=void 0),z[0]+x>=s&&(r[0]=void 0)})(e,t,n,M,O),void 0!==M[0]&&(de(R,M,n),ge(R,R),de(C,M,i),ge(C,C),de(I,M,r),ge(I,I),me(P,C,s),ge(P,P),me(D,I,o),ge(D,D),me(L,R,a),ge(L,L),B(e,P,s,C,R,l),B(e,D,o,I,C,l),B(e,L,a,R,I,l)),void 0!==O[0]&&(de(R,O,n),ge(R,R),de(C,O,i),ge(C,C),de(I,O,r),ge(I,I),me(P,C,s),ge(P,P),me(D,I,o),ge(D,D),me(L,R,a),ge(L,L),B(e,P,s,C,R,l),B(e,D,o,I,C,l),B(e,L,a,R,I,l))}const F=[0,0,0],z=(0,T.vt)(),V=(0,c.vt)(),H=(0,c.vt)(),U=(0,c.vt)(),k=(0,c.vt)(),j=(0,c.vt)(),G=(0,c.vt)();function B(e,t,n,i,r,s){if(_e(t)<x)return;me(V,n,t),me(H,i,t),me(U,r,t),Z(e,t,z),j[1]=z[0],k[1]=z[1],G[1]=k[1]-j[1];const o=[n,i,r],a=[V,H,U];for(let n=0;n<3;++n){Z(e,o[n],z),j[0]=z[0],k[0]=z[1],Z(e,a[n],z),j[2]=z[0],k[2]=z[1],G[0]=k[0]-j[0],G[2]=k[2]-j[2];const i=ue(G);i<s.quality&&(fe(s.b0,o[n]),fe(s.b1,t),fe(s.b2,a[n]),s.quality=i)}}const $=(0,c.vt)();function Z(e,t,n){const{data:i,size:r}=e;n[0]=Number.POSITIVE_INFINITY,n[1]=Number.NEGATIVE_INFINITY;for(let e=0;e<i.length;e+=r){const r=i[e]*t[0]+i[e+1]*t[1]+i[e+2]*t[2];n[0]=Math.min(n[0],r),n[1]=Math.max(n[1],r)}}function W(e,t,n){n.center=e,n.halfSize=(0,l.j)(t,t,.5),n.quaternion=a.zK}const q=(0,c.vt)(),X=(0,c.vt)(),Y=(0,c.vt)(),K=(0,c.vt)(),Q=(0,c.vt)(),J=(0,c.vt)();function ee(e,t,n){fe(q,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?q[0]=0:Math.abs(t[1])>Math.abs(t[2])?q[1]=0:q[2]=0,_e(q)<x&&(q[0]=q[1]=q[2]=1),me(X,t,q),ge(X,X),me(Y,t,X),ge(Y,Y),te(e,t,X,Y,K,Q),de(J,Q,K),ae(t,X,Y,K,Q,J,n)}function te(e,t,n,i,r,s){Z(e,t,z),r[0]=z[0],s[0]=z[1],Z(e,n,z),r[1]=z[0],s[1]=z[1],Z(e,i,z),r[2]=z[0],s[2]=z[1]}const ne=(0,c.vt)(),ie=(0,c.vt)(),re=(0,c.vt)(),se=(0,r.fA)(1,0,0,0,1,0,0,0,1),oe=(0,a.vt)();function ae(e,t,n,i,r,s,o){se[0]=e[0],se[1]=e[1],se[2]=e[2],se[3]=t[0],se[4]=t[1],se[5]=t[2],se[6]=n[0],se[7]=n[1],se[8]=n[2],o.quaternion=function(e,t){const n=t[0]+t[4]+t[8];if(n>0){let i=Math.sqrt(n+1);e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i}else{let n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);const i=(n+1)%3,r=(n+2)%3;let s=Math.sqrt(t[3*n+n]-t[3*i+i]-t[3*r+r]+1);e[n]=.5*s,s=.5/s,e[3]=(t[3*i+r]-t[3*r+i])*s,e[i]=(t[3*i+n]+t[3*n+i])*s,e[r]=(t[3*r+n]+t[3*n+r])*s}return e}(oe,se),he(ne,i,r),pe(ne,ne,.5),pe(ie,e,ne[0]),pe(re,t,ne[1]),he(ie,ie,re),pe(re,n,ne[2]),o.center=(0,l.g)(ie,ie,re),o.halfSize=(0,l.j)(ne,s,.5)}class le{constructor(e){this.minVert=new Array(7),this.maxVert=new Array(7),this.buffer=new ArrayBuffer(448);let t=0;this.minProj=new Float64Array(this.buffer,t,7),t+=56,this.maxProj=new Float64Array(this.buffer,t,7),t+=56;for(let e=0;e<7;++e)this.minVert[e]=new Float64Array(this.buffer,t,3),t+=24;for(let e=0;e<7;++e)this.maxVert[e]=new Float64Array(this.buffer,t,3),t+=24;for(let e=0;e<7;++e)this.minProj[e]=Number.POSITIVE_INFINITY,this.maxProj[e]=Number.NEGATIVE_INFINITY;const n=new Array(7),i=new Array(7),{data:r,size:s}=e;for(let e=0;e<r.length;e+=s){let t=r[e];t<this.minProj[0]&&(this.minProj[0]=t,n[0]=e),t>this.maxProj[0]&&(this.maxProj[0]=t,i[0]=e),t=r[e+1],t<this.minProj[1]&&(this.minProj[1]=t,n[1]=e),t>this.maxProj[1]&&(this.maxProj[1]=t,i[1]=e),t=r[e+2],t<this.minProj[2]&&(this.minProj[2]=t,n[2]=e),t>this.maxProj[2]&&(this.maxProj[2]=t,i[2]=e),t=r[e]+r[e+1]+r[e+2],t<this.minProj[3]&&(this.minProj[3]=t,n[3]=e),t>this.maxProj[3]&&(this.maxProj[3]=t,i[3]=e),t=r[e]+r[e+1]-r[e+2],t<this.minProj[4]&&(this.minProj[4]=t,n[4]=e),t>this.maxProj[4]&&(this.maxProj[4]=t,i[4]=e),t=r[e]-r[e+1]+r[e+2],t<this.minProj[5]&&(this.minProj[5]=t,n[5]=e),t>this.maxProj[5]&&(this.maxProj[5]=t,i[5]=e),t=r[e]-r[e+1]-r[e+2],t<this.minProj[6]&&(this.minProj[6]=t,n[6]=e),t>this.maxProj[6]&&(this.maxProj[6]=t,i[6]=e)}for(let e=0;e<7;++e){let t=n[e];fe(this.minVert[e],r,t),t=i[e],fe(this.maxVert[e],r,t)}}}class ce{constructor(){this.b0=(0,c.fA)(1,0,0),this.b1=(0,c.fA)(0,1,0),this.b2=(0,c.fA)(0,0,1),this.quality=0}}function ue(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function he(e,t,n){e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2]}function de(e,t,n){e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2]}function pe(e,t,n){e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n}function fe(e,t,n=0){e[0]=t[n],e[1]=t[n+1],e[2]=t[n+2]}function me(e,t,n){const i=t[0],r=t[1],s=t[2],o=n[0],a=n[1],l=n[2];e[0]=r*l-s*a,e[1]=s*o-i*l,e[2]=i*a-r*o}function ge(e,t){const n=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(n>0){const i=1/Math.sqrt(n);e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}}function _e(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function ve(e,t){const n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return n*n+i*i+r*r}function ye(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}class be{constructor(e=c.uY,t=Be,n=a.zK){this._data=[e[0],e[1],e[2],t[0],t[1],t[2],n[0],n[1],n[2],n[3]]}clone(){const e=new be;return e._data=this._data.slice(),e}invalidate(){this._data[3]=-1}get isValid(){return this._data[3]>=0}static fromData(e){const t=new be;return t._data=e.slice(),t}static fromJSON(e){return new be(e.center,e.halfSize,e.quaternion)}copy(e){this._data=e.data.slice()}get center(){return(0,l.s)(y.rq.get(),this._data[0],this._data[1],this._data[2])}get centerX(){return this._data[0]}get centerY(){return this._data[1]}get centerZ(){return this._data[2]}getCenter(e){return e[0]=this._data[0],e[1]=this._data[1],e[2]=this._data[2],e}set center(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2]}setCenter(e,t,n){this._data[0]=e,this._data[1]=t,this._data[2]=n}get halfSize(){return(0,l.s)(y.rq.get(),this._data[3],this._data[4],this._data[5])}get halfSizeX(){return this._data[3]}get halfSizeY(){return this._data[4]}get halfSizeZ(){return this._data[5]}getHalfSize(e){return e[0]=this._data[3],e[1]=this._data[4],e[2]=this._data[5],e}set halfSize(e){this._data[3]=e[0],this._data[4]=e[1],this._data[5]=e[2]}get quaternion(){return(0,o.hZ)(y.J8.get(),this._data[6],this._data[7],this._data[8],this._data[9])}getQuaternion(e){return e[0]=this._data[6],e[1]=this._data[7],e[2]=this._data[8],e[3]=this._data[9],e}set quaternion(e){this._data[6]=e[0],this._data[7]=e[1],this._data[8]=e[2],this._data[9]=e[3]}get data(){return this._data}getCorners(e){const t=Te,n=this._data;t[0]=n[6],t[1]=n[7],t[2]=n[8],t[3]=n[9];for(let i=0;i<8;++i){const r=e[i];r[0]=(1&i?-1:1)*n[3],r[1]=(2&i?-1:1)*n[4],r[2]=(4&i?-1:1)*n[5],(0,l.u)(r,r,t),r[0]+=n[0],r[1]+=n[1],r[2]+=n[2]}}doesIntersectFrustumConservativeApproximation(e){return this.intersectPlane(e[0])<=0&&this.intersectPlane(e[1])<=0&&this.intersectPlane(e[2])<=0&&this.intersectPlane(e[3])<=0&&this.intersectPlane(e[4])<=0&&this.intersectPlane(e[5])<=0}get radius(){const e=this._data[3],t=this._data[4],n=this._data[5];return Math.sqrt(e*e+t*t+n*n)}intersectSphere(e){Se[0]=this._data[0]-e[0],Se[1]=this._data[1]-e[1],Se[2]=this._data[2]-e[2];const t=this.getQuaternion(Ee);return(0,o.Xr)(Te,t),(0,l.u)(Se,Se,Te),(0,l.v)(Se,Se),we[0]=Math.min(Se[0],this._data[3]),we[1]=Math.min(Se[1],this._data[4]),we[2]=Math.min(Se[2],this._data[5]),(0,l.w)(we,Se)<e[3]*e[3]}intersectSphereWithMBS(e,t=this.radius){const n=this._data;Se[0]=n[0]-e[0],Se[1]=n[1]-e[1],Se[2]=n[2]-e[2];const i=e[3],r=i+t;return!((0,l.x)(Se)>r*r)&&(Te[0]=-n[6],Te[1]=-n[7],Te[2]=-n[8],Te[3]=n[9],(0,l.u)(Se,Se,Te),(0,l.v)(Se,Se),we[0]=Math.min(Se[0],n[3]),we[1]=Math.min(Se[1],n[4]),we[2]=Math.min(Se[2],n[5]),(0,l.w)(we,Se)<i*i)}intersectPlane(e){const t=e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3],n=this.projectedRadius((0,_.Qj)(e));return t>n?1:t<-n?-1:0}intersectRay(e,t,n=0){const i=this._data,r=Te;r[0]=-i[6],r[1]=-i[7],r[2]=-i[8],r[3]=i[9],Se[0]=e[0]-i[0],Se[1]=e[1]-i[1],Se[2]=e[2]-i[2];const s=(0,l.u)(Se,Se,Te),o=(0,l.u)(we,t,Te);let a=-1/0,c=1/0;const u=this.getHalfSize(ze);for(let e=0;e<3;e++){const t=s[e],i=o[e],r=u[e]+n;if(Math.abs(i)>1e-6){const e=(r-t)/i,n=(-r-t)/i;a=Math.max(a,Math.min(e,n)),c=Math.min(c,Math.max(e,n))}else if(t>r||t<-r)return!1}return a<=c}projectedArea(e,t,n,r){const s=this.getQuaternion(Ee);(0,o.Xr)(Te,s),Se[0]=e[0]-this._data[0],Se[1]=e[1]-this._data[1],Se[2]=e[2]-this._data[2],(0,l.u)(Se,Se,Te);const a=this.getHalfSize(ze),c=Se[0]<-a[0]?-1:Se[0]>a[0]?1:0,h=Se[1]<-a[1]?-1:Se[1]>a[1]?1:0,d=Se[2]<-a[2]?-1:Se[2]>a[2]?1:0,p=Math.abs(c)+Math.abs(h)+Math.abs(d);if(0===p)return 1/0;const f=1===p?4:6,m=6*(c+3*h+9*d+13);(0,i.I0)(Ve,s),(0,i.hs)(Ve,Ve,a);const g=this.getCenter(Ne);for(let e=0;e<f;e++){const n=Re[m+e];(0,l.s)(Se,((1&n)<<1)-1,(2&n)-1,((4&n)>>1)-1),(0,l.t)(Se,Se,Ve),(0,l.g)(Ae,g,Se),Ae[3]=1,(0,u.t)(Ae,Ae,t);const i=1/Math.max(1e-6,Ae[3]);Oe[2*e]=Ae[0]*i,Oe[2*e+1]=Ae[1]*i}const _=2*f-2;let v=Oe[0]*(Oe[3]-Oe[_+1])+Oe[_]*(Oe[1]-Oe[_-1]);for(let e=2;e<_;e+=2)v+=Oe[e]*(Oe[e+3]-Oe[e-1]);return Math.abs(v)*n*r*.125}projectedRadius(e){const t=this.getQuaternion(Ee);return(0,o.Xr)(Te,t),(0,l.u)(Se,e,Te),Math.abs(Se[0]*this._data[3])+Math.abs(Se[1]*this._data[4])+Math.abs(Se[2]*this._data[5])}minimumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]-this.projectedRadius((0,_.Qj)(e))}maximumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]+this.projectedRadius((0,_.Qj)(e))}toAaBoundingBox(e){const t=this.getQuaternion(Ee),n=(0,i.I0)(Ve,t),r=this._data[3]*Math.abs(n[0])+this._data[4]*Math.abs(n[3])+this._data[5]*Math.abs(n[6]),s=this._data[3]*Math.abs(n[1])+this._data[4]*Math.abs(n[4])+this._data[5]*Math.abs(n[7]),o=this._data[3]*Math.abs(n[2])+this._data[4]*Math.abs(n[5])+this._data[5]*Math.abs(n[8]);e[0]=this._data[0]-r,e[1]=this._data[1]-s,e[2]=this._data[2]-o,e[3]=this._data[0]+r,e[4]=this._data[1]+s,e[5]=this._data[2]+o}transform(e,t,n,i=0,r=(0,p.lO)(n),s=(0,p.lO)(t),a=(0,g.jd)(t,s)){if(n===r)t.isGeographic?function(e,t,n,i,r=(0,p.lO)(n)){const s=(0,d.tO)(n),a=1+Math.max(0,i)/(s.radius+e.centerZ);e.getCenter(Le),Le[2]+=i,(0,m.projectBuffer)(Le,n,0,Le,r,0,1),t.center=Le;const c=e.getQuaternion(Ee);t.quaternion=c,(0,o.Xr)(Te,c),(0,l.s)(ke,0,0,1),(0,l.u)(ke,ke,Te);const u=e.getHalfSize(ze);(0,l.s)(ke,u[0]*Math.abs(ke[0]),u[1]*Math.abs(ke[1]),u[2]*Math.abs(ke[2])),(0,l.j)(ke,ke,s.inverseFlattening),(0,l.g)(ke,u,ke),t.halfSize=(0,l.j)(ke,ke,a)}(this,e,t,i,s):function(e,t,n,i,r=(0,p.lO)(n),s=(0,g.jd)(n,r)){e.getCorners(Ue),e.getCenter(Le),Le[2]+=i,(0,f.l)(n,Le,He,r),t.setCenter(He[12],He[13],He[14]);const a=2*Math.sqrt(1+He[0]+He[5]+He[10]);Te[0]=(He[6]-He[9])/a,Te[1]=(He[8]-He[2])/a,Te[2]=(He[1]-He[4])/a,Te[3]=.25*a;const c=e.getQuaternion(Ee);t.quaternion=(0,o.lw)(Te,Te,c),(0,o.Xr)(Te,Te),(0,l.s)(je,0,0,0);const u=t.getCenter(Fe);for(const e of Ue)e[2]+=i,s(e,0,e,0),(0,l.z)(ke,e,u),(0,l.u)(ke,ke,Te),(0,l.v)(ke,ke),(0,l.C)(je,je,ke);t.halfSize=je}(this,e,t,i,s,a);else if(t.isWGS84&&(n.isWebMercator||(0,v.r1)(n)))!function(e,t,n,i,r){t.getCenter(Ne),Ne[2]+=r;const s=(0,p.lO)(n);(0,m.projectBuffer)(Ne,e,0,Ne,s,0,1),Ie(s,t,Ne,n,i)}(t,this,n,e,i);else if(t.isWebMercator&&(0,v.r1)(n))!function(e,t,n,i,r){t.getCenter(Ne),Ne[2]+=r,Ie(e,t,Ne,n,i)}(t,this,n,e,i);else{const r=this.getCenter(Ne);r[2]+=i,(0,m.projectBuffer)(r,t,0,r,n,0,1),e.center=r,this!==e&&(e.quaternion=this.getQuaternion(Ee),e.halfSize=this.getHalfSize(ze))}}}const Te=(0,a.vt)(),Ee=(0,a.vt)(),xe=(0,a.vt)(),Se=(0,c.vt)(),we=(0,c.vt)(),Ae=(0,h.vt)();function Me(e,t=new be){return function(e,t){const{data:n,size:i}=e,r=n.length/i;if(r<=0)return;const s=new le(e);he(S,s.minProj,s.maxProj),pe(S,S,.5),de(w,s.maxProj,s.minProj);const o=ue(w),a=new ce;a.quality=o,r<14&&(e=new E.K(new Float64Array(s.buffer,112,42),3));const l=(0,c.vt)(),u=(0,c.vt)(),h=(0,c.vt)(),d=(0,c.vt)(),p=(0,c.vt)(),f=(0,c.vt)(),m=(0,c.vt)();switch(A(s,e,m,l,u,h,d,p,f,a)){case 1:return void W(S,w,t);case 2:return void ee(e,d,t)}N(e,m,l,u,h,d,p,f,a),te(e,a.b0,a.b1,a.b2,K,Q);const g=(0,c.vt)();de(g,Q,K),a.quality=ue(g),a.quality<o?ae(a.b0,a.b1,a.b2,K,Q,g,t):W(S,w,t)}(e,t),t}const Oe=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],Re=(()=>{const e=new Int8Array(162);let t=0;const n=n=>{for(let i=0;i<n.length;i++)e[t+i]=n[i];t+=6};return n([6,2,3,1,5,4]),n([0,2,3,1,5,4]),n([0,2,3,7,5,4]),n([0,1,3,2,6,4]),n([0,1,3,2,0,0]),n([0,1,5,7,3,2]),n([0,1,3,7,6,4]),n([0,1,3,7,6,2]),n([0,1,5,7,6,2]),n([0,1,5,4,6,2]),n([0,1,5,4,0,0]),n([0,1,3,7,5,4]),n([0,2,6,4,0,0]),n([0,0,0,0,0,0]),n([1,3,7,5,0,0]),n([2,3,7,6,4,0]),n([2,3,7,6,0,0]),n([2,3,1,5,7,6]),n([0,1,5,7,6,2]),n([0,1,5,7,6,4]),n([0,1,3,7,6,4]),n([4,5,7,6,2,0]),n([4,5,7,6,0,0]),n([4,5,1,3,7,6]),n([0,2,3,7,5,4]),n([6,2,3,7,5,4]),n([6,2,3,1,5,4]),e})();function Ce(e,t,n,i,r){const s=e.getQuaternion(Ee);r.quaternion=s,(0,o.Xr)(Te,s);const a=e.getCenter(Ne),u=e.getHalfSize(ze);if(i===b.RT.Global){(0,l.u)(ke,a,Te),(0,l.v)(je,ke),(0,l.y)(Ge,je,u),(0,l.z)(Ge,je,Ge);const i=(0,l.l)(Ge);(0,l.g)(Ge,je,u);const s=(0,l.l)(Ge);if(i<n)r.center=a,(0,l.s)(ke,n,n,n),r.halfSize=(0,l.g)(ke,u,ke);else{const o=s>0?1+t/s:1,a=i>0?1+n/i:1,c=(a+o)/2,h=(a-o)/2;(0,l.j)(Ge,je,h),r.halfSize=(0,l.r)(Ge,Ge,u,c),(0,l.j)(Ge,je,c),(0,l.r)(Ge,Ge,u,h),(0,l.A)(ke,ke),(0,l.B)(ke,Ge,ke);const d=e.getQuaternion(xe);r.center=(0,l.u)(ke,ke,d)}}else{r.center=(0,l.r)(ke,a,c.Cb,(n+t)/2);const e=(0,l.u)(ke,c.Cb,Te);(0,l.v)(e,e),r.halfSize=(0,l.r)(je,u,e,(n-t)/2)}return r}function Ie(e,t,n,r,s){const o=t.getQuaternion(Ee),a=(0,i.I0)(Ve,o),l=t.getHalfSize(ze);for(let e=0;e<8;++e){for(let t=0;t<3;++t)Le[t]=l[t]*(e&1<<t?-1:1);for(let t=0;t<3;++t){let i=n[t];for(let e=0;e<3;++e)i+=Le[e]*a[3*e+t];Pe[3*e+t]=i}}(0,m.projectBuffer)(Pe,e,0,Pe,r,0,8),Me(De,s)}const Pe=new Array(24),De=new E.K(Pe,3),Le=(0,c.vt)(),Ne=(0,c.vt)(),Fe=(0,c.vt)(),ze=(0,c.vt)(),Ve=(0,r.vt)(),He=(0,s.vt)(),Ue=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],ke=(0,c.vt)(),je=(0,c.vt)(),Ge=(0,c.vt)(),Be=(0,c.fA)(-1,-1,-1)},29800:function(e,t,n){"use strict";n.d(t,{A:function(){return c},C:function(){return l}});var i=n(57617),r=n(50240),s=n(82588),o=n(49618),a=n(45147);function l(e,t,n,i){const a="polygon"===e.type?s.Wq.CCW_IS_HOLE:s.Wq.NONE,l="polygon"===e.type?e.rings:e.paths,{position:c,outlines:h}=(0,s.oR)(l,!!e.hasZ,a,e.spatialReference),d=(0,r.jh)(c.length),p=(0,o.au)(c,e.spatialReference,0,d,0,c,0,c.length/3,t,n,i),f=null!=p;return{lines:f?u(h,c,d):[],projectionSuccess:f,sampledElevation:p}}function c(e,t){const n="polygon"===e.type?s.Wq.CCW_IS_HOLE:s.Wq.NONE,r="polygon"===e.type?e.rings:e.paths,{position:o,outlines:l}=(0,s.oR)(r,!1,n),c=(0,i.projectBuffer)(o,e.spatialReference,0,o,t,0,o.length/3);for(let e=2;e<o.length;e+=3)o[e]=a.bi;return{lines:c?u(l,o):[],projectionSuccess:c}}function u(e,t,n=null){const i=new Array;for(const{index:s,count:o}of e){if(o<=1)continue;const e=3*s,a=3*o;i.push({position:(0,r.l5)(t,3*s,3*o),mapPositions:null!=n?(0,r.l5)(n,e,a):void 0})}return i}},45147:function(e,t,n){"use strict";n.d(t,{bi:function(){return on}});var i,r,s=n(53804),o=n(48996),a=n(58941),l=n(25738),c=n(95929),u=n(7187),h=n(28181),d=n(17660),p=n(23502),f=n(40633),m=(n(13798),n(65953)),g=n(73364),_=n(20551),v=n(32501),y=n(65420),b=n(46949),T=n(70974),E=n(86398),x=n(87416),S=n(79068);class w{constructor(){this._extent=(0,x.vt)(),this.resolution=0,this.renderLocalOrigin=(0,S.f)(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new A}get extent(){return this._extent}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const t=.001*e.range;if(this._extent[0]-t<=e.min){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,x.cY)(this._extent,e.range,0,t)}if(this._extent[2]+t>=e.max){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,x.cY)(this._extent,-e.range,0,t)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,(0,x.C)(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}}class A{constructor(){this.extents=[(0,x.vt)(),(0,x.vt)(),(0,x.vt)()],this.numViews=0}}(r=i||(i={}))[r.Color=0]="Color",r[r.ColorNoRasterImage=1]="ColorNoRasterImage",r[r.Highlight=2]="Highlight",r[r.WaterNormal=3]="WaterNormal",r[r.Occluded=4]="Occluded",r[r.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor";class M{constructor(e,t,n){this._fbos=e,this._format=t,this._name=n}get valid(){return null!=this._handle?.getTexture()}dispose(){this._handle=(0,c.Gz)(this._handle)}get texture(){return this._handle?.getTexture()}bind(e,t,n){this._handle&&this._handle.fbo?.width===t&&this._handle.fbo?.height===n||(this._handle?.release(),this._handle=this._fbos.acquire(t,n,this._name,this._format)),e.unbindTexture(this._handle?.fbo?.colorTexture),e.bindFramebuffer(this._handle?.fbo)}generateMipMap(){this._handle?.getTexture()?.descriptor?.hasMipmap&&this._handle?.getTexture()?.generateMipmap()}}var O=n(98680),R=n(27264);class C{constructor(e,t,n,i,r=O.N.RGBA_MIPMAP){this.output=n,this.content=i,this.fbo=new M(e,r,t)}get valid(){return this.fbo.valid}}class I{constructor(e){this.targets=[new C(e,"overlay color",R.V.Color,i.Color),new C(e,"overlay IM color",R.V.Color,i.ColorNoRasterImage),new C(e,"overlay highlight",R.V.Highlight,i.Highlight,O.N.RGBA4),new C(e,"overlay water",R.V.Normal,i.WaterNormal),new C(e,"overlay occluded",R.V.Color,i.Occluded)],(0,a.A)("enable-feature:objectAndLayerId-rendering")&&this.targets.push(new C(e,"overlay oid",R.V.ObjectAndLayerIdColor,i.ObjectAndLayerIdColor))}getTexture(e){return this.targets[e]?.fbo.texture}dispose(){for(const e of this.targets)e.fbo.dispose()}computeValidity(){return this.targets.reduce(((e,t,n)=>t.valid?e|=1<<n:e),0)}}var P,D,L=n(65631),N=n(41546),F=n(94211);F.Zo,(D=P||(P={}))[D.Material=0]="Material",D[D.ShadowMap=1]="ShadowMap",D[D.Highlight=2]="Highlight",D[D.ViewshedShadowMap=3]="ViewshedShadowMap",n(42426),n(11520),n(11388),n(41356),n(14543),n(39506),n(39838);var z,V,H=n(65312);(V=z||(z={}))[V.Disabled=0]="Disabled",V[V.Enabled=1]="Enabled",V[V.EnabledWithWater=2]="EnabledWithWater",V[V.COUNT=3]="COUNT",H.n,(0,N.vt)();var U=n(55747),k=n(7970),j=n(8610);class G{constructor(e){this._context=e,this._perConstructorInstances=new k.O,this._frameCounter=0,this._keepAliveFrameCount=$}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach((e=>e.forEach((e=>e.technique.destroy())))),this._perConstructorInstances.clear()}acquire(e,t=Z){const n=t.key;let i=this._perConstructorInstances.get(e,n);if(null==i){const r=new e(this._context,t,(()=>this.release(r)));i=new B(r),this._perConstructorInstances.set(e,n,i)}return++i.refCount,i.technique}releaseAndAcquire(e,t,n){if(null!=n){if(t.key===n.key)return n;this.release(n)}return this.acquire(e,t)}release(e){if(null==e||this._perConstructorInstances.empty)return;const t=this._perConstructorInstances.get(e.constructor,e.key);null!=t&&(--t.refCount,0===t.refCount&&(t.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==$&&this._perConstructorInstances.forEach(((e,t)=>{e.forEach(((e,n)=>{0===e.refCount&&e.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(e.technique.destroy(),this._perConstructorInstances.delete(t,n))}))}))}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach(((t,n)=>{e.push((async(e,t)=>{const n=t.shader;n&&(await n.reload(),e.forEach((e=>e.technique.reload(this._context))))})(t,n))})),await Promise.all(e)}}class B{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}}const $=-1,Z=new j.K;var W=n(67521),q=n(90553);class X{constructor(e,t,n,i){this._textures=e,this._techniques=t,this.materialChanged=n,this.requestRender=i,this._id2glMaterialRef=new k.O}dispose(){this._textures.destroy()}acquire(e,t,n){this._ownMaterial(e);const i=e.produces.get(t);if(!i?.(n))return null;let r=this._id2glMaterialRef.get(n,e.id);if(null==r){const t=e.createGLMaterial({material:e,techniques:this._techniques,textures:this._textures,output:n});r=new Y(t),this._id2glMaterialRef.set(n,e.id,r)}return r.ref(),r.glMaterial}release(e,t){const n=this._id2glMaterialRef.get(t,e.id);null!=n&&(n.unref(),n.referenced||((0,c.WD)(n.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&f.A.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}}class Y{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,(0,q.vA)(this._refCnt>=0)}get referenced(){return this._refCnt>0}}var K=n(19860),Q=n(24100),J=(n(38504),n(39714)),ee=n(1932),te=n(75256),ne=n(60808),ie=n(98901),re=n(78946),se=n(54407),oe=n(29165),ae=n(55890),le=n(95629);class ce{constructor(e,t){this.shadowMap=e,this.slicePlane=t,this.slot=oe.N.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=ae.y.NONE,this.alignPixelEnabled=!1,this.decorations=se.ID.ON,this.overlayStretch=1,this.viewshedEnabled=!1,this._camera=new L.A,this._inverseViewport=(0,ee.vt)(),this.oldLighting=new le.TA,this.newLighting=new le.TA,this._fadedLighting=new le.TA,this._lighting=this.newLighting,this.ssr=new ue,this.multipassEnabled=!1,this.multipassTerrain=new re.h,this.multipassGeometry=new ie.U,this.hudRenderStyle=ne.D.Occluded,this.cloudsFade=new te.ny,this.shadowHighlightsVisible=!1}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:t,newLighting:n}=this;e>=1?this._lighting=n:(this._fadedLighting.lerpLighting(t,n,e),this._lighting=this._fadedLighting)}}class ue{constructor(){this.fadeFactor=1,this.reprojectionMatrix=(0,J.vt)()}}class he{constructor(e,t,n=null){this.rctx=e,this.sliceHelper=n,this.lastFrameCamera=new L.A,this.output=R.V.Color,this.renderOccludedMask=de,this.bindParameters=new ce(t,null!=n?n.plane:null),this.bindParameters.alignPixelEnabled=!0}}const de=Q.m$.Occlude|Q.m$.OccludeAndTransparent|Q.m$.OccludeAndTransparentStencil;var pe=n(15774),fe=n(87725),me=n(13786),ge=n(33400);let _e=class extends L.A{constructor(){super(...arguments),this._projectionMatrix=(0,J.vt)()}get projectionMatrix(){return this._projectionMatrix}};(0,s._)([(0,p.MZ)()],_e.prototype,"_projectionMatrix",void 0),(0,s._)([(0,p.MZ)({readOnly:!0})],_e.prototype,"projectionMatrix",null),_e=(0,s._)([(0,m.$)("esri.views.3d.webgl-engine.lib.CascadeCamera")],_e);var ve,ye,be=n(12569),Te=n(85456),Ee=n(78541);(ye=ve||(ve={}))[ye.Highlight=0]="Highlight",ye[ye.ExcludeHighlight=1]="ExcludeHighlight";class xe{constructor(){this.camera=new _e,this.lightMat=(0,J.vt)()}}class Se{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}}class we{constructor(e,t){this._fbos=e,this._viewingMode=t,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new Se,this._projectionView=(0,J.vt)(),this._projectionViewInverse=(0,J.vt)(),this._modelViewLight=(0,J.vt)(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=(0,N.vt)(),this._cascades=[new xe,new xe,new xe,new xe],this._lastOrigin=null,this._maxTextureWidth=Math.min((0,a.A)("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){return this._handle?.getTexture()}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return(0,ge.s)(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeOffscreenBuffers(){this._handle=(0,c.Gz)(this._handle),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=(0,pe.qE)(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&null!=this.depthTexture}get cascades(){for(let e=0;e<this._numCascades;++e)Ne[e]=this._cascades[e];return Ne.length=this._numCascades,Ne}start(e,t,n,i,r){(0,q.vA)(this.enabled);const{near:s,far:o}=function(e){let{near:t,far:n}=e;return t<2&&(t=2),n<2&&(n=2),t>=n&&(t=2,n=4),{near:t,far:n}}(n);this._computeCascadeDistances(s,o,i),this._textureHeight=this._computeTextureHeight(e,r,i),this._setupMatrices(e,t);const{viewMatrix:a,projectionMatrix:l}=e;for(let e=0;e<this._numCascades;++e)this._constructCascade(e,l,a,t);this._lastOrigin=null,this.clear()}finish(){(0,q.vA)(this.enabled),this._handle?.detachDepth()}getShadowMapMatrices(e){if(!this._lastOrigin||!(0,_.e)(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||(0,v.vt)(),(0,_.c)(this._lastOrigin,e);for(let t=0;t<this._numCascades;++t){(0,g.Tl)(Fe,this._cascades[t].lightMat,e);for(let e=0;e<16;++e)ze[16*t+e]=Fe[e]}}return ze}moveSnapshot(e){(0,q.vA)(this.enabled),this._handle?.detachDepth(),this._snapshots[e]?.release(),this._snapshots[e]=this._handle,this._handle=null,this.clear()}copySnapshot(e){const t=this._handle?.getTexture()?.descriptor;if(!this.enabled||!t)return;this._snapshots[e]?.release();const{width:n,height:i}=t,r=e===ve.Highlight?"shadow highlight snapshot":"shadow no highlight snapshot";this._snapshots[e]=this._fbos.acquire(n,i,r,O.N.RGBA4);const s=this._fbos.rctx;this._bindFbo();const o=s.bindTexture(this._snapshots[e]?.getTexture(),Ee.g.TEXTURE_UNIT_FOR_UPDATES);s.gl.copyTexSubImage2D(Te.Ap.TEXTURE_2D,0,0,0,0,0,n,i),s.bindTexture(o,Ee.g.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(e){return this.enabled?this._snapshots[e]?.getTexture():null}clear(){const e=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),e.setClearColor(1,1,1,1),e.clear(Te.hn.COLOR_BUFFER_BIT|Te.hn.DEPTH_BUFFER_BIT)}_computeTextureHeight(e,t,n){const i=Math.min(window.devicePixelRatio,t)/e.pixelRatio,r=n?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,s=(0,be.Mv)(Math.floor(Math.max(e.fullWidth,e.fullHeight)*i*r)),o=Math.min(this._maxTextureWidth,this._numCascades*s);return(0,be.uT)(o/this._numCascades)}_ensureFbo(){this._handle?.fbo?.width===this._textureWidth&&this._handle?.fbo.height===this._textureHeight||(this._handle?.release(),this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",O.N.RGBA4)),this._handle?.acquireDepth(O.z.DEPTH16_BUFFER)}_discardSnapshot(e){this._snapshots[e]=(0,c.Gz)(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){const e=this._fbos.rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer(this._handle?.fbo)}_constructCascade(e,t,n,i){const r=this._cascades[e],s=-this._cascadeDistances[e],o=-this._cascadeDistances[e+1],a=(t[10]*s+t[14])/Math.abs(t[11]*s+t[15]),l=(t[10]*o+t[14])/Math.abs(t[11]*o+t[15]);(0,q.vA)(a<l);for(let e=0;e<8;++e){(0,ge.s)(Me,e%4==0||e%4==3?-1:1,e%4==0||e%4==1?-1:1,e<4?a:l,1);const t=Oe[e];(0,ge.t)(t,Me,this._projectionViewInverse),t[0]/=t[3],t[1]/=t[3],t[2]/=t[3]}(0,_.k)(Le,Oe[0]),r.camera.viewMatrix=(0,g.Tl)(Ae,this._modelViewLight,Le);for(let e=0;e<8;++e)(0,_.h)(Oe[e],Oe[e],r.camera.viewMatrix);let c=Oe[0][2],u=Oe[0][2];for(let e=1;e<8;++e)c=Math.min(c,Oe[e][2]),u=Math.max(u,Oe[e][2]);c-=200,u+=200,r.camera.near=-u,r.camera.far=-c,function(e,t,n,i,r){const s=1/Oe[0][3],o=1/Oe[4][3];(0,q.vA)(s<o);let a=s+Math.sqrt(s*o);const l=Math.sin((0,pe.XM)(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]));a/=l,function(e,t,n,i,r,s,o,a){(0,me.hZ)(Ve,0,0);for(let t=0;t<4;++t)(0,me.WQ)(Ve,Ve,e[t]);(0,me.hs)(Ve,Ve,.25),(0,me.hZ)(He,0,0);for(let t=4;t<8;++t)(0,me.WQ)(He,He,e[t]);(0,me.hs)(He,He,.25),(0,me.Cc)(Ue[0],e[4],e[5],.5),(0,me.Cc)(Ue[1],e[5],e[6],.5),(0,me.Cc)(Ue[2],e[6],e[7],.5),(0,me.Cc)(Ue[3],e[7],e[4],.5);let l=0,c=(0,me.hG)(Ue[0],Ve);for(let e=1;e<4;++e){const t=(0,me.hG)(Ue[e],Ve);t<c&&(c=t,l=e)}(0,me.Re)(ke,Ue[l],e[l+4]);const u=ke[0];let h,d;ke[0]=-ke[1],ke[1]=u,(0,me.Re)(je,He,Ve),(0,me.Om)(je,ke)<0&&(0,me.ze)(ke,ke),(0,me.Cc)(ke,ke,je,n),(0,me.S8)(ke,ke),h=d=(0,me.Om)((0,me.Re)(Ge,e[0],Ve),ke);for(let t=1;t<8;++t){const n=(0,me.Om)((0,me.Re)(Ge,e[t],Ve),ke);n<h?h=n:n>d&&(d=n)}(0,me.C)(i,Ve),(0,me.hs)(Ge,ke,h-t),(0,me.WQ)(i,i,Ge);let p=-1,f=1,m=0,g=0;for(let t=0;t<8;++t){(0,me.Re)(Be,e[t],i),(0,me.S8)(Be,Be);const n=ke[0]*Be[1]-ke[1]*Be[0];n>0?n>p&&(p=n,m=t):n<f&&(f=n,g=t)}(0,q.MX)(p>0,"leftArea"),(0,q.MX)(f<0,"rightArea"),(0,me.hs)($e,ke,h),(0,me.WQ)($e,$e,Ve),(0,me.hs)(Ze,ke,d),(0,me.WQ)(Ze,Ze,Ve),We[0]=-ke[1],We[1]=ke[0];const _=(0,q.L)(i,e[g],Ze,(0,me.WQ)(Ge,Ze,We),1,r),v=(0,q.L)(i,e[m],Ze,Ge,1,s),y=(0,q.L)(i,e[m],$e,(0,me.WQ)(Ge,$e,We),1,o),b=(0,q.L)(i,e[g],$e,Ge,1,a);(0,q.MX)(_,"rayRay"),(0,q.MX)(v,"rayRay"),(0,q.MX)(y,"rayRay"),(0,q.MX)(b,"rayRay")}(Oe,a,l,Re,Ce,Ie,Pe,De),function(e,t,n,i,r){(0,me.Re)(Ke,n,i),(0,me.hs)(Ke,Ke,.5),Qe[0]=Ke[0],Qe[1]=Ke[1],Qe[2]=0,Qe[3]=Ke[1],Qe[4]=-Ke[0],Qe[5]=0,Qe[6]=Ke[0]*Ke[0]+Ke[1]*Ke[1],Qe[7]=Ke[0]*Ke[1]-Ke[1]*Ke[0],Qe[8]=1,Qe[qe(0,2)]=-(0,me.Om)(Ye(Qe,0),e),Qe[qe(1,2)]=-(0,me.Om)(Ye(Qe,1),e);let s=(0,me.Om)(Ye(Qe,0),n)+Qe[qe(0,2)],o=(0,me.Om)(Ye(Qe,1),n)+Qe[qe(1,2)],a=(0,me.Om)(Ye(Qe,0),i)+Qe[qe(0,2)],l=(0,me.Om)(Ye(Qe,1),i)+Qe[qe(1,2)];s=-(s+a)/(o+l),Qe[qe(0,0)]+=Qe[qe(1,0)]*s,Qe[qe(0,1)]+=Qe[qe(1,1)]*s,Qe[qe(0,2)]+=Qe[qe(1,2)]*s,s=1/((0,me.Om)(Ye(Qe,0),n)+Qe[qe(0,2)]),o=1/((0,me.Om)(Ye(Qe,1),n)+Qe[qe(1,2)]),Qe[qe(0,0)]*=s,Qe[qe(0,1)]*=s,Qe[qe(0,2)]*=s,Qe[qe(1,0)]*=o,Qe[qe(1,1)]*=o,Qe[qe(1,2)]*=o,Qe[qe(2,0)]=Qe[qe(1,0)],Qe[qe(2,1)]=Qe[qe(1,1)],Qe[qe(2,2)]=Qe[qe(1,2)],Qe[qe(1,2)]+=1,s=(0,me.Om)(Ye(Qe,1),t)+Qe[qe(1,2)],o=(0,me.Om)(Ye(Qe,2),t)+Qe[qe(2,2)],a=(0,me.Om)(Ye(Qe,1),n)+Qe[qe(1,2)],l=(0,me.Om)(Ye(Qe,2),n)+Qe[qe(2,2)],s=-.5*(s/o+a/l),Qe[qe(1,0)]+=Qe[qe(2,0)]*s,Qe[qe(1,1)]+=Qe[qe(2,1)]*s,Qe[qe(1,2)]+=Qe[qe(2,2)]*s,s=(0,me.Om)(Ye(Qe,1),t)+Qe[qe(1,2)],o=(0,me.Om)(Ye(Qe,2),t)+Qe[qe(2,2)],a=-o/s,Qe[qe(1,0)]*=a,Qe[qe(1,1)]*=a,Qe[qe(1,2)]*=a,r[0]=Qe[0],r[1]=Qe[1],r[2]=0,r[3]=Qe[2],r[4]=Qe[3],r[5]=Qe[4],r[6]=0,r[7]=Qe[5],r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=Qe[6],r[13]=Qe[7],r[14]=0,r[15]=Qe[8]}(Re,Ce,Pe,De,r.projectionMatrix),r.projectionMatrix[10]=2/(n-i),r.projectionMatrix[14]=-(n+i)/(n-i)}(n,i,c,u,r.camera),(0,g.lw)(r.lightMat,r.camera.projectionMatrix,r.camera.viewMatrix);const h=this._textureHeight;r.camera.viewport=[e*h,0,h,h]}_setupMatrices(e,t){(0,g.lw)(this._projectionView,e.projectionMatrix,e.viewMatrix),(0,g.B8)(this._projectionViewInverse,this._projectionView);const n=this._viewingMode===y.RT.Global?e.eye:(0,_.s)(Le,0,0,1);(0,g.t5)(this._modelViewLight,[0,0,0],[-t[0],-t[1],-t[2]],n)}_computeCascadeDistances(e,t,n){const i=n?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor((0,q.kL)(t/e,4)),i);const r=(t-e)/this._numCascades,s=(t/e)**(1/this._numCascades);let o=e,a=e;for(let e=0;e<this._numCascades+1;++e)this._cascadeDistances[e]=(0,pe.Cc)(o,a,this.settings.splitSchemeLambda),o*=s,a+=r}get test(){}}const Ae=(0,J.vt)(),Me=(0,N.vt)(),Oe=[];for(let e=0;e<8;++e)Oe.push((0,N.vt)());const Re=(0,ee.vt)(),Ce=(0,ee.vt)(),Ie=(0,ee.vt)(),Pe=(0,ee.vt)(),De=(0,ee.vt)(),Le=(0,v.vt)(),Ne=[],Fe=(0,J.vt)(),ze=J.zK.concat(J.zK,J.zK,J.zK,J.zK),Ve=(0,ee.vt)(),He=(0,ee.vt)(),Ue=[(0,ee.vt)(),(0,ee.vt)(),(0,ee.vt)(),(0,ee.vt)()],ke=(0,ee.vt)(),je=(0,ee.vt)(),Ge=(0,ee.vt)(),Be=(0,ee.vt)(),$e=(0,ee.vt)(),Ze=(0,ee.vt)(),We=(0,ee.vt)();function qe(e,t){return 3*t+e}const Xe=(0,ee.vt)();function Ye(e,t){return(0,me.hZ)(Xe,e[t],e[t+3]),Xe}const Ke=(0,ee.vt)(),Qe=(0,fe.vt)();var Je=n(83525),et=n(90599),tt=n(38177),nt=n(50456);n(59356);class it extends nt.R6{constructor(e,t,n){super(e,t),this.triangleNr=n}}var rt=n(23545),st=n(49845),ot=n(96253),at=n(57701),lt=n(50659),ct=n(69550),ut=n(52798);class ht extends F.gy{constructor(e=(0,v.vt)()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}}class dt{constructor(e=0,t=0){this.from=e,this.to=t}get numElements(){return this.to-this.from}}function pt(e){const t=new Map;e.forAll((e=>t.set(e.from,e)));let n=!0;for(;n;){n=!1;for(let i=0;i<e.length;++i){const r=e.data[i],s=t.get(r.to);if(!s)return;r.to=s.to,t.delete(s.from),e.removeUnordered(s),n=!0}}}class ft extends dt{constructor(e,t,n){super(t,n),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return null!=this.geometry.highlights&&this.isVisible}get hasOccludees(){return null!=this.geometry.occludees}}class mt{constructor(){this.first=0,this.count=0}}class gt{constructor(){this._numElements=0,this._instances=new Map,this.holes=new u.A({allocator:e=>e||new dt,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=_t(),this.drawCommandsHighlight=_t(),this.drawCommandsOccludees=_t(),this.drawCommandsShadowHighlightRest=_t()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,t){this.deleteInstance(e),this._instances.set(e,t),this._numElements+=t.numElements}deleteInstance(e){const t=this._instances.get(e);t&&(this._numElements-=t.numElements,this._instances.delete(e))}updateInstance(e,t,n){const i=this._instances.get(e);i&&(this._numElements-=i.numElements,i.from=t,i.to=n,this._numElements+=i.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,0===this._instances.size)return;if(!this.needsMultipleCommands()){const t=this.drawCommandsDefault.pushNew(),n=this.holes.front();return null!=this.vao&&1===this.holes.length&&n.to===Math.floor(this.vao.byteSize/e)?(t.first=0,void(t.count=n.from)):(t.first=1/0,t.count=0,this._instances.forEach((e=>{t.first=Math.min(t.first,e.from),t.count=Math.max(t.count,e.to)})),void(t.count-=t.first))}const t=Array.from(this._instances.values()).sort(((e,t)=>e.from===t.from?e.to-t.to:e.from-t.from));for(const e of t)e.isVisible&&(vt(e.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,e),vt(e.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,e))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}}function _t(){return new u.A({allocator:e=>e||new mt,deallocator:e=>e})}function vt(e,t){const n=e.back();if(null==n){const n=e.pushNew();return n.first=t.from,void(n.count=t.numElements)}if(function(e,t){return e.first+e.count>=t.from}(n,t)){const e=t.from-n.first+t.numElements;n.count=e}else{const n=e.pushNew();n.first=t.from,n.count=t.numElements}}class yt{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach((e=>e.vao.dispose())),this.buffers.length=0}findBuffer(e){return this.buffers.find((t=>t.instances.has(e)))}}var bt=n(85408);class Tt{constructor(e,t){this._cache=e(t,((e,t,n)=>{switch(t){case bt.k2.ALL:return e.forEach((e=>e.dispose())),0;case bt.k2.SOME:{const t=e.shift();return t&&(n-=Math.round(t.usedMemory),t.dispose()),n}}}))}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}getSize(e){return this._cache.getSize(e)}pop(e){const t=this._cache.peek(e);if(!t)return;const n=t.pop();if(t.length>0){if(n){const i=this._cache.getSize(e)-Math.round(n.usedMemory);this._cache.updateSize(e,t,i)}}else this._cache.pop(e);return n}put(e,t,n=bt.Cn){const i=this._cache.peek(e);if(!i)return void this._cache.put(e,[t],t.usedMemory,n);i.push(t);const r=this._cache.getSize(e)+Math.round(t.usedMemory);this._cache.updateSize(e,i,r)}}var Et=n(69445),xt=n(86305);class St{constructor(e,t,n){this._rctx=e,this._locations=t,this._layout=n,this._cache=new Tt(e.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(e){const t=e.toString();let n=this._cache.pop(t);return n||(n=new Et.Z(this._rctx,this._locations,{geometry:this._layout},{geometry:xt.g.createVertex(this._rctx,Te._U.STATIC_DRAW)}),n.vertexBuffers.geometry.setSize(e),n)}deleteVao(e){if(null==e)return;const t=e.byteSize.toString();this._cache.put(t,e)}}let wt=class extends W.Ot{constructor(e){super(e),this._vaoCache=null,this._glMaterials=null,this._bufferWriter=null,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._produces=new Map,this.drapedPriority=0}destroy(){this._glMaterials=(0,c.WD)(this._glMaterials),this._dataByOrigin.forEach((e=>e.dispose())),this._dataByOrigin.clear(),this._vaoCache=(0,c.WD)(this._vaoCache)}initialize(){this.material.produces.forEach(((e,t)=>{this._produces.set(t,(t=>!(0===this._dataByOrigin.size||!(t!==R.V.Highlight&&t!==R.V.ShadowHighlight||this._hasHighlights))&&e(t)))}))}get produces(){return this._produces}initializeRenderContext(e,t){const{rctx:n}=e.renderContext;this._glMaterials=new ut.c(this.material,t??e.materials),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=new St(n,this.material.vertexAttributeLocations,(0,ct.U)(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get hasOccludees(){return this._hasOccludees}get isDecoration(){return this.material.parameters.isDecoration}queryRenderOccludedState(e){return this.material.queryRenderOccludedState(e)}get materialReference(){return this.material}get numGeometries(){let e=0;return this._dataByOrigin.forEach((t=>e+=t.buffers.reduce(((e,t)=>e+t.instances.size),0))),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach((t=>e+=t.buffers.reduce(((e,t)=>e+t.vao.usedMemory),0))),e}forEachGeometry(e){this._dataByOrigin.forEach((t=>t.buffers.forEach((t=>t.instances.forEach((t=>e(t.geometry)))))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const t=this._bufferWriter;if(null===t)return;const n=t.vertexBufferLayout.stride/4;for(const i of e){const e=i.renderGeometry,r=this._dataByOrigin.get(e.localOrigin.id),s=r?.findBuffer(e.id);if(null==s)return;const o=s.instances.get(e.id);if(i.updateType&(ot.k.GEOMETRY|ot.k.TRANSFORMATION)){const i=Vt(t.elementCount(o.geometry.geometry)*n),r=t.vertexBufferLayout.createView(i.buffer);this._writeGeometry(e,r,0),s.vao.vertexBuffers.geometry.setSubData(i,o.from*n,0,o.numElements*n)}i.updateType&(ot.k.HIGHLIGHT|ot.k.OCCLUDEE|ot.k.VISIBILITY)&&(s.drawCommandsDirty=!0)}}_computeDeltas(e,t){const n=new k.O;for(const t of e){const e=t.localOrigin;if(null==e)continue;let i=n.get(e.id,null);null==i&&(i=new At(e.vec3),n.set(e.id,null,i)),i.changes.push(t)}for(const e of t){const t=e.localOrigin;if(null==t)continue;const i=this._dataByOrigin.get(t.id),r=i?.findBuffer(e.id);if(null==r)continue;let s=n.get(t.id,r);null==s&&(s=new At(t.vec3),n.set(t.id,r,s)),s.changes.push(e)}return n}_addAndRemoveGeometries(e,t){if(null===this._bufferWriter||null===this._vaoCache)return;const{_bufferWriter:n,_dataByOrigin:i}=this,r=n.vertexBufferLayout.stride/4,s=this._computeDeltas(e,t);s.forEach(((e,t)=>{const o=e.get(null),a=null!=o?o.changes:[];s.delete(t,null);let l=i.get(t);if(e.forEach(((e,o)=>{if(s.delete(t,o),null==o)return void(0,q.vA)(!1,"No VAO for removed geometries");if(o.instances.size===e.changes.length)return this._vaoCache.deleteVao(o.vao),(0,lt.Xy)(l.buffers,o),void(0===l.buffers.length&&0===a.length&&i.delete(t));const c=o.numElements,u=o.vao.byteSize/4,h=a.reduce(((e,t)=>e+n.elementCount(t.geometry)),0),d=e.changes.reduce(((e,t)=>e+n.elementCount(t.geometry)),0),p=Math.min((c+h-d)*r,Ft),f=p>u;p>Pt&&p<u/2?(e.changes.forEach((({id:e})=>o.deleteInstance(e))),o.instances.forEach((({geometry:e})=>a.push(e))),this._vaoCache.deleteVao(o.vao),(0,lt.Xy)(l.buffers,o)):f?this._applyAndRebuild(o,a,e):this._applyRemoves(o,e)})),a.length>0)for(null==l&&(l=new yt(o.origin),i.set(t,l)),l.buffers.forEach((e=>this._applyAdds(e,a)));a.length>0;)l.buffers.push(this._applyAndRebuild(new gt,a,null))}))}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach((e=>{e.buffers.forEach((e=>{e.drawCommandsDirty&&(e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,(0,l.Bs)(e.instances,(t=>(e.updateDrawState(t),e.hasHiddenInstances&&e.hasHighlights&&e.hasOccludees))),e.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||e.hasHighlights,this._hasOccludees=this._hasOccludees||e.hasOccludees}))}))}_applyAndRebuild(e,t,n){if(null!=n)for(const t of n.changes)e.deleteInstance(t.id);const i=this._bufferWriter,r=i.vertexBufferLayout.stride,s=r/4,o=Math.floor(Ft/s);let a=e.numElements;for(;t.length>0;){const n=t.pop(),r=i.elementCount(n.geometry);if(a+r>o&&a>0){t.push(n);break}a+=r;const s=new ft(n,0,0);(0,q.vA)(null==e.instances.get(n.id)),e.addInstance(n.id,s)}const l=a*s,c=Vt(l),u=i.vertexBufferLayout.createView(c.buffer);let h=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach(((t,n)=>{this._writeGeometry(t.geometry,u,h);const r=h;h+=i.elementCount(t.geometry.geometry),e.updateInstance(n,r,h),e.updateDrawState(t)})),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(Ht(l)),e.vao.vertexBuffers.geometry.setSubData(c,0,0,h*s),e.holes.clear();const d=e.holes.pushNew();return d.from=h,d.to=Math.floor(e.vao.byteSize/r),e.updateDrawCommands(r),e}_applyRemoves(e,t){if(0===t.changes.length||null===this._bufferWriter)return;for(const n of t.changes){const t=n.id,i=e.instances.get(t);if(!i)continue;e.deleteInstance(t);const r=It.back();if(r){if(r.to===i.from){r.to=i.to;continue}if(r.from===i.to){r.from=i.from;continue}}const s=It.pushNew();s.from=i.from,s.to=i.to}pt(It);const n=this._bufferWriter.vertexBufferLayout.stride/4,i=It.reduce(((e,t)=>Math.max(e,t.numElements)),0)*n,r=Vt(i);r.fill(0,0,i);const s=e.vao.vertexBuffers.geometry;It.forAll((e=>s.setSubData(r,e.from*n,0,e.numElements*n))),e.holes.pushArray(It.data,It.length),It.forAll(((e,t)=>It.data[t]=null)),It.clear(),e.drawCommandsDirty=!0}_applyAdds(e,t){if(0===t.length||null===this._bufferWriter)return;if(!function(e){return null!=e.vao}(e))return void this._applyAndRebuild(e,t,null);const n=this._bufferWriter,i=n.vertexBufferLayout.stride/4,r=e.numElements,s=t.reduce(((e,t)=>e+n.elementCount(t.geometry)),0),o=Math.min((r+s)*i,Ft),a=4*o;if(e.vao.byteSize<Ht(Ft-Pt)&&a>e.vao.byteSize)return void this._applyAndRebuild(e,t,null);pt(e.holes);const l=new Array;for(const i of t){const t=n.elementCount(i.geometry),r=Mt(e.holes,t);l.push(r)}const c=e.vao.vertexBuffers.geometry;let u=0,h=0,d=0;const p=Vt(o),f=n.vertexBufferLayout.createView(p.buffer);t.forEach(((t,r)=>{const s=l[r];if(null==s)return;if(d!==s){const e=d-h;e>0&&c.setSubData(p,h*i,0,e*i),h=s,u=0}const o=n.elementCount(t.geometry);this._writeGeometry(t,f,u),u+=o,d=s+o;const a=new ft(t,s,s+o);(0,q.vA)(null==e.instances.get(t.id)),e.addInstance(t.id,a),e.drawCommandsDirty=!0}));const m=d-h;m>0&&c.setSubData(p,h*i,0,m*i),(0,lt.$i)(t,((e,t)=>null==l[t]))}_writeGeometry(e,t,n){if(null===this._bufferWriter)return;const i=e.localOrigin.vec3;(0,q.M_)(Ot,-i[0],-i[1],-i[2]);const r=(0,g.lw)(Rt,Ot,e.transformation);(0,g.B8)(Ct,r),(0,g.mg)(Ct,Ct),this._bufferWriter.write(r,Ct,e.geometry,t,n)}updateAnimation(e){return this.material.update(e)}prepareTechnique(e){if(!this.material.shouldRender(e))return null;const{output:t,bindParameters:n}=e,i=this.material.produces.get(n.slot);if(!i?.(t))return null;const r=t===R.V.Highlight||t===R.V.ShadowHighlight;if(r&&!this._hasHighlights)return null;const s=t===R.V.ShadowExcludeHighlight,o=!(r||s);for(const i of this._dataByOrigin.values())for(const a of i.buffers){if(r&&!a.hasHighlights)continue;const i=(r?a.drawCommandsHighlight:s&&a.needsMultipleCommands()?a.drawCommandsShadowHighlightRest:a.drawCommandsDefault)||null,l=o&&a.drawCommandsOccludees||null;if(i?.length||l?.length){const i=this._glMaterials.load(e.rctx,n.slot,t),r=null!=i?i.beginSlot(n):null;if(null!=r)return r}}return null}renderNode(e,t){const{output:n,bindParameters:i}=e,r=n===R.V.Highlight||n===R.V.ShadowHighlight,s=n===R.V.ShadowExcludeHighlight,o=!(r||s),a=i.slot===oe.N.OCCLUDER_MATERIAL,l=i.slot===oe.N.TRANSPARENT_OCCLUDER_MATERIAL,c=e.rctx;c.runAppleAmdDriverHelper(),c.bindTechnique(t,i,this.material.parameters);for(const e of this._dataByOrigin.values())for(const n of e.buffers){if(r&&!n.hasHighlights)continue;const u=(r?n.drawCommandsHighlight:s&&n.needsMultipleCommands()?n.drawCommandsShadowHighlightRest:n.drawCommandsDefault)||null,h=o&&n.drawCommandsOccludees||null;(u?.length||h?.length)&&(t.program.bindDraw(new ht(e.origin),i,this.material.parameters),t.ensureAttributeLocations(n.vao),c.bindVAO(n.vao),u?.length&&(c.setPipelineState(t.getPipeline(!1,a,l)),u.forAll((e=>c.drawArrays(t.primitiveType,e.first,e.count)))),h?.length&&(c.setPipelineState(t.getPipeline(!0,a,l)),h.forAll((e=>c.drawArrays(t.primitiveType,e.first,e.count)))))}}get test(){}};(0,s._)([(0,p.MZ)({constructOnly:!0})],wt.prototype,"material",void 0),wt=(0,s._)([(0,m.$)("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],wt);class At{constructor(e){this.origin=e,this.changes=new Array}}function Mt(e,t){let n;if(!e.some((e=>!(e.numElements<t||(n=e,0)))))return null;const i=n.from;return n.from+=t,n.from>=n.to&&e.removeUnordered(n),i}const Ot=(0,J.vt)(),Rt=(0,J.vt)(),Ct=(0,J.vt)(),It=new u.A({allocator:e=>e||new dt,deallocator:null}),Pt=65536,Dt=4*Pt,Lt=1024,Nt=16777216,Ft=Nt/4;let zt=new Float32Array(Pt);function Vt(e){return zt.length<e&&(zt=new Float32Array(e)),zt}function Ht(e){const t=4*e;return t<=Lt?Lt:t<Dt?(0,pe.cU)(t):Math.max(Math.min(Math.ceil(1.5*t/Dt)*Dt,Nt),t)}let Ut=class extends Je.A{constructor(e){super(e),this._pending=new kt,this._changes=new rt.VR,this._materialRenderers=new Map,this._sortedMaterialRenderers=new u.A,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach((e=>e.destroy())),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materials(){return this.rendererContext.materials}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccludedDraped(){return(0,l.Bs)(this._materialRenderers,(e=>0!==e.numGeometries&&!e.queryRenderOccludedState(Q.m$.Occlude)))}get isEmpty(){return!this.updating&&0===this._materialRenderers.size&&0===this._geometries.size}getMaterialRenderer(e){return this._materialRenderers.get(e)}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=(0,at.$T)(this._changes);let t=!1;return e.forEach(((e,n)=>{let i=this.getMaterialRenderer(n);if(!i&&e.adds.length>0){const e=new wt({material:n});e.initializeRenderContext(this.rendererContext.pluginContext,this._materials),i=e,this._materialRenderers.set(n,i),t=!0}i&&(i.modify(e),0===i.numGeometries&&(this._materialRenderers.delete(n),i.destroy(),t=!0))})),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),this._hasHighlights=(0,l.Bs)(this._materialRenderers,(e=>{const t=e.produces.get(oe.N.DRAPED_MATERIAL);return!!t&&t(R.V.Highlight)})),this._hasWater=(0,l.Bs)(this._materialRenderers,(e=>{const t=e.produces.get(oe.N.DRAPED_WATER);return!!t&&t(R.V.Normal)})),this.notifyChange("updating"),!0}addGeometries(e,t){if(0===e.length)return;const n=this._validateRenderGeometries(e);for(const e of n)this._geometries.set(e.id,e);const i=this._pending.empty;for(const e of n)this._pending.adds.add(e);i&&this.notifyChange("updating"),t===ot.q.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const n=this._pending.empty,i=this._pending.adds;for(const t of e)i.has(t)?(this._pending.removed.add(t),i.delete(t)):this._pending.removed.has(t)||this._pending.removes.add(t),this._geometries.delete(t.id);n&&!this._pending.empty&&this.notifyChange("updating"),t===ot.q.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const n=0===this._changes.updates.length;for(const n of e){const e=this._changes.updates.pushNew();e.renderGeometry=this._validateRenderGeometry(n),e.updateType=t}switch(n&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case ot.k.TRANSFORMATION:case ot.k.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case ot.k.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedMaterialRenderers.forAll((n=>t=!!n.updateAnimation&&n.updateAnimation(e)||t)),t}shouldRender(e){return this._sortedMaterialRenderers.some((t=>t.prepareTechnique(e)))}render(e){this._sortedMaterialRenderers.forAll((t=>{const n=t.prepareTechnique(e);null!=n&&t.renderNode(e,n)}))}intersect(e,t,n,i,r){return this._geometries.forEach((s=>{if(i&&!i(s))return;this._intersectRenderGeometry(s,n,t,0,e,r);const o=this.rendererContext.longitudeCyclical;o&&(s.boundingSphere[0]-s.boundingSphere[3]<o.min&&this._intersectRenderGeometry(s,n,t,o.range,e,r),s.boundingSphere[0]+s.boundingSphere[3]>o.max&&this._intersectRenderGeometry(s,n,t,-o.range,e,r)),r++})),r}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;for(const t of this._materialRenderers.values())t.drapedPriority=e++,this._sortedMaterialRenderers.push(t);this._sortedMaterialRenderers.sort(((e,t)=>t.materialReference?.renderPriority===e.materialReference?.renderPriority?e.drapedPriority-t.drapedPriority:(t.materialReference?.renderPriority||0)-(e.materialReference?.renderPriority||0)))}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,t,n,i,r,s){if(!e.visible)return;let o=0;i+=e.transformation[12],o=e.transformation[13],jt[0]=n[0]-i,jt[1]=n[1]-o,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,r,jt,((n,i,o)=>{!function(e,t,n,i,r,s,o){const a=new it(s,o,t),l=t=>{t.set(tt.dz.OVERLAY,a,e.dist,e.normal,e.transformation,n,i)};if((null==r.results.min.drapedLayerOrder||n>=r.results.min.drapedLayerOrder)&&(null==r.results.min.dist||r.results.ground.dist<=r.results.min.dist)&&l(r.results.min),r.options.store!==tt.oH.MIN&&(null==r.results.max.drapedLayerOrder||n<r.results.max.drapedLayerOrder)&&(null==r.results.max.dist||r.results.ground.dist>r.results.max.dist)&&l(r.results.max),r.options.store===tt.oH.ALL){const e=(0,st.G7)(r.ray);l(e),r.results.all.push(e)}}(t,o,s,e.material.renderPriority,r,e.layerUid,e.graphicUid)}),t)}_notifyGraphicGeometryChanged(e){if(null==this.drapeSource.notifyGraphicGeometryChanged)return;let t;for(const n of e){const e=n.graphicUid;null!=e&&e!==t&&(this.drapeSource.notifyGraphicGeometryChanged(e),t=e)}}_notifyGraphicVisibilityChanged(e){if(null==this.drapeSource.notifyGraphicVisibilityChanged)return;let t;for(const n of e){const e=n.graphicUid;null!=e&&e!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(e),t=e)}}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return null==e.localOrigin&&(e.localOrigin=this._localOriginFactory.getOrigin((0,et.g)(e.boundingSphere))),e}get test(){}};(0,s._)([(0,p.MZ)()],Ut.prototype,"drapeSource",void 0),(0,s._)([(0,p.MZ)()],Ut.prototype,"updating",null),(0,s._)([(0,p.MZ)()],Ut.prototype,"rctx",null),(0,s._)([(0,p.MZ)({constructOnly:!0})],Ut.prototype,"rendererContext",void 0),(0,s._)([(0,p.MZ)()],Ut.prototype,"_materials",null),(0,s._)([(0,p.MZ)()],Ut.prototype,"_localOriginFactory",null),(0,s._)([(0,p.MZ)({readOnly:!0})],Ut.prototype,"isEmpty",null),(0,s._)([(0,p.MZ)()],Ut.prototype,"_materialRenderers",void 0),(0,s._)([(0,p.MZ)()],Ut.prototype,"_geometries",void 0),Ut=(0,s._)([(0,m.$)("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Ut);class kt{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}const jt=(0,ee.vt)();var Gt=n(34615),Bt=n(22542),$t=n(40502),Zt=n(54101),Wt=n(57087);class qt extends Bt.w{initializeProgram(e){return new Zt.B(e.rctx,qt.shader.get().build(),$t.D)}initializePipeline(){return this.configuration.hasAlpha?(0,Wt.Ey)({blending:(0,Wt.p3)(Te.dn.SRC_ALPHA,Te.dn.ONE,Te.dn.ONE_MINUS_SRC_ALPHA,Te.dn.ONE_MINUS_SRC_ALPHA),colorWrite:Wt.wE}):(0,Wt.Ey)({colorWrite:Wt.wE})}}qt.shader=new Gt.$(U.a,(()=>n.e(6404).then(n.bind(n,41722))));class Xt extends j.K{constructor(){super(...arguments),this.hasAlpha=!1}}(0,s._)([(0,j.W)()],Xt.prototype,"hasAlpha",void 0);var Yt=n(91998),Kt=n(35910),Qt=n(94010);class Jt extends Bt.w{initializeProgram(e){return new Zt.B(e.rctx,Jt.shader.get().build(),$t.D)}initializePipeline(){return(0,Wt.Ey)({blending:(0,Wt.ox)(Te.dn.ONE,Te.dn.ONE_MINUS_SRC_ALPHA),colorWrite:Wt.wE})}}Jt.shader=new Gt.$(Qt.a,(()=>n.e(5835).then(n.bind(n,49706))));var en=n(48961),tn=n(10956);let nn=class extends W.RW{constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new Qt.O,this.hasHighlights=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new u.A,this._passParameters=new U.T,this._materials=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new L.A,this.worldToPCSRatio=1,this.events=new o.A,this.longitudeCyclical=null,this.produces=new Map([[oe.N.DRAPED_MATERIAL,e=>e!==R.V.Highlight||this.hasHighlights],[oe.N.DRAPED_WATER,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const e=this.view._stage.renderer.fboCache,t=this.view._stage.renderView,{waterTextures:n,stippleTextures:i,markerTextures:r}=t;this._techniques=new G({rctx:this._rctx,viewingMode:y.RT.Local,stippleTextures:i,markerTextures:r,waterTextures:n}),this._renderContext=new he(this._rctx,new we(e,this.view.state.viewingMode),null),this.addHandles([(0,h.watch)((()=>n.updating),(()=>this.events.emit("content-changed")),h.pc),(0,h.watch)((()=>this.spatialReference),(e=>this._localOriginFactory=new K.g(e)),h.pc),(0,h.on)((()=>this.view.allLayerViews),"after-changes",(()=>this._sortedDrapeSourceRenderersDirty=!0))]),this._materials=new X(t.textures,this._techniques,(()=>{this.notifyChange("rendersOccludedDraped"),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")}),(()=>this.events.emit("content-changed"))),this._bindParameters.slot=oe.N.DRAPED_MATERIAL,this._bindParameters.mainDepth=null,this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=ae.y.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new Kt.$p((0,v.fA)(1,1,1))]),this.addHandles(this.view.resourceController.scheduler.registerTask(en.W6.STAGE,this))}destroy(){this._renderers.forEach((e=>e.destroy())),this._renderers.clear(),this._debugTextureTechnique=(0,c.Gz)(this._debugTextureTechnique),this._passParameters.texture=(0,c.WD)(this._passParameters.texture),this._techniques=(0,c.pR)(this._techniques),this.disposeOverlays()}get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materials(){return this._materials}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initializeRenderContext(e){this.pluginContext=e}uninitializeRenderContext(){}renderNode(){}get updating(){return this._sortedDrapeSourceRenderersDirty||(0,l.Bs)(this._renderers,(e=>e.updating))}get hasOverlays(){return null!=this._overlays&&null!=this._renderTargets}getMaterialRenderer(e){for(const t of this._renderers.values()){const n=t.getMaterialRenderer(e);if(n)return n}return null}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map((e=>e.drapeSource.layer)).filter((e=>!!e))}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,Ut)}createDrapeSourceRenderer(e,t,n){const i=this._renderers.get(e);null!=i&&i.destroy();const r=new t({...n,rendererContext:this,drapeSource:e});return this._renderers.set(e,r),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles((0,h.watch)((()=>e.fullOpacity),(()=>this.events.emit("content-changed"))),e),r}removeDrapeSourceRenderer(e){if(null==e)return;const t=this._renderers.get(e);null!=t&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),t.destroy())}computeValidity(){return this._renderTargets?.computeValidity()??0}releaseRenderTargets(){this._renderTargets?.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&(0,d.bw)(e,(e=>e.drapeTargetType===b.sv.WithoutRasterImage))}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=(0,d.bw)(e,(e=>e.drapeSourceType===b.Om.Features)),this._hasDrapedRasterSource=(0,d.bw)(e,(e=>e.drapeSourceType===b.Om.RasterImage))):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,t,n=this._bindParameters.overlayStretch){null==this._overlays&&(this._renderTargets=new I(this.view._stage.renderer.fboCache),this._overlays=[new w,new w]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t),this._bindParameters.overlayStretch=n}disposeOverlays(){this._overlays=null,this._renderTargets=(0,c.WD)(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){if(null!=e)return e===i.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?this._renderTargets?.getTexture(i.Color):this._renderTargets?.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,(()=>!0))}_processDrapeSources(e,t){let n=!1;for(const[i,r]of this._renderers){if(e.done)break;(i.destroyed||t(i))&&r.commitChanges()&&(n=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,n=!0,this._updateSortedDrapeSourceRenderers()),n&&(null!=this._overlays&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=(0,l.Bs)(this._renderers,(e=>e.hasHighlights)),this.notifyChange("rendersOccludedDraped"),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(en.Bb,(e=>e.updatePolicy===Yt.q.SYNC))}get isEmpty(){return!T.b.OVERLAY_DRAW_DEBUG_TEXTURE&&!(0,l.Bs)(this._renderers,(e=>!e.isEmpty))}get hasWater(){return this._hasWater}get rendersOccludedDraped(){const e=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=an;const t=this._sortedRenderers.some((({renderer:e})=>e.shouldRender(this._renderContext)));return this._renderContext.renderOccludedMask=e,t}renders(e){return T.b.OVERLAY_DRAW_DEBUG_TEXTURE&&e!==i.Occluded||this._sortedRenderers.some((({renderer:e})=>e.shouldRender(this._renderContext)))}get mode(){return this.isEmpty?z.Disabled:this._renderTargets?.getTexture(i.WaterNormal)?z.EnabledWithWater:this._renderTargets?.getTexture(i.Color)?z.Enabled:z.Disabled}updateAnimation(e){let t=!1;return this._renderers.forEach((n=>t=n.updateAnimation(e)||t)),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const e of this._overlays)this.longitudeCyclical?e.setupGeometryViewsCyclical(this.longitudeCyclical):e.setupGeometryViewsDirect();for(const t of this._renderTargets.targets){if(t.content===i.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const n=this._drawTarget(E.vr.INNER,t,e),r=this._drawTarget(E.vr.OUTER,t,e);(n||r)&&t.fbo.generateMipMap()}}}_drawTarget(e,t,n){const r=this._overlays[e],s=r.canvasGeometries;if(0===s.numViews)return!1;const{alignPixelEnabled:o,contentPixelRatio:a}=n;this._screenToWorldRatio=a*r.mapUnitsPerPixel/this._bindParameters.overlayStretch;const l=t.output;if(this.isEmpty||l===R.V.Highlight&&!this.hasHighlights||l===R.V.Normal&&!this.hasWater||!r.hasSomeSizedView())return!1;const c=this._rctx;if(this._camera.pixelRatio=r.pixelRatio*a,this._renderContext.output=l,this._bindParameters.alignPixelEnabled=o,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=l===R.V.Normal?oe.N.DRAPED_WATER:oe.N.DRAPED_MATERIAL,t.content===i.Occluded&&(this._renderContext.renderOccludedMask=an),!this.renders(t.content))return this._renderContext.renderOccludedMask=de,!1;const u=r.resolution;this._rctx.setViewport(e===E.vr.INNER?0:u,0,u,u);const h=2*r.resolution,d=r.resolution,p=t.fbo;if(p.bind(c,h,d),e===E.vr.INNER&&(c.setClearColor(0,0,0,0),c.clear(Te.hn.COLOR_BUFFER_BIT)),T.b.OVERLAY_DRAW_DEBUG_TEXTURE&&t.content!==i.Occluded)for(let t=0;t<s.numViews;t++)this._setViewParameters(s.extents[t],r),this._ensureDebugPatternResources(r.resolution,sn[e]),this._rctx.bindTechnique(this._debugTextureTechnique,this._renderContext.bindParameters,this._passParameters),this._rctx.screen.draw();return this._sortedRenderers.forAll((({drapeSource:n,renderer:o})=>{if(t.content===i.ColorNoRasterImage&&n.drapeSourceType===b.Om.RasterImage)return;const{fullOpacity:a}=n,u=null!=a&&a<1&&l===R.V.Color?this.bindTemporaryFramebuffer(h,d):null;for(let e=0;e<s.numViews;e++)this._setViewParameters(s.extents[e],r),o.render(this._renderContext);if(u){p.bind(c,h,d),this._overlayParameters.texture=u.getTexture(),this._overlayParameters.opacity=a,this._overlayParameters.overlayIndex=e;const t=this.pluginContext.techniques.acquire(Jt);this._rctx.bindTechnique(t,this._renderContext.bindParameters,this._overlayParameters),this._rctx.screen.draw(),t.release(),u.release()}})),c.bindFramebuffer(null),this._renderContext.renderOccludedMask=de,!0}bindTemporaryFramebuffer(e,t){const n=this.view._stage.renderer.fboCache,i=n.acquire(e,t,"overlay tmp");return n.rctx.unbindTexture(i.fbo?.colorTexture),n.rctx.bindFramebuffer(i.fbo),n.rctx.clear(Te.hn.COLOR_BUFFER_BIT),i}async reloadShaders(){await this._techniques.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,n,i){this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let r=0;for(const{renderer:s}of this._sortedRenderers)r=s.intersect?.(e,t,n,i,r)??r}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),0===this._renderers.size)return;const e=this.view.map.allLayers,t=e.length;this._renderers.forEach(((n,i)=>{const r=e.indexOf(i.layer),s=r>=0,o=i.renderGroup??(s?b.O7.MapLayer:b.O7.ViewLayer),a=t*o+(s?r:0);this._sortedRenderers.push(new rn(i,n,a))})),this._sortedRenderers.sort(((e,t)=>e.index-t.index))}_setViewParameters(e,t){const n=this._camera;n.viewport=[0,0,t.resolution,t.resolution],(0,g.v3)(n.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],n.near,n.far),(0,g.kN)(n.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=(0,l.Bs)(this._renderers,(e=>e.hasWater));e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_ensureDebugPatternResources(e,t){if((0,_.s)(this._passParameters.color,t[0],t[1],t[2]),this._passParameters.texture)return;const n=new Uint8Array(e*e*4);let i=0;for(let t=0;t<e;t++)for(let r=0;r<e;r++){const s=Math.floor(r/10),o=Math.floor(t/10);s<2||o<2||10*s>e-20||10*o>e-20?(n[i++]=255,n[i++]=255,n[i++]=255,n[i++]=255):(n[i++]=255,n[i++]=255,n[i++]=255,n[i++]=1&s&&1&o?1&r^1&t?0:255:1&s^1&o?0:128)}const r=new tn.R(e);r.samplingMode=Te.Cj.NEAREST,this._passParameters.texture=new Ee.g(this._rctx,r,n);const s=new Xt;s.hasAlpha=!0,this._debugTextureTechnique=this._techniques.acquire(qt,s)}get test(){}};(0,s._)([(0,p.MZ)()],nn.prototype,"hasHighlights",void 0),(0,s._)([(0,p.MZ)()],nn.prototype,"_sortedDrapeSourceRenderersDirty",void 0),(0,s._)([(0,p.MZ)()],nn.prototype,"_techniques",void 0),(0,s._)([(0,p.MZ)({constructOnly:!0})],nn.prototype,"view",void 0),(0,s._)([(0,p.MZ)()],nn.prototype,"worldToPCSRatio",void 0),(0,s._)([(0,p.MZ)()],nn.prototype,"spatialReference",void 0),(0,s._)([(0,p.MZ)({type:Boolean,readOnly:!0})],nn.prototype,"updating",null),(0,s._)([(0,p.MZ)()],nn.prototype,"isEmpty",null),(0,s._)([(0,p.MZ)({readOnly:!0})],nn.prototype,"rendersOccludedDraped",null),nn=(0,s._)([(0,m.$)("esri.views.3d.terrain.OverlayRenderer")],nn);class rn{constructor(e,t,n){this.drapeSource=e,this.renderer=t,this.index=n}}const sn=[[1,.5,.5],[.5,.5,1]],on=-2,an=Q.m$.OccludeAndTransparent},86398:function(e,t,n){"use strict";var i,r,s,o;n.d(t,{vr:function(){return i}}),function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"}(i||(i={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(r||(r={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(s||(s={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(o||(o={}))},30087:function(e,t,n){"use strict";n.d(t,{i$:function(){return c},oD:function(){return u},xJ:function(){return l}});var i=n(27264),r=n(66299),s=n(11687),o=n(39506);function a(e){e.varyings.add("linearDepth","float")}function l(e){e.vertex.uniforms.add(new s.G("nearFar",((e,t)=>t.camera.nearFar)))}function c(e){e.vertex.code.add(o.H`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function u(e,t){const{vertex:n}=e;switch(t.output){case i.V.Color:if(t.receiveShadows)return a(e),void n.code.add(o.H`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case i.V.Shadow:case i.V.ShadowHighlight:case i.V.ShadowExcludeHighlight:case i.V.ViewshedShadow:return e.include(r.em,t),a(e),l(e),c(e),void n.code.add(o.H`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}n.code.add(o.H`void forwardLinearDepth() {}`)}},68561:function(e,t,n){"use strict";n.d(t,{K:function(){return c}});var i=n(23397),r=n(82316),s=n(82598),o=n(14543),a=n(39506),l=n(39838);function c(e,t){const n=e.fragment;n.include(i.E),e.include(r.Ir),n.uniforms.add(new o.m("globalAlpha",(e=>e.globalAlpha)),new s.t("glowColor",(e=>e.glowColor)),new o.m("glowWidth",((e,t)=>e.glowWidth*t.camera.pixelRatio)),new o.m("glowFalloff",(e=>e.glowFalloff)),new s.t("innerColor",(e=>e.innerColor)),new o.m("innerWidth",((e,t)=>e.innerWidth*t.camera.pixelRatio)),new l.N("depthMap",((e,t)=>t.depth?.attachment)),new l.N("normalMap",(e=>e.normals)),new l.N("frameColor",((e,t)=>t.mainColor))),n.code.add(a.H`vec4 blendPremultiplied(vec4 source, vec4 dest) {
float oneMinusSourceAlpha = 1.0 - source.a;
return vec4(
source.rgb + dest.rgb * oneMinusSourceAlpha,
source.a + dest.a * oneMinusSourceAlpha
);
}`),n.code.add(a.H`vec4 premultipliedColor(vec3 rgb, float alpha) {
return vec4(rgb * alpha, alpha);
}`),n.code.add(a.H`vec4 laserlineProfile(float dist) {
if (dist > glowWidth) {
return vec4(0.0);
}
float innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));
float glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);
return blendPremultiplied(
premultipliedColor(innerColor, innerAlpha),
premultipliedColor(glowColor, glowAlpha)
);
}`),n.code.add(a.H`bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float angleCutoffAdjust, out float depthDiscontinuityAlpha) {
float depth = depthFromTexture(depthMap, uv);
if (depth == 1.0) {
return false;
}
float linearDepth = linearizeDepth(depth);
pos = reconstructPosition(gl_FragCoord.xy, linearDepth);
float minStep = 6e-8;
float depthStep = clamp(depth + minStep, 0.0, 1.0);
float linearDepthStep = linearizeDepth(depthStep);
float depthError = abs(linearDepthStep - linearDepth);
if (depthError > 0.2) {
normal = texture(normalMap, uv).xyz * 2.0 - 1.0;
angleCutoffAdjust = 0.004;
} else {
normal = normalize(cross(dFdx(pos), dFdy(pos)));
angleCutoffAdjust = 0.0;
}
float ddepth = fwidth(linearDepth);
depthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / linearDepth);
return true;
}`),t.contrastControlEnabled?(n.uniforms.add(new o.m("globalAlphaContrastBoost",(e=>null!=e.globalAlphaContrastBoost?e.globalAlphaContrastBoost:1))),n.code.add(a.H`float rgbToLuminance(vec3 color) {
return dot(vec3(0.2126, 0.7152, 0.0722), color);
}
vec4 laserlineOutput(vec4 color) {
float backgroundLuminance = rgbToLuminance(texture(frameColor, uv).rgb);
float alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);
return color * alpha;
}`)):n.code.add(a.H`vec4 laserlineOutput(vec4 color) {
return color * globalAlpha;
}`)}},88416:function(e,t,n){"use strict";n.d(t,{L:function(){return o}});var i=n(20830),r=n(14543),s=n(39506);function o(e,t){if(!t.screenSizeEnabled)return;const n=e.vertex;(0,i.yu)(n,t),n.uniforms.add(new r.m("perScreenPixelRatio",((e,t)=>t.camera.perScreenPixelRatio)),new r.m("screenSizeScale",(e=>e.screenSizeScale))),n.code.add(s.H`float computeRenderPixelSizeAt( vec3 pWorld ){
vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
float viewDirectionDistance = abs(dot(viewForward, pWorld - cameraPosition));
return viewDirectionDistance * perScreenPixelRatio;
}
vec3 screenSizeScaling(vec3 position, vec3 anchor){
return position * screenSizeScale * computeRenderPixelSizeAt(anchor) + anchor;
}`)}},77423:function(e,t,n){"use strict";n.d(t,{c:function(){return s}});var i=n(39506),r=n(65839);function s(e,t=!0){e.attributes.add(r.r.POSITION,"vec2"),t&&e.varyings.add("uv","vec2"),e.vertex.code.add(i.H`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${t?i.H`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}},27264:function(e,t,n){"use strict";var i;function r(e){return s(e)||e===i.Depth||e===i.Normal||e===i.ObjectAndLayerIdColor}function s(e){return e===i.Shadow||e===i.ShadowHighlight||e===i.ShadowExcludeHighlight||e===i.ViewshedShadow}function o(e){return f(e)||e===i.Normal}function a(e){return e===i.Highlight||e===i.ObjectAndLayerIdColor}function l(e){return e===i.Color||a(e)}function c(e){return e===i.Color}function u(e){return c(e)||e===i.ObjectAndLayerIdColor}function h(e){return c(e)||e===i.Highlight}function d(e){return h(e)||m(e)}function p(e){return c(e)||a(e)}function f(e){return p(e)||m(e)}function m(e){return e===i.Depth}n.d(t,{MO:function(){return f},PJ:function(){return s},V:function(){return i},XY:function(){return o},_o:function(){return c},aD:function(){return d},cb:function(){return r},dX:function(){return p},eh:function(){return m},i3:function(){return l},u5:function(){return a},zW:function(){return u}}),function(e){e[e.Color=0]="Color",e[e.Depth=1]="Depth",e[e.Normal=2]="Normal",e[e.Shadow=3]="Shadow",e[e.ShadowHighlight=4]="ShadowHighlight",e[e.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",e[e.ViewshedShadow=6]="ViewshedShadow",e[e.Highlight=7]="Highlight",e[e.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",e[e.COUNT=9]="COUNT"}(i||(i={}))},13668:function(e,t,n){"use strict";n.d(t,{HQ:function(){return c}});var i=n(73364),r=n(39714),s=n(20551),o=n(32501),a=n(4435),l=(n(82598),n(39506));function c(e,t){!function(e,t,...n){if(!t.hasSlicePlane){const n=l.H`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return t.hasSliceInVertexProgram&&e.vertex.code.add(n),void e.fragment.code.add(n)}t.hasSliceInVertexProgram&&e.vertex.uniforms.add(...n),e.fragment.uniforms.add(...n);const i=l.H`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,r=l.H`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,s=t.hasSliceHighlight?l.H`
        ${r}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:l.H`#define highlightSlice(_color_, _pos_) (_color_)`;t.hasSliceInVertexProgram&&e.vertex.code.add(i),e.fragment.code.add(i),e.fragment.code.add(s)}(e,t,new a.W("slicePlaneOrigin",((e,n)=>function(e,t,n){if(null==n.slicePlane)return o.uY;const i=u(e,t,n),r=h(i,n.slicePlane),a=d(e,i,n);return null!=a?(0,s.h)(m,r,a):r}(t,e,n))),new a.W("slicePlaneBasis1",((e,n)=>p(t,e,n,n.slicePlane?.basis1))),new a.W("slicePlaneBasis2",((e,n)=>p(t,e,n,n.slicePlane?.basis2))))}function u(e,t,n){return e.instancedDoublePrecision?(0,s.s)(f,n.camera.viewInverseTransposeMatrix[3],n.camera.viewInverseTransposeMatrix[7],n.camera.viewInverseTransposeMatrix[11]):t.slicePlaneLocalOrigin}function h(e,t){return null!=e?(0,s.f)(m,t.origin,e):t.origin}function d(e,t,n){return e.hasSliceTranslatedView?null!=t?(0,i.Tl)(_,n.camera.viewMatrix,t):n.camera.viewMatrix:null}function p(e,t,n,i){if(null==i||null==n.slicePlane)return o.uY;const r=u(e,t,n),a=h(r,n.slicePlane),l=d(e,r,n);return null!=l?((0,s.g)(g,i,a),(0,s.h)(m,a,l),(0,s.h)(g,g,l),(0,s.f)(g,g,m)):i}l.Y;const f=(0,o.vt)(),m=(0,o.vt)(),g=(0,o.vt)(),_=(0,r.vt)()},34178:function(e,t,n){"use strict";n.d(t,{d:function(){return s}});var i=n(30087),r=n(39506);function s(e){(0,i.i$)(e),e.vertex.code.add(r.H`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),e.vertex.code.add(r.H`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}},14812:function(e,t,n){"use strict";n.d(t,{BK:function(){return T},nW:function(){return y}});var i=n(53804),r=n(44705),s=n(87725),o=n(39714),a=n(20551),l=n(32501),c=n(27264),u=n(90576),h=n(20830),d=n(4435),p=n(39506),f=n(78567),m=n(70340),g=n(8610),_=n(65839),v=n(44476);class y extends g.K{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}}(0,i._)([(0,g.W)()],y.prototype,"instancedDoublePrecision",void 0),(0,i._)([(0,g.W)()],y.prototype,"hasModelTransformation",void 0),p.Y;const b=(0,s.vt)();function T(e,t){const n=t.hasModelTransformation,i=t.instancedDoublePrecision;n&&(e.vertex.uniforms.add(new m.X("model",(e=>e.modelTransformation??o.zK))),e.vertex.uniforms.add(new f.k("normalLocalOriginFromModel",(e=>((0,r.Ge)(b,e.modelTransformation??o.zK),b))))),t.instanced&&i&&(e.attributes.add(_.r.INSTANCEMODELORIGINHI,"vec3"),e.attributes.add(_.r.INSTANCEMODELORIGINLO,"vec3"),e.attributes.add(_.r.INSTANCEMODEL,"mat3"),e.attributes.add(_.r.INSTANCEMODELNORMAL,"mat3"));const s=e.vertex;i&&(s.include(u.u,t),s.uniforms.add(new d.W("viewOriginHi",((e,t)=>(0,v.Zo)((0,a.s)(E,t.camera.viewInverseTransposeMatrix[3],t.camera.viewInverseTransposeMatrix[7],t.camera.viewInverseTransposeMatrix[11]),E))),new d.W("viewOriginLo",((e,t)=>(0,v.jA)((0,a.s)(E,t.camera.viewInverseTransposeMatrix[3],t.camera.viewInverseTransposeMatrix[7],t.camera.viewInverseTransposeMatrix[11]),E))))),s.code.add(p.H`
    vec3 getVertexInLocalOriginSpace() {
      return ${n?i?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":i?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${i?p.H`
          // Negated inputs are intentionally the first two arguments. The other way around the obfuscation in dpAdd() stopped
          // working for macOS 14+ and iOS 17+.
          // Issue: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(-instanceModelOriginHi, -instanceModelOriginLo, viewOriginHi, viewOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),s.code.add(p.H`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${n?i?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":i?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `),t.output===c.V.Normal&&((0,h.S7)(s),s.code.add(p.H`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${n?i?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":i?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `)),t.hasVertexTangents&&s.code.add(p.H`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${n?i?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":i?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)}const E=(0,l.vt)()},11377:function(e,t,n){"use strict";n.d(t,{W:function(){return i},Y:function(){return l}});var i,r,s=n(82547),o=n(39506),a=n(65839);function l(e,t){switch(t.normalType){case i.Compressed:e.attributes.add(a.r.NORMALCOMPRESSED,"vec2"),e.vertex.code.add(o.H`vec3 decompressNormal(vec2 normal) {
float z = 1.0 - abs(normal.x) - abs(normal.y);
return vec3(normal + sign(normal) * min(z, 0.0), z);
}
vec3 normalModel() {
return decompressNormal(normalCompressed);
}`);break;case i.Attribute:e.attributes.add(a.r.NORMAL,"vec3"),e.vertex.code.add(o.H`vec3 normalModel() {
return normal;
}`);break;case i.ScreenDerivative:e.fragment.code.add(o.H`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:(0,s.Xb)(t.normalType);case i.COUNT:case i.Ground:}}(r=i||(i={}))[r.Attribute=0]="Attribute",r[r.Compressed=1]="Compressed",r[r.Ground=2]="Ground",r[r.ScreenDerivative=3]="ScreenDerivative",r[r.COUNT=4]="COUNT"},27271:function(e,t,n){"use strict";n.d(t,{g:function(){return o}});var i=n(27264),r=n(39506),s=n(65839);function o(e,t){const n=t.output===i.V.ObjectAndLayerIdColor,o=t.objectAndLayerIdColorInstanced;n&&(e.varyings.add("objectAndLayerIdColorVarying","vec4"),o?e.attributes.add(s.r.INSTANCEOBJECTANDLAYERIDCOLOR,"vec4"):e.attributes.add(s.r.OBJECTANDLAYERIDCOLOR,"vec4")),e.vertex.code.add(r.H`
     void forwardObjectAndLayerIdColor() {
      ${n?o?r.H`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:r.H`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:r.H``} }`),e.fragment.code.add(r.H`
      void outputObjectAndLayerIdColor() {
        ${n?r.H`fragColor = objectAndLayerIdColorVarying;`:r.H``} }`)}},91765:function(e,t,n){"use strict";n.d(t,{I:function(){return s}});var i=n(39506),r=n(65839);function s(e){e.attributes.add(r.r.POSITION,"vec3"),e.vertex.code.add(i.H`vec3 positionModel() { return position; }`)}},55123:function(e,t,n){"use strict";n.d(t,{s:function(){return u}});var i=n(58766),r=n(82598),s=n(14543),o=n(454),a=n(39506),l=n(65839);const c=8;function u(e,t){const n=e.vertex;n.uniforms.add(new s.m("intrinsicWidth",(e=>e.width))),t.vvSize?(e.attributes.add(l.r.SIZEFEATUREATTRIBUTE,"float"),n.uniforms.add(new r.t("vvSizeMinSize",(e=>e.vvSize.minSize)),new r.t("vvSizeMaxSize",(e=>e.vvSize.maxSize)),new r.t("vvSizeOffset",(e=>e.vvSize.offset)),new r.t("vvSizeFactor",(e=>e.vvSize.factor))),n.code.add(a.H`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add(l.r.SIZE,"float"),n.code.add(a.H`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add(l.r.OPACITYFEATUREATTRIBUTE,"float"),n.constants.add("vvOpacityNumber","int",8),n.uniforms.add(new o.x("vvOpacityValues",(e=>e.vvOpacity.values),c),new o.x("vvOpacityOpacities",(e=>e.vvOpacity.opacityValues),c)),n.code.add(a.H`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):n.code.add(a.H`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.include(i.A,t),e.attributes.add(l.r.COLORFEATUREATTRIBUTE,"float"),n.code.add(a.H`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(e.attributes.add(l.r.COLOR,"vec4"),n.code.add(a.H`vec4 getColor(){
return applyOpacity(color);
}`))}},2457:function(e,t,n){"use strict";n.d(t,{U:function(){return l},q:function(){return i}});var i,r,s=n(82547),o=n(39506),a=n(65839);function l(e,t){switch(t.textureCoordinateType){case i.Default:return e.attributes.add(a.r.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(o.H`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case i.Compressed:return e.attributes.add(a.r.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(o.H`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case i.Atlas:return e.attributes.add(a.r.UV0,"vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add(a.r.UVREGION,"vec4"),e.varyings.add("vuvRegion","vec4"),void e.vertex.code.add(o.H`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:(0,s.Xb)(t.textureCoordinateType);case i.None:return void e.vertex.code.add(o.H`void forwardTextureCoordinates() {}`);case i.COUNT:return}}(r=i||(i={}))[r.None=0]="None",r[r.Default=1]="Default",r[r.Atlas=2]="Atlas",r[r.Compressed=3]="Compressed",r[r.COUNT=4]="COUNT"},85709:function(e,t,n){"use strict";n.d(t,{c:function(){return s}});var i=n(39506),r=n(65839);function s(e,t){t.hasVertexColors?(e.attributes.add(r.r.COLOR,"vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(i.H`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(i.H`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(i.H`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}},94211:function(e,t,n){"use strict";n.d(t,{Mh:function(){return h},Zo:function(){return d},gy:function(){return p}});var i=n(82547),r=n(87725),s=n(41546),o=n(11377),a=n(66299),l=n(39506),c=n(31190),u=n(78567);function h(e,t){switch(t.normalType){case o.W.Attribute:case o.W.Compressed:e.include(o.Y,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add(new c.h("transformNormalGlobalFromModel",(e=>e.transformNormalGlobalFromModel)),new u.k("transformNormalViewFromGlobal",(e=>e.transformNormalViewFromGlobal))),e.vertex.code.add(l.H`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case o.W.Ground:e.include(a.em,t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(l.H`
        void forwardNormal() {
          vNormalWorld = ${t.spherical?l.H`normalize(vPositionWorldCameraRelative);`:l.H`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case o.W.ScreenDerivative:e.vertex.code.add(l.H`void forwardNormal() {}`);break;default:(0,i.Xb)(t.normalType);case o.W.COUNT:}}class d extends a.dO{constructor(){super(...arguments),this.transformNormalViewFromGlobal=(0,r.vt)()}}class p extends a.EM{constructor(){super(...arguments),this.transformNormalGlobalFromModel=(0,r.vt)(),this.toMapSpace=(0,s.vt)()}}},66299:function(e,t,n){"use strict";n.d(t,{EM:function(){return g},dO:function(){return m},em:function(){return f}});var i=n(87725),r=n(39714),s=n(32501),o=n(91765),a=n(90576),l=n(4435),c=n(82598),u=n(39506),h=n(31190),d=n(78567),p=n(70340);function f(e,t){e.include(o.I);const n=e.vertex;n.include(a.u,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),n.uniforms.add(new c.t("transformWorldFromViewTH",(e=>e.transformWorldFromViewTH)),new c.t("transformWorldFromViewTL",(e=>e.transformWorldFromViewTL)),new d.k("transformViewFromCameraRelativeRS",(e=>e.transformViewFromCameraRelativeRS)),new p.X("transformProjFromView",(e=>e.transformProjFromView)),new h.h("transformWorldFromModelRS",(e=>e.transformWorldFromModelRS)),new l.W("transformWorldFromModelTH",(e=>e.transformWorldFromModelTH)),new l.W("transformWorldFromModelTL",(e=>e.transformWorldFromModelTL))),n.code.add(u.H`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),n.code.add(u.H`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${t.spherical?u.H`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:u.H`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),e.fragment.uniforms.add(new c.t("transformWorldFromViewTL",(e=>e.transformWorldFromViewTL))),n.code.add(u.H`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),e.fragment.code.add(u.H`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class m extends u.Y{constructor(){super(...arguments),this.transformWorldFromViewTH=(0,s.vt)(),this.transformWorldFromViewTL=(0,s.vt)(),this.transformViewFromCameraRelativeRS=(0,i.vt)(),this.transformProjFromView=(0,r.vt)()}}class g extends u.Y{constructor(){super(...arguments),this.transformWorldFromModelRS=(0,i.vt)(),this.transformWorldFromModelTH=(0,s.vt)(),this.transformWorldFromModelTL=(0,s.vt)()}}},28499:function(e,t,n){"use strict";n.d(t,{r:function(){return a}});var i=n(82547),r=n(2457),s=n(39506);function o(e){e.fragment.code.add(s.H`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function a(e,t){switch(e.include(r.U,t),t.textureCoordinateType){case r.q.Default:case r.q.Compressed:return void e.fragment.code.add(s.H`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);case r.q.Atlas:return e.include(o),void e.fragment.code.add(s.H`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);default:(0,i.Xb)(t.textureCoordinateType);case r.q.None:case r.q.COUNT:return}}},74603:function(e,t,n){"use strict";n.d(t,{G:function(){return c},V:function(){return h}});var i=n(33400),r=n(41546),s=n(19202),o=n(20830),a=n(38917),l=n(39506);function c(e,t){const n=e.vertex;t.hasVerticalOffset?(h(n),t.hasScreenSizePerspective&&(e.include(s.Y6),(0,s.OH)(n),(0,o.yu)(e.vertex,t)),n.code.add(l.H`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${t.spherical?l.H`vec3 worldNormal = normalize(worldPos + localOrigin);`:l.H`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${t.hasScreenSizePerspective?l.H`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:l.H`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):n.code.add(l.H`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const u=(0,r.vt)();function h(e){e.uniforms.add(new a.E("verticalOffset",((e,t)=>{const{minWorldLength:n,maxWorldLength:r,screenLength:s}=e.verticalOffset,o=Math.tan(.5*t.camera.fovY)/(.5*t.camera.fullViewport[3]),a=t.camera.pixelRatio||1;return(0,i.s)(u,s*a,o,n,r)})))}},10155:function(e,t,n){"use strict";n.d(t,{K:function(){return s}});var i=n(45937),r=n(39506);function s(e){e.uniforms.add(new i.e("alignPixelEnabled",((e,t)=>t.alignPixelEnabled))),e.code.add(r.H`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),e.code.add(r.H`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}},1143:function(e,t,n){"use strict";n.d(t,{Q:function(){return h},R:function(){return u}});var i=n(74603),r=n(19202),s=n(20830),o=n(38917),a=n(14543),l=n(39506),c=n(65839);const u=.5;function h(e,t){e.include(r.Y6),e.attributes.add(c.r.POSITION,"vec3"),e.attributes.add(c.r.NORMAL,"vec3"),e.attributes.add(c.r.CENTEROFFSETANDDISTANCE,"vec4");const n=e.vertex;(0,s.NB)(n,t),(0,s.yu)(n,t),n.uniforms.add(new o.E("viewport",((e,t)=>t.camera.fullViewport)),new a.m("polygonOffset",(e=>e.shaderPolygonOffset)),new a.m("cameraGroundRelative",((e,t)=>t.camera.aboveGround?1:-1))),t.hasVerticalOffset&&(0,i.V)(n),n.constants.add("smallOffsetAngle","float",.984807753012208),n.code.add(l.H`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),n.code.add(l.H`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${t.multipassEnabled?l.H.float(0):l.H`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),t.draped&&!t.hasVerticalOffset||(0,s.S7)(n),t.draped||(n.uniforms.add(new a.m("perDistancePixelRatio",((e,t)=>Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)))),n.code.add(l.H`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${l.H.float(u)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),t.screenCenterOffsetUnitsEnabled&&(0,s.Nz)(n),t.hasScreenSizePerspective&&(0,r.OH)(n),n.code.add(l.H`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?l.H`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled?"":l.H`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}},50399:function(e,t,n){"use strict";n.d(t,{I:function(){return o}});var i=n(10155),r=n(78946),s=n(39506);function o(e,t){const{vertex:n,fragment:o}=e;n.include(i.K),t.multipassEnabled&&e.varyings.add("depth","float"),n.code.add(s.H`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.multipassEnabled?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),e.include(r.Q,t),o.code.add(s.H`
  void main() {
    fragColor = vec4(1);
    ${t.multipassEnabled?s.H`
        if(terrainDepthTest(depth)) {
          fragColor.g = 0.5;
        }`:""}
  }
  `)}},60808:function(e,t,n){"use strict";var i;n.d(t,{D:function(){return i}}),function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"}(i||(i={}))},80231:function(e,t,n){"use strict";n.d(t,{y:function(){return c}});var i=n(10155),r=n(60808),s=n(38917),o=n(14543),a=n(39506),l=n(39838);function c(e){e.vertex.uniforms.add(new o.m("renderTransparentlyOccludedHUD",((e,t)=>t.hudRenderStyle===r.D.Occluded?1:t.hudRenderStyle===r.D.NotOccluded?0:.75)),new s.E("viewport",((e,t)=>t.camera.fullViewport)),new l.N("hudVisibilityTexture",((e,t)=>t.hudVisibility?.getTexture()))),e.vertex.include(i.K),e.vertex.code.add(a.H`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}},84435:function(e,t,n){"use strict";n.d(t,{Qh:function(){return l},U:function(){return o},bO:function(){return a}});var i=n(41546),r=n(39506),s=n(39838);const o=(0,i.fA)(1,1,0,1),a=(0,i.fA)(1,0,1,1);function l(e){e.fragment.uniforms.add(new s.N("depthTexture",((e,t)=>t.mainDepth))),e.fragment.constants.add("occludedHighlightFlag","vec4",o).add("unoccludedHighlightFlag","vec4",a),e.fragment.code.add(r.H`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)}},23397:function(e,t,n){"use strict";n.d(t,{E:function(){return a}});var i=n(13786),r=n(1932),s=(n(52766),n(11687)),o=n(39506);function a(e){e.uniforms.add(new s.G("zProjectionMap",((e,t)=>function(e){const t=e.projectionMatrix;return(0,i.hZ)(l,t[14],t[10])}(t.camera)))),e.code.add(o.H`float linearizeDepth(float depth) {
float depthNdc = depth * 2.0 - 1.0;
float c1 = zProjectionMap[0];
float c2 = zProjectionMap[1];
return -(c1 / (depthNdc + c2 + 1e-7));
}`),e.code.add(o.H`float depthFromTexture(sampler2D depthTexture, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
float depth = texelFetch(depthTexture, iuv, 0).r;
return depth;
}`),e.code.add(o.H`float linearDepthFromTexture(sampler2D depthTexture, vec2 uv) {
return linearizeDepth(depthFromTexture(depthTexture, uv));
}`)}const l=(0,r.vt)()},2120:function(e,t,n){"use strict";n.d(t,{v:function(){return s},z:function(){return r}});var i=n(39506);function r(e){e.fragment.code.add(i.H`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function s(e){e.fragment.code.add(i.H`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}},31166:function(e,t,n){"use strict";n.d(t,{q:function(){return f},h:function(){return m}});var i=n(52766),r=n(20830),s=n(38917),o=n(14543),a=n(39506),l=n(39838);function c(e){return e.pattern.map((t=>Math.round(t*e.pixelRatio)))}function u(e){return c(e).reduce(((e,t)=>Math.max(e,t)))}n(5161),n(85456),n(78541),n(10956);var h=n(33400),d=n(41546);const p=(0,d.vt)();function f(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?function(e,t){const n=!(t.draped&&t.stipplePreferContinuous),{vertex:c,fragment:f}=e;f.include(i.W),t.draped||((0,r.yu)(c,t),c.uniforms.add(new o.m("worldToScreenPerDistanceRatio",((e,t)=>1/t.camera.perScreenPixelRatio))),c.code.add(a.H`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),e.varyings.add("vStippleDistance","float"),e.varyings.add("vStippleDistanceLimits","vec2"),e.varyings.add("vStipplePatternStretch","float"),c.code.add(a.H`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${g};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),c.code.add(a.H`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),c.code.add(a.H`
    if (segmentLengthPseudoScreen >= ${n?"patternLength":"1e4"}) {
  `),(0,r.Nz)(c),c.code.add(a.H`float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
float segmentLengthScreenRounded = flooredRepetitions * patternLength;
float stretch = repetitions / flooredRepetitions;
vStipplePatternStretch = max(0.75, stretch);
return vec2(0.0, segmentLengthScreenRounded);
}
return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
}`),f.uniforms.add(new l.N("stipplePatternTexture",(e=>e.stippleTexture)),new o.m("stipplePatternSDFNormalizer",(e=>function(e){return e?(Math.floor(.5*(u(e)-1))+.5)/e.pixelRatio:1}(e.stipplePattern))),new o.m("stipplePatternPixelSizeInv",(e=>1/m(e)))),f.code.add(a.H`float getStippleSDF(out bool isClamped) {
float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;
float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;
u = fract(u);
float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;
return (sdf - 0.5) * vStipplePatternStretch + 0.5;
}
float getStippleSDF() {
bool ignored;
return getStippleSDF(ignored);
}
float getStippleAlpha() {
bool isClamped;
float stippleSDF = getStippleSDF(isClamped);
float antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);
return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
}`),t.stippleOffColorEnabled?(f.uniforms.add(new s.E("stippleOffColor",(e=>function(e){return null==e?d.uY:4===e.length?e:(0,h.s)(p,e[0],e[1],e[2],1)}(e.stippleOffColor)))),f.code.add(a.H`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):f.code.add(a.H`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}(e,t):function(e){e.fragment.code.add(a.H`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}(e)}function m(e){const t=e.stipplePattern;return t?function(e){if(null==e)return 1;const t=c(e);return Math.floor(t.reduce(((e,t)=>e+t)))}(e.stipplePattern)/t.pixelRatio:1}const g=a.H.float(.4)},42426:function(e,t,n){"use strict";n.d(t,{Gc:function(){return s},O4:function(){return o},qU:function(){return a}});var i=n(82598),r=n(39506);function s(e){e.uniforms.add(new i.t("mainLightDirection",((e,t)=>t.lighting.mainLight.direction)))}function o(e){e.uniforms.add(new i.t("mainLightIntensity",((e,t)=>t.lighting.mainLight.intensity)))}function a(e){s(e.fragment),o(e.fragment),e.fragment.code.add(r.H`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}},91981:function(e,t,n){"use strict";n.d(t,{r:function(){return l}});var i=n(33710),r=n(20830),s=n(14543),o=n(39506),a=n(50678);function l(e,t){const{vertex:n,constants:l}=e;l.add("markerSizePerLineWidth","float",i.PV),(0,r.Nz)(n),null==n.uniforms.get("markerScale")&&n.constants.add("markerScale","float",1),n.code.add(o.H`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),t.space===a.lM.World&&(n.constants.add("maxSegmentLengthFraction","float",.45),n.uniforms.add(new s.m("perRenderPixelRatio",((e,t)=>t.camera.perRenderPixelRatio))),n.code.add(o.H`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}},98901:function(e,t,n){"use strict";n.d(t,{H:function(){return o},U:function(){return a}});var i=n(23397),r=n(39506),s=n(39838);function o(e){e.include(i.E),e.uniforms.add(new s.N("geometryDepthTexture",((e,t)=>t.multipassGeometry.depth?.attachment))),e.code.add(r.H`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos);
return (elementDepth < (geometryDepth - 1.0));
}`)}class a{}},78946:function(e,t,n){"use strict";n.d(t,{Q:function(){return o},h:function(){return a}});var i=n(23397),r=n(39506),s=n(39838);function o(e,t){if(!t.multipassEnabled)return;e.fragment.include(i.E),e.fragment.uniforms.add(new s.N("terrainDepthTexture",((e,t)=>t.multipassTerrain.depth?.attachment)));const n=t.occlusionPass;e.fragment.code.add(r.H`
   ${n?"bool":"void"} terrainDepthTest(float fragmentDepth) {
      float depth = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0).r;
      float linearDepth = linearizeDepth(depth);
      ${n?r.H`return fragmentDepth < linearDepth && depth < 1.0;`:r.H`
          if(fragmentDepth ${t.cullAboveGround?">":"<="} linearDepth){
            discard;
          }`}
    }`)}class a{constructor(){this.cullAboveGround=!1}}},51942:function(e,t,n){"use strict";n.d(t,{c:function(){return a},f:function(){return l}});var i=n(39506);function r(e){const t=e.fragment.code;t.add(i.H`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.add(i.H`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.add(i.H`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}var s=n(11520),o=n(61629);function a(e,t){const n=e.fragment.code;e.include(o.p),t.pbrMode!==s.A9.Normal&&t.pbrMode!==s.A9.Schematic&&t.pbrMode!==s.A9.Simplified&&t.pbrMode!==s.A9.TerrainWithWater||(n.add(i.H`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),n.add(i.H`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),t.pbrMode!==s.A9.Normal&&t.pbrMode!==s.A9.Schematic||(e.include(r),n.add(i.H`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),n.add(i.H`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),n.add(i.H`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),n.add(i.H`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function l(e,t){const n=e.fragment.code;e.include(o.p),n.add(i.H`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),n.add(i.H`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),n.add(i.H`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),n.add(i.H`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),n.add(i.H`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}},11520:function(e,t,n){"use strict";n.d(t,{A9:function(){return i},_Z:function(){return d}});var i,r,s=n(28499),o=n(4435),a=n(82598),l=n(39506),c=n(40075),u=n(39838),h=n(54516);function d(e,t){const n=e.fragment,r=t.hasMetallicRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;if(t.pbrMode===i.Normal&&r&&e.include(s.r,t),t.pbrMode!==i.Schematic)if(t.pbrMode!==i.Disabled){if(t.pbrMode===i.Normal){n.code.add(l.H`vec3 mrr;
vec3 emission;
float occlusion;`);const e=t.pbrTextureBindType;t.hasMetallicRoughnessTexture&&(n.uniforms.add(e===h.c.Pass?new u.N("texMetallicRoughness",(e=>e.textureMetallicRoughness)):new c.o("texMetallicRoughness",(e=>e.textureMetallicRoughness))),n.code.add(l.H`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),t.hasEmissionTexture&&(n.uniforms.add(e===h.c.Pass?new u.N("texEmission",(e=>e.textureEmissive)):new c.o("texEmission",(e=>e.textureEmissive))),n.code.add(l.H`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),t.hasOcclusionTexture?(n.uniforms.add(e===h.c.Pass?new u.N("texOcclusion",(e=>e.textureOcclusion)):new c.o("texOcclusion",(e=>e.textureOcclusion))),n.code.add(l.H`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):n.code.add(l.H`float getBakedOcclusion() { return 1.0; }`),e===h.c.Pass?n.uniforms.add(new a.t("emissionFactor",(e=>e.emissiveFactor)),new a.t("mrrFactors",(e=>e.mrrFactors))):n.uniforms.add(new o.W("emissionFactor",(e=>e.emissiveFactor)),new o.W("mrrFactors",(e=>e.mrrFactors))),n.code.add(l.H`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${t.hasMetallicRoughnessTexture?l.H`applyMetallnessAndRoughness(${t.hasMetallicRoughnessTextureTransform?l.H`metallicRoughnessUV`:"vuv0"});`:""}

      ${t.hasEmissionTexture?l.H`applyEmission(${t.hasEmissiveTextureTransform?l.H`emissiveUV`:"vuv0"});`:""}

      ${t.hasOcclusionTexture?l.H`applyOcclusion(${t.hasOcclusionTextureTransform?l.H`occlusionUV`:"vuv0"});`:""}
    }
  `)}}else n.code.add(l.H`float getBakedOcclusion() { return 1.0; }`);else n.code.add(l.H`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}n(36634),(r=i||(i={}))[r.Disabled=0]="Disabled",r[r.Normal=1]="Normal",r[r.Schematic=2]="Schematic",r[r.Water=3]="Water",r[r.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",r[r.Simplified=5]="Simplified",r[r.TerrainWithWater=6]="TerrainWithWater",r[r.COUNT=7]="COUNT"},61629:function(e,t,n){"use strict";n.d(t,{p:function(){return r}});var i=n(39506);function r(e){e.vertex.code.add(i.H`const float PI = 3.141592653589793;`),e.fragment.code.add(i.H`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}},3088:function(e,t,n){"use strict";n.d(t,{O:function(){return i},b:function(){return r}});const i=3e5,r=5e5},58766:function(e,t,n){"use strict";n.d(t,{A:function(){return u}});var i=n(82598),r=n(30636),s=n(454),o=n(39506),a=n(78567),l=n(65839),c=n(77971);function u(e,t){const{vertex:n,attributes:u}=e;t.hasVvInstancing&&(t.vvSize||t.vvColor)&&u.add(l.r.INSTANCEFEATUREATTRIBUTE,"vec4"),t.vvSize?(n.uniforms.add(new i.t("vvSizeMinSize",(e=>e.vvSize.minSize))),n.uniforms.add(new i.t("vvSizeMaxSize",(e=>e.vvSize.maxSize))),n.uniforms.add(new i.t("vvSizeOffset",(e=>e.vvSize.offset))),n.uniforms.add(new i.t("vvSizeFactor",(e=>e.vvSize.factor))),n.uniforms.add(new a.k("vvSymbolRotationMatrix",(e=>e.vvSymbolRotationMatrix))),n.uniforms.add(new i.t("vvSymbolAnchor",(e=>e.vvSymbolAnchor))),n.code.add(o.H`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),n.code.add(o.H`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.hasVvInstancing?o.H`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):n.code.add(o.H`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(n.constants.add("vvColorNumber","int",c.p),n.uniforms.add(new s.x("vvColorValues",(e=>e.vvColor.values),c.p),new r.F("vvColorColors",(e=>e.vvColor.colors),c.p)),n.code.add(o.H`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${t.hasVvInstancing?o.H`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):n.code.add(o.H`vec4 vvColor() { return vec4(1.0); }`)}},11388:function(e,t,n){"use strict";n.d(t,{E:function(){return A}});var i=n(2120),r=n(39506);function s(e){e.fragment.code.add(r.H`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var o=n(51942),a=n(3088),l=n(23397),c=n(11687),u=n(14543),h=n(70340),d=n(39838);function p(e,t){const n=e.fragment;n.include(l.E),n.uniforms.add(new c.G("nearFar",((e,t)=>t.camera.nearFar))),n.uniforms.add(new d.N("depthMap",((e,t)=>t.depth?.attachment))),n.uniforms.add(new h.X("proj",((e,t)=>t.camera.projectionMatrix))),n.uniforms.add(new u.m("invResolutionHeight",((e,t)=>1/t.camera.height))),n.uniforms.add(new h.X("reprojectionMatrix",((e,t)=>t.ssr.reprojectionMatrix))),n.code.add(r.H`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${t.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}var f=n(15774),m=n(43587),g=n(47096),_=n(75256),v=n(58192),y=n(42426),b=n(45937),T=n(82598),E=n(65312),x=n(54516);class S extends E.n{constructor(e,t){super(e,"samplerCube",x.c.Pass,((n,i,r)=>n.bindTexture(e,t(i,r))))}}function w(e){const t=e.fragment;t.uniforms.add(new h.X("rotationMatrixClouds",((e,t)=>t.cloudsFade.parallax.transform)),new h.X("rotationMatrixCloudsCrossFade",((e,t)=>t.cloudsFade.parallaxNew.transform)),new T.t("anchorPosition",((e,t)=>t.cloudsFade.parallax.anchorPointClouds)),new T.t("anchorPositionCrossFade",((e,t)=>t.cloudsFade.parallaxNew.anchorPointClouds)),new u.m("cloudsHeight",(()=>v.k9)),new u.m("radiusCurvatureCorrectionFactor",((e,t)=>t.cloudsFade.parallax.radiusCurvatureCorrectionFactor)),new u.m("totalFadeInOut",((e,t)=>1-t.cloudsFade.opacity)),new u.m("crossFadeAnchorFactor",((e,t)=>(0,f.qE)(t.cloudsFade.fadeFactor,0,1))),new S("cubeMap",((e,t)=>t.cloudsFade.data?.cubeMap?.colorTexture??null)),new b.e("crossFade",((e,t)=>t.cloudsFade.fadeMode===_.OQ.CROSS_FADE)),new b.e("readChannelsRG",((e,t)=>t.cloudsFade.readChannels===g.c.RG)),new b.e("fadeTextureChannels",((e,t)=>t.cloudsFade.renderingStage===g.c2.FADING))),t.constants.add("planetRadius","float",m.$O.radius),t.code.add(r.H`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),t.code.add(r.H`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),t.code.add(r.H`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),(0,y.Gc)(t),(0,y.O4)(t),t.code.add(r.H`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),t.code.add(r.H`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),t.code.add(r.H`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),t.code.add(r.H`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),t.code.add(r.H`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function A(e,t){e.include(o.f,t),e.include(s),e.include(i.v),t.hasCloudsReflections&&e.include(w,t),t.hasScreenSpaceReflections&&e.include(p,t);const n=e.fragment;n.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",a.O).add("ssrHeightFadeEnd","float",a.b).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),n.code.add(r.H`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),n.uniforms.add(new u.m("lightingSpecularStrength",((e,t)=>t.lighting.mainLight.specularStrength)),new u.m("lightingEnvironmentStrength",((e,t)=>t.lighting.mainLight.environmentStrength))),n.code.add(r.H`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),t.hasCloudsReflections&&n.code.add(r.H`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),t.hasScreenSpaceReflections?(n.uniforms.add(new h.X("view",((e,t)=>t.camera.viewMatrix)),new d.N("lastFrameColorTexture",((e,t)=>t.ssr.lastFrameColor?.getTexture())),new u.m("fadeFactorSSR",((e,t)=>t.ssr.fadeFactor))),n.code.add(r.H`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):n.code.add(r.H`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),t.hasCloudsReflections?t.hasScreenSpaceReflections?n.code.add(r.H`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):n.code.add(r.H`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):n.code.add(r.H`return waterRenderedColor;
}`)}},28686:function(e,t,n){"use strict";n.d(t,{H:function(){return i},y:function(){return r}});const i=.1,r=.001},82316:function(e,t,n){"use strict";n.d(t,{Ir:function(){return u}});var i=n(13786),r=n(1932),s=n(33400),o=n(41546),a=n(11687),l=n(38917),c=n(39506);function u(e){e.fragment.uniforms.add(new l.E("projInfo",((e,t)=>function(e){const t=e.projectionMatrix;return 0===t[11]?(0,s.s)(h,2/(e.fullWidth*t[0]),2/(e.fullHeight*t[5]),(1+t[12])/t[0],(1+t[13])/t[5]):(0,s.s)(h,-2/(e.fullWidth*t[0]),-2/(e.fullHeight*t[5]),(1-t[8])/t[0],(1-t[9])/t[5])}(t.camera)))),e.fragment.uniforms.add(new a.G("zScale",((e,t)=>function(e){return 0===e.projectionMatrix[11]?(0,i.hZ)(d,0,1):(0,i.hZ)(d,1,0)}(t.camera)))),e.fragment.code.add(c.H`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}const h=(0,o.vt)(),d=(0,r.vt)()},23864:function(e,t,n){"use strict";n.d(t,{a:function(){return r}});var i=n(39506);function r(e){e.code.add(i.H`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}},90576:function(e,t,n){"use strict";n.d(t,{u:function(){return r}});var i=n(39506);function r({code:e},t){t.doublePrecisionRequiresObfuscation?e.add(i.H`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):e.add(i.H`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}},52766:function(e,t,n){"use strict";n.d(t,{W:function(){return r}});var i=n(39506);function r(e){e.code.add(i.H`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}},19202:function(e,t,n){"use strict";n.d(t,{OH:function(){return c},Y6:function(){return a},pM:function(){return l}});var i=n(20551),r=n(32501),s=n(82598),o=n(39506);function a(e){e.vertex.code.add(o.H`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(o.H`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),e.vertex.code.add(o.H`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),e.vertex.code.add(o.H`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(o.H`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),e.vertex.code.add(o.H`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function l(e){e.uniforms.add(new s.t("screenSizePerspective",(e=>u(e.screenSizePerspective))))}function c(e){e.uniforms.add(new s.t("screenSizePerspectiveAlignment",(e=>u(e.screenSizePerspectiveAlignment||e.screenSizePerspective))))}function u(e){return(0,i.s)(h,e.parameters.divisor,e.parameters.offset,e.minScaleFactor)}const h=(0,r.vt)()},20830:function(e,t,n){"use strict";n.d(t,{yu:function(){return f},Nz:function(){return y},NB:function(){return m},S7:function(){return v}});var i=n(73364),r=n(39714),s=n(20551),o=n(32501),a=n(4435),l=n(82598),c=n(14543),u=n(65312),h=n(54516);class d extends u.n{constructor(e,t){super(e,"mat4",h.c.Draw,((n,i,r)=>n.setUniformMatrix4fv(e,t(i,r))))}}var p=n(70340);function f(e,t){t.instancedDoublePrecision?e.constants.add("cameraPosition","vec3",o.uY):e.uniforms.add(new a.W("cameraPosition",((e,t)=>(0,s.s)(_,t.camera.viewInverseTransposeMatrix[3]-e.origin[0],t.camera.viewInverseTransposeMatrix[7]-e.origin[1],t.camera.viewInverseTransposeMatrix[11]-e.origin[2]))))}function m(e,t){if(!t.instancedDoublePrecision)return void e.uniforms.add(new p.X("proj",((e,t)=>t.camera.projectionMatrix)),new d("view",((e,t)=>(0,i.Tl)(g,t.camera.viewMatrix,e.origin))),new a.W("localOrigin",(e=>e.origin)));const n=e=>(0,s.s)(_,e.camera.viewInverseTransposeMatrix[3],e.camera.viewInverseTransposeMatrix[7],e.camera.viewInverseTransposeMatrix[11]);e.uniforms.add(new p.X("proj",((e,t)=>t.camera.projectionMatrix)),new p.X("view",((e,t)=>(0,i.Tl)(g,t.camera.viewMatrix,n(t)))),new l.t("localOrigin",((e,t)=>n(t))))}const g=(0,r.vt)(),_=(0,o.vt)();function v(e){e.uniforms.add(new p.X("viewNormal",((e,t)=>t.camera.viewInverseTransposeMatrix)))}function y(e){e.uniforms.add(new c.m("pixelRatio",((e,t)=>t.camera.pixelRatio/t.overlayStretch)))}},45937:function(e,t,n){"use strict";n.d(t,{e:function(){return s}});var i=n(65312),r=n(54516);class s extends i.n{constructor(e,t){super(e,"bool",r.c.Pass,((n,i,r)=>n.setUniform1b(e,t(i,r))))}}},11687:function(e,t,n){"use strict";n.d(t,{G:function(){return s}});var i=n(65312),r=n(54516);class s extends i.n{constructor(e,t){super(e,"vec2",r.c.Pass,((n,i,r)=>n.setUniform2fv(e,t(i,r))))}}},4435:function(e,t,n){"use strict";n.d(t,{W:function(){return s}});var i=n(65312),r=n(54516);class s extends i.n{constructor(e,t){super(e,"vec3",r.c.Draw,((n,i,r,s)=>n.setUniform3fv(e,t(i,r,s))))}}},82598:function(e,t,n){"use strict";n.d(t,{t:function(){return s}});var i=n(65312),r=n(54516);class s extends i.n{constructor(e,t){super(e,"vec3",r.c.Pass,((n,i,r)=>n.setUniform3fv(e,t(i,r))))}}},41356:function(e,t,n){"use strict";var i=n(65312);n(54516),i.n},38917:function(e,t,n){"use strict";n.d(t,{E:function(){return s}});var i=n(65312),r=n(54516);class s extends i.n{constructor(e,t){super(e,"vec4",r.c.Pass,((n,i,r)=>n.setUniform4fv(e,t(i,r))))}}},30636:function(e,t,n){"use strict";n.d(t,{F:function(){return s}});var i=n(65312),r=n(54516);class s extends i.n{constructor(e,t,n){super(e,"vec4",r.c.Pass,((n,i,r)=>n.setUniform4fv(e,t(i,r))),n)}}},14543:function(e,t,n){"use strict";n.d(t,{m:function(){return s}});var i=n(65312),r=n(54516);class s extends i.n{constructor(e,t){super(e,"float",r.c.Pass,((n,i,r)=>n.setUniform1f(e,t(i,r))))}}},454:function(e,t,n){"use strict";n.d(t,{x:function(){return s}});var i=n(65312),r=n(54516);class s extends i.n{constructor(e,t,n){super(e,"float",r.c.Pass,((n,i,r)=>n.setUniform1fv(e,t(i,r))),n)}}},50295:function(e,t,n){"use strict";n.d(t,{c:function(){return s}});var i=n(65312),r=n(54516);class s extends i.n{constructor(e,t){super(e,"int",r.c.Pass,((n,i,r)=>n.setUniform1i(e,t(i,r))))}}},31190:function(e,t,n){"use strict";n.d(t,{h:function(){return s}});var i=n(65312),r=n(54516);class s extends i.n{constructor(e,t){super(e,"mat3",r.c.Draw,((n,i,r)=>n.setUniformMatrix3fv(e,t(i,r))))}}},78567:function(e,t,n){"use strict";n.d(t,{k:function(){return s}});var i=n(65312),r=n(54516);class s extends i.n{constructor(e,t){super(e,"mat3",r.c.Pass,((n,i,r)=>n.setUniformMatrix3fv(e,t(i,r))))}}},70340:function(e,t,n){"use strict";n.d(t,{X:function(){return s}});var i=n(65312),r=n(54516);class s extends i.n{constructor(e,t){super(e,"mat4",r.c.Pass,((n,i,r)=>n.setUniformMatrix4fv(e,t(i,r))))}}},62988:function(e,t,n){"use strict";n.d(t,{N5:function(){return l}});var i=n(39819),r=(n(58941),n(40633)),s=n(54516),o=n(90553);class a{constructor(){this._includedModules=new Map}include(e,t){this._includedModules.has(e)?this._includedModules.get(e):(this._includedModules.set(e,t),e(this.builder,t))}}class l extends a{constructor(){super(...arguments),this.vertex=new h,this.fragment=new h,this.attributes=new d,this.varyings=new p,this.extensions=new f,this.constants=new g,this.outputs=new m}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const t=this.extensions.generateSource(e),n=this.attributes.generateSource(e),i=this.varyings.generateSource(e),r="vertex"===e?this.vertex:this.fragment,s=r.uniforms.generateSource(),o=r.code.generateSource(),a="vertex"===e?v:_,l=this.constants.generateSource().concat(r.constants.generateSource()),c=this.outputs.generateSource(e);return`#version 300 es\n${t.join("\n")}\n\n${a}\n\n${l.join("\n")}\n\n${s.join("\n")}\n\n${n.join("\n")}\n\n${i.join("\n")}\n\n${c.join("\n")}\n\n${o.join("\n")}`}generateBindPass(e){const t=new Map;this.vertex.uniforms.entries.forEach((e=>{const n=e.bind[s.c.Pass];n&&t.set(e.name,n)})),this.fragment.uniforms.entries.forEach((e=>{const n=e.bind[s.c.Pass];n&&t.set(e.name,n)}));const n=Array.from(t.values()),i=n.length;return(t,r)=>{for(let s=0;s<i;++s)n[s](e,t,r)}}generateBindDraw(e){const t=new Map;this.vertex.uniforms.entries.forEach((e=>{const n=e.bind[s.c.Draw];n&&t.set(e.name,n)})),this.fragment.uniforms.entries.forEach((e=>{const n=e.bind[s.c.Draw];n&&t.set(e.name,n)}));const n=Array.from(t.values()),i=n.length;return(t,r,s)=>{for(let o=0;o<i;++o)n[o](e,t,r,s)}}}class c{constructor(e){this._stage=e,this._entries=new Map}add(...e){for(const t of e)this._add(t);return this._stage}get(e){return this._entries.get(e)}_add(e){if(null!=e){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new i.A(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else r.A.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder").error(`Trying to add null Uniform from ${(new Error).stack}.`)}generateSource(){return Array.from(this._entries.values()).map((e=>null!=e.arraySize?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`))}get entries(){return Array.from(this._entries.values())}}class u{constructor(e){this._stage=e,this._entries=new Array}add(e){return this._entries.push(e),this._stage}generateSource(){return this._entries}}class h extends a{constructor(){super(...arguments),this.uniforms=new c(this),this.code=new u(this),this.constants=new g}get builder(){return this}}class d{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(e){return"fragment"===e?[]:this._entries.map((e=>`in ${e[1]} ${e[0]};`))}}class p{constructor(){this._entries=new Map}add(e,t){this._entries.has(e)&&(0,o.vA)(this._entries.get(e)===t),this._entries.set(e,t)}generateSource(e){const t=new Array;return this._entries.forEach(((n,i)=>t.push("vertex"===e?`out ${n} ${i};`:`in ${n} ${i};`))),t}}class f{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const t="vertex"===e?f.ALLOWLIST_VERTEX:f.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter((e=>t.includes(e))).map((e=>`#extension ${e} : enable`))}}f.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],f.ALLOWLIST_VERTEX=[];class m{constructor(){this._entries=new Map}add(e,t,n=0){const i=this._entries.get(n);i?(0,o.vA)(i.name===e&&i.type===t,`Fragment shader output location ${n} occupied`):this._entries.set(n,{name:e,type:t})}generateSource(e){if("vertex"===e)return[];0===this._entries.size&&this._entries.set(0,{name:m.DEFAULT_NAME,type:m.DEFAULT_TYPE});const t=new Array;return this._entries.forEach(((e,n)=>t.push(`layout(location = ${n}) out ${e.type} ${e.name};`))),t}}m.DEFAULT_TYPE="vec4",m.DEFAULT_NAME="fragColor";class g{constructor(){this._entries=new Set}add(e,t,n){let i="ERROR_CONSTRUCTOR_STRING";switch(t){case"float":i=g._numberToFloatStr(n);break;case"int":i=g._numberToIntStr(n);break;case"bool":i=n.toString();break;case"vec2":i=`vec2(${g._numberToFloatStr(n[0])},                            ${g._numberToFloatStr(n[1])})`;break;case"vec3":i=`vec3(${g._numberToFloatStr(n[0])},                            ${g._numberToFloatStr(n[1])},                            ${g._numberToFloatStr(n[2])})`;break;case"vec4":i=`vec4(${g._numberToFloatStr(n[0])},                            ${g._numberToFloatStr(n[1])},                            ${g._numberToFloatStr(n[2])},                            ${g._numberToFloatStr(n[3])})`;break;case"ivec2":i=`ivec2(${g._numberToIntStr(n[0])},                             ${g._numberToIntStr(n[1])})`;break;case"ivec3":i=`ivec3(${g._numberToIntStr(n[0])},                             ${g._numberToIntStr(n[1])},                             ${g._numberToIntStr(n[2])})`;break;case"ivec4":i=`ivec4(${g._numberToIntStr(n[0])},                             ${g._numberToIntStr(n[1])},                             ${g._numberToIntStr(n[2])},                             ${g._numberToIntStr(n[3])})`;break;case"mat2":case"mat3":case"mat4":i=`${t}(${Array.prototype.map.call(n,(e=>g._numberToFloatStr(e))).join(", ")})`}return this._entries.add(`const ${t} ${e} = ${i};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}}const _="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",v="precision highp float;\nprecision highp sampler2D;"},40075:function(e,t,n){"use strict";n.d(t,{o:function(){return s}});var i=n(65312),r=n(54516);class s extends i.n{constructor(e,t){super(e,"sampler2D",r.c.Draw,((n,i,r)=>n.bindTexture(e,t(i,r))))}}},39838:function(e,t,n){"use strict";n.d(t,{N:function(){return s}});var i=n(65312),r=n(54516);class s extends i.n{constructor(e,t){super(e,"sampler2D",r.c.Pass,((n,i,r)=>n.bindTexture(e,t(i,r))))}}},65312:function(e,t,n){"use strict";n.d(t,{n:function(){return r}});var i=n(54516);class r{constructor(e,t,n,r,s=null){if(this.name=e,this.type=t,this.arraySize=s,this.bind={[i.c.Pass]:null,[i.c.Draw]:null},r)switch(n){case i.c.Pass:this.bind[i.c.Pass]=r;break;case i.c.Draw:this.bind[i.c.Draw]=r}}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}}},39506:function(e,t,n){"use strict";n.d(t,{H:function(){return r},Y:function(){return i}});const i=class{};function r(e,...t){let n="";for(let i=0;i<t.length;i++)n+=e[i]+t[i];return n+=e[e.length-1],n}var s;(s=r||(r={})).int=function(e){return Math.round(e).toString()},s.float=function(e){return e.toPrecision(8)}},54516:function(e,t,n){"use strict";var i;n.d(t,{c:function(){return i}}),function(e){e[e.Pass=0]="Pass",e[e.Draw=1]="Draw"}(i||(i={}))},34615:function(e,t,n){"use strict";n.d(t,{$:function(){return i}});class i{constructor(e,t){this._module=e,this._loadModule=t}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}}},22542:function(e,t,n){"use strict";n.d(t,{w:function(){return s}});var i=n(95929),r=n(85456);class s{constructor(e,t,n){this.release=n,this.initializeConfiguration(e,t),this._configuration=t.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e)}destroy(){this._program=(0,i.WD)(this._program),this._pipeline=this._configuration=null}reload(e){(0,i.WD)(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return r.WR.TRIANGLES}getPipeline(e,t,n){return this._pipeline}initializeConfiguration(e,t){}}},8610:function(e,t,n){"use strict";n.d(t,{K:function(){return r},W:function(){return s}});var i=n(39506);class r extends i.Y{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map((()=>0)):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,t={key:this.key};for(const n of e)t[n]=this[n];return t}}function s(e={}){return(t,n)=>{if(t._parameterNames=t._parameterNames??[],t._parameterNames.push(n),null!=e.constValue)Object.defineProperty(t,n,{get:()=>e.constValue});else{const i=t._parameterNames.length-1,r=e.count||2,s=Math.ceil(Math.log2(r)),o=t._parameterBits??[0];let a=0;for(;o[a]+s>16;)a++,a>=o.length&&o.push(0);t._parameterBits=o;const l=o[a],c=(1<<s)-1<<l;o[a]+=s,Object.defineProperty(t,n,{get(){return this[i]},set(e){if(this[i]!==e&&(this[i]=e,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+e<<l&c,"number"!=typeof e&&"boolean"!=typeof e))throw new Error("Configuration value for "+n+" must be boolean or number, got "+typeof e)}})}}}},67521:function(e,t,n){"use strict";n.d(t,{B7:function(){return o},Ot:function(){return c},RW:function(){return l},S:function(){return u}});var i=n(83525),r=n(27264);const s={required:[]},o={required:[r.V.Depth]};class a extends i.A{consumes(){return s}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}get materialReference(){return null}modify(e){}get numGeometries(){return 0}get hasOccludees(){return!1}queryRenderOccludedState(e){return!1}}class l extends a{}class c extends a{constructor(){super(...arguments),this.drapedPriority=0}}class u extends a{}},97018:function(e,t,n){"use strict";n.d(t,{H:function(){return s},a:function(){return r}});var i=n(38504);class r{constructor(){this.enabled=!0,this._time=(0,i.l5)(0)}get time(){return this._time}advance({deltaTime:e,fixedTime:t}){return null!=t?this._time!==t&&(this._time=t,!0):(this._time=(0,i.l5)(this._time+e),0!==e)}}class s{constructor(e,t){this.deltaTime=e,this.fixedTime=t}}},14905:function(e,t,n){"use strict";n.d(t,{K:function(){return i},n:function(){return r}});class i{constructor(e,t,n=t){this.data=e,this.size=t,this.stride=n}}class r extends i{constructor(e,t,n,i=!1,r=n){super(e,n,r),this.indices=t,this.exclusive=i}}},23545:function(e,t,n){"use strict";n.d(t,{VR:function(){return r},a0:function(){return o}});var i=n(7187);class r{constructor(){this.adds=new i.A,this.removes=new i.A,this.updates=new i.A({allocator:e=>e||new s,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return 0===this.adds.length&&0===this.removes.length&&0===this.updates.length}}class s{}class o{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}},48015:function(e,t,n){"use strict";n.d(t,{J:function(){return r}});var i=n(11231);class r{constructor(){this.id=(0,i.c)()}}},40359:function(e,t,n){"use strict";var i;n.d(t,{X:function(){return i}}),function(e){e[e.Layer=0]="Layer",e[e.Object=1]="Object",e[e.Mesh=2]="Mesh",e[e.Line=3]="Line",e[e.Point=4]="Point",e[e.Material=5]="Material",e[e.Texture=6]="Texture",e[e.COUNT=7]="COUNT"}(i||(i={}))},40502:function(e,t,n){"use strict";n.d(t,{D:function(){return r}});var i=n(65839);const r=new Map([[i.r.POSITION,0],[i.r.NORMAL,1],[i.r.NORMALCOMPRESSED,1],[i.r.UV0,2],[i.r.COLOR,3],[i.r.COLORFEATUREATTRIBUTE,3],[i.r.SIZE,4],[i.r.TANGENT,4],[i.r.CENTEROFFSETANDDISTANCE,5],[i.r.SYMBOLCOLOR,5],[i.r.FEATUREATTRIBUTE,6],[i.r.INSTANCEFEATUREATTRIBUTE,6],[i.r.INSTANCECOLOR,7],[i.r.OBJECTANDLAYERIDCOLOR,7],[i.r.INSTANCEOBJECTANDLAYERIDCOLOR,7],[i.r.INSTANCEMODEL,8],[i.r.INSTANCEMODELNORMAL,12],[i.r.INSTANCEMODELORIGINHI,11],[i.r.INSTANCEMODELORIGINLO,15]])},4875:function(e,t,n){"use strict";n.d(t,{A:function(){return r}});var i=n(54407);class r{constructor(e){this._material=e.material,this._techniques=e.techniques,this._output=e.output}dispose(){this._techniques.release(this._technique)}get technique(){return this._technique}get _stippleTextures(){return this._techniques.constructionContext.stippleTextures}get _markerTextures(){return this._techniques.constructionContext.markerTextures}ensureTechnique(e,t){return this._technique=this._techniques.releaseAndAcquire(e,this._material.getConfiguration(this._output,t),this._technique),this._technique}ensureResources(e){return i.Am.LOADED}}},52798:function(e,t,n){"use strict";n.d(t,{c:function(){return r}});var i=n(54407);class r{constructor(e,t){this._material=e,this._repository=t,this._map=new Map}dispose(){this._map.forEach(((e,t)=>{null!=e&&this._repository.release(this._material,t)}))}load(e,t,n){const r=this._material.produces.get(t);if(!r?.(n))return null;this._map.has(n)||this._map.set(n,this._repository.acquire(this._material,t,n));const s=this._map.get(n);if(null!=s){if(s.ensureResources(e)===i.Am.LOADED)return s;this._repository.requestRender()}return null}}},36634:function(e,t,n){"use strict";n.d(t,{N:function(){return c},m:function(){return l}});var i=n(95929),r=n(60539),s=n(39506),o=n(54407),a=n(4875);class l extends a.A{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textures=e.textures,this._textureId=e.textureId,this._acquire(e.textureId,(e=>this._texture=e)),this._acquire(e.normalTextureId,(e=>this._textureNormal=e)),this._acquire(e.emissiveTextureId,(e=>this._textureEmissive=e)),this._acquire(e.occlusionTextureId,(e=>this._textureOcclusion=e)),this._acquire(e.metallicRoughnessTextureId,(e=>this._textureMetallicRoughness=e))}dispose(){this._texture=(0,i.Gz)(this._texture),this._textureNormal=(0,i.Gz)(this._textureNormal),this._textureEmissive=(0,i.Gz)(this._textureEmissive),this._textureOcclusion=(0,i.Gz)(this._textureOcclusion),this._textureMetallicRoughness=(0,i.Gz)(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return 0===this._numLoading?o.Am.LOADED:o.Am.LOADING}get textureBindParameters(){return new c(null!=this._texture?this._texture.glTexture:null,null!=this._textureNormal?this._textureNormal.glTexture:null,null!=this._textureEmissive?this._textureEmissive.glTexture:null,null!=this._textureOcclusion?this._textureOcclusion.glTexture:null,null!=this._textureMetallicRoughness?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){null!=this._texture&&e===this._texture.id||(this._texture=(0,i.Gz)(this._texture),this._textureId=e,this._acquire(this._textureId,(e=>this._texture=e)))}_acquire(e,t){if(null==e)return void t(null);const n=this._textures.acquire(e);if((0,r.$X)(n))return++this._numLoading,void n.then((e=>{if(this._disposed)return(0,i.Gz)(e),void t(null);t(e)})).finally((()=>--this._numLoading));t(n)}}class c extends s.Y{constructor(e=null,t=null,n=null,i=null,r=null,s,o){super(),this.texture=e,this.textureNormal=t,this.textureEmissive=n,this.textureOcclusion=i,this.textureMetallicRoughness=r,this.scale=s,this.normalTextureTransformMatrix=o}}},40321:function(e,t,n){"use strict";n.d(t,{V:function(){return S}});var i=n(39714),r=n(20551),s=n(37819),o=n(24540);function a(e){if(e.length<o.y9)return Array.from(e);if((0,o.cy)(e))return Float64Array.from(e);if(!("BYTES_PER_ELEMENT"in e))return Array.from(e);switch(e.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(e);case 2:return(0,o.jq)(e)?Uint16Array.from(e):Int16Array.from(e);case 4:return Float32Array.from(e);default:return Float64Array.from(e)}}var l=n(54407),c=n(7187),u=n(32501),h=n(90553);class d{constructor(e,t,n){this.primitiveIndices=e,this._numIndexPerPrimitive=t,this.position=n,this._children=void 0,(0,h.vA)(e.length>=1),(0,h.vA)(3===n.size||4===n.size);const{data:i,size:s,indices:o}=n;(0,h.vA)(o.length%this._numIndexPerPrimitive==0),(0,h.vA)(o.length>=e.length*this._numIndexPerPrimitive);const a=e.length;let l=s*o[this._numIndexPerPrimitive*e[0]];p.clear(),p.push(l);const c=(0,u.fA)(i[l],i[l+1],i[l+2]),d=(0,u.o8)(c);for(let t=0;t<a;++t){const n=this._numIndexPerPrimitive*e[t];for(let e=0;e<this._numIndexPerPrimitive;++e){l=s*o[n+e],p.push(l);let t=i[l];c[0]=Math.min(t,c[0]),d[0]=Math.max(t,d[0]),t=i[l+1],c[1]=Math.min(t,c[1]),d[1]=Math.max(t,d[1]),t=i[l+2],c[2]=Math.min(t,c[2]),d[2]=Math.max(t,d[2])}}this.bbMin=c,this.bbMax=d;const f=(0,r.o)((0,u.vt)(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(d[0]-c[0],d[1]-c[1]),d[2]-c[2]);let m=this.radius*this.radius;for(let e=0;e<p.length;++e){l=p.at(e);const t=i[l]-f[0],n=i[l+1]-f[1],r=i[l+2]-f[2],s=t*t+n*n+r*r;if(s<=m)continue;const o=Math.sqrt(s),a=.5*(o-this.radius);this.radius=this.radius+a,m=this.radius*this.radius;const c=a/o;f[0]+=t*c,f[1]+=n*c,f[2]+=r*c}this.center=f,p.clear()}getChildren(){if(this._children||(0,r.a)(this.bbMin,this.bbMax)<=1)return this._children;const e=(0,r.o)((0,u.vt)(),this.bbMin,this.bbMax,.5),t=this.primitiveIndices.length,n=new Uint8Array(t),i=new Array(8);for(let e=0;e<8;++e)i[e]=0;const{data:s,size:o,indices:a}=this.position;for(let r=0;r<t;++r){let t=0;const l=this._numIndexPerPrimitive*this.primitiveIndices[r];let c=o*a[l],u=s[c],h=s[c+1],d=s[c+2];for(let e=1;e<this._numIndexPerPrimitive;++e){c=o*a[l+e];const t=s[c],n=s[c+1],i=s[c+2];t<u&&(u=t),n<h&&(h=n),i<d&&(d=i)}u<e[0]&&(t|=1),h<e[1]&&(t|=2),d<e[2]&&(t|=4),n[r]=t,++i[t]}let l=0;for(let e=0;e<8;++e)i[e]>0&&++l;if(l<2)return;const c=new Array(8);for(let e=0;e<8;++e)c[e]=i[e]>0?new Uint32Array(i[e]):void 0;for(let e=0;e<8;++e)i[e]=0;for(let e=0;e<t;++e){const t=n[e];c[t][i[t]++]=this.primitiveIndices[e]}this._children=new Array;for(let e=0;e<8;++e)void 0!==c[e]&&this._children.push(new d(c[e],this._numIndexPerPrimitive,this.position));return this._children}static prune(){p.prune()}}const p=new c.A({deallocator:null});var f=n(48015),m=n(40359),g=n(67496);const _=(0,u.vt)(),v=(0,u.vt)(),y=(0,u.vt)(),b=(0,u.vt)();var T=n(84321),E=n(65839),x=n(84738);class S extends f.J{constructor(e,t,n=null,i=m.X.Mesh,r=null,o=-1){super(),this.material=e,this.mapPositions=n,this.type=i,this.objectAndLayerIdColor=r,this.edgeIndicesLength=o,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(const[e,n]of t)this._attributes.set(e,{...n,indices:(0,s.Dg)(n.indices)}),e===E.r.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(e).indices.length:this.edgeIndicesLength)}instantiate(e={}){const t=new S(e.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach(((e,n)=>{e.exclusive=!1,t._attributes.set(n,e)})),t._boundingInfo=this._boundingInfo,t.transformation=e.transformation||this.transformation,t}get attributes(){return this._attributes}getMutableAttribute(e){let t=this._attributes.get(e);return t&&!t.exclusive&&(t={...t,exclusive:!0,data:a(t.data)},this._attributes.set(e,t)),t}setAttributeData(e,t){const n=this._attributes.get(e);n&&this._attributes.set(e,{...n,exclusive:!0,data:t})}get indexCount(){const e=this._attributes.values().next().value.indices;return e?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===m.X.Mesh?this._computeAttachmentOriginTriangles(e):this.type===m.X.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(null!=this._transformation&&(0,r.h)(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){return function(e,t){if(!e)return!1;const{size:n,data:i,indices:s}=e;(0,r.s)(t,0,0,0),(0,r.s)(b,0,0,0);let o=0,a=0;for(let e=0;e<s.length-2;e+=3){const l=s[e]*n,c=s[e+1]*n,u=s[e+2]*n;(0,r.s)(_,i[l],i[l+1],i[l+2]),(0,r.s)(v,i[c],i[c+1],i[c+2]),(0,r.s)(y,i[u],i[u+1],i[u+2]);const h=(0,g.Q7)(_,v,y);h?((0,r.g)(_,_,v),(0,r.g)(_,_,y),(0,r.j)(_,_,1/3*h),(0,r.g)(t,t,_),o+=h):((0,r.g)(b,b,_),(0,r.g)(b,b,v),(0,r.g)(b,b,y),a+=3)}return!(0===a&&0===o||(0!==o?((0,r.j)(t,t,1/o),0):0===a||((0,r.j)(t,b,1/a),0)))}(this.attributes.get(E.r.POSITION),e)}_computeAttachmentOriginLines(e){const t=this.attributes.get(E.r.POSITION);return function(e,t,n){if(!e)return!1;(0,r.s)(n,0,0,0),(0,r.s)(b,0,0,0);let i=0,s=0;const{size:o,data:a,indices:l}=e,c=l.length-1,u=c+(t?2:0);for(let e=0;e<u;e+=2){const t=e<c?e+1:0,u=l[e<c?e:c]*o,h=l[t]*o;_[0]=a[u],_[1]=a[u+1],_[2]=a[u+2],v[0]=a[h],v[1]=a[h+1],v[2]=a[h+2],(0,r.j)(_,(0,r.g)(_,_,v),.5);const d=(0,r.F)(_,v);d>0?((0,r.g)(n,n,(0,r.j)(_,_,d)),i+=d):0===i&&((0,r.g)(b,b,_),s++)}return 0!==i?((0,r.j)(n,n,1/i),!0):0!==s&&((0,r.j)(n,b,1/s),!0)}(t,function(e,t){return!(!("isClosed"in e)||!e.isClosed)&&t.indices.length>2}(this.material.parameters,t),e)}_computeAttachmentOriginPoints(e){return function(e,t){if(!e)return!1;const{size:n,data:i,indices:s}=e;(0,r.s)(t,0,0,0);let o=-1,a=0;for(let e=0;e<s.length;e++){const r=s[e]*n;o!==r&&(t[0]+=i[r],t[1]+=i[r+1],t[2]+=i[r+2],a++),o=r}return a>1&&(0,r.j)(t,t,1/a),a>0}(this.attributes.get(E.r.POSITION),e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.attributes.get(E.r.POSITION);if(!e||0===e.indices.length)return null;const t=this.type===m.X.Mesh?3:1;(0,h.vA)(e.indices.length%t==0,"Indexing error: "+e.indices.length+" not divisible by "+t);const n=(0,s.tM)(e.indices.length/t);return new d(n,t,e)}get transformation(){return this._transformation??i.zK}set transformation(e){this._transformation=e&&e!==i.zK?(0,i.o8)(e):null}addHighlight(){const e=new T.X(l.Mg.Highlight);return this.highlights=(0,x.Ci)(this.highlights,e),e}removeHighlight(e){this.highlights=(0,x.PC)(this.highlights,e)}}},8470:function(e,t,n){"use strict";n.d(t,{zC:function(){return ie},C1:function(){return w},EE:function(){return Y},nW:function(){return K},td:function(){return C},_B:function(){return te},Nq:function(){return J},DJ:function(){return W},uX:function(){return Z},Z8:function(){return ee},CM:function(){return $},Gj:function(){return X},Ho:function(){return B},Nb:function(){return Q},Xl:function(){return se},xh:function(){return ne}});var i,r=n(1932),s=n(20551),o=n(43274),a=n(32501),l=n(50240),c=n(5047),u=n(37819),h=n(5596),d=n(79578),p=n(14905);!function(e){e.length=function(e,t){const n=e[t],i=e[t+1],r=e[t+2];return Math.sqrt(n*n+i*i+r*r)},e.normalize=function(e,t){const n=e[t],i=e[t+1],r=e[t+2],s=1/Math.sqrt(n*n+i*i+r*r);e[t]*=s,e[t+1]*=s,e[t+2]*=s},e.scale=function(e,t,n){e[t]*=n,e[t+1]*=n,e[t+2]*=n},e.add=function(e,t,n,i,r,s=t){(r=r||e)[s]=e[t]+n[i],r[s+1]=e[t+1]+n[i+1],r[s+2]=e[t+2]+n[i+2]},e.subtract=function(e,t,n,i,r,s=t){(r=r||e)[s]=e[t]-n[i],r[s+1]=e[t+1]-n[i+1],r[s+2]=e[t+2]-n[i+2]}}(i||(i={}));var f=n(40359),m=n(40321),g=n(90553),_=n(65839);const v=i,y=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],b=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],T=[0,0,1,0,1,1,0,1],E=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],x=new Array(36);for(let e=0;e<6;e++)for(let t=0;t<6;t++)x[6*e+t]=e;const S=new Array(36);for(let e=0;e<6;e++)S[6*e]=0,S[6*e+1]=1,S[6*e+2]=2,S[6*e+3]=2,S[6*e+4]=3,S[6*e+5]=0;function w(e,t){Array.isArray(t)||(t=[t,t,t]);const n=new Array(24);for(let e=0;e<8;e++)n[3*e]=y[e][0]*t[0],n[3*e+1]=y[e][1]*t[1],n[3*e+2]=y[e][2]*t[2];return new m.V(e,[[_.r.POSITION,new p.n(n,E,3,!0)],[_.r.NORMAL,new p.n(b,x,3)],[_.r.UV0,new p.n(T,S,2)]])}const A=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],M=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],O=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],R=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function C(e,t){Array.isArray(t)||(t=[t,t,t]);const n=new Array(18);for(let e=0;e<6;e++)n[3*e]=A[e][0]*t[0],n[3*e+1]=A[e][1]*t[1],n[3*e+2]=A[e][2]*t[2];return new m.V(e,[[_.r.POSITION,new p.n(n,O,3,!0)],[_.r.NORMAL,new p.n(M,R,3)]])}const I=(0,o.fA)(-.5,0,-.5),P=(0,o.fA)(.5,0,-.5),D=(0,o.fA)(0,0,.5),L=(0,o.fA)(0,.5,0),N=(0,o.vt)(),F=(0,o.vt)(),z=(0,o.vt)(),V=(0,o.vt)(),H=(0,o.vt)();(0,s.f)(N,I,L),(0,s.f)(F,I,P),(0,s.b)(z,N,F),(0,s.n)(z,z),(0,s.f)(N,P,L),(0,s.f)(F,P,D),(0,s.b)(V,N,F),(0,s.n)(V,V),(0,s.f)(N,D,L),(0,s.f)(F,D,I),(0,s.b)(H,N,F),(0,s.n)(H,H);const U=[I,P,D,L],k=[0,-1,0,z[0],z[1],z[2],V[0],V[1],V[2],H[0],H[1],H[2]],j=[0,1,2,3,1,0,3,2,1,3,0,2],G=[0,0,0,1,1,1,2,2,2,3,3,3];function B(e,t){Array.isArray(t)||(t=[t,t,t]);const n=new Array(12);for(let e=0;e<4;e++)n[3*e]=U[e][0]*t[0],n[3*e+1]=U[e][1]*t[1],n[3*e+2]=U[e][2]*t[2];return new m.V(e,[[_.r.POSITION,new p.n(n,j,3,!0)],[_.r.NORMAL,new p.n(k,G,3)]])}function $(e,t,n,i,r={uv:!0}){const s=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,h=Math.max(3,Math.floor(n)),d=Math.max(2,Math.floor(i)),f=(h+1)*(d+1),g=(0,c.oe)(3*f),v=(0,c.oe)(3*f),y=(0,c.oe)(2*f),b=[];let T=0;for(let e=0;e<=d;e++){const n=[],i=e/d,r=a+i*l,c=Math.cos(r);for(let e=0;e<=h;e++){const a=e/h,l=s+a*o,u=Math.cos(l)*c,d=Math.sin(r),p=-Math.sin(l)*c;g[3*T]=u*t,g[3*T+1]=d*t,g[3*T+2]=p*t,v[3*T]=u,v[3*T+1]=d,v[3*T+2]=p,y[2*T]=a,y[2*T+1]=i,n.push(T),++T}b.push(n)}const E=new Array;for(let e=0;e<d;e++)for(let t=0;t<h;t++){const n=b[e][t],i=b[e][t+1],r=b[e+1][t+1],s=b[e+1][t];0===e?(E.push(n),E.push(r),E.push(s)):e===d-1?(E.push(n),E.push(i),E.push(r)):(E.push(n),E.push(i),E.push(r),E.push(r),E.push(s),E.push(n))}const x=[[_.r.POSITION,new p.n(g,E,3,!0)],[_.r.NORMAL,new p.n(v,E,3,!0)]];return r.uv&&x.push([_.r.UV0,new p.n(y,E,2,!0)]),r.offset&&(x[0][0]=_.r.OFFSET,x.push([_.r.POSITION,new p.n(Float64Array.from(r.offset),(0,u.EH)(E.length),3,!0)])),new m.V(e,x)}function Z(e,t,n,i){const r=function(e,t,n){const i=e;let r,s;if(n)r=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],s=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const e=i*(1+Math.sqrt(5))/2;r=[-i,e,0,i,e,0,-i,-e,0,i,-e,0,0,-i,e,0,i,e,0,-i,-e,0,i,-e,e,0,-i,e,0,i,-e,0,-i,-e,0,i],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let t=0;t<r.length;t+=3)v.scale(r,t,e/v.length(r,t));let o={};function a(t,n){t>n&&([t,n]=[n,t]);const i=t.toString()+"."+n.toString();if(o[i])return o[i];let s=r.length;return r.length+=3,v.add(r,3*t,r,3*n,r,s),v.scale(r,s,e/v.length(r,s)),s/=3,o[i]=s,s}for(let e=0;e<t;e++){const e=s.length,t=new Array(4*e);for(let n=0;n<e;n+=3){const e=s[n],i=s[n+1],r=s[n+2],o=a(e,i),l=a(i,r),c=a(r,e),u=4*n;t[u]=e,t[u+1]=o,t[u+2]=c,t[u+3]=i,t[u+4]=l,t[u+5]=o,t[u+6]=r,t[u+7]=c,t[u+8]=l,t[u+9]=o,t[u+10]=l,t[u+11]=c}s=t,o={}}const l=(0,c.Wz)(r);for(let e=0;e<l.length;e+=3)v.normalize(l,e);return[[_.r.POSITION,new p.n((0,c.Wz)(r),s,3,!0)],[_.r.NORMAL,new p.n(l,s,3,!0)]]}(t,n,i);return new m.V(e,r)}function W(e,t,n,i,s,o,l,c,h=null){const d=n?(0,a.o8)(n):(0,a.vt)(),g=t?(0,a.o8)(t):(0,a.fA)(0,0,1);l??=(0,r.vt)();const v=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],y=null!=s&&2===s.length?s:[1,1],b=(0,u.EH)(1),T=[[_.r.POSITION,new p.n(d,b,3,!0)],[_.r.NORMAL,new p.n(g,b,3,!0)],[_.r.UV0,new p.n(l,b,l.length)],[_.r.COLOR,new p.n(v,b,4,!0)],[_.r.SIZE,new p.n(y,b,2)]];if(null!=o&&(o=[o[0],o[1],o[2],o[3]],T.push([_.r.CENTEROFFSETANDDISTANCE,new p.n(o,b,4)])),c){const e=[c[0],c[1],c[2],c[3]];T.push([_.r.FEATUREATTRIBUTE,new p.n(e,b,4)])}return new m.V(e,T,null,f.X.Point,h)}const q=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function X(e,t=q){const n=new Array(12);for(let e=0;e<4;e++)for(let i=0;i<3;i++)n[3*e+i]=t[e][i];const i=[0,1,2,2,3,0],r=[0,0,0,0,0,0],s=[[_.r.POSITION,new p.n(n,i,3,!0)],[_.r.NORMAL,new p.n([0,0,1],r,3,!0)],[_.r.UV0,new p.n([0,0,1,0,1,1,0,1],i,2,!0)],[_.r.COLOR,new p.n([255,255,255,255],r,4,!0)]];return new m.V(e,s)}function Y(e,t,n,i,r,s=!0,a=!0){let l=0;const u=n,h=t;let d=(0,o.fA)(0,l,0),f=(0,o.fA)(0,l+h,0),g=(0,o.fA)(0,-1,0),v=(0,o.fA)(0,1,0);r&&(l=h,f=(0,o.fA)(0,0,0),d=(0,o.fA)(0,l,0),g=(0,o.fA)(0,1,0),v=(0,o.fA)(0,-1,0));const y=[f,d],b=[g,v],T=i+2,E=Math.sqrt(h*h+u*u);if(r)for(let e=i-1;e>=0;e--){const t=e*(2*Math.PI/i),n=(0,o.fA)(Math.cos(t)*u,l,Math.sin(t)*u);y.push(n);const r=(0,o.fA)(h*Math.cos(t)/E,-u/E,h*Math.sin(t)/E);b.push(r)}else for(let e=0;e<i;e++){const t=e*(2*Math.PI/i),n=(0,o.fA)(Math.cos(t)*u,l,Math.sin(t)*u);y.push(n);const r=(0,o.fA)(h*Math.cos(t)/E,u/E,h*Math.sin(t)/E);b.push(r)}const x=new Array,S=new Array;if(s){for(let e=3;e<y.length;e++)x.push(1),x.push(e-1),x.push(e),S.push(0),S.push(0),S.push(0);x.push(y.length-1),x.push(2),x.push(1),S.push(0),S.push(0),S.push(0)}if(a){for(let e=3;e<y.length;e++)x.push(e),x.push(e-1),x.push(0),S.push(e),S.push(e-1),S.push(1);x.push(0),x.push(2),x.push(y.length-1),S.push(1),S.push(2),S.push(b.length-1)}const w=(0,c.oe)(3*T);for(let e=0;e<T;e++)w[3*e]=y[e][0],w[3*e+1]=y[e][1],w[3*e+2]=y[e][2];const A=(0,c.oe)(3*T);for(let e=0;e<T;e++)A[3*e]=b[e][0],A[3*e+1]=b[e][1],A[3*e+2]=b[e][2];const M=[[_.r.POSITION,new p.n(w,x,3,!0)],[_.r.NORMAL,new p.n(A,S,3,!0)]];return new m.V(e,M)}function K(e,t,n,i,r,a,l){const u=r?(0,o.o8)(r):(0,o.fA)(1,0,0),h=a?(0,o.o8)(a):(0,o.fA)(0,0,0);l??=!0;const d=(0,o.vt)();(0,s.n)(d,u);const f=(0,o.vt)();(0,s.j)(f,d,Math.abs(t));const g=(0,o.vt)();(0,s.j)(g,f,-.5),(0,s.g)(g,g,h);const v=(0,o.fA)(0,1,0);Math.abs(1-(0,s.m)(d,v))<.2&&(0,s.s)(v,0,0,1);const y=(0,o.vt)();(0,s.b)(y,d,v),(0,s.n)(y,y),(0,s.b)(v,y,d);const b=2*i+(l?2:0),T=i+(l?2:0),E=(0,c.oe)(3*b),x=(0,c.oe)(3*T),S=(0,c.oe)(2*b),w=new Array(3*i*(l?4:2)),A=new Array(3*i*(l?4:2));l&&(E[3*(b-2)]=g[0],E[3*(b-2)+1]=g[1],E[3*(b-2)+2]=g[2],S[2*(b-2)]=0,S[2*(b-2)+1]=0,E[3*(b-1)]=E[3*(b-2)]+f[0],E[3*(b-1)+1]=E[3*(b-2)+1]+f[1],E[3*(b-1)+2]=E[3*(b-2)+2]+f[2],S[2*(b-1)]=1,S[2*(b-1)+1]=1,x[3*(T-2)]=-d[0],x[3*(T-2)+1]=-d[1],x[3*(T-2)+2]=-d[2],x[3*(T-1)]=d[0],x[3*(T-1)+1]=d[1],x[3*(T-1)+2]=d[2]);const M=(e,t,n)=>{w[e]=t,A[e]=n};let O=0;const R=(0,o.vt)(),C=(0,o.vt)();for(let e=0;e<i;e++){const t=e*(2*Math.PI/i);(0,s.j)(R,v,Math.sin(t)),(0,s.j)(C,y,Math.cos(t)),(0,s.g)(R,R,C),x[3*e]=R[0],x[3*e+1]=R[1],x[3*e+2]=R[2],(0,s.j)(R,R,n),(0,s.g)(R,R,g),E[3*e]=R[0],E[3*e+1]=R[1],E[3*e+2]=R[2],S[2*e]=e/i,S[2*e+1]=0,E[3*(e+i)]=E[3*e]+f[0],E[3*(e+i)+1]=E[3*e+1]+f[1],E[3*(e+i)+2]=E[3*e+2]+f[2],S[2*(e+i)]=e/i,S[2*e+1]=1;const r=(e+1)%i;M(O++,e,e),M(O++,e+i,e),M(O++,r,r),M(O++,r,r),M(O++,e+i,e),M(O++,r+i,r)}if(l){for(let e=0;e<i;e++){const t=(e+1)%i;M(O++,b-2,T-2),M(O++,e,T-2),M(O++,t,T-2)}for(let e=0;e<i;e++){const t=(e+1)%i;M(O++,e+i,T-1),M(O++,b-1,T-1),M(O++,t+i,T-1)}}const I=[[_.r.POSITION,new p.n(E,w,3,!0)],[_.r.NORMAL,new p.n(x,A,3,!0)],[_.r.UV0,new p.n(S,w,2,!0)]];return new m.V(e,I)}function Q(e,t,n,i,r,s){i=i||10,r=null==r||r,(0,g.vA)(t.length>1);const o=[],a=[];for(let e=0;e<i;e++){o.push([0,-e-1,-(e+1)%i-1]);const t=e/i*2*Math.PI;a.push([Math.cos(t)*n,Math.sin(t)*n])}return J(e,a,t,[[0,0,0]],o,r,s)}function J(e,t,n,i,r,l,u=(0,o.fA)(0,0,0)){const f=t.length,g=(0,c.oe)(n.length*f*3+(6*i.length||0)),v=(0,c.oe)(n.length*f*3+(i?6:0)),y=new Array,b=new Array;let T=0,E=0;const x=(0,a.vt)(),S=(0,a.vt)(),w=(0,a.vt)(),A=(0,a.vt)(),M=(0,a.vt)(),O=(0,a.vt)(),R=(0,a.vt)(),C=(0,a.vt)(),I=(0,a.vt)(),P=(0,a.vt)(),D=(0,a.vt)(),L=(0,a.vt)(),N=(0,a.vt)(),F=(0,h.vt)();(0,s.s)(I,0,1,0),(0,s.f)(S,n[1],n[0]),(0,s.n)(S,S),l?((0,s.g)(C,n[0],u),(0,s.n)(w,C)):(0,s.s)(w,0,0,1),se(S,w,I,I,M,w,oe),(0,s.c)(A,w),(0,s.c)(L,M);for(let e=0;e<i.length;e++)(0,s.j)(O,M,i[e][0]),(0,s.j)(C,w,i[e][2]),(0,s.g)(O,O,C),(0,s.g)(O,O,n[0]),g[T++]=O[0],g[T++]=O[1],g[T++]=O[2];v[E++]=-S[0],v[E++]=-S[1],v[E++]=-S[2];for(let e=0;e<r.length;e++)y.push(r[e][0]>0?r[e][0]:-r[e][0]-1+i.length),y.push(r[e][1]>0?r[e][1]:-r[e][1]-1+i.length),y.push(r[e][2]>0?r[e][2]:-r[e][2]-1+i.length),b.push(0),b.push(0),b.push(0);let z=i.length;const V=i.length-1;for(let e=0;e<n.length;e++){let i=!1;e>0&&((0,s.c)(x,S),e<n.length-1?((0,s.f)(S,n[e+1],n[e]),(0,s.n)(S,S)):i=!0,(0,s.g)(P,x,S),(0,s.n)(P,P),(0,s.g)(D,n[e-1],A),(0,h.O_)(n[e],P,F),(0,h.Ui)(F,(0,d.LV)(D,x),C)?((0,s.f)(C,C,n[e]),(0,s.n)(w,C),(0,s.b)(M,P,w),(0,s.n)(M,M)):se(P,A,L,I,M,w,oe),(0,s.c)(A,w),(0,s.c)(L,M)),l&&((0,s.g)(C,n[e],u),(0,s.n)(N,C));for(let r=0;r<f;r++)if((0,s.j)(O,M,t[r][0]),(0,s.j)(C,w,t[r][1]),(0,s.g)(O,O,C),(0,s.n)(R,O),v[E++]=R[0],v[E++]=R[1],v[E++]=R[2],(0,s.g)(O,O,n[e]),g[T++]=O[0],g[T++]=O[1],g[T++]=O[2],!i){const e=(r+1)%f;y.push(z+r),y.push(z+f+r),y.push(z+e),y.push(z+e),y.push(z+f+r),y.push(z+f+e);for(let e=0;e<6;e++){const t=y.length-6;b.push(y[t+e]-V)}}z+=f}const H=n[n.length-1];for(let e=0;e<i.length;e++)(0,s.j)(O,M,i[e][0]),(0,s.j)(C,w,i[e][1]),(0,s.g)(O,O,C),(0,s.g)(O,O,H),g[T++]=O[0],g[T++]=O[1],g[T++]=O[2];const U=E/3;v[E++]=S[0],v[E++]=S[1],v[E++]=S[2];const k=z-f;for(let e=0;e<r.length;e++)y.push(r[e][0]>=0?z+r[e][0]:-r[e][0]-1+k),y.push(r[e][2]>=0?z+r[e][2]:-r[e][2]-1+k),y.push(r[e][1]>=0?z+r[e][1]:-r[e][1]-1+k),b.push(U),b.push(U),b.push(U);const j=[[_.r.POSITION,new p.n(g,y,3,!0)],[_.r.NORMAL,new p.n(v,b,3,!0)]];return new m.V(e,j)}function ee(e,t,n,i){(0,g.vA)(t.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),(0,g.vA)(3===t[0].length,"createPolylineGeometry(): malformed vertex"),(0,g.vA)(null==n||n.length===t.length,"createPolylineGeometry: need same number of points and normals"),(0,g.vA)(null==n||3===n[0].length,"createPolylineGeometry(): malformed normal");const r=(0,l.jh)(3*t.length),s=new Array(2*(t.length-1));let o=0,a=0;for(let e=0;e<t.length;e++){for(let n=0;n<3;n++)r[o++]=t[e][n];e>0&&(s[a++]=e-1,s[a++]=e)}const h=[[_.r.POSITION,new p.n(r,s,3,!0)]];if(n){const e=(0,c.oe)(3*n.length);let i=0;for(let r=0;r<t.length;r++)for(let t=0;t<3;t++)e[i++]=n[r][t];h.push([_.r.NORMAL,new p.n(e,s,3,!0)])}return i&&h.push([_.r.COLOR,new p.n(i,(0,u.tM)(i.length/4),4)]),new m.V(e,h,null,f.X.Line)}function te(e,t,n,i,r,s=0){const o=new Array(18),a=[[-n,s,r/2],[i,s,r/2],[0,t+s,r/2],[-n,s,-r/2],[i,s,-r/2],[0,t+s,-r/2]];for(let e=0;e<6;e++)o[3*e]=a[e][0],o[3*e+1]=a[e][1],o[3*e+2]=a[e][2];return new m.V(e,[[_.r.POSITION,new p.n(o,[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5],3,!0)]])}function ne(e,t){const n=e.getMutableAttribute(_.r.POSITION).data;for(let e=0;e<n.length;e+=3){const i=n[e],r=n[e+1],o=n[e+2];(0,s.s)(ae,i,r,o),(0,s.h)(ae,ae,t),n[e]=ae[0],n[e+1]=ae[1],n[e+2]=ae[2]}}function ie(e,t=e){const n=e.attributes,i=n.get(_.r.POSITION).data,r=n.get(_.r.NORMAL).data;if(r){const e=t.getMutableAttribute(_.r.NORMAL).data;for(let t=0;t<r.length;t+=3){const n=r[t+1];e[t+1]=-r[t+2],e[t+2]=n}}if(i){const e=t.getMutableAttribute(_.r.POSITION).data;for(let t=0;t<i.length;t+=3){const n=i[t+1];e[t+1]=-i[t+2],e[t+2]=n}}}function re(e,t,n,i,r){return!(Math.abs((0,s.m)(t,e))>r||((0,s.b)(n,e,t),(0,s.n)(n,n),(0,s.b)(i,n,e),(0,s.n)(i,i),0))}function se(e,t,n,i,r,s,o){return re(e,t,r,s,o)||re(e,n,r,s,o)||re(e,i,r,s,o)}const oe=.99619469809,ae=(0,a.vt)()},19860:function(e,t,n){"use strict";n.d(t,{g:function(){return _}}),n(58941);var i=n(11231),r=n(20551),s=n(32501),o=n(41546),a=n(57617),l=n(14905),c=n(40359),u=n(40321),h=n(79068),d=n(10713),p=n(10228),f=n(65839),m=n(1296),g=n(65352);class _{constructor(e){this._originSR=e,this._rootOriginId="root/"+(0,i.c)(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const t=this._origins.get(this._rootOriginId);if(null==t){const t=p.Q.rootOrigin;if(null!=t)return this._origins.set(this._rootOriginId,(0,h.f)(t[0],t[1],t[2],this._rootOriginId)),this.getOrigin(e);const n=(0,h.f)(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,n),n}const n=this._gridSize,i=Math.round(e[0]/n),s=Math.round(e[1]/n),o=Math.round(e[2]/n),a=`${i}/${s}/${o}`;let l=this._origins.get(a);const c=.5*n;if((0,r.f)(v,e,t.vec3),v[0]=Math.abs(v[0]),v[1]=Math.abs(v[1]),v[2]=Math.abs(v[2]),v[0]<c&&v[1]<c&&v[2]<c){if(l){const t=Math.max(...v);if((0,r.f)(v,e,l.vec3),v[0]=Math.abs(v[0]),v[1]=Math.abs(v[1]),v[2]=Math.abs(v[2]),Math.max(...v)<t)return l}return t}return l||(l=(0,h.f)(i*n,s*n,o*n,a),this._origins.set(a,l)),l}_drawOriginBox(e,t=(0,o.fA)(1,1,0,1)){const n=window.view,i=n._stage,r=t.toString();if(!this._objects.has(r)){this._material=new g.W({width:2,color:t}),i.add(this._material);const e=new m.x(i,{pickable:!1}),n=new d.B({castShadow:!1});i.add(n),e.add(n),this._objects.set(r,n)}const s=this._objects.get(r),h=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],p=h.length,_=new Array(3*p),v=new Array,y=.5*this._gridSize;for(let t=0;t<p;t++)_[3*t]=e[0]+(1&h[t]?y:-y),_[3*t+1]=e[1]+(2&h[t]?y:-y),_[3*t+2]=e[2]+(4&h[t]?y:-y),t>0&&v.push(t-1,t);(0,a.projectBuffer)(_,this._originSR,0,_,n.renderSpatialReference,0,p);const b=new u.V(this._material,[[f.r.POSITION,new l.n(_,v,3,!0)]],null,c.X.Line);i.add(b),s.addGeometry(b)}get test(){}}const v=(0,s.vt)()},49845:function(e,t,n){"use strict";n.d(t,{G7:function(){return E},hz:function(){return v}});var i=n(73364),r=n(39714),s=n(20551),o=n(32501),a=n(33400),l=n(41546),c=n(79578),u=n(65420),h=n(38177),d=n(50456),p=n(59356),f=n(22323);const m=1e-5;class g{constructor(e){this.options=new h.H6,this._results=new y,this.transform=new f.dg,this.tolerance=m,this.verticalOffset=null,this._ray=(0,c.vt)(),this._rayEnd=(0,o.vt)(),this._rayBeginTransformed=(0,o.vt)(),this._rayEndTransformed=(0,o.vt)(),this.viewingMode=e??u.RT.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,t,n){this.resetWithRay((0,c.Cr)(e,t,this._ray),n)}resetWithRay(e,t){this.camera=t,e!==this._ray&&(0,c.C)(e,this._ray),0!==this.options.verticalOffset?this.viewingMode===u.RT.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,(0,s.g)(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,t,n,i,r){this.point=t,this.filterPredicate=i,this.tolerance=n??m;const s=(0,f.ou)(this.verticalOffset);if(e&&e.length>0){const t=r?e=>{r(e)&&this.intersectObject(e)}:e=>{this.intersectObject(e)};for(const n of e){const e=n.getSpatialQueryAccelerator?.();null!=e?(null!=s?e.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,t,s):e.forEachAlongRay(this._ray.origin,this._ray.direction,t),this.options.selectionMode&&this.options.hud&&e.forEachDegenerateObject(t)):n.objects.forAll((e=>t(e)))}}this.sortResults()}intersectObject(e){const t=e.geometries;if(!t)return;const n=e.effectiveTransformation,i=(0,f.ou)(this.verticalOffset);for(const o of t){if(!o.visible)continue;const{material:t,id:a}=o;this.transform.setAndInvalidateLazyTransforms(n,o.transformation),(0,s.h)(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),(0,s.h)(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;null!=i&&(i.objectTransform=this.transform),t.intersect(o,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,((t,n,i,s,o,c)=>{if(t>=0){if(null!=this.filterPredicate&&!this.filterPredicate(this._ray.origin,this._rayEnd,t))return;const u=s?this._results.hud:this._results,p=s?s=>{const l=new d.B$(e,a,i,c);s.set(h.dz.HUD,l,t,n,r.zK,o)}:r=>r.set(h.dz.OBJECT,{object:e,geometryId:a,triangleNr:i},t,n,l,o);if((null==u.min.drapedLayerOrder||o>=u.min.drapedLayerOrder)&&(null==u.min.dist||t<u.min.dist)&&p(u.min),this.options.store!==h.oH.MIN&&(null==u.max.drapedLayerOrder||o<u.max.drapedLayerOrder)&&(null==u.max.dist||t>u.max.dist)&&p(u.max),this.options.store===h.oH.ALL)if(s){const e=new T(this._ray);p(e),this._results.hud.all.push(e)}else{const e=new b(this._ray);p(e),this._results.all.push(e)}}}))}}sortResults(e=this._results.all){e.sort(((e,t)=>e.dist!==t.dist?(e.dist??0)-(t.dist??0):e.drapedLayerOrder!==t.drapedLayerOrder?_(e.drapedLayerOrder,t.drapedLayerOrder):_(e.drapedLayerGraphicOrder,t.drapedLayerGraphicOrder)))}}function _(e,t){return(t??-Number.MAX_VALUE)-(e??-Number.MAX_VALUE)}function v(e){return new g(e)}class y{constructor(){this.min=new b((0,c.vt)()),this.max=new b((0,c.vt)()),this.hud={min:new T((0,c.vt)()),max:new T((0,c.vt)()),all:new Array},this.ground=new b((0,c.vt)()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}}class b{get ray(){return this._ray}get distanceInRenderSpace(){return null!=this.dist?((0,s.j)(x,this.ray.direction,this.dist),(0,s.l)(x)):null}getIntersectionPoint(e){return!!(0,p.i3)(this)&&((0,s.j)(x,this.ray.direction,this.dist),(0,s.g)(e,this.ray.origin,x),!0)}getTransformedNormal(e){return(0,s.c)(S,this.normal),S[3]=0,(0,a.t)(S,S,this.transformation),(0,s.c)(e,S),(0,s.n)(e,e)}constructor(e){this.intersector=h.dz.OBJECT,this.normal=(0,o.vt)(),this.transformation=(0,r.vt)(),this._ray=(0,c.vt)(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=h.dz.OBJECT,(0,c.C)(e,this._ray)}set(e,t,n,a,l,c,u){this.intersector=e,this.dist=n,(0,s.c)(this.normal,a??o.Cb),(0,i.C)(this.transformation,l??r.zK),this.target=t,this.drapedLayerOrder=c,this.drapedLayerGraphicOrder=u}copy(e){(0,c.C)(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,(0,s.c)(this.normal,e.normal),(0,i.C)(this.transformation,e.transformation)}}class T extends b{constructor(){super(...arguments),this.intersector=h.dz.HUD}}function E(e){return new b(e)}const x=(0,o.vt)(),S=(0,l.vt)()},38177:function(e,t,n){"use strict";var i,r;n.d(t,{H6:function(){return s},dz:function(){return i},oH:function(){return r}}),function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL",e[e.TILES3D=8]="TILES3D"}(i||(i={}));class s{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=r.ALL,this.normalRequired=!0}}!function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"}(r||(r={}))},50456:function(e,t,n){"use strict";n.d(t,{B$:function(){return s},R6:function(){return a}});var i=n(32501);class r{constructor(e,t,n){this.object=e,this.geometryId=t,this.triangleNr=n}}class s extends r{constructor(e,t,n,r){super(e,t,n),this.center=null!=r?(0,i.o8)(r):null}}class o{constructor(e){this.layerUid=e}}class a extends o{constructor(e,t){super(e),this.graphicUid=t}}},79068:function(e,t,n){"use strict";n.d(t,{f:function(){return s}});var i=n(32501);class r{constructor(e,t){this.vec3=e,this.id=t}}function s(e,t,n,s){return new r((0,i.fA)(e,t,n),s)}},24100:function(e,t,n){"use strict";n.d(t,{im:function(){return p},m$:function(){return i},qA:function(){return f}});var i,r,s=n(32501),o=n(39506),a=n(97018),l=n(54407),c=n(48015),u=n(40359),h=n(40502),d=n(84887);class p extends c.J{constructor(e,t){super(),this.type=u.X.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._vertexAttributeLocations=h.D,this._pp0=(0,s.fA)(0,0,1),this._pp1=(0,s.fA)(0,0,0),this._parameters=(0,d.qu)(e,t),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e,t=!0){(0,d.MB)(this._parameters,e)&&(this.validateParameters(this._parameters),t&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bindParameters.decorations===l.ID.ON)&&!!(this.parameters.renderOccluded&e.renderOccludedMask)}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){this.repository?.materialChanged(this)}queryRenderOccludedState(e){return this.isVisible()&&this.parameters.renderOccluded===e}intersectDraped(e,t,n,i,r,s){return this._pp0[0]=this._pp1[0]=i[0],this._pp0[1]=this._pp1[1]=i[1],this.intersect(e,t,n,this._pp0,this._pp1,r)}}a.H,(r=i||(i={}))[r.None=0]="None",r[r.Occlude=1]="Occlude",r[r.Transparent=2]="Transparent",r[r.OccludeAndTransparent=4]="OccludeAndTransparent",r[r.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",r[r.Opaque=16]="Opaque";class f extends o.Y{constructor(){super(...arguments),this.renderOccluded=i.Occlude,this.isDecoration=!1}}},96253:function(e,t,n){"use strict";var i,r;n.d(t,{k:function(){return r},q:function(){return i}}),function(e){e[e.ADD=0]="ADD",e[e.UPDATE=1]="UPDATE",e[e.REMOVE=2]="REMOVE"}(i||(i={})),function(e){e[e.NONE=0]="NONE",e[e.VISIBILITY=1]="VISIBILITY",e[e.GEOMETRY=2]="GEOMETRY",e[e.TRANSFORMATION=4]="TRANSFORMATION",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.OCCLUDEE=16]="OCCLUDEE"}(r||(r={}))},10713:function(e,t,n){"use strict";n.d(t,{B:function(){return g}}),n(58941);var i=n(73364),r=n(39714),s=n(20551),o=n(32501),a=n(90599),l=n(76185),c=n(54407),u=n(48015),h=n(40359),d=n(84321),p=n(90553),f=n(65839),m=n(84738);class g extends u.J{get geometries(){return this._geometries}get transformation(){return this._transformation??r.zK}set transformation(e){this._transformation=(0,i.C)(this._transformation??(0,r.vt)(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(e){this._shaderTransformation=e?(0,i.C)(this._shaderTransformation??(0,r.vt)(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}constructor(e={}){super(),this.type=h.X.Object,this._shaderTransformation=null,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new _),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){(0,p.vA)(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._emit("geometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const t=this._geometries.splice(e,1)[0];t&&(this._emit("geometryRemoved",{object:this,geometry:t}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(e,t,n=!1){this._emit("attributesChanged",{object:this,geometry:e,attribute:t,sync:n}),(0,f.b)(t)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const e of this._geometries)e.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new d.X(c.Mg.MaskOccludee);for(const t of this._geometries)t.occludees=(0,m.Ci)(t.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const t of this._geometries)t.occludees=(0,m.PC)(t.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new d.X(c.Mg.Highlight);for(const t of this._geometries)t.highlights=(0,m.Ci)(t.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const t of this._geometries)t.highlights=(0,m.PC)(t.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,t){return(0,i.lw)(t,this.transformation,e.transformation)}getCombinedShaderTransformation(e,t=(0,r.vt)()){return(0,i.lw)(t,this.effectiveTransformation,e.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new v,this._validateBoundingVolume(this._bvWorldSpace,S.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new v,this._validateBoundingVolume(this._bvObjectSpace,S.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,t){const n=t===S.ObjectSpace;for(const t of this._geometries){const i=t.boundingInfo;i&&y(i,e,n?t.transformation:this.getCombinedShaderTransformation(t))}(0,s.o)((0,a.g)(e.bounds),e.min,e.max,.5);for(const t of this._geometries){const i=t.boundingInfo;if(null==i)continue;const r=n?t.transformation:this.getCombinedShaderTransformation(t),o=(0,l.hG)(r);(0,s.h)(x,i.center,r);const c=(0,s.p)(x,(0,a.g)(e.bounds)),u=i.radius*o;e.bounds[3]=Math.max(e.bounds[3],c+u)}}_invalidateBoundingVolume(){const e=this._bvWorldSpace?.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,t){this._parentLayer&&this._parentLayer.events.emit(e,t)}get test(){}}class _{constructor(){this.min=(0,o.fA)(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=(0,o.fA)(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class v extends _{constructor(){super(...arguments),this.bounds=(0,a.c)()}}function y(e,t,n){const r=e.bbMin,o=e.bbMax;if((0,i.tZ)(n)){const e=(0,s.s)(b,n[12],n[13],n[14]);(0,s.g)(T,r,e),(0,s.g)(E,o,e);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],T[e]),t.max[e]=Math.max(t.max[e],E[e])}else if((0,s.h)(T,r,n),(0,s.e)(r,o))for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],T[e]),t.max[e]=Math.max(t.max[e],T[e]);else{(0,s.h)(E,o,n);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],T[e],E[e]),t.max[e]=Math.max(t.max[e],T[e],E[e]);for(let e=0;e<3;++e){(0,s.c)(T,r),(0,s.c)(E,o),T[e]=o[e],E[e]=r[e],(0,s.h)(T,T,n),(0,s.h)(E,E,n);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],T[e],E[e]),t.max[e]=Math.max(t.max[e],T[e],E[e])}}}const b=(0,o.vt)(),T=(0,o.vt)(),E=(0,o.vt)(),x=(0,o.vt)();var S,w;(w=S||(S={}))[w.WorldSpace=0]="WorldSpace",w[w.ObjectSpace=1]="ObjectSpace"},84321:function(e,t,n){"use strict";n.d(t,{X:function(){return r}});var i=n(11231);class r{constructor(e){this.channel=e,this.id=(0,i.c)()}}},35363:function(e,t,n){"use strict";n.d(t,{A:function(){return G}});var i,r,s=n(56996),o=n(7187),a=n(20551),l=n(32501),c=n(69508),u=n(79578),h=n(90599),d=n(90553);class p{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,t){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new f,this._objectCount=0,t&&(void 0!==t.maximumObjectsPerNode&&(this._maximumObjectsPerNode=t.maximumObjectsPerNode),void 0!==t.maximumDepth&&(this._maximumDepth=t.maximumDepth))}destroy(){this._degenerateObjects.clear(),f.clearPool(),C[0]=null,N.prune(),k.prune()}add(e,t=e.length){this._objectCount+=t,this._grow(e,t);const n=f.acquire();for(let i=0;i<t;i++){const t=e[i];this._isDegenerate(t)?this._degenerateObjects.add(t):(n.init(this._root),this._add(t,n))}f.release(n)}remove(e,t=null){this._objectCount-=e.length;const n=f.acquire();for(const i of e){const e=t??(0,h.a)(this.objectToBoundingSphere(i),F);A(e[3])?(n.init(this._root),_(i,e,n)):this._degenerateObjects.delete(i)}f.release(n),this._shrink()}update(e,t){if(!A(t[3])&&this._isDegenerate(e))return;const n=function(e){return C[0]=e,C}(e);this.remove(n,t),this.add(n)}forEachAlongRay(e,t,n){const i=(0,u.LV)(e,t);m(this._root,(e=>{if(!function(e,t){return E((0,h.g)(t.bounds),2*-t.halfSize,D),E((0,h.g)(t.bounds),2*t.halfSize,L),(0,d.O_)(e.origin,e.direction,D,L)}(i,e))return!1;const t=e.node;return t.terminals.forAll((e=>{this._intersectsObject(i,e)&&n(e)})),null!==t.residents&&t.residents.forAll((e=>{this._intersectsObject(i,e)&&n(e)})),!0}))}forEachAlongRayWithVerticalOffset(e,t,n,i){const r=(0,u.LV)(e,t);m(this._root,(e=>{if(!function(e,t,n){return E((0,h.g)(t.bounds),2*-t.halfSize,D),E((0,h.g)(t.bounds),2*t.halfSize,L),n.applyToMinMax(D,L),(0,d.O_)(e.origin,e.direction,D,L)}(r,e,i))return!1;const t=e.node;return t.terminals.forAll((e=>{this._intersectsObjectWithOffset(r,e,i)&&n(e)})),null!==t.residents&&t.residents.forAll((e=>{this._intersectsObjectWithOffset(r,e,i)&&n(e)})),!0}))}forEach(e){m(this._root,(t=>{const n=t.node;return n.terminals.forAll(e),null!==n.residents&&n.residents.forAll(e),!0})),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,t,n,i=(()=>!0),r=1/0){let s=1/0,o=1/0,l=null;const u=S(e,t),d=a=>{if(--r,!i(a))return;const u=this.objectToBoundingSphere(a);if(!(0,c.m7)(n,u))return;const d=w(e,t,(0,h.g)(u)),p=d-u[3],f=d+u[3];p<s&&(s=p,o=f,l=a)};return g(this._root,(i=>{if(r<=0||!(0,c.m7)(n,i.bounds))return!1;if((0,a.j)(P,u,i.halfSize),(0,a.g)(P,P,(0,h.g)(i.bounds)),w(e,t,P)>o)return!1;const s=i.node;return s.terminals.forAll((e=>d(e))),null!==s.residents&&s.residents.forAll((e=>d(e))),!0}),e,t),l}forEachInDepthRange(e,t,n,i,r,s,o){let l=-1/0,u=1/0;const d={setRange:e=>{n===p.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,e.near),u=Math.min(u,e.far)):(l=Math.max(l,-e.far),u=Math.min(u,-e.near))}};d.setRange(i);const f=w(t,n,e),m=S(t,n),_=S(t,-n),v=e=>{if(!o(e))return;const i=this.objectToBoundingSphere(e),a=(0,h.g)(i),p=w(t,n,a)-f,m=p-i[3],g=p+i[3];m>u||g<l||!(0,c.m7)(s,i)||r(e,d)};g(this._root,(e=>{if(!(0,c.m7)(s,e.bounds))return!1;if((0,a.j)(P,m,e.halfSize),(0,a.g)(P,P,(0,h.g)(e.bounds)),w(t,n,P)-f>u)return!1;if((0,a.j)(P,_,e.halfSize),(0,a.g)(P,P,(0,h.g)(e.bounds)),w(t,n,P)-f<l)return!1;const i=e.node;return i.terminals.forAll((e=>v(e))),null!==i.residents&&i.residents.forAll((e=>v(e))),!0}),t,n)}forEachNode(e){m(this._root,(t=>e(t.node,t.bounds,t.halfSize,t.depth)))}forEachNeighbor(e,t){const n=(0,h.b)(t),i=(0,h.g)(t),r=t=>{const r=this.objectToBoundingSphere(t),s=(0,h.b)(r),o=n+s;return!((0,a.a)((0,h.g)(r),i)-o*o<=0)||e(t)};let s=!0;const o=e=>{s&&(s=r(e))};m(this._root,(e=>{const t=(0,h.b)(e.bounds),r=n+t;if((0,a.a)((0,h.g)(e.bounds),i)-r*r>0)return!1;const l=e.node;return l.terminals.forAll(o),s&&null!==l.residents&&l.residents.forAll(o),s})),s&&this.forEachDegenerateObject(o)}_intersectsObject(e,t){const n=this.objectToBoundingSphere(t);return!(n[3]>0)||(0,h.j)(n,e)}_intersectsObjectWithOffset(e,t,n){const i=this.objectToBoundingSphere(t);return!(i[3]>0)||(0,h.j)(n.applyToBoundingSphere(i),e)}_add(e,t){t.advanceTo(this.objectToBoundingSphere(e))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))}_split(e){const t=e.node.residents;e.node.residents=null;for(let n=0;n<t.length;n++){const i=f.acquire().init(e);this._add(t.at(n),i),f.release(i)}}_grow(e,t){if(0!==t&&(x(e,t,(e=>this.objectToBoundingSphere(e)),z),A(z[3])&&!this._fitsInsideTree(z)))if(y(this._root.node))(0,h.a)(z,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const e=this._rootBoundsForRootAsSubNode(z);this._placingRootViolatesMaxDepth(e)?this._rebuildTree(z,e):this._growRootAsSubNode(e),f.release(e)}}_rebuildTree(e,t){(0,a.c)((0,h.g)(V),(0,h.g)(t.bounds)),V[3]=t.halfSize,x([e,V],2,(e=>e),H);const n=f.acquire().init(this._root);this._root.initFrom(null,H,H[3]),this._root.increaseHalfSize(1.25),m(n,(e=>(this.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&this.add(e.node.residents.data,e.node.residents.length),!0))),f.release(n)}_placingRootViolatesMaxDepth(e){const t=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let n=0;return m(this._root,(e=>(n=Math.max(n,e.depth),n+t<=this._maximumDepth))),n+t>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const t=e[3],n=e;let i=-1/0;const r=this._root.bounds,s=this._root.halfSize;for(let e=0;e<3;e++){const o=r[e]-s-(n[e]-t),a=n[e]+t-(r[e]+s),l=Math.max(0,Math.ceil(o/(2*s))),c=Math.max(0,Math.ceil(a/(2*s)))+1,u=2**Math.ceil(Math.log(l+c)*Math.LOG2E);i=Math.max(i,u),U[e].min=l,U[e].max=c}for(let e=0;e<3;e++){let t=U[e].min,n=U[e].max;const o=(i-(t+n))/2;t+=Math.ceil(o),n+=Math.floor(o);const a=r[e]-s-t*s*2;I[e]=a+(n+t)*s}const o=i*s;return I[3]=o*R,f.acquire().initFrom(null,I,o,0)}_growRootAsSubNode(e){const t=this._root.node;(0,a.c)((0,h.g)(z),(0,h.g)(this._root.bounds)),z[3]=this._root.halfSize,this._root.init(e),e.advanceTo(z,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let e=null;const t=this._root.node.children;let n=0,i=0;for(;i<t.length&&null==e;)n=i++,e=t[n];for(;i<t.length;)if(t[i++])return-1;return n}_isDegenerate(e){return!A(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const t=this._root.bounds,n=this._root.halfSize;return e[3]<=n&&e[0]>=t[0]-n&&e[0]<=t[0]+n&&e[1]>=t[1]-n&&e[1]<=t[1]+n&&e[2]>=t[2]-n&&e[2]<=t[2]+n}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:t,_objectCount:n}=this,i=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:t,objectCount:n,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:i}}}_nodeToJSON(e){const t=e.children.map((e=>e?this._nodeToJSON(e):null)),n=e.residents?.map((e=>this.objectToBoundingSphere(e))),i=e.terminals?.map((e=>this.objectToBoundingSphere(e)));return{children:t,residents:n,terminals:i}}static fromJSON(e){const t=new p((e=>e),{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return t._objectCount=e.objectCount,t._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),t}}class f{constructor(){this.bounds=(0,h.c)(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,t,n,i=this.depth){return this.node=null!=e?e:f.createEmptyNode(),t&&(0,h.a)(t,this.bounds),this.halfSize=n,this.depth=i,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*R}advance(e){let t=this.node.children[e];t||(t=f.createEmptyNode(),this.node.children[e]=t),this.node=t,this.halfSize/=2,this.depth++;const n=M[e];return this.bounds[0]+=n[0]*this.halfSize,this.bounds[1]+=n[1]*this.halfSize,this.bounds[2]+=n[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,t,n=!1){for(;;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()){if(!n)return t&&t(this,-1),!1;this.node.residents=null}const i=this._childIndex(e);t&&t(this,i),this.advance(i)}}isLeaf(){return null!=this.node.residents}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const t=this.bounds;return(t[0]<e[0]?1:0)+(t[1]<e[1]?2:0)+(t[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new o.A({shrink:!0}),residents:new o.A({shrink:!0})}}static acquire(){return f._pool.acquire()}static release(e){f._pool.release(e)}static clearPool(){f._pool.prune()}}function m(e,t){let n=f.acquire().init(e);const i=[n];for(;0!==i.length;){if(n=i.pop(),t(n)&&!n.isLeaf())for(let e=0;e<n.node.children.length;e++)n.node.children[e]&&i.push(f.acquire().init(n).advance(e));f.release(n)}}function g(e,t,n,i=p.DepthOrder.FRONT_TO_BACK){let r=f.acquire().init(e);const s=[r];for(function(e,t,n){if(!k.length)for(let e=0;e<8;++e)k.push({index:0,distance:0});for(let n=0;n<8;++n){const i=M[n];k.data[n].index=n,k.data[n].distance=w(e,t,i)}k.sort(((e,t)=>e.distance-t.distance));for(let e=0;e<8;++e)n[e]=k.data[e].index}(n,i,j);0!==s.length;){if(r=s.pop(),t(r)&&!r.isLeaf())for(let e=7;e>=0;--e){const t=j[e];r.node.children[t]&&s.push(f.acquire().init(r).advance(t))}f.release(r)}}function _(e,t,n){N.clear();const i=n.advanceTo(t,((e,t)=>{N.push(e.node),N.push(t)}))?n.node.terminals:n.node.residents;if(i.removeUnordered(e),0===i.length)for(let e=N.length-2;e>=0&&v(N.data[e],N.data[e+1]);e-=2);}function v(e,t){return t>=0&&(e.children[t]=null),!!y(e)&&(null===e.residents&&(e.residents=new o.A({shrink:!0})),!0)}function y(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(let t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0}function b(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function T(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function E(e,t,n){n[0]=e[0]+t,n[1]=e[1]+t,n[2]=e[2]+t}function x(e,t,n,i){if(1===t){const t=n(e[0]);(0,h.a)(t,i)}else{D[0]=1/0,D[1]=1/0,D[2]=1/0,L[0]=-1/0,L[1]=-1/0,L[2]=-1/0;for(let i=0;i<t;i++){const t=n(e[i]);A(t[3])&&(b(D,t),T(L,t))}(0,a.o)((0,h.g)(i),D,L,.5),i[3]=Math.max(L[0]-D[0],L[1]-D[1],L[2]-D[2])/2}}function S(e,t){let n,i=1/0;for(let r=0;r<8;++r){const s=w(e,t,O[r]);s<i&&(i=s,n=O[r])}return n}function w(e,t,n){return t*(e[0]*n[0]+e[1]*n[1]+e[2]*n[2])}function A(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}f._pool=new s.A(f),i=p||(p={}),(r=i.DepthOrder||(i.DepthOrder={}))[r.FRONT_TO_BACK=1]="FRONT_TO_BACK",r[r.BACK_TO_FRONT=-1]="BACK_TO_FRONT";const M=[(0,l.fA)(-1,-1,-1),(0,l.fA)(1,-1,-1),(0,l.fA)(-1,1,-1),(0,l.fA)(1,1,-1),(0,l.fA)(-1,-1,1),(0,l.fA)(1,-1,1),(0,l.fA)(-1,1,1),(0,l.fA)(1,1,1)],O=[(0,l.fA)(-1,-1,-1),(0,l.fA)(-1,-1,1),(0,l.fA)(-1,1,-1),(0,l.fA)(-1,1,1),(0,l.fA)(1,-1,-1),(0,l.fA)(1,-1,1),(0,l.fA)(1,1,-1),(0,l.fA)(1,1,1)],R=Math.sqrt(3),C=[null],I=(0,h.c)(),P=(0,l.vt)(),D=(0,l.vt)(),L=(0,l.vt)(),N=new o.A,F=(0,h.c)(),z=(0,h.c)(),V=(0,h.c)(),H=(0,h.c)(),U=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],k=new o.A,j=[0,0,0,0,0,0,0,0],G=p},46921:function(e,t,n){"use strict";n.d(t,{K_:function(){return p},SE:function(){return h},V0:function(){return o},XO:function(){return c},aB:function(){return d},cl:function(){return f},ez:function(){return l},xt:function(){return u}});var i=n(55890),r=n(85456),s=n(57087);const o=(0,s.p3)(r.dn.SRC_ALPHA,r.dn.ONE,r.dn.ONE_MINUS_SRC_ALPHA,r.dn.ONE_MINUS_SRC_ALPHA),a=(0,s.p3)(r.dn.ONE,r.dn.ZERO,r.dn.ONE,r.dn.ONE_MINUS_SRC_ALPHA);function l(e){return e===i.y.FrontFace?null:a}function c(e){return e===i.y.FrontFace?s.kn:null}const u=5e5,h={factor:-1,units:-2};function d(e){return e?h:null}function p(e,t=r.MT.LESS){return e===i.y.NONE||e===i.y.FrontFace?t:r.MT.LEQUAL}function f(e){return e===i.y.ColorAlpha?{buffers:[r.Nm.COLOR_ATTACHMENT0,r.Nm.COLOR_ATTACHMENT1]}:null}},54101:function(e,t,n){"use strict";n.d(t,{B:function(){return s}});var i=n(7187),r=n(41835);class s{constructor(e,t,n){this._context=e,this._locations=n,this._textures=new Map,this._freeTextureUnits=new i.A({deallocator:null}),this._glProgram=e.programCache.acquire(t.generate("vertex"),t.generate("fragment"),n),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=t.generateBindPass(this),this.bindDraw=t.generateBindDraw(this),this._fragmentUniforms=(0,r.en)()?t.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(e,t){this._glProgram.setUniform1i(e,t?1:0)}setUniform1i(e,t){this._glProgram.setUniform1i(e,t)}setUniform1f(e,t){this._glProgram.setUniform1f(e,t)}setUniform2fv(e,t){this._glProgram.setUniform2fv(e,t)}setUniform3fv(e,t){this._glProgram.setUniform3fv(e,t)}setUniform4fv(e,t){this._glProgram.setUniform4fv(e,t)}setUniformMatrix3fv(e,t){this._glProgram.setUniformMatrix3fv(e,t)}setUniformMatrix4fv(e,t){this._glProgram.setUniformMatrix4fv(e,t)}setUniform1fv(e,t){this._glProgram.setUniform1fv(e,t)}setUniform1iv(e,t){this._glProgram.setUniform1iv(e,t)}setUniform2iv(e,t){this._glProgram.setUniform3iv(e,t)}setUniform3iv(e,t){this._glProgram.setUniform3iv(e,t)}setUniform4iv(e,t){this._glProgram.setUniform4iv(e,t)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,t){if(null==t?.glName){const t=this._textures.get(e);return t&&(this._context.bindTexture(null,t.unit),this._freeTextureUnit(t),this._textures.delete(e)),null}let n=this._textures.get(e);return null==n?(n=this._allocTextureUnit(t),this._textures.set(e,n)):n.texture=t,this._context.useProgram(this),this.setUniform1i(e,n.unit),this._context.bindTexture(t,n.unit),n.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach(((e,t)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(t,e.unit)})),this._fragmentUniforms?.forEach((e=>{"sampler2D"!==e.type&&"samplerCube"!==e.type||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)}))}_allocTextureUnit(e){return{texture:e,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}}},45079:function(e,t,n){"use strict";n.d(t,{JG:function(){return c},Uy:function(){return h},Wb:function(){return S},Z$:function(){return m}});var i=n(20551),r=n(32501),s=n(24761),o=n(40359),a=n(90553),l=n(65839);class c{constructor(e=!1,t=!0){this.isVerticalRay=e,this.normalRequired=t}}const u=(0,s.vt)();function h(e,t,n,r,s,u){if(!e.visible)return;const h=(0,i.z)(M,r,n),d=(e,t,n)=>{u(e,n,t,!1)},f=new c(!1,t.options.normalRequired);if(e.boundingInfo){(0,a.vA)(e.type===o.X.Mesh);const i=t.tolerance;p(e.boundingInfo,n,h,i,s,f,d)}else{const t=e.attributes.get(l.r.POSITION),i=t.indices;g(n,h,0,i.length/3,i,t.data,t.stride,s,f,d)}}const d=(0,r.vt)();function p(e,t,n,r,o,a,l){if(null==e)return;const c=function(e,t){return(0,i.s)(t,1/e[0],1/e[1],1/e[2])}(n,d);if((0,s.Ne)(u,e.bbMin),(0,s.vI)(u,e.bbMax),null!=o&&o.applyToAabb(u),S(u,t,c,r)){const{primitiveIndices:i,position:s}=e,c=i?i.length:s.indices.length/3;if(c>w){const i=e.getChildren();if(void 0!==i){for(const e of i)p(e,t,n,r,o,a,l);return}}!function(e,t,n,i,r,s,o,a,l,c,u){const h=e[0],d=e[1],p=e[2],m=t[0],g=t[1],_=t[2],{normalRequired:v}=c;for(let e=0;e<i;++e){const t=a[e],n=3*t,i=o*r[n];let c=s[i],y=s[i+1],T=s[i+2];const E=o*r[n+1];let x=s[E],S=s[E+1],w=s[E+2];const M=o*r[n+2];let O=s[M],R=s[M+1],C=s[M+2];null!=l&&([c,y,T]=l.applyToVertex(c,y,T,e),[x,S,w]=l.applyToVertex(x,S,w,e),[O,R,C]=l.applyToVertex(O,R,C,e));const I=x-c,P=S-y,D=w-T,L=O-c,N=R-y,F=C-T,z=g*F-N*_,V=_*L-F*m,H=m*N-L*g,U=I*z+P*V+D*H;if(Math.abs(U)<=A)continue;const k=h-c,j=d-y,G=p-T,B=k*z+j*V+G*H;if(U>0){if(B<0||B>U)continue}else if(B>0||B<U)continue;const $=j*D-P*G,Z=G*I-D*k,W=k*P-I*j,q=m*$+g*Z+_*W;if(U>0){if(q<0||B+q>U)continue}else if(q>0||B+q<U)continue;const X=(L*$+N*Z+F*W)/U;X>=0&&u(X,t,v?b(I,P,D,L,N,F,f):null)}}(t,n,0,c,s.indices,s.data,s.stride,i,o,a,l)}}const f=(0,r.vt)();function m(e,t,n,r,s,o,a,l,c){const{data:u,stride:h}=o;g(e,(0,i.z)(M,t,e),n,r,s,u,h,a,l,c)}function g(e,t,n,r,s,o,a,l,c,u){const h=t,d=O,p=Math.abs(h[0]),f=Math.abs(h[1]),m=Math.abs(h[2]),g=p>=f?p>=m?0:2:f>=m?1:2,b=g,E=h[b]<0?2:1,x=(g+E)%3,S=(g+(3-E))%3,w=h[x]/h[b],A=h[S]/h[b],M=1/h[b],R=_,C=v,I=y,{normalRequired:P}=c;for(let t=n;t<r;++t){const n=3*t,r=a*s[n];(0,i.s)(d[0],o[r+0],o[r+1],o[r+2]);const c=a*s[n+1];(0,i.s)(d[1],o[c+0],o[c+1],o[c+2]);const h=a*s[n+2];(0,i.s)(d[2],o[h+0],o[h+1],o[h+2]),l&&((0,i.c)(d[0],l.applyToVertex(d[0][0],d[0][1],d[0][2],t)),(0,i.c)(d[1],l.applyToVertex(d[1][0],d[1][1],d[1][2],t)),(0,i.c)(d[2],l.applyToVertex(d[2][0],d[2][1],d[2][2],t))),(0,i.z)(R,d[0],e),(0,i.z)(C,d[1],e),(0,i.z)(I,d[2],e);const p=R[x]-w*R[b],f=R[S]-A*R[b],m=C[x]-w*C[b],g=C[S]-A*C[b],_=I[x]-w*I[b],v=I[S]-A*I[b],y=_*g-v*m,E=p*v-f*_,O=m*f-g*p;if((y<0||E<0||O<0)&&(y>0||E>0||O>0))continue;const D=y+E+O;if(0===D)continue;const L=y*(M*R[b])+E*(M*C[b])+O*(M*I[b]);if(L*Math.sign(D)<0)continue;const N=L/D;N>=0&&u(N,t,P?T(d):null)}}const _=(0,r.vt)(),v=(0,r.vt)(),y=(0,r.vt)();function b(e,t,n,r,s,o,a){return(0,i.s)(E,e,t,n),(0,i.s)(x,r,s,o),(0,i.b)(a,E,x),(0,i.n)(a,a),a}function T(e){return(0,i.z)(E,e[1],e[0]),(0,i.z)(x,e[2],e[0]),(0,i.b)(f,E,x),(0,i.n)(f,f),f}const E=(0,r.vt)(),x=(0,r.vt)();function S(e,t,n,i){return function(e,t,n,i,r){const s=(e[0]-i-t[0])*n[0],o=(e[3]+i-t[0])*n[0];let a=Math.min(s,o),l=Math.max(s,o);const c=(e[1]-i-t[1])*n[1],u=(e[4]+i-t[1])*n[1];if(l=Math.min(l,Math.max(c,u)),l<0)return!1;if(a=Math.max(a,Math.min(c,u)),a>l)return!1;const h=(e[2]-i-t[2])*n[2],d=(e[5]+i-t[2])*n[2];return l=Math.min(l,Math.max(h,d)),!(l<0)&&(a=Math.max(a,Math.min(h,d)),!(a>l)&&a<1/0)}(e,t,n,i)}const w=1e3,A=1e-7,M=(0,r.vt)(),O=[(0,r.vt)(),(0,r.vt)(),(0,r.vt)()]},15389:function(e,t,n){"use strict";n.d(t,{$:function(){return c}});var i=n(11231),r=n(73364),s=n(39714),o=n(20551),a=n(90599),l=n(76185);class c{constructor(e,t={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=(0,s.vt)(),this._shaderTransformation=null,this._boundingSphere=null,this.id=(0,i.c)(),this.layerUid=t.layerUid,this.graphicUid=t.graphicUid,this.castShadow=t.castShadow??!1,null!=t.objectShaderTransformation&&this.objectShaderTransformationChanged(t.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){(0,r.C)(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){null==e?this._shaderTransformation=null:(this._shaderTransformation??=(0,s.vt)(),(0,r.lw)(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(null==this._boundingSphere&&(this._boundingSphere??=(0,a.c)(),(0,o.h)((0,a.g)(this._boundingSphere),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*(0,l.hG)(this.shaderTransformation)),this._boundingSphere):a.N}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??this.transformation}get attributes(){return this.geometry.attributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}}},29165:function(e,t,n){"use strict";var i;n.d(t,{N:function(){return i}}),function(e){e[e.INTEGRATED_MESH=0]="INTEGRATED_MESH",e[e.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",e[e.OPAQUE_NO_SSAO_DEPTH=3]="OPAQUE_NO_SSAO_DEPTH",e[e.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_NO_SSAO_DEPTH=5]="TRANSPARENT_NO_SSAO_DEPTH",e[e.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN",e[e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=7]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",e[e.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN",e[e.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL",e[e.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL",e[e.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS",e[e.OPAQUE_ENVIRONMENT=12]="OPAQUE_ENVIRONMENT",e[e.TRANSPARENT_ENVIRONMENT=13]="TRANSPARENT_ENVIRONMENT",e[e.LASERLINES=14]="LASERLINES",e[e.LASERLINES_CONTRAST_CONTROL=15]="LASERLINES_CONTRAST_CONTROL",e[e.HUD_MATERIAL=16]="HUD_MATERIAL",e[e.LABEL_MATERIAL=17]="LABEL_MATERIAL",e[e.LINE_CALLOUTS=18]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=19]="LINE_CALLOUTS_HUD_DEPTH",e[e.DRAPED_MATERIAL=20]="DRAPED_MATERIAL",e[e.DRAPED_WATER=21]="DRAPED_WATER",e[e.VIEWSHED=22]="VIEWSHED",e[e.VOXEL=23]="VOXEL",e[e.MAX_SLOTS=24]="MAX_SLOTS"}(i||(i={}))},6200:function(e,t,n){"use strict";n.d(t,{I$:function(){return h},a9:function(){return u},m:function(){return s},mK:function(){return d},qh:function(){return c},r8:function(){return l},sf:function(){return o},v0:function(){return a}});var i=n(54407),r=n(85456);const s={func:r.MT.LESS},o={func:r.MT.ALWAYS},a={mask:255},l={mask:0},c={function:{func:r.MT.ALWAYS,ref:i.dd.OutlineVisualElementMask,mask:i.dd.OutlineVisualElementMask},operation:{fail:r.eA.KEEP,zFail:r.eA.KEEP,zPass:r.eA.ZERO}},u={function:{func:r.MT.ALWAYS,ref:i.dd.OutlineVisualElementMask,mask:i.dd.OutlineVisualElementMask},operation:{fail:r.eA.KEEP,zFail:r.eA.KEEP,zPass:r.eA.REPLACE}},h={function:{func:r.MT.EQUAL,ref:i.dd.OutlineVisualElementMask,mask:i.dd.OutlineVisualElementMask},operation:{fail:r.eA.KEEP,zFail:r.eA.KEEP,zPass:r.eA.KEEP}},d={function:{func:r.MT.NOTEQUAL,ref:i.dd.OutlineVisualElementMask,mask:i.dd.OutlineVisualElementMask},operation:{fail:r.eA.KEEP,zFail:r.eA.KEEP,zPass:r.eA.KEEP}}},59552:function(e,t,n){"use strict";n.d(t,{g:function(){return U}}),n(58941);var i=n(39819),r=n(48996),s=n(95929),o=n(60539),a=n(24540),l=n(90683),c=n(9030),u=n(86419),h=n(54407),d=n(53216);let p;var f,m;(m=f||(f={}))[m.ETC1_RGB=0]="ETC1_RGB",m[m.ETC2_RGBA=1]="ETC2_RGBA",m[m.BC1_RGB=2]="BC1_RGB",m[m.BC3_RGBA=3]="BC3_RGBA",m[m.BC4_R=4]="BC4_R",m[m.BC5_RG=5]="BC5_RG",m[m.BC7_M6_RGB=6]="BC7_M6_RGB",m[m.BC7_M5_RGBA=7]="BC7_M5_RGBA",m[m.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",m[m.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",m[m.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",m[m.ATC_RGB=11]="ATC_RGB",m[m.ATC_RGBA=12]="ATC_RGBA",m[m.FXT1_RGB=17]="FXT1_RGB",m[m.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",m[m.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",m[m.ETC2_EAC_R11=20]="ETC2_EAC_R11",m[m.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",m[m.RGBA32=13]="RGBA32",m[m.RGB565=14]="RGB565",m[m.BGR565=15]="BGR565",m[m.RGBA4444=16]="RGBA4444";var g=n(85456),_=n(78541),v=n(93380);let y=null,b=null;async function T(){return null==b&&(p??=(async()=>{const e=await n.e(5090).then(n.bind(n,90830)),t=await e.default({locateFile:e=>(0,d.s)(`esri/libs/basisu/${e}`)});return t.initializeBasis(),t})(),b=p,y=await b),b}function E(e,t,n,i,r){const s=(0,v.IB)(t?g.CQ.COMPRESSED_RGBA8_ETC2_EAC:g.CQ.COMPRESSED_RGB8_ETC2),o=r&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(n*i*s*o)}function x(e){return e.getNumImages()>=1&&!e.isUASTC()}function S(e){return e.getFaces()>=1&&e.isETC1S()}function w(e,t,n,i,r,s,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=e.capabilities,[u,h]=l?i?[f.ETC2_RGBA,g.CQ.COMPRESSED_RGBA8_ETC2_EAC]:[f.ETC1_RGB,g.CQ.COMPRESSED_RGB8_ETC2]:c?i?[f.BC3_RGBA,g.CQ.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[f.BC1_RGB,g.CQ.COMPRESSED_RGB_S3TC_DXT1_EXT]:[f.RGBA32,g.Ab.RGBA],d=t.hasMipmap?n:Math.min(1,n),p=[];for(let e=0;e<d;e++)p.push(new Uint8Array(o(e,u))),a(e,u,p[e]);return t.internalFormat=h,t.hasMipmap=p.length>1,t.samplingMode=t.hasMipmap?g.Cj.LINEAR_MIPMAP_LINEAR:g.Cj.LINEAR,t.width=r,t.height=s,new _.g(e,t,{type:"compressed",levels:p})}var A=n(48015),M=n(40359),O=n(40633);const R=()=>O.A.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil");function C(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const I=C("DXT1"),P=C("DXT3"),D=C("DXT5");function L(e,t){const n=new Int32Array(e,0,31);if(542327876!==n[0])return R().error("Invalid magic number in DDS header"),null;if(!(4&n[20]))return R().error("Unsupported format, must contain a FourCC code"),null;const i=n[21];let r,s;switch(i){case I:r=8,s=g.CQ.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case P:r=16,s=g.CQ.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case D:r=16,s=g.CQ.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return R().error("Unsupported FourCC code:",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(i)),null}let o=1,a=n[4],l=n[3];(3&a||3&l)&&(R().warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,u=l;let h,d;131072&n[2]&&!1!==t&&(o=Math.max(1,n[7]));let p=n[1]+4;const f=[];for(let t=0;t<o;++t)d=(a+3>>2)*(l+3>>2)*r,h=new Uint8Array(e,p,d),f.push(h),p+=d,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:f},internalFormat:s,width:c,height:u}}var N,F,z=n(12569),V=n(90553),H=n(10956);class U extends A.J{get parameters(){return this._parameters}constructor(e,t){super(),this._data=e,this.type=M.X.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new r.A,this._parameters={...j,...t},this._startPreload(e)}dispose(){this.unload(),this._data=this.frameUpdate=void 0}_startPreload(e){null!=e&&(e instanceof HTMLVideoElement?(this.frameUpdate=t=>this._frameUpdate(e,t),this._startPreloadVideoElement(e)):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!((0,l.w8)(e.src)||"auto"===e.preload&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const t=!e.paused;if(e.src=e.src,t&&e.autoplay){const t=()=>{e.removeEventListener("canplay",t),e.play()};e.addEventListener("canplay",t)}}}_startPreloadImageElement(e){(0,l.DB)(e.src)||(0,l.w8)(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}_createDescriptor(e){const t=new H.R;return t.wrapMode=this._parameters.wrap??g.pF.REPEAT,t.flipped=!this._parameters.noUnpackFlip,t.samplingMode=this._parameters.mipmap?g.Cj.LINEAR_MIPMAP_LINEAR:g.Cj.LINEAR,t.hasMipmap=!!this._parameters.mipmap,t.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,t.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?e.parameters.maxMaxAnisotropy:1),t}get glTexture(){return this._glTexture}get memoryEstimate(){return this._glTexture?.usedMemory||function(e,t){if(null==e)return 0;if((0,a.mw)(e)||(0,a.mg)(e))return t.encoding===h.JS.KTX2_ENCODING?function(e,t){if(null==y)return e.byteLength;const n=new y.KTX2File(new Uint8Array(e)),i=S(n)?E(n.getLevels(),n.getHasAlpha(),n.getWidth(),n.getHeight(),t):0;return n.close(),n.delete(),i}(e,!!t.mipmap):t.encoding===h.JS.BASIS_ENCODING?function(e,t){if(null==y)return e.byteLength;const n=new y.BasisFile(new Uint8Array(e)),i=x(n)?E(n.getNumLevels(0),n.getHasAlpha(),n.getImageWidth(0,0),n.getImageHeight(0,0),t):0;return n.close(),n.delete(),i}(e,!!t.mipmap):e.byteLength;const{width:n,height:i}=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?k(e):t;return(t.mipmap?4/3:1)*n*i*(t.components||4)||0}(this._data,this._parameters)}load(e){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const t=this._data;return null==t?(this._glTexture=new _.g(e,this._createDescriptor(e),null),this._glTexture):(this._parameters.reloadable||(this._data=void 0),"string"==typeof t?this._loadFromURL(e,t):t instanceof Image?this._loadFromImageElement(e,t):t instanceof HTMLVideoElement?this._loadFromVideoElement(e,t):t instanceof ImageData||t instanceof HTMLCanvasElement?this._loadFromImage(e,t):((0,a.mw)(t)||(0,a.mg)(t))&&this._parameters.encoding===h.JS.DDS_ENCODING?this._loadFromDDSData(e,t):((0,a.mw)(t)||(0,a.mg)(t))&&this._parameters.encoding===h.JS.KTX2_ENCODING?this._loadFromKTX2(e,t):((0,a.mw)(t)||(0,a.mg)(t))&&this._parameters.encoding===h.JS.BASIS_ENCODING?this._loadFromBasis(e,t):(0,a.mg)(t)?this._loadFromPixelData(e,t):(0,a.mw)(t)?this._loadFromPixelData(e,new Uint8Array(t)):null)}_frameUpdate(e,t){return null==this._glTexture||e.readyState<N.HAVE_CURRENT_DATA||t===e.currentTime?t:(this._glTexture.setData(e),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),e.currentTime)}_loadFromDDSData(e,t){return this._glTexture=function(e,t,n){const i=L(n,t.hasMipmap??!1);if(null==i)throw new Error("DDS texture data is null");const{textureData:r,internalFormat:s,width:o,height:a}=i;return t.samplingMode=r.levels.length>1?g.Cj.LINEAR_MIPMAP_LINEAR:g.Cj.LINEAR,t.hasMipmap=r.levels.length>1,t.internalFormat=s,t.width=o,t.height=a,new _.g(e,t,r)}(e,this._createDescriptor(e),t),this._glTexture}_loadFromKTX2(e,t){return this._loadAsync((()=>async function(e,t,n){null==y&&(y=await T());const i=new y.KTX2File(new Uint8Array(n));if(!S(i))return null;i.startTranscoding();const r=w(e,t,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),((e,t)=>i.getImageTranscodedSizeInBytes(e,0,0,t)),((e,t,n)=>i.transcodeImage(n,e,0,0,t,0,-1,-1)));return i.close(),i.delete(),r}(e,this._createDescriptor(e),t).then((e=>(this._glTexture=e,e)))))}_loadFromBasis(e,t){return this._loadAsync((()=>async function(e,t,n){null==y&&(y=await T());const i=new y.BasisFile(new Uint8Array(n));if(!x(i))return null;i.startTranscoding();const r=w(e,t,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),((e,t)=>i.getImageTranscodedSizeInBytes(0,e,t)),((e,t,n)=>i.transcodeImage(n,0,e,t,0,0)));return i.close(),i.delete(),r}(e,this._createDescriptor(e),t).then((e=>(this._glTexture=e,e)))))}_loadFromPixelData(e,t){(0,V.vA)(this._parameters.width>0&&this._parameters.height>0);const n=this._createDescriptor(e);return n.pixelFormat=1===this._parameters.components?g.Ab.LUMINANCE:3===this._parameters.components?g.Ab.RGB:g.Ab.RGBA,n.width=this._parameters.width??0,n.height=this._parameters.height??0,this._glTexture=new _.g(e,n,t),this._glTexture}_loadFromURL(e,t){return this._loadAsync((async n=>{const i=await(0,c.D)(t,{signal:n});return(0,o.Te)(n),this._loadFromImage(e,i)}))}_loadFromImageElement(e,t){return t.complete?this._loadFromImage(e,t):this._loadAsync((async n=>{const i=await(0,u.Sx)(t,t.src,!1,n);return(0,o.Te)(n),this._loadFromImage(e,i)}))}_loadFromVideoElement(e,t){return t.readyState>=N.HAVE_CURRENT_DATA?this._loadFromImage(e,t):this._loadFromVideoElementAsync(e,t)}_loadFromVideoElementAsync(e,t){return this._loadAsync((n=>new Promise(((r,a)=>{const l=()=>{t.removeEventListener("loadeddata",c),t.removeEventListener("error",u),(0,s.xt)(h)},c=()=>{t.readyState>=N.HAVE_CURRENT_DATA&&(l(),r(this._loadFromImage(e,t)))},u=e=>{l(),a(e||new i.A("Failed to load video"))};t.addEventListener("loadeddata",c),t.addEventListener("error",u);const h=(0,o.u7)(n,(()=>u((0,o.NK)())))}))))}_loadFromImage(e,t){let n=t;if(!(n instanceof HTMLVideoElement)){const{maxTextureSize:t}=e.parameters;n=this._parameters.downsampleUncompressed?(0,z.IR)(n,t):(0,z.vM)(n,t)}const i=k(n);this._parameters.width=i.width,this._parameters.height=i.height;const r=this._createDescriptor(e);return r.pixelFormat=3===this._parameters.components?g.Ab.RGB:g.Ab.RGBA,r.width=i.width,r.height=i.height,this._glTexture=new _.g(e,r,n),this._glTexture}_loadAsync(e){const t=new AbortController;this._loadingController=t;const n=e(t.signal);this._loadingPromise=n;const i=()=>{this._loadingController===t&&(this._loadingController=null),this._loadingPromise===n&&(this._loadingPromise=null)};return n.then(i,i),n}unload(){if(this._glTexture=(0,s.WD)(this._glTexture),null!=this._loadingController){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}}function k(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}(F=N||(N={}))[F.HAVE_NOTHING=0]="HAVE_NOTHING",F[F.HAVE_METADATA=1]="HAVE_METADATA",F[F.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",F[F.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",F[F.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA";const j={wrap:{s:g.pF.REPEAT,t:g.pF.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1}},55890:function(e,t,n){"use strict";var i;n.d(t,{y:function(){return i}}),function(e){e[e.ColorAlpha=0]="ColorAlpha",e[e.FrontFace=1]="FrontFace",e[e.NONE=2]="NONE",e[e.COUNT=3]="COUNT"}(i||(i={}))},91998:function(e,t,n){"use strict";var i;n.d(t,{q:function(){return i}}),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(i||(i={}))},90553:function(e,t,n){"use strict";n.d(t,{L:function(){return l},MX:function(){return o},M_:function(){return u},O_:function(){return a},kL:function(){return c},vA:function(){return s},zH:function(){return h}});var i=n(1932);n(33400),(0,n(41546).vt)();class r{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}}function s(e,t){if(!e){t=t||"Assertion";const e=new Error(t).stack;throw new r(`${t} at ${e}`)}}function o(e,t){e||(t=t||"",console.warn("Verify failed: "+t+"\n"+new Error("verify").stack))}function a(e,t,n,i){let r,s=(n[0]-e[0])/t[0],o=(i[0]-e[0])/t[0];s>o&&(r=s,s=o,o=r);let a=(n[1]-e[1])/t[1],l=(i[1]-e[1])/t[1];if(a>l&&(r=a,a=l,l=r),s>l||a>o)return!1;a>s&&(s=a),l<o&&(o=l);let c=(n[2]-e[2])/t[2],u=(i[2]-e[2])/t[2];return c>u&&(r=c,c=u,u=r),!(s>u||c>o||(u<o&&(o=u),o<0))}function l(e,t,n,r,s,o=(0,i.vt)()){const a=(r[s]-n[s])*(t[0]-e[0])-(r[0]-n[0])*(t[s]-e[s]),l=(r[0]-n[0])*(e[s]-n[s])-(r[s]-n[s])*(e[0]-n[0]);if(0===a)return!1;const c=l/a;return o[0]=e[0]+c*(t[0]-e[0]),o[1]=e[s]+c*(t[s]-e[s]),!0}function c(e,t){return Math.log(e)/Math.log(t)}function u(e,t,n,i){e[12]=t,e[13]=n,e[14]=i}function h(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&1===e[15]}},69445:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var i=n(81438);class r extends i.Z{}},65839:function(e,t,n){"use strict";var i;function r(e){return e===i.POSITION}n.d(t,{b:function(){return r},r:function(){return i}}),function(e){e.POSITION="position",e.NORMAL="normal",e.NORMALCOMPRESSED="normalCompressed",e.UV0="uv0",e.COLOR="color",e.SYMBOLCOLOR="symbolColor",e.SIZE="size",e.TANGENT="tangent",e.OFFSET="offset",e.PERSPECTIVEDIVIDE="perspectiveDivide",e.CENTEROFFSETANDDISTANCE="centerOffsetAndDistance",e.LENGTH="length",e.PREVPOSITION="prevPosition",e.NEXTPOSITION="nextPosition",e.SUBDIVISIONFACTOR="subdivisionFactor",e.COLORFEATUREATTRIBUTE="colorFeatureAttribute",e.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",e.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",e.DISTANCETOSTART="distanceToStart",e.UVMAPSPACE="uvMapSpace",e.BOUNDINGRECT="boundingRect",e.UVREGION="uvRegion",e.PROFILERIGHT="profileRight",e.PROFILEUP="profileUp",e.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",e.FEATUREVALUE="featureValue",e.INSTANCEMODELORIGINHI="instanceModelOriginHi",e.INSTANCEMODELORIGINLO="instanceModelOriginLo",e.INSTANCEMODEL="instanceModel",e.INSTANCEMODELNORMAL="instanceModelNormal",e.INSTANCECOLOR="instanceColor",e.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",e.LOCALTRANSFORM="localTransform",e.GLOBALTRANSFORM="globalTransform",e.BOUNDINGSPHERE="boundingSphere",e.MODELORIGIN="modelOrigin",e.MODELSCALEFACTORS="modelScaleFactors",e.FEATUREATTRIBUTE="featureAttribute",e.STATE="state",e.LODLEVEL="lodLevel",e.POSITION0="position0",e.POSITION1="position1",e.NORMAL2COMPRESSED="normal2Compressed",e.COMPONENTINDEX="componentIndex",e.VARIANTOFFSET="variantOffset",e.VARIANTSTROKE="variantStroke",e.VARIANTEXTENSION="variantExtension",e.SIDENESS="sideness",e.START="start",e.END="end",e.UP="up",e.EXTRUDE="extrude",e.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",e.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"}(i||(i={}))},1296:function(e,t,n){"use strict";n.d(t,{x:function(){return d}});var i=n(48996),r=n(14606),s=n(95929),o=n(7187),a=n(48015),l=n(40359);const c=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];var u=n(35363),h=n(91998);class d extends a.J{get objects(){return this._objects}constructor(e,t,n=""){super(),this.stage=e,this.apiLayerUid=n,this.type=l.X.Layer,this.events=new i.A,this.visible=!0,this.pickable=!0,this.sliceable=!1,this._objects=new o.A,this._objectsAdded=new o.A,this._handles=new r.A,this.apiLayerUid=n,this.visible=t?.visible??!0,this.pickable=t?.pickable??!0,this.updatePolicy=t?.updatePolicy??h.q.ASYNC,this._disableOctree=t?.disableOctree??!1,e.add(this);for(const t of c)this._handles.add(this.events.on(t,(n=>e.handleEvent(t,n))))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),null!=this._octree&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),null!=this._octree&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),null!=this._octree&&this._objectsAdded.pushArray(e)}removeMany(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),null!=this._octree){for(let e=0;e<t.length;)this._objectsAdded.removeUnordered(t[e])?(t[e]=t[t.length-1],t.length-=1):++e;this._octree.remove(t)}}}sync(){this.updatePolicy!==h.q.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,t){null==this._octree||this._objectsAdded.includes(e)||this._octree.update(e,t)}getSpatialQueryAccelerator(){return null==this._octree&&this._objects.length>50&&!this._disableOctree?(this._octree=new u.A((e=>e.boundingVolumeWorldSpace.bounds)),this._octree.add(this._objects.data,this._objects.length)):null!=this._octree&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}invalidateSpatialQueryAccelerator(){this._octree=(0,s.pR)(this._octree),this._objectsAdded.clear()}}},54407:function(e,t,n){"use strict";var i,r,s,o,a,l,c,u,h;n.d(t,{Am:function(){return o},C7:function(){return s},ID:function(){return u},JS:function(){return h},Mg:function(){return l},dd:function(){return a},it:function(){return r},s2:function(){return i},sf:function(){return c}}),function(e){e[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.COUNT=3]="COUNT"}(i||(i={})),function(e){e[e.Less=0]="Less",e[e.Lequal=1]="Lequal",e[e.COUNT=2]="COUNT"}(r||(r={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.UPDATE=1]="UPDATE"}(s||(s={})),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(o||(o={})),function(e){e[e.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",e[e.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(a||(a={})),function(e){e[e.Highlight=0]="Highlight",e[e.MaskOccludee=1]="MaskOccludee",e[e.COUNT=2]="COUNT"}(l||(l={})),function(e){e[e.Blend=0]="Blend",e[e.Opaque=1]="Opaque",e[e.Mask=2]="Mask",e[e.MaskBlend=3]="MaskBlend",e[e.COUNT=4]="COUNT"}(c||(c={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(u||(u={})),function(e){e.DDS_ENCODING="image/vnd-ms.dds",e.KTX2_ENCODING="image/ktx2",e.BASIS_ENCODING="image/x.basis"}(h||(h={}))},59356:function(e,t,n){"use strict";n.d(t,{i3:function(){return r}}),n(20551);var i=n(32501);function r(e){return null!=e?.dist}n(2075),n(38177),(0,i.vt)()},57701:function(e,t,n){"use strict";n.d(t,{$T:function(){return a},zj:function(){return r}});var i,r,s,o=n(23545);function a(e){const t=new Map,n=e=>{let n=t.get(e);return n||(n=new o.a0,t.set(e,n)),n};return e.removes.forAll((e=>{l(e)&&n(e.material).removes.push(e)})),e.adds.forAll((e=>{l(e)&&n(e.material).adds.push(e)})),e.updates.forAll((e=>{l(e.renderGeometry)&&n(e.renderGeometry.material).updates.push(e)})),t}function l(e){return e.geometry.indexCount>=1}(s=i||(i={}))[s.Default=0]="Default",s[s.Screenshot=1]="Screenshot",s[s.ObjectAndLayerID=2]="ObjectAndLayerID",function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"}(r||(r={}))},54035:function(e,t,n){"use strict";n.d(t,{MD:function(){return a},cJ:function(){return o},hs:function(){return l},m0:function(){return s}});var i=n(15774);function r(e,t,n){const i=n.parameters;return c.scale=Math.min(i.divisor/(t-i.offset),1),c.factor=function(e){return Math.abs(e*e*e)}(e),c}function s(e,t){return(0,i.Cc)(e*Math.max(t.scale,t.minScaleFactor),e,t.factor)}function o(e,t,n,i){i.scale=function(e,t,n){const i=r(e,t,n);return i.minScaleFactor=0,s(1,i)}(e,t,n),i.factor=0,i.minScaleFactor=n.minScaleFactor}function a(e,t,n=[0,0]){const i=Math.min(Math.max(t.scale,t.minScaleFactor),1);return n[0]=e[0]*i,n[1]=e[1]*i,n}function l(e,t,n,i){return s(e,r(t,n,i))}n(65420),(0,i.kU)(10),(0,i.kU)(12),(0,i.kU)(70),(0,i.kU)(40);const c={scale:0,factor:0,minScaleFactor:0}},10228:function(e,t,n){"use strict";n.d(t,{G:function(){return i},Q:function(){return r}});const i={stableRendering:!1},r={rootOrigin:null}},12569:function(e,t,n){"use strict";n.d(t,{IR:function(){return a},Mv:function(){return s},uT:function(){return o},vM:function(){return l}});var i=n(39819);const r=16;function s(e){return Math.ceil(e/r)*r}function o(e){return Math.floor(e/r)*r}function a(e,t){let n=e.width*e.height;if(n<4096)return e instanceof ImageData?u(e):e;let i=e.width,r=e.height;do{i=Math.ceil(i/2),r=Math.ceil(r/2),n=i*r}while(n>1048576||null!=t&&(i>t||r>t));return c(e,i,r)}function l(e,t){const n=Math.max(e.width,e.height);if(n<=t)return e;const i=t/n;return c(e,Math.round(e.width*i),Math.round(e.height*i))}function c(e,t,n){if(e instanceof ImageData)return c(u(e),t,n);const i=document.createElement("canvas");return i.width=t,i.height=n,i.getContext("2d").drawImage(e,0,0,i.width,i.height),i}function u(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");if(null==n)throw new i.A("Failed to create 2d context from HTMLCanvasElement");return n.putImageData(e,0,0),t}},22323:function(e,t,n){"use strict";n.d(t,{dg:function(){return d},ou:function(){return m}});var i=n(44705),r=n(87725),s=n(73364),o=n(39714),a=n(20551),l=n(32501),c=n(90599),u=n(65420),h=n(89765);class d{constructor(){this._transform=(0,o.vt)(),this._transformInverse=new p({value:this._transform},s.B8,o.vt),this._transformInverseTranspose=new p(this._transformInverse,s.mg,o.vt),this._transformTranspose=new p({value:this._transform},s.mg,o.vt),this._transformInverseRotation=new p({value:this._transform},i.dR,r.vt)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){(0,s.C)(this._transform,e)}multiplyTransform(e){(0,s.lw)(this._transform,this._transform,e)}set(e){(0,s.C)(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this._invalidateLazyTransforms()}}class p{constructor(e,t,n){this._original=e,this._update=t,this._dirty=!0,this._transform=n()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}}const f=new class{constructor(e=0){this.offset=e,this.sphere=(0,c.c)(),this.tmpVertex=(0,l.vt)()}applyToVertex(e,t,n){const i=this.objectTransform.transform,r=(0,a.s)(g,e,t,n),s=(0,a.h)(r,r,i),o=this.offset/(0,a.l)(s);(0,a.r)(s,s,s,o);const l=this.objectTransform.inverse;return(0,a.h)(this.tmpVertex,s,l),this.tmpVertex}applyToMinMax(e,t){const n=this.offset/(0,a.l)(e);(0,a.r)(e,e,e,n);const i=this.offset/(0,a.l)(t);(0,a.r)(t,t,t,i)}applyToAabb(e){const t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;const n=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*n,e[4]+=e[4]*n,e[5]+=e[5]*n,e}applyToBoundingSphere(e){const t=(0,a.l)((0,c.g)(e)),n=this.offset/t;return(0,a.r)((0,c.g)(this.sphere),(0,c.g)(e),(0,c.g)(e),n),this.sphere[3]=e[3]+e[3]*this.offset/t,this.sphere}};function m(e){return null!=e?(f.offset=e,f):null}new class{constructor(e=0){this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=(0,l.vt)(),this._tmpMbs=(0,c.c)(),this._tmpObb=new h.ab,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=(0,a.l)(e)}applyToVertex(e,t,n){const i=(0,a.s)(g,e,t,n),r=(0,a.s)(_,e,t,n+this.componentLocalOriginLength),s=this._totalOffset/(0,a.l)(r);return(0,a.r)(this._tmpVertex,i,r,s),this._tmpVertex}applyToAabb(e){const t=this.componentLocalOriginLength,n=e[0],i=e[1],r=e[2]+t,s=e[3],o=e[4],a=e[5]+t,l=Math.abs(n),c=Math.abs(i),u=Math.abs(r),h=Math.abs(s),d=Math.abs(o),p=Math.abs(a),f=.5*(1+Math.sign(n*s))*Math.min(l,h),m=.5*(1+Math.sign(i*o))*Math.min(c,d),g=.5*(1+Math.sign(r*a))*Math.min(u,p),_=Math.max(l,h),v=Math.max(c,d),y=Math.max(u,p),b=Math.sqrt(f*f+m*m+g*g),T=Math.sign(l+n),E=Math.sign(c+i),x=Math.sign(u+r),S=Math.sign(h+s),w=Math.sign(d+o),A=Math.sign(p+a),M=this._totalOffset;if(b<M)return e[0]-=(1-T)*M,e[1]-=(1-E)*M,e[2]-=(1-x)*M,e[3]+=S*M,e[4]+=w*M,e[5]+=A*M,e;const O=M/Math.sqrt(_*_+v*v+y*y),R=M/b,C=R-O,I=-C;return e[0]+=n*(T*I+R),e[1]+=i*(E*I+R),e[2]+=r*(x*I+R),e[3]+=s*(S*C+O),e[4]+=o*(w*C+O),e[5]+=a*(A*C+O),e}applyToMbs(e){const t=(0,a.l)((0,c.g)(e)),n=this._totalOffset/t;return(0,a.r)((0,c.g)(this._tmpMbs),(0,c.g)(e),(0,c.g)(e),n),this._tmpMbs[3]=e[3]+e[3]*this._totalOffset/t,this._tmpMbs}applyToObb(e){return(0,h.gm)(e,this._totalOffset,this._totalOffset,u.RT.Global,this._tmpObb),this._tmpObb}},new class{constructor(e=0){this.offset=e,this.tmpVertex=(0,l.vt)()}applyToVertex(e,t,n){const i=(0,a.s)(g,e,t,n),r=(0,a.g)(_,i,this.localOrigin),s=this.offset/(0,a.l)(r);return(0,a.r)(this.tmpVertex,i,r,s),this.tmpVertex}applyToAabb(e){const t=v,n=y,i=b;for(let r=0;r<3;++r)t[r]=e[0+r]+this.localOrigin[r],n[r]=e[3+r]+this.localOrigin[r],i[r]=t[r];const r=this.applyToVertex(t[0],t[1],t[2]);for(let t=0;t<3;++t)e[t]=r[t],e[t+3]=r[t];const s=t=>{const n=this.applyToVertex(t[0],t[1],t[2]);for(let t=0;t<3;++t)e[t]=Math.min(e[t],n[t]),e[t+3]=Math.max(e[t+3],n[t])};for(let e=1;e<8;++e){for(let r=0;r<3;++r)i[r]=e&1<<r?n[r]:t[r];s(i)}let o=0;for(let e=0;e<3;++e)t[e]*n[e]<0&&(o|=1<<e);if(0!==o&&7!==o)for(let e=0;e<8;++e)if(!(o&e)){for(let r=0;r<3;++r)i[r]=o&1<<r?0:e&1<<r?t[r]:n[r];s(i)}for(let t=0;t<3;++t)e[t]-=this.localOrigin[t],e[t+3]-=this.localOrigin[t];return e}};const g=(0,l.vt)(),_=(0,l.vt)(),v=(0,l.vt)(),y=(0,l.vt)(),b=(0,l.vt)()},35910:function(e,t,n){"use strict";n.d(t,{$p:function(){return r},Qx:function(){return o},_y:function(){return s},e_:function(){return a}});var i=n(32501);class r{constructor(e=(0,i.vt)()){this.intensity=e}}class s{constructor(e=(0,i.vt)(),t=(0,i.fA)(.57735,.57735,.57735)){this.intensity=e,this.direction=t}}class o{constructor(e=(0,i.vt)(),t=(0,i.fA)(.57735,.57735,.57735),n=!0,r=1,s=1){this.intensity=e,this.direction=t,this.castShadows=n,this.specularStrength=r,this.environmentStrength=s}}class a{constructor(){this.r=[0],this.g=[0],this.b=[0]}}},95629:function(e,t,n){"use strict";n.d(t,{TA:function(){return w},uH:function(){return S}});var i=n(15774),r=n(20551),s=n(32501),o=n(35910);function a(e,t,n){(n=n||e).length=e.length;for(let i=0;i<e.length;i++)n[i]=e[i]*t[i];return n}function l(e,t,n){(n=n||e).length=e.length;for(let i=0;i<e.length;i++)n[i]=e[i]*t;return n}function c(e,t,n){(n=n||e).length=e.length;for(let i=0;i<e.length;i++)n[i]=e[i]+t[i];return n}function u(e){return(e+1)*(e+1)}function h(e,t,n){const i=e[0],r=e[1],s=e[2],o=n||[];return o.length=u(t),t>=0&&(o[0]=.28209479177),t>=1&&(o[1]=.4886025119*i,o[2]=.4886025119*s,o[3]=.4886025119*r),t>=2&&(o[4]=1.09254843059*i*r,o[5]=1.09254843059*r*s,o[6]=.31539156525*(3*s*s-1),o[7]=1.09254843059*i*s,o[8]=.54627421529*(i*i-r*r)),o}function d(e,t){const n=u(e),i=t||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=n;for(let e=0;e<n;e++)i.r[e]=i.g[e]=i.b[e]=0;return i}function p(e,t){const n=function(e){return(0,i.qE)(Math.floor(Math.sqrt(e)-1),0,2)}(t.r.length);for(const i of e)(0,r.k)(b,i.direction),h(b,n,v),a(v,T),l(v,i.intensity[0],y),c(t.r,y),l(v,i.intensity[1],y),c(t.g,y),l(v,i.intensity[2],y),c(t.b,y);return t}function f(e,t){h(b,0,v);for(const n of e)t.r[0]+=v[0]*T[0]*n.intensity[0]*4*Math.PI,t.g[0]+=v[0]*T[0]*n.intensity[1]*4*Math.PI,t.b[0]+=v[0]*T[0]*n.intensity[2]*4*Math.PI;return t}const m=[],g=[],_=[],v=[0],y=[0],b=(0,s.vt)(),T=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];class E{constructor(){this.color=(0,s.vt)(),this.intensity=1}}class x{constructor(){this.direction=(0,s.vt)(),this.ambient=new E,this.diffuse=new E}}const S=.4;class w{constructor(){this._shOrder=2,this._legacy=new x,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new o.e_,this._mainLight=new o.Qx((0,s.vt)(),(0,s.fA)(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){(function(e,t,n,i){d(t,i),(0,r.s)(n.intensity,0,0,0);let s=!1;const a=m,l=g,u=_;a.length=0,l.length=0,u.length=0;for(const t of e)t instanceof o.Qx&&!s?((0,r.c)(n.direction,t.direction),(0,r.c)(n.intensity,t.intensity),n.specularStrength=t.specularStrength,n.environmentStrength=t.environmentStrength,n.castShadows=t.castShadows,s=!0):t instanceof o.Qx||t instanceof o._y?a.push(t):t instanceof o.$p?l.push(t):t instanceof o.e_&&u.push(t);p(a,i),f(l,i);for(const e of u)c(i.r,e.r),c(i.g,e.g),c(i.b,e.b)})(e,this._shOrder,this._mainLight,this._sphericalHarmonics),(0,r.c)(this._legacy.direction,this._mainLight.direction);const t=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*t,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*t,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*t,(0,r.j)(this._legacy.diffuse.color,this._mainLight.intensity,t),(0,r.c)(A,this._legacy.diffuse.color),(0,r.j)(A,A,S*this.globalFactor),(0,r.g)(this._legacy.ambient.color,this._legacy.ambient.color,A)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),(0,r.c)(this._mainLight.direction,e.mainLight.direction),(0,r.c)(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,t,n){if((0,r.o)(this._mainLight.intensity,e.mainLight.intensity,t.mainLight.intensity,n),this._mainLight.environmentStrength=(0,i.Cc)(e.mainLight.environmentStrength,t.mainLight.environmentStrength,n),this._mainLight.specularStrength=(0,i.Cc)(e.mainLight.specularStrength,t.mainLight.specularStrength,n),(0,r.c)(this._mainLight.direction,t.mainLight.direction),this._mainLight.castShadows=t.mainLight.castShadows,this.globalFactor=(0,i.Cc)(e.globalFactor,t.globalFactor,n),this.noonFactor=(0,i.Cc)(e.noonFactor,t.noonFactor,n),e.sh.r.length===t.sh.r.length)for(let r=0;r<t.sh.r.length;r++)this._sphericalHarmonics.r[r]=(0,i.Cc)(e.sh.r[r],t.sh.r[r],n),this._sphericalHarmonics.g[r]=(0,i.Cc)(e.sh.g[r],t.sh.g[r],n),this._sphericalHarmonics.b[r]=(0,i.Cc)(e.sh.b[r],t.sh.b[r],n);else for(let e=0;e<t.sh.r.length;e++)this._sphericalHarmonics.r[e]=t.sh.r[e],this._sphericalHarmonics.g[e]=t.sh.g[e],this._sphericalHarmonics.b[e]=t.sh.b[e]}}const A=(0,s.vt)()},48042:function(e,t,n){"use strict";n.d(t,{v:function(){return C}});var i=n(58941),r=n(41546),s=n(65856),o=n(27264),a=n(54407),l=n(4875),c=n(46921),u=n(29165),h=n(65839),d=n(84264),p=n(27291),f=n(77971),m=n(34615),g=n(22542),_=n(40502),v=n(54101),y=n(6200),b=n(55890),T=n(38474),E=n(85456),x=n(57087);f.S;class S extends g.w{initializeProgram(e){return new v.B(e.rctx,S.shader.get().build(this.configuration),_.D)}_createPipeline(e,t){const n=this.configuration,i=e===b.y.NONE,r=e===b.y.FrontFace;return(0,x.Ey)({blending:n.output===o.V.Color&&n.transparent?i?c.V0:(0,c.ez)(e):null,culling:(0,x.Xt)(n.cullFace),depthTest:n.draped?null:{func:(0,c.K_)(e)},depthWrite:n.draped?null:(i||r)&&n.writeDepth?x.kn:null,drawBuffers:n.output===o.V.Depth?{buffers:[E.Hr.NONE]}:(0,c.cl)(e),colorWrite:x.wE,stencilWrite:n.hasOccludees?y.v0:null,stencilTest:n.hasOccludees?t?y.a9:y.qh:null,polygonOffset:i||r?n.polygonOffset?w:null:(0,c.aB)(n.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}S.shader=new m.$(T.C,(()=>n.e(2523).then(n.bind(n,62970))));const w={factor:1,units:1};var A=n(53804),M=n(8610),O=n(46121);class R extends O.E{constructor(){super(...arguments),this.output=o.V.Color,this.cullFace=a.s2.None,this.transparencyPassType=b.y.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1,this.draped=!1}}(0,A._)([(0,M.W)({count:o.V.COUNT})],R.prototype,"output",void 0),(0,A._)([(0,M.W)({count:a.s2.COUNT})],R.prototype,"cullFace",void 0),(0,A._)([(0,M.W)({count:b.y.COUNT})],R.prototype,"transparencyPassType",void 0),(0,A._)([(0,M.W)()],R.prototype,"hasSlicePlane",void 0),(0,A._)([(0,M.W)()],R.prototype,"hasVertexColors",void 0),(0,A._)([(0,M.W)()],R.prototype,"transparent",void 0),(0,A._)([(0,M.W)()],R.prototype,"polygonOffset",void 0),(0,A._)([(0,M.W)()],R.prototype,"enableOffset",void 0),(0,A._)([(0,M.W)()],R.prototype,"writeDepth",void 0),(0,A._)([(0,M.W)()],R.prototype,"hasOccludees",void 0),(0,A._)([(0,M.W)()],R.prototype,"multipassEnabled",void 0),(0,A._)([(0,M.W)()],R.prototype,"cullAboveGround",void 0),(0,A._)([(0,M.W)()],R.prototype,"objectAndLayerIdColorInstanced",void 0),(0,A._)([(0,M.W)()],R.prototype,"vvColor",void 0),(0,A._)([(0,M.W)()],R.prototype,"draped",void 0),(0,A._)([(0,M.W)({constValue:!1})],R.prototype,"occlusionPass",void 0),(0,A._)([(0,M.W)({constValue:!0})],R.prototype,"hasVvInstancing",void 0),(0,A._)([(0,M.W)({constValue:!1})],R.prototype,"vvSize",void 0),(0,A._)([(0,M.W)({constValue:!1})],R.prototype,"vvOpacity",void 0);class C extends p.W{constructor(e){super(e,new P),this.supportsEdges=!0,this.produces=new Map([[u.N.OPAQUE_MATERIAL,e=>e===o.V.Highlight||(0,o.zW)(e)&&!this._isTransparent],[u.N.OPAQUE_NO_SSAO_DEPTH,e=>(0,o.eh)(e)&&this.parameters.writeLinearDepth&&!this._isTransparent],[u.N.TRANSPARENT_MATERIAL,e=>(0,o.zW)(e)&&this._isTransparent&&this.parameters.writeDepth],[u.N.TRANSPARENT_NO_SSAO_DEPTH,e=>(0,o.eh)(e)&&this.parameters.writeLinearDepth&&this._isTransparent&&this.parameters.writeDepth],[u.N.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,e=>((0,o.zW)(e)||(0,o.eh)(e)&&this.parameters.writeLinearDepth)&&this._isTransparent&&!this.parameters.writeDepth],[u.N.DRAPED_MATERIAL,e=>(0,o.i3)(e)]]),this._configuration=new R}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<c.xt,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}createGLMaterial(e){return new I(e)}createBufferWriter(){const e=(0,s.BP)().vec3f(h.r.POSITION);return(0,i.A)("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(h.r.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(h.r.COLORFEATUREATTRIBUTE):e.vec4u8(h.r.COLOR),new d.Z(e)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}}class I extends l.A{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===o.V.Color&&this._updateOccludeeState(e),this.ensureTechnique(S,e)}}class P extends f.S{constructor(){super(...arguments),this.color=r.uY,this.forceTransparentMode=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=a.s2.None,this.hasOccludees=!1,this.draped=!1}}},84264:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var i=n(65839),r=n(93678);class s{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.attributes.get(i.r.POSITION).indices.length}write(e,t,n,i,s){(0,r.SA)(n,this.vertexBufferLayout,e,t,i,s)}}},73318:function(e,t,n){"use strict";n.d(t,{Ci:function(){return s},Dq:function(){return l},dB:function(){return a},zK:function(){return o}});var i=n(65856),r=n(65839);const s=(0,i.BP)().vec3f(r.r.POSITION),o=(0,i.BP)().vec3f(r.r.POSITION).vec2f(r.r.UV0),a=(0,i.BP)().vec3f(r.r.POSITION).vec4u8(r.r.COLOR),l=(0,i.BP)().vec3f(r.r.POSITION).vec2f(r.r.UV0).vec4u8(r.r.OBJECTANDLAYERIDCOLOR)},46121:function(e,t,n){"use strict";n.d(t,{E:function(){return a}});var i=n(53804),r=n(14812),s=n(54516),o=n(8610);class a extends r.nW{}(0,i._)([(0,o.W)({constValue:!0})],a.prototype,"hasSliceHighlight",void 0),(0,i._)([(0,o.W)({constValue:!1})],a.prototype,"hasSliceInVertexProgram",void 0),(0,i._)([(0,o.W)({constValue:s.c.Pass})],a.prototype,"pbrTextureBindType",void 0)},6955:function(e,t,n){"use strict";n.d(t,{R:function(){return Z}});var i=n(58941),r=n(15774),s=n(44705),o=n(87725),a=n(73364),l=n(39714),c=n(1932),u=n(20551),h=n(32501),d=n(41546);var p=n(87416),f=n(92754),m=n(24129),g=n(70974),_=n(65856),v=n(27264),y=n(1143),b=n(36634),T=n(24100),E=n(29165),x=n(54035),S=n(90553),w=n(65839);class A{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}}var M=n(93678),O=n(84887),R=n(88008),C=n(65420),I=n(34615),P=n(22542),D=n(40502),L=n(46921),N=n(54101),F=n(55890),z=n(85456),V=n(57087);class H extends P.w{initializeConfiguration(e,t){t.spherical=e.viewingMode===C.RT.Global}initializeProgram(e){return new N.B(e.rctx,H.shader.get().build(this.configuration),D.D)}initializePipeline(){const e=this.configuration.transparencyPassType,t=this.configuration,n=e===F.y.NONE,i=e===F.y.FrontFace,r=this.configuration.hasPolygonOffset?U:null,s=t.draped?null:(n||i)&&t.output!==v.V.Highlight&&(t.depthEnabled||t.occlusionPass)?V.kn:null;return(0,V.Ey)({blending:t.output===v.V.Color||t.output===v.V.Highlight?n?k:(0,L.ez)(e):null,depthTest:t.draped?null:{func:z.MT.LEQUAL},depthWrite:s,drawBuffers:(0,L.cl)(e),colorWrite:V.wE,polygonOffset:r})}get primitiveType(){return this.configuration.occlusionPass?z.WR.POINTS:z.WR.TRIANGLES}}H.shader=new I.$(R.H,(()=>n.e(8121).then(n.bind(n,47416))));const U={factor:0,units:-4},k=(0,V.ox)(z.dn.ONE,z.dn.ONE_MINUS_SRC_ALPHA);var j=n(53804),G=n(8610),B=n(46121);class $ extends B.E{constructor(){super(...arguments),this.output=v.V.Color,this.transparencyPassType=F.y.NONE,this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}}(0,j._)([(0,G.W)({count:v.V.COUNT})],$.prototype,"output",void 0),(0,j._)([(0,G.W)({count:F.y.COUNT})],$.prototype,"transparencyPassType",void 0),(0,j._)([(0,G.W)()],$.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,j._)([(0,G.W)()],$.prototype,"spherical",void 0),(0,j._)([(0,G.W)()],$.prototype,"occlusionTestEnabled",void 0),(0,j._)([(0,G.W)()],$.prototype,"signedDistanceFieldEnabled",void 0),(0,j._)([(0,G.W)()],$.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),(0,j._)([(0,G.W)()],$.prototype,"vvSize",void 0),(0,j._)([(0,G.W)()],$.prototype,"vvColor",void 0),(0,j._)([(0,G.W)()],$.prototype,"hasVerticalOffset",void 0),(0,j._)([(0,G.W)()],$.prototype,"hasScreenSizePerspective",void 0),(0,j._)([(0,G.W)()],$.prototype,"debugDrawLabelBorder",void 0),(0,j._)([(0,G.W)()],$.prototype,"hasSlicePlane",void 0),(0,j._)([(0,G.W)()],$.prototype,"hasPolygonOffset",void 0),(0,j._)([(0,G.W)()],$.prototype,"depthEnabled",void 0),(0,j._)([(0,G.W)()],$.prototype,"pixelSnappingEnabled",void 0),(0,j._)([(0,G.W)()],$.prototype,"draped",void 0),(0,j._)([(0,G.W)()],$.prototype,"multipassEnabled",void 0),(0,j._)([(0,G.W)()],$.prototype,"cullAboveGround",void 0),(0,j._)([(0,G.W)()],$.prototype,"occlusionPass",void 0),(0,j._)([(0,G.W)()],$.prototype,"objectAndLayerIdColorInstanced",void 0),(0,j._)([(0,G.W)({constValue:!0})],$.prototype,"hasSliceInVertexProgram",void 0),(0,j._)([(0,G.W)({constValue:!1})],$.prototype,"hasVvInstancing",void 0);class Z extends T.im{constructor(e){super(e,new pe),this._configuration=new $,this.produces=new Map([[E.N.HUD_MATERIAL,e=>(0,v.dX)(e)&&!this.parameters.drawInSecondSlot],[E.N.LABEL_MATERIAL,e=>(0,v.dX)(e)&&this.parameters.drawInSecondSlot],[E.N.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[E.N.DRAPED_MATERIAL,e=>(0,v.dX)(e)]])}getConfiguration(e,t){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.draped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=t.slot===E.N.OCCLUSION_PIXELS&&this.parameters.occlusionTest,e===v.V.Color&&(this._configuration.debugDrawLabelBorder=!!g.b.LABELS_SHOW_BORDER),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,t,n,i,r,o){if(!(n.options.selectionMode&&n.options.hud&&e.visible&&n.point))return;const l=this.parameters,c=n.point,d=n.camera;let{scaleX:p,scaleY:f}=this._getScreenScale(e);p*=d.pixelRatio,f*=d.pixelRatio,(0,s.z0)(ne,t),e.attributes.has(w.r.FEATUREATTRIBUTE)&&function(e){const t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=1/Math.sqrt(t*t+n*n+i*i),h=1/Math.sqrt(r*r+s*s+o*o),d=1/Math.sqrt(a*a+l*l+c*c);e[0]=t*u,e[1]=n*u,e[2]=i*u,e[3]=r*h,e[4]=s*h,e[5]=o*h,e[6]=a*d,e[7]=l*d,e[8]=c*d}(ne);const m=e.attributes.get(w.r.POSITION),g=e.attributes.get(w.r.SIZE),_=e.attributes.get(w.r.NORMAL),v=e.attributes.get(w.r.CENTEROFFSETANDDISTANCE);(0,S.vA)(m.size>=3);const y=(0,R.c)(l),b="screen"===this.parameters.centerOffsetUnits;for(let e=0;e<m.data.length/m.size;e++){const i=e*m.size;(0,u.s)(K,m.data[i],m.data[i+1],m.data[i+2]),(0,u.h)(K,K,t);const r=e*g.size;he[0]=g.data[r]*p,he[1]=g.data[r+1]*f,(0,u.h)(K,K,d.viewMatrix);const s=e*v.size;if((0,u.s)(se,v.data[s],v.data[s+1],v.data[s+2]),!b&&(K[0]+=se[0],K[1]+=se[1],0!==se[2])){const e=se[2];(0,u.n)(se,K),(0,u.f)(K,K,(0,u.j)(se,se,e))}const T=e*_.size;if((0,u.s)(Q,_.data[T],_.data[T+1],_.data[T+2]),q(Q,ne,d,le),this._applyVerticalOffsetTransformationView(K,le,d,Y),d.applyProjection(K,J),J[0]>-1){b&&(se[0]||se[1])&&(J[0]+=se[0]*d.pixelRatio,0!==se[1]&&(J[1]+=(0,x.m0)(se[1],Y.factorAlignment)*d.pixelRatio),d.unapplyProjection(J,K)),J[0]+=this.parameters.screenOffset[0]*d.pixelRatio,J[1]+=this.parameters.screenOffset[1]*d.pixelRatio,J[0]=Math.floor(J[0]),J[1]=Math.floor(J[1]),(0,x.MD)(he,Y.factor,he);const e=ce*d.pixelRatio;let t=0;if(l.textureIsSignedDistanceField&&(t=l.outlineSize*d.pixelRatio/2),X(c,J[0],J[1],he,e,t,l,y)){const e=n.ray;if((0,u.h)(te,K,(0,a.B8)(re,d.viewMatrix)),J[0]=c[0],J[1]=c[1],d.unprojectFromRenderScreen(J,K)){const t=(0,h.vt)();(0,u.c)(t,e.direction);const n=1/(0,u.l)(t);(0,u.j)(t,t,n),o((0,u.p)(e.origin,K)*n,t,-1,!0,1,te)}}}}}intersectDraped(e,t,n,i,r,s){const o=e.attributes.get(w.r.POSITION),a=e.attributes.get(w.r.SIZE),l=this.parameters,c=(0,R.c)(l);let{scaleX:u,scaleY:h}=this._getScreenScale(e);u*=e.screenToWorldRatio,h*=e.screenToWorldRatio;const d=ue*e.screenToWorldRatio;for(let t=0;t<o.data.length/o.size;t++){const n=t*o.size,p=o.data[n],f=o.data[n+1],m=t*a.size;he[0]=a.data[m]*u,he[1]=a.data[m+1]*h;let g=0;l.textureIsSignedDistanceField&&(g=l.outlineSize*e.screenToWorldRatio/2),X(i,p,f,he,d,g,l,c)&&r(s.dist,s.normal,-1,!1)}}createBufferWriter(){return new ge(this)}_updateScaleInfo(e,t,n){const i=this.parameters;null!=i.screenSizePerspective?(0,x.cJ)(n,t,i.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),null!=i.screenSizePerspectiveAlignment?(0,x.cJ)(n,t,i.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,t,n,i,r,s,o){const a=q(t,n,r,le);return this._applyVerticalGroundOffsetView(e,a,r,o),this._applyVerticalOffsetTransformationView(o,a,r,s),this._applyPolygonOffsetView(o,a,i[3],r,o),this._applyCenterOffsetView(o,i,o),o}applyShaderOffsetsNDC(e,t,n,i,r){return this._applyCenterOffsetNDC(e,t,n,i),null!=r&&(0,u.c)(r,i),this._applyPolygonOffsetNDC(i,t,n,i),i}_applyPolygonOffsetView(e,t,n,i,s){const o=i.aboveGround?1:-1;let a=Math.sign(n);0===a&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return(0,u.c)(s,e);const c=(0,r.qE)(Math.abs(t.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/i.viewport[2];return(0,u.j)(s,e,l>0?h:1/h),s}_applyVerticalGroundOffsetView(e,t,n,i){const r=(0,u.l)(e),s=n.aboveGround?1:-1,o=n.computeRenderPixelSizeAtDist(r)*y.R,a=(0,u.j)(K,t.normal,s*o);return(0,u.g)(i,e,a),i}_applyVerticalOffsetTransformationView(e,t,n,i){const r=this.parameters;if(!r.verticalOffset?.screenLength){if(r.screenSizePerspective||r.screenSizePerspectiveAlignment){const n=(0,u.l)(e);this._updateScaleInfo(i,n,t.cosAngle)}else i.factor.scale=1,i.factorAlignment.scale=1;return e}const s=(0,u.l)(e),o=r.screenSizePerspectiveAlignment??r.screenSizePerspective,a=(0,O.kE)(n,s,r.verticalOffset,t.cosAngle,o);return this._updateScaleInfo(i,s,t.cosAngle),(0,u.j)(t.normal,t.normal,a),(0,u.g)(e,e,t.normal)}_applyCenterOffsetView(e,t,n){const i="screen"!==this.parameters.centerOffsetUnits;return n!==e&&(0,u.c)(n,e),i&&(n[0]+=t[0],n[1]+=t[1],t[2]&&((0,u.n)(Q,n),(0,u.g)(n,n,(0,u.j)(Q,Q,t[2])))),n}_applyCenterOffsetNDC(e,t,n,i){const r="screen"!==this.parameters.centerOffsetUnits;return i!==e&&(0,u.c)(i,e),r||(i[0]+=t[0]/n.fullWidth*2,i[1]+=t[1]/n.fullHeight*2),i}_applyPolygonOffsetNDC(e,t,n,i){const r=this.parameters.shaderPolygonOffset;if(e!==i&&(0,u.c)(i,e),r){const e=n.aboveGround?1:-1,s=e*Math.sign(t[3]);i[2]-=(s||e)*r}return i}createGLMaterial(e){return new W(e)}calculateRelativeScreenBounds(e,t,n=(0,p.vt)()){return function(e,t,n,i){i[0]=e.anchorPosition[0]*-t[0]+e.screenOffset[0]*n,i[1]=e.anchorPosition[1]*-t[1]+e.screenOffset[1]*n}(this.parameters,e,t,n),n[2]=n[0]+e[0],n[3]=n[1]+e[1],n}_getScreenScale(e){const t=e.attributes.get(w.r.FEATUREATTRIBUTE);if(null==t)return{scaleX:1,scaleY:1};const n=(0,d.ci)(t.data,ae),[i,r]=(0,m.VC)(oe,this.parameters,n);return{scaleX:i,scaleY:r}}}class W extends b.m{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(H,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}}function q(e,t,n,i){return function(e){return(t=e)instanceof Float32Array&&t.length>=16||function(e){return Array.isArray(e)&&e.length>=16}(e);var t}(t)&&(t=(0,s.z0)(ie,t)),(0,u.t)(i.normal,e,t),(0,u.h)(i.normal,i.normal,n.viewInverseTransposeMatrix),i.cosAngle=(0,u.m)(ee,de),i}function X(e,t,n,i,r,s,o,a){let l=t-r-(a[0]>0?i[0]*a[0]:0),c=l+i[0]+2*r,u=n-r-(a[1]>0?i[1]*a[1]:0),h=u+i[1]+2*r;const d=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&null!=d&&(l+=i[0]*d[0],u+=i[1]*d[1],c-=i[0]*(1-d[2]),h-=i[1]*(1-d[3]),l-=s,c+=s,u-=s,h+=s),e[0]>l&&e[0]<c&&e[1]>u&&e[1]<h}const Y=new class{constructor(){this.factor=new A,this.factorAlignment=new A}},K=(0,h.vt)(),Q=(0,h.vt)(),J=(0,d.vt)(),ee=(0,h.vt)(),te=(0,h.vt)(),ne=(0,o.vt)(),ie=(0,o.vt)(),re=(0,l.vt)(),se=(0,h.vt)(),oe=(0,h.vt)(),ae=(0,d.vt)(),le={normal:ee,cosAngle:0},ce=1,ue=2,he=[0,0],de=(0,h.fA)(0,0,1);class pe extends b.N{constructor(){super(...arguments),this.renderOccluded=T.m$.Occlude,this.isDecoration=!1,this.color=(0,d.fA)(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=(0,c.fA)(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=(0,d.fA)(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.draped=!1}}const fe=(0,_.BP)().vec3f(w.r.POSITION).vec3f(w.r.NORMAL).vec2f(w.r.UV0).vec4u8(w.r.COLOR).vec2f(w.r.SIZE).vec4f(w.r.CENTEROFFSETANDDISTANCE).vec4f(w.r.FEATUREATTRIBUTE),me=fe.clone().vec4u8(w.r.OBJECTANDLAYERIDCOLOR);class ge{constructor(e){this._material=e,this.vertexBufferLayout=(0,i.A)("enable-feature:objectAndLayerId-rendering")?me:fe}elementCount(e){return 6*e.attributes.get(w.r.POSITION).indices.length}write(e,t,n,i,r){(0,M.Hk)(n.attributes.get(w.r.POSITION),e,i.position,r,6),(0,M.p1)(n.attributes.get(w.r.NORMAL),t,i.normal,r,6);const s=n.attributes.get(w.r.UV0).data;let o,a,l,c;if(null==s||s.length<4){const e=this._material.parameters;o=0,a=0,l=e.texCoordScale[0],c=e.texCoordScale[1]}else o=s[0],a=s[1],l=s[2],c=s[3];l=Math.min(1.99999,l+1),c=Math.min(1.99999,c+1);let u=n.attributes.get(w.r.POSITION).indices.length,h=r;const d=i.uv0;for(let e=0;e<u;++e)d.set(h,0,o),d.set(h,1,a),h++,d.set(h,0,l),d.set(h,1,a),h++,d.set(h,0,l),d.set(h,1,c),h++,d.set(h,0,l),d.set(h,1,c),h++,d.set(h,0,o),d.set(h,1,c),h++,d.set(h,0,o),d.set(h,1,a),h++;(0,M.tb)(n.attributes.get(w.r.COLOR),4,i.color,r,6);const{data:p,indices:m}=n.attributes.get(w.r.SIZE);u=m.length;const g=i.size;h=r;for(let e=0;e<u;++e){const t=p[2*m[e]],n=p[2*m[e]+1];for(let e=0;e<6;++e)g.set(h,0,t),g.set(h,1,n),h++}if(n.attributes.get(w.r.CENTEROFFSETANDDISTANCE)?(0,M.Ut)(n.attributes.get(w.r.CENTEROFFSETANDDISTANCE),i.centerOffsetAndDistance,r,6):(0,M.Pq)(i.centerOffsetAndDistance,r,6*u),n.attributes.get(w.r.FEATUREATTRIBUTE)?(0,M.Ut)(n.attributes.get(w.r.FEATUREATTRIBUTE),i.featureAttribute,r,6):(0,M.Pq)(i.featureAttribute,r,6*u),null!=n.objectAndLayerIdColor){const e=n.attributes.get(w.r.POSITION)?.indices;if(e){const t=e.length,s=i.getField(w.r.OBJECTANDLAYERIDCOLOR,f.XP);(0,M.tH)(n.objectAndLayerIdColor,s,t,r,6)}}}}},65352:function(e,t,n){"use strict";n.d(t,{W:function(){return V}});var i=n(58941),r=n(40633),s=n(15774),o=n(13520),a=n(13786),l=n(20551),c=n(32501),u=n(41546),h=n(69508),d=n(73313),p=n(5596),f=n(65856),m=n(27264),g=n(4875),_=n(24100),v=n(29165),y=n(90553),b=n(65839),T=n(77971),E=n(50678),x=n(35904),S=n(34615),w=n(22542),A=n(46921),M=n(54101),O=n(6200),R=n(55890),C=n(85456),I=n(57087);const P=new Map([[b.r.POSITION,0],[b.r.PREVPOSITION,1],[b.r.NEXTPOSITION,2],[b.r.SUBDIVISIONFACTOR,3],[b.r.UV0,4],[b.r.COLOR,5],[b.r.COLORFEATUREATTRIBUTE,5],[b.r.SIZE,6],[b.r.SIZEFEATUREATTRIBUTE,6],[b.r.OPACITYFEATUREATTRIBUTE,7],[b.r.OBJECTANDLAYERIDCOLOR,8]]);class D extends w.w{initializeProgram(e){return new M.B(e.rctx,D.shader.get().build(this.configuration),P)}_makePipelineState(e,t){const n=this.configuration,i=e===R.y.NONE,r=e===R.y.FrontFace,s=(0,m.cb)(n.output);return(0,I.Ey)({blending:n.output===m.V.Color?i?A.V0:(0,A.ez)(e):null,depthTest:{func:(0,A.K_)(e)},depthWrite:i?n.writeDepth||s?I.kn:null:(0,A.XO)(e),drawBuffers:n.output===m.V.Depth?{buffers:[C.Hr.NONE]}:(0,A.cl)(e),colorWrite:I.wE,stencilWrite:n.hasOccludees?O.v0:null,stencilTest:n.hasOccludees?t?O.a9:O.qh:null,polygonOffset:i||r?n.hasPolygonOffset?L:null:A.SE})}initializePipeline(){const e=this.configuration;if(e.occluder){const t=e.hasPolygonOffset?L:null;this._occluderPipelineTransparent=(0,I.Ey)({blending:A.V0,polygonOffset:t,depthTest:O.sf,depthWrite:null,colorWrite:I.wE,stencilWrite:null,stencilTest:O.mK,drawBuffers:e.output===m.V.Depth?{buffers:[C.Hr.NONE]}:null}),this._occluderPipelineOpaque=(0,I.Ey)({blending:A.V0,polygonOffset:t,depthTest:O.sf,depthWrite:null,colorWrite:I.wE,stencilWrite:O.r8,stencilTest:O.I$,drawBuffers:e.output===m.V.Depth?{buffers:[C.Hr.NONE]}:null}),this._occluderPipelineMaskWrite=(0,I.Ey)({blending:null,polygonOffset:t,depthTest:O.m,depthWrite:null,colorWrite:null,stencilWrite:O.v0,stencilTest:O.a9,drawBuffers:e.output===m.V.Depth?{buffers:[C.Hr.NONE]}:null})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?C.WR.LINES:C.WR.TRIANGLE_STRIP}getPipeline(e,t,n){return e?this._occludeePipelineState:this.configuration.occluder?n?this._occluderPipelineTransparent:t?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}}D.shader=new S.$(x.R,(()=>n.e(3569).then(n.bind(n,75312))));const L={factor:0,units:-4};var N,F,z=n(95736);(F=N||(N={}))[F.LEFT_JOIN_START=-2]="LEFT_JOIN_START",F[F.LEFT_JOIN_END=-1]="LEFT_JOIN_END",F[F.LEFT_CAP_START=-4]="LEFT_CAP_START",F[F.LEFT_CAP_END=-5]="LEFT_CAP_END",F[F.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",F[F.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",F[F.RIGHT_CAP_START=4]="RIGHT_CAP_START",F[F.RIGHT_CAP_END=5]="RIGHT_CAP_END";class V extends _.im{constructor(e){super(e,new U),this._configuration=new z.Q,this.produces=new Map([[v.N.OPAQUE_MATERIAL,e=>e===m.V.Highlight||e===m.V.ObjectAndLayerIdColor||e===m.V.Color&&this.parameters.renderOccluded===_.m$.OccludeAndTransparentStencil],[v.N.OPAQUE_NO_SSAO_DEPTH,e=>(0,m.eh)(e)],[v.N.OCCLUDER_MATERIAL,e=>(0,m.MO)(e)&&this.parameters.renderOccluded===_.m$.OccludeAndTransparentStencil],[v.N.TRANSPARENT_OCCLUDER_MATERIAL,e=>(0,m.MO)(e)&&this.parameters.renderOccluded===_.m$.OccludeAndTransparentStencil],[v.N.TRANSPARENT_MATERIAL,e=>e===m.V.Color&&this.parameters.writeDepth&&this.parameters.renderOccluded!==_.m$.OccludeAndTransparentStencil],[v.N.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,e=>e===m.V.Color&&!this.parameters.writeDepth&&this.parameters.renderOccluded!==_.m$.OccludeAndTransparentStencil],[v.N.DRAPED_MATERIAL,e=>(0,m.i3)(e)]]),this._vertexAttributeLocations=P}getConfiguration(e,t){this._configuration.output=e,this._configuration.draped=t.slot===v.N.DRAPED_MATERIAL;const n=null!=this.parameters.stipplePattern&&e!==m.V.Highlight;return this._configuration.stippleEnabled=n,this._configuration.stippleOffColorEnabled=n&&null!=this.parameters.stippleOffColor,this._configuration.stipplePreferContinuous=n&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins="round"===this.parameters.join,this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=null!=this.parameters.markerParameters&&function(e){return e.anchor===E.kJ.Tip&&e.hideOnShortSegments&&"begin-end"===e.placement&&e.worldSpace}(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&null!=this.parameters.innerColor,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===_.m$.OccludeAndTransparentStencil,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,t,n,i,r,o){if(!n.options.selectionMode)return;const a=e.attributes.get(b.r.POSITION).data,l=e.attributes.get(b.r.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const t=e.attributes.get(b.r.SIZEFEATUREATTRIBUTE).data[0];c*=(0,s.qE)(this.parameters.vvSize.offset[0]+t*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const u=i[0],h=i[1],d=(c/2+4)*e.screenToWorldRatio;let p=Number.MAX_VALUE,f=0;for(let e=0;e<a.length-5;e+=3){const t=a[e],n=a[e+1],i=u-t,r=h-n,o=a[e+3]-t,l=a[e+4]-n,c=(0,s.qE)((o*i+l*r)/(o*o+l*l),0,1),d=o*c-i,m=l*c-r,g=d*d+m*m;g<p&&(p=g,f=e/3)}p<d*d&&r(o.dist,o.normal,f,!1)}intersect(e,t,n,i,o,c){if(!n.options.selectionMode||!e.visible)return;if(!(0,y.zH)(t))return void r.A.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const u=e.attributes,f=u.get(b.r.POSITION).data;let m=this.parameters.width;if(this.parameters.vvSize){const e=u.get(b.r.SIZEFEATUREATTRIBUTE).data[0];m*=(0,s.qE)(this.parameters.vvSize.offset[0]+e*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else u.has(b.r.SIZE)&&(m*=u.get(b.r.SIZE).data[0]);const g=n.camera,_=q;(0,a.C)(_,n.point);const v=m*g.pixelRatio/2+4*g.pixelRatio;(0,l.s)(re[0],_[0]-v,_[1]+v,0),(0,l.s)(re[1],_[0]+v,_[1]+v,0),(0,l.s)(re[2],_[0]+v,_[1]-v,0),(0,l.s)(re[3],_[0]-v,_[1]-v,0);for(let e=0;e<4;e++)if(!g.unprojectFromRenderScreen(re[e],se[e]))return;(0,p.Cr)(g.eye,se[0],se[1],oe),(0,p.Cr)(g.eye,se[1],se[2],ae),(0,p.Cr)(g.eye,se[2],se[3],le),(0,p.Cr)(g.eye,se[3],se[0],ce);let T=Number.MAX_VALUE,E=0;const x=G(this.parameters,u)?f.length-2:f.length-5;for(let e=0;e<x;e+=3){B[0]=f[e]+t[12],B[1]=f[e+1]+t[13],B[2]=f[e+2]+t[14];const n=(e+3)%f.length;if($[0]=f[n]+t[12],$[1]=f[n+1]+t[13],$[2]=f[n+2]+t[14],(0,p.mN)(oe,B)<0&&(0,p.mN)(oe,$)<0||(0,p.mN)(ae,B)<0&&(0,p.mN)(ae,$)<0||(0,p.mN)(le,B)<0&&(0,p.mN)(le,$)<0||(0,p.mN)(ce,B)<0&&(0,p.mN)(ce,$)<0)continue;if(g.projectToRenderScreen(B,X),g.projectToRenderScreen($,Y),X[2]<0&&Y[2]>0){(0,l.f)(Z,B,$);const e=g.frustum,t=-(0,p.mN)(e[h.FB.NEAR],B)/(0,l.m)(Z,(0,p.Qj)(e[h.FB.NEAR]));(0,l.j)(Z,Z,t),(0,l.g)(B,B,Z),g.projectToRenderScreen(B,X)}else if(X[2]>0&&Y[2]<0){(0,l.f)(Z,$,B);const e=g.frustum,t=-(0,p.mN)(e[h.FB.NEAR],$)/(0,l.m)(Z,(0,p.Qj)(e[h.FB.NEAR]));(0,l.j)(Z,Z,t),(0,l.g)($,$,Z),g.projectToRenderScreen($,Y)}else if(X[2]<0&&Y[2]<0)continue;X[2]=0,Y[2]=0;const i=(0,d.kb)((0,d.Cr)(X,Y,J),_);i<T&&(T=i,(0,l.c)(K,B),(0,l.c)(Q,$),E=e/3)}const S=n.rayBegin,w=n.rayEnd;if(T<v*v){let e=Number.MAX_VALUE;if((0,d.ld)((0,d.Cr)(K,Q,J),(0,d.Cr)(S,w,ee),W)){(0,l.f)(W,W,S);const t=(0,l.l)(W);(0,l.j)(W,W,1/t),e=t/(0,l.p)(S,w)}c(e,W,E,!1)}}get _layout(){const e=(0,f.BP)().vec3f(b.r.POSITION).vec3f(b.r.PREVPOSITION).vec3f(b.r.NEXTPOSITION).f32(b.r.SUBDIVISIONFACTOR).vec2f(b.r.UV0);return this.parameters.vvSize?e.f32(b.r.SIZEFEATUREATTRIBUTE):e.f32(b.r.SIZE),this.parameters.vvColor?e.f32(b.r.COLORFEATUREATTRIBUTE):e.vec4f(b.r.COLOR),this.parameters.vvOpacity&&e.f32(b.r.OPACITYFEATUREATTRIBUTE),(0,i.A)("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(b.r.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new k(this._layout,this.parameters)}createGLMaterial(e){return new H(e)}validateParameters(e){"miter"!==e.join&&(e.miterLimit=0),null!=e.markerParameters&&(e.markerScale=e.markerParameters.width/e.width)}}class H extends g.A{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextures.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===m.V.Color&&this._updateOccludeeState(e);const t=this._material.parameters.stipplePattern;return this._stipplePattern!==t&&(this._material.setParameters({stippleTexture:this._stippleTextures.swap(t,this._stipplePattern)}),this._stipplePattern=t),this.ensureTechnique(D,e)}}class U extends T.S{constructor(){super(...arguments),this.width=0,this.color=u.Un,this.join="miter",this.cap=z.x.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}}class k{constructor(e,t){this.vertexBufferLayout=e,this._parameters=t,this.numJoinSubdivisions=0;const n=t.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=n;break;case"round":this.numJoinSubdivisions=x.r+n}}_isClosed(e){return G(this._parameters,e.attributes)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const t=e.attributes.get(b.r.POSITION).indices.length/2+1,n=this._isClosed(e);let i=n?2:4;return i+=((n?t:t-1)-(n?0:1))*(2*this.numJoinSubdivisions+4),i+=2,this._parameters.wireframe&&(i=2+4*(i-2)),i}write(e,t,n,r,s){const o=te,a=ne,c=ie,u=n.attributes.get(b.r.POSITION),h=u.indices,d=u.data.length/3,p=n.attributes.get(b.r.DISTANCETOSTART)?.data;h&&h.length!==2*(d-1)&&console.warn("RibbonLineMaterial does not support indices");const f=n.attributes.get(b.r.SIZEFEATUREATTRIBUTE)?.data[0]??n.attributes.get(b.r.SIZE)?.data[0]??1;let m=[1,1,1,1],g=0;const _=this.vertexBufferLayout.fields.has(b.r.COLORFEATUREATTRIBUTE);_?g=n.attributes.get(b.r.COLORFEATUREATTRIBUTE).data[0]:n.attributes.has(b.r.COLOR)&&(m=n.attributes.get(b.r.COLOR).data);const v=(0,i.A)("enable-feature:objectAndLayerId-rendering")?n.objectAndLayerIdColor:null,y=this.vertexBufferLayout.fields.has(b.r.OPACITYFEATUREATTRIBUTE),T=y?n.attributes.get(b.r.OPACITYFEATUREATTRIBUTE).data[0]:0,E=new Float32Array(r.buffer),x=(0,i.A)("enable-feature:objectAndLayerId-rendering")?new Uint8Array(r.buffer):null,S=this.vertexBufferLayout.stride/4;let w=s*S;const A=w;let M=0;const O=p?(e,t,n)=>M=p[n]:(e,t,n)=>M+=(0,l.p)(e,t),R=(0,i.A)("enable-feature:objectAndLayerId-rendering"),C=(e,t,n,i,r,s,o)=>{if(E[w++]=t[0],E[w++]=t[1],E[w++]=t[2],E[w++]=e[0],E[w++]=e[1],E[w++]=e[2],E[w++]=n[0],E[w++]=n[1],E[w++]=n[2],E[w++]=i,E[w++]=o,E[w++]=r,E[w++]=f,_)E[w++]=g;else{const e=Math.min(4*s,m.length-4);E[w++]=m[e],E[w++]=m[e+1],E[w++]=m[e+2],E[w++]=m[e+3]}y&&(E[w++]=T),R&&(null!=v&&(x[4*w]=v[0],x[4*w+1]=v[1],x[4*w+2]=v[2],x[4*w+3]=v[3]),w++)};w+=S,(0,l.s)(a,u.data[0],u.data[1],u.data[2]),e&&(0,l.h)(a,a,e);const I=this._isClosed(n);if(I){const t=u.data.length-3;(0,l.s)(o,u.data[t],u.data[t+1],u.data[t+2]),e&&(0,l.h)(o,o,e)}else(0,l.s)(c,u.data[3],u.data[4],u.data[5]),e&&(0,l.h)(c,c,e),C(a,a,c,1,N.LEFT_CAP_START,0,0),C(a,a,c,1,N.RIGHT_CAP_START,0,0),(0,l.c)(o,a),(0,l.c)(a,c);const P=I?0:1,D=I?d:d-1;for(let t=P;t<D;t++){const n=(t+1)%d*3;(0,l.s)(c,u.data[n],u.data[n+1],u.data[n+2]),e&&(0,l.h)(c,c,e),O(o,a,t),C(o,a,c,0,N.LEFT_JOIN_END,t,M),C(o,a,c,0,N.RIGHT_JOIN_END,t,M);const i=this.numJoinSubdivisions;for(let e=0;e<i;++e){const n=(e+1)/(i+1);C(o,a,c,n,N.LEFT_JOIN_END,t,M),C(o,a,c,n,N.RIGHT_JOIN_END,t,M)}C(o,a,c,1,N.LEFT_JOIN_START,t,M),C(o,a,c,1,N.RIGHT_JOIN_START,t,M),(0,l.c)(o,a),(0,l.c)(a,c)}I?((0,l.s)(c,u.data[3],u.data[4],u.data[5]),e&&(0,l.h)(c,c,e),M=O(o,a,D),C(o,a,c,0,N.LEFT_JOIN_END,P,M),C(o,a,c,0,N.RIGHT_JOIN_END,P,M)):(M=O(o,a,D),C(o,a,a,0,N.LEFT_CAP_END,D,M),C(o,a,a,0,N.RIGHT_CAP_END,D,M)),j(E,A+S,E,A,S),w=j(E,w-S,E,w,S),this._parameters.wireframe&&this._addWireframeVertices(r,A,w,S)}_addWireframeVertices(e,t,n,i){const r=new Float32Array(e.buffer,n*Float32Array.BYTES_PER_ELEMENT),s=new Float32Array(e.buffer,t*Float32Array.BYTES_PER_ELEMENT,n-t);let o=0;const a=e=>o=j(s,e,r,o,i);for(let e=0;e<s.length-1;e+=2*i)a(e),a(e+2*i),a(e+1*i),a(e+2*i),a(e+1*i),a(e+3*i)}}function j(e,t,n,i,r){for(let s=0;s<r;s++)n[i++]=e[t++];return i}function G(e,t){return!!e.isClosed&&t.get(b.r.POSITION).indices.length>2}const B=(0,c.vt)(),$=(0,c.vt)(),Z=(0,c.vt)(),W=(0,c.vt)(),q=(0,c.vt)(),X=(0,o.r_)(),Y=(0,o.r_)(),K=(0,c.vt)(),Q=(0,c.vt)(),J=(0,d.vt)(),ee=(0,d.vt)(),te=(0,c.vt)(),ne=(0,c.vt)(),ie=(0,c.vt)(),re=[(0,o.r_)(),(0,o.r_)(),(0,o.r_)(),(0,o.r_)()],se=[(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)()],oe=(0,p.vt)(),ae=(0,p.vt)(),le=(0,p.vt)(),ce=(0,p.vt)()},27291:function(e,t,n){"use strict";n.d(t,{W:function(){return s}});var i=n(24100),r=n(45079);class s extends i.im{intersect(e,t,n,i,s,o){return(0,r.Uy)(e,n,i,s,void 0,o)}}},77971:function(e,t,n){"use strict";n.d(t,{S:function(){return s},p:function(){return o}});var i=n(24129),r=n(24100);class s extends i.Gd{constructor(){super(...arguments),this.renderOccluded=r.m$.Occlude,this.isDecoration=!1}}const o=8},84887:function(e,t,n){"use strict";n.d(t,{MB:function(){return l},Um:function(){return u},kE:function(){return o},qu:function(){return a}});var i=n(50659),r=n(15774),s=n(54035);function o(e,t,n,i,o){let a=(n.screenLength||0)*e.pixelRatio;null!=o&&(a=(0,s.hs)(a,i,t,o));const l=a*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return(0,r.qE)(l*t,n.minWorldLength||0,null!=n.maxWorldLength?n.maxWorldLength:1/0)}function a(e,t){const n=t?a(t):{};for(const t in e){let i=e[t];i?.forEach&&(i=c(i)),null==i&&t in n||(n[t]=i)}return n}function l(e,t){let n=!1;for(const r in t){const s=t[r];void 0!==s&&(Array.isArray(s)?null===e[r]?(e[r]=s.slice(),n=!0):(0,i.yo)(e[r],s)&&(n=!0):e[r]!==s&&(n=!0,e[r]=s))}return n}function c(e){const t=[];return e.forEach((e=>t.push(e))),t}const u={multiply:1,ignore:2,replace:3,tint:4}},93678:function(e,t,n){"use strict";n.d(t,{Hk:function(){return d},Pq:function(){return h},SA:function(){return g},Ut:function(){return u},p1:function(){return p},tH:function(){return m},tb:function(){return f},uO:function(){return a},zC:function(){return _}});var i=n(73364),r=n(92754),s=n(90553),o=n(65839);function a(e,t,n,i=1){const{data:r,indices:s}=e,o=t.typedBuffer,a=t.typedBufferStride,l=s.length;if(n*=a,1===i)for(let e=0;e<l;++e)o[n]=r[s[e]],n+=a;else for(let e=0;e<l;++e){const t=r[s[e]];for(let e=0;e<i;e++)o[n]=t,n+=a}}function l(e,t,n){const{data:i,indices:r}=e,s=t.typedBuffer,o=t.typedBufferStride,a=r.length;n*=o;for(let e=0;e<a;++e){const t=2*r[e];s[n]=i[t],s[n+1]=i[t+1],n+=o}}function c(e,t,n,i){const{data:r,indices:s}=e,o=t.typedBuffer,a=t.typedBufferStride,l=s.length;if(n*=a,null==i||1===i)for(let e=0;e<l;++e){const t=3*s[e];o[n]=r[t],o[n+1]=r[t+1],o[n+2]=r[t+2],n+=a}else for(let e=0;e<l;++e){const t=3*s[e];for(let e=0;e<i;++e)o[n]=r[t],o[n+1]=r[t+1],o[n+2]=r[t+2],n+=a}}function u(e,t,n,i=1){const{data:r,indices:s}=e,o=t.typedBuffer,a=t.typedBufferStride,l=s.length;if(n*=a,1===i)for(let e=0;e<l;++e){const t=4*s[e];o[n]=r[t],o[n+1]=r[t+1],o[n+2]=r[t+2],o[n+3]=r[t+3],n+=a}else for(let e=0;e<l;++e){const t=4*s[e];for(let e=0;e<i;++e)o[n]=r[t],o[n+1]=r[t+1],o[n+2]=r[t+2],o[n+3]=r[t+3],n+=a}}function h(e,t,n){const i=e.typedBuffer,r=e.typedBufferStride;t*=r;for(let e=0;e<n;++e)i[t]=0,i[t+1]=0,i[t+2]=0,i[t+3]=0,t+=r}function d(e,t,n,r,s=1){if(!t)return void c(e,n,r,s);const{data:o,indices:a}=e,l=n.typedBuffer,u=n.typedBufferStride,h=a.length,d=t[0],p=t[1],f=t[2],m=t[4],g=t[5],_=t[6],v=t[8],y=t[9],b=t[10],T=t[12],E=t[13],x=t[14];r*=u;let S=0,w=0,A=0;const M=(0,i.tZ)(t)?e=>{S=o[e]+T,w=o[e+1]+E,A=o[e+2]+x}:e=>{const t=o[e],n=o[e+1],i=o[e+2];S=d*t+m*n+v*i+T,w=p*t+g*n+y*i+E,A=f*t+_*n+b*i+x};if(1===s)for(let e=0;e<h;++e)M(3*a[e]),l[r]=S,l[r+1]=w,l[r+2]=A,r+=u;else for(let e=0;e<h;++e){M(3*a[e]);for(let e=0;e<s;++e)l[r]=S,l[r+1]=w,l[r+2]=A,r+=u}}function p(e,t,n,r,s=1){if(!t)return void c(e,n,r,s);const{data:o,indices:a}=e,l=t,u=n.typedBuffer,h=n.typedBufferStride,d=a.length,p=l[0],f=l[1],m=l[2],g=l[4],_=l[5],v=l[6],y=l[8],b=l[9],T=l[10],E=!(0,i.ut)(l),x=1e-6,S=1-x;r*=h;let w=0,A=0,M=0;const O=(0,i.tZ)(l)?e=>{w=o[e],A=o[e+1],M=o[e+2]}:e=>{const t=o[e],n=o[e+1],i=o[e+2];w=p*t+g*n+y*i,A=f*t+_*n+b*i,M=m*t+v*n+T*i};if(1===s)if(E)for(let e=0;e<d;++e){O(3*a[e]);const t=w*w+A*A+M*M;if(t<S&&t>x){const e=1/Math.sqrt(t);u[r]=w*e,u[r+1]=A*e,u[r+2]=M*e}else u[r]=w,u[r+1]=A,u[r+2]=M;r+=h}else for(let e=0;e<d;++e)O(3*a[e]),u[r]=w,u[r+1]=A,u[r+2]=M,r+=h;else for(let e=0;e<d;++e){if(O(3*a[e]),E){const e=w*w+A*A+M*M;if(e<S&&e>x){const t=1/Math.sqrt(e);w*=t,A*=t,M*=t}}for(let e=0;e<s;++e)u[r]=w,u[r+1]=A,u[r+2]=M,r+=h}}function f(e,t,n,i,r=1){const{data:s,indices:o}=e,a=n.typedBuffer,l=n.typedBufferStride,c=o.length;if(i*=l,t!==s.length||4!==t)if(1!==r)if(4!==t)for(let e=0;e<c;++e){const t=3*o[e];for(let e=0;e<r;++e)a[i]=s[t],a[i+1]=s[t+1],a[i+2]=s[t+2],a[i+3]=255,i+=l}else for(let e=0;e<c;++e){const t=4*o[e];for(let e=0;e<r;++e)a[i]=s[t],a[i+1]=s[t+1],a[i+2]=s[t+2],a[i+3]=s[t+3],i+=l}else{if(4===t){for(let e=0;e<c;++e){const t=4*o[e];a[i]=s[t],a[i+1]=s[t+1],a[i+2]=s[t+2],a[i+3]=s[t+3],i+=l}return}for(let e=0;e<c;++e){const t=3*o[e];a[i]=s[t],a[i+1]=s[t+1],a[i+2]=s[t+2],a[i+3]=255,i+=l}}else{a[i]=s[0],a[i+1]=s[1],a[i+2]=s[2],a[i+3]=s[3];const e=new Uint32Array(n.typedBuffer.buffer,n.start),t=l/4,o=e[i/=4];i+=t;const u=c*r;for(let n=1;n<u;++n)e[i]=o,i+=t}}function m(e,t,n,i,r=1){const s=t.typedBuffer,o=t.typedBufferStride;if(i*=o,1===r)for(let t=0;t<n;++t)s[i]=e[0],s[i+1]=e[1],s[i+2]=e[2],s[i+3]=e[3],i+=o;else for(let t=0;t<n;++t)for(let t=0;t<r;++t)s[i]=e[0],s[i+1]=e[1],s[i+2]=e[2],s[i+3]=e[3],i+=o}function g(e,t,n,i,s,a){for(const l of t.fields.keys()){const t=e.attributes.get(l),c=t?.indices;if(t&&c)_(l,t,n,i,s,a);else if(l===o.r.OBJECTANDLAYERIDCOLOR&&null!=e.objectAndLayerIdColor){const t=e.attributes.get(o.r.POSITION)?.indices;if(t){const n=t.length,i=s.getField(l,r.XP);m(e.objectAndLayerIdColor,i,n,a)}}}}function _(e,t,n,a,c,h){switch(e){case o.r.POSITION:{(0,s.vA)(3===t.size);const i=c.getField(e,r.xs);(0,s.vA)(!!i,`No buffer view for ${e}`),i&&d(t,n,i,h);break}case o.r.NORMAL:{(0,s.vA)(3===t.size);const n=c.getField(e,r.xs);(0,s.vA)(!!n,`No buffer view for ${e}`),n&&p(t,a,n,h);break}case o.r.NORMALCOMPRESSED:{(0,s.vA)(2===t.size);const n=c.getField(e,r.mJ);(0,s.vA)(!!n,`No buffer view for ${e}`),n&&l(t,n,h);break}case o.r.UV0:{(0,s.vA)(2===t.size);const n=c.getField(e,r.gH);(0,s.vA)(!!n,`No buffer view for ${e}`),n&&l(t,n,h);break}case o.r.COLOR:case o.r.SYMBOLCOLOR:{const n=c.getField(e,r.XP);(0,s.vA)(!!n,`No buffer view for ${e}`),(0,s.vA)(3===t.size||4===t.size),!n||3!==t.size&&4!==t.size||f(t,t.size,n,h);break}case o.r.COLORFEATUREATTRIBUTE:{const n=c.getField(e,r.Y$);(0,s.vA)(!!n,`No buffer view for ${e}`),(0,s.vA)(1===t.size),n&&1===t.size&&function(e,t,n){const{data:i,indices:r}=e,s=t.typedBuffer,o=t.typedBufferStride,a=r.length,l=i[0];n*=o;for(let e=0;e<a;++e)s[n]=l,n+=o}(t,n,h);break}case o.r.TANGENT:{(0,s.vA)(4===t.size);const o=c.getField(e,r.Eq);(0,s.vA)(!!o,`No buffer view for ${e}`),o&&function(e,t,n,r,s=1){if(!t)return void u(e,n,r,s);const{data:o,indices:a}=e,l=t,c=n.typedBuffer,h=n.typedBufferStride,d=a.length,p=l[0],f=l[1],m=l[2],g=l[4],_=l[5],v=l[6],y=l[8],b=l[9],T=l[10],E=!(0,i.ut)(l),x=1e-6,S=1-x;if(r*=h,1===s)for(let e=0;e<d;++e){const t=4*a[e],n=o[t],i=o[t+1],s=o[t+2],l=o[t+3];let u=p*n+g*i+y*s,d=f*n+_*i+b*s,w=m*n+v*i+T*s;if(E){const e=u*u+d*d+w*w;if(e<S&&e>x){const t=1/Math.sqrt(e);u*=t,d*=t,w*=t}}c[r]=u,c[r+1]=d,c[r+2]=w,c[r+3]=l,r+=h}else for(let e=0;e<d;++e){const t=4*a[e],n=o[t],i=o[t+1],l=o[t+2],u=o[t+3];let d=p*n+g*i+y*l,w=f*n+_*i+b*l,A=m*n+v*i+T*l;if(E){const e=d*d+w*w+A*A;if(e<S&&e>x){const t=1/Math.sqrt(e);d*=t,w*=t,A*=t}}for(let e=0;e<s;++e)c[r]=d,c[r+1]=w,c[r+2]=A,c[r+3]=u,r+=h}}(t,n,o,h);break}case o.r.PROFILERIGHT:case o.r.PROFILEUP:case o.r.PROFILEVERTEXANDNORMAL:case o.r.FEATUREVALUE:{(0,s.vA)(4===t.size);const n=c.getField(e,r.Eq);(0,s.vA)(!!n,`No buffer view for ${e}`),n&&u(t,n,h)}}}},20794:function(e,t,n){"use strict";n.d(t,{Xq:function(){return a},wk:function(){return o}});const i={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},r={dash:i.dash,"dash-dot":[...i.dash,...i.dot],dot:i.dot,"long-dash":i["long-dash"],"long-dash-dot":[...i["long-dash"],...i.dot],"long-dash-dot-dot":[...i["long-dash"],...i.dot,...i.dot],none:null,"short-dash":i["short-dash"],"short-dash-dot":[...i["short-dash"],...i["short-dot"]],"short-dash-dot-dot":[...i["short-dash"],...i["short-dot"],...i["short-dot"]],"short-dot":i["short-dot"],solid:null},s=8;function o(e){return{pattern:[e,e],pixelRatio:2}}function a(e){return null!=e&&"style"===e.type?function(e){return null!=e?function(e,t){return null==e?e:{pattern:e.slice(),pixelRatio:t}}(r[e],s):null}(e.style):null}},84738:function(e,t,n){"use strict";n.d(t,{Ci:function(){return s},PC:function(){return o},Vk:function(){return a}});var i=n(32501),r=n(44476);function s(e,t){return null==e&&(e=[]),e.push(t),e}function o(e,t){if(null==e)return null;const n=e.filter((e=>e!==t));return 0===n.length?null:n}function a(e,t,n,i,s){l[0]=e.get(t,0),l[1]=e.get(t,1),l[2]=e.get(t,2),(0,r.jS)(l,c,3),n.set(s,0,c[0]),i.set(s,0,c[1]),n.set(s,1,c[2]),i.set(s,1,c[3]),n.set(s,2,c[4]),i.set(s,2,c[5])}const l=(0,i.vt)(),c=new Float32Array(6)},50678:function(e,t,n){"use strict";n.d(t,{Dt:function(){return h},kJ:function(){return r},lM:function(){return i}});var i,r,s,o=n(53804),a=n(27264),l=n(8610),c=n(55890),u=n(46121);(s=i||(i={}))[s.Draped=0]="Draped",s[s.Screen=1]="Screen",s[s.World=2]="World",s[s.COUNT=3]="COUNT",function(e){e[e.Center=0]="Center",e[e.Tip=1]="Tip",e[e.COUNT=2]="COUNT"}(r||(r={}));class h extends u.E{constructor(){super(...arguments),this.output=a.V.Color,this.transparencyPassType=c.y.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=i.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=r.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}get draped(){return this.space===i.Draped}}(0,o._)([(0,l.W)({count:a.V.COUNT})],h.prototype,"output",void 0),(0,o._)([(0,l.W)({count:c.y.COUNT})],h.prototype,"transparencyPassType",void 0),(0,o._)([(0,l.W)()],h.prototype,"occluder",void 0),(0,o._)([(0,l.W)()],h.prototype,"hasSlicePlane",void 0),(0,o._)([(0,l.W)()],h.prototype,"writeDepth",void 0),(0,o._)([(0,l.W)({count:i.COUNT})],h.prototype,"space",void 0),(0,o._)([(0,l.W)()],h.prototype,"hideOnShortSegments",void 0),(0,o._)([(0,l.W)()],h.prototype,"hasCap",void 0),(0,o._)([(0,l.W)({count:r.COUNT})],h.prototype,"anchor",void 0),(0,o._)([(0,l.W)()],h.prototype,"hasTip",void 0),(0,o._)([(0,l.W)()],h.prototype,"vvSize",void 0),(0,o._)([(0,l.W)()],h.prototype,"vvColor",void 0),(0,o._)([(0,l.W)()],h.prototype,"vvOpacity",void 0),(0,o._)([(0,l.W)()],h.prototype,"hasOccludees",void 0),(0,o._)([(0,l.W)()],h.prototype,"multipassEnabled",void 0),(0,o._)([(0,l.W)()],h.prototype,"cullAboveGround",void 0),(0,o._)([(0,l.W)({constValue:!1})],h.prototype,"occlusionPass",void 0),(0,o._)([(0,l.W)({constValue:!0})],h.prototype,"hasVvInstancing",void 0),(0,o._)([(0,l.W)({constValue:!0})],h.prototype,"hasSliceTranslatedView",void 0)},95736:function(e,t,n){"use strict";n.d(t,{Q:function(){return u},x:function(){return i}});var i,r,s=n(53804),o=n(27264),a=n(8610),l=n(55890),c=n(46121);(r=i||(i={}))[r.BUTT=0]="BUTT",r[r.SQUARE=1]="SQUARE",r[r.ROUND=2]="ROUND",r[r.COUNT=3]="COUNT";class u extends c.E{constructor(){super(...arguments),this.output=o.V.Color,this.capType=i.BUTT,this.transparencyPassType=l.y.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}}(0,s._)([(0,a.W)({count:o.V.COUNT})],u.prototype,"output",void 0),(0,s._)([(0,a.W)({count:i.COUNT})],u.prototype,"capType",void 0),(0,s._)([(0,a.W)({count:l.y.COUNT})],u.prototype,"transparencyPassType",void 0),(0,s._)([(0,a.W)()],u.prototype,"occluder",void 0),(0,s._)([(0,a.W)()],u.prototype,"hasSlicePlane",void 0),(0,s._)([(0,a.W)()],u.prototype,"hasPolygonOffset",void 0),(0,s._)([(0,a.W)()],u.prototype,"writeDepth",void 0),(0,s._)([(0,a.W)()],u.prototype,"draped",void 0),(0,s._)([(0,a.W)()],u.prototype,"stippleEnabled",void 0),(0,s._)([(0,a.W)()],u.prototype,"stippleOffColorEnabled",void 0),(0,s._)([(0,a.W)()],u.prototype,"stipplePreferContinuous",void 0),(0,s._)([(0,a.W)()],u.prototype,"roundJoins",void 0),(0,s._)([(0,a.W)()],u.prototype,"applyMarkerOffset",void 0),(0,s._)([(0,a.W)()],u.prototype,"vvSize",void 0),(0,s._)([(0,a.W)()],u.prototype,"vvColor",void 0),(0,s._)([(0,a.W)()],u.prototype,"vvOpacity",void 0),(0,s._)([(0,a.W)()],u.prototype,"falloffEnabled",void 0),(0,s._)([(0,a.W)()],u.prototype,"innerColorEnabled",void 0),(0,s._)([(0,a.W)()],u.prototype,"hasOccludees",void 0),(0,s._)([(0,a.W)()],u.prototype,"multipassEnabled",void 0),(0,s._)([(0,a.W)()],u.prototype,"cullAboveGround",void 0),(0,s._)([(0,a.W)()],u.prototype,"wireframe",void 0),(0,s._)([(0,a.W)()],u.prototype,"objectAndLayerIdColorInstanced",void 0),(0,s._)([(0,a.W)({constValue:!1})],u.prototype,"occlusionPass",void 0),(0,s._)([(0,a.W)({constValue:!0})],u.prototype,"hasVvInstancing",void 0),(0,s._)([(0,a.W)({constValue:!0})],u.prototype,"hasSliceTranslatedView",void 0)},65631:function(e,t,n){"use strict";n.d(t,{A:function(){return w}});var i,r=n(53804),s=n(83525),o=n(40633),a=n(15774),l=n(13520),c=n(23502),u=(n(58941),n(13798),n(65953)),h=n(73364),d=n(39714),p=n(13786),f=n(1932),m=n(20551),g=n(32501),_=n(33400),v=n(41546),y=n(69508),b=n(79578),T=n(29531),E=n(65420),x=n(57701);let S=i=class extends s.A{constructor(e){super(e),this._ray=(0,b.vt)(),this._viewport=(0,v.fA)(0,0,1,1),this._padding=(0,v.fA)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=(0,f.fA)(1,1e3),this._viewDirty=!0,this._viewMatrix=(0,d.vt)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=(0,d.vt)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=(0,d.vt)(),this._frustumDirty=!0,this._frustum=(0,y.vt)(),this._fullViewport=(0,v.vt)(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=(0,g.vt)(),this._up=(0,g.vt)(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(e){this._pixelRatio=e>0?e:1}get rows(){return this._rows}set rows(e){this._rows=Math.max(1,e)}get columns(){return this._columns}set columns(e){this._columns=Math.max(1,e)}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center,"_center")}get ray(){return(0,m.f)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){(0,h.C)(this._viewMatrix,e),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),(0,m.s)((0,g.vt)(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),(0,m.s)((0,g.vt)(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),(0,m.s)((0,g.vt)(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get screenViewport(){if(1===this.pixelRatio)return this._viewport;const e=(0,_.b)((0,v.vt)(),this._viewport,1/this.pixelRatio),t=this._get("screenViewport");return t&&(0,_.e)(e,t)?t:e}get screenPadding(){if(1===this.pixelRatio)return this._padding;const e=(0,_.b)((0,v.vt)(),this._padding,1/this.pixelRatio),t=this._get("screenPadding");return t&&(0,_.e)(e,t)?t:e}get x(){return this._viewport[0]}set x(e){e+=this._padding[x.zj.LEFT],this._viewport[0]!==e&&(this._viewport[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(e){e+=this._padding[x.zj.BOTTOM],this._viewport[1]!==e&&(this._viewport[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[x.zj.RIGHT]+this._padding[x.zj.LEFT]}set fullWidth(e){this.width=e-(this._padding[x.zj.RIGHT]+this._padding[x.zj.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[x.zj.TOP]+this._padding[x.zj.BOTTOM]}set fullHeight(e){this.height=e-(this._padding[x.zj.TOP]+this._padding[x.zj.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[x.zj.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[x.zj.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){(0,_.a)(this._padding,e)||(this._viewport[0]+=e[x.zj.LEFT]-this._padding[x.zj.LEFT],this._viewport[1]+=e[x.zj.BOTTOM]-this._padding[x.zj.BOTTOM],this._viewport[2]-=e[x.zj.RIGHT]+e[x.zj.LEFT]-(this._padding[x.zj.RIGHT]+this._padding[x.zj.LEFT]),this._viewport[3]-=e[x.zj.TOP]+e[x.zj.BOTTOM]-(this._padding[x.zj.TOP]+this._padding[x.zj.BOTTOM]),(0,_.c)(this._padding,e),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&((0,h.lw)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return(0,h.B8)((0,d.vt)(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||(0,d.vt)()}get fov(){return this._fov}set fov(e){this._fov=e,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return e=this._fov,t=this.width,n=this.height,2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+n*n));var e,t,n}set fovX(e){this._fov=function(e,t,n){return 2*Math.atan(Math.sqrt(t*t+n*n)*Math.tan(.5*e)/t)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return e=this._fov,t=this.width,n=this.height,2*Math.atan(n*Math.tan(.5*e)/Math.sqrt(t*t+n*n));var e,t,n}set fovY(e){this._fov=function(e,t,n){return 2*Math.atan(Math.sqrt(t*t+n*n)*Math.tan(.5*e)/n)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return(0,m.p)(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,h.B8)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,h.mg)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return null!=this.relativeElevation&&this.relativeElevation>=0}get _projectionMatrixInternal(){const e=this.width,t=this.height,n=this.near*Math.tan(this.fovY/2)*2,i=n*this._aspect,r=n/this.rows,s=i/this.columns,o=-i/2+this.column*s,a=o+s,l=-n/2+this.row*r,c=l+r,u=(0,h.$h)((0,d.vt)(),o*(1+2*this._padding[x.zj.LEFT]/e),a*(1+2*this._padding[x.zj.RIGHT]/e),l*(1+2*this._padding[x.zj.BOTTOM]/t),c*(1+2*this._padding[x.zj.TOP]/t),this.near,this.far),p=this._get("projectionMatrix");return p&&(0,h.aI)(p,u)?p:u}copyFrom(e){(0,m.c)(this._ray.origin,e.eye),this.center=e.center,this.up=e.up,(0,_.c)(this._viewport,e.viewport),this.notifyChange("_viewport"),(0,_.c)(this._padding,e.padding),this.notifyChange("_padding"),(0,p.C)(this._nearFar,e.nearFar),this.notifyChange("_nearFar"),this._fov=e.fov,this.row=e.row,this.column=e.column,this.rows=e.rows,this.columns=e.columns,this.relativeElevation=e.relativeElevation;const t=e;return this._viewDirty=t._viewDirty,this._viewDirty||((0,h.C)(this._viewMatrix,e.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||((0,y.C)(this._frustum,e.frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,h.C)(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,_.c)(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up}clone(){return(new i).copyFrom(this)}equals(e){return(0,m.e)(this.eye,e.eye)&&(0,m.e)(this.center,e.center)&&(0,m.e)(this.up,e.up)&&(0,_.a)(this._viewport,e.viewport)&&(0,_.a)(this._padding,e.padding)&&(0,p.t2)(this.nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation&&this.row===e.row&&this.column===e.column&&this.rows===e.rows&&this.columns===e.columns}almostEquals(e){const t=Math.max(1,1/this.pixelRatio,1/e.pixelRatio);if(Math.abs(e.fov-this._fov)>=.001||(0,_.d)(e.screenPadding,this.screenPadding)>=t||(0,_.d)(this.screenViewport,e.screenViewport)>=t||this.row!==e.row||this.column!==e.column||this.rows!==e.rows||this.columns!==e.columns)return!1;(0,m.z)(O,e.eye,e.center),(0,m.z)(R,this.eye,this.center);const n=(0,m.m)(O,R),i=(0,m.x)(O),r=(0,m.x)(R),s=5e-4;return n*n>=(1-1e-10)*i*r&&(0,m.w)(e.eye,this.eye)<Math.max(i,r)*s*s}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(e))}_viewDirectionDistance(e){return Math.abs((0,T.gr)(this.viewForward,(0,m.f)(O,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(e=(0,l.gs)()){return e[0]=(this.padding[x.zj.LEFT]+this.width/2)/this.pixelRatio,e[1]=(this.padding[x.zj.TOP]+this.height/2)/this.pixelRatio,e}getRenderCenter(e,t=.5,n=.5){return e[0]=this.padding[x.zj.LEFT]+this.width*t,e[1]=this.padding[x.zj.BOTTOM]+this.height*n,e[2]=.5,e}setGLViewport(e){const t=this.viewport,n=this.padding;e.setViewport(t[0]-n[3],t[1]-n[2],t[2]+n[1]+n[3],t[3]+n[0]+n[2])}applyProjection(e,t){e!==A&&(0,m.c)(A,e),A[3]=1,(0,_.t)(A,A,this.projectionMatrix);const n=Math.abs(A[3]);(0,m.j)(A,A,1/n);const i=this.fullViewport;t[0]=(0,a.Cc)(0,i[0]+i[2],.5+.5*A[0]),t[1]=(0,a.Cc)(0,i[1]+i[3],.5+.5*A[1]),t[2]=.5*(A[2]+1),t[3]=n}unapplyProjection(e,t){const n=this.fullViewport;A[0]=(e[0]/(n[0]+n[2])*2-1)*e[3],A[1]=(e[1]/(n[1]+n[3])*2-1)*e[3],A[2]=(2*e[2]-1)*e[3],A[3]=e[3],null!=this.inverseProjectionMatrix&&((0,_.t)(A,A,this.inverseProjectionMatrix),t[0]=A[0],t[1]=A[1],t[2]=A[2])}projectToScreen(e,t){return this.projectToRenderScreen(e,C),this.renderToScreen(C,t),t}projectToRenderScreen(e,t){if(A[0]=e[0],A[1]=e[1],A[2]=e[2],A[3]=1,(0,_.t)(A,A,this.viewProjectionMatrix),0===A[3])return null;const n=A;(0,m.j)(n,n,1/Math.abs(A[3]));const i=this.fullViewport,r=(0,a.Cc)(0,i[0]+i[2],.5+.5*n[0]),s=(0,a.Cc)(0,i[1]+i[3],.5+.5*n[1]);return"x"in t?(t.x=r,t.y=s):(t[0]=r,t[1]=s,t.length>2&&(t[2]=.5*(n[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,C),t)}unprojectFromRenderScreen(e,t){if((0,h.lw)(M,this.projectionMatrix,this.viewMatrix),!(0,h.B8)(M,M))return null;const n=this.fullViewport;return A[0]=2*(e[0]-n[0])/n[2]-1,A[1]=2*(e[1]-n[1])/n[3]-1,A[2]=2*e[2]-1,A[3]=1,(0,_.t)(A,A,M),0===A[3]?null:(t[0]=A[0]/A[3],t[1]=A[1]/A[3],t[2]=A[2]/A[3],t)}constrainWindowSize(e,t,n,i){const r=e*this.pixelRatio,s=t*this.pixelRatio,o=Math.max(r-n/2,0),a=Math.max(this.fullHeight-s-i/2,0),l=-Math.min(r-n/2,0),c=-Math.min(this.fullHeight-s-i/2,0),u=n-l- -Math.min(this.fullWidth-r-n/2,0),h=i-c- -Math.min(s-i/2,0);return[Math.round(o),Math.round(a),Math.round(u),Math.round(h)]}computeUp(e){e===E.RT.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(e,t){const n=e[0]*this.pixelRatio,i=this.fullHeight-e[1]*this.pixelRatio;return t[0]=n,t[1]=i,t}renderToScreen(e,t){const n=e[0]/this.pixelRatio,i=(this.fullHeight-e[1])/this.pixelRatio;t[0]=n,t[1]=i}_computeUpGlobal(){(0,m.f)(O,this.center,this.eye);const e=(0,m.l)(this.center);e<1?((0,m.s)(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs((0,m.m)(O,this.center))>.9999*(0,m.l)(O)*e||((0,m.b)(this._up,O,this.center),(0,m.b)(this._up,this._up,O),(0,m.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){(0,m.E)(O,this.eye,this.center),Math.abs(O[2])<=.9999&&((0,m.j)(O,O,O[2]),(0,m.s)(this._up,-O[0],-O[1],1-O[2]),(0,m.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(e,t,n=""){"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?(0,m.e)(e,t)||((0,m.c)(t,e),this._markViewDirty(),n.length&&this.notifyChange(n)):o.A.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&((0,y.ui)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&((0,h.t5)(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};(0,r._)([(0,c.MZ)()],S.prototype,"_viewport",void 0),(0,r._)([(0,c.MZ)()],S.prototype,"_padding",void 0),(0,r._)([(0,c.MZ)()],S.prototype,"_fov",void 0),(0,r._)([(0,c.MZ)()],S.prototype,"_nearFar",void 0),(0,r._)([(0,c.MZ)()],S.prototype,"_viewDirty",void 0),(0,r._)([(0,c.MZ)()],S.prototype,"_viewMatrix",void 0),(0,r._)([(0,c.MZ)()],S.prototype,"_pixelRatio",void 0),(0,r._)([(0,c.MZ)()],S.prototype,"pixelRatio",null),(0,r._)([(0,c.MZ)()],S.prototype,"row",void 0),(0,r._)([(0,c.MZ)()],S.prototype,"column",void 0),(0,r._)([(0,c.MZ)()],S.prototype,"_rows",void 0),(0,r._)([(0,c.MZ)()],S.prototype,"rows",null),(0,r._)([(0,c.MZ)()],S.prototype,"_columns",void 0),(0,r._)([(0,c.MZ)()],S.prototype,"columns",null),(0,r._)([(0,c.MZ)()],S.prototype,"eye",null),(0,r._)([(0,c.MZ)()],S.prototype,"center",null),(0,r._)([(0,c.MZ)()],S.prototype,"_center",void 0),(0,r._)([(0,c.MZ)()],S.prototype,"up",null),(0,r._)([(0,c.MZ)()],S.prototype,"_up",void 0),(0,r._)([(0,c.MZ)()],S.prototype,"viewMatrix",null),(0,r._)([(0,c.MZ)({readOnly:!0})],S.prototype,"viewForward",null),(0,r._)([(0,c.MZ)({readOnly:!0})],S.prototype,"viewUp",null),(0,r._)([(0,c.MZ)({readOnly:!0})],S.prototype,"viewRight",null),(0,r._)([(0,c.MZ)({readOnly:!0})],S.prototype,"nearFar",null),(0,r._)([(0,c.MZ)()],S.prototype,"near",null),(0,r._)([(0,c.MZ)()],S.prototype,"far",null),(0,r._)([(0,c.MZ)()],S.prototype,"viewport",null),(0,r._)([(0,c.MZ)({readOnly:!0})],S.prototype,"screenViewport",null),(0,r._)([(0,c.MZ)({readOnly:!0})],S.prototype,"screenPadding",null),(0,r._)([(0,c.MZ)()],S.prototype,"x",null),(0,r._)([(0,c.MZ)()],S.prototype,"y",null),(0,r._)([(0,c.MZ)()],S.prototype,"width",null),(0,r._)([(0,c.MZ)()],S.prototype,"height",null),(0,r._)([(0,c.MZ)()],S.prototype,"fullWidth",null),(0,r._)([(0,c.MZ)()],S.prototype,"fullHeight",null),(0,r._)([(0,c.MZ)({readOnly:!0})],S.prototype,"_aspect",null),(0,r._)([(0,c.MZ)()],S.prototype,"padding",null),(0,r._)([(0,c.MZ)({readOnly:!0})],S.prototype,"projectionMatrix",null),(0,r._)([(0,c.MZ)({readOnly:!0})],S.prototype,"inverseProjectionMatrix",null),(0,r._)([(0,c.MZ)()],S.prototype,"fov",null),(0,r._)([(0,c.MZ)()],S.prototype,"fovX",null),(0,r._)([(0,c.MZ)()],S.prototype,"fovY",null),(0,r._)([(0,c.MZ)()],S.prototype,"viewInverseTransposeMatrix",null),(0,r._)([(0,c.MZ)({readOnly:!0})],S.prototype,"_projectionMatrixInternal",null),(0,r._)([(0,c.MZ)()],S.prototype,"relativeElevation",void 0),S=i=(0,r._)([(0,u.$)("esri.views.3d.webgl.RenderCamera")],S);const w=S,A=(0,v.vt)(),M=(0,d.vt)(),O=(0,g.vt)(),R=(0,g.vt)(),C=(0,l.r_)()},98680:function(e,t,n){"use strict";var i,r;n.d(t,{N:function(){return i},z:function(){return r}}),function(e){e[e.RED=0]="RED",e[e.RG=1]="RG",e[e.RGBA4=2]="RGBA4",e[e.RGBA=3]="RGBA",e[e.RGBA_MIPMAP=4]="RGBA_MIPMAP",e[e.R16F=5]="R16F",e[e.RGBA16F=6]="RGBA16F"}(i||(i={})),function(e){e[e.DEPTH_STENCIL_TEXTURE=0]="DEPTH_STENCIL_TEXTURE",e[e.DEPTH16_BUFFER=1]="DEPTH16_BUFFER"}(r||(r={}))},65420:function(e,t,n){"use strict";var i;n.d(t,{RT:function(){return i}}),function(e){e[e.Global=1]="Global",e[e.Local=2]="Local"}(i||(i={}))},93336:function(e,t,n){"use strict";n.d(t,{N:function(){return Je},l:function(){return nt}});var i,r,s=n(53804),o=n(59469),a=n(83525),l=n(78879),c=n(28181),u=n(23502),h=(n(58941),n(40633),n(13798),n(65953)),d=n(20248);!function(e){e[e.NeverApplied=0]="NeverApplied",e[e.Applied=1]="Applied",e[e.Undone=2]="Undone"}(i||(i={})),function(e){e.UndoRedoUpdating="UndoRedoUpdating",e.UndoInvalidError="UndoInvalidError",e.RedoInvalidError="RedoInvalidError",e.ApplyInvalidError="ApplyInvalidError"}(r||(r={}));const p={[r.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[r.UndoInvalidError]:"There are no items to Undo",[r.RedoInvalidError]:"There are no items to Redo",[r.ApplyInvalidError]:"Cannot apply an item that is already applied"};class f extends Error{constructor(){super(p[r.UndoRedoUpdating]),this.type="undo-redo-updating-error"}}class m extends Error{constructor(){super(p[r.UndoInvalidError]),this.type="undo-redo-undo-error"}}class g extends Error{constructor(){super(p[r.RedoInvalidError]),this.type="undo-redo-redo-error"}}class _ extends Error{constructor(){super(p[r.ApplyInvalidError]),this.type="undo-redo-apply-error"}}var v,y;(y=v||(v={}))[y.Apply=0]="Apply",y[y.Undo=1]="Undo",y[y.Redo=2]="Redo";let b=class extends a.A{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=i.NeverApplied}get canUndo(){return this.status===i.Applied}get canRedo(){return this.status===i.Undone}async executeUndoRedoOperation(e){switch(e){case v.Apply:if(this.status!==i.NeverApplied)throw new _;return await this.apply(),void(this.status=i.Applied);case v.Undo:if(this.status!==i.Applied)throw new m;return await this.undo(),void(this.status=i.Undone);case v.Redo:if(this.status!==i.Undone)throw new m;return await this.redo(),void(this.status=i.Applied)}}};(0,s._)([(0,u.MZ)()],b.prototype,"name",void 0),(0,s._)([(0,u.MZ)()],b.prototype,"tag",void 0),b=(0,s._)([(0,h.$)("esri.undoredo.UndoableOperation")],b);let T=class extends a.A{constructor(){super(...arguments),this._stack=new l.A,this._stackPosition=-1,this._updatingHandles=new d.U}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach((e=>e.destroy()))}_drainStack(){this._stack.drain((e=>e.destroy())),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new m;if(this.updating)throw new f;const e=this._stack.getItemAt(this._stackPosition);await this._updatingHandles.addPromise((async()=>{await e.executeUndoRedoOperation(v.Undo),--this._stackPosition,e.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new g;if(this.updating)throw new f;const e=this._stack.getItemAt(this._stackPosition+1);await this._updatingHandles.addPromise((async()=>{await e.executeUndoRedoOperation(v.Redo),++this._stackPosition})())}peekUndo(){return this.canUndo?this._stack.getItemAt(this._stackPosition):null}peekRedo(){return this.canRedo?this._stack.getItemAt(this._stackPosition+1):null}async inject(e){if(this.updating)throw new f;await this._updatingHandles.addPromise((async()=>{e.status===i.NeverApplied&&await e.executeUndoRedoOperation(v.Apply),e.canUndo?(this._stack.splice(this._stackPosition+1,0,e),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach((e=>e.destroy())),this._stackPosition=-1)})())}async add(e){if(this.updating)throw new f;await this._updatingHandles.addPromise((async()=>{e.status===i.NeverApplied&&await e.executeUndoRedoOperation(v.Apply),this._stackPosition>=-1&&this._truncateForwardStack(),e.canUndo?(this._stack.push(e),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(e,t=!1){if(this.updating&&!t)return;await(0,c.C_)((()=>!this.updating));const n=new l.A;for(let t=0;t<this._stack.length;t++){const i=this._stack.getItemAt(t);i.tag===e?(i.destroy(),t===this._stackPosition&&(this._stackPosition=n.length-1)):n.push(i)}this._stack=n,this._stackPosition>n.length-1&&(this._stackPosition=n.length-1)}async clear(e=!1){if(this.updating&&!e)throw new f;await(0,c.C_)((()=>!this.updating)),this._drainStack()}};(0,s._)([(0,u.MZ)()],T.prototype,"_stack",void 0),(0,s._)([(0,u.MZ)()],T.prototype,"_stackPosition",void 0),(0,s._)([(0,u.MZ)()],T.prototype,"updating",null),(0,s._)([(0,u.MZ)({readOnly:!0})],T.prototype,"canUndo",null),(0,s._)([(0,u.MZ)({readOnly:!0})],T.prototype,"hasUndo",null),(0,s._)([(0,u.MZ)({readOnly:!0})],T.prototype,"canRedo",null),(0,s._)([(0,u.MZ)({readOnly:!0})],T.prototype,"hasRedo",null),T=(0,s._)([(0,h.$)("esri.UndoRedo")],T);var E=n(77472),x=n(48996),S=n(61226),w=n(95929),A=n(6338),M=n(19702),O=n(42413);class R{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}}n(50917);var C,I=n(50659),P=n(21609),D=n(62938),L=n(20551),N=n(32501),F=n(61714),z=n(45532),V=n(44740),H=n(57165),U=n(57862),k=n(1644),j=n(94757);let G=C=class extends V.A{constructor(...e){super(...e),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}normalizeCtorArgs(e,t){let n;if(e?.center)n=e;else{if(e?.rings)return super.normalizeCtorArgs(e,t);n={center:e}}return{...super.normalizeCtorArgs(),...n,...t}}initialize(){const e=this.center,t=this.numberOfPoints;if(this.hasZ=e?.hasZ??!1,0!==this.rings.length||!e)return;const n=(0,D.oU)(this.radius,this.radiusUnit,"meters"),i=e.spatialReference;let r,s="geographic";if(i.isWebMercator?s="webMercator":(null!=(i.wkid&&j.A[i.wkid])||(i.wkt2||i.wkt)&&(0,D.x1)(i.wkt2||i.wkt))&&(s="projected"),this.geodesic){let i;switch(s){case"webMercator":i=(0,k.ci)(e);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":i=e}r=this._createGeodesicCircle(i,n,t),"webMercator"===s&&(r=(0,k.Gh)(r))}else{let i;"webMercator"===s||"projected"===s?i=n/(0,D.Ao)(e.spatialReference):"geographic"===s&&(i=(0,D.vl)(n,"meters",(0,F.tO)(e.spatialReference).radius)),r=this._createPlanarCircle(e,i,t)}this.spatialReference=r.spatialReference,this.addRing(r.rings[0])}clone(){const{center:e,numberOfPoints:t,radius:n,radiusUnit:i,geodesic:r}=this;return new C({center:e?.clone(),numberOfPoints:t,radius:n,radiusUnit:i,geodesic:r})}_createGeodesicCircle(e,t,n){let i=0;const r=[];for(;i<360;){const s=[0,0],o=[e.x,e.y];(0,U.vN)(s,o,i,t,H.A.WGS84),this.hasZ&&s.push(e.z),r.push(s),i+=360/n}return r.push(r[0]),new V.A(r)}_createPlanarCircle(e,t,n){const i=[],r=2*Math.PI/n;for(let s=0;s<n;++s){const n=r*s,o=[e.x+Math.cos(-n)*t,e.y+Math.sin(-n)*t];this.hasZ&&o.push(e.z),i.push(o)}return i.push(i[0]),new V.A({spatialReference:e.spatialReference,rings:[i]})}};(0,s._)([(0,u.MZ)({type:z.default})],G.prototype,"center",void 0),(0,s._)([(0,u.MZ)()],G.prototype,"geodesic",void 0),(0,s._)([(0,u.MZ)()],G.prototype,"numberOfPoints",void 0),(0,s._)([(0,u.MZ)()],G.prototype,"radius",void 0),(0,s._)([(0,u.MZ)()],G.prototype,"radiusUnit",void 0),G=C=(0,s._)([(0,h.$)("esri.geometry.Circle")],G);const B=G;var $=n(22162),Z=n(38441),W=n(57652),q=n(67348),X=n(12978),Y=n(32237),K=n(61769),Q=n(72485);function J(e,t,n=null){return null!=n?[e,t,n]:[e,t]}function ee(e,t,n=null){return null!=n?{x:e,y:t,z:n}:{x:e,y:t}}class te{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return e.map((e=>this.mapToLocal(e))).filter(I.Ru)}get doUnnormalization(){return!1}}class ne extends te{constructor(e,t,n=null){super(t),this._defaultZ=n,this.transform=(0,X.vt)(),this.transformInv=(0,X.vt)(),this.transform=(0,X.o8)(e),(0,q.B8)(this.transformInv,this.transform)}makeMapPoint(e,t){return J(e,t,this._defaultZ)}mapToLocal(e){return ee(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return J(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this._defaultZ)}}class ie extends te{constructor(e,t){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=(0,N.vt)(),this.tangentFrameUpWS=(0,N.vt)(),this.tangentFrameRightWS=(0,N.vt)(),this.tangentFrameForwardWS=(0,N.vt)(),this.localFrameRightWS=(0,N.vt)(),this.localFrameUpWS=(0,N.vt)(),this.worldToLocalTransform=(0,K.vt)(),this.localToWorldTransform=(0,K.vt)(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=t,this.defaultZ=t.hasZ?t.z:null;const n=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Q._.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Q._.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Q._.Z,this.tangentFrameForwardWS);const i=(0,N.vt)();(0,L.j)(i,this.tangentFrameForwardWS,(0,L.m)(n,this.tangentFrameForwardWS)),(0,L.f)(this.localFrameRightWS,n,i),(0,L.n)(this.localFrameRightWS,this.localFrameRightWS),(0,L.b)(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),(0,Y.Yc)(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),(0,Y.B8)(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return"global"===this.view.viewingMode}makeMapPoint(e,t){return J(e,t,this.defaultZ)}mapToLocal(e){const t=(0,N.vt)();this.view.renderCoordsHelper.toRenderCoords(new z.default({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),(0,L.u)(t,t,this.worldToLocalTransform);const n=this.view.renderCoordsHelper.fromRenderCoords(t,new z.default({spatialReference:this.view.spatialReference}));return null!=n?ee(n.x/this.scale,n.y/this.scale):null}localToMap(e){const t=(0,N.vt)();this.view.renderCoordsHelper.toRenderCoords(new z.default({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),(0,L.u)(t,t,this.localToWorldTransform);const n=this.view.renderCoordsHelper.fromRenderCoords(t,new z.default({spatialReference:this.view.spatialReference}));return null!=n?J(n.x,n.y,this.defaultZ):null}}var re=n(71673),se=n(91508);function oe(e,t){const n=new z.default({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(n.z=e[2]),n}function ae(e,t,n){const i=new se.A({paths:e,spatialReference:t});return n&&(0,Z._7)(i),i}function le(e,t,n,i=!0){const r=(0,P.o8)(e);r.forEach((e=>{const t=e[0],n=e[e.length-1];(0,I.aI)(t,n)&&1!==e.length||e.push(e[0])}));let s=new V.A({rings:r,spatialReference:t});return s.rings.forEach((e=>{(0,Z.$3)(e)||e.reverse()})),n&&(0,Z._7)(s),i&&s.isSelfIntersecting&&(0,W.fn)(t)&&(s=(0,$.simplify)(s)),s}function ce(e,t,n){const i=t.mapToLocalMultiple(e),r=[],s={x:i[0].x,y:i[0].y},o=i[1].x,a=i[1].y,l=Math.round(o-s.x),c=Math.round(a-s.y),u=Math.max(Math.abs(l),Math.abs(c));if(n){const e={x:s.x+u,y:s.y+u},t={x:s.x-u,y:s.y-u};r.push(ee(e.x,t.y),ee(t.x,t.y),ee(t.x,e.y),ee(e.x,e.y))}else{const e={x:l>0?s.x+u:s.x-u,y:c>0?s.y+u:s.y-u};r.push(ee(s.x,s.y),ee(e.x,s.y),ee(e.x,e.y),ee(s.x,e.y))}return ue(le([r.map((e=>t.localToMap(e))).filter(I.Ru)],t.spatialReference,t.doUnnormalization,!0),r,t)}function ue(e,t,n){const i=he(t[3],t[2],n),r=he(t[1],t[2],n),s=he(t[0],t[1],n),o=he(t[0],t[3],n);return{geometry:e,midpoints:null!=i&&null!=r&&null!=s&&null!=o?{top:i,right:r,bottom:s,left:o}:null}}function he(e,t,n){pe[0]=e.x,pe[1]=e.y,pe[2]=0,fe[0]=t.x,fe[1]=t.y,fe[2]=0,(0,L.o)(pe,pe,fe,.5),de.x=pe[0],de.y=fe[1],de.z=fe[2];const i=n.localToMap(de);return null!=i?oe(i,n.spatialReference):null}const de=ee(0,0,0),pe=(0,N.vt)(),fe=(0,N.vt)();function me(e,t,n,i){const r=t.mapToLocalMultiple(e);let s=null,o=null;if(n)s=r[0],o=r[1];else{const e=r[0],t=r[1],n=Math.round(t.x-e.x),i=Math.round(t.y-e.y),a=Math.max(Math.abs(n),Math.abs(i));s=ee(n>0?e.x+a/2:e.x-a/2,i>0?e.y+a/2:e.y-a/2),o=ee(Math.abs(n)>Math.abs(i)?s.x-a/2:s.x,Math.abs(n)>Math.abs(i)?s.y:s.y-a/2)}const a=t.localToMap(s),l=t.localToMap(o);if(null==a||null==l)return null;t.doUnnormalization&&(0,Z.JM)([[a,l]],t.spatialReference);const c=oe(a,t.spatialReference),u=oe(l,t.spatialReference),h=(0,D.GA)(t.spatialReference);let d=0;if((0,W.fn)(t.spatialReference))d=h*(0,$.distance)(c,u,null);else{const e=s.x-o.x,t=s.y-o.y;d=h*Math.sqrt(e*e+t*t)*(i||1)}const p=new B({center:c,radius:d,radiusUnit:"meters",spatialReference:t.spatialReference});return{geometry:le(p.rings,p.spatialReference,!1),center:c,edge:u}}var ge=n(56275),_e=n(68945);function ve(e,t){switch(e){case"point":case"multipoint":return"point";case"polyline":return function(e){return(null!=e&&"polyline"===e.type&&e.paths.length?e.paths[0].length:0)<2?"polylineZeroVertices":"polylineOneVertex"}(t);case"polygon":return function(e){const t=null!=e&&"polygon"===e.type&&e.rings.length?e.rings[0].length:0;return t<3?"polylineZeroVertices":t<4?"polygonOneVertex":"polygonTwoVertices"}(t);default:return}}const ye=(0,N.vt)();var be=n(7768),Te=n(77664),Ee=n(90858);let xe=class extends Ee.w{constructor(e){super(e),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=ge.iT}get allFields(){return[]}};(0,s._)([(0,u.MZ)()],xe.prototype,"type",void 0),(0,s._)([(0,u.MZ)()],xe.prototype,"radius",void 0),(0,s._)([(0,u.MZ)()],xe.prototype,"xSize",void 0),(0,s._)([(0,u.MZ)()],xe.prototype,"ySize",void 0),(0,s._)([(0,u.MZ)()],xe.prototype,"area",void 0),(0,s._)([(0,u.MZ)()],xe.prototype,"allFields",null),xe=(0,s._)([(0,h.$)("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],xe);var Se=n(18063),we=n(73919);let Ae=class extends((0,we.B)(Ee.w)){constructor(e){super(e),this.type="draw-mesh",this.orientation=(0,Se.LJ)({lockable:!1}),this.scale=(0,Se.dy)({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};(0,s._)([(0,u.MZ)()],Ae.prototype,"helpMessage",void 0),(0,s._)([(0,u.MZ)()],Ae.prototype,"allFields",null),Ae=(0,s._)([(0,h.$)("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],Ae);let Me=class extends((0,we.B)(Ee.w)){constructor(e){super(e),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};(0,s._)([(0,u.MZ)()],Me.prototype,"helpMessage",void 0),(0,s._)([(0,u.MZ)()],Me.prototype,"allFields",null),Me=(0,s._)([(0,h.$)("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],Me);let Oe=class extends((0,we.B)(Ee.w)){constructor(e){super(e),this.type="draw-polygon",this.direction=(0,Se.Gk)(),this.distance=(0,Se.R0)({title:e=>e.messages.sketch.distance}),this.area=(0,Se.Am)(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};(0,s._)([(0,u.MZ)()],Oe.prototype,"xyMode",void 0),(0,s._)([(0,u.MZ)()],Oe.prototype,"helpMessage",void 0),(0,s._)([(0,u.MZ)()],Oe.prototype,"allFields",null),Oe=(0,s._)([(0,h.$)("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],Oe);let Re=class extends((0,we.B)(Ee.w)){constructor(e){super(e),this.type="draw-polyline",this.direction=(0,Se.Gk)(),this.distance=(0,Se.R0)({title:e=>e.messages.sketch.distance}),this.totalLength=(0,Se.fr)(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};(0,s._)([(0,u.MZ)()],Re.prototype,"helpMessage",void 0),(0,s._)([(0,u.MZ)()],Re.prototype,"xyMode",void 0),(0,s._)([(0,u.MZ)()],Re.prototype,"allFields",null),Re=(0,s._)([(0,h.$)("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],Re);let Ce=class extends Ee.w{constructor(e){super(e),this.type="draw-rectangle",this.xSize=ge.r7,this.ySize=ge.r7,this.area=ge.iT}get allFields(){return[]}};(0,s._)([(0,u.MZ)()],Ce.prototype,"type",void 0),(0,s._)([(0,u.MZ)()],Ce.prototype,"xSize",void 0),(0,s._)([(0,u.MZ)()],Ce.prototype,"ySize",void 0),(0,s._)([(0,u.MZ)()],Ce.prototype,"area",void 0),(0,s._)([(0,u.MZ)()],Ce.prototype,"allFields",null),Ce=(0,s._)([(0,h.$)("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],Ce);var Ie=n(99675),Pe=n(70474),De=n(9862),Le=n(46517);function Ne(e){const{directionOptions:t,geometryType:n,sketchOptions:i,tooltipInfos:r}=e,s=t=>{const n=$e(e).mode,i=r[t].elevation;"relative-to-ground"===n||"relative-to-scene"===n||"on-the-ground"===n?i.lock(We(e)):i.unlock()};switch(n){case"polygon":case"polyline":s(n),(e=>{if(t){const n=r[e].direction;n.committed=t.angle,n.unlockOnVertexPlacement=!1,i.values.directionMode=t.mode}})(n);break;case"point":case"mesh":s(n)}}function Fe(e){ze(e)?.allFields.forEach((e=>{e.unlockOnVertexPlacement&&e.unlock()}))}function ze({geometryType:e,graphic:t,tooltipInfos:n}){return"multipoint"===e||t?.geometry?.type!==Ve[e]?null:n[e]}const Ve={point:"point",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon"};function He(e,t,n){const{drawOperation:i,view:r,sketchOptions:s}=n,{cursorVertex:o}=i;if(e.sketchOptions=s,e.viewType=r.type,e.setLocationFromPoint(t,Ze(n)),ke(e.elevation,n),!o)return void(i.constraints=void 0);const a=o;i.constraints={context:qe(a,n),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:null,direction:null}}function Ue(e,t){const{drawOperation:n,sketchOptions:i,view:r}=t,{cursorVertex:s,lastVertex:o,secondToLastVertex:a}=n,l=i.values.effectiveDirectionMode;e.sketchOptions=i,e.viewType=r.type;const c=o&&s?(0,De.Kt)(o,s)??ge.r7:null;if(e.distance.actual=c,e.distance.readOnly=null==o,e.direction.actual=null,e.direction.readOnly=!0,o&&s&&("absolute"===l||a)){const t=(0,Ie.uR)(a,o,s,l);e.direction.actual=t??ge.n0,e.direction.readOnly=!1}e.setLocationFromPoint(s,Ze(t)),ke(e.elevation,t);const u=function(e,{sketchOptions:t}){const n=t.tooltips.xyMode;return"auto"===n?e?"direction-distance":"coordinates":n}(o,t);e.xyMode=u,e.direction.visible="direction-distance"===u,e.distance.visible="direction-distance"===u,e.effectiveX.visible="coordinates"===u,e.effectiveY.visible="coordinates"===u;const h=s??o;n.constraints=h?{context:qe(h,t),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:e.distance.committed,direction:e.direction.committed}:void 0}function ke(e,t){const{drawOperation:n}=t,i=n?.cursorVertex??n?.lastVertex;e.actual=(0,Le.Of)(i)??We(t),e.visible=n.hasZ,e.readOnly=!1,e.showAsZ=!0}function je(e){const t=e.createOperationGeometry?.full;return"polygon"!==t?.type?ge.iT:(0,Pe.n)(t)??ge.iT}function Ge(e){const t=e.createOperationGeometry?.rectangle?.midpoints;return(null!=t?(0,De.Kt)(t.left,t.right):null)??ge.r7}function Be(e){const t=e.createOperationGeometry?.rectangle?.midpoints;return(null!=t?(0,De.Kt)(t.top,t.bottom):null)??ge.r7}function $e(e){return e.drawOperation.elevationInfo??_e.qt}function Ze(e){return e.drawOperation.coordinateHelper.spatialReference}function We(e){const t=(0,D.G9)(Ze(e));return(0,ge.d_)(e.defaultZ*t,"meters")}function qe(e,t){return(0,be.hj)(e,t.view,Ze(t),$e(t),t.drawOperation.coordinateHelper.hasZ(),t.sketchOptions.values.effectiveDirectionMode)}var Xe=n(83202),Ye=n(37102),Ke=n(30329),Qe=n(25638);let Je=class extends(x.A.EventedMixin(Xe.g)){constructor(e){super(e),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new Ye.A}initialize(){const{view:e}=this;this.internalGraphicsLayer=new M.default({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);const t=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=function(e,t){return{point:new Me({sketchOptions:t,viewType:e}),polyline:new Re({sketchOptions:t,viewType:e}),polygon:new Oe({sketchOptions:t,viewType:e}),mesh:new Ae({sketchOptions:t,viewType:e}),rectangle:new Ce({sketchOptions:t}),circle:new xe({sketchOptions:t})}}(e.type,this.sketchOptions);const n=this.tooltip=new Ke.m({view:e});Ne(this._tooltipsContext),this._coordinateFormatterLoadTask=(0,E.UT)((()=>(0,A.Hh)())),this.addHandles([t.on("vertex-add",(e=>this.onVertexAdd(e))),t.on("vertex-remove",(e=>this.onVertexRemove(e))),t.on("vertex-update",(e=>this.onVertexUpdate(e))),t.on("cursor-update",(e=>this.onCursorUpdate(e))),t.on("cursor-remove",(()=>this._updateGraphic())),t.on("complete",(e=>this.onComplete(e))),this._coordinateFormatterLoadTask,n.on("paste",(e=>(0,Te.HA)(e,this.activeTooltipInfo))),(0,c.watch)((()=>this.cursor),(e=>{t.cursor=e}),c.pc),(0,Qe.fm)((()=>{const{activeTooltipInfo:e,sketchOptions:t}=this;(function(e,t){switch(e?.type){case"draw-point":!function(e,t){const n=t.graphic?.geometry;"point"===n?.type&&(He(e,n,t),e.helpMessage=ve("point",n))}(e,t);break;case"draw-polyline":!function(e,t){const{createOperationGeometry:n,drawOperation:i}=t,r=null!=n?n.full:null;"polyline"===r?.type&&(Ue(e,t),e.totalLength.actual=i.lastVertex?(0,De.ob)(r)??ge.r7:null,e.helpMessage=ve("polyline",r))}(e,t);break;case"draw-polygon":!function(e,t){const{createOperationGeometry:n,drawOperation:i}=t,r=null!=n?n.full:null;"polygon"===r?.type&&(Ue(e,t),e.area.actual=i.lastVertex?(0,Pe.n)(r)??ge.iT:null,e.helpMessage=ve("polygon",r))}(e,t);break;case"draw-rectangle":!function(e,t){e.sketchOptions=t.sketchOptions,e.xSize=Ge(t),e.ySize=Be(t),e.area=je(t)}(e,t);break;case"draw-circle":!function(e,t){const{forceUniformSize:n,sketchOptions:i}=t;e.sketchOptions=i,e.radius=n?function({createOperationGeometry:e}){return(null!=e?.circle?.center&&null!=e.circle.edge?(0,De.Kt)(e.circle.center,e.circle.edge):null)??ge.r7}(t):null,e.xSize=n?null:Ge(t),e.ySize=n?null:Be(t),e.area=je(t)}(e,t);break;case"draw-mesh":!function(e,t){const{graphic:n,view:i}=t,r=n?.geometry;"3d"===i.type&&"mesh"===r?.type&&(He(e,r.origin,t),(0,Te.Ue)(e,r),e.helpMessage=function(e,t){const n=e?.geometry;if(!e||"mesh"!==n?.type||!t)return;const{renderCoordsHelper:i,elevationProvider:r}=t,{camera:s}=t.state,{extent:o}=n,{center:a,spatialReference:l}=o,c=(0,D.GA)(l),u=(0,D.G9)(l),h=(0,D.GA)(i.spatialReference),d=o.width*c,p=o.height*u,f=(o.zmax??0)*u,m=f-(o.zmin??0)*u,g=Math.max(d,p,m)/h,{x:_,y:v}=a,y=a.z??0;(0,L.s)(ye,_,v,y),i.toRenderCoords(ye,l,ye);const b=g/s.computeScreenPixelSizeAt(ye);if(b>1*s.width)return"meshTooClose";if(b<20)return"meshTooFar";const T=(0,_e.bh)(e),{absoluteZ:E}=(0,_e.Q5)(_,v,f,l,t,T);return E<(r.getElevation(_,v,y,l,"ground")??0)*u+.1*m?"meshUnderground":"mesh"}(n,i))}(e,t)}})(e,this._tooltipsContext),n.info=t.tooltips.effectiveEnabled?e:null})),(0,Qe.fm)((()=>{t.constraintZ=function(e){const{geometryType:t,tooltipInfos:n}=e;switch(t){case"point":case"mesh":case"polyline":case"polygon":{const i=n[t].elevation.committed;if(!i)return;return(0,ge.l3)(i,"meters")/(0,D.G9)(Ze(e))}default:return}}(this._tooltipsContext)}))]),this.finishToolCreation()}destroy(){this.drawOperation=(0,w.pR)(this.drawOperation),this.tooltip=(0,w.pR)(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=(0,w.pR)(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){return{createOperationGeometry:this._createOperationGeometry,defaultZ:this.defaultZ,directionOptions:this.directionOptions,drawOperation:this.drawOperation,forceUniformSize:this.forceUniformSize,geometryType:this.geometryType,graphic:this.graphic,sketchOptions:this.sketchOptions,tooltipInfos:this.tooltipInfos,view:this.view}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(e){this._set("centered",e),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(e){this._set("cursor",e)}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(e){this._set("graphicSymbol",e),null!=this._graphic&&(this._graphic.symbol=e)}set mode(e){const t=this.drawOperation;t&&(t.drawingMode=e),this._set("mode",e)}get updating(){return this.drawOperation?.updating??!1}get undoRedo(){const{view:{type:e,map:t}}=this;return"2d"===e&&t&&"undoRedo"in t&&t.undoRedo instanceof T?t.undoRedo:null}set undoRedo(e){this._override("undoRedo",e)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.destroyed||(0,Te.wG)(e,this.tooltip)||this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),0===this.drawOperation.numCommittedVertices&&Ne(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(tt.outline),this.removeHandles(tt.regularVertices),this.removeHandles(tt.activeVertex),this.removeHandles(tt.activeEdge),this.removeHandles(et)}_createOrUpdateGraphic(e){if(null!=this._graphic)return this.updateGraphicGeometry(e),this._graphic;const t=new o.default({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=t,this.updateGraphicGeometry(e),this.internalGraphicsLayer.add(t),this.addHandles(this.initializeGraphic(t)),this.notifyChange("graphic"),this.addHandles((0,S.hA)((()=>{this.internalGraphicsLayer.remove(t),this._graphic===t&&(this._graphic=null)})),et),t}updateGraphicGeometry(e){this._graphic.geometry=e}_getCreateOperationGeometry(e={operationComplete:!1}){if(null==this.drawOperation)return;const{coordinateHelper:t,view:n,visualizationCursorVertex:i,lastVertex:r,committedVertices:s,geometryIncludingUncommittedVertices:o,numCommittedVertices:a}=this.drawOperation;if(!(a>0||null!=i))return;const l=e.operationComplete?s:o,c=l.length,u=null!=i?t.pointToArray(i):null,h=this._drawSpatialReference,d="3d"===n.type&&"global"===n.viewingMode,p=new R;p.committedVertices=s,p.cursorVertex=u;const{geometryType:f}=this;switch(f){case"point":case"mesh":p.full=t.arrayToPoint(l[0]);break;case"multipoint":p.full=c>0?function(e,t){return new re.A({points:e,spatialReference:t})}(l,h):null;break;case"polyline":case"polygon":c>0&&(p.full="polygon"===f?le([l],h,d,!0):ae([l],h,d),p.cursorEdge=null!=u&&r&&!(0,O.CI)(i,r)?ae([[u,t.pointToArray(r)]],h,d):null,p.outline=c>1?p.full:null);break;case"circle":case"rectangle":{if(p.committedVertices=p.cursorVertex=null,!c)break;const t=function(e,t){if("2d"===e.type)return new ne(e.state.transform,e.spatialReference,t.length>2?t[2]:null);if("3d"===e.type){const n=t.length>2?new z.default({x:t[0],y:t[1],z:t[2],spatialReference:e.spatialReference}):new z.default({x:t[0],y:t[1],spatialReference:e.spatialReference});return new ie(e,n)}return null}(n,l[0]),i=l[0],r=t.makeMapPoint(i[0]+it*n.resolution,i[1]);"circle"===f?1===c&&e.operationComplete?p.circle=me([i,r],t,!0):2===c&&(this.forceUniformSize?p.circle=me(l,t,this.centered):p.rectangle=function(e,t,n){const i=t.mapToLocalMultiple(e),r=i[0],s=i[1],o=Math.round(s.x-r.x),a=Math.round(s.y-r.y),l=ee(n?r.x:r.x+o/2,n?r.y:r.y+a/2),c=n?o:o/2,u=n?a:a/2,h=[],d=2*Math.PI/60;function p(e){const t=Math.cos(e),n=Math.sin(e);return ee(c*t+l.x,u*n+l.y)}for(let e=0;e<60;e++)h.push(p(e*d));h.push(h[0]);const{spatialReference:f,doUnnormalization:m}=t,g=le([h.map((e=>t.localToMap(e))).filter(I.Ru)],f,m,!1),_=t.localToMap(p(Math.PI/2)),v=t.localToMap(p(0)),y=t.localToMap(p(-Math.PI/2)),b=t.localToMap(p(Math.PI));return{geometry:g,midpoints:null!=_&&null!=v&&null!=y&&null!=b?{top:oe(_,f),right:oe(v,f),bottom:oe(y,f),left:oe(b,f)}:null}}(l,t,this.centered)):1===c&&e.operationComplete?p.rectangle=ce([i,r],t,!0):2===c&&(p.rectangle=this.forceUniformSize?ce(l,t,this.centered):function(e,t,n){let i=t.mapToLocalMultiple(e);if(1===i.length){const e=48,t=i[0];i=[ee(t.x-e,t.y+e),ee(t.x+e,t.y-e),ee(t.x+e,t.y-e),ee(t.x-e,t.y+e)]}const r=[],s={x:i[0].x,y:i[0].y},o={x:i[1].x,y:i[1].y};if(n){const e=Math.round(o.x-s.x),t=Math.round(o.y-s.y);r.push(ee(s.x-e,s.y-t),ee(o.x,s.y-t),ee(o.x,o.y),ee(s.x-e,o.y))}else r.push(ee(s.x,s.y),ee(o.x,s.y),ee(o.x,o.y),ee(s.x,o.y));return ue(le([r.map((e=>t.localToMap(e))).filter(I.Ru)],t.spatialReference,t.doUnnormalization,!0),r,t)}(l,t,this.centered)),p.full=null!=p.circle?p.circle.geometry:p.rectangle?.geometry,p.outline="polygon"===p.full?.type?p.full:null;break}default:return null}return p}initializeGraphic(e){return(0,S.hA)()}onComplete(e){if(!this.drawOperation)return;this._updateGraphic();let t=null;if(this.drawOperation.isCompleted){const e=this._getCreateOperationGeometry({operationComplete:!0});null!=e&&(t=this._createOrUpdateGraphic(e.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:t,...e})}onCursorUpdate(e){this._updateGraphic(),this.emit("cursor-update",e)}onDeactivate(){const{drawOperation:e}=this;e&&(e.isCompleted||e.cancel())}onOutlineChanged(e){return(0,S.hA)()}onCursorEdgeChanged(e){return(0,S.hA)()}onVertexAdd(e){Fe(this._tooltipsContext),this._updateGraphic(),function(e,t){const{drawOperation:n,view:i}=t,r=ze(t),s=$e(t);if("2d"===i.type||!e||"absolute-height"!==s.mode||1!==n?.numCommittedVertices||!r||"draw-polyline"!==r.type&&"draw-polygon"!==r.type||r.elevation.locked)return;const[o,a,l]=e,c=function(e,t,n,i,r){const{view:s,drawOperation:o}=r;if("3d"!==s.type||!o)return;n??=0;const a=Ze(r),l=$e(r),c=(0,_e.Fo)(s,e,t,n,a,l,i);return(0,Le.Qc)(c,a)??We(r)}(o,a,l,s,t);null!=c&&r.elevation.lock(c)}(e.vertices.at(0)?.coordinates,this._tooltipsContext),this.emit("vertex-add",e)}onVertexRemove(e){Fe(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateGraphic(),this.emit("vertex-update",e)}_updateGraphic(){const e=this._getCreateOperationGeometry();this._createOperationGeometry=e,null!=e?(null!=e.cursorEdge?this.addHandles(this.onCursorEdgeChanged(e.cursorEdge),tt.activeEdge):this.removeHandles(tt.activeEdge),null!=e.outline?this.addHandles(this.onOutlineChanged(e.outline),tt.outline):this.removeHandles(tt.outline),null!=e.committedVertices?this.addHandles(this.onRegularVerticesChanged(e.committedVertices),tt.regularVertices):this.removeHandles(tt.regularVertices),null!=e.cursorVertex?this.addHandles(this.onActiveVertexChanged(e.cursorVertex),tt.activeVertex):this.removeHandles(tt.activeVertex),null!=e.full?this._createOrUpdateGraphic(e.full):this.removeHandles(et)):this._destroyAllVisualizations()}get activeTooltipInfo(){return this._coordinateFormatterLoadTask?.finished?ze(this._tooltipsContext):null}};(0,s._)([(0,u.MZ)()],Je.prototype,"_coordinateFormatterLoadTask",void 0),(0,s._)([(0,u.MZ)()],Je.prototype,"_createOperationGeometry",void 0),(0,s._)([(0,u.MZ)()],Je.prototype,"_tooltipsContext",null),(0,s._)([(0,u.MZ)({value:!0})],Je.prototype,"centered",null),(0,s._)([(0,u.MZ)()],Je.prototype,"cursor",null),(0,s._)([(0,u.MZ)({nonNullable:!0})],Je.prototype,"defaultZ",void 0),(0,s._)([(0,u.MZ)({constructOnly:!0})],Je.prototype,"directionOptions",void 0),(0,s._)([(0,u.MZ)()],Je.prototype,"drawOperation",void 0),(0,s._)([(0,u.MZ)({value:!0})],Je.prototype,"enabled",null),(0,s._)([(0,u.MZ)({value:!0})],Je.prototype,"forceUniformSize",null),(0,s._)([(0,u.MZ)({constructOnly:!0})],Je.prototype,"geometryType",void 0),(0,s._)([(0,u.MZ)()],Je.prototype,"graphic",null),(0,s._)([(0,u.MZ)({constructOnly:!0})],Je.prototype,"graphicProperties",void 0),(0,s._)([(0,u.MZ)()],Je.prototype,"graphicSymbol",null),(0,s._)([(0,u.MZ)({constructOnly:!0})],Je.prototype,"hasZ",void 0),(0,s._)([(0,u.MZ)({constructOnly:!0})],Je.prototype,"geometryToPlace",void 0),(0,s._)([(0,u.MZ)()],Je.prototype,"mode",null),(0,s._)([(0,u.MZ)()],Je.prototype,"snappingManager",void 0),(0,s._)([(0,u.MZ)()],Je.prototype,"snapToScene",void 0),(0,s._)([(0,u.MZ)()],Je.prototype,"tooltip",void 0),(0,s._)([(0,u.MZ)()],Je.prototype,"tooltipInfos",void 0),(0,s._)([(0,u.MZ)({constructOnly:!0,type:Ye.A})],Je.prototype,"sketchOptions",void 0),(0,s._)([(0,u.MZ)()],Je.prototype,"updating",null),(0,s._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],Je.prototype,"view",void 0),(0,s._)([(0,u.MZ)({constructOnly:!0})],Je.prototype,"undoRedo",null),(0,s._)([(0,u.MZ)()],Je.prototype,"activeTooltipInfo",null),Je=(0,s._)([(0,h.$)("esri.views.draw.DrawGraphicTool")],Je);const et=Symbol("create-operation-graphic"),tt={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function nt(e){switch(e){case"point":case"polyline":case"polygon":case"multipoint":return e;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const it=48},85499:function(e,t,n){"use strict";n.d(t,{O0:function(){return F}});var i=n(53804),r=n(83525),s=n(48996),o=n(21609),a=n(95929),l=n(7213),c=n(60539),u=n(85876),h=n(28181),d=n(13520),p=n(23502),f=(n(58941),n(40633),n(65953)),m=n(72952),g=n(20248),_=n(42413),v=n(68945),y=n(65420);const b="click";class T{constructor({consumesClicks:e,grabbableForEvent:t}){this.events=new s.A,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.consumesClicks=e,this.grabbableForEvent=t}destroy(){}intersectionDistance(e,t){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}}var E=n(50517),x=n(2831),S=n(2623),w=n(7819),A=n(92100),M=n(7768),O=n(50822),R=n(58144),C=n(45908),I=(n(13798),n(48961));let P=class extends r.A{constructor(e){super(e),this.constrainResult=e=>e,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=(0,c.sg)((async(e,t,n,i)=>{const r=this._frameTask;if(null==r)return;const s=await r.schedule((()=>t.snap({...e,context:n,signal:i})),i);s.valid&&await r.schedule((()=>{this.stagedPoint=s.apply(),e!==this._snapPoints&&null!=this._snapPoints&&(this.stagedPoint=t.update({...this._snapPoints,context:n}))}),i)}))}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){const e="3d"===this.view.type?this.view?.resourceController?.scheduler:null;this._frameTask=null!=e?e.registerTask(I.W6.SNAPPING):I.nu}destroy(){this._abortController=(0,a.DC)(this._abortController),this._frameTask=(0,a.xt)(this._frameTask)}update(e,t,n){this._snapPoints=e;const{point:i,scenePoint:r}=e,s=t.update({point:i,scenePoint:r,context:n});return this.stagedPoint=s,s}async snap(e,t,n){const{point:i,scenePoint:r}=e;return this.stagedPoint=t.update({point:i,scenePoint:r,context:n}),this._snapPoints=e,null==this._abortController&&(this._abortController=new AbortController),this._snap(e,t,n,this._abortController.signal)}async snapAgainNearPreviousMapPoint(e,t){null!=this._snapPoints&&await this.snap(this._snapPoints,e,t)}abort(){this._abortController=(0,a.DC)(this._abortController),this._snapPoints=null}};(0,i._)([(0,p.MZ)({constructOnly:!0})],P.prototype,"view",void 0),(0,i._)([(0,p.MZ)()],P.prototype,"stagedPoint",null),(0,i._)([(0,p.MZ)()],P.prototype,"constrainResult",void 0),(0,i._)([(0,p.MZ)()],P.prototype,"_stagedPoint",void 0),P=(0,i._)([(0,f.$)("esri.views.interactive.snapping.SnappingOperation")],P);var D=n(44425);const L=Symbol(),N=Symbol();let F=class extends(s.A.EventedMixin(r.A)){constructor(e){super(e),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new u.A,this._stagedScreenPoint=null,this._stagedPointerType=null,this._updatingHandles=new g.U,this._stagedPointerId=null,this.constraintsEnabled=!1,this.constraints=void 0,this._getPointConstraint=(0,l.B)(M.cx),this._getPolylineOrPolygonConstraint=(0,l.B)(M.lJ),this.constraintZ=null,this.defaultZ=null,this.isDraped=!0,this.labelOptions=new O.A,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.firstVertex=null,this.lastVertex=null,this.secondToLastVertex=null,null==e.elevationInfo&&(this.elevationInfo=(0,v.bK)(!!e.hasZ))}initialize(){const{geometryType:e,view:t}=this,n=t.spatialReference,i="viewingMode"in t.state?t.state.viewingMode:y.RT.Local,r="segment"===e||"multipoint"===e?"polyline":e;this.coordinateHelper=(0,E.BV)(this.hasZ,this.hasM,n),this._editGeometryOperations=new w.p(new S.ZE(r,this.coordinateHelper),i),this._snappingOperation=new P({view:t}),this.addHandles([(0,h.watch)((()=>({stagedPoint:this._snappingOperation.stagedPoint,constraint:this._constraint})),(({stagedPoint:e,constraint:t},n)=>{const{snappingOptions:i}=this;if(i&&(i.forceDisabled=null!=t&&(0,A.fT)(t)),null!=n&&e===n.stagedPoint&&t!==n.constraint)return this._onKeyboardBasedChange();this._processCursor(e??this._screenToMap(this._stagedScreenPoint))}),{equals:(e,t)=>e.stagedPoint===t.stagedPoint&&(0,a.CM)(e.constraint,t.constraint)}),(0,h.watch)((()=>this.view.viewpoint),((e,t)=>{e&&t&&(0,m.Ui)(e,t)&&this._onKeyboardBasedChange()}))]),this._activeComponent=new S.uA(n,i),this._editGeometryOperations.data.components.push(this._activeComponent);const s=this.segmentLabels;null!=s&&(s.context={view:t,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.addHandles((0,h.watch)((()=>this.labelOptions.enabled),(e=>{s.visible=e}),h.pc))),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],(e=>{const t=e.vertices.map((e=>({componentIndex:0,vertexIndex:e.index,coordinates:this.coordinateHelper.vectorToArray(e.pos)}))),n=t.map((e=>e.coordinates)),i=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getFirstVertex()?.pos)??null;(0,_.CI)(i,this.firstVertex)||(this.firstVertex=i);const r=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getLastVertex()?.pos)??null;(0,_.CI)(r,this.lastVertex)||(this.lastVertex=r);const s=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.edges.at(-1)?.leftVertex?.pos)??null;switch((0,_.CI)(s,this.secondToLastVertex)||(this.secondToLastVertex=s),this._processCursor(this.cursorVertex),e.type){case"vertex-add":this.emit(e.type,{...e,added:n,vertices:t});break;case"vertex-update":this.emit(e.type,{...e,updated:n,vertices:t});break;case"vertex-remove":this.emit(e.type,{...e,removed:n,vertices:t})}})));const o=this._manipulator=new T({consumesClicks:!1,grabbableForEvent:e=>"click"!==this.drawingMode||"touch"===e.pointerType&&this._snappingEnabled&&1===this._pointerDownStates.size});this.manipulators.add(o),o.grabbable="point"!==e,this.addHandles([o.events.on("immediate-click",(e=>this._onImmediateClick(e))),o.events.on("immediate-double-click",(e=>this._onImmediateDoubleClick(e))),(0,h.watch)((()=>this.drawingMode),(()=>{this.removeHandles(L),this.addHandles(this._createManipulatorDragPipeline(o),L)}),h.pc),(0,h.watch)((()=>({effectiveCursor:this.effectiveCursor})),(({effectiveCursor:e})=>{o.cursor=e}),h.pc)]),(0,D.BY)(this,(()=>{const e=this.view.inputManager.latestPointerType??"mouse",t=this._getSnappingContext(e);if(null!=this.snappingManager){const e=this._snappingOperation.snapAgainNearPreviousMapPoint(this.snappingManager,t);this._updatingHandles.addPromise((0,c.QZ)(e))}}))}destroy(){(0,a.pR)(this.segmentLabels),(0,a.pR)(this._snappingOperation),this._editGeometryOperations=(0,a.pR)(this._editGeometryOperations),this._updatingHandles.destroy()}get _isDragging(){const{_stagedPointerId:e,_manipulator:t}=this;return null!=e&&this._pointerDownStates.has(e)||t.grabbing||!t.interactive}get _snappingEnabled(){return null!=this.snappingManager&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const e=this._updateAndGetEffectiveDrawSurface();return"3d"===this.view.type&&this.drawSurface!==e}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map((e=>this.coordinateHelper.vectorToArray(e.pos)))}get _constraint(){const{constraints:e,constraintsEnabled:t}=this;if(e&&t)switch(this.geometryType){case"point":return this._getPointConstraint(e);case"polygon":case"polyline":return this._getPolylineOrPolygonConstraint(this.lastVertex,this.secondToLastVertex,e)}}set drawingMode(e){this._set("drawingMode",e??b)}get effectiveCursor(){return this.loading?"progress":this._hideDefaultCursor?null:this.cursor||"crosshair"}get interactive(){return this._manipulator.interactive}set interactive(e){this._manipulator.interactive=e}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get snappingOptions(){return null!=this.snappingManager?this.snappingManager.options:null}get cursorVertex(){return this._get("cursorVertex")}get visualizationCursorVertex(){return"mouse"===this._stagedPointerType?this.cursorVertex:null}get committableVertex(){const{cursorVertex:e,lastVertex:t,firstVertex:n,geometryType:i}=this;return"polygon"===i&&(0,_.fk)(e,n)||(0,_.fk)(e,t)?null:e}get updating(){return this._updatingHandles.updating}get geometryIncludingUncommittedVertices(){const{committedVertices:e,committableVertex:t,coordinateHelper:n}=this,i=e.slice();return null!=t&&i.push(n.pointToArray(t)),i}cancel(){this.complete({aborted:!0})}commitStagedVertex(){this._snappingOperation.abort();const{committableVertex:e}=this;null!=e&&this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(e))}complete(e){const t=e?.aborted||!1;this._snappingOperation.abort(),this.snappingManager?.doneSnapping();const{geometryType:n,numCommittedVertices:i}=this,r="multipoint"===n&&0===i||"polyline"===n&&i<2||"polygon"===n&&i<3;"segment"!==n&&"point"!==n||this.commitStagedVertex(),this._createOperationCompleted=!r,(this.isCompleted||t)&&(this._stagedScreenPoint=null,this._stagedPointerId=null,this._stagedPointerType=null,this._processCursor(null),this.emit("complete",{vertices:this.committedVertices.map(((e,t)=>({componentIndex:0,vertexIndex:t,coordinates:e}))),aborted:t,type:"complete"}))}onInputEvent(e){switch(e.type){case"pointer-down":this._pointerDownStates.add(e.pointerId);break;case"pointer-up":this._pointerDownStates.delete(e.pointerId)}switch(e.type){case"pointer-move":return this._onPointerMove(e);case"hold":return this._onHold(e)}}redo(){this._editGeometryOperations.redo()}undo(){null!=this.snappingManager&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_processCursor(e){const t=(0,o.o8)(this.cursorVertex),n=(0,o.o8)(e),i=n&&(this._updateAndGetEffectiveDrawSurface()?.constrainZ(n)??n),r=this._snapToClosingVertex(i),s=this._applyConstraints(r);(0,_.fk)(t,s)||(this._set("cursorVertex",s),this.segmentLabels?.set("stagedVertex",null!=s?this.coordinateHelper.pointToVector(s):null),null==s||"mouse"!==this._stagedPointerType?this.emit("cursor-remove"):this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(s)}],operation:"apply",type:"vertex-update"}))}_snapToClosingVertex(e){if(null==e||this._isDragging||"polygon"!==this.geometryType||this.numCommittedVertices<=2)return e;const t=this._mapToScreen(e);if(!t)return e;const n=this._activeComponent;return this._vertexWithinPointerDistance(n.vertices[0].pos,t)?this.firstVertex:this._vertexWithinPointerDistance(n.vertices.at(-1).pos,t)?this.lastVertex:e}_createManipulatorDragPipeline(e){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(e);case"freehand":return this._createManipulatorDragPipelineFreehand(e);case"hybrid":return this._createManipulatorDragPipelineHybrid(e)}}_createManipulatorDragPipelineClick(e){return(0,x.Xt)(e,((e,t,n,i)=>{const r="touch"===i&&this._snappingEnabled;if(this.isCompleted||!r)return;const{snappingStep:s,cancelSnapping:o}=(0,C.L)({predicate:()=>r,snappingManager:this.snappingManager,snappingContext:new R.e({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:i,visualizer:this.snappingVisualizer,drawConstraints:this.constraints}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});n=n.next((e=>(r&&null!=this.snappingManager&&this.snappingManager.doneSnapping(),e))).next(o),t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(this._processCursor(e.mapStart),("segment"===this.geometryType||r&&!this.numCommittedVertices)&&this.commitStagedVertex()),e))).next((0,x.pg)(this.view,this.elevationInfo)).next(...s).next((e=>(r&&(this._processCursor(e.mapEnd),"end"===e.action&&this.commitStagedVertex()),e))).next((e=>("end"===e.action&&("mouse"!==this._stagedPointerType&&this._snappingOperation.abort(),"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()),e)))}))}_createManipulatorDragPipelineFreehand(e){return(0,x.Xt)(e,((e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(this._snappingOperation.abort(),null==this.committableVertex&&this._processCursor(e.mapStart),"segment"===this.geometryType&&this.commitStagedVertex()),e))).next((e=>{switch(e.action){case"start":case"update":this._processCursor(e.mapEnd),"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":this.complete()}return e}))}))}_createManipulatorDragPipelineHybrid(e){return(0,x.Xt)(e,((e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(this._snappingOperation.abort(),this.addHandles(this._editGeometryOperations.createUndoGroup(),N),this._processCursor(e.mapStart),this.commitStagedVertex()),e))).next((e=>{switch(e.action){case"start":case"update":this._processCursor(e.mapEnd),"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":"mouse"!==this._stagedPointerType&&this._snappingOperation.abort(),this.removeHandles(N),"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()}return e}))}))}get _drawAtFixedElevation(){const{constraintsEnabled:e,constraintZ:t,geometryType:n,numCommittedVertices:i}=this;return e?null!=t||"segment"===n&&i>0:("segment"===n||"polygon"===n)&&i>0}_updateAndGetEffectiveDrawSurface(){const{constraintsEnabled:e,coordinateHelper:t,drawSurface:n,elevationDrawSurface:i,snapToSceneEnabled:r}=this;if(null==i)return n;if(!this.hasZ)return i.defaultZ=null,i;const s=this.elevationInfo?.mode;let o=this.defaultZ,a=e||"absolute-height"===s;return null!=r&&(a=r),"on-the-ground"===s&&(a=!1),this._drawAtFixedElevation&&(o=(e?this.constraintZ:null)??t.getZ(this._activeComponent.vertices[0].pos),a=!1),a?n:(i.defaultZ=o,i)}_mapToScreen(e){return this._updateAndGetEffectiveDrawSurface()?.mapToScreen(e)}_onHold(e){this._snappingOperation.abort(),"click"===this.drawingMode&&"touch"===e.pointerType&&this._snappingEnabled&&this._processCursor(e.mapPoint),e.stopPropagation()}_onImmediateClick(e){if(!("mouse"===e.pointerType&&2===e.button||this._manipulator.dragging))try{const{drawingMode:t,geometryType:n}=this;this._stagedPointerType=e.pointerType,this._stagedScreenPoint=e.screenPoint;const i=this._screenToMap(e.screenPoint);if(null==i)return;if(null==i||"freehand"===t&&"point"!==n)return;if(this._snappingEnabled&&null!=this.cursorVertex||this._processCursor(i),null==this.committableVertex)return void this.complete();this.commitStagedVertex(),"mouse"!==e.pointerType&&this._processCursor(null),("freehand"===t||"point"===n||"segment"===n&&2===this.numCommittedVertices||"segment"===n&&"hybrid"===t&&1===this.numCommittedVertices)&&this.complete()}finally{e.stopPropagation()}}_onImmediateDoubleClick(e){this._manipulator.dragging||"point"===this.geometryType||(this.complete(),e.stopPropagation())}_onPointerMove(e){const t=(0,d.tc)(e.x,e.y);this._stagedScreenPoint=t,this._stagedPointerType=e.pointerType,this._stagedPointerId=e.pointerId,this._isDragging?this._snappingOperation.abort():(e.stopPropagation(),this._processCursorMovementRelativeToSurface(t,e.pointerType))}_onKeyboardBasedChange(){"mouse"===this._stagedPointerType&&this._stagedScreenPoint&&null!=this._stagedPointerId&&!this._isDragging?this._processCursorMovementRelativeToSurface(this._stagedScreenPoint,this._stagedPointerType):this._snappingOperation.abort()}_processCursorMovementRelativeToSurface(e,t){const n=this._snappingOperation,i=this._screenToMap(e),r=this._requiresScenePoint?this.drawSurface?.screenToMap(e):null;if(null==i)return this._hideDefaultCursor=!0,this._processCursor(null),void n.abort();this._hideDefaultCursor=!1;const s=this.snappingManager;if(null==s)return this._processCursor(i),void n.abort();const o=this._getSnappingContext(t);this._updatingHandles.addPromise((0,c.QZ)(n.snap({point:i,scenePoint:r},s,o)))}_applyConstraints(e){const{_constraint:t,constraints:n}=this;if(!e||!n||!t)return e;const{context:i}=n,r=(0,M.dz)(e,i),s=r?t.closestTo(r):void 0;if(!s)return e;const o=(0,M.tC)(s,e,i),a="2d"===this.view.type||"absolute-height"!==i.elevationInfo.mode;return null!=o&&a&&null!=this.constraintZ&&this.hasZ&&(o.z=this.constraintZ),o}_screenToMap(e){return e?this._updateAndGetEffectiveDrawSurface()?.screenToMap(e):null}_screenToMapDragEventStep(){let e=null;return t=>{if("start"===t.action&&(e=this._screenToMap(t.screenStart)),null==e)return null;const n=this._screenToMap(t.screenEnd);return null!=n?{...t,mapStart:e,mapEnd:n}:null}}_vertexWithinPointerDistance(e,t){const n=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(e));return null!=n&&function(e,t,n){const i=e.x-t.x,r=e.y-t.y;return i*i+r*r<=25}(n,t)}_getSnappingContext(e){const t=this._drawAtFixedElevation?this.elevationDrawSurface?.defaultZ:null;return new R.e({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:e,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:null!=t?{value:t,elevationInfo:this.elevationInfo}:null,drawConstraints:this.constraints})}};(0,i._)([(0,p.MZ)()],F.prototype,"_hideDefaultCursor",void 0),(0,i._)([(0,p.MZ)()],F.prototype,"_stagedPointerId",void 0),(0,i._)([(0,p.MZ)()],F.prototype,"_isDragging",null),(0,i._)([(0,p.MZ)()],F.prototype,"_snappingOperation",void 0),(0,i._)([(0,p.MZ)()],F.prototype,"_snappingEnabled",null),(0,i._)([(0,p.MZ)({constructOnly:!0})],F.prototype,"graphic",void 0),(0,i._)([(0,p.MZ)()],F.prototype,"constraintsEnabled",void 0),(0,i._)([(0,p.MZ)()],F.prototype,"constraints",void 0),(0,i._)([(0,p.MZ)()],F.prototype,"_constraint",null),(0,i._)([(0,p.MZ)()],F.prototype,"constraintZ",void 0),(0,i._)([(0,p.MZ)()],F.prototype,"defaultZ",void 0),(0,i._)([(0,p.MZ)()],F.prototype,"isDraped",void 0),(0,i._)([(0,p.MZ)({value:b})],F.prototype,"drawingMode",null),(0,i._)([(0,p.MZ)({constructOnly:!0})],F.prototype,"elevationDrawSurface",void 0),(0,i._)([(0,p.MZ)({constructOnly:!0})],F.prototype,"elevationInfo",void 0),(0,i._)([(0,p.MZ)({constructOnly:!0,type:O.A})],F.prototype,"labelOptions",void 0),(0,i._)([(0,p.MZ)({constructOnly:!0})],F.prototype,"geometryType",void 0),(0,i._)([(0,p.MZ)({constructOnly:!0})],F.prototype,"hasM",void 0),(0,i._)([(0,p.MZ)({constructOnly:!0})],F.prototype,"hasZ",void 0),(0,i._)([(0,p.MZ)()],F.prototype,"cursor",void 0),(0,i._)([(0,p.MZ)()],F.prototype,"effectiveCursor",null),(0,i._)([(0,p.MZ)()],F.prototype,"loading",void 0),(0,i._)([(0,p.MZ)({constructOnly:!0})],F.prototype,"manipulators",void 0),(0,i._)([(0,p.MZ)({constructOnly:!0})],F.prototype,"drawSurface",void 0),(0,i._)([(0,p.MZ)({constructOnly:!0})],F.prototype,"segmentLabels",void 0),(0,i._)([(0,p.MZ)({constructOnly:!0})],F.prototype,"snappingManager",void 0),(0,i._)([(0,p.MZ)({constructOnly:!0})],F.prototype,"snappingVisualizer",void 0),(0,i._)([(0,p.MZ)()],F.prototype,"snapToSceneEnabled",void 0),(0,i._)([(0,p.MZ)({readOnly:!0})],F.prototype,"cursorVertex",null),(0,i._)([(0,p.MZ)({readOnly:!0})],F.prototype,"visualizationCursorVertex",null),(0,i._)([(0,p.MZ)()],F.prototype,"committableVertex",null),(0,i._)([(0,p.MZ)()],F.prototype,"firstVertex",void 0),(0,i._)([(0,p.MZ)()],F.prototype,"lastVertex",void 0),(0,i._)([(0,p.MZ)()],F.prototype,"secondToLastVertex",void 0),(0,i._)([(0,p.MZ)()],F.prototype,"updating",null),(0,i._)([(0,p.MZ)({constructOnly:!0})],F.prototype,"view",void 0),F=(0,i._)([(0,f.$)("esri.views.draw.DrawOperation")],F)},99113:function(e,t,n){"use strict";n.d(t,{IX:function(){return u},rT:function(){return c},uF:function(){return h}}),n(50917);var i=n(13520),r=n(46460),s=n(45328),o=n(68945),a=n(57165),l=n(45532);class c{constructor(e,t,n,i=null){this._elevationInfo=e,this.defaultZ=t,this._view=n,this._excludeGraphics=i}screenToMap(e){const{defaultZ:t,_view:n}=this,r=n.sceneIntersectionHelper.intersectElevationFromScreen((0,i.gs)(e.x,e.y),this._elevationInfo,t??0,this._excludeGraphics);return null==t&&null!=r&&(r.z=void 0),r}mapToScreen(e){const t=(0,r.T)(e.x,e.y,(0,o.wS)(this._view,e,this._elevationInfo),e.spatialReference);return this._view.toScreen(t)}constrainZ(e){const{defaultZ:t}=this;return null!=t&&e.z!==t&&((e=(0,s.EL)(e)).z=t),e}}class u{constructor(e,t,n=[]){this.view=e,this.elevationInfo=t,this.exclude=n}screenToMap(e){const t=this.view.toMap(e,{exclude:this.exclude,excludeHud:!0});return null!=t&&(t.z=(0,o.id)(t,this.view,this.elevationInfo)),t}mapToScreen(e){let t=e;return null!=this.elevationInfo&&(t=(0,r.T)(e.x,e.y,(0,o.wS)(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(t)}constrainZ(e){return e}}class h{constructor(e,t=!1,n=0){this.view=e,this.hasZ=t,this.defaultZ=n,this.mapToScreen=t=>e.toScreen(t),this.screenToMap=t?t=>{const i=e.toMap(t);return i.z=n,i}:t=>e.toMap(t)}constrainZ(e){const{defaultZ:t}=this;return this.hasZ&&e.z!==t&&((e=(0,s.EL)(e)).z=t),e}}class d{screenToMap(e){const{x:t,y:n}=e;return new l.default({x:t,y:n,spatialReference:d.spatialReference})}mapToScreen(e){return(0,i.tc)(e.x,e.y)}constrainZ(e){return e}}d.spatialReference=new a.A},71168:function(e,t,n){"use strict";var i;n.d(t,{w:function(){return i}}),function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"}(i||(i={}))},82067:function(e,t,n){"use strict";n.d(t,{l:function(){return b}});var i=n(53804),r=n(83525),s=n(48996),o=n(28181),a=n(13520),l=n(23502),c=(n(58941),n(40633),n(13798),n(65953)),u=n(13786),h=n(20551),d=n(32501),p=n(46157),f=n(56763),m=n(68945),g=n(74661),_=n(6422),v=n(17921),y=n(33383);let b=class extends r.A{set graphic(e){this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()}get elevationInfo(){const{layer:e}=this.graphic,t=e&&"elevationInfo"in e?e.elevationInfo:null,n=(0,m.ky)(this.graphic),i=t?t.offset:0;return new _.A({mode:n,offset:i})}set focusedSymbol(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())}set hovering(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())}set selected(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}constructor(e){super(e),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.consumesClicks=!0,this.events=new s.A.EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(e){const t=this.graphic;if(!1===t.visible)return null;const n=t.geometry;if(null==n)return null;const i=this._get("focusedSymbol"),r=null!=i?i:t.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,e,n,r):this._intersectDistance3D(this.view,e,t)}attach(){this.attachSymbolChanged(),null!=this.layer&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),null!=this.layer&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=(0,o.watch)((()=>this.graphic?.symbol),(e=>{null!=e&&e!==this.focusedSymbol&&e!==this._originalSymbol&&(this._originalSymbol=e,this._focused&&null!=this.focusedSymbol&&(this.graphic.symbol=this.focusedSymbol))}),o.OH)}detachSymbolChanged(){null!=this._graphicSymbolChangedHandle&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}onElevationChange(){}onViewChange(){}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&null!=this.focusedSymbol?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(e,t,n,i){if(null==(i=i||(0,g.SF)(n)))return null;let r=this._circleCollisionCache;if("point"===n.type&&"cim"===i.type&&"CIMPointSymbol"===i.data.symbol?.type&&i.data.symbol.symbolLayers){const{offsetX:r,offsetY:s,size:o}=(0,v.T)(i),l=(0,a.WA)(t,E),c=o/2,h=e.toScreen(n),d=h.x+r,p=h.y+s;return(0,u.hG)(l,[d,p])<c*c?1:null}if("point"!==n.type||"simple-marker"!==i.type)return(0,y.t)(t,n,e)?1:null;if(null==r||!r.originalPoint.equals(n)){const t=n,s=e.spatialReference;if((0,p.canProjectWithoutEngine)(t.spatialReference,s)){const e=(0,p.project)(t,s);r={originalPoint:t.clone(),mapPoint:e,radiusPx:(0,a.Lz)(i.size)},this._circleCollisionCache=r}}if(null!=r){const n=(0,a.WA)(t,E),s=e.toScreen?.(r.mapPoint);if(!s)return null;const o=r.radiusPx,l=s.x+(0,a.Lz)(i.xoffset),c=s.y-(0,a.Lz)(i.yoffset);return(0,u.hG)(n,[l,c])<o*o?1:null}return null}_intersectDistance3D(e,t,n){const i=e.toMap(t,{include:[n]});return i&&(0,f.g)(i,T,e.renderSpatialReference)?(0,h.p)(T,e.state.camera.eye):null}};(0,i._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],b.prototype,"graphic",null),(0,i._)([(0,l.MZ)()],b.prototype,"elevationInfo",null),(0,i._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],b.prototype,"view",void 0),(0,i._)([(0,l.MZ)({value:null})],b.prototype,"focusedSymbol",null),(0,i._)([(0,l.MZ)({constructOnly:!0})],b.prototype,"layer",void 0),(0,i._)([(0,l.MZ)()],b.prototype,"interactive",void 0),(0,i._)([(0,l.MZ)()],b.prototype,"selectable",void 0),(0,i._)([(0,l.MZ)()],b.prototype,"grabbable",void 0),(0,i._)([(0,l.MZ)({value:!1})],b.prototype,"grabbing",null),(0,i._)([(0,l.MZ)()],b.prototype,"dragging",void 0),(0,i._)([(0,l.MZ)()],b.prototype,"hovering",null),(0,i._)([(0,l.MZ)({value:!1})],b.prototype,"selected",null),(0,i._)([(0,l.MZ)()],b.prototype,"cursor",void 0),b=(0,i._)([(0,c.$)("esri.views.interactive.GraphicManipulator")],b);const T=(0,d.vt)(),E=(0,a.gs)()},83202:function(e,t,n){"use strict";n.d(t,{g:function(){return p}});var i,r,s=n(53804),o=n(83525),a=(n(58941),n(40633),n(60539)),l=n(23502),c=(n(13798),n(65953)),u=n(53551),h=n(78879);(r=i||(i={}))[r.WhenToolEditable=0]="WhenToolEditable",r[r.WhenToolNotEditable=1]="WhenToolNotEditable",r[r.Always=2]="Always";class d{constructor(){this._isToolEditable=!0,this._manipulators=new h.A,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(e){this._isToolEditable=e}get length(){return this._manipulators.length}add(e,t=i.WhenToolEditable){this.addMany([e],t)}addMany(e,t=i.WhenToolEditable){for(const n of e){const e={manipulator:n,visibilityPredicate:t,attached:!1};this._manipulators.add(e),this._attached&&this._updateManipulatorAttachment(e)}}remove(e){for(let t=0;t<this._manipulators.length;t++)if(this._manipulators.at(t).manipulator===e){const e=this._manipulators.splice(t,1)[0];this._detachManipulator(e);break}}removeAll(){this._manipulators.forEach((e=>{this._detachManipulator(e)})),this._manipulators.removeAll()}attach(){this._manipulators.forEach((e=>{this._updateManipulatorAttachment(e)})),this._attached=!0}detach(){this._manipulators.forEach((e=>{this._detachManipulator(e)})),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach((({manipulator:e})=>e.destroy())),this._manipulators.destroy(),this._resourceContexts=null}on(e,t){return this._manipulators.on(e,(e=>{t(e)}))}forEach(e){for(const t of this._manipulators.items)e(t)}some(e){return this._manipulators.items.some(e)}toArray(){const e=[];return this.forEach((t=>e.push(t.manipulator))),e}intersect(e,t){let n=null,i=Number.MAX_VALUE;return this._manipulators.forEach((({manipulator:r,attached:s})=>{if(!s||!r.interactive)return;const o=r.intersectionDistance(e,t);null!=o&&o<i&&(i=o,n=r)})),n}_updateManipulatorAttachment(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}_attachManipulator(e){e.attached||(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),e.attached=!0)}_detachManipulator(e){if(!e.attached)return;const t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach&&t.detach(this._resourceContexts),e.attached=!1}_isManipulatorItemVisible(e){return e.visibilityPredicate===i.Always||(this._isToolEditable?e.visibilityPredicate===i.WhenToolEditable:e.visibilityPredicate===i.WhenToolNotEditable)}}let p=class extends o.A{constructor(e){super(e),this.manipulators=new d,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[u.PK.MANAGER,!0],[u.PK.USER,!0]]),this._creationFinishedResolver=(0,a.Tw)()}get active(){return null!=this.view&&this.view.activeTool===this}set visible(e){this._get("visible")!==e&&(this._set("visible",e),this._syncVisible())}get editable(){return this.getEditableFlag(u.PK.USER)}set editable(e){this.setEditableFlag(u.PK.USER,e)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){null!=this.view&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}handleInputEvent(e){this.onInputEvent(e)}handleInputEventAfter(e){this.onInputEventAfter(e)}setEditableFlag(e,t){this._editableFlags.set(e,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),e===u.PK.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(e){return this._editableFlags.get(e)??!1}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(e){}onInputEventAfter(e){}get internallyEditable(){return this.getEditableFlag(u.PK.USER)&&this.getEditableFlag(u.PK.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized)if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};(0,s._)([(0,l.MZ)({constructOnly:!0})],p.prototype,"view",void 0),(0,s._)([(0,l.MZ)({readOnly:!0})],p.prototype,"active",null),(0,s._)([(0,l.MZ)({value:!0})],p.prototype,"visible",null),(0,s._)([(0,l.MZ)({value:!0})],p.prototype,"editable",null),(0,s._)([(0,l.MZ)({readOnly:!0})],p.prototype,"manipulators",void 0),(0,s._)([(0,l.MZ)({readOnly:!0})],p.prototype,"updating",null),(0,s._)([(0,l.MZ)()],p.prototype,"cursor",null),(0,s._)([(0,l.MZ)({readOnly:!0})],p.prototype,"automaticManipulatorSelection",void 0),(0,s._)([(0,l.MZ)()],p.prototype,"hasFocusedManipulators",null),(0,s._)([(0,l.MZ)()],p.prototype,"hasGrabbedManipulators",void 0),(0,s._)([(0,l.MZ)()],p.prototype,"hasHoveredManipulators",void 0),(0,s._)([(0,l.MZ)()],p.prototype,"firstGrabbedManipulator",void 0),(0,s._)([(0,l.MZ)({readOnly:!0})],p.prototype,"created",void 0),(0,s._)([(0,l.MZ)({readOnly:!0})],p.prototype,"removeIncompleteOnCancel",void 0),p=(0,s._)([(0,c.$)("esri.views.interactive.InteractiveToolBase")],p)},50517:function(e,t,n){"use strict";n.d(t,{BV:function(){return m}});var i,r,s=n(13786),o=n(1932),a=n(20551),l=n(32501),c=n(33400),u=n(41546),h=n(45532);(r=i||(i={}))[r.Z=0]="Z",r[r.M=1]="M";class d{constructor(e){this.spatialReference=e}createVector(){return this._tag((0,o.vt)())}pointToVector(e){return this._tag((0,o.fA)(e.x,e.y))}arrayToVector(e){return this._tag((0,o.fA)(e[0],e[1]))}vectorToArray(e){return[e[0],e[1]]}pointToArray(e){return[e.x,e.y]}vectorToPoint(e,t=new h.default){return t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.spatialReference=this.spatialReference,t}arrayToPoint(e,t=new h.default){return t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.spatialReference=this.spatialReference,t}vectorToDehydratedPoint(e,t){if(e)return t??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"},t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.hasZ=!1,t.hasM=!1,t.spatialReference=this.spatialReference,t}lerp(e,t,n,i){return(0,s.Cc)(i,e,t,n)}addDelta(e,t,n){e[0]+=t,e[1]+=n}distance(e,t){return(0,s.Io)(e,t)}getZ(e,t=void 0){return t}hasZ(){return!1}getM(e,t=void 0){return t}hasM(){return!1}clone(e){return this._tag((0,o.ci)(e))}copy(e,t){return(0,s.C)(t,e)}fromXYZ(e){return this._tag((0,o.fA)(e[0],e[1]))}toXYZ(e,t=(0,l.vt)()){return(0,a.s)(t,e[0],e[1],0)}pointToXYZ(e,t=(0,l.vt)()){return(0,a.s)(t,e.x,e.y,0)}equals(e,t){return(0,s.aI)(e,t)}_tag(e){return e}}class p{constructor(e,t){this._valueType=e,this.spatialReference=t}createVector(){return this._tag((0,l.vt)())}pointToVector(e){return this._tag((0,l.fA)(e.x,e.y,this._valueType===i.Z?e.z:e.m))}arrayToVector(e){return this._tag((0,l.fA)(e[0],e[1],e[2]||0))}vectorToArray(e){return[e[0],e[1],e[2]]}pointToArray(e){return this._valueType===i.Z?[e.x,e.y,e.z]:[e.x,e.y,e.m]}vectorToPoint(e,t=new h.default){return t.x=e[0],t.y=e[1],t.z=this._valueType===i.Z?e[2]:void 0,t.m=this._valueType===i.M?e[2]:void 0,t.spatialReference=this.spatialReference,t}arrayToPoint(e,t=new h.default){return t.x=e[0],t.y=e[1],t.z=this._valueType===i.Z?e[2]:void 0,t.m=this._valueType===i.M?e[2]:void 0,t.spatialReference=this.spatialReference,t}vectorToDehydratedPoint(e,t){if(!e)return;t??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"};const n=this._valueType===i.Z,r=this._valueType===i.M;return t.x=e[0],t.y=e[1],t.z=n?e[2]:void 0,t.m=r?e[2]:void 0,t.hasZ=n,t.hasM=r,t.spatialReference=this.spatialReference,t}lerp(e,t,n,i){return(0,a.o)(i,e,t,n)}addDelta(e,t,n,r){e[0]+=t,e[1]+=n,this._valueType===i.Z&&(e[2]+=r)}distance(e,t){return this._valueType===i.Z?(0,a.p)(e,t):(0,s.Io)(e,t)}getZ(e,t=void 0){return this._valueType===i.Z?e[2]:t}hasZ(){return this._valueType===i.Z}getM(e,t=void 0){return this._valueType===i.M?e[2]:t}hasM(){return this._valueType===i.M}clone(e){return this._tag((0,l.ci)(e))}copy(e,t){return(0,a.c)(t,e)}fromXYZ(e,t=0,n=0){return this._tag((0,l.fA)(e[0],e[1],this._valueType===i.Z?e.length>2?e[2]:t:n))}toXYZ(e,t=(0,l.vt)()){return(0,a.s)(t,e[0],e[1],this._valueType===i.Z?e[2]:0)}pointToXYZ(e,t=(0,l.vt)()){return(0,a.s)(t,e.x,e.y,this._valueType===i.Z?e.z??0:0)}equals(e,t){return(0,a.G)(e,t)}_tag(e){return e}}class f{constructor(e){this.spatialReference=e}createVector(){return this._tag((0,u.vt)())}pointToVector(e){return this._tag((0,u.fA)(e.x,e.y,e.z,e.m))}arrayToVector(e){return this._tag((0,u.fA)(e[0],e[1],e[2]||0,e[3]||0))}vectorToArray(e){return[e[0],e[1],e[2],e[3]]}pointToArray(e){return[e.x,e.y,e.z,e.m]}vectorToPoint(e,t=new h.default){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.spatialReference=this.spatialReference,t}arrayToPoint(e,t=new h.default){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.spatialReference=this.spatialReference,t}vectorToDehydratedPoint(e,t){if(e)return t??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"},t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.hasZ=!0,t.hasM=!0,t.spatialReference=this.spatialReference,t}lerp(e,t,n,i){return(0,c.l)(i,e,t,n)}addDelta(e,t,n,i){e[0]+=t,e[1]+=n,e[2]+=i}distance(e,t){return(0,a.p)(e,t)}getZ(e){return e[2]}hasZ(){return!0}getM(e){return e[3]}hasM(){return!0}clone(e){return this._tag((0,u.ci)(e))}copy(e,t){return(0,c.c)(t,e)}fromXYZ(e,t=0,n=0){return this._tag((0,u.fA)(e[0],e[1],e.length>2?e[2]:t,n))}toXYZ(e,t=(0,l.vt)()){return(0,a.s)(t,e[0],e[1],e[2])}pointToXYZ(e,t=(0,l.vt)()){return(0,a.s)(t,e.x,e.y,e.z??0)}equals(e,t){return(0,c.e)(e,t)}_tag(e){return e}}function m(e,t,n){return e&&t?new f(n):t?new p(i.M,n):e?new p(i.Z,n):new d(n)}},2831:function(e,t,n){"use strict";n.d(t,{EX:function(){return b},RS:function(){return M},Tp:function(){return E},Wp:function(){return p},Xt:function(){return h},an:function(){return d},bl:function(){return _},dp:function(){return v},mc:function(){return y},pg:function(){return w},rh:function(){return S},sO:function(){return T},y$:function(){return g}});var i=n(50659),r=(n(58941),n(21609),n(15774)),s=n(13520),o=n(46157),a=n(67376),l=n(45328),c=n(68945),u=n(7819);function h(e,t){return e.events.on("drag",function(e,t){let n=null,i=null;return r=>{if("cancel"===r.action)return void(null!=i&&(i.execute({action:"cancel"}),n=null,i=null));const s={action:r.action,screenStart:r.start,screenEnd:r.screenPoint};"start"===r.action&&null==n&&(n=new S,i=new S,t(e,n,i,r.pointerType,s)),null!=n&&n.execute(s),"end"===r.action&&null!=n&&(n=null,i=null)}}(e,t))}function d(e,t){const n=[e.x,e.y,e.z??0],i=t,r=[Math.cos(i),Math.sin(i)],s=Math.sqrt(r[0]*r[0]+r[1]*r[1]);if(0===s)return null;r[0]/=s,r[1]/=s;const o=e=>{const t=(e.x-n[0])*r[0]+(e.y-n[1])*r[1];e.x=n[0]+t*r[0],e.y=n[1]+t*r[1]};return e=>(o(e.mapStart),o(e.mapEnd),{...e,axis:r})}function p(e){let t=null;return n=>{if("start"===n.action&&(t=function(e,t){const n=e.operations;if(!n)return null;const i=n.data.geometry,r=(0,l.RS)(t);if(i.spatialReference.equals(r))return m(e,n,(()=>{}));if("mesh"!==i.type){const t=f(i,r);if(null==t)return null;const s=i.spatialReference;return m(e,u.p.fromGeometry(t,n.viewingMode),(()=>{const e=(0,o.project)(i,s);n.trySetGeometry(e)}))}if((0,a.CK)(i)){const t=f(i.origin,r);if(!t)return null;const s=i.spatialReference,a=u.p.fromGeometry(t,n.viewingMode);return m(e,n,(()=>{const e=(0,o.project)(a.data.geometry,s),t=e.x-i.origin.x,r=e.y-i.origin.y,l=(e.z??0)-(i.origin.z??0);n.move(t,r,l)}))}return null}(e,n.mapStart.spatialReference)),null==t)return null;const i=n.mapEnd.x-n.mapStart.x,r=n.mapEnd.y-n.mapStart.y,s=(n.mapEnd.z??0)-(n.mapStart.z??0);return t.move(i,r,s,n.action),{...n,translationX:i,translationY:r,translationZ:s}}}function f(e,t){return null==e?null:e.spatialReference.equals(t)?e.clone():(0,o.project)(e,t)}function m(e,t,n){let i=0,r=0,s=0;return{move:(o,a,l,c)=>{"start"===c&&(i=0,r=0,s=0);const u=o-i,h=a-r,d=l-s;t.move(u,h,d),i+=u,r+=h,s+=d,n(),"end"===c&&e.endInteraction?.()}}}function g(e,t=null,n){let i=null;const r=null==t||e.spatialReference?.equals(t)?e=>e:e=>null!=e?(0,o.project)(e,t):e,s={exclude:[],...n};return t=>{if("start"===t.action&&(i=r(e.toMap(t.screenStart,s))),null==i)return null;const n=r(e.toMap(t.screenEnd,s));return null!=n?{...t,mapStart:i,mapEnd:n}:null}}function _(e){const t=e.map((e=>p(e))).filter(i.Ru);return e=>{const n=e.mapEnd.x-e.mapStart.x,i=e.mapEnd.y-e.mapStart.y,r=e.mapEnd.z-e.mapStart.z;return t.forEach((t=>t(e))),{...e,translationX:n,translationY:i,translationZ:r}}}function v(e){const t=e.operations?.createResetState();return e=>(t?.remove(),e)}function y(e){const t=e.map((e=>v(e))).filter((e=>null!=e));return e=>(t.forEach((t=>t(e))),e)}function b(){let e=0,t=0,n=0;return i=>{"start"===i.action&&(e=i.mapStart.x,t=i.mapStart.y,n=i.mapStart.z);const r=i.mapEnd.x-e,s=i.mapEnd.y-t,o=i.mapEnd.z-n;return e=i.mapEnd.x,t=i.mapEnd.y,n=i.mapEnd.z,{...i,mapDeltaX:r,mapDeltaY:s,mapDeltaZ:o,mapDeltaSpatialReference:i.mapStart.spatialReference}}}function T(){let e=0,t=0;return n=>{"start"===n.action&&(e=n.screenStart.x,t=n.screenStart.y);const i=n.screenEnd.x-e,r=n.screenEnd.y-t;return e=n.screenEnd.x,t=n.screenEnd.y,{...n,screenDeltaX:i,screenDeltaY:r}}}function E(e,t){let n=null,i=0,o=0;return a=>{if("start"===a.action&&(n=e.toScreen?.(t),null!=n&&(n.x<0||n.x>e.width||n.y<0||n.y>e.height?n=null:(i=a.screenStart.x-n.x,o=a.screenStart.y-n.y))),null==n)return null;const l=(0,r.qE)(a.screenEnd.x-i,0,e.width),c=(0,r.qE)(a.screenEnd.y-o,0,e.height),u=(0,s.tc)(l,c);return a.screenStart=n,a.screenEnd=u,a}}const x=()=>{};class S{constructor(){this.execute=x}next(e,t=new S){return null!=e&&(this.execute=n=>{const i=e(n);null!=i&&t.execute(i)}),t}}function w(e,t,n=[]){if("2d"===e.type)return e=>e;let i=null;return r=>{"start"===r.action&&(i=e.toMap(r.screenStart,{exclude:n}),null!=i&&(i.z=(0,c.id)(i,e,t)));const s=e.toMap(r.screenEnd,{exclude:n});null!=s&&(s.z=(0,c.id)(s,e,t));const o=null!=i&&null!=s?{sceneStart:i,sceneEnd:s}:null;return{...r,scenePoints:o}}}function A(e,t,n){const i=t.elevationProvider.getElevation(e.x,e.y,e.z??0,e.spatialReference,"scene")??0,r=(0,l.EL)(e);return r.z=i,r.hasZ=!0,r.z=(0,c.id)(r,t,n),r}function M(e,t){if("2d"===e.type)return e=>e;let n=null;return i=>{"start"===i.action&&(n=A(i.mapStart,e,t));const r=A(i.mapEnd,e,t),s=null!=n&&null!=r?{sceneStart:n,sceneEnd:r}:null;return{...i,scenePoints:s}}}},2623:function(e,t,n){"use strict";n.d(t,{uA:function(){return p},oH:function(){return d},ZE:function(){return f},Li:function(){return h},oF:function(){return g}});var i=n(50659),r=n(82547),s=n(48996),o=n(44740),a=n(91508),l=n(50517),c=n(57652),u=n(65420);class h{constructor(e){this.component=e,this.leftEdge=null,this.rightEdge=null,this.type="vertex",this.index=null}get pos(){return this._pos}set pos(e){this._pos=e,this.component.unnormalizeVertexPositions()}}class d{constructor(e,t,n){this.component=e,this.leftVertex=t,this.rightVertex=n,this.type="edge",t.rightEdge=this,n.leftEdge=this}}class p{constructor(e,t){this._spatialReference=e,this._viewingMode=t,this.vertices=[],this.edges=[],this.index=null}unnormalizeVertexPositions(){this.vertices.length<=1||function(e,t){if(!t.supported)return;let n=1/0,i=-1/0;const r=t.upperBoundX-t.lowerBoundX;e.forEach((e=>{let s=e.pos[0];for(;s<t.lowerBoundX;)s+=r;for(;s>t.upperBoundX;)s-=r;n=Math.min(n,s),i=Math.max(i,s),e.pos[0]=s}));const s=i-n;r-s<s&&e.forEach((e=>{e.pos[0]<0&&(e.pos[0]+=r)}))}(this.vertices,function(e,t){const n=(0,c.Vp)(e);return t===u.RT.Global&&n?{supported:!0,lowerBoundX:n.valid[0],upperBoundX:n.valid[1]}:{supported:!1,lowerBoundX:null,upperBoundX:null}}(this._spatialReference,this._viewingMode))}updateVertexIndex(e,t){if(0===this.vertices.length)return;const n=this.vertices[0];let i=null,r=e,s=t;do{i=r,i.index=s++,r=i.rightEdge?i.rightEdge.rightVertex:null}while(null!=r&&r!==n);i.leftEdge&&i!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(i),this.vertices.length-1)}getFirstVertex(){return this.vertices.at(0)}getLastVertex(){return this.vertices.at(-1)}isClosed(){return this.vertices.length>2&&null!==this.vertices[0].leftEdge}swapVertices(e,t){const n=this.vertices[e];this.vertices[e]=this.vertices[t],this.vertices[t]=n}iterateVertices(e){if(0===this.vertices.length)return;const t=this.vertices[0];let n=t;do{e(n,n.index),n=null!=n.rightEdge?n.rightEdge.rightVertex:null}while(n!==t&&null!=n)}}class f extends s.A{constructor(e,t){super(),this.type=e,this.coordinateHelper=t,this._geometry=null,this._dirty=!0,this.components=[]}get geometry(){if(this._dirty){switch(this.type){case"point":this._geometry=this._toPoint();break;case"polyline":this._geometry=this._toPolyline();break;case"polygon":this._geometry=this._toPolygon();break;case"mesh":break;default:(0,r.Xb)(this.type)}this._dirty=!1}return this._geometry}get spatialReference(){return this.coordinateHelper.spatialReference}get allVertices(){return Array.from(this.iterateVertices())}*iterateVertices(){for(const e of this.components)for(const t of e.vertices)yield t}notifyChanges(e){this._dirty=!0,this.emit("change",e)}_toPoint(){return 0===this.components.length||0===this.components[0].vertices.length?null:this.coordinateHelper.vectorToPoint(this.components[0].vertices[0].pos)}_toPolyline(){const e=[],t=this.coordinateHelper.vectorToArray;for(const n of this.components){if(n.vertices.length<1)continue;const i=[];let r=n.vertices.find((e=>null==e.leftEdge));const s=r;do{i.push(t(r.pos)),r=r.rightEdge?r.rightEdge.rightVertex:null}while(r&&r!==s);e.push(i)}return new a.A({paths:e,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}_toPolygon(){const e=[],t=this.coordinateHelper.vectorToArray;for(const n of this.components){if(n.vertices.length<1)continue;const i=[],r=n.vertices[0];let s=r;const o=s;do{i.push(t(s.pos)),s=null!=s.rightEdge?s.rightEdge.rightVertex:null}while(s&&s!==o);n.isClosed()&&i.push(t(r.pos)),e.push(i)}return new o.A({rings:e,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}static fromGeometry(e,t){const n=e.spatialReference,r=(0,l.BV)(e.hasZ,e.hasM,n),s=new f(e.type,r);switch(e.type){case"polygon":!function(e,t,n){const r=t.spatialReference,s=e.coordinateHelper,o=t.rings;for(let t=0;t<o.length;++t){const a=o[t],l=new p(r,n);l.index=t;const c=a.length>2&&(0,i.aI)(a[0],a[a.length-1]),u=c?a.length-1:a.length;for(let e=0;e<u;++e){const t=s.arrayToVector(a[e]),n=new h(l);l.vertices.push(n),n.pos=t,n.index=e}const f=l.vertices.length-1;for(let e=0;e<f;++e){const t=l.vertices[e],n=l.vertices[e+1],i=new d(l,t,n);l.edges.push(i)}if(c){const e=new d(l,l.vertices[l.vertices.length-1],l.vertices[0]);l.edges.push(e)}e.components.push(l)}}(s,e,t);break;case"polyline":!function(e,t,n){const i=t.spatialReference,r=e.coordinateHelper,s=t.paths;for(let t=0;t<s.length;++t){const o=s[t],a=new p(i,n);a.index=t;const l=o.length;for(let e=0;e<l;++e){const t=r.arrayToVector(o[e]),n=new h(a);a.vertices.push(n),n.pos=t,n.index=e}const c=a.vertices.length-1;for(let e=0;e<c;++e){const t=a.vertices[e],n=a.vertices[e+1],i=new d(a,t,n);a.edges.push(i)}e.components.push(a)}}(s,e,t);break;case"point":m(s,e,t);break;case"mesh":m(s,e.anchor,t),s._geometry=e,s._dirty=!1}return s}}function m(e,t,n){const i=t.spatialReference,r=e.coordinateHelper,s=new p(i,n);s.index=0;const o=new h(s);o.index=0,o.pos=r.pointToVector(t),s.vertices.push(o),e.components.push(s)}function g(e){return"mesh"===e.type}},7819:function(e,t,n){"use strict";n.d(t,{p:function(){return w}});var i=n(48996),r=n(61226),s=n(32501),o=n(38441),a=n(2623),l=n(34358);class c{constructor(e,t,n){this._editGeometry=e,this._component=t,this._pos=n,this._addedVertex=null,this._originalEdge=null,this._left=null,this._right=null}apply(){let e="redo";null==this._addedVertex&&(e="apply",this._addedVertex=new a.Li(this._component));const t=this._component.getLastVertex();if(null==t)this._component.vertices.push(this._addedVertex),this._addedVertex.pos=this._pos,this._addedVertex.index=0;else{let e=null;t.rightEdge&&(this._originalEdge=t.rightEdge,e=this._originalEdge.rightVertex,this._component.edges.splice(this._component.edges.indexOf(this._originalEdge),1)),this._component.vertices.push(this._addedVertex),this._addedVertex.pos=this._pos,null==this._left&&(this._left=new a.oH(this._component,t,this._addedVertex)),this._component.edges.push(this._left),t.rightEdge=this._left,null!=this._originalEdge&&null!=e&&(null==this._right&&(this._right=new a.oH(this._component,this._addedVertex,e)),this._component.edges.push(this._right),e.leftEdge=this._right),this._component.updateVertexIndex(this._addedVertex,t.index+1)}this._editGeometry.notifyChanges({operation:e,addedVertices:[this._addedVertex]})}undo(){null!=this._addedVertex&&(this._component.vertices.splice(this._component.vertices.indexOf(this._addedVertex),1),null!=this._left&&(this._component.edges.splice(this._component.edges.indexOf(this._left),1),this._left.leftVertex.rightEdge=null),null!=this._right&&(this._component.edges.splice(this._component.edges.indexOf(this._right),1),this._right.rightVertex.leftEdge=null),null!=this._originalEdge&&(this._component.edges.push(this._originalEdge),this._originalEdge.leftVertex.rightEdge=this._originalEdge,this._originalEdge.rightVertex.leftEdge=this._originalEdge),null!=this._left?this._component.updateVertexIndex(this._left.leftVertex,this._left.leftVertex.index):this._component.updateVertexIndex(this._addedVertex,0),this._editGeometry.notifyChanges({operation:"undo",removedVertices:[this._addedVertex]}))}accumulate(){return!1}}var u=n(57665);class h{constructor(e,t,n=0){this._editGeometry=e,this._vertices=t,this._minNumberOfVertices=n,this.removedVertices=null}apply(){let e="redo";if(null==this.removedVertices){const t=this.removedVertices=[];this._vertices.forEach((e=>{const n=this._removeVertex(e);null!=n&&t.push(n)})),e="apply"}else this.removedVertices.forEach((e=>{this._removeVertex(e.removedVertex)}));this._editGeometry.notifyChanges({operation:e,removedVertices:this._vertices})}undo(){this.removedVertices?.forEach((e=>{this._undoRemoveVertex(e)})),this._editGeometry.notifyChanges({operation:"undo",addedVertices:this._vertices})}accumulate(){return!1}_removeVertex(e){const t=e.component;if(t.vertices.length<=this._minNumberOfVertices)return null;const n={removedVertex:e,createdEdge:null},i=e.leftEdge,r=e.rightEdge;return t.vertices.splice(t.vertices.indexOf(e),1),i&&(t.edges.splice(t.edges.indexOf(i),1),i.leftVertex.rightEdge=null),r&&(t.edges.splice(t.edges.indexOf(r),1),r.rightVertex.leftEdge=null),0===e.index&&r&&this._vertices.length>0&&t.swapVertices(t.vertices.indexOf(r.rightVertex),0),i&&r&&(n.createdEdge=new a.oH(t,i.leftVertex,r.rightVertex),t.edges.push(n.createdEdge)),r&&t.updateVertexIndex(r.rightVertex,r.rightVertex.index-1),n}_undoRemoveVertex(e){const t=e.removedVertex,n=e.removedVertex.component,i=t.leftEdge,r=t.rightEdge;e.createdEdge&&n.edges.splice(n.edges.indexOf(e.createdEdge),1),n.vertices.push(t),i&&(n.edges.push(i),i.leftVertex.rightEdge=i),r&&(n.edges.push(r),r.rightVertex.leftEdge=r),n.updateVertexIndex(t,t.index)}}class d{constructor(e,t,n){this._editGeometry=e,this._edge=t,this._t=n,this.createdVertex=null,this._left=null,this._right=null}apply(){let e="redo";const t=this._edge,n=t.component,i=t.leftVertex,r=t.rightVertex;n.edges.splice(n.edges.indexOf(t),1),null==this.createdVertex&&(e="apply",this.createdVertex=new a.Li(t.component)),n.vertices.push(this.createdVertex),this.createdVertex.pos=this._editGeometry.coordinateHelper.lerp(t.leftVertex.pos,t.rightVertex.pos,this._t,this._editGeometry.coordinateHelper.createVector()),null==this._left&&(this._left=new a.oH(n,i,this.createdVertex)),this._left.leftVertex.leftEdge?n.edges.push(this._left):n.edges.unshift(this._left),i.rightEdge=this._left,null==this._right&&(this._right=new a.oH(n,this.createdVertex,r)),n.edges.push(this._right),r.leftEdge=this._right,n.updateVertexIndex(this.createdVertex,i.index+1),this._editGeometry.notifyChanges({operation:e,addedVertices:[this.createdVertex]})}undo(){if(null==this.createdVertex||null==this._left||null==this._right)return null;const e=this._edge,t=e.component,n=this.createdVertex.leftEdge,i=this.createdVertex.rightEdge,r=n?.leftVertex,s=i?.rightVertex;t.vertices.splice(t.vertices.indexOf(this.createdVertex),1),t.edges.splice(t.edges.indexOf(this._left),1),t.edges.splice(t.edges.indexOf(this._right),1),this._edge.leftVertex.leftEdge?t.edges.push(this._edge):t.edges.unshift(this._edge),r&&(r.rightEdge=e),s&&(s.leftEdge=e),r&&t.updateVertexIndex(r,r.index),this._editGeometry.notifyChanges({operation:"undo",removedVertices:[this.createdVertex]})}accumulate(){return!1}}class p{constructor(e,t,n){this._editGeometry=e,this._vertex=t,this._pos=n}apply(){const e=null==this._originalPosition;e&&(this._originalPosition=this._vertex.pos),this._apply(e?"apply":"redo")}undo(){this._vertex.pos=this._originalPosition,this._editGeometry.notifyChanges({operation:"undo",updatedVertices:[this._vertex]})}accumulate(e){return e instanceof p&&e._vertex===this._vertex&&(this._pos=e._pos,this._apply("apply"),!0)}_apply(e){this._vertex.pos=this._pos,this._editGeometry.components.forEach((e=>e.unnormalizeVertexPositions())),this._editGeometry.notifyChanges({operation:e,updatedVertices:[this._vertex]})}}var f=n(50659);class m{constructor(e,t){this._editGeometry=e,this._component=t,this._createdEdge=null}apply(){let e="redo";if(null==this._createdEdge){e="apply";const t=this._component.getFirstVertex(),n=this._component.getLastVertex();if(this._component.isClosed()||this._component.vertices.length<3||null==t||null==n)return;this._createdEdge=new a.oH(this._component,n,t)}this._createdEdge.leftVertex.rightEdge=this._createdEdge,this._createdEdge.rightVertex.leftEdge=this._createdEdge,this._component.edges.push(this._createdEdge),this._editGeometry.notifyChanges({operation:e})}undo(){null!=this._createdEdge&&((0,f.TF)(this._component.edges,this._createdEdge),this._createdEdge.leftVertex.rightEdge=null,this._createdEdge.rightVertex.leftEdge=null,this._editGeometry.notifyChanges({operation:"undo"}))}accumulate(){return!1}}class g{constructor(e,t,n,i){this._editGeometry=e,this.dx=t,this.dy=n,this.dz=i,this._firstTime=!0}apply(){const e=this._firstTime?"apply":"redo";this._firstTime=!1,this._apply(e,this.dx,this.dy,this.dz)}undo(){this._apply("undo",-this.dx,-this.dy,-this.dz)}accumulate(e){const t=this._editGeometry.geometry;return e instanceof g&&e._editGeometry.geometry===t&&(this._apply("apply",e.dx,e.dy,e.dz),this.dx+=e.dx,this.dy+=e.dy,this.dz+=e.dz,!0)}_apply(e,t,n,i){const r=this._editGeometry.geometry;r.offset(t,n,i);const s=this._editGeometry.components[0].getFirstVertex();if(!s)return;const o=this._editGeometry.coordinateHelper;s.pos=o.pointToVector(r.anchor),this._editGeometry.notifyChanges({operation:e,updatedVertices:[s]})}}var _,v=n(28080),y=n(63447),b=n(31966),T=n(76835);class E{constructor(e,t){this._editGeometry=e,this._newPositions=t}apply(){const e=null==this._originalPositions?"apply":"redo";if(!this._originalPositions){const e=this._editGeometry.coordinateHelper;this._originalPositions=this._editGeometry.allVertices.map((t=>e.clone(t.pos)))}this._apply(e,this._newPositions)}undo(){this._originalPositions&&this._apply("undo",this._originalPositions)}accumulate(e){return e instanceof E&&(this._newPositions=e._newPositions,this._apply("apply",this._newPositions),!0)}_apply(e,t){const n=this._editGeometry.coordinateHelper,i=this._editGeometry.allVertices;for(let e=0;e<i.length;e++)n.copy(t[e],i[e].pos);this._editGeometry.components.forEach((e=>e.unnormalizeVertexPositions())),this._editGeometry.notifyChanges({operation:e,updatedVertices:i})}}const x=Symbol();class S{constructor(e){this._operations=[],this._closed=!1,this[_]=!0,e&&(this._operations=e,this._closed=!0)}close(){this._closed=!0}apply(){for(const e of this._operations)e.apply()}undo(){for(let e=this._operations.length-1;e>=0;e--)this._operations[e].undo()}accumulate(e){if(this._closed)return!1;const t=this._operations.length?this._operations[this._operations.length-1]:null;return t&&t.accumulate(e)||(this._operations.push(e),e.apply()),!0}}_=x;class w extends i.A{constructor(e,t){super(),this.data=e,this.viewingMode=t,this._undoStack=[],this._redoStack=[],this._listener=this.data.on("change",(e=>{e.addedVertices&&this.emit("vertex-add",{type:"vertex-add",vertices:e.addedVertices,operation:e.operation}),e.removedVertices&&this.emit("vertex-remove",{type:"vertex-remove",vertices:e.removedVertices,operation:e.operation}),e.updatedVertices&&this.emit("vertex-update",{type:"vertex-update",vertices:e.updatedVertices,operation:e.operation})}))}destroy(){this._listener.remove()}splitEdge(e,t){return this._apply(new d(this.data,e,t))}updateVertices(e,t,n=l.Y.ACCUMULATE_STEPS){return this._apply(new u.D(this.data,e,t),n)}move(e,t,n,i=l.Y.ACCUMULATE_STEPS){return(0,a.oF)(this.data)?this._apply(new g(this.data,e,t,n),i):this.moveVertices(this.data.allVertices,e,t,n,i)}moveVertices(e,t,n,i,r=l.Y.ACCUMULATE_STEPS){return(0,a.oF)(this.data)?this._apply(new g(this.data,t,n,i),r):this.updateVertices(e,new v.a(this.data.coordinateHelper,t,n,i),r)}scale(e,t,n,i,r=l.Y.ACCUMULATE_STEPS,s=u.K.CUMULATIVE){return this.scaleVertices(this.data.allVertices,e,t,n,i,r,s)}scaleVertices(e,t,n,i,r,s=l.Y.ACCUMULATE_STEPS,o=u.K.CUMULATIVE){return this.updateVertices(e,new T.j(t,n,i,r,o),s)}rotate(e,t,n=l.Y.ACCUMULATE_STEPS,i=u.K.CUMULATIVE){return this.rotateVertices(this.data.allVertices,e,t,n,i)}rotateVertices(e,t,n,i=l.Y.ACCUMULATE_STEPS,r=u.K.CUMULATIVE){return this.updateVertices(e,new b.m(t,n,r),i)}removeVertices(e){return this._apply(new h(this.data,e,this._minNumVerticesPerType))}appendVertex(e){return 0===this.data.components.length?null:this._apply(new c(this.data,this.data.components[0],e))}setVertexPosition(e,t){return this._apply(new p(this.data,e,t))}offsetEdge(e,t,n,i=l.Y.ACCUMULATE_STEPS){return this.updateVertices([t.leftVertex,t.rightVertex],new y.L(this.data.coordinateHelper,e,t,n),i)}trySetGeometry(e,t=l.Y.ACCUMULATE_STEPS){const{data:n}=this,{coordinateHelper:i}=n;if(n.type!==e.type||!n.spatialReference.equals(e.spatialReference)||i.hasZ()!==e.hasZ||i.hasM()!==e.hasM||!(0,o.It)(n.geometry,e)||(0,a.oF)(n))return;const r=Array.from(a.ZE.fromGeometry(e,this.viewingMode).iterateVertices(),(e=>e.pos));return this.setVertexPositions(r,t)}setVertexPositions(e,t=l.Y.ACCUMULATE_STEPS){return this._apply(new E(this.data,e),t)}createResetState(){if((0,a.oF)(this.data))return this._createResetStateMesh();const e=this.data.geometry.clone();return(0,r.hA)((()=>this.trySetGeometry(e)))}closeComponent(e){return this.data.components.includes(e)?this._apply(new m(this.data,e)):null}canRemoveVertex(e){return e.vertices.length>this._minNumVerticesPerType}createUndoGroup(){const e=new S;return this._apply(e),(0,r.hA)((()=>e.close()))}undo(){if(this._undoStack.length>0){const e=this._undoStack.pop();return e.undo(),this._redoStack.push(e),e}return null}redo(){if(this._redoStack.length>0){const e=this._redoStack.pop();return e.apply(),this._undoStack.push(e),e}return null}get canUndo(){return this._undoStack.length>0}get canRedo(){return this._redoStack.length>0}get lastOperation(){return this._undoStack.length>0?this._undoStack[this._undoStack.length-1]:null}get _minNumVerticesPerType(){switch(this.data.type){case"point":return 1;case"polyline":return 2;case"polygon":return 3;default:return 0}}_apply(e,t=l.Y.ACCUMULATE_STEPS){return t!==l.Y.NEW_STEP&&null!=this.lastOperation&&this.lastOperation.accumulate(e)||(e.apply(),this._undoStack.push(e),this._redoStack=[]),e}_createResetStateMesh(){if(!(0,a.oF)(this.data))return(0,r.hA)();const e=this.data.geometry,{vertexSpace:t}=e;if(t.origin){const n=(0,s.o8)(t.origin);return(0,r.hA)((()=>{e.vertexSpace.origin=n}))}const n=e.vertexAttributes.clonePositional();return(0,r.hA)((()=>{e.vertexAttributes=n,e.vertexAttributesChanged()}))}static fromGeometry(e,t){return new w(a.ZE.fromGeometry(e,t),t)}}},34358:function(e,t,n){"use strict";var i;n.d(t,{Y:function(){return i}}),function(e){e[e.NEW_STEP=0]="NEW_STEP",e[e.ACCUMULATE_STEPS=1]="ACCUMULATE_STEPS"}(i||(i={}))},28080:function(e,t,n){"use strict";n.d(t,{a:function(){return i}});class i{constructor(e,t,n,i){this._helper=e,this.dx=t,this.dy=n,this.dz=i}_move(e,t,n,i){this._helper.addDelta(e.pos,t,n,i)}apply(e){this._move(e,this.dx,this.dy,this.dz)}undo(e){this._move(e,-this.dx,-this.dy,-this.dz)}canAccumulate(e){return e instanceof i}accumulate(e,t){this._move(e,t.dx,t.dy,t.dz)}accumulateParams(e){this.dx+=e.dx,this.dy+=e.dy,this.dz+=e.dz}}},63447:function(e,t,n){"use strict";n.d(t,{B:function(){return f},L:function(){return h}});var i=n(15774),r=n(13786),s=n(1932),o=n(20551),a=n(32501),l=n(5596),c=n(29531),u=n(77363);class h{get plane(){return this._plane}get requiresSplitEdgeLeft(){return!this._left.isOriginalDirection}get requiresSplitEdgeRight(){return!this._right.isOriginalDirection}get edgeDirection(){return this._edgeDirection}constructor(e,t,n,i=0,r=m.IMMEDIATE){this._helper=e,this._planeType=t,this._edge=n,this.distance=i,this._plane=(0,l.vt)(),this._offsetPlane=(0,l.vt)(),this._minDistance=-1/0,this._maxDistance=1/0,this._selectedArrow=1,r===m.IMMEDIATE&&this._initialize()}_initialize(){this._initializeNeighbors(),this._initializePlane(),this._initializeDistanceConstraints()}_initializeNeighbors(){const e=this._toXYZ(this._edge.leftVertex.pos),t=this._toXYZ(this._edge.leftVertex.leftEdge?.leftVertex?.pos),n=this._toXYZ(this._edge.rightVertex.pos),i=this._toXYZ(this._edge.rightVertex.rightEdge?.rightVertex?.pos);this._edgeDirection=(0,o.E)((0,a.vt)(),e,n),t?(this._left=this._computeNeighbor(e,t,this._edgeDirection),this._right=this._computeNeighbor(n,i,this._edgeDirection,this._left)):(this._right=this._computeNeighbor(n,i,this._edgeDirection),this._left=this._computeNeighbor(e,t,this._edgeDirection,this._right))}_toXYZ(e){return null!=e?this._helper.toXYZ(e):null}_pointToXYZ(e){return this._toXYZ(this._helper.pointToVector(e))}_computeNeighbor(e,t,n,i){const r=(0,a.vt)();if(t){(0,o.E)(r,e,t);const i=!this._passesBisectingAngleThreshold(r,n);return{start:e,end:t,direction:i?this._bisectVectorsPerpendicular(n,r):r,isOriginalDirection:!i}}return this._helper.hasZ()?i&&((0,o.b)(r,n,i.direction),(0,o.b)(r,r,n),(0,o.n)(r,r),Math.sign(r[1])!==Math.sign(n[0])&&(0,o.j)(r,r,-1)):(0,o.s)(r,-n[1],n[0],0),{start:e,end:t,direction:r,isOriginalDirection:!0}}_passesBisectingAngleThreshold(e,t){const n=Math.abs((0,c.g7)(t,e));return n>=d&&n<=Math.PI-d}_bisectVectorsPerpendicular(e,t){const n=(0,o.m)(e,t)<0?e:(0,o.k)((0,a.vt)(),e),i=Math.abs((0,o.m)(n,t));if(!(i<p||i>1-p))return this._bisectDirection(n,t);const r=(0,o.b)((0,a.vt)(),n,[0,0,1]);return(0,o.n)(r,r)}_bisectDirection(e,t){const n=(0,o.g)((0,a.vt)(),e,t);return(0,o.n)(n,n)}_initializePlane(){const e=this._computeNormalDirection(this._left),t=this._computeNormalDirection(this._right);(0,o.m)(e,t)<0&&(0,o.k)(t,t),(0,l.O_)(this._left.start,this._bisectDirection(e,t),this._plane)}_computeNormalDirection(e){const t=(0,o.b)((0,a.vt)(),e.direction,this._edgeDirection);(0,o.n)(t,t);const n=(0,o.b)((0,a.vt)(),this._edgeDirection,t);return this._planeType===f.XY&&(n[2]=0),(0,o.n)(n,n)}_initializeDistanceConstraints(){null==this._left.end||this.requiresSplitEdgeLeft||this._updateDistanceConstraint((0,l.mN)(this._plane,this._left.end)),null==this._right.end||this.requiresSplitEdgeRight||this._updateDistanceConstraint((0,l.mN)(this._plane,this._right.end)),this._updateIntersectDistanceConstraint(this._plane)}_updateDistanceConstraint(e){e<=0&&(this._minDistance=Math.max(this._minDistance,e)),e>=0&&(this._maxDistance=Math.min(this._maxDistance,e))}_updateIntersectDistanceConstraint(e){const t=(0,l.Qj)(e),n=this._edgeDirection,i=(0,o.g)((0,a.vt)(),this._left.start,this._left.direction),c=(0,o.g)((0,a.vt)(),this._right.start,this._right.direction),h=this._pointInBasis2D((0,s.vt)(),t,n,this._left.start),d=this._pointInBasis2D((0,s.vt)(),t,n,i),p=this._pointInBasis2D((0,s.vt)(),t,n,this._right.start),f=this._pointInBasis2D((0,s.vt)(),t,n,c),[m]=(0,u.jI)({start:d,end:h,type:u.Vv.LINE},{start:f,end:p,type:u.Vv.LINE});if(!m)return;const g=(0,r.Re)((0,s.vt)(),h,d);(0,r.S8)(g,g);const _=(0,r.Re)((0,s.vt)(),m,d),v=(0,r.Om)(g,_),y=(0,o.g)((0,a.vt)(),i,(0,o.j)((0,a.vt)(),this._left.direction,-v)),b=(0,l.mN)(e,y);this._updateDistanceConstraint(b)}_pointInBasis2D(e,t,n,i){return e[0]=(0,c.gr)(t,i),e[1]=(0,c.gr)(n,i),e}_offset(e,t){Number.isFinite(this._minDistance)&&(t=Math.max(this._minDistance,t)),Number.isFinite(this._maxDistance)&&(t=Math.min(this._maxDistance,t)),(0,l.C)(this._offsetPlane,this._plane),this._offsetPlane[3]-=t;const n=(e,t,n)=>null!=t&&(0,l.U5)(this._offsetPlane,e,(0,o.g)((0,a.vt)(),e,t),n),i=(0,a.vt)();(e===this._edge.leftVertex?n(this._left.start,this._left.direction,i):n(this._right.start,this._right.direction,i))&&this._helper.copy(this._helper.fromXYZ(i,void 0,this._helper.getM(e.pos)),e.pos)}selectArrowFromStartPoint(e){this._selectedArrow=(0,l.Tj)(this.plane,this._pointToXYZ(e))?1:-1}get selectedArrow(){return this._selectedArrow}signedDistanceToPoint(e){return(0,l.mN)(this.plane,this._pointToXYZ(e))}apply(e){this._offset(e,this.distance)}undo(e){this._offset(e,0)}canAccumulate(e){return e instanceof h&&this._edge.leftVertex.index===e._edge.leftVertex.index&&this._edge.rightVertex.index===e._edge.rightVertex.index&&this._edge.component===e._edge.component&&this._maybeEqualsVec3(this._left.direction,e._left.direction)&&this._maybeEqualsVec3(this._right.direction,e._right.direction)&&(0,o.G)((0,l.Qj)(this._plane),(0,l.Qj)(e._plane))}accumulate(e,t){const n=this._plane[3]-t._plane[3]+t.distance;this._offset(e,n)}accumulateParams(e){const t=e.distance-e._plane[3];this.distance=t+this._plane[3]}clone(){const e=new h(this._helper,this._planeType,this._edge,this.distance,m.DEFERRED);return(0,l.C)(e._plane,this._plane),(0,l.C)(e._offsetPlane,this._offsetPlane),e._maxDistance=this._maxDistance,e._minDistance=this._minDistance,e._left=this._cloneNeighbor(this._left),e._right=this._cloneNeighbor(this._right),e._edgeDirection=(0,o.c)((0,a.vt)(),this._edgeDirection),e}_maybeEqualsVec3(e,t){return null==e&&null==t||null!=e&&null!=t&&(0,o.G)(e,t)}_cloneNeighbor({start:e,end:t,direction:n,isOriginalDirection:i}){return{start:(0,o.c)((0,a.vt)(),e),end:null!=t?(0,o.c)((0,a.vt)(),t):null,direction:(0,o.c)((0,a.vt)(),n),isOriginalDirection:i}}}const d=(0,i.kU)(15),p=.001;var f,m,g;(g=f||(f={}))[g.XYZ=0]="XYZ",g[g.XY=1]="XY",function(e){e[e.IMMEDIATE=0]="IMMEDIATE",e[e.DEFERRED=1]="DEFERRED"}(m||(m={}))},31966:function(e,t,n){"use strict";n.d(t,{m:function(){return o}});var i=n(50659),r=n(13786),s=n(57665);class o{constructor(e,t,n=s.K.CUMULATIVE){this.origin=e,this.angle=t,this._accumulationType=n}_rotate(e,t){(0,r.e$)(e.pos,e.pos,this.origin,t)}apply(e){this._rotate(e,this.angle)}undo(e){this._rotate(e,-this.angle)}canAccumulate(e){return e instanceof o&&(0,i.aI)(this.origin,e.origin)}accumulate(e,t){const n=t._accumulationType===s.K.REPLACE;this._rotate(e,n?t.angle-this.angle:t.angle)}accumulateParams(e){const t=e._accumulationType===s.K.REPLACE;this.angle=t?e.angle:this.angle+e.angle}}},76835:function(e,t,n){"use strict";n.d(t,{j:function(){return a}});var i=n(50659),r=n(1932),s=n(13786),o=n(57665);class a{constructor(e,t,n,i,s=o.K.CUMULATIVE){this.origin=e,this.axis1=t,this.factor1=n,this.factor2=i,this._accumulationType=s,this.axis2=(0,r.fA)(t[1],-t[0])}_scale(e,t,n){(0,s.Vj)(e.pos,e.pos,this.origin,this.axis1,t),(0,s.Vj)(e.pos,e.pos,this.origin,this.axis2,n)}apply(e){this._scale(e,this.factor1,this.factor2)}undo(e){this._scale(e,1/this.factor1,1/this.factor2)}canAccumulate(e){return e instanceof a&&(0,i.aI)(this.origin,e.origin)&&(0,i.aI)(this.axis1,e.axis1)}accumulate(e,t){t._accumulationType===o.K.REPLACE?this._scale(e,t.factor1/this.factor1,t.factor2/this.factor2):this._scale(e,t.factor1,t.factor2)}accumulateParams(e){const t=e._accumulationType===o.K.REPLACE;this.factor1=t?e.factor1:this.factor1*e.factor1,this.factor2=t?e.factor2:this.factor2*e.factor2}}},57665:function(e,t,n){"use strict";n.d(t,{D:function(){return i},K:function(){return r}});class i{constructor(e,t,n){this._editGeometry=e,this._vertices=t,this.operation=n,this._undone=!1}apply(){this._vertices.forEach((e=>this.operation.apply(e))),this._editGeometry.components.forEach((e=>e.unnormalizeVertexPositions())),this._editGeometry.notifyChanges({operation:this._undone?"redo":"apply",updatedVertices:this._vertices})}undo(){this._vertices.forEach((e=>this.operation.undo(e))),this._editGeometry.notifyChanges({operation:"undo",updatedVertices:this._vertices}),this._undone=!0}canAccumulate(e){if(this._undone||e._vertices.length!==this._vertices.length)return!1;for(let t=0;t<e._vertices.length;++t)if(e._vertices[t]!==this._vertices[t])return!1;return this.operation.canAccumulate(e.operation)}accumulate(e){return!!(e instanceof i&&this.canAccumulate(e))&&(this._vertices.forEach((t=>this.operation.accumulate(t,e.operation))),this.operation.accumulateParams(e.operation),this._editGeometry.components.forEach((e=>e.unnormalizeVertexPositions())),this._editGeometry.notifyChanges({operation:"apply",updatedVertices:this._vertices}),!0)}}var r;!function(e){e[e.CUMULATIVE=0]="CUMULATIVE",e[e.REPLACE=1]="REPLACE"}(r||(r={}))},41857:function(e,t,n){"use strict";n.d(t,{Bb:function(){return d},G3:function(){return m},fJ:function(){return p}});var i=n(13786),r=n(20551),s=n(32501),o=n(2075),a=n(50973),l=n(28080),c=n(31966),u=n(76835),h=n(57665);function d(e,t){return f(e,t,!1)}function p(e,t){return f(e,t,!0)}function f(e,t,n){if(e instanceof h.D){if(e.operation instanceof l.a)return function(e,t,n=!1){const i=n?-1:1,a=(0,s.fA)(i*e.dx,i*e.dy,i*e.dz);(0,r.g)(t.origin,t.origin,a),(0,o.u)(t)}(e.operation,t,n),!0;if(e.operation instanceof c.m)return function(e,t,n=!1){const i=n?-e.angle:e.angle;(0,r.K)(t.basis1,t.basis1,s.uY,i),(0,r.K)(t.basis2,t.basis2,s.uY,i),(0,o.u)(t)}(e.operation,t,n),!0;if(e.operation instanceof u.j)return function(e,t,n=!1){const s=n?1/e.factor1:e.factor1,a=n?1/e.factor2:e.factor2;(0,r.j)(t.basis1,t.basis1,s),(0,r.j)(t.basis2,t.basis2,a),(0,i.Vj)(t.origin,t.origin,e.origin,e.axis1,s),(0,i.Vj)(t.origin,t.origin,e.origin,e.axis2,a),(0,o.u)(t)}(e.operation,t,n),!0}return!1}function m(e,t,n,r){r||(r=(0,o.a)());const s=(0,i.hZ)(a.oG.get(),e[1],-e[0]),l=(0,i.hZ)(a.oG.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),c=(0,i.hZ)(a.oG.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),u=a.oG.get();t.components.forEach((t=>t.vertices.forEach((({pos:t})=>{(0,i.hZ)(u,(0,i.Om)(e,t),(0,i.Om)(s,t)),(0,i.jk)(l,l,u),(0,i.T9)(c,c,u)}))));const h=1e-6,d=(0,i.hZ)(a.oG.get(),c[0]-l[0]<h?n/2:0,c[1]-l[1]<h?n/2:0);return(0,i.Re)(l,l,d),(0,i.WQ)(c,c,d),(0,i.hs)(r.basis1,e,(c[0]-l[0])/2),(0,i.hs)(r.basis2,s,(c[1]-l[1])/2),(0,i.hZ)(r.origin,l[0]*e[0]+l[1]*s[0],l[0]*e[1]+l[1]*s[1]),(0,i.WQ)(r.origin,r.origin,r.basis1),(0,i.WQ)(r.origin,r.origin,r.basis2),(0,o.u)(r),r}},53551:function(e,t,n){"use strict";var i,r,s;n.d(t,{PK:function(){return i},SJ:function(){return s},p7:function(){return r}}),function(e){e[e.USER=0]="USER",e[e.MANAGER=1]="MANAGER"}(i||(i={})),function(e){e[e.None=0]="None",e[e.Unfocused=1]="Unfocused",e[e.Focused=2]="Focused",e[e.Unselected=4]="Unselected",e[e.Selected=8]="Selected",e[e.All=15]="All"}(r||(r={})),function(e){e[e.None=0]="None",e[e.Custom1=16]="Custom1",e[e.Custom2=32]="Custom2",e[e.Custom3=64]="Custom3",e[e.Custom4=128]="Custom4",e[e.Custom5=256]="Custom5",e[e.Custom6=512]="Custom6",e[e.Custom7=1024]="Custom7",e[e.Custom8=2048]="Custom8",e[e.Custom9=4096]="Custom9",e[e.Custom10=8192]="Custom10",e[e.Custom11=16384]="Custom11",e[e.Custom12=32768]="Custom12",e[e.All=65520]="All"}(s||(s={}))},7768:function(e,t,n){"use strict";n.d(t,{cx:function(){return y},dz:function(){return E},hj:function(){return f},lJ:function(){return b},tC:function(){return x}}),n(50917);var i=n(56275),r=n(62938),s=n(20551),o=n(68734),a=n(57862),l=n(46460),c=n(68945),u=n(92100),h=n(28397),d=n(99675),p=n(57165);function f(e,t,n,i,r,s){let l="geodesic",c=(0,a.Xn)(n);const u=(0,h.Hh)();return(0,h.vf)(e,t,i,u),u[2]=0,c&&(0,o.F)(u,n,u,c)||(l="euclidean",c=n),{mode:l,view:t,elevationInfo:i,hasZ:r,directionMode:s,spatialReference:e.spatialReference,measurementSR:c,origin:u}}function m(e,t,n){if(null==t||null==e)return;const s=(0,r._H)(n.measurementSR);if(null==s)return;const o=E(e,n);if(null==o)return;const a=(0,i.l3)(t,s);return new u.ej(o,a)}function g(e,t,n,r){if(null==n||null==e)return;const s=E(e,r);if(null==s)return;const o=(0,d.hF)(n),a=e=>{if(null==e)return;const t=(0,h.Hh)(),n=(0,i.Wq)(e,"degrees","geographic");return(0,d.rT)(t,s,r.measurementSR,10,n,r.mode)?new u.FX(s,t):void 0},l=()=>{if(null!=t&&null!=e)return(0,d.hF)((0,d.$h)(t,e))};switch(r.directionMode){case d.rZ.Absolute:return a(o);case d.rZ.Relative:{const e=l();if(null==e)return;return a(e+o)}case d.rZ.RelativeBilateral:{const e=l();if(null==e)return;return(0,u.xW)([a(e+o),a(e-o)])}}}function _(e,t){const n=function(e,t){return w(e,t)?.value??void 0}(e,t);return null!=n?new u.qR(n):void 0}function v(e,t,n){const{context:r,longitude:s,latitude:a,direction:l,distance:c,elevation:p}=n;if(null!=s||null!=a||null!=c||null!=p||null!=l){if(null!=s||null!=a){const e=(0,d.hF)(s),t=(0,d.hF)(a),n=S(p,r);return new u.QT(e,t,n)}return function(e,t,{context:n,direction:r,distance:s,elevation:a}){if(null==t)return _(a,n);const{view:l,elevationInfo:c,measurementSR:p}=n,f=(0,h.vf)(t,l,c);if(!p||!(0,o.F)(f,t.spatialReference,A,p))return;const[m,g]=A,v=null!=s?(0,i.l3)(s,"meters"):void 0,y=(0,d.hF)(r),b=S(a,n),T=e=>{const t=new u.jf([m,g],p,v,b,e);return null==v||null==e||null==b&&n.hasZ?t:new u.i7(t.closestTo(f))};if(null==y)return T(void 0);const E=()=>{if(null!=e&&null!=t)return(0,d.hF)((0,d.$h)(e,t))};switch(n.directionMode){case d.rZ.Absolute:return T(y);case d.rZ.Relative:{const e=E();if(null==e)return;return T(e+y)}case d.rZ.RelativeBilateral:{const e=E();if(null==e)return;return(0,u.xW)([T(e+y),T(e-y)])}}}(e,t,n)}}function y(e){return"geodesic"===e.context.mode?v(null,null,e):T(e)}function b(e,t,n){const{context:i,x:r,y:s,distance:o,direction:a,elevation:l}=n;return"geodesic"===i.mode?v(t,e,n):null!=r||null!=s?T(n):function(e){let t;for(const n of e)n&&(t=t?.intersect(n)??n);return t}([m(e,o,i),g(e,t,a,i),_(l,i)])}function T({x:e,y:t,elevation:n,context:i}){R.x=e?.value??0,R.y=t?.value??0,R.spatialReference=i.spatialReference;const r=E(R,i,M);return new u.QT(null!=e&&null!=r?r[0]:void 0,null!=t&&null!=r?r[1]:void 0,S(n,i))}function E(e,t,n=(0,h.Hh)()){const{view:i,elevationInfo:r,measurementSR:a,origin:l,mode:c}=t;if((0,h.vf)(e,i,r,n),(0,o.F)(n,e.spatialReference,n,a))return"geodesic"!==c&&(0,s.f)(n,n,l),n}function x(e,t,n,i){const{view:r,measurementSR:a,spatialReference:l,origin:c,mode:u}=n;if("geodesic"===u?(0,s.c)(O,e):(0,s.g)(O,e,c),(0,o.F)(O,a,O,l))return(0,h.xF)(O,r,t,n,i)}function S(e,t){const n=w(e,t);return null!=n?(0,i.l3)(n,"meters"):void 0}function w(e,{view:t,origin:n,elevationInfo:s,hasZ:o,measurementSR:a}){if(null==e||!o)return;const l=(0,r.mq)(a);if(null==l)return;const[u,h]=n,d=(0,i.l3)(e,l),p="3d"===t?.type?(0,c.Fo)(t,u,h,d,a,s):d;return null!=p?(0,i.d_)(p,l):void 0}const A=(0,h.Hh)(),M=(0,h.Hh)(),O=(0,h.Hh)(),R=(0,l.T)(0,0,0,p.A.WGS84)},58144:function(e,t,n){"use strict";n.d(t,{e:function(){return i}});class i{constructor(e){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.drawConstraints=null,this.editGeometryOperations=e.editGeometryOperations,this.elevationInfo=e.elevationInfo,this.pointer=e.pointer,this.vertexHandle=e.vertexHandle,this.excludeFeature=e.excludeFeature,this.feature=e.feature,this.visualizer=e.visualizer,this.selfSnappingZ=e.selfSnappingZ,this.drawConstraints=e.drawConstraints}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}get spatialReference(){return this.coordinateHelper.spatialReference}}},45908:function(e,t,n){"use strict";n.d(t,{L:function(){return d}});var i=n(95929),r=n(60539),s=n(28181),o=n(42413),a=n(45328),l=n(68945),c=n(2831),u=n(58144),h=n(48961);function d({predicate:e=(()=>!0),snappingManager:t,snappingContext:n,updatingHandles:a,useZ:d=!0}){const _=new c.rh;if(null==t)return{snappingStep:[g,_],cancelSnapping:g};let v,y=null,b=null,T=null;const E=()=>{y=(0,i.DC)(y),t.doneSnapping(),b?.frameTask.remove(),b=null,v=(0,i.xt)(v),T=null},x=(S=t,w=d,A=_,(0,r.sg)((async({frameTask:e,point:t,scenePoint:n,context:i,event:r,delta:s,getLastState:a},l)=>{const c=await e.schedule((()=>S.snap({point:t,scenePoint:n,context:i,signal:l})),l);if(c.valid){let n=await e.schedule((()=>c.apply()),l);const u=a();null!=u.point&&t!==u.point&&(n=S.update({point:u.point,scenePoint:u.scenePoint,context:i})),null!=u.updatePoint&&(0,o.CI)(n,u.updatePoint)||(m(r.mapEnd,n,s,w),A.execute(r))}})));var S,w,A;let M=null,O=null,R=null;return{snappingStep:[i=>{if(!e(i))return i;const{action:o}=i;if("start"===o){const{info:e}=i,r=function(e){return"3d"===e.type?e.resourceController.scheduler.registerTask(h.W6.SNAPPING):h.nu}(t.view);if(b=function(e,t,n){return{context:new u.e({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:null!=t.info?t.info.handle:null,excludeFeature:e.excludeFeature,feature:e.feature,visualizer:e.visualizer}),originalPos:null!=t.snapOrigin?e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,originalScenePos:null!=t.scenePoints?t.scenePoints.sceneStart:null,frameTask:n}}(n,i,r),b.context.selfSnappingZ=null,!d&&null!=e){const t=function(e,t){if(!e.hasZ())return null;const n=t.vertices;let i=null;for(const t of n){const n=e.getZ(t.pos);if(null!=i&&null!=n&&Math.abs(n-i)>1e-6)return null;null==i&&(i=n)}return i}(n.coordinateHelper,e.handle.component);null!=t&&(b.context.selfSnappingZ={value:t,elevationInfo:n.elevationInfo??l.qt})}}if(null!=b){const{context:e,originalScenePos:n,originalPos:l}=b,{mapEnd:c,mapStart:u,scenePoints:h}=i,g=p(l,f(c,u)),_=f(u,l),E={...i,action:"update"},S=b.context,w=function(e,t){return null==e||null==t?null:p(e,f(t.sceneEnd,t.sceneStart))}(n,h),A=t.update({point:g,scenePoint:w,context:e});if(R=A,m(c,A,_,d),M=g,O=w,"end"!==o){const{frameTask:e}=b;null==y&&(y=new AbortController),T=t=>{a.addPromise((0,r.QZ)(x({frameTask:e,event:E,context:S,point:g,scenePoint:w,delta:_,getLastState:()=>({point:M,scenePoint:O,updatePoint:t.forceUpdate?null:R})},y.signal)))},T({forceUpdate:!1}),null==v&&(v=(0,s.watch)((()=>t.options.effectiveEnabled),(()=>T?.({forceUpdate:!0}))))}}return"end"===o&&E(),i},_],cancelSnapping:e=>(E(),e)}}function p(e,[t,n,i]){const r=(0,a.EL)(e);return r.x+=t,r.y+=n,r.hasZ&&(r.z+=i),r}function f(e,t){const n=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,n]}function m(e,t,[n,i,r],s){e.x=t.x+n,e.y=t.y+i,s&&e.hasZ&&t.hasZ&&(e.z=t.z+r)}function g(e){return e}},21858:function(e,t,n){"use strict";n.d(t,{b:function(){return c}});var i=n(61226),r=n(97441),s=n(64330),o=n(92535),a=n(96942),l=n(98245);class c{draw(e,t){const n=function(e){const t=[];for(const n of e){let e=!0;for(const i of t)if(n.equals(i)){e=!1;break}e&&t.push(n)}return t}(e),c=this.sortUniqueHints(n),u=[];for(const e of c)e instanceof r.v&&u.push(this.visualizeIntersectionPoint(e,t)),e instanceof s.c&&u.push(this.visualizeLine(e,t)),e instanceof o.r&&u.push(this.visualizeParallelSign(e,t)),e instanceof l.l&&u.push(this.visualizeRightAngleQuad(e,t)),e instanceof a._&&u.push(this.visualizePoint(e,t));return(0,i.vE)(u)}sortUniqueHints(e){return e}}},96942:function(e,t,n){"use strict";n.d(t,{_:function(){return s}});var i=n(20551),r=n(94612);class s extends r.m{constructor(e,t,n){super(t,n),this.point=e}equals(e){return e instanceof s&&(0,i.e)(this.point,e.point)}}},17921:function(e,t,n){"use strict";n.d(t,{T:function(){return r}});var i=n(13520);function r(e){let t=0,n=0,r=0;return e?("cim"===e.type&&e.data.symbol&&"symbolLayers"in e.data.symbol&&e.data.symbol.symbolLayers&&e.data.symbol.symbolLayers.map((e=>{"CIMVectorMarker"===e.type&&e.anchorPoint&&(Math.abs(e.anchorPoint.x)>t&&(t=e.anchorPoint.x),Math.abs(e.anchorPoint.y)>n&&(n=e.anchorPoint.y),null!=e.size&&e.size>r&&(r=e.size))})),t=(0,i.Lz)(t),n=(0,i.Lz)(n),r=(0,i.Lz)(r),{offsetX:t,offsetY:n,size:r}):{offsetX:t,offsetY:n,size:r}}},30329:function(e,t,n){"use strict";n.d(t,{m:function(){return Ee}});var i=n(53804),r=n(48996),s=n(40212),o=n(95929),a=n(28181),l=n(23502),c=(n(58941),n(40633),n(13798),n(65953)),u=n(93839);const h="esri-tooltip",d=`${h}-content`,p=`${h}-content--input`,f=`${h}-content__header`,m=`${h}-content__header__spacer`,g=`${h}-content__header__actions`,_=`${h}-draw-header-actions`,v=`${h}-table`,y=`${h}-help-message`,b=`${h}-help-message__text`,T=`${h}-help-message__icon`;n(39819);var E=n(31267),x=n(20457),S=n(49146);const w=`${h}-field`,A={base:w,inputMode:`${w}--input`,title:`${w}__title`,value:`${w}__value`};let M=class extends E.A{constructor(){super(...arguments),this.hidden=!1,this.mode="feedback"}render(){return(0,S.K)("div",{class:this.classes({[A.base]:!0,[A.inputMode]:"input"===this.mode})},(0,S.K)("div",{class:A.title},this.title),(0,S.K)("div",{class:A.value},this.value))}};(0,i._)([(0,l.MZ)()],M.prototype,"hidden",void 0),(0,i._)([(0,l.MZ)()],M.prototype,"mode",void 0),(0,i._)([(0,l.MZ)()],M.prototype,"title",void 0),(0,i._)([(0,l.MZ)()],M.prototype,"value",void 0),M=(0,i._)([(0,c.$)("esri.views.interactive.tooltip.components.TooltipField")],M);const O={base:`${h}-value-by-value`};let R=class extends E.A{constructor(){super(...arguments),this.divider="×"}render(){return(0,S.K)("div",{class:O.base},(0,S.K)("span",null,this.left),(0,S.K)("span",null,this.divider),(0,S.K)("span",null,this.right))}};(0,i._)([(0,l.MZ)()],R.prototype,"left",void 0),(0,i._)([(0,l.MZ)()],R.prototype,"divider",void 0),(0,i._)([(0,l.MZ)()],R.prototype,"right",void 0),R=(0,i._)([(0,c.$)("esri.views.interactive.tooltip.components.ValueByValue")],R);var C=n(84016),I=n(7213),P=n(60539),D=n(74087),L=n(15999),N=n(62938),F=n(76722),z=n(37578),V=n(49634),H=n(96018),U=n(90357);let k=class extends E.A{constructor(){super(...arguments),this._focusAbortController=new AbortController,this._transition=null,this._mode="feedback",this._getFormatters=(0,I.B)(V.GC),this._onDiscard=()=>{this.info.clearInputValues(),this.exitInputMode()},this._onCommit=(e,t)=>{if("commit-and-exit"===t)return void this.exitInputMode();if("commit-on-blur"===t)return;const n=this._getFocusableElements(),i=n.length,r=n.indexOf(e);if(-1===r)return void this.exitInputMode();const s=((r+("commit-and-next"===t?1:-1))%i+i)%i;j(n.at(s))},this._handleTab=e=>{if(e.code!==z.ac.next)return;const t=this._getFocusableElements(),n=t.at(0),i=t.at(-1);n&&i&&(e.shiftKey?document.activeElement===n&&(e.preventDefault(),j(i)):document.activeElement===i&&(e.preventDefault(),j(n)))}}get mode(){return this._mode}get _displayUnits(){const e=(0,F.c)(this.tooltip.view);return{length:e,verticalLength:e,area:e,angle:"degrees"}}get _inputUnitInfos(){const e=this._messagesUnits,t=t=>({unit:t,abbreviation:(0,L.Cq)(e,t,"abbr")}),n=(0,F.c)(this.tooltip.view),i=t((0,N.wL)(n)),r=t((0,N.m5)(n)),s=t((0,N.tW)(n)),o=t("degrees");return{length:i,lengthRelative:i,verticalLength:r,verticalLengthRelative:r,area:s,direction:o,orientation:o,rotation:o,longitudeLatitude:o}}get _formatters(){return this._getFormatters(this._messagesUnits,this._displayUnits)}get fieldContext(){return{formatters:this._formatters,inputUnitInfos:this._inputUnitInfos,messages:this._messagesTooltip,sketchOptions:this.info.sketchOptions,onCommit:this._onCommit,onDiscard:this._onDiscard}}render(){const{visibleElements:e}=this.info.sketchOptions.tooltips,t=this._renderedContent,n=this._renderedActions,i=this._renderedHelpMessage,r=t.length>0,s=r||!!i,o="input"===this.mode;return(0,S.K)("div",{class:(0,x.Ly)(d,o&&p),onkeydown:this._handleTab},o&&s&&e.header?(0,S.K)("div",{class:f,key:"header"},(0,S.K)("calcite-button",{appearance:"transparent","data-testid":"tooltip-back-button",iconFlipRtl:"both",iconStart:"chevron-left",key:"discard-button",kind:"neutral",onclick:this._onDiscard,scale:"s",tabIndex:-1}),n.length>0?(0,S.K)(S.w,null,(0,S.K)("div",{class:m,key:"spacer"}),(0,S.K)("div",{class:g,key:"actions"},n)):null):null,r?(0,S.K)("div",{class:v,key:"content"},...t):null,i)}_renderActions(){return null}loadDependencies(){return(0,H.W)({button:()=>n.e(2974).then(n.bind(n,74769)),icon:()=>n.e(2525).then(n.bind(n,22667)),input:()=>n.e(2498).then(n.bind(n,33916))})}async enterInputMode(e){try{await this._transitionTo("input"),await this._focusField(e)}catch(e){(0,P.jH)(e)}}async exitInputMode({focusOnView:e=!0}={}){try{const{container:t,info:n}=this;n.clearInputValues();const i=e?t?.closest(".esri-view")?.querySelector(".esri-view-surface"):null;await this._transitionTo("feedback"),i instanceof HTMLElement&&i.focus()}catch(e){(0,P.jH)(e)}}get _renderedContent(){return G(this._renderContent())}get _renderedActions(){return G(this._renderActions())}get _renderedHelpMessage(){const{sketchOptions:e,visibleElements:t}=this.info;if(!t.helpMessage)return null;const n=e.tooltips.helpMessage??this._defaultHelpMessage;if(!n)return null;const i=e.tooltips.helpMessageIcon??"information";return(0,S.K)("div",{class:y,key:"help-message"},i?(0,S.K)("calcite-icon",{class:T,icon:i,scale:"s"}):null,(0,S.K)("div",{class:b},n))}get _defaultHelpMessage(){const{helpMessage:e,viewType:t}=this.info;if(null==e)return null;const n="3d"===t?"helpMessages3d":"helpMessages2d";return this._messagesTooltip?.sketch?.[n]?.[e]}async _focusField(e){this._focusAbortController?.abort(),this._focusAbortController=new AbortController;const{signal:t}=this._focusAbortController;await this._waitForInputs(),(0,P.Te)(t);const n=this._getFocusableInputs(),i=e?n.find((t=>t.getAttribute("data-field-name")===e)):n.at(0);await j(i)}async _transitionTo(e){if(this._mode===e)return;const t=()=>{this._mode=e};if(!this.domNode?.firstChild||!document.startViewTransition||(0,C.O)())return void t();this.autoRenderingEnabled=!1,this._transition?.skipTransition();const n=this._transition=document.startViewTransition((()=>{if(!this.destroyed)return this.autoRenderingEnabled=!0,t(),this.renderNow(),(0,D.NO)()}));try{await this._transition.finished}finally{n===this._transition&&(this._transition=null)}}async _waitForInputs(){const e=()=>Array.from(this.domNode?.querySelectorAll("calcite-input")??[]);for(;0===e().length;)await(0,P.Pl)(B);await(0,D.$m)()}_getFocusableInputs(){return Array.from(this.domNode?.querySelectorAll("calcite-input:not([read-only]):not([disabled])")??[])}_getFocusableElements(){const e=this.domNode?.querySelector(`.${_}`);return[...Array.from(e?.querySelectorAll(`.${g} calcite-button:not([disabled])`)??[]),...this._getFocusableInputs()]}};async function j(e){await(e?.setFocus())}function G(e){return(Array.isArray(e)?e:[e]).flat(10).filter((e=>!!e))}(0,i._)([(0,U.G)("esri/core/t9n/Units"),(0,l.MZ)()],k.prototype,"_messagesUnits",void 0),(0,i._)([(0,U.G)("esri/views/interactive/tooltip/t9n/Tooltip"),(0,l.MZ)()],k.prototype,"_messagesTooltip",void 0),(0,i._)([(0,l.MZ)()],k.prototype,"info",void 0),(0,i._)([(0,l.MZ)()],k.prototype,"tooltip",void 0),(0,i._)([(0,l.MZ)()],k.prototype,"_mode",void 0),(0,i._)([(0,l.MZ)()],k.prototype,"mode",null),(0,i._)([(0,l.MZ)()],k.prototype,"_displayUnits",null),(0,i._)([(0,l.MZ)()],k.prototype,"_inputUnitInfos",null),(0,i._)([(0,l.MZ)()],k.prototype,"_formatters",null),(0,i._)([(0,l.MZ)()],k.prototype,"fieldContext",null),(0,i._)([(0,l.MZ)()],k.prototype,"_renderedContent",null),(0,i._)([(0,l.MZ)()],k.prototype,"_renderedActions",null),(0,i._)([(0,l.MZ)()],k.prototype,"_renderedHelpMessage",null),(0,i._)([(0,l.MZ)()],k.prototype,"_defaultHelpMessage",null),k=(0,i._)([(0,c.$)("esri.views.interactive.tooltip.content.TooltipContent")],k);const B=20;let $=class extends k{_renderContent(){const{area:e,radius:t,xSize:n,ySize:i,visibleElements:r}=this.info,s=this._messagesTooltip.sketch,o=this._formatters;return(0,S.K)(S.w,null,r.radius&&null!=t?(0,S.K)(M,{title:s.radius,value:o.length(t)}):null,r.size&&null!=n&&null!=i?(0,S.K)(M,{title:s.size,value:(0,S.K)(R,{left:o.length(n),right:o.length(i)})}):null,r.area?(0,S.K)(M,{title:s.area,value:o.area(e)}):null)}};$=(0,i._)([(0,c.$)("esri.views.interactive.tooltip.content.TooltipContentDrawCircle")],$);const Z=`${h}-editable-field`,W={base:Z,inputMode:`${Z}--input`,feedbackMode:`${Z}--feedback`,readOnly:`${Z}--read-only`,locked:`${Z}--locked`,title:`${Z}__title`,value:`${Z}__value`,valueContent:`${Z}__value__content`,valueContentReadOnly:`${Z}__value__content--read-only`,lockIcon:`${Z}__lock-icon`,input:`${Z}__input`,inputSuffix:`${Z}__input-suffix`,button:`${Z}__button`},q="lock";let X=class extends E.A{constructor(){super(...arguments),this._input=null,this._onKeyDown=e=>{e.key===z.ac.discard&&"input"===this.mode&&this._input&&this.context.onDiscard(this._input)},this._onInputKeyDown=e=>{const t=this._input;if(t)switch(e.key){case z.ac.commit:return this.field.onCommit("commit-and-exit",t,this.context);case z.ac.next:{e.preventDefault(),e.stopPropagation();const n=e.shiftKey?"commit-and-previous":"commit-and-next";return this.field.onCommit(n,t,this.context)}}},this._onInput=e=>{this.field.onInput(e.target.value)},this._onInputBlur=()=>{const e=this._input;e&&this.field.onCommit("commit-on-blur",e,this.context)},this._selectText=()=>{const e=()=>{this._input===document.activeElement&&this._input?.selectText()};e(),(0,D.$m)().then(e)}}initialize(){this.addHandles((0,a.watch)((()=>this._rawDisplayValue),(()=>{const{committed:e,inputValue:t}=this.field;e||t||this._input!==document.activeElement||this._selectText()})))}loadDependencies(){return(0,H.W)({button:()=>n.e(2974).then(n.bind(n,74769)),icon:()=>n.e(2525).then(n.bind(n,22667)),input:()=>n.e(2498).then(n.bind(n,33916))})}render(){const{field:e,mode:t}=this,n="input"===t,{locked:i,readOnly:r}=e;return(0,S.K)("div",{class:this.classes({[W.base]:!0,[W.feedbackMode]:"feedback"===t,[W.inputMode]:"input"===t,[W.locked]:i,[W.readOnly]:r})},(0,S.K)("div",{class:W.title,key:"title"},this._title),(0,S.K)("div",{class:W.value,key:"value",onkeydown:this._onKeyDown},n?this._renderValueInputMode():this._renderValueFeedbackMode()))}get _formattedValue(){return this.field.getFormattedValue(this.context)||Y}get _rawDisplayValue(){return this.field.getRawDisplayValue(this.context)}get _suffix(){return this.field.getSuffix(this.context)}get _title(){const{title:e}=this.field;return"string"==typeof e?e:e(this.context)}_renderValueFeedbackMode(){return(0,S.K)(S.w,null,(0,S.K)("div",{class:W.valueContent,key:"value-feedback"},this._formattedValue),this.field.locked&&"input"!==this.mode?(0,S.K)("calcite-icon",{class:W.lockIcon,icon:q,key:"icon",scale:"s"}):null)}_renderValueInputMode(){return this.field.readOnly?this._renderValueReadOnly():this._renderValueWritable()}_renderValueReadOnly(){return(0,S.K)("div",{class:this.classes(W.valueContent,W.valueContentReadOnly),key:"value-read-only"},this._formattedValue)}_renderValueWritable(){const{field:e}=this,{name:t,invalid:n,locked:i}=e,r=this.context?.messages.sketch??{},s=i?r.unlockConstraint:r.lockConstraint;return(0,S.K)(S.w,null,(0,S.K)("calcite-input",{afterCreate:e=>{this._input=e},class:W.input,"data-field-name":t,"data-testid":`tooltip-field-${t}`,onblur:this._onInputBlur,onfocus:this._selectText,onkeydown:this._onInputKeyDown,scale:"s",status:n?"invalid":"idle",type:"text",value:this._rawDisplayValue??Y,onCalciteInputInput:this._onInput}),(0,S.K)("div",{class:W.inputSuffix,key:"suffix"},this._suffix),e.lockable?(0,S.K)("calcite-button",{alignment:"center",appearance:"transparent",class:W.button,"data-testid":`tooltip-field-${t}-lock`,iconStart:i?q:"unlock",key:"lock",kind:"neutral",label:s,onclick:()=>{e.toggleLock(this.context)},scale:"s",tabIndex:-1,title:s}):(0,S.K)("div",{key:"lock-empty"}))}};(0,i._)([(0,l.MZ)()],X.prototype,"field",void 0),(0,i._)([(0,l.MZ)()],X.prototype,"context",void 0),(0,i._)([(0,l.MZ)()],X.prototype,"mode",void 0),(0,i._)([(0,l.MZ)()],X.prototype,"_input",void 0),(0,i._)([(0,l.MZ)()],X.prototype,"_formattedValue",null),(0,i._)([(0,l.MZ)()],X.prototype,"_rawDisplayValue",null),(0,i._)([(0,l.MZ)()],X.prototype,"_suffix",null),(0,i._)([(0,l.MZ)()],X.prototype,"_title",null),X=(0,i._)([(0,c.$)("esri.views.interactive.tooltip.components.TooltipEditableField")],X);const Y="—";function K(e){const t=e.fields.filter((e=>!0===e?.visible));return 0===t.length?null:(0,S.K)(S.w,null,t.map((t=>(0,S.K)(X,{context:e.context,field:t,key:t.id,mode:e.mode}))))}let Q=class extends k{_renderContent(){const{fieldContext:e,info:t,mode:n}=this,{visibleElements:i}=t;return(0,S.K)(K,{context:e,fields:[i.coordinates?t.effectiveX:void 0,i.coordinates?t.effectiveY:void 0,i.elevation?t.elevation:void 0,i.orientation?t.orientation:void 0,i.scale?t.scale:void 0],mode:n})}};Q=(0,i._)([(0,c.$)("esri.views.interactive.tooltip.content.TooltipContentDrawMesh")],Q);let J=class extends k{_renderContent(){const{fieldContext:e,info:t,mode:n}=this,{elevation:i,visibleElements:r}=t;return(0,S.K)(K,{context:e,fields:[r.coordinates?t.effectiveX:void 0,r.coordinates?t.effectiveY:void 0,r.elevation?i:void 0],mode:n})}};J=(0,i._)([(0,c.$)("esri.views.interactive.tooltip.content.TooltipContentDrawPoint")],J);const ee={absolute:"absolute-direction",relative:"relative-direction"};let te=class extends E.A{constructor(e){super(e),this.visibleElements={}}render(){return(0,S.K)("div",{class:_},this._isElementVisible("direction")?(0,S.K)(ne,{messages:this.messages,sketchOptions:this.sketchOptions}):null)}loadDependencies(){return(0,H.W)({button:()=>n.e(2974).then(n.bind(n,74769)),dropdown:()=>n.e(7209).then(n.bind(n,10582)),"dropdown-item":()=>n.e(2547).then(n.bind(n,70019)),"dropdown-group":()=>n.e(951).then(n.bind(n,75053))})}_isElementVisible(e){return this.visibleElements?.[e]??this.sketchOptions.tooltips.visibleElements[e]}};function ne(e){const{directionMode:t}=e.sketchOptions.values,n=e.messages?.sketch,i=n?.directionModeSelect?.title,r="absolute",s="relative";return(0,S.K)("calcite-dropdown",{key:"direction-mode",placement:"bottom-end",scale:"s",widthScale:"s",onCalciteDropdownSelect:t=>{const n=t.target.selectedItems?.[0]?.getAttribute("data-mode");e.sketchOptions.values.directionMode=n??"absolute"}},(0,S.K)("calcite-button",{alignment:"end",appearance:"transparent",iconStart:ee[t],kind:"neutral",label:i,scale:"s",slot:"trigger",title:i}),(0,S.K)("calcite-dropdown-group",{selectionMode:"single"},(0,S.K)("calcite-dropdown-item",{"data-mode":s,"data-testid":"tooltip-direction-mode-relative",iconStart:ee.relative,key:"relative",selected:t===s},n?.directionModeSelect?.relative),(0,S.K)("calcite-dropdown-item",{"data-mode":r,"data-testid":"tooltip-direction-mode-absolute",iconStart:ee.absolute,key:"absolute",selected:t===r},n?.directionModeSelect?.absolute)))}(0,i._)([(0,U.G)("esri/views/interactive/tooltip/t9n/Tooltip"),(0,l.MZ)()],te.prototype,"messages",void 0),(0,i._)([(0,l.MZ)()],te.prototype,"sketchOptions",void 0),(0,i._)([(0,l.MZ)()],te.prototype,"visibleElements",void 0),te=(0,i._)([(0,c.$)("esri.views.interactive.tooltip.components.DrawHeaderActions")],te);let ie=class extends k{_renderContent(){const{fieldContext:e,info:t,mode:n}=this,{xyMode:i,visibleElements:r}=t;return(0,S.K)(K,{context:e,fields:[..."direction-distance"===i?[r.direction?t.direction:void 0,r.distance?t.distance:void 0]:[r.coordinates?t.effectiveX:void 0,r.coordinates?t.effectiveY:void 0],r.elevation?t.elevation:void 0,r.area?t.area:void 0],mode:n})}_renderActions(){const{xyMode:e,sketchOptions:t}=this.info;return(0,S.K)(te,{sketchOptions:t,visibleElements:{direction:"direction-distance"===e}})}};ie=(0,i._)([(0,c.$)("esri.views.interactive.tooltip.content.TooltipContentDrawPolygon")],ie);let re=class extends k{_renderContent(){const{fieldContext:e,info:t,mode:n}=this,{xyMode:i,visibleElements:r}=t;return(0,S.K)(K,{context:e,fields:[..."direction-distance"===i?[r.direction?t.direction:void 0,r.distance?t.distance:void 0]:[r.coordinates?t.effectiveX:void 0,r.coordinates?t.effectiveY:void 0],r.elevation?t.elevation:void 0,r.totalLength?t.totalLength:void 0],mode:n})}_renderActions(){const{xyMode:e,sketchOptions:t}=this.info;return(0,S.K)(te,{sketchOptions:t,visibleElements:{direction:"direction-distance"===e}})}};re=(0,i._)([(0,c.$)("esri.views.interactive.tooltip.content.TooltipContentDrawPolyline")],re);let se=class extends k{_renderContent(){const{area:e,xSize:t,ySize:n,visibleElements:i}=this.info,r=this._messagesTooltip.sketch,s=this._formatters;return(0,S.K)(S.w,null,i.size&&null!=t&&null!=n?(0,S.K)(M,{title:r.size,value:(0,S.K)(R,{left:s.length(t),right:s.length(n)})}):null,i.area?(0,S.K)(M,{title:r.area,value:s.area(e)}):null)}};se=(0,i._)([(0,c.$)("esri.views.interactive.tooltip.content.TooltipContentDrawRectangle")],se);let oe=class extends k{_renderContent(){const{angle:e,visibleElements:t}=this.info,n=this._messagesTooltip.sketch;return(0,S.K)(S.w,null,t.rotation?(0,S.K)(M,{title:n.rotation,value:this._formatters.angleRelative(e)}):null)}};oe=(0,i._)([(0,c.$)("esri.views.interactive.tooltip.content.TooltipContentExtentRotate")],oe);let ae=class extends k{_renderContent(){const e=this.info,{visibleElements:t}=e,n=this._messagesTooltip.sketch,i=this._formatters;return(0,S.K)(S.w,null,t.size?(0,S.K)(M,{title:n.size,value:(0,S.K)(R,{left:i.length(e.xSize),right:i.length(e.ySize)})}):null,t.scale?(0,S.K)(M,{title:n.scale,value:(0,S.K)(R,{left:i.scale(e.xScale),right:i.scale(e.yScale)})}):null)}};ae=(0,i._)([(0,c.$)("esri.views.interactive.tooltip.content.TooltipContentExtentScale")],ae);let le=class extends k{_renderContent(){const{fieldContext:e,info:t,mode:n}=this,{visibleElements:i}=t;return(0,S.K)(K,{context:e,fields:[i.coordinates?t.effectiveX:void 0,i.coordinates?t.effectiveY:void 0,i.elevation?t.elevation:void 0],mode:n})}};le=(0,i._)([(0,c.$)("esri.views.interactive.tooltip.content.TooltipContentMovePoint")],le);let ce=class extends k{_renderContent(){const{area:e,distance:t,totalLength:n,visibleElements:i}=this.info,r=this._messagesTooltip.sketch,s=this._formatters;return(0,S.K)(S.w,null,i.distance?(0,S.K)(M,{title:r.distance,value:s.lengthRelative(t)}):null,i.area&&null!=e?(0,S.K)(M,{title:r.area,value:s.area(e)}):null,i.totalLength&&null!=n?(0,S.K)(M,{title:r.totalLength,value:s.length(n)}):null)}};ce=(0,i._)([(0,c.$)("esri.views.interactive.tooltip.content.TooltipContentReshapeEdgeOffset")],ce);let ue=class extends k{_renderContent(){const{fieldContext:e,info:t,mode:n}=this,{visibleElements:i}=t;return(0,S.K)(K,{context:e,fields:[i.coordinates?t.effectiveX:void 0,i.coordinates?t.effectiveY:void 0,i.elevation?t.elevation:void 0,i.area&&"polygon"===t.geometryType?t.area:null,i.totalLength&&"polyline"===t.geometryType?t.totalLength:null],mode:n})}};ue=(0,i._)([(0,c.$)("esri.views.interactive.tooltip.content.TooltipContentSelectedVertex")],ue);var he=n(88226);let de=class extends k{_renderContent(){const{info:e}=this,{visibleElements:t}=e,n=this._messagesTooltip.sketch,i=this._formatters;return(0,S.K)(S.w,null,t.orientation&&null!=e.orientation?(0,S.K)(M,{key:"orientation",title:n.orientation,value:(0,he.Nk)(e.orientation,e.rotationType,e.orientationPrecision)}):null,t.size&&null!=e.size?(0,S.K)(M,{key:"size",title:n.size,value:i.length(e.size,e.sizeUnit,e.sizePrecision)}):null)}};de=(0,i._)([(0,c.$)("esri.views.interactive.tooltip.content.TooltipContentTransformAbsolute")],de);let pe=class extends k{_renderContent(){const{fieldContext:e,info:t,mode:n}=this,{visibleElements:i}=t;return(0,S.K)(K,{context:e,fields:[i.coordinates?t.effectiveX:void 0,i.coordinates?t.effectiveY:void 0,i.elevation?t.elevation:void 0,i.orientation?t.orientation:void 0,i.scale?t.scale:void 0],mode:n})}};pe=(0,i._)([(0,c.$)("esri.views.interactive.tooltip.content.TooltipContentTransformMesh")],pe);let fe=class extends k{_renderContent(){const{fieldContext:e,info:t,mode:n}=this,{visibleElements:i}=t;return(0,S.K)(K,{context:e,fields:[i.coordinates?t.effectiveX:void 0,i.coordinates?t.effectiveY:void 0,i.elevation?t.elevation:void 0],mode:n})}};fe=(0,i._)([(0,c.$)("esri.views.interactive.tooltip.content.TooltipContentTransformPoint")],fe);let me=class extends k{_renderContent(){const{info:e}=this,{visibleElements:t}=e,n=this._messagesTooltip.sketch;return(0,S.K)(S.w,null,t.rotation&&null!=e.rotation?(0,S.K)(M,{key:"rotation",title:n.rotation,value:(0,he.rJ)(e.rotation,e.rotationType,e.rotationPrecision)}):null,t.orientation&&null!=e.orientation?(0,S.K)(M,{key:"orientation",title:n.orientation,value:(0,he.Nk)(e.orientation,e.rotationType,e.orientationPrecision)}):null)}};me=(0,i._)([(0,c.$)("esri.views.interactive.tooltip.content.TooltipContentTransformRotate")],me);let ge=class extends k{_renderContent(){const{info:e}=this,{visibleElements:t}=e,n=this._messagesTooltip.sketch,i=this._formatters;return(0,S.K)(S.w,null,t.scale&&null!=e.scale?(0,S.K)(M,{key:"scale",title:n.scale,value:i.percentage(e.scale)}):null,t.size&&null!=e.size?(0,S.K)(M,{key:"size",title:n.size,value:i.length(e.size,e.sizeUnit,e.sizePrecision)}):null)}};ge=(0,i._)([(0,c.$)("esri.views.interactive.tooltip.content.TooltipContentTransformScale")],ge);let _e=class extends k{_renderContent(){const{info:e}=this,{visibleElements:t}=e,n=this._messagesTooltip.sketch,i=this._formatters;return(0,S.K)(S.w,null,t.distance?(0,S.K)(M,{title:n.distance,value:i.length(e.distance)}):null)}};_e=(0,i._)([(0,c.$)("esri.views.interactive.tooltip.content.TooltipContentTranslate")],_e);let ve=class extends k{_renderContent(){const{distance:e,elevation:t,area:n,totalLength:i,visibleElements:r}=this.info,s=this._messagesTooltip.sketch,o=this._formatters;return(0,S.K)(S.w,null,r.distance?(0,S.K)(M,{title:s.distance,value:o.length(e)}):null,r.elevation&&null!=t?.actual?(0,S.K)(M,{title:s.elevation,value:o.verticalLength(t.actual)}):null,r.area&&null!=n?(0,S.K)(M,{title:s.area,value:o.area(n)}):null,r.totalLength&&null!=i?(0,S.K)(M,{title:s.totalLength,value:o.length(i)}):null)}};ve=(0,i._)([(0,c.$)("esri.views.interactive.tooltip.content.TooltipContentTranslateVertex")],ve);let ye=class extends k{_renderContent(){const{info:e}=this,{visibleElements:t}=e,n=this._messagesTooltip.sketch,i=this._formatters;return(0,S.K)(S.w,null,t.distance?(0,S.K)(M,{title:n.distance,value:i.length(e.distance)}):null)}};ye=(0,i._)([(0,c.$)("esri.views.interactive.tooltip.content.TooltipContentTranslateXY")],ye);let be=class extends k{_renderContent(){const{info:e}=this,{visibleElements:t}=e,n=this._messagesTooltip.sketch;return(0,S.K)(S.w,null,t.distance?(0,S.K)(M,{title:n.distance,value:this._formatters.verticalLengthRelative(e.distance)}):null)}};be=(0,i._)([(0,c.$)("esri.views.interactive.tooltip.content.TooltipContentTranslateZ")],be);const Te={base:`${h}`};let Ee=class extends r.A.EventedAccessor{constructor(e){super(e),this.info=null,this.position=null,this.content=null,this.contentContainer=(()=>{const e=document.createElement("div");return e.classList.add(Te.base),(0,u.hY)(e),e})()}initialize(){const{contentContainer:e}=this;this.addHandles([(0,a.watch)((()=>this.view.overlay?.surface),(t=>{e.remove(),t?.appendChild(e)}),a.pc),(0,a.watch)((()=>this.info),((t,n)=>{if(null!=this.content&&null!=t&&null!=n&&t.type===n.type)this.content.info=t;else{this.content=(0,o.pR)(this.content);const n=function(e,t){if(null==t)return null;const n=document.createElement("div");switch(t.type){case"draw-point":return new J({tooltip:e,info:t,container:n});case"draw-polygon":return new ie({tooltip:e,info:t,container:n});case"draw-polyline":return new re({tooltip:e,info:t,container:n});case"draw-mesh":return new Q({tooltip:e,info:t,container:n});case"draw-rectangle":return new se({tooltip:e,info:t,container:n});case"draw-circle":return new $({tooltip:e,info:t,container:n});case"extent-rotate":return new oe({tooltip:e,info:t,container:n});case"extent-scale":return new ae({tooltip:e,info:t,container:n});case"move-point":return new le({tooltip:e,info:t,container:n});case"selected-vertex":return new ue({tooltip:e,info:t,container:n});case"transform-absolute":return new de({tooltip:e,info:t,container:n});case"transform-point":return new fe({tooltip:e,info:t,container:n});case"transform-mesh":return new pe({tooltip:e,info:t,container:n});case"transform-rotate":return new me({tooltip:e,info:t,container:n});case"transform-scale":return new ge({tooltip:e,info:t,container:n});case"translate":return new _e({tooltip:e,info:t,container:n});case"translate-vertex":return new ve({tooltip:e,info:t,container:n});case"translate-z":return new be({tooltip:e,info:t,container:n});case"translate-xy":return new ye({tooltip:e,info:t,container:n});case"reshape-edge-offset":return new ce({tooltip:e,info:t,container:n})}}(this,t);n&&(this.content=n,n.container&&e.appendChild(n.container),this.exitInputMode())}}),a.pc),(0,a.watch)((()=>({container:this.contentContainer,content:this.content,screenPoint:this._screenPoint,positionMode:this.positionMode,position:this.position})),xe,a.pc),(0,s.on)(this.contentContainer,"paste",(e=>{this.emit("paste",e)}))])}destroy(){this.info=null,this.content=(0,o.pR)(this.content),this.contentContainer.remove()}get positionMode(){return"input"===this.content?.mode?"fixed":"follow-cursor"}get mode(){return this.content?.mode??"feedback"}get _screenPoint(){const{inputManager:e}=this.view;return e?.multiTouchActive?null:e?.latestPointerLocation}get visible(){return"none"!==this.contentContainer?.style.display}clear(){this.info=null}async enterInputMode(e){await(this.content?.enterInputMode(e))}async exitInputMode(e){await(this.content?.exitInputMode(e))}};function xe(e){if("fixed"===e.positionMode&&!e.position)return;const{style:t}=e.container,n=e.position??e.screenPoint;if(null!=n&&null!=e.content){t.display="block";const i=(0,x.V8)(e.container),r=`translate(${Math.round(n.x)+Se[0]*(i?-1:1)}px, ${Math.round(n.y)+Se[1]}px)`;t.transform=i?`translate(-100%, 0) ${r}`:r}else t.display="none"}(0,i._)([(0,l.MZ)({nonNullable:!0})],Ee.prototype,"view",void 0),(0,i._)([(0,l.MZ)()],Ee.prototype,"info",void 0),(0,i._)([(0,l.MZ)()],Ee.prototype,"positionMode",null),(0,i._)([(0,l.MZ)()],Ee.prototype,"position",void 0),(0,i._)([(0,l.MZ)()],Ee.prototype,"content",void 0),(0,i._)([(0,l.MZ)()],Ee.prototype,"mode",null),(0,i._)([(0,l.MZ)()],Ee.prototype,"contentContainer",void 0),(0,i._)([(0,l.MZ)()],Ee.prototype,"_screenPoint",null),Ee=(0,i._)([(0,c.$)("esri.views.interactive.tooltip.Tooltip")],Ee);const Se=[20,20]},18063:function(e,t,n){"use strict";n.d(t,{Am:function(){return E},Gk:function(){return g},S3:function(){return y},fL:function(){return S},R0:function(){return _},em:function(){return x},LJ:function(){return b},dy:function(){return T},fr:function(){return v},Hw:function(){return w},uf:function(){return A}});var i=n(56275),r=n(49634),s=n(53804),o=n(83525),a=n(66110),l=n(23502),c=(n(58941),n(40633),n(13798),n(65953));let u=class extends o.A{constructor(e){super(e),this.actual=null,this.lockable=!0,this.id=(0,a.lk)(),this.inputValue=null,this.readOnly=!1,this.suffix=null,this.visible=!0,this.invalid=!1,this.unlockOnVertexPlacement=!0}get committed(){return this.lockable?this._get("committed"):null}set committed(e){this.lockable&&this._set("committed",e)}get dirty(){return null!=this.inputValue}get locked(){return this.lockable&&null!=this.committed}onInput(e){this.inputValue=e}onCommit(e,t,n){this.lockable?this._onCommitLockable(e,n):this._onCommitNonLockable(n),this.invalid&&"commit-and-exit"===e||n.onCommit(t,e)}_onCommitLockable(e,t){const{inputValue:n,locked:i}=this;i&&h(n)?this.unlock():("commit-and-exit"===e&&!i||null!=n)&&this._parseInputAndLock(t)}_onCommitNonLockable(e){const{inputValue:t}=this;h(t)?this.setActual(null):null!=t&&this._parseInputAndSetActual(e)}applyValue(e){this.lockable?this.lock(e):this.setActual(e)}clearInputValue(){this.inputValue=null,this.invalid=!1}setActual(e){this.actual=e,this.clearInputValue()}lock(e){this.lockable&&(this.committed=e??this.actual,this.clearInputValue())}unlock(){this.lockable&&(this.committed=null,this.clearInputValue())}toggleLock(e){this.lockable&&(this.locked?this.unlock():this._parseInputAndLock(e))}getSuffix(e){const{suffix:t}=this;return"function"==typeof t?t(e):t}getFormattedValue(e){const{actual:t,committed:n,format:i}=this;return null!=n?i(n,e):null!=t?i(t,e):null}getRawDisplayValue(e){const{actual:t,committed:n,inputValue:i}=this;return null!=i?i:this.lockable&&null!=n?this.formatForInputMode(n,e):null!=t?this.formatForInputMode(t,e):null}_parseInputAndSetActual(e){const{inputValue:t}=this;if(null==t||h(t))return this.setActual(null);const n=this.parse(t,e);null!=n?this.setActual(n):this.invalid=!0}_parseInputAndLock(e){const{inputValue:t,actual:n}=this;if(h(t))return this.unlock();if(null==t)return this.lock(n);const i=this.parse(t,e);null!=i?this.lock(i):this.invalid=!0}};function h(e){return null!=e&&""===e.trim()}(0,s._)([(0,l.MZ)()],u.prototype,"actual",void 0),(0,s._)([(0,l.MZ)()],u.prototype,"committed",null),(0,s._)([(0,l.MZ)()],u.prototype,"dirty",null),(0,s._)([(0,l.MZ)()],u.prototype,"format",void 0),(0,s._)([(0,l.MZ)()],u.prototype,"formatForInputMode",void 0),(0,s._)([(0,l.MZ)()],u.prototype,"lockable",void 0),(0,s._)([(0,l.MZ)()],u.prototype,"locked",null),(0,s._)([(0,l.MZ)()],u.prototype,"id",void 0),(0,s._)([(0,l.MZ)()],u.prototype,"inputValue",void 0),(0,s._)([(0,l.MZ)()],u.prototype,"name",void 0),(0,s._)([(0,l.MZ)()],u.prototype,"parse",void 0),(0,s._)([(0,l.MZ)()],u.prototype,"readOnly",void 0),(0,s._)([(0,l.MZ)()],u.prototype,"suffix",void 0),(0,s._)([(0,l.MZ)()],u.prototype,"title",void 0),(0,s._)([(0,l.MZ)()],u.prototype,"visible",void 0),(0,s._)([(0,l.MZ)()],u.prototype,"invalid",void 0),(0,s._)([(0,l.MZ)()],u.prototype,"unlockOnVertexPlacement",void 0),u=(0,s._)([(0,c.$)("esri.views.interactive.tooltip.fields.TooltipField")],u);let d=class extends u{constructor(e){super(e),this.showAsZ=!1}normalizeCtorArgs(e){const t=e=>e.inputUnitInfos.verticalLength.unit;return{name:"elevation",actual:i.r7,parse:(0,r.hw)(((e,n)=>(0,i.d_)(e,t(n)))),format:(e,t)=>t.formatters.verticalLength(e),formatForInputMode:(e,n)=>n.formatters.scalar((0,i.kM)(e,t(n))),suffix:e=>e.inputUnitInfos.verticalLength.abbreviation,title:e=>e.messages.sketch[this.showAsZ?"z":"elevation"],unlockOnVertexPlacement:!1,...e}}};(0,s._)([(0,l.MZ)()],d.prototype,"showAsZ",void 0),d=(0,s._)([(0,c.$)("esri.views.interactive.tooltip.fields.TooltipFieldElevation")],d);var p=n(88226),f=n(99675);let m=class extends u{constructor(e){super(e),this.precision=1}normalizeCtorArgs(e){return{name:"orientation",actual:null,parse:(0,r.hw)(((e,t)=>(0,i.Wq)(e,(e=>e.inputUnitInfos.orientation.unit)(t),"geographic"))),format:e=>{const t=(0,f.P1)(e);return(0,p.Nk)(t,"geographic",this.precision)},formatForInputMode:(e,t)=>{const n=(0,f.P1)(e);return t.formatters.scalar(n)},suffix:e=>e.inputUnitInfos.orientation.abbreviation,title:e=>e.messages.sketch.orientation,...e}}};function g(e){const t=e=>e.inputUnitInfos.direction.unit,n=e=>e.sketchOptions.values.effectiveDirectionMode;return new u({name:"direction",actual:i.IV,parse:(0,r.hw)(((e,n)=>(0,i.Wq)(e,t(n),"geographic"))),format:(e,t)=>{const i=n(t),r=(0,f.jQ)(e,i);switch(i){case f.rZ.Absolute:return t.formatters.direction(r);case f.rZ.Relative:return t.formatters.directionRelative(r);case f.rZ.RelativeBilateral:return t.formatters.directionRelativeBilateral(r)}},formatForInputMode:(e,r)=>{const s=(0,f.jQ)(e,n(r));return r.formatters.scalar((0,i.kM)(s,t(r)))},suffix:e=>e.inputUnitInfos.direction.abbreviation,title:e=>{const t=n(e),{absolute:i,relative:r}=e.messages.sketch.direction;switch(t){case f.rZ.Absolute:return i;case f.rZ.Relative:case f.rZ.RelativeBilateral:return r}},...e})}function _(e){const t=e=>e.inputUnitInfos.length.unit;return new u({name:"distance",actual:i.r7,parse:(0,r.hw)(((e,n)=>(0,i.d_)(Math.max(e,0),t(n)))),format:(e,t)=>t.formatters.length(e),formatForInputMode:(e,n)=>n.formatters.scalar((0,i.kM)(e,t(n))),suffix:e=>e.inputUnitInfos.length.abbreviation,title:e=>e.messages.sketch.distance,...e})}function v(){return _({format:(e,t)=>t.formatters.totalLength(e),title:e=>e.messages.sketch.totalLength,readOnly:!0})}function y(e){return new d(e)}function b(e){return new m(e)}function T(e){return M("scale",{name:"scale",actual:null,parse:(0,r.hw)((e=>(0,i.LF)(Math.abs(e)))),...e})}function E(e){const t=e=>e.inputUnitInfos.area.unit;return new u({name:"area",actual:i.iT,parse:(0,r.hw)(((e,n)=>(0,i.gT)(e,t(n)))),format:(e,t)=>t.formatters.area(e),formatForInputMode:(e,n)=>n.formatters.scalar((0,i.kM)(e,t(n))),suffix:e=>e.inputUnitInfos.area.abbreviation,title:e=>e.messages.sketch.area,readOnly:!0,...e})}function x(e){return new u({name:"x",actual:i.IV,parse:r.L5,format:(e,t)=>t.formatters.longitudeDecimalDegrees(e),formatForInputMode:e=>(0,r.zX)(e),suffix:e=>e.inputUnitInfos.longitudeLatitude.abbreviation,title:e=>e.messages.sketch.longitude,...e})}function S(e){return new u({name:"y",actual:i.IV,parse:r.A3,format:(e,t)=>t.formatters.latitudeDecimalDegrees(e),formatForInputMode:e=>(0,r.oZ)(e),suffix:e=>e.inputUnitInfos.longitudeLatitude.abbreviation,title:e=>e.messages.sketch.latitude,...e})}function w(e){return M("x",{name:"x",...e})}function A(e){return M("y",{name:"y",...e})}function M(e,t){return new u({actual:(0,i.LF)(0),parse:(0,r.hw)((e=>(0,i.LF)(e))),format:(e,t)=>t.formatters.scalar(e),formatForInputMode:(e,t)=>t.formatters.scalar(e),title:t=>t.messages.sketch[e],...t})}(0,s._)([(0,l.MZ)()],m.prototype,"precision",void 0),m=(0,s._)([(0,c.$)("esri.views.interactive.tooltip.fields.TooltipFieldOrientation")],m)},49634:function(e,t,n){"use strict";n.d(t,{A3:function(){return D},GC:function(){return h},L5:function(){return P},Nr:function(){return R},X3:function(){return I},hw:function(){return A},m6:function(){return L},oZ:function(){return y},zX:function(){return v}});var i=n(16691),r=n(88226),s=n(56275),o=n(6338),a=n(2900),l=n(99675);const c=1,u=6;function h(e,t){return{angleRelative:d,direction:p,directionRelative:f,directionRelativeBilateral:m,latitudeDecimalDegrees:_,longitudeDecimalDegrees:g,area:(n,i)=>(0,r.Jd)(e,n,i??t.area),length:(n,i,s)=>(0,r.ix)(e,n,i??t.length,s),lengthRelative:(n,i)=>(0,r.yh)(e,n,i??t.length),totalLength:(n,i)=>(0,r.ix)(e,n,i??t.length),verticalLength:(n,i)=>(0,r.Oo)(e,n,i??t.length),verticalLengthRelative:(n,i)=>(0,r.OM)(e,n,i??t.verticalLength),percentage:E,scalar:S,scale:x}}function d(e){return(0,a.ZV)(e,{signDisplay:"exceptZero",...w(c)})}function p(e){return(0,r.Nk)(e,e.rotationType,c)}function f(e){const t=(0,l.hF)(e);return(0,a.ZV)(t,{style:"unit",unitDisplay:"narrow",unit:"degree",signDisplay:t>0?"never":"exceptZero",...w(c)})}function m(e){return(0,r.Nk)(e,e.rotationType,c)}function g(e){return b(e,N)}function _(e){return b(e,F)}function v(e){return T(e,N)}function y(e){return T(e,F)}function b(e,t){return(0,r.Nk)((0,s.kM)(e,"degrees"),"geographic",u,t,!1)}function T(e,t){const n=t.normalize((0,s.kM)(e,"degrees").value,void 0,!1);return S((0,s.LF)(n),u)}function E(e){return(0,a.ZV)(e.value,{style:"percent"})}function x(e){return(0,a.ZV)(e,{style:"percent",maximumFractionDigits:0})}function S(e,t){return(0,a.ZV)(e.value,w(t))}function w(e){return{minimumFractionDigits:e,maximumFractionDigits:e}}function A(e){return(t,n)=>{const i=(0,a.$J)(t);return null!=i?e(i,n):null}}const M=e=>{let t=`[-+]?[0-9${e.thousands}]+`;return""!==e.decimal&&(t+=`${e.decimal}[0-9]+`),new RegExp(`^(${t}\\s*)${e.separator}(\\s*${t})$`,"i")},O=[];for(const e of[",","\\|","\\s+"])for(const t of["\\.",",",""])for(const n of["",",","\\."," ","\\s+"])e!==t&&e!==n&&t!==n&&O.push({separator:e,decimal:t,thousands:n,pattern:M({decimal:t,thousands:n,separator:e})});function R(e){for(const{decimal:t,thousands:n,pattern:i}of O){i.lastIndex=0;const r=e.match(i);if(!r)continue;const o=(0,a.$J)(C(r[1],t,n)),l=(0,a.$J)(C(r[2],t,n));if(null!=o&&null!=l)return{x:(0,s.LF)(o),y:(0,s.LF)(l)}}return null}function C(e,t,n){let i=e.replaceAll(/[\s+]/g,"");return""!==n&&(i=i.replaceAll(n,"")),""!==t&&(i=i.replaceAll(t,".")),i}function I(e){if(!e||null!=(0,a.$J)(e)||!(0,o.s1)())return null;const t=(0,o.o6)(e),n=L(t?.latitude),i=L(t?.longitude);return null!=i&&null!=n?{latitude:n,longitude:i}:null}function P(e){return L((0,o.mT)(e))}function D(e){return L((0,o.ts)(e))}function L(e){return null!=e?(0,s.Wq)(e,"degrees","geographic"):null}const N=new i.hr(-180,180),F=new i.hr(-90,90)},60403:function(e,t,n){"use strict";n.d(t,{d:function(){return a}});var i=n(53804),r=n(23502),s=(n(58941),n(40633),n(13798),n(65953)),o=n(90858);let a=class extends o.w{constructor(e){super(e),this.type="extent-rotate",this.angle=0}};(0,i._)([(0,r.MZ)()],a.prototype,"type",void 0),(0,i._)([(0,r.MZ)()],a.prototype,"angle",void 0),a=(0,i._)([(0,s.$)("esri.views.interactive.tooltip.infos.ExtentRotateTooltipInfo")],a)},96632:function(e,t,n){"use strict";n.d(t,{c:function(){return l}});var i=n(53804),r=n(56275),s=n(23502),o=(n(58941),n(40633),n(13798),n(65953)),a=n(90858);let l=class extends a.w{constructor(e){super(e),this.type="extent-scale",this.xScale=0,this.yScale=0,this.xSize=r.r7,this.ySize=r.r7}};(0,i._)([(0,s.MZ)()],l.prototype,"type",void 0),(0,i._)([(0,s.MZ)()],l.prototype,"xScale",void 0),(0,i._)([(0,s.MZ)()],l.prototype,"yScale",void 0),(0,i._)([(0,s.MZ)()],l.prototype,"xSize",void 0),(0,i._)([(0,s.MZ)()],l.prototype,"ySize",void 0),l=(0,i._)([(0,o.$)("esri.views.interactive.tooltip.infos.ExtentScaleTooltipInfo")],l)},18945:function(e,t,n){"use strict";n.d(t,{F:function(){return l}});var i=n(53804),r=n(23502),s=(n(58941),n(40633),n(13798),n(65953)),o=n(90858),a=n(73919);let l=class extends((0,a.B)(o.w)){constructor(e){super(e),this.type="move-point",this.allFields.forEach((e=>{e.lockable=!1,e.setActual(null)}))}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};(0,i._)([(0,r.MZ)()],l.prototype,"allFields",null),l=(0,i._)([(0,s.$)("esri.views.interactive.tooltip.infos.MovePointTooltipInfo")],l)},83931:function(e,t,n){"use strict";n.d(t,{d:function(){return c}});var i=n(53804),r=n(23502),s=(n(58941),n(40633),n(13798),n(65953)),o=n(18063),a=n(90858),l=n(73919);let c=class extends((0,l.B)(a.w)){constructor(e){super(e),this.type="selected-vertex",this.area=(0,o.Am)(),this.totalLength=(0,o.fr)(),this.geometryType="polyline",this.allFields.forEach((e=>{e.lockable=!1,e.setActual(null)}))}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,"polygon"===this.geometryType?this.area:this.totalLength]}};(0,i._)([(0,r.MZ)()],c.prototype,"geometryType",void 0),(0,i._)([(0,r.MZ)()],c.prototype,"allFields",null),c=(0,i._)([(0,s.$)("esri.views.interactive.tooltip.infos.SelectedVertexTooltipInfo")],c)},90858:function(e,t,n){"use strict";n.d(t,{w:function(){return a}});var i=n(53804),r=n(83525),s=n(23502),o=(n(58941),n(40633),n(13798),n(65953));let a=class extends r.A{constructor(e){super(e),this.helpMessage=void 0,this.viewType=void 0}get visibleElements(){return this.sketchOptions.tooltips.visibleElements}get allFields(){return[]}get editableFields(){return this.allFields.filter((e=>e.visible&&!e.readOnly))}clearInputValues(){this.allFields.forEach((e=>e.clearInputValue()))}};(0,i._)([(0,s.MZ)()],a.prototype,"sketchOptions",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"visibleElements",null),(0,i._)([(0,s.MZ)()],a.prototype,"helpMessage",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"viewType",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"allFields",null),(0,i._)([(0,s.MZ)()],a.prototype,"editableFields",null),a=(0,i._)([(0,o.$)("esri.views.interactive.tooltip.infos.SketchTooltipInfo")],a)},73919:function(e,t,n){"use strict";n.d(t,{B:function(){return h}});var i=n(53804),r=n(56275),s=n(23502),o=(n(58941),n(40633),n(13798),n(65953)),a=n(74471),l=n(18063),c=n(49634),u=n(99368);const h=e=>{let t=class extends e{constructor(){super(...arguments),this.longitude=(0,l.em)(),this.latitude=(0,l.fL)(),this.x=(0,l.Hw)(),this.y=(0,l.uf)(),this.elevation=(0,l.S3)(),this.geographic=!1}get effectiveX(){return this.geographic?this.longitude:this.x}get effectiveY(){return this.geographic?this.latitude:this.y}get key(){return{longitude:this.longitude.actual,latitude:this.latitude.actual,x:this.x.actual,y:this.y.actual,elevation:this.elevation.actual,geographic:this.geographic}}setLocationFromPoint(e,t=e?.spatialReference){if(this.geographic=!!t&&(0,u.yF)(t),null==e)return this._setActualLonLat(null,null),void this._setActualXY(null,null);if(this.geographic){const t=(0,a.QP)(e,d);this._setActualLonLat((0,c.m6)(t?.[0]),(0,c.m6)(t?.[1]))}else this._setActualXY((0,r.LF)(e.x),(0,r.LF)(e.y))}_setActualLonLat(e,t){this.longitude.actual=e,this.latitude.actual=t}_setActualXY(e,t){this.x.actual=e,this.y.actual=t}};return(0,i._)([(0,s.MZ)()],t.prototype,"geographic",void 0),(0,i._)([(0,s.MZ)()],t.prototype,"effectiveX",null),(0,i._)([(0,s.MZ)()],t.prototype,"effectiveY",null),(0,i._)([(0,s.MZ)()],t.prototype,"key",null),t=(0,i._)([(0,o.$)("esri.views.interactive.tooltip.infos.TooltipInfoWithCoordinates")],t),t},d=[0,0]},94492:function(e,t,n){"use strict";n.d(t,{M:function(){return l}});var i=n(53804),r=n(56275),s=n(23502),o=(n(58941),n(40633),n(13798),n(65953)),a=n(90858);let l=class extends a.w{constructor(e){super(e),this.type="translate",this.distance=r.r7}clear(){this.distance=r.r7}};(0,i._)([(0,s.MZ)()],l.prototype,"type",void 0),(0,i._)([(0,s.MZ)()],l.prototype,"distance",void 0),l=(0,i._)([(0,o.$)("esri.views.interactive.tooltip.infos.TranslateTooltipInfo")],l)},77664:function(e,t,n){"use strict";n.d(t,{HA:function(){return M},IA:function(){return y},Ue:function(){return v},mu:function(){return b},sZ:function(){return A},wG:function(){return w}});var i=n(77472),r=n(61226),s=n(15774),o=n(56275),a=n(62938),l=n(20551),c=n(32501),u=n(6338),h=(n(45532),n(36405)),d=n(67376),p=n(57652),f=n(1644),m=n(37578),g=n(49634),_=n(99675);function v(e,t){const n=(0,d.Hq)(t.vertexSpace),{scale:i,orientation:r}=e,{transform:s}=t,a=function(e){if(!e)return 0;const t=E(e.rotationAxis);return null!=t?t*e.rotationAngle:null}(s);n&&null!=a?(r.actual=(0,o.Wq)(a,"degrees","arithmetic"),r.visible=!0):(r.actual=null,r.visible=!1),n?(i.actual=(0,o.LF)(S(s)),i.visible=!0):(i.actual=null,i.visible=!1)}function y(e,t,n){if(!t||!(0,d.Hq)(t.vertexSpace))return;const i=t.transform??=new h.A,{rotationAngle:r,rotationAxis:s}=i,o=(0,_.Ef)(e.orientation.actual),a=E(s);if(null!=o&&null!=a&&o!==r){n?.onRotateStart?.(r);const e=o*a;i.rotationAngle=e,n?.onRotate?.(e),n?.onRotateStop?.(e)}const u=e.scale.actual?.value,p=S(i);if(null!=u&&u!==p){const{scale:e}=i;let t;if(n?.onScaleStart?.(e[0],e[1],e[2]),0===p)t=(0,c.o8)(c.Un);else{const n=u/p;t=(0,l.j)((0,c.vt)(),e,n)}i.scale=t,n?.onScale?.(t[0],t[1],t[2]),n?.onScaleStop?.(t[0],t[1],t[2])}}function b(e,t){const{x:n,y:i,z:r}=t,{x:l,y:c,z:u}=function(e,t){let n,i,r;if(e.geographic){n=(0,_.hF)(e.longitude.actual),i=(0,_.hF)(e.latitude.actual),(0,p.K8)(t)&&(null!=n&&null!=i?[n,i]=(0,f.je)(n,i,T):null!=n?n=(0,f.je)(n,0,T)[0]:null!=i&&(i=(0,f.je)(0,i,T)[1]));const s=e.elevation.actual,l=(0,a.mq)(t);r=null!=l&&null!=s?(0,o.l3)(s,l):void 0}else n=e.x.actual?.value,i=e.y.actual?.value,r=e.elevation.actual?.value;return{x:n,y:i,z:r}}(e,t.spatialReference);return{dx:null==l||(0,s.Io)(l,n)?0:l-n,dy:null==c||(0,s.Io)(c,i)?0:c-i,dz:null==u||null==r||(0,s.Io)(u,r)?0:u-r}}const T=[0,0];function E(e){return(0,l.G)(e,c.Cb)?1:(0,l.G)(e,x)?-1:null}const x=(0,l.k)((0,c.vt)(),c.Cb);function S(e){return e?Math.max(...e.scale):1}function w(e,t){return!("key-down"!==e.type||e.key!==m.ac.enterInputMode||!t||!function(e){const t=e?.sketchOptions;if(!t)return!1;const{inputEnabled:n,visibleElements:i}=t.tooltips;return n&&!0===e.editableFields.some((({name:e})=>"x"===e||"y"===e?i.coordinates:i[e]))}(t.info)||(t.enterInputMode(),e.stopPropagation(),0))}function A(e){let t=null;return(0,r.vE)([e.on("paste",(async n=>{t?.abort(),t=(0,i.UT)((async()=>{(0,u.s1)()||await(0,u.Hh)(),M(n,e.info)}))})),(0,i.UT)((()=>(0,u.Hh)())),(0,r.hA)((()=>t?.abort()))])}function M(e,t){if(!t||!("geographic"in t))return;const n=e.clipboardData?.getData("text");if(n)if(t.geographic){const i=(0,g.X3)(n);i&&(t.longitude.applyValue(i.longitude),t.latitude.applyValue(i.latitude),e.stopPropagation(),e.preventDefault())}else{const i=(0,g.Nr)(n);i&&(t.x.applyValue(i.x),t.y.applyValue(i.y),e.stopPropagation(),e.preventDefault())}}},81197:function(e,t,n){"use strict";var i;n.d(t,{M:function(){return i}}),function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"}(i||(i={}))},48961:function(e,t,n){"use strict";n.d(t,{Bb:function(){return M},W6:function(){return i},nu:function(){return O}});var i,r,s=n(14606),o=(n(58941),n(40633)),a=n(95929),l=n(69739),c=n(7187),u=n(60539),h=n(28181),d=n(85445),p=n(38504),f=n(47558),m=n(16164),g=n(81197),_=n(55213);(r=i||(i={})).RESOURCE_CONTROLLER_IMMEDIATE="immediate",r.RESOURCE_CONTROLLER="schedule",r.SLIDE="slide",r.STREAM_DATA_LOADER="stream loader",r.ELEVATION_QUERY="elevation query",r.TERRAIN_SURFACE="terrain",r.SURFACE_GEOMETRY_UPDATES="surface geometry updates",r.LOD_RENDERER="LoD renderer",r.GRAPHICS_CORE="Graphics3D",r.I3S_CONTROLLER="I3S",r.POINT_CLOUD_LAYER="point cloud",r.FEATURE_TILE_FETCHER="feature fetcher",r.OVERLAY="overlay",r.STAGE="stage",r.GRAPHICS_DECONFLICTOR="graphics deconflictor",r.FILTER_VISIBILITY="Graphics3D filter visibility",r.SCALE_VISIBILITY="Graphics3D scale visibility",r.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",r.POINT_OF_INTEREST_FREQUENT="POI frequent",r.POINT_OF_INTEREST_INFREQUENT="POI infrequent",r.LABELER="labeler",r.FEATURE_QUERY_ENGINE="feature query",r.FEATURE_TILE_TREE="feature tile tree",r.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",r.ELEVATION_ALIGNMENT="elevation alignment",r.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",r.TEXT_TEXTURE_ATLAS="text texture atlas",r.TEXTURE_UNLOAD="texture unload",r.LINE_OF_SIGHT_TOOL="line of sight tool",r.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",r.ELEVATION_PROFILE="elevation profile",r.SNAPPING="snapping",r.SHADOW_ACCUMULATOR="shadow accumulator",r.CLOUDS_GENERATOR="clouds generator",r[r.NONE=0]="NONE",r[r.TEST_PRIO=1]="TEST_PRIO";const v=new Map([[i.RESOURCE_CONTROLLER_IMMEDIATE,0],[i.RESOURCE_CONTROLLER,4],[i.SLIDE,0],[i.STREAM_DATA_LOADER,0],[i.ELEVATION_QUERY,0],[i.TERRAIN_SURFACE,1],[i.SURFACE_GEOMETRY_UPDATES,1],[i.LOD_RENDERER,2],[i.GRAPHICS_CORE,2],[i.I3S_CONTROLLER,2],[i.POINT_CLOUD_LAYER,2],[i.FEATURE_TILE_FETCHER,2],[i.OVERLAY,4],[i.STAGE,4],[i.GRAPHICS_DECONFLICTOR,4],[i.FILTER_VISIBILITY,4],[i.SCALE_VISIBILITY,4],[i.FRUSTUM_VISIBILITY,4],[i.CLOUDS_GENERATOR,4],[i.POINT_OF_INTEREST_FREQUENT,6],[i.POINT_OF_INTEREST_INFREQUENT,30],[i.LABELER,8],[i.FEATURE_QUERY_ENGINE,8],[i.FEATURE_TILE_TREE,16],[i.FEATURE_TILE_TREE_ACTIVE,0],[i.ELEVATION_ALIGNMENT,12],[i.ELEVATION_ALIGNMENT_SCENE,14],[i.TEXT_TEXTURE_ATLAS,12],[i.TEXTURE_UNLOAD,12],[i.LINE_OF_SIGHT_TOOL,16],[i.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[i.SNAPPING,0],[i.SHADOW_ACCUMULATOR,30]]);function y(e){return v.has(e)?v.get(e):"number"==typeof e?e:1}const b=(0,p.l5)(6.5),T=(0,p.l5)(1),E=(0,p.l5)(30),x=(0,p.l5)(1e3/30),S=(0,p.l5)(100);var w,A;!function(e){e.Scheduler=class{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some((e=>e.needsUpdate))}constructor(){this._updating=(0,d.v)(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new l.A("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new n,this._state=g.M.INTERACTING,this._tasks=new c.A,this._runQueue=new c.A,this._load=0,this._idleStateCallbacks=new c.A,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=(0,h.watch)((()=>m.A.SCHEDULER_LOG_SLOW_TASKS),(e=>this._debug=e),h.Vh);for(const e of Object.keys(i))this.performanceInfo.tasks.set(i[e],new l.A(i[e]))}destroy(){this._tasks.toArray().forEach((e=>e.remove())),this._tasks.clear(),(0,a.xt)(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(e){this._updatingChanged(),e&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask((()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())})))}registerTask(e,n){const i=new t(this,e,n);return this._tasks.push(i),this._updatingChanged(),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new l.A(e)),i}registerIdleStateCallbacks(e,t){const n={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(n),this.state===g.M.IDLE&&this._idleUpdatesStartFired&&n.idleBegin();const i=this;return{remove:()=>this._removeIdleStateCallbacks(n),set idleBegin(e){i._idleUpdatesStartFired&&(n.idleEnd(),i._state===g.M.IDLE&&e()),n.idleBegin=e},set idleEnd(e){n.idleEnd=e}}}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,this.state!==g.M.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}get state(){return this._state}updateBudget(e){++this._frameNumber;let t=b,n=e.frameDuration,i=T;switch(this.state){case g.M.IDLE:t=(0,p.l5)(0),n=(0,p.l5)(Math.max(S,e.frameDuration)),i=E;break;case g.M.INTERACTING:n=(0,p.l5)(Math.max(x,e.frameDuration));case g.M.ANIMATING:}return n=(0,p.l5)(n-e.elapsedFrameTime-t),this.state!==g.M.IDLE&&n<T&&!this._forceTask?(this._forceTask=!0,!1):(n=(0,p.l5)(Math.max(n,i)),this._budget.reset(n,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case g.M.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case g.M.INTERACTING:this._runInteracting();break;default:this._runAnimating()}}stopFrame(){this._budget.reset((0,p.l5)(0),this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}removeTask(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e),this._updatingChanged()}_updateTask(e){this._tasks.forAll((t=>{t.name===e&&t.setPriority(e)}))}_getState(e){if(this._runQueue.some((t=>t.name===e)))return A.SCHEDULED;let t=A.IDLE;return this._tasks.forAll((n=>{n.name===e&&n.needsUpdate&&(n.schedulePriority<=1?t=A.READY:t!==A.READY&&(t=A.WAITING))})),t}_getRuntime(e){let t=0;return this._tasks.forAll((n=>{n.name===e&&(t+=n.runtime)})),t}_resetRuntimes(){this._tasks.forAll((e=>e.runtime=0))}_getRunning(){const e=new Map;if(this._tasks.forAll((t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;let t="";return e.forEach(((e,n)=>{t+=e>1?` ${e}x ${n}`:` ${n}`})),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce(((e,t)=>t.needsUpdate?++e:e),0);this._load=.9*this._load+e*(1-.9)}_schedule(){for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1))),this._tasks.forAll((e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.includes(e)&&e.blockFrame!==this._frameNumber&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forAll((n=>{n.needsUpdate&&0!==n.schedulePriority&&0!==n.basePriority&&n.blockFrame!==this._frameNumber&&(e=!0,t=Math.max(t,n.basePriority),1===n.schedulePriority?(n.schedulePriority=0,this._runQueue.push(n)):--n.schedulePriority)})),!e)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const e=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){const t=this._budget.now(),n=this._runQueue.pop();this._budget.resetProgress();try{n.task.runTask(this._budget)===_.G&&(n.blockFrame=this._frameNumber)}catch(e){o.A.getLogger("esri.views.support.Scheduler").error(`Exception in task "${n.name}"`,e),n.blockFrame=this._frameNumber}!this._budget.hasProgressed&&n.blockFrame!==this._frameNumber&&n.needsUpdate&&(n.name,i.I3S_CONTROLLER,n.blockFrame=this._frameNumber),n.schedulePriority=n.basePriority;const r=this._budget.now()-t;if(n.runtime+=r,this._frameTaskTimes.set(n.priority,this._frameTaskTimes.get(n.priority)+r),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-e)}}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-e)}_startFrameTaskTimes(){for(const e of Object.keys(i))this._frameTaskTimes.set(i[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach(((e,t)=>this.performanceInfo.tasks.get(t).record(e))),this.performanceInfo.total.record(e)}get test(){}};class t{get task(){return this._task.value}get updating(){return this._queue.running}constructor(e,t,n){this._scheduler=e,this.name=t,this.blockFrame=0,this.runtime=0,this._queue=new f.T,this._handles=new s.A,this._basePriority=y(t),this.schedulePriority=this._basePriority,this._task=(0,d.v)(null!=n?n:this._queue),this._handles.add((0,h.when)((()=>this.task.running),(t=>e.taskRunningChanged(t))))}remove(){this.processQueue(M),this._scheduler.removeTask(this),this.schedule=O.schedule,this.reschedule=O.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(e){if(this.name===e)return;this.name=e;const t=y(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.updating||this.task.running}schedule(e,t,n){return this._queue.push(e,t,n)}reschedule(e,t,n){return this._queue.unshift(e,t,n)}processQueue(e){return this._queue.runTask(e)}}class n{constructor(){this._begin="undefined"!=typeof performance?performance.now():0,this._budget=0,this._state=g.M.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e,t){this._begin=this.now(),this._budget=e,this._state=t,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}e.Budget=n}(w||(w={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(A||(A={}));const M=(()=>{const e=new w.Budget;return e.enabled=!1,e})(),O=new class{remove(){}processQueue(){}schedule(e,t,n){try{if((0,u.G4)(t)){const e=(0,u.NK)();return n?Promise.resolve(n(e)):Promise.reject(e)}return(0,u.z7)(e(M))}catch(e){return Promise.reject(e)}}reschedule(e,t,n){return this.schedule(e,t,n)}}},55213:function(e,t,n){"use strict";n.d(t,{G:function(){return i}});const i=Symbol("Yield")},70474:function(e,t,n){"use strict";n.d(t,{n:function(){return E}});var i=n(56275),r=n(62938),s=n(59122),o=n(20551),a=n(32501),l=n(68734),c=n(5596),u=n(67496),h=n(19271);function d(e,t,n=e.hasZ){const s=(0,h.l)(e.spatialReference),d=(0,r.B5)(s);if(null==d)return null;const g=(e,t)=>!(t.length<2||((0,o.s)(e,t[0],t[1],n&&t[2]||0),0));let _=0;for(const n of e.rings){const i=n.length;if(i<3)continue;const{positionsWorldCoords:r}=t;for(;r.length<i;)r.push((0,a.vt)());const h=p,d=(0,o.s)(f,0,0,0),v=1/i;for(let t=0;t<i;t++){if(!g(h,n[t]))return null;if(!(0,l.F)(h,e.spatialReference,r[t],s))return null;(0,o.r)(d,d,r[t],v)}const y=(0,c.Cr)(r[0],r[1],d,(0,c.LV)());if(0===(0,o.q)((0,c.Qj)(y)))continue;for(let e=0;e<i;e++)(0,c.Z1)(y,d,r[e],r[e]);const b=m(r);for(let e=0;e<b.length;e+=3)_+=(0,u.Fm)(r[b[e]],r[b[e+1]],r[b[e+2]])}return(0,i.gT)(_,d)}const p=(0,a.vt)(),f=(0,a.vt)();function m(e){return(0,s.e)(function(e){const t=new Float64Array(2*e.length);for(let n=0;n<e.length;++n){const i=e[n],r=2*n;t[r]=i[0],t[r+1]=i[1]}return t}(e),[],2)}var g=n(22162),_=n(57862),v=n(99368);function y(e){const{spatialReference:t}=e;return(0,v.M0)(t,b,T,e)}function b(e){return(0,i.gT)(Math.abs((0,_.qy)([e],"square-meters")[0]),"square-meters")}function T(e){try{return(0,i.gT)(Math.abs((0,g.geodesicArea)(e,"square-meters")),"square-meters")}catch(e){return null}}function E(e,t={positionsWorldCoords:[]}){return function(e,t,n={positionsWorldCoords:[]}){if("on-the-ground"===t){const t=y(e);return null!=t?t:function(e,t={positionsWorldCoords:[]}){return d(e,t,!1)}(e,n)}return function(e,t={positionsWorldCoords:[]}){return d(e,t)}(e,n)}(e,"on-the-ground",t)}},9862:function(e,t,n){"use strict";n.d(t,{Do:function(){return l},Kt:function(){return a},ob:function(){return o}});var i=n(32501),r=n(46517),s=n(1428);function o(e){return(0,s.mh)(e)??(0,r.Xg)(e)}function a(e,t){return(0,s.Og)(e,t)??(0,r.ll)(e,t)}function l(e,t,n){return c[0]=e[0],c[1]=e[1],c[2]=3===e.length?e[2]:0,u[0]=t[0],u[1]=t[1],u[2]=3===t.length?t[2]:0,(0,s.n3)(c,u,n)??(0,r.sT)(c,u,n)}const c=(0,i.vt)(),u=(0,i.vt)()},16164:function(e,t,n){"use strict";n.d(t,{A:function(){return l}});var i=n(53804),r=n(83525),s=n(23502),o=(n(58941),n(40633),n(13798),n(65953));let a=class extends r.A{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};(0,i._)([(0,s.MZ)()],a.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),a=(0,i._)([(0,o.$)("esri.views.support.debugFlags")],a);const l=new a},33383:function(e,t,n){"use strict";n.d(t,{V:function(){return o},t:function(){return a}}),n(50917);var i=n(62938),r=n(82418),s=n(91484);function o(e,t,n,r=new s.default){let o=0;if("2d"===n.type)o=t*(n.resolution??0);else if("3d"===n.type){const r=n.overlayPixelSizeInMapUnits(e),s=n.basemapSpatialReference;o=null==s||s.equals(n.spatialReference)?t*r:(0,i.GA)(s)/(0,i.GA)(n.spatialReference)}const a=e.x-o,l=e.y-o,c=e.x+o,u=e.y+o,{spatialReference:h}=n;return r.xmin=Math.min(a,c),r.ymin=Math.min(l,u),r.xmax=Math.max(a,c),r.ymax=Math.max(l,u),r.spatialReference=h,r}function a(e,t,n){const i=n.toMap(e);return null!=i&&o(i,(0,r.o)(),n,l).intersects(t)}const l=new s.default},46517:function(e,t,n){"use strict";n.d(t,{Of:function(){return m},Qc:function(){return g},Xg:function(){return d},cL:function(){return y},e5:function(){return f},ll:function(){return p},sT:function(){return v}});var i,r,s=n(56275),o=n(62938),a=n(20551),l=n(32501),c=n(68734),u=n(57652),h=n(19271);function d(e){return function(e,t){const{hasZ:n,spatialReference:r}=e,a=(0,h.l)(r);let l=0;const c=(0,o._H)(a);if(null==c)return null;const u=t===i.Direct?_:v;for(const t of e.paths){if(t.length<2)continue;const e=t.length-1;for(let i=0;i<e;++i){const e=t[i];T[0]=e[0],T[1]=e[1],T[2]=n?e[2]:0;const s=t[i+1];E[0]=s[0],E[1]=s[1],E[2]=n?s[2]:0;const o=u(T,E,r);if(null==o)return null;l+=o.value}}return(0,s.d_)(l,c)}(e,i.Horizontal)}function p(e,t){const{spatialReference:n}=e;return(0,u.aI)(n,t.spatialReference)?(T[0]=e.x,T[1]=e.y,T[2]=e.hasZ?e.z:0,E[0]=t.x,E[1]=t.y,E[2]=t.hasZ?t.z:0,v(T,E,n)):null}function f(e,t){const{spatialReference:n}=e;return(0,u.aI)(n,t.spatialReference)?(T[0]=e.x,T[1]=e.y,T[2]=e.hasZ?e.z:0,E[0]=t.x,E[1]=t.y,E[2]=t.hasZ?t.z:0,y(T,E,n)):null}function m(e){return null!=e?g(e.hasZ?e.z:0,e.spatialReference):null}function g(e,t){const n=(0,o.mq)(t);return null!=n?(0,s.d_)(e??0,n):null}function _(e,t,n){const r=b(e,t,n,i.Direct);return null!=r?(0,s.d_)(r.direct,r.unit):null}function v(e,t,n){const r=b(e,t,n,i.Horizontal);return null!=r?(0,s.d_)(r.horizontal,r.unit):null}function y(e,t,n){const r=b(e,t,n,i.Vertical);return null!=r?(0,s.d_)(r.verticalSigned,r.unit):null}function b(e,t,n,r){const s=(0,h.l)(n),l=(0,o._H)(s);if(null==l)return null;const u=t[2]-e[2];if(r===i.Vertical)return{verticalSigned:u,unit:l};if(!(0,c.F)(e,n,x,s)||!(0,c.F)(t,n,S,s))return null;if(r===i.Direct)return{direct:(0,a.p)(S,x),unit:l};if((0,a.s)(w,e[0],e[1],t[2]),!(0,c.F)(w,n,w,s))return null;const d=(0,a.p)(w,S);return r===i.Horizontal?{horizontal:d,unit:l}:{direct:(0,a.p)(S,x),horizontal:d,vertical:Math.abs(u),unit:l}}(r=i||(i={}))[r.Direct=0]="Direct",r[r.Horizontal=1]="Horizontal",r[r.Vertical=2]="Vertical";const T=(0,l.vt)(),E=(0,l.vt)(),x=(0,l.vt)(),S=(0,l.vt)(),w=(0,l.vt)()},16633:function(e,t,n){"use strict";n.d(t,{b:function(){return s}});var i=n(56275),r=n(9862);function s({topLeft:e,topRight:t,bottomRight:n,bottomLeft:s,spatialReference:o}){const a=(0,i.T9)((0,r.Do)(s,n,o),(0,r.Do)(e,t,o));if(null==a)return null;const l=(0,i.T9)((0,r.Do)(n,t,o),(0,r.Do)(s,e,o));return null==l?null:{xSize:a,ySize:l}}},19271:function(e,t,n){"use strict";n.d(t,{l:function(){return o}});var i=n(61714),r=n(96611),s=n(57652);function o(e){return(0,s.B3)(e)?(0,s.oT)(e)||(0,s.K8)(e)||(0,s.x1)(e)||(0,i.jA)(e)?r.Y0:e:(0,r.lO)(e)}},86305:function(e,t,n){"use strict";n.d(t,{g:function(){return c}});var i=n(50659),r=(n(58941),n(40633)),s=n(24540),o=n(41835),a=n(85456);const l=()=>r.A.getLogger("esri.views.webgl.BufferObject");class c{static createIndex(e,t,n){return new c(e,a.NZ.ELEMENT_ARRAY_BUFFER,t,n)}static createVertex(e,t,n){return new c(e,a.NZ.ARRAY_BUFFER,t,n)}static createUniform(e,t,n){return new c(e,a.NZ.UNIFORM_BUFFER,t,n)}static createPixelPack(e,t=a._U.STREAM_READ,n){const i=new c(e,a.NZ.PIXEL_PACK_BUFFER,t);return n&&i.setSize(n),i}static createPixelUnpack(e,t=a._U.STREAM_DRAW,n){return new c(e,a.NZ.PIXEL_UNPACK_BUFFER,t,n)}static createTransformFeedback(e,t=a._U.STATIC_DRAW,n){const i=new c(e,a.NZ.TRANSFORM_FEEDBACK_BUFFER,t);return i.setSize(n),i}constructor(e,t,n,i){this._context=e,this.bufferType=t,this.usage=n,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(a.vt.BufferObject,this),this._glName=this._context.gl.createBuffer(),(0,o.Y2)(this._context.gl),i&&this.setData(i)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){return this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER?this._indexType===a.pe.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER||this.bufferType===a.NZ.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(a.vt.BufferObject,this),this._context=null):this._glName&&l().warn("Leaked WebGL buffer object")}setSize(e,t=null){if(this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&null!=t)switch(this._indexType=t,t){case a.pe.UNSIGNED_SHORT:e*=2;break;case a.pe.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let t=e.byteLength;this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&((0,s.jq)(e)&&(t/=2,this._indexType=a.pe.UNSIGNED_SHORT),(0,s.XJ)(e)&&(t/=4,this._indexType=a.pe.UNSIGNED_INT)),this._setBufferData(t,e)}_setBufferData(e,t=null){this._size=e;const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const i=this._context.gl;null!=t?i.bufferData(this.bufferType,t,this.usage):i.bufferData(this.bufferType,e,this.usage),(0,o.Y2)(i),this._isVAOAware&&this._context.bindVAO(n)}setSubData(e,t,n,i){if(!e)return;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:s}=this._context;s.bufferSubData(this.bufferType,t*e.BYTES_PER_ELEMENT,e,n,i-n),(0,o.Y2)(s),this._isVAOAware&&this._context.bindVAO(r)}getSubData(e,t=0,n,r){if(n<0||r<0)return;const s=function(e){return(0,i.Xj)(e)}(e)?e.BYTES_PER_ELEMENT:1;if(s*((n??0)+(r??0))>e.byteLength)return;t+s*(r??0)>this.usedMemory&&l().warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this.bufferType===a.NZ.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,a.NZ.TRANSFORM_FEEDBACK_BUFFER),o.getBufferSubData(a.NZ.TRANSFORM_FEEDBACK_BUFFER,t,e,n,r),this._context.unbindBuffer(a.NZ.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,a.NZ.COPY_READ_BUFFER),o.getBufferSubData(a.NZ.COPY_READ_BUFFER,t,e,n,r),this._context.unbindBuffer(a.NZ.COPY_READ_BUFFER))}async getSubDataAsync(e,t=0,n,i){await this._context.clientWaitAsync(),this.getSubData(e,t,n,i)}}},69452:function(e,t,n){"use strict";var i;n.d(t,{p:function(){return i}}),function(e){e[e.Texture=0]="Texture",e[e.RenderBuffer=1]="RenderBuffer"}(i||(i={}))},78541:function(e,t,n){"use strict";n.d(t,{g:function(){return c}});var i=n(39819),r=(n(58941),n(41835)),s=n(85456),o=n(69452),a=n(10956);class l extends a.R{constructor(e,t){switch(super(),this.context=e,Object.assign(this,t),this.internalFormat){case s.H0.R16F:case s.H0.R16I:case s.H0.R16UI:case s.H0.R32F:case s.H0.R32I:case s.H0.R32UI:case s.H0.R8_SNORM:case s.H0.R8:case s.H0.R8I:case s.H0.R8UI:this.pixelFormat=s.Ab.RED}}static validate(e,t){return new l(e,t)}}let c=class e{constructor(e,t=null,n=null){if(this.type=o.p.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,n=t;else{const n=l.validate(e,t);if(!n)throw new i.A("Texture descriptor invalid");this._descriptor=n}this._descriptor.target===s.Ap.TEXTURE_CUBE_MAP?this._setDataCubeMap(n):this.setData(n)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return(0,a.e)(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._glName&&this._descriptor.context.instanceCounter.decrement(s.vt.Texture,this),this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(e,t){const n=this._descriptor;if(n.width!==e||n.height!==t){if(this._wasImmutablyAllocated)throw new i.A("Immutable textures can't be resized!");n.width=e,n.height=t,this._descriptor.target===s.Ap.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let t=s.Ap.TEXTURE_CUBE_MAP_POSITIVE_X;t<=s.Ap.TEXTURE_CUBE_MAP_NEGATIVE_Z;t++)this._setData(e,t)}setData(e){this._setData(e)}_setData(t,n){if(!this._descriptor.context?.gl)return;const o=this._descriptor.context.gl;(0,r.Y2)(o),this._glName||(this._glName=o.createTexture(),this._glName&&this._descriptor.context.instanceCounter.increment(s.vt.Texture,this)),void 0===t&&(t=null);const a=this._descriptor,l=n??a.target,c=m(l);null===t&&(a.width=a.width||4,a.height=a.height||4,c&&(a.depth=a.depth??1));const _=this._descriptor.context.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),u(a),this._configurePixelStorage(),(0,r.Y2)(o);const v=this._deriveInternalFormat();if(f(t)){let e="width"in t?t.width:t.codedWidth,n="height"in t?t.height:t.codedHeight;const i=1;t instanceof HTMLVideoElement&&(e=t.videoWidth,n=t.videoHeight),a.width&&a.height,c&&a.depth,a.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(l,v,a.hasMipmap,e,n,i),this._texImage(l,0,v,e,n,i,t),(0,r.Y2)(o),a.hasMipmap&&this.generateMipmap(),a.width||(a.width=e),a.height||(a.height=n),c&&!a.depth&&(a.depth=i)}else{const{width:e,height:n,depth:u}=a;if(null==e||null==n)throw new i.A("Width and height must be specified!");if(c&&null==u)throw new i.A("Depth must be specified!");if(a.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(l,v,a.hasMipmap,e,n,u),p(t)){const r=t.levels,c=g(l,e,n,u),h=Math.min(c-1,r.length-1);o.texParameteri(a.target,this._descriptor.context.gl.TEXTURE_MAX_LEVEL,h);const d=v;if(!(d in s.CQ))throw new i.A("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel(((e,t,n,i)=>{const s=r[Math.min(e,r.length-1)];this._compressedTexImage(l,e,d,t,n,i,s)}),h)}else this._texImage(l,0,v,e,n,u,t),(0,r.Y2)(o),a.hasMipmap&&this.generateMipmap()}h(o,this._descriptor),d(o,this._descriptor),function(e,t){const n=e.capabilities.textureFilterAnisotropic;n&&e.gl.texParameterf(t.target,n.TEXTURE_MAX_ANISOTROPY,t.maxAnisotropy??1)}(this._descriptor.context,this._descriptor),(0,r.Y2)(o),this._descriptor.context.bindTexture(_,e.TEXTURE_UNIT_FOR_UPDATES)}updateData(t,n,r,s,o,a,l=0){a||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._descriptor,u=this._deriveInternalFormat(),{context:h,pixelFormat:d,dataType:m,target:g,isImmutable:_}=c;if(_&&!this._wasImmutablyAllocated)throw new i.A("Cannot update immutable texture before allocation!");const v=h.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES,!0);(n<0||r<0||n+s>c.width||r+o>c.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:y}=h;l&&y.pixelStorei(y.UNPACK_SKIP_ROWS,l),f(a)?y.texSubImage2D(g,t,n,r,s,o,d,m,a):p(a)?y.compressedTexSubImage2D(g,t,n,r,s,o,u,a.levels[t]):y.texSubImage2D(g,t,n,r,s,o,d,m,a),l&&y.pixelStorei(y.UNPACK_SKIP_ROWS,0),h.bindTexture(v,e.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(t,n,r,s,o,a,l,c){c||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const u=this._descriptor,h=this._deriveInternalFormat(),{context:d,pixelFormat:f,dataType:g,isImmutable:_,target:v}=u;if(_&&!this._wasImmutablyAllocated)throw new i.A("Cannot update immutable texture before allocation!");m(v)||console.warn("Attempting to set 3D texture data on a non-3D texture");const y=d.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);d.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),(n<0||r<0||s<0||n+o>u.width||r+a>u.height||s+l>u.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:b}=d;if(p(c))c=c.levels[t],b.compressedTexSubImage3D(v,t,n,r,s,o,a,l,h,c);else{const e=c;b.texSubImage3D(v,t,n,r,s,o,a,l,f,g,e)}d.bindTexture(y,e.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const t=this._descriptor;if(!t.hasMipmap){if(this._wasImmutablyAllocated)throw new i.A("Cannot add mipmaps to immutable texture after allocation");t.hasMipmap=!0,this._samplingModeDirty=!0,u(t)}t.samplingMode===s.Cj.LINEAR?(this._samplingModeDirty=!0,t.samplingMode=s.Cj.LINEAR_MIPMAP_NEAREST):t.samplingMode===s.Cj.NEAREST&&(this._samplingModeDirty=!0,t.samplingMode=s.Cj.NEAREST_MIPMAP_NEAREST);const n=this._descriptor.context.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(t.target),this._descriptor.context.bindTexture(n,e.TEXTURE_UNIT_FOR_UPDATES)}clearMipmap(){const e=this._descriptor;if(e.hasMipmap){if(this._wasImmutablyAllocated)throw new i.A("Cannot delete mipmaps to immutable texture after allocation");e.hasMipmap=!1,this._samplingModeDirty=!0,u(e)}e.samplingMode===s.Cj.LINEAR_MIPMAP_NEAREST?(this._samplingModeDirty=!0,e.samplingMode=s.Cj.LINEAR):e.samplingMode===s.Cj.NEAREST_MIPMAP_NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=s.Cj.NEAREST)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,u(this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._descriptor,t=e.context.gl;this._samplingModeDirty&&(h(t,e),this._samplingModeDirty=!1),this._wrapModeDirty&&(d(t,e),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(null!=this._descriptor.internalFormat)return this._descriptor.internalFormat===s.Ab.DEPTH_STENCIL&&(this._descriptor.internalFormat=s.Ab.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case s.ld.FLOAT:switch(this._descriptor.pixelFormat){case s.Ab.RGBA:return this._descriptor.internalFormat=s.H0.RGBA32F;case s.Ab.RGB:return this._descriptor.internalFormat=s.H0.RGB32F;default:throw new i.A("Unable to derive format")}case s.ld.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case s.Ab.RGBA:return this._descriptor.internalFormat=s.H0.RGBA8;case s.Ab.RGB:return this._descriptor.internalFormat=s.H0.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===s.Ab.DEPTH_STENCIL?s.Ab.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:t,flipped:n,preMultiplyAlpha:i}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,t),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,n?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i?1:0)}_texStorage(e,t,n,r,o,a){const{gl:l}=this._descriptor.context;if(!(t in s.H0))throw new i.A("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const c=n?g(e,r,o,a):1;if(m(e)){if(null==a)throw new i.A("Missing depth dimension for 3D texture upload");l.texStorage3D(e,c,t,r,o,a)}else l.texStorage2D(e,c,t,r,o);this._wasImmutablyAllocated=!0}_texImage(e,t,n,r,s,o,a){const l=this._descriptor.context.gl,c=m(e),{isImmutable:u,pixelFormat:h,dataType:d}=this._descriptor;if(u){if(null!=a){const n=a;if(c){if(null==o)throw new i.A("Missing depth dimension for 3D texture upload");l.texSubImage3D(e,t,0,0,0,r,s,o,h,d,n)}else l.texSubImage2D(e,t,0,0,r,s,h,d,n)}}else{const u=a;if(c){if(null==o)throw new i.A("Missing depth dimension for 3D texture upload");l.texImage3D(e,t,n,r,s,o,0,h,d,u)}else l.texImage2D(e,t,n,r,s,0,h,d,u)}}_compressedTexImage(e,t,n,r,s,o,a){const l=this._descriptor.context.gl,c=m(e);if(this._descriptor.isImmutable){if(null!=a)if(c){if(null==o)throw new i.A("Missing depth dimension for 3D texture upload");l.compressedTexSubImage3D(e,t,0,0,0,r,s,o,n,a)}else l.compressedTexSubImage2D(e,t,0,0,r,s,n,a)}else if(c){if(null==o)throw new i.A("Missing depth dimension for 3D texture upload");l.compressedTexImage3D(e,t,n,r,s,o,0,a)}else l.compressedTexImage2D(e,t,n,r,s,0,a)}_forEachMipmapLevel(e,t=1/0){let{width:n,height:r,depth:o,hasMipmap:a,target:l}=this._descriptor;const c=l===s.Ap.TEXTURE_3D;if(null==n||null==r||c&&null==o)throw new i.A("Missing texture dimensions for mipmap calculation");for(let i=0;e(i,n,r,o),a&&(1!==n||1!==r||c&&1!==o)&&!(i>=t);++i)n=Math.max(1,n>>1),r=Math.max(1,r>>1),c&&(o=Math.max(1,o>>1))}};function u(e){(null!=e.width&&e.width<0||null!=e.height&&e.height<0||null!=e.depth&&e.depth<0)&&console.error("Negative dimension parameters are not allowed!")}function h(e,t){let n=t.samplingMode,i=t.samplingMode;n===s.Cj.LINEAR_MIPMAP_NEAREST||n===s.Cj.LINEAR_MIPMAP_LINEAR?(n=s.Cj.LINEAR,t.hasMipmap||(i=s.Cj.LINEAR)):n!==s.Cj.NEAREST_MIPMAP_NEAREST&&n!==s.Cj.NEAREST_MIPMAP_LINEAR||(n=s.Cj.NEAREST,t.hasMipmap||(i=s.Cj.NEAREST)),e.texParameteri(t.target,e.TEXTURE_MAG_FILTER,n),e.texParameteri(t.target,e.TEXTURE_MIN_FILTER,i)}function d(e,t){"number"==typeof t.wrapMode?(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode)):(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode.s),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode.t))}function p(e){return null!=e&&"type"in e&&"compressed"===e.type}function f(e){return null!=e&&!p(e)&&!function(e){return null!=e&&"byteLength"in e}(e)}function m(e){return e===s.Ap.TEXTURE_3D||e===s.Ap.TEXTURE_2D_ARRAY}function g(e,t,n,i=1){let r=Math.max(t,n);return e===s.Ap.TEXTURE_3D&&(r=Math.max(r,i)),Math.round(Math.log(r)/Math.LN2)+1}c.TEXTURE_UNIT_FOR_UPDATES=0},10956:function(e,t,n){"use strict";n.d(t,{R:function(){return s},e:function(){return o}});var i=n(85456),r=n(93380);class s{constructor(e=0,t=e){this.width=e,this.height=t,this.target=i.Ap.TEXTURE_2D,this.pixelFormat=i.Ab.RGBA,this.dataType=i.ld.UNSIGNED_BYTE,this.samplingMode=i.Cj.LINEAR,this.wrapMode=i.pF.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}}function o(e){return e.width<=0||e.height<=0?0:Math.round(e.width*e.height*(e.hasMipmap?4/3:1)*(null==e.internalFormat?4:(0,r.IB)(e.internalFormat)))}},93380:function(e,t,n){"use strict";n.d(t,{Hi:function(){return l},IB:function(){return c},WH:function(){return o},yu:function(){return a}}),n(58941);var i=n(41835),r=n(85456),s=n(48347);function o(e){const t=e.gl;switch(t.getError()){case t.NO_ERROR:return null;case t.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case t.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case t.INVALID_OPERATION:return"The specified command is not allowed for the current state";case t.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case t.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case t.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function a(e,t,n,r,a=0){const l=e.gl;e.bindBuffer(n);for(const n of r){const r=t.get(n.name);if(void 0===r){console.warn(`There is no location for vertex attribute '${n.name}' defined.`);continue}const c=a*n.stride;if(n.count<=4)l.vertexAttribPointer(r,n.count,n.type,n.normalized,n.stride,n.offset+c),l.enableVertexAttribArray(r),n.divisor>0&&e.gl.vertexAttribDivisor(r,n.divisor);else if(9===n.count)for(let t=0;t<3;t++)l.vertexAttribPointer(r+t,3,n.type,n.normalized,n.stride,n.offset+12*t+c),l.enableVertexAttribArray(r+t),n.divisor>0&&e.gl.vertexAttribDivisor(r+t,n.divisor);else if(16===n.count)for(let t=0;t<4;t++)l.vertexAttribPointer(r+t,4,n.type,n.normalized,n.stride,n.offset+16*t+c),l.enableVertexAttribArray(r+t),n.divisor>0&&e.gl?.vertexAttribDivisor(r+t,n.divisor);else console.error("Unsupported vertex attribute element count: "+n.count);if((0,i.en)()){const t=o(e),i=(0,s._)(n.type),r=n.offset,a=Math.round(i/r)!==i/r?`. Offset not a multiple of stride. DataType requires ${i} bytes, but descriptor has an offset of ${r}`:"";t&&console.error(`Unable to bind vertex attribute "${n.name}" with baseInstanceOffset ${c}${a}:`,t,n)}}}function l(e,t,n,i){const s=e.gl;e.bindBuffer(n);for(const n of i){const i=t.get(n.name);if(n.count<=4)s.disableVertexAttribArray(i),n.divisor&&n.divisor>0&&e.gl?.vertexAttribDivisor(i,0);else if(9===n.count)for(let t=0;t<3;t++)s.disableVertexAttribArray(i+t),n.divisor&&n.divisor>0&&e.gl?.vertexAttribDivisor(i+t,0);else if(16===n.count)for(let t=0;t<4;t++)s.disableVertexAttribArray(i+t),n.divisor&&n.divisor>0&&e.gl?.vertexAttribDivisor(i+t,0);else console.error("Unsupported vertex attribute element count: "+n.count)}e.unbindBuffer(r.NZ.ARRAY_BUFFER)}function c(e){switch(e){case r.Ab.ALPHA:case r.Ab.LUMINANCE:case r.Ab.RED:case r.Ab.RED_INTEGER:case r.H0.R8:case r.H0.R8I:case r.H0.R8UI:case r.H0.R8_SNORM:case r.yQ.STENCIL_INDEX8:return 1;case r.Ab.LUMINANCE_ALPHA:case r.Ab.RG:case r.Ab.RG_INTEGER:case r.H0.RGBA4:case r.H0.R16F:case r.H0.R16I:case r.H0.R16UI:case r.H0.RG8:case r.H0.RG8I:case r.H0.RG8UI:case r.H0.RG8_SNORM:case r.H0.RGB565:case r.H0.RGB5_A1:case r.yQ.DEPTH_COMPONENT16:return 2;case r.Ab.DEPTH_COMPONENT:case r.Ab.RGB:case r.Ab.RGB_INTEGER:case r.H0.RGB8:case r.H0.RGB8I:case r.H0.RGB8UI:case r.H0.RGB8_SNORM:case r.H0.SRGB8:case r.yQ.DEPTH_COMPONENT24:return 3;case r.Ab.DEPTH_STENCIL:case r.Ab.DEPTH24_STENCIL8:case r.Ab.RGBA:case r.Ab.RGBA_INTEGER:case r.H0.RGBA8:case r.H0.R32F:case r.H0.R11F_G11F_B10F:case r.H0.RG16F:case r.H0.R32I:case r.H0.R32UI:case r.H0.RG16I:case r.H0.RG16UI:case r.H0.RGBA8I:case r.H0.RGBA8UI:case r.H0.RGBA8_SNORM:case r.H0.SRGB8_ALPHA8:case r.H0.RGB9_E5:case r.H0.RGB10_A2UI:case r.H0.RGB10_A2:case r.yQ.DEPTH_STENCIL:case r.yQ.DEPTH_COMPONENT32F:case r.yQ.DEPTH24_STENCIL8:return 4;case r.yQ.DEPTH32F_STENCIL8:return 5;case r.H0.RGB16F:case r.H0.RGB16I:case r.H0.RGB16UI:return 6;case r.H0.RG32F:case r.H0.RG32I:case r.H0.RG32UI:case r.H0.RGBA16F:case r.H0.RGBA16I:case r.H0.RGBA16UI:return 8;case r.H0.RGB32F:case r.H0.RGB32I:case r.H0.RGB32UI:return 12;case r.H0.RGBA32F:case r.H0.RGBA32I:case r.H0.RGBA32UI:return 16;case r.CQ.COMPRESSED_RGB_S3TC_DXT1_EXT:case r.CQ.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case r.CQ.COMPRESSED_RGBA_S3TC_DXT3_EXT:case r.CQ.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case r.CQ.COMPRESSED_R11_EAC:case r.CQ.COMPRESSED_SIGNED_R11_EAC:case r.CQ.COMPRESSED_RGB8_ETC2:case r.CQ.COMPRESSED_SRGB8_ETC2:case r.CQ.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case r.CQ.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;case r.CQ.COMPRESSED_RG11_EAC:case r.CQ.COMPRESSED_SIGNED_RG11_EAC:case r.CQ.COMPRESSED_RGBA8_ETC2_EAC:case r.CQ.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}},81438:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var i=n(40633),r=n(95929),s=n(24540),o=n(85456),a=n(93380);const l=()=>i.A.getLogger("esri.views.webgl.VertexArrayObject");let c=class{constructor(e,t,n,i,r=null){this._context=e,this._locations=t,this._layout=n,this._buffers=i,this._indexBuffer=r,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce(((e,t)=>e+this._buffers[t].usedMemory),null!=this._indexBuffer?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*s.zQ}dispose(){if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const e in this._buffers)this._buffers[e]?.dispose(),delete this._buffers[e];this._indexBuffer=(0,r.WD)(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&l().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(o.vt.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:e}=this._context,t=e.createVertexArray();e.bindVertexArray(t),this._bindLayout(),e.bindVertexArray(null),this._glName=t,this._context.instanceCounter.increment(o.vt.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:e,_layout:t,_indexBuffer:n}=this;e||l().error("Vertex buffer dictionary is empty!");const i=this._context.gl;for(const n in e){const i=e[n];i||l().error("Vertex buffer is uninitialized!");const r=t[n];r||l().error("Vertex element descriptor is empty!"),(0,a.yu)(this._context,this._locations,i,r)}null!=n&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,n.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}}},3817:function(e,t,n){"use strict";n.d(t,{_:function(){return i}});class i{constructor(e,t,n,i,r,s=!1,o=0){this.name=e,this.count=t,this.type=n,this.offset=i,this.stride=r,this.normalized=s,this.divisor=o}}},41835:function(e,t,n){"use strict";n.d(t,{Xc:function(){return c},Y2:function(){return u},en:function(){return l}});var i=n(39819),r=n(58941),s=n(40633);const o=()=>s.A.getLogger("esri.views.webgl.checkWebGLError"),a=!!(0,r.A)("enable-feature:webgl-debug");function l(){return a}function c(){return a}function u(e){if(l()){const t=e.getError();if(t){const n=function(e,t){switch(t){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}(e,t),r=(new Error).stack;o().error(new i.A("webgl-error","WebGL error occurred",{message:n,stack:r}))}}}},44476:function(e,t,n){"use strict";function i(e,t,n){for(let i=0;i<n;++i)t[2*i]=e[i],t[2*i+1]=e[i]-t[2*i]}function r(e,t){const n=e.length;for(let i=0;i<n;++i)o[0]=e[i],t[i]=o[0];return t}function s(e,t){const n=e.length;for(let i=0;i<n;++i)o[0]=e[i],o[1]=e[i]-o[0],t[i]=o[1];return t}n.d(t,{Zo:function(){return r},jA:function(){return s},jS:function(){return i}});const o=new Float32Array(2)},85456:function(e,t,n){"use strict";var i,r,s,o,a,l,c,u,h,d,p,f,m,g,_,v,y,b,T,E;n.d(t,{Ab:function(){return g},Ac:function(){return c},Ap:function(){return m},CQ:function(){return O},Cj:function(){return p},Co:function(){return T},H0:function(){return _},Hr:function(){return A},MT:function(){return h},NZ:function(){return a},Nm:function(){return w},R:function(){return E},Tb:function(){return o},WR:function(){return r},Y7:function(){return l},_U:function(){return b},dn:function(){return s},eA:function(){return d},hn:function(){return i},ld:function(){return v},nI:function(){return M},pF:function(){return f},pe:function(){return u},sS:function(){return P},tx:function(){return D},vt:function(){return S},xM:function(){return x},xV:function(){return R},yQ:function(){return y}}),function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"}(i||(i={})),function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(r||(r={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(s||(s={})),function(e){e[e.ADD=32774]="ADD",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.SUBTRACT=32778]="SUBTRACT",e[e.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(o||(o={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER"}(a||(a={})),function(e){e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(l||(l={})),function(e){e[e.CW=2304]="CW",e[e.CCW=2305]="CCW"}(c||(c={})),function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.HALF_FLOAT=5131]="HALF_FLOAT"}(u||(u={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(h||(h={})),function(e){e[e.ZERO=0]="ZERO",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP"}(d||(d={})),function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(p||(p={})),function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(f||(f={})),function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(m||(m={})),function(e){e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.RG=33319]="RG",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER"}(g||(g={})),function(e){e[e.RGBA4=32854]="RGBA4",e[e.R16F=33325]="R16F",e[e.RG16F=33327]="RG16F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.R32F=33326]="R32F",e[e.RG32F=33328]="RG32F",e[e.RGBA32F=34836]="RGBA32F",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB5_A1=32855]="RGB5_A1",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.RGB16F=34843]="RGB16F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.RGB565=36194]="RGB565",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2=32857]="RGB10_A2",e[e.RGB10_A2UI=36975]="RGB10_A2UI"}(_||(_={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.INT=5124]="INT",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(v||(v={})),function(e){e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(y||(y={})),function(e){e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_READ=35045]="STATIC_READ",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.STREAM_COPY=35042]="STREAM_COPY"}(b||(b={})),function(e){e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER"}(T||(T={})),function(e){e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(E||(E={}));const x=33984;var S,w,A;!function(e){e[e.Texture=0]="Texture",e[e.BufferObject=1]="BufferObject",e[e.VertexArrayObject=2]="VertexArrayObject",e[e.Shader=3]="Shader",e[e.Program=4]="Program",e[e.FramebufferObject=5]="FramebufferObject",e[e.Renderbuffer=6]="Renderbuffer",e[e.TransformFeedback=7]="TransformFeedback",e[e.Sync=8]="Sync",e[e.UNCOUNTED=9]="UNCOUNTED",e[e.LinesOfCode=9]="LinesOfCode",e[e.Uniform=10]="Uniform",e[e.COUNT=11]="COUNT"}(S||(S={})),function(e){e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(w||(w={})),function(e){e[e.NONE=0]="NONE",e[e.BACK=1029]="BACK"}(A||(A={}));const M=33306;var O,R,C,I,P,D,L;!function(e){e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"}(O||(O={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT=5124]="INT",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(R||(R={})),function(e){e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS"}(C||(C={})),function(e){e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED"}(I||(I={})),function(e){e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED"}(P||(P={})),function(e){e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(D||(D={})),function(e){e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(L||(L={}))},48347:function(e,t,n){"use strict";n.d(t,{_:function(){return r}});var i=n(85456);function r(e){switch(e){case i.pe.BYTE:case i.pe.UNSIGNED_BYTE:return 1;case i.pe.SHORT:case i.pe.UNSIGNED_SHORT:case i.pe.HALF_FLOAT:return 2;case i.pe.FLOAT:case i.pe.INT:case i.pe.UNSIGNED_INT:return 4}}},57087:function(e,t,n){"use strict";n.d(t,{Ey:function(){return T},Ms:function(){return G},Xt:function(){return c},hG:function(){return l},kn:function(){return u},ox:function(){return s},p3:function(){return o},wE:function(){return h}});var i=n(54407),r=n(85456);function s(e,t,n=r.Tb.ADD,i=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:n,opAlpha:n,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function o(e,t,n,i,s=r.Tb.ADD,o=r.Tb.ADD,a=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:n,dstAlpha:i,opRgb:s,opAlpha:o,color:{r:a[0],g:a[1],b:a[2],a:a[3]}}}const a={face:r.Y7.BACK,mode:r.Ac.CCW},l={face:r.Y7.FRONT,mode:r.Ac.CCW},c=e=>e===i.s2.Back?a:e===i.s2.Front?l:null,u={zNear:0,zFar:1},h={r:!0,g:!0,b:!0,a:!0};function d(e){return S.intern(e)}function p(e){return A.intern(e)}function f(e){return O.intern(e)}function m(e){return C.intern(e)}function g(e){return P.intern(e)}function _(e){return L.intern(e)}function v(e){return F.intern(e)}function y(e){return V.intern(e)}function b(e){return U.intern(e)}function T(e){return j.intern(e)}class E{constructor(e,t){this._makeKey=e,this._makeRef=t,this._interns=new Map}intern(e){if(!e)return null;const t=this._makeKey(e),n=this._interns;return n.has(t)||n.set(t,this._makeRef(e)),n.get(t)??null}}function x(e){return"["+e.join(",")+"]"}const S=new E(w,(e=>({__tag:"Blending",...e})));function w(e){return e?x([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const A=new E(M,(e=>({__tag:"Culling",...e})));function M(e){return e?x([e.face,e.mode]):null}const O=new E(R,(e=>({__tag:"PolygonOffset",...e})));function R(e){return e?x([e.factor,e.units]):null}const C=new E(I,(e=>({__tag:"DepthTest",...e})));function I(e){return e?x([e.func]):null}const P=new E(D,(e=>({__tag:"StencilTest",...e})));function D(e){return e?x([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const L=new E(N,(e=>({__tag:"DepthWrite",...e})));function N(e){return e?x([e.zNear,e.zFar]):null}const F=new E(z,(e=>({__tag:"ColorWrite",...e})));function z(e){return e?x([e.r,e.g,e.b,e.a]):null}const V=new E(H,(e=>({__tag:"StencilWrite",...e})));function H(e){return e?x([e.mask]):null}const U=new E(k,(e=>({__tag:"DrawBuffers",...e})));function k(e){return e?x(e.buffers):null}const j=new E((function(e){return e?x([w(e.blending),M(e.culling),R(e.polygonOffset),I(e.depthTest),D(e.stencilTest),N(e.depthWrite),z(e.colorWrite),H(e.stencilWrite),k(e.drawBuffers)]):null}),(e=>({blending:d(e.blending),culling:p(e.culling),polygonOffset:f(e.polygonOffset),depthTest:m(e.depthTest),stencilTest:g(e.stencilTest),depthWrite:_(e.depthWrite),colorWrite:v(e.colorWrite),stencilWrite:y(e.stencilWrite),drawBuffers:b(e.drawBuffers)})));class G{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._setDrawBuffers(e.drawBuffers),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(e){this._drawBuffers=this._setSubState(e,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(e,t,n,i){return(n||e!==t)&&(i(e),this._pipelineInvalid=!0),e}}},31267:function(e,t,n){"use strict";n.d(t,{A:function(){return V}});var i=n(53804),r=(n(64122),n(88022)),s=n(88264),o=n(48996),a=n(40212),l=(n(58941),n(21609)),c=n(40633),u=n(95929),h=n(62560),d=n(60539),p=n(28181),f=n(66110),m=n(23502),g=n(77560),_=n(65953),v=n(44567),y=n(6792),b=n(92781);n(81401);const T={handleInterceptedEvent:(e,t,n,i)=>(e.scheduleRender(),t.properties[`on${i.type}`].apply(t.properties.bind||n,[i]))},E={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,n)=>{"-"===t.charAt(0)?e.style.setProperty(t,n):e.style[t]=n}},x=(e,t,n=!1)=>{let i=e;return t.forEach(((e,r)=>{const s=i?.children?((e,t)=>e.find(t))(i.children,(t=>t.domNode===e)):void 0;n&&!s&&r!==t.length-1||(i=s)})),i};var S=n(96018),w=n(69987),A=n(50074);const M=new Set;var O,R=n(15351),C=n(20457),I=n(22739),P=n(38225);let D=0;function L(e,t){const n=Object.prototype.hasOwnProperty;for(const i in t)n.call(t,i)&&n.call(e,i)&&(null!=e[i]&&null!=t[i]&&"object"==typeof e[i]&&"object"==typeof t[i]?L(e[i],t[i]):e[i]=t[i]);return e}const N=(e=>{let t;const n={...T,...e},i=(s=n,{...E,...s}),r=i.performanceLogger;var s;let o,a=!0,l=!1;const c=[],u=[],h=(e,s,o)=>{let a;i.eventHandlerInterceptor=(e,i,s,o)=>function(e){let i;r("domEvent",e);const s=((e,t)=>{const n=[];for(;e&&e!==t;)n.push(e),e=e.parentNode;return n})(e.currentTarget,a.domNode),o=s.some((e=>customElements.get(e?.tagName?.toLowerCase())));if(e.eventPhase!==Event.CAPTURING_PHASE&&o){const t=e.composedPath(),n=t.slice(t.indexOf(e.currentTarget),t.indexOf(a.domNode)).reverse();i=x(a.getLastRender(),n,!0)}else s.reverse(),i=x(a.getLastRender(),s);let l;return i&&(l=n.handleInterceptedEvent(t,i,this,e)),r("domEventProcessed",e),l},n.postProcessProjectionOptions?.(i);const l=o();a=e(s,l,i),i.eventHandlerInterceptor=void 0,c.push(a),u.push(o),n.afterFirstVNodeRendered&&n.afterFirstVNodeRendered(a,l)};let d=()=>{if(o=void 0,a){a=!1,r("renderStart",void 0);for(let e=0;e<c.length;e++){const t=u[e]();r("rendered",void 0),c[e].update(t),r("patched",void 0)}r("renderDone",void 0),a=!0}};return n.modifyDoRenderImplementation&&(d=n.modifyDoRenderImplementation(d,c,u)),t={renderNow:d,scheduleRender:()=>{o||l||(o=requestAnimationFrame(d))},stop:()=>{o&&(cancelAnimationFrame(o),o=void 0),l=!0},resume:()=>{l=!1,a=!0,t.scheduleRender()},append:(e,t)=>{h(b.t.append,e,t)},insertBefore:(e,t)=>{h(b.t.insertBefore,e,t)},merge:(e,t)=>{h(b.t.merge,e,t)},replace:(e,t)=>{h(b.t.replace,e,t)},detach:e=>{for(let t=0;t<u.length;t++)if(u[t]===e)return u.splice(t,1),c.splice(t,1)[0];throw new Error("renderFunction was not found")}},t})({postProcessProjectionOptions(e){const t=e.eventHandlerInterceptor,n=/capture$/i;e.eventHandlerInterceptor=(e,i,r,s)=>{const o=t?.(e,i,r,s),a=n.test(e);if(!((e=e.replace(n,"")).toLowerCase()in r)||a){const t=e[2].toLowerCase()+e.slice(3),n=e=>o?.call(r,e);r.addEventListener(t,n,a);const i=()=>r.removeEventListener(t,n,a),l=s.afterRemoved;s.afterRemoved=e=>{l?.(e),i()}}return o}},handleInterceptedEvent(e,t,n,i){const{eventPhase:r,type:s}=i,o=r===Event.CAPTURING_PHASE;let a=`on${s}${o?"capture":""}`;const l=t.properties;(l&&a in l||(a=`on${s[0].toUpperCase()}${s.slice(1)}${o?"Capture":""}`,l&&a in l))&&((0,R.Sh)(),e.scheduleRender(),l[a].call(l.bind||n,i))}});let F=!1,z=class extends((0,h.g)(o.A.EventedAccessor)){constructor(e,t){super(e,t),this._attached=!1,this._projector=N,this._readyForTrueRender=!1,this.key=this,this.autoRenderingEnabled=!0,this._loadLocale=(0,d.sg)((async()=>{if(this._messageBundleProps?.length){const e=await Promise.allSettled(this._messageBundleProps.map((async({bundlePath:e,propertyName:t})=>{if(this.destroyed)return;let n=await(0,P.ud)(e);this.uiStrings&&Object.keys(this.uiStrings)&&(n=L((0,l.o8)(n),this.uiStrings)),this[t]=n})));if(this.destroyed)return;for(const t of e)"rejected"===t.status&&c.A.getLogger(this).error("widget-intl:locale-error",this.declaredClass,t.reason)}await this.loadLocale()})),(0,S.V)();const n="esri-widget-uid-"+(0,f.lk)(),i=this.render.bind(this);this._trackingTarget=new y.r((()=>{this.autoRenderingEnabled&&this.scheduleRender()}));const r=()=>({vnodeSelector:"div",properties:{key:`${n}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}),s=()=>{if(!this._readyForTrueRender||this.destroyed)return null;const e=i()??r(),t=e.properties??={};if(t.key??=n,(0,w.b)(e.vnodeSelector)){if(!this.visible)return r()}else this.visible?t.styles||(t.styles={}):(t.class="",t.styles={display:"none"}),t.styles.display??="";let s=0;return e.children?.forEach((e=>{(0,w.b)(e.vnodeSelector)||(e.properties??={},e.properties.key??=`${this.id}--${s++}`)})),(0,w.d)(this,e)};this.render=()=>{if(F)return s();let e=(0,R.rE)(this)??null;if(e)return e;this._trackingTarget.clear(),F=!0;try{e=(0,v.a)(this._trackingTarget,s)}catch(e){throw c.A.getLogger(this).error(e),e}finally{F=!1}return e&&(0,R.$U)(this,e),e};const o=this.beforeFirstRender();var a;o?this._resourcesFetch=o.then((()=>{this._readyForTrueRender=!0,this._postInitialize()})):(this._resourcesFetch=Promise.resolve().then((()=>{this._postInitialize()})),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),a=this._resourcesFetch,M.add(a),a.finally((()=>M.delete(a)))}normalizeCtorArgs(e,t){const n={...e};return t&&(n.container=t),n}postInitialize(){}beforeFirstRender(){const e=this.loadDependencies();return this._messageBundleProps?.length||e?Promise.all([e,this._loadLocale()]).then((()=>{})).catch(d.jH):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||((0,u.pR)(this._trackingTarget),(0,u.pR)(this.viewModel),this._detach(this.container),this._set("container",null),this._emitter.clear(),this.render=()=>null,this._projector=null,(0,R.Qw)(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return(0,s.$H)(e)}get domNode(){return this.container}set domNode(e){this.container=e}get icon(){return null}set icon(e){this._overrideIfSome("icon",e)}get id(){return this._get("id")||this.container?.id||Date.now().toString(16)+"-widget-"+D++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(O=A.x,A.D)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||((0,R.Qw)(this),this._projector.scheduleRender())}own(e){(0,r.eO)(c.A.getLogger(this),"`Widget.own()` is deprecated in favor of 'Widget.addHandles()'",{replacement:"Widget.addHandles()",version:"4.28"}),this.addHandles(e)}classes(...e){return C.Ly.apply(this,e)}renderNow(){(0,R.Qw)(this),this._projector.renderNow()}_postInitialize(){if(this.destroyed)return;this.scheduleRender(),this._delegatedEventNames?.length&&this.addHandles((0,p.watch)((()=>this.viewModel),((e,t)=>{t&&this.removeHandles("delegated-events"),e&&(0,a.wb)(e)&&this.addHandles(this._delegatedEventNames.map((t=>(0,a.on)(e,t,(e=>{this.emit(t,e)})))),"delegated-events")}),p.pc)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(d.jH),this.scheduleRender()};this.addHandles([(0,I.oQ)(e),(0,p.watch)((()=>this.uiStrings),e),(0,p.when)((()=>this.container),(e=>{this.destroyed||this._attach(e)}),{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){this._attached&&(this._projector.detach(this.render),this._attached=!1),e?.parentNode?.removeChild(e)}};z[O]=!0,(0,i._)([(0,m.MZ)()],z.prototype,"_readyForTrueRender",void 0),(0,i._)([(0,m.MZ)({value:null})],z.prototype,"container",null),(0,i._)([(0,g.w)("container")],z.prototype,"castContainer",null),(0,i._)([(0,m.MZ)()],z.prototype,"icon",null),(0,i._)([(0,m.MZ)()],z.prototype,"id",null),(0,i._)([(0,m.MZ)()],z.prototype,"label",null),(0,i._)([(0,m.MZ)()],z.prototype,"renderable",null),(0,i._)([(0,m.MZ)()],z.prototype,"uiStrings",void 0),(0,i._)([(0,m.MZ)()],z.prototype,"viewModel",void 0),(0,i._)([(0,m.MZ)({value:!0})],z.prototype,"visible",null),(0,i._)([(0,m.MZ)()],z.prototype,"key",void 0),(0,i._)([(0,m.MZ)()],z.prototype,"children",void 0),(0,i._)([(0,m.MZ)()],z.prototype,"afterCreate",void 0),(0,i._)([(0,m.MZ)()],z.prototype,"afterUpdate",void 0),(0,i._)([(0,m.MZ)()],z.prototype,"afterRemoved",void 0),z=(0,i._)([(0,_.$)("esri.widgets.Widget")],z);const V=z},96018:function(e,t,n){"use strict";n.d(t,{V:function(){return c},W:function(){return u}});var i=n(4507),r=n(17858);function s(){const{classList:e}=document.body,t=window.matchMedia("(prefers-color-scheme: dark)").matches,n=()=>e.contains(i.d)||e.contains(i.a)&&t?"dark":"light",r=e=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:e}})),s=e=>{o!==e&&r(e),o=e};let o=n();r(o),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(e=>s(e.matches?"dark":"light"))),new MutationObserver((()=>s(n()))).observe(document.body,{attributes:!0,attributeFilter:["class"]})}"undefined"!=typeof window&&"undefined"!=typeof location&&"undefined"!=typeof document&&window.location===location&&window.document===document&&("interactive"===document.readyState?s():document.addEventListener("DOMContentLoaded",(()=>s()),{once:!0}));var o=n(53216),a=(n(58941),n(90683));let l;function c(){try{(0,r.OX)(".")}catch{(0,r.Qu)((0,a.s2)((0,o.s)(l)))}}function u(e){const t=[];for(const n of Object.keys(e))customElements.get(`calcite-${n}`)||t.push(e[n]?.());return t.length>0?Promise.all(t):null}l="components/assets"},90357:function(e,t,n){"use strict";function i(e){return(t,n)=>{t.hasOwnProperty("_messageBundleProps")||(t._messageBundleProps=t._messageBundleProps?t._messageBundleProps.slice():[]),t._messageBundleProps.push({bundlePath:e,propertyName:n})}}n.d(t,{G:function(){return i}})},49146:function(e,t,n){"use strict";n.d(t,{K:function(){return a},w:function(){return l}});var i=n(69987),r=function(e){return{vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}},s=function(e,t){for(var n=0,i=e.length;n<i;n++){var o=e[n];Array.isArray(o)?s(o,t):null!=o&&!1!==o&&(o.hasOwnProperty("vnodeSelector")||(o=r(o)),t.push(o))}},o=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(1===n.length&&"string"==typeof n[0])return{vnodeSelector:e,properties:t||void 0,children:void 0,text:n[0],domNode:null};var r=[];return s(n,r),{vnodeSelector:e,properties:t||void 0,children:r,text:void 0,domNode:null}};function a(e,t,...n){return"function"!=typeof e||(0,i.b)(e)?o(e,t,...n):e(t,...n)}function l(...e){return e}},69987:function(e,t,n){"use strict";n.d(t,{b:function(){return d},d:function(){return l}});var i=n(61226),r=n(50074);const s=[],o={},a=new WeakMap;function l(e,t){let n=t.children;if(n?.length)for(let t=0;t<n.length;++t)n[t]=l(e,n[t]);else n=s;const i=t.vnodeSelector;if(d(i)){const r=t.properties||o,s=r.key||i;return{vnodeSelector:"div",properties:{key:s,afterCreate:c,afterUpdate:u,afterRemoved:h,parentWidget:e,widgetConstructor:i,widgetProperties:{...r,key:s,children:n}},children:void 0,text:void 0,domNode:null}}return t}function c(e,t,n,{parentWidget:s,widgetConstructor:o,widgetProperties:l}){const c=new o(l);c.container=e,a.set(e,c),c.afterCreate?.(c,e),s.addHandles((0,i.hA)((()=>h(e)))),queueMicrotask((()=>{c[r.D].projector.renderNow()}))}function u(e,t,n,{widgetProperties:i}){const r=a.get(e);r&&(r.set(i),r.afterUpdate?.(r,e))}function h(e){const t=a.get(e);t&&(t.afterRemoved?.(t,e),t.destroy(),a.delete(e))}function d(e){return"function"==typeof e&&e[r.x]}},50074:function(e,t,n){"use strict";n.d(t,{D:function(){return r},x:function(){return i}});const i=Symbol("widget"),r=Symbol("widget-test-data")},15351:function(e,t,n){"use strict";n.d(t,{$U:function(){return o},Qw:function(){return a},Sh:function(){return r},rE:function(){return s}});const i=new Map;function r(){i.clear()}function s(e){return i.get(e)}function o(e,t){i.set(e,t)}function a(e){i.delete(e)}},20457:function(e,t,n){"use strict";n.d(t,{Ly:function(){return ce},N_:function(){return he},OU:function(){return ge},V8:function(){return ue},W5:function(){return me},cA:function(){return de}});var i=function(){return i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},i.apply(this,arguments)},r={exports:{}},s={},o={exports:{}},a={};function l(){return{"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1}}var c=/javascript\s*\:/gim;a.whiteList={"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1},a.getDefaultWhiteList=l,a.onAttr=function(e,t,n){},a.onIgnoreAttr=function(e,t,n){},a.safeAttrValue=function(e,t){return c.test(t)?"":t};var u={indexOf:function(e,t){var n,i;if(Array.prototype.indexOf)return e.indexOf(t);for(n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1},forEach:function(e,t,n){var i,r;if(Array.prototype.forEach)return e.forEach(t,n);for(i=0,r=e.length;i<r;i++)t.call(n,e[i],i,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}},h=u,d=a,p=function(e,t){";"!==(e=h.trimRight(e))[e.length-1]&&(e+=";");var n=e.length,i=!1,r=0,s=0,o="";function a(){if(!i){var n=h.trim(e.slice(r,s)),a=n.indexOf(":");if(-1!==a){var l=h.trim(n.slice(0,a)),c=h.trim(n.slice(a+1));if(l){var u=t(r,o.length,l,c,n);u&&(o+=u+"; ")}}}r=s+1}for(;s<n;s++){var l=e[s];if("/"===l&&"*"===e[s+1]){var c=e.indexOf("*/",s+2);if(-1===c)break;r=(s=c+1)+1,i=!1}else"("===l?i=!0:")"===l?i=!1:";"===l?i||a():"\n"===l&&a()}return h.trim(o)};function f(e){return null==e}function m(e){(e=function(e){var t={};for(var n in e)t[n]=e[n];return t}(e||{})).whiteList=e.whiteList||d.whiteList,e.onAttr=e.onAttr||d.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||d.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||d.safeAttrValue,this.options=e}m.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t=this.options,n=t.whiteList,i=t.onAttr,r=t.onIgnoreAttr,s=t.safeAttrValue;return p(e,(function(e,t,o,a,l){var c=n[o],u=!1;if(!0===c?u=c:"function"==typeof c?u=c(a):c instanceof RegExp&&(u=c.test(a)),!0!==u&&(u=!1),a=s(o,a)){var h,d={position:t,sourcePosition:e,source:l,isWhite:u};return u?f(h=i(o,a,d))?o+":"+a:h:f(h=r(o,a,d))?void 0:h}}))};var g=m;!function(e,t){var n=a,i=g;for(var r in(t=e.exports=function(e,t){return new i(t).process(e)}).FilterCSS=i,n)t[r]=n[r]}(o,o.exports);var _=o.exports,v={indexOf:function(e,t){var n,i;if(Array.prototype.indexOf)return e.indexOf(t);for(n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1},forEach:function(e,t,n){var i,r;if(Array.prototype.forEach)return e.forEach(t,n);for(i=0,r=e.length;i<r;i++)t.call(n,e[i],i,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/.exec(e);return t?t.index:-1}},y=_.FilterCSS,b=_.getDefaultWhiteList,T=v;var E=new y;function x(e){return e.replace(S,"&lt;").replace(w,"&gt;")}var S=/</g,w=/>/g,A=/"/g,M=/&quot;/g,O=/&#([a-zA-Z0-9]*);?/gim,R=/&colon;?/gim,C=/&newline;?/gim,I=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,P=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,D=/u\s*r\s*l\s*\(.*/gi;function L(e){return e.replace(A,"&quot;")}function N(e){return e.replace(M,'"')}function F(e){return e.replace(O,(function(e,t){return"x"===t[0]||"X"===t[0]?String.fromCharCode(parseInt(t.substr(1),16)):String.fromCharCode(parseInt(t,10))}))}function z(e){return e.replace(R,":").replace(C," ")}function V(e){for(var t="",n=0,i=e.length;n<i;n++)t+=e.charCodeAt(n)<32?" ":e.charAt(n);return T.trim(t)}function H(e){return V(e=z(e=F(e=N(e))))}function U(e){return x(e=L(e))}s.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height","loading"],ins:["datetime"],kbd:[],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]},s.getDefaultWhiteList=function(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height","loading"],ins:["datetime"],kbd:[],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}},s.onTag=function(e,t,n){},s.onIgnoreTag=function(e,t,n){},s.onTagAttr=function(e,t,n){},s.onIgnoreTagAttr=function(e,t,n){},s.safeAttrValue=function(e,t,n,i){if(n=H(n),"href"===t||"src"===t){if("#"===(n=T.trim(n)))return"#";if("http://"!==n.substr(0,7)&&"https://"!==n.substr(0,8)&&"mailto:"!==n.substr(0,7)&&"tel:"!==n.substr(0,4)&&"data:image/"!==n.substr(0,11)&&"ftp://"!==n.substr(0,6)&&"./"!==n.substr(0,2)&&"../"!==n.substr(0,3)&&"#"!==n[0]&&"/"!==n[0])return""}else if("background"===t){if(I.lastIndex=0,I.test(n))return""}else if("style"===t){if(P.lastIndex=0,P.test(n))return"";if(D.lastIndex=0,D.test(n)&&(I.lastIndex=0,I.test(n)))return"";!1!==i&&(n=(i=i||E).process(n))}return U(n)},s.escapeHtml=x,s.escapeQuote=L,s.unescapeQuote=N,s.escapeHtmlEntities=F,s.escapeDangerHtml5Entities=z,s.clearNonPrintableCharacter=V,s.friendlyAttrValue=H,s.escapeAttrValue=U,s.onIgnoreTagStripAll=function(){return""},s.StripTagBody=function(e,t){"function"!=typeof t&&(t=function(){});var n=!Array.isArray(e),i=[],r=!1;return{onIgnoreTag:function(s,o,a){if(function(t){return!!n||-1!==T.indexOf(e,t)}(s)){if(a.isClosing){var l=a.position+10;return i.push([!1!==r?r:a.position,l]),r=!1,"[/removed]"}return r||(r=a.position),"[removed]"}return t(s,o,a)},remove:function(e){var t="",n=0;return T.forEach(i,(function(i){t+=e.slice(n,i[0]),n=i[1]})),t+=e.slice(n)}}},s.stripCommentTag=function(e){for(var t="",n=0;n<e.length;){var i=e.indexOf("\x3c!--",n);if(-1===i){t+=e.slice(n);break}t+=e.slice(n,i);var r=e.indexOf("--\x3e",i);if(-1===r)break;n=r+3}return t},s.stripBlankChar=function(e){var t=e.split("");return(t=t.filter((function(e){var t=e.charCodeAt(0);return!(127===t||t<=31&&10!==t&&13!==t)}))).join("")},s.attributeWrapSign='"',s.cssFilter=E,s.getDefaultCSSWhiteList=b;var k={},j=v;function G(e){var t,n=j.spaceIndex(e);return t=-1===n?e.slice(1,-1):e.slice(1,n+1),"/"===(t=j.trim(t).toLowerCase()).slice(0,1)&&(t=t.slice(1)),"/"===t.slice(-1)&&(t=t.slice(0,-1)),t}function B(e){return"</"===e.slice(0,2)}var $=/[^a-zA-Z0-9\\_:.-]/gim;function Z(e,t){for(;t<e.length;t++){var n=e[t];if(" "!==n)return"="===n?t:-1}}function W(e,t){for(;t<e.length;t++){var n=e[t];if(" "!==n)return"'"===n||'"'===n?t:-1}}function q(e,t){for(;t>0;t--){var n=e[t];if(" "!==n)return"="===n?t:-1}}function X(e){return function(e){return'"'===e[0]&&'"'===e[e.length-1]||"'"===e[0]&&"'"===e[e.length-1]}(e)?e.substr(1,e.length-2):e}k.parseTag=function(e,t,n){var i="",r=0,s=!1,o=!1,a=0,l=e.length,c="",u="";e:for(a=0;a<l;a++){var h=e.charAt(a);if(!1===s){if("<"===h){s=a;continue}}else if(!1===o){if("<"===h){i+=n(e.slice(r,a)),s=a,r=a;continue}if(">"===h||a===l-1){i+=n(e.slice(r,s)),c=G(u=e.slice(s,a+1)),i+=t(s,i.length,c,u,B(u)),r=a+1,s=!1;continue}if('"'===h||"'"===h)for(var d=1,p=e.charAt(a-d);""===p.trim()||"="===p;){if("="===p){o=h;continue e}p=e.charAt(a-++d)}}else if(h===o){o=!1;continue}}return r<l&&(i+=n(e.substr(r))),i},k.parseAttr=function(e,t){var n=0,i=0,r=[],s=!1,o=e.length;function a(e,n){if(!((e=(e=j.trim(e)).replace($,"").toLowerCase()).length<1)){var i=t(e,n||"");i&&r.push(i)}}for(var l=0;l<o;l++){var c,u=e.charAt(l);if(!1!==s||"="!==u)if(!1===s||l!==i){if(/\s|\n|\t/.test(u)){if(e=e.replace(/\s|\n|\t/g," "),!1===s){if(-1===(c=Z(e,l))){a(j.trim(e.slice(n,l))),s=!1,n=l+1;continue}l=c-1;continue}if(-1===(c=q(e,l-1))){a(s,X(j.trim(e.slice(n,l)))),s=!1,n=l+1;continue}}}else{if(-1===(c=e.indexOf(u,l+1)))break;a(s,j.trim(e.slice(i+1,c))),s=!1,n=(l=c)+1}else s=e.slice(n,l),n=l+1,i='"'===e.charAt(n)||"'"===e.charAt(n)?n:W(e,l+1)}return n<e.length&&(!1===s?a(e.slice(n)):a(s,X(j.trim(e.slice(n))))),j.trim(r.join(" "))};var Y=_.FilterCSS,K=s,Q=k,J=Q.parseTag,ee=Q.parseAttr,te=v;function ne(e){return null==e}function ie(e){(e=function(e){var t={};for(var n in e)t[n]=e[n];return t}(e||{})).stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=K.onIgnoreTagStripAll),e.whiteList||e.allowList?e.whiteList=function(e){var t={};for(var n in e)Array.isArray(e[n])?t[n.toLowerCase()]=e[n].map((function(e){return e.toLowerCase()})):t[n.toLowerCase()]=e[n];return t}(e.whiteList||e.allowList):e.whiteList=K.whiteList,this.attributeWrapSign=!0===e.singleQuotedAttributeValue?"'":K.attributeWrapSign,e.onTag=e.onTag||K.onTag,e.onTagAttr=e.onTagAttr||K.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||K.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||K.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||K.safeAttrValue,e.escapeHtml=e.escapeHtml||K.escapeHtml,this.options=e,!1===e.css?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new Y(e.css))}ie.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t=this,n=t.options,i=n.whiteList,r=n.onTag,s=n.onIgnoreTag,o=n.onTagAttr,a=n.onIgnoreTagAttr,l=n.safeAttrValue,c=n.escapeHtml,u=t.attributeWrapSign,h=t.cssFilter;n.stripBlankChar&&(e=K.stripBlankChar(e)),n.allowCommentTag||(e=K.stripCommentTag(e));var d=!1;n.stripIgnoreTagBody&&(d=K.StripTagBody(n.stripIgnoreTagBody,s),s=d.onIgnoreTag);var p=J(e,(function(e,t,n,d,p){var f={sourcePosition:e,position:t,isClosing:p,isWhite:Object.prototype.hasOwnProperty.call(i,n)},m=r(n,d,f);if(!ne(m))return m;if(f.isWhite){if(f.isClosing)return"</"+n+">";var g=function(e){var t=te.spaceIndex(e);if(-1===t)return{html:"",closing:"/"===e[e.length-2]};var n="/"===(e=te.trim(e.slice(t+1,-1)))[e.length-1];return n&&(e=te.trim(e.slice(0,-1))),{html:e,closing:n}}(d),_=i[n],v=ee(g.html,(function(e,t){var i=-1!==te.indexOf(_,e),r=o(n,e,t,i);return ne(r)?i?(t=l(n,e,t,h))?e+"="+u+t+u:e:ne(r=a(n,e,t,i))?void 0:r:r}));return d="<"+n,v&&(d+=" "+v),g.closing&&(d+=" /"),d+">"}return ne(m=s(n,d,f))?c(d):m}),c);return d&&(p=d.remove(p)),p};var re=ie;!function(e,t){var n=s,i=k,r=re;function o(e,t){return new r(t).process(e)}(t=e.exports=o).filterXSS=o,t.FilterXSS=r,function(){for(var e in n)t[e]=n[e];for(var r in i)t[r]=i[r]}(),"undefined"!=typeof self&&"undefined"!=typeof DedicatedWorkerGlobalScope&&self instanceof DedicatedWorkerGlobalScope&&(self.filterXSS=e.exports)}(r,r.exports);var se=r.exports,oe=function(){function e(e,t){var n,r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],article:["style"],aside:["style"],audio:["autoplay","controls","loop","muted","preload"],b:[],blockquote:["style"],br:[],code:["style"],dd:["style"],details:["style"],div:["align","style","aria-label","aria-hidden"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],footer:["style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],header:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],main:["style"],mark:["style"],nav:["style"],ol:[],p:["style"],pre:["style"],section:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],summary:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],time:["style"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.arcgisCSSWhiteList=i(i({},se.getDefaultCSSWhiteList()),{flex:!0,"flex-basis":!0,"flex-direction":!0,"flex-flow":!0,"flex-grow":!0,"flex-shrink":!0,"flex-wrap":!0,"line-height":!0,"justify-content":!0,overflow:!0}),this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(e,t,n,i){return"a"===e&&"href"===t||("img"===e||"source"===e)&&"src"===t?r.sanitizeUrl(n):se.safeAttrValue(e,t,n,i)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"},e&&!t?n=e:e&&t?((n=Object.create(this.arcgisFilterOptions)).css={whiteList:this.arcgisCSSWhiteList},Object.keys(e).forEach((function(t){if("whiteList"===t)n.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,e.whiteList||{}]);else if("css"===t){var i=e.css.whiteList;null!=i&&e.css instanceof Object&&Object.keys(i).forEach((function(e){return n.css.whiteList[e]=i[e]}))}else n[t]=e[t]}))):((n=Object.create(this.arcgisFilterOptions)).whiteList=this.arcgisWhiteList,n.css={whiteList:this.arcgisCSSWhiteList}),this.xssFilterOptions=n,this._xssFilter=new se.FilterXSS(n)}return e.prototype.sanitize=function(e,t){switch(void 0===t&&(t={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,t);default:if(t.allowUndefined&&void 0===e)return;return null}},e.prototype.sanitizeUrl=function(e,t){var n=(null!=t?t:{}).isProtocolRequired,i=void 0===n||n,r=this._trim(e.substring(0,e.indexOf(":"))),s="/"===e,o=/^#/.test(e),a=r&&this.allowedProtocols.indexOf(r.toLowerCase())>-1;return s||o||a?se.escapeAttrValue(e):r||i?"":se.escapeAttrValue("https://".concat(e))},e.prototype.sanitizeHTMLAttribute=function(e,t,n,i){return"function"==typeof this.xssFilterOptions.safeAttrValue?this.xssFilterOptions.safeAttrValue(e,t,n,i):se.safeAttrValue(e,t,n,i)},e.prototype.validate=function(e,t){void 0===t&&(t={});var n=this.sanitize(e,t);return{isValid:e===n,sanitized:n}},e.prototype.encodeHTML=function(e){var t=this;return String(e).replace(/[&<>"'\/]/g,(function(e){return t._entityMap[e]}))},e.prototype.encodeAttrValue=function(e){var t=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,(function(n,i){return t.test(n)?n:"&#x".concat(Number(e.charCodeAt(i)).toString(16),";")}))},e.prototype._extendObjectOfArrays=function(e){var t={};return e.forEach((function(e){Object.keys(e).forEach((function(n){Array.isArray(e[n])&&Array.isArray(t[n])?t[n]=t[n].concat(e[n]):t[n]=e[n]}))})),t},e.prototype._iterateOverObject=function(e,t){var n=this;void 0===t&&(t={});try{var i=!1,r=void 0;if(Array.isArray(e))r=e.reduce((function(e,r){var s=n.validate(r,t);return s.isValid?e.concat([r]):(i=!0,e.concat([s.sanitized]))}),[]);else{if(!function(e){if("object"!=typeof e||null===e)return!1;if("[object Object]"!==Object.prototype.toString.call(e))return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(e)){if(t.allowUndefined&&void 0===e)return;return null}r=Object.keys(e).reduce((function(r,s){var o=e[s],a=n.validate(o,t);return a.isValid?r[s]=o:(i=!0,r[s]=a.sanitized),r}),{})}return i?r:e}catch(e){return null}},e.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},e}(),ae=n(14130),le=(n(61226),n(58941),n(40633),n(28181),n(15351));function ce(...e){const t=ae.A.acquire();for(let n=0;n<e.length;n++){const i=e[n],r=typeof i;if("string"===r)t.push(i);else if(Array.isArray(i))t.push.apply(t,i);else if("object"===r)for(const e in i)i[e]&&t.push(e)}const n=t.join(" ");return ae.A.release(t),n}function ue(e){const t=e?.closest("[dir]");return null!==t&&t instanceof HTMLElement&&"rtl"===t.dir||"rtl"===document.dir}function he(e){this[e.getAttribute("data-node-ref")]=null}function de(e){this[e.getAttribute("data-node-ref")]=e}(()=>{const e=new Map;new ResizeObserver((t=>{(0,le.Sh)();for(const n of t)e.get(n.target)?.(n)}))})();const pe=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"].reduce(((e,t)=>(e[t]=[],e)),{}),fe=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],me=new oe({whiteList:pe,onTagAttr:(e,t,n)=>{const i=`${t}="${n}"`;if(fe.includes(t))return i},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function ge(e){return"Enter"===e||" "===e}},4507:function(e,t,n){"use strict";n.d(t,{C:function(){return s},a:function(){return i},d:function(){return r}});const i="calcite-mode-auto",r="calcite-mode-dark",s={autoMode:i,darkMode:r,lightMode:"calcite-mode-light",rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateIn:"calcite-animate__in",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left",calciteAnimateInScale:"calcite-animate__in-scale"}}}]);
//# sourceMappingURL=views-3d-interactive-editingTools.js.map